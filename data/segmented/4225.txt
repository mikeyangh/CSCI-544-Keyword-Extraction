Page1/ 改进/ 的/ 基于/ 屏幕/ 空间/ 环境/ 遮挡/ 邱祥松/ 1/ )/ ,/ 2/ )/ 李泽/ 癉/ 2/ )/ 吴志红/ 1/ )/ ,/ 2/ )/ 时/ 宏伟/ 2/ )/ 张/ 严辞/ 1/ )/ ,/ 2/ )/ 1/ )/ (/ 四川大学/ 计算机/ 学院/ 成都/ 610065/ )/ 2/ )/ (/ 四川大学/ 视觉/ 合成/ 图形图像/ 技术/ 国防/ 重点学科/ 实验室/ 成都/ 610065/ )/ 摘要/ 基于/ 屏幕/ 空间/ 环境/ 遮挡/ 以/ 牺牲/ 计算精度/ 与/ 部分/ 效果/ 作为/ 代价/ ,/ 换取/ 场景/ 的/ 实时/ 渲染/ ./ 文中/ 针对/ 基于/ 屏幕/ 空间/ 环境/ 遮挡/ 技术/ 在/ 采样/ 方式/ 、/ 遮挡/ 因子/ 计算/ 和/ 平滑/ 滤波/ 3/ 个/ 方面/ 的/ 缺陷/ ,/ 提出/ 相应/ 的/ 改进/ 方法/ ./ 采样/ 方式/ 方面/ ,/ 在/ 三维空间/ 构建/ 平行/ 于/ 投影/ 平面/ 的/ 圆盘/ ,/ 并/ 根据/ 其/ 在/ 屏幕/ 的/ 投影/ 来/ 计算/ 采样/ 范围/ ,/ 然后/ 采用/ 类似/ 正态分布/ 的/ 方法/ 结合/ 随机/ 纹理/ ,/ 对/ 采样/ 范围/ 内/ 的/ 纹素/ 采样/ ;/ 在/ 遮挡/ 因子/ 计算/ 方面/ ,/ 增加/ 衰减系数/ ,/ 调整/ 采样/ 点/ 对/ 遮挡/ 因子/ 的/ 贡献/ ;/ 最后/ ,/ 使用/ 双边/ 滤波/ 来/ 平滑/ 图像/ ,/ 保持/ 场景/ 边缘/ ,/ 突出/ 细节/ 信息/ ./ 关键词/ 环境/ 遮挡/ ;/ 屏幕/ 空间/ ;/ 圆盘/ 采样/ ;/ 双边/ 滤波/ ;/ 光线/ 跟踪/ 1/ 引言/ 全局/ 光照/ 技术/ 作为/ 对/ 真实/ 光照/ 的/ 逼真/ 模拟/ ,/ 目前/ 被/ 大量/ 使用/ 在/ 电影/ 特效/ 等/ 离线/ 应用/ 中/ ./ 但/ 由于/ 其/ 巨大/ 的/ 计算/ 量/ ,/ 即使/ 在/ 目前/ 图形/ 处理器/ (/ GraphicsPage2/ 时/ 执行/ ,/ 因此/ 被/ 广泛/ 的/ 应用/ 在/ 游戏/ 中/ [/ 3/ -/ 4/ ]/ ./ 基于/ 顶点/ 的/ AO/ 技术/ 在/ 模型/ 表面/ 顶点/ 足够/ 密/ 的/ 情况/ 下/ ,/ 能够/ 得到/ 很/ 好/ 的/ 效果/ ,/ 但/ 这种/ 方法/ 却/ 由于/ 计算/ 量/ 巨大/ 而/ 只能/ 用于/ 离线/ 渲染/ ./ 为/ 达到/ 实时/ 计算/ 的/ 目的/ ,/ 提出/ 基于/ 屏幕/ 空间/ 的/ 环境/ 遮挡/ 技术/ (/ ScreenSpaceAmbientOcclusion/ ,/ SSAO/ )/ ,/ 对/ 每个/ 像素/ 的/ 邻域/ 进行/ 随机/ 采样/ 快速/ 计算/ AO/ 的/ 近似值/ ./ 由于/ SSAO/ 使用/ 较/ 少/ 采样/ 点/ 的/ 方法/ ,/ 从而/ 会/ 引起/ 渲染/ 结果/ 出现/ 大量/ 噪点/ [/ 5/ ]/ ,/ 自/ 遮挡/ 误差/ [/ 6/ ]/ ,/ 阴影/ 效果/ 不/ 明显/ ,/ 且/ 在/ 计算精度/ 不够/ 时会/ 丢失/ 更/ 多/ 细节/ [/ 7/ ]/ ./ 当/ 屏幕/ 空间/ 中/ 相邻/ 的/ 采样/ 点/ 位置/ 在/ 实际/ 视点/ 空间/ 中距离/ 偏差/ 较大/ 时/ ,/ 将/ 导致/ 遮挡/ 值/ 计算/ 出现/ 误差/ ./ 同时/ ,/ SSAO/ 只/ 根据/ 当前/ 可见/ 像素/ 进行/ 遮挡/ 计算/ ,/ 在/ 视点/ 移动/ 时/ 容易/ 出现/ 帧/ 闪烁/ 现象/ ./ 针对/ SSAO/ 技术/ 在/ 采样/ 方式/ ,/ AO/ 因子/ 计算/ 和/ 图像/ 平滑/ 滤波/ 等/ 方面/ 的/ 缺陷/ ,/ 本文/ 提出/ 了/ 相应/ 的/ 改进/ 方法/ (/ ImprovedScreenSpaceAmbientOcclusion/ ,/ ISSAO/ )/ ./ 本文/ 的/ 主要/ 贡献/ :/ (/ 1/ )/ 根据/ 视点/ 坐标系/ 中/ 生成/ 的/ 圆盘/ 在/ 屏幕/ 空间/ 的/ 投影/ 来/ 确定/ 采样/ 范围/ ,/ 并/ 使用/ 类似/ 正态分布/ 的/ 方法/ 来/ 选取/ 采样/ 点/ 的/ 位置/ ;/ (/ 2/ )/ 采用/ 新型/ 衰减/ 表示/ 函数/ ,/ 加入/ 可控/ 参数/ 来/ 计算/ 当前/ 点/ 的/ 遮挡/ 因子/ ;/ (/ 3/ )/ 采用/ 改进/ 的/ 双边/ 滤波/ 处理/ 噪点/ ./ 2/ 相关/ 工作/ Zhukov/ 等/ 人/ [/ 8/ ]/ 提出/ 利用/ 场景/ 表面/ 的/ 可见/ 点/ 发射/ 射线/ ,/ 判断/ 与/ 周围/ 物体/ 的/ 相交/ 情况/ ,/ 计算/ 点/ 与/ 周围/ 物体/ 的/ 遮挡/ 关系/ 模型/ ./ Landis/ [/ 1/ ]/ 在/ Zhukov/ 等/ 人/ 提出/ 的/ 模型/ 基础/ 上/ ,/ 改进/ 遮挡/ 的/ 计算/ 方式/ ,/ 称作/ AO/ ,/ 计算/ 效率/ 得到/ 大幅/ 提升/ ./ 后来/ ,/ Kontkanen/ 等/ 人/ [/ 9/ ]/ 提出/ 对/ 每个/ 遮挡/ 物/ ,/ 提前/ 计算/ 一个/ 空间/ 区域/ ,/ 利用/ 场景/ 上点/ 的/ 相关/ 信息/ ,/ 近似/ 表示/ 可见/ 点/ 被/ 遮挡/ 的/ 比例/ ,/ 提升/ 执行/ 效率/ ./ Shanmugam/ 等/ 人/ [/ 10/ ]/ 在/ AO/ 思想/ 的/ 基础/ 上/ ,/ 结合/ 硬件加速/ 的/ 方法/ ,/ 将/ AO/ 分解/ 为/ 高频/ 的/ AO/ 和/ 低频/ 的/ AO/ 进行/ 计算/ ./ NVIDIA/ 公司/ 根据/ AO/ 的/ 原理/ ,/ 预计/ 算/ AO/ 值/ ,/ 存储/ 在/ 三维/ 网格/ 之中/ 并/ 通过/ 检索/ 相应/ 值/ 使用/ [/ 11/ ]/ ./ Crytex/ 游戏/ 公司/ 最先/ 提出/ SSAO/ 理论/ [/ 3/ ]/ 改进/ AO/ 计算/ ,/ 只/ 需/ 计算/ 可视/ 区域/ 场景/ 的/ 几何/ 物体/ 之间/ 的/ 位置/ 遮挡/ 关系/ ./ 这种/ 方法/ 不仅/ 适用/ 于/ 静态/ 场景/ ,/ 更/ 适用/ 于/ 各种/ 动态/ 场景/ ,/ 极大地提高/ AO/ 计算/ 的/ 实时性/ ./ SSAO/ 算法/ ,/ 将/ 空间/ 物体/ 表面/ 的/ 可/ 视点/ ,/ 映射/ 到/ 纹理/ 中/ ,/ 采样/ 计算/ AO/ 因子/ ./ 这样/ 的/ 算法/ 虽然/ 效率高/ ,/ 但是/ 带来/ 因/ 采样/ 较少/ 而/ 产生/ 的/ 噪点/ 以及/ 部分/ 效果/ 的/ 丢失/ ./ 在/ 2008/ 年/ ,/ Bavoil/ 等/ 人/ [/ 7/ ]/ 提出/ HBAO/ (/ Horizon/ -/ BasedAmbientOcclusion/ )/ 算法/ ,/ 采用/ 极坐标/ 进行/ 积分/ ,/ 利用/ 空间/ 夹角/ 计算/ AO/ ;/ 紧接着/ 又/ 提出/ MDAO/ [/ 12/ ]/ (/ Multi/ -/ LayerDual/ -/ ResolutionScreen/ -/ SpaceAmbientOcclusion/ )/ 的/ 想法/ ,/ 采用/ 基于/ 深度/ 的/ 多层/ 采样/ 和/ 不同/ 的/ 分辨率/ 纹理/ 进行/ 处理/ ,/ 增强/ 渲染/ 效果/ ./ 最近/ ,/ 仍/ 有/ 大量/ 学者/ 针对/ AO/ 进行/ 改进/ ./ Reinbothe/ 等/ 人/ [/ 13/ ]/ 提出/ HAO/ (/ HybridAmbientOcclusion/ )/ ,/ 联系/ 物体/ 空间/ 和/ 屏幕/ 空间/ 计算/ AO/ ,/ 保留/ 场景/ 周围/ 所有/ 的/ 物体/ 信息/ ,/ 消除/ 几何图形/ 光栅/ 化到/ Z/ 缓存/ 引起/ 的/ 问题/ ./ Mattausch/ 等/ 人/ [/ 14/ ]/ 提出/ TSSAO/ (/ High/ -/ QualityScreen/ -/ SpaceAmbientOcclusionusingTemporalCoherence/ )/ ,/ 使用/ 帧/ 相关性/ ,/ 复用/ 上/ 一帧/ 结果/ 进行/ 累加/ ,/ 获取/ 高质量/ 的/ AO/ ./ Loos/ 等/ 人/ [/ 6/ ]/ 提出/ VO/ (/ VolumetricObscurance/ )/ 算法/ ,/ 利用/ 平面/ 线段/ 或者/ 面积/ 采样/ 代替/ 点/ 采样/ 的/ 方式/ ,/ 计算/ 遮挡/ 区域/ 体积/ 比例/ 近似/ AO/ 因子/ ./ 在/ 2011/ 年/ ,/ McGuire/ 等/ 人/ [/ 5/ ]/ 提出/ 基于/ Alchemy/ 游戏/ 引擎/ 下/ 的/ AlchemyAO/ (/ TheAlchemyScreen/ -/ SpaceAmbientObscuranceAlgorithm/ )/ 算法/ ,/ 在/ AO/ 因子/ 计算公式/ 中/ ,/ 引进/ 可/ 调控/ 的/ 参数/ 因子/ ,/ 调整/ 显示/ 结果/ ./ 3/ 算法/ 概述/ 基于/ 屏幕/ 空间/ 的/ AO/ 算法/ 通过/ 在/ 屏幕/ 空间/ 进行/ 随机/ 采样/ ,/ 并/ 根据/ 采样/ 点/ 的/ 空间/ 分布/ 来/ 估算/ AO/ 因子/ ./ 由于/ 所有/ 的/ 计算/ 都/ 发生/ 在/ 屏幕/ 空间/ ,/ 因此/ 这/ 类/ 算法/ 的/ 执行/ 效率/ 非常/ 高/ ,/ 但/ 在/ 计算/ 的/ 精度/ 上/ ,/ 却/ 难以/ 和/ 基于/ 顶点/ 的/ AO/ 计算/ 相比/ ./ 同时/ ,/ 由于/ 视点/ 移动/ 以及/ 随机/ 采样/ 等/ 因素/ ,/ 基于/ 屏幕/ 空间/ 的/ AO/ 算法/ 往往/ 需要/ 使用/ 平滑/ 滤波/ 的/ 方式/ 来/ 消除/ 采样/ 较少/ 或/ 不足/ 所/ 产生/ 的/ 噪点/ ./ 综上所述/ ,/ 基于/ 屏幕/ 空间/ 的/ AO/ 算法/ 以/ 牺牲/ 部分/ 渲染/ 效果/ 和/ 精度/ 的/ 代价/ ,/ 来/ 换取/ 实时/ 渲染/ ./ 本文/ 提出/ 一种/ 改进/ 的/ 基于/ 屏幕/ 空间/ 的/ AO/ 算法/ ,/ 通过/ 如下/ 3/ 个/ 方面/ 对/ 原有/ 算法/ 进行/ 改进/ :/ (/ 1/ )/ 采样/ 区域/ 的/ 计算/ 和/ 采样/ 点/ 选取/ :/ 采样/ 区域/ 可能/ 影响/ 算法/ 的/ 效率/ 和/ 效果/ ,/ 例如/ ,/ 在/ 改进/ 的/ SSAO/ 算法/ 中/ ,/ 屏幕/ 空间/ 的/ 采样/ 区域/ 选取/ 不当/ ,/ 会/ 导致/ 即使/ 采样/ 点较/ 多/ ,/ 却/ 仍/ 得不到/ 准确/ 效果/ 的/ 情况/ ./ 为此/ ,/ ISSAO/ 使用/ 视点/ 空间/ 下/ 圆盘/ 在/ 屏幕/ 空间/ 下/ 的/ 投影/ Page3/ 区域/ 作为/ 采样/ 范围/ ,/ 增加/ 采样/ 像素/ 的/ 有效性/ ./ 在/ 采样/ 点/ 的/ 选取/ 方面/ ,/ 如果/ 采用/ 完全/ 随机/ 的/ 采样/ 方式/ ,/ 场景/ 明暗/ 不够/ 明显/ ,/ 产生/ 一些/ 细节/ 处/ 的/ 遮挡/ 信息/ 丢失/ ./ ISSAO/ 使用/ 类似/ 正态分布/ 的/ 概率/ 方法/ ,/ 结合/ 随机/ 纹理/ ,/ 得到/ 场景/ 明暗/ 明显/ 、/ 细节/ 处有/ 良好/ 保持/ 的/ 效果/ ;/ (/ 2/ )/ 遮挡/ 因子/ 计算公式/ :/ 在/ 实验/ 中/ 发现/ ,/ SSAO/ 计算公式/ 会/ 计算/ 并/ 得到/ 场景/ 中距离/ 较/ 远/ 物体/ 之间/ 的/ 遮挡/ 因子/ ,/ 甚至/ 采样/ 点/ 被/ 重复/ 计算/ ,/ 不可避免/ 地/ 出现/ 自/ 遮挡/ 、/ 不/ 连续/ 等/ 现象/ ./ ISSAO/ 改进/ 遮挡/ 因子/ 计算公式/ ,/ 采用/ 新型/ 的/ 衰减/ 表示/ 函数/ ,/ 有效/ 地/ 消除/ 多余/ 边缘/ 的/ 计算/ ,/ 减少/ 自/ 遮挡/ 和/ 不/ 连续/ 现象/ 的/ 发生/ ;/ (/ 3/ )/ 作为/ 后置/ 处理/ 的/ 去/ 噪/ 滤波/ :/ 由于/ SSAO/ 算法/ 是/ 在/ 屏幕/ 空间/ 中/ 采样/ ,/ 采样/ 点/ 不足/ 会/ 导致/ 普遍存在/ 的/ 噪点/ ./ 与/ 以往/ SSAO/ 的/ 滤波/ 不同/ ,/ ISSAO/ 使用/ 可以/ 有效/ 保持/ 边缘/ 的/ 改进型/ 双边/ 滤波/ ,/ 结合/ 深度/ 信息/ ,/ 得到/ 较/ 好/ 的/ 去/ 噪/ 效果/ ./ 4/ 算法/ 实现/ 4.1/ 改进/ 的/ 采样/ 方式/ 为/ 更/ 准确/ 地/ 得到/ 屏幕/ 空间/ 的/ 采样/ 区域/ ,/ ISSAO/ 针对/ 屏幕/ 空间/ 中/ 的/ 像素/ p/ ,/ 以其/ 在/ 视点/ 坐标系/ 中/ 的/ 对应点/ P/ 为/ 圆心/ ,/ 作/ 一个/ 平行/ 于/ 屏幕/ 空间/ 、/ 半径/ 为/ R/ 的/ 圆盘/ ,/ 将/ 其/ 投影/ 到/ 屏幕/ 空间/ ,/ 并/ 以/ 其/ 投影/ 所/ 覆盖/ 的/ 像素/ 区域/ 作为/ p/ 的/ 采样/ 区域/ ./ 由于/ 投影/ 方式/ 是/ 透视/ 投影/ ,/ 因此/ 三维空间/ 中/ 的/ 一个/ 圆盘/ 在/ 屏幕/ 空间/ 上/ 的/ 投影/ 为/ 一个/ 椭圆/ ,/ 椭圆/ 相对/ 于/ 原始/ 圆盘/ 的/ 形变/ 程度/ 根据/ 投影/ 角度/ 的/ 不同/ 而/ 不同/ ./ 投影/ 角度/ 越大/ ,/ 形变/ 越大/ ./ 由于/ 在/ 椭圆/ 区域/ 内/ 进行/ 随机/ 采样/ 的/ 计算/ 量/ 较大/ ,/ 在/ 具体/ 实现/ 过程/ 中/ ,/ 本文/ 在/ 屏幕/ 空间/ 上/ 构造/ 一个/ 能/ 刚好/ 覆盖/ 椭圆/ 投影/ 区域/ 的/ 半径/ 为/ r/ 的/ 圆/ 作为/ 真正/ 的/ 采样/ 区域/ ./ 通过/ 在/ 三维空间/ 中/ 构造/ 的/ 圆盘/ 来/ 确定/ 采样/ 区域/ ,/ 使得/ 距离/ 视点/ 更近/ 的/ 像素/ 获得/ 更大/ 的/ 采样/ 区域/ ,/ 而/ 减小/ 距离/ 视点/ 较远/ 的/ 像素/ 采样/ 区域/ ,/ 使得/ 最终/ 生成/ 的/ 图像/ 质量/ 更/ 高/ 并/ 保证/ 渲染/ 效率/ ./ 在/ 得到/ 采样/ 区域/ 后/ ,/ 需要/ 在/ 采样/ 区域/ 中/ 产生/ 一些/ 随机/ 采样/ 点来/ 计算/ AO/ 因子/ ./ 以往/ 的/ 一些/ AO/ 算法/ 在/ 采样/ 区域/ 内/ 产生/ 的/ 采样/ 点/ 比较/ 均匀/ ,/ 导致/ 较/ 多/ 的/ 噪点/ 产生/ ,/ 引起/ 场景/ 的/ 明暗/ 程度/ 不/ 明显/ 、/ 细节/ 大量/ 丢失/ 等/ 问题/ ./ 本文/ 算法/ 的/ 采样/ 点/ 生成/ 方式/ 是/ 基于/ 如下/ 事实/ ,/ 三维空间/ 中距离/ P/ 点较/ 近/ 的/ 点/ 对/ 其/ 遮挡/ 贡献/ 值/ 较大/ ,/ 而/ 较/ 远点/ 对/ 其/ 遮挡/ 贡献/ 值较/ 小/ ./ 这个/ 事实/ 体现/ 在/ 屏幕/ 空间/ 的/ 采样/ ,/ 即/ 在/ 距离/ p/ 较近/ 的/ 区域/ ,/ 应该/ 生成/ 更/ 多/ 的/ 采样/ 点/ ;/ 而/ 在/ 远离/ p/ 的/ 区域/ ,/ 只/ 需/ 生成/ 较/ 少数/ 目的/ 采样/ 点/ ./ ISSAO/ 使用/ 类似/ 正态分布/ 的/ 方法/ ,/ 结合/ 随机/ 纹理/ 进行/ 采样/ ,/ 计算/ 采样/ 偏移/ C/ (/ e1/ ,/ e2/ )/ ,/ 见式/ (/ 1/ )/ ./ C/ (/ e1/ ,/ e2/ )/ =/ rmax/ ×/ (/ e1/ ×/ sin/ (/ 2/ π/ e2/ )/ ,/ e2/ ×/ cos/ (/ 2/ π/ e1/ )/ )/ 其中/ ,/ rmax/ 为/ 屏幕/ 空间/ 采样/ 区域/ 半径/ ;/ e1/ 和/ e2/ 是/ 有/ 固定/ 关系/ 且/ 均/ 小于/ 1/ 的/ 随机/ 数值/ ,/ 通过/ 读取/ 随机/ 纹理/ 得到/ ./ 在/ 图/ 1/ 中/ ,/ 采样/ 点/ 的/ 选取/ 呈现出/ 采样/ 区域/ 中/ ,/ 距离/ 圆心/ p/ 越近/ ,/ 选取/ 的/ 采样/ 点越/ 密集/ ;/ 距离/ 越/ 远/ ,/ 选取/ 的/ 采样/ 点越/ 稀疏/ 的/ 分布/ 情况/ ,/ 很/ 好/ 地/ 模拟/ 了/ 三维空间/ 中/ 遮挡/ 贡献/ 值/ 的/ 强弱/ 分布/ ./ 这样/ 的/ 采样/ 点/ 选取/ 方法/ ,/ 有效/ 利用/ p/ 点较/ 近/ 区域/ 的/ 顶点/ ,/ 增大/ 这些/ 点/ 对/ p/ 点/ AO/ 因子/ 的/ 贡献/ ,/ 增强/ 场景/ 明暗/ 效果/ ,/ 实现/ 对/ 场景/ 细节/ 的/ 良好/ 保持/ ./ 考虑/ 到/ 视点/ 空间/ 的/ P/ 点/ 距离/ 视点/ 越/ 远/ ,/ 在/ 屏幕/ 空间/ 投影/ 的/ 采样/ 范围/ 越小/ ,/ 在/ 视图/ 中/ 的/ 显示/ 区域/ 越小/ ,/ 会/ 减少/ 对/ 最终/ 渲染/ 的/ 场景/ 整体/ 效果/ 影响/ ;/ 每个/ 采样/ 区域/ 采样/ 点数/ 固定/ ,/ 区域/ 过小有/ 可能/ 增加/ 重复/ 的/ 采样/ ./ 所以/ ,/ 采用/ 根据/ 深度/ 值/ 调整/ 采样/ 数/ 的/ LOD/ (/ LevelOfDetail/ )/ 层次/ 度/ 模型/ [/ 15/ ]/ 类似/ 方法/ ,/ 对/ 距离/ 视点/ 较远/ 的/ 顶点/ 减少/ 采样/ 次数/ ,/ 同时/ 减少/ 计算/ 次数/ ,/ 提高/ 渲染/ 效率/ ,/ 增强/ 场景/ 真实度/ ./ 4.2/ 改进/ 的/ AO/ 因子/ 计算/ 与/ 基于/ 顶点/ 的/ AO/ 算法/ 从/ 每个/ 顶点/ 发出/ 大量/ 光线/ ,/ 通过/ 求交/ 计算/ 来/ 获得/ 遮挡/ 率/ 不同/ ,/ 基于/ 屏幕/ 空间/ 的/ AO/ 算法/ 只/ 通过/ 很少/ 的/ 采样/ 点来/ 估算/ 遮挡/ ,/ 因此/ 其/ 计算公式/ 应该/ 更/ 精确/ ,/ 否则/ 会/ 导致/ 较大/ 的/ 误差/ ./ ISSAO/ 在/ SSAO/ 计算公式/ 的/ 基础/ 上/ ,/ 增加/ 衰减/ 表示/ 函数/ ,/ 抑制/ 视点/ 空间/ 中距离/ P/ 点较/ 远/ 的/ 点/ 对/ P/ 点/ AO/ 因子/ 计算/ 的/ 影响/ ,/ 增强/ 近点/ 对/ P/ 点/ 的/ 影响/ 权重/ 因子/ ./ Page4/ 环境/ 光照强度/ Ia/ 的/ 计算公式/ [/ 16/ ]/ 为/ 其中/ ,/ I0/ 是/ 入射/ 的/ 环境/ 光照强度/ ;/ A0/ 是/ 遮挡/ 因子/ ,/ 其/ 计算公式/ 可以/ 表示/ 为/ 其中/ 积分/ 区域/ Ω/ 是/ 三维空间/ 中/ P/ 点/ 的/ 空间/ 邻域/ ,/ 为/ 简化/ 计算/ ,/ 取以/ P/ 点为/ 中心/ 、/ 半径/ 为/ R/ 的/ 球形/ 空间/ Θ/ 作为/ 积分/ 区域/ 进行/ 处理/ ;/ 狊/ 为/ 三维空间/ 中/ 的/ 采样/ 点到/ P/ 点/ 的/ 归一化/ 向量/ ;/ 狀为/ P/ 点/ 的/ 单位/ 法/ 向量/ ;/ D/ (/ 狊/ )/ 是/ AO/ 贡献/ 权重/ 因子/ 的/ 计算/ 函数/ ./ 在/ 计算/ AO/ 因子/ 的/ 算法/ 中/ ,/ 假设/ P/ 点/ 空间/ 邻域/ 的/ 所有/ 采样/ 点/ 都/ 对/ P/ 点/ 的/ 环境/ 遮挡/ 值有/ 贡献/ ./ 在/ Θ/ 中/ ,/ 把/ 视点/ 空间/ 中/ 的/ 圆盘/ 投影/ 到/ 屏幕/ 空间/ ,/ 对/ p/ 点/ 纹理/ 邻域/ 上/ 的/ 采样/ 点/ ,/ 都/ 认为/ 可以/ 用来/ 计算/ AO/ 因子/ ,/ 简化/ 计算公式/ ./ 但/ 这样/ 的/ 计算方法/ ,/ 可能/ 会/ 增加/ 一些/ 原本/ 不该/ 影响/ AO/ 因子/ 计算/ 的/ 采样/ 点/ ./ 在/ 图/ 2/ 中/ ,/ 三维空间/ 中点/ T/ 和/ W/ 在/ 纹理/ 上/ 的/ 映射/ 点离/ p/ 点/ 的/ 距离/ 是/ 一样/ 大小/ ,/ 但是/ 在/ 视点/ 空间/ 中离/ P/ 点/ 距离/ distanceT/ >/ distanceW/ ./ W/ 点/ 对/ AO/ 因子/ 的/ 贡献/ 值/ 较大/ ,/ 而/ T/ 点/ 对/ AO/ 因子/ 的/ 贡献/ 值/ 很小/ ./ 如果/ 不/ 加/ 区别/ 的/ 计算/ W/ 和/ T/ 的/ 结果/ 作为/ 对/ P/ 的/ 遮挡/ 贡献/ ,/ 可能/ 会/ 导致/ 较大/ 的/ 误差/ ./ ISSAO/ 通过/ 引入/ 一个/ 衰减/ 表示/ 函数/ Q/ (/ p/ →/ 狊/ )/ 来/ 解决/ 这个/ 问题/ ,/ AO/ 因子/ 的/ 计算公式/ 更新/ 为式/ (/ 4/ )/ ./ 在/ Θ/ 区域/ ,/ 采样/ 点离/ P/ 的/ 距离/ distance/ </ R/ ,/ 狏/ 是/ P/ 到/ 遮挡/ 点/ 的/ 向量/ ,/ 狀为/ P/ 的/ 单位/ 法/ 向量/ ,/ Q/ (/ p/ →/ 狊/ )/ 是/ 本文/ 提出/ 的/ 衰减/ 表示/ 函数/ ,/ 如式/ (/ 5/ )/ 所示/ :/ 其中/ φ/ (/ 狏/ )/ 是/ 用户/ 可控/ 的/ 场景/ 明暗/ 参数/ 因子/ ,/ 控制/ 场景/ 明暗/ 颜色/ 分离/ ,/ 使/ 深黑色/ 保持/ ,/ 稍/ 浅/ 颜色/ 变淡/ ;/ μ/ 是/ 用于/ 向量/ 大小/ 计算/ 范围/ 限定/ 的/ 常数/ 因子/ ./ 在/ 计算/ AO/ 因子/ 的/ SSAO/ 算法/ 中/ ,/ 通过/ 对/ 狏/ 进行/ 归一化/ 操作/ ,/ 提高/ 采样/ 点/ 信息/ 的/ 利用率/ ,/ 却/ 使得/ 纹理/ 上/ 临近/ p/ 的/ 点/ ,/ 在/ 视点/ 空间/ 下因/ 距离/ P/ 较远/ ,/ 得到/ 的/ AO/ 因子/ 计算/ 值比/ 真实/ 值/ 偏大/ ./ 另外/ ,/ 由于/ 三维空间/ 下/ 的/ 采样/ 并不需要/ 预先/ 知道/ 场景/ 信息/ ,/ P/ 点/ 可能/ 与/ 同一/ 采样/ 点/ 多次/ 进行/ 遮挡/ 因子/ 计算/ ,/ 产生/ 自/ 遮挡/ 、/ 不/ 连续/ 等/ 误差/ ./ 结合/ 式/ (/ 4/ )/ 和/ (/ 5/ )/ ,/ 并/ 将/ 积分/ 离散/ 化/ ,/ 最后/ 可以/ 得到/ ISSAO/ 的/ AO/ 因子/ 计算/ 式/ (/ 6/ )/ ./ 其中/ ,/ λ/ 是/ 用来/ 增强/ 遮挡/ 处/ 阴影/ 效果/ 的/ 权重/ 因子/ ;/ ψ/ (/ z/ )/ 根据/ 三维空间/ P/ 的/ 深度/ z/ 值/ ,/ 消除/ 自/ 遮挡/ 阴影/ 和/ 不/ 连续/ 的/ 参数/ 因子/ ;/ 采用/ 未/ 归一化/ 的/ 狏/ 计算/ 点积/ ,/ 用以/ 抑制/ 采样/ 点/ 与/ P/ 点/ 距离/ 过大时/ 对/ 遮挡/ 值/ 计算/ 的/ 影响/ ;/ 引入/ σ/ ,/ 用以/ 控制/ 当/ 狏/ 为/ 0/ 时/ ,/ 分母/ 导致/ 的/ 不可/ 预测/ 结果/ ,/ 且/ 根据/ 场景/ 的/ 大小/ 可以/ 调整/ 渲染/ 效果/ ;/ s/ 为/ 基于/ 屏幕/ 空间/ p/ 点/ 采样/ 范围/ 中/ 的/ 采样/ 数目/ ./ 在/ 计算/ 采样/ 点/ 的/ 遮挡/ 贡献/ 值时/ ,/ 设置/ 相关/ 的/ 与/ 场景/ 复杂度/ 无关/ 的/ 可/ 控制/ 因子/ 经验值/ ,/ 能够/ 使/ 整个/ 场景/ 的/ 显示/ 效果/ 得到/ 明显/ 优化/ ./ 4.3/ 双边/ 滤波/ 去/ 噪/ 高斯/ 滤波/ 作为/ 一种/ 简单/ 高效/ 的/ 滤波/ 算法/ ,/ 被/ 很多/ AO/ 算法/ 使用/ ./ 但是/ ,/ 由于/ 其/ 对/ 屏幕/ 空间/ 所有/ 信息/ 过滤/ ,/ 直接/ 忽略/ 边缘/ 信息/ 的/ 保持/ ./ 所以/ ,/ ISSAO/ 使用/ 一个/ 可/ 保持/ 边缘/ 的/ 改进型/ 双边/ 滤波/ 作为/ 算法/ 的/ 后置/ 处理/ ./ 双边/ 滤波/ (/ BilateralFilter/ ,/ BF/ )/ 能够/ 减少/ 图像/ 的/ 噪点/ ,/ 是/ 平滑/ 图像/ 并且/ 保存/ 边缘/ 细节/ 信息/ 的/ 非线性/ 滤波/ 技术/ [/ 17/ ]/ ./ ISSAO/ 采用/ 三维空间/ 中/ 顶点/ 的/ 深度/ 信息/ 来/ 计算/ 得到/ 双边/ 滤波/ 中/ 的/ 相似性/ 因子/ ,/ 作为/ 边缘/ 保持/ 的/ 权重/ ,/ 结合/ AO/ 值/ 的/ 高斯/ 权重/ ,/ 作为/ 去/ 噪/ 因子/ ./ AO/ 的/ 处理/ 方式/ 区别/ 于/ 像素/ 差值/ 形式/ 的/ 处理/ 方式/ ,/ 能够/ 更/ 有效/ 地/ 得到/ 真实/ 的/ 位置/ 信息/ ,/ 再/ 通过/ 对/ 边缘/ 检测/ 分割/ ,/ 减少/ 不必要/ 的/ 点/ 的/ 计算/ ,/ 提高/ 计算/ 效率/ ,/ 并且/ 得到/ 一个/ 既/ 保存/ 边缘/ 信息/ 又/ 减少/ 图像/ 噪点/ 的/ 滤波/ 效果/ ./ B/ (/ x/ )/ =/ 1/ 在/ 式/ (/ 7/ )/ 中/ ,/ f/ (/ ξ/ )/ 是/ 在/ x/ 周围/ 偏移/ ξ/ 所/ 取得/ 的/ 顶点/ 遮挡/ 信息/ ,/ dp/ (/ ξ/ )/ 是/ 在/ x/ 周围/ 偏移/ ξ/ 所/ 取得/ 的/ 采样/ 点/ 的/ 深度/ 信息/ ;/ k/ (/ x/ )/ 是/ 单位/ 化/ 因子/ ,/ 由/ g/ (/ ξ/ ,/ x/ )/ 和/ s/ (/ dp/ (/ ξ/ )/ ,/ dp/ (/ x/ )/ )/ 综合/ 得到/ ;/ g/ (/ ξ/ ,/ x/ )/ 是/ 基于/ 像素/ 空间/ Page5/ σ/ (/ dp/ (/ ξ/ )/ ,/ dp/ (/ x/ )/ )/ 2/ σ/ (/ )/ r/ 距离/ 的/ 高斯/ 权重/ ,/ g/ (/ ξ/ ,/ x/ )/ =/ e/ -/ 1/ 是/ 用来/ 计算/ 点/ 与/ 点/ 之间/ 的/ 距离/ 系数/ ,/ ξ/ -/ x/ 用来/ 表示/ 两个/ 顶点/ 的/ 水平/ 距离/ ;/ s/ (/ dp/ (/ ξ/ )/ ,/ dp/ (/ x/ )/ )/ 是/ 基于/ 深度/ 信息/ 的/ 相似/ 度/ 权重/ ,/ s/ (/ dp/ (/ ξ/ )/ ,/ dp/ (/ x/ )/ )/ =/ e/ -/ 1/ 系数/ ,/ σ/ (/ dp/ (/ ξ/ )/ ,/ dp/ (/ x/ )/ )/ 是/ 计算/ f/ (/ ξ/ )/ 和/ f/ (/ x/ )/ 两点/ 的/ 深度/ 差/ ./ B/ (/ x/ )/ 因子/ 的/ 滤波/ 处理/ ,/ 很/ 好地解决/ 场景/ 因/ SSAO/ 采样/ 点较/ 少/ 所/ 带来/ 的/ 噪点/ 影响/ ./ 5/ 实验/ 结果/ 本文/ 的/ 硬件/ 测试/ 平台/ 采用/ Intel/ (/ R/ )/ Core/ (/ TM/ )/ i3/ -/ 2100CPU/ @/ 3.10/ GHz/ 处理器/ 和/ NVIDIAGeForceGTS450/ 图形/ 显卡/ ./ 通过/ 对/ Dragon/ 、/ Bunny/ 、/ Hebe/ 模型/ 进行/ 渲染/ ,/ 分别/ 与/ 改进/ 的/ HBAO/ 、/ SSAO/ 、/ AlchemyAO/ 进行/ 效果/ 对比/ ,/ 以及/ 光线/ 跟踪/ 渲染/ 的/ 环境/ 遮挡/ 作为/ 参照/ 对比/ (/ 详见/ 图/ 6/ )/ ;/ 主要/ 以/ Dragon/ 模型/ 进行/ 效率/ 测试/ ,/ 可以/ 看到/ ISSAO/ 算法/ 与/ 现有/ 遮挡/ 算法/ 运行/ 效率/ 的/ 对比/ 结果/ ./ 图/ 3/ 展示/ 了/ ISSAO/ 算法/ 和/ HBAO/ 算法/ 同样/ 选取/ 12/ 个/ 采样/ 点/ 的/ 结果/ 对比/ ,/ 可以/ 看出/ ,/ ISSAO/ 算法/ 可以/ 反映/ 出/ 更/ 多/ 的/ 细节/ ,/ 能够/ 产生/ 更/ 多/ 细节/ 的/ 主要/ 原因/ 在于/ 其/ 采用/ 了/ 更好/ 的/ 采样/ 方式/ ,/ 此处/ ISSAO/ 参数/ 选择/ R/ =/ 1.75/ ,/ φ/ (/ 狏/ )/ =/ 0.40/ ,/ ψ/ (/ z/ )/ =/ 0.022/ ,/ λ/ =/ 1.06/ ,/ σ/ =/ 0.00016/ ./ 从/ 采样/ 区域/ 来说/ ,/ HBAO/ 算法/ 在/ 确定/ 采样/ 区域/ 时/ 没有/ 过多/ 考虑/ 像素/ p/ 在/ 三维空间/ 中/ 对应点/ 到/ 视点/ 距离/ ,/ 而/ ISSAO/ 是/ 通过/ 在/ 三维空间/ 中/ 构造/ 固定/ 大小/ 的/ 圆盘/ ,/ 通过/ 圆盘/ 在/ 屏幕/ 空间/ 的/ 投影/ 来/ 确定/ 采样/ 半径/ ./ 从/ 采样/ 方式/ 来说/ ,/ HBAO/ 算法/ 沿着/ 某些/ 随机/ 方向/ 进行/ 采样/ ,/ 其/ 最后/ 生成/ 的/ 采样/ 点/ 仍然/ 比较/ 规整/ ;/ 而/ ISSAO/ 算法/ 的/ 采样/ ,/ 通过/ 采用/ 类似/ 正态分布/ 规律/ 的/ 采样/ 方法/ ,/ 距离/ p/ 越近/ 的/ 区域/ ,/ 采样/ 点越/ 密集/ ,/ 而/ 距离/ p/ 越远/ 采样/ 点越/ 稀疏/ ,/ 确保/ 采样/ 点/ 的/ 有效性/ ./ 图/ 4/ 展示/ 了/ 在/ 同样/ 采用/ 12/ 个/ 随机/ 采样/ 点/ 的/ 情况/ 下/ ,/ 分别/ 应用/ 式/ (/ 3/ )/ 和/ (/ 4/ )/ 得到/ 的/ 渲染/ 效果/ ,/ 此处/ ISSAO/ 参数/ 为/ R/ =/ 1.05/ ,/ φ/ (/ 狏/ )/ =/ 0.43/ ,/ ψ/ (/ z/ )/ =/ 0.014/ ,/ λ/ =/ 1.00/ ,/ σ/ =/ 0.00019/ ./ 从图/ 4/ 中/ 可以/ 看出/ ,/ 采用/ 引入/ 衰减/ 表示/ 函数/ 修正/ AO/ 因子/ 的/ 计算公式/ 后/ ,/ 得到/ 成功/ 消除/ 模型/ 自/ 遮挡/ 效果/ ,/ 减少/ 局部/ 区域/ 周围/ 不/ 连续/ 情况/ ,/ 减少/ 渲染/ 产生/ 的/ 噪点/ ./ ISSAO/ 算法/ 通过/ 计算/ 三维空间/ 点/ 的/ 高斯/ 模糊/ 因子/ 与/ 基于/ 深度/ 对比/ 的/ 相似性/ 因子/ ,/ 综合/ 两/ 因子/ 得到/ 双边/ 滤波/ 的/ 计算/ 因子/ ,/ 保持/ 各/ 边缘/ 间/ 的/ 信息/ ,/ 对/ 各个/ 区域/ 产生/ 的/ 噪点/ 进行/ 模糊/ 处理/ ,/ 与/ AlchemyAO/ 的/ 滤波/ 方式/ 相比/ ,/ 去除/ 噪点/ 效果/ 更/ 明显/ ,/ 边缘/ 信息/ 保持/ 完整/ ./ 此处/ ISSAO/ 参数/ 为/ R/ =/ 2.20/ ,/ φ/ (/ 狏/ )/ =/ 0.55/ ,/ ψ/ (/ z/ )/ =/ 0.018/ ,/ λ/ =/ 1.00/ ,/ σ/ =/ 0.00015/ ,/ 如图/ 5/ 所示/ ./ 图/ 6/ 为/ ISSAO/ 与/ 光线/ 跟踪/ 、/ 对比/ 算法/ 的/ 渲染/ 效果/ 详细/ 对比/ ,/ 光线/ 跟踪/ 采用/ 不同/ 分辨率/ 以及/ 发射/ 光线/ 数/ 渲染/ ,/ 对比/ 算法/ 选择/ 模型/ 的/ 不同/ 的/ 结果/ ./ Page6/ 表/ 1/ 展示/ 了/ ISSAO/ 与/ 部分/ 基于/ 屏幕/ 空间/ 的/ AO/ 算法/ 的/ 运行/ 时间/ 对比/ 结果/ ./ 为了/ 公平/ 地/ 比较/ 算法/ 的/ 效率/ ,/ 在/ 不/ 采用/ 任何/ 滤波/ 和/ 都/ 采用/ 双边/ 滤波/ 的/ 情况/ 下/ ,/ 进行/ 算法/ 的/ 运行/ 效率/ 测试/ ./ 从表中/ 可以/ 看出/ ,/ ISSAO/ 能够/ 获得/ 与/ 其他/ 主流/ SSAO/ 算法/ 类似/ 的/ 渲染/ 效率/ ./ 在/ 具体/ 实现/ 过程/ 中/ ,/ 采用/ 如下/ 方式/ 来/ 保证/ 算法/ 的/ 渲染/ 效率/ ./ Dragon/ (/ withBF/ )/ 14.648/ ./ 378.338/ ./ 77Dragon/ (/ nofilter/ )/ 10.974/ ./ 544.675/ ./ 10/ (/ 1/ )/ 采用/ early/ -/ z/ -/ culling/ 技术/ ,/ 消除/ 采样/ 重复/ 的/ 点/ 以及/ 跳过/ 空间/ R/ 区域/ 以外/ 的/ 采样/ 点/ 计算/ ,/ 减少/ 不必要/ 的/ 计算/ 时间/ ;/ (/ 2/ )/ 通过/ 进行/ 屏幕/ 空间/ 的/ 圆盘/ 采样/ ,/ 直接/ 操作/ 纹理/ 处理/ 采样/ 点/ ,/ 减少/ 不必要/ 信息/ 的/ 计算/ ;/ (/ 3/ )/ 采用/ 改进/ 的/ 双边/ 滤波/ ,/ 通过/ 深度/ 信息/ 计算/ 保持/ 边缘/ ,/ 从/ AO/ 计算/ 的/ 中间/ 结果/ 直接/ 获取/ 深度/ 信息/ ,/ 提高/ 计算/ 效率/ ./ 6/ 结论/ 本文/ 主要/ 研究/ 屏幕/ 空间/ 环境/ 遮挡/ 算法/ ,/ 改进/ 采样/ 方式/ ,/ 采用/ 新型/ 的/ 遮挡/ 因子/ 计算公式/ 和/ 改进/ 的/ 双边/ 滤波/ 处理/ ./ 采样/ 半径/ 选取/ 上/ ,/ 根据/ 视点/ 坐标系/ 中/ 生成/ 的/ 圆盘/ 在/ 屏幕/ 空间/ 的/ 投影/ 来/ 确定/ 采样/ 范围/ ,/ 提高/ 采样/ 点/ 的/ 有效性/ ;/ 使用/ 类似/ 正态分布/ 的/ 方法/ 来/ 选取/ 采样/ 点/ 的/ 位置/ ,/ 控制/ 显示/ 明暗/ ;/ 采用/ 新型/ 衰减/ 表示/ 函数/ ,/ 加入/ 可控/ 参数/ 来/ 计算/ 当前/ 点/ 的/ 遮挡/ 因子/ ,/ 增强/ 细节/ 效果/ ;/ 针对/ SSAO/ 方法/ 采样/ 带来/ 的/ 噪点/ ,/ 使用/ 改进/ 的/ 双边/ 滤波/ 处理/ ,/ 得到/ 平滑/ 的/ 效果/ ;/ 在/ 运行/ 效率/ 方面/ ,/ 能够/ 达到/ 与/ HBAO/ 和/ AlchemyAO/ 同级/ 的/ 渲染/ 效率/ ./ 本文/ 所/ 提出/ 的/ 改进/ 算法/ ,/ 依然/ 存在/ 一些/ 未能/ 完全/ 改进/ 的/ 细节/ ./ 采样/ 方式/ 上/ ,/ 依然/ 不能/ 完全/ 还原/ 细小/ 区域/ 的/ 边缘/ 信息/ ;/ 采样/ 精度/ 上/ ,/ 为/ 保证/ 效率/ ,/ 没有/ 采用/ 更/ 高精度/ 采样/ 方法/ 提高/ 渲染/ 精度/ ;/ 引进/ 需要/ 用户/ 自己/ 调试/ 的/ 相关/ 控制/ 因子/ ,/ 调整/ 偏移/ 值/ 大小/ ,/ 较为/ 繁琐/ ,/ 只能/ 根据/ 实验/ 结果/ 得到/ 相应/ 的/ 经验值/ ;/ 在/ 滤波/ 方式/ 上/ ,/ 也/ 有/ 可以/ 提升/ 和/ 改进/ 的/ 地方/ ./ 

