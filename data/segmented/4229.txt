Page1/ 一种/ 基于/ 细粒度/ 性能/ 计数器/ 建立/ 系统/ 实时/ 功耗/ 模型/ 的/ 方法/ 程华/ 1/ )/ ,/ 2/ )/ ,/ 3/ )/ 陈左宁/ 4/ )/ 孙凝晖/ 1/ )/ ,/ 2/ )/ 王明/ 扬/ 3/ )/ 李超/ 3/ )/ 1/ )/ (/ 中国科学院计算技术研究所/ 北京/ 100190/ )/ 2/ )/ (/ 中国科学院/ 大学/ 北京/ 100039/ )/ 3/ )/ (/ 江南/ 计算技术/ 研究所/ 江苏/ 无锡/ 214083/ )/ 4/ )/ (/ 国家/ 并行/ 计算机/ 工程技术/ 研究/ 中心/ 北京/ 100190/ )/ 摘要/ 对/ 计算机系统/ 运行/ 时/ 功耗/ 值/ 的/ 实时/ 获取/ ,/ 是/ 进行/ 功耗/ 动态/ 管理/ 的/ 先决条件/ ./ 性能/ 计数器/ 能够/ 准确/ 地/ 反映/ 各/ 硬件/ 部件/ 的/ 使用/ 情况/ ,/ 进而/ 反映/ 其/ 功耗/ 情况/ ./ 文中/ 提出/ 了/ 一种/ 基于/ 细粒度/ 性能/ 计数器/ 建立/ 系统/ 实时/ 功耗/ 模型/ 的/ 方法/ (/ SysPower/ )/ ,/ 该/ 方法/ 由/ 功耗/ 模型/ 设定/ 、/ 性能/ 计数器/ 选取/ 、/ 数据/ 采样/ 、/ 模型/ 求解/ 、/ 结果/ 检验/ 五个/ 步骤/ 组成/ ,/ 基本思路/ 是/ :/ 选取/ 反映/ 处理器/ 、/ 内存/ 、/ I/ // O/ 等/ 主要/ 部件/ 运行/ 状态/ 的/ 细粒度/ 性能/ 计数器/ 作为/ 预选/ 特征值/ 集合/ (/ Fpreslct/ )/ ,/ 通过/ 实验/ 建立/ 该/ 集合/ 与/ 运行/ 时/ 系统/ 总/ 功耗/ 的/ 对应/ 关系/ ,/ 采用/ 多元/ 线性/ 回归/ 法/ 进行/ 模型/ 求解/ ,/ 得到/ 各/ 性能/ 计数器/ 对/ 功耗/ 的/ 影响/ 系数/ ,/ 从而/ 建立/ 系统/ 的/ 实时/ 功耗/ 模型/ ,/ 并/ 得到/ 对/ 该/ 系统/ 运行/ 时/ 功耗/ 产生/ 实际/ 影响/ 的/ 有效/ 性能/ 特征值/ 集合/ (/ Feffect/ )/ ./ 在/ 三个/ 不同/ 平台/ 上/ 的/ 实验/ 表明/ ,/ 该/ 方法/ 建立/ 的/ 功耗/ 模型/ 最大/ 误差/ 小于/ 4/ %/ ,/ 针对/ 每个/ 平台/ 使用/ 三组/ 不同/ 的/ 采样/ 数据/ 组合/ 进行/ 模型/ 求解/ ,/ 得到/ 的/ 有效/ 特征/ 集合/ 完全一致/ ,/ 证明/ 了/ 模型/ 的/ 稳定性/ ./ 最后/ ,/ 综合/ 三个/ 平台/ 的/ 实验/ 情况/ ,/ 给出/ 了/ 一个/ 包含/ 70/ 个/ 元素/ 的/ 性能/ 计数器/ 集合/ ,/ 作为/ 该/ 方法/ 的/ 缺省/ 特征值/ 集合/ (/ Fcommon/ _/ effect/ )/ ./ 关键词/ 实时/ 功耗/ 模型/ ;/ 性能/ 计数器/ ;/ 多元/ 线性/ 回归/ ;/ 绿色/ 计算/ 1/ 引言/ 近年来/ ,/ 能耗/ 已经/ 成为/ 制约/ 信息技术/ 发展/ 的/ 重要/ 因素/ [/ 1/ -/ 3/ ]/ ,/ 对/ 计算机系统/ 功耗/ 值/ 的/ 实时/ 获取/ ,/ 是/ 动态/ 功耗/ 管理/ 的/ 前提/ 和/ 关键问题/ [/ 4/ -/ 5/ ]/ ./ 采用/ 直接/ 在/ 系统/ 中/ 添加/ 功耗/ 测量/ 硬件/ 部件/ 的/ 方式/ ,/ 代价/ 较大/ ,/ 并且/ 大部分/ 的/ 系统/ 并/ 不/ 支持/ [/ 6/ -/ 7/ ]/ ./ 因此/ ,/ 通过/ 建立/ 系统/ 功耗/ 模型/ ,/ 用/ 软件/ 的/ 手段/ 对系统/ 功耗/ 进行/ 精确/ 估计/ ,/ 具有/ 十分/ 现实/ 的/ 意义/ ./ 以往/ 的/ 研究/ 中/ ,/ 运行/ 时/ 系统/ 的/ 功耗/ 估计/ 模型/ 主要/ 采用/ 基于/ 指令/ [/ 8/ -/ 11/ ]/ 、/ 基于/ 每/ 周期/ 执行/ 指令/ 数/ [/ 12/ ]/ 、/ 基于/ 主要/ 硬件/ 部件/ 利用率/ [/ 13/ -/ 14/ ]/ 、/ 基于/ 系统/ 主要/ 性能参数/ 等/ 方法/ [/ 15/ -/ 20/ ]/ ,/ 由于/ 选取/ 的/ 参数/ 范围/ 有限/ ,/ 导致/ 估计/ 精度/ 不/ 理想/ ./ 计算机系统/ 的/ 实时/ 功耗/ 可分解/ 为/ 各/ 硬件/ 功能/ 单元/ 的/ 功耗/ 之/ 和/ ,/ 而/ 每个/ 硬件/ 功能/ 单元/ 的/ 实时/ 功耗/ 由/ 其/ 固有/ 的/ 功耗/ 特征/ 和/ 实时/ 使用/ 情况/ 决定/ ./ 因此/ ,/ 在/ 功耗/ 特征/ 既定/ 的/ 情况/ 下/ ,/ 获取/ 到/ 硬件/ 单元/ 的/ 实时/ 使用/ 情况/ 即可/ 推算/ 其实/ 时/ 功耗/ ./ 硬件/ 性能/ 计数器/ 监测/ 到/ 的/ 活动/ 事件/ 的/ 发生/ 次数/ ,/ 能够/ 准确/ 直观/ 地/ 体现/ 系统/ 运行/ 时/ 的/ 硬件/ 部件/ 使用/ 情况/ ,/ 同时/ 也/ 是/ 获得/ 其/ 功耗/ 情况/ 的/ 最/ 直观/ 、/ 最/ 精确/ 的/ 途径/ ./ 但是/ 目前/ 的/ 研究/ 中/ ,/ 对于/ 如何/ 选取/ 作为/ 特征值/ 的/ 性能/ 计数器/ ,/ 如何/ 建立/ 特征值/ 与/ 系统/ 功耗/ 的/ 关系/ 模型/ ,/ 仍然/ 不/ 明确/ ./ 实时/ 功耗/ 模型/ 的/ 方法/ ,/ 主要/ 贡献/ 是/ :/ 本文/ 提出/ 一种/ 基于/ 细粒度/ 性能/ 计数器/ 建立/ 系统/ 统/ 实时/ 功耗/ 模型/ (/ 简称/ SysPower/ 模型/ )/ ;/ 集合/ ,/ 作为/ 预选/ 特征/ 集合/ (/ 简称/ Fpreslct/ )/ ;/ (/ 1/ )/ 提出/ 一种/ 基于/ 细粒度/ 硬件/ 性能/ 计数器/ 的/ 系/ (/ 2/ )/ 提出/ 一组/ 反映/ 系统/ 运行/ 状态/ 的/ 性能/ 计数器/ (/ 3/ )/ 给出/ 了/ 该/ 模型/ 的/ 求解/ 方法/ ,/ 以及/ 构建/ 有效/ 特征值/ 集合/ (/ 简称/ Feffect/ )/ 的/ 方法/ ;/ (/ 4/ )/ 在/ 三个/ 不同/ 系统/ 平台/ 上/ 开展/ 了/ 实验/ ,/ 在/ 基于/ 单路/ 4/ 核/ CPU/ 的/ 系统/ 、/ 基于/ 单路/ 单核/ CPU/ 的/ 系统/ 上/ ,/ 分别/ 选取/ 了/ 211/ 、/ 199/ 个/ 性能/ 计数器/ 作为/ Fpreslct/ ,/ 采用/ 本文/ 提出/ 的/ 方法/ 进行/ 模型/ 求解/ ,/ 结果显示/ ,/ 最大/ 误差/ 小于/ 4/ %/ ,/ 证明/ 了/ 该/ 模型/ 的/ 有效性/ ;/ (/ 5/ )/ 在/ 此基础/ 上/ ,/ 对/ 以上/ 三个/ 平台/ 的/ Feffect/ 集合/ 进行/ 了/ 分析/ ,/ 得到/ 了/ 在/ 三个/ 平台/ 上/ 都/ 对系统/ 总/ 功耗/ Psystem/ 产生/ 影响/ 的/ 共性/ 特征/ 集合/ (/ Fcommon/ _/ effect/ )/ ,/ 共/ 包含/ 70/ 个/ 元素/ ,/ 能够/ 反映/ 除/ 风扇/ 外/ 所有/ 主要/ 功能/ 部件/ 的/ 资源/ 占用/ 情况/ 和/ 活动/ 状况/ ./ 本文/ 第/ 2/ 节对/ 现有/ 的/ 运行/ 时/ 功耗/ 估计/ 技术/ 进行/ 了/ 介绍/ ;/ 第/ 3/ 节/ 描述/ 本文/ 提出/ 的/ SysPower/ 模型/ 的/ 构建/ 方法/ ,/ 包括/ 模型/ 设定/ 、/ 性能/ 计数器/ 选取/ 、/ 数据/ 采样/ 、/ 模型/ 求解/ 、/ 结果/ 检验/ ;/ 第/ 4/ 节/ 介绍/ 使用/ 该/ 方法/ 在/ 三个/ 系统/ 平台/ 上/ 的/ 实验/ ,/ 证明/ 了/ 该/ 方法/ 的/ 有效性/ ;/ 第/ 5/ 节对/ 本文/ 工作/ 进行/ 总结/ ./ 2/ 相关/ 工作/ 已有/ 的/ 运行/ 时/ 系统/ 功耗/ 估计/ 技术/ 可/ 分成/ 以下/ 4/ 类/ ./ (/ 1/ )/ 基于/ 指令/ ./ 通过/ 配置/ 指令/ 级/ 功耗/ 模拟器/ 的/ 参数/ ,/ 在/ 进行/ 性能/ 模拟/ 的/ 同时/ ,/ 根据/ 性能/ 的/ 输出/ 数据/ 获得/ 能耗/ 的/ 输出/ ./ 主要/ 的/ 研究/ 工作/ 有/ :/ Ye/ 等/ 人/ [/ 8/ ]/ 提出/ 并/ 实现/ 了/ 基于/ 指令/ 周期/ 的/ 功耗/ 估算/ 工具/ SimplePower/ ,/ 用于/ 在/ RTL/ 级/ 评估/ 算法/ 、/ 体系结构/ 和/ 编译/ 优化/ ;/ Shivakumar/ 等/ 人/ [/ 9/ ]/ 提出/ CACTI/ 用于/ 评估/ Cache/ 延时/ 、/ 功耗/ 等/ 信息/ ./ Brooks/ 等/ 人/ [/ 10/ ]/ 提出/ 了/ 体系结构/ 级/ 功耗/ 评估/ 工具/ Wattch/ ,/ 用于/ 辅助/ 体系结构/ 人员/ 在/ 设计/ 早期/ 进行/ 结构/ 探索/ ;/ Tiwari/ 等/ 人/ [/ 11/ ]/ 提出/ 指令/ 级/ 功耗/ 建模/ 方法/ ,/ 通过/ 分析程序/ 执行/ 过程/ 中/ 执行/ 的/ 指令/ ,/ 并/ 根据/ 单/ Page3/ 个/ 指令/ 的/ 功耗/ 值/ 、/ 不同/ 指令/ 间/ 切换/ 的/ 功耗/ 值/ ,/ 得到/ 程序/ 的/ 功耗/ 估算/ 值/ ,/ 可/ 用于/ 评估/ 一个/ 特定/ 软件/ 的/ 功耗/ ./ 这种/ 体系结构/ 级/ 、/ 周期/ 精确/ 的/ 指令/ 级/ 功耗/ 模拟器/ ,/ 适用/ 于/ 现代/ 超标/ 量/ 处理器/ 的/ 设计/ ,/ 但/ 在/ 实际/ 使用/ 中/ ,/ 由于/ 商用/ 处理器/ 和/ 模拟器/ 之间/ 、/ 以及/ 不同/ 处理器/ 之间/ 的/ 微结构/ 已经/ 有/ 较大/ 差异/ ,/ 难以/ 用/ 模拟器/ 来/ 准确/ 描述/ 实际/ 系统/ ,/ 同时/ 模拟/ 方法/ 速度/ 较慢/ ,/ 难以/ 用来/ 支持/ 计算机系统/ 运行/ 时/ 功耗/ 的/ 实时/ 度量/ ./ (/ 2/ )/ 基于/ 每/ 周期/ 执行/ 指令/ 数/ ./ 通过/ 建立/ 每/ 周期/ 执行/ 指令/ 数/ (/ InstructionPerClock/ ,/ IPC/ )/ 与/ 功耗/ 值/ 的/ 关系/ 模型/ 进行/ 功耗/ 估计/ ./ Li/ 等/ 人/ [/ 12/ ]/ 观察/ 到/ 系统/ 功耗/ 与/ IPC/ 密切相关/ ,/ 在/ 实验/ 中/ 还/ 发现/ 系统/ 调用/ 的/ 功耗/ 表现/ 出/ 了/ 与其/ 性能/ 很大/ 的/ 相关性/ ./ 这种/ 功耗/ 度量/ 方法/ 由于/ 仅/ 考虑/ CPU/ 的/ IPC/ ,/ 未/ 考虑/ 其它/ 部件/ 的/ 使用/ 情况/ ,/ 因此/ 估算/ 的/ 准确率/ 有限/ ./ (/ 3/ )/ 基于/ 主要/ 硬件/ 部件/ 利用率/ ./ 该/ 方法/ 在/ 已知/ 系统/ 各/ 主要/ 模块/ 的/ 最大/ 功耗/ 的/ 前提/ 下/ ,/ 通过/ 建立/ 各/ 主要/ 模块/ 利用率/ 与/ 系统/ 总/ 功耗/ 的/ 线性关系/ 来/ 建立/ 功耗/ 模型/ ,/ 如/ Economou/ 等/ 人/ [/ 13/ ]/ 提出/ 基于/ 系统/ 主要/ 硬件/ 部件/ 的/ 利用率/ 进行/ 功耗/ 估计/ ,/ 分别/ 测定/ 系统/ 各/ 主要/ 模块/ 在/ 满/ 负载/ 时/ 的/ 最大/ 功耗/ ,/ 通过/ 跟踪/ 系统/ 运行/ 时/ 各/ 模块/ 的/ 利用率/ ,/ 建立/ 系统/ 功耗/ 与/ 各/ 主要/ 硬件/ 部件/ 利用率/ 的/ 线性/ 模型/ ./ 这种/ 模型/ 建立/ 在/ 如下/ 假设/ 的/ 基础/ 上/ :/ 各/ 模块/ 的/ 功耗/ 等于/ 该/ 模块/ 的/ 最大/ 功耗/ ×/ 利用率/ ,/ 即/ 实际/ 功耗/ 与/ 最大/ 功耗/ 之间/ 是/ 线性关系/ ./ 本文/ 通过/ 实际/ 测试/ 发现/ ,/ 这种/ 线性关系/ 对于/ CPU/ 是/ 不/ 完全/ 成立/ 的/ ,/ 对于/ 同一/ 软硬件/ 系统/ 的/ 不同/ 的/ 应用/ ,/ 在/ CPU/ 利用率/ 都/ 为/ 100/ %/ 的/ 情况/ 下/ ,/ CPU/ 的/ 功耗/ 值/ 可以/ 相差/ 30/ %/ 以上/ ./ (/ 4/ )/ 基于/ 系统/ 主要/ 性能/ 计数器/ ./ 通过/ 建立/ 系统/ 主要/ 性能参数/ 与/ 功耗/ 值/ 的/ 关系/ 模型/ 进行/ 功耗/ 估计/ ./ Chen/ 等/ 人/ [/ 15/ ]/ 提出/ 一种/ 在线/ 的/ 、/ 支持/ 多核/ 多线程/ 环境/ 的/ 处理器/ 性能/ 和/ 功耗/ 估算/ 方法/ ,/ 该/ 性能/ 模型/ 采用/ 复用/ 距离/ 直方图/ 、/ 高速缓存/ 访问/ 频率/ 、/ 每个/ 进程/ 的/ 吞吐量/ 和/ 缓存/ 命中率/ 之间/ 的/ 关系/ 来/ 预测/ 系统/ 的/ 吞吐量/ ,/ 系统/ 级/ 功耗/ 模型/ 使用/ 多/ 变量/ 线性/ 回归/ 推导/ ./ Singh/ 等/ 人/ [/ 17/ ]/ 提出/ 一种/ 基于/ 性能/ 计数器/ 的/ 多/ 程序/ 多/ 核心/ 环境/ 功率/ 估计/ 模型/ ,/ 这种/ 功率/ 模型/ 的/ 建立/ 过程/ 是/ 临时性/ 的/ ,/ 需要/ 用户/ 手动/ 调整/ 模型/ 参数/ ,/ 此外/ ,/ 他们/ 的/ 功耗/ 模型/ 无法/ 处理/ 统一/ 核心/ 上/ 进程/ 之间/ 的/ 时间/ 共享/ [/ 15/ ]/ ./ Contreras/ 等/ 人/ [/ 18/ -/ 19/ ]/ 的/ 模型/ 中/ 使用/ 了/ 一套/ 功耗/ 权重/ 值/ ,/ 用以/ 将/ 6/ 个/ 硬件/ 性能/ 计数器/ 的/ 值/ 映射/ 到/ 处理器/ 和/ 内存/ 的/ 功耗/ ,/ 功耗/ 权重/ 值/ 是/ 利用/ 参数估计/ 技术/ 得到/ 的/ ./ Bircher/ 等/ 人/ [/ 20/ ]/ 提出/ 使用/ 回归/ 曲线拟合/ ,/ 利用/ 9/ 个/ 性能/ 计数器/ ,/ 得到/ CPU/ 、/ 内存/ 、/ 芯片组/ 、/ I/ // O/ 、/ 磁盘/ 五个/ 子系统/ 的/ 功耗/ 模型/ ,/ 平均误差/ 小于/ 9/ %/ ./ 以上/ 模型/ 由于/ 只是/ 用/ 了/ 少量/ 的/ 性能/ 计数器/ ,/ 在/ 反映/ 计算机系统/ 整体/ 功耗/ 方面/ 有所/ 欠缺/ ./ 事实上/ ,/ 除了/ 缓存/ 失效率/ 、/ 内存/ 缺页/ 故障/ ,/ 逻辑/ IO/ 请求/ 的/ 个数/ 、/ 设备/ IO/ 操作/ 数量/ 等/ 因素/ 外/ ,/ 还/ 存在/ 其它/ 多种/ 因素/ 对/ 运行/ 时/ 系统/ 的/ 功耗/ 产生/ 影响/ ,/ 对于/ 这些/ 因素/ 的/ 忽略/ 将会/ 不可避免/ 地/ 影响/ 功耗/ 模型/ 的/ 准确度/ ./ 3/ 基于/ 细粒度/ 性能/ 计数器/ 的/ 系统/ 实时/ 功耗/ 模型/ 3.1/ 模型/ 的/ 提出/ 计算机系统/ 的/ 实时/ 功耗/ 是/ 由/ CPU/ 、/ 内存/ 、/ 磁盘/ 、/ 网络/ 等/ 所有/ 硬件/ 功能/ 部件/ 的/ 实时/ 功耗/ 组成/ ,/ 而/ 每个/ 硬件/ 功能/ 部件/ 的/ 实时/ 功耗/ 为/ 其/ 所有/ 功能/ 单元/ 的/ 功耗/ 之/ 和/ ./ 设/ 一个/ 计算机系统/ (/ System/ )/ 由/ n/ 个/ 功能/ 部件/ (/ Component/ )/ 组成/ ,/ 第/ i/ 个/ 功能/ 部件/ Componenti/ 由/ li/ 个/ 功能/ 单元/ (/ Unit/ )/ 组成/ ,/ 系统/ 的/ 总/ 功耗/ 为/ Psystem/ ,/ 第/ i/ 个/ 功能/ 部件/ 的/ 功耗/ 为/ Pcomponenti/ ,/ 第/ i/ 个/ 功能/ 部件/ 的/ 第/ j/ 个/ 功能/ 单元/ 的/ 功耗/ 为/ Punitij/ 成/ 可以/ 表示/ 为/ 由此/ ,/ 求解/ 系统/ 总/ 功耗/ 的/ 问题/ 可以/ 归结为/ 对/ 功能/ 单元/ 的/ 功耗/ 的/ 求解/ ./ 功能/ 单元/ 运行/ 时/ 的/ 功耗/ 取决于/ 2/ 个/ 因素/ :/ (/ 1/ )/ 硬件/ 固有/ 的/ 功耗/ 特征/ ;/ (/ 2/ )/ 运行/ 时/ 使用/ 情况/ ./ 因此/ ,/ 在/ 功耗/ 特征/ 既定/ 的/ 情况/ 下/ ,/ 获取/ 到/ 功能/ 单元/ 的/ 使用/ 情况/ 即可/ 推算/ 其实/ 时/ 功耗/ ./ 硬件/ 性能/ 计数器/ 监测/ 到/ 的/ 活动/ 事件/ 的/ 发生/ 次数/ ,/ 能够/ 准确/ 直观/ 地/ 体现/ 系统/ 运行/ 时/ 的/ 硬件/ 部件/ 使用/ 情况/ ,/ 同时/ 也/ 是/ 获得/ 其/ 功耗/ 情况/ 的/ 最/ 直观/ 、/ 最/ 精确/ 的/ 途径/ ./ 当前/ 的/ 主流/ 处理器/ 均/ 定义/ 了/ 丰富/ 的/ 硬件/ 事件/ 集合/ ,/ 并/ 配置/ 了/ 相应/ 的/ 硬件/ 性能/ 计数器/ 以/ 记录/ 这些/ 活动/ 事件/ ,/ 从而/ 为/ 通过/ 性能/ 计数器/ 描述/ 系统/ 功耗/ 提供/ 了/ 条件/ ./ 计算机系统/ 是/ 一个/ 通过/ 分工合作/ 共同完成/ 既定/ 任务/ 的/ 复杂/ 系统/ ,/ 功能/ 单元/ 与/ 性能/ 计数器/ 之间/ 呈现/ 多/ 对/ 多/ 的/ 相关性/ ./ 任何/ 功能/ 单元/ 都/ 与/ 其它/ 部分/ 有着/ 紧密/ 的/ 相互作用/ ,/ 难以/ 通过/ 单个/ 性能/ 计数器/ 完整/ 地/ 反映/ 其/ 工作/ 情况/ ,/ 如/ :/ 对/ 内存/ 的/ 读取/ 访问/ ,/ 同时/ 也/ 意味着/ 系统/ 已经/ 对/ L1Cache/ 、/ L2Cache/ 、/ L3Cache/ 进/ Page4/ 行过/ 访问/ ;/ 同样/ ,/ 各/ 性能/ 计数器/ 所/ 代表/ 的/ 活动/ 事件/ 之间/ 存在/ 复杂/ 的/ 相关/ 关系/ ,/ 一个/ 性能/ 计数器/ 的/ 变化/ 的/ 同时/ ,/ 与/ 之/ 相关/ 的/ 性能/ 计数器/ 也/ 在/ 发生/ 相应/ 的/ 变化/ ./ L3Cache/ 的/ 命中/ ,/ 同时/ 也/ 意味着/ 记录/ L1CacheMiss/ 、/ L2CacheMiss/ 的/ 性能/ 计数器/ 值/ 增加/ ,/ 分支/ 预测/ 失败/ ,/ 不仅/ 会/ 导致/ BranchPredictionMiss/ 问题/ ,/ 也/ 可能/ 会/ 导致/ 浮点/ 和/ 整数/ 计算/ 单元/ 的/ 利用率/ 下降/ ./ 由此可知/ ,/ 一个/ 功能/ 单元/ 的/ 使用/ 情况/ 一般/ 与/ 多个/ 性能/ 计数器/ 相关/ ,/ 由/ 多个/ 相关/ 性能/ 计数器/ 的/ 线性组合/ 估计/ 功能/ 单元/ 的/ 功耗/ ,/ 比/ 只/ 使用/ 一个/ 性能/ 计数器/ 更/ 符合实际/ 情况/ ./ 设/ Fpreslct/ 为/ 系统/ 提供/ 的/ 性能/ 计数器/ 全集/ ,/ 且/ Fpreslct/ 中有/ m/ 个/ 活动/ 事件/ ,/ fk/ 为/ 第/ k/ 个/ 性能/ 计数器/ 的/ 值/ ,/ 第/ k/ 个/ 性能/ 计数器/ 对/ Punitij/ 的/ 影响/ 权值/ 为/ wijk/ ,/ β/ ij/ 为/ 常量/ (/ 其中/ 包括/ 该/ 部件/ 的/ 静态/ 功耗/ )/ ,/ 则/ 可得/ 以下/ 公式/ Punitij/ =/ β/ ij/ +/ ∑/ mPsystem/ =/ ∑/ n/ 设/ w0/ =/ ∑/ n/ 功耗/ 与/ 性能/ 计数器/ 值/ 的/ 关系/ 可/ 表示/ 为/ 犠/ 的/ 可/ 解性/ 和/ 精确性/ 是/ 模型/ 的/ 关键/ ./ 其中/ ,/ fk/ 为/ 第/ k/ 个/ 性能/ 计数器/ 的/ 值/ ,/ wk/ 为/ 第/ k/ 个/ 性能/ 计数器/ 代表/ 的/ 系统/ 行为/ 对系统/ 功耗/ 的/ 影响/ 权值/ ./ 3.2/ 求解/ 过程/ 对于/ 特定/ 的/ 目标/ 系统/ ,/ 需要/ 确定/ 两组/ 参数/ 集合/ :/ (/ 1/ )/ 预选/ 特征/ 集合/ Fpreslct/ =/ {/ fk/ ,/ k/ =/ 1/ ,/ 2/ ,/ …/ ,/ m/ }/ ;/ (/ 2/ )/ 影响/ 权值/ 的/ 集合/ 犠/ =/ {/ wk/ ,/ k/ =/ 1/ ,/ 2/ ,/ …/ ,/ m/ }/ ,/ 本文/ 通过/ 5/ 个/ 步骤/ 完成/ 模型/ 的/ 求解/ :/ (/ 1/ )/ 建立/ 实验/ 环境/ ./ 该/ 环境/ 能够/ 实时/ 记录/ Fpreslct/ 和/ Psystem/ ;/ (/ 2/ )/ 建立/ Fpreslct/ 集合/ ./ 选取/ 反映/ CPU/ 、/ 主存/ 、/ I/ // O/ 、/ 网络/ 等/ 主要/ 设备/ 运行/ 状态/ 的/ 性能/ 计数器/ ,/ 建立/ Fpreslct/ 集合/ ;/ (/ 3/ )/ 样本/ 提取/ ,/ 建立/ 多元/ 一次/ 方程组/ ./ 对/ 选定/ 的/ 系统/ 运行/ 有效/ 的/ 测试/ 激励/ ,/ 同步/ 采样/ Fpreslct/ =/ {/ fk/ ,/ k/ =/ 1/ ,/ 2/ ,/ …/ ,/ m/ }/ 与/ Psystem/ ,/ 得到/ 足够/ 多/ 的/ 样本/ ,/ 设/ 最终/ 用于/ 模型/ 求解/ 的/ 样本/ 数量/ 为/ s/ ,/ 建立/ 反映/ 运行/ 时/ Fpreslct/ 与/ Psystem/ 对应/ 关系/ 的/ 多元/ 一次/ 方程组/ ,/ 设/ w0/ 为/ 常数/ ,/ μ/ t/ 为/ 第/ t/ 个/ 样本/ 的/ 估计/ 误差/ ,/ U/ =/ {/ μ/ t/ ,/ t/ =/ 1/ ,/ 2/ ,/ …/ ,/ s/ }/ ,/ 则/ 方程组/ 为/ Psystem1/ =/ w0/ +/ w1/ ×/ f11/ +/ w2/ ×/ f21/ +/ w3/ ×/ f31/ +/ …/ +/ 烄/ wm/ ×/ fm1/ +/ μ/ 1Psystem2/ =/ w0/ +/ w1/ ×/ f12/ +/ w2/ ×/ f22/ +/ w3/ ×/ f32/ +/ …/ +/ 烅/ wm/ ×/ fm2/ +/ μ/ 2/ / Psystems/ =/ w0/ +/ w1/ ×/ f1s/ +/ w2/ ×/ f2s/ +/ w3/ ×/ f3s/ +/ …/ +/ ws/ ×/ fms/ +/ μ/ 烆/ 的/ 求解/ ./ 模型/ 求解/ ,/ 使得/ 误差/ 平方和/ ∑/ s/ (/ 5/ )/ 模型/ 有效性/ 验证/ ./ 依据/ 多元/ 线性/ 回归/ 的/ 方法/ 的/ 模型/ 检验/ 标准/ ,/ 检验/ 模型/ 的/ 显著性/ 水平/ α/ 、/ 残差/ r/ 、/ 相关系数/ r2/ 、/ 概率/ P/ 等/ 参数/ ,/ 验证/ 模型/ 的/ 有效性/ ;/ ①/ 如/ 通过/ 了/ 有效性/ 验证/ ,/ 则/ 得到/ 该/ 系统/ 的/ 功耗/ 模型/ Psystem/ =/ w0/ +/ w1/ ×/ f1/ +/ w2/ ×/ f2/ +/ …/ +/ wm/ ×/ fm/ 、/ 有效/ 特征值/ 集合/ Feffect/ 、/ 权值/ 集合/ W/ =/ {/ wk/ ,/ k/ =/ 1/ ,/ 2/ ,/ …/ ,/ m/ }/ ;/ ②/ 如未/ 通过/ 有效性/ 验证/ ,/ 则/ 回归/ 到/ 第/ (/ 2/ )/ 步/ ,/ 调/ (/ 4/ )/ 模型/ 求解/ ./ 通过/ 多元/ 线性/ 回归/ 的/ 方法/ 进行/ 由此/ ,/ 权值/ 的/ 求解/ 过程/ 可/ 推导/ 为/ 对/ 以上/ 方程组/ 整/ Fpreslct/ 和/ 测试/ 激励/ ,/ 继续/ 实验/ ./ 3.3/ 实验/ 环境/ 对于/ Psystem/ 实时/ 功耗/ 采样/ ,/ 本文/ 使用/ 安捷伦/ 8848A/ 功耗/ 分析仪/ 进行/ ,/ 将/ 其/ 探头/ 接入/ 电源线/ ,/ 获取/ 整机/ 的/ 实时/ 电流/ 输出/ 值/ ./ 在/ 控制/ 端/ 运行/ 外部/ 监控/ 程序/ ,/ 通过/ 标准/ GPIB/ 接口/ 实时/ 读取/ 功率/ 分析仪/ 的/ 输出/ ,/ 并/ 保存/ 在/ 本地/ 文件/ 中/ 进行/ 后期/ 处理/ ./ 测试/ 时/ 使用/ 220V/ 高精度/ 稳压电源/ ,/ 设置/ 系统/ 采样/ 频率/ 为/ 每/ 5s/ 一次/ ,/ 平均/ 每个/ 采样/ 点为/ 50/ 个/ 连续/ 电流/ 采样/ 的/ 平均值/ ./ 本文/ 的/ 实验/ 环境/ 如图/ 1/ 所示/ ./ Page53/ ./ 4/ 建立/ 犉/ preslct/ 集合/ 原则/ :/ 的/ 局部/ 运行/ 情况/ ;/ 况/ ,/ 全面/ 反映/ 系统/ 各/ 部分/ 的/ 性能/ 表现/ ;/ 对于/ Fpreslct/ 集合/ 中/ 元素/ 的/ 选择/ ,/ 本文/ 给出/ 了/ 3/ 点/ (/ 1/ )/ 有效性/ ./ 可以/ 实时/ 获得/ ,/ 并/ 有效/ 地/ 反映/ 系统/ (/ 2/ )/ 全面性/ ./ 能够/ 有效/ 刻画/ 系统/ 的/ 实时/ 运行/ 情/ (/ 3/ )/ 独立性/ ./ 元素/ 之间/ 不/ 存在/ 包含/ 关系/ ,/ 例如/ ,/ cpu/ %/ =/ usr/ %/ +/ sys/ %/ +/ iowait/ %/ +/ idle/ %/ ,/ 则/ cpu/ %/ 不/ 应该/ 在/ 参数/ 集合/ 中/ ./ 为了/ 确保/ Fpreslct/ 集合/ 能够/ 有效/ 反映/ 系统/ 的/ 运行/ 情况/ ,/ 不/ 遗漏/ 重要/ 的/ 性能/ 计数器/ ,/ 首先/ 尽可能/ 多地/ 将/ 所有/ 不/ 存在/ 包含/ 关系/ 的/ 性能/ 影响/ 因素/ 都/ 加入/ Fpreslct/ 集合/ 中/ ,/ 在/ 模型/ 求解/ 后/ ,/ 再/ 将/ 权值/ 为/ 0/ 的/ 性能/ 计数器/ 去除/ ,/ 从而/ 得到/ 一组/ 对系统/ 运行/ 功耗/ 存在/ 有效/ 影响/ 的/ 性能/ 计数器/ 集合/ ,/ 做/ 为/ 有效/ 特征值/ 集合/ (/ 简称/ Feffect/ )/ ./ 进一步/ ,/ 为/ 满足/ 实时性/ 的/ 要求/ ,/ 也/ 可以/ 在/ 实时性/ 和/ 精确性/ 之间/ 进行/ 权衡/ ,/ 对模型/ 进行/ 精简/ ./ 本文/ 选取/ 的/ Fpreslct/ 集合/ 如表/ 1/ 所示/ ./ 分类/ 内存/ 分页/ 监控/ I/ // O/ 及/ 传输速率/ 监控/ 块/ 设备/ 监控/ 网络设备/ 监控/ 网络设备/ 错误/ 监控/ NFS/ 监控/ 统计/ 成功/ 的/ 、/ 重传/ 的/ RPC/ 调用/ 次数/ 等/ 信息/ 套/ 接字/ 监控/ 统计/ 使用/ 的/ TCP/ 、/ UDP/ 、/ RAW/ 、/ IP/ 段/ 以及/ 总共/ 的/ 套/ 平均/ 负载/ 和/ 队列/ 监控/ 内存/ 资源/ 监控/ CPU/ 资源/ 监控/ 内核/ 表/ 监控/ 统计/ 索引/ 节点/ 、/ 文件/ 句柄/ 、/ 伪/ 终端/ 的/ 数量/ 等/ 信息/ 3.5/ 样本/ 提取/ 使用/ 情况/ ,/ 样本/ 应/ 满足/ 以下/ 要求/ :/ 为/ 减少/ 抽样误差/ ,/ 确保/ 样本/ 能够/ 全面/ 反映/ 系统/ 各/ 水平/ 上/ 基本/ 呈/ 正态分布/ ;/ 足/ 方差齐性/ ,/ 在/ 各/ 水平/ 的/ 样本量/ 大致/ 相等/ ;/ (/ 1/ )/ 正态分布/ ./ 样本/ 集合/ 在/ 所有/ 性能/ 计数器/ 的/ (/ 2/ )/ 方差齐性/ ./ Psystem/ 在/ 性能/ 计数器/ 各/ 水平/ 上满/ (/ 3/ )/ 样本/ 独立性/ ./ 采样/ 点/ 之间/ 无/ 相关性/ ,/ 本/ 实验/ 中/ ,/ 重点/ 关注/ 对于/ 时序/ 相关性/ 和/ 资源/ 相关性/ 的/ 消除/ ./ 为此/ ,/ 需要/ 对/ 典型/ 应用/ 中/ 各/ 主要/ 部件/ 使用/ 情况/ 进行/ 概率/ 统计/ ,/ 选择/ 能够/ 符合/ 以上/ 概率/ 的/ 典型/ Benchmark/ 作为/ 测试/ 激励/ ,/ 并/ 通过/ 覆盖率/ 测试/ ,/ 验证/ 这些/ Benchmark/ 的/ 代表性/ 和/ 全面性/ ./ 本文/ 选取/ 了/ 体现/ CPU/ 、/ Cache/ 、/ 主存/ 、/ I/ // O/ 、/ 网络/ 、/ 总线/ 等/ 主要/ 设备/ 的/ 典型/ Benchmark/ ,/ 包括/ Lmbench/ 、/ Unixbench/ 、/ Iozone/ 、/ LTPstress/ 、/ Netperf/ 、/ NPB/ 、/ Cachebench/ ./ 在/ 运行/ 以上/ Benchmark/ 的/ 过程/ 中/ ,/ 每隔/ 5/ 秒钟/ ,/ 同步/ 采样/ 性能/ 计数器/ 和/ 电流/ 的/ 数值/ ,/ 计入/ 日志/ 文件/ ./ 接下来/ ,/ 对/ 日志/ 中/ 的/ 采样/ 数据/ 进行/ 统计/ 和/ 处理/ ,/ 进行/ 以下/ 3/ 个/ 步骤/ 的/ 处理/ ,/ 以/ 满足/ 样本/ 方差齐性/ 、/ 正态分布/ 和/ 独立性/ 的/ 要求/ :/ (/ 1/ )/ 方差齐性/ ./ 统计/ 各/ 性能/ 计数器/ 值/ 的/ 平均值/ 和/ 方差/ ,/ 对于/ 方差/ 较大/ 的/ 性能/ 计数器/ ,/ 分析/ 其/ 取值/ 分布/ ,/ 有/ 针对性/ 地/ 进行/ 补充/ 测试/ ,/ 以/ 减小/ 与/ 其它/ 性能/ 计数器/ 的/ 方差/ ,/ 直到/ 各/ 性能/ 计数器/ 值/ 的/ 方差/ 基本相同/ 为止/ ;/ (/ 2/ )/ 正态分布/ ./ 由于/ 本文/ 提出/ 的/ 方法/ 是/ 在/ 假定/ 系统/ 输入/ 电压/ 恒定/ 的/ 前提/ 下/ ,/ 通过/ 测试/ 系统/ 电流/ 来/ 计算/ 实时/ 功耗/ ,/ 为/ 保证/ 样本/ 的/ 方差齐性/ ./ 对于/ 电流值/ ,/ 取/ 0.1/ A/ 为/ 步长/ ,/ 统计/ 采样/ 样本/ 在/ 各/ 电流/ 区间/ 的/ 分布/ ,/ 减少/ 样本/ 密度/ 较/ 高/ 的/ 区间/ 中/ 的/ 样本数/ ,/ 直到/ 各/ 区间/ 的/ 采样/ 数/ 基本相同/ 为止/ ;/ 通过/ 以上/ 两步/ ,/ 得到/ 了/ 作为/ 模型/ 求解/ 的/ 样本/ 集合/ ,/ 表/ 2/ 是/ 本文/ 在/ 三个/ 平台/ 上/ 采用/ 的/ 样本/ 统计/ ./ BenchmarkLmbench178521131684Unixbench165429161883Iozone143511951335LTPstress146116421247Netperf139313091512NPBCachebench1263/ 合计/ 120691116912868Page6/ (/ 3/ )/ 样本/ 独立性/ ./ 样本/ 独立性/ 的/ 强弱/ 关系/ 决定/ 其/ 均值/ 差异/ 检验/ 的/ 统计/ 显著性/ 高低/ 关系/ ,/ 二者/ 是/ 完全/ 吻合/ 的/ [/ 21/ ]/ ,/ 即/ 样本/ 间/ 独立性/ 越强/ 其/ 均值/ 差异/ 的/ 显著性/ 就/ 越/ 高/ ,/ 独立性/ 越弱/ 其/ 均值/ 差异/ 的/ 显著性/ 就/ 越/ 低/ [/ 21/ ]/ ./ 由于/ 连续/ 2/ 个/ 样本/ 之间/ 不可避免/ 地/ 存在/ 时序/ 相关性/ 、/ 资源/ 相关性/ ,/ 因此/ ,/ 本文/ 中/ 的/ 样本/ 独立性/ 重点/ 关注/ 降低/ 这/ 二者/ 对模型/ 精度/ 的/ 影响/ ./ 增大/ 采样/ 周期/ 可以/ 有效/ 地/ 提高/ 样本/ 的/ 独立性/ ,/ 通过/ 实验/ 我们/ 也/ 发现/ ,/ 在/ 样本/ 数量/ 相同/ 的/ 前提/ 下/ ,/ 适当/ 增大/ 采样/ 周期/ 能够/ 有效/ 提高/ 模型/ 的/ 精度/ ./ 与此同时/ ,/ 为/ 保证/ 输入/ 样本/ 的/ 数量/ ,/ 增大/ 采样/ 周期/ 的/ 同时/ 也/ 要求/ 延长/ 总/ 的/ 采样/ 时间/ ,/ 需要/ 相应/ 地/ 增加/ 基准/ 测试/ 的/ 种类/ 及/ 参数/ 组合/ ./ 最终/ 选定/ 的/ 每隔/ 5s/ 的/ 采样/ 间隔/ ,/ 是/ 在/ 样本/ 数量/ 和/ 采样/ 间隔/ 之间/ 权衡/ 的/ 结果/ ./ 3.6/ 权值/ 求解/ 回归方程/ 的/ 求解/ ./ 本文/ 采用/ Matlab/ 的/ regress/ 函数/ 进行/ 多元/ 线性/ 设/ Q/ =/ ∑/ s/ 求解/ 可/ 归结为/ 求/ 犠/ =/ {/ wk/ ,/ k/ =/ 1/ ,/ 2/ ,/ …/ ,/ m/ }/ ,/ 使得/ Q/ 达到/ 最小/ ./ 即/ / w0/ =/ -/ 2/ ∑/ s/ / Q/ 烄/ / w1/ =/ -/ 2/ ∑/ s/ / Q/ 烅/ / / wm/ =/ -/ 2/ ∑/ s/ / Q/ 烆/ 化简/ 可得/ f2t/ +/ …/ +/ wm/ ∑/ s/ 设/ 犉/ =/ 可以/ 简写/ 成可得/ 最大/ 似然/ 估计值/ :/ 使用/ Matlab/ 中/ 的/ regress/ 函数/ 进行/ 多元/ 线性/ 回归/ ,/ 得到/ 系统/ 的/ 功耗/ 模型/ SysPower/ =/ 犠/ ×/ Fpreslct/ ./ 并取/ Fpreslct/ 中/ 的/ 非/ 0/ 元素/ 组成/ Feffect/ ,/ Feffect/ 中/ 的/ 性能/ 计数器/ 所/ 代表/ 的/ 系统/ 事件/ 对/ 功耗/ 是/ 有/ 影响/ 的/ ./ 3.7/ 结果/ 检验/ 标准/ 为了/ 确认/ 回归/ 模型/ 是否/ 符合/ 变量/ 之间/ 的/ 客观规律/ ,/ 需要/ 对/ 回归/ 模型/ 进行/ 检验/ ,/ 以/ 确定/ 预测/ 结果/ 的/ 可设/ 以下/ s/ 组/ 采样/ 样本/ 用于/ 模型/ 求解/ :/ (/ f11/ ,/ f21/ ,/ …/ ,/ fm1/ ,/ P1/ )/ …/ (/ f1s/ ,/ f2s/ ,/ …/ ,/ fms/ ,/ Ps/ )/ ./ 取/ 珡/ w0/ ,/ 珡/ w1/ ,/ …/ ,/ 珡/ wn/ ./ 当/ w0/ =/ 珡/ w0/ ,/ w1/ =/ 珡/ w1/ ,/ …/ ,/ wm/ =/ 珡/ wm/ 时/ ,/ μ/ t/ =/ Psystemt/ -/ w0/ -/ w1/ ×/ f1t/ -/ w2/ ×/ f2t/ …/ wm/ ×/ fmt/ ,/ t/ =/ 1/ ,/ 2/ ,/ …/ ,/ s/ ./ fmt/ =/ ∑/ st/ =/ 1/ 信/ 程度/ ./ 本文/ 中/ ,/ 对于/ 满足/ 正态分布/ 和/ 方差齐性/ 的/ 样本/ ,/ 取前/ 10000/ 条/ 进行/ 随机/ 的/ 乱序/ 重排/ 并/ 作为/ 模型/ 求解/ 的/ 输入/ ,/ 使用/ 多元/ 线性/ 回归/ 法/ 求解/ 功耗/ 模型/ ,/ 其余/ 样本/ 中取/ 1000/ 条/ 用于/ 对模型/ 的/ 精确度/ 评价/ ,/ 使用/ Matlab/ 中/ 的/ regress/ 函数/ 进行/ 多元/ 线性/ 回归方程/ 求解/ ./ 其/ 公式/ 为/ 其中/ :/ 10000/ }/ ;/ 合/ 矩阵/ 犠/ =/ {/ wk/ ,/ k/ =/ 1/ ,/ 2/ ,/ …/ ,/ m/ }/ 的/ 积/ ;/ 性关系/ 成立/ ;/ [/ b/ ,/ bint/ ,/ r/ ,/ rint/ ,/ stats/ ]/ =/ regress/ (/ Y/ ,/ X/ ,/ a/ )/ ,/ (/ 1/ )/ Y/ 为/ 样本/ 的/ 功耗/ 值/ 集合/ {/ Psystemt/ ,/ t/ =/ 1/ ,/ 2/ ,/ …/ ,/ (/ 2/ )/ X/ 为/ Fpreslct/ =/ {/ fk/ ,/ k/ =/ 1/ ,/ 2/ ,/ …/ ,/ m/ }/ 与/ 权值/ 集/ (/ 3/ )/ α/ 表示/ 显著性/ 水平/ ,/ 一般/ 小于/ 0.05/ 表示/ 线/ (/ 4/ )/ b/ 为/ 回归系数/ ,/ 即/ 求解/ 的/ 参数/ ./ 本文/ 中为/ (/ 5/ )/ bint/ 表示/ 回归系数/ 的/ 区间/ 估计/ ./ 本文/ 中为/ Fpreslct/ 对/ 功耗/ 的/ 权值/ 集合/ 犠/ ;/ Page7/ (/ 6/ )/ r/ 表示/ 残差/ ,/ 即/ 估计值/ 与/ 实际/ 值之差/ ;/ (/ 7/ )/ rint/ 表示/ 回归系数/ b/ 的/ 置信区间/ ;/ (/ 8/ )/ stats/ 表示/ 用于/ 检验/ 回归/ 模型/ 的/ 统计/ 量/ ,/ 有/ 3/ 个/ 数值/ :/ 相关系数/ r2/ 、/ F/ 值/ 、/ 与/ F/ 对应/ 的/ 概率/ P/ ./ 该/ 函数/ 规定/ ,/ 相关系数/ r2/ 越/ 接近/ 1/ ,/ 说明/ 回归方程/ 越/ 显著/ ;/ F/ 越大/ ,/ 说明/ 回归方程/ 越/ 显著/ ;/ 与/ F/ 对应/ 的/ 概率/ P/ </ α/ 时/ ,/ 表示/ 回归/ 模型/ 成立/ ./ 本文/ 认为/ 验证/ SysPower/ 功耗/ 模型/ 的/ 标准/ 如下/ :/ (/ 1/ )/ 相关系数/ r2/ >/ 0.9/ ,/ r2/ 值越/ 大/ 说明/ 模型/ 越/ (/ 2/ )/ F/ >/ 150/ ,/ F/ 值越/ 大/ 说明/ 模型/ 越/ 准确/ ;/ (/ 3/ )/ P/ </ α/ ,/ 即/ P/ </ 0.05/ ,/ P/ 值越/ 小/ 说明/ 模型/ 越/ (/ 4/ )/ 在/ 多/ 核/ SMP/ 系统/ 中/ ,/ 代表/ 每个/ 核/ 的/ 相同/ 性能/ 计数器/ ,/ 例如/ CPU0/ 、/ CPU1/ 的/ 内核/ 态/ 运行/ 时间/ 百分比/ ,/ 在/ 模型/ 中/ 的/ 权值/ 应该/ 相似/ ,/ 相差/ 不/ 大于/ 5/ %/ ;/ 准确/ ;/ 准确/ ;/ 犠/ =/ {/ wk/ ,/ k/ =/ 1/ ,/ 2/ ,/ …/ ,/ m/ }/ 的/ 区间/ 估计/ ;/ (/ 5/ )/ 模型/ 的/ 绝对/ 估计/ 误差/ </ 5/ %/ ./ 4/ 实验/ 分析/ 在/ 3.5/ 节中/ ,/ 针对/ 神威/ D1000/ 、/ DELLPC/ 、/ 龙芯/ 电脑/ ,/ 本文/ 分别/ 采样/ 了/ 12069/ 、/ 11169/ 、/ 12868/ 份/ 样本/ ./ 根据/ 前期/ 实验/ 的/ 经验/ ,/ 在/ 采样/ 间隔/ 为/ 5s/ 、/ 样本/ 数量/ 在/ 9000/ ~/ 11000/ 份时/ 模型/ 的/ 精度/ 较/ 好/ ./ 为/ 便于/ 对比/ ,/ 本文/ 对/ 每/ 一个/ 平台/ 都/ 取/ 最后/ 1000/ 份/ 样本/ 进行/ 模型/ 精确度/ 检验/ ,/ 其余/ 样本/ 中取/ 10000/ 份/ 用于/ 模型/ 求解/ ./ 同时/ ,/ 由/ 3.5/ 节/ 可知/ 适当/ 增加/ 采样/ 间隔/ 有利于/ 减小/ 样本/ 间/ 相关性/ ,/ 为/ 尽量/ 利用/ 所有/ 的/ 采样/ 样本/ ,/ 使/ 模型/ 尽可能/ 精确/ ,/ 本文/ 采取/ 了/ 在/ 其余/ 样本/ 中/ 随机/ 抽取/ 10000/ 份/ 样本/ 的/ 方式/ ./ 4.1/ 神威/ D1000/ 配置/ 参数/ 如表/ 3/ 所示/ ./ 神威/ D1000/ 电脑/ 采用/ 申威/ 四核/ CPU/ ,/ 具体/ 系统/ Technology/ // Frequency/ 根据/ 神威/ D1000PC/ 的/ 结构/ ,/ 本文/ 预先/ 选定/ 211/ 个/ 性能/ 计数器/ 作为/ Fpreslct/ ,/ 按照/ 第/ 3.5/ 节/ 的/ 方法/ 进行/ 样本/ 提取/ ,/ 对于/ 最终/ 得到/ 的/ 样本/ ,/ 取/ 最后/ 的/ 1000/ 份/ 用于/ 模型/ 验证/ 和/ 精确度/ 评价/ ,/ 其余/ 样本/ 中/ ,/ 先后/ 3/ 次/ 从中/ 随机/ 抽取/ 10000/ 份/ 样本/ 作为/ 模型/ 求解/ 的/ 输入/ ,/ 使用/ Matlab/ 中/ 的/ regress/ 函数/ 分别/ 进行/ 模型/ 求解/ ./ 实验/ 结果表明/ ,/ 三组/ 数据/ 所/ 得到/ 的/ 功耗/ 模型/ 的/ r2/ 分别/ 为/ 0.87480/ 、/ 0.87477/ 、/ 0.87479/ ,/ 在/ 预先/ 选定/ 的/ 211/ 个/ 性能/ 计数器/ 中/ ,/ 三组/ 模型/ 得到/ 的/ 有效/ 特征/ 集合/ (/ 权值/ 非/ 0/ )/ Feffect/ 完全一致/ ,/ 包含/ 74/ 个/ 性能/ 计数器/ ,/ 这/ 表明/ 本文/ 提出/ 的/ 模型/ 构建/ 方法/ 具有/ 较/ 好/ 的/ 稳定性/ ,/ 同时/ 也/ 表示/ 这/ 74/ 个/ 性能/ 计数器/ 所/ 代表/ 的/ 系统/ 运行/ 情况/ 对/ 功耗/ 是/ 有/ 贡献/ 的/ ,/ 由此/ 得到/ 神威/ D1000PC/ 的/ 有效/ 特征/ 集合/ :/ Feffect/ _/ 神威/ D1000/ ./ 本文/ 选取/ 了/ r2/ 最大/ 的/ 功耗/ 模型/ ,/ 具体/ 见/ 附录/ ./ 该/ 模型/ 的/ r2/ =/ 0.87480/ (/ 越/ 接近/ 于/ 1/ ,/ 回归/ 效果/ 越/ 显著/ )/ ,/ F/ =/ 275.1558/ ,/ P/ =/ 0/ ,/ 由/ P/ </ 0.05/ ,/ 可知/ 回归/ 模型/ SysPower/ 神威/ D1000/ 成立/ ./ 使用/ 剩余/ 数据/ 中/ 的/ 1000/ 份/ 采样/ 数据/ 进行/ 模型/ 的/ 精确度/ 评价/ ,/ 估计值/ 与/ 实际/ 值/ 的/ 误差/ 如图/ 2/ 所示/ ./ 对/ 这/ 1000/ 组/ 估计/ 数据/ 的/ 误差/ 分布/ 情况/ 统计/ 如表/ 4/ 所示/ ./ 标准差/ 均/ 方差/ 最大/ 绝/ 0.00242/ ./ 39E/ -/ 063.18/ %/ 88.20/ %/ 11.00/ %/ 0.70/ %/ 0.10/ %/ 以上/ 数据/ 显示/ ,/ 在/ 99.9/ %/ 的/ 情况/ 下/ ,/ 该/ 功耗/ 模型/ 的/ 误差/ 在/ 3/ %/ 以内/ ,/ 因此/ ,/ 在/ 基于/ 申威/ 四核/ CPU/ 的/ 神威/ D1000PC/ 上/ ,/ 采用/ 本文/ 提出/ 的/ 方法/ 所/ 构建/ 的/ 功耗/ 模型/ 是/ 有效/ 的/ ./ 4.2/ DELLOptiplex750PCCPU/ ,/ 其/ 系统配置/ 参数/ 如表/ 5/ 所示/ ./ DELLOptiplex750PC/ 采用/ IntelQ8200/ 四核/ Page8Technology/ // FrequencyNumberofcores/ 根据/ DELLOptiplex750PC/ 的/ 结构/ ,/ 预先/ 选定/ 211/ 个/ 性能/ 计数器/ 作为/ Fpreslct/ ,/ 并/ 按照/ 4.1/ 节/ 的/ 方法/ 进行/ 样本/ 采样/ 和/ 精确度/ 评价/ ./ 实验/ 结果表明/ ,/ 三组/ 数据/ 所/ 得到/ 的/ 功耗/ 模型/ 的/ r2/ 分别/ 为/ 0.96658/ 、/ 0.96660/ 、/ 0.96656/ ,/ 在/ 预先/ 选定/ 的/ 211/ 个/ 性能/ 计数器/ 中/ ,/ 三组/ 模型/ 得到/ 的/ 有效/ 特征/ 集合/ (/ 权值/ 非/ 0/ )/ Feffect/ 完全一致/ ,/ 包含/ 79/ 个/ 性能/ 计数器/ ,/ 这/ 表明/ 本文/ 提出/ 的/ 模型/ 构建/ 方法/ 具有/ 较/ 好/ 的/ 稳定性/ ,/ 由此/ 得到/ 该/ 平台/ 的/ 有效/ 特征/ 集合/ :/ Feffect/ _/ DELLOptiplex750/ ./ 本文/ 选取/ 了/ r2/ 最大/ 的/ 功耗/ 模型/ ,/ 由于/ 篇幅/ 所/ 限/ ,/ 不/ 详细/ 列出/ 该/ 模型/ ,/ 具体/ 见/ 附录/ ./ 该/ 模型/ 的/ r2/ =/ 0.96660/ ,/ F/ =/ 810.08/ ,/ P/ =/ 0/ ,/ 由/ P/ </ 0.05/ ,/ 可知/ 回归/ 模型/ SysPowerDELLOptiplex750/ 成立/ ./ 使用/ 剩余/ 数据/ 中/ 的/ 1000/ 份/ 采样/ 数据/ 进行/ 模型/ 的/ 精确度/ 评价/ ,/ 估计值/ 与/ 实际/ 值/ 的/ 误差/ 如图/ 3/ 所示/ ./ 对/ 这/ 1000/ 组/ 估计/ 数据/ 的/ 误差/ 分布/ 情况/ 统计/ 如表/ 6/ 所示/ ./ 标准差/ 均/ 方差/ 最大/ 绝/ 0.01011/ ./ 01E/ -/ 053.73/ %/ 79.30/ %/ 15.20/ %/ 4.60/ %/ 0.90/ %/ 以上/ 数据/ 显示/ ,/ 在/ 99.1/ %/ 的/ 情况/ 下/ ,/ 该/ 功耗/ 模型/ 的/ 误差/ 在/ 3/ %/ 以内/ ,/ 因此/ ,/ 在/ 基于/ IntelQ8200/ 四核/ CPU/ 的/ DELLOptiplex750PC/ 上/ ,/ 采用/ 本文/ 提出/ 的/ 方法/ 所/ 构建/ 的/ 功耗/ 模型/ 是/ 有效/ 的/ ./ 4.3/ 龙芯/ 2F6003/ 置/ 参数/ 如表/ 7/ 所示/ ./ 龙芯/ 2F6003/ 采用/ 龙芯/ 2F/ 单核/ CPU/ ,/ 其/ 系统配/ Technology/ // Frequency/ 由于/ 龙芯/ 2F6003/ 采用/ 龙芯/ 2F/ 单核/ CPU/ ,/ 因此/ 本文/ 在/ 之前/ 的/ 211/ 个/ 性能/ 计数器/ 基础/ 上/ ,/ 去除/ 反映/ CPU1/ 、/ CPU2/ 、/ CPU3/ 负载/ 的/ 12/ 个/ 性能/ 计数器/ ,/ 将/ 剩下/ 的/ 199/ 个/ 性能/ 计数器/ 作为/ Fpreslct/ ,/ 并/ 按照/ 4.1/ 节/ 的/ 方法/ 进行/ 样本/ 采样/ 和/ 精确度/ 评价/ ./ 实验/ 结果表明/ ,/ 三组/ 数据/ 所/ 得到/ 的/ 功耗/ 模型/ 的/ r2/ 分别/ 为/ 0.88473/ 、/ 0.88489/ 、/ 0.88481/ ,/ 在/ 预先/ 选定/ 的/ 199/ 个/ 性能/ 计数器/ 中/ ,/ 三组/ 模型/ 得到/ 的/ 有效/ 特征/ 集合/ (/ 权值/ 非/ 0/ )/ Feffect/ 完全一致/ ,/ 包含/ 63/ 个/ 性能/ 计数器/ ,/ 这/ 表明/ 本文/ 提出/ 的/ 模型/ 构建/ 方法/ 具有/ 较/ 好/ 的/ 稳定性/ ,/ 由此/ 得到/ 该/ 平台/ 的/ 有效/ 特征/ 集合/ :/ Feffect/ _/ 龙芯/ 2F6003/ ./ 本文/ 选取/ 了/ r2/ 最大/ 的/ 功耗/ 模型/ ,/ 由于/ 篇幅/ 所/ 限/ ,/ 不/ 详细/ 列出/ 该/ 模型/ ,/ 具体/ 见/ 附录/ ./ 该/ 模型/ 的/ r2/ =/ 0.88489/ ,/ F/ =/ 810.08/ ,/ P/ =/ 0/ ,/ 由/ P/ </ 0.05/ ,/ 可知/ 回归/ 模型/ SysPower/ 龙芯/ 2F6003/ 成立/ ./ 使用/ 剩余/ 数据/ 中/ 的/ 1000/ 份/ 采样/ 数据/ 进行/ 模型/ 的/ 精确度/ 评价/ ,/ 估计值/ 与/ 实际/ 值/ 的/ 误差/ 如图/ 4/ 所示/ ./ 对/ 这/ 1000/ 组/ 估计/ 数据/ 的/ 误差/ 分布/ 情况/ 统计/ 如表/ 8/ 所示/ ./ Page9/ 标准差/ 均/ 方差/ 最大/ 绝/ 0.00444/ ./ 44E/ -/ 063.84/ %/ 64.70/ %/ 19.50/ %/ 11.10/ %/ 4.70/ %/ 以上/ 数据/ 显示/ ,/ 在/ 95.3/ %/ 的/ 情况/ 下/ ,/ 该/ 功耗/ 模型/ 的/ 误差/ 在/ 3/ %/ 以内/ ,/ 因此/ ,/ 在/ 基于/ 龙芯/ 2F/ 单核/ CPU/ 的/ 龙芯/ 2F6003/ 电脑/ 上/ ,/ 采用/ 本文/ 提出/ 的/ 方法/ 所/ 构建/ 的/ 功耗/ 模型/ 是/ 有效/ 的/ ./ 4.4/ 结果/ 分析/ 在/ 以上/ 工作/ 基础/ 上/ ,/ 本文/ 对/ 以上/ 三个/ 平台/ 的/ Feffect/ 集合/ 进行/ 了/ 分析/ ,/ 由于/ 龙芯/ 2F/ 为/ 单核/ CPU/ ,/ 没有/ 针对/ 4/ 核/ 处理器/ 的/ 1/ 核/ 、/ 2/ 核/ 、/ 3/ 核/ 的/ 性能/ 计数器/ ,/ 但/ 这/ 三个/ 核/ 的/ 性能/ 计数器/ 对系统/ 功耗/ 有/ 不可/ 忽略/ 的/ 影响/ ,/ 因此/ 本文/ 将/ 针对/ 其余/ 三个/ 核/ 的/ 性能/ 计数器/ 也/ 一起/ 考虑/ ,/ 得到/ 了/ 在/ 三个/ 平台/ 上/ 都/ 对系统/ 总/ 功耗/ Psystem/ 产生/ 影响/ 的/ Fcommon/ _/ effect/ 集合/ :/ Fcommon/ _/ effect/ =/ Feffect/ _/ 神威/ D1000/ ∩/ Feffect/ _/ DELLOptiplex750/ ∩/ Feffect/ _/ 龙芯/ 2F6003/ ./ 该/ 集合/ 共/ 包含/ 70/ 个/ 性能/ 计数器/ ,/ 负责/ 对/ CPU/ 资源/ 、/ 平均/ 负载/ 和/ 队列/ 、/ 内存/ 资源/ 、/ 内存/ 页/ 操作/ 情况/ 、/ 索引/ 节点/ // 文件/ 内核/ 表/ 、/ I/ // O/ 及/ 传输速率/ 、/ 块/ 设备/ 活动/ 情况/ 、/ 网络设备/ 活动/ 情况/ 的/ 监控/ ,/ 如表/ 9/ 所示/ ./ 参数/ CPU/ 利用率/ 创建/ 任务/ 和/ 系统/ 切换/ 内核/ 表/ 状态/ 平均/ 负载/ 和/ 队列/ 内存/ 相关/ 信息/ 参数/ 页/ 相关/ 信息/ I/ // O/ 设备/ 统计/ 信息/ 块/ 设备/ 相关/ 信息/ 网络设备/ 相关/ 信息/ 由表/ 9/ 可知/ ,/ 这/ 70/ 个/ 性能/ 计数器/ 反映/ 了/ 系统/ 内/ 所有/ 的/ 主要/ 功能/ 部件/ 的/ 资源/ 占用/ 情况/ 和/ 活动/ 状况/ ,/ 包括/ CPU/ 资源/ 、/ 内存/ 资源/ 、/ 磁盘/ 、/ I/ // O/ 、/ 网络/ ./ 值得注意/ 的/ 是/ ,/ 申威/ 处理器/ 与/ 龙芯/ 处理器/ 同/ 属于/ RISC/ 架构/ ,/ 但是/ 其/ 功耗/ 模型/ 却/ 存在/ 一定/ 的/ 区别/ ./ 在/ Feffect/ _/ 神威/ D1000/ ∩/ Feffect/ _/ 龙芯/ 2F6003/ 中/ 包含/ 72/ 个/ 性能/ 计数器/ ,/ 占/ Feffect/ _/ 神威/ D1000/ 的/ 97.30/ %/ ;/ 而/ Feffect/ _/ 龙芯/ 2F6003/ 集合/ 中/ 因为/ 少/ 了/ 12/ 个/ 代表/ 其余/ 三个/ 核/ 的/ 性能/ 计数器/ ,/ 只有/ 60/ 个/ 性能/ 计数器/ 包含/ 在内/ ,/ 占/ Feffect/ _/ 龙芯/ 2F6003/ 的/ 95.23/ %/ ./ 这/ 说明/ 处理器/ 的/ 具体/ 实现/ 和/ 模拟器/ 的/ 存在/ 一定/ 差异/ ,/ 传统/ 的/ 模拟器/ 的/ 方法/ 可以/ 作为/ 趋势性/ 研究/ ,/ 但/ 在/ 描述/ 处理器/ 实时/ 功耗/ 方面/ 精度/ 不足/ ./ 5/ 结论/ 及下/ 一步/ 工作/ 本文/ 提出/ 一种/ 基于/ 细粒度/ 性能/ 计数器/ 集合/ 建立/ 系统/ 实时/ 功耗/ 模型/ 的/ 方法/ ,/ 由/ 功耗/ 模型/ 设定/ 、/ 性能/ 计数器/ 选取/ 、/ 数据/ 采样/ 、/ 模型/ 求解/ 、/ 结果/ 检验/ 五个/ 步骤/ 组成/ ./ 在/ 基于/ 申威/ 四核/ CPU/ 的/ 神威/ D1000PC/ 、/ 基于/ Page10/ 龙芯/ 2F/ 单核/ CPU/ 的/ 福珑/ PC/ 、/ 基于/ IntelQ8200/ 四核/ CPU/ 的/ DELLOptiplex750PC/ 上/ ,/ 采用/ 该/ 方法/ 分别/ 建立/ 相应/ 的/ 功耗/ 模型/ SysPower/ 神威/ D1000/ 、/ 表/ 10/ 三个/ 平台/ 上/ 的/ 功耗/ 模型/ 检验/ 数据/ 和/ 误差/ 分析/ SysPower/ 神威/ D10000/ ./ 87480275.1600/ ./ 00242.39/ E/ -/ 063.18/ %/ 88.20/ %/ 11.00/ %/ 0.70/ %/ 0.10/ %/ SysPowerDellOptiplex0/ ./ 96660810.0800/ ./ 01011.01/ E/ -/ 053.73/ %/ 79.30/ %/ 15.20/ %/ 4.60/ %/ 0.90/ %/ SysPower/ 龙芯/ 2F60030/ ./ 88489168.8700/ ./ 00444.44/ E/ -/ 063.84/ %/ 64.70/ %/ 19.50/ %/ 11.10/ %/ 4.70/ %/ 在/ 此基础/ 上/ ,/ 对/ 以上/ 三个/ 平台/ 的/ Feffect/ 集合/ 进行/ 了/ 分析/ ,/ 得到/ 了/ 在/ 三个/ 平台/ 上/ 都/ 对系统/ 总/ 功耗/ Psystem/ 产生/ 影响/ 的/ Fcommon/ _/ effect/ 集合/ ,/ 该/ 集合/ 共/ 包含/ 70/ 个/ 元素/ ,/ 反映/ 了/ 系统/ 内/ 所有/ 的/ 主要/ 功能/ 部件/ (/ 除/ 风扇/ )/ 的/ 资源/ 占用/ 情况/ 和/ 活动/ 状况/ ./ 本文/ 的/ 测试/ 工作/ 在/ 相对/ 恒温/ (/ 18/ ~/ 20/ )/ 的/ 实验室/ 环境/ 中/ 进行/ ,/ 未/ 考虑/ 温度/ 变化/ 对/ 功耗/ 的/ 影响/ ,/ 此外/ ,/ 受/ 实验/ 平台/ 所/ 限/ ,/ 本文/ 的/ 实验/ 只/ 考虑/ 系统/ 的/ 基本/ 配置/ ,/ 未/ 考虑/ 无线/ 、/ 蓝牙/ 、/ 音频/ 、/ 图形/ 加速卡/ 等/ 硬件/ 设备/ 的/ 性能/ 计数器/ ./ 下/ 一步/ ,/ 我们/ 计划/ 研究/ 针对/ 这些/ 部件/ 的/ 典型/ 负载/ ,/ 提出/ 包括/ 这些/ 硬件/ 部件/ 的/ 功耗/ 模型/ 构建/ 方法/ ./ 本文/ 方法/ 是/ 基于/ 统计/ 的/ 回归/ 法/ ,/ 在/ 神威/ D1000/ 、/ DELLPC/ 、/ 龙芯/ 电脑/ 中/ ,/ 分别/ 进行/ 了/ 12069/ 、/ 11169/ 、/ 12868/ 次/ 采样/ ./ 如何/ 消除/ 相关性/ ,/ 如何/ 使/ 样本/ 更好/ 地/ 满足/ 正态分布/ 、/ 方差齐性/ 的/ 要求/ ,/ 从而/ 进一步提高/ 模型/ 的/ 精度/ ,/ 是/ 很/ 重要/ 、/ 同时/ 也/ 更为/ 复杂/ 和/ 困难/ 的/ 问题/ ,/ 需要/ 大量/ 的/ 实验/ 探索/ ,/ 我们/ 将/ 在/ 未来/ 的/ 工作/ 中/ 展开/ 进一步/ 的/ 研究/ ./ 此外/ ,/ 如果/ 能够/ 在/ 本文/ 的/ 基础/ 上/ ,/ 对/ 参数/ 的/ 确定/ 进行/ 理论/ 分析/ 或/ 估计/ ,/ 将/ 硬件/ 功能模块/ 的/ 性能/ 模型/ 和/ 能耗/ 模型/ 有机/ 结合/ 起来/ ,/ 通过/ 精心设计/ 的/ 实验/ 测试方法/ 自动/ 获取/ 系统/ 性能/ 和/ 能耗/ 参数/ ,/ 从而/ 方便/ 用户/ 根据/ 系统/ 特性/ 进行/ 参数估计/ ,/ 进一步提高/ 模型/ 的/ 通用性/ ,/ 也/ 是/ 本文/ 下/ 一步/ 研究/ 的/ 重点/ ./ 致谢/ 在/ 此/ ,/ 谨向/ 对/ 本文/ 的/ 工作/ 提出/ 宝贵/ 建议/ 的/ 徐志伟/ 老师/ 、/ 吴东/ 老师/ ,/ 对/ 协助/ 作者/ 进行/ 环境/ 搭建/ 、/ 数据处理/ 工作/ 的/ 夏志禹/ 工程师/ 、/ 张超容/ 工程师/ 表示/ 诚挚/ 的/ 感谢/ !/ 

