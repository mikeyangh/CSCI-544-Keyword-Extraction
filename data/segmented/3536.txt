Page1/ 面向/ 地址/ 空间/ 分离/ 网络/ 的/ 地址映射/ 模型/ :/ AMIA/ 陈/ 文龙/ 1/ )/ 徐明伟/ 2/ )/ 1/ )/ (/ 首都师范大学/ 信息/ 工程学院/ 北京/ 100048/ )/ 2/ )/ (/ 清华大学/ 计算机科学/ 与/ 技术/ 系/ 北京/ 100084/ )/ 摘要/ 地址/ 空间/ 分离/ 是/ 解决/ 互联网/ 路由/ 可/ 扩展/ 问题/ 的/ 有效/ 方法/ ,/ 其/ 关键技术/ 是/ 边缘/ 网/ 地址/ 到/ 核心网/ 地址/ 的/ 映射/ 机制/ ./ 现有/ 典型/ 地址映射/ 模型/ 基于/ 缓存/ 映射/ 项/ 机制/ 实施/ ,/ 其/ 映射/ 信息/ 交互/ 协议/ 复杂/ ,/ 路由器/ 对/ 映射/ 信息/ 缓存/ 的/ 维护/ 开销/ 很大/ ./ 而且/ ,/ 缓存/ 机制/ 中/ 映射/ 项/ 查询/ 延迟/ 较长/ ,/ 明显/ 影响/ 到/ 端系统/ 用户/ 的/ 网络/ 体验/ ./ 文中/ 设计/ 了/ 一种/ 新型/ 的/ 面向/ 地址/ 空间/ 分离/ 网络/ 的/ 域间/ 地址映射/ 模型/ :/ AMIA/ ,/ 通过/ BGP/ 协议/ 扩展/ 完成/ 映射/ 信息/ 交互/ ,/ 映射/ 项/ 存储/ 不/ 带有/ 任何/ 缓存/ 机制/ ,/ 方便/ 实施/ ./ 文中/ 还/ 为/ AMIA/ 模型/ 设计/ 研制/ 了/ 集成/ PE/ 和/ KMS/ 功能/ 的/ 多功能/ 路由/ 系统/ ,/ 并/ 在/ CERNET2/ 中/ 搭建/ 实验/ 网/ 进行/ 实验/ 验证/ ./ 理论/ 分析/ 及/ 实验/ 结果/ 证明/ AMIA/ 模型/ 具有/ 高性能/ 、/ 可行性/ 及易/ 实施/ 等/ 特点/ ./ 关键词/ 地址映射/ ;/ 封装/ ;/ PE1/ 引言/ 随着/ 互联网/ 规模/ 的/ 快速/ 发展/ ,/ 互联网/ 路由/ 可/ 扩展/ Page2/ 开销/ 和/ FIB/ 表/ 存储/ 开销/ ./ 上述/ 问题/ 的/ 根源/ 就/ 在于/ 整个/ 互联网/ 一体化/ 的/ 地址/ 及/ 路由/ 机制/ ,/ 这/ 导致/ 大量/ 边缘/ 网路/ 由/ 进入/ 到/ 核心网/ ,/ 使得/ 核心网/ 设备/ 不堪重负/ ./ 目前/ ,/ 学术界/ 解决/ 路由/ 可/ 扩展/ 问题/ 的/ 主流/ 思路/ 是/ 将/ 互联网/ 地址/ 分为/ 两个/ 空间/ :/ 边缘/ 网/ 和/ 核心网/ ,/ 从而/ 减少/ 核心/ 网路/ 由/ 容量/ [/ 3/ ]/ ./ 根据/ 文献/ [/ 3/ ]/ 的/ 分析/ ,/ 将/ 边缘/ 网/ 地址/ 前缀/ 从/ 核心网/ 剥离/ 后/ ,/ 整个/ 互联网/ 的/ 路由表/ 容量/ 及/ 路由/ 更新/ 频率/ 将/ 降低/ 一个/ 数量级/ ./ 地址/ 空间/ 分离/ 的/ 思想/ 最早/ 由/ 文献/ [/ 4/ ]/ 提出/ ,/ 实施/ 的/ 关键/ 是/ 建立/ 好/ 边缘/ 网/ 地址/ 与/ 核心网/ 地址/ 的/ 映射/ 模型/ ,/ 以/ 实现/ 端到/ 端/ 数据/ 在/ 核心网/ 的/ 封装/ 传输/ ./ 当前/ ,/ 典型/ 的/ 地址/ 空间/ 分离/ 模型/ ,/ 如/ LISP/ [/ 5/ ]/ 和/ APT/ [/ 6/ ]/ ,/ 都/ 是/ 基于/ 核心网/ 边界/ 路由器/ (/ ProviderEdge/ ,/ PE/ )/ 缓存/ 映射/ 项/ 机制/ 完成/ ./ 缓存/ 机制/ 最大/ 的/ 问题/ 在于/ :/ 端系统/ 用户/ 网络/ 体验/ 会/ 受到/ 较大/ 影响/ ,/ 缓存/ 机制/ 的/ 控制协议/ 开销/ 和/ PE/ 维护/ 开销/ 较大/ ,/ 实际/ 部署/ 难度/ 较大/ ./ 同时/ ,/ 对于/ 无/ 缓存/ 的/ 地址映射/ 机制/ ,/ 如/ Softwire/ [/ 7/ ]/ 中/ ,/ PE/ 需要/ 存储/ 全网/ 所有/ 映射/ 信息/ ,/ 难以承受/ ./ 本文/ 设计/ 了/ 一种/ 新型/ 的/ 面向/ 地址/ 空间/ 分离/ 网络/ 的/ 域间/ 地址映射/ 模型/ :/ AMIA/ (/ AddressMappingforInter/ -/ AS/ )/ ,/ 实现/ 全网/ 的/ 边缘/ 网/ 地址/ 与/ 核心网/ 地址/ 空间/ 分离/ ./ AMIA/ 模型/ 在/ 每个/ 自治/ 域/ 设置/ 一台/ 核心/ 映射/ 服务器/ (/ KernelMappingServer/ ,/ KMS/ )/ ,/ PE/ 只/ 与/ 本/ 自治/ 域/ 的/ KMS/ 通过/ IBGP/ 扩展/ [/ 8/ ]/ 进行/ 本/ 自治/ 域/ 映射/ 信息/ 交互/ ./ 互联网/ 端到/ 端/ 数据/ 在/ 核心网/ 的/ 传输/ 过程/ 通过/ 报文/ 封装/ 完成/ ./ AMIA/ 模型/ 信息/ 交互/ 通过/ 对/ BGP/ 协议/ 扩展/ 完成/ ,/ 映射/ 项/ 存储/ 不/ 带有/ 任何/ 缓存/ 机制/ ,/ 简单/ 易/ 实施/ ./ 而且/ ,/ 通过/ 对/ 映射/ 表/ 存储容量/ 的/ 分析/ ,/ 论证/ 了/ AMIA/ 模型/ 较/ 好/ 的/ 存储/ 性能/ ./ 本文/ 还/ 为/ AMIA/ 模型/ 设计/ 实现/ 了/ 集成/ PE/ 和/ KMS/ 功能/ 的/ 多功能/ 路由/ 系统/ MFRT/ (/ Multi/ -/ FunctionRouter/ )/ ,/ 并/ 在/ CERNET2/ 中/ 搭建/ 网络/ 进行/ 实验/ ,/ 进一步/ 验证/ 了/ AMIA/ 模型/ 高性能/ 、/ 可行性/ 及易/ 实施/ 等/ 特点/ ./ 本文/ 主要/ 贡献/ 包括/ :/ (/ 1/ )/ 设计/ 了/ 一种/ 无/ 缓存/ 机制/ 的/ 域间/ 地址映射/ 模型/ ,/ 克服/ 了/ 现有/ 典型/ 地址/ 空间/ 分离/ 模型/ 缓存/ 机制/ 对于/ 用户/ 网络/ 体验/ 影响/ 较大/ 的/ 缺点/ ;/ (/ 2/ )/ 研制/ 了/ 集成/ PE/ 和/ KMS/ 功能/ 的/ 多功能/ 路由/ 系统/ ,/ 并/ 测试/ 验证/ 了/ 其/ 高带宽/ 、/ 低/ 转发/ 时延/ 等/ 特点/ ;/ (/ 3/ )/ 基于/ VegaNet/ [/ 9/ ]/ 完成/ AMIA/ 模型/ 在/ CERNET2/ 上/ 的/ 真实/ 部署/ 并/ 正常/ 运行/ ./ 本文/ 第/ 2/ 节/ 介绍/ 地址映射/ 的/ 相关/ 研究/ 工作/ ;/ 第/ 3/ 节/ 描述/ AMIA/ 模型/ 具体/ 思想/ 和/ 映射/ 项/ 存储/ 分析/ 以及/ AMIA/ 模型/ 的/ 优劣/ 评价/ ;/ 第/ 4/ 节/ 给出/ AMIA/ 模型/ 的/ 具体实施/ 方法/ ;/ 第/ 5/ 节/ 介绍/ AMIA/ 模型/ 在/ CERNET2/ 上/ 的/ 真实/ 部署/ 实验/ 及/ 相关/ 性能/ 分析/ ;/ 第/ 6/ 节对/ 全文/ 工作/ 进行/ 总结/ ./ 2/ 相关/ 研究/ 针对/ 互联网/ 的/ Multi/ -/ homing/ 和/ 流量/ 工程/ 导致/ 的/ 核心/ 路由表/ 的/ 快速增长/ 问题/ ,/ LISP/ [/ 5/ ]/ 协议/ 提出/ 了/ 地址/ 空间/ 分离/ 模型/ ./ 它/ 将/ 互联网/ IP地址/ 分为/ 端系统/ 标识/ 域/ (/ EIDs/ )/ 和/ 路由/ 标识/ 域/ (/ RLOCs/ )/ ./ LISP/ 无需/ 对/ 主机/ 协议/ 栈/ 和/ 除/ PE/ 外/ 的/ 核心网/ 路由器/ 做/ 任何/ 修改/ ./ 数据/ 层面/ ,/ LISP/ 是/ 一个/ 简单/ 的/ 隧道/ 转发/ 机制/ ./ 核心网/ 中/ ,/ 源/ 端系统/ 所属/ 的/ PE/ 路由器/ 将/ 封装/ 报文/ 发/ 至/ 目的/ 端系统/ 所在/ 的/ PE/ 路由器/ ./ 边缘/ 网/ 和/ 核心网/ 的/ 数据/ 转发/ 过程/ 和/ 传统/ 转发/ 机制/ 一样/ ,/ 关键点/ 只是/ PE/ 路由器/ 的/ 报文/ 封装/ 和解/ 封装/ ./ 控制/ 层面/ ,/ 主要/ 是/ 指/ 映射/ 信息/ 的/ 学习/ 及/ 存储/ ,/ LISP/ 设定/ 了/ 一种/ 分布式/ 映射/ 系统/ ,/ 并/ 提供/ 了/ PUSH/ 和/ PUSH/ // PULL/ 等/ 几种/ 不同/ 的/ 映射/ 信息/ 学习/ 机制/ ./ 而且/ ,/ LISP/ 定义/ 了/ 基于/ UDP/ 的/ 新型/ 协议/ 报文/ 来/ 交互/ 映射/ 信息/ ./ 然而/ ,/ LISP/ 模型/ 中/ 映射/ 项/ 平均/ 查询/ 时间/ 高达/ 3.6/ s/ [/ 10/ ]/ ,/ 这些/ 额外/ 增加/ 的/ 访问/ 延时/ 对/ 网络/ 用户/ 影响/ 太大/ ./ LISP/ 协议/ 较为/ 复杂/ ,/ PE/ 维护/ 映射/ 信息/ 缓存/ 需要/ 较大/ 开销/ ,/ 在/ 映射/ 信息系统/ 方面/ 也/ 涉及/ 新型/ 设备/ 部署/ ,/ 真实/ 部署/ 难度/ 较大/ ./ DAN/ [/ 6/ ]/ 希望/ 将/ APT/ 设计/ 成/ 一种/ 能/ 真正/ 在/ 互联网/ 部署/ 的/ 地址/ 空间/ 分离/ 模型/ ./ APT/ 模型/ 的/ 映射/ 信息/ 获取/ 是/ 一种/ PULL/ // PUSH/ 混杂/ 模式/ ./ 数据/ 层面/ ,/ APT/ 也/ 是/ 通过/ 报文/ 封装/ 完成/ 数据/ 在/ 核心网/ 的/ 传输/ ./ 不过/ ,/ APT/ 定义/ 了/ 默认/ 映射器/ DM/ 来/ 存储/ 全部/ 映射/ 信息/ ./ PE/ 只/ 缓存/ 部分/ 最近/ 使用/ 的/ 映射/ 信息/ ,/ 对于/ 在/ 缓存/ 中/ 没有/ 找到/ 映射/ 项/ 的/ 报文/ ,/ PE/ 会/ 将/ 其/ 封装/ 发送给/ DM/ ,/ 由/ DM/ 负责/ 转发/ 到/ 对/ 端/ PE/ ./ APT/ 模型/ 中/ ,/ PE/ 和/ DM/ 对/ 映射/ 信息/ 缓存/ 的/ 维护/ 代价/ 较/ 高/ ,/ 而且/ DM/ 根据/ 转发/ 数据/ 向/ PE/ 发送/ 映射/ 项/ 的/ 机制/ 有/ 较大/ 的/ 安全/ 问题/ ,/ 容易/ 受到/ 攻击/ ./ 清华大学/ 提出/ 的/ Softwire/ [/ 7/ ]/ 架构/ ,/ 虽然/ 是/ 一种/ IPv4/ 到/ IPv6/ 的/ 过渡/ 机制/ ,/ 但/ 其/ 处理过程/ 及/ 实施/ 结果/ 却/ 和/ 地址/ 空间/ 分离/ 模型/ 极为/ 相似/ ,/ 是/ 地址映射/ 模型/ 研究/ 的/ 很/ 好/ 借鉴/ ./ Softwire/ 模型/ 中/ ,/ P/ E通/ 过/ 扩展/ 的/ BGP/ 协议/ 两/ 两/ 建立/ 邻居/ 关系/ ,/ 并/ 相互/ 传递/ 4/ ~/ 6/ 映射/ 信息/ ./ 而且/ ,/ IPv4/ 报文/ 在/ IPv6/ 网络/ 中/ 的/ 传输/ 也/ 是/ 通过/ 封装/ 机制/ 完成/ ./ Softwire/ 模型/ 的/ 不足/ 是/ PE/ 需要/ 建立/ 太多/ 的/ BGP/ 邻居/ ,/ 而且/ 尚/ 不能/ 解决/ 全网/ 跨域/ 的/ 映射/ 信息/ 交互/ ./ Page33AMIA/ 模型/ 方便/ 描述/ ,/ 定义/ 边缘/ 网/ 地址/ 前缀/ 为/ E/ _/ PFX/ ,/ 核心网/ 地址/ 为/ C/ _/ Addr/ ./ AMIA/ 模型/ 关于/ 映射/ 信息/ 存储/ 及/ 信息/ 交互/ 有/ 如下/ 基本/ 思想/ :/ (/ 1/ )/ PE/ 只/ 存储/ 本/ 自治/ 域/ 的/ 映射/ 信息/ ;/ (/ 2/ )/ KMS/ 存储/ 全网/ 所有/ 的/ 映射/ 信息/ ;/ (/ 3/ )/ PE/ 只/ 与/ 本/ 自治/ 域/ 的/ KMS/ 交互/ 映射/ 信息/ ;/ (/ 4/ )/ KMS/ 之间/ 通过/ 邻居/ 洪泛/ 模式/ 学习/ 映射/ 信息/ ./ 定义/ 1/ (/ 地址映射/ 项/ )/ ./ 地址映射/ 项/ 用于/ 描述/ 边缘/ 网/ 地址/ 前缀/ 到/ 核心网/ 地址/ 的/ 映射/ 关系/ ,/ 记/ 作/ “/ E/ _/ PFX/ →/ C/ _/ Addr/ ”/ ./ 定义/ 2/ (/ 通配/ 映射/ 项/ )/ ./ 任何/ 边缘/ 网/ 地址/ 都/ 可/ 匹配/ 的/ 映射/ 项/ 被/ 称为/ 通配/ 映射/ 项/ ,/ 记/ 作/ “/ E/ _/ PFXany/ →/ C/ _/ Addr/ ”/ ./ 假设/ 边缘/ 网是/ IPv4/ 地址/ 空间/ ,/ 则/ E/ _/ PFXany/ 就是/ 一个/ 0/ 位/ 掩码/ 的/ IPv4/ 地址/ 前缀/ ,/ 即/ 0.0/ ./ 0.0/ // 0/ ./ AMIA/ 模型/ 的/ 映射/ 信息/ 传播/ 机制/ 遵循/ 如下/ 原则/ :/ (/ 1/ )/ PE/ 与/ 本/ 自治/ 域/ 的/ KMS/ 之间/ 建立/ IBGP/ 邻居/ 关系/ ,/ 并/ 通过/ 扩展/ 的/ IBGP/ 协议/ 进行/ 映射/ 信息/ 交互/ ;/ (/ 2/ )/ KMS/ 向/ 所属/ 自治/ 域/ 的/ P/ E通/ 告该/ 域/ 所有/ 的/ 图/ 1AMIA/ 模型/ 网络拓扑/ 示例/ 以/ 映射/ 项/ “/ E/ _/ PFX1/ →/ C/ _/ Addr1/ ”/ 为例/ 解释/ 上述/ 映射/ 信息/ 传播/ 机制/ ,/ PE1/ 会/ 把/ “/ E/ _/ PFX1/ →/ C/ _/ Addr1/ ”/ 通告/ 给/ KMS1/ ,/ KMS1/ 会/ 继续/ 将/ 该/ 映射/ 项/ 转告/ 给/ PE2/ 和/ KMS2/ ./ 不过/ ,/ KMS2/ 却/ 不会/ 将/ 这种/ 域外/ 学习/ 到/ 的/ 映射/ 项/ 通告/ 给/ PE3/ ./ 映射/ 信息/ 传播/ 后/ ,/ 各/ 路由器/ 所/ 拥有/ 映射/ 信息/ 如表/ 1/ 所示/ ./ 显然/ ,/ 映射/ 信息/ 传播/ 机制/ 达到/ 了/ 既定目标/ :/ “/ PE/ 只/ 存储/ 本域/ 映射/ 信息/ ,/ KMS/ 存储/ 全网/ 映射/ 信息/ ”/ ./ 需要/ 说明/ ,/ KMS/ 生成/ 的/ 通配/ 映射/ 项/ 专为/ PE/ 服务/ ,/ 无需/ 在/ 自身/ 存储/ ./ 对于/ 跨域/ 数据通信/ ,/ PE/ 查询/ 映射/ 项/ 必定/ 匹配/ 通配/ 映射/ 项/ ,/ 映射/ 项/ ,/ 即/ 映射/ 项/ 的/ E/ _/ PFX/ 和/ C/ _/ Addr/ 都/ 属于/ 该域/ ;/ (/ 3/ )/ KMS/ 向/ 所属/ 自治/ 域/ 的/ 每个/ P/ E通/ 告/ 一条/ 通配/ 映射/ 项/ ,/ 通配/ 映射/ 项/ 的/ C/ _/ Addr/ 为/ KMS/ 的/ 地址/ ;/ (/ 4/ )/ PE/ 之间/ 不/ 进行/ 映射/ 信息/ 交互/ ;/ (/ 5/ )/ 相邻/ 自治/ 域/ 的/ KMS/ 之间/ 会/ 建立/ EBGP/ 邻居/ 关系/ ,/ 并/ 通过/ 扩展/ 的/ EBGP/ 协议/ 交互/ 映射/ 信息/ ;/ (/ 6/ )/ KMS/ 之间/ 相互/ 传递/ 各自/ 拥有/ 的/ 全部/ 映射/ 信息/ ,/ 保证/ 映射/ 信息/ 在/ 不同/ 自治/ 域/ 的/ KMS/ 间/ 逐个/ 传递/ ./ 根据/ 图/ 1/ 所示/ 拓扑/ ,/ 通过/ PE1/ ~/ PE3/ 和/ KMS1/ ~/ KMS2/ 分析/ AMIA/ 模型/ 的/ 映射/ 信息/ 传播/ 过程/ ./ 令/ PE1/ 、/ PE2/ 、/ PE3/ 核心网/ 地址/ 分别/ 为/ C/ _/ Addr1/ 、/ C/ _/ Addr2/ 、/ C/ _/ Addr3/ ,/ 它们/ 连接/ 了/ 边缘/ 网/ 主机/ H1/ 、/ H2/ 、/ H3/ ,/ 各/ 主机/ 所属/ 的/ 地址/ 前缀/ 分别/ 为/ E/ _/ PFX1/ 、/ E/ _/ PFX2/ 、/ E/ _/ PFX3/ ./ 令/ KMS1/ 和/ KMS2/ 的/ 核心网/ 地址/ 为/ C/ _/ Addr4/ 和/ C/ _/ Addr5/ ./ P/ E通/ 过/ 边缘/ 网路/ 由/ 协议/ 获得/ 该/ 边缘/ 网路/ 由/ 信息/ ,/ 并/ 针对/ 每个/ 路由/ 前缀/ 生成/ 一条/ “/ 边缘/ 网/ 地址/ 前缀/ 到/ 核心网/ 地址/ ”/ 的/ 本地/ 映射/ 项/ ./ 其中/ ,/ PE1/ 会/ 生成/ 主机/ H1/ 所属/ 边缘/ 网/ 地址/ 前缀/ 的/ 映射/ 项/ :/ E/ _/ PFX1/ →/ C/ _/ Addr1/ ./ 同理/ ,/ PE2/ 和/ PE3/ 也/ 会/ 生成/ 本地/ 映射/ 项/ :/ E/ _/ PFX2/ →/ C/ _/ Addr2/ 和/ E/ _/ PFX3/ →/ C/ _/ Addr3/ ./ 并/ 将/ 报文/ 转/ 交给/ KMS/ 处理/ ./ 角色/ PE1E/ _/ PFX1/ →/ C/ _/ Addr1/ 、/ E/ _/ PFX2/ →/ C/ _/ Addr2/ 、/ PE2E/ _/ PFX1/ →/ C/ _/ Addr1/ 、/ E/ _/ PFX2/ →/ C/ _/ Addr2/ 、/ PE3E/ _/ PFX3/ →/ C/ _/ Addr3/ 、/ E/ _/ PFXany/ →/ C/ _/ Addr5KMS1E/ _/ PFX1/ →/ C/ _/ Addr1/ 、/ E/ _/ PFX2/ →/ C/ _/ Addr2/ 、/ KMS2E/ _/ PFX1/ →/ C/ _/ Addr1/ 、/ E/ _/ PFX2/ →/ C/ _/ Addr2/ 、/ Page4AMIA/ 模型/ 中/ ,/ 报文/ 转发/ 过程/ 分为/ 两种/ 情况/ :/ 域/ 内/ 通信/ 和域/ 间通信/ ./ 域/ 内/ 通信/ 是/ 指/ 通信/ 两端/ 在/ 同一/ 自治/ 域/ 的/ 不同/ 边缘/ 网/ ,/ 转发/ 过程/ 中/ 发送/ 端/ 所属/ PE/ 路由器/ 完成/ 报文/ 的/ 封装/ ,/ 接收端/ 所属/ PE/ 路由器/ 进行/ 解/ 封装/ ./ 域/ 间通信/ 是/ 指/ 通信/ 两端/ 分属/ 不同/ 自治/ 域/ ,/ 由于/ PE/ 路由器/ 没有/ 全网/ 的/ 地址映射/ 信息/ ,/ 需要/ KMS/ 路由器/ 作/ 转发/ 跳板/ ,/ 转发/ 过程/ 会/ 出现/ 两次/ 报文/ 封装/ 和解/ 封装/ ./ 发送/ 端/ 主机/ 所属/ PE/ 路由器/ 完成/ 报文/ 的/ 第一次/ 封装/ ,/ 报文/ 送到/ 源端/ 所在/ 自治/ 域/ 的/ KMS/ 路由器/ 进行/ 第一次/ 解/ 封装/ ;/ 接着/ ,/ 仍/ 是/ 这台/ KMS/ 路由器/ 进行/ 第二次/ 封装/ ,/ 报文/ 送到/ 目的/ 端/ 所属/ PE/ 路由器/ 进行/ 第二次/ 解/ 封装/ ./ PE/ 或/ KMS/ 进行/ 报文/ 封装/ 时/ ,/ 根据/ 报文/ 边缘/ 网/ 目的/ 地址/ 进行/ 映射/ 表/ 匹配/ ,/ 当有/ 多条/ 映射/ 项/ 的/ E/ _/ PFX/ 与/ 该/ 地址/ 匹配/ 时/ ,/ 选择/ E/ _/ PFX/ 前缀/ 长度/ 最长/ 的/ 映射/ 项/ 作为/ 匹配/ 结果/ ./ 继续/ 以图/ 1/ 所示/ 拓扑/ 及表/ 1/ 所述/ 映射/ 表为/ 依据/ 介绍/ 地址/ 空间/ 分离/ 网络/ 中/ 报文/ 转发/ 过程/ ./ 首先/ 分析/ H1/ 到/ H2/ 的/ 域/ 内/ 通信/ 过程/ ,/ 转发/ 步骤/ 如下/ :/ 1/ ./ H1/ 发送/ 原始/ 报文/ ,/ 源地址/ 为/ H1/ ,/ 目的/ 地址/ 为/ H2/ ;/ 2/ ./ 报文/ 到达/ PE1/ (/ 路由/ 所致/ ,/ PE1/ 会/ 向/ 边缘/ 网/ 发布/ 默认/ 路由/ )/ ,/ PE1/ 根据/ 报文/ 目的/ 地址/ H2/ 查询/ 映射/ 表/ ,/ 匹配/ 映射/ 项/ “/ E/ _/ PFX2/ →/ C/ _/ Addr2/ ”/ ;/ 3/ ./ PE1/ 对/ 原始/ 报文/ 进行/ 封装/ ,/ 封装/ 报头/ 源地址/ 为/ C/ _/ Addr1/ ,/ 目的/ 地址/ 为/ C/ _/ Addr2/ ,/ PE1/ 发出/ 封装/ 报文/ ;/ PE2/ 将/ 原始/ 报文/ 送达/ 目的/ 主机/ H2/ ./ 4/ ./ PE2/ 收到/ 封装/ 报文/ 并/ 进行/ 解/ 封装/ ,/ 得到/ 原始/ 报文/ ,/ H2/ 到/ H1/ 的/ 反向/ 通信/ 过程/ 与/ 上述/ 步骤/ 类似/ ,/ 是/ 它/ 的/ 逆/ 过程/ ./ H1/ 和/ H2/ 的/ 双向/ 域/ 内/ 通信/ 过程/ 如图/ 2/ 所示/ ./ 骤/ 如下/ :/ 接着/ ,/ 分析/ H1/ 到/ H3/ 的/ 域/ 间通信/ 过程/ ,/ 转发/ 步/ 1/ ./ H1/ 发送/ 原始/ 报文/ ,/ 源地址/ 为/ H1/ ,/ 目的/ 地址/ 为/ H3/ ;/ 2/ ./ 报文/ 到达/ PE1/ ,/ PE1/ 根据/ 报文/ 目的/ 地址/ H3/ 查询/ 映射/ 表/ ,/ 匹配/ 通配/ 映射/ 项/ “/ E/ _/ PFXany/ →/ C/ _/ Addr4/ ”/ ;/ 3/ ./ PE1/ 对/ 原始/ 报文/ 进行/ 封装/ ,/ 封装/ 报头/ 源地址/ 为/ C/ _/ Addr1/ ,/ 目的/ 地址/ 为/ C/ _/ Addr4/ ,/ PE1/ 发出/ 封装/ 报文/ ;/ 4/ ./ KMS1/ 收到/ 封装/ 报文/ 并/ 进行/ 解/ 封装/ ,/ 得到/ 原始/ 报文/ ;/ KMS1/ 继续/ 根据/ 报文/ 目的/ 地址/ H3/ 查询/ 映射/ 表/ ,/ 匹配/ 通配/ 映射/ 项/ “/ E/ _/ PFX3/ →/ C/ _/ Addr3/ ”/ ;/ 5/ ./ KMS1/ 对/ 原始/ 报文/ 进行/ 封装/ ,/ 封装/ 报头/ 源地址/ 为/ C/ _/ Addr4/ ,/ 目的/ 地址/ 为/ C/ _/ Addr3/ ,/ KMS1/ 发出/ 封装/ 报文/ ;/ PE3/ 将/ 原始/ 报文/ 送达/ 目的/ 主机/ H3/ ./ 6/ ./ PE3/ 收到/ 封装/ 报文/ 并/ 进行/ 解/ 封装/ ,/ 得到/ 原始/ 报文/ ,/ 需要/ 注意/ ,/ H3/ 到/ H1/ 的/ 反向/ 通信/ 过程/ 中/ ,/ 封装/ // 解/ 封装/ 的/ 实施/ 点/ 并/ 不同于/ 上述/ 步骤/ ./ 其中/ ,/ PE3/ 进行/ 第一次/ 封装/ ,/ KMS2/ 进行/ 第一次/ 解/ 封装/ ,/ 并/ 继续/ 第二次/ 封装/ 发送给/ PE1/ ,/ 由/ PE1/ 完成/ 第二次/ 解/ 封装/ ./ H1/ 和/ H3/ 的/ 域/ 间通信/ 过程/ 如图/ 3/ 所示/ ./ AMIA/ 模型/ 中/ ,/ 每/ 一个/ KMS/ 设备/ 需要/ 负责/ 所属/ 域/ 端系统/ 的/ 所有/ 域间/ 流量/ 的/ 转发/ ,/ 负载/ 较/ 重/ ,/ 需要/ 部署/ 处理/ 能力/ 较强/ 的/ 高性能/ 网关/ 设备/ 充当/ KMS/ ./ 当然/ ,/ 我们/ 还/ 可以/ 通过/ 在/ 一个/ 域/ 中/ 部署/ 多个/ KMS/ 进行/ 负载/ 分摊/ ./ 负载/ 策略/ 可/ 简单/ 根据/ 地址/ 前/ 若干/ 比特/ 位/ 不同/ 实施/ 流量/ 分摊/ ,/ 本文/ 不/ 做/ 详细/ 阐述/ ./ 3.1/ 映射/ 项/ 存储/ 分析/ 映射/ 项/ 存储/ 分析/ 有表/ 2/ 定义/ 的/ 评价/ 参数/ ./ 高端/ 路由器/ 的/ 存储资源/ 紧缺/ ,/ 主要/ 针对/ 数据/ 层转/ 发表/ 项/ 的/ 存储/ ,/ 涉及/ TCAM/ 和/ SRAM/ 等/ 芯片/ ./ 地址/ 空间/ 分离/ 模型/ 的/ 映射/ 表项/ 也/ 需/ 占用/ 上述/ 资源/ ,/ 所以/ 本/ 节/ 分析/ AMIA/ 模型/ 在/ 数据/ 层/ 的/ 硬件/ 存储/ 消耗/ ./ 现有/ 非/ 缓存/ 方式/ 的/ 映射/ 地址/ 模型/ 主要/ 有/ Softwire/ [/ 7/ ]/ 涉及/ 的/ PE/ 全/ 存储/ 模型/ CSPE/ (/ CompleteStorageonPE/ )/ ./ 全网/ 的/ 映射/ 表/ 项数/ 为/ 所有/ 自治/ 域/ 映射/ 项/ 总和/ :/ i/ =/ 1/ ∑/ Ei/ ∑/ sPi/ (/ j/ )/ ./ 在/ CSPE/ 模型/ 中/ ,/ 所有/ PE/ 路由器/ 转发/ 模块/ 都/ 要/ 存储/ 其它/ PE/ 产生/ 的/ 映射/ 项/ ,/ 本地/ 产生/ 的/ 映射/ 项/ 无需/ 在/ 自身/ 数据/ 层/ 存储/ ./ 全网/ 的/ PE/ 路由器/ 数量/ 为/ ∑/ s/ 射项/ 总和/ TCSPE/ 满足/ 式/ (/ 1/ )/ ./ j/ =/ 1TCSPE/ =/ ∑/ sPage5/ 参数/ // 变量/ s/ 全网/ 自治/ 域/ 数量/ Ei/ 第/ i/ 个/ 自治/ 域/ 中/ 边缘/ 网/ 数量/ (/ PE/ 个数/ )/ Ea/ 平均/ 每个/ 自治/ 域/ 中/ 边缘/ 网/ 数量/ (/ PE/ 个数/ )/ Pi/ (/ j/ )/ 第/ i/ 个/ 自治/ 域/ 中/ 第/ j/ 个/ 边缘/ 网/ 生成/ 的/ 前缀/ 路由/ 数/ Pa/ 平均/ 每个/ 边缘/ 网/ 生成/ 的/ 前缀/ 路由/ 数/ PEi/ (/ j/ )/ 第/ i/ 个/ 自治/ 域/ 中/ 第/ j/ 个/ PETCSPECSPE/ 模型/ 全网/ 存储/ 的/ 映射/ 项数/ TAMIAAMIA/ 模型/ 全网/ 存储/ 的/ 映射/ 项数/ 便于/ 分析/ ,/ 对/ 自治/ 域/ 中/ 边缘/ 网数/ 和/ 边缘/ 网路/ 由数取/ 平均值/ 分析/ ,/ 则/ TCSPE/ 满足/ 式/ (/ 2/ )/ ./ j/ =/ 1AMIA/ 模型/ 中/ ,/ 全网/ 映射/ 表/ 项数/ 仍然/ 是/ i/ =/ 1/ ∑/ Ei/ ∑/ sPi/ (/ j/ )/ ,/ 但/ 只有/ KMS/ 存储/ 全网/ 映射/ 项/ ./ 所以/ ,/ s/ 个/ 自治/ 域/ 的/ s/ 个/ KMS/ 存储/ 的/ 映射/ 项/ 总数/ 为/ i/ =/ 1/ ∑/ Eis/ ×/ ∑/ s/ ∑/ EiPi/ (/ j/ )/ ,/ 每个/ PE/ 的/ 数据/ 层/ 只/ 存储/ 本域/ 其它/ PE/ 产/ j/ =/ 1/ 生/ 的/ 映射/ 项/ 以及/ 一条/ 由/ KMS/ 发布/ 的/ 通配/ 映射/ 项/ ./ 即/ PEi/ (/ k/ )/ 存储/ 的/ 映射/ 项/ :/ j/ =/ 1/ 所以/ ,/ 第/ i/ 个/ 自治/ 域/ 中/ Ei/ 个/ PE/ 总共/ 存储/ 的/ 映射/ 表/ 项数/ 为/ (/ Ei/ -/ 1/ )/ ×/ ∑/ Ei/ 存储/ 的/ 映射/ 表/ 项数/ 为/ ∑/ s/ 所以/ ,/ AMIA/ 模型/ 全网/ 所有/ 路由器/ 存储/ 的/ 映射/ 项/ 总和/ TAMIA/ 满足/ 式/ (/ 4/ )/ ,/ 包括/ PE/ 和/ KMS/ 的/ 存储/ 映射/ 项/ ./ TAMIA/ =/ ∑/ s/ 便于/ 分析/ ,/ 对/ 自治/ 域/ 中/ 边缘/ 网数/ 和/ 边缘/ 网路/ 由数取/ 平均值/ 分析/ ,/ 则/ AMIA/ 模型/ 存储/ 的/ 映射/ 项/ 总和/ TAMIA/ 满足/ 式/ (/ 5/ )/ ./ TAMIA/ =/ s/ ×/ Ea/ ×/ (/ Ea/ -/ 1/ )/ ×/ Pa/ +/ s/ ×/ Ea/ +/ s2/ ×/ Ea/ ×/ Pa/ =/ s/ ×/ E2a/ ×/ Pa/ +/ s2/ ×/ Ea/ ×/ Pa/ +/ s/ ×/ Ea/ -/ s/ ×/ Ea/ ×/ Pa/ 继而/ 分析/ AMIA/ 模型/ 和/ CSPE/ 模型/ 的/ 存储/ 映射/ 项/ 的/ 差值/ ,/ 见式/ (/ 6/ )/ ./ TCSPE/ -/ TAMIA/ =/ (/ s2/ ×/ E2a/ ×/ Pa/ -/ s/ ×/ Ea/ ×/ Pa/ )/ -/ (/ s/ ×/ E2a/ ×/ Pa/ +/ s2/ ×/ Ea/ ×/ Pa/ +/ s/ ×/ Ea/ -/ s/ ×/ Ea/ ×/ Pa/ )/ =/ (/ s/ ×/ Ea/ -/ s/ -/ Ea/ )/ ×/ (/ s/ ×/ Ea/ ×/ Pa/ )/ -/ s/ ×/ Ea/ =/ (/ (/ s/ ×/ Ea/ -/ s/ -/ Ea/ )/ ×/ Pa/ -/ 1/ )/ ×/ (/ s/ ×/ Ea/ )/ (/ 6/ )/ 从式/ (/ 6/ )/ 可以/ 看出/ ,/ 只要/ s/ 、/ Ea/ 两个/ 参数/ 大于/ 2/ ,/ 式/ (/ 6/ )/ 就/ 为/ 正值/ ./ 而且/ ,/ 式/ 中/ 3/ 个/ 参数/ 的/ 值/ 越/ 大/ ,/ 式/ (/ 6/ )/ 差值/ 越大/ ./ 显然/ ,/ 真实/ 互联网/ 中/ s/ 和/ Ea/ 都/ 远大于/ 2/ ,/ 所以/ AMIA/ 较之/ CSPE/ 模型/ 在/ 映射/ 项/ 存储/ 数量/ 上/ 有/ 很大/ 的/ 减少/ ./ 由于/ 一个/ 边缘/ 网/ 产生/ 的/ 路由/ 数/ 一般/ 为/ 1/ 或/ 2/ ,/ 图/ 4/ 给出/ 了/ 针对/ 平均/ 边缘/ 网路/ 由数/ 为/ 1/ 和/ 2/ 以及/ 自治/ 域数/ 分别/ 为/ 10/ 和/ 100/ 时/ ,/ 两种/ 模型/ 在/ 不同/ 边缘/ 网/ 数量/ 情况/ 下/ 需要/ 存储/ 映射/ 项数/ 的/ 分析/ ./ 显然/ ,/ 无论/ 针对/ 哪/ 种/ 情形/ ,/ AMIA/ 模型/ 全网/ 需要/ 存储/ 的/ 映射/ 项数/ 都/ 要/ 远远/ 少于/ CSPE/ 模型/ ,/ 有/ 较/ 好/ 的/ 存储/ 性能/ ./ 3.2/ AMIA/ 模型/ 性能/ 评价/ 相对/ 现有/ 其它/ 方案/ ,/ AMIA/ 模型/ 在/ 映射/ 项/ 存储/ 性能/ 、/ 控制协议/ 、/ 表项/ 维护/ 、/ 端系统/ 用户/ 体验/ 、/ 网络安全/ 等/ 方面/ 都/ 有/ 了/ 较大/ 的/ 改善/ ,/ 并/ 容易/ 在/ 真实/ 网络/ 实施/ ,/ 其/ 付出/ 的/ 代价/ 只是/ 少量/ 的/ 冗余/ 转发/ 路径/ ./ 下面/ 从/ 不同/ 角度/ 对/ AMIA/ 模型/ 与/ 其它/ 方案/ 进行/ 具体/ 比较/ 分析/ ,/ 并/ 有表/ 3/ 所述/ 总结/ ./ (/ 1/ )/ 映射/ 项/ 存储/ 性能/ ./ 由于/ 一个/ 边缘/ 网/ 一天/ 的/ 目的/ 地址/ 访问/ 数/ 一般/ 高达/ 106/ 级别/ [/ 10/ ]/ ,/ 所以/ 缓存/ 映射/ 项/ 的/ 模型/ (/ 如/ LISP/ 和/ APT/ )/ 若想/ 达到/ 较/ 好/ 的/ 转发/ 效果/ ,/ 在/ PE/ 端/ 需要/ 维护/ 一个/ 容量/ 较大/ 的/ 映射/ 项缓/ Page6/ 模型/ 存储/ APT/ 一般/ 复杂/ 达到/ 小有/ (/ 少量/ )/ 较差/ LISP/ 一般/ 非常复杂/ 无法/ CSPE/ 差/ 简单/ 达到/ 小/ AMIA/ 好/ 简单/ 达到/ 小存/ ./ 对于/ AMIA/ 模型/ ,/ 由于/ 一个/ 边缘/ 网/ 产生/ 的/ 路由/ 数/ 通常/ 为/ 1/ ~/ 2/ 条/ ,/ 而/ 平均/ 一个/ 自治/ 域/ 的/ 边缘/ 网数/ 不/ 超过/ 100/ ./ 所以/ ,/ 根据/ 式/ (/ 3/ )/ 可得/ AMIA/ 模型/ PE/ 的/ 映射/ 项/ 存储量/ 不/ 超过/ 200/ ./ 由于/ LISP/ 或/ APT/ 都/ 会/ 为/ 每个/ 自治/ 域/ 部署/ 至少/ 一个/ 存储/ 全网/ 映射/ 项/ 的/ 映射/ 服务器/ ,/ 等效于/ AMIA/ 模型/ 中/ 的/ KMS/ 映射/ 项/ 存储/ ,/ 所以/ AMIA/ 模型/ 在/ 映射/ 项/ 存储/ 总量/ 上/ 也/ 少于/ LISP/ 或/ APT/ ./ 结合/ 3.1/ 节/ ,/ 可知/ CSPE/ 的/ 映射/ 项/ 存储/ 性能/ 较差/ ./ 所以/ ,/ AMIA/ 模型/ 在/ 映射/ 项/ 全网/ 存储/ 或/ 平均/ 每个/ PE/ 存储/ 等/ 方面/ ,/ 都/ 具有/ 最好/ 的/ 存储/ 性能/ ./ (/ 2/ )/ 控制协议/ 及/ 表项/ 维护/ ./ AMIA/ 模型/ 和/ CSPE/ 模型/ 都/ 是/ 通过/ 对/ BGP/ 协议/ 扩展/ 完成/ 映射/ 信息/ 的/ 传递/ ,/ 功能/ 简单/ 易/ 实施/ ./ APT/ 模型/ 中/ DM/ 间/ 的/ 信息/ 交互/ 通过/ 一种/ 新型/ 的/ 类似/ OSPF/ 的/ 洪泛/ 协议/ 完成/ ,/ 而且/ DM/ 向/ P/ E通/ 告/ 映射/ 信息/ 过程/ 需要/ 有/ 抑制/ 机制/ ,/ 控制协议/ 较为/ 复杂/ ./ LISP/ 为/ 映射/ 信息/ 交互/ 设计/ 了/ 一种/ 全新/ 的/ 控制协议/ ,/ 而且/ LISP/ 有/ 多种/ 映射/ 信息/ 存储/ 模式/ 和/ 获取/ 机制/ ,/ 协议/ 极为/ 复杂/ ,/ 难以/ 被/ 广泛/ 接受/ ./ 对于/ 数据/ 层/ 映射/ 项/ 维护/ ,/ AMIA/ 模型/ 和/ CSPE/ 模型/ 与/ 现有/ 单播/ 转/ 发表/ 维护/ 类似/ ,/ 完全/ 根据/ 控制/ 层/ 协议/ 的/ 指示/ 进行/ 表项/ 增/ 、/ 删/ 、/ 改/ ./ 相对而言/ ,/ LISP/ 和/ APT/ 由于/ 采用/ 映射/ 项/ 缓存/ 机制/ ,/ 需要/ 根据/ 数据/ 转发/ 过程/ 中/ 映射/ 项/ 命中/ 频率/ 等/ 参数/ 对/ 缓存/ 进行/ 维护/ ,/ 较为/ 复杂/ ./ (/ 3/ )/ 线速/ 转发/ ./ LISP/ 模型/ 中/ ,/ 当/ PE/ 缓存/ 没有/ 待/ 转发/ 报文/ 所/ 需/ 的/ 映射/ 项时/ ,/ 需要/ 数据/ 层/ 通告/ 控制/ 层/ 发送/ 映射/ 信息/ 请求/ 并/ 等待/ 回应/ ./ 也就是说/ ,/ LISP/ 模型/ 中/ PE/ 数据/ 层/ 无法/ 为/ 所有/ 数据/ 提供/ 线速/ 转发/ 支持/ ./ AMIA/ 、/ CSPE/ 和/ APT/ 等/ 模型/ 都/ 是/ 通过/ 查询/ 映射/ 项/ 进行/ 报文/ 封装/ 来/ 完成/ 数据/ 在/ 核心网/ 的/ 传输/ ,/ 根据/ 本文/ 第/ 5/ 节/ 的/ 实验/ ,/ 说明/ 都/ 能/ 达到/ 线速/ 转发/ ./ 然而/ ,/ APT/ 模型/ 中/ DM/ 数据/ 层/ 在/ 对/ 封装/ 报文/ 重新/ 封装/ 并/ 转发/ 的/ 同时/ ,/ 需要/ 向/ 控制/ 层/ 提交/ 相关/ 信息/ ,/ 使/ 其/ 向/ 报文/ 源端/ PE/ 发送/ 映射/ 信息/ ./ 这种/ 数据/ 层/ 对/ 控制/ 层/ 的/ 反向/ 影响/ ,/ 需要/ 设备/ 在/ 硬件/ 数据/ 层/ 付出/ 较大/ 的/ 逻辑/ 处理/ 开销/ ./ (/ 4/ )/ 通信/ 时延/ ./ 数据/ 封装/ 及解/ 封装/ 会/ 给/ 转发/ 增加/ μ/ s/ 级/ 的/ 设备/ 转发/ 时延/ ,/ 但/ 这/ 对/ 端/ 到/ 端/ 路径/ 转发/ 时延/ 来说/ 可/ 忽略不计/ ./ CSPE/ 没有/ 任何/ 转发/ 路径/ 冗余/ ./ AMIA/ 和/ APT/ 可能/ 出现/ 转发/ 路径/ 冗余/ ,/ 但/ 只会/ 发生/ 在/ 一个/ 自治/ 域/ 内部/ ,/ 发生/ 在域/ 内/ 的/ 转发/ 路径/ 冗余/ 带来/ 的/ 通信/ 时延/ 较/ 小/ ,/ 端/ 用户/ 不易/ 感知/ ./ 而且/ ,/ 可以/ 通过/ 对/ KMS/ 和/ DM/ 优化/ 部署/ 来/ 减少/ 或/ 完全/ 规避/ 这种/ 额外/ 时延/ ./ 然而/ ,/ LISP/ 模型/ 中/ 类似/ DNS/ 的/ 映射/ 信息/ 查询/ ,/ 在/ 每个/ 连接/ 初始/ 流量/ 的/ 数据/ 转发/ 时/ ,/ 会/ 给/ 端/ 用户/ 带来/ 明显/ 的/ 时延/ ./ (/ 5/ )/ 路径/ 冗余/ ./ 路径/ 冗余/ 是/ 指/ 地址/ 空间/ 分离/ 网络/ 中端/ 到/ 端的/ 转发/ 路径/ 与/ 传统/ 路由/ 转发/ 路径/ 相比/ ,/ 是否/ 在/ 转发/ 跳数/ 上/ 有所增加/ ./ LISP/ 和/ APT/ 模型/ 在/ PE/ 没有/ 缓存/ 所/ 需/ 的/ 映射/ 项时/ ,/ 都/ 会/ 产生/ 转发/ 路径/ 冗余/ ,/ 反之/ 则/ 不会/ 有/ 路径/ 冗余/ ./ AMIA/ 模型/ 中/ ,/ 对于/ 自治/ 域/ 内部/ 端到/ 端/ 通信/ 没有/ 任何/ 转发/ 路径/ 冗余/ ,/ 对域/ 间通信/ 可能/ 产生/ 转发/ 路径/ 冗余/ ./ 不过/ ,/ 可以/ 将/ KMS/ 部署/ 在/ 自治/ 域/ 出口/ 来/ 减小/ 甚至/ 消除/ AMIA/ 模型/ 的/ 转发/ 路径/ 冗余/ ./ CSPE/ 模型/ 针对/ 所有/ 通信/ 都/ 不会/ 产生/ 转发/ 路径/ 冗余/ ,/ 但/ 这/ 是/ 以/ PE/ 存储/ 全网/ 映射/ 项/ 作为/ 代价/ ./ (/ 6/ )/ 网络安全/ ./ 本文/ 主要/ 考虑/ 用户/ 通过/ 发送/ 目的/ 地址/ 无法/ 命中/ 映射/ 表/ 的/ 攻击/ 报文/ 给/ 网络/ 带来/ 的/ 破坏性/ 结果/ ,/ 如/ 带宽/ 消耗/ 、/ 产生/ 无效/ 映射/ 信息/ 交互/ 等/ ./ CSPE/ 模型/ 防御/ 攻击能力/ 最好/ ,/ PE/ 拥有/ 全部/ 映射/ 信息/ ,/ 一旦/ PE/ 查询/ 映射/ 表/ 失败/ 则/ 立刻/ 丢弃/ 报文/ ./ AMIA/ 模型/ 和/ APT/ 模型/ 中/ ,/ 每个/ PE/ 都/ 有/ 通配/ 映射/ 项/ ,/ 攻击/ 报文/ 在/ PE/ 中会/ 匹配/ 通配/ 映射/ 项/ 转发/ 到/ KMS/ ,/ 浪费/ 了/ 网络带宽/ ./ 当然/ ,/ AMIA/ 模型/ 的/ 攻击/ 报文/ 最终/ 会/ 在/ KMS/ 中因/ 映射/ 表/ 匹配/ 失败/ 而/ 丢弃/ ./ 不过/ ,/ APT/ 中/ DM/ 会/ 根据/ 报文/ 回送/ 映射/ 信息/ 的/ RE/ -/ PLY/ 报文/ ,/ 使得/ PE/ 缓存/ 无效/ 表项/ ,/ 造成/ 无效/ 存储/ ./ LISP/ 防范/ 能力/ 最差/ ,/ 收到/ 攻击/ 报文/ 会/ 使/ PE/ 与/ 映射/ 系统/ 通信/ 并/ 缓存/ 无效/ 表项/ ,/ 大量/ 攻击/ 报文/ 易/ 导致/ PE/ 拒绝服务/ ./ 4AMIA/ 模型/ 实现/ 设计/ 本文/ 以/ 边缘/ 网为/ IPv4/ 地址/ 空间/ ,/ 核心网/ 为/ IPv6/ 地址/ 空间/ 为例/ ,/ 研究/ AMIA/ 模型/ 的/ 实现/ 机制/ ./ AMIA/ 模型/ 需要/ 在/ 每个/ 自治/ 域/ 设置/ 一台/ 高性能/ 路由器/ 作为/ KMS/ ,/ 并/ 让/ KMS/ 和/ 本域/ PE/ 之间/ 以及/ 相邻/ 域/ 的/ KMS/ 之间/ 建立/ 带有/ 扩展/ 能力/ 的/ IPv6BGP/ 邻居/ 关系/ ./ 传统/ IPv6BGP/ 连接/ 用来/ 传播/ IPv6/ 地址/ 前缀/ 和/ IPv6/ 下/ 一/ 跳/ 信息/ ,/ 而/ AMIA/ 模型/ 需要/ 对/ BGP/ 进行/ 扩展/ ,/ 使/ 其/ 能够/ 携带/ “/ E/ _/ PFX/ →/ C/ _/ Addr/ ”/ 映射/ 信息/ ./ 本文/ 实例/ 中/ ,/ E/ _/ PFX/ 是/ IPv4/ 地址/ 前缀/ ,/ C/ _/ Addr/ 是/ IPv6/ 地址/ ./ BGP/ 扩展/ 主要/ 包括/ 两/ 方面/ :/ Page7/ (/ 1/ )/ 扩展/ 能力/ 协商/ ./ AMIA/ 模型/ 利用/ OPEN/ 报文/ 的/ 可选/ 参数/ “/ OptionalParameters/ ”/ 描述/ BGP/ 实例/ 的/ 映射/ 信息/ 交互/ 能力/ ,/ 双方/ 都/ 有/ 扩展/ 能力/ 的/ 邻居/ 才能/ 收发/ 映射/ 信息/ ;/ (/ 2/ )/ 映射/ 信息/ 通告/ ./ 利用/ UPDATE/ 报文/ 的/ 路径/ 属性/ “/ PathAttributes/ ”/ 描述/ 通告/ 或/ 撤消/ 通告/ 的/ IPv4/ 地址/ 前缀/ 信息/ [/ 8/ ]/ ./ 除了/ 通配/ 映射/ 项由/ KMS/ 直接/ 发布/ ,/ 普通/ 映射/ 信息/ 总是/ 在/ PE/ 路由器/ 上/ 产生/ ,/ 并/ 通告/ 给/ 本域/ 的/ KMS/ ,/ 由/ KMS/ 向外/ 发布/ ./ PE/ 中/ 映射/ 信息/ 是/ 由/ IPv4/ 路由/ 管理/ 将/ IPv4/ 前缀/ 通告/ 给/ IPv6BGP/ 模块/ 生成/ ./ 考虑/ 实施/ 的/ 高效性/ ,/ 映射/ 信息/ 集成/ 在/ IPv4/ 转/ 发表/ 中/ 存储/ ./ 地址映射/ 项/ 区别/ 于/ 普通/ IPv4/ 转发/ 项之处/ 包括/ :/ (/ 1/ )/ 映射/ 项/ 转发/ 标志/ 位/ “/ M/ ”/ ;/ (/ 2/ )/ 下/ 一/ 跳/ 是/ IPv6/ 地址/ ./ 集成/ PE/ 和/ KMS/ 功能/ 的/ 多功能/ 路由/ 系统/ MFRT/ 功能/ 结构/ 如图/ 5/ 所示/ ,/ 下面/ 根据/ 重要/ 事件/ 处理过程/ 描述/ 该/ 设备/ 的/ 功能/ 特征/ ./ (/ 1/ )/ 学习/ 到/ IPv4/ 路由/ ./ 该/ 事件/ 发生/ 在/ PE/ ,/ 系统/ 学习/ 到/ IPv4/ 路由/ ./ 一方面/ ,/ 按/ 传统模式/ 处理/ ,/ 生成/ IPv4/ 转发/ 项/ ./ 另一方面/ ,/ 路由/ 管理/ 将/ IPv4/ 路由/ 前缀/ 通告/ IPv6BGP/ 模块/ 生成/ 映射/ 信息/ ,/ 继而/ 向/ 它/ 的/ KMS/ 邻居/ 发送/ ./ (/ 2/ )/ 学习/ 到/ IPv6/ 路由/ ./ 该/ 事件/ 发生/ 在/ PE/ 或/ KMS/ 设备/ 上/ ,/ 完全/ 按照/ 传统模式/ 处理/ ,/ 生成/ IPv6/ 转/ 发表/ 项/ ./ (/ 3/ )/ 学习/ 到/ 4/ ~/ 6/ 映射/ 信息/ ./ 4/ ~/ 6/ 映射/ 信息/ 是/ 通过/ 扩展/ BGP/ 学习/ ,/ 该/ 事件/ 可能/ 发生/ 在/ PE/ 或/ KMS/ ./ ①/ 若/ PE/ 收到/ 4/ ~/ 6/ 映射/ 信息/ ,/ 对端/ BGP/ 邻居/ 肯定/ 是/ 本域/ 的/ KMS/ ,/ PE/ 将/ 映射/ 信息/ 存储/ 于/ IPv4/ 转/ 发表/ 并/ 设置/ 标志/ 位/ “/ M/ ”/ ,/ 不再/ 向外/ 通告/ ./ ②/ 若/ 是/ KMS/ 收到/ 4/ ~/ 6/ 映射/ 信息/ ,/ 首先/ 将/ 映射/ 信/ 存储/ 于/ IPv4/ 转/ 发表/ 并/ 设置/ 标志/ 位/ “/ M/ ”/ ,/ 并/ 向/ 其它/ KMS/ 邻居/ 通告/ ./ 另外/ ,/ KMS/ 还/ 需/ 确定/ 是否/ 将/ 收到/ 的/ 映射/ 信息/ 向/ 本域/ PE/ 广播/ ./ 分析/ 对端/ 邻居/ 角色/ ,/ 如果/ 是/ PE/ 发来/ 的/ 本域/ 映射/ 信息/ ,/ 则/ 需向/ 本域/ 其它/ PE/ 邻居/ 通告/ ./ 相反/ ,/ 如果/ 是/ KMS/ 邻居/ 发来/ 的/ 其它/ 域/ 映射/ 信息/ ,/ 则/ 无需/ 向/ 本域/ 的/ PE/ 邻居/ 发送/ ./ (/ 4/ )/ 收到/ IPv4/ 报文/ ./ 一般/ 发生/ 在/ PE/ ./ 根据/ 最长/ 前缀/ 匹配/ 原则/ 查询/ IPv4/ 转/ 发表/ ,/ 若查/ 得/ 普通/ IPv4/ 转发/ 项则/ 按/ 传统模式/ 转发/ 报文/ ./ 若查/ 得/ 转发/ 项/ 具有/ 封装/ 标志/ “/ M/ ”/ ,/ 则/ 说明/ 匹配/ 的/ 是/ 一条/ 映射/ 项/ ,/ 需要/ 进行/ IPv6/ 封装/ ,/ 封装/ 后/ 进行/ IPv6/ 转/ 发表/ 查询/ ,/ 并/ 按/ IPv6/ 查询/ 结果/ 发送/ 报文/ ./ 具体/ 过程/ 参见/ 图/ 6/ ./ (/ 5/ )/ 收到/ IPv6/ 报文/ ./ 事件/ 可能/ 发生/ 在/ PE/ 或/ KMS/ ./ 查询/ IPv6/ 转/ 发表/ ,/ 若/ 报文/ 目的/ 地址/ 不是/ 本地/ 地址/ 则/ 正常/ 转发/ ./ 否则/ ,/ 分析/ 其/ 是否/ 封装/ 报文/ ./ 对于/ 非/ 封装/ 报文/ ,/ 则/ 按/ 传统模式/ 本/ 机/ 接收/ ./ 对于/ 封装/ 报文/ ,/ 解/ 封装/ 得到/ 内层/ IPv4/ 报文/ ,/ 并/ 进行/ IPv4/ 转发/ 处理/ ./ 后续/ IPv4/ 报文/ 处理过程/ 和/ 上述/ 功能/ 特征/ (/ 4/ )/ 一样/ ,/ 具体/ 参见/ 图/ 6.5/ 实验/ 及/ 性能/ 分析/ 本文/ 基于/ VegaNet/ 虚拟/ 路由器/ [/ 9/ ]/ ,/ 按照/ 第/ 4/ 节/ 所述/ 机制/ ,/ 设计/ 实现/ 了/ MFRT/ 原型/ 系统/ ./ VegaNet/ 是/ 一种/ 为/ 网络/ 研究/ 提供/ 真实/ 实验/ 环境/ 以及/ 对/ 核心/ 网络/ 进行/ 模拟/ 分析/ 的/ 高性能/ 虚拟/ 网络/ ,/ 它/ 基于/ CER/ -/ NET2/ 的/ 实施/ 能/ 提供/ 一个/ 接近/ 于/ 真实/ 网络/ 状况/ 的/ 网络/ 实验/ 环境/ ,/ 并/ 能/ 灵活/ 支持/ 对/ 核心/ 网络/ 的/ 模拟/ 分析/ ./ VegaNet/ 的/ 核心/ 设备/ —/ —/ —/ 虚拟/ 路由器/ ,/ 基于/ 真正/ 的/ 商业/ 路由/ 平台/ 实现/ ,/ 支持/ 高带宽/ 的/ 虚拟/ 网络流量/ ./ 首先/ ,/ 在/ 实验室/ 通过/ 测试仪/ 对/ PE/ 及/ KMS/ 转发/ 性能/ 进行/ 测试/ ./ IXIA/ 测试仪/ 的/ 两个/ 千兆/ 接口/ 分别/ 连接/ MFRT/ 的/ 千兆/ 接口/ ./ 测试仪/ 从/ 一个/ 接口/ 发包/ ,/ 通过/ MFRT/ 系统/ 转发/ ,/ 从/ 另/ 一/ 接口/ 接收/ 报文/ ./ MFRT/ 被/ 测试/ 的/ 转发/ 模式/ 包括/ :/ 模式/ 1/ ,/ 对/ IPv4/ 报文/ 进行/ IPv6/ 封装/ 再/ 转发/ ;/ 模式/ 2/ ,/ 对/ IPv4inIPv6/ 封装/ 报/ 文解/ 封装/ 再/ 转发/ ;/ 模式/ 3/ ,/ 对/ IPv4inIPv6/ 封装/ 报/ 文解/ 封装/ 再/ 二次/ 封装/ 并/ 转发/ ./ 测试仪/ 发送/ 64Bytes/ ~/ 1478Bytes/ 随机/ 大小/ 报文/ ,/ 测试/ 结果/ 如图/ 7/ 所示/ ./ 统计/ 3/ 种/ 转发/ 模式/ 平均/ 转发/ 能力/ 分别/ 为/ 798Mbps/ 、/ 910Mbps/ 、/ 895Mbps/ ./ 由于/ 转发/ 性能/ 是/ 针/ Page8/ 对/ 设备/ 接收/ 报文/ 统计/ ,/ 而/ 模式/ 1/ 是/ 对/ 原始/ IPv4/ 报文/ 进行/ 封装/ 后/ 转发/ ,/ 转发/ 过程/ 增加/ 了/ 报文/ 大小/ ./ 考虑/ 任何/ 地址/ 空间/ 分离/ 模型/ 都/ 要/ 付出/ 的/ 封装/ 代价/ ,/ 说明/ 支持/ AMIA/ 模型/ 的/ MFRT/ 系统/ 各种/ 转发/ 模式/ 基本/ 都/ 能/ 达到/ 线速/ 转发/ 能力/ ./ 接着/ ,/ 继续/ 基于/ 上述/ 测试环境/ 分析/ 单台/ MFRT/ 设备/ 的/ 转发/ 时延/ ./ IXIA/ 测试仪/ 通过/ 一个/ 接口/ 发送/ 不同/ 字节/ 大小/ 的/ 报文/ ,/ 并/ 在/ 另/ 一/ 接口/ 收包/ 以/ 获取/ MFRT/ 的/ 报文/ 转发/ 时延/ ,/ 测试/ 分别/ 针对/ 普通/ IPv4/ 转发/ 、/ 普通/ IPv6/ 转发/ 和/ AMIA/ 模型/ 封装/ 转发/ 进行/ ./ 针对/ 不同/ 大小/ 报文/ 的/ MFRT/ 转发/ 时延/ 如图/ 8/ 所示/ ,/ 相对/ 于/ 普通/ 的/ IPv4/ 和/ IPv6/ 转发/ ,/ AMIA/ 模型/ 的/ 数据/ 转发/ 时延/ 会/ 略有/ 增加/ ,/ 但/ 最高/ 约/ 为/ 80/ μ/ s/ ./ 微秒/ 级/ 的/ 设备/ 转发/ 时延/ 对于/ 端到/ 端/ 通信/ 至少/ 毫秒/ 级/ 的/ 路径/ 传输/ 时延/ 可以/ 忽略/ ,/ 所以/ MFRT/ 的/ 报文/ 处理/ 不会/ 增加/ 网络应用/ 的/ 额外/ 延迟/ ./ 其次/ ,/ 本文/ 利用/ 现有/ VegaNet/ 完成/ 了/ AMIA/ 模型/ 基于/ CERNET2/ 的/ 真实/ 部署/ ,/ 通过/ 8/ 个/ 虚拟/ 路由器/ 在/ CERNET2/ 构建/ 了/ 如图/ 9/ 所示/ 的/ 实验/ 拓扑/ ./ 实验/ 网由/ 两个/ AS/ 组成/ ,/ 每个/ AS/ 包括/ 4/ 台/ 虚拟/ 路由器/ ,/ D/ 、/ E/ 分别/ 充当/ 两个/ AS/ 的/ KMS/ 路由器/ ,/ 其它/ 6/ 台/ 设备/ 的/ 角色/ 为/ PE/ ./ 另外/ ,/ 有/ 4/ 台/ 主机/ 分别/ 下/ 连/ 在/ 4/ 个/ PE/ 的/ 边缘/ 网中/ ./ 图/ 9/ 中/ 椭圆/ 范围/ 内/ 接口/ 配置/ IPv6/ 地址/ ,/ 椭圆/ 外部/ 接口/ 配置/ IPv4/ 地址/ ,/ 即/ 主机/ 和/ 与/ 之/ 相连/ 路由器/ 的/ 接口/ 为/ IPv4/ 地址/ ,/ 其它/ 均/ 为/ IPv6/ 地址/ ./ 所有/ 虚拟/ 路由器/ 都/ 按照/ 本文/ 的/ AMIA/ 模型/ 实现/ ,/ 并/ 按/ 图/ 9/ 中/ 连线/ 建立/ BGP/ 邻居/ 关系/ ./ 实验/ 中/ ,/ PE/ 上/ 配置/ IPv4/ 静态/ 路由/ 生成/ 本地/ 映射/ 表项/ 并/ 向/ 外/ 通告/ ./ 分析/ PE/ 上/ 配置/ 不同/ 数量/ 的/ 静态/ 路由/ 时/ ,/ 全网/ 存储/ 的/ 映射/ 项/ 数量/ 和/ PE/ 平均/ 存储/ 的/ 映射/ 项/ 数量/ ./ 接着/ ,/ 按照/ 图/ 10/ 所示/ 将/ KMS/ 撤除/ ,/ 其它/ 6/ 个/ PE/ 进行/ BGP/ 全/ 连接/ ,/ 按/ CSPE/ 模型/ 进行/ 映射/ 信息/ 交互/ ,/ 同样/ 分析/ 相关/ 映射/ 项/ 存储/ ./ 实验/ 结果/ 如图/ 11/ 所示/ ,/ 无论/ PE/ 平均/ 存储/ 映射/ 项数/ 还是/ 全网/ 映射/ 项/ 存储/ 数/ ,/ AMIA/ 模型/ 相对/ CSPE/ 模型/ 均/ 有/ 减少/ ./ 结合/ 3.2/ 节/ 分析/ 可知/ ,/ 这种/ 差异/ 随/ 网络/ 规模/ 增大/ 越为/ 明显/ ./ 最后/ ,/ 在/ 图/ 9/ 中/ 主机/ 间/ 进行/ 了/ 多种/ IPv4/ 应用/ 测试/ :/ PING/ 、/ FTP/ 、/ WEB/ 等/ 常用/ 网络应用/ 程序/ ,/ 各项/ 测试/ 均/ 能/ 正常/ 完成/ ,/ 说明/ 了/ AMIA/ 模型/ 的/ 功能/ 可用性/ ./ 6/ 总结/ 现有/ 地址/ 空间/ 分离/ 模型/ 尚存/ 许多/ 不足/ :/ 控制协议/ 复杂/ 、/ 映射/ 项/ 缓存/ 机制/ 需要/ 较大/ 的/ 缓存/ 维护/ 开销/ 、/ 影响/ 端系统/ 网络/ 用户/ 的/ 网络/ 体验/ 等/ ./ 本文/ 设计/ 了/ 一种/ 新型/ 的/ 面向/ 地址/ 空间/ 分离/ 网络/ 的/ 域间/ 地址映射/ 模型/ :/ AMIA/ ,/ 它/ 以/ 少量/ 冗余/ 转发/ 路径/ 为/ 代价/ 实现/ 互联网/ 边缘/ 网/ 地址/ 和/ 核心网/ 地址/ 的/ 空间/ 分离/ ./ AMIA/ 通/ Page9/ 过/ BGP/ 协议/ 扩展/ 完成/ 映射/ 信息/ 的/ 交互/ ,/ 通过/ 隧道/ 封装/ 完成/ 边缘/ 网/ 分组/ 在/ 核心网/ 的/ 传输/ ./ AMIA/ 模型/ 无需/ 任何/ 缓存/ 机制/ ,/ 并且/ 具有/ 很/ 好/ 的/ 映射/ 项/ 存储/ 性能/ ./ 它/ 的/ 映射/ 信息/ 交互/ 关系/ 简单/ 易/ 实施/ ,/ 具有/ 很/ 好/ 的/ 网络攻击/ 防范/ 能力/ ./ AMIA/ 模型/ 区别/ 于/ 其它/ 相关/ 模型/ 的/ 另/ 一/ 贡献/ 还/ 在于/ 它/ 不会/ 影响/ 端到/ 端/ 用户/ 的/ 网络/ 体验/ ./ 本文/ 基于/ VegaNet/ 虚拟/ 路由器/ ,/ 设计/ 并/ 研制/ 了/ 集成/ AMIA/ 模型/ 多种/ 角色/ 功能/ 的/ 多功能/ 路由/ 系统/ MFRT/ ./ 实验/ 表明/ ,/ 多功能/ 路由/ 系统/ 在/ 实施/ AMIA/ 模型/ 数据/ 转发/ 时能/ 达到/ 线速/ 处理/ 及/ 最高/ 80/ μ/ s/ 的/ 转发/ 时延/ ./ AMIA/ 模型/ 基于/ CERNET2/ 进行/ 了/ 实验/ 网/ 部署/ ,/ 通过/ 实验/ 网/ 的/ 运行/ 及/ 相关/ 实验/ ,/ 进一步/ 验证/ 了/ AMIA/ 模型/ 的/ 高效/ 存储/ 性能/ 及/ 功能/ 可用性/ ./ 致谢/ 本/ 论文/ 工作/ 在/ 清华大学/ 完成/ ,/ 感谢/ 清华大学/ 网络/ 研究所/ 的/ 支持/ !/ 

