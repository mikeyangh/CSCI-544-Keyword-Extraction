Page1/ 一种/ 列/ 存储/ 数据仓库/ 中/ 的/ 数据/ 复用/ 策略/ 王梅/ 周娇玲/ 乐嘉锦/ (/ 东华大学/ 计算机科学/ 与/ 技术/ 学院/ 上海/ 201620/ )/ 摘要/ 数据/ 复用/ 是/ 数据仓库/ 管理/ 中/ 节约/ 存储空间/ 、/ 提高/ 查询/ 效率/ 的/ 重要/ 手段/ ./ 列/ 存储技术/ 将/ 来自/ 同一/ 属性/ 的/ 数据/ 连续/ 存储/ ,/ 极大地提高/ 了/ 数据仓库/ 等/ 分析/ 型/ 应用软件/ 的/ 性能/ ,/ 同时/ 增加/ 了/ 复用/ 的/ 可行性/ 和/ 灵活性/ ./ 为此/ ,/ 提出/ 了/ 一种/ 列/ 存储/ 数据仓库/ 中/ 的/ 数据/ 复用/ 策略/ ./ 首先/ ,/ 利用/ 模式匹配/ 技术/ 发掘/ 候选/ 可/ 复用/ 列/ ,/ 排除/ 大量/ 无法/ 复用/ 的/ 数据/ 列/ ,/ 在/ 此基础/ 上/ 对/ 候选/ 可/ 复用/ 数据/ 进行/ 筛选/ 和/ 过滤/ ,/ 大大降低/ 复用/ 数据/ 检测/ 的/ 复杂度/ ./ 针对/ 确定/ 的/ 可/ 复用/ 数据/ ,/ 提出/ 了/ 基于/ 列/ 存储/ 的/ 复用/ 实现/ 策略/ ,/ 分别/ 给出/ 了/ 原始数据/ 列/ 、/ 压缩/ 数据/ 列及/ 索引/ 数据/ 列/ 的/ 复用/ 实现/ 方法/ ./ 最后/ 提出/ 了/ 基于/ 复用/ 数据/ 的/ 查询/ 实现/ 技术/ ./ 在/ 大规模/ 数据仓库/ 基准/ 数据/ 集上/ 的/ 实验/ 结果/ 验证/ 了/ 数据/ 复用/ 策略/ 在/ 减少/ 存储量/ 、/ 节省/ 数据/ 装载/ 时间/ 及/ 提升/ 查询/ 性能/ 方面/ 的/ 有效性/ ./ 关键词/ 数据/ 复用/ ;/ 数据仓库/ ;/ 列/ 存储/ ;/ 模式匹配/ ;/ 可/ 复用/ 数据/ 1/ 引言/ 随着/ 社会/ 信息化/ 不断/ 推进/ ,/ 目前/ 数字/ 信息量/ 呈/ Page2/ 传统/ 数据仓库/ 底层/ 存储/ 结构/ 大都/ 采用/ 行/ 存储/ 方式/ ,/ 将/ 每条/ 记录/ 作为/ 一个/ 整体/ 顺序存储/ 在/ 介质/ 中/ ./ 由于/ 不同/ 数据/ 集/ 的/ 数据/ 模式/ 间/ 存在/ 差异/ ,/ 很难/ 找到/ 两条/ 完全相同/ 的/ 记录/ ,/ 因此/ 在/ 存储/ 层次/ 上/ 原始数据/ 的/ 重复/ 率不高/ ,/ 不/ 易于/ 复用/ ./ 目前/ ,/ 行/ 存储/ 中/ 往往/ 考虑/ 基于/ 视图/ 或/ 查询/ 产生/ 的/ 中间/ 结果/ 的/ 复用/ ./ 通过/ 重用/ 连接/ 、/ 投影/ 、/ 分组/ 等/ 复杂/ 处理/ 的/ 中间/ 结果/ ,/ 满足/ 及时/ 响应/ 用户/ 查询/ 和/ 联机/ 分析/ 处理/ 等/ 应用/ 的/ 要求/ ./ 这种/ 策略/ 虽然/ 能/ 在/ 一定/ 程度/ 上/ 改善/ 查询/ 效率/ ,/ 但/ 由于/ 分析/ 型/ 数据/ 应用/ 中/ 包含/ 海量/ 数据/ ,/ 查询/ 执行/ 过程/ 中/ 产生/ 的/ 可/ 被/ 重复/ 访问/ 的/ 中间/ 结果/ 也/ 具有/ “/ 海量/ ”/ 特点/ ,/ 在/ 缓冲区/ 有限/ 的/ 情况/ 下/ ,/ 极易/ 发生/ 内存/ 争用/ 问题/ [/ 1/ ]/ ./ 由此/ 产生/ 的/ 重用/ 度/ 估计/ 、/ 额外/ 的/ 缓冲区/ 调度/ 策略/ 等/ 都/ 会/ 影响/ 复用/ 的/ 性能/ ./ 另一方面/ ,/ 查询/ 结果/ 的/ 重用/ 主要/ 针对/ 同一/ 数据/ 集/ ,/ 对于/ 多个/ 数据/ 集/ 的/ 数据/ 复用/ 问题/ 并未/ 过多/ 考虑/ ./ 相较/ 于行/ 存储/ ,/ 列/ 存储技术/ 在/ 物理/ 上将/ 关系/ 中/ 的/ 元组/ 按/ 属性/ 拆分/ ,/ 来自/ 同一/ 属性/ 的/ 数据/ 连续/ 存储/ ./ 这种/ 存储/ 方式/ 极大地提高/ 了/ 分析/ 型/ 查询/ 的/ 效率/ [/ 2/ ]/ ./ 由于/ 列/ 存储/ 在/ 分析/ 型/ 应用/ 中/ 的/ 卓越/ 性能/ ,/ 近年来/ 针对/ 列/ 存储/ 数据仓库/ 的/ 研究/ 引起/ 了/ 人们/ 广泛/ 的/ 兴趣/ ./ 不同/ 的/ 表/ 模式/ ,/ 或者说/ 现实/ 世界/ 的/ 不同/ 实体/ ,/ 往往/ 具有/ 相同/ 的/ 属性/ ,/ 反映/ 在/ 列/ 存储/ 中/ 就是/ 相同/ 或/ 相近/ 的/ 列/ ./ 因此/ 列/ 存储/ 中/ 数据/ 的/ 冗余度/ 更高/ ./ 另外/ ,/ 传统/ 行/ 存储/ 在/ 查询/ 执行/ 时/ 每次/ 选取/ 关系/ 中/ 一个/ 完整/ 的/ 元组/ 进行/ 运算/ ./ 此时/ 重用/ 的/ 粒度/ 是/ 一/ 整行/ 或/ 投影/ 后/ 的/ 可用/ 列/ ,/ 匹配/ 条件/ 更/ 严格/ ,/ 重用/ 代价/ 较/ 高/ ./ 反之/ 列/ 存储/ 查询/ 执行/ 以/ 包含/ 部分/ 同列/ 数据/ 的/ 块/ 作为/ 操作/ 对象/ ,/ 增加/ 了/ 复用/ 的/ 可行性/ 和/ 灵活性/ ./ 然而/ ,/ 相/ 比较/ 行/ 存储/ ,/ 列/ 存储/ 数据仓库/ 还/ 不/ 太/ 成熟/ ,/ 对/ 其/ 复用技术/ 的/ 研究/ 仍/ 较/ 少/ ,/ 部分/ 现有/ 工作/ 仍旧/ 关注/ 于/ 同一/ 数据/ 集中/ 的/ 物化/ 视图/ 及/ 查询/ 的/ 中间/ 结果/ ,/ 针对/ 不同/ 数据/ 集/ 的/ 数据/ 冗余/ 在/ 存储/ 层面/ 上/ 的/ 有效/ 数据/ 复用/ 策略/ 并/ 不多见/ ./ 重复/ 数据/ ,/ 如/ 产品/ 信息/ 、/ 客户/ 信息/ 、/ 地理信息/ 、/ 日期/ 信息/ 等/ ./ 数据/ 复用技术/ 充分利用/ 重复/ 数据/ 之间/ 的/ 关系/ ,/ 减少/ 系统/ 存储量/ 、/ 缩短/ 用户/ 响应/ 时间/ ,/ 已/ 成为/ 数据仓库/ 管理/ 的/ 重要/ 研究/ 内容/ ./ 针对/ 上述/ 问题/ ,/ 本文/ 提出/ 了/ 一种/ 列/ 存储/ 数据仓库/ 中/ 的/ 数据/ 复用/ 策略/ ./ 首先/ ,/ 利用/ 模式匹配/ 技术/ 发掘/ 候选/ 的/ 可/ 复用/ 列/ ,/ 排除/ 大量/ 无法/ 复用/ 的/ 数据/ 列/ ,/ 大大/ 缩小/ 复用/ 数据/ 的/ 检测/ 空间/ 和/ 复杂度/ ;/ 进而/ 根据/ 复用/ 的/ 条件/ 对/ 候选/ 可/ 复用/ 列/ 进行/ 筛选/ 和/ 过滤/ ,/ 得到/ 确定/ 的/ 可/ 复用/ 数据/ ;/ 针对/ 上述/ 数据/ ,/ 提出/ 了/ 基于/ 列/ 存储/ 的/ 复用/ 实现/ 策略/ ,/ 分别/ 给出/ 了/ 原始数据/ 列/ 、/ 压缩/ 数据/ 列及/ 索引/ 数据/ 列/ 的/ 复用/ 实现/ 方法/ ;/ 并/ 在/ 此基础/ 上/ 给出/ 基于/ 复用/ 数据/ 的/ 查询/ 实现/ 过程/ ./ 最后/ 在/ 大规模/ 数据仓库/ 基准/ 数据/ 集/ TPCH/ ①/ 和/ SSB/ ②/ 上/ 进行/ 实验/ ,/ 验证/ 本文/ 所提/ 策略/ 在/ 减少/ 存储量/ 、/ 节省/ 数据/ 装载/ 时间/ 及/ 提升/ 查询/ 性能/ 方面/ 的/ 有效性/ ./ 本文/ 第/ 2/ 节/ 介绍/ 本文/ 相关/ 工作/ ;/ 第/ 3/ 节/ 介绍/ 相关/ 定义/ 和/ 符号/ ;/ 第/ 4/ 节/ 详细/ 介绍/ 本文/ 提出/ 的/ 复用/ 策略/ ,/ 包括/ 复用/ 数据/ 的/ 检测/ 、/ 基于/ 列/ 存储/ 的/ 复用/ 实现/ 以及/ 复用/ 数据/ 上/ 的/ 查询/ 实现/ ;/ 第/ 5/ 节/ 给出/ 本文/ 所述/ 方法/ 的/ 实验/ 验证/ ;/ 最后/ 是/ 总结/ 和/ 展望/ ./ 2/ 相关/ 工作/ 2.1/ 数据/ 复用/ 数据/ 复用/ (/ datareuse/ )/ 又称/ 数据/ 重用/ ./ 早期/ 的/ 数据/ 复用技术/ 主要/ 为/ 硬件/ 存储/ 服务/ ,/ 通过/ 重复使用/ 访问/ 频率/ 较/ 高/ 的/ 数据/ 节约/ 内存/ 消耗/ ./ 20/ 世纪/ 90/ 年代/ 以来/ ,/ 随着/ 人们/ 对/ 缓存/ 查询/ 结果/ 的/ 广泛/ 研究/ ,/ 数据/ 复用/ 逐渐/ 应用/ 于/ 传统/ 行/ 存储/ 数据仓库/ 中/ ,/ 其/ 复用/ 对象/ 主要/ 是/ 物化/ 视图/ 及/ 查询/ 的/ 中间/ 结果/ ./ 近几年/ ,/ 对/ 物化/ 视图/ 的/ 研究/ 着重/ 围绕/ 视图/ 的/ 选择/ 、/ 维护/ 而/ 进行/ ./ 常见/ 的/ FPUS/ [/ 3/ ]/ 算法/ 通过/ 计算/ 单位/ 存储空间/ 视图/ 的/ 查询/ 频率/ ,/ 每次/ 物化/ 查询/ 频率/ 最高/ 的/ 视图/ ./ MVPP/ [/ 4/ ]/ 算法/ 比较/ 每个/ 视图/ 的/ 代价/ 和/ 增益/ ,/ 并/ 利用/ 贪心/ 算法/ 选择/ 具有/ 最小/ 代价/ 的/ 多/ 查询/ 优化/ ./ 对于/ 内存/ 中/ 中间/ 结果/ 的/ 复用/ ,/ 早期/ 仅限于/ 一些/ 特定/ 查询/ 的/ 中间/ 结果/ 复用/ ./ 随后/ Roy/ 等/ 人/ 提出/ 了/ 查询/ 自动/ 缓存/ 系统/ Exchequer/ ③/ ./ 该/ 系统/ 引入/ 缓存/ 管理/ 和/ 优化/ 机制/ ,/ 可以/ 自动/ 重用/ 任意/ 查询/ 的/ 中间/ 结果/ ./ Markl/ 等/ 人/ [/ 5/ ]/ 提出/ 了/ POP/ 方法/ ,/ 进一步/ 通过/ 重/ 优化/ 查询处理/ 保证/ 中间/ 结果/ 能够/ 更好/ 地被/ 重用/ ./ 列/ 存储技术/ 在/ 物理/ 上以/ 列为/ 单位/ 进行/ 存储/ ,/ 在/ 查询/ 过程/ 中/ 只/ 需/ 读入/ 查询/ 相关/ 列/ ,/ 从而/ 极大地提高/ 了/ 分析/ 型/ 查询/ 的/ 效率/ ,/ 同时/ 列/ 存储/ 对/ 复杂/ 查询/ 的/ 灵活/ 快速/ 响应/ 及/ 为/ 压缩/ 带来/ 的/ 存储/ 优势/ 也/ 使/ 其/ 在/ 数据仓库/ 方面/ 具有/ 良好/ 的/ 发展前景/ ,/ 代表性/ 系统/ 包括/ MonetDB/ // X100/ [/ 6/ ]/ 、/ C/ -/ Store/ [/ 7/ ]/ 等/ ./ 在/ 列/ 存储/ 的/ 基础/ 上/ ,/ Ivanova/ 等/ 人/ [/ 8/ ]/ 提出/ 了/ 中间/ 结果/ 的/ 重用/ 策略/ ,/ 主/ ①/ ②/ ③/ Page3/ 要/ 关注/ 多/ 查询/ 计划/ 间/ 的/ 中间/ 结果/ 重用/ ./ 然而/ 相对/ 于/ 单一/ 查询/ 计划/ ,/ 多/ 查询/ 计划/ 间/ 差异/ 较大/ ,/ 重用/ 性不高/ ./ 后来/ ,/ 张琦等/ 人/ [/ 9/ ]/ 针对/ 列/ 存储/ 数据仓库/ ,/ 提出/ 了/ 单一/ 查询/ 计划/ 执行/ 过程/ 中/ 的/ 中间/ 结果/ 重用/ 策略/ ./ 该/ 策略/ 根据/ 模型/ 估计/ 的/ 结果/ 执行/ 缓冲区/ 调度/ 算法/ ,/ 使/ 产生/ 的/ 中间/ 结果/ 能够/ 更好/ 地被/ 重用/ ,/ 以/ 提升/ 查询/ 性能/ ./ 可以/ 看到/ ,/ 目前/ 对列/ 存储/ 数据仓库/ 中/ 数据/ 复用/ 的/ 研究/ 仍/ 关注/ 于/ 同一/ 数据/ 集中/ 的/ 物化/ 视图/ 及/ 查询/ 的/ 中间/ 结果/ ,/ 针对/ 不同/ 数据/ 集/ 的/ 数据/ 冗余/ 在/ 存储/ 层面/ 上/ 的/ 有效/ 数据/ 复用/ 策略/ 并/ 不多见/ ./ 2.2/ 模式匹配/ 系统/ 模式匹配/ [/ 10/ ]/ 被/ 广泛/ 用于/ 多/ 数据源/ 集成/ 时/ 在/ 两个/ 或/ 多个/ 模式/ 元素/ 之间/ 产生/ 映射/ 关系/ ,/ 使得/ 数据/ 集成/ 后/ 能够/ 在/ 统一/ 的/ 模式/ 下/ 进行/ 查询/ 和/ 分析/ ./ 模式匹配/ 方法/ 目前/ 存在/ 较/ 多/ 的/ 研究成果/ ,/ 按照/ 匹配/ 内容/ 的/ 不同/ 可/ 分为/ 元素/ 自身/ 信息/ 、/ 模式/ 结构/ 信息/ 和/ 数据/ 实例/ 信息/ 3/ 种/ 类型/ ./ 早期/ 对/ 模式匹配/ 的/ 研究/ 大多/ 基于/ 元素/ 自身/ 信息/ ,/ 如/ COMA/ [/ 11/ ]/ 方法/ ,/ 但/ 该/ 方法/ 只能/ 发掘/ 11/ 匹配/ 且/ 需要/ 多次/ 扫描/ 整个/ 模式/ ,/ 时间/ 复杂度/ 高/ ./ 模式/ 中/ 元素/ 间/ 的/ 相互/ 关系/ 构成/ 了/ 模式/ 的/ 结构/ 信息/ ./ 常用/ 的/ SF/ [/ 12/ ]/ 方法/ 和/ Cupid/ [/ 13/ ]/ 方法/ 均/ 利用/ 模式/ 结构/ 信息/ 来/ 辅助/ 匹配/ ./ 然而/ ,/ 如果/ 模式/ 中/ 定义/ 的/ 结构/ 信息/ 不够/ 丰富/ (/ 如/ 关系数据库/ 中/ 结构/ 信息/ 仅为/ 元素/ 间/ 的/ 主外键/ 关系/ )/ ,/ 就/ 会/ 对/ 匹配/ 准确度/ 产生/ 一定/ 的/ 影响/ ./ 数据/ 实例/ 信息/ 是/ 模式/ 描述/ 的/ 对象/ ,/ 能够/ 最/ 真实/ 地/ 反映/ 元素/ 的/ 信息/ ./ 目前/ 已经/ 有/ 很多/ 模式匹配/ 方法/ 利用/ 数据/ 实例/ 信息/ 提高/ 匹配/ 的/ 准确度/ ,/ 比较/ 典型/ 的/ 有/ iMAP/ [/ 14/ ]/ 方法/ ./ 它/ 利用/ 不同/ 类型/ 的/ 搜索器/ 搜索/ 候选/ 匹配/ ,/ 然后/ 选取/ 相似/ 度值/ 最高/ 的/ 元素/ 作为/ 最终/ 匹配/ ./ iMAP/ 可以/ 很/ 好/ 地/ 发掘/ 1/ :/ 1/ 匹配/ 和/ 复杂/ 匹配/ ,/ 但/ 由于/ 每个/ 搜索/ 程序/ 都/ 要/ 对/ 所有/ 的/ 候选/ 匹配/ 进行/ 检索/ ,/ 导致/ 需要/ 检索/ 的/ 候选/ 匹配/ 规模/ 太/ 大/ ,/ 影响/ 匹配/ 效率/ ./ 随后/ 在/ iMAP/ 基础/ 上/ 提出/ 的/ CM/ [/ 15/ ]/ 方法/ ,/ 通过/ 预处理/ 过滤/ 掉/ 部分/ 不合理/ 的/ 候选/ 匹配/ ,/ 在/ 一定/ 程度/ 上/ 缩小/ 了/ 候选/ 匹配/ 空间/ ./ 3/ 基本/ 定义/ 和/ 符号/ 定义/ 1/ ./ 数据仓库/ ./ 给定/ 数据仓库/ D/ =/ {/ S1/ ,/ S2/ ,/ …/ ,/ Sn/ }/ ,/ 由/ 一系列/ 相互/ 关联/ 的/ 物理/ 表/ 构成/ ,/ 其中/ S/ 表示/ 关系/ 表/ ,/ n/ 表示/ 关系/ 的/ 数量/ ./ 定义/ 2/ ./ 关系/ 表/ ./ 关系/ 表/ Si/ =/ {/ Ai1/ ,/ Ai2/ ,/ …/ ,/ Aim/ }/ ,/ 其中/ m/ 表示/ 关系/ Si/ 的/ 目的/ 度/ ,/ Aij/ 表示/ Si/ 中/ 第/ j/ 个/ 属性/ ./ 定义/ 3/ ./ 数据/ 段/ ./ 列/ 存储/ 中/ ,/ 任意/ 一列/ Ai/ 中/ 的/ 数据/ 在/ 逻辑/ 上/ 对应/ 一个/ 数据/ 段/ Segi/ ∈/ Seg/ ,/ 其中/ Seg/ 是/ 所有/ 数据/ 段/ 的/ 集合/ ./ 每个/ 数据/ 段/ 由/ 一系列/ 连续/ 的/ 数据/ 块/ 构成/ ./ 若/ blk/ 表示/ 数据/ 块/ ,/ r/ 表示/ 块/ 的/ 总数/ ,/ 则/ 第/ i/ 个/ 数据/ 段/ Segi/ =/ {/ blki1/ ,/ blki2/ ,/ …/ ,/ blkir/ }/ ./ 定义/ 4/ ./ 目标/ 表/ ./ 等待/ 被/ 装载/ 到/ D/ 中/ 的/ 关系/ 表/ 定义/ 为/ 目标/ 表/ T/ ,/ 其中/ T/ =/ {/ A1/ ,/ A2/ ,/ …/ ,/ Ak/ }/ ,/ k/ 表示/ T/ 的/ 目的/ 度/ ./ Ai/ ,/ 在/ D/ 中/ 寻找/ 可/ 复用/ 数据/ 并/ 合理/ 利用/ 的/ 过程/ ./ 定义/ 5/ ./ 数据/ 复用/ ./ 对于/ T/ 中/ 的/ 每/ 一个/ 属性/ 定义/ 6/ ./ 源/ 属性/ 集/ ./ D/ 已有/ 的/ 关系/ 表中/ 能够/ 被/ 复用/ 的/ 属性/ 集合/ 记为源/ 属性/ 集/ Cols/ ,/ Cols/ =/ {/ Ai1/ ,/ Ai2/ ,/ …/ ,/ Aij/ }/ ,/ 集合/ 中/ 的/ 每一项/ 称为/ 源/ 属性/ ./ 定义/ 7/ ./ 目标/ 属性/ 集/ ./ 目标/ 表/ T/ 中/ 能够/ 复用/ 源/ 属性/ 的/ 属性/ 集合/ 记/ 为/ 目标/ 属性/ 集/ Colt/ ,/ Colt/ =/ {/ A1/ ,/ A2/ ,/ …/ ,/ Aj/ }/ ,/ 其中/ Ai/ 又/ 称为/ 目标/ 属性/ ./ 4/ 复用/ 策略/ 4.1/ 复用/ 分类/ 针对/ 不同/ 的/ 应用/ 需求/ ,/ 数据/ 复用/ 有/ 多种/ 分类/ 标准/ ./ 我们/ 主要/ 考虑/ 基于/ 属性/ 基数/ 的/ 复用/ 标准/ ./ 属性/ 基数/ 是/ 指/ 参与/ 复用/ 的/ 属性/ 数目/ ./ 根据/ 属性/ 基数/ ,/ 可以/ 将/ 数据/ 复用/ 分为/ 11/ 复用/ 和/ 复杂/ 复用/ ./ 与/ 11/ 复用/ 不同/ 的/ 是/ ,/ 复杂/ 复用/ 要求/ 参与/ 复用/ 的/ 对象/ 不仅仅/ 是/ 源/ 属性/ 集/ 和/ 目标/ 属性/ 集中/ 的/ 某个/ 属性/ ,/ 至少/ 有/ 一个/ 属性/ 组/ ./ 4.2/ 复用/ 数据/ 的/ 检测/ 模型/ 复用/ 数据/ 的/ 检测/ 是/ 数据/ 复用/ 的/ 关键环节/ ,/ 它/ 直接/ 关系/ 到/ 能否/ 找到/ 可/ 重用/ 数据/ 以及/ 如何/ 根据/ 数据/ 之间/ 的/ 映射/ 关系/ 设计/ 复用/ 算法/ ./ 复用/ 数据/ 的/ 检测/ 主要/ 分为/ 两个/ 步骤/ :/ (/ 1/ )/ 寻找/ 候选/ 复用/ 数据/ ;/ (/ 2/ )/ 筛选/ 候选/ 复用/ 数据/ ./ 下面/ 我们/ 将/ 分别/ 介绍/ 这/ 两个/ 方面/ 的/ 内容/ ./ 4.2/ ./ 1/ 数据/ 的/ 匹配/ 要/ 想/ 找到/ T/ 中/ 目标/ 属性/ 的/ 可/ 重用/ 数据/ 首先/ 必须/ 检测/ D/ 中/ 是否/ 存在/ 符合条件/ 的/ 属性/ 或/ 属性/ 组/ ./ 若/ 直接/ 进行/ 检测/ ,/ 则/ 需/ 穷举/ 所有/ 属性/ 及/ 属性/ 组/ 的/ 可能/ 匹配/ ,/ 在/ 计算/ 上/ 并/ 不/ 可行/ ./ 在/ 此/ ,/ 我们/ 借助/ 更为/ 高效/ 的/ 模式匹配/ 算法/ ./ 模式匹配/ 可以/ 发掘/ 一个/ 模式/ 中/ 某些/ 特定/ 元素/ 与/ 另/ 一个/ 模式/ 中/ 某些/ 特定/ 元素/ 间/ 的/ 映射/ Page4/ 关系/ ./ 已有/ 的/ 模式匹配/ 方法/ 大多/ 着重/ 发掘/ 模式/ 元素/ 间/ 的/ 11/ 匹配/ ./ 然而/ 模式/ 之间/ 还/ 包括/ 许多/ 复杂/ 匹配/ ./ 文献/ [/ 14/ -/ 15/ ]/ 中/ 提出/ 的/ iMAP/ 和/ CM/ 方法/ 都/ 能/ 很/ 好/ 地/ 发掘/ 11/ 和/ 复杂/ 匹配/ ./ 但/ iMAP/ 检索/ 候选/ 匹配/ 空间/ 的/ 时间/ 复杂度/ 可能/ 达到/ O/ (/ 2nm/ )/ ,/ 时间/ 效率/ 不高/ ./ CM/ 在/ iMAP/ 基础/ 上/ 增加/ 预处理/ 单元/ ,/ 事先/ 过滤/ 掉/ 部分/ 不合理/ 的/ 候选/ 匹配/ ,/ 从而/ 缩小/ 候选/ 匹配/ 空间/ ,/ 加快/ 列与列/ 之间/ 映射/ 关系/ 的/ 寻找/ ./ 因此/ ,/ 我们/ 选择/ 基于/ 数据/ 实例/ 信息/ 的/ CM/ 模式匹配/ 方法/ ./ 模式匹配/ 的/ 最终目标/ 是/ 寻找/ 属性/ 之间/ 的/ 映射/ 关系/ f/ ,/ 这是/ 复用/ 的/ 根本/ 依据/ ./ CM/ 匹配/ 框架/ 主要/ 由/ 4/ 个/ 单元/ 组成/ :/ 预/ 处理器/ 、/ 匹配/ 产生器/ 、/ 相似/ 度/ 估价/ 器/ 和/ 匹配/ 选择器/ ./ 具体/ 的/ 匹配/ 算法/ 表述/ 如下/ ./ 算法/ 1/ ./ SchemaMatching/ (/ D/ ,/ T/ )/ ./ 输入/ :/ D/ ,/ T/ 输出/ :/ M/ =/ (/ Colt/ ,/ Cols/ ,/ F/ )/ 1/ ./ S/ =/ / ;/ M/ =/ / ;/ 2/ ./ ListCandidatelist/ ;/ 3/ ./ SimilarMatrixMatrix/ ;/ 4/ ./ InitList/ (/ Candidatelist/ )/ ;/ 5/ ./ WHILE/ (/ S/ =/ D/ ./ getNextTable/ (/ )/ )/ 6/ ./ Preprocess/ (/ S/ )/ ;/ // / 根据/ 属性/ 的/ 数据类型/ 将/ S/ 中/ 的/ 各个/ 属性/ 存/ 7/ ./ Preprocess/ (/ T/ )/ ;/ // / 根据/ 属性/ 的/ 数据类型/ 将/ T/ 中/ 的/ 各个/ 属性/ 存表/ 1/ 模式匹配/ 发掘/ 的/ 映射/ 关系/ 4.2/ ./ 2/ 数据/ 的/ 筛选/ 由/ 模式匹配/ 得到/ 的/ 映射/ 关系/ 在/ 一定/ 程度/ 上/ 反映/ 了/ 数据/ 的/ 相关性/ ,/ 确定/ 了/ 复用/ 的/ 类型/ ./ 但/ 许多/ 关于/ 模式匹配/ 的/ 研究/ 表明/ ,/ 其/ 查准率/ 和/ 查全率/ 都/ 不能/ 达到/ 100/ %/ [/ 16/ ]/ ./ 因此/ 存在/ 映射/ 关系/ 仅仅/ 是/ 复用/ 的/ 必要/ 不/ 充分条件/ ,/ 候选/ 数据/ 能否/ 被/ 复用/ 还/ 必须/ 经过/ 进一步/ 的/ 筛选/ ./ 引入/ 两个/ 变量/ sum1/ ,/ sum2/ ,/ 其中/ sum1/ 为/ 目标/ 表/ T/ 的/ 元组/ 数/ ,/ sum2/ 为/ D/ 中/ 关系/ 表/ S/ 的/ 元组/ 数/ ./ 候选/ 数据/ 的/ 筛选/ 算法/ 如下/ ./ 8/ ./ ListInsert/ (/ Candidatelist/ ,/ s/ _/ unit/ [/ i/ ]/ ,/ t/ _/ unit/ [/ i/ ]/ )/ ;/ 9/ ./ Candidatelist/ =/ Search/ [/ m/ ]/ (/ Candidatelist/ )/ ;/ // / Search/ [/ m/ ]/ 是/ 一个/ 函数指针/ 数组/ ,/ 每个/ 函数/ 10/ ./ Matrix/ =/ SimilarityEstimate/ (/ Candidatelist/ )/ ;/ 11/ ./ f/ =/ SelectThreshold/ (/ Matrix/ )/ ,/ 将/ 最优/ 匹配/ f/ 及/ 属/ 12/ ./ RETURNM/ ./ 上述/ 算法/ 步/ 5/ 每次/ 选取/ D/ 中/ 的/ 一张/ 表与/ T/ 进行/ 匹配/ ,/ 其中/ D/ 中/ 的/ 表/ 与/ T/ 可/ 来自/ 两个/ 不同/ 的/ 数据/ 集/ ./ 步/ 6/ ~/ 7/ 通过/ 预处理/ ,/ 按照/ 属性/ 的/ 数据类型/ 过滤/ 掉/ 部分/ 不合理/ 的/ 候选/ 匹配/ ./ 步/ 9/ 应用/ 标准/ 的/ 搜索/ 策略/ 搜索/ 初步/ 缩小/ 的/ 候选/ 匹配/ 空间/ ,/ 产生/ 11/ 匹配/ 和/ 复杂/ 匹配/ (/ 匹配/ 基数/ 决定/ 了/ 复用/ 的/ 类型/ )/ ./ 步/ 10/ 、/ 11/ 应用/ 贝叶斯/ 分类器/ 对/ 候选/ 匹配/ 进行/ 估价/ 并/ 由/ 匹配/ 选择器/ 选择/ 出/ 较优/ 的/ 候选/ 匹配/ ./ 算法/ 的/ 输出/ 是/ 一个/ 包含/ 所有/ 确定/ 映射/ 关系/ 的/ 三元组/ M/ =/ (/ Colt/ ,/ Cols/ ,/ F/ )/ ,/ F/ 是/ 映射/ 关系/ f/ 的/ 集合/ ,/ Colt/ 与/ Cols/ 分别/ 是/ f/ 的/ 原像集/ 和/ 像/ 集/ ./ 不同/ 的/ 匹配/ 基数/ 对应/ 不同/ 的/ 映射/ 关系/ f/ ./ 对于/ 11/ 匹配/ ,/ Colt/ 中/ 的/ 目标/ 属性/ 在/ Cols/ 中有/ 唯一/ 确定/ 的/ 源/ 属性/ 与/ 之/ 对应/ ,/ 记为/ f/ :/ Ai/ →/ Aij/ ,/ (/ A/ ∈/ Colt/ ,/ Aij/ ∈/ Cols/ )/ ./ 对于/ 复杂/ 匹配/ ,/ 至少/ 存在/ 一个/ 属性/ 组合/ ,/ 记为/ f/ :/ (/ Ai/ ,/ …/ ,/ Aj/ )/ →/ (/ Aik/ ,/ …/ ,/ Aim/ )/ ,/ (/ (/ Ai/ ,/ …/ ,/ Aj/ )/ / Colt/ ,/ (/ Aik/ ,/ …/ ,/ Aim/ )/ / Cols/ ,/ (/ i/ -/ j/ )/ 2/ +/ (/ k/ -/ m/ )/ 2/ >/ 0/ )/ ,/ 属性/ 组合/ 一般/ 来自/ 于同/ 一张/ 关系/ 表/ ./ 常见/ 的/ 映射/ 关系/ f/ 主要/ 有/ 6/ 种/ ,/ 如表/ 1/ 所示/ ./ 算法/ 2/ ./ Filter/ (/ M/ )/ ./ 输入/ :/ M/ (/ Colt/ ,/ Cols/ ,/ F/ )/ 输出/ :/ M/ (/ Colt/ ,/ Cols/ ,/ F/ )/ 1/ ./ 对于/ M/ 中/ 每个/ 映射/ 关系/ f2/ ./ colt/ =/ f/ 中/ 来自/ T/ 的/ 属性/ 或/ 属性/ 组合/ ,/ 统计/ sum13/ ./ cols/ =/ f/ 中/ 来自/ S/ 的/ 属性/ 或/ 属性/ 组合/ ,/ 统计/ sum24/ ./ inti/ =/ 0/ ;/ 5/ ./ WHILE/ (/ (/ itemt/ =/ colt/ ./ getNextItem/ (/ )/ )/ Page56/ ./ IF/ (/ f/ (/ itemt/ )/ =/ =/ items/ )/ i/ ++/ 7/ ./ ELSE8/ ./ M/ =/ M/ -/ (/ colt/ ,/ cols/ ,/ f/ )/ GOTO19/ ./ ENDIF10/ ./ ENDWHILE11/ ./ IF/ (/ i/ =/ =/ sum1sum1/ </ sum2/ )/ 12/ ./ M/ =/ M/ -/ (/ colt/ ,/ cols/ ,/ f/ )/ GOTO113/ ./ ENDIF14/ ./ M/ =/ M15/ ./ RETURNM/ ./ 算法/ 中/ 统计/ 量/ i/ 表示/ 满足/ 映射/ 关系/ 的/ 数据项/ 总数/ ./ 步/ 8/ 说明/ 一旦/ 检测/ 出/ 某个/ 数据项/ 不/ 满足/ 映射/ 关系/ ,/ 候选/ 数据/ 就/ 不能/ 复用/ ,/ 必须/ 将/ 该/ 候选/ 匹配/ 剔除/ ./ 步/ 11/ 通过/ 比较/ i/ 与/ sum1/ 、/ sum2/ 的/ 大小/ ,/ 确定/ 复用/ 的/ 完整性/ ./ 可以/ 看到/ ,/ i/ 等于/ colt/ 与/ cols/ 记录/ 条数/ 的/ 最小值/ ./ 理想/ 情况/ 下/ i/ =/ sum1/ =/ sum2/ ,/ 对于/ 目标/ 属性/ 来说/ 数据/ 恰恰/ 完全/ 复用/ ;/ 如果/ i/ =/ sum2/ </ sum1/ ,/ 目标/ 属性/ 的/ 数据/ 真/ 包含/ 源/ 属性/ 的/ 数据/ ,/ 此时/ 除了/ 复用/ 源/ 属性/ 外/ 还/ 必须/ 从/ 外部/ 导入/ 剩余/ 的/ (/ sum1/ -/ i/ )/ 条/ 数据/ ,/ 称之为/ 部分/ 复用/ ./ 假若/ i/ =/ sum1/ </ sum2/ ,/ 说明/ 源/ 属性/ 中/ 还有/ 部分/ 数据/ 在/ 目标/ 属性/ 中/ 无法/ 找到/ 原/ 象/ ,/ 即/ 不是/ 满/ 映射/ ,/ 也/ 必须/ 剔除/ 该/ 候选/ 匹配/ ./ 经过/ 筛选/ 最终/ 得到/ 满足/ 复用/ 条件/ 的/ 新/ 三元组/ M/ (/ Colt/ ,/ Cols/ ,/ F/ )/ ./ 例如/ ,/ 根据/ 4.2/ ./ 1/ 节/ 的/ SchemaMatching/ (/ )/ 算法/ 得到/ M/ =/ (/ {/ name/ }/ ,/ {/ agent/ _/ name/ }/ ,/ {/ name/ =/ agent/ _/ name/ }/ )/ ,/ 其中/ sum1/ =/ 10500/ ,/ sum2/ =/ 10000/ ./ 调用/ Filter/ (/ )/ 算法/ 得到/ i/ =/ 10000/ ,/ 映射/ 关系/ f/ 成立/ ,/ name/ 列/ 复用/ agent/ _/ name/ 的/ 整列/ 数据/ ,/ 并/ 导入/ 额外/ 的/ 500/ 条/ 记录/ ./ 4.2/ ./ 3/ 复用/ 检测/ 模型/ 的/ 有效性/ 分析/ 上述/ 过程/ 利用/ 模式匹配/ 技术/ 发掘/ 候选/ 可/ 复用/ 列/ ,/ 排除/ 大量/ 无法/ 复用/ 的/ 数据/ 列/ ,/ 在/ 此基础/ 上/ 对/ 候选/ 可/ 复用/ 数据/ 进行/ 筛选/ 和/ 过滤/ ,/ 可/ 极大/ 减少/ 检测/ 空间/ 和/ 复杂度/ ./ 分析/ 如下/ :/ 假设/ D/ 中共/ 有/ n/ 张/ 关系/ 表/ ,/ 平均/ 每张/ 表有/ m/ 个/ 属性/ ,/ 目标/ 表/ T/ 中有/ k/ 个/ 属性/ ./ 关系/ 表/ 的/ 平均/ 记录/ 条数/ 为/ t/ ./ 如果/ 直接/ 进行/ 数据/ 的/ 筛选/ ,/ 所有/ 可能/ 的/ 候选/ 匹配/ 个数/ X1/ 可由式/ (/ 1/ )/ 计算/ 得到/ ,/ 筛选/ 候选/ 匹配/ 的/ 规模/ X2/ 可由式/ (/ 2/ )/ 计算/ 得到/ CM/ 匹配/ 框架/ 通过/ 模式匹配/ 得到/ 确定/ 的/ 映射/ 关系/ ,/ 其/ 候选/ 匹配/ 个数/ X3/ 及/ 筛选/ 规模/ X4/ 为/ 上式/ 中/ ,/ X2/ 的/ 时间/ 复杂度/ 为/ O/ (/ 2nmk/ )/ ,/ X4/ 的/ 时间/ 复杂度/ 为/ O/ (/ 2mk/ )/ ./ 显然/ ,/ 模式匹配/ 大大/ 缩小/ 了/ 候选/ 匹配/ 空间/ ,/ 特别/ 当表/ 的/ 记录/ 数/ t/ 十分/ 庞大/ 时/ ,/ 筛选/ 的/ 规模/ 大幅度/ 地/ 降低/ ,/ 极大地提高/ 了/ 复用/ 的/ 效率/ ./ 4.3/ 基于/ 存储/ 的/ 复用/ 实现/ 4.3/ ./ 1/ 原始数据/ 的/ 复用/ 如何/ 标记/ 源/ 属性/ 是否/ 被/ 重用/ ,/ 关系/ 到/ 如何/ 访问/ 重用/ 数据/ 的/ 问题/ ./ 列/ 存储/ 中/ ,/ 每个/ 段用/ 一个/ 段/ 控制/ 块/ 来/ 保存/ 段/ 的/ 特征/ 信息/ ./ 因此/ ,/ 我们/ 在/ 段/ 控制/ 块/ 中/ 引入/ 标示/ 符/ flag/ ,/ flag/ =/ 0/ 表示/ 此段/ 未/ 被/ 复用/ ,/ flag/ =/ 1/ 表示/ 此段/ 已/ 被/ 复用/ ./ 用/ 一张/ 复用/ 信息/ 表/ RTable/ 存放/ 相关/ 的/ 元/ 数据/ 信息/ ,/ RTable/ 的/ 结构/ 如表/ 2/ 所示/ ./ 名称/ coltcolt/ / Colt/ 来自/ T/ 的/ 属性/ 或/ 属性/ 组/ colscols/ / Cols/ 来自/ S/ 的/ 属性/ 或/ 属性/ 组/ ff/ / F/ ,/ 目标/ 属性/ colt/ 与源/ 属性/ cols/ 之间/ 的/ 映射/ 关系/ sum1/ 表/ T/ 的/ 记录/ 总数/ sum2/ 表/ S/ 的/ 记录/ 总数/ blk/ _/ id/ _/ list/ 映射/ 关系/ 中/ 每列/ 的/ 数据/ 块/ 信息/ 链表/ RTable/ 中/ 每条/ 记录/ 由/ 一个/ 映射/ 关系/ f/ 及/ 对应/ 属性/ 的/ 信息/ 构成/ ,/ 其中/ colt/ ,/ cols/ 共同/ 构成/ RTable/ 的/ 主键/ ./ cols/ 对应/ 的/ 数据/ 段/ 称为/ 原始/ 段/ ,/ colt/ 对应/ 的/ 数据/ 段/ 称为/ 目标/ 段/ ./ blk/ _/ id/ _/ list/ 是/ 一张/ 链表/ ,/ 每个/ 节点/ 存放/ 源/ 属性/ 的/ 列/ id/ ,/ 起始/ 数据/ 块块/ 号/ blk1/ 和/ 终止/ 数据/ 块块/ 号/ blkr/ ./ 首先/ 将/ 新/ 三元组/ M/ 中/ 的/ 所有/ 信息/ 添加/ 到/ RTable/ 表/ ,/ 然后/ 给出/ 基于/ 原始数据/ 的/ 复用/ 算法/ ./ 算法/ 3/ ./ Dataload/ _/ Reusing/ (/ T/ )/ ./ 输入/ :/ T1/ ./ FORallA/ ∈/ TDO2/ ./ colt/ =/ A/ ;/ 3/ ./ cols/ =/ findSimilarData/ (/ RTable/ ,/ colt/ )/ ;/ 4/ ./ IF/ (/ cols/ =/ =/ null/ )/ 5/ ./ blk1/ =/ load/ (/ A/ ,/ 1/ ,/ sum1/ )/ ;/ 6/ ./ blkr/ =/ getLastBlk/ (/ blk1/ )/ ;/ 7/ ./ addListNode/ (/ A/ ,/ blk1/ ,/ blkr/ )/ ;/ 8/ ./ ELSE9/ ./ flag/ =/ 1/ ;/ 10/ ./ blk/ _/ id/ _/ list/ =/ getBlkList/ (/ cols/ )/ ;/ 11/ ./ IF/ (/ sum1/ >/ sum2/ )/ 12/ ./ blk/ _/ id1/ =/ load/ (/ A/ ,/ sum1/ -/ sum2/ ,/ sum1/ )/ ;/ 13/ ./ blk/ _/ id/ _/ list/ ./ blkr/ -/ >/ next/ _/ id/ =/ blk/ _/ id1/ ;/ 14/ ./ blk/ _/ id/ _/ list/ ./ blkr/ =/ getLastBlk/ (/ blk/ _/ id1/ )/ ;/ 15/ ./ ELSE16/ ./ blk/ _/ id/ _/ list/ ./ blkr/ -/ >/ next/ _/ id/ =/ 0/ ;/ 17/ ./ ENDIF18/ ./ addListNode/ (/ A/ ,/ blk1/ ,/ blkr/ )/ ;/ 19/ ./ ENDIF20/ ./ ENDFORPage6/ 算法/ 中步/ 3/ 首先/ 判断/ 该/ 属性/ 能否/ 复用/ 源/ 属性/ ./ 步/ 5/ ~/ 7/ 表示/ 如果/ 不能/ 复用/ ,/ 则/ 加载/ 该/ 属性/ ./ addListNode/ (/ )/ 函数/ 将/ 当/ 前列/ id/ ,/ 起始/ 数据/ 块/ blk1/ 和/ 最后/ 一个/ 数据/ 块/ blkr/ 添加/ 到/ blk/ _/ id/ _/ list/ 中/ ./ 步/ 11/ 判断/ 目标/ 属性/ 是否/ 为/ 部分/ 复用/ ,/ 若/ 是/ 则/ 加载/ 时/ 必须/ 申请/ 新/ 的/ 数据/ 块/ 存储/ 剩余/ 的/ (/ sum1/ -/ sum2/ )/ 条/ 数据/ (/ 见步/ 12/ )/ ,/ 然后/ 将/ 原始/ 段/ 与/ 新/ 数据/ 块/ 串联/ 起来/ ./ 串联/ 时令/ 原始/ 段/ 最后/ 一个/ 数据/ 块/ 的/ 后继/ 指向/ 新/ 分配/ 的/ 第一个/ 数据/ 块/ (/ 见步/ 13/ )/ ./ 需要/ 注意/ 的/ 是/ ,/ 复用/ 的/ 实质/ 是/ 目标/ 属性/ 与源/ 属性/ 共享/ 存储空间/ ,/ 串联/ 改变/ 了/ 原始/ 段/ 的/ 存储/ 结构/ ./ 因此/ 针对/ 部分/ 复用/ ,/ 查询/ 时/ 如果/ 访问/ 源/ 属性/ 则/ 令/ blkr/ -/ >/ next/ _/ id/ =/ 0/ ,/ 说明/ 该段/ 为/ 原始/ 段/ ,/ 且/ 最后/ 一个/ 数据/ 块/ 为/ blkr/ ./ 如果/ 访问/ 目标/ 属性/ ,/ 则/ blkr/ -/ >/ next/ _/ id/ =/ blk/ _/ id1/ ,/ 即/ 该段/ 是/ 串联/ 后/ 的/ 目标/ 段/ ./ 若/ 多个/ 目标/ 属性/ 复用/ 同一/ 源/ 属性/ ,/ 即/ RTable/ 表/ cols/ 相同/ ,/ colt/ 不/ 同时/ ,/ 对/ colt/ 中/ 的/ 每个/ 目标/ 段/ 都/ 会/ 进行/ 形/ 如/ 算法/ 3/ 中步/ 10/ ~/ 16/ 的/ 操作/ ,/ 从而/ 实现/ 多/ 段/ 复用/ ./ 4.3/ ./ 2/ 压缩/ 数据/ 的/ 复用/ 目前/ 压缩/ 主要/ 分为/ 表级/ 、/ 块级/ 、/ 元组/ 级/ 、/ 属性/ 级/ 以及/ 比/ 特级/ 压缩/ ./ 列/ 存储/ 中/ 连续/ 存储/ 的/ 数据/ 均/ 来源于/ 同一个/ 属性/ ,/ 即/ 同一个/ 值域/ ,/ 因此/ 属性/ 级/ 压缩/ 在/ 数据压缩/ 方面/ 具有/ 很大/ 的/ 优势/ ./ 但/ 系统/ 在/ 首次/ 压缩/ 时/ 需要/ 耗费/ 一定/ 的/ CPU/ 代价/ [/ 17/ ]/ ./ 为此/ 我们/ 可以/ 对/ 已/ 压缩/ 数据/ 进行/ 复用/ ,/ 从而/ 减少/ 上述/ 开销/ ,/ 提高/ 系统/ 性能/ ./ 压缩/ 数据/ 复用/ 的/ 基本/ 思想/ :/ 由于/ 源/ 属性/ 与/ 目标/ 属性/ 共享/ 存储空间/ ,/ 因此/ 只要/ 源/ 属性/ 进行/ 了/ 压缩/ ,/ 目标/ 属性/ 就/ 可以/ 复用/ 其/ 压缩/ 数据/ ./ 算法/ 如下/ ./ 算法/ 4/ ./ compress/ _/ Reusing/ (/ T/ )/ ./ 输入/ :/ T1/ ./ FORallA/ ∈/ Tdo2/ ./ colt/ =/ A/ ;/ 3/ ./ cols/ =/ findSimilarData/ (/ RTable/ ,/ colt/ )/ ;/ 4/ ./ IF/ (/ cols/ =/ =/ null/ )/ 5/ ./ cmp/ _/ blkid/ =/ compress/ (/ A/ ,/ 1/ ,/ sum1/ )/ ;/ 6/ ./ cmp/ _/ blkid1/ =/ 0/ ;/ 7/ ./ ELSE8/ ./ cmp/ _/ blkid/ =/ getCompBlk/ (/ cols/ )/ ;/ 9/ ./ flag1/ =/ 1/ ;/ 10/ ./ IF/ (/ sum1/ >/ sum2/ )/ 11/ ./ cmp/ _/ blkid1/ =/ compress/ (/ A/ ,/ sum1/ -/ sum2/ ,/ sum1/ )/ ;/ 12/ ./ ELSE13/ ./ cmp/ _/ blkid1/ =/ 0/ ;/ 14/ ./ ENDIF15/ ./ ENDIF16/ ./ insertCompBlk/ (/ A/ ,/ cmp/ _/ blkid/ ,/ cmp/ _/ blkid1/ )/ ;/ 17/ ./ ENDFOR/ 在/ 存储/ 结构/ 上/ ,/ 每个/ 属性/ 同时/ 对应/ 一个/ 压缩/ 段/ id/ ,/ 即/ 起始/ 压缩/ 块/ 地址/ ,/ 根据/ 压缩/ 段/ id/ 可以/ 读取/ 压缩/ 数据/ ./ 同样/ 在/ 压缩/ 段/ 的/ 段/ 控制/ 块/ 中/ 引入/ 标示/ 符/ flag1/ ,/ flag1/ =/ 0/ 表示/ 压缩/ 段/ 未/ 被/ 复用/ ,/ flag1/ =/ 1/ 表示/ 该/ 压缩/ 段/ 已/ 被/ 复用/ ./ 步/ 3/ 首先/ 从/ RTable/ 表中/ 寻找/ 原始数据/ 复用/ 信息/ ./ 步/ 8/ 显示/ 一旦/ 存在/ 复用/ 信息/ ,/ 就/ 获取/ 源/ 属性/ 的/ 压缩/ 段/ id/ ./ 否则/ 必须/ 压缩/ 整列/ 数据/ ,/ 如步/ 5/ ./ compress/ (/ )/ 函数/ 涉及/ 3/ 个/ 参数/ ,/ 分别/ 是/ 属性/ 名/ 、/ 起始/ 行号/ (/ 从/ 1/ 开始/ 计数/ )/ 和/ 终止/ 行号/ ./ 若/ 是/ 部分/ 复用/ ,/ 如步/ 10/ 、/ 11/ 所示/ ,/ 则/ 压缩/ 剩余/ 数据/ ,/ 用/ cmp/ _/ blkid1/ 记录/ 新/ 压缩/ 块/ id/ ,/ 反之/ cmp/ _/ blkid1/ 为/ 0/ ./ 步/ 16/ 将/ 两/ 部分/ 的/ 压缩/ 段/ id/ 赋值/ 给/ 目标/ 属性/ ,/ 完成/ 压缩/ 数据/ 的/ 复用/ ./ 4.3/ ./ 3/ 索引/ 数据/ 的/ 复用/ 列/ 存储/ 中/ 元组/ 重构/ 与/ 多表/ 连接/ 是/ 影响/ 查询/ 性能/ 的/ 重要/ 因素/ ./ 而要/ 提高/ 查询/ 的/ 效率/ ,/ 最/ 简单/ 、/ 最/ 有效/ 的/ 方法/ 就是/ 在/ 数据表/ 相应/ 的/ 列上/ 建立/ 索引/ ./ 对/ 索引/ 数据/ 的/ 复用/ 可以/ 减少/ 复用/ 数据/ 的/ 索引/ 创建/ 时间/ ,/ 其/ 复用/ 实现/ 的/ 基本/ 思想/ 与/ 4.3/ ./ 2/ 节/ 类似/ :/ 对于/ T/ 中/ 等待/ 创建/ 索引/ 的/ 列/ Ai/ ,/ 查询/ RTable/ 表/ ,/ 如果/ 存在/ 可/ 重用/ 的/ 源/ 属性/ 且源/ 属性/ 已/ 创建/ 索引/ 则/ 将源/ 属性/ 的/ 索引/ 信息/ 赋值/ 给/ 目标/ 索引/ ,/ 完成/ 索引/ 数据/ 的/ 复用/ ./ 4.4/ 基于/ 复用/ 的/ 查询/ 实现/ 基于/ 复用/ 的/ 查询/ 实现/ 包括/ 4/ 个/ 主要/ 的/ 部分/ :/ 查询/ 匹配/ 、/ 查询/ 重写/ 、/ 查询/ 执行/ 和/ 结果/ 整合/ ./ 查询/ 匹配/ 是/ 指/ 查询/ RTable/ 表/ ,/ 判断/ 用户/ 查询/ 的/ 字/ 段/ 是否/ 重用/ ;/ 查询/ 重写/ 是/ 指/ 如果/ 存在/ 重用/ 的/ 字/ 段/ ,/ 则/ 根据/ 映射/ 关系/ 重写/ 原/ 查询/ 语句/ ;/ 查询/ 执行/ 是/ 指/ 将/ 查询/ 语句/ 提交/ 给/ 查询/ 引擎/ 执行/ ;/ 结果/ 整合/ 是/ 指/ 对/ 查询/ 结果/ 进行/ 适当/ 的/ 转换/ ,/ 生成/ 用户/ 需要/ 的/ 查询/ 结果/ 集/ ./ 现有/ 数据仓库/ D/ =/ {/ S1/ }/ ,/ 加载/ 目标/ 表/ T/ 前/ ,/ 首先/ 根据/ SchemaMatching/ (/ )/ 算法/ 与/ Filter/ (/ )/ 算法/ ,/ 得到/ 新/ 三元组/ M/ ./ 然后/ 将/ M/ 的/ 相关/ 信息/ 保存/ 到/ RTable/ 表中/ ,/ 如表/ 3/ 所示/ ./ 最后/ 调用/ Dataload/ _/ Reusing/ (/ )/ 算法/ ,/ 完成/ 原始数据/ 的/ 装载/ ./ 目标/ 属性/ 源/ 属性/ A1A2A3/ 现有/ 基于/ 表/ T/ 的/ 查询/ Q1/ 如下/ (/ 其中/ const1/ 与/ const2/ 表示/ 任意/ 常量/ )/ :/ SELECTA1/ ,/ A2/ ,/ A3/ ,/ A4FROMTWHEREA1/ >/ const1ANDA2/ >/ const2/ ;/ 下面/ 在/ 复用/ 数据/ 的/ 基础/ 上/ 实现/ 查询/ Q1/ ./ Page7/ (/ 1/ )/ 查询/ 匹配/ ./ 通过/ 查询/ RTable/ 表/ 可知/ T/ 中/ A4/ 无法/ 找到/ 复用/ 信息/ ,/ 而/ A1/ ,/ A2/ ,/ A3/ 均/ 能/ 在/ S1/ 中/ 找到/ 可/ 重用/ 数据/ ;/ (/ 2/ )/ 查询/ 重写/ ./ 为了/ 保证/ 查询/ 结果/ 的/ 准确性/ ,/ 首先/ 应/ 确保/ 查询/ 语句/ 等价/ ./ Q1/ 中/ 对于/ A1/ >/ const1/ ,/ 由于/ A1/ =/ A11/ ,/ 即/ 两列/ 数据/ 完全/ 等价/ ,/ 选择/ 条件/ 无需/ 改变/ ./ 而/ 对于/ A2/ >/ const2/ ,/ A2/ 与/ A12/ 的/ 数据/ 之间/ 存在/ 转换/ 关系/ ,/ 此时/ 选择/ 条件/ 是否/ 需要/ 改变/ 取决于/ 目标/ 数据/ 的/ 来源/ ./ 已知/ sum1/ ,/ sum2/ 分别/ 为/ T/ 和/ S1/ 的/ 记录/ 总数/ ./ 若/ sum1/ =/ sum2/ ,/ A2/ 完全/ 复用/ A12/ ,/ 则/ 根据/ f/ 原/ 查询/ 语句/ 重写/ 为/ Q1/ :/ SELECTA1/ ,/ A2/ ,/ A3/ ,/ A4FROMTWHEREA1/ >/ const1ANDA2/ >/ (/ const2/ // 0.1/ )/ ./ 反之/ 当/ sum1/ >/ sum2/ 时/ ,/ 数据/ 来源于/ 两/ 部分/ ,/ A12/ 中/ 的/ 可/ 重用/ 数据/ 及/ 外部/ 导入/ 的/ 数据/ ./ 对于/ 外部/ 导入/ 的/ 数据/ ,/ 选择/ 条件/ 仍为/ A2/ >/ const2/ ,/ 查询/ 语句/ 不变/ ./ 而/ 对于/ 可/ 重用/ 数据/ ,/ 查询/ 重写/ 为/ Q1/ ;/ (/ 3/ )/ 查询/ 执行/ ./ 对于/ 完全/ 复用/ ,/ 直接/ 执行/ Q1/ ./ 对于/ 部分/ 复用/ ,/ 如/ 4.3/ ./ 1/ 节/ 所述/ ,/ 查询/ 按照/ 数据/ 来源/ 的/ 不同/ 被/ 分解/ 为/ 两/ 部分/ ./ 由/ 〈/ colt/ ,/ cols/ 〉/ 对应/ 的/ blk/ _/ id/ _/ list/ 中/ 可以/ 得到/ 每个/ 复用/ 关系/ 中/ 两/ 部分/ 数据/ 的/ 起止/ 数据/ 块/ ./ 对于/ 可/ 重用/ 数据/ 执行/ Q1/ ,/ 对于/ 外部/ 导入/ 的/ 数据/ 仍然/ 执行/ Q1/ ;/ (/ 4/ )/ 结果/ 整合/ ./ 读取/ 可/ 重用/ 数据/ 中/ 满足条件/ 的/ 数据项/ ,/ 然后/ 根据/ colt/ =/ f/ (/ cols/ )/ 分别/ 进行/ 转换/ ,/ 最后/ 整合/ 转换/ 后/ 的/ 数据/ 并/ 输出/ 最终/ 结果/ ./ 4.4/ ./ 1/ 中间/ 结果/ 的/ 复用/ 数据仓库/ 支持/ 各种/ 可能/ 的/ 查询/ ,/ 但是/ 有/ 许多/ 查询/ 是/ 非常复杂/ 的/ ,/ 涉及/ 大量/ 的/ 数据/ ,/ 而且/ 要/ 对/ 这些/ 数据/ 进行/ 选择/ 、/ 投影/ 、/ 连接/ 等/ 复杂/ 处理/ ./ 这样/ 的/ 查询/ 过程/ 在/ 传统/ 数据库/ 中/ 时间/ 开销/ 很大/ ,/ 这/ 在/ 决策支持系统/ 中是/ 不能容忍/ 的/ ./ 因此/ 数据仓库/ 便/ 针对/ 可能/ 的/ 查询/ 对/ 原始数据/ 进行/ 连接/ 、/ 投影/ 、/ 分组/ 等/ 预处理/ ,/ 并/ 将/ 得到/ 的/ 中间/ 数据/ 保存/ 到/ 物理/ 磁盘/ 中/ ,/ 当/ 遇到/ 相同/ 的/ 查询/ 时/ ,/ 可以/ 直接/ 重用/ 物化/ 的/ 中间/ 结果/ ./ 下/ 两个/ 查询/ :/ 同样/ ,/ 复用/ 数据/ 也/ 能/ 重用/ 中间/ 结果/ ./ 例如/ 给定/ 如/ Q2/ :/ SELECT/ / FROMS1/ ,/ S2WHERES1/ ./ key/ =/ S2/ ./ key/ ;/ Q3/ :/ SELECT/ / FROMT1/ ,/ T2WHERET1/ ./ key/ =/ T2/ ./ key/ ;/ Q3/ 与/ Q2/ 的/ 查询/ 流程/ 相同/ ,/ 都/ 是/ 对/ 两张/ 表/ 进行/ 连接/ ,/ 且/ 存在/ 如下/ 映射/ 关系/ f/ :/ T1/ ./ key/ =/ S1/ ./ key/ ,/ T2/ ./ key/ =/ S2/ ./ key/ ./ 传统/ 情况/ 下/ 如果/ 预先/ 执行/ T1/ ./ key/ =/ T2/ ./ key/ 且/ 连接/ 结果/ result/ 驻留/ 在/ 缓冲区/ 或/ 存储/ 到/ 磁盘/ 上/ ,/ 再/ 执行/ Q3/ 时/ 可以/ 直接/ 重用/ result/ ./ 复用/ 情况/ 下/ 如果/ 预先/ 执行/ S1/ ./ key/ =/ S2/ ./ key/ 或/ T1/ ./ key/ =/ T2/ ./ key/ ,/ 连接/ 结果/ 均/ 能/ 重用/ ./ 复用/ 数据/ 中间/ 结果/ 的/ 重用/ 具体/ 分为/ 以下/ 几种/ 情况/ (/ 设/ 预先/ 执行/ S1/ ./ key/ =/ S2/ ./ key/ ,/ 且/ 连接/ 结果/ 为/ result1/ )/ :/ (/ 1/ )/ T1/ ./ key/ ,/ T2/ ./ key/ 均/ 完全/ 复用/ ./ 查询/ 重写/ 模块/ 判断/ 两条/ 语句/ 的/ 数据/ 均/ 来源于/ 可/ 重用/ 数据/ ,/ 且/ 连接/ 条件/ 相同/ ,/ 因此/ 直接/ 复用/ result1/ ;/ (/ 2/ )/ T1/ ./ key/ 部分/ 复用/ ,/ T2/ ./ key/ 完全/ 复用/ ./ 结果/ 集由/ 两/ 部分/ 组成/ ,/ T1/ ./ key/ 中/ 复用/ 成功/ 的/ 部分/ 复用/ 连接/ 结果/ result1/ ,/ 而/ T1/ ./ key/ 中/ 从/ 外部/ 导入/ 的/ 部分/ 继续/ 与/ T2/ ./ key/ 进行/ 连接/ ,/ 得到/ result2/ ,/ 两者/ 再取/ 并/ 集/ ;/ (/ 3/ )/ T1/ ./ key/ 完全/ 复用/ ,/ T2/ ./ key/ 部分/ 复用/ ,/ 同/ (/ 2/ )/ ./ 容易/ 看出/ ,/ 对于/ 数据量/ 相对/ 庞大/ 的/ 原始数据/ ,/ 经过/ 预计/ 算/ 可以/ 大大减少/ 数据量/ ,/ 快速/ 响应/ 复杂/ 查询/ ,/ 从而/ 节约/ 用户/ 的/ 查询/ 时间/ ,/ 提高/ 数据库/ 的/ 性能/ ./ 但/ 中间/ 结果/ 的/ 重用/ 与/ 具体/ 的/ 查询/ 相关/ ,/ 重用/ 机率/ 有限/ ./ 而/ 数据/ 复用/ 使得/ 中间/ 结果/ 与源/ 属性/ 或/ 目标/ 属性/ 均/ 相关/ ,/ 增加/ 了/ 中间/ 结果/ 的/ 重用/ 机率/ ,/ 有利于/ 大/ 数据/ 的/ 查询/ ./ 5/ 实验/ 5.1/ 实验/ 环境/ 实验/ 运行/ 的/ 硬件/ 环境/ 为/ Intel/ / CoreTM2DuoCPUP8700/ @/ 2.53/ GHz/ ,/ 内存/ 2GB/ ,/ 操作系统/ 为/ Windows7/ ./ 开发/ 环境/ 为/ MicrosoftVisual/ C++/ 6.0/ ./ 实验/ 中列/ 存储/ 其/ 底层/ 列/ 存储/ 方式/ 为/ (/ rowid/ ,/ value/ )/ 二元/ 表/ ,/ rowid/ 是/ 为了/ 重构/ 元组/ 而/ 在/ 每/ 一列/ 数据/ 前/ 附加/ 的/ 行号/ ,/ 每个/ value/ 都/ 与/ 一个/ rowid/ 相关/ ./ 存储单元/ 从大到/ 小/ 依次/ 为/ 段/ 、/ 区/ 和/ 数据/ 块/ ./ 列/ 存储/ 中/ 一列/ 就是/ 一个/ 段/ ,/ 每个/ 段/ 包括/ 904/ 个区/ ,/ 每个/ 区/ 包含/ 16/ 个/ 数据/ 块/ ,/ 每个/ 数据/ 块/ 的/ 大小/ 为/ 8KB/ ./ 5.2/ 数据/ 集/ 实验/ 采用/ 的/ 数据/ 来源于/ 工业界/ 和/ 学术界/ 都/ 普遍/ 采用/ 的/ 大规模/ 基准/ 数据/ 集/ TPCH/ 和/ SSB/ ./ TPCH/ 中共/ 有/ 8/ 张表/ ,/ 包含/ 两张/ 事实/ 表/ lineitem/ 和/ orders/ ,/ 其为/ 雪花/ 模式/ ,/ SSB/ 则/ 对/ TPCH/ 在/ 模式/ 上/ 进行/ 一定/ 修改/ ,/ 使/ 其/ 成为/ 标准/ 的/ 星型/ 模型/ ./ 因此/ ,/ 两/ 数据/ 集中/ 包含/ 许多/ 相似/ 属性/ ,/ 如/ lineitem/ 和/ lineorder/ 表/ 的/ l/ _/ orderkey/ 、/ l/ _/ linenumber/ 列/ ,/ part/ 表/ 的/ partkey/ 、/ type/ 、/ size/ 列/ ,/ customer/ 表/ 的/ custkey/ 、/ name/ 、/ phone/ 列/ 等/ ,/ 可用/ 来/ 进行/ 数据/ 复用/ 的/ 实验/ ./ 不失/ 一般性/ ,/ 我们/ 使用/ SSB/ 中/ 事实/ 表/ lineorder/ 以及/ TPCH/ 中/ 事实/ 表/ lineitem/ 数据/ 进行/ 测试/ ./ 实例/ 数据/ 集/ 的/ 大小/ 由/ 增量/ 因/ Page8/ 子/ SF/ 控制/ ./ 当/ SF/ =/ 1/ 时/ SSB/ 中/ 事实/ 表/ lineorder/ 及/ TPCH/ 中/ 事实/ 表/ lineitem/ 的/ 数据量/ 均/ 为/ 6000000/ 行/ ./ 5.3/ 实验/ 结果/ 与/ 分析/ 假设/ 数据仓库/ D/ 已/ 包含/ SSB/ 数据/ 集中/ 的/ lineorder/ 表/ ,/ 即/ D/ =/ {/ lineorder/ }/ ,/ TPCH/ 中/ 的/ lineitem/ 表为/ 目标/ 表/ ./ 已知/ lineorder/ 表共/ 17/ 列/ ,/ lineitem/ 表共/ 16/ 列/ ./ 当/ SF/ 相等/ 时/ ,/ 两张/ 表/ 的/ 记录/ 条数/ 相同/ ./ 复用/ 检测/ 模型/ 发掘出/ 两张/ 表/ 属性/ 之间/ 的/ 映射/ 关系/ 如表/ 4/ 所示/ ,/ 可以/ 看到/ lineitem/ 表/ 中共/ 有/ 7/ 列/ 满足/ 11/ 完全/ 复用/ ,/ 其中/ l/ _/ discount/ ,/ l/ _/ tax/ 列均/ 与/ 源/ 属性/ 存在/ 单位/ 异构/ ,/ 而/ l/ _/ receiptdate/ 列与源/ 属性/ 存在/ 日期/ 格式/ 异构/ ./ 表/ 4/ 犾/ 犻/ 狀/ 犲/ 狅/ 狉/ 犱/ 犲/ 狉/ 表/ 与/ 犾/ 犻/ 狀/ 犲/ 犻/ 狋/ 犲/ 犿/ 表/ 属性/ 间/ 的/ 映射/ 关系/ 目标/ 属性/ 源/ 属性/ l/ _/ orderkeylo/ _/ orderkeyl/ _/ orderkey/ =/ lo/ _/ orderkeyl/ _/ linenumberlo/ _/ linenumberl/ _/ linenumber/ =/ lo/ _/ linenumberl/ _/ partkeylo/ _/ partkeyl/ _/ partkey/ =/ lo/ _/ partkeyl/ _/ discountlo/ _/ discountl/ _/ discount/ =/ lo/ _/ discount/ ×/ 0.01/ l/ _/ taxlo/ _/ taxl/ _/ tax/ =/ lo/ _/ tax/ ×/ 0.01/ l/ _/ receiptdatelo/ _/ commitdatel/ _/ shipmodelo/ _/ shipmodel/ _/ shipmode/ =/ lo/ _/ shipmode/ 用/ ω/ 表示/ 目标/ 表/ T/ 的/ 复用/ 率/ ,/ a/ 表示/ T/ 中/ 复用/ 成功/ 的/ 属性/ 数目/ ,/ b/ 表示/ T/ 中/ 复用/ 失败/ 的/ 属性/ 数目/ ,/ 则/ 由式/ (/ 5/ )/ 可知/ ,/ lineitem/ 表/ 的/ 复用/ 率为/ 7/ // 16/ =/ 43.75/ %/ ./ 5.3/ ./ 1/ 存储量/ 比较/ 实验/ 1/ 分别/ 采用/ 未/ 复用/ 策略/ 和/ 本文/ 提出/ 的/ 复用/ 策略/ 将/ lineitem/ 表/ 加载/ 到/ D/ 中/ ,/ 比较/ 随着/ SF/ 的/ 增加/ ,/ 不同/ 策略/ 下/ lineitem/ 表所/ 占用/ 的/ 存储量/ ./ 图/ 1/ 给出/ 了/ 存储量/ 的/ 比较/ 结果/ ,/ 其中/ 图中/ 每组/ 数据/ 值均/ 以/ 复用/ 后/ 的/ 存储量/ 为/ 基准/ 进行/ 归一化/ 处理/ ,/ 如图/ 1/ 所示/ ./ 从图/ 1/ 可以/ 看出/ ,/ 随着/ 表中/ 记录/ 条数/ 的/ 增长/ ,/ 两种/ 策略/ 的/ 总/ 存储量/ 均/ 按/ 比例/ 增长/ ./ 但/ 两者之间/ 消耗/ 存储空间/ 的/ 比例/ 趋于稳定/ ,/ 未/ 复用/ 时/ 占用/ 的/ 存储量/ 大约/ 是/ 复用/ 时/ 的/ 1.52/ 倍/ ./ 实际上/ ,/ 存储量/ =/ 记录/ 数/ ×/ 字/ 段/ 总长度/ ./ 假设/ 数据/ 集中/ decimal/ 数据类型/ 占用/ 4/ 个/ 字节/ ,/ 系统/ 中/ 附加/ 的/ rowid/ 占用/ 4/ 个/ 字节/ ./ 根据/ 表/ 的/ 模式定义/ 可以/ 得到/ lineitem/ 表中/ 记录/ 本身/ 占用/ 137B/ ,/ 所有/ 的/ rowid/ 占用/ 4/ ×/ 16/ =/ 64B/ ,/ 其中/ 可/ 复用/ 的/ 列/ 占用/ 42B/ ,/ 同时/ 节约/ 的/ rowid/ 共/ 占用/ 4/ ×/ 7/ =/ 28B/ ,/ 则/ 复用/ 情况/ 下/ 每条/ 记录/ 可以/ 节约/ 42/ +/ 28/ =/ 70B/ ./ 当/ 选择/ 相同/ 的/ SF/ 时/ ,/ 理论/ 上/ 未/ 复用/ 时/ lineitem/ 表/ 占用/ 的/ 存储量/ 是/ 复用/ 的/ (/ 137/ +/ 64/ )/ // (/ 137/ +/ 64/ -/ 70/ )/ =/ 1.53/ 倍/ ./ 这/ 也/ 间接/ 证明/ 了/ 图/ 1/ 的/ 合理性/ ./ 5.3/ ./ 2/ 加载/ 时间/ 比较/ 在/ 实验/ 1/ 的/ 基础/ 上/ ,/ 我们/ 比较/ 不同/ 策略/ 下/ ,/ 装载/ lineitem/ 表所/ 花费/ 的/ 时间/ ,/ 同样/ 对/ 每组/ 数据/ 按/ 复用/ 后/ 数据/ 导入/ 时间/ 进行/ 归一化/ 处理/ ./ 从图/ 2/ 中/ 可以/ 明显/ 看出/ ,/ 不论/ SF/ 如何/ 取值/ ,/ 复用/ 情况/ 下/ lineitem/ 表/ 导入/ 时间/ 减少/ 的/ 百分比/ 趋近/ 于/ 常量/ ,/ 大约/ 为/ 未/ 复用/ 时/ 的/ 45/ %/ ./ 由于/ 减少/ 的/ 百分比/ 与/ 目标/ 表/ 的/ 复用/ 率/ ω/ 相关/ ,/ 当/ 复用/ 率较/ 高时/ ,/ 复用/ 能够/ 节省/ 大量/ 的/ 数据/ 导入/ 时间/ ./ 5.3/ ./ 3/ 查询/ 时间/ 比较/ 实验/ 3/ 我们/ 比较/ 随着/ SF/ 的/ 变化/ 查询/ 执行器/ 在/ 执行/ 标准/ 查询/ 语句/ 时/ 执行/ 时间/ 的/ 差异/ ./ 选取/ 的/ 查询/ 语句/ Q4/ 如下/ :/ SELECTl/ _/ orderkey/ ,/ l/ _/ suppkey/ ,/ l/ _/ discountFROMlineitemWHEREl/ _/ orderkey/ </ 100ANDl/ _/ discount/ =/ 0.01/ ;/ 根据/ 4.4/ 节/ 提出/ 的/ 查询/ 实现/ 方法/ ,/ 在/ 复用/ 数据/ 上/ 实现/ 此/ 查询/ 可/ 分为/ 如下/ 几步/ :/ (/ 1/ )/ 由表/ 4/ 中/ 的/ 映射/ 关系/ 可知/ ,/ Q4/ 的/ 目标/ 列表/ 中/ l/ _/ orderkey/ 与/ l/ _/ discount/ 列/ 可以/ 完全/ 复用/ ,/ Page9l/ _/ suppkey/ 无法/ 找到/ 匹配/ 列/ ;/ f/ 重写/ 选择/ 条件/ ,/ 得到/ Q4/ :/ (/ 2/ )/ 由于/ l/ _/ discount/ 列/ 存在/ 单位/ 异构/ ,/ 则/ 根据/ SELECTl/ _/ orderkey/ ,/ l/ _/ suppkey/ ,/ l/ _/ discountFROMlineitemWHEREl/ _/ orderkey/ </ 100ANDl/ _/ discount/ =/ 1/ ;/ (/ 3/ )/ 执行/ Q4/ ;/ (/ 4/ )/ 将/ 返回/ 的/ l/ _/ discount/ 列/ 的/ 数据/ 均/ 乘以/ 0.01/ ,/ 其它/ 数据/ 不变/ ./ 下面/ 我们/ 观察/ 随着/ 数据/ 集/ 的/ 增加/ ,/ 查询/ 开销/ 的/ 增长/ 趋势/ ./ 如图/ 3/ 所示/ ,/ 依次/ 将/ SF/ 设定/ 为/ 0.5/ 、/ 1/ 、/ 2/ 、/ 3/ ,/ 分别/ 在/ 这些/ 数量级/ 的/ 未/ 复用/ 数据/ 及/ 复用/ 数据/ 上/ 执行/ 查询/ ,/ 记录/ 平均/ 查询/ 时间/ ./ 可以/ 观察/ 到/ ,/ 当/ 数据量/ 比较/ 小时/ ,/ 用户/ 对/ 两种/ 策略/ 的/ 响应/ 时间/ 差别/ 可能/ 并/ 不/ 敏感/ ./ 但/ 当/ 数据量/ 逐渐/ 增大/ 时/ ,/ 复用/ 策略/ 由于/ 创造/ 了/ 更/ 多/ 的/ 重用/ 机率/ ,/ 在/ 一定/ 程度/ 上/ 缩短/ 了/ 查询/ 的/ 响应/ 时间/ ./ 这种/ 优势/ 会/ 在/ 多/ 查询/ 语句/ 组中/ 体现/ 更/ 充分/ ./ 数据仓库/ 中/ 查询/ 语句/ 的/ 一般/ 形式/ 为/ 将/ 维表/ 与/ 事实/ 表/ 根据/ 主外键/ 进行/ 连接/ ,/ 然后/ 在/ 特定/ 维度/ 层次/ 上/ 对/ 事实/ 表中/ 的/ 度量/ 信息/ 进行/ 聚集/ ./ 据此/ ,/ 我们/ 在/ 两个/ 数据/ 集中/ 分别/ 选取/ 一条/ 查询/ 语句/ 构成/ 查询/ 语句/ 组/ G1/ :/ Q5/ :/ SELECTlo/ _/ part/ ./ p/ _/ brand/ ,/ SUM/ (/ lo/ _/ quantity/ )/ FROMlineorder/ ,/ lo/ _/ partWHERElineorder/ ./ lo/ _/ partkey/ =/ lo/ _/ part/ ./ p/ _/ partkeyGROUPBYlo/ _/ part/ ./ p/ _/ brand/ ;/ ORDERBYlo/ _/ part/ ./ p/ _/ brand/ ;/ Q6/ :/ SELECTl/ _/ part/ ./ p/ _/ brand/ ,/ SUM/ (/ l/ _/ quantity/ )/ FROMlineitem/ ,/ l/ _/ partWHERElineitem/ ./ l/ _/ partkey/ =/ l/ _/ part/ ./ p/ _/ partkeyGROUPBYl/ _/ part/ ./ p/ _/ brand/ ;/ ORDERBYl/ _/ part/ ./ p/ _/ brand/ ;/ 可以/ 看到/ 这/ 两条/ 语句/ 的/ 选择性/ 都/ 不/ 高/ ,/ 这/ 也/ 正/ 符合/ 了/ 分析/ 型/ 应用/ 中/ 查询/ 语句/ 的/ 特点/ ./ 继续/ 观察/ 随着/ SF/ 的/ 变化/ ,/ 查询/ 开销/ 的/ 增长/ 趋势/ ./ 由于/ SSB/ 数据/ 集中/ lo/ _/ part/ 表/ 记录/ 数/ 与/ SF/ 呈/ 对数/ 关系/ (/ 200000/ ×/ floor/ (/ 1/ +/ log2SF/ )/ )/ ,/ 即当/ lineorder/ 表为/ 6000000/ 行时/ ,/ lo/ _/ part/ 表为/ 200000/ 行/ ,/ 因此/ 如图/ 4/ 所示/ 将/ SF/ 更/ 改为/ 1/ 、/ 2/ 、/ 4/ 、/ 8/ ./ G1/ 的/ 平均/ 执行/ 时间/ 为/ 两条/ 语句/ 执行/ 时间/ 和/ 的/ 平均值/ ./ 从图/ 中/ 可以/ 看到/ ,/ 未/ 复用/ 情况/ 下/ 顺序/ 执行/ Q5/ ,/ Q6/ ,/ 其/ 查询/ 时间/ 与/ 单独/ 执行/ 每条/ 语句/ 的/ 时间/ 之/ 和/ 相差/ 不大/ ./ 然而/ 在/ 复用/ 情况/ 下/ ,/ 执行/ Q5/ 后/ 接着/ 执行/ Q6/ 时/ 由于/ 连接/ 条件/ 中/ 涉及/ 到/ 的/ 两列/ 均/ 参加/ 复用/ ,/ 因而/ 连接/ 产生/ 的/ 部分/ 中间/ 结果/ 及/ 聚集/ 结果/ 可以/ 被/ 重用/ ,/ 这样/ 相当于/ 减少/ 了/ Q6/ 的/ 执行/ 时间/ ,/ 则/ 语句/ 组/ 的/ 总/ 时间/ 就/ 大大减少/ ./ 从/ 上面/ 的/ 过程/ 容易/ 看出/ 不论是/ 相同/ 数据/ 集/ 或/ 不同/ 数据/ 集/ ,/ 在/ 本文/ 方法/ 的/ 基础/ 上/ 均/ 可/ 再/ 应用/ 传统/ 的/ 中间/ 结果/ 优化/ 方法/ ,/ 从而/ 带来/ 复用/ 效率/ 的/ 进一步/ 提升/ ./ 6/ 总结/ 与/ 展望/ 本文/ 根据/ 列/ 存储/ 的/ 特点/ ,/ 提出/ 了/ 列/ 存储/ 数据仓库/ 中/ 不同/ 数据/ 集/ 之间/ 的/ 数据/ 复用/ 策略/ ./ 利用/ 模式匹配/ 技术/ 发掘/ 候选/ 可/ 复用/ 列/ ,/ 排除/ 大量/ 无法/ 复用/ 的/ 数据/ 列/ ,/ 在/ 此基础/ 上/ 对/ 候选/ 可/ 复用/ 数据/ 进行/ 筛选/ 和/ 过滤/ ,/ 大大减少/ 复用/ 数据/ 检测/ 的/ 复杂度/ ./ 针对/ 确定/ 的/ 可/ 复用/ 数据/ ,/ 提出/ 了/ 基于/ 列/ 存储/ 的/ 复用/ 实现/ 策略/ ,/ 以及/ 基于/ 复用/ 数据/ 的/ 查询/ 实现/ 技术/ ./ 实验/ 结果/ 验证/ 了/ 本文/ 所提/ 策略/ 能够/ 有效/ 利用/ 数据/ 之间/ 的/ 冗余/ ,/ 在/ 减少/ 存储量/ 、/ 节省/ 数据/ 装载/ 时间/ 及/ 提升/ 查询/ 性能/ 方面/ 具有/ 较/ 高效率/ ./ 未来/ 的/ 工作/ 将/ 继续/ 完善/ 本文/ 提出/ 的/ 数据/ 复用/ 策略/ ,/ 主要/ 是/ 优化/ 候选/ 数据/ 的/ 筛选/ 并/ 扩大/ 复用/ 策略/ 的/ 适用范围/ ./ 

