Page1/ 面向/ 互动式/ 网络/ 场景/ 再现/ 的/ 流速/ 控制系统/ 与/ 方法/ 褚伟波/ 1/ )/ 管晓宏/ 1/ )/ ,/ 2/ )/ 蔡忠/ 闽/ 1/ )/ 陶敬/ 1/ )/ 1/ )/ (/ 西安交通大学/ 智能/ 网络/ 与/ 网络安全/ 教育部/ 重点/ 实验室/ 西安/ 710049/ )/ 2/ )/ (/ 清华大学/ 自动化系/ 清华/ 信息科学/ 与/ 技术/ 国家/ 实验室/ 北京/ 100084/ )/ 摘要/ 互动式/ 网络/ 场景/ 再现/ 是/ 一种/ 重要/ 的/ 真实/ 网络流量/ 产生/ 方法/ ./ 然而/ ,/ 由于/ 流量/ 产生/ 过程/ 的/ 复杂性/ ,/ 基于/ 精确/ 的/ 数学模型/ 对/ 该/ 过程/ 产生/ 流速/ 进行/ 控制/ 是/ 一个/ 较为/ 困难/ 的/ 新/ 问题/ ./ 文中/ 设计/ 实现/ 了/ 一个/ 面向/ 互动式/ 网络/ 场景/ 再现/ 的/ 流速/ 控制系统/ ,/ 并/ 将/ 网络/ 场景/ 再现/ 过程/ 中/ 的/ 流速/ 控制/ 问题/ 转化/ 为/ 目标/ 跟踪/ 控制/ 问题/ 进行/ 求解/ ./ 该/ 系统/ 采用/ 一种/ 基于/ 函数/ 近似/ 器/ 的/ 流速/ 控制/ 方法/ ,/ 利用/ 函数/ 近似/ 器/ 对系统/ 的/ 输入输出/ 关系/ 进行/ 描述/ ,/ 通过/ 动态/ 调整/ 系统/ 输入/ 流量/ 来/ 对/ 回放/ 过程/ 输出/ 流量/ 进行/ 跟踪/ ./ 最后/ ,/ 利用/ 真实/ 网络流量/ 实验/ 考察/ 了/ 文中/ 系统/ 和/ 方法/ 在/ 不同/ 丢包/ 、/ 传输/ 延迟/ 以及/ 会话/ 阻断/ 环境/ 下/ 的/ 实际/ 控制/ 效果/ ,/ 并/ 从/ 收敛/ 时间/ 、/ 产生/ 输入输出/ 、/ 控制/ 误差/ 等/ 角度/ 对系统/ 的/ 控制/ 性能/ 进行/ 了/ 分析/ ./ 关键词/ 互动式/ 网络/ 场景/ 再现/ ;/ 流量/ 回放/ ;/ 流速/ 控制/ ;/ 函数/ 近似/ 器/ 1/ 引言/ 网络/ 场景/ 再现/ [/ 1/ -/ 15/ ]/ 是/ 近年来/ 逐渐/ 受到重视/ 的/ 一个/ 新兴/ 研究/ 方向/ ,/ 其/ 核心/ 问题/ 是/ 再现/ 符合/ 真实/ 网络/ 场景/ 的/ 流量/ ./ 网络/ 场景/ 再现/ 研究/ 对于/ 网络安全/ 、/ 网络管理/ 、/ 网络设备/ 测试/ 评估/ 等/ 领域/ 具有/ 重要/ 意义/ ./ 当前/ 网络流量/ 再现/ 方法/ 主要/ 有/ 两种/ ,/ 即/ 基于/ 仿真/ 的/ 流量/ 再现/ 方法/ [/ 1/ -/ 6/ ]/ 和/ 基于/ 真实/ 网络流量/ 还原/ 回放/ [/ 7/ -/ 15/ ]/ 的/ 方法/ ./ 基于/ 仿真/ 的/ 流量/ 再现/ 方法/ 能够/ 通过/ 调整/ 模型/ 参数/ 来/ 灵活/ 产生/ 需要/ 的/ 流量/ (/ 如/ Spirient/ ’/ sSmartbits/ ①/ ,/ IXIA/ ’/ sTrafficGenerator/ ②/ )/ ./ 然而/ ,/ 由于/ 实际/ 网络流量/ 异常/ 复杂/ ,/ 基于/ 仿真/ 方法/ 产生/ 的/ 流量/ 往往/ 与/ 实际/ 流量/ 相差/ 较大/ (/ 如/ 数据包/ 大小/ 、/ IP地址/ 和/ 端口/ 分布/ 、/ 应用/ 类型/ 等/ )/ ,/ 利用/ 仿真/ 流量/ 对系统/ 进行/ 测评/ 得到/ 的/ 结果/ 并/ 不足以/ 代表/ 系统/ 在/ 真实/ 网络/ 环境/ 下/ 的/ 功能/ 和/ 性能/ ./ 在/ 实际/ 情况/ 中/ 也/ 经常/ 发现/ 系统/ 在/ 仿真/ 流量/ 环境/ 下/ 功能/ 和/ 性能/ 均/ 表现/ 正常/ 而/ 在/ 实际/ 网络/ 中/ 却/ 出现/ 各种/ 问题/ ;/ 相反/ 地/ ,/ 网络流量/ 回放/ 方法/ 则/ 是/ 将/ 真实/ 网络/ 中/ 的/ 流量/ 进行/ 捕获/ 记录/ [/ 16/ ]/ 并/ 还原/ 回/ 放到/ 测试/ 网络/ 的/ 一种/ 流量/ 产生/ 方法/ ./ 由于/ 采用/ 了/ 实际/ 网络/ 中/ 捕获/ 得到/ 的/ 流量/ ,/ 流量/ 回放/ 方法/ 可以/ 在/ 数据包/ 层面/ (/ 包/ 大小/ 、/ 包/ 内容/ 、/ 包/ 时序/ 等/ 方面/ )/ 还原/ 实际/ 网络/ 场景/ 、/ 达到/ 直接/ 考察/ 被/ 测系统/ 在/ 真实/ 网络/ 中/ 的/ 功能/ 和/ 性能/ 的/ 目的/ ./ 根据/ 流量/ 回放/ 机制/ 的/ 不同/ ,/ 流量/ 回放/ 方法/ 又/ 分为/ 直接/ 回放/ [/ 7/ -/ 11/ ]/ 和/ 互动式/ 回放/ [/ 12/ -/ 15/ ]/ 两种/ ,/ 分别/ 对应/ 直接/ 的/ 流量/ 再现/ 以及/ 互动式/ 流量/ 再现/ ./ 直接/ 流量/ 再现/ 方法/ (/ 如/ TCPReplay/ ③/ 、/ TCPivo/ [/ 7/ ]/ 、/ Monkey/ [/ 8/ ]/ 、/ Tomahawk/ ④/ )/ 简单/ 地/ 将/ 捕获/ 到/ 的/ 数据包/ 注入/ 到/ 测试/ 网络/ 来/ 对/ 网络/ 场景/ 进行/ 还原/ ,/ 主要/ 用于/ 测试/ IDS/ (/ 入侵/ 检测/ 系统/ )/ 、/ Sniffer/ (/ 嗅探器/ )/ 等/ 各类/ 被动型/ 旁路/ 设备/ ;/ 而/ 互动式/ 再现/ 方法/ 则/ 在/ 流量/ 产生/ 过程/ 中/ 仿真/ 实现/ 了/ TCP/ // IP/ 协议/ 栈/ 并/ 严格/ 基于/ 网络协议/ 规范/ 来/ 产生/ 数据/ 报文/ ,/ 有效/ 解决/ 了/ 直接/ 流量/ 再现/ 方法/ 在/ 测试/ Firewall/ (/ 防火墙/ )/ 、/ IPS/ (/ 入侵/ 阻断/ 系统/ )/ 等/ 各类/ 串接/ 型/ 安全设备/ 过程/ 中/ 产生/ 大量/ 违反/ 协议/ 语义/ 数据包/ 的/ 问题/ [/ 12/ ,/ 14/ ]/ (/ 如/ 采用/ 直接/ 再现/ 方法/ 在/ 测试/ Firewall/ 的/ 过程/ 中/ ,/ SYN/ _/ ACK/ 报文/ 会/ 在/ SYN/ 报文/ 被/ Firewall/ 阻断/ 的/ 情况/ 下/ 仍然/ 被/ 回/ 放到/ 测试/ 网络/ 中/ ,/ 从而/ 极大/ 地/ 影响/ 到/ 测试/ 结果/ 的/ 准确性/ )/ ./ 由于/ 在/ 流量/ 再现/ 过程/ 中/ 考虑/ 了/ 数据包/ 之间/ 的/ 协议/ 语义/ 并/ 模拟/ 会话/ 两侧/ 的/ 行为/ 来/ 产生/ 流量/ ,/ 因而/ 互动式/ 网络流量/ 再现/ 方法/ 可以/ 通过/ 产生/ 流量/ 的/ 变化/ 反映/ 被测/ 设备/ 的/ 作用/ ,/ 达到/ 考察/ 被测/ 设备/ 串接/ 在/ 实际/ 网络/ 时/ 的/ 功能/ 和/ 性能/ 的/ 目的/ ./ 当前/ ,/ 互动式/ 网络流量/ 再现/ 方法/ 已经/ 成为/ 了/ 对/ IPS/ 、/ Firewall/ 等/ 各类/ 串接/ 型/ 网络设备/ 进行/ 测试/ 评估/ 的/ 最新/ 方法/ ./ 在/ 网络/ 场景/ 再现/ 过程/ 中/ ,/ 对/ 回放/ 产生/ 流量/ 的/ 流速/ 进行/ 控制/ 具有/ 重要/ 意义/ ./ 流速/ 控制/ 主要/ 有/ 两个/ 方面/ ,/ 一方面/ 是/ 产生/ 尽可能/ 大/ 的/ 流速/ 的/ 流量/ ,/ 另外/ 一方面/ 是/ 产生/ 满足用户/ 设定/ 流速/ 的/ 流量/ ./ 产生/ 高速/ 流量/ 可/ 用于/ 考察/ 被/ 测系统/ 在/ 高速/ 网络/ 环境/ 下/ 的/ 功能/ 和/ 性能/ ,/ 而/ 产生/ 用户/ 指定/ 流速/ 的/ 流量/ 在/ 测试/ 过程/ 中/ 同样/ 非常/ 重要/ ./ 在/ 实际/ 网络管理/ 和/ 设备/ 测试/ 过程/ 中/ 经常/ 发现/ 被/ 测系统/ 的/ 一些/ 深层次/ 故障/ 和/ 问题/ 往往/ 是/ 在/ 流速/ 突然/ 发生变化/ 的/ 时候/ 或/ 在/ 一些/ 特定/ 流量/ 水平/ 上/ 才/ 体现/ 出来/ ./ 所以/ ,/ 流速/ 控制/ 在/ 流量/ 再现/ 过程/ 中便/ 成为/ 了/ 一个/ 非常/ 重要/ 的/ 环节/ ./ 在/ 本文/ 中/ ,/ 考虑/ 在/ 互动式/ 网络/ 场景/ 再现/ 过程/ 中/ 产生/ 满足/ 目标/ 网络/ 环境/ 且/ 具有/ 指定/ 流速/ 的/ 流量/ 的/ 问题/ ./ 在/ 直接/ 网络/ 场景/ 再现/ 过程/ 中/ ,/ 由于/ 数据包/ 被/ 直接/ 注入/ 到/ 测试/ 网络/ ,/ 在/ 流量/ 产生/ 过程/ 中/ 对/ 流速/ 进行/ 控制/ 是/ 一个/ 相对/ 较为简单/ 的/ 问题/ ,/ 而/ 在/ 互动式/ 场景/ 再现/ 过程/ 中/ 对/ 流速/ 进行/ 控制/ 则/ 较为/ 复杂/ ,/ 其/ 主要/ 原因/ 如下/ :/ (/ 1/ )/ 作为/ 系统/ 输入/ 的/ 网络流量/ 的/ 不稳定性/ ./ 大量/ 研究/ 表明/ 真实/ 网络流量/ 是/ 一个/ 非常复杂/ 的/ 非/ 平稳/ 过程/ [/ 17/ -/ 19/ ]/ ,/ 各种/ 特征/ 诸如/ 流量/ 大小/ 、/ 数据包/ 大小/ ,/ IP地址/ 和/ 端口/ 分布/ 等/ 均/ 是/ 随/ 时间/ 动态变化/ 的/ ./ 特别/ 是/ 由于/ 互动式/ 流量/ 回放/ 过程/ 是/ 基于/ 流/ 来/ 产生/ 测试/ 流量/ ,/ 流量/ 中/ 各种/ 与/ 流/ 相关/ 的/ 特征/ 诸如/ 流/ 的/ 长短/ 、/ 流/ 的/ 持续时间/ 和/ 流/ 的/ 到达/ 速率/ 等/ 均/ 会/ 影响/ 到/ 系统/ 性能/ ;/ (/ 2/ )/ 测试环境/ 的/ 作用/ ./ 流量/ 产生/ 过程/ 中/ 测试环境/ 的/ 丢/ 包/ 、/ 会话/ 阻断/ 和/ 数据包/ 传输/ 延迟/ 等/ 作用/ 会/ 影响/ 到/ 回放/ 时流/ 的/ 状态/ ,/ 进而/ 影响/ 到/ 回放/ 系统/ 的/ 性能/ ;/ (/ 3/ )/ 回放/ 系统/ 自身/ 的/ 动态/ 特性/ ./ 互动式/ 流量/ 回放/ 系统/ 通常/ 是/ 由/ 软件/ 实现/ ,/ 因此/ 操作系统/ 中/ 的/ 进程/ 调度/ 、/ 磁盘/ IO/ 、/ 网络/ IO/ 等/ 随机因素/ 也/ 会/ 影响/ 到/ 流量/ 回放/ 过程/ ./ 考虑/ 到/ 互动式/ 场景/ 再现/ 过程/ 的/ 复杂性/ ,/ 对/ 其/ 建立/ 精确/ 的/ 数学模型/ 并/ 基于/ 模型/ 进行/ 流速/ 控制/ 便/ 成为/ ①/ ②/ ③/ ④/ Page3/ 了/ 一个/ 非常/ 困难/ 的/ 过程/ ./ 由于/ 不/ 知道/ 系统/ 的/ 数学模型/ ,/ 一些/ 传统/ 基于/ 模型/ 的/ 控制/ 方法/ (/ 如/ H/ 无穷/ 最优控制/ 、/ 模型/ 参考/ 控制/ 等等/ )/ 便/ 无法/ 适用/ ./ 在/ 文中/ ,/ 我们/ 设计/ 实现/ 了/ 一个/ 面向/ 互动式/ 网络/ 场景/ 再现/ 的/ 流速/ 控制系统/ ,/ 并/ 将/ 网络/ 场景/ 再现/ 过程/ 中/ 的/ 流速/ 控制/ 问题/ 转化/ 为/ 目标/ 跟踪/ 控制/ 问题/ 进行/ 求解/ ./ 所/ 设计/ 的/ 系统/ 采用/ 一种/ 基于/ 函数/ 近似/ 器/ 的/ 流速/ 控制/ 方法/ ,/ 利用/ 函数/ 近似/ 器/ 对系统/ 的/ 输入输出/ 关系/ 进行/ 描述/ ,/ 通过/ 动态/ 调整/ 系统/ 输入/ 流量/ 来/ 对/ 回放/ 过程/ 输出/ 流量/ 进行/ 跟踪/ ,/ 并/ 同时/ 通过/ 并行/ 扰动/ 随机/ 估计/ 理论/ [/ 20/ ]/ 对/ 近似/ 器中/ 的/ 参数/ 进行/ 实时/ 估计/ ./ 该/ 系统/ 的/ 最大/ 优点/ 在于/ 可以/ 在/ 并不知道/ 系统/ 模型/ 的/ 情况/ 下/ 仍然/ 对/ 复杂/ 过程/ 进行/ 有效/ 控制/ ./ 我们/ 采用/ 真实/ 网络流量/ 对/ 所/ 提出/ 的/ 流量/ 控制系统/ 和/ 方法/ 在/ 不同/ 网络/ 环境/ 下/ 的/ 实际/ 控制/ 效果/ 进行/ 了/ 分析/ 与/ 验证/ ./ 实验/ 结果表明/ ,/ 本文/ 所/ 设计/ 实现/ 的/ 流速/ 控制系统/ 可以/ 精确/ 地/ 对/ 回放/ 过程/ 产生/ 的/ 流速/ 进行/ 控制/ ,/ 在/ 测试/ 网络/ 丢/ 包率/ 达到/ 10/ %/ 以及/ 会话/ 阻断/ 率/ 达到/ 30/ %/ 等/ 极端/ 情况/ 下/ ,/ 系统/ 仍然/ 能够/ 达到/ 很/ 好/ 的/ 控制/ 效果/ ./ 此外/ ,/ 还/ 从/ 控制/ 过程/ 的/ 收敛/ 时间/ 、/ 产生/ 输入输出/ 以及/ 控制/ 误差/ 等/ 角度/ 对/ 该/ 系统/ 的/ 控制/ 性能/ 进行/ 了/ 分析/ ./ 本文/ 第/ 2/ 节/ 介绍/ 相关/ 研究/ 工作/ ;/ 第/ 3/ 节/ 介绍/ 互动式/ 网络/ 场景/ 再现/ 过程/ 流速/ 控制/ 问题/ ;/ 第/ 4/ 节对/ 影响/ 互动式/ 网络/ 场景/ 再现/ 过程/ 产生/ 流速/ 的/ 因素/ 进行/ 分析/ ;/ 第/ 5/ 节/ 介绍/ 基于/ 函数/ 近似/ 器/ 和/ 并行/ 扰动/ 随机/ 估计/ 理论/ 的/ 流速/ 控制系统/ 和/ 方法/ ;/ 第/ 6/ 节/ 给出/ 用/ 真实/ 网络流量/ 对/ 所/ 提/ 系统/ 和/ 方法/ 实际/ 控制/ 效果/ 进行/ 实验/ 验证/ 与/ 分析/ 的/ 结果/ ;/ 第/ 7/ 节对/ 全文/ 工作/ 进行/ 小结/ 并/ 对/ 未来/ 进行/ 展望/ ./ 2/ 相关/ 研究/ 工作/ 基于/ 真实/ 网络流量/ 的/ 场景/ 再现/ 研究/ 工作/ 始于/ 2001/ 年/ 左右/ ./ 最早/ 研究/ 人员/ 在/ sourceforge/ 上/ 建立/ 了/ TCPDump/ ①/ 和/ Libpcap/ ②/ 等/ 开源/ 项目/ ,/ 用于/ 开发/ 在/ 网络/ 中/ 能够/ 实时/ 捕获/ 数据/ 报文/ 的/ 系统/ ./ 在/ 这/ 之后/ 很大/ 一部分/ 研究/ 开始/ 转向/ 流量/ 还原/ 回放/ 方面/ ./ 文献/ [/ 7/ ]/ 介绍/ 了/ TCPivo/ —/ —/ —/ 一个/ Linux/ 平台/ 下/ 的/ 高性能/ 数据包/ 回放/ 系统/ ,/ 并/ 提出/ 了/ 一些/ 用于/ 提高/ 数据/ 报文/ 回放/ 效率/ 的/ 系统/ 实现/ 方法/ ;/ Monkey/ [/ 8/ ]/ 是/ 加州大学/ 和/ Google/ 共同开发/ 出来/ 用于/ 测试/ 服务器端/ 性能/ 的/ 流量/ 回放/ 系统/ ,/ 分为/ Monkeysee/ 和/ Monkeydo/ 两个/ 功能模块/ ,/ Monkeysee/ 用于/ 在/ 服务器端/ 一侧/ 捕获/ 服务器/ 与/ 客户端/ 交互/ 的/ 流量/ ,/ 并/ 提取/ 包括/ 数据/ 报文/ 间隔/ 、/ 网络/ 传输/ 延迟/ 、/ 丢/ 包率/ 等/ 参数信息/ ;/ 而/ Monkeydo/ 用于/ 模拟/ 客户端/ 和/ 传输/ 网络/ 行为/ ,/ 根据/ 接收/ 到/ 的/ 服务器端/ 发送/ 过来/ 的/ 数据包/ 来/ 产生/ (/ 回放/ )/ 客户端/ 的/ 流量/ ,/ 以此/ 考察/ 服务器端/ 的/ 参数/ 变化/ (/ 如/ 不同/ 的/ 缓存/ 大小/ )/ 对于/ 网络服务/ 性能/ 的/ 影响/ ./ 文献/ [/ 9/ -/ 11/ ]/ 考察/ 了/ 大规模/ 网络流量/ 并行/ 回放/ 中/ 的/ 流/ 分割/ 和/ 回放/ 质量/ 评估/ 问题/ ./ 上述/ 研究/ 工作/ 主要/ 定/ 位于/ 对/ 捕获/ 流量/ 进行/ 单向/ 回放/ ./ 在/ TCPReplay/ 和/ Tomahawk/ 中/ ,/ 研究/ 人员/ 开发/ 出/ 用于/ 测试/ 各类/ 串接/ 型/ 设备/ 的/ 数据/ 报文/ 回放/ 系统/ ./ 该类/ 系统/ 采用/ 了/ 流量/ 的/ 双向/ 收发/ 机制/ ,/ 即/ 利用/ 两个/ 测试/ 接口/ 来回/ 放/ 捕获/ 的/ 双向/ 流量/ ,/ 每个/ 测试/ 接口/ 用来/ 回放/ 一个/ 方向/ 的/ 流量/ 并/ 接收/ 来自/ 另外/ 一个/ 方向/ 的/ 流量/ ;/ 被测/ 设备/ 串接/ 在/ 两个/ 测试/ 接口/ 之间/ ,/ 回放/ 系统/ 通过/ 对比/ 接收/ 的/ 流量/ 和/ 回放/ 的/ 原始/ 流量/ 来/ 考察/ 串接/ 设备/ 对于/ 流量/ 施加/ 的/ 作用/ ./ 为了/ 解决/ 流量/ 直接/ 回放/ 方法/ 在/ 测试/ IPS/ 、/ Firewall/ 等/ 各类/ 串接/ 型/ 安全设备/ 过程/ 中/ 产生/ 大量/ 违反/ 协议/ 语义/ 数据包/ 的/ 问题/ ,/ 在/ 2005/ 年/ 加州大学/ 的/ Hong/ 和/ Wu/ 首次/ 提出/ 了/ 互动式/ 的/ 网络流量/ 场景/ 再现/ 方法/ ,/ 并/ 开发/ 了/ 原型/ 系统/ TCPOpera/ [/ 12/ ]/ ./ 在/ 这种/ 新型/ 的/ 流量/ 回放/ 方法/ 中/ ,/ 除了/ 采用/ 流量/ 的/ 双向/ 收发/ 机制/ 外/ ,/ 回放/ 系统/ 还/ 模拟/ 实现/ 了/ TCP/ // IP/ 协议/ 栈/ ,/ 为/ 每个/ 被/ 回放/ TCP/ 流会话/ 维护/ 状态/ ./ 在/ 流量/ 回放/ 时/ ,/ 回放/ 系统/ 严格/ 根据/ TCP/ // IP/ 协议/ ,/ 采用/ 基于/ 状态/ 的/ 方法/ 来回/ 放/ TCP/ 流量/ ./ 由于/ 在/ 流量/ 产生/ 过程/ 中/ 考虑/ 了/ 数据包/ 之间/ 的/ 协议/ 语义/ 并/ 模拟/ 会话/ 两侧/ 的/ 行为/ 来/ 产生/ 流量/ ,/ 互动式/ 网络流量/ 回放/ 方法/ 可以/ 产生/ 满足/ 协议/ 语义/ 的/ 流量/ ,/ 并/ 通过/ 产生/ 流量/ 的/ 变化/ 反映/ 被测/ 设备/ 的/ 作用/ ,/ 达到/ 考察/ 被测/ 设备/ 串接/ 在/ 实际/ 网络/ 时/ 的/ 功能/ 和/ 性能/ 的/ 目的/ ./ 文献/ [/ 13/ ]/ 对/ 互动式/ 流量/ 回放/ 测试/ 系统/ 的/ 具体/ 实现/ 作/ 了/ 详细/ 的/ 介绍/ ./ 也/ 有/ 学者/ 将/ 仿真/ 方法/ 和/ 流量/ 回放/ 技术相结合/ 来/ 产生/ 目标/ 流量/ ,/ 如/ 文献/ [/ 21/ -/ 22/ ]/ ./ 本文/ 作者/ 所在/ 研究/ 小组/ 自/ 2007/ 年/ 开始/ 对/ 互动式/ 网络/ 场景/ 再现/ 方法/ 进行/ 了/ 相关/ 研究/ ./ 在/ 文献/ [/ 14/ -/ 15/ ]/ 中/ ,/ 作者/ 基于/ TCP/ 协议/ 的/ 确认/ 机制/ 和/ 停/ 等/ 特性/ (/ 在/ 流量/ 回放/ 时/ 体现/ 为/ 收发/ 平衡/ 现象/ )/ ,/ 提出/ 了/ 一种/ 基于/ 收发/ 平衡/ 和/ 状态/ 判定/ 相结合/ 的/ 新/ 的/ TCP/ 流量/ 回放/ ①/ ②/ Page4/ 方法/ ./ 通过/ 在/ 回放/ TCP/ 流量/ 时/ 将/ 满足/ 收发/ 平衡条件/ 的/ 数据包/ 优先/ 发送/ 出去/ ,/ 所提/ 方法/ 能够/ 在/ 保持/ TCP/ 流量/ 回放/ 语义/ 的/ 前提/ 下/ ,/ 有效/ 减少/ 数据包/ 发送/ 时/ 的/ 状态/ 判定/ 开销/ ,/ 从而/ 提升/ 回放/ 性能/ ./ 而/ 本文/ 的/ 研究/ 工作/ 则/ 是/ 关注/ TCP/ 流量/ 回放/ 过程/ 在/ 受到/ 丢包/ 、/ 传输/ 延迟/ 和/ 会/ 话/ 阻断/ 等/ 网络/ 环境/ 作用/ 时/ 的/ 流速/ 控制/ 问题/ ./ 因此/ ,/ 虽然/ 两者/ 的/ 研究/ 对象/ 均/ 为/ 互动式/ 流量/ 回放/ 过程/ ,/ 但是/ 关注点/ 不同/ ./ 与/ 本文/ 研究/ 工作/ 最为/ 接近/ 的/ 是/ 加州大学/ 的/ Vishwanash/ 和/ Vahdat/ 的/ 工作/ ,/ 他们/ 开发/ 的/ Swing/ [/ 23/ ]/ 是/ 一个/ 将/ 网络/ 模型/ 和/ 真实/ 流量/ 数据/ 相结合/ 的/ 流量/ 产生/ 系统/ ./ 具体/ 地/ ,/ Vishwanash/ 和/ Vahdat/ 认为/ 产生/ 真实/ 网络流量/ 需要/ 一个/ 层次化/ 模型/ ,/ 从上到下/ 分别/ 对应/ 用户/ 层/ 、/ 会话层/ 、/ 链接/ 层/ 和/ 网络层/ ./ 他们/ 将/ 产生/ 流量/ 的/ 模型/ 参数/ 分成/ 两类/ ,/ 一类/ 是/ 流量/ 特征参数/ ,/ 包括/ 应用层/ 协议/ 分布/ 、/ 会话/ 大小/ 、/ 会话/ 时间/ 间隔/ 、/ 链接/ 数目/ 、/ 链接/ 到达/ 速率/ 等/ ;/ 另外/ 一类/ 是/ 网络/ 特征参数/ ,/ 包括/ 数据包/ 丢/ 包率/ 、/ 传输/ 延迟/ 和/ 链路/ 带宽/ ./ 从/ 捕获/ 流量/ 中/ 提取/ 出/ 这些/ 参数/ 之后/ ,/ Vishwanash/ 和/ Vahdat/ 通过/ 搭建/ 模拟/ 环境/ (/ 包括/ 两端/ 的/ 流量/ 产生器/ 和/ 中间/ 的/ 网络/ 仿真器/ )/ 来/ 产生/ 流量/ ./ 具体/ 产生/ 流量/ 的/ 方法/ 是/ 在/ 流量/ 产生器/ 中/ 设置/ 链接/ 产生/ 时间/ 、/ 链接/ 大小/ 、/ 链接/ 持续时间/ 等/ 相关/ 流量/ 特征参数/ ,/ 而/ 在/ 网络/ 仿真器/ 中/ 设置/ 丢/ 包率/ 、/ 传输/ 延迟/ 等/ 网络/ 参数/ ./ 与/ Swing/ 系统/ 相比/ ,/ 本文/ 工作/ 虽然/ 也/ 是/ 通过/ 搭建/ 模拟/ 环境/ 来/ 产生/ 流量/ ,/ 但/ 存在/ 如下/ 不同之处/ :/ (/ 1/ )/ 本文/ 工作/ 通过/ 在/ 模拟/ 环境/ 中/ 回放/ 捕获/ 的/ 真实/ 流量/ 来/ 产生/ 用户/ 需要/ 的/ 流量/ ,/ 无需/ 对/ 真实/ 流量/ 中/ 的/ 特征参数/ 进行/ 提取/ ./ (/ 2/ )/ 本文/ 工作/ 通过/ 模拟/ TCP/ // IP/ 协议/ 栈/ 来回/ 放/ 捕获/ 的/ 网络流量/ ,/ 产生/ 的/ 数据/ 是/ 真实/ 的/ 网络流量/ (/ 数据包/ 内容/ 与/ 原始/ 网络流量/ 相同/ )/ ./ 而/ Swing/ 系统/ 则/ 图/ 1/ 基于/ 互动式/ 流量/ 回放/ 过程/ 产生/ 目标/ 流量/ 的/ 方法/ 示意图/ 是/ 通过/ 在/ 流量/ 产生器/ 中/ 建立/ 真实/ TCP/ 链接/ 来/ 传输/ 一定/ 大小/ 人工/ 仿真/ 数据/ 的/ 方法/ 来/ 产生/ 流量/ ./ 因此/ ,/ 两者/ 产生/ 流量/ 的/ 机理/ 不同/ ./ Swing/ 系统/ 更多地/ 关注/ 产生/ 流量/ 的/ 特征参数/ 符合/ 真实/ 网络/ 特性/ ,/ 对/ 流量/ 中/ 传输/ 内容/ 并/ 不/ 关注/ ./ 而/ 本文/ 工作/ 则/ 关注/ 流量/ 内容/ 的/ 真实性/ ./ (/ 3/ )/ 本文/ 主要/ 研究/ 回放/ 过程/ 在/ 受到/ 传输/ 网络/ 作用/ 的/ 条件/ 下/ 的/ 流速/ 控制/ 问题/ ,/ 而/ Swing/ 系统/ 则/ 主要/ 解决/ 产生/ 满足/ 网络/ 环境/ 特征/ 的/ 流量/ (/ 产生/ 流量/ 的/ 特征参数/ 分布/ 符合/ 真实/ 网络流量/ )/ 的/ 问题/ ./ 3/ 互动式/ 网络/ 场景/ 再现/ 流速/ 控制/ 3.1/ 基于/ 互动式/ 场景/ 再现/ 的/ 流量/ 产生/ 方法/ 除了/ 用于/ 设备/ 测试/ ,/ 互动式/ 网络/ 场景/ 再现/ 还/ 可用/ 来/ 当作/ 真实/ 网络流量/ 的/ 产生/ 机制/ ,/ 用于/ 产生/ 目标/ 网络/ 环境/ 下/ 符合/ 协议/ 语义/ 的/ 真实/ 流量/ ./ 由于/ 实际/ 网络流量/ 通常/ 是/ 在/ 某个/ 特定/ 时间/ 特定/ 网络/ 环境/ 下/ 捕获/ 的/ ,/ 而/ 对/ 设备/ 进行/ 测试/ 时/ 往往/ 又/ 需要/ 一些/ 具有/ 指定/ 网络/ 环境/ 的/ 流量/ (/ 比如/ 需要/ 一定/ 丢/ 包率/ 和/ 网络/ 延迟/ 环境/ 的/ 真实/ 流量/ ,/ 用来/ 当作/ 背景/ 流量/ 对/ IDS/ 等/ 设备/ 进行/ 功能/ 和/ 性能/ 测试/ ,/ 而/ 实际/ 这样/ 的/ 网络/ 环境/ 却/ 不/ 容易/ 获得/ )/ ./ 在/ 这种/ 情况/ 下/ ,/ 就/ 需要/ 对/ 从/ 实际/ 网络/ 中/ 捕获/ 到/ 的/ 真实/ 流量/ 进行/ 变换/ (/ 从/ 流量/ 捕获/ 时/ 的/ 原始/ 网络/ 环境映射/ 到/ 目标/ 网络/ 环境/ )/ ,/ 使/ 之/ 产生/ 目标/ 网络/ 环境/ 下/ 满足/ 协议/ 语义/ 的/ 流量/ ./ 由于/ 网络流量/ 的/ 复杂性/ ,/ 直接/ 基于/ 原始/ 流量/ 产生/ 目标/ 流量/ 的/ 仿真/ 方法/ 很/ 容易/ 破坏/ 产生/ 流量/ 的/ 协议/ 语义/ ,/ 而/ 互动式/ 流量/ 回放/ 方法/ 具有/ 保持/ 流量/ 协议/ 语义/ 的/ 特性/ ,/ 因此/ 可用/ 来/ 产生/ 指定/ 网络/ 环境/ 下/ 的/ 真实/ 流量/ ./ 图/ 1/ 是/ 基于/ 互动式/ 流量/ 回放/ 过程/ 产生/ 目标/ 流量/ 的/ 方法/ 示意图/ ./ 如图/ 1/ (/ a/ )/ 所示/ ,/ 在/ 具体/ 应用/ 该/ 方法/ 之前/ ,/ 一般/ 需要/ 先对/ 原始/ 流量/ 进行/ 处理/ (/ 比如/ 去除/ 重/ Page5/ 传/ 的/ 数据包/ 、/ 过滤/ 掉/ 不/ 需要/ 的/ 流量/ 等/ )/ ./ 之后/ ,/ 将/ 一台/ 可/ 配置/ 丢/ 包率/ 、/ 数据包/ 传输/ 延迟/ 等/ 环境参数/ 的/ 网络/ 仿真/ 设备/ 当作/ 中间设备/ 串接/ 在/ 互动式/ 流量/ 回放/ 系统/ 中/ (/ 该/ 网络/ 仿真/ 设备/ 用于/ 模拟/ 目标/ 网络/ 环境/ ,/ 见图/ 1/ (/ b/ )/ )/ ,/ 通过/ 控制/ 互动式/ 流量/ 回放/ 过程/ 产生/ 指定/ 网络/ 条件/ 下/ 的/ 符合/ 协议/ 语义/ 的/ 目标/ 流量/ ./ 3.2/ 互动式/ 网络/ 场景/ 再现/ 过程/ 的/ 流速/ 控制/ 互动式/ 网络/ 场景/ 再现/ 的/ 核心/ 是/ 流量/ 的/ 双向/ 收发/ 以及/ 基于/ 状态/ 的/ 流量/ 产生/ 机制/ ./ 在/ 系统/ 实现/ 中/ 涉及/ 到/ 磁盘/ IO/ 、/ 网络/ IO/ 、/ 会话/ 状态/ 维护/ 和/ 管理/ 等/ 多个/ 方面/ ./ 基于/ 流量/ 在/ 回放/ 时/ 的/ 具体/ 处理/ 流程/ 以及/ 系统/ 实现/ 时/ 的/ 性能/ 考虑/ (/ 如/ 磁盘/ IO/ 和/ 网络/ IO/ 的/ 并行/ 化等/ )/ ,/ 互动式/ 流量/ 回放/ 过程/ 通常/ 包含/ 如下/ 5/ 个子/ 过程/ (/ 如图/ 2/ )/ :/ ①/ 数据包/ 输入/ 子/ 过程/ ./ 该/ 过程/ 从/ 磁盘/ 文件/ 中/ 依序/ 读入/ 数据包/ ,/ 并/ 至于/ 系统/ 的/ 输入/ 缓冲区/ 中/ ./ ②/ 流量/ 回放/ 子/ 过程/ ./ 该/ 过程/ 从/ 系统/ 输入/ 缓冲区/ 中/ 获取/ 数据包/ ,/ 并/ 根据/ 对应/ 会话/ 的/ 状态/ ,/ 采用/ 基于/ 状态/ 判定/ 的/ 方法/ 尝试/ 发送/ 该/ 数据包/ ./ 如果/ 待/ 发送/ 数据包/ 通过/ 状态/ 判定/ ,/ 则/ 回放/ 系统/ 直接/ 调用/ 对应/ 的/ 网络/ 测试/ 接口/ 将/ 数据包/ 发送/ 出去/ 并/ 更新/ 对应/ 会话/ 的/ 状态/ ;/ 否则/ ,/ 该/ 数据包/ 将/ 被/ 缓存/ 于/ 系统/ 中/ 并/ 等待/ 会话/ 状态/ 更新/ 后/ 再次/ 发送/ ./ ③/ 数据包/ 接收/ 子/ 过程/ ./ 该/ 过程/ 从/ 回放/ 系统/ 的/ 网络/ 测试/ 接口/ 中/ 提取/ 到达/ 的/ 数据包/ ,/ 并/ 至于/ 系统/ 的/ 接收/ 数据包/ 缓冲区/ 中/ ./ ④/ 会话/ 接收/ 更新/ 子/ 过程/ ./ 该/ 过程/ 从/ 回放/ 系统/ 的/ 接收/ 数据包/ 缓冲区/ 中/ 取出/ 到达/ 系统/ 的/ 数据包/ ,/ 并/ 根据/ 数据包/ 包含/ 的/ 协议/ 状态/ 信息/ 更新/ 对应/ 会话/ 的/ 状态/ ;/ 在/ 会/ 话/ 状态/ 更新/ 后/ ,/ 该/ 过程/ 还/ 负责/ 将/ 缓存/ 于/ 系统/ 中/ 满足/ 发送/ 条件/ 的/ 数据包/ 发送/ 出去/ ./ ⑤/ 超时/ 重传/ 子/ 过程/ :/ 该/ 过程/ 负责/ 将/ 当前/ 系统/ 已经/ 发送/ 出去/ 但/ 尚未/ 被/ 系统/ 另外/ 一个/ 测试/ 接口/ 接收/ 到/ 的/ 超时/ 的/ 数据/ 报文/ 依据/ 网络协议/ 规范/ 进行/ 重传/ ./ 本文/ 考虑/ 在/ 互动式/ 流量/ 回放/ 过程/ 中/ ,/ 通过/ 调整/ 系统/ 输入/ 流量/ 速率/ 来/ 控制/ 回放/ 过程/ 输出/ 流量/ ./ 由于/ 不/ 知道/ 具体/ 数学模型/ ,/ 因此/ 考虑/ 基于/ 系统/ 输入输出/ 信息/ 来/ 对系统/ 进行/ 控制/ ./ 该/ 问题/ 建模/ 成/ 离散/ 时间/ 目标/ 跟踪/ 控制/ 问题/ ,/ 具体/ 描述/ 如下/ :/ 将/ 互动式/ 流量/ 回放/ 过程/ 视为/ 一个/ 动态/ 的/ 含有/ 噪声/ 的/ 非线性/ 过程/ ,/ 其中/ 系统/ 数学/ 方程/ 并/ 不/ 可知/ ,/ 但/ 却/ 可以/ 通过/ 测量/ 得到/ 一系列/ 离散/ 时间/ 回放/ 过程/ 输出/ 流量/ 信息/ ./ 记/ 回放/ 控制/ 的/ 目标/ 流量/ 大小/ 为/ t1/ ,/ t2/ ,/ …/ ,/ 测量/ 得到/ 的/ 离散/ 时间/ 系统/ 输出/ 流量/ 大小/ 为/ y1/ ,/ y2/ ,/ …/ ,/ 相应/ 的/ 输入/ 流量/ 控制/ 为/ u0/ ,/ u1/ ,/ …/ ./ 其中/ ,/ 当前/ 时刻/ k/ 的/ 系统/ 输入/ uk/ 影响/ yk/ +/ 1/ ,/ yk/ +/ 2/ ,/ …/ ./ 基于/ 到/ 当前/ 为止/ 的/ 历史/ 流量/ 输出/ 信息/ y1/ ,/ y2/ ,/ …/ ,/ yk/ 以及/ 历史/ 控制/ u0/ ,/ u1/ ,/ …/ ,/ uk/ -/ 1/ ,/ 回放/ 过程/ 流速/ 控制/ 的/ 目标/ 是/ 决定/ 当前/ 时刻/ k/ 的/ 输入/ uk/ ,/ 以便/ 在/ 该/ 输入/ 下/ 回放/ 过程/ 产生/ 的/ 下/ 一个/ 时刻/ 的/ 输出/ yk/ +/ 1/ 满足/ 目标值/ tk/ +/ 1.4/ 影响/ 网络/ 场景/ 再现/ 过程/ 产生/ 流速/ 的/ 因素/ 分析/ 本节/ 将/ 从/ 网络/ 环境/ 行为/ 以及/ 网络流量/ 特性/ 两大/ 方面/ 对/ 影响/ 互动式/ 网络/ 场景/ 再现/ 过程/ 产生/ 流速/ 的/ 因素/ 进行/ 分析/ ./ 4.1/ 网络/ 环境/ 行为/ 互动式/ 网络/ 场景/ 再现/ 过程/ 的/ 本质/ 是/ 模拟/ TCP/ // IP/ 协议/ 栈来/ 对/ TCP/ 流量/ 传输/ 过程/ 进行/ 再现/ ./ 因此/ ,/ 所有/ 影响/ TCP/ 传输/ 性能/ 的/ 网络/ 行为/ 都/ 会/ 影响/ 到/ 回放/ 过程/ ./ 以下/ 分别/ 从/ 网络/ 丢包/ 、/ 传输/ 延迟/ 、/ 会话/ 阻断/ 以及/ 报文/ 乱序/ 等/ 几/ 方面/ 进行/ 分析/ ,/ 并/ 对/ 这些/ 因素/ 影响/ TCP/ 流量/ 回放/ 过程/ 的/ 机理/ 进行/ 说明/ ./ (/ 1/ )/ 网络/ 丢包/ ./ 网络/ 传输/ 过程/ 中/ 的/ 数据包/ 丢包/ 行为/ 会/ 影响/ 到/ TCP/ 流量/ 的/ 传输/ 性能/ ./ 根据/ TCP/ // IP/ 协议/ 规范/ ,/ 丢包/ 是/ 网络/ 发生/ 拥塞/ 的/ 表现/ ./ TCP/ 发送/ 端/ 在/ 通过/ 超时/ 机制/ 感知/ 到/ 丢/ 包/ 发生/ 时/ ,/ 会/ 减小/ 数据/ 发送窗口/ 并/ 进入/ 拥塞/ 避免/ 阶段/ [/ 24/ ]/ ,/ 同时/ 对/ 丢失/ 的/ 数据/ 报文/ 进行/ 重传/ ./ 由于/ 发送窗口/ 减小/ ,/ TCP/ 数据/ 传输速率/ 也/ 随之/ 降低/ ./ (/ 2/ )/ 传输/ 延迟/ ./ 数据包/ 端到/ 端/ 传输/ 延迟/ 也/ 会/ 影响/ 到/ TCP/ 流量/ 的/ 传输/ 性能/ ./ 根据/ 文献/ [/ 25/ ]/ ,/ TCP/ 会话/ 的/ 吞吐/ 率/ 与/ 网络/ 传输/ 延迟/ 近似/ 成反比/ 关系/ ,/ 即/ 网络/ Page6/ 传输/ 延迟/ 越大/ ,/ 则/ TCP/ 流量/ 的/ 传输/ 性能/ 也/ 就/ 越/ 低/ ./ (/ 3/ )/ 会话/ 阻断/ ./ 在/ 实际/ 的/ 流量/ 传输/ 过程/ 中/ ,/ 若/ 一个/ TCP/ 会话/ 被/ 阻断/ (/ 如/ 接收/ 到/ Firewall/ 发送/ 的/ RST/ 报文/ )/ ,/ 则/ 该会/ 话/ 将/ 会/ 被/ 终止/ ,/ 且/ 其/ 后续/ 的/ 流量/ 将/ 不再/ 传输/ ./ (/ 4/ )/ 报文/ 乱序/ ./ 报文/ 乱序/ 对/ TCP/ 传输/ 性能/ 的/ 影响/ 体现/ 在/ 接收端/ 的/ 确认/ 行为/ 上/ ./ 当/ 发送/ 方/ 传输/ 的/ 数据/ 报文/ 在/ 网络/ 中/ 发生/ 乱序/ 时/ ,/ 接收/ 方将/ 需要/ 缓存/ 乱序/ 到达/ 的/ 数据/ 报文/ [/ 26/ ]/ ./ 对于/ 采用/ 累计/ 确认/ 的/ TCP/ 协议/ 实现/ ,/ 报文/ 乱序/ 将/ 明显降低/ TCP/ 的/ 数据传输/ 效率/ ./ 4.2/ 输入/ 流量/ 特性/ 除了/ 丢包/ 、/ 传输/ 延迟/ 等/ 网络/ 环境/ 行为/ ,/ 输入/ 流量/ 特性/ 同样/ 会/ 影响/ 到/ 回放/ 过程/ ./ 由于/ 被/ 回放/ 流量/ 通常/ 是/ 由/ 多个/ TCP/ 会话/ 组成/ ,/ 因此/ ,/ 从/ 单个/ TCP/ 会话/ 特性/ 以及/ 会话/ 并发/ 两个/ 方面/ 进行/ 分析/ ./ (/ 1/ )/ 单个/ TCP/ 会话/ 特性/ :/ 从/ 真实/ 网络/ 中/ 采集/ 的/ 流量/ 包含/ 多种/ 应用/ ,/ 产生/ 的/ TCP/ 会话/ 特性/ 也/ 会/ 根据/ 应用/ 的/ 不同/ 而/ 不同/ ./ 参考文献/ [/ 1/ ]/ ,/ 我们/ 将/ TCP/ 会话/ 大体/ 分成/ 两类/ ,/ 一类/ 是/ 交互式/ 会话/ ,/ 对应/ 的/ 应用/ 包括/ Telnet/ 、/ SSH/ 、/ Rlogin/ 、/ VoIP/ 等/ ;/ 另外/ 一类/ 是/ 成块/ 数据传输/ 会话/ ,/ 如/ FTP/ 文件传输/ 、/ 文件共享/ 等/ ./ 对于/ 交互式/ 会话/ ,/ 一般来说/ 这类/ 会/ 话/ 的/ 流速/ 较/ 低/ ,/ 数据包/ 之间/ 的/ 时间/ 间隔/ 相对/ 较长/ ,/ 因此/ ,/ 在/ 相同/ 的/ 输出/ 流速/ 下/ 需要/ 并发/ 的/ 会/ 话/ 个数/ 较/ 多/ ;/ 而/ 成块/ 数据传输/ 的/ 会/ 话/ 对应/ 的/ 流速/ 较/ 高/ ,/ 数据包/ 之间/ 的/ 时间/ 间隔/ 较/ 短/ ,/ 通常/ 情况/ 下/ 同一/ 时刻/ 发送窗口/ 中会/ 有/ 多个/ 数据/ 报文/ 进行/ 传输/ ./ 因此/ ,/ 在/ 相同/ 的/ 输出/ 流速/ 下/ 需要/ 的/ 并发/ 会话/ 个数/ 也/ 较/ 少/ ./ (/ 2/ )/ 输入/ 流量/ 的/ 会/ 话/ 并发/ :/ 会话/ 并发/ 会/ 显著/ 改变/ 流量/ 回放/ 过程/ 输出/ 速率/ ./ 站/ 在/ 回放/ 过程/ 流速/ 控制/ 的/ 角度/ 来看/ ,/ 当/ 网络/ 丢包/ 、/ 传输/ 延迟/ 、/ 会话/ 阻断/ 以及/ 报文/ 乱序/ 等/ 现象/ 越/ 严重/ 时/ ,/ 单个/ TCP/ 会话/ 的/ 传输/ 性能/ 也/ 就/ 越/ 低/ ./ 因此/ ,/ 为了/ 产生/ 相同/ 速率/ 的/ 流量/ ,/ 回放/ 系统/ 需要/ 在/ 同一/ 时刻/ 回放/ 尽可能/ 多/ 的/ 并发/ 会话/ ,/ 也/ 即/ 在/ 系统控制/ 时/ 需要/ 施加/ 更大/ 的/ 流量/ 输入/ 速率/ ./ 而/ 当/ 被/ 回放/ 流量/ 中/ 同一/ 时刻/ 并发/ 会话/ 数目/ 达/ 不到/ 要求/ 时/ (/ 比如/ ,/ 输入/ 流量/ 中/ 只/ 包含/ 少数几个/ 会话/ )/ ,/ 则/ 无论/ 施加/ 多大/ 输入/ 流量/ ,/ 系统/ 都/ 不/ 可能/ 产生/ 期望/ 输出/ 速率/ (/ 在/ 本文/ 实验/ 部分/ 可以/ 观察/ 到/ )/ ./ 5/ 基于/ FA/ 和/ SPSA/ 的/ 互动式/ 场景/ 再现/ 过程/ 流速/ 控制系统/ 和/ 方法/ 由于/ 互动式/ 流量/ 产生/ 机制/ 异常/ 复杂/ ,/ 很难/ 通过/ 内部/ 机理/ 分析/ 建立/ 精确/ 的/ 数学模型/ ,/ 因此/ 考虑/ 在/ 系统/ 的/ 输入/ 和/ 输出/ 层面/ 来/ 对系统/ 进行/ 建模/ 并/ 对/ 产生/ 流速/ 进行/ 控制/ ./ 以下/ 具体/ 介绍/ 基于/ 函数/ 近似/ 器/ (/ FunctionApproximator/ ,/ FA/ )/ 和/ 并行/ 扰动/ 随机/ 估计/ 理论/ (/ SPSA/ )/ 的/ 流速/ 控制系统/ 和/ 方法/ ./ 5.1/ 互动式/ 网络/ 场景/ 再现/ 过程/ 的/ FA/ 控制/ 方法/ 将/ 流量/ 回放/ 系统/ 当作/ 一个/ 黑盒/ (/ 如图/ 3/ )/ ,/ 采用/ 函数/ 近似/ 器来/ 产生/ 控制/ 输入/ 并/ 对系统/ 进行/ 控制/ ./ 函数/ 近似/ 器/ 用来/ 描述/ 目标/ 流量/ 和/ 需要/ 施加/ 流量/ 之间/ 的/ 映射/ ,/ 具体/ 数学/ 形式/ 可以/ 采用/ 多层/ 神经网络/ 、/ 代数/ 多项式/ 、/ 三角型/ 序列/ 等/ ./ 根据/ Stone/ -/ Weierstrass/ 理论/ [/ 27/ ]/ ,/ 这些/ 近似/ 器均/ 可/ 对/ 任意/ 一个/ 数学/ 函数/ 进行/ 精确/ 逼近/ ./ 我们/ 考虑/ 采用/ 结构/ 固定/ 的/ 函数/ 近似/ 器/ (/ 如/ 多层/ 神经网络/ 中层/ 数/ 和/ 节点/ 数目/ 一定/ 、/ 代数/ 多项式/ 的/ 阶数/ 一定/ )/ ,/ 但/ 却/ 可以/ 让/ 近似/ 器/ 的/ 参数/ 随/ 时间/ 动态变化/ (/ 比如/ 权重/ 可/ 动态/ 改变/ )/ ./ 函数/ 近似/ 器/ 的/ 输入/ 是/ 系统/ 观测/ 到/ 的/ 历史/ 测量/ 数据/ 和/ 历史/ 控制/ 信息/ (/ 还/ 可/ 包含/ 目标/ 流量/ 信息/ )/ ,/ 而/ 相应/ 的/ 输出/ 则/ 是/ 系统/ 当前/ 时刻/ 产生/ 的/ 控制/ ./ 假设/ 时刻/ k/ 函数/ 近似/ 器/ 的/ 输入/ 包含/ 前/ M/ 个/ 历史/ 测量/ 数据/ 和/ 前/ N/ 个/ 历史/ 控制/ 信息/ ,/ 当/ 函数/ 近似/ 器/ 参数/ 不/ 变化/ 时/ ,/ 近似/ 器/ 的/ 输入/ 可/ 简单/ 记为/ Ik/ =/ {/ yk/ ,/ yk/ -/ 1/ ,/ …/ ,/ yk/ -/ M/ +/ 1/ ;/ uk/ -/ 1/ ,/ uk/ -/ 2/ ,/ …/ ,/ uk/ -/ N/ }/ 当/ 函数/ 近似/ 器/ 的/ 参数/ 动态/ 更新/ 时/ (/ 由/ 扰动/ 机制/ 产生/ ,/ 在/ 下面/ 小节/ 将会/ 介绍/ )/ ,/ 上述/ 近似/ 器/ 的/ 输入/ 信息/ 中/ 还/ 将/ 包含/ 一部分/ 参数/ 动态/ 更新/ 时/ 得到/ 的/ 数据/ ./ 图/ 3/ 是/ 基于/ 函数/ 近似/ 器/ 进行/ 流速/ 控制/ 的/ 互动式/ 流量/ 回放/ 系统/ 示意图/ ./ 在/ 该/ 系统/ 中/ ,/ 当前/ 时刻/ k/ 函数/ 近似/ 器/ 的/ 控制/ 输入/ 是/ 目标/ 流量/ 信息/ tk/ +/ 1/ 和/ 前/ 一个/ 时刻/ 的/ 系统/ 观测/ 信息/ Ik/ =/ {/ yk/ }/ ,/ 而/ 近似/ 器/ 的/ 输出/ 则/ 直接/ 对应/ 当前/ 时刻/ 产生/ 的/ 控制/ uk/ ./ 图/ 3/ 基于/ 函数/ 近似/ 器/ 的/ 互动式/ 流量/ 回放/ 过程/ 5.2/ 基于/ SPSA/ 方法/ 的/ 参数估计/ 在/ 基于/ 函数/ 近似/ 器/ 的/ 控制系统/ 和/ 方法/ 中/ ,/ 函数/ 近似/ 器/ 被/ 用来/ 根据/ 历史/ 信息/ 产生/ 当前/ 时刻/ 需要/ 的/ 输入/ ./ 然而/ ,/ 由于/ 不/ 知道/ 近似/ 器/ 包含/ 的/ 参数/ ,/ 因此/ 需要/ 对/ 近似/ 器/ 的/ 参数/ θ/ k/ 进行/ 实时/ 估计/ ./ 在/ 假定/ 函数/ 近似/ Page7/ 器/ 结构/ 固定/ 的/ 条件/ 下/ ,/ 近似/ 器/ 的/ 参数估计/ 问题/ 等同于/ 求取/ 使得/ 代价/ 函数/ Lk/ (/ θ/ k/ )/ 最小化/ 的/ 参数/ θ/ k/ ∈/ Rp/ (/ 由于/ 近似/ 器/ 结构/ 固定/ ,/ p/ 是/ 与/ k/ 无关/ 的/ 一个/ 常量/ ,/ 代表/ 参数/ 个数/ )/ ./ 代价/ 函数/ Lk/ (/ θ/ k/ )/ 可/ 采用/ 如下/ 二次/ 型/ :/ Lk/ (/ θ/ k/ )/ =/ E/ [/ (/ 狔/ k/ +/ 1/ -/ 狋/ k/ +/ 1/ )/ T/ 犃/ k/ (/ 狔/ k/ +/ 1/ -/ 狋/ k/ +/ 1/ )/ +/ 狌/ Tk/ 犅/ k/ 狌/ k/ ]/ 式/ 中/ 犃/ k/ 和/ 犅/ k/ 是/ 两个/ 半/ 正定/ 矩阵/ ,/ 反映/ 控制器/ 对于/ 输出/ 流量/ 和/ 施加/ 控制/ 的/ 不同/ 权重/ ;/ 狔/ k/ +/ 1/ ,/ 狋/ k/ +/ 1/ ,/ 狌/ k/ 分别/ 是/ 由/ 标量/ yk/ +/ 1/ ,/ tk/ +/ 1/ 和/ uk/ 组成/ 的/ 向量/ ./ 上述/ 函数/ 近似/ 器/ 的/ 参数估计/ 问题/ 等价/ 于/ 在/ 时刻/ k/ 求取/ θ/ / k/ ,/ 使/ 之/ 满足/ 如下/ 方程/ :/ 其中/ ,/ gk/ (/ θ/ k/ )/ 即/ 为/ 代价/ 函数/ Lk/ (/ θ/ k/ )/ 对/ 参数/ θ/ k/ ∈/ Rp/ 的/ 梯度/ ./ 然而/ ,/ 由于/ 系统/ 数学模型/ 并/ 不/ 可知/ ,/ 式/ (/ 3/ )/ 中/ / Lk/ // / 狌/ k/ 项便/ 无法/ 求得/ ./ 因此/ ,/ 传统/ 基于/ 目标/ 函数/ 梯度/ 信息/ 进行/ 求解/ 的/ 方法/ 或/ 其它/ 一些/ 利用/ gk/ (/ θ/ k/ )/ 进行/ 参数/ 求解/ 的/ 方法/ 便/ 不再/ 适用/ ./ 为了/ 获取/ 系统/ 参数/ {/ θ/ k/ }/ ,/ 我们/ 考虑/ 采用/ 随机/ 估计/ 的/ 方法/ :/ 其中/ ,/ θ/ ^/ k/ 是/ k/ 时刻/ 近似/ 器/ 参数/ θ/ k/ 的/ 估计值/ ,/ {/ ak/ }/ 是/ 一个/ 满足/ 一定/ 条件/ 的/ 标量/ 序列/ ./ 此处/ ,/ 采用/ 并行/ 扰动/ 随图/ 4/ 并行/ 扰动/ 随机/ 估计/ 方法/ 的/ 算法/ 步骤/ 当/ 扰动/ 机制/ 引入/ 到/ 控制/ 过程/ 时/ ,/ 函数/ 近似/ 器/ 的/ 输入/ 将/ 包含/ 参数/ 扰动/ 后/ 得到/ 的/ 系统/ 测量/ 值/ 和/ 控制/ 输入/ ./ 此时/ ,/ 系统/ 的/ 测量/ 值/ 变为/ {/ y0/ ,/ y/ (/ +/ )/ 2/ ,/ y/ (/ -/ )/ 2/ ,/ y2/ ,/ …/ }/ ,/ 而/ 对应/ 的/ 控制/ 输入/ 也/ 将/ 变为/ y/ (/ +/ )/ {/ u0/ ,/ u/ (/ +/ )/ 1/ ,/ u/ (/ -/ )/ 生/ 的/ 控制/ 均/ 是/ 基于/ 前/ M/ 个/ 历史/ 测量/ 数据/ 和/ 前/ N/ 个/ 历史/ 控制/ 信息/ ,/ 对于/ u/ (/ +/ )/ 机/ 估计/ 方法/ (/ SPSA/ )/ [/ 20/ ]/ 进行/ 参数估计/ ,/ 该/ 方法/ 具有/ 如下/ 形式/ :/ 式/ (/ 5/ )/ 中/ g/ ^/ k/ (/ θ/ ^/ k/ -/ 1/ )/ 是/ 扰动/ 后/ gk/ (/ θ/ ^/ k/ -/ 1/ )/ 的/ 估计值/ ./ g/ ^/ k/ (/ θ/ ^/ k/ -/ 1/ )/ 的/ 第/ l/ 个/ 成员/ 变量/ (/ l/ =/ 1/ ,/ 2/ ,/ …/ ,/ p/ )/ 可以/ 由/ 如下/ 式子/ 求得/ :/ 在/ 式/ (/ 6/ )/ 中/ :/ (/ 1/ )/ L/ ^/ (/ ±/ )/ 进行/ 计算/ 得到/ 的/ 值/ ./ 对于/ 形如式/ (/ 2/ )/ 的/ 代价/ 函数/ ,/ L/ ^/ (/ ±/ )/ k/ =/ (/ 狔/ (/ ±/ )/ (/ 2/ )/ u/ (/ ±/ )/ 得到/ 的/ 函数/ 近似/ 器/ 的/ 控制/ 输出/ ,/ 其中/ Δ/ k/ =/ (/ Δ/ k1/ ,/ Δ/ k2/ ,/ …/ ,/ Δ/ kp/ )/ T/ 是/ 一个/ 随机/ 序列/ ./ 通常/ 情况/ 下/ ,/ {/ Δ/ ki/ }/ 是/ 独立/ 同/ 分布/ 、/ 有/ 界/ 、/ 相对/ 于/ 0/ 对称/ 分布/ 的/ 随机/ 量/ ,/ 并且/ / k/ ,/ i/ 满足/ E/ (/ Δ/ -/ 2/ (/ 3/ )/ y/ (/ ±/ )/ 量/ 测量/ 值/ ./ (/ 4/ )/ {/ ck/ }/ 是/ 满足/ 一定/ 条件/ 的/ 正/ 实数/ 序列/ ./ 通常/ 情况/ 下/ ,/ 根据/ 被控/ 系统/ 是否/ 稳定/ 取/ ck/ →/ 0/ 或者/ ck/ =/ c/ ./ 基于/ 并行/ 扰动/ 随机/ 估计/ 理论/ 进行/ 参数估计/ 的/ 算法/ 如图/ 4/ 所示/ ./ 似器/ 的/ 输入/ 就/ 变成/ 了/ 集合/ I/ (/ +/ )/ M/ =/ N/ =/ 2/ 且/ 当前/ 最新/ 系统/ 测量/ 值为/ y/ (/ +/ )/ 时刻/ 系统/ 的/ 控制/ u/ (/ -/ )/ k/ =/ {/ y/ (/ +/ )/ 集合/ I/ (/ -/ )/ 5.3/ 流量/ 回放/ 过程/ 流速/ 控制/ 流程/ 基于/ 函数/ 近似/ 器/ 的/ 流速/ 控制系统/ 在/ 采用/ SPSA/ 算法/ 进行/ 参数估计/ 后/ 的/ 具体/ 流速/ 控制/ 过程/ 如/ 算法/ 1/ ./ Page8/ 放/ 过程/ 流速/ 控制/ 流程/ ./ 器/ 的/ 输入/ Ik/ ;/ 算法/ 1/ ./ 基于/ 函数/ 近似/ 器/ 和/ SPSA/ 的/ 流量/ 回/ 1/ ./ 读入/ 当前/ 时刻/ k/ 的/ 参数/ 估计值/ θ/ ^/ k/ -/ 1/ 和/ 当前/ 时刻/ 近似/ 2/ ./ 参数/ 右/ 扰动/ θ/ k/ =/ θ/ ^/ k/ -/ 1/ +/ ck/ Δ/ k/ ,/ 函数/ 近似/ 器/ 根据/ 扰动/ 后/ 的/ 参数/ 和/ 当前/ 输入/ 信息/ 产生/ 需要/ 施加/ 的/ 流量/ u/ (/ +/ )/ 后/ 的/ 参数/ 和/ 当前/ 输入/ 信息/ 产生/ 需要/ 施加/ 的/ 流量/ u/ (/ -/ )/ 3/ ./ 测量/ 流量/ 回放/ 过程/ 的/ 输出/ 流量/ 大小/ y/ (/ +/ )/ 4/ ./ 计算/ 参数/ 右/ 扰动/ 后/ 的/ 代价/ 函数/ L/ ^/ (/ +/ )/ 5/ ./ 更新/ 当前/ 函数/ 近似/ 器/ 的/ 输入/ 信息/ ;/ 6/ ./ 参数/ 左/ 扰动/ θ/ k/ =/ θ/ ^/ k/ -/ 1/ -/ ck/ Δ/ k/ ,/ 函数/ 近似/ 器/ 根据/ 扰动/ 7/ ./ 测量/ 流量/ 回放/ 过程/ 的/ 输出/ 流量/ 大小/ y/ (/ -/ )/ 8/ ./ 计算/ 参数/ 左/ 扰动/ 后/ 的/ 代价/ 函数/ L/ ^/ (/ -/ )/ 9/ ./ 更新/ 当前/ 函数/ 近似/ 器/ 的/ 输入/ 信息/ ;/ 10/ ./ 根据/ 参数/ 左右/ 扰动/ 后/ 的/ 代价/ 函数/ 变化/ 信息/ 更新/ 当前/ 参数/ θ/ ^/ k/ =/ θ/ ^/ k/ -/ 1/ -/ akg/ ^/ k/ (/ θ/ ^/ k/ -/ 1/ )/ ;/ 11/ ./ 当前/ 时刻/ k/ =/ k/ +/ 1/ ;/ 12/ ./ 返回/ 步/ 1/ ,/ 直到/ 流量/ 回放/ 过程/ 结束/ ./ 采用/ 函数/ 近似/ 器/ 和/ SPSA/ 方法/ 进行/ 系统控制/ 的/ 最大/ 优点/ 在于/ 可以/ 在/ 并不知道/ 系统/ 模型/ 的/ 情况/ 下/ 仍然/ 对/ 动态/ 系统/ 进行/ 精确/ 控制/ ./ 然而/ ,/ 引入/ 参数/ 扰动/ 机制/ 也/ 给/ 该/ 方法/ 和/ 对应/ 的/ 控制系统/ 在/ 具体/ 应用/ 时/ 在/ 输入输出/ 和/ 收敛/ 时间/ 等/ 方面/ 带来/ 了/ 一些/ 副作用/ ./ 我们/ 将/ 在/ 实验/ 部分/ 对此/ 进行/ 详细/ 论述/ ./ 6/ 实验/ 验证/ 及/ 结果/ 分析/ 6.1/ 实验/ 环境/ 设置/ 为/ 考察/ 设计/ 的/ 系统/ 和/ 方法/ 的/ 实际/ 控制/ 效果/ ,/ 实现/ 了/ 一个/ 高性能/ 的/ 互动式/ 网络流量/ 回放/ 测试/ 系统/ ,/ 如图/ 5/ 所示/ ./ 整个/ 测试/ 系统/ 由/ 组成/ 测试/ 回路/ 的/ 流量/ 回放/ 服务器/ 、/ 千兆/ 交换机/ 、/ FreeBSD/ 双穴/ 主机/ (/ 当作/ 网络/ 仿真器/ )/ 和/ 流量/ 监测器/ 组成/ ./ 其中/ ,/ 流量/ 回放/ 服务器/ 由/ 一台/ 高性能/ Linux/ 服务器/ 充当/ (/ Redhat9/ ./ 0/ 系统/ ,/ 2.4/ ./ 20/ 内核/ )/ ,/ 配置/ 2/ ×/ 2.0/ GHzIntelXeon/ 处理器/ ,/ 4GBRAM/ ./ 由于/ TCP/ 协议/ 栈/ 的/ 实现/ 在/ 不同/ 的/ 操作系统/ 平台/ 以及/ 不同/ 系统/ 的/ 版本/ 下/ 存在/ 差异/ ,/ 本文/ 流量/ 回放/ 服务器/ 上/ 的/ TCP/ 协议/ 栈/ 的/ 模拟/ 实现/ 参考/ 了/ TCP/ -/ Opera/ ,/ 具体/ 也/ 是/ 基于/ BSD4/ ./ 4/ -/ LiteRELEASE/ 平台/ 的/ TCP/ 协议/ 栈/ 实现/ [/ 24/ ]/ ./ 目前/ 实现/ 的/ 一些/ 核心/ 功能/ 包括/ :/ 6/ 个/ TCP/ 计时器/ 、/ 传输/ 过程/ 中/ 的/ 数据包/ 超时/ 和/ 重传/ 、/ 快速/ 重传/ 和/ 快速/ 恢复/ 、/ 拥塞/ 控制/ 以及/ RTT/ 动态/ 测量/ 等/ ./ 网络/ 仿真器/ 的/ 实现/ 采用/ 的/ 是/ FreeBSD/ 平台/ 上/ 的/ Dummynet/ ①/ 这一/ 开源/ 工具/ ./ Dummynet/ 可/ 用于/ 模拟/ 多种/ 复杂/ 的/ 网络/ 环境/ ,/ 对/ 包括/ 传输/ 延迟/ 、/ 网络带宽/ 、/ 丢/ 包率/ 以及/ 排队/ 策略/ 等/ 在内/ 的/ 多项/ 参数/ 进行/ 选择/ 设置/ ,/ 是/ 当前/ 网络/ 研究/ 领域/ 最/ 常用/ 的/ 网络/ 仿真/ 工具/ ./ 在/ 我们/ 的/ 实验/ 中/ ,/ 将/ 网络/ 仿真/ 平台/ (/ 安装/ FreeBSD8/ ./ 1/ -/ RELEASE/ 系统/ )/ 的/ 两块/ 网卡/ 设置/ 成/ 网桥/ 模式/ 进行/ 数据/ 包转发/ ,/ 同时/ 配合/ Dummynet/ 对/ 网桥/ 传输/ 流量/ 的/ 数据包/ 延迟/ 和/ 丢/ 包率/ 进行/ 控制/ ;/ 对/ 回放/ 过程/ 会话/ 阻断/ 功能/ 的/ 实现/ 则/ 是/ 通过/ 预先/ 在/ 输入/ 流量/ 中/ 对/ 需要/ 阻断/ 会话/ 的/ 数据包/ 的/ MAC/ 地址/ 进行/ 标定/ ,/ 而后/ 在/ 网络/ 仿真/ 平台/ 上/ 通过/ IPFirewall/ 设置/ 相应/ 的/ 规则/ (/ 根据/ MAC/ 地址/ 设置/ )/ 进行/ 阻断/ ./ 此外/ ,/ 流量/ 回放/ 服务器/ 和/ FreeBSD/ 双穴/ 主机/ 均/ 配备/ Intele1000/ 千兆/ 网卡/ ,/ 整个/ 测试/ 回路/ 是/ 一个/ 纯/ 千兆/ 的/ 环境/ ./ 在/ 千兆/ 交换机/ 上将/ 回放/ 产生/ 的/ 流量/ 镜像/ 到/ 流量/ 监测器/ 上/ 进行/ 观测/ ./ 实验/ 中/ 采用/ 真实/ 网络流量/ 对/ 本文/ 方法/ 进行/ 考察/ ./ 所用/ 流量/ 在/ 西安交通大学/ 校园网/ 出口处/ 采集/ 得到/ ,/ 共/ 包含/ 超过/ 20000000/ 个/ TCP/ 数据包/ 和/ 300000/ 个/ TCP/ 会话/ ./ 实验/ 中/ 对/ 串接/ 在/ 测试/ 回路/ 中/ 的/ FreeBSD/ 双穴/ 主机/ 设置/ 不同/ 的/ 丢/ 包率/ 和/ 传输/ 延迟/ ,/ 同时/ 在/ 输入/ 流量/ 中以/ 不同/ 的/ 概率/ 对/ 阻断/ 会话/ 进行/ 标识/ ,/ 以此/ 来/ 模拟/ 不同/ 的/ 目标/ 网络/ 环境/ ./ 6.2/ 实验/ 结果/ 及/ 分析/ 考虑/ 丢包/ 、/ 数据包/ 传输/ 延迟/ 以及/ 会话/ 阻断/ 3/ 种/ 不同/ 的/ 网络/ 行为/ ,/ 实验/ 过程/ 中/ 设置/ FreeBSD/ 双穴/ 主机/ 分别/ 以/ 0.1/ %/ ,/ 1/ %/ ,/ 5/ %/ 和/ 10/ %/ 的/ 概率/ 进行/ 随机/ 丢包/ ,/ 以/ 0.1/ ms/ ,/ 1ms/ ,/ 10ms/ 进行/ 数据包/ 传输/ 延迟/ ./ 另外/ ,/ 设置/ 以/ 10/ %/ ,/ 20/ %/ 和/ 30/ %/ 的/ 概率/ 进行/ 随/ 机会/ 话/ 阻断/ ./ 这样/ 设置/ FreeBSD/ 双穴/ 主机/ 的/ 丢/ 包率/ 、/ 传输/ ①/ http/ :/ // // info/ ./ iet/ ./ unipi/ ./ it/ // ~/ luigi/ // ip/ _/ dummynet/ // Page9/ 延迟/ 以及/ 回放/ 过程/ 会话/ 阻断/ 率/ 的/ 目的/ 在于/ 在/ 一个/ 较为/ 宽广/ 的/ 目标/ 网络/ 环境/ 下/ 考察/ 所提/ 方法/ 的/ 实际/ 控制/ 性能/ ./ 实验/ 过程中将/ 需要/ 产生/ 的/ 目标/ 流量/ 大小/ 设置/ 为/ 100Mbps/ ,/ 离散/ 采样/ 时间/ 取为/ 0.5/ s/ ./ 对/ 每个/ 不同/ 设置/ 的/ 实验/ 均/ 重复/ 进行/ 10/ 次/ ,/ 最后/ 取/ 平均/ 性能/ 进行/ 分析/ ./ 6.2/ ./ 1/ 未/ 施加/ 控制/ 时/ 的/ 回放/ 性能/ 首先/ 考察/ 系统/ 在/ 不/ 施加/ 任何/ 控制/ 时/ 的/ 回放/ 性能/ ,/ 实验/ 结果/ 如图/ 6/ 所示/ ./ 在/ 实验/ 中/ 观察/ 到/ 整个/ 真实/ 网络流量/ 的/ 互动式/ 回放/ 过程/ 是/ 一个/ 非常/ 不/ 平稳/ 的/ 过程/ ;/ 受到/ 丢/ 包和会/ 话/ 阻断/ 等/ 网络/ 因素/ 的/ 影响/ ,/ 系统/ 性能/ 发生/ 显著/ 变化/ ,/ 而且/ ,/ 两种/ 因素/ 对/ 产生/ 流量/ 的/ 影响/ 较为/ 复杂/ ,/ 难以/ 用/ 一个/ 确切/ 的/ 数学/ 方程/ 进行/ 描述/ ./ 可以/ 预见/ ,/ 在/ 同时/ 有/ 丢/ 包/ 、/ 会话/ 阻断/ 以及/ 传输/ 延迟/ 等/ 多种/ 因素/ 存在/ 的/ 网络/ 环境/ 下/ ,/ 系统/ 性能/ 的/ 变化/ 将/ 变得/ 更加/ 复杂/ ./ 图/ 6/ 没有/ 施加/ 控制/ 的/ 情况/ 下/ 回放/ 系统/ 产生/ 的/ 流量/ 大小/ 6.2/ ./ 2/ 采用/ FA/ 和/ SPSA/ 方法/ 的/ 回放/ 结果/ (/ 1/ )/ 方法/ 参数/ 选取/ 考察/ 基于/ 函数/ 近似/ 器/ 和/ 并行/ 扰动/ 随机/ 估计/ 理论/ 的/ 控制系统/ 和/ 方法/ 的/ 控制/ 效果/ ./ 实验/ 中/ 利用/ 神经网络/ 当作/ 函数/ 近似/ 器/ ,/ 该/ 神经网络/ 的/ 节点/ 采用/ 1/ // (/ 1/ +/ e/ -/ z/ )/ 的/ 输入输出/ 函数/ ,/ 每个/ 节点/ 的/ 输入/ 包括/ 前/ 一层/ 节点/ 的/ 输出/ 加权/ 和/ 再/ 加上/ 一个/ 属于/ 自身/ 节点/ 的/ 偏移量/ ./ 整个/ 函数/ 近似/ 器/ 的/ 输入/ 包括/ 到/ 当前/ 时刻/ 为止/ 的/ 前/ 两个/ 时刻/ 回放/ 系统/ 产生/ 流量/ 值/ (/ M/ =/ 2/ )/ 、/ 上/ 一个/ 时刻/ 的/ 输入/ 控制/ 量/ (/ N/ =/ 1/ )/ 和/ 下/ 一个/ 时刻/ 的/ 目标/ 流量/ 大小/ ,/ 近似/ 器/ 的/ 输出/ 则/ 是/ 当前/ 时刻/ 需要/ 施加/ 的/ 控制/ 量/ ./ 因此/ ,/ 作为/ 函数/ 近似/ 器/ 的/ 神经网络/ 具有/ 4/ 个/ 输入/ 节点/ ,/ 1/ 个/ 输出/ 节点/ ./ 假定/ 包含/ 两个/ 隐层/ ,/ 每个/ 隐层/ 有/ 5/ 个/ 节点/ ,/ 则/ 该/ 神经网络/ 可记/ 为/ N4/ ,/ 5/ ,/ 5/ ,/ 1/ ,/ 共/ 包含/ (/ 4/ ×/ 5/ +/ 5/ )/ +/ (/ 5/ ×/ 5/ +/ 5/ )/ +/ (/ 5/ ×/ 1/ +/ 1/ )/ =/ 61/ 个/ 参数/ 需要/ 同时/ 估计/ ./ 神经网络/ 的/ 具体/ 结构/ 如图/ 7/ 所示/ (/ 实验/ 中/ 发现/ 采用/ 结构/ 更为/ 复杂/ 的/ 神经网络/ 并/ 没有/ 显著/ 提升/ 控制/ 性能/ ,/ 但/ 却/ 增加/ 了/ 计算/ 量/ )/ ./ 在/ SPSA/ 算法/ 中/ ,/ 参数/ {/ Δ/ ki/ }/ 取为/ 伯努利/ ±/ 1/ 分布/ ,/ ak/ =/ a/ =/ 0.05/ ,/ ck/ =/ c/ =/ 0.005/ ,/ 作为/ 函数/ 近似/ 器/ 的/ 神经网络/ 的/ 权值/ 初始/ 量/ 取为/ 标准/ 正态分布/ N/ (/ 0/ ,/ 1/ )/ ;/ 式/ (/ 2/ )/ 中/ 代价/ 函数/ 的/ 参数/ 犃/ k/ =/ [/ 1/ ]/ ,/ 犅/ k/ =/ [/ 10/ ]/ ./ (/ 2/ )/ 实际/ 控制/ 结果/ 与/ 分析/ 图/ 8/ 、/ 图/ 9/ 以及/ 图/ 10/ 分别/ 是/ 在/ 不同/ 数据包/ 传输/ 延迟/ 、/ 会话/ 阻断/ 和/ 丢/ 包/ 情况/ 下/ 控制系统/ 产生/ 的/ 输入/ 流量/ 大小/ 和/ 输出/ 流量/ 大小/ ./ 从/ 实验/ 结果/ 中/ 可以/ 得到/ 如下/ 结论/ :/ (/ 1/ )/ 在/ 互动式/ 流量/ 回放/ 控制/ 过程/ 中/ ,/ 系统/ 的/ 输入/ 流量/ 和/ 输出/ 流量/ 之间/ 的/ 关系/ 确实/ 是/ 非线性/ 的/ ./ 比如/ 从图/ 9/ (/ a/ )/ 中/ 可以/ 看出/ ,/ 为了/ 追踪/ 目标/ 流量/ ,/ 系统/ 在/ 10/ %/ 的/ 会/ 话/ 阻断/ 率下/ 达到/ 稳定/ 时/ 需要/ 施加/ 的/ 输入/ 流量/ 约/ 为/ 110Mbps/ ,/ 在/ 20/ %/ 的/ 情况/ 下为/ 128Mbps/ ,/ 而/ 在/ 30/ %/ 的/ 情况/ 下/ 需要/ 施加/ 的/ 输入/ 流量/ 上升/ 到/ 145Mbps/ ./ (/ 2/ )/ 在/ 达到/ 稳定/ 状态/ 时/ ,/ 基于/ FA/ 和/ SPSA/ 方法/ 的/ 控制系统/ 在/ 会/ 话/ 阻断/ 、/ 丢包/ 和/ 数据包/ 传输/ 延迟/ 3/ 种/ 网络/ 因素/ 影响/ 下均/ 能够/ 精确/ 地/ 对/ 回放/ 过程/ 产生/ 流速/ 进行/ 控制/ ./ 在/ 测试/ 网络/ 丢/ 包率/ 达到/ 10/ %/ 以及/ 会话/ 阻断/ 率/ 达到/ 30/ %/ 等/ 极端/ 情况/ 下/ ,/ 系统/ 仍然/ 能够/ 达到/ 很/ 好/ 的/ 控制/ 效果/ ./ Page10/ 图/ 8/ 基于/ 函数/ 近似/ 器/ 的/ 控制系统/ 在/ 不同/ 数据包/ 传输/ 延迟/ 情况/ 下/ 产生/ 输入/ 和/ 输出/ 流量/ 大小/ 图/ 9/ 基于/ 函数/ 近似/ 器/ 的/ 控制系统/ 在/ 不同/ 会话/ 阻断/ 率/ 的/ 情况/ 下/ 产生/ 输入/ 和/ 输出/ 流量/ 大小/ 图/ 10/ 基于/ 函数/ 近似/ 器/ 的/ 控制系统/ 在/ 不同/ 数据包/ 丢/ 包率/ 的/ 情况/ 下/ 产生/ 输入/ 和/ 输出/ 流量/ 大小/ (/ 3/ )/ 基于/ FA/ 和/ SPSA/ 方法/ 的/ 控制系统/ 在/ 不同/ 网络/ 环境因素/ 影响/ 下/ 所/ 需要/ 的/ 收敛/ 时间/ 不同/ ./ 总体/ 上/ 来说/ ,/ 在/ 随机/ 丢包/ 情况/ 下/ 系统/ 所/ 需要/ 的/ 收敛/ 时间/ 最少/ ,/ 而/ 在/ 会/ 话/ 阻断/ 情况/ 下/ 需要/ 的/ 收敛/ 时间/ 最长/ ./ (/ 4/ )/ 从/ 稳定/ 误差/ 上面/ 来看/ ,/ 在/ 会/ 话/ 阻断/ 、/ 丢包/ 和/ 数据包/ 传输/ 延迟/ 3/ 种/ 网络/ 影响/ 因素/ 中/ ,/ 基于/ FA/ 和/ SPSA/ 方法/ 的/ 控制系统/ 在/ 会/ 话/ 随机/ 阻断/ 和/ 数据包/ 传输/ 延迟/ 情况/ 下/ 的/ 控制/ 效果/ 要/ 好/ 于/ 在/ 随机/ 丢包/ 情况/ 下/ (/ 见图/ 8/ (/ b/ )/ 、/ 图/ 9/ (/ b/ )/ 和/ 图/ 10/ (/ b/ )/ )/ ./ 我们/ 认为/ 引起/ 该/ 现象/ 的/ 主要/ 原因/ 在于/ 不同/ 网络/ 事件/ 引起/ 的/ 回放/ 系统/ 行为/ 复杂性/ 不同/ ./ 数据包/ 传输/ 延迟/ 是/ 一个/ 相对/ 较为简单/ 的/ 网络/ 行为/ ;/ 当会/ 话/ 被/ 阻断/ 时/ (/ 接收/ 到/ RST/ 报文/ )/ ,/ 回放/ 系统/ 将/ 简单/ 地/ 结束/ 当前/ 流/ 的/ 回放/ 并且/ 后续/ 输入/ 流量/ 中/ 所有/ 属于/ 该会/ 话/ 的/ 数据包/ 将/ 不再/ 被/ 回放/ 出去/ ./ 因此/ ,/ 会话/ 阻断/ 情况/ 下/ 系统/ 的/ 行为/ 也/ 相对/ 简单/ ./ 而/ 当/ 数据包/ 发生/ 丢/ 包时/ ,/ 回放/ 系统/ 将/ 执行/ 超时/ 重/ Page11/ 传/ 行为/ ./ 根据/ TCP/ // IP/ 协议/ 规范/ ,/ TCP/ 数据/ 报文/ 的/ 超时/ 重传/ 机制/ 是/ 一个/ 非常复杂/ 的/ 过程/ [/ 28/ -/ 29/ ]/ ./ 因此/ ,/ 随机/ 丢包/ 情况/ 下/ 的/ 系统/ 行为/ 是/ 最/ 复杂/ 的/ ,/ 相应/ 地/ 导致系统/ 在/ 随机/ 丢包/ 情况/ 下/ 的/ 控制/ 效果/ 要/ 低于/ 在/ 会/ 话/ 随机/ 阻断/ 以及/ 数据包/ 传输/ 延迟/ 时/ 的/ 情况/ ./ (/ 5/ )/ 对于/ 数据包/ 传输/ 延迟/ 在/ 10ms/ 的/ 情况/ 下/ ,/ 发现/ 基于/ FA/ 和/ SPSA/ 方法/ 的/ 控制系统/ 产生/ 的/ 输出/ 流量/ 在/ 第/ 80/ 个/ 采样/ 周期/ 后/ 缓慢/ 下降/ 而/ 跟踪/ 不上/ 目标/ 流量/ (/ 见图/ 8/ (/ b/ )/ )/ ./ 我们/ 猜测/ 引起/ 该/ 现象/ 的/ 原因/ 在于/ 输入/ 流量/ 的/ 特性/ ,/ 即当/ 数据包/ 传输/ 延迟/ 在/ 10ms/ 时/ ,/ 输入/ 流量/ 中/ 的/ 并发/ 会话/ 个数/ 不足以/ 使得/ 回放/ 过程/ 跟踪/ 上/ 目标/ 流量/ ./ 通过/ 监测/ 流量/ 回放/ 过程/ 发现/ 此时/ 并发/ 会话/ 个数/ 约/ 为/ 80/ ./ 同时/ ,/ 在/ 第/ 80/ 个/ 时刻/ 之后/ 人为/ 设置/ 输入/ 流量/ 大小/ 持续增长/ ,/ 同样/ 发现/ 系统/ 的/ 实际/ 输出/ 流量/ 不再/ 随着/ 输入/ 流量/ 的/ 增长/ 而/ 增长/ ./ 因此/ ,/ 并发/ 会话/ 的/ 个数/ 会/ 决定/ 输出/ 流量/ 的/ 大小/ ,/ 实验/ 结果/ 与/ 我们/ 的/ 分析/ 一致/ ./ 此外/ ,/ 我们/ 将/ 基于/ FA/ 和/ SPSA/ 的/ 控制/ 方法/ 与/ 单/ 输入/ 单/ 输出/ 系统/ 的/ 一些/ 自/ 适应控制/ 方法/ 进行/ 了/ 比较/ ,/ 发现/ 有/ 如下/ 性质/ :/ (/ 1/ )/ 稳定/ 误差/ ./ 基于/ FA/ 和/ SPSA/ 的/ 方法/ 产生/ 的/ 误差/ 要/ 优于/ 一般/ 的/ 自/ 适应控制/ 方法/ ,/ 尤其/ 是/ 在/ 大/ 丢/ 包率/ 的/ 情况/ 下/ ./ (/ 2/ )/ 收敛/ 时间/ ./ 基于/ FA/ 和/ SPSA/ 的/ 方法/ 需要/ 的/ 收敛/ 时间/ 要/ 比/ 一般/ 的/ 自/ 适应控制/ 方法/ 长/ ./ 而且/ ,/ 一般/ 的/ 自/ 适应控制/ 方法/ 的/ 收敛/ 时间/ 比较稳定/ ,/ 而/ 基于/ FA/ 和/ SPSA/ 的/ 方法/ 在/ 丢/ 包/ 、/ 会话/ 阻断/ 以及/ 不同/ 数据包/ 传输/ 延迟/ 情况/ 下则/ 相差/ 较大/ ./ (/ 3/ )/ 产生/ 输入/ 和/ 输出/ ./ 在/ 系统/ 稳定/ 之前/ 基于/ FA/ 和/ SPSA/ 的/ 方法/ 产生/ 的/ 输入/ 和/ 输出/ 要/ 比/ 一般/ 的/ 自/ 适应控制/ 方法/ 波动/ 大/ ./ 对于/ 基于/ FA/ 和/ SPSA/ 的/ 方法/ 与/ 一般/ 的/ 自/ 适应控制/ 方法/ 在/ 收敛/ 时间/ 和/ 产生/ 输入输出/ 方面/ 的/ 差异/ ,/ 我们/ 认为/ 主要/ 原因/ 是/ 由/ 引入/ 的/ 扰动/ 机制/ 造成/ 的/ ./ 为了/ 对/ 参数/ 进行/ 估计/ ,/ 基于/ FA/ 和/ SPSA/ 的/ 方法/ 通过/ 在/ 参数/ 空间/ 随机/ 扰动/ 来/ 获得/ 代价/ 函数/ 对/ 参数/ 的/ 变化/ 信息/ ./ 而/ 一般/ 的/ 自/ 适应/ 方法/ 则/ 是/ 直接/ 基于/ 系统/ 输出/ 反馈/ 信息/ 产生/ 需要/ 的/ 输入/ ./ 因此/ ,/ 随机/ 扰动/ 增加/ 了/ 产生/ 输入/ 和/ 输出/ 的/ 波动性/ ,/ 同时/ 也/ 使得/ 方法/ 和/ 系统/ 需要/ 更/ 多/ 数据量/ 和/ 收敛/ 时间/ 来/ 跟踪/ 上/ 目标/ 流量/ 大小/ ./ 下面/ ,/ 通过/ 表/ 1/ 所示/ 的/ 数据/ 对/ 基于/ FA/ 和/ SPSA/ 方法/ 的/ 控制系统/ 在/ 稳定/ 时/ 的/ 控制/ 效果/ 进行/ 更为/ 细致/ 的/ 分析/ 和/ 说明/ ./ 从/ 平均误差/ 和/ 误差/ 方差/ 上/ 可以/ 看出/ ,/ 总体/ 上/ 基于/ FA/ 和/ SPSA/ 方法/ 的/ 控制系统/ 具有/ 较/ 好/ 的/ 稳定性/ ./ 表/ 1/ 基于/ 函数/ 近似/ 器/ 的/ 控制系统/ 在/ 不同/ 网络/ 丢/ 包率/ // %/ 会话/ 阻断/ // %/ 20.00/ ./ 00718.33/ E/ -/ 5/ 数据包/ 传输/ 延迟/ // ms1/ ./ 00.00291/ ./ 24E/ -/ 4/ 利用/ 其它/ 网络流量/ 对/ 所/ 提/ 方法/ 和/ 系统/ 进行/ 了/ 实验/ 考察/ ,/ 得到/ 的/ 结果/ 同/ 上述/ 结果/ 基本一致/ ,/ 基于/ 文章/ 篇幅/ 考虑/ 此处/ 便/ 不再/ 陈列/ ./ 从/ 实验/ 结果/ 中/ 可以/ 发现/ ,/ 本文/ 所/ 设计/ 的/ 系统/ 与/ 方法/ 可以/ 在/ 一个/ 较为/ 宽广/ 的/ 网络/ 环境/ 下/ 对/ 回放/ 系统/ 产生/ 的/ 流量/ 速率/ 进行/ 有效/ 控制/ ./ 7/ 结论/ 和/ 未来/ 展望/ 本文/ 对/ 互动式/ 网络/ 场景/ 再现/ 过程/ 的/ 流速/ 控制/ 问题/ 进行/ 了/ 研究/ ,/ 设计/ 实现/ 了/ 一个/ 基于/ 函数/ 近似/ 器/ 的/ 流速/ 控制系统/ ,/ 并/ 采用/ 真实/ 网络流量/ 对系统/ 的/ 实际/ 性能/ 进行/ 了/ 实验/ 验证/ 与/ 分析/ ./ 在/ 未来/ ,/ 将/ 重点/ 进行/ 如下/ 工作/ :/ (/ 1/ )/ 定量/ 考察/ 网络/ 延迟/ 、/ 丢/ 包和会/ 话/ 阻断/ 等/ 不同/ 网络/ 行为/ 以及/ 流量/ 的/ 各种/ 特性/ 如会话/ 到达/ 速率/ 、/ 会话/ 大小/ 分布/ 等/ 对/ 回放/ 过程/ 性能/ 的/ 影响/ ./ (/ 2/ )/ 在/ 上述/ 工作/ 基础/ 上/ ,/ 尝试/ 对/ 回放/ 系统/ 建立/ 精确/ 的/ 数学模型/ ./ 虽然/ 采用/ 无/ 模型/ 控制/ 方法/ 可以/ 达到/ 较为/ 满意/ 的/ 控制/ 效果/ ,/ 然而/ ,/ 精确/ 的/ 数学模型/ 仍然/ 是/ 更好/ 地/ 对系统/ 施加/ 控制/ ,/ 并/ 进行/ 性能/ 分析/ 、/ 最优化/ 设计/ 和/ 稳定性/ 分析/ 等/ 多项/ 重要/ 工作/ 的/ 前提/ ./ 

