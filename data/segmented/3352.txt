Page1/ 基于/ GPU/ 的/ 快速/ 球面/ 距离/ 变换/ 陈伟锋/ 王锐/ 潘明皓华炜/ (/ 浙江大学/ CAD/ &/ CG/ 国家/ 重点/ 实验室/ 杭州/ 310058/ )/ 摘要/ 文中/ 提出/ 了/ 一种/ 基于/ GPU/ 加速/ 的/ 精确/ 计算/ 球面/ 距离/ 变换/ 的/ 算法/ ./ 球面/ 距离/ 变换/ 在/ 球面/ 网格/ 剖分/ 、/ 气象/ 建模/ 等/ 领域/ 有/ 重要/ 的/ 应用/ ./ 目前/ 主要/ 的/ 球面/ 距离/ 变换/ 算法/ 是/ 基于/ 有序/ 扩散/ 的/ ,/ 即/ 每个/ 球面/ 像素/ 的/ 距离/ 变换/ 都/ 需要/ 参照/ 相邻/ 像素/ 的/ 信息/ ,/ 因而/ 难以/ 通过/ 并行计算/ 加速/ ./ 在/ 经度/ -/ 纬度/ 参数/ 域/ 上/ ,/ 该文/ 给出/ 了/ 依次/ 沿/ 纬线/ 和/ 经线/ 独立/ 扫描/ 进行/ 球面/ 距离/ 变换/ 的/ 理论/ 证明/ ,/ 提出/ 了/ 一种/ 新/ 的/ 球面/ 距离/ 变换/ 算法/ ,/ 称为/ 经纬/ 独立/ 扫描/ 算法/ ./ 同/ 以往/ 的/ 球面/ 距离/ 变换/ 算法/ 相比/ ,/ 该文/ 提出/ 的/ 算法/ 是/ 完全/ 并行/ 的/ 算法/ ,/ 可以/ 在/ GPU/ 上/ 实现/ 以/ 提高/ 球面/ 距离/ 变换/ 的/ 性能/ ./ 最后/ ,/ 该文/ 列举/ 了/ 几个/ 快速/ 球面/ 距离/ 变换/ 的/ 应用/ ./ 关键词/ GPU/ 加速/ ;/ 球面/ 距离/ 变换/ ;/ 独立/ 扫描/ ;/ 球面/ Voronoi/ 图/ 1/ 引言/ 在/ 二维/ 空间/ 中/ ,/ 假设/ 图像/ 是/ 由/ 边界/ 像素/ 和/ 非边/ Page2/ 的/ 距离/ 变换/ 受到/ 了/ 广泛/ 的/ 研究/ 及/ 应用/ ,/ 研究者/ 提出/ 了/ 许多/ 优化/ 的/ 距离/ 变换/ 算法/ ,/ 包括/ Wavefront/ 算法/ 、/ 顺序/ 扫描/ 算法/ 、/ 独立/ 扫描/ 算法/ 等/ ./ 本文/ 主要/ 研究/ 定义/ 在/ 球面/ 上/ 的/ 距离/ 变换/ ,/ 称为/ 球面/ 距离/ 变换/ (/ SphericalDistanceTransform/ ,/ SDT/ )/ ,/ 如图/ 1/ 所示/ ./ 球面/ 距离/ 是/ 指/ 定义/ 在/ 球面/ 上/ 的/ 测地/ 距离/ ./ 球面/ 距离/ 变换/ 一直/ 有着/ 重要/ 的/ 应用/ ,/ 如/ 球面/ 网格化/ 、/ 气象/ 建模/ 、/ 湍流/ 建模/ 等/ ./ 在/ 二维/ 空间/ 中/ ,/ Rosenfeld/ 和/ Pfaltz/ [/ 1/ ]/ 提出/ 了/ 一个/ 利用/ 降维/ 进行/ 距离/ 变换/ 的/ 算图/ 1/ 球面/ 距离/ 变换/ (/ (/ c/ )/ ,/ (/ d/ )/ 是/ 相应/ 的/ 距离/ 场/ 在/ 二维/ 参数/ 化/ 平面/ 上/ 的/ 表示/ ./ 采用/ 2048/ ×/ 2048/ 的/ 本文/ 根据/ 球面/ 距离/ 函数/ 和/ 距离/ 变换/ 的/ 特征/ ,/ 证明/ 了/ 在/ 经度/ -/ 纬度/ 参数/ 域/ 上/ 球面/ 距离/ 变换/ 中/ 的/ 两个/ 重要/ 定理/ ,/ 通过/ 扩展/ 二维/ 空间/ 中/ 的/ 独立/ 扫描/ 算法/ ,/ 提出/ 了/ 一种/ 基于/ GPU/ 并行/ 加速/ 的/ 球面/ 距离/ 变换/ 算法/ ,/ 称为/ 经纬/ 独立/ 扫描/ 算法/ ./ 将/ 球面/ 在/ 经度/ -/ 纬度/ 参数/ 域/ 上/ 参数/ 化/ 并/ 离散/ 映射/ 到/ N/ ×/ N/ 的/ 二维/ 平面/ 网格/ 上后/ ,/ 我们/ 的/ 算法/ 主要/ 分成/ 如下/ 两个/ 步骤/ 执行/ :/ 算法/ 首先/ 沿着/ 表示/ 纬度/ 的/ 二维/ 网格/ 的/ 行/ 扫描/ ,/ 得到/ 二维/ 网格/ 中/ 每个/ 像素/ 在/ 其/ 所在/ 行中/ 的/ 最近/ 边界/ 像素/ ,/ 并/ 保存/ 在/ 当前/ 像素/ 中/ ./ 然后/ 沿着/ 表示/ 经度/ 的/ 列/ 扫描/ ,/ 这个/ 步骤/ 分成/ 两次/ 扫描/ 完成/ ./ 由于/ 执行/ 第一/ 步骤/ 之后/ 列/ 的/ 每个/ 像素/ 中/ 都/ 保存/ 了/ 其/ 所在/ 行中/ 的/ 最近/ 边界/ 像素/ 的/ 坐标/ (/ 如果/ 存在/ 的话/ )/ ,/ 第一次/ 扫描/ 将/ 从中/ 剔除/ 那些/ 不会/ 影响/ 到/ 最终/ 球面/ 距离/ 变换/ 结果/ 的/ 边界/ 像素/ ,/ 得到/ 一个/ 与/ 当/ 前列/ 相关/ 的/ 最小/ 的/ 边界/ 像素/ 的/ 子集/ ./ 紧接着/ 根据/ 得到/ 的/ 这个/ 子集/ 对列/ 再/ 进行/ 一次/ 扫描/ ,/ 计算/ 每个/ 像素/ 到/ 其/ 最近/ 边界/ 像素/ 的/ 球面/ 距离/ ./ 本文/ 提出/ 的/ 算法/ 的/ 复杂度/ 为/ O/ (/ N2/ )/ ,/ 其中/ N/ 是/ 对/ 球面/ 经度/ 和/ 纬度/ 的/ 参数/ 化/ 密度/ ,/ 即将/ 球面/ 的/ 经度/ 和/ 纬度/ 分别/ N/ 等/ 分/ ./ 由于/ 我们/ 的/ 算法/ 首先/ 得到/ 的/ 是/ 每个/ 球面/ 像素/ 所/ 属于/ 的/ 边界/ 像素/ 的/ 球面/ Voronoi/ 区域/ ,/ 所以/ 得到/ 的/ 球面/ 距离/ 变换/ 结果/ 在/ 参数/ 化/ 密度/ 下/ 是/ 精确/ 的/ ./ 本文/ 第/ 2/ 节/ 介绍/ 距离/ 变换/ 的/ 相关/ 工作/ ;/ 第/ 3/ 节/ 提出/ 并/ 证明/ 两个/ 定义/ 在/ 球面/ 上/ 的/ 距离/ 变换/ 相关/ 的/ 定理/ ,/ 它们/ 是/ 保证/ 本文/ 算法/ 的/ 正确性/ 的/ 理论/ 基础/ ;/ 第/ 4/ 法/ ,/ 称为/ 独立/ 扫描/ 算法/ ./ 独立/ 扫描/ 算法/ 首先/ 在/ 一维/ 上/ (/ 行或列/ )/ 独立/ 地/ 构造/ 一个/ 距离/ 变换/ ,/ 然后/ 以/ 这个/ 中间/ 结果/ 作为/ 构造/ 二维/ 距离/ 变换/ 的/ 输入/ ./ Paglieroni/ [/ 2/ ]/ 统一/ 了/ 这种/ 基于/ 并行/ 地/ 扫描/ 行和列/ 进行/ 距离/ 变换/ 的/ 架构/ ,/ 提出/ 并/ 证明/ 了/ 只要/ 符合/ Paglieroni/ 条件/ 的/ 距离/ 函数/ 都/ 可以/ 使用/ 这个/ 架构/ 进行/ 距离/ 变换/ ./ 然而/ 在/ 球面/ 空间/ 中/ ,/ 由于/ 球面/ 距离/ 不/ 属于/ 欧几里得/ 空间/ ,/ 它/ 并/ 不/ 满足/ Paglieroni/ 条件/ ,/ 因而/ 无法/ 直接/ 应用/ 独立/ 扫描/ 算法/ ./ 节/ 介绍/ 经纬/ 独立/ 扫描/ 算法/ 的/ 细节/ ,/ 并/ 在/ 第/ 5/ 节/ 给出/ 我们/ 算法/ 的/ 实验/ 结果/ 与/ 统计/ ;/ 最后/ 本文/ 列举/ 快速/ 球面/ 距离/ 变换/ 的/ 几个/ 应用/ 并/ 给出/ 总结/ ./ 2/ 相关/ 工作/ 球面/ 距离/ 变换/ 是/ 指/ 在/ 球面/ 上/ 计算/ 距离/ 场/ 的/ 方法/ ./ 根据/ 球面/ 距离/ 变换/ 的/ 定义/ ,/ 最/ 直接/ 的/ 距离/ 变换/ 方法/ 是/ 对/ 球面/ 上/ 的/ 每个/ 非/ 边界/ 像素/ (/ 边界/ 像素/ 的/ 距离/ 变换/ 是/ 0/ )/ 执行/ 一遍/ 循环/ ,/ 计算/ 每个/ 边界/ 像素/ 到/ 它/ 的/ 距离/ 并/ 找出/ 这些/ 距离/ 中/ 的/ 最小值/ 作为/ 每个/ 非/ 边界/ 像素/ 距离/ 变换/ 的/ 结果/ ./ 令/ 球面/ 参数/ 化后/ 的/ 二维/ 网格/ 的/ 分辨率/ 为/ N/ ×/ N/ ,/ 该/ 方法/ 在/ 最坏/ 情况/ 下/ 具有/ 的/ 时间/ 复杂度/ 为/ O/ (/ N4/ )/ ./ 球面/ 距离/ 变换/ 的/ Brute/ -/ force/ 算法/ 虽然/ 可以/ 获得/ 精确/ 解/ ,/ 实现/ 也/ 相对/ 简单/ ,/ 但是/ 算法/ 的/ 时间/ 复杂度/ 太高/ ,/ 因而/ 难以/ 实际/ 应用/ ./ 由于/ 球面/ 距离/ 变换/ 首先/ 需要/ 将/ 球面/ 进行/ 参数/ 化/ ,/ 一般/ 是/ 将/ 球面/ 映射/ 到/ 二维/ 网格/ ,/ 所以/ 可以/ 借鉴/ 某些/ 二维/ 空间/ 的/ 距离/ 变换/ 算法/ ./ 扩散/ 算法/ (/ Propaga/ -/ tionAlgorithm/ )/ 是/ 有效/ 利用/ 距离/ 变换/ 局部/ 特性/ 的/ 一类/ 算法/ [/ 3/ -/ 5/ ]/ ./ 将/ 二维/ 网格/ 中/ 的/ 每个/ 非/ 边界/ 像素/ 的/ 距离/ 初始化/ 为/ 无穷大/ ,/ 通过/ 维护/ 一个/ 边界/ 像素/ 的/ 辅助/ 数组/ ,/ 扩散/ 算法/ 每次/ 从/ 数组/ 中/ 取出/ 一个/ 像素/ ,/ 称为/ 中心/ 像素/ ,/ 并/ 基于/ 中心/ 像素/ 的/ 距离/ 计算/ 它/ 的/ 每/ 一个/ 相邻/ 像素/ 的/ 距离/ 变换/ ,/ 如果/ 新/ 的/ 距离/ 值/ 小于/ 原来/ 保存/ 的/ Page3/ 距离/ 值/ ,/ 则/ 更新/ 原/ 距离/ 值/ ,/ 并/ 将/ 该/ 相邻/ 像素/ 放到/ 辅助/ 数组/ 中/ ,/ 重复/ 该/ 步骤/ 直到/ 辅助/ 数组/ 中/ 没有/ 像素/ 为止/ ./ 由于/ 这种/ 算法/ 类似/ 于/ Dijkstra/ 算法/ [/ 6/ ]/ ,/ 因而/ 令/ 辅助/ 数组/ 是/ 一个/ 以/ 距离/ 为/ 关键/ 值/ 的/ 优先/ 队列/ ,/ 每次/ 从中/ 取出/ 具有/ 最小/ 距离/ 的/ 像素/ 进行/ 扩散/ ,/ 从而/ 可以/ 减少/ 像素/ 的/ 更新/ 次数/ ./ Danielsson/ [/ 7/ ]/ 在/ 1980/ 年/ 提出/ 了/ 一种/ 计算/ 欧几里得/ 距离/ 变换/ 的/ 光栅/ 化/ 扫描/ 算法/ ,/ 由于/ 它/ 扩散/ 的/ 是/ 最近/ 边界/ 像素/ 的/ 相对/ 坐标/ ,/ 因而/ 被/ 称为/ 向量/ 扩散/ 算法/ ./ Danielsson/ 指出/ ,/ 尽管/ 在/ 大部分/ 图像/ 上/ 得到/ 的/ 距离/ 变换/ 是/ 正确/ 的/ ,/ 但/ 仍会/ 产生/ 误差/ ,/ 主要/ 是因为/ 离散/ 欧几里得/ Voronoi/ 区域/ 并/ 不/ 总是/ 相连/ 的/ [/ 8/ ]/ ./ Michikawa/ 和/ Suzuki/ [/ 9/ ]/ 将/ 向量/ 扩散/ 算法/ 扩展/ 到/ 球面/ 距离/ 变换/ 中/ ,/ 提出/ 了/ 基于/ 顺序/ 向量/ 扩散/ 的/ 球面/ 距离/ 变换/ 算法/ (/ SequentialVectorSphericalDis/ -/ tanceTransform/ ,/ SVSDT/ )/ ./ 在/ 基于/ N/ ×/ N/ 参数/ 化/ 的/ 球面/ 上/ ,/ 该/ 算法/ 直接/ 沿着/ 纬度/ 方向/ 做/ 三次/ 顺/ 逆时针/ 交替/ 的/ 长度/ 为/ 3N/ // 2/ 顺序/ 向量/ 扩散/ 算法/ ,/ 因此/ 算法/ 的/ 复杂度/ 为/ O/ (/ N2/ )/ ./ 由于/ 该/ 算法/ 是/ Danielsson/ 的/ 向量/ 扩散/ 算法/ [/ 7/ ]/ 的/ 扩展/ ,/ 因而/ 也/ 存在/ 误差/ ./ 另一方面/ ,/ 该/ 算法/ 数据/ 依赖性/ 较强/ ,/ 很难/ 在/ 并行/ 架构/ 上/ 进行/ 加速/ ./ Rosenfeld/ 和/ Pfaltz/ [/ 1/ ]/ 提出/ 了/ 一个/ 利用/ 降维/ 计算/ 距离/ 变换/ 的/ 算法/ ,/ 称为/ 独立/ 扫描/ 算法/ ./ 在/ 二维/ 图像/ 空间/ 中/ ,/ 独立/ 扫描/ 分为/ 两个/ 步骤/ ,/ 分别/ 对应/ 行/ 扫描/ 和/ 列/ 扫描/ ./ 根据/ 第二步/ 的/ 不同/ ,/ 独立/ 扫描/ 又/ 分为/ 几个/ 分支/ [/ 8/ ]/ ./ Kolountzakis/ 等/ 人/ [/ 10/ ]/ 在/ 1992/ 年/ 提出/ 了/ 一种/ O/ (/ N2logN/ )/ 时间/ 复杂度/ 的/ 基于/ 抛物线/ 相交/ 的/ 独立/ 扫描/ 算法/ ,/ Chen/ 和/ Chuang/ [/ 11/ ]/ 将/ 该/ 算法/ 进行/ 了/ 优化/ ,/ 使得/ 其/ 在/ 最坏/ 情况/ 下/ 具有/ O/ (/ N2/ )/ 的/ 复杂度/ [/ 12/ ]/ ./ Maurer/ 等/ 人/ [/ 13/ -/ 15/ ]/ 采用/ 了/ 类似/ 的/ 方法/ ,/ 不同/ 的/ 是/ 他们/ 在/ 第二步/ 中/ 采用/ 了/ 基于/ Voronoi/ 图/ 相交/ 的/ 方法/ ,/ 由于/ 边界/ 像素/ 的/ Voronoi/ 图/ 与/ 二维/ 图像/ 的/ 列/ 或行/ 的/ 交点/ 可以/ 比较/ 容易/ 地/ 求得/ ,/ 因此/ 这种/ 方法/ 的/ 效率/ 较/ 高/ ./ Maurer/ 等/ 人/ [/ 15/ ]/ 同时/ 证明/ 了/ 这种/ 算法/ 是/ 准确/ 的/ 距离/ 变换/ 的/ 算法/ ./ 由于/ 这些/ 算法/ 可以/ 独立/ 地/ 扫描/ 二维/ 网格/ 的/ 列和行/ ,/ 并/ 能够/ 直接/ 地/ 扩展/ 到/ 多维/ 空间/ (/ 通过/ 不断/ 地降维/ )/ ,/ 因此/ 得到/ 了/ 广泛/ 的/ 应用/ ./ 然而/ ,/ 由于/ 球面/ 函数/ 不/ 属于/ 欧几里得/ 空间/ ,/ 这种/ 并行/ 的/ 独立/ 扫描/ 算法/ 无法/ 直接/ 应用/ 到/ 球面/ 距离/ 变换/ ./ 3/ 理论/ 基础/ 3.1/ 球面/ 参数/ 化/ 和/ 球面/ 距离/ 变换/ 在/ 用/ 计算机/ 进行/ 球面/ 距离/ 变换/ 之前/ ,/ 首先/ 需要/ 对/ 球面/ 进行/ 参数/ 化/ ,/ 即将/ 球面/ 离散/ 成/ 二维/ 网格/ ./ 本文/ 在/ 经度/ -/ 纬度/ 参数/ 域/ 上/ 对/ 球面/ 参数/ 化/ ,/ 将/ 球面/ 离散/ 成/ 一个/ N/ ×/ N/ 的/ 二维/ 网格/ 数据结构/ ,/ 如图/ 2/ 所示/ ./ 注意/ 到/ 粗/ 的/ 横线/ 虽然/ 具有/ 不同/ 的/ 经度/ 值/ (/ 如图/ 2/ (/ b/ )/ 所示/ )/ ,/ 但/ 它们/ 分别/ 汇聚/ 成/ 两个/ 极点/ ./ 尽管/ 有/ 这/ 两个/ 极点/ 的/ 存在/ ,/ 但/ 它们/ 并/ 不/ 影响/ 本文/ 算法/ 的/ 实现/ 及/ 球面/ 距离/ 场/ 的/ 计算/ ./ 参数/ 化后/ 的/ 球面/ 被/ 表示/ 成用/ 横坐标/ i/ 和/ 纵坐标/ j/ 分别/ 表示/ 经度/ / i/ =/ i/ ×/ 2/ π/ // N/ 和/ 纬度/ θ/ j/ =/ j/ ×/ π/ // (/ N/ -/ 1/ )/ 的/ 二维/ 网格/ ,/ 其中/ 经度/ 的/ 范围/ 是/ [/ 0/ ,/ 2/ π/ )/ ,/ 纬度/ 的/ 范围/ 是/ [/ 0/ ,/ π/ ]/ ,/ 经度/ 在/ / =/ 2/ π/ 处/ 与/ / =/ 0/ 重合/ ./ 球面/ 距离/ 变换/ 是/ 指/ 在/ 球面/ 上/ 定义/ 的/ 一个/ 标量/ 距离/ 场/ ./ 球面/ 上/ 经过/ 两点/ 的/ 劣弧/ 的/ 长度/ 定义/ 为/ 这两点/ 的/ 球面/ 距离/ ./ 不失/ 一般性/ ,/ 本文/ 中/ 的/ 距离/ 场/ 定义/ 在/ 半径/ 为/ 1/ 的/ 单位/ 球上/ ./ 定义/ 在/ 单位/ 球面/ 上/ 任意/ 两点/ p/ (/ θ/ 1/ ,/ / 1/ )/ 和/ q/ (/ θ/ 2/ ,/ / 2/ )/ 的/ 球面/ 距离/ 为/ 其中/ ,/ 分别/ 是/ p/ ,/ q/ 从球/ 坐标系/ 转化/ 到/ 三维/ 欧氏/ 坐标系/ 后/ 的/ 坐标/ ,/ θ/ 和/ / 分别/ 表示/ 纬度/ 和/ 经度/ 坐标/ (/ 见图/ 2/ )/ ./ 根据/ 球面/ 距离/ 的/ 定义/ ,/ 0/ / ds/ (/ p/ ,/ q/ )/ / π/ ./ 3.2/ 经度/ 距离/ 和/ 中心/ 纬度/ (/ p1/ ≠/ p2/ )/ ,/ 定义/ 经度/ 距离/ 如下/ :/ 对于/ 球面/ 上/ 两个/ 点/ p1/ (/ θ/ 1/ ,/ / 1/ )/ 和/ p2/ (/ θ/ 2/ ,/ / 2/ )/ Ψ/ (/ / 1/ ,/ / 2/ )/ =/ min/ (/ |/ / 1/ -/ / 2/ |/ ,/ 2/ π/ -/ |/ / 1/ -/ / 2/ |/ )/ ,/ 如果/ 已知/ 经度/ / 0/ ,/ 定义/ 中心/ 纬度/ θ/ 0/ 为/ 使得/ ds/ (/ p0/ ,/ p1/ )/ =/ ds/ (/ p0/ ,/ p2/ )/ 的/ 纬度/ 值/ ,/ 即/ 球面/ 点/ p0/ (/ θ/ 0/ ,/ / 0/ )/ 分别/ 到/ p1/ 和/ p2/ 的/ 球面/ 距离/ 相等/ ,/ 如图/ 3/ ./ 由于/ 球面/ 具有/ 旋转/ 不变性/ ,/ 不失/ 一般性/ ,/ 可以/ 将/ / 0/ ,/ / 1/ ,/ / 2/ 同时/ 绕/ 着/ 极轴/ 旋转/ 至令/ / 0/ =/ 0/ ,/ 从而/ 根据/ 中心/ 纬度/ 的/ 定义/ 推导/ 得到/ 中心/ 纬度/ 的/ 计算公式/ 如下/ :/ Page4/ Θ/ (/ / 0/ ,/ p1/ ,/ p2/ )/ =/ Θ/ (/ 0/ ,/ Δ/ p1/ ,/ Δ/ p2/ )/ =/ π/ 烄/ 2/ ,/ arctancos/ θ/ 2/ -/ cos/ θ/ 1A/ -/ B/ ,/ cos/ θ/ 2/ -/ cos/ θ/ 1A/ -/ B/ / 0/ 烅/ arctancos/ θ/ 2/ -/ cos/ θ/ 1A/ -/ B/ +/ π/ ,/ cos/ θ/ 2/ -/ cos/ θ/ 1A/ -/ B/ </ 烆/ 其中/ ,/ A/ =/ sin/ θ/ 1cos/ Δ/ / 1/ ,/ B/ =/ sin/ θ/ 2cos/ Δ/ / 2/ ./ Δ/ 表示/ 绕/ 着/ 极轴/ 的/ 一个/ 旋转变换/ ,/ Δ/ / 1/ 和/ Δ/ / 2/ 分别/ 表示/ 经过/ 旋转变换/ 后/ 的/ 两个/ 球面/ 点/ 的/ 经度/ 值/ ./ 中心/ 纬度/ 的/ 几何/ 意义/ 为/ 经过/ 两个/ 点/ 的/ 球面/ 路径/ 的/ 中心点/ 并/ 在/ 该/ 点/ 与/ 球面/ 路径/ 垂直/ 的/ 大圆/ ,/ 与/ 经度/ 为/ / 0/ 所在/ 的/ 大圆/ 的/ 交点/ 的/ 纬度/ 值/ ./ 由于/ 球面/ 上/ 两个/ 不同/ 的/ 大圆/ 有且/ 仅/ 有/ 两个/ 交点/ ,/ 且/ 交点/ 的/ 连线/ 刚好/ 是/ 一条/ 直径/ ,/ 因此/ 当/ θ/ 1/ ≠/ θ/ 2/ 时/ ,/ 在/ 经度/ / 0/ 表示/ 的/ 半圆/ 上/ ,/ 有且/ 仅/ 有/ 一个/ 交点/ ,/ 从而/ 任意/ 两个/ 具有/ 不同/ 纬度/ 的/ 球面/ 点/ 在/ 任意/ 经度/ 上/ 的/ 中心/ 纬度/ 值/ θ/ 0/ 是/ 存在/ 且/ 唯一/ 的/ ,/ 并且/ θ/ 0/ ∈/ (/ 0/ ,/ π/ )/ ./ 3.3/ 经纬/ 独立/ 扫描/ 算法/ 的/ 理论/ 基础/ 在/ 二维/ 距离/ 变换/ 中/ ,/ Paglieroni/ [/ 2/ ]/ 证明/ 了/ 只要/ 定义/ 的/ 距离/ 函数/ 具有/ 如式/ (/ 2/ )/ 形式/ ,/ 且/ 符合/ 如下/ 条件/ (/ 式/ (/ 3/ )/ 和/ (/ 4/ )/ )/ ,/ 就/ 可以/ 使用/ 独立/ 扫描/ 算法/ 进行/ 距离/ 变换/ ./ / y/ ,/ |/ x1/ |/ </ |/ x2/ |/ / f/ (/ |/ x1/ |/ ,/ |/ y/ |/ )/ / f/ (/ |/ x2/ |/ ,/ |/ y/ |/ )/ / x/ ,/ |/ y1/ |/ </ |/ y2/ |/ / f/ (/ |/ x/ |/ ,/ |/ y1/ |/ )/ / f/ (/ |/ x/ |/ ,/ |/ y2/ |/ )/ 将/ 球面/ 参数/ 化到/ 二维/ 空间/ 后/ ,/ 由/ 球面/ 距离/ 函数/ 的/ 定义/ ,/ 其/ 不是/ 以/ 两点/ 的/ 经度/ 差/ 和/ 纬度/ 差/ 的/ 绝对值/ 为/ 独立/ 变量/ 的/ 函数/ ,/ 即/ 球面/ 距离/ 函数/ 不/ 具有/ 式/ (/ 2/ )/ 的/ 形式/ ,/ 因此/ 基于/ 这些/ 条件/ 的/ 独立/ 扫描/ 算法/ 也/ 不再/ 适用/ 于/ 球面/ 距离/ 变换/ ./ 本/ 小节/ 内容/ 主要/ 提出/ 并/ 证明/ 了/ 在/ 球面/ 经度/ -/ 纬度/ 参数/ 域/ 上/ ,/ 球面/ 距离/ 变换/ 中/ 的/ 两个/ 重要/ 定理/ ./ 这/ 两个/ 定理/ 保证/ 了/ 依次/ 沿/ 参数/ 域/ 的/ 纬线/ 和/ 经线/ 独立/ 扫描/ 得到/ 球面/ 距离/ 变换/ 的/ 正确性/ ./ 定理/ 1/ ./ 对于/ 任意/ 经度/ / ,/ 在/ 同一/ 纬度/ θ/ 0/ 上/ 的/ 两个/ 点/ p1/ (/ θ/ 0/ ,/ / 1/ )/ 和/ p2/ (/ θ/ 0/ ,/ / 2/ )/ ,/ 如果/ 经度/ 距离/ Ψ/ (/ / ,/ / 1/ )/ </ Ψ/ (/ / ,/ / 2/ )/ ,/ 那么/ 对于/ 经度/ / 上/ 的/ 任何/ 球面/ 点/ p0/ (/ θ/ ,/ / )/ (/ 0/ / θ/ / π/ )/ ,/ ds/ (/ p0/ ,/ p1/ )/ / ds/ (/ p0/ ,/ p2/ )/ 成立/ ,/ 且/ 当/ sin/ θ/ =/ 0/ 或/ sin/ θ/ 0/ =/ 0/ 时取/ 等/ 号/ ./ 证明/ ./ 根据/ 球面/ 距离/ 的/ 定义/ 及/ 三角函数/ 公式/ ,/ cosds/ (/ p0/ ,/ p1/ )/ -/ cosds/ (/ p0/ ,/ p2/ )/ =/ sin/ θ/ sin/ θ/ 0/ (/ cos/ (/ / -/ / 1/ )/ -/ cos/ (/ / -/ / 2/ )/ )/ =/ sin/ θ/ sin/ θ/ 0/ (/ cos/ (/ Ψ/ (/ / -/ / 1/ )/ )/ -/ cos/ (/ Ψ/ (/ / -/ / 2/ )/ )/ )/ ,/ 其中/ ,/ 由/ 余弦/ 函数/ 在/ [/ 0/ ,/ π/ ]/ 的/ 单调/ 性及/ 经度/ 距离/ 的/ 值域/ ,/ 当/ Ψ/ (/ / ,/ / 1/ )/ </ Ψ/ (/ / ,/ / 2/ )/ 时/ ,/ cosds/ (/ p0/ ,/ p1/ )/ >/ cosds/ (/ p0/ ,/ p2/ )/ ./ 由于/ 球面/ 距离/ 的/ 区间/ 是/ [/ 0/ ,/ π/ ]/ ,/ 因而/ 就/ 有/ ds/ (/ p0/ ,/ p1/ )/ / ds/ (/ p0/ ,/ p2/ )/ 成立/ ,/ 当且/ 仅/ 当/ sin/ θ/ sin/ θ/ 0/ =/ 0/ 时/ ,/ 等/ 号/ 成立/ ./ 该/ 定理/ 说明/ 对于/ 任意/ 经度/ / 上/ 的/ 球面/ 像素/ ,/ 如果/ 在/ 同一/ 纬度/ 上/ 存在/ 边界/ 像素/ ,/ 则/ 只有/ 与/ / 具有/ 最小/ 经度/ 距离/ 的/ 边界/ 像素/ 离/ 经度/ / 上/ 的/ 所有/ 像素/ 都/ 最近/ ./ 因此/ 也/ 表明/ 在/ 每条/ 经线/ 上/ ,/ 最多/ 有/ N/ 个/ 球面/ 边界/ 像素/ 的/ Voronoi/ 区域/ 与/ 该/ 经线/ 相交/ ,/ 从而/ 使/ 每条/ 经线/ 上/ 的/ 球面/ 像素/ 的/ 距离/ 变换/ 可以/ 限制/ 在/ 与/ O/ (/ N/ )/ 个/ 边界/ 像素/ 的/ 距离/ 计算/ 得到/ ,/ 由此/ 可以/ 得到/ 最坏/ 情况/ 下/ O/ (/ N3/ )/ 的/ 整体/ 时间/ 复杂度/ ./ 定理/ 2/ ./ 对于/ 球面/ 上/ 的/ 两个/ 点/ p1/ (/ θ/ 1/ ,/ / 1/ )/ 和/ p2/ (/ θ/ 2/ ,/ / 2/ )/ ,/ p0/ (/ θ/ 0/ ,/ / 0/ )/ 是/ 经线/ / 0/ 上/ 的/ 到/ p1/ 和/ p2/ 距离/ 相等/ 的/ 点/ ,/ 即/ θ/ 0/ 是/ p1/ 和/ p2/ 关于/ 经线/ / 0/ 的/ 中心/ 纬度/ ,/ 其中/ θ/ 1/ </ θ/ 2/ ./ 对于/ 经线/ / 0/ 上/ 的/ 其它/ 一点/ p/ (/ θ/ ,/ / 0/ )/ ,/ 如果/ θ/ </ θ/ 0/ ,/ 则/ ds/ (/ p1/ ,/ p/ )/ </ ds/ (/ p2/ ,/ p/ )/ ,/ 反之/ ,/ 如果/ θ/ >/ θ/ 0/ ,/ 则/ ds/ (/ p1/ ,/ p/ )/ >/ ds/ (/ p2/ ,/ p/ )/ ./ 证明/ ./ 由于/ 球面/ 绕/ 极轴/ 旋转/ 具有/ 旋转/ 不变性/ ,/ 因此/ 令/ / 0/ =/ 0/ ,/ 其它/ 各点/ 也/ 做/ 相应/ 的/ 旋转变换/ ./ 根据/ 球面/ 距离/ 公式/ ,/ 令/ 函数/ F/ (/ θ/ )/ =/ cosds/ (/ p1/ ,/ p/ )/ -/ cosds/ (/ p2/ ,/ p/ )/ ,/ 根据/ 球面/ 距离/ 定义/ ,/ 有/ F/ (/ θ/ )/ =/ (/ sin/ θ/ 1cos/ / 1/ ,/ sin/ θ/ 1sin/ / 1/ ,/ cos/ θ/ 1/ )/ ·/ (/ sin/ θ/ ,/ 0/ ,/ cos/ θ/ )/ -/ (/ sin/ θ/ 2cos/ / 2/ ,/ sin/ θ/ 2sin/ / 2/ ,/ cos/ θ/ 2/ )/ ·/ (/ sin/ θ/ ,/ 0/ ,/ cos/ θ/ )/ / F/ (/ θ/ )/ =/ Asin/ θ/ +/ Bcos/ θ/ 烄/ A/ =/ sin/ θ/ 1cos/ / 1/ -/ sin/ θ/ 2cos/ / 2/ 烅/ 烆/ B/ =/ cos/ θ/ 1/ -/ cos/ θ/ 由/ 假设/ θ/ 1/ </ θ/ 2/ (/ θ/ 1/ ,/ θ/ 2/ ∈/ [/ 0/ ,/ π/ ]/ )/ ,/ 因此/ B/ >/ 0/ ,/ 由/ 三角函数/ 公式/ ,/ 可将式/ (/ 5/ )/ 改写/ 成/ 如下/ 形式/ :/ Page5/ 其中/ γ/ =/ arctan/ (/ A/ // B/ )/ ,/ 由/ 假设/ 当/ θ/ =/ θ/ 0/ 时/ ,/ F/ (/ θ/ )/ =/ 0/ ,/ 得到/ γ/ -/ θ/ 0/ =/ ±/ π/ // 2/ ./ 由于/ B/ >/ 0/ ,/ γ/ ∈/ (/ -/ π/ // 2/ ,/ π/ // 2/ )/ ,/ 并且/ θ/ 0/ ∈/ (/ 0/ ,/ π/ )/ ,/ 所以/ γ/ -/ θ/ 0/ =/ -/ π/ // 2/ ./ 我们/ 令/ θ/ =/ θ/ 0/ +/ Δ/ θ/ ,/ 于是/ 有/ 因为/ Δ/ θ/ ∈/ (/ 0/ ,/ π/ )/ ,/ 所以/ F/ (/ θ/ )/ >/ 0/ / ds/ (/ p1/ ,/ p/ )/ </ ds/ (/ p2/ ,/ p/ )/ ,/ θ/ </ θ/ 0/ 烅/ 烄/ F/ (/ θ/ )/ </ 0/ / ds/ (/ p1/ ,/ p/ )/ >/ ds/ (/ p2/ ,/ p/ )/ ,/ θ/ >/ θ/ 烆/ 该/ 定理/ 是/ 文献/ [/ 12/ ]/ 中/ 的/ 引理/ 1/ 在/ 球面/ 上/ 的/ 推广/ ./ 在/ 球面/ 上/ ,/ 对于/ 两个/ 点/ p1/ (/ θ/ 1/ ,/ / 1/ )/ 和/ p2/ (/ θ/ 2/ ,/ / 2/ )/ ,/ 只要/ 有/ θ/ 1/ ≠/ θ/ 2/ ,/ 则/ 它们/ 关于/ 某一/ 经线/ / 0/ 上/ 每个/ 点/ 的/ 球面/ 距离/ 函数/ 的/ 交点/ 有且/ 仅/ 有/ 一个/ ,/ 这个/ 交点/ 的/ 纬度/ 即/ 它们/ 在/ 该条/ 经线/ 上/ 的/ 中心/ 纬度/ ./ 该/ 定理/ 保证/ 了/ 任意/ 两个/ 点/ p1/ 和/ p2/ 关于/ 某条/ 经线/ 的/ 中心/ 纬度/ 构成/ 了/ 对/ 该/ 经线/ 的/ 划分/ ,/ 使得/ 这/ 条/ 经线/ 上/ 的/ 所有/ 点以/ 中心/ 纬度/ 为界/ ,/ 分别/ 属于/ p1/ 和/ p2/ 所/ 生成/ 的/ 球面/ Voronoi/ 区域/ ./ 4/ 经纬/ 独立/ 扫描/ 算法/ 及/ 实现/ 在/ 第/ 3/ 节中/ ,/ 我们/ 引入/ 了/ 在/ 经度/ -/ 纬度/ 参数/ 域/ 上/ 的/ 球面/ 参数/ 化/ 方法/ 后/ ,/ 给出/ 了/ 球面/ 距离/ 、/ 经度/ 距离/ 、/ 中心/ 纬度/ 等/ 定义/ ,/ 最后/ 证明/ 了/ 在/ 这种/ 参数/ 域/ 上/ ,/ 满足/ 依次/ 沿/ 纬线/ 和/ 经线/ 独立/ 扫描/ 进行/ 球面/ 距离/ 变换/ 的/ 两个/ 重要/ 定理/ ./ 为/ 描述/ 算法/ ,/ 假设/ 在/ 经度/ -/ 纬度/ 参数/ 域/ 上/ ,/ 我们/ 已经/ 把/ 球面/ 离散/ 成/ N/ ×/ N/ 的/ 二维/ 网格/ G/ =/ {/ gi/ ,/ j/ |/ 0/ / i/ ,/ j/ </ N/ }/ ./ 网格/ 的/ 每个/ 元素/ 保存/ 一个/ 索引/ ,/ 初始/ 时/ 所有/ 表示/ 边界/ 像素/ 的/ 网格/ 元素/ 都/ 初始化/ 为/ 自身/ 索引/ ,/ 其它/ 则/ 初始化/ 为/ 一个/ 无效/ 的/ 索引/ ./ 本节/ 中/ ,/ 在/ 讨论/ 球面/ 距离/ 变换/ 算法/ 的/ 时候/ ,/ 如果/ 不/ 存在/ 二义性/ ,/ 二维/ 网格/ 的/ 点/ (/ i/ ,/ j/ )/ 即/ 表示/ 球面/ 上/ 的/ 点/ (/ θ/ j/ ,/ / i/ )/ ./ 4.1/ 沿/ 纬线/ 逆/ // 顺时针/ 扫描/ 对于/ 网格/ 中/ 的/ 第/ i/ 列/ ,/ Ni/ ,/ j/ 表示/ 第/ j/ 行中离/ 球面/ 点/ gi/ ,/ j/ (/ θ/ j/ ,/ / i/ )/ 最近/ 的/ 边界/ 像素/ ,/ 令/ Ni/ =/ {/ Ni/ ,/ j/ |/ Ni/ ,/ j/ ≠/ NULL/ ,/ j/ =/ 0/ ,/ 1/ ,/ 2/ ,/ …/ ,/ n/ -/ 1/ }/ 表示/ 第/ i/ 列/ 每个/ 像素/ 在/ 其/ 所在/ 行中/ 的/ 最近/ 边界/ 像素/ 的/ 集合/ ,/ Ni/ ,/ j/ =/ NULL/ 表示/ 第/ j/ 行/ 没有/ 边界/ 像素/ 存在/ ,/ 称/ Ni/ 为/ 第/ i/ 列/ 的/ 最近/ 边界/ 像素/ 候选/ 集/ ./ 根据/ 定理/ 1/ ,/ 在/ 每/ 一行/ 中/ ,/ 对于/ 经度/ / i/ 上/ 的/ 球面/ 点/ (/ θ/ j/ ,/ / i/ )/ ,/ 我们/ 只/ 需要/ 找到/ 与其/ 具有/ 最近/ 经度/ 距离/ (/ 式/ (/ 1/ )/ )/ 的/ 边界/ 像素/ ./ 因此/ ,/ 对/ 球面/ 参数/ 化/ 得到/ 的/ 二维/ 网格/ 的/ 每/ 一行/ 独立/ 地/ 从左往右/ 和/ 从/ 右/ 往/ 左/ 扫描/ ,/ 即可/ 得到/ 每/ 一列/ 的/ 最近/ 边界/ 像素/ 候选/ 集/ ./ 然而/ ,/ 由于/ 球面/ 的/ 经度/ 坐标/ 在/ 2/ π/ 和/ 0/ 的/ 时候/ 会/ 重合/ ,/ 所以/ ,/ 需要/ 扫描/ 3N/ // 2/ 的/ 长度/ [/ 9/ ]/ ,/ 以/ 找到/ 正确/ 的/ 具有/ 最近/ 经度/ 距离/ 的/ 边界/ 像素/ ./ 如图/ 4/ (/ a/ )/ 所示/ ,/ 在/ 第一次/ 扫描/ 时/ (/ 逆时针/ )/ ,/ 仅/ 需要/ 简单/ 地/ 把/ 每个/ 边界/ 像素/ 的/ 索引/ 填入/ 在/ 其/ 之后/ ,/ 在/ 下/ 一个/ 边界/ 像素/ 之前/ 的/ 网格/ 元素/ 内/ ,/ 扫描/ 完成/ 后/ ,/ 只要/ 该行/ 存在/ 边界/ 像素/ ,/ 每个/ 网格/ 元素/ 都/ 会/ 保存/ 一个/ 边界/ 像素/ 的/ 索引/ ;/ 在/ 第二次/ 反向/ 扫描/ 时/ (/ 顺时针/ )/ ,/ 初始化/ 一个/ 辅助/ 边界/ 像素/ 索引/ B/ 为/ 起始/ 网格/ 元素/ 保存/ 的/ 边界/ 像素/ 的/ 索引/ ,/ 计算/ B/ 与/ 当前/ 网格/ 点/ 的/ 经度/ 距离/ ,/ 并/ 与/ 网格/ 元素/ 已/ 保存/ 的/ 边界/ 像素/ 到/ 该/ 网格/ 点/ 的/ 经度/ 距离/ 比较/ ,/ 如果/ 前者/ 小于/ 后者/ ,/ 则/ 更新/ 当前/ 网格/ 元素/ 以/ 保存/ 新/ 的/ 边界/ 像素/ 的/ 索引/ B/ ;/ 否则/ 将/ B/ 更新/ 为/ 当前/ 网格/ 元素/ 已/ 保存/ 的/ 边界/ 像素/ 的/ 索引/ ./ 4.2/ 沿/ 经线/ 计算/ 球面/ 距离/ 变换/ 给定/ 4.1/ 节中/ 得到/ 的/ 第/ i/ 列/ 的/ 最近/ 边界/ 像素/ 候选/ 集/ Ni/ ,/ 如果/ 把/ Ni/ 中/ 的/ 边界/ 像素/ 的/ Voronoi/ 图/ 不/ 与/ 经线/ / i/ 相交/ 的/ 那些/ 边界/ 像素/ 剔除/ ,/ 则/ 得到/ 第/ i/ 列/ 的/ 最近/ 边界/ 像素/ 集合/ Si/ ./ 根据/ 定理/ 2/ 及/ Meijster/ 等/ 人/ 的/ 方法/ [/ 15/ -/ 16/ ]/ ,/ 将/ 这/ 一步/ 分成/ 两次/ 扫描/ ,/ 第一次/ 扫描/ 从列/ 的/ 顶部/ 至/ 底部/ ,/ 以/ 求得/ 该列/ 的/ 最近/ 边界/ 像素/ 集合/ Si/ ;/ 第二次/ 扫描/ 则/ 从/ 列/ 的/ 底部/ 扫描/ 至/ 顶部/ ,/ 以/ 完成/ 列/ 的/ 每个/ 像素/ 的/ 距离/ 变换/ ./ 算法/ 的/ 大致/ 流程/ 如下/ ./ 对于/ 列/ i/ :/ 初始化/ 两个/ 辅助/ 数组/ W/ ,/ S/ ;/ 令/ W/ [/ 0/ ]/ =/ 0/ ,/ S/ [/ 0/ ]/ =/ Ni/ ,/ 0/ 令/ iter/ =/ 1/ ;/ 1/ ./ 按/ j/ 递增/ 的/ 顺序/ 依次/ 取出/ Ni/ 中/ 的/ 下/ 一个/ 边界/ 像素/ Ni/ ,/ j/ ,/ 执行/ 以下/ 流程/ ,/ 直到/ Ni/ 为空/ ,/ 2.1/ ./ 如果/ θ/ j/ / W/ [/ iter/ -/ 1/ ]/ ,/ 则/ 计算/ 球面/ 点/ (/ θ/ j/ ,/ / i/ )/ 到/ S/ [/ iter/ -/ 1/ ]/ 的/ 球面/ 距离/ 并/ 输出/ 到/ 结果/ 中/ ;/ 否则/ 执行/ 步/ 2.2/ ;/ 2.2/ ./ iter/ =/ iter/ -/ 1/ ,/ 执行/ 步/ 2.1/ ./ 如果/ |/ Ni/ |/ =/ 1/ ,/ 则/ 略过/ 算法/ 中/ 的/ 步/ 1/ ,/ 球面/ 距离/ 变换/ 可以/ 直接/ 扫描/ i/ 列/ 的/ 每个/ 像素/ 并/ 计算/ 到/ 该/ 边界/ 1.1/ ./ 计算/ Ni/ ,/ j/ 和/ S/ [/ iter/ -/ 1/ ]/ 到/ 点/ (/ W/ [/ iter/ -/ 1/ ]/ ,/ / i/ )/ 的/ 球面/ 距离/ ,/ 分别/ 得到/ d1/ 和/ d2/ ,/ 如果/ d1/ >/ d2/ ,/ 执行/ 步/ 1.2/ ;/ 否则/ ,/ 执行/ 步/ 1.3/ ;/ 1.2/ ./ 计算/ Ni/ ,/ j/ 和/ S/ [/ iter/ -/ 1/ ]/ 在/ / i/ 上/ 的/ 中心/ 纬度/ θ/ w/ =/ Θ/ (/ / i/ ,/ Ni/ ,/ j/ ,/ S/ [/ iter/ -/ 1/ ]/ )/ ,/ 并/ 执行/ W/ [/ iter/ ]/ =/ θ/ w/ ,/ S/ [/ iter/ ]/ =/ Ni/ ,/ j/ ,/ iter/ =/ iter/ +/ 1/ ;/ 1.3/ ./ iter/ =/ iter/ -/ 1/ ,/ 执行/ 步/ 1.1/ ;/ 见图/ 4/ (/ b/ )/ ;/ 2/ ./ 对于/ 列/ i/ 的/ 每个/ 像素/ (/ i/ ,/ j/ )/ ,/ 按/ j/ 递减/ 的/ 顺序/ 从/ 底部/ 到/ 顶部/ ,/ Page6/ 像素/ 的/ 球面/ 距离/ 得到/ ./ 另外/ ,/ 根据/ 球面/ 上/ 中心/ 纬度/ 的/ 定义/ 及/ 性质/ ,/ 算法/ 流程/ 的/ 第/ 1/ 部分/ 中/ 的/ 辅助/ 数组/ 至少/ 会/ 有/ 一个/ 元素/ 存在/ ./ 图/ 4/ (/ a/ )/ 表示/ 算法/ 的/ 第/ 1/ 部分/ (/ 分别/ 沿着/ 每条/ 纬线/ 做/ 逆时针/ 和/ 顺时针/ 的/ 长度/ 为/ 3N/ // 2/ 的/ 扫描/ )/ ;/ (/ b/ )/ 表示/ 算法/ 的/ 第/ 2/ 部分/ 的/ 第一次/ 扫描/ (/ 对于/ 一个/ 新/ 的/ 边界/ 像素/ P0/ ,/ 由于/ P0/ 到/ θ/ 1/ 的/ 距离/ 小于/ P1/ 到/ θ/ 1/ 的/ 距离/ ,/ 因此/ 执行/ 算法/ 中/ 的/ 步/ 1.3/ ,/ 从/ 辅助/ 数组/ 中/ 分别/ 移除/ P1/ 和/ θ/ 1/ ;/ 而/ P0/ 到/ θ/ 2/ 的/ 距离/ 大于/ P2/ 到/ θ/ 2/ 的/ 距离/ ,/ 因此/ 执行/ 算法/ 中/ 的/ 步/ 1.2/ ,/ 将/ P0/ 和/ θ/ 0/ 分别/ 加入/ 到/ 辅助/ 数组/ 中/ )/ 4.3/ 算法/ 复杂度/ 在/ 本文/ 算法/ 的/ 第/ 1/ 部分/ (/ 4.1/ 节/ )/ 中/ ,/ 对/ 网格/ 的/ 每/ 一行/ 执行/ 了/ 两次/ 3N/ // 2/ 长度/ 的/ 扫描/ ,/ 因此/ 总体/ 的/ 算法/ 复杂度/ 为/ O/ (/ N2/ )/ ./ 在/ 算法/ 的/ 第/ 2/ 部分/ (/ 4.2/ 节/ )/ 中/ ,/ 对于/ 网格/ 的/ 每/ 一列/ ,/ 算法/ 执行/ 了/ 两次/ O/ (/ N/ )/ 的/ 扫描/ 过程/ ,/ 因而/ 算法/ 的/ 这/ 一/ 步骤/ 在/ 整个/ 二维/ 参数/ 化/ 网格/ 上/ 的/ 复杂度/ 也/ 是/ O/ (/ N2/ )/ ./ 结合/ 两个/ 部分/ ,/ 本文/ 算法/ 的/ 整体/ 复杂度/ 仍然/ 为/ O/ (/ N2/ )/ ./ 4.4/ 基于/ GPU/ 的/ 算法/ 优化/ 因为/ 上述/ 两个/ 部分/ 分别/ 沿着/ 二维/ 参数/ 化/ 网格/ 的/ 每行/ 和/ 每列/ 的/ 扫描/ 是/ 相互/ 独立/ 的/ ,/ 所以/ 我们/ 在/ GPU/ 上用/ CUDA/ 实现/ 了/ 并行/ 的/ 算法/ ./ 注意/ 到/ ,/ 本文/ 算法/ 的/ 第/ 1/ 部分/ 中是/ 沿着/ 网格/ 的/ 行/ 扫描/ 的/ ,/ 而/ 在/ 第/ 2/ 部分/ 中是/ 沿着/ 网格/ 的/ 列/ 进行/ 扫描/ ./ 由于/ GPU/ 显存/ 的/ 存取/ 特性/ ,/ 如果/ 在/ 一个/ Block/ 内/ 的/ 线程/ 具有/ 连续/ 的/ 显存/ 读取/ 和/ 写入/ ,/ 则/ 可以/ 一定/ 程度/ 上/ 提升/ GPU/ 算法/ 的/ 效率/ ./ 因此/ 可以/ 在/ 两个/ 部分/ 之间/ 对/ 存储/ 的/ 二维/ 网格/ 做/ 转置/ ,/ 从而/ 充分发挥/ GPU/ 连续/ 存取/ 显存/ 数据/ 的/ 效率/ ./ 当然/ ,/ 转置/ 需要/ 额外/ 的/ 开销/ ,/ 但是/ ,/ 在/ 实验/ 中/ 我们/ 发现/ ,/ 由于/ 对齐/ 了/ 显存/ 存取/ ,/ 这种/ 开销/ 已经/ 被/ 掩盖/ ./ 另一方面/ ,/ 由于/ GPU/ 是/ 针对/ 大量/ (/ 数以万计/ )/ 线程/ 并行/ 优化/ 的/ 硬件/ 架构/ ,/ 所以/ 当/ 并行执行/ 的/ 线程/ 数量/ 较/ 少时/ ,/ GPU/ 的/ 高性能/ 计算能力/ 无法/ 被/ 充分发挥/ 出来/ ./ 因此/ 我们/ 参照/ Cao/ 等/ 人/ 提出/ 的/ 并行/ 条带/ 算法/ [/ 17/ ]/ ,/ 使用/ m/ 个/ 线程/ 同时/ 处理/ 原来/ 仅/ 由/ 一个/ 线程/ 完成/ 的/ 计算/ 任务/ ,/ 然后/ 用/ 额外/ 的/ 线程/ 协调/ 上述/ m/ 个/ 线程/ 的/ 结果/ ./ 相应/ 的/ 运行/ 时间/ 统计/ 结果/ 在/ 表/ 1/ 的/ 第/ 6/ 列/ (/ 统计/ 时/ m/ =/ 16/ )/ ./ 从中/ 可以/ 看到/ ,/ 当/ 球面/ 参数/ 化/ 密度/ 较/ 低/ 的/ 时候/ ,/ 使用/ 该/ 方法/ 可以/ 用/ 较/ 小/ 的/ 代价/ 获得/ 更/ 高/ 的/ 并行/ 粒度/ ,/ 从而/ 显著/ 提高/ 了/ 球面/ 距离/ 变换/ 的/ 计算/ 性能/ ./ 5/ 实验/ 结果/ 我们/ 的/ 实验/ 平台/ 配置/ 是/ IntelCore2E8400/ 的/ CPU/ (/ 4GB/ 内存/ )/ 和/ NVIDIAGeForce280GTX/ 的/ GPU/ (/ 1GB/ 显存/ )/ ./ 图/ 1/ 显示/ 了/ 我们/ 的/ 算法/ 运行/ 在/ 参数/ 化/ 密度/ 为/ N/ =/ 2048/ 并/ 随机/ 生成/ 100/ 个/ 网格/ 点/ 作为/ 边界/ 像素/ 的/ 结果/ ,/ 和/ Brute/ -/ force/ 算法/ 相比/ ,/ 我们/ 的/ 算法/ 速度/ 优势/ 非常明显/ ./ 图/ 5/ 显示/ 了/ 我们/ 的/ 算法/ 在/ 具有/ 以/ 字符串/ “/ GRAPHICS/ ”/ 为/ 边界/ 像素/ 的/ 输入/ 上/ 得到/ 的/ 结果/ ./ 图/ 6/ 统计/ 了/ 在/ 2048/ ×/ 2048/ 分辨率/ 下/ ,/ 边界/ 像素/ 的/ 数量/ 对/ 算法/ 性能/ 的/ 影响/ ./ 从图/ 中/ 可以/ 看到/ ,/ 算法/ 的/ 第/ 1/ 部分/ 的/ 运行/ 时间/ 基本/ 不/ 受/ 边界/ 像素/ 数量/ 的/ 影响/ ,/ 而/ 第/ 2/ 部分/ 的/ 运行/ 时间/ 随着/ 边界/ 像素/ 的/ 数量/ 变化/ 出现/ 图/ 5/ 应用/ 字符串/ “/ GRAPHICS/ ”/ 作为/ 边界/ 像素/ 生成/ 的/ 等距/ 线/ 结果/ (/ (/ a/ )/ 是/ 边界/ 像素/ 的/ 示意图/ ,/ 采用/ 2048/ ×/ 2048/ 的/ 分辨率/ ,/ (/ b/ )/ 是/ 运行/ 我们/ 算法/ 的/ 结果/ ./ 耗时/ 14.5/ ms/ )/ 图/ 6/ 边界/ 像素/ 数量/ 对/ 本文/ 的/ 经纬/ 独立/ 扫描/ 算法/ 的/ 两个/ 部分/ 的/ 平均/ 运行/ 时间/ 的/ 影响/ (/ 球面/ 参数/ 化/ 密度/ 为/ 2048/ ×/ 2048/ ,/ 横轴/ 表示/ 随机/ 生成/ 的/ 边界/ 像素/ 的/ 数量/ )/ Page7/ 波动/ ./ 当/ 边界/ 像素/ 较/ 少时/ ,/ 每/ 一列/ 的/ 最近/ 边界/ 像素/ 候选/ 集/ 的/ 元素/ 个数/ 也/ 相对/ 较/ 少/ ,/ 从而/ 第/ 2/ 部分/ 中/ 算法/ 流程/ 的/ 步/ 1/ 也/ 能够/ 较/ 快/ 地/ 完成/ ;/ 另一方面/ ,/ 如果/ 第/ 2/ 部分/ 中/ 算法/ 流程/ 的/ 步/ 1.3/ 和步/ 2.2/ 被/ 执行/ 的/ 次数/ 较/ 多/ 而/ 构成/ 深度/ 的/ 循环/ ,/ 由于/ GPU/ 的/ 硬件/ 特性/ ,/ 一个/ 线程/ 将会/ 被/ 分开/ 执行/ ,/ 从而/ 导致/ 了/ 性能/ 下降/ ./ 图/ 6/ 说明/ 了/ 当/ 边界/ 像素/ 密度/ 在/ 10/ %/ 左右/ 时/ ,/ 这种/ 现象/ 最/ 明显/ ./ 然而/ 可以/ 证明/ ,/ 边界/ 像素/ 的/ 数量/ 不会/ 影响/ 整体/ 的/ 算法/ 复杂度/ [/ 16/ ]/ ./ 由于/ 在/ 快速/ 球面/ 距离/ 变换/ 方面/ 的/ 研究/ 相对/ 较/ 少/ ,/ 我们/ 主要/ 与/ Michikawa/ 和/ Suzuki/ [/ 9/ ]/ 的/ SVSDT/ 算法/ 进行/ 对比/ ./ 由于/ 他们/ 的/ 算法/ 是/ 基于/ 向量/ 扩散/ 的/ ,/ 因而/ 难以/ 在/ GPU/ 上/ 实现/ ./ 基于/ 扩散/ 的/ 方法/ 是/ 一个/ 使用/ 优先/ 队列/ 的/ 有序/ 扩散/ 算法/ 的/ 实现/ ,/ 在/ 每次/ 扩散/ 过程/ 中/ 保存/ 最近/ 边界/ 像素/ 的/ 索引/ ,/ 以/ 保证/ 任意/ 两个/ 球面/ 点/ 的/ 距离/ 计算/ 是/ 精确/ 的/ ,/ 然而/ 同/ 一般/ 扩散/ 算法/ 一样/ ,/ 仍然/ 会/ 存在/ 精度/ 误差/ ./ 表/ 1/ 列出/ 了/ 对比/ 实验/ 的/ 统计/ 结果/ ./ 时间/ 统计/ 仅/ 包括/ 球面/ 距离/ 变换/ 执行/ 的/ 时间/ ,/ 不/ 包含/ 初始化/ 部分/ ,/ 基于/ GPU/ 的/ 本文/ 的/ 算法/ 也/ 不/ 包含/ 数据/ 从/ 系统/ 内存/ 上/ 传到/ 显存/ 的/ 时间/ ./ 除/ 本文/ 算法/ 实时/ 计算/ 每个/ 网格/ 点/ 的/ 欧氏/ 空间/ 坐标/ 外/ ,/ 其余/ 三种/ 方法/ 都/ 使用/ 了/ 辅助/ 数组/ 进行/ 缓存/ 加速/ ./ 表/ 1/ 各种/ 算法/ 的/ 时间/ 统计/ (/ 只有/ 本文/ 的/ 算法/ 是/ 基于/ GPU/ 的/ ,/ 边界/ 像素/ 通过/ 随机/ 生成/ 的/ 1000/ 个点/ 得到/ )/ 参数/ 化/ 密度/ 0.080/ ./ 00740.320/ ./ 00921.250/ ./ 01604.960/ ./ 028019.700/ ./ 0600512228.710242117/ ./ 620482479.013/ ./ 87409621945.071/ ./ 88819227811.0571/ ./ 9/ ①/ 注/ :/ 上标/ ①/ 表示/ 由于/ 使用/ 了/ 优先/ 队列/ (/ 具有/ 额外/ 的/ 存储/ 开销/ )/ ,/ 因此/ 受/ 32/ 位/ 系统/ 单/ 进程/ 2GB/ 的/ 内存/ 限制/ ,/ 我们/ 实时/ 计算/ 每个/ 网格/ 点/ 对应/ 的/ 欧式/ 空间/ 坐标/ ./ 与/ 之/ 相距/ 最近/ 的/ 边界/ 像素/ 的/ 坐标/ (/ 4.2/ 节/ 算法/ 流程/ 的/ 步/ 6/ 应用/ 2.1/ 中/ 直接/ 输出/ 最近/ 边界/ 像素/ 的/ 索引/ )/ ,/ 从而/ 可以/ 根据/ 边界/ 像素/ 的/ 属性/ (/ 如/ 颜色/ 等/ )/ 直接/ 生成/ 球面/ Voronoi/ 图/ ,/ 如图/ 7/ (/ a/ )/ 所示/ ./ 球面/ 质心/ Voronoi/ 图/ (/ SphericalCentroidVoronoiDiagrams/ ,/ SCVDs/ )/ 是/ 球面/ Voronoi/ 图/ 计算/ 的/ 一个/ 扩展/ ,/ 在/ 球面/ 均匀/ 网格/ 划分/ 、/ 球面/ 均匀/ 采样/ 等/ 领域/ 有着/ 重要/ 的/ 应用/ ./ 我们/ 使用/ Lloyd/ 迭代/ 算法/ [/ 18/ ]/ 得到/ 球面/ 质心/ Voronoi/ 图/ ,/ 如图/ 7/ 所示/ ./ 本节/ 给出/ 了/ 球面/ 距离/ 变换/ 的/ 3/ 个/ 常见/ 应用/ ./ 6.1/ 球面/ Voronoi/ 图/ 生成/ 球面/ Voronoi/ 图/ 的/ 计算/ 是/ 球面/ 距离/ 变换/ 的/ 直接/ 应用/ ./ 经过/ 球面/ 距离/ 变换/ 后/ ,/ 球面/ 上/ 的/ 每个/ 点/ 都/ 保存/ 了/ 球面/ 距离/ 变换/ 在/ 很多/ 领域/ 都/ 有着/ 重要/ 的/ 应用/ ./ 图/ 7/ 球面/ 质心/ Voronoi/ 图/ 的/ 迭代/ 过程/ (/ 颜色/ 最深/ 的/ 小球/ 表示/ 生成/ 当前/ Voronoi/ 图/ 的/ 中心点/ ,/ 颜色/ 最浅/ 的/ 小球/ 表示/ 6.2/ 地球表面/ 相关/ 的/ 建模/ 从/ 以往/ 的/ 文献/ 中/ ,/ 我们/ 发现/ 球面/ 距离/ 变换/ 的/ 最/ 广泛/ 的/ 应用/ 是/ 在/ 与/ 地球/ 地理/ 相关/ 的/ 各种/ 建模/ 中/ (/ 如/ 气象/ 运动/ 建模/ 、/ 海洋/ 湍流/ 建模/ 等/ )/ ./ 如图/ 8/ 展示/ 了/ 基于/ 快速/ 球面/ 距离/ 变换/ 的/ 地球/ 建模/ ,/ 使用/ 我们/ 的/ 算法/ ,/ 从/ 地球/ 洋面/ 上/ 的/ 任何/ 一个/ 位置/ ,/ 都/ 能/ 迅速/ 得到/ 离其/ 最近/ 的/ 大陆/ 海岸/ 以及/ 相应/ 的/ 球面/ 距离/ ./ 6.3/ 实时/ 绘制/ 中/ 可见/ 性场/ 插值/ 在/ 绘制/ 中/ ,/ 由于/ 可见/ 性场/ 是/ 一个/ 二值/ 函数/ ,/ 因此/ 直接/ 进行/ 插值/ 会/ 产生/ 鬼影/ 效果/ (/ 可见/ 性/ 既/ 不/ 为/ 0/ ,/ 也/ 不/ 为/ 1/ )/ ,/ 如图/ 9/ (/ e/ )/ 所示/ ./ 在/ 文献/ [/ 19/ ]/ 中/ ,/ Wang/ 等/ 人/ 通过/ 将/ 可见/ 性场/ 映射/ 到/ 半球/ 上/ 的/ 带符号/ 球面/ 距离/ 场/ (/ SphericalSignedDistanceField/ ,/ SSDF/ ,/ 即/ 在/ 可见/ 性为/ 0/ 的/ 地方/ 距离/ 为/ 负值/ )/ ,/ 然后/ 通过/ 对/ 距离/ 场/ 进行/ 插值/ 的/ 方法/ ,/ 恢复/ 出/ 对应/ 位置/ 的/ 可见/ 性场/ ,/ 如图/ 9/ 所示/ ./ 本文/ 的/ 算法/ 可以/ 实时/ 地/ 得到/ 距离/ 场/ ,/ 因而/ 可以/ 加快/ 动态/ 场景/ 的/ 真实感/ 绘制/ 过程/ ./ Page8/ 图/ 8/ (/ a/ )/ 和/ (/ b/ )/ 计算/ 海洋/ 中/ 各点/ 到/ 最近/ 海岸/ 的/ 距离/ 变图/ 9/ 球面/ 距离/ 变换/ 应用/ 于/ 绘制/ 中/ 的/ 可见/ 性场/ 插值/ (/ (/ a/ )/ 7/ 总结/ 本文/ 主要/ 研究/ 了/ 球面/ 上/ 快速/ 距离/ 变换/ 的/ 精确/ 方法/ ,/ 提出/ 了/ 一个/ 基于/ GPU/ 的/ 快速/ 球面/ 距离/ 变换/ 的/ 并行算法/ ,/ 称为/ 经纬/ 独立/ 扫描/ 算法/ ,/ 并/ 从/ 理论/ 上/ 证明/ 了/ 在/ 经度/ -/ 纬度/ 参数/ 域/ 上/ 保证/ 我们/ 的/ 算法/ 的/ 正确性/ 的/ 一般/ 定理/ ./ 得益于/ GPU/ 的/ 强大/ 的/ 计算能力/ ,/ 我们/ 的/ 算法/ 在/ 较/ 高分辨率/ 下/ 仍/ 能/ 达到/ 接近/ 实时/ 的/ 计算/ 效率/ ./ 同时/ 本文/ 也/ 展现/ 了/ 球面/ 距离/ 变换/ 在/ 不同/ 领域/ 中/ 的/ 应用/ ./ 虽然/ 本文/ 证明/ 了/ 在/ 球面/ 经度/ -/ 纬度/ 参数/ 域/ 上/ ,/ 我们/ 的/ 算法/ 能够/ 准确/ 地/ 计算/ 球面/ 距离/ 变换/ ,/ 然而/ ,/ 由于/ 这种/ 球面/ 参数/ 化是/ 不/ 均匀/ 的/ 参数/ 化/ ,/ 因而/ 在/ 球面/ 上/ 从/ 赤道/ 到/ 两极/ 存在/ 着/ 精度/ 变化/ ,/ 在/ 未来/ 的/ 工作/ 中/ 可以/ 研究/ 新/ 的/ 球面/ 参数/ 化/ 方法/ ,/ 使得/ 在/ 整个/ 球面/ 上/ 具有/ 更加/ 一致/ 的/ 精度/ ./ 

