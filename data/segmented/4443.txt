Page1/ 基于/ 主/ -/ 备/ 关系/ 的/ PMIPv6/ 区域/ 移动/ 锚点/ 容错/ 方案/ 张瀚文/ 1/ )/ 许智君/ 1/ )/ ,/ 2/ )/ 张玉军/ 1/ )/ 李/ 忠诚/ 1/ )/ 1/ )/ (/ 中国科学院计算技术研究所/ 北京/ 100190/ )/ 2/ )/ (/ 中国科学院/ 大学/ 北京/ 100049/ )/ 摘要/ 代理/ 移动/ IPv6/ (/ PMIPv6/ )/ 是/ IETF/ 提出/ 的/ 基于/ 网络/ 的/ 区域/ 移动/ 管理/ 协议/ ./ 在/ PMIPv6/ 系统/ 中/ ,/ 区域/ 移动/ 锚点/ (/ LMA/ )/ 是/ 维持/ 移动/ 节点/ (/ MobileNode/ ,/ MN/ )/ 在/ PMIPv6/ 域/ 内/ 不同/ 接入/ 链路/ 间/ 移动/ 过程/ 中/ 可达性/ 的/ 关键/ 实体/ ./ 文中/ 针对/ PMIPv6/ 中/ LMA/ 的/ 单点故障/ 问题/ ,/ 提出/ 一种/ 基于/ 主/ -/ 备/ 关系/ 的/ 区域/ 移动/ 锚点/ 容错/ 方案/ (/ LMAFT/ )/ ./ 方案/ 在/ PMIPv6/ 域/ 内/ 部署/ 多/ LMA/ ,/ 并/ 建立/ 一一对应/ 的/ 主/ -/ 备/ 关系/ ,/ 通过/ LMA/ 间/ 自/ 组织/ 状态/ 管理/ 实现/ 容错/ ./ 方案设计/ 了/ 双向/ 有效性/ 检测/ 机制/ ,/ 实现/ 主/ 、/ 备/ LMA/ 间/ 快速/ 的/ 失效/ 检测/ ;/ LMA/ 服务/ 迁移/ 机制/ 支持/ 失效/ 实体/ 全部/ 服务/ 迁移/ 和/ 过载/ 实体/ 部分/ 服务/ 迁移/ ,/ 实现/ 容错/ 的/ 同时/ 支持/ 多/ LMA/ 负载/ 均衡/ ./ 理论/ 分析/ 和/ 仿真/ 实验/ 结果表明/ ,/ LMAFT/ 方案/ 可/ 将/ LAM/ 容错/ 时间/ 控制/ 在/ 50ms/ ~/ 350ms/ ./ 当/ 容错/ 时间/ 控制/ 在/ 100ms/ 以下/ 时/ ,/ 可/ 完全避免/ LMA/ 失效/ 对/ 移动/ 节点/ MN/ 的/ TCP/ 应用/ 造成/ 的/ 影响/ ;/ 最差/ 情况/ 下/ ,/ 也/ 可/ 在/ LMA/ 失效/ 发生/ 后/ 的/ 1s/ ~/ 2.7/ s/ 内/ 快速/ 恢复/ 相关/ MN/ 的/ TCP/ 应用/ 吞吐量/ ./ 对于/ UDP/ 应用/ ,/ LMAFT/ 方案/ 可/ 在/ LMA/ 失效/ 发生/ 后/ 2s/ 内/ 恢复/ 相关/ MN/ 的/ 收/ 包率/ ./ 关键词/ 代理/ 移动/ IPv6/ ;/ 区域/ 移动/ 锚点/ ;/ 可靠性/ ;/ 容错/ 1/ 引言/ 代理/ 移动/ IPv6/ (/ ProxyMobileIPv6/ ,/ PMIPv6/ )/ 协议/ [/ 1/ ]/ 是/ IETF/ 制定/ 的/ 无需/ 终端/ 参与/ 的/ 、/ 基于/ 网络/ 的/ 区域/ 移动/ 管理/ 协议/ ./ 利用/ 该/ 协议/ ,/ 未经/ 修改/ 的/ 任意/ IP/ 节点/ 在/ 一定/ 管理/ 域/ 内/ ,/ 都/ 可/ 在/ 不同/ 接入/ 路由器/ 间/ 移动/ 而/ 无需/ 改变/ 其/ IP地址/ ./ 目前/ PMIPv6/ 协议/ 已/ 被/ 多种/ 通信/ 技术标准/ (/ 3GPPSAE/ 、/ WiMAX/ 等/ )/ 所/ 采用/ ,/ 成为/ 多种/ 通信/ 网络/ 建设/ 中/ 实现/ 区域/ 移动/ 管理/ 的/ 首选/ 技术/ 方案/ ./ 在/ PMIPv6/ 系统/ 中/ ,/ 区域/ 移动/ 锚点/ (/ LocalizedMobilityAnchor/ ,/ LMA/ )/ 是/ PMIPv6/ 域/ 内/ 所有/ MN/ 的/ 路由/ 锚点/ ,/ 是/ 维持/ MN/ 在域/ 内/ 不同/ 接入/ 链路/ 间/ 移动/ 过程/ 中/ 可达性/ 的/ 关键/ 实体/ ,/ 承担/ 两/ 方面/ 的/ 功能/ :/ 维护/ MN/ 在/ PMIPv6/ 域/ 内/ 的/ 位置/ 信息/ ,/ 即/ MN/ 当前/ 附着/ 的/ 移动/ 接入网/ 关/ (/ MobilityAccessGateway/ ,/ MAG/ )/ ;/ 通过/ 与/ LMA/ -/ MAG/ 间/ 的/ 双向/ 隧道/ 为/ MN/ 转发/ 数据包/ ./ 作为/ PMIPv6/ 系统/ 中/ 最/ 重要/ 的/ 基础设施/ ,/ LMA/ 同时/ 也/ 是/ 系统/ 单点故障/ 隐患/ 所在/ ./ LMA/ 失效/ 将/ 导致/ 整个/ PMIPv6/ 域/ 的/ 移动/ 管理/ 服务/ 失效/ ,/ 处于/ 该域/ 内/ 的/ 所有/ MN/ 将/ 失去/ 可达性/ ./ PMIPv6/ 协议/ 明确指出/ 应/ 在/ 一个/ PMIPv6/ 域/ 内/ 部署/ 多/ LMA/ 以/ 支持/ 容错/ ,/ 但/ 并未/ 定义/ 具体/ 容错/ 方案/ ./ 即使/ 实现/ 多/ LMA/ 部署/ ,/ PMIPv6/ 协议/ 本身/ 也/ 是/ 不/ 具备/ LMA/ 容错/ 能力/ 的/ ./ 这/ 是因为/ :/ PMIPv6/ 协议/ 的/ 设计/ 原则/ 是/ 移动/ 管理/ 服务/ 完全/ 由/ 网络/ 实现/ ,/ 无需/ MN/ 参与/ ./ 遵循/ 这一/ 设计/ 思想/ ,/ PMIPv6/ 系统/ 中/ 的/ 移动/ 管理/ 实体/ 对/ MN/ 是/ 不/ 可见/ 的/ ./ 因此/ ,/ MN/ 由于/ 当前/ 服务/ LMA/ 失效/ 而/ 失去/ 网络连接/ 时/ ,/ 不/ 可能/ 通过/ 可用/ LMA/ 发现/ 和/ 重/ 配置/ 选择/ 新/ 的/ LMA/ 恢复/ 网络连接/ ,/ 这些/ MN/ 甚至/ 根本无法/ 获知/ 导致/ 其/ 失去/ 连接/ 的/ 原因/ 是/ LMA/ 失效/ ./ PMIPv6/ 实际/ 部署/ 和/ 运营/ 要求/ 解决/ LMA/ 单点故障/ 问题/ ,/ 保障/ 系统可靠性/ ./ 本文/ 首次/ 提出/ 一种/ 基于/ 主/ -/ 备/ 关系/ 的/ LMA/ 容错/ 方案/ ,/ 解决/ 了/ PMIPv6/ 系统/ 中/ 的/ LMA/ 单点故障/ 问题/ ,/ 使得/ 某/ LMA/ 失效/ 后/ ,/ 系统/ 仍能/ 提供/ 既定/ 服务/ ./ 本文/ 第/ 2/ 节对/ 相关/ 研究/ 现状/ 进行/ 介绍/ 和/ 分析/ ;/ 第/ 3/ 节/ 提出/ 基于/ 主/ -/ 备/ 关系/ 的/ LMA/ 容错/ 方案/ ;/ 第/ 4/ 节/ 和/ 第/ 5/ 节/ 分别/ 通过/ 理论/ 分析/ 和/ 仿真/ 实验/ ,/ 从/ LMA/ 容错/ 时间/ 、/ 不同/ 应用/ 下/ 的/ LMA/ 容错性/ 能/ 、/ LMA/ 容错/ 开销/ 等/ 方面/ ,/ 对/ 方案/ 进行/ 定量/ 评价/ ;/ 最后/ 总结/ 全文/ ./ 2/ 相关/ 工作/ 目前/ 针对/ PMIPv6/ 的/ 研究/ 主要/ 集中/ 在/ 路由/ 优化/ 、/ 性能/ 评价/ 、/ 多穴/ 支持/ 、/ PMIPv6/ -/ MIPv6/ 交互/ 等/ 方面/ [/ 2/ -/ 8/ ]/ ./ PMIPv6/ 可靠性/ 技术/ 方面/ 的/ 研究/ 工作/ 尚/ 处于/ 起步/ 阶段/ ./ 文献/ [/ 9/ ]/ 提出/ PMIPv6/ 心跳/ 机制/ 实现/ MAG/ 和/ LMA/ 之间/ 相互/ 的/ 可达性/ 检测/ ./ 文献/ [/ 10/ ]/ 针对/ PMIPv6/ 中/ 另/ 一/ 关键/ 移动/ 管理/ 实体/ 移动/ 接入网/ 关/ (/ MAG/ )/ ,/ 提出/ 容错/ 方案/ ./ 然而/ 针对/ PMIPv6/ 移动/ 锚点/ LMA/ 的/ 容错/ 方案/ 还有/ 待/ 进一步/ 研究/ ./ 另一方面/ ,/ PMIPv6/ 中/ 的/ LMA/ 和/ MIPv6/ [/ 11/ ]/ 中/ 的/ 家乡/ 代理/ (/ HomeAgent/ ,/ HA/ )/ 分别/ 是/ 维持/ MN/ 在/ 区域/ 范围/ 微/ 移动/ 和/ 全局/ 范围/ 宏/ 移动/ 过程/ 中/ 可达性/ 的/ 移动/ 锚点/ ,/ 二者/ 在/ 功能/ 上/ 具有/ 相似性/ ./ MIPv6/ 中/ 的/ HA/ 容错/ 方法/ 研究/ 已/ 取得/ 了/ 一系列/ 研究成果/ [/ 12/ -/ 15/ ]/ ,/ 这些/ 成果/ 中/ 的/ 某些/ 思想/ 可/ 被/ 借鉴/ 用于/ 解决/ PMIPv6/ 实体/ 容错/ ./ 然而/ ,/ LMA/ 和/ HA/ 在/ 功能/ 实现/ 原理/ 及/ 部署/ 方式/ 上/ 存在/ 以下/ 差异/ ,/ 使得/ HA/ 容错/ 方案/ 无法/ 直接/ 应用/ 于/ LMA/ 容错/ :/ (/ 1/ )/ MIPv6/ 是/ 基于/ 主机/ 的/ 移动/ 管理/ 方案/ ,/ HA/ 容错/ 方案/ 的/ 设计/ 需要/ 考虑/ 多/ HA/ 对/ MN/ 的/ 呈现/ 形式/ 及/ 容错/ 过程/ 对/ MN/ 的/ 透明性/ ;/ 而/ PMIPv6/ 是/ 基于/ 网络/ 的/ 移动/ 管理/ 方案/ ,/ LMA/ 对/ MN/ 是/ 不/ 可见/ 的/ ,/ 其/ 容错/ 方案/ 无须/ 考虑/ 多/ LMA/ 对/ MN/ 的/ 呈现/ 形式/ ./ (/ 2/ )/ MIPv6/ 中多/ HA/ 部署/ 于/ 同一/ 家乡/ 链路/ ,/ 可以/ 引入/ 集中/ 的/ 管理/ 实体/ 对/ 多/ HA/ 进行/ 合理/ 组织/ ,/ 实现/ 高效/ 容错/ ;/ 而/ 在/ PMIPv6/ 网络/ 中/ ,/ 家乡/ 链路/ 只是/ 逻辑/ 上/ 的/ 概念/ ,/ 多/ LMA/ 部署/ 于/ 不同/ 物理/ 链路/ ,/ 对/ 多/ LMA/ 采用/ 集中管理/ ,/ 相关/ 处理/ 延时/ 将/ 很大/ ,/ 且/ 将/ 引入/ 大量/ 管理/ 开销/ ./ 对于/ LMA/ 容错/ ,/ 应/ 考虑/ 基于/ LMA/ 间/ 的/ 自/ 组织/ 方式/ ,/ 实现/ 实体/ 状态/ 管理/ 和/ 失效/ 实体/ 的/ 服务/ 恢复/ ./ (/ 3/ )/ MIPv6/ 中/ ,/ 仅/ 有/ 实体/ HA/ 维护/ MN/ 的/ 移动/ 管理/ 信息/ ,/ 现有/ HA/ 容错/ 方案/ 大都/ 基于/ HA/ 间/ 的/ 信息/ 备份/ 实现/ 失效/ HA/ 的/ 快速/ 服务/ 恢复/ ./ 而/ LMA/ 容错/ 不宜/ 采用/ 基于/ 信息/ 备份/ 的/ 方法/ ,/ 原因/ 如下/ :/ 首先/ ,/ 多/ LMA/ 部署/ 于/ 不同/ 链路/ ,/ 而/ LMA/ 作为/ 多个/ MAG/ 的/ 汇聚/ 点/ ,/ 维护/ 的/ 信息量/ 大且/ 更新/ 频繁/ ,/ 难以实现/ LMA/ 间/ 的/ 信息/ 实时/ 同步/ ,/ 且/ 会/ 在/ 不同/ 链路/ 间/ 引入/ 大量/ 同步/ 开销/ ;/ 其次/ ,/ PMIPv6/ 中/ LMA/ 和/ MAG/ 维护/ 一致/ 的/ 移动/ 管理/ 信息/ ,/ LMA/ 失效/ 后/ ,/ 其/ 服务/ 接管/ 实体/ 可/ 从/ MAG/ 处/ 获得/ 相关/ 信息/ ./ (/ 4/ )/ HA/ 和/ LMA/ 的/ 路由/ 锚点/ 功能/ 实现/ 方式/ 不/ Page3/ 同/ :/ HA/ 为/ MN/ 分配/ 家乡/ 地址/ HoA/ ,/ 这些/ HoA/ 地址/ 的/ 前缀/ 为/ HA/ 的/ 拓扑/ 前缀/ ,/ HA/ 通过/ 在/ 本地/ 链路/ 为/ 移动/ 到/ 外地/ 的/ MN/ 广播/ 代理/ 邻居/ 宣告/ 消息/ ,/ 将/ 其/ HoA/ 绑定/ 到/ 自己/ 的/ 物理地址/ ,/ 从而/ 实现/ 为/ MN/ 截获/ 并/ 转发/ 数据包/ 的/ 功能/ ;/ 而/ LMA/ 则/ 为/ 各/ MN/ 分配/ 独立/ 的/ 家乡/ 网络/ 前缀/ (/ MN/ ’/ sHomeNetworkPrefix/ ,/ MN/ -/ HNP/ )/ ,/ 并/ 通过/ 对外/ 宣告/ MN/ -/ HNP/ 为/ MN/ 建立/ 路由/ ./ 移动/ 代理/ 功能/ 实现/ 方式/ 的/ 不同/ ,/ 使得/ 两种/ 实体/ 失效/ 后/ 的/ 服务/ 接管/ 方式/ 也/ 不/ 可能/ 相同/ ./ (/ 5/ )/ MIPv6/ 中/ ,/ HA/ 是/ 唯一/ 移动/ 管理/ 实体/ ,/ 容错/ 过程/ 不/ 涉及/ 其他/ 实体/ ;/ 而/ PMIPv6/ 中/ ,/ LMA/ 和/ MAG/ 共同/ 实现/ 对/ MN/ 的/ 移动/ 管理/ ,/ LMA/ 失效/ 后/ 的/ 容错/ 处理/ 需要/ 与/ 对/ 端/ 实体/ MAG/ 交互/ ./ 3/ 基于/ 主/ -/ 备/ 关系/ 的/ LMA/ 容错/ 方案/ 本文/ 提出/ 一种/ 基于/ 主/ -/ 备/ 关系/ 的/ LMA/ 容错/ 方案/ (/ LMAFault/ -/ Tolerantmethodbasedonprimary/ -/ standbyrelationship/ ,/ LMAFT/ )/ ,/ 使得/ PMIPv6/ 域/ 内/ 某/ LMA/ 失效/ 时/ ,/ 在/ 无需/ MN/ 参与/ 的/ 前提/ 下/ ,/ 由/ 网络/ 快速/ 实现/ LMA/ 失效/ 检测/ 和/ 失效/ LMA/ 的/ 服务/ 接管/ ,/ 恢复/ 对/ failure/ -/ affected/ -/ MN/ (/ 原本/ 由/ 失效/ LMA/ 所/ 服务/ 的/ MN/ ,/ 后文/ 简称/ fa/ -/ MN/ )/ 的/ 服务/ ,/ 减小/ 对/ fa/ -/ MN/ 上层/ 应用/ 造成/ 的/ 影响/ ./ LMAFT/ 系统结构/ 如图/ 1/ 所示/ ,/ 在/ PMIPv6/ 域/ 内/ 部署/ 多/ LMA/ ,/ 并/ 建立/ 一一对应/ 的/ 主/ -/ 备/ 关系/ ,/ 通过/ LMA/ 间/ 自/ 组织/ 的/ 状态/ 管理/ 实现/ 容错/ ./ 备/ -/ LMA/ (/ standby/ -/ LMA/ ,/ 后文称/ s/ -/ LMA/ )/ 负责/ 对/ 所/ 支持/ 的/ 主/ -/ LMA/ (/ primary/ -/ LMA/ ,/ 后文称/ p/ -/ LMA/ )/ 进行/ 主动/ 的/ 有效性/ 检测/ 和/ 失效/ 后/ 的/ 服务/ 接管/ ./ LMAFT/ 的/ 实现/ 包括/ LMA/ 主/ -/ 备/ 关系/ 动态/ 建立/ 、/ 失效/ 检测/ 和/ 服务/ 迁移/ 3/ 个/ 关键/ 过程/ ./ 3.1/ LMA/ 主/ -/ 备/ 关系/ 动态/ 建立/ 各/ LMA/ 本地/ 维护/ 一/ LMA/ 列表/ (/ LMAList/ ,/ LMAL/ )/ ,/ 记录/ PMIPv6/ 域/ 内/ 所有/ LMA/ 的/ 优先级/ 、/ 当前/ 状态/ (/ “/ 有效/ ”/ 或/ “/ 失效/ ”/ )/ 、/ 主/ -/ 备/ 关系/ 等/ 信息/ ./ LMA/ 在/ 系统/ 初始化/ 、/ 失效/ 重启/ 恢复/ 、/ 或/ 其/ 当前/ s/ -/ LMA/ 失效/ 时/ ,/ 通过/ LMA/ 主/ -/ 备/ 关系/ 动态/ 建立/ 过程/ (/ 如图/ 2/ )/ ,/ 在域/ 内/ 选择/ 唯一/ LMA/ 配置/ 为/ s/ -/ LMA/ ./ (/ 1/ )/ LMAi/ 根据/ 本地/ LMAL/ 所/ 维护/ 的/ 域/ 内/ 所有/ LMA/ 信息/ ,/ 从/ 当前/ “/ 有效/ ”/ LMA/ 中/ ,/ 选择/ 优先级/ 最高/ 且/ 已/ 支持/ p/ -/ LMA/ 数目/ 最少/ 的/ 一个/ 作为/ 候选/ s/ -/ LMA/ (/ 图中以/ LMAj/ 为例/ )/ ./ (/ 2/ )/ LMAi/ 向/ LMAj/ 发送/ 主/ -/ 备/ 关系/ 建立/ 请求/ (/ PSRSR/ )/ ./ (/ 3/ )/ LMAj/ 接收/ PSRSR/ 消息/ 后/ ,/ 根据/ 自身/ 状态/ 或/ 其他/ 可/ 选/ 本地/ 策略/ 判断/ 是否/ 接受/ 请求/ ./ 若/ 接受/ ,/ 则/ 在/ 本地/ LMAL/ 中/ 更新/ 请求/ 发送者/ LMAi/ 表项/ 中/ 的/ 主/ -/ 备/ 关系/ 信息/ ./ (/ 4/ )/ LMAj/ 向/ LMAi/ 回复/ 主/ -/ 备/ 关系/ 建立/ 应答/ (/ PSRSA/ )/ 消息/ ,/ 指示/ 接受/ 或/ 拒绝/ 主/ -/ 备/ 关系/ 建立/ 请求/ ,/ 可选/ 的/ 指示/ 拒绝/ 原因/ ./ (/ 5/ )/ LMAi/ 接收/ PSRSA/ 后/ ,/ 若/ 消息/ 指示/ 拒绝请求/ ,/ 则/ 回到/ 步/ (/ 1/ )/ ,/ 选择/ 新/ 的/ 候选/ s/ -/ LMA/ 重新/ 执行/ 此/ 过程/ ;/ 若/ 消息/ 指示/ 接受/ 请求/ ,/ 则/ 在/ 本地/ LMAL/ 中/ 更新/ 自己/ 的/ 主/ -/ 备/ 关系/ 信息/ ,/ 并/ 执行/ 步/ (/ 6/ )/ ./ (/ 6/ )/ LMAi/ 向域/ 内/ 其他/ LMA/ 发送/ 主/ -/ 备/ 关系/ 建立/ 通告/ (/ PSRSN/ )/ 消息/ ,/ 宣告/ 新/ 配置/ 的/ s/ -/ LMA/ ./ (/ 7/ )/ 其他/ LMA/ 接收/ 到/ PSRSN/ 消息/ 后/ ,/ 在/ 本地/ LMAL/ 中/ 更新/ LMAi/ 的/ 主/ -/ 备/ 关系/ 信息/ ./ 3.2/ LMA/ 失效/ 检测/ LMAFT/ 中/ ,/ 各/ LMA/ 与其/ s/ -/ LMA/ 需/ 相互/ 进行/ 有效性/ 检测/ ,/ 当/ LMA/ 检测/ 到/ 其/ s/ -/ LMA/ 失效/ ,/ 需/ 配置/ 新/ 的/ s/ -/ LMA/ ;/ 当/ LMA/ 检测/ 到/ 它/ 所/ 支持/ 的/ 某/ p/ -/ LMA/ 失效/ ,/ 需/ 接管/ 失效/ LMA/ 所/ 服务/ 的/ 所有/ fa/ -/ MN/ ./ 为/ 减小/ 容错/ 方案/ 引入/ 的/ 信令/ 开销/ ,/ LMAFT/ 设计/ 实现/ 了/ 双向/ 的/ 有效性/ 检测/ 机制/ (/ 如图/ 3/ 所示/ )/ ,/ 其/ Page4/ 基本/ 思想/ 是/ :/ s/ -/ LMA/ 作为/ 主动/ 检测/ 方/ ,/ 其/ 支持/ 的/ p/ -/ LMA/ 作为/ 被动/ 检测/ 方/ ;/ s/ -/ LMA/ 以/ 间隔时间/ Ihb/ (/ 心跳/ 间隔时间/ HEARTBEAT/ _/ INTERVAL/ )/ 周期性地/ 向/ p/ -/ LMA/ 发送/ 心跳/ 请求/ (/ HeartbeatRequest/ ,/ HReq/ )/ ;/ 双方/ 各为/ 对/ 端/ 维护/ 一/ 心跳/ 定时器/ TO/ 和/ 丢失/ 心跳/ 消息/ 计数器/ nmhb/ ;/ 双方/ 一旦/ 接收/ 到/ 对/ 端/ 发送/ 的/ HReq/ ,/ 若/ 消息/ 序列号/ 大于/ 上/ 一/ 接收/ 消息/ ,/ 需/ 回复/ 相应/ 的/ 心跳/ 应答/ (/ HeartbeatResponse/ ,/ HRsp/ )/ ./ 对于/ 主动/ 方/ s/ -/ LMA/ :/ 周期性/ 发送/ HReq/ ,/ 在/ 发送/ 前/ 将/ 对/ 端/ 维护/ 的/ nmhb/ 增/ 1/ 后/ 判断/ nmhb/ 是否/ 已/ 增至/ 心跳/ 消息/ 允许/ 丢失/ 数目/ Nmh/ ,/ 若/ nmhb/ =/ =/ Nmh/ 则/ 判断/ 对端/ 失效/ ,/ 若/ nmhb/ </ Nmh/ 才/ 向/ 对/ 端/ 发送/ HReq/ ;/ s/ -/ LMA/ 发送/ HReq/ 后/ 将/ 对/ 端/ 维护/ 的/ TO/ 重置/ 为/ Ihb/ ;/ 每当/ 收到/ 对端/ 回复/ 的/ HRsp/ ,/ 将/ 其/ nmhb/ 置/ 0/ ./ 对于/ 被动/ 方/ p/ -/ LMA/ :/ 每当/ 接收/ 到/ 端/ s/ -/ LMA/ 发送/ 的/ HReq/ 后/ ,/ 首先/ 将/ 其/ 维护/ 的/ nmhb/ 置/ 0/ ,/ 并/ 将/ 其/ 维护/ 的/ TO/ 重置/ 为/ Ihb/ ,/ 之后/ 回复/ HRsp/ ;/ 当/ 定时器/ TO/ 到期/ ,/ 将/ 对/ 端的/ nmhb/ 增/ 1/ ,/ 若/ nmhb/ 值/ 达到/ Nmh/ ,/ 则/ 向/ 对/ 端/ s/ -/ LMA/ 主动/ 发送/ 一/ HReq/ ,/ 重置/ 定时器/ TO/ 为/ 略大于/ Ihb/ 的/ 值/ (/ Ihb/ +/ Δ/ )/ ,/ 若/ TO/ 到期/ ,/ 仍/ 未/ 接收/ 到/ s/ -/ LMA/ 的/ 应答/ 则/ 判断/ 其/ 失效/ ./ s/ -/ LMA/ 一旦/ 检测/ 到/ p/ -/ LMA/ 失效/ ,/ 就/ 作为/ 接管/ 实体/ 发起/ LMA/ 服务/ 迁移/ 过程/ ,/ 接管/ 其/ 服务/ 的/ 所有/ MN/ ;/ 并/ 向域/ 内/ 所有/ 其他/ LMA/ 发送/ 失效/ 通告/ 消息/ (/ LMAFailureNotify/ ,/ LFN/ )/ ,/ 通告/ p/ -/ LMA/ 失效/ ;/ 各/ LMA/ 接收/ LFN/ 后/ ,/ 在/ 本地/ LMAL/ 中/ 更新/ 失效/ LMA/ 状态/ ./ p/ -/ LMA/ 一旦/ 检测/ 到/ s/ -/ LMA/ 失效/ ,/ 则/ 发起/ LMA/ 主/ -/ 备/ 关系/ 动态/ 建立/ 过程/ ,/ 配置/ 新/ 的/ s/ -/ LMA/ ./ 失效/ 检测/ 过程/ 中/ ,/ p/ -/ LMA/ 可能/ 接收/ 到/ 其他/ LMA/ 发送/ 的/ LFN/ 消息/ ,/ 通告/ 其/ s/ -/ LMA/ 失效/ ,/ 此时/ p/ -/ LMA/ 停止/ 检测/ 过程/ ,/ 直接/ 触发/ LMA/ 主/ -/ 备/ 关系/ 动态/ 建立/ 过程/ ./ 3.3/ LMA/ 服务/ 迁移/ LMA/ 服务/ 迁移/ 机制/ ,/ 针对/ 失效/ 或/ 过载/ LMA/ 分别/ 实现/ 全部/ 或/ 部分/ 服务/ 迁移/ (/ 如图/ 4/ )/ ./ 对于/ 失效/ LMA/ 服务/ 迁移/ :/ 失效/ LMA/ 的/ s/ -/ LMA/ 检测/ 到/ 其/ 失效/ 后/ ,/ 将/ 作为/ 接管/ 实体/ (/ takeover/ -/ LMA/ ,/ t/ -/ LMA/ )/ 触发/ 服务/ 迁移/ 过程/ ,/ 向域/ 内/ 所有/ MAG/ 通告/ 失效/ LMA/ ,/ 并/ 从/ fa/ -/ MN/ 当前/ 附着/ 的/ MAG/ 获取/ 移动/ 管理/ 信息/ ,/ 接管/ 所有/ fa/ -/ MN/ ./ 对于/ 过载/ LMA/ 服务/ 迁移/ :/ 处于/ “/ 过载/ ”/ 状态/ 的/ LMA/ 将/ 根据/ 本地/ LMAL/ 所/ 维护/ 的/ 各/ LMA/ 状态/ ,/ 选择/ 某/ LMA/ ,/ 向/ 其/ 发送/ 负载/ 迁移/ 请求/ ./ 被/ 选/ LMA/ 若/ 接受/ 请求/ ,/ 则/ 作为/ t/ -/ LMA/ 发起/ LMA/ 服务/ 迁移/ 过程/ ,/ 接管/ “/ 过载/ ”/ LMA/ 的/ 部分/ 负载/ ./ LMA/ 服务/ 迁移/ 机制/ 具体/ 实现/ 如下/ :/ (/ 1/ )/ t/ -/ LMA/ 触发/ LMA/ 服务/ 迁移/ 过程/ :/ 触发/ 事件/ :/ t/ -/ LMA/ 检测/ 到/ LMA/ 失效/ ;/ 或/ LMAPage5/ 过载/ ,/ 请求/ 将/ 部分/ 负载/ 迁移/ 至/ t/ -/ LMA/ ./ 步/ (/ 2/ )/ 仅/ 在/ p/ -/ LMA/ 过载/ 触发/ 的/ LMA/ 服务/ 迁移/ 场景/ 下/ 发生/ ./ (/ 2/ )/ LMA/ 与/ t/ -/ LMA/ 间/ 上下文/ 传递/ 迁移/ MN/ 的/ 移动/ 管理/ 信息/ ,/ 双方/ 可/ 协商/ 迁移/ MN/ 数目/ 等/ 信息/ ./ (/ 3/ )/ t/ -/ LMA/ 向/ 相关/ MAG/ 发送/ LMA/ 服务/ 迁移/ 通告/ (/ LMAServiceSwitchingNotify/ ,/ LSSN/ )/ :/ ①/ LMA/ 失效/ 触发/ 的/ 服务/ 迁移/ ,/ 则/ 向域/ 内/ 所有/ MAG/ 发送/ ;/ LMA/ 过载/ 触发/ 的/ 服务/ 迁移/ ,/ 则/ 仅/ 向/ 待/ 迁移/ MN/ 当前/ 附着/ 的/ MAG/ 发送/ ,/ 并/ 在/ 消息/ 中/ 携带/ 待/ 迁移/ MN/ 标识/ ;/ 效/ 或/ LMA/ 过载/ ./ ②/ 通告/ 消息/ 中/ 携带/ 原/ LMA/ 标识/ ;/ ③/ LSSN/ 消息/ 指示/ 服务/ 迁移/ 触发/ 原因/ :/ LMA/ 失/ (/ 4/ )/ MAG/ 查找/ 需/ 迁移/ 的/ MN/ :/ ①/ MAG/ 接收/ 到/ LSSN/ 消息/ ,/ 若/ 消息/ 表示/ 迁移/ 触发/ 原因/ 为/ LMA/ 失效/ ,/ 则/ 在/ 本地/ LMAL/ 中将/ 失效/ LMA/ 的/ 状态/ 置/ 为/ “/ 失效/ ”/ ;/ ②/ MAG/ 从/ LSSN/ 消息/ 中/ 获取/ 迁移/ MN/ 标识/ (/ 过载/ LMA/ 部分/ 服务/ 迁移/ 场景/ 下/ )/ ;/ 或/ 根据/ 失效/ LMA/ 标识/ 在/ 本地/ 绑定/ 的/ 更新/ 列表/ (/ BUL/ )/ 中/ 查找/ 需/ 迁移/ MN/ (/ fa/ -/ MN/ )/ ,/ 若/ 未查/ 找到/ 需/ 迁移/ MN/ ,/ 则/ 不再/ 进行/ 后续/ 处理/ ./ (/ 5/ )/ MAG/ 锁定/ 待/ 迁移/ MN/ 的/ BUL/ (/ 可/ 选/ 步骤/ )/ :/ 步/ (/ 6/ )/ ~/ (/ 13/ )/ 的/ 迁移/ 过程/ 中/ ,/ MAG/ 暂存/ 会/ 导致/ MN/ 的/ 移动/ 管理/ 信息/ 改变/ ./ (/ 6/ )/ MAG/ 向/ t/ -/ LMA/ 发送/ LMA/ 服务/ 迁移/ 请求/ (/ LMAServiceSwitchingRequest/ ,/ LSSR/ )/ :/ 若/ MAG/ 先前/ 接收/ 到/ 的/ LSSN/ 指示/ 迁移/ 触发/ 原因/ 为/ LMA/ 失效/ ,/ 则/ LSSR/ 中/ 携带/ 待/ 迁移/ MN/ 的/ 移动/ 管理/ 信息/ ./ 提供/ 移动/ 管理/ 服务/ ./ (/ 7/ )/ t/ -/ LMA/ 接收/ 处理/ LSSR/ :/ 若/ 接受/ LSSR/ ,/ t/ -/ LMA/ 创建/ 或/ 激活/ 待/ 迁移/ MN/ 的/ 代理/ 绑定/ 缓存/ 项/ (/ PBCE/ )/ ;/ 对外/ 宣告/ 迁移/ MN/ 的/ MN/ -/ HNP/ ;/ 为/ 其/ 隧道/ 转发/ 数据包/ ./ (/ 8/ )/ t/ -/ LMA/ 向/ MAG/ 回复/ LMA/ 服务/ 迁移/ 应答/ (/ LMAServiceSwitchingRequest/ ,/ LSSA/ )/ ,/ 指示/ 服务/ 迁移/ 结果/ ./ 步/ (/ 9/ )/ 、/ (/ 10/ )/ 仅/ 在/ LMA/ 过载/ 触发/ 的/ 服务/ 迁移/ 场/ (/ 9/ )/ t/ -/ LMA/ 向/ LMA/ 发送/ LSSAck/ ,/ 指示/ 服务/ 迁/ (/ 10/ )/ LMA/ 删除/ 迁移/ MN/ 的/ PBCE/ ,/ 停止/ 为/ 其景下/ 发生/ ./ 移/ 结果/ ./ 新为/ t/ -/ LMA/ ,/ 并/ 解锁/ 迁移/ MN/ 的/ BUL/ ./ (/ 11/ )/ MAG/ 在/ BUL/ 中将/ 迁移/ MN/ 的/ LMA/ 更/ (/ 12/ )/ MN/ 信息/ 同步/ (/ 可/ 选/ 步骤/ )/ :/ 若/ 服务/ 迁移/ 过程/ 中/ MAG/ 缓存/ 了/ 导致/ MN/ 移动/ 管理/ 信息/ 改变/ 的/ 事件/ 信息/ ,/ 在/ 迁移/ 完成/ 后/ ,/ MAG/ 根据上述/ 缓存/ 信息/ 修改/ MN/ 的/ BUL/ 并/ 上报/ 给/ t/ -/ LMA/ ,/ 保证/ MAG/ 和/ LMA/ 维护/ 的/ 移动/ 管理/ 信息/ 一致/ ./ 4LMAFT/ 方案/ 性能/ 分析/ 本节/ 和/ 下/ 一节/ 通过/ 理论/ 分析/ 和/ 系统/ 仿真/ ,/ 从/ LMA/ 容错/ 时间/ 、/ 不同/ 应用/ 下/ 的/ LMA/ 容错性/ 能/ 、/ 容错/ 开销/ 等/ 方面/ ,/ 对/ LMAFT/ 方案/ 进行/ 定量/ 评价/ ./ LMAFT/ 性能/ 分析/ 网络/ 模型/ 如图/ 5/ 所示/ ,/ 表/ 1/ 为/ 相关/ 参数/ 说明/ 及其/ 经验值/ [/ 16/ -/ 17/ ]/ ./ 参数/ tmrMN/ 与/ 基站/ 或/ 无线/ 接入点/ (/ BS/ // AP/ )/ 间/ 的/ 无线/ 链路/ 传输/ trmBS/ // AP/ 到/ MAG/ 的/ 单项/ 传输/ 延时/ ,/ 2ms/ ~/ 5mstmmMN/ 与/ MAG/ 间/ 的/ 传输/ 延时/ ,/ tmm/ =/ tmr/ +/ trmtmlMAG/ 与/ LAM/ 间/ 的/ 单项/ 传输/ 延时/ ,/ 10ms/ ~/ 30mstllLAM/ 间/ 的/ 单项/ 传输/ 延时/ ,/ tll/ =/ tml/ ,/ 10ms/ ~/ 30mstclCN/ 与/ LAM/ 间/ 的/ 单向/ 传输/ 延时/ ,/ 40ms/ ~/ 50ms4/ ./ 1LMA/ 容错/ 时间/ 分析/ LMAFT/ 中/ ,/ LMA/ 容错/ 时间/ TLMA/ 测/ 时间/ TLMA/ 如图/ 6/ 所示/ ,/ s/ -/ LMA/ (/ LMAj/ )/ 以/ 间隔时间/ Ihb/ 向/ 其/ p/ -/ LMA/ (/ LMAi/ )/ 发送/ HReq/ 消息/ ,/ 检测/ 有效性/ ./ 设/ p/ -/ LMA/ 失效/ 发生/ 在/ s/ -/ LMA/ 向/ 其/ 发送/ 第/ i/ 次/ 和/ 第/ i/ +/ 1/ 次/ HReq/ 的/ 间隔/ 周期/ 内/ ./ 从/ ti/ +/ 1/ 开始/ ,/ s/ -/ LMA/ 每次/ 向/ p/ -/ LMA/ 发送/ HReq/ 前/ 都/ 会/ 将/ 本地/ 维护/ 的/ nmhb/ (/ i/ )/ 值增/ 1/ ,/ 直到/ ti/ +/ Nmh/ ,/ nmhb/ (/ i/ )/ 值/ 达到/ Nmh/ ,/ s/ -/ LMA/ 判断/ p/ -/ LMA/ 失效/ ./ 令/ θ/ 表示/ p/ -/ LMA/ 失效/ 发生/ 到/ s/ -/ LMA/ 下/ 一次/ 发出/ HReq/ 的/ 时间/ ,/ 那么/ θ/ 服从/ [/ 0/ ,/ Ihb/ ]/ 均匀分布/ ./ 失效/ 检测时间/ 为/ TLMAPage6/ 忽略/ 节点/ 处理/ 时间/ ,/ 服务/ 迁移/ 时间/ 为/ TLMAft/ ]/ =/ (/ Nmh/ -/ 1/ // 2/ )/ ×/ Ihm/ +/ 2tmlLMA/ 容错/ 时间/ 及其/ 均值/ 为/ TLMAft/ =/ TMAGE/ [/ TLMA/ 图/ 7/ 为/ LMA/ 容错/ 时间/ 均值/ E/ [/ TLMA/ 隔/ 周期/ Ihb/ 和/ 允许/ 丢失/ 心跳/ 消息/ 数目/ Nmh/ 的/ 变化/ 情况/ ,/ 其中/ tml/ =/ 20ms/ 时/ ./ E/ [/ TLMANmh/ 越大/ ,/ E/ [/ TLMA/ 错/ 时间/ ,/ 应/ 尽量/ 减小/ Nmh/ ./ 然而/ Nmh/ 过/ 小将/ 使得/ 失效/ 判断/ 的/ 准确率/ 低/ ,/ 尤其/ 在/ 链路/ 拥塞/ 或/ 丢/ 包率/ 较/ 高/ 的/ 情况/ 下/ ,/ Nmh/ 的/ 一般/ 取值/ 为/ 2/ ~/ 5/ ./ Ihb/ 是/ 影响/ E/ [/ TLMAft/ ]/ 的/ 另/ 一/ 重要/ 参数/ ,/ Ihb/ 越小/ ,/ 心跳/ 消息/ 发送/ 频率/ 越高/ ,/ 失效/ 检测/ 更/ 快速/ ,/ 容错/ 时间/ 随之/ 减小/ ,/ Ihb/ 的/ 取值/ 一般/ 在/ 50ms/ 量级/ ./ 通过/ 合理/ 调节/ 参数/ Ihb/ 和/ Nmh/ 可以/ 控制/ 容错/ 时间/ ./ 图中/ 给出/ 的/ 参数/ 取值/ 范围/ 将/ 容错/ 时间/ 控制/ 在/ 50ms/ ~/ 350ms/ 内/ ./ 4.2/ TCP/ 应用/ 下/ 的/ LMA/ 容错性/ 能/ 分析/ 本/ 节/ 通过/ 分析/ LMA/ 失效/ 造成/ 的/ TCP/ 应用/ 吞吐量/ 下降时间/ TLAM/ 的/ LMA/ 容错性/ 能/ 进行/ 评价/ ,/ 分析模型/ 如图/ 8/ 所示/ ./ 假设/ LMAi/ 在/ 时间/ 点/ A/ 发生/ 失效/ ,/ 失效/ 发生/ 以前/ MN/ 的/ TCP/ 连接/ 处于/ 稳定/ 状态/ ,/ 拥塞/ 窗口/ 大小/ 为/ CW/ ./ 时刻/ B/ 为/ LMAi/ 在/ 失效/ 发生/ 前为/ MN/ 转发/ 的/ 最后/ 一个/ CN/ →/ MN/ 方向/ 数据包/ 到达/ MN/ 的/ 时刻/ ;/ 时刻/ E/ 为/ LMAi/ 为/ MN/ 转发/ 的/ 最后/ 一个/ MN/ →/ CN/ 方向/ 数据包/ (/ MN/ 向/ CN/ 回复/ 的/ ACK/ 消息/ )/ 到达/ CN/ 的/ 时刻/ ;/ 在/ 时刻/ C/ ,/ s/ -/ LMA/ (/ LMAj/ )/ 检测/ 到/ LMAi/ 失效/ ;/ 在/ 时刻/ D/ ,/ s/ -/ LMA/ 完成/ 服务/ 迁移/ ,/ 接管/ 所有/ fa/ -/ MN/ ./ 时刻/ A/ 到/ D/ 的/ 一段时间/ 则/ 为/ LMA/ 容错/ 时间/ TLMACN/ 在/ 时间/ 点/ E/ 接收/ 到/ fa/ -/ MN/ 在/ LMAi/ 失效/ 发生/ 前向/ CN/ 发送/ 的/ 最后/ 一个/ ACK/ 消息/ 后/ ,/ 将/ 向/ fa/ -/ MN/ 发送/ 拥塞/ 窗口/ 内/ (/ CW/ )/ 的/ 所有/ 数据包/ ,/ 并/ 等待/ fa/ -/ MN/ 回复/ 的/ ACK/ 消息/ ./ 根据/ 容错/ 时间/ TLMA/ 不同/ ,/ 将/ 有/ 两种/ 情况/ 发生/ :/ 情况/ 1/ ./ CN/ 发送/ 的/ 拥塞/ 窗口/ 内/ 的/ 最后/ 一个/ 数据包/ (/ 时间/ 点/ F/ 发送/ )/ 到达/ PMIPv6/ 域时/ 失效/ LMAi/ 的/ 服务/ 迁移/ 已经/ 完成/ ,/ 即/ F/ +/ tcl/ / D/ (/ 也/ 就是/ TLAM/ (/ F/ -/ E/ )/ +/ (/ E/ -/ A/ )/ +/ tcl/ )/ ./ 这种/ 情况/ 下/ ,/ CN/ 在/ 拥塞/ 窗口/ 内/ 发送/ 的/ 数据包/ 将/ 通过/ LMAj/ 转发/ 至/ fa/ -/ MN/ ,/ LMAi/ 失效/ 不/ 影响/ MN/ 的/ 上层/ TCP/ 应用/ ,/ 即/ TLAM/ 由于/ TCP/ 对于/ 窗口/ 内/ 的/ 数据包/ 连续/ 发送/ ,/ 这里/ (/ F/ -/ E/ )/ 可/ 忽略不计/ ,/ (/ E/ -/ A/ )/ =/ tcl/ ,/ 因此/ 情况/ 2/ ./ CN/ 发送/ 的/ 拥塞/ 窗口/ 内/ 的/ 最后/ 一个/ 数据包/ 到达/ PMIPv6/ 域时/ ,/ 服务/ 迁移/ 未/ 完成/ ,/ 即/ F/ +/ tcl/ </ D/ (/ 也/ 就是/ TLAM/ 况下/ ,/ CN/ 在/ 拥塞/ 窗口/ 内/ 的/ 发送/ 的/ 所有/ 数据包/ 将/ 丢失/ ./ CN/ 等待/ 到/ G/ 时刻/ ,/ 它/ 在/ E/ 时刻/ 所/ 发送/ 数据包/ 的/ Page7/ 重传/ 定时器/ (/ RTO1/ )/ 到期/ ,/ CN/ 将/ 重传/ 该/ 数据包/ ,/ 并/ 将/ 拥塞/ 窗口/ 置/ 为/ 1/ ./ 若/ 重传/ 数据包/ 到达/ PMIPv6/ 域时/ ,/ LMA/ 服务/ 迁移/ 仍/ 未/ 完成/ ,/ 该/ 数据包/ 又/ 将/ 丢失/ ./ CN/ 等到/ 第/ 2/ 次/ 重传/ 定时器/ (/ RTO2/ )/ 超时/ ,/ 重/ 发/ 数据包/ ./ 假设/ 第/ N/ 次/ 重传/ 的/ 数据包/ 到达/ PMIPv6/ 域时/ ,/ 服务/ 迁移/ 完成/ ,/ LMAj/ 将/ 截获/ 该/ 数据包/ 并/ 转发/ 至/ fa/ -/ MN/ ./ CN/ 和/ MN/ 通过/ LMAj/ 恢复正常/ 通信/ 后/ ,/ 在/ H/ 时刻/ 后/ 开始/ TCP/ 慢/ 启动/ ,/ 拥塞/ 窗口/ 从/ 1/ 增大/ 到/ CW/ 的/ 恢复/ 时间/ 为/ τ/ s/ =/ [/ log2/ (/ 1/ +/ CW/ )/ -/ 1/ ]/ ×/ RTT/ ./ LMAi/ 失效/ 造成/ 的/ TCP/ 吞吐量/ 下降时间/ 为/ TLAM/ (/ H/ -/ B/ )/ +/ τ/ s/ +/ (/ tcl/ +/ tml/ +/ tmm/ )/ ,/ 其中/ (/ H/ -/ B/ )/ =/ (/ H/ -/ E/ )/ +/ (/ E/ -/ A/ )/ -/ (/ B/ -/ A/ )/ ,/ (/ E/ -/ A/ )/ =/ tcl/ ,/ (/ B/ -/ A/ )/ =/ tml/ +/ tmm/ ./ (/ H/ -/ E/ )/ 由/ 重传/ 次数/ N/ 确定/ ./ 按照/ TCP/ 重传/ 机制/ ,/ 初始/ 重传/ 定时器/ 值/ TO1/ =/ β/ ×/ RTT/ ,/ RTT/ 为/ TCP/ 连接/ 的/ 平均/ 往返/ 时延/ ./ 第/ N/ 次/ 重传/ 的/ 定时器/ 值/ TON/ (/ N/ / 1/ )/ 为/ 那么/ ,/ (/ H/ -/ E/ )/ 即/ 从/ 第/ 1/ 次/ 发送到/ 第/ N/ 次/ 重传/ 某/ 数据包/ 的/ 总/ 时间/ 为/ (/ H/ -/ E/ )/ =/ RTON/ =/ ∑/ N/ =/ =/ 重传/ 次数/ N/ 由/ 容错/ 时间/ TLMARTON/ -/ 1/ +/ (/ E/ -/ A/ )/ +/ tcl/ </ TLMA/ / RTON/ -/ 1/ +/ 2tcl/ </ TLMA/ 因此/ ,/ LMA/ 失效/ 造成/ 的/ 吞吐量/ 下降时间/ 为/ TLMAtd/ -/ TCP/ =/ 0/ ,/ 烄/ RTO1/ +/ 2tcl/ +/ τ/ s/ ,/ 2tcl/ </ TLMA/ 烅/ RTON/ +/ 2tcl/ +/ τ/ s/ ,/ RTON/ -/ 1/ +/ 2tcl/ </ TLMA/ 烆/ 图/ 9/ 为/ LMA/ 失效/ 造成/ 的/ 吞吐量/ 下降时间/ td/ -/ TCP/ 随/ 容错/ 时间/ TLMATLAM10ms/ 、/ 50ms/ 、/ 150ms/ (/ WLAN/ 、/ 3G/ 网络/ 、/ 卫星通信/ 网络/ 中/ 的/ 典型值/ )/ ./ 当/ TLMA/ 图/ 9LMA/ 失效/ 造成/ 的/ TCP/ 应用/ 吞吐量/ 下降时间/ ft/ 的/ 增大/ ,/ TLAMLMA/ 失效/ 未/ 对/ MN/ 的/ 上层/ TCP/ 应用/ 造成/ 影响/ ./ 随着/ TLMA/ 次/ 递增/ ./ 这/ 是因为/ 随着/ TLMA/ 就/ 导致/ 多/ 一次/ 的/ 数据包/ 重传/ 次数/ ,/ 服务/ 中断/ 时间/ 也/ 就/ 随之/ 增大/ 一个/ 重传/ 超时/ 时间/ ./ 另外/ ,/ tmr/ 越大/ ,/ 同等/ 次数/ 的/ TLAM/ 时间/ 与/ MN/ -/ CN/ 间/ 的/ 传输/ 时延/ 相关/ ,/ tmr/ 越大/ ,/ 超时/ 时间/ 越大/ ,/ TLAM/ 网络/ 环境/ ,/ 通过/ 合理/ 选择/ 容错/ 参数/ Ihb/ 和/ Nmh/ ,/ 可/ 有效/ 控制/ LMA/ 失效/ 对/ fa/ -/ MN/ 进行/ 中/ 的/ TCP/ 应用/ 造成/ 的/ 影响/ ./ 理论/ 上/ ,/ 将/ 容错/ 时间/ 控制/ 在/ 100ms/ 以下/ 时/ ,/ 可/ 完全避免/ LMA/ 失效/ 造成/ fa/ -/ MN/ 上层/ TCP/ 应用/ 的/ 吞吐量/ 下降/ ./ 针对/ 不同/ 类型/ 的/ 无线网络/ ,/ 最差/ 情况/ ,/ 也/ 可/ 将/ 吞吐量/ 下降时间/ 控制/ 在/ 1s/ ~/ 2.7/ s/ ./ 4.3/ UDP/ 应用/ 下/ 的/ LMA/ 容错性/ 能/ 分析/ 本/ 节/ 通过/ 分析/ LMA/ 失效/ 造成/ 的/ UDP/ 应用/ 丢包/ 情况/ ,/ 对/ UDP/ 应用/ 下/ LMAFT/ 方案/ 的/ 容错性/ 能/ 进行/ 评价/ ,/ 分析模型/ 如图/ 10/ 所示/ ./ A/ 时刻/ ,/ LMAi/ 失效/ ;/ B/ 时刻/ ,/ LMAi/ 在/ 失效/ 前为/ fa/ -/ MN/ 转发/ 的/ 最后/ 一个/ 数据包/ 到达/ fa/ -/ MN/ ;/ C/ 时刻/ ,/ LMAj/ 检测/ 到/ LMAi/ 失效/ ,/ 发起/ LMA/ 服务/ 迁移/ ;/ D/ 时刻/ ,/ 服务/ 迁移/ 完成/ ./ 此后/ ,/ MN/ 的/ 数据包/ 由/ LMAj/ 负责/ 转发/ ./ 容错/ 时间/ ft/ 内/ ,/ MN/ 的/ 数据包/ 都/ 将/ 丢失/ ./ CN/ 在/ 时刻/ E/ 到/ FTLMA/ 间/ 向/ MN/ 发送/ 的/ 数据包/ 将/ 丢失/ ./ 设/ CN/ 的/ 发包/ 率为/ λ/ p/ ,/ 则/ LMAi/ 失效/ 造成/ 的/ MN/ 丢包/ NLMApl/ -/ UDP/ =/ λ/ p/ ×/ (/ F/ -/ E/ )/ NMAGPage8/ 图/ 10LMA/ 容错性/ 能/ 分析模型/ (/ UDP/ 应用/ )/ 图/ 11/ 给出/ 了/ MN/ 丢包/ NLMA/ 的/ 变化/ 情况/ ./ NLMA/ 率/ λ/ p/ 越大/ ,/ NLMA/ 方案/ 的/ TLMA/ 所示/ 的/ 3/ 种/ 发包/ 率/ 的/ UDP/ 应用/ ,/ LMAFT/ 可/ 将/ 丢/ 包数/ 控制/ 在/ [/ 0/ ,/ 7/ ]/ 、/ [/ 2/ ,/ 17/ ]/ 、/ [/ 5/ ,/ 35/ ]/ 范围/ 内/ ./ 5LMAFT/ 方案/ 仿真/ 实验/ 本文/ 在/ NS/ -/ 2/ 中/ 实现/ 了/ LMAFT/ 方案/ ,/ 本/ 节/ 通过/ 仿真/ 分析/ 对/ LMAFT/ 在/ TCP/ 和/ UDP/ 应用/ 下/ 的/ 容错性/ 能/ 进行/ 评价/ ./ 仿真/ 场景/ 为/ 在/ PMIPv6/ 域/ 内/ 部署/ 3/ 个/ LMA/ ,/ 6/ 个/ MAG/ ,/ 100/ 个/ MN/ 在/ 各/ MAG/ 间/ 随机/ 移动/ ,/ 通过/ 无线/ 链路/ 与/ MAG/ 建立/ 连接/ ,/ 分别/ 仿真/ 了/ IEEE802/ ./ 11g/ 、/ UMTS/ 和/ 卫星网络/ 3/ 种/ 无线/ 接入/ 方式/ ,/ 单向/ 传输/ 延迟/ 分别/ 为/ 10ms/ 、/ 50ms/ 、/ 150ms/ ./ 各/ 场景/ 的/ 仿真/ 时间/ 均/ 为/ 50s/ ,/ 失效/ 发生/ 在/ 第/ 25s/ ,/ 此时/ 上层/ 应用/ 已/ 处于/ 稳定/ 状态/ ./ 5.1/ TCP/ 应用/ 下/ 的/ LMA/ 容错性/ 能图/ 12/ 为/ MN/ -/ MAG/ 间/ 无线/ 链路/ 分别/ 为/ 802.11/ g/ 、/ UMTS/ 和/ 卫星网络/ ,/ 心跳/ 间隔/ Ihb/ ,/ 心跳/ 消息/ 允许/ 丢失/ 数/ Nmh/ 分别/ 取/ 不同/ 值时/ ,/ LMA/ 失效/ 造成/ 的/ TCP/ 应用服务/ 中断/ 时间/ TLMA/ 大/ ,/ TLMAsi/ -/ TCP/ 随/ Ihb/ 的/ 增大/ 阶梯/ 性/ 增长/ ./ 针对/ 具体/ 网络/ 环境/ ,/ 选择/ 适合/ 的/ 容错/ 参数/ ,/ 可/ 有效/ 降低/ LMA/ 失效/ 对/ fa/ -/ MN/ 上层/ TCP/ 应用/ 造成/ 的/ 影响/ ./ 例如/ ,/ 针对/ 卫星网络/ ,/ 当/ Nmh/ 取值/ 3/ ,/ Ihb/ 取值/ 20ms/ ~/ 50ms/ 时/ ,/ LMA/ 失效/ 都/ 不/ 对/ fa/ -/ MN/ 的/ TCP/ 应用/ 造成/ 影响/ ;/ Ihb/ 取值/ 60ms/ ~/ 140ms/ 时/ ,/ 可/ 将/ LMA/ 失效/ 造成/ 的/ fa/ -/ MNTCP/ 应用服务/ 中断/ 时间/ 控制/ 在/ 600ms/ 左右/ ./ 图/ 12LMA/ 失效/ 时/ 的/ TCP/ 应用服务/ 中断/ 时间/ 理论/ 上/ ,/ MN/ -/ MAG/ 间/ 无线/ 链路/ 延时/ 越大/ ,/ CN/ -/ MN/ 间/ 的/ 平均/ 往返/ 延时/ 更大/ ,/ CN/ 向/ MN/ 发包/ 的/ 重传/ 定时器/ 值/ 将/ 更/ 大/ ,/ 那么/ 服务/ 中断/ 时间/ TLMA/ 该/ 越/ 大/ ./ 然而/ 在/ 图/ 12/ 中/ ,/ 当/ Ihb/ 较/ 小时/ ,/ MN/ -/ MAG/ 间/ 链路/ 延时/ 最大/ 的/ 卫星通信/ 网络/ 反倒/ 比/ 其他/ 两种/ 情况/ 的/ 服务/ 中断/ 时间/ 更/ 小/ ./ 这/ 是因为/ :/ 对于/ MN/ -/ MAG/ 间/ 无线/ 链路/ 为/ 802.11/ g/ 和/ UMTS/ 的/ 情况/ ,/ MN/ -/ MAGPage9/ 单向/ 传输/ 延时/ 分别/ 为/ 10ms/ // 50ms/ ,/ CN/ 在/ LMA/ 失效/ 前/ 发送给/ MN/ 的/ 最后/ 一个/ 数据包/ 通过/ LMA/ 到达/ MAG/ 后/ 分别/ 通过/ 10ms/ // 50ms/ 到达/ MN/ ,/ 之后/ MN/ 回复/ ACK/ ,/ ACK/ 到达/ MAG/ 时/ 分别/ 又/ 过/ 了/ 10ms/ // 50ms/ ,/ 共计/ 20ms/ // 100ms/ ,/ 此时/ LMA/ 切换/ 尚未/ 完成/ ,/ 所以/ ACK/ 丢失/ ,/ CN/ 需/ 等待/ 重传/ 定时器/ 超时/ 才/ 会/ 向/ MN/ 重传/ 数据包/ ,/ 造成/ 服务/ 中断/ ;/ 而/ 对于/ MN/ -/ MAG/ 间/ 无线/ 链路/ 为/ 卫星通信/ 网络/ 的/ 情况/ ,/ MN/ -/ MAG/ 单向/ 传输/ 延时/ 为/ 150ms/ ,/ CN/ 在/ LMA/ 失效/ 前/ 发送给/ MN/ 的/ 最后/ 一个/ 数据包/ 通过/ LMA/ 到达/ MAG/ 后/ ,/ MAG/ 转发给/ MN/ 并/ 再/ 接收/ 到/ MN/ 回复/ 的/ ACK/ 共计/ 过/ 了/ 300ms/ ,/ 此时/ LMA/ 切换/ 已经/ 完成/ ,/ 所以/ 该/ ACK/ 能够/ 通过/ LMA/ 送到/ CN/ ,/ CN/ 收到/ ACK/ 后/ 将/ 继续/ 向/ MN/ 发包/ ,/ 而/ 无需/ 等待/ 重传/ 定时器/ 到期/ ,/ 因此/ 服务/ 中断/ 时间/ 为/ 0/ ./ 图/ 13/ 为/ 3/ 种/ 不同/ 无线/ 链路/ ,/ 分别/ 运行/ PMIPv6/ 基本/ 协议/ (/ Base/ -/ PMIPv6/ )/ 和/ LMAFT/ 方案/ 的/ 6/ 种/ 场景/ 下/ ,/ fa/ -/ MN/ 的/ TCP/ 吞吐量/ 变化/ 情况/ ./ 在/ 仿真/ 进行/ 5s/ 左右/ ,/ 各/ 场景/ 下/ 的/ TCP/ 应用/ 吞吐量/ 达到/ 稳定/ 状态/ ,/ Base/ -/ PMIPv6/ 和/ LMAFT/ 方案/ 在/ 同种/ 无线/ 链路/ 场景/ 下/ 的/ 吞吐量/ 值/ 相同/ ./ 在/ LMA/ 失效/ 发生/ (/ 第/ 25s/ )/ 后/ ,/ Base/ -/ PMIPv6/ 的/ 3/ 种/ 场景/ 下/ 的/ 吞吐量/ 值/ 都/ 迅速/ 降为/ 0/ ,/ 且/ 不再/ 恢复/ ./ 而/ 在/ LMAFT/ -/ Satellite/ 场景/ 下/ ,/ fa/ -/ MN/ 的/ 吞吐量/ 值未/ 下降/ ,/ 这/ 是因为/ Ihb/ 和/ Nmh/ 的/ 该/ 取值/ 使得/ LMA/ 失效/ 对/ 卫星网络/ 中/ 的/ fa/ -/ MN/ 上层/ TCP/ 应用/ 不/ 造成/ 影响/ ./ LMAFT/ -/ 802.11/ g/ 和/ LMAFT/ -/ UMTS/ 场景/ 下/ ,/ 吞吐量/ 在/ LMA/ 失效/ 后/ 明显/ 下降/ ,/ 但/ 快速/ 上升/ 并/ 恢复/ 到/ 失效/ 前/ 的/ 稳定/ 状态/ ./ 5.2/ UDP/ 应用/ 下/ 的/ LMA/ 容错性/ 能图/ 14/ 为/ Base/ -/ PMIPv6/ 和/ LMAFT/ 方案/ 下/ ,/ fa/ -/ MN/ 上层/ UDP/ 应用/ 的/ 收/ 包率/ 变化/ 情况/ ./ LMA/ 失效/ 对/ fa/ -/ MN/ 上层/ UDP/ 应用/ 的/ 影响/ 与/ fa/ -/ MN/ 所在/ 无线/ 链路/ 无关/ ,/ 因此/ 图中仅/ 给出/ 了/ 一种/ 无线/ 链路/ 的/ 场景/ ./ LMA/ 失效/ 发生/ 前/ ,/ 两种/ 方案/ 下/ ,/ fa/ -/ MN/ 的/ 收/ 包率/ 变化/ 情况/ 相同/ ./ 失效/ 发生/ (/ 第/ 25s/ )/ 后/ ,/ LMAFT/ 场景/ 下/ ,/ fa/ -/ MN/ 丢/ 包率/ 在/ 第/ 26s/ 下降/ 到/ 20packets/ // s/ 左右/ ,/ 但/ 在/ 第/ 27s/ 已/ 恢复/ 至/ 失效/ 发生/ 前/ 的/ 稳定/ 值/ ,/ 整个/ 容错/ 过程/ 中/ 的/ 丢/ 包未/ 超过/ 10/ 个/ ;/ 而/ Base/ -/ PMIPv6/ 场景/ 下/ 的/ 收/ 包率/ 迅速/ 下降/ 为/ 0.5/ ./ 3LMA/ 容错/ 信令/ 开销/ 图/ 15/ 为/ LMAFT/ 方案/ 引入/ 的/ 信令/ 开销/ 和/ PMIPv6/ 图/ 15LMA/ 容错/ 信令/ 开销/ 与/ PMIPv6/ 基本/ 信令/ 开销/ 的/ 比较/ Page10/ 基本/ 信令/ 开销/ 的/ 对比/ ./ LMAFT/ 引入/ 的/ 容错/ 信令/ 开销/ 主要/ 为/ 失效/ 检测/ 的/ 心跳/ 消息/ ,/ 因此/ 如图/ 15/ (/ a/ )/ 所示/ ,/ 随着/ Ihb/ 的/ 增大/ ,/ 引入/ 的/ 容错/ 信令/ 开销/ 快速/ 减少/ ./ 当/ Ihb/ 取值/ 50ms/ 时/ ,/ 容错/ 信令/ 开销/ 仅为/ PMIPv6/ 基本/ 信令/ 的/ 一半/ ./ 图/ 15/ (/ b/ )/ 为/ 信令/ 开销/ 随/ 系统/ 所/ 服务/ MN/ 数目/ 变化/ 的/ 情况/ ./ 随着/ 系统/ 所/ 服务/ MN/ 数目/ 的/ 增大/ ,/ PMIPv6/ 基本/ 信令/ 开销/ 将/ 线性/ 增长/ ,/ 而/ 容错/ 信令/ 开销/ 不变/ ,/ 当/ MN/ 数目/ 为/ 300/ 时/ ,/ 基本/ 信令/ 开销/ 已/ 接近/ 容错/ 信令/ 开销/ 的/ 5/ 倍/ ./ 而/ 在/ 实际/ 网络/ 部署/ 中/ ,/ 一个/ LMA/ 所/ 支持/ 的/ MN/ 远大于/ 300/ ,/ 也就是说/ 当/ 系统/ 处于/ 较/ 饱和/ 的/ 服务/ 状态/ 时/ ,/ 方案/ 引入/ 的/ 容错/ 信令/ 开销/ 将/ 远/ 小于/ 基本/ 信令/ ./ 6/ 结语/ 本文/ 针对/ PMIPv6/ 系统/ 中/ 的/ LMA/ 单点故障/ 问题/ ,/ 首次/ 提出/ 一种/ 基于/ 主备/ 关系/ 的/ LMA/ 容错/ 方案/ (/ LMAFT/ )/ ./ 该/ 方案/ 在/ PMIPv6/ 域/ 内/ 部署/ 多/ LMA/ ,/ 并/ 建立/ 一一对应/ 的/ LMA/ 主/ -/ 备/ 关系/ ,/ 通过/ LMA/ 间/ 自/ 组织/ 的/ 状态/ 管理/ 实现/ 容错/ ./ 通过/ 理论/ 分析/ 和/ 仿真/ 实验/ 表明/ ,/ LMAFT/ 方案/ 能/ 在/ LMA/ 失效/ 后/ 快速/ 恢复/ 相关/ MN/ 的/ 网络连接/ ,/ 有效/ 减小/ 甚至/ 避免/ LMA/ 失效/ 对/ MN/ 上层/ 应用/ 造成/ 的/ 影响/ ;/ 方案/ 引入/ 的/ 容错/ 信令/ 开销/ 远/ 小于/ PMIPv6/ 系统/ 的/ 基本/ 信令/ ./ 

