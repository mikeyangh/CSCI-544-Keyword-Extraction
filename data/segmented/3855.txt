Page1/ 基于/ 分布式文件系统/ HDFS/ 的/ 节能/ 算法/ 廖彬/ 1/ )/ ,/ 2/ )/ 于/ 炯/ 1/ )/ ,/ 2/ )/ 张陶/ 2/ )/ 杨兴耀/ 2/ )/ 1/ )/ (/ 新疆大学/ 软件/ 学院/ 乌鲁木齐/ 830008/ )/ 2/ )/ (/ 新疆大学/ 信息科学/ 与/ 工程学院/ 乌鲁木齐/ 830046/ )/ 摘要/ 与/ 传统/ 数据中心/ 节能/ 算法/ 不同/ ,/ MapReduce/ 计算/ 任务/ 的/ 数据/ 依赖性/ 使得/ 设计/ HDFS/ (/ HadoopDistributedFileSystem/ )/ 节能/ 算法/ 时/ 必须/ 保证/ 集群/ 中/ 所有/ 数据/ 块/ 的/ 可用性/ ,/ 即/ 任意/ 数据/ 块/ 或/ 其/ 副本/ 中/ 的/ 至少/ 一块/ 处于/ 活动状态/ ./ 根据/ HDFS/ 集群/ 结构/ 与/ 数据/ 块/ 存储/ 等/ 特点/ 建立/ 了/ DataNode/ 节点/ 矩阵/ 、/ 节点/ 状态/ 矩阵/ 、/ 文件/ 分块/ 矩阵/ 、/ 数据/ 块/ 存储/ 矩阵/ 与/ 数据/ 块/ 状态/ 矩阵/ ,/ 为/ 后续/ 研究/ 建立/ 了/ 基础/ 模型/ ./ 结合/ 数据/ 块/ 状态/ 矩阵/ 与/ 数据/ 块/ 可用性/ 之间/ 的/ 关系/ 设计/ 了/ DataNode/ 节点/ 休眠/ 验证/ 算法/ ./ 概率分析/ 了/ 由于/ 机架/ 感知/ 的/ 存储/ 策略/ 带来/ 数据/ 块/ 分布/ 的/ 随机性/ ,/ 使得/ 在/ 不/ 改变/ 数据/ 块/ 存储/ 结构/ 与/ 存储/ 策略/ 的/ 情况/ 下/ 并/ 不能/ 通过/ 休眠/ DataNode/ 节点/ 达到/ 节能/ 的/ 目的/ ./ 进而/ 设计/ 了/ 数据/ 块/ 存储/ 结构/ 配置/ 节能/ 算法/ 与/ 基于/ 对称/ 数据/ 块/ 存储/ 策略/ 下/ 的/ 节能/ 算法/ ,/ 分别/ 从/ 改变/ 数据/ 块/ 的/ 存储/ 结构/ 与/ 存储/ 策略/ 两/ 方面/ 对/ HDFS/ 进行/ 节能/ 改进/ ./ 实验/ 结果表明/ :/ 两种/ 节能/ 算法/ 都/ 能/ 解决/ HDFS/ 集群/ 的/ 能耗/ 低/ 利用率/ 问题/ ,/ 并且/ 集群/ 负载/ 越低/ 节能/ 效率/ 越高/ ./ 关键词/ 云/ 计算/ ;/ 分布式文件系统/ ;/ 节能/ 计算/ ;/ 副本/ 策略/ ;/ 绿色/ 计算/ 1/ 引言/ 低碳/ 节能/ 已经/ 成为/ 全球/ 热点问题/ 之一/ ,/ 而/ 信息/ 与/ 通信/ 技术/ 行业/ 的/ 高速/ 发展/ 也/ 带来/ 了/ 高能耗/ 、/ 高/ 二氧化碳/ 排放量/ 的/ 问题/ ./ 据统计/ ①/ ,/ 目前/ IT/ 领域/ 的/ 二氧化碳/ 排放量/ 占/ 全球/ 的/ 2/ %/ ,/ 而/ 到/ 2020/ 年/ 这/ 一/ 比例/ 将/ 翻番/ ./ 2008/ 年/ 路由器/ 、/ 交换机/ 、/ 服务器/ 、/ 冷却/ 设备/ 、/ 数据中心/ 等/ 互联网/ 设备/ 总共/ 消耗/ 8680/ 亿度/ 电/ ,/ 占/ 全球/ 总/ 耗电量/ 的/ 5.3/ %/ ./ 根据/ 文献/ [/ 1/ ]/ 的/ 预测/ ,/ 到/ 2025/ 年/ IT/ 行业/ 的/ 平均/ 能耗/ 将/ 达到/ 2006/ 年/ 的/ 5/ 倍/ ,/ 而/ 网络设备/ 的/ 能耗/ 更会/ 达到/ 13/ 倍/ ./ 与此同时/ ,/ Barroso/ 等/ 人/ 在/ 文献/ [/ 2/ ]/ 中/ 对/ Google/ 内部/ 5000/ 多台/ 服务器进行/ 长/ 达/ 半年/ 的/ 调查/ 统计/ 结果表明/ :/ 服务器/ 在/ 大部分/ 时间/ 里/ 利用率/ 都/ 在/ 10/ %/ ~/ 50/ %/ 之间/ ,/ 完全/ 没有/ 达到/ 高效/ 利用/ 的/ 要求/ ./ 造成/ Google/ 服务器/ 利用率/ 低/ 的/ 主要/ 原因/ 是/ 传统/ 的/ 负载/ 均衡/ 算法/ 专注/ 于/ 将/ 用户/ 请求/ 平均分/ 发给/ 集群/ 中/ 的/ 所有/ 服务器/ 以/ 提高/ 系统/ 的/ 可用性/ 的/ 同时/ 没有/ 考虑/ 到/ 系统/ 负载/ 率/ 与/ 能耗/ 利用率/ 之间/ 的/ 关系/ ,/ 导致用户/ 的/ 服务/ 请求/ 被/ 分发/ 到/ 了/ 过量/ 的/ 而/ 不是/ 适量/ 的/ 服务器/ 上/ ,/ 由此/ 造成/ 了/ 大量/ 电能/ 的/ 浪费/ ./ 通过/ 图/ 1/ 可以/ 看出/ 服务器/ 在/ 负载/ 很/ 低/ (/ 小于/ 10/ %/ )/ 的/ 情况/ 下/ 电能/ 消耗/ 也/ 超过/ 了/ 峰值/ 能耗/ 的/ 50/ %/ ,/ 并且/ 能耗/ 利用率/ 随着/ 系统/ 负载/ 的/ 增加/ 而/ 增加/ ./ 由此可见/ ,/ IT/ 设备/ 的/ 高能耗/ 、/ 高/ 二氧化碳/ 排放量/ 与/ 能耗/ 的/ 低/ 利用率/ 问题/ 已经/ 成为/ 信息/ 与/ 通信/ 技术/ 行业/ 亟待解决/ 的/ 问题/ ./ 图/ 1/ 服务器/ 能耗/ 利用率/ 与/ 负载/ 率/ 之间/ 的/ 关系/ [/ 2/ ]/ Hadoop/ ②/ 作为/ 新/ 的/ 分布式/ 存储/ 与/ 计算/ 架构/ ,/ 由于/ 能够/ 部署/ 在/ 通用/ 平台/ 上/ ,/ 并且/ 具有/ 可扩展性/ (/ scal/ -/ able/ )/ 、/ 低成本/ (/ economical/ )/ 、/ 高效性/ (/ efficient/ )/ 与/ 可靠性/ (/ reliable/ )/ 等/ 优点/ 使/ 其/ 在/ 分布式计算/ 领域/ 得到/ 了/ 广泛/ 运用/ ,/ 并且/ 已/ 逐渐/ 成为/ 工业/ 与/ 学术界/ 事实上/ 的/ 海量/ 数据/ 并行处理/ 标准/ ./ Hadoop/ 作为/ 分布式系统/ 基础架构/ ,/ 用户/ 可以/ 在/ 不/ 了解/ 分布式系统/ 底层/ 细节/ 的/ 情况/ 下/ ,/ 充分利用/ 集群/ 的/ 高速/ 运算/ 和/ 存储/ 能力/ ,/ 开发/ 分布式应用/ 程序/ ./ Hadoop/ 参考/ Google/ 的/ 分布式文件系统/ GFS/ (/ GoogleFileSystem/ )/ [/ 3/ ]/ ,/ 实现/ 了/ 分布式文件系统/ HDFS/ ;/ 参考/ MapReduce/ [/ 4/ ]/ 计算/ 模型/ 实现/ 了/ 自己/ 的/ 分布式计算/ 框架/ ;/ 参考/ BigTable/ [/ 5/ ]/ 实现/ 了/ 分布式/ 数据库/ HBase/ ./ 虽然/ Hadoop/ 拥有/ 诸多/ 优点/ ,/ 但是/ 由于/ Hadoop/ 底层/ 的/ 分布式文件系统/ HDFS/ 基于/ 机架/ 感知/ 的/ 数据/ 块/ 存储/ 策略/ 使得/ 数据/ 块/ 在/ 集群/ 中/ 的/ 分布/ 具有/ 随机性/ ,/ 并且/ MapReduce/ 的/ 移动/ 计算/ 理念/ 使得/ 计算/ 任务/ 与/ 数据/ 块/ 依赖/ 紧密/ ,/ 这/ 使得/ 系统/ 必须/ 保证/ 所有/ 数据/ 块/ 的/ 可用性/ ./ Hadoop/ 通过/ 副本/ 策略/ 与/ 节点/ 失效/ 处理/ 等等/ 方法/ 保证数据/ 块/ 可用性/ 的/ 同时/ 并/ 没有/ 考虑/ 集群/ 负载/ 率/ 与/ 系统/ 能耗/ 之间/ 的/ 关系/ ,/ 即使/ 在/ Hadoop/ 集群/ 利用率/ 很/ 低/ 的/ 情况/ 下/ ,/ 集群/ 中/ 所有/ 的/ DataNode/ 节点/ 都/ 保持/ 活动状态/ 以/ 保证系统/ 中/ 数据/ 块/ 的/ 可用性/ ,/ 其/ 高能耗/ 低效率/ 的/ 情况/ 与/ Google/ 服务器/ 集群/ 类似/ ,/ 并/ 由此/ 造成/ 了/ 大量/ 电能/ 的/ 浪费/ ./ 为/ 解决/ HDFS/ 分布式/ 集群/ 高能耗/ 低效率/ 的/ 问题/ ,/ 本文/ 主要/ 做/ 了/ 以下/ 工作/ :/ (/ 1/ )/ 通过/ 分析/ HDFS/ 集群/ 节点/ 结构/ 、/ 文件/ 分块/ 与/ 存储/ 机制/ 建立/ 了/ DataNode/ 节点/ 矩阵/ 、/ 节点/ 状态/ 矩阵/ 、/ 文件/ 分块/ 矩阵/ 、/ 数据/ 块/ 存储/ 矩阵/ 与/ 数据/ 块/ 状态/ 矩阵/ ./ 用/ 矩阵/ 表达/ 的/ 集群/ 结构/ 、/ 节点/ 状态/ 、/ 文件/ 分块/ 、/ 数据/ 块/ 存储/ 、/ 数据/ 块/ 状态/ 规范/ 了/ HDFS/ 集群/ 的/ 建模/ 并/ 为/ 后续/ 研究/ 打下/ 了/ 基础/ ./ (/ 2/ )/ 通过/ 休眠/ 闲置/ 节点/ 进行/ 节能/ 的/ 方法/ 在/ HDFS/ 集群/ 中/ 受到/ 数据/ 块/ 可用性/ 的/ 挑战/ ./ 为了/ 验证/ 特定/ DataNode/ 节点/ 的/ 休眠/ 是否/ 影响/ 数据/ 块/ 的/ 可用/ ①/ ②/ tectureandDesign/ ./ http/ :/ // // hadoop/ ./ apache/ ./ org/ // common/ // Page3/ 性/ ,/ 结合/ 数据/ 块/ 状态/ 矩阵/ 与/ 数据/ 块/ 可用性/ 之间/ 的/ 关系/ 设计/ 了/ DataNode/ 节点/ 可/ 休眠/ 验证/ 算法/ ./ 通过/ 概率分析/ 证明/ 了/ 在/ 不/ 改变/ 数据/ 块/ 存储/ 结构/ 与/ 存储/ 策略/ 的/ 情况/ 下/ 并/ 不能/ 通过/ 休眠/ DataNode/ 节点/ 达到/ 节能/ 的/ 目的/ ./ (/ 3/ )/ 在/ 原/ 机架/ 感知/ 的/ 存储/ 策略/ 基础/ 上/ 设计/ 了/ 数据/ 块/ 存储/ 结构/ 配置/ 节能/ 算法/ 与/ RACK/ 区域/ 划分算法/ ./ RACK/ 区域/ 划分算法/ 将/ RACK/ 划分/ 成/ Active/ -/ Zone/ 与/ Sleep/ -/ Zone/ 两个/ 区域/ ,/ 根据/ 数据/ 块/ 的/ 访问/ 规律/ 将/ 数据/ 块/ 存储/ 在/ 不同/ 的/ 区域/ 中/ ,/ 在/ 保证数据/ 块/ 可用性/ 的/ 前提/ 下/ 通过/ 休眠/ Sleep/ -/ Zone/ 区域/ 中/ DataN/ -/ ode/ 节点/ 达到/ 节能/ 的/ 目的/ ./ (/ 4/ )/ 设计/ 了/ 对称/ 数据/ 块/ 存储/ 策略/ ,/ 并/ 设计/ 了/ 该/ 存储/ 策略/ 下/ 的/ 节能/ 算法/ ./ 在/ 不/ 影响/ 原/ HDFS/ 可靠性/ 、/ 高效性/ 与/ 可扩展性/ 的/ 前提/ 下/ ,/ 对称/ 数据/ 块/ 存储/ 策略/ 使得/ 具有/ 相同/ 存储/ 结构/ 的/ DataNode/ 节点/ 之间/ 能够/ 实现/ 任务/ 的/ 转移/ 与/ 替换/ ,/ 算法/ 通过/ 任务调度/ 产生/ 并/ 休眠/ 空闲/ 节点/ 从而/ 达到/ 节能/ 的/ 目的/ ./ 本文/ 第/ 2/ 节对/ 相关/ 工作/ 进行/ 介绍/ ;/ 第/ 3/ 节/ 定义/ DataNode/ 节点/ 矩阵/ 、/ 节点/ 状态/ 矩阵/ 、/ 文件/ 分块/ 矩阵/ 、/ 数据/ 块/ 存储/ 矩阵/ 与/ 数据/ 块/ 状态/ 矩阵/ 的/ 建立/ 并/ 给出/ 示例/ ;/ 第/ 4/ 节/ 提出/ DataNode/ 节点/ 可/ 休眠/ 验证/ 算法/ 、/ 数据/ 块/ 存储/ 结构/ 配置/ 节能/ 算法/ 、/ RACK/ 区域/ 划分算法/ 与/ 基于/ 对称/ 数据/ 块/ 存储/ 策略/ 下/ 的/ 节能/ 算法/ ;/ 第/ 5/ 节对/ 相关/ 算法/ 建立/ 数学/ 分析模型/ ;/ 第/ 6/ 节/ 通过/ 模拟实验/ 验证/ 算法/ 的/ 有效性/ ;/ 最后/ 一节/ 对/ 全文/ 进行/ 总结/ 并/ 提出/ 未来/ 研究/ 工作/ 的/ 方向/ ./ 2/ 相关/ 工作/ 传统/ 的/ IT/ 系统/ 一方面/ 通过/ 超额/ 资源/ 供给/ 与/ 冗余/ 设计/ 来/ 保障/ QoS/ 与/ 系统可靠性/ [/ 6/ ]/ ,/ 另一方面/ 负载/ 均衡/ 算法/ 专注/ 于/ 将/ 用户/ 请求/ 平均分/ 发给/ 集群/ 中/ 的/ 所有/ 服务器/ 以/ 提高/ 系统/ 的/ 可用性/ ,/ 这些/ 设计/ 原则/ 都/ 没有/ 考虑/ 到/ 系统/ 的/ 能耗/ 因素/ ,/ 这/ 使得/ IT/ 系统/ 的/ 能量/ 利用/ 日益/ 暴露出/ 高能耗/ 低效率/ 的/ 问题/ ./ 学术/ 与/ 工业界/ 分别/ 从/ 硬件/ 、/ 操作系统/ 、/ 虚拟机/ 、/ 数据中心/ 4/ 个/ 层次/ 去/ 解决/ IT/ 系统/ 的/ 能耗/ 问题/ ./ 硬件/ 层次/ 上/ 主要/ 采用/ DCD/ [/ 7/ -/ 10/ ]/ (/ DynamicComponentDeactivation/ )/ 与/ DPS/ [/ 11/ -/ 14/ ]/ (/ DynamicPerformanceScaling/ )/ 两种/ 节能/ 技术/ ,/ 其中/ DCD/ 通过/ 在/ 一段时间/ 内/ 关闭/ 或/ 休眠/ 系统/ 硬件/ 的/ 某些/ 部件/ ,/ 而/ DPS/ 通过/ 调节/ 适应/ 于/ 当前/ 负载/ 的/ CPU/ 频率/ 与/ 电压/ 从而/ 达到/ 节能/ 的/ 目的/ ./ 文献/ [/ 7/ -/ 10/ ]/ 研究/ 了/ DCD/ 节能/ 技术/ 将/ 关闭/ 或/ 休眠/ 后/ 的/ 部件/ 重新启动/ 的/ 时间延迟/ 影响/ 用户/ QoS/ 与/ 休眠/ 部件/ 初始化/ 时/ 的/ 高能耗/ 等/ 关键问题/ ./ DPS/ 通过/ 降低/ CPU/ 工作频率/ 与/ 电压/ 进行/ 节能/ 的/ 同时/ 也/ 带来/ 了/ CPU/ 性能/ 降低/ 的/ 问题/ ,/ 由此/ 文献/ [/ 11/ -/ 14/ ]/ 对/ CPU/ 能耗/ 与/ 性能/ 之间/ 的/ 平衡点/ 问题/ 进行/ 了/ 相关/ 研究/ ./ 操作系统/ 层面/ 上/ ,/ 文献/ [/ 15/ -/ 18/ ]/ 研究/ 了/ NemesisOS/ 、/ Linux/ 、/ ECOsystem/ 等/ 系统/ 采用/ 系统/ 资源管理/ 、/ 任务调度/ 与/ 适应/ 、/ 硬件/ 节能/ 技术/ 等/ 方法/ 对/ 操作系统/ 进行/ 节能/ 处理/ 的/ 相关/ 问题/ ./ 虚拟机/ 层面/ 上/ ,/ Xen/ 、/ VMware/ 、/ KVM/ 等/ 虚拟机/ VMM/ (/ VirtualMachineMonitor/ )/ 利用/ DPS/ 或者/ DCD/ 等/ 技术/ 控制系统/ 资源/ 的/ 使用/ 来/ 达到/ 节能/ 的/ 目的/ ./ 文献/ [/ 18/ -/ 29/ ]/ 对/ 数据中心/ 层面/ 上/ 的/ 节能/ 技术/ 进行/ 了/ 大量/ 研究/ ,/ 数据中心/ 层面/ 上/ 的/ 节能/ 技术/ 通常/ 采用/ 合并/ 任务/ 的/ 方法/ ,/ 即/ 在/ 满足用户/ QoS/ 约束/ 的/ 前提/ 下/ 将/ 任务分配/ 到/ 较/ 小/ 的/ 资源/ 集上/ ,/ 将/ 空闲/ 下来/ 的/ 节点/ 资源/ 休眠/ 以/ 达到/ 节能/ 的/ 目的/ ./ 本文/ 即/ 是/ 基于/ 数据中心/ 的/ 节能/ 思想/ ,/ 并/ 假设/ 所有/ 的/ DataNode/ 节点/ 都/ 具有/ DPS/ 能力/ 以便/ 根据/ 当前/ 负载/ 动态/ 调节/ 服务器/ 能耗/ ,/ 在/ 满足/ HDFS/ 集群/ 数据/ 块/ 可用性/ 的/ 前提/ 下/ ,/ 通过/ 休眠/ 空闲/ DataNode/ 节点/ 达到/ 节能/ 的/ 目的/ ./ 现阶段/ 针对/ MapReduce/ 、/ HDFS/ 节能/ 方面/ 的/ 研究/ 较/ 少/ ,/ 文献/ [/ 30/ ]/ 对/ 基于/ MapReduce/ 与/ HDFS/ 框架/ 的/ 数据中心/ 能耗/ 进行/ 了/ 测量/ ,/ 提出/ 了/ 存在/ 的/ 能耗/ 问题/ ,/ 并/ 通过/ 优化/ 系统配置/ 参数/ 来/ 提高/ 能源/ 利用率/ ./ 文献/ [/ 31/ ]/ 提出/ 了/ 数据/ 块/ 子集/ subset/ 的/ 概念/ ,/ 将/ 数据/ 块/ 与其/ 副本/ 中/ 的/ 至少/ 一个/ 数据/ 块/ 放入/ 该子/ 集中/ 以/ 保证/ 所有/ 数据/ 块/ 的/ 可/ 访问/ 性/ 的/ 前提/ 下/ ,/ 通过/ 关闭/ 与/ 该/ 数据/ 块/ 子集/ 无/ 交集/ 的/ DataNode/ 节点/ 以/ 达到/ 节能/ 的/ 目的/ ./ 文献/ [/ 32/ ]/ 设计/ 了/ HDFS/ 集群/ 数据/ 块/ 配置/ 算法/ ,/ 该/ 算法/ 根据/ 当前/ HDFS/ 集群/ 的/ 工作/ 负载/ 动态/ 配置/ 数据/ 块/ 的/ 存放/ ./ 当/ 节点/ 负载/ 达到/ 设定/ 阈值/ 时/ ,/ 通过/ 算法/ 自动/ 地/ 打开/ 与/ 关闭/ 某些/ DataNode/ 节点/ 以/ 达到/ 节能/ 的/ 目的/ ./ 文献/ [/ 33/ -/ 34/ ]/ 通过/ 对/ Yahoo/ 公司/ HDFS/ 集群/ 内部/ 数据/ 块/ 访问/ 规律/ 的/ 研究/ 发现/ 数据/ 块/ 的/ 访问/ 具有/ 较强/ 的/ 规律性/ ,/ 根据/ 数据/ 块/ 的/ 访问/ 次数/ 将/ 其/ 放在/ Cold/ -/ Zone/ 与/ Hot/ -/ Zone/ 两个/ DataNode/ 节点/ 区域/ 中/ ,/ 通过/ 将/ Cold/ -/ Zone/ 中/ DataNode/ 节点/ 进行/ 节能/ 处理/ 从而/ 达到/ 整个/ 集群/ 节能/ 的/ 目的/ ./ 本文/ 与/ 以上/ 工作/ 不同之处/ 在于/ 通过/ 建立/ 分析/ 矩阵/ 对/ HDFS/ 集群/ 结构/ 、/ 节点/ 状态/ 、/ 文件/ 分块/ 、/ 数据/ 块/ 存储/ 、/ 数据/ 块/ 状态/ 进行/ 建模/ ,/ 为/ 后续/ 研究/ 建立/ 了/ 基础/ ./ 本文/ 设计/ 的/ 节能/ 算法/ 以/ 保证数据/ 块/ 的/ 可用性/ 为/ 前提/ ,/ 而已/ 有/ 研究/ 则/ 很少/ 考虑/ 到/ HDFS/ 集群/ 这一/ 特点/ ./ 数据/ 块/ 存储/ 结构/ 配置/ 节能/ 算法/ 与/ 基于/ 对称/ 数据/ 块/ 存储/ Page4/ 策略/ 下/ 的/ 节能/ 算法/ 分别/ 从/ 数据/ 块/ 存储/ 结构/ 与/ 数据/ 块/ 存储/ 策略/ 两/ 方面/ 对/ HDFS/ 集群/ 能耗/ 进行/ 改进/ ./ 其中/ 数据/ 块/ 存储/ 结构/ 配置/ 节能/ 算法/ 结合/ 了/ 文献/ [/ 31/ -/ 33/ ]/ 的/ 思想/ ,/ 首先/ RACK/ 区域/ 划分算法/ 将/ RACK/ 划分/ 成/ Active/ -/ Zone/ 与/ Sleep/ -/ Zone/ 两个/ 区域/ ,/ 并/ 通过/ 休眠/ Sleep/ -/ Zone/ 区域/ 中/ DataNode/ 节点/ 达到/ 节能/ 的/ 目的/ ./ 而/ 对称/ 数据/ 块/ 存储/ 策略/ 下/ 的/ 节能/ 算法/ 首先/ 重新/ 设计/ 了/ 数据/ 块/ 的/ 存储/ 策略/ ,/ 在/ 保证/ HDFS/ 可靠性/ 、/ 高效性/ 与/ 可扩展性/ 等/ 优点/ 的/ 同时/ ,/ 使得/ DataNode/ 节点/ 的/ 休眠/ 摆脱/ 了/ 数据/ 块/ 可用性/ 的/ 约束/ ,/ 从而/ 达到/ 通过/ 休眠/ 空闲/ 节点/ 实现/ 节能/ 目标/ ./ 3HDFS/ 集群/ 节能/ 问题/ 建模/ 及/ 示例/ 3.1/ 节能/ 问题/ 建模/ 本节/ 将/ 对/ HDFS/ 集群/ 节能/ 问题/ 的/ 相关/ 概念/ 进行/ 建模/ ,/ 具体/ 包括/ DataNode/ 节点/ 矩阵/ 、/ DataNode/ 节点/ 状态/ 矩阵/ 、/ 文件/ 分块/ 矩阵/ 、/ 数据/ 块/ 存储/ 矩阵/ 、/ 数据/ 块/ 状态/ 矩阵/ 、/ HDFS/ 集群/ 节能/ 问题/ 定义/ 等等/ ./ HDFS/ 集群/ 一般/ 由/ 多个/ 机架/ RACK/ 组成/ ,/ 而/ 一个/ RACK/ 内部/ 又/ 由/ 多个/ 服务器/ 组成/ ,/ 并且/ HDFS/ 集群/ 通常/ 由/ 一个/ NameNode/ 和/ 多个/ DataNode/ 节点/ 构成/ ,/ 因/ 文本/ 考虑/ 的/ 是/ 将/ DataNode/ 节点/ 休眠/ 以/ 达到/ 节能/ 的/ 目的/ ,/ 所以/ 不/ 考虑/ NameNode/ 节点/ 的/ 节能/ 问题/ ./ 定义/ 1/ (/ DataNode/ 节点/ 矩阵/ )/ ./ 设/ 某个/ HDFS/ 集群/ 由/ 集合/ Cluster/ =/ {/ 〈/ rack1/ ,/ s1/ 〉/ ,/ 〈/ rack2/ ,/ s2/ 〉/ ,/ …/ ,/ 〈/ racki/ ,/ si/ 〉/ }/ 组成/ ,/ 其中/ 元素/ 〈/ rack1/ ,/ s1/ 〉/ 表示/ 编号/ 为/ rack1/ 的/ RACK/ 机架/ 中有/ s1/ 台/ DataNode/ 服务器/ ,/ 该/ 集群/ 由/ i/ 个/ RACK/ 组成/ ,/ 即/ |/ Cluster/ |/ =/ i/ ./ 用/ dn/ 表示/ DataNode/ 节点/ 服务器/ ,/ 那么/ 可/ 将/ HDFS/ 集群/ 中/ 的/ 所有/ DataNode/ 节点/ 表示/ 为/ 矩阵/ 犮/ sm/ ×/ i/ :/ 犮/ sm/ ×/ i/ =/ 其中/ 矩阵/ 犮/ sm/ ×/ i/ 中/ 的/ 列/ 表示/ 编号/ 为/ racki/ 的/ RACK/ 中/ 的/ si/ 个/ DataNode/ 服务器/ ,/ 其中/ sm/ 表示/ RACK/ 中/ 节点/ 数量/ 集合/ {/ s1/ ,/ s2/ ,/ …/ ,/ si/ }/ 中/ 的/ 最大值/ ./ 设/ 集群/ 中/ DataNode/ 节点/ 的/ 数量/ 为/ k/ ,/ 那么/ k/ =/ ∑/ si/ ,/ 而/ DataNode/ 节点/ 矩阵/ 犮/ sm/ ×/ i/ 可以/ 表示/ sm/ ×/ i/ 个/ 元素/ ,/ 当/ sm/ ×/ i/ >/ ∑/ si/ 时/ ,/ 用/ sm/ ×/ i/ -/ ∑/ si/ 个/ 0/ 填充/ 犮/ sm/ ×/ i/ 矩阵/ ,/ 表示/ RACK/ 中该/ 位置/ 没有/ DataNode/ 节点/ ./ 定义/ 2/ (/ DataNode/ 节点/ 状态/ 矩阵/ )/ ./ HDFS/ 集群/ 中/ 的/ DataNode/ 节点/ 可能/ 存在/ 多种/ 状态/ ,/ 设/ 状态/ 标识/ 集合/ 为/ state/ =/ {/ 0/ ,/ 1/ ,/ 2/ ,/ 3/ }/ ,/ 其中/ 0/ 表示/ 该/ 位置/ 没有/ 服务器/ ,/ 而/ 1/ 、/ 2/ 、/ 3/ 分别/ 表示/ DataNode/ 节点/ 处于/ 活动/ 、/ 休眠/ 、/ 宕机/ 状态/ ./ 宕机/ 有/ 可能/ 是因为/ 系统故障/ 、/ 电源/ 中断/ 、/ 硬件/ 故障/ 等等/ 原因/ 造成/ ;/ 休眠/ 与/ 宕机/ 的/ 共同点/ 都/ 是/ 此时/ DataNode/ 节点/ 不可/ 用/ ,/ 但是/ 休眠/ 可以/ 通过/ 唤醒/ 机制/ 将/ DataNode/ 节点/ 转化/ 为/ 活动状态/ ./ 在/ DataNode/ 节点/ 矩阵/ 犮/ sm/ ×/ i/ 的/ 基础/ 上/ ,/ HDFS/ 集群/ 中/ 的/ DataNode/ 节点/ 状态/ 矩阵/ 表示/ 为/ 其中/ smn/ ∈/ {/ 0/ ,/ 1/ ,/ 2/ ,/ 3/ }/ (/ 1/ / m/ / sm/ ,/ 1/ / n/ / i/ )/ ./ 定义/ 3/ (/ 文件/ 分块/ 矩阵/ )/ ./ HDFS/ 集群/ 中/ 文件/ 的/ 存储/ 都/ 被/ 拆/ 分成/ 一系列/ 的/ 数据/ 块/ 存放/ 在/ DataNode/ 节点/ 中/ ,/ 并/ 采用/ 在/ 同一个/ 集群/ 中/ 存储/ 多个/ 副本/ 的/ 策略/ 来/ 提高/ 数据/ 的/ 可靠性/ ./ 设/ HDFS/ 集群/ 中有/ k/ (/ k/ >/ 3/ )/ 个/ DataNode/ {/ dn/ ∈/ 犮/ sm/ ×/ i/ }/ ,/ 文件/ F/ 数据/ 块/ 副本/ 系数/ 为/ m/ ,/ 数据/ 块/ 大小/ 为/ bs/ ,/ 则/ HDFS/ 中/ 大小/ 为/ n/ ×/ bs/ 的/ F/ 会/ 有/ n/ ×/ m/ 个/ 数据/ 块/ 随机/ 存储/ 在/ 这/ k/ 个/ DataNode/ 中/ ,/ 其/ 文件/ 分块/ 可/ 由/ 犉/ n/ ×/ m/ 矩阵/ 表示/ ./ 其中/ ,/ 原文件/ F/ 由/ 数据/ 块/ {/ b11/ ,/ b21/ ,/ …/ ,/ bn1/ }/ 组成/ ,/ 而/ 矩阵/ 犉/ n/ ×/ (/ m/ -/ 1/ )/ 表示/ 该/ 文件/ 的/ 副本/ ,/ n/ 表示/ 文件/ 犉/ 的/ 原始数据/ 块/ 数量/ ./ 犉/ n/ ×/ m/ =/ HDFS/ 机架/ 感知/ 的/ 数据/ 块/ 存储/ 策略/ 如图/ 2/ 所示/ ,/ 当/ 用户/ 向/ HDFS/ 集群/ 上传/ 数据/ 时/ ,/ 第/ 1/ 个/ 数据/ 块/ b11/ 随机/ 存放/ 在/ 某个/ DataNode/ 节点/ 中/ ,/ 第/ 2/ 个/ 数据/ 块/ b12/ (/ b11/ 的/ 副本/ 1/ )/ 存放/ 在/ 与/ b11/ 不同/ 的/ 机架/ 上/ 的/ Page5DataNode/ 节点/ 中/ ,/ 第/ 3/ 个/ 数据/ 块/ b13/ (/ b11/ 的/ 副本/ 2/ )/ 存放/ 在/ 与/ b12/ 相同/ 的/ 机架/ 但/ 不同/ 的/ DataNode/ 节点/ 中/ ./ 如果/ 副本/ 系数/ m/ >/ 3/ ,/ 其余/ 的/ 数据/ 块/ 就/ 随机/ 的/ 存放/ 在/ 除/ b11/ 、/ b12/ 、/ b13/ 存储/ 节点/ 以外/ 的/ 任意/ DataNode/ 节点/ 中/ ,/ 由此可见/ 基于/ 机架/ 感知/ 的/ 数据/ 块/ 存储/ 策略/ 使得/ 数据/ 块/ 的/ 存储/ 具有/ 随机性/ ./ 定义/ 4/ (/ 数据/ 块/ 存储/ 矩阵/ )/ ./ 文件/ F/ 首先/ 根据/ 矩阵/ 犉/ n/ ×/ m/ 对/ 文件/ 进行/ 分块/ ,/ 然后/ 根据/ 机架/ 感知/ 的/ 数据/ 块/ 存储/ 策略/ 将/ 数据/ 块/ 存储/ 于/ HDFS/ 集群/ 中/ 的/ DataNode/ 节点/ 上/ ,/ 即/ 文件/ 分块/ 矩阵/ 犉/ n/ ×/ m/ 中/ 的/ n/ ×/ m/ 个/ 数据/ 块/ bij/ (/ 1/ / i/ / n/ ,/ 1/ / j/ / m/ )/ 存储/ 于/ 矩阵/ dn/ ∈/ 犮/ sm/ ×/ i/ 中/ 的/ k/ 个/ DataNode/ 服务器/ 中/ ,/ 并/ 遵循/ 一个/ 数据/ 块/ bij/ 只能/ 存储/ 在/ 一个/ DataNode/ 节点/ 中/ ,/ bij/ 与其/ 副本/ 数据/ 块/ 不能/ 存储/ 在/ 同一个/ DataNode/ 节点/ 中/ 的/ 规律/ ./ 那么/ ,/ 可/ 将/ 数据/ 块/ 与/ 存储/ 该/ 数据/ 块/ 的/ DataNode/ 节点/ 之间/ 的/ 对应/ 关系/ 转化/ 表示/ 为/ 数据/ 块/ 存储/ 矩阵/ 犛/ n/ ×/ m/ :/ 其中/ ,/ dij/ ∈/ 犮/ sm/ ×/ i/ (/ 1/ / i/ / n/ ,/ 1/ / j/ / m/ )/ 且/ 犛/ n/ ×/ m/ 中/ 任意/ 一行/ 不能/ 存在/ 相同/ 的/ 元素/ ./ 定义/ 5/ (/ 数据/ 块/ 状态/ 矩阵/ )/ ./ 存储/ 于/ 不同/ 状态/ 的/ DataNode/ 节点/ 中/ 的/ 数据/ 块/ 可用性/ 不同/ ,/ 根据/ Da/ -/ taNode/ 节点/ 状态/ 矩阵/ 犇/ 犛/ sm/ ×/ i/ 与/ 文件/ 数据/ 块/ 存储/ 矩阵/ 犛/ n/ ×/ m/ 之间/ 的/ DataNode/ 节点/ 关联/ 可/ 得到/ 文件/ 数据/ 块/ 状态/ 矩阵/ 犅/ 犛/ n/ ×/ m/ :/ 其中/ bsij/ ∈/ {/ 1/ ,/ 2/ ,/ 3/ }/ (/ 1/ / i/ / n/ ,/ 1/ / j/ / m/ )/ ,/ 状态/ 1/ 表示/ 该/ 数据/ 块/ 存储/ 在/ 活动/ 的/ DataNode/ 节点/ 中/ ,/ 数据/ 块/ 处于/ 可用/ 状态/ ;/ 2/ 表示/ 该/ 数据/ 块/ 存储/ 在/ 休眠/ 的/ DataNode/ 节点/ 中/ ,/ 3/ 表示/ 该/ 数据/ 块/ 存储/ 在/ 宕机/ 的/ 节点/ 中/ ,/ 状态/ 2/ 与/ 3/ 都/ 表示/ 数据/ 块/ 处于/ 不可/ 用/ 状态/ ./ 定理/ 1/ ./ HDFS/ 集群/ 中/ 的/ 任意/ 文件/ F/ 处于/ 可用/ 状态/ 的/ 条件/ 是/ 该/ 文件/ 数据/ 块/ 状态/ 矩阵/ 犅/ 犛/ n/ ×/ m/ 中/ 的/ 每/ 一行/ 至少/ 存在/ 一个/ 状态/ 为/ 1/ 的/ 数据/ 块/ ./ 证明/ ./ 用/ 反证法/ 证明/ ./ 假设/ 文件/ F/ 的/ 数据/ 块/ 状态/ 矩阵/ 犅/ 犛/ n/ ×/ m/ 中/ 存在/ 第/ i/ (/ 1/ / i/ / n/ )/ 行/ {/ bsi1/ ,/ bsi2/ ,/ …/ ,/ bsim/ }/ 中/ 不/ 存在/ 状态/ 为/ 1/ 的/ 数据/ 块/ ,/ 即/ {/ bsi1/ ,/ bsi2/ ,/ …/ ,/ bsim/ }/ ∈/ {/ 2/ ,/ 3/ }/ (/ 1/ / i/ / n/ )/ ./ 根据/ 定义/ 3/ 与/ 定义/ 5/ 可知/ 此时/ 文件/ F/ 的/ n/ 个/ 分块/ 中/ 第/ i/ 个/ 数据/ 块/ 与其/ 副本/ 都/ 处于/ 休眠/ 或/ 宕机/ 的/ DataNode/ 节点/ 中/ ,/ 数据/ 块/ {/ bi1/ ,/ bi2/ ,/ …/ ,/ bim/ }/ 都/ 处于/ 不可/ 用/ 状态/ ./ 用户/ 读取/ 文件/ F/ 时/ ,/ 因为/ 数据/ 块/ {/ bi1/ ,/ bi2/ ,/ …/ ,/ bim/ }/ 都/ 处于/ 不可/ 用/ 状态/ ,/ n/ 个/ 数据/ 块/ 中/ 的/ 第/ i/ 个/ 数据/ 块/ 将/ 读取/ 失败/ ,/ 造成/ 不能/ 将/ 文件/ F/ 组合/ 成功/ 返回/ 给/ 用户/ ./ 此时/ ,/ 文件/ F/ 对于/ 读取/ 用户/ 不可/ 用/ ./ 证毕/ ./ 定义/ 6/ ./ 将/ HDFS/ 中/ 的/ 节能/ 问题/ 定义/ 为/ 四元组/ p/ =/ 〈/ 犮/ sm/ ×/ i/ ,/ SD/ ,/ files/ ,/ flag/ 〉/ ./ 其中/ 犮/ sm/ ×/ i/ 为/ HDFS/ 集群/ DataNode/ 节点/ 矩阵/ ,/ 表示/ 集群/ 中/ 所有/ k/ 个/ DataNode/ 节点/ 的/ 集合/ ./ SD/ =/ {/ dn1/ ,/ dn2/ ,/ …/ ,/ dnu/ }/ 表示/ 处于/ 不可/ 用/ 状态/ 的/ DataNode/ 节点/ 的/ 集合/ ,/ u/ =/ |/ SD/ |/ 表示/ 不可/ 用/ 节点/ 的/ 数目/ ,/ 其中/ 包括/ 休眠/ 与/ 宕机/ 状态/ 的/ DataNode/ 节点/ ,/ 由于/ 本文/ 讨论/ 的/ 范围/ 为/ 通过/ 休眠/ DataNode/ 节点/ 节能/ ,/ 所以/ 不/ 考虑/ 宕机/ 情况/ ,/ 将/ 所有/ 不可/ 用/ 的/ DataNode/ 节点/ 统一/ 考虑/ 为/ 休眠状态/ ./ files/ =/ {/ F1/ ,/ F2/ ,/ …/ ,/ Fw/ }/ 表示/ 集群/ 中/ 存储/ 的/ 所有/ 文件/ 的/ 集合/ ,/ 其中/ w/ =/ |/ files/ |/ 表示/ 文件/ 的/ 个数/ ./ flag/ ∈/ {/ 0/ ,/ 1/ }/ 表示/ 集群/ 中/ 所有/ 文件/ 的/ 可用性/ 标识/ ,/ 当/ 集群/ 中/ 所有/ 文件/ files/ =/ {/ F1/ ,/ F2/ ,/ …/ ,/ Fw/ }/ 满足/ 定理/ 1/ 时/ ,/ flag/ =/ 1/ ;/ 当/ 集群/ 中/ 存在/ 文件/ 不/ 满足/ 定理/ 1/ 时/ ,/ flag/ =/ 0/ ./ 此时/ 通过/ 休眠/ HDFS/ 集群/ 中/ 的/ DataNode/ 节点/ 以/ 达到/ 节能/ 目的/ 问题/ 转化/ 为/ 在/ 保证/ 四元组/ p/ =/ 〈/ 犮/ sm/ ×/ i/ ,/ SD/ ,/ files/ ,/ flag/ 〉/ 中/ flag/ =/ 1/ 的/ 前提/ 下/ ,/ 怎样/ 使得/ SD/ =/ {/ dn1/ ,/ dn1/ ,/ …/ ,/ dnu/ }/ 集合/ 最大/ 的/ 问题/ ./ 其中/ sp/ =/ u/ // k/ 的/ 值/ 表示/ 集群/ 中/ 休眠/ DataNode/ 节点/ 的/ 比例/ ,/ sp/ 值越/ 大/ ,/ 节能/ 效率/ 越高/ ./ 定理/ 2/ ./ 在/ 不/ 改变/ 任意/ 数据/ 块/ 原始/ 存储/ 结构/ 的/ 前提/ 下/ ,/ 四元组/ p/ =/ 〈/ 犮/ sm/ ×/ i/ ,/ SD/ ,/ files/ ,/ flag/ 〉/ 中/ flag/ =/ 1/ 的/ 概率/ 为/ A/ (/ k/ ,/ m1/ (/ 1/ -/ A/ (/ u/ ,/ m1/ )/ A/ (/ k/ ,/ m3/ (/ 1/ -/ A/ (/ u/ ,/ m3/ )/ 其中/ (/ n1/ ,/ n2/ ,/ n3/ ,/ …/ ,/ nw/ )/ 分别/ 表示/ 集群/ 中/ 的/ w/ 个/ 文件/ files/ =/ {/ F1/ ,/ F2/ ,/ …/ ,/ Fw/ }/ 的/ 原始/ 分块/ 数/ ,/ (/ m1/ ,/ m2/ ,/ m3/ ,/ …/ ,/ mw/ )/ 分别/ 表示/ w/ 个/ 文件/ 的/ 副本/ 系数/ ./ 证明/ ./ 在/ 拥有/ k/ 个/ DataNode/ 节点/ 的/ HDFS/ 集群/ 中有/ u/ 个/ 不可/ 用/ 的/ 节点/ ,/ 根据/ 定理/ 1/ ,/ 当/ 同一/ 数据/ 块/ 的/ m/ 个/ 备份/ 同时/ 存储/ 于/ 不可/ 用/ 节点/ 集合/ SD/ =/ {/ dn1/ ,/ dn1/ ,/ …/ ,/ dnu/ }/ 中/ 时/ ,/ 该/ 数据/ 块/ 不可/ 用/ ,/ 此/ 事件/ 发生/ 的/ 概率/ 为/ Page6/ 所以/ ,/ 该/ 数据/ 块/ 可用/ 的/ 概率/ 为/ 文件/ F/ 由/ n/ 个/ 数据/ 块/ 组成/ ,/ 当/ n/ 个/ 数据/ 块/ 都/ 可用/ 时/ ,/ 文件/ F/ 可用/ ,/ 此/ 事件/ 发生/ 的/ 概率/ 为/ 由/ 定义/ 6/ ,/ p/ =/ 〈/ 犮/ sm/ ×/ i/ ,/ SD/ ,/ files/ ,/ flag/ 〉/ 中/ flag/ =/ 1/ 表示/ 集群/ 中/ 任意/ 文件/ files/ =/ {/ F1/ ,/ F2/ ,/ …/ ,/ Fw/ }/ 都/ 满足/ 定理/ 1/ ,/ 即/ 集合/ files/ =/ {/ F1/ ,/ F2/ ,/ …/ ,/ Fw/ }/ 中/ 所有/ 文件/ 都/ 可用/ ,/ 此/ 事件/ 发生/ 的/ 概率/ 为/ A/ (/ k/ ,/ m1/ (/ 1/ -/ A/ (/ u/ ,/ m1/ )/ A/ (/ k/ ,/ m3/ (/ 1/ -/ A/ (/ u/ ,/ m3/ )/ 3.2/ HDFS/ 集群/ 与/ 数据/ 块/ 矩阵/ 示/ 例如/ 图/ 3/ 所示/ 为/ 一个/ 由/ 4/ 个/ RACK/ ,/ 每个/ RACK/ 中/ 分别/ 由/ 3/ ,/ 4/ ,/ 2/ ,/ 5/ 个/ DataNode/ 节点/ 服务器/ 组成/ 的/ HDFS/ 集群/ ,/ 其中/ 节点/ dn31/ 与/ dn44/ 处于/ 休眠状态/ ,/ dn32/ 与/ dn41/ 处于/ 宕机/ 状态/ ./ 根据/ 定义/ 1/ 该/ 集群/ DataNode/ 节点/ 矩阵/ 表示/ 为/ 犆/ 5/ ×/ 4/ ,/ 根据/ 定义/ 2/ 集群/ DataNode/ 节点/ 状态/ 矩阵/ 表示/ 为犇/ 犛/ 5/ ×/ 4/ ./ 熿/ 犆/ 5/ ×/ 4/ =/ 燀/ ./ 图/ 3HDFS/ 集群/ 中/ 文件/ 数据/ 块/ 存储/ 与/ 状态/ 示例/ 设/ F1/ 是/ 分块/ 为/ n/ =/ 2/ 、/ 副本/ 系数/ m/ =/ 3/ ,/ F2/ 是/ 分块/ 为/ n/ =/ 3/ 、/ 副本/ 系数/ m/ =/ 2/ 的/ 文件/ 存储/ 于/ 犆/ 5/ ×/ 4/ 集群/ 中/ ,/ 那么/ 根据/ 定义/ 3/ ,/ F1/ 、/ F2/ 文件/ 分块/ 矩阵/ 为/ 犉/ 12/ ×/ 3/ 、/ 犉/ 23/ ×/ 2/ ,/ 根据/ 定义/ 4/ 数据/ 块/ 存储/ 矩阵/ 为/ 犛/ 犉/ 12/ ×/ 3/ 、/ 犛/ 犉/ 23/ ×/ 2/ ,/ 根据/ 定义/ 5/ 数据/ 块/ 状态/ 矩阵/ 为/ 犅/ 犛/ 犉/ 12/ ×/ 3/ 、/ 犅/ 犛/ 犉/ 23/ ×/ 2/ ./ 犉/ 12/ ×/ 3/ =/ b11b12b13/ 犅/ 犛/ 犉/ 12/ ×/ 3/ =/ 111/ [/ ]/ 111/ ,/ 犉/ 23/ ×/ 2/ =/ 犛/ 犉/ 23/ ×/ 2/ =/ 假设/ DataNode/ 节点/ dn13/ 状态/ 转化/ 为/ 2/ 、/ dn24/ 转化/ 为/ 3/ 时/ ,/ HDFS/ 集群/ DataNode/ 节点/ 状态/ 矩阵/ 犇/ 犛/ 5/ ×/ 4/ 、/ 文件/ F1/ 、/ F2/ 数据/ 块/ 状态/ 矩阵/ 犅/ 犛/ 犉/ 12/ ×/ 3/ 、/ 犅/ 犛/ 犉/ 23/ ×/ 2/ 改变/ 为犇/ 犛/ 5/ ×/ 4/ =/ 犅/ 犛/ 犉/ 23/ ×/ 2/ =/ 从/ 数据/ 块/ 状态/ 矩阵/ 犅/ 犛/ 犉/ 12/ ×/ 3/ 与/ 犅/ 犛/ 犉/ 23/ ×/ 2/ 我们/ 可以/ 看出/ ,/ 节点/ dn13/ 与/ dn24/ 的/ 状态/ 改变/ 并/ 没有/ 影响/ 文件/ F1/ 数据/ 块/ 的/ 可用性/ ,/ 但是/ 使得/ 文件/ F2/ 第/ 2/ 个/ 数据/ Page7/ 块/ 变得/ 不可/ 用/ ./ 由此可见/ 节点/ dn13/ 与/ dn24/ 不能/ 同时/ 进入/ 休眠状态/ ,/ 否则/ 将/ 影响/ 文件/ F2/ 的/ 数据/ 块/ 可用性/ ./ 通过/ 定理/ 2/ 的/ 证明/ 过程/ 与/ 上述/ 示例/ 可以/ 看出/ ,/ 当/ 集群/ 中/ 处于/ 不可/ 用/ 状态/ 的/ 节点/ 数量/ 大于/ 等于/ 文件/ 副本/ 系数/ ,/ 即/ u/ / m/ 时/ ,/ 该/ 文件/ 都/ 有/ 可能/ 处于/ 不可/ 用/ 状态/ ./ 在/ 不/ 改变/ 数据/ 块/ 原始/ 存储/ 结构/ 的/ 情况/ 下/ ,/ 最多能/ 休眠/ u/ =/ m/ -/ 1/ 个/ DataNode/ 节点/ ,/ 在/ k/ 值/ 较大/ 时/ 达到/ 的/ 节能/ 效果/ 甚微/ ./ 所以/ ,/ 本文/ 下面/ 设计/ 了/ 数据/ 块/ 存储/ 结构/ 配置/ 算法/ ,/ 根据/ 文件/ 的/ 访问/ 规律/ 动态/ 配置/ 数据/ 块/ 的/ 存储/ 结构/ ,/ RACK/ 区域/ 划分算法/ 将/ RACK/ 分成/ Active/ -/ Zone/ 与/ Sleep/ -/ Zone/ 两个/ 区域/ ,/ 通过/ 休眠/ Sleep/ -/ Zone/ 中/ 的/ DataNode/ 节点/ 达到/ 节能/ 的/ 目的/ ./ 对称/ 数据/ 块/ 存储/ 策略/ 与/ 该/ 存储/ 策略/ 下/ 的/ 节能/ 算法/ 在/ 不/ 影响/ 原/ HDFS/ 可靠性/ 、/ 高效性/ 与/ 可扩展性/ 的/ 前提/ 下/ ,/ 对称/ 数据/ 块/ 存储/ 策略/ 使得/ 具有/ 相同/ 存储/ 结构/ 的/ DataNode/ 节点/ 之间/ 能够/ 实现/ 任务/ 的/ 转移/ 与/ 替换/ ,/ 算法/ 通过/ 任务/ 调控/ 产生/ 并/ 休眠/ 空闲/ 节点/ 从而/ 达到/ 节能/ 的/ 目的/ ./ 4HDFS/ 节能/ 算法/ 4.1/ DataNode/ 节点/ 休眠/ 验证/ 算法/ 输入/ :/ 待/ 验证/ 的/ 节点/ ID/ ,/ datanodeID/ ;/ 算法/ 1/ ./ DataNode/ 节点/ 休眠/ 验证/ 算法/ ./ 初始化/ :/ Setblocks/ ←/ newList/ 〈/ Block/ 〉/ (/ )/ ;/ block/ ←/ newBlock/ (/ )/ ;/ file/ ←/ newFile/ (/ )/ ;/ rowNum/ ←/ 0/ ;/ cloumnNum/ ←/ 0/ ;/ activeNumInRow/ ←/ 0/ ;/ rowValue/ [/ ]/ ←/ newint/ [/ ]/ ;/ blockStatusMatrix/ ←/ newBlockStatusMatrix/ (/ )/ ;/ updatedBlockStatusMatrix/ ←/ newBlockStatusMa/ -/ trix/ (/ )/ ;/ 1/ ./ blocks/ ←/ getBlocks/ (/ datanodeID/ )/ ;/ 2/ ./ fori/ =/ 0toblocks/ ./ size/ (/ )/ -/ 1do3/ ./ block/ ←/ blocks/ ./ get/ (/ i/ )/ ;/ 4/ ./ file/ ←/ getFile/ (/ block/ )/ ;/ 5/ ./ blockStatusMatrix/ ←/ getBlockStatusMatrix/ (/ file/ )/ ;/ 6/ ./ updatedBlockStatusMatrix/ ←/ 7/ ./ rowNum/ ←/ updatedBlockStatusMatrix/ ./ getRowNum/ (/ )/ ;/ 8/ ./ cloumnNum/ ←/ updatedBlockStatusMatrix/ ./ getCloumnNum/ (/ )/ ;/ 9/ ./ forj/ =/ 0torowNum/ -/ 1do10/ ./ rowValue/ [/ cloumnNum/ ]/ ←/ updatedBlockStatusMatrix/ ./ getRowValue/ (/ j/ )/ ;/ 11/ ./ fork/ =/ 0tocloumnNum/ -/ 1do12/ ./ ifrowValue/ [/ k/ ]/ =/ =/ 1then13/ ./ activeNumInRow/ ++/ ;/ 14/ ./ endif15/ ./ endfor16/ ./ ifactiveNumInRow/ =/ =/ 0then17/ ./ returnfalse18/ ./ endif19/ ./ endfor20/ ./ endfor21/ ./ returntrue/ 定理/ 1/ 可/ 用于/ 验证/ 一个/ DataNode/ 节点/ 由/ 活动状态/ 转化/ 为/ 休眠状态/ 是否/ 影响/ 数据/ 块/ 的/ 可用性/ ./ 当/ 任意/ DataNode/ 节点/ 由/ 活动状态/ 转化/ 到/ 休眠状态/ 时/ ,/ 使得/ 该/ 节点/ 上/ 所有/ 的/ 数据/ 块/ 不可/ 用/ ,/ 通过/ 更新/ 并/ 验证/ 休眠/ DataNode/ 节点/ 上/ 所有/ 数据/ 块/ 所属/ 文件/ 的/ 数据/ 块/ 状态/ 矩阵/ 犅/ 犛/ n/ ×/ m/ ,/ 是否/ 违反/ 数据/ 块/ 可用性/ 原则/ 来/ 验证/ 该/ 节点/ 能否/ 进入/ 休眠状态/ ./ DataNode/ 节点/ 可/ 休眠/ 验证/ 算法/ 如/ 算法/ 1/ 所示/ ./ 算法/ 第/ 1/ 行/ 通过/ 输入/ 参数/ datatnodeID/ 得到/ DataNode/ 节点/ 上/ 所有/ 数据/ 块/ 的/ 集合/ ,/ 遍历/ 所有/ 数据/ 块/ 并/ 通过/ 数据/ 块/ 信息/ 得到/ 数据/ 块/ 所属/ 文件/ 的/ file/ 对象/ ,/ 通过/ file/ 对象/ 可以/ 得到/ 该/ 文件/ 的/ 数据/ 块/ 状态/ 矩阵/ ./ 算法/ 第/ 6/ 行/ 更新/ DataNode/ 节点/ 上/ 所有/ 数据/ 块/ 状态/ 由/ 1/ (/ 活动/ )/ 转化/ 为/ 2/ (/ 休眠/ )/ 后/ 的/ 数据/ 块/ 状态/ 矩阵/ ./ 循环/ 数据/ 块/ 状态/ 矩阵/ 的/ 每/ 一行/ ,/ 验证/ 新/ 的/ 数据/ 块/ 状态/ 矩阵/ 行/ 是否/ 能/ 满足/ 数据/ 块/ 可用性/ 的/ 要求/ ./ 如果/ 有/ 任意/ 数据/ 块/ 变得/ 不可/ 用/ ,/ 第/ 17/ 行/ 返回/ false/ ,/ 表示/ 该/ DataNode/ 节点/ 不能/ 进入/ 休眠状态/ ;/ 如果/ 循环/ 结束/ ,/ 验证/ 所有/ 的/ 数据/ 块/ 可用性/ 并/ 没有/ 受到/ DataNode/ 节点/ 休眠/ 的/ 影响/ ,/ 返回/ true/ ,/ 此时/ 可/ 将/ 该/ 节点/ 休眠/ 节能/ ./ 4.2/ 数据/ 块/ 存储/ 结构/ 配置/ 节能/ 算法/ 文献/ [/ 32/ -/ 33/ ]/ 通过/ 对/ Yahoo/ 公司/ HDFS/ 集群/ 内部/ 数据/ 块/ 访问/ 日志/ 的/ 分析/ ,/ 得出/ 90.26/ %/ 的/ 数据/ 块/ 都/ 会/ 在/ 其/ 上传/ 2/ 天内/ 进行/ 第一次/ 访问/ ,/ 89.61/ %/ 的/ 数据/ 块/ 都/ 会/ 再/ 其/ 上传/ 后/ 的/ 10/ 天内/ 进行/ 最后/ 一次/ 访问/ ,/ 40/ %/ 的/ 数据/ 块/ 最后/ 一次/ 读取/ 时间/ 到/ 最后/ 删除/ 的/ 时间跨度/ 都/ 不会/ 超过/ 20/ 天/ ./ 由此可见/ HDFS/ 集群/ 内部/ 数据/ 块/ 的/ 访问/ 具有/ 较强/ 的/ 规律性/ ,/ 数据/ 块/ 访问/ 的/ 热点/ 期/ 大多/ 集中/ 在/ 其/ 上传/ 后/ 较/ 短/ 的/ 一段时间/ 内/ ,/ 过后/ 则/ 进入/ 空闲/ 期/ ./ 根据/ 数据/ 块/ 这种/ 访问/ 规律/ 并/ 结合/ 数据/ 块/ 矩阵/ 本文/ 设计/ 了/ 数据/ 块/ 存储/ 结构/ 配置/ 节能/ 算法/ ./ 如图/ 4/ 所示/ ,/ RACK/ 区域/ 划分算法/ 将/ RACK/ 分成/ Active/ -/ Zone/ 与/ Sleep/ -/ Zone/ 两个/ 区域/ ,/ Active/ -/ Zone/ 中/ 的/ DataNode/ 节点/ 用于/ 存放/ 状态/ 为/ 1/ 的/ 数据/ 块/ ,/ 而/ Sleep/ -/ Zone/ 中/ 的/ 节点/ 用于/ 存放/ 状态/ 为/ 2/ 的/ 数据/ 块/ ,/ 并/ 通过/ 休眠/ 处于/ Sleep/ -/ Zone/ 的/ 节点/ 来/ 达到/ 节/ Page8/ 能/ 的/ 目的/ ./ 算法/ 在/ 保证数据/ 块/ 可用性/ 的/ 前提/ 下/ ,/ 在/ 算法/ 执行/ 时间/ 周期/ T/ 内/ 根据/ 文件/ 的/ 访问/ 频率/ 调整/ 该/ 文件/ 的/ 数据/ 块/ 状态/ 矩阵/ 犅/ 犛/ n/ ×/ m/ 中/ 处于/ 活动状态/ 数据/ 块/ 的/ 数量/ ./ 如果/ 一个/ 文件/ 在/ 时间/ 周期/ T/ 内/ 访问/ 次数/ 小于/ 阈值/ sleepCount/ ,/ 算法/ 则/ 会/ 减小/ 该/ 文件/ 的/ 活动/ 数据/ 块/ 的/ 数量/ ,/ 相反/ 如果/ 访问/ 次数/ 大于/ 阈值/ active/ -/ Count/ ,/ 则/ 增加/ 活动/ 数据/ 块/ 的/ 数量/ ;/ 算法/ 在/ 达到/ 节能/ 目的/ 的/ 同时/ 保证/ 了/ 数据/ 块/ 的/ 可用性/ ./ 算法/ 如/ 算法/ 2/ 所示/ ./ 输入/ :/ 算法/ 2/ ./ 数据/ 块/ 存储/ 结构/ 配置/ 节能/ 算法/ ./ HDFS/ 集群/ 中/ 所有/ 数据文件/ :/ List/ 〈/ File/ 〉/ allFileInHDFS/ ;/ 算法/ 执行/ 周期/ :/ T/ ;/ 将/ 数据/ 块/ 从/ Active/ -/ Zone/ 移动/ 到/ Sleep/ -/ Zone/ 的/ 阈值/ :/ 将/ 数据/ 块/ 从/ Sleep/ -/ Zone/ 移动/ 到/ Active/ -/ Zone/ 的/ 阈值/ :/ 初始化/ 1/ ./ ifexecutionTime/ (/ T/ )/ then2/ ./ acitveAllSleepDataNodes/ (/ )/ ;/ 3/ ./ fileNumInHDFS/ ←/ allFileInHDFS/ ./ size/ (/ )/ ;/ 4/ ./ fori/ =/ 0tofileNumInHDFS/ -/ 1do5/ ./ file/ ←/ allFileInHDFS/ ./ get/ (/ i/ )/ ;/ 6/ ./ visitCount/ ←/ getVisitCountFromLog/ (/ file/ )/ ;/ 7/ ./ blockStatusMatrix/ ←/ getBlockStatusMatrix/ (/ file/ )/ ;/ 8/ ./ cloumnNum/ ←/ blockStatusMatrix/ ./ getCloumnNum/ (/ )/ ;/ 9/ ./ activeBlockNumInRow/ ←/ blockStatusMatrix/ ./ getAcitveNum/ (/ )/ ;/ 10/ ./ ifvisitCount/ </ sleepCountthen11/ ./ ifactiveBlockNumInRow/ >/ 1then12/ ./ reduceActiveBlockNum/ (/ blockStatusMatrix/ )/ ;/ 13/ ./ moveBlockToSleepZone/ (/ block/ ,/ 2/ )/ ;/ 14/ ./ endif15/ ./ endif16/ ./ ifvisitCount/ >/ activeCountthen17/ ./ ifactiveBlockNumInRow/ </ cloumnNumthen18/ ./ increaseActiveBlockNum/ (/ blockStatusMatrix/ )/ ;/ 19/ ./ moveBlockToActiveZone/ (/ block/ ,/ 1/ )/ ;/ 20/ ./ endif21/ ./ endif22/ ./ updateBlockStoreMatrix/ (/ file/ )/ ;/ 23/ ./ updateBlockStatusMatrix/ (/ file/ )/ ;/ 24/ ./ endif25/ ./ endif/ 算法/ 输入/ 参数/ T/ 为/ 算法/ 执行/ 时间/ 周期/ (/ 如/ 一天/ 、/ 一周/ 等/ )/ ,/ 可/ 根据/ 不同/ 的/ HDFS/ 集群/ 的/ 特点/ 设置/ 不同/ 的/ T/ 值/ 并/ 最好/ 选择/ 在/ HDFS/ 集群/ 较为/ 空闲/ 时/ 执行/ 算法/ ;/ sleepCount/ 与/ activeCount/ 为/ 减小/ 与/ 增加/ 文件/ 活动/ 数据/ 块/ 数量/ 的/ 阈值/ ,/ 参数/ allFileInHDFS/ 表示/ 集群/ 中/ 所有/ 文件/ 的/ 集合/ ./ 算法/ 第/ 1/ 行/ 表示/ 达到/ 执行/ 时间/ 周期/ T/ 条件/ 时/ 开始/ 执行/ 算法/ ,/ 代码/ 行/ 2/ 首先/ 唤醒/ 所有/ 的/ 休眠/ 节点/ ,/ 以便/ 后续/ 操作/ 的/ 顺利进行/ ./ 代码/ 行/ 4/ 循环/ 遍历/ HDFS/ 集群/ 中/ 所有/ 的/ 文件/ 数据/ 块/ 状态/ 矩阵/ ,/ 并/ 根据/ 文件/ 的/ 访问/ 日志/ 得到/ 数据/ 块/ 的/ 访问/ 次数/ ,/ 与/ 阈值/ 参数/ sleepCount/ 、/ activeCount/ 进行/ 比较/ 判断/ 该/ 文件/ 是/ 减小/ 还是/ 增加/ 活动/ 数据/ 块/ 的/ 数量/ ,/ 并/ 将/ 状态/ 改变/ 后/ 的/ 数据/ 块/ 转移/ 到/ 相应/ 的/ 区域/ 中/ ,/ 最后/ 22/ 、/ 23/ 行/ 更新/ 该/ 文件/ 的/ 数据/ 块/ 存储/ 与/ 状态/ 矩阵/ ./ 数据/ 块/ 存储/ 结构/ 配置/ 节能/ 算法/ 需要/ RACK/ 区域/ 划分算法/ 的/ 支持/ ./ RACK/ 区域/ 划分算法/ 如/ 算法/ 3/ 所示/ ./ 算法/ 3/ ./ RACK/ 区域/ 划分算法/ ./ 输入/ :/ 初始化/ :/ Setrack/ ←/ newRack/ (/ )/ ;/ block/ ←/ newBlock/ (/ )/ ;/ dataNode/ ←/ newDataNode/ (/ )/ ;/ dataNodesInRack/ ←/ newList/ 〈/ DataNode/ 〉/ (/ )/ ;/ blocksInDataNode/ ←/ 0/ ;/ blocksInRack/ ←/ 0/ ;/ activeBlocksInRack/ ←/ 0/ ;/ dataNodeNum/ ←/ 0/ ;/ activeDataNodeNum/ ←/ 0/ ;/ Page9sleepDataNodeNum/ ←/ 0/ ;/ 1/ ./ fori/ =/ 0toracks/ ./ size/ (/ )/ -/ 1do2/ ./ rack/ ←/ racks/ ./ get/ (/ i/ )/ ;/ 3/ ./ dataNodeNum/ ←/ rack/ ./ getDataNodeNum/ (/ i/ )/ ;/ 4/ ./ dataNodesInRack/ ←/ rack/ ./ getDataNodes/ (/ i/ )/ ;/ 5/ ./ forj/ =/ 0todataNodeNum/ -/ 1do6/ ./ dataNode/ ←/ racks/ ./ get/ (/ j/ )/ ;/ 7/ ./ blocksInDataNode/ ←/ dataNode/ ./ getBlockNum/ (/ )/ ;/ 8/ ./ blocksInRack/ +/ =/ blocksInDataNode/ ;/ 9/ ./ fork/ =/ 0toblocksInDataNode/ -/ 1do10/ ./ block/ ←/ dataNode/ ./ getBlock/ (/ k/ )/ ;/ 11/ ./ ifblock/ ./ status/ =/ =/ 1then12/ ./ activeBlocksInRack/ ++/ ;/ 13/ ./ endif14/ ./ endfor15/ ./ endfor16/ ./ activeDataNodeNum/ ←/ 17/ ./ sleepDataNodeNum/ ←/ dataNodeNum/ -/ 18/ ./ returnactiveDataNodeNum/ ,/ sleepDataNodeNum19/ ./ endforRACK/ 区域/ 划分算法/ 解决/ 了/ RACK/ 中/ Active/ -/ Zone/ 与/ Sleep/ -/ Zone/ 区域/ 节点/ 分配/ 问题/ ,/ 算法/ 采用/ 与/ Hadoop/ 原/ balancer/ 相同/ 的/ 策略/ ,/ 即将/ RACK/ 中/ 的/ 所有/ 数据/ 块/ 平均分配/ 到/ 该/ RACK/ 所属/ 节点/ 中/ ,/ 按照/ RACK/ 中/ 活动/ 与/ 休眠/ 数据/ 块/ 的/ 比例/ 计算/ 活动/ 与/ 休眠/ 节点/ 的/ 数量/ ,/ 算法/ 伪/ 代码/ 如/ 算法/ 3/ 所示/ ./ 算法/ 首先/ 遍历/ RACK/ 中/ 所有/ 的/ DataNode/ 节点/ 与/ 节点/ 中/ 的/ 数据/ 块/ ,/ 算法/ 第/ 12/ 行/ 计算/ RACK/ 中/ 活动/ 数据/ 块/ 的/ 数量/ ,/ 算法/ 第/ 16/ 行/ 通过/ 计算/ 活动/ 数据/ 块/ 与/ 总/ 数据/ 块/ 的/ 比值/ 来/ 计算/ Active/ -/ Zone/ 区域/ 中/ 节点/ 的/ 数量/ ,/ 代码/ 第/ 17/ 行/ 通过/ RACK/ 中/ 总/ 的/ 节点/ 数量/ 减去/ Active/ -/ Zone/ 区域/ 中/ 节点/ 的/ 数量/ 便/ 得到/ Sleep/ -/ Zone/ 区域/ 节点/ 的/ 数量/ ./ RACK/ 区域/ 划分算法/ 应/ 选择/ 在/ 数据/ 块/ 存储/ 结构/ 配置/ 节能/ 算法/ 第/ 13/ 行/ 代码/ 前/ 执行/ ./ 4.3/ 对称/ 数据/ 块/ 存储/ 策略/ 下/ 的/ 节能/ 算法/ 机架/ 感知/ 的/ 数据/ 块/ 存储/ 策略/ 下/ 集群/ 中/ 数据/ 块/ 的/ 存储/ 具有/ 随机性/ ,/ 任意/ 两个/ DataNode/ 节点/ 存储/ 结构/ 不/ 可能/ 完全相同/ ,/ 此种/ 情况/ 下/ 只能/ 通过/ 4.2/ 节/ 重新配置/ 数据/ 块/ 存储/ 结构/ 以/ 达到/ 节能/ 的/ 目的/ ./ 假设/ 存在/ 相同/ 数据/ 块/ 存储/ 结构/ 的/ DataNode/ 节点/ dn1/ 与/ dn2/ ,/ 即/ dn1/ 与/ dn2/ 之间/ 的/ 任务/ 可以/ 相互/ 转移/ 与/ 替换/ ./ 当/ dn1/ ,/ dn2/ 负载/ 率/ 都/ 较/ 低时/ ,/ 将/ dn1/ 与/ dn2/ 其中/ 之一/ 进行/ 休眠/ 处理/ ,/ 此时/ dn1/ ,/ dn2/ 中/ 的/ 数据/ 块/ 可用性/ 将/ 不会/ 受到/ 任何/ 影响/ ./ 基于/ 这种/ 思想/ 本文/ 设计/ 了/ 对称/ 数据/ 块/ 存储/ 策略/ 如图/ 5/ 所示/ ./ 按照/ 数据/ 块/ 分块/ 矩阵/ 犉/ n/ ×/ m/ 对称/ 地/ 存储/ 于/ HDFS/ 集群/ 中/ ,/ 其中/ Rack1/ 中/ 存放/ 着/ 文件/ F/ 的/ 原始数据/ 块/ ,/ Rack2/ 到/ Rackm/ 都/ 存放/ 原始数据/ 块/ 的/ 副本/ ,/ 即/ 为/ 矩阵/ 犉/ n/ ×/ (/ m/ -/ 1/ )/ 中/ 表示/ 的/ 数据/ 块/ ./ DataNode/ 节点/ 矩阵/ 为/ 犆/ r/ ×/ m/ :/ 当/ 数据/ 块/ 上/ 传到/ 集群/ 中/ 时/ 按照/ 对称/ 数据/ 块/ 存储/ 策略/ 进行/ 存储/ ,/ 该/ 存储/ 策略/ 使得/ 犆/ r/ ×/ m/ 矩阵/ 中/ 每/ 一行/ 中/ 的/ m/ 个/ DataNode/ 数据/ 块/ 存储/ 结构/ 完全一致/ ,/ 互为/ 备份/ ./ 对称/ 数据/ 块/ 存储/ 策略/ 简化/ 了/ HDFS/ 集群/ 数据/ 块/ 可用性/ 的/ 判断/ 条件/ ,/ 只要/ 犆/ r/ ×/ m/ 中/ 的/ 每行/ 保证/ 至少/ 一个/ 节点/ 处于/ 活动状态/ ,/ HDFS/ 集群/ 中/ 所有/ 数据/ 块/ 都/ 可用/ ./ 由于/ 副本/ 系数/ m/ 为/ 一/ 可变/ 因子/ ,/ 设/ 不同/ m/ 值/ 的/ 犆/ r/ ×/ m/ 矩阵/ 为/ 一组/ ,/ 一个/ HDFS/ 集群/ 可/ 由/ 多个/ 组/ 构成/ ,/ 其/ 结构/ 表示/ 为/ 对称/ 数据/ 块/ 存储/ 策略/ 使得/ 犆/ r/ ×/ m/ 组中/ 每/ 一行/ m/ 个/ DataNode/ 节点/ 数据/ 块/ 存储/ 结构/ 完全一致/ ,/ m/ 个/ DataNode/ 节点/ 之间/ 的/ 任务/ 可以/ 相互/ 转移/ 与/ 替换/ ,/ 节能/ 算法/ 通过/ 控制/ 任务/ 的/ 调度/ 分配/ 产生/ 空闲/ 节点/ ,/ 将/ 空闲/ 节点/ 休眠/ 以/ 达到/ 节能/ 的/ 目的/ ./ 图/ 6/ 表示/ 了/ 对称/ 图/ 6/ 对称/ 数据/ 块/ 存储/ 策略/ 下/ 的/ 节能/ 算法/ 架构图/ Page10/ 数据/ 块/ 存储/ 策略/ 下/ 的/ 节能/ 算法/ 架构图/ ,/ DataNode/ 通过/ 心跳/ 向/ NameNode/ 发送/ 负载/ 信息/ ,/ 能耗/ 控制器/ PowerController/ 用于/ 接收/ 与/ 处理/ NameNode/ 发送/ 过来/ 的/ 节点/ 负载/ 信息/ ,/ PowerController/ 根据/ 不同/ 的/ 负载/ 情况/ 进行/ 处理/ ,/ 将/ 处理/ 后/ 的/ 配置/ 信息/ 传送/ 回图/ 7/ 当/ m/ =/ 3/ 时/ DataNode/ 负载/ 状态/ 示意图/ 算法/ 4/ ./ 对称/ 数据/ 块/ 存储/ 策略/ 下/ 的/ 节能/ 算法/ ./ 1/ ./ 初始化/ ./ 设置/ DataNode/ 最大/ 负载/ 阈值/ Umax/ 与/ 休眠/ 负载/ 阈值/ Umin/ ,/ 算法/ 执行/ 时间/ 周期/ T/ ./ 2/ ./ DataNode/ 节点/ 定期/ 向/ NameNode/ 节点/ 发送/ heart/ -/ beat/ 心跳/ 信息/ ,/ 心跳/ 信息/ 包括/ DataNode/ 节点/ 负载/ 状态/ 信息/ ./ 当/ 达到/ 算法/ 执行/ 时间/ 周期/ T/ 时/ ,/ NameNode/ 将/ 负载/ 介于/ Umin/ 与/ Umax/ 之间/ 的/ 节点/ 视为/ 正常/ 节点/ ,/ 当有/ 节点/ 负载/ 小于/ Umin/ 或者/ 大于/ Umax/ 时/ ,/ NameNode/ 将/ 该/ DataNode/ 节点/ 与其/ 同行/ 所有/ 的/ DataNode/ 负载/ 状态/ 信息/ 放入/ List/ 〈/ RowDataNodeStatus/ 〉/ 中/ 并/ 发送给/ PowerController/ 节点/ 进行/ 处理/ ./ 3/ ./ 当/ PowerController/ 接收/ 到/ 如/ row2/ 所示/ 负载/ 信息/ ,/ 即/ 有/ DataNode/ 节点/ 负载/ 均/ 超过/ Umax/ 时/ ,/ PowerController/ 向/ NameNode/ 节点/ 返回/ 配置/ 信息/ :/ 在/ 时间/ 周期/ T/ 内/ 停止/ 向/ dn11/ ,/ dn12/ ,/ dn13/ 节点/ 分配/ 数据/ 写入/ 操作/ ,/ 新/ 写入/ 数据/ 任务分配/ 到/ 其它/ 组/ ;/ 转向/ 执行/ 步/ 16.4/ ./ 当/ PowerController/ 接收/ 到/ 如/ row2/ 所示/ 负载/ 信息/ 时/ ,/ PowerController/ 向/ NameNode/ 节点/ 返回/ 配置/ 信息/ :/ 唤醒/ 休眠/ 节点/ dn23/ 并/ 将/ dn21/ 与/ dn22/ 部分/ 任务/ 转移/ 到/ dn23/ 节点/ 执行/ ;/ 转向/ 执行/ 步/ 16.5/ ./ 当/ PowerController/ 接收/ 到/ 如/ row3/ 所示/ 负载/ 信息/ 时/ ,/ PowerController/ 向/ NameNode/ 节点/ 返回/ 配置/ 信息/ :/ 在/ 时间/ 周期/ T/ 内/ 将/ 分配任务/ 到/ 节点/ dn31/ 与/ dn32/ 的/ 任务/ 转移/ 到/ dn33/ 节点/ ;/ 转向/ 执行/ 步/ 16.6/ ./ 当/ PowerController/ 接收/ 到/ 如/ row4/ 所示/ 负载/ 信息/ NameNode/ 节点/ ,/ 最后/ 由/ NameNode/ 执行/ Power/ -/ Controller/ 发出/ 的/ 节能/ 控制/ 信息/ ./ 本文/ 以/ m/ =/ 3/ 时为例/ 阐述/ 对称/ 数据/ 块/ 存储/ 策略/ 下/ 的/ 节能/ 算法/ 的/ 步骤/ ,/ 设其/ DataNode/ 负载/ 状态/ 如图/ 7/ 所示/ ./ 7/ ./ 当/ PowerController/ 接收/ 到/ 如/ row5/ 所示/ 负载/ 信息/ 时/ ,/ PowerController/ 向/ NameNode/ 节点/ 返回/ 配置/ 信息/ :/ 在/ 时间/ 周期/ T/ 内/ 将/ dn51/ 部分/ 任务/ 转移/ 到/ dn52/ 执行/ ,/ 如果/ 在/ 周期/ T/ 内/ 出现/ row2/ 所示/ 情况/ ,/ 则/ 执行/ 步/ 4/ ;/ 否则/ 转向/ 执行/ 步/ 16.8/ ./ 当/ PowerController/ 接收/ 到/ 如/ row6/ 所示/ 负载/ 信息/ 时/ ,/ PowerController/ 向/ NameNode/ 节点/ 返回/ 配置/ 信息/ :/ 在/ 时间/ 周期/ T/ 内/ 将/ dn61/ 任务/ 转移/ 到/ dn63/ 执行/ ;/ 转向/ 步/ 16.9/ ./ 当/ PowerController/ 接收/ 到/ 如/ row7/ 所示/ 负载/ 信息/ 时/ ,/ PowerController/ 向/ NameNode/ 节点/ 返回/ 配置/ 信息/ :/ 在/ 时间/ 周期/ T/ 内/ 将/ dn71/ 任务/ 转移/ 到/ dn72/ 与/ dn73/ 负载/ 较轻/ 的/ 节点/ ;/ 转向/ 执行/ 步/ 16.10/ ./ 当/ PowerController/ 接收/ 到/ 如/ row8/ 所示/ 负载/ 信息/ 时/ ,/ PowerController/ 向/ NameNode/ 节点/ 返回/ 配置/ 信息/ :/ 在/ 时间/ 周期/ T/ 内/ 将/ dn81/ 任务/ 转移/ 到/ dn82/ 节点/ ,/ 如/ 在/ 时间/ 周期/ T/ 内/ 出现/ row2/ 情况/ ,/ 转向/ 步/ 4/ ,/ 否则/ 转向/ 步/ 16/ ./ 时/ ,/ PowerController/ 向/ NameNode/ 节点/ 返回/ 配置/ 信息/ :/ 唤醒/ dn42/ 与/ dn43/ 中/ 休眠/ 时间/ 较长/ 的/ 节点/ 并/ 在/ 时间/ 周期/ T/ 内/ 停止/ 向/ dn41/ 分配任务/ ;/ 转向/ 执行/ 步/ 16.11/ ./ 当/ PowerController/ 接收/ 到/ 如/ row9/ 所示/ 负载/ 信息/ 时/ ,/ PowerController/ 向/ NameNode/ 节点/ 返回/ 配置/ 信息/ :/ 在/ 时间/ 周期/ T/ 内/ 将/ dn91/ ,/ dn92/ ,/ dn93/ 中负载/ 最低/ 的/ 节点/ (/ 假设/ 为/ dn92/ )/ 任务/ 转移/ 到/ 其它/ 两个/ 节点/ (/ dn91/ ,/ dn93/ )/ ,/ 当/ dn92/ 负载/ 降为/ 0/ 时/ 进入/ 休眠状态/ ;/ 转向/ 执行/ 步/ 16.12/ ./ 当/ PowerController/ 接收/ 到/ 如/ row10/ 所示/ 负载/ 信息/ Page11/ 时/ ,/ PowerController/ 向/ NameNode/ 节点/ 返回/ 配置/ 信息/ :/ 在/ 时间/ 周期/ T/ 内/ 将/ dn10/ _/ 1/ 负载/ 转移/ 到/ dn10/ _/ 2/ (/ 假设/ dn10/ _/ 1/ 负载/ 小于/ dn10/ _/ 2/ )/ ,/ 当/ dn10/ _/ 1/ 负载/ 降为/ 0/ 时/ 进入/ 休眠状态/ ;/ 转向/ 执行/ 步/ 16.13/ ./ 当/ PowerController/ 接收/ 到/ 如/ row11/ 所示/ 负载/ 信息/ 时/ ,/ PowerController/ 向/ NameNode/ 节点/ 返回/ 配置/ 信息/ :/ 在/ 时间/ 周期/ T/ 内/ 将/ dn11/ _/ 1/ 负载/ 转移/ 到/ dn11/ _/ 2/ ,/ 当/ dn11/ _/ 1/ 负载/ 降为/ 0/ 时/ 进入/ 休眠状态/ ;/ 转向/ 执行/ 步/ 16.14/ ./ 当/ PowerController/ 接收/ 到/ 如/ row12/ 所示/ 负载/ 信息/ 时/ ,/ PowerController/ 向/ NameNode/ 节点/ 返回/ 配置/ 信息/ :/ 在/ 时间/ 周期/ T/ 内/ 将/ dn12/ _/ 1/ 负载/ 转移/ 到/ dn12/ _/ 2/ 与/ dn12/ _/ 3/ 中负载/ 较/ 低/ 节点/ ,/ 当/ dn12/ _/ 1/ 负载/ 降为/ 0/ 时/ 进入/ 休眠状态/ ;/ 转向/ 执行/ 步/ 16.15/ ./ 当/ PowerController/ 接收/ 到/ 如/ row13/ 所示/ 负载/ 信息/ 时/ ,/ 不/ 作/ 任何/ 处理/ ;/ 转向/ 执行/ 步/ 16.16/ ./ 执行/ List/ 〈/ RowDataNodeStatus/ 〉/ 队列/ 的/ next/ (/ )/ 方法/ 执行/ 下/ 一行/ DataNode/ 状态/ ,/ 如果/ 队列/ 中/ 所有/ 的/ 行/ 都/ 处理/ 完成/ ,/ 算法/ 结束/ ./ 5/ 算法/ 分析模型/ 本/ 节/ 给出/ HDFS/ 下/ 数据库/ 存储/ 结构/ 配置/ 节能/ 算法/ 与/ 对称/ 数据/ 块/ 策略/ 下/ 的/ 节能/ 算法/ 的/ 分析模型/ ,/ 其中/ 符号/ 定义/ 说明/ 如表/ 1/ 所示/ ./ 符号/ F/ 文件/ 表示/ 符号/ n/ 文件/ 分块/ 原始数据/ 块/ 的/ 数量/ m/ 数据/ 块/ 副本/ 系数/ kHDFS/ 集群/ 中/ DataNode/ 节点/ 的/ 数量/ u/ 集群/ 中/ 处于/ 不可/ 用/ 状态/ 的/ DataNode/ 节点/ 的/ 数量/ sd/ 集群/ 中/ 休眠/ 的/ DataNode/ 节点/ 的/ 数量/ wHDFS/ 集群/ 中/ 所有/ 文件/ 的/ 个数/ z/ 组成/ HDFS/ 集群/ 的/ 犆/ r/ ×/ m/ 组数/ r/ 犆/ r/ ×/ m/ 中/ DataNode/ 节点/ 的/ 行数/ PDataNode/ 节点/ 服务器/ 功耗/ EDataNode/ 节点/ 服务器/ 能耗/ aDataNode/ 节点/ 服务器/ 电路/ 翻转/ 频率/ CDataNode/ 节点/ 服务器/ 负载/ 电容/ fDataNode/ 节点/ 服务器/ 时钟/ 频率/ V/ 电压/ SDataNode/ 节点/ 服务器/ 服务/ 速率/ Pro/ 数据/ 块/ 可用/ 概率/ 服务器/ 中/ 系统/ 能耗/ 主要/ 由/ 处理器/ 、/ 内存/ 、/ 磁盘/ I/ // O/ 、/ 散热/ 设备/ 等等/ 组成/ ,/ 据/ 文献/ [/ 35/ ]/ 服务器/ 功耗/ 由/ 静态/ 功耗/ 与/ 动态/ 功耗/ 组成/ :/ 其中/ Pdynamic/ 可/ 表示/ 为/ 其中/ ,/ a/ 为/ 电路/ 翻转/ 频率/ ,/ C/ 是/ 负载/ 电容/ ,/ f/ 为/ 时钟/ 频率/ ,/ V/ 为/ 电压/ ./ 电压/ V/ 与/ 时钟/ 频率/ f/ 成正比/ ,/ f/ 时钟/ 频率/ 与/ 系统/ 性能/ 成正比/ ./ 文献/ [/ 35/ ]/ 将/ 服务器/ 系统/ 功耗/ 简化/ 表示/ 为/ 其中/ ,/ σ/ e/ 为/ 空闲/ 功耗/ 或者/ 静态/ 功耗/ ;/ s/ 为/ 服务器/ 服务/ 速率/ ,/ 与/ 式/ (/ 5/ )/ 中/ f/ 成正比/ ;/ μ/ e/ 和/ a/ 为/ 常数/ ,/ 与/ 具体/ 的/ 设备/ 相关/ ./ 文献/ [/ 36/ ]/ 指出/ a/ 的/ 取值/ 通常/ 在/ 3/ 之间/ 波动/ ,/ 而/ 文献/ [/ 35/ ]/ 对/ IntelPXA270/ 、/ PentiumM770/ 与/ TCP/ // IPOffloadEngine/ 进行/ 了/ 研究/ 并/ 得出/ 三者/ a/ 值/ 分别/ 为/ 1.11/ 、/ 1.62/ 、/ 1.66/ ./ 由于/ 能耗/ 与/ 功耗/ 是/ 完全/ 不同/ 的/ 概念/ ,/ 能耗/ 为/ 服务器/ 在/ 一段时间/ 内所/ 消耗/ 的/ 总/ 能量/ ,/ 单位/ 为/ 焦耳/ (/ J/ )/ ,/ 在/ Δ/ t/ 时间/ 内/ 的/ 能耗/ 定义/ 如式/ (/ 8/ )/ 所示/ :/ 数据/ 块/ 存储/ 结构/ 配置/ 节能/ 算法/ 靠/ 休眠/ Sleep/ -/ Zone/ 区域/ 的/ DataNode/ 节点/ 达到/ 节能/ 的/ 目的/ ,/ 设/ 所有/ RACKSleep/ -/ Zone/ 中/ 休眠/ 节点/ 数量/ 为/ sd/ ,/ 那么/ Active/ -/ zone/ 中/ 的/ 节点/ 数量/ 为/ k/ -/ sd/ ,/ 节能/ 算法/ 执行/ 前/ 集群/ 中/ k/ 个/ 节点/ 都/ 处于/ 活动状态/ ,/ 此时/ 集群/ 功耗/ 为/ k/ 个/ 节点/ 功耗/ 的/ 总和/ :/ 当/ 休眠/ sd/ 个/ 节点/ 后/ ,/ 剩余/ k/ -/ sd/ 个/ 节点/ 消耗/ 能量/ ,/ 此时/ 集群/ 功耗/ 为/ 那么/ 由/ 数据/ 块/ 存储/ 结构/ 配置/ 节能/ 算法/ 节省/ 的/ 功耗/ 为/ Psave/ =/ ∑/ k/ 其中/ ,/ s1/ 为/ 算法/ 执行/ 前/ 的/ 服务器/ 速率/ ,/ s2/ 为/ 算法/ 执行/ 后/ 的/ 服务器/ 速率/ ,/ 一般/ 情况/ 下有/ s1/ </ s2/ ./ 由/ 数据/ 块/ 存储/ 结构/ 配置/ 节能/ 算法/ 在/ Δ/ t/ 时间/ 内/ 节省/ 的/ 能量/ 可/ 表达/ 为/ Esave/ _/ Δ/ t/ =/ ∫/ t/ +/ Δ/ t/ 对称/ 数据/ 块/ 存储/ 策略/ 下/ 的/ 节能/ 算法/ 进行/ Data/ -/ Node/ 之间/ 任务/ 转移/ 与/ 替换/ 时/ 将/ 改变/ DataNode/ 服务/ 速率/ s/ ,/ 即/ 减少/ 了/ 任务/ 转移/ 节点/ 的/ 功耗/ 而/ 增加/ 了/ 任务/ 转移/ 目标/ 节点/ 的/ 功耗/ ,/ 特别/ 的/ 当/ 某/ 一个/ DataNode/ 节点/ 进入/ 休眠状态/ 后/ ,/ 其/ 功耗/ 可/ 忽略不计/ ,/ 即/ Pserver/ =/ 0/ ./ 所以/ 在/ HDFS/ 集群/ 某/ 副本/ 系数/ 为/ m/ 组/ 的/ 某/ 一行/ 中/ ,/ 由/ 节能/ 算法/ 带来/ 的/ 功耗/ 节省/ 可/ 表示/ 为/ Page12Psave/ _/ row/ =/ ∑/ m/ 其中/ ,/ P/ 表示/ 该行/ 中/ 第/ i/ 个/ DataNode/ 节点/ 节能/ 算法/ 执行/ 前/ 的/ 功耗/ ,/ P/ 表示/ 该/ 节点/ 节能/ 算法/ 执行/ 后/ 的/ 功耗/ ./ 那么/ 一个/ 犆/ r/ ×/ m/ 组/ 功耗/ 节省/ 为/ Psave/ _/ group/ =/ ∑/ r/ 其中/ r/ 表示/ 犆/ r/ ×/ m/ 组中/ DataNode/ 节点/ 行数/ ./ 假设/ HDFS/ 集群/ 由/ z/ 个/ 犆/ r/ ×/ m/ 组/ 组成/ ,/ 那么/ 整个/ HDFS/ 集群/ 功耗/ 节省/ 可/ 表示/ 为/ Psave/ _/ HDFS/ =/ ∑/ z/ 由于/ HDFS/ 集群/ 是/ 负载/ 不断/ 变化/ 的/ 系统/ ,/ 所以/ 其/ 功耗/ 也/ 在/ 不断/ 变化/ ,/ 由/ 节能/ 算法/ 在/ Δ/ t/ 时间/ 内/ 节省/ 的/ 能量/ 为/ Esave/ _/ Δ/ t/ =/ ∫/ t/ +/ Δ/ t/ (/ t/ ∑/ zk/ =/ 1/ ∑/ r6/ 评价/ 与/ 比较/ 基于/ 第/ 5/ 节/ 所述/ 数学/ 分析模型/ ,/ 本文/ 使用/ MatlabCloudsim/ [/ 37/ ]/ 对/ 本文/ 算法/ 进行/ 模拟/ 分析/ ,/ 通过/ 实验/ 评价/ 与/ 比较/ ,/ 验证/ 数据/ 块/ 的/ 可用性/ 、/ 存储/ 结构/ 配置/ 节能/ 算法/ 与/ 对称/ 数据/ 块/ 存储/ 策略/ 下/ 的/ 节能/ 算法/ 的/ 有效性/ ./ 其中/ Cloudsim/ 模拟/ 产生/ 的/ DataNode/ 节点/ 配置/ 参数/ 如表/ 2/ 所示/ ./ CUP/ (/ cores/ // MIPS/ )/ 6.1/ 数据/ 块/ 可用性/ 实验/ 如图/ 8/ 所示/ 为/ 在/ 不/ 改变/ 数据/ 块/ 原始/ 存储/ 结构/ 前提/ 下/ 不可/ 用/ DataNode/ 节点/ 数/ 与/ HDFS/ 集群/ 数据/ 块/ 可用性/ 之间/ 的/ 关系/ ,/ 其中/ 横轴/ 表示/ 不可/ 用/ 节点/ 的/ 数量/ ,/ 纵轴/ 表示/ 集群/ 中/ 所有/ 数据/ 块/ 可用/ 的/ 概率/ ./ 其/ line1/ 表示/ 集群/ 中/ 节点/ 数/ k/ =/ 100/ ,/ 副本/ 系数/ m/ =/ 3/ ,/ 集群/ 中原/ 数据/ 块/ 个数/ 为/ 10000/ 时/ ,/ 不可/ 用/ 状态/ 的/ 节点/ 数量/ 与/ 整个/ 系统/ 可用性/ 概率/ 之间/ 的/ 关系/ ./ line1/ 与/ line2/ 比较/ ,/ 当/ k/ 与/ n/ 条件/ 相同/ 时/ ,/ 副本/ 系数/ m/ 值越/ 大/ ,/ HDFS/ 集群/ 可用/ 概率/ 越高/ ;/ line2/ 与/ line3/ 比较/ ,/ 当/ m/ 与/ n/ 条件/ 相等/ 时/ ,/ DataNode/ 节点/ 数越/ 大/ ,/ HDFS/ 集群/ 可用/ 概率/ 越高/ ;/ line1/ 与/ line4/ 比较/ ,/ 当/ m/ 与/ k/ 条件/ 相等/ 时/ ,/ n/ 越小/ ,/ HDFS/ 集群/ 可用/ 概率/ 越高/ ./ 但是/ 无论/ HDFS/ 集群/ 有/ 多少/ DataNode/ 节点/ ,/ 其中/ 有/ 多少/ 原始数据/ 块/ ,/ 当/ 集群/ 中/ 不可/ 用/ 的/ 节点/ 数/ 大于/ 等于/ 副本/ 系数/ m/ 时/ ,/ 都/ 有/ 可能/ 引起/ 数据/ 块/ 的/ 不可/ 用/ ,/ 意味着/ 在/ 不/ 改变/ 数据/ 块/ 存储/ 结构/ 与/ 存储/ 策略/ 的/ 情况/ 下/ 并/ 不能/ 通过/ 休眠/ 节点/ 达到/ 节能/ 的/ 目的/ ./ 图/ 8/ 不可/ 用/ 节点/ 数/ 与/ 集群/ 可用性/ 之间/ 的/ 关系/ 6.2/ 存储/ 结构/ 配置/ 节能/ 算法/ 通过/ 第/ 5/ 节/ 的/ 数学/ 建模/ 分析/ ,/ 数据/ 块/ 存储/ 结构/ 配置/ 节能/ 算法/ 通过/ 休眠/ Sleep/ -/ Zone/ 区域/ 的/ DataN/ -/ ode/ 节点/ 达到/ 节能/ 的/ 目的/ ,/ 节能/ 效率/ 由/ Sleep/ -/ Zone/ 中/ 休眠/ 节点/ 数量/ sd/ 与/ 算法/ 执行/ 前后/ 的/ 服务器/ 速率/ s1/ 与/ s2/ 决定/ ./ 而/ sd/ 、/ s1/ 与/ s2/ 三个/ 变量/ 的/ 值/ 又/ 与/ HDFS/ 中/ 数据/ 块/ 的/ 负载/ 、/ 算法/ 执行/ 周期/ T/ 、/ 阈值/ sleepCount/ 与/ activeCount/ 相关/ ./ 利用/ Cloudsim/ 模拟/ 产生/ 10/ 个/ RACK/ 且/ 每个/ RACK/ 中有/ 10/ 个/ DataNode/ 节点/ 即/ k/ =/ 100/ 的/ HDFS/ 集群/ ,/ 数据/ 块/ 副本/ 值/ 随机/ 产生/ m/ =/ random/ [/ 2/ ,/ 5/ ]/ ,/ 原始数据/ 块数/ n/ 取/ 2/ ~/ 10/ 的/ 随机数/ ,/ 初始化/ 10000/ 个/ 文件/ 存储/ 在/ 该/ 集群/ 中/ ./ 为了/ 模拟出/ 文献/ [/ 32/ -/ 33/ ]/ 数据/ 块/ 访问/ 规律/ ,/ 设/ 文件/ 在/ 上/ 传到/ 集群/ 后/ 第/ 1/ 天/ 的/ 访问/ 次数/ 取/ 0/ ~/ 100/ 的/ 随机数/ ,/ 第/ 2/ 天取/ 0/ ~/ 90/ 的/ 随机数/ ,/ 第/ 3/ 天为/ 0/ ~/ 80/ 的/ 随机数/ ,/ 依次/ 类推/ ,/ 10/ 天及/ 以后/ 访问/ 次数/ 取/ 0/ ~/ 10/ 的/ 随机数/ ./ 如图/ 9Page13/ 所示/ 为设/ 算法/ 执行/ 周期/ T/ =/ 1/ 天/ 、/ 阈值/ 参数/ sleep/ -/ Count/ 分别/ 取值/ 5/ 与/ 10/ ,/ 阈值/ 参数/ activeCount/ 分别/ 取值/ 30/ 与/ 50/ 时/ 算法/ 模拟/ 的/ 结果/ ./ 由图/ 9/ 可以/ 看出/ sleepCount/ 取值/ 越小/ ,/ active/ -/ Count/ 取值/ 越大时/ 相同/ 集群/ 与/ 负载/ 条件/ 下/ 产生/ 的/ 休眠/ 节点/ 数越/ 多/ ;/ 即/ 相同/ 条件/ 下/ sleepCount/ 参数/ 越小/ ,/ 节能/ 效率/ 越高/ ,/ sleepCount/ 是/ 平衡/ 数据/ 块/ 访问/ 频率/ 与/ 集群/ 节能/ 效率/ 的/ 参数/ ;/ 而/ activeCount/ 越小/ ,/ 节能/ 效率/ 越低/ ,/ 但/ 同一/ 数据/ 块/ 备份/ 数越/ 多时/ ,/ 数据/ 块/ 响应/ 效率/ 越高/ ,/ 即/ activeCount/ 是/ 平衡/ 数据/ 块/ 响应/ 与/ 节能/ 效率/ 的/ 参数/ ./ 不同/ 的/ HDFS/ 集群/ 具有/ 不同/ 的/ 负载/ 情况/ 与/ 用户/ QoS/ 协议/ ,/ 应/ 根据/ 实际/ 的/ 情况/ 设定/ 算法/ 执行/ 周期/ T/ 、/ 阈值/ 参数/ sleepCount/ 与/ activeCount/ ./ 当/ 集群/ 中/ 所有/ 数据/ 块/ 与其/ 副本/ 中/ 只有/ 一个/ 数据/ 块/ 存储/ 在/ Active/ -/ Zone/ 区域/ 中/ 时/ ,/ 休眠/ 节点/ 数量/ 达到/ 最大/ ,/ 此时/ 休眠/ 节点/ 数量/ 达到/ 珡/ m/ -/ 1/ 示/ 集群/ 中/ 所有/ 文件/ 的/ 平均/ 副本/ 系数/ ;/ 此时/ 节能/ 效率/ 达到/ 最高/ 的/ (/ 1/ -/ 1/ // 珡/ m/ )/ ./ 当/ 空闲/ 功耗/ 参数/ σ/ e/ =/ 100/ ,/ 能耗/ 常数/ μ/ e/ =/ 300/ ,/ 如图/ 10/ 为/ 在/ k/ =/ 100/ 的/ HDFS/ 集群/ 中/ 不同/ 休眠/ 节点/ 图/ 10/ 不同/ 休眠/ 节点/ 与/ a/ 值下/ 集群/ 功耗/ 与/ 平均/ 负载/ 之间/ 的/ 关系/ 数量/ 与/ 常数/ a/ 取/ 不同/ 值时/ 集群/ 功耗/ 与/ 集群/ 平均/ 负载/ 的/ 关系/ 示意图/ ./ 如图/ 10/ 可以/ 看出/ ,/ 相同/ 集群/ 平均/ 负载/ 率/ 条件/ 下/ ,/ 休眠/ 节点/ 数越/ 大/ ,/ 集群/ 功耗/ 越小/ ;/ 相同/ 集群/ 休眠/ 节点/ 数/ 与/ 集群/ 平均/ 负载/ 条件/ 下/ ,/ 常数/ a/ 值越/ 小/ ,/ 集群/ 功耗/ 越小/ ./ 由此可见/ 存储/ 结构/ 配置/ 节能/ 算法/ 不仅/ 能够/ 通过/ 增加/ 休眠/ 节点/ 数来/ 提高/ 节能/ 效率/ ,/ 也/ 可以/ 通过/ 选取/ 常数/ a/ 值较/ 小/ 的/ 系统/ 硬件/ 来/ 提高/ 系统/ 节能/ 效率/ ./ 6.3/ 对称/ 数据/ 块/ 存储/ 策略/ 下/ 的/ 节能/ 算法/ 利用/ Cloudsim/ 模拟/ 产生/ 的/ m/ =/ 3/ ,/ r/ =/ 10/ 的/ DataNode/ 节点/ 犆/ 10/ ×/ 3/ 组/ (/ 节点/ 配置/ 如表/ 2/ 所示/ )/ ,/ 为了/ 测试/ 不同/ 负载/ 情况/ 下/ 节能/ 算法/ 的/ 效率/ ,/ 分别/ 向/ 该/ 集群/ 在/ 限定/ 范围/ 内/ 施加/ 低/ 负载/ 、/ 随机/ 负载/ 与/ 高/ 负载/ 3/ 种/ 情况/ ./ 表/ 3/ 为/ 3/ 种/ 不同/ 负载/ 情况/ 下/ 节能/ 算法/ 执行/ 前后/ 节点/ 负载/ 比较/ ,/ 其中/ 低/ 负载/ 初始/ 平均/ 负载/ 为/ 0.1403/ ,/ 节能/ 算法/ 执行/ 后/ 平均/ 负载/ 为/ 0.1453/ ;/ 随机/ 负载/ 初始/ 平均/ 负载/ 为/ 0.4442/ ,/ 节能/ 算法/ 执行/ 后/ 平均/ 负载/ 为/ 0.4473/ ;/ 高/ 负载/ 初始/ 平均/ 负载/ 为/ 0.7083/ ,/ 节能/ 算法/ 执行/ 后/ 平均/ 负载/ 为/ 0.7093/ ./ 犇/ 犖/ r/ ×/ m/ 低/ 负载/ 算法/ dn110/ ./ 160.210/ ./ 220.540/ ./ 590.59/ dn120/ ./ 190.160/ ./ 720.670/ ./ 450.65/ dn130/ ./ 120.320/ ./ 620.480/ ./ 870.87/ dn210/ ./ 290.210/ ./ 920.510/ ./ 690.69/ dn220/ ./ 0200.130/ ./ 690.920/ ./ 92dn230/ ./ 320.220/ ./ 0600.880/ ./ 78dn310/ ./ 0700.440/ ./ 550.760/ ./ 76dn320/ ./ 170.260/ ./ 570.340/ ./ 080dn330/ ./ 150.180/ ./ 0800.750/ ./ 75dn410/ ./ 310.220/ ./ 310.880/ ./ 970.97/ dn420/ ./ 0400.570/ ./ 420.930/ ./ 63dn430/ ./ 250.210/ ./ 910.360/ ./ 770.77/ dn510/ ./ 0100.360/ ./ 430.650/ ./ 65dn520/ ./ 0200.280/ ./ 220.640/ ./ 64dn530/ ./ 130.240/ ./ 240.380/ ./ 880.88/ dn610/ ./ 210.280/ ./ 0900.620/ ./ 62dn620/ ./ 0700.590/ ./ 780.840/ ./ 54dn630/ ./ 170.340/ ./ 770.660/ ./ 330.63/ dn710/ ./ 0600.890/ ./ 860.810/ ./ 81dn720/ ./ 150.190/ ./ 460.530/ ./ 890.89/ dn730/ ./ 250.320/ ./ 130.340/ ./ 740.74/ dn810/ ./ 0300.140/ ./ 080.990/ ./ 99dn820/ ./ 230.160/ ./ 610.350/ ./ 810.81/ dn830/ ./ 120.080/ ./ 230.410/ ./ 360.46/ dn910/ ./ 120.120/ ./ 650.680/ ./ 530.53/ dn920/ ./ 0600.0700/ ./ 860.86/ dn930/ ./ 290.250/ ./ 610.780/ ./ 380.48/ dn10/ _/ 10.0300/ ./ 940.650/ ./ 520.62/ dn10/ _/ 20.160/ ./ 390.020/ ./ 450.980/ ./ 98dn10/ _/ 30.0100/ ./ 450.380/ ./ 760.77/ 平均/ 负载/ 0.14030/ ./ 14530.44420/ ./ 44730.70830/ ./ 7093Page14/ 如图/ 11/ 表示/ 低/ 负载/ 状态/ 下/ 节能/ 算法/ 执行/ 前后/ 负载/ 对比/ ,/ 在/ 平均/ 负载/ 为/ 0.1403/ 的/ 情况/ 下/ ,/ 节能/ 算法/ 执行/ 后/ 将/ 编号/ 为/ dn22/ 、/ dn31/ 、/ dn42/ 、/ dn51/ 、/ dn52/ 、/ dn62/ 、/ dn71/ 、/ dn81/ 、/ dn92/ 、/ dn10/ _/ 1/ 、/ dn10/ _/ 3/ 共/ 11/ 个/ 节点/ 都/ 进行/ 了/ 休眠/ 处理/ ,/ 休眠/ 率为/ 37/ %/ ,/ 并且/ 节能/ 算法/ 执行/ 后/ 平均/ 负载/ 变为/ 0.1453/ ./ 如图/ 12/ 表示/ 随机/ 负载/ 状态/ 下/ 节能/ 算法/ 执行/ 前后/ 负载/ 对比/ ,/ 在/ 平均/ 负载/ 为/ 0.4442/ 的/ 情况/ 下/ ,/ 节能/ 算法/ 执行/ 后/ 将/ 编号/ 为/ dn23/ 、/ dn33/ 、/ 图/ 11/ 低/ 负载/ 状态/ 下/ 节能/ 算法/ 执行/ 前后/ 负载/ 对比/ 图/ 12/ 随机/ 负载/ 状态/ 下/ 节能/ 算法/ 执行/ 前后/ 负载/ 对比/ 当/ 空闲/ 功耗/ σ/ e/ 取值/ 100/ ,/ 常数/ μ/ e/ 与/ a/ 分别/ 取值/ 70/ 与/ 1.5/ 时/ ,/ 低/ 负载/ 、/ 随机/ 负载/ 与/ 高/ 负载/ 3/ 种/ 负载/ 状态/ 功耗/ 如图/ 14/ 所示/ ./ 其中/ 图/ 14/ (/ a/ )/ 表示/ 低/ 负载/ 状态/ 下/ 节能/ 算法/ 执行/ 前后/ 节点/ 的/ 功耗/ ;/ 图/ 14/ (/ b/ )/ 表示/ dn61/ 、/ dn92/ 这/ 4/ 个/ 节点/ 进行/ 了/ 休眠/ 处理/ ,/ 休眠/ 率为/ 13.3/ %/ ./ 节能/ 算法/ 执行/ 后/ 平均/ 负载/ 相比/ 之前/ 变为/ 0.4473/ ,/ 平均/ 负载/ 在/ 节能/ 算法/ 的/ 执行/ 前后/ 变化/ 不大/ ./ 如图/ 13/ 为/ 高/ 负载/ 状态/ 下/ 节能/ 算法/ 执行/ 前后/ 负载/ 对比/ ,/ 在/ 平均/ 负载/ 为/ 0.7083/ 的/ 情况/ 下/ ,/ 节能/ 算法/ 执行/ 后/ 将/ 编号/ 为/ dn32/ 的/ 唯一/ 节点/ 进行/ 了/ 休眠/ 处理/ ,/ 休眠/ 率为/ 3.3/ %/ ./ 节能/ 算法/ 执行/ 后/ 平均/ 负载/ 相比/ 之前/ 变为/ 0.7093/ ./ 随机/ 负载/ 状态/ 下/ 节能/ 算法/ 执行/ 前后/ 节点/ 的/ 功耗/ ;/ 图/ 14/ (/ c/ )/ 表示/ 高/ 负载/ 状态/ 下/ 节能/ 算法/ 执行/ 前后/ 节点/ 的/ 功耗/ ;/ 图/ 14/ (/ d/ )/ 表示/ 3/ 组/ 负载/ 状态/ 下/ 节能/ 算法/ 执行/ 前后/ 节点/ 的/ 平均/ 功耗/ 对比/ ./ Page15/ 图/ 13/ 高/ 负载/ 状态/ 下/ 节能/ 算法/ 执行/ 前后/ 负载/ 对比/ 图/ 143/ 种/ 负载/ 状态/ 下/ 节能/ 算法/ 执行/ 前后/ DataNode/ 节点/ 功耗/ 对比/ Page16/ 如图/ 14/ 所示/ ,/ 低/ 负载/ 状态/ 下/ DataNode/ 节点/ 平均/ 功耗/ 在/ 节能/ 算法/ 执行/ 后/ 由/ 120.81/ 转化/ 为/ 80.54/ ,/ 功耗/ 节省/ 率为/ 33.3/ %/ ;/ 随机/ 负载/ 状态/ 下/ DataNode/ 节点/ 平均/ 功耗/ 在/ 节能/ 算法/ 执行/ 后/ 由/ 146.71/ 转化/ 为/ 132.35/ ,/ 功耗/ 节省/ 率为/ 9.8/ %/ ;/ 高/ 负载/ 状态/ 下/ Data/ -/ Node/ 节点/ 平均/ 功耗/ 在/ 节能/ 算法/ 执行/ 后/ 由/ 172.19/ 转化/ 为/ 168.33/ ,/ 功耗/ 节省/ 率为/ 2.2/ %/ ./ 由此可见/ 功耗/ 节省/ 率/ 与/ HDFS/ 集群/ 负载/ 状态/ 相关/ ,/ HDFS/ 集群/ 平均/ 负载/ 越低/ ,/ 功耗/ 节省/ 率越/ 高/ ;/ 相反/ ,/ HDFS/ 集群/ 平均/ 负载/ 越高/ ,/ 功耗/ 节省/ 率越/ 低/ ./ 除此之外/ ,/ 同一/ 集群/ 在/ 相同/ 平均/ 负载/ 率下/ ,/ 功耗/ 节省/ 率/ 还/ 受到/ 节点/ 不同/ 负载/ 率/ 分布/ 的/ 影响/ ,/ 节点/ 负载/ 率/ 分布/ 越/ 均匀/ ,/ 功耗/ 节省/ 率越/ 低/ ,/ 相反/ 则/ 越/ 高/ ./ 在/ 副本/ 系数/ 为/ m/ 的/ DataNode/ 节点/ 组中/ ,/ 当/ 所有/ 行中/ 有/ m/ -/ 1/ 个/ DataN/ -/ ode/ 节点/ 处于/ 休眠状态/ 时/ 功耗/ 最低/ ./ 但是/ 由于/ 任务/ 的/ 转移/ 与/ 替换/ 会/ 加大/ 目标/ 节点/ 的/ 负载/ ,/ 即/ 提高/ 了/ 该/ 节点/ 的/ 功耗/ ,/ 所以/ 每组/ 的/ 最大/ 功耗/ 节省/ 率/ 不会/ 超过/ (/ 1/ -/ 1/ // m/ )/ ./ 7/ 结论/ 及下/ 一步/ 工作/ 由于/ 传统/ IT/ 系统/ 超额/ 的/ 资源/ 供给/ 与/ 冗余/ 设计/ 以及/ 负载/ 均衡/ 算法/ 对/ 能耗/ 因素/ 的/ 忽略/ 导致/ 了/ 高能耗/ 低效率/ 问题/ 的/ 日益突出/ ./ 在/ HDFS/ 集群/ 节能/ 问题/ 上/ ,/ 由于/ 存在/ 数据/ 块/ 可用性/ 的/ 要求/ ,/ 使得/ HDFS/ 并/ 不能/ 简单/ 地/ 采用/ 传统/ 数据中心/ 合并/ 任务/ 与/ 休眠/ 空闲/ 节点/ 的/ 方法/ 解决/ 能耗/ 问题/ ,/ 保证数据/ 块/ 的/ 可用性/ 成为/ 设计/ HDFS/ 集群/ 下/ 节能/ 算法/ 的/ 前提/ ./ 本文/ 通过/ 研究/ HDFS/ 集群/ 结构/ 、/ 节点/ 与/ 数据/ 块/ 状态/ 与/ 数据/ 块/ 存储/ 机制/ 建立/ 了/ DataNode/ 节点/ 矩阵/ 、/ 节点/ 状态/ 矩阵/ 、/ 文件/ 分块/ 矩阵/ 、/ 数据/ 块/ 存储/ 矩阵/ 与/ 数据/ 块/ 状态/ 矩阵/ ,/ 为/ 研究/ 数据/ 块/ 可用性/ 、/ 节能/ 算法/ 等/ 提供/ 了/ 基础/ 模型/ ./ 利用/ 数据/ 块/ 状态/ 矩阵/ 与/ 数据/ 块/ 可用性/ 之间/ 的/ 关系/ 设计/ 了/ DataNode/ 节点/ 休眠/ 验证/ 算法/ ,/ 算法/ 能够/ 确认/ DataNode/ 节点/ 的/ 休眠/ 是否/ 对/ 数据/ 块/ 的/ 可用性/ 造成/ 影响/ ./ 通过/ 文件/ 可用性/ 概率分析/ 与/ 证明/ 得出/ 在/ 不/ 改变/ 数据/ 块/ 存储/ 结构/ 与/ 存储/ 策略/ 的/ 情况/ 下/ 并/ 不能/ 通过/ 休眠/ DataNode/ 节点/ 达到/ 节能/ 的/ 目的/ ./ 所以/ 本文/ 分别/ 从/ 改变/ 数据/ 块/ 的/ 存储/ 结构/ 与/ 存储/ 策略/ 两/ 方面/ 着手/ 对/ HDFS/ 进行/ 节能/ 改进/ ./ 设计/ 了/ 数据/ 块/ 存储/ 结构/ 配置/ 节能/ 算法/ 与/ RACK/ 区域/ 划分算法/ ,/ 将/ 处于/ Sleep/ -/ Zone/ 区域/ 的/ 节点/ 休眠/ 从而/ 达到/ 节能/ 的/ 目的/ ./ 设计/ 了/ 对称/ 数据/ 块/ 存储/ 策略/ ,/ 解决/ 了/ 节点/ 休眠/ 对/ 数据/ 块/ 可用性/ 的/ 影响/ 问题/ ,/ 对称/ 数据/ 块/ 存储/ 策略/ 下/ 的/ 节能/ 算法/ 将/ 任务/ 转移/ 与/ 替换/ 产生/ 的/ 空闲/ 节点/ 休眠/ ,/ 从而/ 达到/ 节能/ 的/ 目的/ ./ 通过/ 实验/ 表明/ 两种/ 节能/ 算法/ 都/ 能/ 解决/ HDFS/ 集群/ 的/ 能耗/ 低/ 利用率/ 问题/ ,/ 并且/ 集群/ 负载/ 越低/ 算法/ 节能/ 效率/ 越高/ ./ 下/ 一步/ 工作/ 主要/ 集中/ 在/ 以下/ 3/ 个/ 方面/ :/ (/ 1/ )/ 节能/ 算法/ 参数/ 的/ 优化/ 问题/ ./ 由于/ 不用/ 的/ HDFS/ 集群/ 在/ 负载/ 、/ 应用/ 特点/ 等/ 方面/ 存在/ 很大/ 的/ 差异/ ,/ 需要/ 探寻/ 不同/ 环境/ 下/ 节能/ 算法/ 参数/ 的/ 优化/ 方法/ ./ (/ 2/ )/ 分布式文件系统/ 在/ 数据/ 可用性/ 、/ 性能/ 、/ 能耗/ 之间/ 存在/ 相互/ 联系/ 与/ 制约/ 的/ 关系/ ,/ 如何/ 在/ 这/ 三者/ 之间/ 找到/ 合理/ 的/ 平衡点/ 是/ 将来/ 研究/ 的/ 一个/ 方向/ ./ (/ 3/ )/ 分布式文件系统/ 节能/ 的/ 标准化/ 问题/ ./ 分布式文件系统/ 在/ 节能/ 方面/ 并/ 没有/ 统一/ 的/ 标准/ 与/ 模型/ ,/ 制定/ 统一/ 的/ 节能/ 标准/ 与/ 模型/ 是/ 将来/ 研究/ 的/ 另/ 一个/ 方向/ ./ 

