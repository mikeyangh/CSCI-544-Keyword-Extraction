Page1/ 不/ 一致/ 数据/ 上/ 查询/ 结果/ 的/ 一致性/ 估计/ 刘雪莉/ 李建中/ (/ 哈尔滨工业大学/ 计算机科学/ 与/ 技术/ 学院/ 哈尔滨/ 150001/ )/ 摘要/ 主键/ 约束/ 是/ 描述/ 关系数据/ 一致性/ 的/ 常用/ 方法/ ,/ 基于/ 主键/ 约束/ 的/ 数据/ 一致性/ 修复/ 返回/ 一个/ 极大/ 子集/ ,/ 子/ 集中/ 不同/ 数据/ 的/ 主键/ 不同/ ./ 对于/ 合取/ 查询/ Q/ ,/ 一致性/ 合取/ 查询/ 返回/ 一个/ 答案/ 集合/ ,/ 答案/ 集合/ 是/ Q/ 在/ 数据/ 集合/ I/ 的/ 每/ 一个/ 修复/ 下/ 查询/ 结果/ 的/ 交集/ ./ 文中/ 将/ Q/ 在/ I/ 中/ 的/ 查询/ 结果/ 满足/ 一致性/ 的/ 个数/ 占/ 总/ 的/ 结果/ 个数/ 的/ 比例/ 定义/ 为/ 查询/ 结果/ 的/ 一致性/ 程度/ ./ 若/ Q/ 不可/ 一阶/ 表达/ 且/ 不能/ 在/ 多项式/ 时间/ 内/ 得到/ 其/ 一致性/ 解/ ,/ 则/ 当/ Q/ 答案/ 个数/ 超过/ 30/ 时/ ,/ 使用/ 抽样/ 的/ 方法/ 给/ 答案/ 集合/ 一致性/ 程度/ 的/ 一个/ (/ ε/ ,/ δ/ )/ -/ 估计/ ./ 由于/ 布尔/ 合取/ 查询/ 的/ 一致性/ 判定/ 问题/ 是/ coNP/ -/ 完全/ 问题/ ,/ 因此/ 在/ 估计/ 过程/ 中/ ,/ 使用/ 攻击/ 图/ ,/ 通过/ 攻击/ 图对/ 布尔/ 查询/ q/ 进行/ 改写/ 近似/ 判断/ q/ 近似/ 一致性/ 回答/ ./ 实验/ 表明/ 了/ 估计/ 算法/ 和/ 近似/ 判定/ 算法/ 具有/ 较/ 高/ 的/ 效率/ 和/ 准确率/ ./ 关键词/ 主键/ 约束/ ;/ 一致性/ 查询/ ;/ 合取/ 查询/ ;/ 近似/ 一致性/ 1/ 引言/ 近年来/ ,/ 数据/ 质量/ 问题/ 引起/ 了/ 人们/ 的/ 高度重视/ ./ 数据/ 质量/ 是/ 数据分析/ 结论/ 有效性/ 和/ 准确性/ 的/ 基础/ ,/ Page2/ 国/ 银行业/ ,/ 由于/ 信息/ 的/ 不一致性/ 导致/ 的/ 失察/ 信用卡/ 欺诈/ 在/ 2006/ 年/ 大约/ 造成/ 了/ 48/ 亿美元/ 的/ 损失/ ;/ 而/ 在/ 数据仓库/ 项目/ 的/ 开发/ 过程/ 中/ ,/ 数据/ 清洗/ 通常/ 需要/ 花费/ 30/ %/ ~/ 80/ %/ 的/ 开发/ 时间/ 和/ 开发/ 预算/ ①/ ./ 数据/ 的/ 一致性/ 是/ 指/ 数据/ 集合/ 中/ 不/ 包含/ 语义/ 错误/ 或/ 相互/ 矛盾/ 的/ 数据/ [/ 1/ ]/ ./ 例如/ ,/ 数据/ (/ 国码/ =/ “/ 86/ ”/ ,/ 区/ 号/ =/ “/ 10/ ”/ ,/ 城市/ =/ “/ 上海/ ”/ )/ 含有/ 语义/ 错误/ ,/ 因为/ 10/ 是/ 北京/ 区/ 号/ 而/ 非/ 上海/ 区/ 号/ ./ 目前/ 关于/ 数据/ 不一致性/ 的/ 研究/ 主要/ 从/ 两个/ 方面/ 着手/ :/ (/ 1/ )/ 不/ 一致/ 数据/ 的/ 检测/ 和/ 修复/ ;/ (/ 2/ )/ 不/ 一致/ 数据/ 上/ 的/ 一致性/ 查询/ ./ 不/ 一致/ 数据/ 的/ 检测/ 方面/ ,/ 基本/ 方法/ 是/ 建立/ 一组/ 一致性/ 质量/ 规则/ ,/ 若/ 数据/ 集合/ 中/ 存在/ 着/ 不/ 一致/ 信息/ ,/ 则/ 不/ 一致/ 信息/ 将会/ 违背/ 相应/ 的/ 规则/ 从而/ 被/ 检测/ 出来/ ./ 数据/ 修复/ 是/ 通过/ 尽可能少/ 的/ 修改/ 数据/ ,/ 使得/ 数据/ 集合/ 满足/ 一致性/ 规则/ 集合/ ./ 然而/ ,/ 数据/ 修复/ 存在/ 着/ 一些/ 问题/ :/ 首先/ ,/ 删除/ 不/ 一致/ 数据/ 可能/ 会/ 造成/ 有用/ 信息/ 的/ 缺失/ ;/ 其次/ ,/ 并/ 不能/ 保证/ 修复/ 之后/ 的/ 数据/ 一定/ 是/ 正确/ 的/ ,/ 存在/ 着/ 将/ 正确/ 数据/ 修复/ 为/ 错误/ 数据/ 的/ 可能性/ ./ 基于/ 此/ ,/ 文献/ [/ 2/ ]/ 提出/ 了/ 一致性/ 查询/ 问题/ ./ 一致性/ 查询处理/ 是/ 指/ 回答/ 用户/ 查询/ 时仅/ 使用/ 不/ 含/ 错误/ 的/ 信息/ ./ 文献/ [/ 2/ ]/ 中/ 使用/ 数据/ 修复/ 来/ 定义/ 一致性/ 查询/ 结果/ ,/ 对于/ 一个/ 主键/ 约束/ 的/ 数据/ 集/ ,/ 它/ 的/ 一个/ 修复/ 可以/ 通过/ 从/ 数据/ 集中/ 挑选出/ 任意/ 两个/ 主键/ 都/ 不/ 相同/ 的/ 极大/ 子集/ 得到/ ./ 显然/ ,/ 一个/ 不/ 一致/ 的/ 数据/ 集合/ 可能/ 有/ 多种/ 修复/ ./ 一致性/ 查询/ 结果/ 指/ 的/ 是/ 查询/ 结果/ 中/ 的/ 每/ 一条/ 记录/ 都/ 出现/ 在/ 对/ 所有/ 的/ 修复/ 进行/ 查询/ 的/ 结果/ 中/ ./ 然而/ ,/ 数据/ 的/ 所有/ 修复/ 具有/ 指数/ 级/ 可能/ 空间/ ,/ 即使/ 只/ 考虑/ 主键/ 约束/ ,/ 一致性/ 查询/ 也/ 是/ coNP/ -/ 完全/ 问题/ ./ 更/ 重要/ 的/ 是/ ,/ 不/ 一致/ 的/ 数据/ 中/ 也/ 可能/ 包含/ 着/ 用户/ 需求/ 的/ 信息/ ,/ 只/ 返回/ 一致性/ 的/ 查询/ 结果/ 丢失/ 了/ 查询/ 相关/ 的/ 有/ 价值/ 数据/ ,/ 返回/ 的/ 结果/ 可能/ 并/ 不能/ 满足用户/ 的/ 需求/ ,/ 但是/ 返回/ 全部/ 结果/ 又/ 使/ 用户/ 对/ 查询/ 的/ 准确度/ 没有/ 了解/ ,/ 从而/ 造成/ 错误/ 的/ 认知/ ,/ 甚至/ 做出/ 错误/ 的/ 决策/ ./ 因此/ ,/ 本文/ 考虑/ ,/ 返回/ 所有/ 的/ 查询/ 结果/ ,/ 并/ 给定/ 查询/ 结果/ 的/ 一个/ 一致性/ 估计/ ,/ 使得/ 用户/ 获得/ 查询/ 结果/ 的/ 一致性/ 程度/ ,/ 了解/ 查询/ 结果/ 的/ 总体/ 特征/ ./ 本文/ 只/ 考虑/ 主键/ 约束/ 下/ 不/ 一致/ 数据/ 集/ 查询/ 结果/ 的/ 一致性/ 估计/ ./ 例/ 1/ ./ 关系/ 表/ nba/ (/ Player/ ,/ Season/ ,/ Age/ ,/ Tm/ ,/ Lg/ ,/ PTs/ )/ 描述/ 了/ 球员/ 参加/ NBA/ 比赛/ 的/ 基本/ 信息/ ,/ 如表/ 1/ 所示/ ./ 其中/ Player/ 表示/ 球员/ 的/ 名字/ ,/ Season/ ,/ Age/ ,/ Tm/ ,/ Lg/ ,/ PTs/ 分别/ 描述/ 了/ NBA/ 赛季/ ,/ 年龄/ ,/ 所属/ 球队/ ,/ 联赛/ ,/ 总/ 的/ 得分/ 信息/ ./ Player/ ,/ Season/ 下/ 的/ 下划线/ 表示/ Player/ ,/ Season/ 是/ nba/ 表/ 的/ 主键/ ./ 假设/ 查询/ q/ (/ x/ ,/ t/ )/ =/ nba/ (/ x/ ,/ y/ ,/ z/ ,/ t/ ,/ l/ ,/ g/ )/ ,/ 由/ 一致性/ 查询/ 的/ 定义/ ,/ 若/ 用户/ 只/ 返回/ 一致性/ 的/ 查询/ 答案/ ,/ 则/ 查询/ 的/ 一致性/ 答案/ 集合/ 为/ {/ (/ QuincyAcy/ ,/ TOR/ )/ ,/ (/ JeffAdrien/ ,/ CHA/ )/ }/ ./ PlayerQuincyAcy2013/ -/ 14JeffAdrien2013/ -/ 14JeffAdrien2013/ -/ 14ColeAldrich2013/ -/ 14ColeAldrich2013/ -/ 14/ 显然/ ,/ 答案/ 集合/ 漏掉/ 了/ ColeAldrich/ 的/ 信息/ ,/ 这/ 可能/ 是/ 用户/ 想要/ 获得/ 的/ ./ 为了/ 尽可能/ 全面/ 回答/ 用户/ 的/ 查询/ ,/ 本文/ 返回/ 所有/ 的/ 查询/ 答案/ ,/ 同时/ 给出/ 查询/ 答案/ 的/ 一致性/ 准确/ 程度/ 给/ 用户/ 以/ 指导/ ,/ 使得/ 用户/ 对/ 查询/ 的/ 可靠性/ 有/ 一个/ 大致/ 的/ 了解/ ./ 在/ 此次/ 查询/ 中/ ,/ (/ ColeAldrich/ ,/ NYK/ )/ 和/ (/ ColeAldrich/ ,/ TOT/ )/ 是/ 不/ 一致/ 的/ ./ 一致性/ 回答/ 个数/ 为/ 2/ ,/ 总/ 的/ 回答/ 个数/ 为/ 4/ ,/ 若/ 将/ 一致性/ 准确率/ 定义/ 为/ 一致性/ 回答/ 的/ 个数/ 占/ 总/ 回答/ 个数/ 的/ 比例/ ,/ 则/ 一致性/ 准确率/ 从/ 为/ 2/ // 4/ =/ 1/ // 2/ ./ 用户/ 可以/ 根据/ 一致性/ 准确率/ 信息/ 判断/ 查询/ 信息/ 的/ 可用性/ ./ 从例/ 1/ 中/ 可以/ 看出/ ,/ 为了/ 估计/ 查询/ 结果/ 的/ 一致性/ 程度/ ,/ 需要/ 确定/ 答案/ 集合/ 中/ 的/ 每条/ 元组/ 的/ 一致性/ ./ 此/ 问题/ 可以/ 形式化/ 定义/ 为/ CERTAINTY/ (/ q/ )/ 问题/ ,/ 即/ CERTAINTY/ (/ q/ )/ =/ {/ I/ |/ 对于/ 数据/ 集/ I/ 的/ 每/ 一个/ 修复/ ,/ 之前/ 的/ 研究/ [/ 3/ ]/ 指出/ 此/ 问题/ 的/ 复杂度/ 上界/ 为/ coNP/ -/ 完全/ ,/ 当/ q/ 是/ 一阶可/ 表达/ 时/ ,/ 复杂度/ 降为/ 一阶/ 查询/ 的/ 复杂度/ AC0/ ./ q/ 是/ 一阶可/ 表达/ 的/ 是/ 指/ q/ 可以/ 经过/ 一阶/ 改写/ 得到/ 一个/ 一阶/ 查询/ q/ ,/ q/ 返回/ 所有/ 修复/ 下/ 满足/ q/ 的/ 答案/ 集合/ ,/ 即/ q/ 的/ 一致性/ 答案/ 集合/ ./ q/ 可以/ 改写/ 成/ SQL/ 语句/ 直接/ 对/ 关系数据/ 集/ 进行/ 查询/ ,/ 也就是说/ ,/ 可以/ 在/ 多项式/ 时间/ 内/ 得到/ 查询/ 的/ 一致性/ 结果/ ,/ 这/ 使得/ 一阶/ 表达/ 在/ 一致性/ 查询/ 中/ 有着/ 重要/ 的/ 作用/ ./ 然而/ ,/ 目前/ 并/ 没有/ 一个/ 可一阶/ 表达/ 与/ 一致性/ 查询/ 判定/ 易解/ 的/ 一个/ 充要条件/ ./ 因此/ ,/ 针对/ 不可/ 一阶/ 表达/ 的/ 查询/ ,/ 本文/ 引入/ 了/ 近似/ 一致性/ 的/ 概念/ ./ 本文/ 的/ 主要/ 贡献/ 如下/ :/ (/ 1/ )/ 定义/ 了/ 查询/ 结果/ 的/ 一致性/ 程度/ 估计/ ,/ 当/ 查询/ 不可/ 一阶/ 改写/ 时/ ,/ 使用/ 抽样/ 的/ 方法/ 给出/ 了/ 一致性/ 程度/ 的/ 一个/ (/ ε/ ,/ δ/ )/ -/ 估计/ ./ ①/ WoolseyB/ ,/ SchulzM/ ./ Creditcardstatistics/ ,/ industryPage3/ (/ 2/ )/ 对于/ 不可/ 一阶/ 改写/ 的/ 查询/ ,/ 定义/ 了/ 新/ 的/ 查询/ 改写/ qrelax/ ,/ 设计/ 判定/ 算法/ 使用/ qrelax/ 的/ 中间/ 结果/ 近似/ 判定/ 查询/ 回答/ 中/ 元组/ t/ 的/ 一致性/ ./ (/ 3/ )/ 当/ 合取/ 查询/ 中/ 出现/ 环/ 以及/ 自/ 连接/ 时/ ,/ 定义/ 了/ 查询/ 改写/ qacylic/ 和/ qsjf/ ,/ 用来/ 判定/ 其/ 回答/ 的/ 近似/ 一致性/ ./ (/ 4/ )/ 实验/ 验证/ 了/ 估计/ 和/ 近似/ 判定/ 算法/ 的/ 效率/ 以及/ 准确率/ ./ 本文/ 第/ 1/ 节/ 描述/ 问题/ 的/ 背景/ 和/ 意义/ ;/ 第/ 2/ 节/ 介绍/ 相关/ 工作/ ;/ 第/ 3/ 节/ 给出/ 背景/ 知识/ 介绍/ ;/ 第/ 4/ 节/ 提出/ 不可/ 一阶/ 改写/ 查询/ 答案/ 一致性/ 程度/ 的/ (/ ε/ ,/ δ/ )/ -/ 估计/ 算法/ ;/ 第/ 5/ 节/ 介绍/ 不可/ 一阶/ 改写/ 查询/ 的/ 近似/ 一致性/ 判定/ 方法/ ;/ 第/ 6/ 节/ 使用/ 实验/ 验证/ 估计/ 算法/ 的/ 效率/ 和/ 准确性/ 以及/ 近似/ 判定/ 算法/ 的/ 效率/ 和/ 准确率/ ;/ 第/ 7/ 节/ 总结/ 全文/ 以及/ 提出/ 未来/ 工作/ ./ 2/ 相关/ 工作/ 针对/ 数据/ 不/ 一致/ 问题/ ,/ 目前/ 的/ 处理/ 方法/ 主要/ 有/ 两种/ ./ 一种/ 是/ 建立/ 描述/ 一致性/ 的/ 相关/ 规则/ ,/ 一旦/ 数据/ 集合/ 中/ 数据/ 集/ 违反/ 了/ 规则/ ,/ 则/ 对/ 数据/ 进行/ 修复/ 使/ 其/ 处于/ 一致/ 的/ 状态/ ./ 近年来/ 随着/ 数据/ 质量/ 越来越/ 引起/ 人们/ 的/ 重视/ ,/ 越来越/ 多/ 的/ 规则/ 被/ 提出/ 用来/ 描述/ 数据/ 的/ 一致性/ ./ 主要/ 有/ 以下/ 几种/ :/ 否定/ 约束/ [/ 4/ ]/ 、/ 包含/ 依赖/ [/ 5/ ]/ 、/ 外键/ 约束/ 和/ 函数/ 依赖/ [/ 6/ ]/ 、/ 聚集/ 约束/ [/ 7/ ]/ 、/ 元组/ 生成/ 和/ 等值/ 生成/ 依赖/ [/ 3/ ]/ ./ 同时/ 有/ 多种/ 修复/ 方式/ ,/ 例如/ :/ 对称/ 差分/ 修复/ [/ 3/ ]/ 、/ 子集/ 修复/ [/ 8/ ]/ 、/ 基数/ 修复/ [/ 9/ ]/ 、/ 基于/ 更新/ 的/ 修复/ [/ 10/ ]/ 、/ 投影/ 连接/ 修复/ [/ 11/ ]/ 等/ ./ 即使/ 检测/ 出/ 不/ 一致/ 数据/ ,/ 也/ 可能/ 没有/ 确定/ 的/ 方法/ 在/ 保证数据/ 真实/ 准确/ 的/ 条件/ 下/ 完全/ 修复/ 不/ 一致/ ./ 基于/ 此/ ,/ 文献/ [/ 12/ ]/ 第一次/ 提出/ 了/ 一致性/ 查询/ 问题/ ,/ 一致性/ 查询/ 问题/ 是/ 指/ 在/ 存在/ 不一致性/ 数据/ 的/ 数据/ 集合/ 中/ ,/ 不/ 完全/ 修复/ 数据/ 情况/ 下/ ,/ 查询/ 得到/ 一致性/ 的/ 查询/ 结果/ ,/ 而/ 查询/ 结果/ 的/ 一致性/ 由/ 不/ 一致/ 数据/ 的/ 可能/ 修复/ 定义/ ./ 文献/ [/ 3/ ]/ 定义/ 了/ 修复/ 语义/ 下/ 的/ 一致性/ 查询/ ,/ 即/ 查询/ 需要/ 满足/ 所有/ 的/ 修复/ ./ 文献/ [/ 13/ ]/ 是/ 数据/ 修复/ 和/ 一致性/ 查询/ 回答/ 的/ 一个/ 综述/ ./ 国内/ 也/ 对/ 一致性/ 查询处理/ 问题/ 有/ 了/ 综述/ 相关/ 的/ 研究/ [/ 14/ ]/ ./ 文献/ [/ 15/ ]/ 研究/ 了/ 基于/ 空值/ 的/ 一致性/ 查询处理/ ,/ 将/ 一致性/ 约束/ 转换/ 为/ 和/ 查询/ 相关/ 的/ 约束/ ,/ 查询/ 过程中将/ 不/ 一致/ 属性/ 作为/ 空值/ 进而/ 返回/ 一致/ 的/ 查询/ 结果/ ,/ 此/ 方法/ 得到/ 的/ 查询/ 结果/ 可能/ 会/ 丢失/ 有用/ 数据/ ./ 目前/ 关于/ 主键/ 约束/ ,/ 子集/ 修复/ 的/ 一致性/ 查询/ 已经/ 有/ 较/ 多/ 的/ 研究成果/ ./ 文献/ [/ 16/ ]/ 提出/ 了/ EQUIP/ 系统/ 解决/ 合取/ 查询/ 的/ 一致性/ 查询/ 问题/ ,/ 其/ 将/ 一致性/ 查询/ 的/ 补/ 问题/ 规约/ 到/ 01/ 整形/ 规划/ 问题/ ,/ 通过/ 求解/ 规划/ 方程/ 去掉/ 不/ 满足/ 一致性/ 的/ 解/ ,/ 最终/ 得到/ 一致性/ 的/ 回答/ ./ 此外/ ,/ 基于/ 析取/ 逻辑程序/ 以及/ 稳定/ 语义/ 模型/ 可以/ 解决/ 任意/ 合取/ 查询/ 的/ 一致性/ 回答/ 问题/ [/ 17/ ]/ ,/ 且/ 一致性/ 限制/ 并/ 不/ 局限于/ 主键/ 约束/ ./ 然而/ 其/ 复杂度/ 为/ Π/ 献/ [/ 18/ -/ 19/ ]/ 首次/ 提出/ 并/ 研究/ 了/ CERTAINTY/ (/ q/ )/ 问题/ ,/ 即/ 布尔/ 查询/ 的/ 一致性/ 判定/ 问题/ ./ 研究/ 一致性/ 查询/ 的/ 一个/ 重要/ 成果/ 是/ 一阶/ 查询/ 改写/ ,/ 一阶/ 查询/ 改写/ 指将/ 初始/ 查询/ 进行/ 一阶/ 改写/ ,/ 使得/ 执行/ 改写/ 之后/ 的/ 查询/ 可以/ 得到/ 原/ 查询/ 在/ 数据/ 集中/ 的/ 一致性/ 查询/ 结果/ ./ 文献/ [/ 18/ -/ 19/ ]/ 定义/ 了/ 一个/ 可以/ 一阶/ 改写/ 的/ 不/ 带/ 自/ 连接/ 的/ 合取/ 查询/ 类/ Cforest/ ,/ 该类/ 中/ 的/ 所有/ 查询/ 均/ 可/ 改写/ 为/ 一阶/ 查询/ ,/ 从而/ 在/ 多项式/ 时间/ 内/ 返回/ 查询/ 的/ 一致性/ 回答/ ./ 同时/ ,/ 他们/ 指出/ 对于/ q/ =/ / x/ / y/ (/ R/ (/ x/ ,/ y/ )/ ∧/ R/ (/ y/ ,/ z/ )/ )/ 不/ 在/ Cforest/ 中/ ,/ 然而/ 其是/ 一阶可/ 表达/ 的/ ./ 文献/ [/ 20/ ]/ 提出/ 了/ 一个/ 包含/ 一阶可/ 表达/ 的/ 查询/ 的/ 更/ 大/ 的/ 类/ ,/ 指出/ 不/ 在/ 该类/ 中/ 的/ 涉及/ 到/ 两个/ 不同/ 关系/ 表/ 进行/ 连接/ 操作/ 的/ 查询/ 一定/ 是/ 不可/ 一阶/ 改写/ 的/ (/ 关系/ 表/ 的/ 个数/ 大于/ 2/ 时/ 没有/ 此/ 结果/ )/ ./ 后来/ 又/ 给出/ 了/ 无/ 环无自/ 连接/ 的/ 合取/ 查询/ 一阶可/ 表达/ 的/ 充分条件/ ,/ 其/ 通过/ 建立/ 攻击/ 图/ ,/ 当/ 攻击/ 图无环时/ 则/ 可/ 得到/ 查询/ 时是/ 一阶可/ 表达/ 的/ ./ 此外/ ,/ 文献/ [/ 21/ ]/ 研究/ 了/ 满足/ 函数/ 依赖/ 的/ 情况/ 下/ 基于/ 主键/ 约束/ 的/ 一致性/ 查询/ 问题/ ,/ 其/ 首先/ 认为/ 数据库/ 是/ 部分/ 一致/ 的/ (/ 满足/ 函数/ 依赖/ )/ ,/ 基于/ 此/ 研究/ 了/ CERTAINTY/ (/ q/ ,/ Σ/ )/ 问题/ ./ 即/ 在/ 满足/ 函数/ 依赖/ 集合/ Σ/ 的/ 情况/ 下/ ,/ q/ 是否是/ 一阶可/ 表达/ 的/ ,/ 此/ 问题/ 限制/ q/ 不带/ 自/ 连接/ ./ 文献/ [/ 22/ -/ 23/ ]/ 研究/ 了/ CERTAINTY/ (/ q/ )/ 的/ 变种/ :/ 计数/ 的/ 复杂性/ 问题/ ,/ 记为/ #/ CERTAINTY/ (/ q/ )/ ./ 给定/ 一个/ 数据/ 集/ db/ ,/ #/ CERTAINTY/ (/ q/ )/ 返回/ 满足/ q/ 的/ db/ 修复/ 的/ 个数/ ,/ 同时/ 指出/ 了/ 对于/ 不带/ 自/ 连接/ 的/ 合取/ 查询/ q/ ,/ #/ CERTAINTY/ (/ q/ )/ 是/ P/ 问题/ 或是/ #/ P/ -/ 完全/ 问题/ ./ 本文/ 的/ 工作/ 和/ 查询/ 一阶/ 改写/ 及/ #/ CERTAINTY/ (/ q/ )/ 问题/ 相关/ ./ 然而/ ,/ 不同于/ 之前/ 的/ 工作/ ,/ 当/ 查询/ 不可/ 进行/ 一阶/ 改写/ 时/ ,/ 本文/ 并/ 不/ 确切/ 地/ 计算/ #/ CERTAINTY/ (/ q/ )/ 的/ 值/ ,/ 因为/ 此/ 问题/ 可能/ 是/ 难解/ 的/ ./ 相应/ 的/ ,/ 给定/ 一个/ 元组/ t/ ,/ 计算/ #/ CERTAINTY/ (/ q/ (/ t/ )/ )/ 的/ 一个/ 下界/ ,/ 当其/ 满足/ 给定/ 的/ 阈值/ 时/ ,/ 近似/ 认为/ t/ 属于/ 一致性/ 回答/ ./ 3/ 背景/ 知识/ 首先/ ,/ 我们/ 在/ 3.1/ 节/ 介绍/ 一致性/ 查询/ 的/ 模型/ ,/ 3.2/ 节/ 给出/ 查询/ 一阶可/ 表达/ 的/ 判定/ 方法/ ./ Page43/ ./ 1/ 一致性/ 查询/ 模型/ 定义/ 1/ ./ 不一致性/ ./ 对于/ 描述/ 一致性/ 的/ 规则/ (/ 约束/ )/ 集合/ Σ/ ,/ 数据/ 集合/ I/ 称为/ 一致/ 的/ ,/ 当且/ 仅/ 当/ 满足/ I/ / Σ/ ,/ 否则/ ,/ I/ 成为/ 不/ 一致/ 数据/ 集/ ./ 定义/ 2/ ./ 修复/ r/ 是/ 不/ 一致/ 数据/ 集/ I/ 关于/ 规则/ 集合/ Σ/ 的/ 一个/ 修复/ 当且/ 仅/ 当/ :/ (/ 1/ )/ r/ / Σ/ ,/ (/ 2/ )/ 不/ 存在/ r/ 满足/ r/ / Σ/ 且/ r/ 的/ 修复/ 代价/ 小于/ r/ ./ 定义/ 3/ ./ 一致性/ 查询/ ./ 给定/ 规则/ 集合/ Σ/ 以及/ 不/ 一致/ 数据/ 集/ I/ ,/ 对/ I/ 的/ 任意/ 查询/ q/ ,/ 其/ 一致性/ 查询/ 结果/ 定义/ 为/ CQAq/ 有/ 可能/ 修复/ ./ 本文/ 研究/ 的/ 不/ 一致/ 查询/ 问题/ 的/ 一致性/ 约束/ 规则/ 为主/ 键/ 约束/ ,/ 修复/ 类型/ 为/ 子集/ ,/ 查询/ 类型/ 为/ 合取/ 查询/ ./ 若/ 关系数据/ 集/ I/ 满足/ 主键/ 为/ x/ ,/ 关系/ 模式/ 为/ R/ (/ x/ ,/ y/ ,/ z/ )/ 的/ 主键/ 约束/ ,/ 则/ 对于/ t1/ ,/ t2/ ∈/ I/ ,/ 若/ t1/ ./ x/ =/ t2/ ./ x/ ,/ 则/ t1/ ./ y/ =/ t2/ ./ y/ 且/ t1/ ./ z/ =/ t2/ ./ z/ ./ 将/ 数据/ 集中/ 具有/ 相同/ 主键/ 的/ 元组/ 结合/ 称为/ 一个/ 块/ ,/ 假设/ 主/ 键值/ 为/ a/ ,/ 记/ #/ block/ (/ a/ )/ 为主/ 键值/ 为/ a/ 的/ 元组/ 集合/ 的/ 个数/ ./ 数据/ 集/ I/ 关于/ 规则/ 集合/ Σ/ 的/ 修复/ r/ 是/ 子集/ 修复/ 当且/ 仅/ 当/ :/ (/ 1/ )/ r/ / Σ/ ,/ (/ 2/ )/ 不/ 存在/ |/ r/ |/ </ |/ r/ |/ 且/ r/ 是/ I/ 的/ 一个/ 修复/ ./ 合取/ 查询/ 是/ 包含/ 选择/ 、/ 投影/ 和/ 连接/ 操作/ 的/ 查询/ ,/ 其/ datalog/ 表示/ 形式/ 为/ q/ (/ u0/ )/ :/ -/ R1/ (/ u1/ )/ ,/ R2/ (/ u2/ )/ ,/ …/ ,/ Rn/ (/ un/ )/ ,/ 其中/ R1/ ,/ …/ ,/ Rn/ 表示/ 关系/ 名/ ,/ u0/ ,/ u1/ ,/ …/ ,/ un/ 是/ 相应/ 关系/ 表中/ 的/ 自由/ 元组/ ,/ 由/ 常量/ 和/ 变量/ 组成/ ,/ Ri/ (/ ui/ )/ 称为/ q/ 中/ 的/ 原子公式/ ./ 当/ q/ 中/ 所有/ 表名/ 只/ 出现/ 一次/ 时/ ,/ 称/ 查询/ q/ 为/ 不/ 带/ 自/ 连接/ 的/ 查询/ ./ 当/ u0/ 为/ 空时/ ,/ q/ 为/ 布尔/ 合取/ 查询/ ./ 3.2/ 查询/ 一阶可/ 表达/ 的/ 判定/ 主键/ 约束/ 下/ 基于/ 子集/ 修复/ 的/ 合取/ 查询/ 的/ 一致性/ 查询/ 是/ coNP/ -/ 完全/ 问题/ ./ 然而/ ,/ 对于/ 合取/ 查询/ 的/ 一些/ 子/ 查询/ ,/ 可以/ 在/ 多项式/ 时间/ 内/ 计算/ 其/ 一致性/ 查询/ 结果/ ./ 此类/ 子/ 查询/ 具有/ 的/ 一个/ 重要/ 性质/ 即/ 一阶可/ 改写/ ./ 文献/ [/ 24/ ]/ 中/ 给出/ 了/ 无/ 循环/ 无自/ 连接/ 的/ 一致性/ 合取/ 布尔/ 查询/ 一阶可/ 改写/ 的/ 必要条件/ (/ 见/ 定理/ 1/ )/ ,/ 其/ 通过/ 查询/ q/ 的/ join/ 树/ [/ 25/ ]/ ,/ 建立/ 查询/ q/ 的/ 攻击/ 图/ ,/ 根据/ 攻击/ 图/ 给出/ 查询/ 的/ 一阶/ 改写/ 查询/ q/ ,/ 使用/ q/ 对/ 数据/ 进行/ 查询/ 操作/ ,/ 查询/ 的/ 结果/ 等价/ 于/ q/ 的/ 一致性/ 查询/ 结果/ ./ 定理/ 1/ ./ 假设/ q/ 为/ 非/ 循环/ 无/ 连接/ 布尔/ 连接/ 查询/ ,/ 若/ q/ 对应/ 的/ 攻击/ 图/ Gq/ 无环/ ,/ 则/ CERTAINTY/ (/ q/ )/ 是/ 一阶可/ 表达/ 的/ ./ 攻击/ 图/ 的/ 建立/ 需要/ join/ 树/ ,/ 查询/ q/ 的/ join/ 树是/ 一个/ 无向/ 连通/ 树/ ,/ 树中/ 的/ 每个/ 节点/ 表示/ 查询/ 中/ 的/ 一个/ 原子公式/ 且/ 满足/ 如下/ 条件/ :/ 若/ 变量/ x/ 出现/ 在/ 两个/ 不同/ 的/ 原子公式/ Ri/ 和/ Rj/ 中/ ,/ 则/ x/ 出现/ 在/ 连接/ Ri/ 和/ Rj/ 的/ 唯一/ 路径/ 上/ 的/ 所有/ 原子公式/ 中/ ./ 若/ 一个/ 查询/ 存在/ join/ 树/ ,/ 则/ 称/ 该/ 查询/ 是/ 无环/ 的/ ./ 查询/ q/ 的/ 攻击/ 图为/ 一个/ 有向图/ ,/ 攻击/ 图中/ 的/ 顶点/ 由/ q/ 的/ 原子公式/ 构成/ ./ 原子公式/ 具有/ 主键/ 约束/ ,/ 主键/ 约束/ 使得/ 原子公式/ 所/ 代表/ 的/ 关系/ 表中/ 存在/ 着/ 属性/ 值间/ 的/ 函数/ 依赖/ ./ 例如/ ,/ 在/ 原子公式/ F/ :/ R/ (/ x/ ,/ y/ ,/ z/ )/ 中/ ,/ X/ 是/ R/ 的/ 主键/ ,/ 则/ 存在/ 着/ 函数/ 依赖/ {/ x/ }/ →/ {/ x/ ,/ y/ ,/ z/ }/ ,/ 可以/ 简写/ 为/ x/ →/ xyz/ (/ 等价/ 于/ x/ →/ yz/ )/ ./ 此/ 函数/ 依赖/ 不同于/ 一般/ 意义/ 上/ 的/ 函数/ 依赖/ ,/ 显然/ ,/ 此/ 函数/ 依赖/ 的/ 变量/ 与/ 查询/ 相关/ ./ 记/ 集合/ κ/ (/ q/ )/ 为/ 查询/ q/ 中/ 的/ 函数/ 依赖/ 集合/ ./ 集合/ F/ +/ ,/ q/ 为/ F/ 的/ 主键/ 集合/ KVars/ (/ F/ )/ 关于/ 原子/ q/ \/ {/ F/ }/ 中/ 的/ 函数/ 依赖/ 集合/ 的/ 属性/ 闭包/ ./ 其中/ ,/ 属性/ 闭包/ 的/ 概念/ 来源于/ 关系数据库/ 理论/ ,/ 如果/ Σ/ 是/ 属性/ 集/ U/ 上/ 的/ 函数/ 依赖/ ,/ X/ / U/ ,/ 则/ X/ 关于/ Σ/ 的/ 属性/ 闭包/ 是/ 集合/ {/ A/ ∈/ U/ |/ Σ/ / X/ →/ A/ }/ ./ 攻击/ 图中/ 有/ 一条/ 从/ F/ 到/ 原子公式/ G/ 的/ 边/ 当且/ 仅/ 当/ F/ +/ ,/ q/ 不/ 包含/ join/ 树中/ F/ 到/ G/ 的/ 唯一/ 路径/ 上/ 出现/ 的/ 所有/ 变量/ ./ 例/ 2/ ./ 查询/ q/ :/ -/ R1/ (/ x/ ,/ y/ )/ ,/ R2/ (/ u/ ,/ x/ )/ ,/ R3/ (/ y/ ,/ x/ ,/ z/ )/ ,/ R4/ (/ x/ ,/ z/ )/ 的/ join/ 树/ 和/ 攻击/ 图为/ 图/ 1/ [/ 21/ ]/ 所示/ ./ 对于/ 无环/ 查询/ q/ 的/ 攻击/ 图/ Gq/ ,/ 若图/ 中/ 顶点/ F/ =/ R/ (/ x/ ,/ y/ )/ 的/ 入度/ 为/ 0/ ,/ 则/ 称/ F/ 不/ 被/ 任何/ 顶点/ 攻击/ ,/ 设/ q/ =/ q/ \/ {/ F/ }/ ,/ φ/ (/ x/ ,/ y/ )/ 为/ q/ (/ x/ ,/ y/ )/ 的/ 一阶/ 改写/ ,/ 则/ q/ 可一阶/ 改写/ 为/ Rewrite/ (/ F/ ,/ q/ )/ =/ / x/ / y/ (/ R/ (/ x/ ,/ y/ )/ ∧/ / y/ (/ R/ (/ x/ ,/ y/ )/ →/ φ/ (/ x/ ,/ y/ )/ )/ ./ 4/ 问题/ 定义/ 及/ 估计/ 算法/ 4.1/ 问题/ 定义/ 一致性/ 查询/ 估计/ 的/ 目标/ 是/ 估计/ 查询/ 结果/ 的/ 一致性/ 程度/ ,/ 一致性/ 程度/ 是/ 指/ 查询/ 结果/ 中是/ 一致性/ 查询/ 回答/ 占/ 总/ 的/ 查询/ 结果/ 的/ 比例/ ./ 可以/ 用/ 一个/ 概率/ 值来/ 描述/ ,/ 记/ 为/ 一致性/ 程度/ pc/ ,/ 此/ 估计/ 问题/ 形式化/ 定义/ 如下/ :/ Page5/ 问题/ :/ 一致性/ 查询/ 估计/ 输入/ :/ 合取/ 查询/ Q/ ,/ D/ ,/ 主键/ 约束/ 集合/ Σ/ 输出/ :/ Q/ (/ D/ )/ 的/ 一致性/ 程度/ pc/ 已知/ 当/ 查询/ Q/ 一阶可/ 表达/ 时/ ,/ 可以/ 在/ 多项式/ 时间/ 内/ 得到/ Q/ 的/ 一致性/ 回答/ ,/ 因此/ ,/ 估计/ 算法/ 需要/ 首先/ 判断/ Q/ 是否是/ 一阶可/ 表达/ 的/ ./ 当/ 查询/ 可一阶/ 表达/ 时/ ,/ 则/ 可以/ 直接/ 执行/ 其一/ 阶/ 改写/ 后/ 的/ 查询/ ,/ 得到/ 一致性/ 答案/ 集合/ ,/ 使用/ 一致性/ 答案/ 集合/ 的/ 元组/ 个数/ 除以/ Q/ (/ D/ )/ 中/ 的/ 元组/ 个数/ ,/ 计算/ 一致性/ 程度/ 估计/ pc/ ./ 当/ 查询/ 不可/ 一阶/ 表达/ 时且/ 不能/ 在/ 多项式/ 时间/ 内/ 计算/ 其/ 一致性/ 查询/ 结果/ 时/ ,/ 需要/ 近似/ 的/ 估计/ 查询/ 结果/ 的/ 一致性/ 程度/ ./ 下/ 一节/ (/ 4.2/ 节/ )/ 说明/ 当/ 查询/ 不可/ 一阶可/ 表达/ 时/ ,/ 如何/ 估计/ 查询/ 结果/ 的/ 一致性/ 程度/ ./ 4.2/ 一阶/ 不可/ 表达/ 的/ 查询/ 结果/ 一致性/ 估计/ 当/ Q/ 不可/ 一阶/ 表达/ 时/ ,/ 且/ Q/ 的/ 一致性/ 回答/ 不能/ 在/ 多项式/ 时间/ 内/ 计算/ 时/ ,/ 需要/ Q/ (/ D/ )/ 中/ 的/ 每条/ 元组/ ,/ 将/ 其/ 元组/ t/ 的/ 属性/ 值赋/ 给/ Q/ 后/ 形成/ 布尔/ 查询/ q/ =/ Q/ (/ t/ )/ ,/ 判断/ q/ 的/ 一致性/ 回答/ 是否/ 为/ “/ 是/ ”/ ,/ 当/ q/ 的/ 一致性/ 回答/ 为/ “/ 是/ ”/ 时/ ,/ t/ 是/ Q/ 的/ 一致性/ 回答/ ./ 然而/ ,/ 当/ 查询/ 结果/ 集/ 很大/ 时/ ,/ 若/ 是/ 对/ 每/ 一条/ 元组/ 都/ 判断/ 其/ 是否是/ 一致/ 的/ 回答/ 将会/ 非常/ 耗时/ ./ 因此/ ,/ 当/ 查询/ 的/ 个数/ 大于/ 30/ 时/ ,/ 本文/ 将/ 采用/ 抽样/ 的/ 方法/ 给出/ 查询/ 结果/ pc/ 的/ 一个/ (/ ε/ ,/ δ/ )/ -/ 估计/ p/ ^/ c/ ,/ (/ ε/ ,/ δ/ )/ -/ 估计/ 的/ 定义/ 见/ 定义/ 4/ ./ 当/ 查询/ 结果/ 小于/ 等于/ 30/ 时/ ,/ 对/ 答案/ 集中/ 的/ 每/ 一条/ 元组/ ,/ 判定/ 其/ 一致性/ ,/ 返回/ 一致性/ 的/ 元组/ 在/ 答案/ 集合/ 中/ 的/ 比例/ ./ 定义/ 4/ ./ (/ ε/ ,/ δ/ )/ -/ 估计/ ./ 对于/ 任意/ ε/ (/ ε/ / 0/ )/ 和/ δ/ (/ 0/ / δ/ / 1/ )/ ,/ I/ ^/ 是/ 估计量/ I/ 的/ 估计值/ ,/ 如果/ Pr/ (/ |/ (/ I/ ^/ -/ I/ )/ // I/ |/ / ε/ )/ / δ/ ./ 其中/ Pr/ (/ X/ )/ 随机/ 事件/ X/ 发生/ 的/ 概率/ ,/ 称/ I/ ^/ 是/ I/ 的/ (/ ε/ ,/ δ/ )/ -/ 估计/ ./ 将/ Q/ (/ D/ )/ 做/ 为/ 总体/ ,/ 可以/ 用/ 随机变量/ Xi/ 表示/ Q/ (/ D/ )/ 中/ 第/ i/ 个/ 元组/ ti/ 的/ 一致性/ ./ 其中/ ,/ Xi/ =/ 1/ 表示/ ti/ 是/ 一致/ 的/ 答案/ ,/ 即/ 对于/ 数据/ 所有/ 的/ 修复/ ,/ ti/ 都/ 出现/ 在/ 查询/ 的/ 结果/ 中/ ./ Xi/ =/ 0/ 表示/ ti/ 是/ 不/ 一致/ 的/ 答案/ ,/ 即/ 存在/ 一个/ 修复/ ,/ 在/ 此/ 修复/ 下/ ,/ ti/ 不/ 出现/ 在/ 查询/ 的/ 结果/ 中/ ./ 基于/ 此/ ,/ 抽样/ 算法/ 如/ 算法/ 1/ 所示/ ./ 算法/ 1/ ./ 抽样/ 算法/ ./ 1/ ./ 根据/ ε/ ,/ δ/ 确定/ 抽样/ 的/ 次数/ ;/ 2/ ./ 对/ Q/ (/ D/ )/ 进行/ 重复/ 抽样/ ,/ 判定/ 抽出/ 的/ 样本/ 的/ 一致性/ ;/ 3/ ./ 计算/ Q/ (/ D/ )/ 的/ 一致性/ 程度/ 估计/ p/ ^/ c/ ./ 算法/ 第/ 1/ 步/ 需要/ 确定/ 抽样/ 次数/ ,/ 抽样/ 次数/ 由/ ε/ ,/ δ/ 决定/ ./ 由/ 定理/ 2/ 可知/ ,/ 抽样/ 的/ 次数/ 和/ 查询/ 回答/ 的/ 个数/ 无关/ ./ 定理/ 2/ ./ 如果/ 抽样/ 次数/ n/ 满足/ :/ n/ / p/ ^/ c/ 是/ pc/ 的/ (/ ε/ ,/ δ/ )/ -/ 估计/ ,/ 其中/ / δ/ // 2/ 是/ 标准/ 正态分布/ 的/ δ/ // 2/ 分/ 位点/ ./ 证明/ ./ p/ ^/ c/ 的/ 方差/ var/ (/ p/ ^/ c/ )/ =/ 由/ n/ / / 24/ ε/ 2/ +/ 1/ 知/ :/ n/ -/ 1/ / 可得/ var/ (/ p/ ^/ c/ )/ / 又/ 由/ 0/ / E/ (/ pc/ )/ =/ pc/ / 1/ ,/ var/ (/ p/ ^/ c/ )/ / 可/ 得/ / δ/ // 2/ ×/ var/ (/ p/ ^/ c/ 槡/ )/ / ε/ pc/ 则/ 由/ 中心/ 极限/ 定理/ 可得/ Pr/ (/ |/ p/ ^/ c/ -/ pc/ |/ / / δ/ // 2/ ×/ var/ (/ p/ ^/ c/ 槡/ )/ )/ / δ/ 则/ Pr/ (/ |/ p/ ^/ c/ -/ pc/ |/ / ε/ pc/ )/ / δ/ ,/ 即/ Pr/ (/ |/ (/ p/ ^/ c/ -/ pc/ )/ // pc/ |/ / ε/ )/ / δ/ ./ 算法/ 第/ 2/ 步/ 需要/ 对/ 抽出/ 的/ 样本/ 进行/ 一致性/ 判定/ ,/ 即/ 判定/ t/ ∈/ CERTAINTY/ (/ q/ )/ ?/ 已知/ 此/ 问题/ 的/ 上界/ 是/ coNP/ -/ 完全/ 问题/ ,/ 因此/ 在/ NP/ ≠/ P/ 的/ 假设/ 下/ 没有/ 确定/ 的/ 多项式/ 时间/ 算法/ 判定/ 查询/ 是否/ 有/ 一致性/ 答案/ ./ 基于/ 此/ ,/ 对于/ 复杂度/ 为/ coNP/ -/ 完全/ 问题/ 的/ 一致性/ 查询/ ,/ 定义/ 了/ 近似/ 一致性/ 判定/ ./ 第/ 5/ 节/ 介绍/ 近似/ 一致性/ 判定/ 算法/ ./ 对于/ 不可/ 一阶/ 表达/ ,/ 但是/ 一致性/ 回答/ 可以/ 在/ 多项式/ 时间/ 内/ 获得/ 的/ 查询/ ./ 例如/ ,/ 查询/ Q/ (/ z/ ,/ w/ )/ :/ -/ R1/ (/ x/ ,/ y/ ,/ z/ )/ ,/ R2/ (/ y/ ,/ x/ ,/ w/ )/ ,/ 其/ 不可/ 一阶/ 改写/ ,/ 然而/ ,/ 可以/ 在/ 多项式/ 时间/ 查询/ 得到/ 其/ 一致性/ 解/ ./ 此类/ 查询/ 的/ 一个/ 重要/ 特征/ 是/ 连接/ 属性/ 全部/ 出现/ 在/ 查询/ 的/ 主键/ 变量/ 集合/ 中/ ./ 对于/ 此类/ 查询/ ,/ 可以/ 首先/ 对/ 其/ 攻击/ 图/ 进行/ 去/ 环/ 查询/ 改写/ (/ 见/ 定义/ 7/ )/ ,/ 在/ 去/ 环/ 查询/ 得到/ 的/ 结果/ 集中/ 在/ 多项式/ 时间/ 内/ 过滤/ 掉/ 不/ 满足/ 一致性/ 的/ 解/ ,/ 从而/ 精确/ 的/ 计算/ 一致性/ 程度/ ./ 5/ 近似/ 一致性/ 判定/ 算法/ 由于/ 当/ 查询/ 无环且/ 不/ 存在/ 自/ 连接/ 时/ ,/ 定理/ 1/ 成立/ ,/ 因此/ 本文/ 分/ 两种/ 情况/ 考虑/ 布尔/ 查询/ q/ 的/ 一致性/ 判定/ ./ 5.1/ 节/ 针对/ 无环/ 无自/ 连接/ 的/ 查询/ ,/ 5.2/ 节/ 简单/ 地/ 说明/ 了/ 查询/ 有环/ 或是/ 自/ 连接/ 时/ 的/ 处理/ 方法/ ./ 5.1/ 无环/ 无自/ 连接/ 的/ 查询/ 近似/ 一致性/ 判定/ 算法/ 当/ Gq/ 有/ 环时/ ,/ 使用/ 攻击/ 图/ 无法/ 在/ 多项式/ 时间/ 内/ 判定/ CERTAINTY/ (/ q/ )/ ,/ 因此/ ,/ 本/ 节/ 提出/ 了/ 近似/ 一致性/ 判定/ 的/ 概念/ ./ 在/ 介绍/ 近似/ 一致性/ 判定/ 之前/ ,/ 我们/ 首/ Page6/ 先/ 介绍/ 一致性/ 准确率/ 的/ 概念/ ./ 定义/ 5/ ./ 一致性/ 准确率/ ./ 假设/ 数据/ 实例/ I/ 有/ n/ 种/ 修复/ ,/ 元组/ t/ ∈/ q/ (/ I/ )/ 在/ n/ 中/ 修复/ 下/ 被/ 返回/ ,/ 则/ t/ 的/ 一致性/ 准确率/ 为/ n/ // n/ ./ 在/ 近似/ 一致性/ 判定/ 中/ ,/ 使用/ 一致性/ 准确率/ 来/ 表示/ 一致性/ 的/ 近似/ 程度/ ./ 定义/ 6/ ./ 近似/ 一致性/ 回答/ (/ τ/ -/ CERTAINTY/ (/ q/ )/ )/ :/ 给定/ 近似/ 阈值/ τ/ (/ 0/ </ τ/ </ 1/ )/ ,/ 对于/ t/ ∈/ q/ (/ I/ )/ ,/ 如果/ t/ 的/ 准确率/ pt/ / τ/ ,/ 则/ t/ 为/ q/ 的/ τ/ -/ 近似/ 一致性/ 回答/ ./ 当/ τ/ =/ 1/ 时/ ,/ t/ 为/ q/ 的/ 一致性/ 查询/ 回答/ ,/ 若/ CER/ -/ TAINTY/ (/ q/ )/ 不是/ 一阶可/ 表达/ 的/ ,/ 则/ CERTAINTY/ (/ q/ )/ 可能/ 是/ co/ -/ NP/ 完全/ 问题/ ./ 因此/ ,/ 设/ τ/ </ 1/ ,/ 计算/ t/ 的/ τ/ -/ 近似/ 一致性/ 回答/ 判定/ 答案/ ./ 通过观察/ 我们/ 发现/ :/ 对于/ q/ ,/ 若/ q/ 的/ 一致性/ 回答/ 为/ “/ 是/ ”/ ,/ 则/ 去掉/ Gq/ 的/ 环/ ,/ 对/ 其/ 进行/ 改写/ 得到/ qrelax/ ,/ 则/ qrelax/ 的/ 一致性/ 回答/ 为/ “/ 是/ ”/ ,/ 即/ 所有/ 提供/ q/ 一致性/ 回答/ 为/ “/ 是/ ”/ 的/ 中间/ 结果/ 是/ 所有/ 提供/ qrelax/ 一致性/ 回答/ 为/ “/ 是/ ”/ 的/ 中间/ 结果/ 的/ 子集/ ./ 因此/ ,/ 定义/ 了/ 查询/ 的/ 去/ 环/ 操作/ ,/ 如/ 定义/ 7/ 所示/ ./ 定义/ 7/ ./ 去/ 环/ 查询/ 改写/ ./ 对于/ 无环/ 无自/ 连接/ 的/ 合取/ 查询/ q/ (/ u0/ )/ =/ R1/ (/ u1/ )/ ,/ R2/ (/ u2/ )/ ,/ …/ ,/ Rn/ (/ un/ )/ ,/ n/ / 1/ ,/ 若/ q/ 的/ 攻击/ 图/ 存在/ 环/ Ri/ ,/ Rj/ ,/ …/ ,/ Ri/ ,/ 则/ 存在/ 一个/ 查询/ qrelax/ (/ u0/ )/ =/ R1/ (/ u1/ )/ ,/ R2/ (/ u2/ )/ ,/ …/ ,/ Rn/ (/ un/ )/ ,/ n/ / 1/ ,/ ui/ 为/ Ri/ 中/ 修改/ 的/ 变量/ 集合/ ./ 若/ qrelax/ 的/ 攻击/ 图无环/ ,/ 且/ 不/ 存在/ u/ ,/ 使得/ u/ / u/ ,/ 则/ 称/ qrelax/ 是/ q/ 的/ 一个/ 去/ 环/ 查询/ 改写/ ./ 例/ 3/ ./ 设/ q1/ =/ R1/ (/ x/ ,/ y/ )/ ,/ R2/ (/ z/ ,/ y/ )/ ,/ 则/ 改写/ 后/ 的/ 查询/ qrelax/ =/ R1/ (/ x/ ,/ y/ )/ ,/ R2/ (/ z/ ,/ y/ )/ ./ 去/ 环/ 操作/ 放松/ 了/ 查询/ 条件/ ,/ 减少/ 了/ 连接/ 属性/ 的/ 个数/ ./ 因此/ ,/ 去/ 环/ 之后/ 的/ 查询/ qrelax/ 和/ 原来/ 的/ 查询/ q/ 在/ 查询/ 结果/ 上/ 有/ 定理/ 3/ 所/ 描述/ 的/ 关系/ ./ 此外/ ,/ 提供/ qrelax/ 一致性/ 回答/ 为/ “/ 是/ ”/ 的/ 中间/ 结果/ 包含/ 执行/ q/ 一致性/ 查询/ 的/ 中间/ 结果/ ./ 基于/ 此/ ,/ 本文/ 使用/ qrelax/ 的/ 中间/ 结果/ 近似/ 判定/ q/ 的/ 一致性/ 回答/ 是否/ 为/ “/ 是/ ”/ ./ 定义/ 8/ 形式化/ 定义/ 了/ 近似/ 判定/ q/ 的/ 一致性/ 回答/ 需要/ 用到/ 的/ qrelax/ 的/ 中间/ 结果/ ./ 定理/ 3/ ./ 查询/ q/ 的/ 改写/ qrelax/ 的/ 一致性/ 查询/ 结果/ 为否/ ,/ 则/ q/ 的/ 查询/ 结果/ 为否/ ./ 显然/ ,/ 由于/ qrelax/ 实际上/ 放松/ 了/ q/ 的/ 查询/ 条件/ ,/ 定理/ 3/ 成立/ ./ 定义/ 8/ ./ 见证/ 元组/ 集合/ ./ 设/ qrelax/ 是/ q/ 的/ 一个/ 去/ 环/ 查询/ 改写/ ,/ 若/ qrelax/ 的/ 一致性/ 回答/ 为/ 是/ ,/ 则/ 见证/ 元组/ 集合/ witness/ (/ Ukey/ ,/ U/ )/ 为/ 使得/ qrelax/ 回答/ 为/ 是/ 的/ 中间/ 结果/ 集在/ Ukey/ ,/ U/ 属性/ 集上/ 的/ 投影/ ./ 其中/ Ukey/ ,/ U/ 由/ 常量/ 和/ 变量/ 组成/ ,/ Ukey/ 表示/ q/ 改写/ 生成/ qrelax/ 时/ 改变/ 的/ 原子/ 的/ 主/ 键值/ ,/ U/ 表示/ 改变/ 后/ 的/ 原子/ 变量/ 和/ 被/ 改变/ 的/ 原子/ 变量/ 组成/ 的/ 变量/ 对/ 的/ 值/ ./ 例/ 4/ ./ 查询/ q1/ 的/ 见证/ 元组/ 集合/ witness/ (/ x/ ,/ z/ ,/ (/ y/ ,/ y/ )/ )/ 为/ R1/ ,/ R2/ 的/ 笛卡尔/ 集/ ./ 若/ qrelax/ 的/ 一致性/ 回答/ 为/ “/ 否/ ”/ ,/ 则/ 由/ 定理/ 3/ ,/ q/ 的/ 一致性/ 回答/ 为/ “/ 否/ ”/ ./ 假设/ 执行/ qrelax/ 一致性/ 回答/ 为/ “/ 是/ ”/ ,/ 执行/ 过程/ 中/ 生成/ 的/ witness/ (/ Ukey/ ,/ U/ )/ 中有/ 元组/ t/ 使得/ t/ ./ U/ 中/ 每/ 对值/ 相等/ ,/ 则/ 可以/ 根据/ t/ 计算/ 满足/ q/ 的/ 修复/ 比例/ ,/ 即/ 一致性/ 准确率/ ,/ 近似/ 判断/ q/ 的/ 一致性/ 回答/ ./ 满足/ q/ 的/ 修复/ 由/ 两/ 部分/ 组成/ :/ (/ 1/ )/ t/ ./ Ukey/ =/ t/ ./ Ukey/ ,/ t/ ./ U/ ≠/ t/ ./ U/ 且/ t/ 出现/ 在/ witness/ 中/ 的/ 元组/ 加上/ t/ 所/ 代表/ 的/ 修复/ 个数/ 之/ 和/ ,/ 记/ 满足条件/ 的/ 元组/ 个数/ 为/ l/ ./ 此/ 部分/ 元组/ 满足/ 修复/ 的/ 比例/ 为/ frac/ _/ part1/ =/ l/ // #/ t/ ,/ 其中/ #/ t/ =/ #/ block/ (/ t/ ./ xi/ )/ ./ 比如/ 表/ 3/ 中/ t/ ,/ t1/ ,/ t2/ ,/ t3/ ,/ t4/ ,/ l/ =/ 5/ ,/ ∏/ 1/ / i/ / kfrac/ _/ part1/ =/ 5/ // #/ t/ ;/ (/ 2/ )/ t/ ./ Ukey/ =/ t/ ./ Ukey/ 且/ 不/ 出现/ 在/ witness/ 中/ 的/ 元组/ 集合/ 所/ 代表/ 的/ 修复/ 个数/ ./ 比如/ 元组/ (/ a/ ,/ …/ ,/ c/ ,/ (/ 0/ ,/ 1/ )/ ,/ …/ (/ 1/ ,/ 1/ )/ )/ ./ (/ 1/ )/ 和/ (/ 2/ )/ 组成/ 的/ 元组/ 共有/ #/ t/ 个/ ,/ 需要/ 为/ #/ t/ -/ l/ 个/ 元组/ 计算/ 其所能/ 代表/ 的/ q/ 满足/ 的/ 修复/ 个数/ ./ 查看/ 表/ ,/ 如果/ 存在/ t5/ ,/ t6/ 类型/ 的/ 元组/ ,/ 即/ t/ ./ Ukey/ ≠/ t/ ./ Ukey/ 使/ q/ 为/ “/ 是/ ”/ ,/ 则/ 说明/ 在/ 取/ t5/ ,/ t6/ 所在/ 的/ 元组/ 为/ 数据/ 修复/ 的/ 一部分/ 时/ ,/ xk/ 所在/ 的/ 关系/ 表中/ 主键/ 为/ c/ 值/ 的/ 元组/ 可以/ 任取/ 组成/ 完整/ 的/ 修复/ ./ t5/ ,/ t6/ 的/ 不同/ 在于/ t5/ ./ x1/ =/ t/ ./ x1/ ,/ t5/ 提供/ 的/ 修复/ 比例/ 为/ (/ #/ t/ -/ l/ )/ ·/ #/ block/ (/ x1/ )/ // (/ #/ t/ ·/ #/ t5/ )/ ,/ t6/ 提供/ 的/ 修复/ 比例/ 为/ (/ #/ t/ -/ l/ )/ // (/ #/ t/ ·/ #/ t5/ )/ ./ 这/ 是因为/ 对/ (/ 2/ )/ 中/ 满足条件/ 的/ 每个/ 元组/ 而言/ ,/ t5/ 类型/ 的/ 元组/ 满足/ 部分/ 修复/ 为/ 形成/ t5/ 的/ xk/ 所在/ 的/ 关系/ 表中/ 的/ 元组/ ,/ 主键/ 为/ d/ 值中/ 的/ 一条/ ,/ 以及/ 形成/ t5/ 的/ x1/ 所在/ 的/ 关系/ 表中主/ 键值/ 为/ a/ 的/ 一条/ ,/ 以及/ 其他/ 关系/ 表/ 的/ 任意/ 修复/ ./ 因为/ a/ 已经/ 出现/ 在/ t/ 中/ ,/ 因此/ ,/ 其/ 代表/ 的/ 修复/ 比例/ 为/ #/ block/ (/ x1/ )/ // (/ #/ t/ ·/ #/ t5/ )/ ./ 然而/ ,/ t5/ 和/ t6/ 提供/ 的/ 修复/ 中有/ 重复/ 的/ 情况/ ,/ 需要/ 减去/ 交集/ ,/ 即/ 交集/ 占/ 的/ 修复/ 比例/ 为/ 1/ // (/ #/ t5/ ·/ #/ t6/ )/ ./ 因此/ ,/ 假设/ 有/ m/ 条/ 类似/ 于/ t5/ ,/ t6/ 这样/ 的/ 元组/ t1/ ,/ …/ ,/ tm/ ,/ 则/ 其/ 提供/ 的/ 修复/ 比例/ 为/ p/ =/ (/ #/ t/ -/ l/ )/ p/ (/ frac/ _/ t1/ ∪/ …/ ∪/ frac/ _/ tm/ )/ ,/ frac/ _/ ti/ 为/ 元组/ ti/ 提供/ 的/ 修复/ 比例/ ,/ 其中/ frac/ _/ ti/ =/ ∏/ 1/ / i/ / k/ ./ ti/ ./ xi/ =/ t/ ./ xip/ (/ ∩/ frac/ _/ ti/ )/ =/ ∏/ 1/ // #/ ti/ ,/ p/ 可/ 使用/ 相容/ 事件/ 发生/ 的/ 概率/ 公式/ 计算/ ./ 然而/ ,/ 当/ m/ 较大/ 时/ ,/ 计算/ 为/ 指数/ 时间/ ./ 由于/ p/ / (/ #/ t/ -/ l/ )/ p/ (/ frac/ _/ ti/ )/ ,/ 因此/ 我们/ 可以/ 首先/ 计算/ 单个/ 元组/ 提供/ 的/ 修复/ 比例/ ,/ 将/ p/ =/ p/ +/ p/ 和/ 给定/ 的/ 近似/ 性/ 阈值/ 比较/ ,/ 以/ 尽早/ 终止/ 算法/ ./ 显然/ ,/ 当/ 处理/ 完/ 所有/ 的/ (/ 1/ )/ (/ 2/ )/ 类型/ 的/ 元组/ 时/ ,/ p/ </ 1/ ,/ 则/ q/ 的/ 一致性/ 答案/ 返回/ “/ 否/ ”/ ./ Page7t0t1t2t3t4t5t6/ …/ 具体/ 判定/ 算法/ 如/ 算法/ 2/ 所示/ ./ 算法/ 2/ ./ 近似/ 一致性/ 判定/ ./ 输入/ :/ 查询/ q/ 的/ 去/ 环/ 查询/ 改写/ qrelax/ ,/ 近似/ 性/ 阈值/ τ/ 输出/ :/ q/ 的/ 近似/ 一致性/ 回答/ “/ 是/ ”/ (/ 1/ )/ 或者/ “/ 否/ ”/ (/ 0/ )/ 1/ ./ 一阶/ 改写/ qrelax/ 为/ qfo/ ,/ 执行/ qfo/ ,/ 记录/ 见证/ 元组/ 集合/ witness/ (/ Ukey/ ,/ U/ )/ ,/ 设/ Ukey/ =/ {/ x1/ ,/ …/ ,/ xk/ }/ ,/ U/ =/ {/ (/ y1/ ,/ y1/ )/ ,/ …/ ,/ (/ ym/ ,/ ym/ )/ }/ ,/ 若/ qfo/ 结果/ 为空/ ,/ 则/ 返回/ “/ 0/ ”/ ;/ 2/ ./ 否则/ ,/ 删除/ witness/ (/ Ukey/ ,/ U/ )/ 中/ U/ 中/ yi/ ≠/ yi/ 的/ 元组/ ./ 若/ 删除/ 后/ 有/ 元组/ t/ ,/ 对于/ 1/ / i/ / k/ ,/ #/ block/ (/ t/ ./ xi/ )/ =/ 1/ ,/ 则/ 返回/ “/ 1/ ”/ ;/ 3/ ./ 否则/ ,/ 寻找/ 元组/ t/ ,/ 使得/ ∏/ 1/ / i/ / k/ 过程/ 1/ 和/ 过程/ 2/ 计算/ 返回/ 结果/ ./ 过程/ 1.1/ ./ 寻找/ witness/ 中/ t/ ./ Ukey/ =/ t/ ./ Ukey/ ,/ t/ ./ U/ ≠/ t/ ./ U/ 记/ 满足条件/ 的/ 元组/ 个数/ 为/ l/ ;/ 2/ ./ p/ =/ (/ l/ +/ 1/ )/ // #/ t/ ./ 过程/ 2.1/ ./ 寻找/ witness/ 中/ t/ ./ Ukey/ ≠/ t/ ./ Ukey/ 的/ 元组/ 集合/ t1/ ,/ …/ ,/ tm/ ./ j/ =/ 1/ ;/ 2/ ./ 计算/ p/ =/ (/ #/ t/ -/ l/ )/ p/ (/ ∪/ 3/ ./ 若/ p/ +/ p/ / τ/ 且/ j/ </ m/ ,/ 则/ 返回/ “/ 1/ ”/ ;/ 若/ j/ =/ m/ ,/ p/ +/ p/ </ 1/ ,/ 则/ 返回/ “/ 0/ ”/ ;/ 若/ p/ +/ p/ </ τ/ 且/ j/ </ m/ ,/ 则/ j/ =/ j/ +/ 1/ ,/ 返回/ 步/ 2/ ./ 近似/ 一致性/ 判定/ 算法/ 第/ 1/ 步/ 需要/ 将/ qrelax/ 改写/ 为/ 一阶/ 查询/ ,/ 之后/ 可以/ 将/ 一阶/ 查询/ 修改/ 为/ SQL/ 语句/ ,/ 在/ 现有/ 的/ 支持/ SQL/ 操作/ 的/ 数据库/ 上/ 如/ PostSql/ ,/ 可以/ 直接/ 执行/ ./ 若/ 执行/ 查询/ 后/ 查询/ 结果/ 为空/ ,/ 由/ 定理/ 3/ ,/ 直接/ 返回/ q/ 的/ 一致性/ 回答/ 为/ “/ 否/ ”/ ,/ 否则/ ,/ 算法/ 在/ 第/ 2/ 步中/ 判断/ 是否/ 由/ 一致性/ 的/ 数据/ 可以/ 使/ q/ 的/ 回答/ 为/ “/ 是/ ”/ ./ 若有/ ,/ 则/ 说明/ 不/ 一致/ 数据/ 集/ 无论/ 怎么/ 修复/ ,/ 都/ 存在/ 元组/ 使得/ q/ 的/ 回答/ 为/ “/ 是/ ”/ ,/ 即/ 一致性/ 判定/ 结果/ 为/ “/ 是/ ”/ ./ 若/ 不/ 存在/ 这样/ 的/ 一致性/ 元组/ ,/ 则/ 算法/ 执行/ 第/ 3/ 步/ ./ 分/ 之前/ 介绍/ 的/ 两种/ 情况/ 计算/ 满足/ q/ 的/ 回答/ 为/ “/ 是/ ”/ 的/ 修复/ 比例/ ./ 在/ 计算/ 过程/ 中/ ,/ 如果/ 计算/ 的/ 修复/ 比例/ p/ / τ/ 时/ ,/ 算法/ 终止/ ,/ 返回/ “/ 是/ ”/ ./ 显然/ ,/ 若/ t/ 不是/ q/ 的/ 一致性/ 查询/ 回答/ ,/ 算法/ 提前结束/ ,/ 然而/ t/ 可能/ 为/ τ/ -/ CERTAINTY/ (/ q/ )/ ./ 在/ 估计/ 查询/ 答案/ 集合/ 的/ 一致/ 程度/ 时/ ,/ 若/ 将/ t/ 作为/ 满足/ τ/ -/ CERTAINTY/ (/ q/ )/ 的/ 答案/ 返回/ ,/ 则/ 会/ 过/ 高/ 的/ 估计/ 查询/ 的/ 一致/ 程度/ ,/ 因此/ ,/ 只有/ 当/ t/ 在/ 当前/ 计算/ 中/ 不能/ 断定/ 其/ 是/ 不/ 一致/ 时/ ,/ 才/ 考虑/ 近似/ 一致性/ ,/ 近似/ 认为/ t/ 是/ 一致/ 的/ ./ 算法/ 的/ 正确性/ 分析/ ./ 对于/ witness/ 中/ 某个/ 固定/ 的/ t/ ,/ 算法/ 考虑/ 了/ t/ 所/ 涉及/ 到/ 的/ 关系/ 表/ 的/ 主键/ 在/ 所有/ 可能/ 下/ 的/ 修复/ 情况/ ,/ 因此/ ,/ 当/ τ/ =/ 1/ 时/ ,/ 算法/ 能够/ 确定/ 的/ 计算/ 出/ 所有/ 满足/ q/ 的/ 修复/ 比例/ ./ 当/ 计算/ 的/ 修复/ 比例/ 为/ 1/ 时/ ,/ 确定/ 的/ 说明/ 了/ q/ 的/ 一致性/ 回答/ 为/ “/ 是/ ”/ ,/ 否则/ ,/ 则/ 说明/ q/ 的/ 一致性/ 回答/ 为否/ ./ τ/ </ 1/ 时/ ,/ 当/ p/ >/ τ/ 时/ ,/ 近似/ 返回/ 了/ q/ 的/ 一致性/ 回答/ 为/ “/ 是/ ”/ ;/ 当/ p/ </ τ/ 且/ 算法/ 终止/ 时/ ,/ q/ 的/ 一致性/ 回答/ 可/ 确定/ 为/ “/ 否/ ”/ ,/ 即/ 对于/ “/ 否/ ”/ 的/ 答案/ ,/ 算法/ 返回/ 的/ 结果/ 都/ 是/ 确定/ 的/ ./ 对于/ “/ 是/ ”/ 的/ 答案/ ,/ 算法/ 返回/ 的/ 结果/ 可能/ 是/ 近似/ 一致/ 的/ ./ 算法/ 的/ 时间/ 复杂度/ 分析/ ./ 对于/ q/ (/ u0/ )/ =/ R1/ (/ u1/ )/ ,/ R2/ (/ u2/ )/ ,/ …/ ,/ Rm/ (/ um/ )/ ,/ m/ / 1/ ,/ 攻击/ 图/ 建立/ 的/ 时间/ 为/ O/ (/ m3/ )/ ,/ 无/ 循环/ 改写/ 和/ 一阶/ 改写/ 为/ 常数/ 时间/ ./ 设/ Ri/ 的/ 元组/ 个数/ / n/ ,/ 算法/ 第/ 2/ 步/ 的/ 时间/ 为/ O/ (/ nm/ )/ ,/ 算法/ 第/ 2/ 步/ 最坏/ 情况/ 下为/ m/ 个表/ 的/ 笛卡尔/ 积/ ,/ 即/ O/ (/ nm/ )/ ./ 第/ 3/ 步/ 最坏/ 情况/ 下/ 需要/ 调用/ 过程/ X/ ,/ 假设/ witness/ 最坏/ 情况/ 下为/ O/ (/ nm/ )/ ,/ 则/ 计算/ p/ 需要/ 花费/ 的/ 时间/ 为/ nm/ +/ C2m/ ,/ 因此/ 总/ 的/ 时间/ 复杂度/ 为/ O/ (/ 2n2n/ 下/ τ/ =/ 1/ 时/ 计算/ q/ 答案/ 为/ “/ 是/ ”/ 时/ 的/ 修复/ 个数/ 为/ #/ p/ -/ 完全/ 问题/ [/ 23/ ]/ ./ 然而/ ,/ 在/ 现实/ 数据库/ 中/ ,/ 由于/ 多表/ 连接/ 结果/ 远/ 小于/ O/ (/ nm/ )/ ,/ 且/ 给定/ 的/ τ/ </ 1/ ,/ 数据/ 集/ 的/ 不一致性/ 很小/ ,/ 造成/ 且/ 生成/ 的/ witness/ 表/ 也/ 不会/ 太大/ ./ 因此/ ,/ 算法/ 在/ 执行/ 过程/ 中/ 的/ 时间/ 复杂度/ 要/ 远远/ 低于/ 指数/ 级/ ./ 实验/ 很/ 好/ 地/ 说明/ 了/ 这/ 一点/ ./ 5.2/ 循环/ 和/ 自/ 连接/ 的/ 查询/ τ/ -/ 近似/ 一致性/ 回答/ 判定/ 对于/ 无/ 循环/ 的/ 合取/ 查询/ ,/ 可/ 利用/ join/ 树/ 建立/ 权重/ 攻击/ 图/ ,/ 而/ 有/ 循环/ 的/ 合取/ 查询/ ,/ 不/ 存在/ join/ 树/ ./ 文献/ [/ 24/ ]/ 中/ 指出/ 有环/ 的/ 查询/ 可以/ 使用/ intersection/ 树/ 建立/ 攻击/ 图/ ./ 然而/ ,/ intersection/ 树/ 建立/ 的/ 攻击/ 图/ 不/ 唯一/ ,/ 因此/ 存在/ 误判/ 的/ 情况/ ,/ 即/ 攻击/ 图无环时/ ,/ 查询/ 不/ 一定/ 可一阶/ 改写/ ./ 考虑/ 到/ 此/ 情况/ ,/ 本文/ 将/ 在/ 建立/ 攻击/ 图/ 之前/ 改写/ 查询/ q/ ,/ 将/ 导致/ 环/ 出现/ 的/ 查询/ 变量/ 使用/ 新/ 的/ 变量/ 代替/ qacylic/ ,/ 然后/ 为/ 新/ 的/ 查询/ 建立/ 攻击/ 图/ ./ 此时/ ,/ 当/ 攻击/ 图中/ 无环时/ ,/ 由/ 定理/ 1/ 可得/ ,/ qacylic/ 是/ 一阶可/ 表达/ 的/ ./ 显然/ ,/ qacylic/ 的/ 回答/ 为/ “/ 是/ ”/ 并/ 不/ 意味着/ q/ 的/ 一致性/ 答案/ 为/ 是/ ./ 此时/ ,/ 我们/ 需要/ 计算/ qacylic/ 计算/ 过程/ 中/ 生成/ “/ 是/ ”/ 的/ 中间/ 结果/ 改写/ 后/ 变量/ 的/ 赋值/ 是否/ Page8/ 和/ 原始/ 变量值/ 相等/ ,/ 可以/ 使用/ 5.1/ 节/ 算法/ 近似/ 判断/ q/ 的/ 一致性/ ./ 当/ 攻击/ 图有/ 环时/ ,/ 需要/ 对/ qacylic/ 进行/ 查询/ 改写/ ,/ 此时/ qacylicrelax/ 括/ qacylic/ 中/ 的/ 变量/ 以及/ 新/ 的/ 改写/ 新加/ 的/ 变量/ 集合/ ,/ 之后/ 的/ 过程/ 同/ 5.1/ 节/ 相同/ ./ 对于/ 存在/ 自/ 连接/ 的/ 查询/ ,/ 假设/ 查询/ q/ 中/ 存在/ 自/ 连接/ R/ (/ x/ ,/ y/ )/ ∧/ R/ (/ y/ ,/ z/ )/ ,/ 则/ 引入/ 新/ 的/ 原子公式/ R/ ,/ 使得/ R/ (/ x/ ,/ y/ )/ ∧/ R/ (/ y/ ,/ z/ )/ 改写/ 为/ R/ (/ x/ ,/ y/ )/ ∧/ R/ (/ y/ ,/ z/ )/ ,/ 形成/ 新/ 的/ 查询/ qsjf/ ,/ 然后/ 将/ qsjf/ 作为/ 无自/ 连接/ 的/ 查询/ 判断/ 其/ 回答/ 的/ 一致性/ ./ 无论/ qsjf/ 是否/ 可一阶/ 表达/ ,/ 都/ 需要/ 在/ witness/ 中/ 判断/ 是否/ (/ x/ =/ y/ )/ ∧/ (/ y/ =/ z/ )/ ./ 6/ 实验/ 当/ q/ (/ u/ )/ 为/ 合取/ 查询/ 时/ ,/ 在/ 主键/ 约束/ 下/ 解决/ CERTAINTY/ (/ q/ (/ u/ )/ )/ 问题/ 主要/ 有/ Conquer/ [/ 18/ ]/ 和/ EQUIP/ [/ 16/ ]/ 两个/ 系统/ ,/ 其中/ Conquer/ 系统/ 适用/ 于/ 查询/ 可/ 进行/ 一阶/ 改写/ 的/ 情况/ ./ 此/ 系统/ 将/ 改写/ 过后/ 的/ 一阶/ 查询/ 再次/ 改写/ 为/ SQL/ 语句/ ,/ 可以/ 在/ 任意/ 不/ 一致/ 的/ 数据/ 集中/ 得到/ 一致/ 的/ 查询/ 结果/ ./ 显然/ ,/ 此/ 系统/ 不/ 依赖于/ 数据/ 集/ ,/ 仅/ 依赖于/ 查询/ 语句/ ./ EQUIP/ 系统/ 则/ 适用/ 于/ 所有/ 的/ 合取/ 查询/ ,/ 该/ 系统/ 将/ 数据/ 集/ 和/ 查询/ 规约/ 成/ 一个/ 0/ -/ 1/ 整数/ 规划/ (/ BIP/ )/ 问题/ ./ 通过/ 解/ 方程组/ 得到/ 不/ 满足/ 一致性/ 查询/ 的/ 解/ ,/ 将/ 不/ 一致/ 解/ 全部/ 去掉/ 之后/ 得到/ 最终/ 一致性/ 的/ 查询/ 结果/ ./ 较之/ Conquer/ 系统/ ,/ 此/ 系统/ 依赖于/ 数据/ 集/ ,/ 当/ 数据/ 集/ 改变/ 时/ ,/ 整数/ 规划/ 方程/ 需要/ 重新/ 建立/ ./ 由于/ 系统/ 性能/ 受/ 多种/ 因素/ 的/ 影响/ ,/ 例如/ ,/ 数据/ 集/ 的/ 不/ 一致/ 程度/ ,/ 查询/ 解/ 空间/ 的/ 大小/ 等/ ./ 目前/ ,/ 并/ 没有/ 一个/ 基准/ 的/ 测试/ 用于/ 比较/ 其/ 各自/ 的/ 性能/ [/ 21/ ]/ ./ 不过/ ,/ 大量/ 的/ 实验/ 表明/ ,/ 如果/ 查询/ 是/ 一阶可/ 表达/ 的/ ,/ 则/ 将/ 一阶/ 查询/ 变换/ 为/ SQL/ 语句/ 的/ 执行/ 效率/ 要/ 高于/ EQUIP/ 系统/ 的/ 效率/ ./ 这/ 是因为/ BIP/ 问题/ 是/ NP/ -/ 完全/ 问题/ ,/ 而/ 一阶/ 查询/ 的/ 问题/ 复杂性/ 为/ AC0/ ./ 不同于/ Conquer/ 系统/ 和/ EQUIP/ 系统/ ,/ 本文/ 不/ 关注/ 于/ 求解/ 查询/ 的/ 一致性/ 答案/ ,/ 而是/ 评估/ 查询/ q/ 在/ 不/ 一致/ 数据/ 集中/ 的/ 查询/ 结果/ 的/ 一致性/ ./ 显然/ ,/ 对于/ 不/ 涉及/ 到/ 数据/ 集中/ 不/ 一致/ 数据/ 的/ 查询/ 结果/ ,/ 其/ 一定/ 是/ 一致/ 的/ ./ 对于/ 涉及/ 到/ 不/ 一致/ 数据/ 的/ 查询/ 结果/ ,/ 则/ 需要/ 评估/ 其/ 一致性/ ,/ 因此/ ,/ 实验/ 关注/ 于/ 评估/ 的/ 效率/ 和/ 评估/ 的/ 准确度/ 以及/ 不/ 一致/ 程度/ 对/ 评估/ 准确度/ 和/ 效率/ 的/ 影响/ ./ 6.1/ 实验/ 配置/ 和/ 数据/ 集/ 本文/ 的/ 实验/ 在/ PC机/ 上/ 运行/ ,/ 其/ 内存/ 4GB/ ,/ 硬盘/ 500GB/ ,/ CPU/ 为/ Pentium/ @/ 2.93/ GHz/ ,/ 操作系统/ 为/ Windows7/ ,/ 所有/ 算法/ 用/ C++/ 实现/ ./ 其中/ ,/ 查询/ 实验/ 使用/ PostgreSQL/ ,/ 版本/ 为/ 9.3/ ./ 4/ -/ 3/ ./ (/ 1/ )/ 基准/ 查询/ ./ 对于/ 不同/ 的/ 查询/ ,/ 一致性/ 查询/ 问题/ 的/ 复杂度/ 从/ 多项式/ 时间/ 到/ coNP/ -/ 完全/ 不/ 等/ ./ 因此/ ,/ 我们/ 设计/ 多组/ 查询/ 针对/ 不同/ 的/ 情况/ 对/ 查询/ 的/ 一致性/ 进行/ 估计/ ./ 查询/ 从/ 时间/ 复杂度/ 上/ 可/ 分为/ 3/ 组/ :/ ①/ 可/ 进行/ 一阶/ 改写/ 的/ 查询/ ;/ ②/ 多项式/ 时间/ ,/ 但是/ 不可/ 进行/ 一阶/ 改写/ ;/ ③/ coNP/ -/ 完全/ ./ 对于/ 多项式/ 时间/ 但是/ 不可/ 进行/ 一阶/ 改写/ 的/ 查询/ ,/ 可以/ 对/ 其/ 进行/ qrelax/ 改写/ 之后/ 在/ 多项式/ 时间/ 过滤/ 掉/ 不/ 满足/ q/ 一致性/ 回答/ 的/ qrelax/ 回答/ ./ 3/ 组/ 查询/ 设计/ 来源于/ 文献/ [/ 16/ ]/ ,/ 如表/ 3/ 所示/ ./ 可一阶/ 改写/ 查询/ 多项式/ 时间/ 但/ 不可/ 一阶/ 改写/ 查询/ coNP/ -/ Hard/ 查询/ (/ 2/ )/ 真实/ 数据/ 集/ ./ 真实/ 数据/ 集是/ NBA/ 球员/ 数据/ 集/ ①/ ./ 该/ 数据/ 集/ 来源于/ 篮球/ 信息/ 的/ 一个/ 网站/ 以及/ 维基百科/ ,/ 由/ 3/ 个表/ 组成/ :/ 球队/ 信息/ team/ ,/ 由/ 68/ 条/ 记录/ 构成/ ,/ 球员/ 球队/ 关系/ 表/ play/ _/ team/ ,/ 由/ 9413/ 条/ 记录/ 构成/ ;/ 以及/ 教练/ 球队/ 关系/ 表/ team/ _/ coach/ ,/ 由/ 639/ 条/ 记录/ 构成/ ./ 由于/ 数据/ 的/ 记录时间/ 不同/ ,/ 若/ 选择/ 合适/ 的/ 主键/ ,/ 则/ 存在/ 着/ 不/ 一致/ 的/ 数据/ ./ 例如/ ,/ 在/ 球员/ 球队/ 关系/ 表中/ ,/ 假设/ 以/ 球员/ 作为/ 主键/ ,/ 则/ 球员/ 可能/ 会/ 在/ 不同/ 的/ 时期/ 属于/ 不同/ 的/ 球队/ ./ 受/ 数据/ 集/ 的/ 限制/ ,/ 我们/ 设计/ 两类/ 真实/ 数据/ 集上/ 的/ 查询/ :/ 一类/ 为/ 多项式/ 时间/ 可解/ 的/ ,/ 另一类/ 的/ 计算/ 复杂度/ 为/ coNP/ -/ 完全/ ,/ 查询/ 设计/ 如下/ :/ q1/ (/ y/ ,/ z/ )/ =/ team/ (/ x/ )/ ,/ play/ _/ team/ (/ y/ ,/ x/ )/ ,/ q2/ (/ y/ ,/ z/ )/ =/ team/ (/ x/ )/ ,/ play/ _/ team/ (/ y/ ,/ x/ )/ ,/ 其中/ x/ 表示/ 球队/ ,/ y/ 表示/ 球员/ ,/ z/ 表示/ 教练/ ./ q1/ 的/ 一致性/ 回答/ 在/ 多项式/ 时间/ 内/ 可以/ ,/ q2/ 则/ 不/ 可以/ ./ (/ 3/ )/ 合成/ 数据/ 集/ ./ 由于/ TPC/ -/ H/ 的/ 数据/ 集/ 大多/ 不能/ 表示/ 不可/ 一阶/ 改写/ 的/ 查询/ 的/ 语义/ 特征/ ,/ 因此/ ,/ 本文/ 设计/ 数据/ 来/ 验证/ 基准/ 查询/ 的/ 性能/ 和/ 估计/ 的/ 准确性/ ./ 数据/ 集/ 的/ 生成/ 由/ 两/ 部分/ 组成/ :/ ①/ 根据/ 查询/ 生成/ 一致/ ①/ http/ :/ // // www/ ./ basketball/ -/ reference/ ./ com/ 和/ wikipediaPage9/ 的/ 数据/ 集/ ./ 为了/ 方便/ 查询/ 的/ 执行/ ,/ 数据/ 集中/ 的/ 属性/ 值/ 类型/ 均/ 为/ 数字/ 类型/ ,/ 数据/ 集中/ 关系/ 表/ 的/ 主键/ 根据/ 选择/ 的/ 基准/ 查询/ 来/ 确定/ ,/ 关系/ 表/ 的/ 规模/ 相同/ ,/ 在/ 生成/ 关系/ 表时/ ,/ 使得/ 任意/ 两表/ 连接/ 的/ 结果/ 大概/ 占/ 原始/ 表/ 的/ 20/ %/ ;/ ②/ 在/ 一致/ 的/ 数据/ 集中/ 引入/ 不一致性/ ./ 采用/ 的/ 方法/ 为/ 在/ 一致/ 的/ 数据/ 集中/ 加入/ 新/ 的/ 元组/ ,/ 新元/ 组/ 的/ 主/ 键值/ 来源于/ 一致/ 数据/ 集中/ 的/ 主/ 键值/ ./ 此/ 过程/ 由/ 两个/ 参数/ 控制/ :/ ①/ #/ conflicts/ ,/ 即/ 加入/ 元组/ 的/ 个数/ ;/ ②/ key/ _/ size/ ,/ 即/ 主键/ 相同/ 的/ 元组/ 的/ 个数/ ,/ 默认/ 为/ 2/ ./ (/ 4/ )/ 参数设置/ ./ 设计/ 近似/ 一致性/ 的/ 近似/ 阈值/ 为/ 0.5/ ;/ 抽样/ 算法/ 中/ ε/ 为/ 0.1/ ,/ δ/ 为/ 0.2/ ./ 6.2/ 实验/ 结果/ 实验/ 的/ 目标/ 是/ 验证/ 估计/ 算法/ 的/ 效率/ 和/ 估计/ 的/ 准确率/ ,/ 以及/ 判定/ 算法/ 的/ 效率/ 和/ 准确率/ ./ 我们/ 首先/ 在/ 真实/ 数据/ 集上/ 验证/ 估计/ 和/ 判定/ 算法/ 的/ 效率/ 和/ 准确率/ ./ 之后/ 在/ 合成/ 数据/ 集上/ 更深/ 一步/ 地/ 挖掘/ 算法/ 所/ 具有/ 的/ 特征/ ./ 数据/ 集中/ ,/ 不/ 违背/ 主键/ 约束/ 的/ 数据/ 是/ 一致/ 的/ ,/ 从/ 这部分/ 数据/ 中/ 查询/ 所/ 得到/ 的/ 结果/ 也/ 是/ 一致/ 的/ ./ 因此/ ,/ 每次/ 实验/ 我们/ 将/ 查询/ 结果/ 集/ ans/ 分为/ 两个/ 部分/ :/ ansc/ 和/ ansn/ ./ 其中/ ansc/ 代表/ 从/ 一致/ 的/ 数据/ 中/ 查询/ 得到/ 的/ 答案/ ,/ ansn/ 表示/ 从/ 剩下/ 的/ 数据/ 中/ 查询/ 得到/ 的/ 结果/ 和/ ansc/ 的/ 差集/ ./ 显然/ ,/ 在/ 验证/ 估计/ 算法/ 时/ ,/ ansc/ 集合/ 中/ 答案/ 的/ 一致性/ 判定/ 为/ 1/ ,/ 只/ 需/ 对/ ansn/ 中/ 的/ 答案/ 进行/ 近似/ 一致性/ 判定/ 时/ ./ 实验/ 过程/ 中/ 抽样/ 算法/ 执行/ 五次/ ,/ 其/ 平均值/ 为/ 算法/ 的/ 效率/ 和/ 评估/ 的/ 准确度/ ,/ 同时/ 对/ 抽出/ 的/ 样本/ 计算/ 其/ 判定/ 的/ 平均/ 准确率/ ./ 6.2/ ./ 1/ 真实/ 数据/ 集上/ 算法/ 的/ 效率/ 和/ 准确性/ 由于/ q1/ 在/ 多项式/ 时间/ 内/ 可以/ 查询/ 到/ 其/ 一致/ 的/ 解/ ./ 因此/ ,/ 其/ 一致性/ 为/ q1/ 经过/ 一阶/ 改写/ 的/ 查询/ 得/ 的/ 结果/ 集/ 的/ 个数/ 占/ q1/ 查询/ 的/ 结果/ 个数/ 的/ 比例/ ,/ 估计/ 的/ 准确度/ 为/ 1/ ./ 此时/ ,/ 不/ 需要/ 进行/ 近似/ 一致性/ 判定/ ./ 对于/ q2/ ,/ 首先/ 要/ 对/ 其/ 进行/ qrelax/ 改写/ ,/ 在/ qrelax/ 查询/ 的/ 结果/ 集中/ 进行/ 抽样/ ,/ 判断/ 样本/ 的/ 近似/ 一致性/ ./ 两个/ 查询/ 的/ 效率/ 和/ 准确率/ 如表/ 4/ 所示/ ./ 表/ 4/ 真实/ 数据/ 上/ 的/ 一致性/ 查询/ 效率/ 及/ 有效性/ 查询/ q1q2cons/ (/ q1/ )/ cons/ (/ q2/ )/ 由表/ 4/ 可以/ 看出/ ,/ 一致性/ 查询/ 的/ 时间/ 要/ 远远/ 大于/ 查询/ 时间/ ,/ 其中/ ,/ q2/ 的/ 一致性/ 查询/ 我们/ 采用/ EQUIP/ 中/ 的/ 方法/ 得到/ 查询/ 结果/ ./ q1/ 的/ 一致性/ 估计/ 的/ 准确度/ 为/ 100/ %/ ,/ 一致性/ 判定/ 准确率/ 也/ 为/ 100/ %/ ,/ 这/ 是因为/ 我们/ 可以/ 在/ 多项式/ 时间/ 内/ 求得/ q1/ 的/ 一致性/ 回答/ ./ q2/ 的/ 一致性/ 判定/ 准确率/ 为/ 85/ %/ ,/ 其/ 一致性/ 估计/ 的/ 准确度/ 由/ 两个/ 因素/ 决定/ :/ 抽样/ 算法/ 给定/ 的/ δ/ 以及/ 近似/ 一致性/ 估计/ 所/ 带来/ 的/ 误差/ ./ 实验/ 中/ 查询/ 生成/ 112724/ 条/ 结果/ 记录/ ./ 其中/ ansn/ 的/ 个数/ 为/ 103165/ :/ 抽样/ 算法/ 抽出/ 42/ 条/ 记录/ 判断/ 一致性/ ./ 从图/ 中/ 可以/ 看出/ ,/ 其/ 总/ 的/ 误差/ 为/ 15/ %/ ./ 准确率/ 没有/ 超过/ 90/ %/ 的/ 原因/ 是/ 由于/ 近似/ 一致性/ 估计/ 中/ 错误/ 的/ 将/ 不/ 一致/ 的/ 答案/ 判成/ 了/ 一致性/ 答案/ ./ 近似/ 一致性/ 判定/ 的/ 平均/ 准确率/ 为/ 70/ %/ ./ 6.2/ ./ 2/ 合成/ 数据/ 集上/ 算法/ 的/ 效率/ 和/ 准确度/ ./ 为了/ 进一步/ 研究/ 算法/ 的/ 性能/ ,/ 我们/ 在/ 合成/ 数据/ 集上/ 进行/ 了/ 一系列/ 的/ 实验/ ./ 首先/ 验证/ 了/ 评估/ 算法/ 的/ 时间/ 效率/ ./ 图/ 2/ 比较/ 了/ 基准/ 的/ 6/ 个/ 查询/ 直接/ 查询/ 得到/ 查询/ 结果/ 的/ 时间/ 效率/ 以及/ 查询/ 一致性/ 结果/ 的/ 效率/ ./ 从图/ 中/ 可以/ 看出/ ,/ Q2/ 的/ 一致性/ 查询/ 时间/ 较长/ ,/ 这/ 是因为/ Q2/ 的/ 一阶/ 改写/ 较为/ 复杂/ ./ Q5/ ,/ Q6/ 的/ 一致性/ 判定/ 为/ coNP/ -/ 完全/ 问题/ ./ 在/ 实际/ 判定/ 时/ ,/ 由于/ 连接/ 结果/ 可能/ 很小/ ,/ 可/ 迅速/ 的/ 判断/ 出其/ 一致性/ ,/ 即/ 近似/ 估计/ 算法/ 在/ 实际/ 计算/ 中/ 效率/ 不会/ 很差/ ./ 其次/ ,/ 实验/ 比较/ 了/ 评估/ 算法/ 的/ 准确性/ ./ 评估/ 的/ 准确性/ 由/ 两/ 部分/ 确定/ :/ (/ 1/ )/ 抽样/ 算法/ 的/ 相对误差/ 造成/ 的/ 准确性/ 降低/ ;/ (/ 2/ )/ 判定/ 算法/ 中/ 判定/ 查询/ 结果/ 是/ 一致/ 的/ 时候/ ,/ 使用/ 了/ 近似/ 的/ 方法/ ,/ 使得/ 最终/ 结果/ 可能/ 会/ 出现/ 将/ 一致/ 的/ 数据/ 误判/ 为/ 不/ 一致/ 的/ 数据/ ,/ 进而/ 造成/ 评估/ 值/ 小于/ 实际/ 值/ ./ 图/ 3/ 中/ 由于/ 近似/ 阈值/ 设置/ 在/ 0.5/ ,/ 即当/ 50/ %/ 的/ 修复/ 被/ 满足/ 时/ 认为/ 元组/ 在/ 一致性/ 结果/ 集中/ ,/ 造成/ 了/ coNP/ -/ Hard/ 查询/ 的/ 准确率/ 最低/ 在/ 50/ %/ 左右/ ./ 显然/ ,/ 能够/ 一阶/ 改写/ 的/ 查询/ 的/ 评估/ 准确率/ 为/ 100/ %/ ,/ 不能/ 被/ 一阶/ 改写/ 然而/ 可以/ 在/ 多项式/ 时间/ 内可解/ 的/ 查询/ 可以/ 使用/ 本文/ 介绍/ 的/ qrelax/ 改写/ 方法/ ,/ 得到/ 精确/ 的/ 一致性/ 解/ ./ Page106/ ./ 2.3/ 参数/ 对/ 算法/ 性能/ 的/ 影响/ ./ 首先/ 我们/ 考虑/ 抽样/ 算法/ 关于/ (/ ε/ ,/ δ/ )/ 的/ 相对误差/ 以及/ 样本容量/ 对/ 相对误差/ 的/ 影响/ ./ 实验/ 取/ ε/ 为/ 0.05/ ,/ 0.1/ ,/ 0.15/ ,/ 0.2/ ,/ δ/ 的/ 值取/ 0.1/ ,/ 即/ 10/ %/ ./ 实验/ 结果/ 如图/ 4/ 、/ 图/ 5/ 所示/ ./ 从图/ 4/ 中/ 我们/ 可以/ 看出/ ,/ 抽样/ 算法/ 的/ 相对误差/ 控制/ 在/ δ/ 附近/ ,/ 当/ ε/ 取/ 0.05/ 时/ ,/ 相对误差/ 的/ 值/ 为/ 8/ %/ ,/ ε/ 越大/ ,/ 相对误差/ 越小/ ./ 图/ 5/ 表明/ 了/ 随着/ 样本容量/ 的/ 增加/ ,/ 相对误差/ 逐渐/ 减小/ ./ 当/ 抽样/ 的/ 样本量/ 为/ 总体/ 的/ 20/ %/ 时/ ,/ 相对误差/ 低于/ 3/ %/ ./ 这/ 是因为/ 当/ 样本容量/ 增加/ 时/ ,/ 更/ 能够/ 反映/ 样本/ 的/ 总体/ 特征/ ,/ 从而/ 使/ 评估/ 值/ 更/ 接近/ 实际/ ./ 其次/ ,/ 考虑/ 了/ 在/ 近似/ 一致性/ 判定/ 算法/ 中/ ,/ 近似/ 阈值/ τ/ 对/ 近似/ 一致性/ 判定/ 准确率/ 的/ 影响/ ./ 此组/ 实验/ 取/ Q5/ 查询/ 5/ 次测试/ 的/ 平均/ 结果/ ,/ 结果/ 如图/ 6/ 所示/ ./ 可以/ 看出/ ,/ 随着/ 近似/ 阈值/ 的/ 增大/ ,/ 判定/ 的/ 准确度/ 随之/ 增加/ ./ 当/ 近似/ 阈值/ 为/ 0.7/ 时/ ,/ 一致性/ 判定/ 的/ 准确率/ 在/ 90/ %/ 以上/ ./ 显然/ ,/ 当/ 近似/ 阈值/ 较大/ 时/ ,/ 若/ 一个/ 元组/ 是/ 不/ 一致/ 回答/ ,/ 则/ 其/ 被/ 判定/ 为/ 不/ 一致/ 的/ 机会/ 也/ 大大增加/ ,/ 使得/ 最后/ 误判/ 的/ 结果/ 数量/ 减小/ ,/ 从而/ 提高/ 准确率/ ./ 此外/ ,/ 我们/ 还/ 分析/ 了/ 数据/ 集/ 不/ 一致/ 程度/ 以及/ 查询/ 结果/ 集/ 的/ 大小/ 对/ 评估/ 算法/ 效率/ 的/ 影响/ ,/ 实验/ 结果/ 如图/ 7/ 、/ 图/ 8/ 所示/ ./ 当/ 不/ 一致/ 程度/ 增加/ 时/ ,/ 满足/ 一致性/ 的/ 查询/ 回答/ 减少/ ,/ 对于/ coNP/ -/ Hard/ 一致性/ 查询/ 来说/ ,/ 其/ 判定/ 时间/ 也/ 会/ 减少/ ,/ 见图/ 7/ 中/ Q5/ ,/ Q6/ 的/ 评估/ 时间/ ,/ 也/ 随之/ 减少/ ,/ 对于/ 多项式/ 时间/ 及/ 一阶可/ 改写/ 查询/ 来说/ ,/ 其/ 变化/ 较/ 少/ ,/ 只是/ 因为/ 不/ 一致/ 程度/ 的/ 增加/ 不会/ 改变/ 数据/ 集/ 的/ 扫描/ 次数/ ,/ 对/ 时间/ 效率/ 上/ 不会/ 有太大/ 的/ 影响/ ./ 而/ 查询/ 结果/ 集/ 的/ 大小/ 对/ 一致性/ 查询/ 和/ 近似/ 一致性/ 查询/ 的/ 影响/ 很小/ ,/ 查询/ 时间/ 紧/ 随着/ 结果/ 集/ 的/ 增大/ 有着/ 小幅/ 增长/ ./ 需要/ 注意/ 的/ 是/ 对于/ coNP/ -/ Hard/ 一致性/ 查询/ 来说/ ,/ 由于/ 结果/ 集在/ 抽样/ 之后/ 可以/ 一次性/ 的/ 判定/ 其/ 一致性/ ,/ 因此/ ,/ 结果/ 集/ 的/ 增加/ 不会/ 使/ 时间/ 变化/ 过大/ ./ Page117/ 结论/ 和/ 未来/ 工作/ 本文/ 研究/ 了/ 违背/ 主键/ 约束/ 的/ 不/ 一致/ 数据/ 集中/ 的/ 查询/ 结果/ 一致性/ 估计/ 问题/ ./ 当/ 查询/ 不可/ 一阶/ 改写/ 且/ 不能/ 在/ 多项式/ 时间/ 计算/ 时/ ,/ 采用/ 简单/ 抽样/ 的/ 方法/ 给出/ 了/ 合取/ 查询/ 结果/ 集/ 关于/ 一致性/ 准确率/ 的/ (/ ε/ ,/ δ/ )/ -/ 估计/ ./ 抽样/ 算法/ 均匀/ 随机/ 的/ 抽取/ 查询/ 答案/ 集合/ ,/ 判定/ 样本/ 的/ 一致性/ ./ 由于/ 判定/ 答案/ 是否是/ 一致性/ 回答/ 的/ 问题/ 可能/ 是/ 难解/ 的/ ,/ 本文/ 定义/ 了/ 近似/ 一致性/ ,/ 以/ 大于/ 给定/ 的/ 近似/ 阈值/ 来/ 判定/ 答案/ 的/ 一致性/ ./ 下/ 一步/ 工作/ 将/ 考虑/ 一致性/ 依赖/ 是/ 其他/ 形式/ ,/ 比如/ 函数/ 依赖/ 时/ 查询/ 结果/ 的/ 一致性/ 估计/ 问题/ ,/ 以及/ 不/ 一致/ 数据/ 程度/ 对/ 查询/ 结果/ 一致性/ 的/ 影响/ ./ 

