Page1/ 针对/ AES/ 的/ Cache/ 计时/ 模板/ 攻击/ 研究/ 王韬/ 1/ )/ 赵新杰/ 1/ )/ 郭/ 世泽/ 2/ )/ 张帆/ 3/ )/ 刘会英/ 1/ )/ 郑/ 天明/ 1/ )/ 1/ )/ (/ 军械/ 工程学院/ 计算机/ 工程系/ 石家庄/ 050003/ )/ 2/ )/ (/ 北方/ 电子设备/ 研究所/ 北京/ 100083/ )/ 3/ )/ (/ 康涅狄格/ 大学/ 计算机科学/ 与/ 工程系/ 斯托斯/ 康涅狄格州/ 06269/ 美国/ )/ 摘要/ 受/ 微处理器/ 硬件/ 架构/ 和/ 操作系统/ 的/ 影响/ ,/ 分组/ 密码/ 查找/ S/ 盒/ 不同/ 索引/ 执行/ 时间/ 存在/ 差异/ ,/ 构成/ 了/ S/ 盒/ 索引/ 的/ 天然/ 泄漏/ 源/ ./ 该文/ 采用/ “/ 面向/ 字节/ 、/ 分而治之/ ”/ 的/ 旁路/ 攻击/ 思想/ ,/ 对/ AES/ 抗/ Cache/ 计时/ 模板/ 攻击能力/ 进行/ 了/ 研究/ ./ 首先/ 分析/ 了/ 分组/ 密码/ 访问/ Cache/ 时间/ 差异/ 泄漏/ 机理/ ,/ 直观/ 地/ 给出/ 了/ 基于/ 碰撞/ 和/ 模板/ 的/ 两种/ Cache/ 计时/ 攻击/ 方法/ ;/ 其次/ 给出/ 了/ Cache/ 计时/ 外部/ 模板/ 攻击/ 模型/ ,/ 提出/ 了/ 基于/ Pearson/ 相关性/ 的/ 模板/ 匹配/ 算法/ ,/ 对/ 128/ 位/ AES/ 加密/ 第一轮/ 和/ 最后/ 一轮/ 分别/ 进行/ 了/ 攻击/ 应用/ ;/ 为/ 克服/ 外部/ 模板/ 攻击/ 需要/ 一个/ 模板/ 密码/ 服务器/ 的/ 限制/ ,/ 提出/ 了/ Cache/ 计时/ 内部/ 模板/ 攻击/ 模型/ ,/ 并/ 对/ AES/ 进行/ 了/ 攻击/ 应用/ ;/ 最后/ ,/ 在/ 不同/ 环境/ 、/ 操作系统/ 、/ 加密/ Cache/ 初始状态/ 、/ 密码/ 库中/ ,/ 分别/ 进行/ 攻击/ 实验/ ,/ 同/ 前人/ 工作/ 进行/ 了/ 比较/ 分析/ ,/ 并/ 给出/ 了/ 攻击/ 的/ 有效/ 防御/ 措施/ ./ 关键词/ 高级/ 加密/ 标准/ ;/ 分组/ 密码/ ;/ Cache/ 计时/ 攻击/ ;/ 模板/ 攻击/ ;/ 查找/ S/ 盒/ ;/ 防御/ 措施/ 1/ 引言/ 1.1/ 相关/ 工作/ Cache/ 访问/ 过程/ 中/ ,/ 可/ 通过/ 执行/ 时间/ 、/ 能量消耗/ (/ 电磁辐射/ )/ 等/ 旁路/ 产生/ 一定/ 的/ 信息/ 泄露/ ./ Kocher/ [/ 1/ ]/ 和/ Kelsey/ [/ 2/ ]/ 在/ 20/ 世纪/ 90/ 年代/ 中期/ 提出/ 将/ 这些/ 旁路/ 信息/ 用于/ 密码/ 破解/ 的/ 思想/ ,/ 随后/ 密码/ 学家/ 在/ 此基础/ 上/ 实现/ 了/ 针对/ 分组/ 密码/ 的/ 各种/ Cache/ 攻击/ [/ 3/ -/ 33/ ]/ ./ 根据/ 所/ 采集/ 物理/ 效应/ 的/ 分类/ 不同/ ,/ 可/ 将/ Cache/ 攻击/ 分为/ Cache/ 计时/ 攻击/ 和/ Cache/ 功耗/ 分析/ (/ 电磁/ )/ 攻击/ 两种/ ;/ 根据/ 信息/ 采集/ 模型/ 不同/ ,/ 可/ 将/ Cache/ 攻击/ 分为/ 时序/ 驱动/ (/ timedriven/ )/ 、/ 访问/ 驱动/ (/ accessdriven/ )/ 、/ 踪迹/ 驱动/ (/ tracedriven/ )/ 3/ 种/ ./ 时序/ 驱动/ 攻击/ [/ 4/ -/ 11/ ]/ 主要/ 通过/ 计时/ 手段/ 采集/ 整个/ 密码/ 加/ // 解密/ 时间/ ,/ 利用/ 统计/ 方法/ 分析/ 密钥/ ./ 文献/ [/ 4/ -/ 7/ ]/ 利用/ Cache/ 命中/ 和/ 失效/ 次数/ 同/ 密码/ 整体/ 的/ 执行/ 时间/ 关系/ 对/ DES/ 、/ AES/ 进行/ 了/ 攻击/ ,/ 这种/ 攻击/ 可/ 简称/ 为/ “/ Cache/ 碰撞/ 计时/ 攻击/ ”/ ./ 文献/ [/ 8/ ]/ 利用/ 查找/ S/ 盒/ 不同/ 索引/ 的/ 执行/ 时间/ 同/ 密码/ 整体/ 执行/ 时间/ 的/ 关系/ ,/ 通过/ 模板/ 分析/ 的/ 方法/ 对/ AES/ 进行/ 了/ 远程/ 计时/ 攻击/ ,/ 该/ 攻击/ 可/ 简称/ 为/ “/ Cache/ 计时/ 模板/ 攻击/ ”/ ./ 后续/ 研究者/ 对/ 文献/ [/ 8/ ]/ 中/ 的/ 攻击/ 进行/ 了/ 再现/ [/ 9/ ]/ 、/ 分析/ [/ 10/ ]/ 以及/ 扩展/ [/ 11/ ]/ ./ 时序/ 驱动/ 攻击/ 所/ 需/ 样本量/ 大/ ,/ 分析方法/ 相对/ 复杂/ ,/ 但/ 采集/ 方法/ 简单/ ,/ 跨平台/ 适用/ 能力/ 强/ ./ 访问/ 驱动/ 攻击/ [/ 12/ -/ 25/ ]/ 主要/ 利用/ 多/ 进程/ 共享/ Cache/ 资源/ 特性/ ,/ 使用/ 一个/ 恶意/ 进程/ S/ 通过/ 读取/ 私有/ 数据/ 在/ 密码/ 进程/ V/ 执行/ (/ 某次/ 查找/ 表/ 或/ 整个/ 加密/ )/ 前/ 清空/ Cache/ ,/ 然后/ 在/ V/ 执行/ 后/ 再次/ 启动/ S/ 观察/ 私有/ 数据/ 被/ 替换/ 情况/ ,/ 根据/ 二次/ 访问/ 执行/ 时间/ 推断/ S/ 和/ V/ 的/ 外部/ Cache/ 访问/ 碰撞/ ,/ 获取/ V/ 访问/ Cache/ 行/ 地址/ ,/ 并/ 结合/ 算法/ 进行/ 密钥/ 分析/ ./ 文献/ [/ 12/ ]/ 首次/ 指出/ 多线程/ 共享/ Cache/ 访问/ 方式/ 可/ 为/ 恶意/ 线程/ 监视/ 采集/ 密码/ 线程/ Cache/ 访问/ 地址/ 提供/ 入口/ ,/ 使得/ 恶意/ 线程/ 能够/ 窃取/ 加密/ 密钥/ ,/ 并/ 实现/ 了/ 针对/ RSA/ 的/ 访问/ 驱动/ Cache/ 计时/ 攻击/ ./ 之后/ ,/ 基于/ 该/ 思想/ ,/ 研究者/ 对/ AES/ [/ 13/ -/ 19/ ]/ 、/ Camellia/ [/ 20/ ]/ 、/ ARIA/ [/ 21/ ]/ 、/ SMS4/ [/ 22/ ]/ 等/ 分组/ 密码/ ,/ HC/ -/ 256/ [/ 23/ ]/ 、/ SNOW3G/ [/ 24/ ]/ 、/ RC4/ [/ 25/ ]/ 等流/ 密码/ 进行/ 了/ 攻击/ 应用/ ./ 同时/ 序/ 驱动/ 攻击/ 相比/ ,/ 访问/ 驱动/ 攻击/ 采集/ 方法/ 比/ 时序/ 驱动/ 稍显/ 复杂/ ,/ 但/ 分析方法/ 简单/ ,/ 一般/ 通过/ 计时/ 手段/ 实现/ ,/ 主要/ 适用/ 于/ 支持/ 多/ 进程/ 或/ 线程/ 的/ 微处理器/ 平台/ ./ 踪迹/ 驱动/ 攻击/ [/ 26/ -/ 33/ ]/ 需/ 精确/ 采集/ 一次/ 密码/ 加密/ 多次/ 查表/ 导致/ 的/ 内部/ Cache/ 访问/ 碰撞/ 信息/ ,/ 得到/ 每次/ 加密/ 所有/ 查表/ 的/ Cache/ 命中/ 和/ 失效/ 序列/ ,/ 在/ 此基础/ 上/ 结合/ 算法/ 进行/ 密钥/ 分析/ ./ 文献/ [/ 26/ ]/ 首先/ 提出/ 踪迹/ 驱动/ 攻击/ 思想/ ,/ 文献/ [/ 27/ ]/ 首次/ 通过/ 功耗/ 仿真/ 对/ AES/ 进行/ 了/ 攻击/ 尝试/ ,/ 后续/ 研究者/ 通过/ 仿真/ 手段/ 对/ OPENSSL/ 中/ 的/ 快速/ AES/ 实现/ 的/ 第一轮/ [/ 28/ ]/ 、/ 第二轮/ [/ 29/ ]/ 、/ 最后/ 一轮/ [/ 30/ ]/ 进行/ 了/ 分析/ ,/ 通过/ 功耗/ [/ 32/ ]/ 、/ 电磁/ [/ 33/ ]/ 手段/ 对/ 适用/ 紧凑型/ S/ 盒/ 的/ AES/ 实现/ 进行/ 了/ 物理攻击/ 实验/ ./ 一般来说/ ,/ Cache/ 访问/ 内部/ 碰撞/ 采集/ 通过/ 计时/ 手段/ 很难/ 实现/ ,/ 常/ 通过/ 功耗/ 或/ 电磁/ 采集/ 手段/ 进行/ ,/ 攻击/ 主要/ 适用/ 于/ 嵌入式/ 处理器/ 平台/ ,/ 需/ 物理/ 接触/ 密码/ 设备/ ,/ 远程/ 攻击/ 可行性/ 不强/ ./ 上述/ 3/ 种/ 攻击/ 中/ ,/ 通过/ 分区/ Cache/ 、/ 将/ S/ 盒/ 预先/ 加载/ 到/ Cache/ 中等/ 实现/ [/ 8/ ,/ 14/ ,/ 34/ -/ 36/ ]/ ,/ 可/ 消除/ Cache/ 碰撞/ 信息/ 对/ 整体/ 执行/ 时间/ 的/ 影响/ 、/ 阻止/ 攻击者/ 采集/ Cache/ 碰撞/ 信息/ ,/ 进而/ 可/ 有效/ 地/ 防御/ 时序/ 驱动/ 攻击/ 中/ 的/ Cache/ 碰撞/ 计时/ 攻击/ 、/ 访问/ 驱动/ 攻击/ 和/ 踪迹/ 驱动/ 攻击/ ./ 但/ 由于/ 查找/ S/ 盒/ 不同/ 索引/ 的/ 时间/ 差异/ 受/ CPU/ 硬件/ 架构/ 、/ 操作系统/ 等/ 多种/ 因素/ 影响/ ,/ 很难/ 从根本上/ 消除/ 掉/ ,/ 现有/ 措施/ 不能/ 有效/ 防御/ Cache/ 计时/ 模板/ 攻击/ ./ 有/ 研究者/ 指出/ [/ 11/ ]/ ,/ 即使/ 在/ 加密/ 前/ 将/ S/ 盒/ 提前/ 加载/ 到/ Cache/ 中/ ,/ 使得/ 加密/ 每次/ 查表/ 均/ 发生/ Cache/ 命中/ ,/ 仍/ 不能/ 完全/ 消除/ 掉/ 查表/ 执行/ 时间/ 差异/ ,/ 存在/ 遭受/ Cache/ 计时/ 模板/ 攻击/ 的/ 风险/ ./ 因此/ ,/ 本文/ 主要/ 对/ Cache/ 计时/ 模板/ 攻击/ 进行/ 研究/ ./ 在/ Cache/ 计时/ 模板/ 攻击/ 方面/ ,/ Bernstein/ [/ 8/ ]/ 在/ 强制/ 消除/ 网络/ 传输/ 时延/ 条件/ 下/ ,/ 实现/ 了/ 一种/ 针对/ OpenSSL/ -/ 0.9/ ./ 7a/ 中/ AES/ 加密/ 第一轮/ 的/ 远程/ Cache/ 计时/ 攻击/ ,/ 使用/ 227.5/ 个/ 样本/ 恢复/ 出/ 128/ 位/ AES/ 密钥/ ./ 攻击/ 中/ ,/ 密码/ 服务端/ 负责/ 采集/ AES/ 加密/ 时间/ 并/ 发送给/ 攻击/ 端/ ,/ 本质/ 仍属/ 本地/ 攻击/ ./ Bernstein/ 首先/ 搭建/ 了/ 一台/ 同/ 目标/ 密码/ 服务器/ 相同/ 配置/ 的/ 模板/ 密码/ 服务器/ ,/ 在/ 已知/ 密钥/ 情况/ 下/ 采集/ 到/ 对/ 大量/ 样本/ 的/ 加密/ 时间/ ,/ 并/ 计算/ 第一轮/ 每个/ 查表/ 索引/ 对应/ 256/ 个/ 聚类/ 的/ 平均/ 时间/ 标准差/ (/ 每个/ 聚类/ 平均/ 时间/ 同/ 所有/ 聚类/ 的/ 平均/ 时间/ 之差/ )/ ,/ 得到/ 一条/ 模板/ 曲线/ ;/ 然后/ 对/ 目标/ 密码/ 服务器/ 在/ 未知/ 密钥/ 情况/ 下/ 采集/ 大量/ 样本/ 的/ 加密/ 时间/ ,/ 通过/ 预测/ 每个/ 密钥/ 字节/ 候选/ 值/ ,/ 计算/ 第一轮/ 每个/ 查表/ 索引/ 对应/ 的/ 256/ 个/ 聚类/ 的/ 平均/ 时间/ 标准差/ ,/ 得到/ 一条/ 预测/ 曲线/ ;/ 再/ 通过/ 计算/ 这/ 两条/ 曲线/ 256/ 个点/ 的/ 平均/ 时间/ 标准差/ 乘积/ 并/ 求和/ ,/ 得出/ 两条/ 曲线/ 匹配/ 度/ ./ 正确/ 的/ 密钥/ 字节/ 候选/ 值/ 对应/ 的/ 匹配/ 度/ 较/ 高/ ,/ 否则/ 较/ 低/ ./ Bernstein/ 攻击/ 存在/ 以下/ 潜在/ 问题/ :/ 一是/ 计算/ 的/ 曲线/ 匹配/ 度/ 未/ 进行/ 归一化/ 处理/ ,/ 匹配/ 算法/ 准确度/ 有待/ 提高/ ;/ 二是/ 攻击/ 条件/ 过于/ 严格/ ,/ 需/ 获取/ 同/ 目标/ 密码/ 服务器/ 一样/ 配置/ 的/ 模板/ 密码/ 服务器/ ,/ 并/ 能/ 控制/ 其/ 在/ 密钥/ 已知/ 时/ 进行/ 密码/ 运算/ ,/ 搭建/ 时间/ 模板/ ./ 本/ Page3/ 文/ 工作/ 主要/ 是/ 围绕/ 上述/ 两个/ 问题/ 开展/ 的/ ./ 1.2/ 本文/ 的/ 贡献/ 本文/ 对/ Cache/ 计时/ 模板/ 攻击/ 进行/ 了/ 一定/ 的/ 研究/ ,/ 并/ 以/ AES/ 为例/ 进行/ 了/ 攻击/ 应用/ ,/ 主要/ 研究/ 贡献/ 如下/ :/ (/ 1/ )/ 分析/ 了/ 分组/ 密码/ 查找/ S/ 盒/ Cache/ 访问/ 时间/ 泄漏/ 的/ 机理/ ,/ 直观/ 给出/ 了/ 如何/ 利用/ 时间/ 差异/ 进行/ 密钥/ 分析/ 的/ 方法/ ./ 分组/ 密码/ 时序/ 驱动/ Cache/ 攻击/ 主要/ 是/ 利用/ S/ 盒/ 操作/ 时间/ 差异/ 对/ 整体/ 加密/ 时间/ 的/ 影响/ 进行/ 密钥/ 分析/ ./ 我们/ 认为/ S/ 盒/ 查表/ 操作/ 时间/ 差异/ 可/ 划分/ 为/ 两类/ :/ 一是/ 加密/ 两次/ ,/ 查找/ 同一个/ S/ 盒/ Cache/ 访问/ 时/ 命中/ 和/ 失效/ 的/ 时间/ 差异/ ,/ 二是/ 利用/ 加密/ 一次/ 查找/ 同一个/ S/ 盒/ 不同/ 索引/ 的/ 执行/ 时间/ 差异/ ./ 现有/ 时序/ 驱动/ Cache/ 攻击/ [/ 4/ -/ 11/ ]/ 本质/ 上/ 都/ 属于/ 这/ 两类/ 中/ 的/ 某/ 一类/ ,/ 大都/ 仅/ 给出/ 原理/ 说明/ ,/ 细节/ 阐述/ 很少/ ./ 本文/ 首次/ 直观/ 地/ 给出/ 了/ 这/ 两类/ 时间/ 差异/ 的/ 特征/ 以及/ 如何/ 利用/ 其/ 进行/ 密钥/ 分析/ 的/ 方法/ ,/ 同时/ 对/ 时间/ 差异/ 泄漏/ 机理/ 和/ 攻击/ 防御/ 难度/ 也/ 进行/ 了/ 比较/ 分析/ ./ (/ 2/ )/ 提出/ 了/ 一种/ 新/ 的/ 基于/ 计算/ Pearson/ 相关性/ 的/ Cache/ 计时/ 模板/ 匹配/ 算法/ ./ Bernstein/ [/ 8/ ]/ 给出/ 了/ 一种/ Cache/ 计时/ 外部/ 模板/ 攻击/ ,/ 主要/ 针对/ AES/ 加密/ 第一轮/ 进行/ ,/ 其/ 模板/ 匹配/ 方法/ 是/ 将/ 已知/ 密钥/ 时/ 查表/ 索引/ 对应/ 计时/ 标准差/ 模板/ 曲线/ 、/ 未知/ 密钥/ 字节/ 预测/ 查表/ 索引/ 对应/ 计时/ 标准差/ 曲线/ 上/ 256/ 个点/ 简单/ 乘积/ 加/ 和/ ,/ 最大/ 匹配/ 度/ 对应/ 的/ 预测值/ 即/ 为/ 正确/ 密钥/ 字节/ 值/ ,/ 匹配/ 度/ 未/ 进行/ 归一化/ 处理/ ./ 本文/ 首先/ 给出/ Cache/ 计时/ 外部/ 模板/ 攻击/ 模型/ ,/ 并/ 提出/ 一种/ 新/ 的/ 基于/ 计算/ Pearson/ 相关性/ 的/ Cache/ 计时/ 模板/ 匹配/ 算法/ ,/ 然后/ 对/ AES/ 加密/ 第一轮/ 和/ 最后/ 一轮/ 均/ 进行/ 攻击/ 和/ 分析/ ./ 新/ 模板/ 匹配/ 算法/ 通过/ 计算/ 模板/ 曲线/ 、/ 预测/ 曲线/ 间/ 的/ Pearson/ 相关性/ 系数/ ,/ 对/ 模板/ 匹配/ 度/ 进行/ 归一化/ 处理/ ,/ 提高/ 了/ 正确/ 密钥/ 字节/ 可/ 识别/ 度/ ,/ 降低/ 了/ 攻击/ 所/ 需/ 的/ 样本量/ ./ 模型/ ./ (/ 3/ )/ 提出/ 了/ 一种/ 新/ 的/ Cache/ 计时/ 内部/ 模板/ 攻击/ Bernstein/ 攻击/ [/ 8/ ]/ 属于/ 外部/ 模板/ 攻击/ ,/ 攻击/ 假定/ 可/ 预先/ 获取/ 一个/ 同/ 目标/ 密码/ 服务器/ 一样/ 配置/ 的/ 模板/ 密码/ 服务器/ ,/ 并/ 能够/ 使用/ 已知/ 密钥/ 执行/ 大量/ 的/ 加密/ 操作/ ,/ 采集/ 加密/ 时间/ 构建/ 模板/ ./ 实际/ 情况/ 下/ ,/ 这种/ 条件/ 过于/ 严格/ ,/ 而且/ 在/ 外部/ 模板/ 攻击/ 中/ ,/ 用于/ 搭建/ 模板/ 的/ 密码/ 服务器/ 上/ 的/ 运行/ 环境/ 很难/ 保证/ 同/ 目标/ 密码/ 服务器/ 完全一致/ ,/ 而/ 这种/ 环境/ 的/ 差异/ 信息/ 对/ 攻击/ 成功率/ 存在/ 很大/ 的/ 影响/ ./ 为/ 解决/ 上述/ 问题/ ,/ 本文/ 提出/ 了/ 一种/ 新/ 的/ Cache/ 计时/ 内部/ 模板/ 攻击/ 模型/ ,/ 并/ 对/ AES/ 第一轮/ 和/ 最后/ 一轮/ 进行/ 了/ 攻击/ 分析/ ./ 攻击者/ 可/ 直接/ 采集/ 目标/ 服务器/ 加密/ 时间/ ,/ 然后/ 利用/ 不同/ 次/ 查找/ 同一个/ S/ 盒/ 的/ 时间/ 搭建/ 内部/ 计时/ 模板/ ,/ 通过/ 计算/ Pearson/ 相关性/ 系数/ 的/ 模板/ 匹配/ 方法/ 恢复/ 相关/ 密钥/ ./ 由于/ 内部/ 模板/ 搭建/ 可/ 在/ 目标/ 密码/ 服务器/ 上/ 直接/ 进行/ ,/ 模板/ 搭建/ 和/ 匹配/ 准确度/ 相对/ 较/ 高/ ,/ 攻击/ 样本量/ 比/ 外部/ 模板/ 攻击/ 相对/ 要/ 小/ ./ (/ 4/ )/ 分析/ 和/ 评估/ 了/ 不同/ 环境/ 下/ AES/ 实现/ 抗/ Cache/ 计时/ 模板/ 攻击/ 的/ 能力/ ,/ 并/ 给出/ 攻击/ 的/ 一种/ 有效/ 防御/ 措施/ ./ 现有/ 的/ 时序/ 驱动/ Cache/ 计时/ 攻击/ [/ 4/ -/ 11/ ]/ 大都/ 在/ 单一/ 环境/ 下/ 针对/ 单一/ AES/ 实现/ 进行/ ,/ 我们/ 则/ 利用/ Cache/ 计时/ 模板/ 攻击/ 对/ 本地/ 远程/ 环境/ 、/ 不同/ 操作系统/ 、/ 不同/ 加密/ 前/ Cache/ 初始状态/ 、/ 不同/ 密码/ 库下/ 的/ AES/ 实现/ 安全性/ 进行/ 了/ 分析/ 和/ 评估/ ,/ 试图/ 研究/ AES/ 实现/ 在/ 不同/ 环境/ 下/ 的/ 抗/ Cache/ 计时/ 模板/ 攻击/ 的/ 能力/ ,/ 并/ 给出/ 有效/ 防御/ 措施/ ./ 结果表明/ :/ 由于/ 网络/ 传输/ 时延/ 甚至/ 其/ 抖动/ 远大于/ 不同/ 输入/ 的/ 加密/ 时间/ 差异/ ,/ 远程/ 环境/ 下/ 的/ 分组/ 密码/ Cache/ 计时/ 模板/ 攻击/ 可行性/ 不高/ ;/ 加密/ 前/ 将/ S/ 盒/ 预先/ 加载/ 到/ Cache/ 中/ 可/ 有效/ 防御/ Cache/ 碰撞/ 计时/ 攻击/ 、/ 访问/ 驱动/ 和/ 踪迹/ 驱动/ Cache/ 计时/ 攻击/ ,/ 但/ 由于/ 其/ 不能/ 消除/ 查找/ 不同/ S/ 盒/ 索引/ 的/ 访问/ 时间/ 差异/ ,/ 因而/ 不能/ 有效/ 防御/ Cache/ 计时/ 模板/ 攻击/ ;/ 最新/ 的/ 各类/ 密码/ 库/ ,/ 如/ OpenSSL/ -/ 0.9/ ./ 8j/ 、/ Mir/ -/ acl5/ ./ 0/ 、/ LibTomCrypt1/ ./ 17/ 、/ Crypto/ ++/ 5.6/ ./ 1/ 中/ AES/ 实现/ 仍然/ 是/ 不/ 安全/ 的/ ;/ 防御/ 可/ 通过/ 在/ AES/ 加密/ 首轮/ 、/ 末轮/ 将/ 查找/ 表/ 预先/ 加载/ 到/ Cache/ 中/ ,/ 并/ 增加/ 一定/ 的/ 随机/ 时延/ 来/ 实现/ ./ 1.3/ 结构/ 组织/ 本文/ 第/ 2/ 节/ 给出/ Cache/ 访问/ 机制/ 、/ 查找/ S/ 盒/ 访问/ Cache/ 时间/ 泄漏/ 机理/ 和/ 密钥/ 分析方法/ ;/ 第/ 3/ 节/ 给出/ Cache/ 计时/ 外部/ 模板/ 攻击/ 模型/ 和/ 对/ AES/ 攻击/ 应用/ ,/ 并/ 和/ 前人/ 工作/ 进行/ 了/ 比较/ ;/ 第/ 4/ 节/ 给出/ Cache/ 计时/ 内部/ 模板/ 攻击/ 模型/ 和/ 对/ AES/ 攻击/ 应用/ ,/ 并/ 对/ 两种/ 模板/ 攻击/ 进行/ 比较/ 分析/ ;/ 第/ 5/ 节对/ 不同/ 环境/ 、/ 不同/ 操作系统/ 、/ 不同/ 加密/ Cache/ 初始状态/ 、/ 不同/ 密码/ 库下/ 的/ AES/ 实现/ 安全性/ 进行/ 分析/ 和/ 评估/ ;/ 第/ 6/ 节/ 给出/ 一种/ 攻击/ 防御/ 措施/ ;/ 第/ 7/ 节/ 总结/ 全文/ ./ 2Cache/ 结构/ 与/ 信息/ 泄露/ 分析/ 2.1/ Cache/ 访问/ 机制/ 现代/ 微处理器/ 大都/ 使用/ 高速缓存/ Cache/ 来/ 解决/ Page4CPU/ 与/ 主存/ 之间/ 速度/ 不/ 匹配/ 的/ 问题/ ./ 假设/ 整个/ Cache/ 包括/ S/ 个/ Cache/ 组/ ,/ 每组/ 有/ W/ 个/ Cache/ 行/ ,/ 每行/ 有/ δ/ 个/ 元素/ (/ B/ 字节/ )/ ,/ 则/ 整个/ Cache/ 大小/ 为/ S/ ×/ W/ ×/ δ/ ×/ B/ 字节/ ./ CPU/ 读取/ 主存/ 中/ 的/ 一个/ 字/ a/ 时/ ,/ 首先/ 将/ a/ 地址/ 放入/ 地址/ 寄存器/ ,/ Cache/ 控制/ 逻辑/ 依据/ 地址/ 判断/ a/ 当前/ 是否/ 在/ Cache/ 中/ ,/ 如果/ 是/ 则/ 地址变换/ 成功/ ,/ 发生/ “/ Cache/ 命中/ ”/ ,/ 从/ Cache/ 中/ 直接/ 读取/ a/ ;/ 否则/ 发生/ “/ Cache/ 失效/ ”/ ,/ 根据/ 程序/ 局部性/ 原理/ ,/ 把/ 包括/ a/ 在内/ 的/ 一整块/ 数据/ (/ δ/ 个/ Cache/ 元素/ )/ 从/ 主存/ 中/ 读出来/ ,/ 装载/ 到/ Cache/ 中去/ ,/ 然后/ 从/ Cache/ 中/ 读取/ a/ ./ 对于/ 典型/ 处理器/ 来说/ ,/ Cache/ 命中/ 所/ 需/ 时间/ 较/ 少/ ,/ 一般/ 为/ 2/ ~/ 3/ 个/ 时钟/ 周期/ ,/ 而/ 失效/ 则/ 一般/ 需要/ 10/ ~/ 14/ 个/ ./ 需要/ 指出/ 的/ 是/ ,/ 如/ 无/ 特殊/ 说明/ ,/ 文中/ 的/ 加密/ 时间/ 都/ 是/ 以/ 时钟/ 周期/ 为/ 基本/ 单位/ ./ 现代/ 分组/ 密码/ 大都/ 使用/ S/ 盒/ 查表/ 操作/ ,/ 访问/ Cache/ ,/ 提高/ 算法/ 的/ 执行/ 效率/ ,/ 但/ 由于/ 其/ 整体/ 加密/ 时间/ 受/ Cache/ 结构/ 和/ 访问/ 机制/ 影响/ ,/ 可/ 在/ 某种程度/ 上/ 泄露/ 出/ S/ 盒/ 查表/ 索引/ 信息/ ,/ 给/ 密钥/ 安全/ 带来/ 严重威胁/ ./ 影响/ 密码/ 整体/ 加密/ 时间/ 的/ 因素/ 有/ 很多/ ,/ 本文/ 主要/ 从/ S/ 盒/ 查表/ 操作/ 时间/ 对/ 整个/ 加密/ 时间/ 的/ 影响/ 进行/ 分析/ ./ 总的来说/ ,/ S/ 盒/ 查表/ 操作/ 时间/ 对/ 整体/ 加密/ 时间/ 的/ 影响/ 分为/ 两类/ :/ 一是/ 加密/ 两次/ 查找/ S/ 盒/ Cache/ 访问/ 命中/ 和/ 失效/ 的/ 时间/ 差异/ ,/ 常用/ 于/ “/ Cache/ 碰撞/ 计时/ 攻击/ ”/ ;/ 二是/ 利用/ 加密/ 查找/ S/ 盒/ 不同/ 索引/ 的/ 执行/ 时间/ 差异/ ,/ 常用/ 于/ “/ Cache/ 计时/ 模板/ 攻击/ ”/ ./ 下面/ 分别/ 给出/ 如何/ 利用/ 这/ 两类/ 信息/ 进行/ 密钥/ 分析/ 的/ 方法/ ./ 2.2/ 查找/ S/ 盒/ Cache/ 访问/ 命中/ 和/ 失效/ 时间/ 信息/ 泄露/ 分析/ 如图/ 1/ 所示/ ,/ pi/ 和/ pj/ 是/ 一次/ 加密/ 过程/ 中/ 两个/ 明文/ 字节/ ,/ ki/ 和/ kj/ 是/ 对应/ 的/ 密钥/ 字节/ ./ 以/ AES/ [/ 37/ ]/ 加密/ 第一轮/ 查找/ 表/ ①/ T0/ 为例/ ,/ 对于/ 两次/ 查/ T0/ 表/ 操作/ ,/ 首先/ 按照/ 明文/ 字节/ 差分/ pi/ / pj/ 将/ 大量/ 样本/ 的/ 整个/ 加密/ 时间/ 划分/ 为/ 256/ 个/ 聚类/ ,/ 并/ 计算/ 每个/ 聚类/ 的/ 平均/ 加密/ 时间/ ./ 如果/ 两次/ 查表/ 索引/ 相同/ ,/ 则/ 第二次/ 查表/ 会/ 发生/ Cache/ 命中/ ,/ 满足/ 此时/ pi/ / pj/ 值/ 对应/ 的/ 聚类/ 样本/ 加密/ 时间/ 较/ 短/ ,/ 否则/ 较长/ ./ 也就是说/ ,/ 加密/ 时间/ 较/ 短/ 聚类/ 对应/ 的/ 即/ 为/ pi/ / pj/ 的/ 值/ ,/ 事实上/ 就是/ ki/ / kj/ 值/ ./ 当/ 考虑/ 到/ Cache/ 调度/ 策略/ 和/ 程度/ 的/ 局部性/ 原理/ ,/ 发生/ Cache/ 命中/ 时/ ,/ AES/ 加密/ 两次/ 查找/ T0/ 表/ 的/ 索引/ 值/ y/ 的/ 高/ 8/ -/ log2/ (/ δ/ )/ 位/ (/ 表示/ 为/ 〈/ y/ 〉/ )/ 相同/ ,/ 即/ 〈/ pi/ / ki/ 〉/ =/ 〈/ pj/ / kj/ 〉/ / 〈/ ki/ / kj/ 〉/ =/ 〈/ pi/ / pj/ 〉/ (/ 2/ )/ 此时/ 会/ 有/ 连续/ 的/ δ/ 个/ pi/ / pj/ 值/ 对应/ 聚类/ 的/ 平均/ 加密/ 时间/ 较/ 短/ ./ 图/ 2/ 为/ Athlon643000/ +/ 1.81/ GHz/ 处理器/ 下/ (/ δ/ =/ 16/ )/ 221/ 样本/ 时/ ,/ OpenSSL/ -/ 0.9/ ./ 8a/ [/ 38/ ]/ 中/ AES/ 第一轮/ 前/ 两次/ 查找/ T0/ 表/ 根据/ p0/ / p4/ 值/ 划分/ 的/ 256/ 个/ 聚类/ 的/ 平均/ 访问/ 时间/ ,/ 可以/ 看出/ ,/ 当/ p0/ / p4/ 的/ 高/ 4/ 位值/ 为/ 7/ 时/ ,/ 其/ 对应/ 平均/ 加密/ 时间/ 较/ 短/ ,/ 而/ 真实/ 的/ p0/ / p4/ 值为/ 0x78/ ./ 图/ 2p0/ / p4/ 的/ 256/ 候选/ 值/ 对应/ 的/ AES/ 平均/ 加密/ 时间/ 2.3/ 查找/ S/ 盒/ 不同/ 索引/ 时间/ 信息/ 泄露/ 分析/ 2.2/ 节/ 考虑/ 的/ 是/ 同/ 一次/ 加密/ 两次/ 查找/ S/ 盒时/ ,/ 第二次/ 查找/ S/ 盒/ 发生/ 的/ Cache/ 命中/ 和/ 失效/ 对/ 整体/ 加密/ 时间/ 的/ 影响/ ,/ 本节/ 则/ 主要/ 考虑/ 单次/ 查找/ S/ 盒/ 不同/ 索引/ 访问/ 时间/ 对/ 整体/ 加密/ 时间/ 影响/ ./ 受/ 处理器/ 硬件/ 架构/ 、/ 操作系统/ 、/ Cache/ 调度/ 策略/ 等/ 因素/ 影响/ ,/ 分组/ 密码/ 查找/ S/ 盒/ 不同/ 索引/ 的/ 访问/ 时间/ 也/ 不尽相同/ ./ Bernstein/ [/ 8/ ]/ 指出/ :/ 大量/ 样本/ 的/ 查找/ 分组/ 密码/ S/ 盒/ 不同/ 索引/ 的/ 平均/ 访问/ 时间/ 可以/ 用来/ 进行/ 精确/ 建模/ ,/ 作为/ 计时/ 模板/ 信息/ ./ 图/ 3/ 为/ WindowsXPSP2/ 环境/ 、/ Athlon643000/ +/ 1.81/ GHz/ 处理器/ 下/ (/ δ/ =/ 16/ )/ ,/ 使用/ 两个/ 已知/ 的/ 不同/ 随机/ 密钥/ 对/ 221/ 样本/ 加密/ 时/ ,/ OpenSSL/ -/ 0.9/ ./ 8a/ 中/ AES/ 第一轮/ 查找/ T0/ 表/ (/ 图/ 3/ (/ a/ )/ )/ 、/ T3/ 表/ (/ 图/ 3/ (/ b/ )/ )/ 的/ 256/ 个/ 索引/ 值/ 对应/ 的/ 平均/ 加密/ 时间/ 标准差/ ./ 平均/ 加密/ 时间/ 标准差/ 是/ 指/ 某个/ 索引/ 值聚类/ 对应/ 的/ 平均/ 加密/ 时间/ 减去/ 所有/ 加密/ 样本/ 平均/ 加密/ 时间/ 差值/ ./ 可以/ 看出/ ,/ 同一/ 查找/ 表/ 的/ 256/ 个/ 索引/ 值/ 对应/ 平均/ 加密/ 时间/ 标准差/ 确实/ 不尽相同/ ,/ 而且/ 不同/ 查找/ 表/ 的/ 相同/ 查表/ 索引/ 对应/ 的/ 平均/ 加密/ 时间/ ①/ 这里/ 的/ 查找/ 表/ 实际上/ 就是/ S/ 盒/ ./ Page5/ 标准差/ 也/ 不/ 相同/ ./ 图/ 3/ 不同/ 密钥/ 对应/ 的/ AES/ 第一轮/ 查表/ 256/ 个/ 如果/ 攻击者/ 能够/ 掌控/ 一台/ 同/ 目标/ 密码/ 服务器/ 相同/ 的/ 模板/ 密码/ 服务器/ ,/ 并/ 能/ 使用/ 已知/ 密钥/ 进行/ 加密/ ,/ 采集/ 到/ AES/ 第一轮/ 16/ 次/ 查找/ S/ 盒/ 的/ 所有/ 索引/ 值/ 的/ 平均/ 加密/ 时间/ ,/ 搭建/ 类似/ 图/ 3/ 的/ 16/ 条/ Cache/ 计时/ 模板/ 曲线/ ,/ 然后/ 对/ 未知/ 密钥/ 的/ 目标/ 密码/ 服务器/ 采集/ 大图/ 4Cache/ 外部/ 计时/ 模板/ 攻击/ 模型/ 量/ 的/ 加密/ 时间/ 信息/ ,/ 分别/ 预测/ 每个/ 密钥/ 字节/ 的/ 值/ ,/ 将/ 根据/ 每个/ 密钥/ 字节/ 候选/ 值/ 将/ 样本/ 划分/ 为/ 256/ 个/ 索引/ 值聚类/ ,/ 得到/ 对应/ 的/ 一条/ 平均/ 加密/ 时间/ 标准差/ ,/ 计算/ 其同/ 前面/ 模板/ 曲线/ 的/ 匹配/ 度/ ,/ 正确/ 密钥/ 字节/ 候选/ 值/ 对应/ 的/ 匹配/ 度/ 往往/ 较/ 高/ ./ 在/ 加密/ 前/ 进行/ Cache/ 预热/ ,/ 将/ S/ 盒/ 提前/ 加载/ 到/ Cache/ 中/ ,/ 使得/ 加密/ 每次/ 查表/ 均/ 发生/ Cache/ 命中/ ,/ 可/ 消除/ 2.2/ 节/ 提到/ 的/ 时间/ 差异/ ,/ 进而/ 有效/ 防御/ Cache/ 碰撞/ 计时/ 攻击/ [/ 4/ -/ 7/ ]/ 、/ 访问/ 驱动/ 攻击/ [/ 12/ -/ 19/ ]/ 和/ 踪迹/ 驱动/ 攻击/ [/ 26/ -/ 33/ ]/ ./ 然而/ 本/ 节/ 攻击/ 利用/ 的/ 单次/ 查找/ S/ 盒/ 不同/ 索引/ 的/ 时间/ 不受/ Cache/ 访问/ 命中/ 和/ 失效/ 时间/ 的/ 影响/ ,/ 时间/ 差异/ 根源/ 来自/ 于/ CPU/ 硬件/ 架构/ 、/ 操作系统/ 等/ 因素/ ,/ 很难/ 消除/ ./ 即使/ 在/ 加密/ 前/ 将/ 整个/ S/ 盒/ 提前/ 加载/ 到/ Cache/ 中/ ,/ 单次/ 查找/ S/ 盒/ 不同/ 索引/ 值/ 的/ 时间/ 仍然/ 可以/ 用于/ 构建/ 模板/ ,/ 用于/ 进一步/ 的/ 密钥/ 分析/ ./ 考虑/ 到/ 利用/ 这/ 类/ 时间/ 差异/ 信息/ 进行/ 攻击/ 的/ 较/ 强/ 适用性/ ,/ 本文/ 主要/ 研究/ 利用/ 单次/ 查找/ S/ 盒/ 不同/ 索引/ 值/ 的/ 访问/ 时间/ 差异/ 进行/ 的/ 密钥/ 分析/ ,/ 即/ Cache/ 计时/ 模板/ 攻击/ 技术/ ./ 3AESCache/ 计时/ 外部/ 模板/ 攻击/ 3.1/ Cache/ 计时/ 外部/ 模板/ 攻击/ 模型/ 需要/ 说明/ 的/ 是/ ,/ 本文/ 中/ 的/ Cache/ 计时/ 模板/ 攻击/ 主要/ 针对/ S/ 盒/ 查表/ 操作/ ,/ 特别/ 适用/ 于/ 使用/ 了/ S/ 盒/ 的/ 分组/ 密码/ 甚至/ 流/ 密码/ ./ 攻击/ 一般/ 由/ 模板/ 搭建/ 、/ 目标/ 设备/ Cache/ 计时/ 信息/ 采集/ 、/ 模板/ 匹配/ 3/ 个/ 步骤/ 组成/ (/ 图/ 4/ )/ ./ 不失/ 一般性/ ,/ 下面/ 以/ 对/ 分组/ 密码/ 加密/ 第一轮/ 使用/ 明文/ P/ 和/ 密钥/ K/ 异或/ 值/ 查表/ 分析/ 为例/ 进行/ Page6/ (/ 1/ )/ 模板/ 搭建/ 攻击者/ 能够/ 掌控/ 一台/ 同/ 目标/ 密码/ 服务器/ 一样/ 的/ 模板/ 密码/ 服务器/ ,/ 并/ 能/ 对/ 其/ 使用/ 已知/ 密钥/ 进行/ 加密/ 操作/ ./ ①/ 对/ 掌控/ 模板/ 密码/ 服务器/ ,/ 使用/ 已知/ 密钥/ KT/ 为/ N/ 个/ 随机/ 明文/ 样本/ 执行/ 加密/ 操作/ ,/ 将/ 采集/ 加密/ 时间/ 存储/ 在/ 数组/ TM/ [/ i/ ]/ (/ 1/ / i/ / N/ )/ ./ ②/ 对于/ 第一轮/ 加密/ 过程/ 中/ 的/ m/ 次/ (/ 假如/ m/ =/ 16/ )/ 查表/ 操作/ 对应/ 的/ 明文/ 、/ 密钥/ 块/ (/ 假如/ 块/ 大小/ 为/ 一个/ 字节/ )/ ,/ 根据/ 16/ 个/ 索引/ 值/ pi/ / ki/ (/ 1/ / i/ / N/ )/ 的/ 候选/ 值/ ,/ 分别/ 将/ TM/ [/ i/ ]/ 划分/ 为/ 256/ 个/ 聚类/ ,/ 并/ 计算/ 每个/ 聚类/ 的/ 平均/ 加密/ 时间/ 标准差/ TMC/ [/ i/ ]/ [/ j/ ]/ (/ 0/ / i/ / 15/ ,/ 0/ / j/ / 255/ )/ 中/ ./ 介绍/ ./ (/ 2/ )/ 目标/ 设备/ Cache/ 计时/ 信息/ 采集/ ①/ 对/ 未知/ 密钥/ 目标/ 密码/ 服务器/ ,/ 使用/ 未知/ 密钥/ K/ 采集/ 对/ N/ 个/ 随机/ 明文/ 加密/ 时间/ T/ [/ i/ ]/ (/ 1/ / i/ / N/ )/ ./ ②/ 对于/ 第一轮/ 加密/ 中/ m/ 次/ 查表/ 操作/ 对应/ 的/ 明文/ 、/ 密钥/ 块/ ,/ 以/ 第/ i/ 次/ 查表/ 操作/ 为例/ ,/ 首先/ 预测/ ki/ 的/ 256/ 个/ 候选/ 值/ ,/ 对于/ 每个/ ki/ 的/ 第/ j/ 个/ 候选/ 值/ ,/ 计算/ N/ 个/ 明文/ 样本/ 对应/ pi/ / ki/ 值/ q/ ,/ 将/ T/ [/ i/ ]/ 划分/ 为/ 256/ 个/ 聚类/ ,/ 并/ 计算/ 平均/ 加密/ 时间/ 标准差/ TC/ [/ i/ ]/ [/ j/ ]/ [/ q/ ]/ (/ 0/ / i/ / 15/ ,/ 0/ / j/ / 255/ ,/ 0/ / q/ / 255/ )/ ./ (/ 3/ )/ 模板/ 匹配/ ①/ 以/ 分析/ 密钥/ ki/ 为例/ ./ 假设/ i/ =/ 0/ ,/ ki/ =/ 0/ ,/ 利用/ 式/ (/ 3/ )/ 计算/ 匹配/ 向量/ 犡/ =/ TC/ [/ 0/ ]/ [/ 0/ ]/ [/ q/ ]/ 同/ 计时/ 模板/ 向量/ 犢/ =/ TMC/ [/ 0/ ]/ [/ q/ ]/ 的/ Pearson/ 相关性/ 系数/ ,/ 得到/ ki/ 的/ 256/ 个/ 候选/ 值/ 对应/ 的/ 相关性/ 系数/ 向量/ 犚/ [/ 0/ ]/ [/ j/ ]/ (/ 0/ / j/ / 255/ )/ ./ 表/ 110/ 次/ OpenSSL/ -/ 0.9/ ./ 8a/ 中/ AES/ 第一轮/ Cache/ 计时/ 外部/ 模板/ 攻击/ 结果/ 序号/ k0k1k2k3k4k5k6k7k8k9k10k11k12k13k14k15115215511101881165112170212114821135230111940131873113120191111426111513311116614131421113150128813911891315122965116138122241611116441611351001112911129811113316171188331122711721112051751811761951132127112507811127419139681117136119923115750210111501111113114521143131/ 从表/ 1/ 可以/ 看出/ ,/ T0/ 表/ 和/ T3/ 表/ 对应/ 的/ 8/ 个/ 密钥/ 字节/ 恢复/ 效果/ 较/ 好/ ,/ 而/ T1/ 表/ 和/ T2/ 表/ 对应/ 字节/ 恢复/ 效果/ 较差/ ./ 图/ 5/ (/ a/ )/ 、/ (/ b/ )/ 分别/ 为/ 猜测/ k0/ =/ 0xe0/ 和/ k0/ =/ 0x98/ 时/ 预测/ 查/ T0/ 表/ 索引/ 聚类/ 和/ 模板/ 中/ 索引/ 聚类/ 对/ r/ 〈/ 犡/ ,/ 犢/ 〉/ =/ ∑/ 255/ ②/ 将/ 向量/ 犚/ [/ 0/ ]/ [/ j/ ]/ (/ 0/ / j/ / 255/ )/ 按/ 大小/ 进行/ 排序/ ,/ 最大值/ 对应/ 的/ j/ 即为/ 正确/ ki/ ./ ③/ 参考/ 上面/ 步骤/ 通过/ 模板/ 匹配/ 获取/ 所有/ ki/ 值/ ,/ 通过/ 进一步/ 分析/ 获取/ 初始/ 密钥/ K/ ./ 需要/ 说明/ 的/ 是/ ,/ 上面/ 模板/ 攻击/ 过程/ 同样/ 适用/ 于/ 利用/ 密文/ 和/ 加密/ 时间/ 对/ 最后/ 一轮/ 扩展/ 密钥/ 的/ 分析/ ./ 3.2/ 第一轮/ 攻击/ 为/ 提高/ AES/ 软件加密/ 速度/ ,/ OpenSSL/ -/ 0.9/ ./ 8a/ 中/ AES/ 在/ 每/ 一轮/ 中/ ,/ 将/ 除/ 与/ 轮/ 密钥/ 异或/ 以外/ 的/ 操作/ 合并/ 为/ 16/ 次/ 查表/ 操作/ ./ 整个/ 加密/ 过程/ 由/ 160/ 次/ 查表/ 和/ 176/ 次/ 异或/ 操作/ 组成/ ,/ 执行/ 效率/ 非常/ 高/ ,/ 前/ 9/ 轮/ 分别/ 对/ T0/ ~/ T3/ 表/ 执行/ 4/ 次/ 查表/ 操作/ ,/ 最后/ 一轮/ 仅/ 对/ T3/ 表/ 执行/ 了/ 16/ 次/ 查表/ 操作/ ./ AES/ 第一轮/ 加密/ 16/ 次/ 查表/ 操作/ 索引/ 为/ 应用/ 3.1/ 节/ 攻击/ 模型/ ,/ 通过/ 采集/ 已知/ 密钥/ 的/ AES/ 密码/ 服务器/ 加密/ 时间/ 构建/ 模板/ ,/ 并/ 采集/ 未知/ 密钥/ 的/ 密码/ 服务器/ 加密/ 时间/ ,/ 然后/ 预测/ 每个/ 密钥/ 字节/ ki/ ,/ 并/ 根据/ 其/ 利用/ 式/ (/ 3/ )/ ~/ (/ 4/ )/ 计算/ 每个/ 索引/ 字节/ 对应/ 的/ 平均/ 加密/ 时间/ 标准差/ ,/ 同/ 模板/ 进行/ 匹配/ ,/ 匹配/ 度/ 最大/ 的/ 即/ 为/ 正确/ 密钥/ 字节/ 值/ ./ 在/ Windows/ 环境/ 下/ 对/ OpenSSL/ -/ 0.9/ ./ 8a/ 中/ 的/ AES/ 进行/ 了/ 10/ 次/ Cache/ 计时/ 外部/ 模板/ 攻击/ 实验/ ,/ 样本量/ 为/ 221/ ,/ 16/ 个/ 正确/ 密钥/ 字节/ 在/ 256/ 个/ 候选/ 值/ 模板/ 匹配/ 度/ 集合/ 中/ 排序/ 如表/ 1/ 所示/ ,/ 其中/ 匹配/ 度越/ 高/ ,/ 序号/ 越小/ ./ 应/ 平均/ 加密/ 时间/ 标准差/ 曲线/ ./ 正确/ 的/ 密钥/ 值/ 是/ 0xe0/ ./ 当/ k0/ =/ 0xe0/ 时/ ,/ 两条/ 曲线/ 十分/ 接近/ (/ 图/ 5/ (/ a/ )/ )/ ,/ 而/ k0/ =/ 0x98/ 时/ ,/ 两条/ 曲线/ 差异/ 较大/ (/ 图/ 5/ (/ b/ )/ )/ ./ 图/ 6/ (/ a/ )/ 为/ k0/ 的/ 256/ 个/ 候选/ 值/ 的/ 匹配/ 曲线/ ,/ 可以/ Page7/ 看出/ ,/ k0/ =/ 0xe0/ 对应/ 匹配/ 度/ 比较/ 大/ ,/ 匹配/ 曲线/ 出现/ 明显/ 的/ 峰值/ ./ 需要/ 说明/ 的/ 是/ ,/ 当/ 考虑/ 到/ 程序/ 的/ 局部性/ 原理/ 时/ ,/ 每次/ 查找/ 表/ 访问/ 1/ 个/ 索引/ 值/ 就/ 会/ 将/ 同一个/ 块/ 的/ 16/ 个/ Cache/ 元素/ 都/ 加载/ 到/ Cache/ 中/ ,/ 这样/ 相邻/ 图/ 5OpenSSL/ -/ 0.9/ ./ 8a/ 中/ AES/ 第一轮/ 查/ T0/ 表/ 索引/ 值/ 256/ 聚类/ 对应/ 平均/ 加密/ 时间/ 标准差/ 图/ 6OpenSSL/ -/ 0.9/ ./ 8a/ 中/ AES/ 加密/ 第一轮/ 密钥/ 字节/ 候选/ 值/ 模板/ 匹配/ 度/ 实验/ 中/ 我们/ 发现/ ,/ 经/ 模板/ 分析/ 有些/ 密钥/ 字节/ 的/ 恢复/ 效果/ 比较/ 好/ ,/ 如/ 第/ k0/ ,/ k3/ ,/ k4/ ,/ k7/ ,/ k8/ ,/ k11/ ,/ k12/ ,/ k15/ 字节/ ,/ 正确/ 的/ 密钥/ 字节/ 值/ 对应/ 的/ 匹配/ 度/ 最高/ ,/ 峰值/ 比较/ 明显/ (/ 图/ 6/ (/ a/ )/ )/ ,/ 有些/ 密钥/ 字节/ (/ 如/ k1/ )/ 的/ 恢复/ 效果/ 则/ 较差/ (/ 图/ 6/ (/ b/ )/ )/ ,/ 正确/ 的/ 密钥/ 字节/ 对应/ 匹配/ 度/ 不/ 一定/ 是/ 最高/ 的/ ./ 有趣/ 的/ 是/ ,/ 正确/ k5/ ,/ k14/ 字节/ 的/ 低/ 的/ 16/ 个/ 索引/ 查表/ 时间/ 十分/ 接近/ ,/ 这样/ 索引/ 值/ 的/ 低/ 4/ 位值/ 有时候/ 很难/ 精确/ 预测/ ./ 在/ 图/ 6/ (/ a/ )/ 中/ ,/ 当/ k0/ 的/ 高/ 4/ 位为/ e/ 时/ ,/ 其/ 匹配/ 度/ 都/ 相对/ 比较/ 高/ ./ 2/ ~/ 4/ 位/ 也/ 可以/ 恢复/ 出来/ ,/ 如图/ 6/ (/ c/ )/ 、/ (/ d/ )/ 所示/ ,/ 会/ 出现/ 32/ 个/ 峰值/ ,/ 其/ 对应/ 密钥/ 字节/ 的/ 低/ 2/ ~/ 4/ 位/ 相同/ ./ 这样/ ,/ 在/ Windows/ 环境/ 下/ ,/ 221/ 样本/ 下/ ,/ 应用/ 本/ 节/ 攻击/ ,/ 可/ 恢复/ OpenSSL/ -/ 0.9/ ./ 8a/ 中/ AES/ 的/ 70/ 位/ 密钥/ ./ 进一步/ 降低/ 密钥/ 搜索/ 空间/ 可/ 通过/ 下面/ 两个/ 途径/ 获得/ :/ 一是/ 加大/ 攻击/ 样本量/ ,/ 二是/ 对/ AES/ 加密/ 第二轮/ 进行/ Page8/ 进一步/ 模板/ 分析/ ./ 3.3/ 最后/ 一轮/ 攻击/ Bernstein/ 攻击/ [/ 8/ ]/ 主要/ 针对/ AES/ 加密/ 第一轮/ ,/ 使用/ 了/ 227.5/ 个/ 样本/ ,/ 经/ 几天/ 时间/ 才/ 恢复/ 128/ 位/ AES/ 密钥/ ./ 我们/ 在/ 第一轮/ 攻击/ 的/ 基础/ 上/ ,/ 尝试/ 将/ 攻击/ 转向/ 最后/ 一轮/ ,/ 检验/ AES/ 最后/ 一轮/ 抗/ Cache/ 计时/ 模板/ 攻击能力/ ./ OpenSSL/ -/ 0.9/ ./ 8a/ 中/ AES/ 最后/ 一轮/ 仅/ 对/ T4/ 表/ 进行/ 了/ 16/ 次/ 查表/ 操作/ ,/ 16/ 次/ 查表/ 索引/ yi/ 为/ T4/ [/ yi/ ]/ / k9/ 应用/ 3.1/ 节/ 攻击/ 模型/ ,/ 通过/ 采集/ 已知/ 密钥/ 的/ 密码/ 服务器/ 上/ 加密/ 时间/ 构建/ 模板/ ,/ 并/ 采集/ 未知/ 密钥/ 的/ 表/ 210/ 次/ OpenSSL/ -/ 0.9/ ./ 8a/ 中/ AES/ 最后/ 一轮/ Cache/ 计时/ 外部/ 模板/ 攻击/ 结果/ 序号/ k91112211111111112119211211111111111113130121111111112114214911111111111212514294111111112111616521111111111111713121111111111118121111111111112191124461111111115221110260161121111111111/ 图/ 7/ (/ a/ )/ 为/ AES/ 最后/ 一轮/ k9/ 配/ 曲线/ ,/ 同图/ 6/ 比较/ 可以/ 看出/ ,/ 正确/ 密钥/ 候选/ 值/ k90xc9/ 对应/ 匹配/ 度/ 比较/ 大/ ,/ 匹配/ 曲线/ 会/ 出现/ 唯一/ 的/ 峰值/ ,/ 效果/ 要/ 好/ 于/ 第一轮/ 攻击/ ./ 原因/ 有/ 两个/ 方面/ :/ (/ 1/ )/ 只有/ 最后/ 一轮/ 对/ T4/ 表/ 执行/ 了/ 16/ 次/ 查表/ 操作/ ,/ 整体/ 加密/ 时间/ 受/ 每次/ 查/ T4/ 表/ 操作/ 时间/ 影响/ 比较/ 明显/ ,/ 而/ 第一轮/ 攻击/ 关注/ 的/ 是/ 对/ 加密/ 整体/ 时间/ 受/ 第一轮/ 查/ T0/ ~/ T34/ 个表/ 的/ 影响/ ,/ 由于/ 加密/ 其它/ 轮/ 也/ 要/ 查找/ 这/ 4/ 个表/ ,/ 进而/ 对/ 整体/ 加密/ 时间/ 也/ 有/ 较大/ 影响/ ,/ 因而/ 第一轮/ 查表/ 时间/ 差异/ 对/ 整体/ 时间/ 影响/ 较/ 小/ ,/ 噪声/ 较大/ ./ 图/ 7OpenSSL/ -/ 0.9/ ./ 8a/ 中/ AES/ 加密/ 最后/ 一轮/ 密钥/ 字节/ 候选/ 值/ 模板/ 匹配/ 度/ 密码/ 服务器/ 加密/ 时间/ ,/ 然后/ 预测/ 每个/ 密钥/ 字节/ k9/ 并/ 根据/ 其/ 利用/ 式/ (/ 3/ )/ 和/ 式/ (/ 5/ )/ 计算/ 最后/ 一轮/ 每次/ 查表/ 索引/ 字节/ 对应/ 的/ 平均/ 加密/ 时间/ 标准差/ ,/ 同/ 模板/ 进行/ 匹配/ ,/ 匹配/ 度/ 最大/ 的/ 即/ 为/ 正确/ 密钥/ 字节/ 值/ ./ 在/ Windows/ 环境/ 下/ 对/ OpenSSL/ -/ 0.9/ ./ 8a/ 中/ 的/ AES/ 进行/ 了/ 本节/ 所述/ 外部/ 模板/ 攻击/ 实验/ ,/ 样本量/ 大小/ 为/ 220/ ,/ 攻击/ 均/ 能/ 在/ 有限/ 复杂度/ 内/ 恢复/ 完整/ 密钥/ ,/ 10/ 次/ 攻击/ 最后/ 一轮/ 密钥/ 字节/ 的/ 模板/ 匹配/ 度/ 排序/ 如表/ 2/ 所示/ ./ 从中/ 可以/ 看出/ ,/ 最后/ 一轮/ 攻击/ (/ 表/ 2/ )/ 大部分/ 正确/ 密钥/ 字节/ 对应/ 的/ 排序/ 要/ 高于/ 第一轮/ 攻击/ (/ 表/ 1/ )/ ,/ 攻击/ 效果/ 要/ 好/ ./ 7k98k9/ (/ 2/ )/ 文中/ 每个/ Cache/ 行/ 包含/ δ/ =/ 16/ 个/ AES/ 查表/ 元素/ ./ 考虑/ 到/ 程序/ 的/ 局部性/ 原理/ ,/ 根据/ 第一轮/ 攻击/ 中/ 利用/ 的/ 式/ (/ 4/ )/ 可知/ ,/ 与/ 正确/ 密钥/ 高/ 4/ 位/ 相同/ 的/ 16/ 个/ 密钥/ 字节/ 的/ 查表/ 时间/ 对/ 整体/ 时间/ 影响/ 大致相同/ ,/ 故/ 第一轮/ 理论/ 上/ 一般/ 可/ 获取/ 每个/ 密钥/ 字节/ 的/ 高/ 4/ 位/ ,/ 而/ 根据/ 最后/ 一轮/ 攻击/ 利用/ 的/ 式/ (/ 5/ )/ 可知/ ,/ 由于/ T4/ 表/ 的/ 雪崩/ 扩散作用/ ,/ 同/ 正确/ 密钥/ 高/ 4/ 位/ 相同/ 的/ 16/ 个/ 密钥/ 字节/ 的/ 查表/ 时间/ 对/ 整体/ 时间/ 的/ 影响/ 也/ 有/ 很大/ 区别/ ,/ 每个/ 预测/ 密钥/ 字节/ 对/ 整体/ 加密/ 时间/ 的/ 影响/ 差异/ 都/ 大/ ,/ 故/ 正确/ 密钥/ 字节/ 对应/ 的/ 匹配/ 曲线/ 峰值/ 最为/ 明显/ ./ Page9/ 但是/ 最后/ 一轮/ k9/ 理想/ (/ 图/ 7/ (/ b/ )/ )/ ,/ 匹配/ 曲线/ 比较/ 平缓/ ,/ 没有/ 出现/ 明显/ 的/ 峰值/ ,/ 匹配/ 度/ 普遍/ 比较/ 低/ ,/ 我们/ 可以/ 分析/ 得出结论/ 1/ 猜测/ 错误/ ,/ 最后/ 通过/ 暴力破解/ 获取/ k9k93/ ./ 4/ 同/ 前人/ 工作/ 比较/ Bernstein/ [/ 8/ ]/ 攻击/ 是/ 典型/ 的/ Cache/ 计时/ 外部/ 模板/ 攻击/ ,/ 主要/ 针对/ AES/ 加密/ 第一轮/ 进行/ ,/ 使用/ 227.5/ 个/ 样本/ 恢复/ 出/ 128/ 位/ AES/ 密钥/ ,/ 攻击/ 得到/ 的/ 模板/ 匹配/ 度/ 未/ 进行/ 归一化/ 处理/ ./ 我们/ 在/ 对/ Bernstein/ 攻击/ 基础/ 上/ ,/ 提出/ 了/ 一种/ 新/ 的/ 基于/ Pearson/ 相关性/ 系数/ 的/ 模图/ 8/ 本文/ 模板/ 匹配/ 方法/ 同/ Bernstein/ 攻击/ 比较/ 4AESCache/ 计时/ 内部/ 模板/ 攻击/ 4.1/ Cache/ 计时/ 内部/ 模板/ 攻击/ 模型/ 第/ 3/ 节/ 模板/ 攻击/ 属于/ “/ 两步/ 攻击/ ”/ ,/ 攻击者/ 需/ 掌控/ 一个/ 与/ 目标/ 密码/ 服务器/ 一样/ 配置/ 的/ 密码/ 设备/ ,/ 并/ 能够/ 对/ 已知/ 密钥/ 执行/ 加密/ 操作/ ./ 本节/ 则/ 尝试/ 去除/ 该/ 条件/ ,/ 构造/ 一种/ “/ 一步/ 攻击/ ”/ ./ 攻击者/ 直接/ 采集/ 目标/ 服务器/ 的/ 加密/ 时间/ ,/ 然后/ 利用/ 不同/ 次/ 查找/ 同一个/ S/ 盒/ 时间/ 搭建/ 内部/ 计时/ 模板/ ,/ 通过/ 模板/ 匹配/ 恢复/ 相关/ 密钥/ ./ 下面/ 将/ 详细描述/ Cache/ 内部/ 模板/ 攻击/ 模型/ ./ Cache/ 内部/ 模板/ 攻击/ 一般/ 由/ 目标/ 设备/ 加密/ 时间/ 信息/ 采集/ 、/ 内部/ 模板/ 构建/ 、/ 模板/ 匹配/ 3/ 个/ 步骤/ 组成/ ./ 不失/ 一般性/ ,/ 下面/ 仍以/ 对/ 分组/ 密码/ 加密/ 第一轮/ 使用/ 明文/ P/ 和/ 密钥/ K/ 的/ 异或/ 值/ 查表/ 的/ 分析/ 为例/ 进行/ 介绍/ ./ 目标/ 设备/ 加密/ 时间/ 采集/ 过程/ 不再/ 赘述/ ./ 分组/ 密码/ 两次/ 查找/ 同一个/ S/ 盒时/ ,/ 根据/ 其/ 索引/ yi/ ,/ yj/ (/ 如/ i/ =/ 0/ ,/ j/ =/ 4/ )/ 划分/ 的/ 256/ 个/ 聚类/ 平均/ 时间/ 标准差/ 分布/ 特征/ 应该/ 基本/ 相似/ ,/ 如图/ 9/ (/ a/ )/ 、/ (/ b/ )/ 所示/ ./ 攻击者/ 采集/ 到/ 目标/ 密码/ 服务器/ 使用/ 未知/ 密钥/ 的/ 加密/ 时间/ 后/ ,/ 由于/ 密钥/ 未知/ ,/ 故/ 无法/ 根据/ 查找/ 表/ 索引/ y/ 将/ 所有/ 样本/ 板/ 匹配/ 算法/ ,/ 对/ AES/ 第一轮/ 和/ 最后/ 一轮/ 均/ 进行/ 了/ 攻击/ 分析/ ./ 新/ 匹配/ 算法/ 对/ 匹配/ 度/ 进行/ 了/ 归一化/ 处理/ ,/ 提高/ 了/ Bernstein/ 攻击/ 的/ 效率/ ,/ 可/ 降低/ 攻击/ 样本量/ 和/ 提高/ 攻击/ 准确度/ ./ 图/ 8/ (/ a/ )/ 、/ (/ b/ )/ 分别/ 为/ 外部/ 模板/ 攻击/ 中/ ,/ 220/ 样本/ 下/ ,/ 应用/ Bernstein/ 攻击/ 方法/ 和/ 本文/ 模板/ 匹配/ 方法/ 对/ OpenSSL/ -/ 0.9/ ./ 8aAES/ 加密/ 最后/ 一轮/ 进行/ 攻击/ (/ 被/ 攻击/ 密钥/ 字节/ 相同/ ,/ 0x6b/ )/ 的/ 结果/ ./ 可以/ 看出/ ,/ 本文/ 方法/ 对/ 模板/ 匹配/ 度/ 进行/ 了/ 归一化/ 处理/ ,/ 正确/ 密钥/ 字节/ 峰值/ 更为/ 明显/ ./ 加密/ 时间/ 划分/ 为/ 256/ 个/ 聚类/ ,/ 而/ 只/ 可以/ 根据/ 每次/ 查表/ 对应/ 的/ 明文/ 字节/ 进行/ 聚类/ 划分/ ./ 具体/ 内部/ 模板/ 构建/ 、/ 模板/ 匹配/ 方法/ 如下/ :/ (/ 1/ )/ 首先/ 按照/ pi/ 值/ 进行/ 聚类/ 划分/ ,/ 得到/ 256/ 个/ 聚类/ 平均/ 时间/ 标准差/ ,/ 绘制/ 一条/ 模板/ 曲线/ ,/ 如图/ 9/ (/ c/ )/ 所示/ ./ (/ 2/ )/ 然后/ 攻击者/ 可/ 通过/ 预测/ ki/ / kj/ 值/ ,/ 针对/ 每/ 一个/ ki/ / kj/ 值/ ,/ 得到/ ki/ / kj/ / pj/ 值/ 对应/ 的/ 256/ 个/ 聚类/ (/ 根据/ pj/ 划分/ )/ 的/ 平均/ 时间/ 标准差/ ./ (/ 3/ )/ 因为/ ki/ / kj/ =/ pi/ / pj/ ,/ 如果/ ki/ / kj/ 预测/ 正确/ ,/ ki/ / kj/ / pj/ 所/ 划分/ 的/ 256/ 个/ 聚类/ 平均/ 时间/ 标准差/ 曲线/ 和/ pi/ 值/ 划分/ 的/ 模板/ 曲线/ 应该/ 最/ 匹配/ (/ 如图/ 9/ (/ d/ )/ )/ ,/ 计算/ 两条/ 曲线/ 间/ 的/ Pearson/ 相关性/ 系/ 数值/ 最大/ ;/ 反之/ ,/ 如果/ ki/ / kj/ 预测/ 错误/ ,/ 得到/ 的/ 预测/ 曲线/ 同/ 模板/ 曲线/ 差别/ 较大/ (/ 如图/ 9/ (/ e/ )/ )/ ,/ 得到/ 的/ Pearson/ 相关性/ 系/ 数值/ 较/ 小/ ./ 需要/ 说明/ 的/ 是/ ,/ 基于/ 内部/ 模板/ 攻击/ 可/ 得到/ 某轮查/ 同一/ 类型/ S/ 盒/ 对应/ 的/ 不同/ 密钥/ 字节/ 异或/ 值/ ,/ 并/ 不能/ 直接/ 得到/ 密钥/ 字节/ 值/ ./ 同样/ ,/ 上面/ 攻击/ 模型/ 适用/ 于/ 利用/ 密文/ 和/ 加密/ 时间/ 对/ 最后/ 一轮/ 扩展/ 密钥/ 异或/ 值/ 进行/ 的/ 分析/ ./ Page10/ 图/ 9Cache/ 计时/ 内部/ 模板/ 攻击/ 模型/ 4.2/ 第一轮/ 攻击/ OpenSSL/ -/ 0.9/ ./ 8a/ 中/ AES/ 第一轮/ 对/ T0/ ~/ T3/ ,/ 4/ 个表/ 分别/ 查找/ 4/ 次/ ,/ 共/ 查找/ 16/ 次表/ ,/ 第/ j/ 次/ 查找/ 的/ 是/ Tj/ %/ 4/ 表/ ./ 根据/ 4.1/ 节/ ,/ 第一轮/ 攻击/ 可/ 获取/ 24/ (/ 4/ ×/ (/ 4/ ×/ 3/ )/ // 2/ )/ 个/ ki/ / kj/ (/ 0/ / i/ ,/ j/ / 15/ ,/ i/ %/ 4/ =/ j/ %/ 4/ )/ 密钥/ 字节/ ,/ 如图/ 10/ 所示/ ./ 这样/ ,/ 第一轮/ 攻击/ 理想/ 情况/ 下/ 可/ 获取/ 到/ 96/ (/ 4/ ×/ 表/ 3OpenSSL/ -/ 0.9/ ./ 8a/ 中/ AES/ 第一轮/ 10/ 次/ Cache/ 计时/ 内部/ 模板/ 攻击/ 结果/ 序号/ k4/ / k0k5/ / k1k6/ / k2k7/ / k3k8/ / k0k8/ / k4k9/ / k1k9/ / k5k10/ / k2k10/ / k6k11/ / k3k11/ / k7119725146122207912469254121703815711988135282501311396791122774135152551417965841119410616582521511213067112052519749250161787913911101271292481712081595111706710993253181224012611229491124819114460104112006711392501101674592115810117102461/ 序号/ k12/ / k0k12/ / k4k12/ / k8k13/ / k1k13/ / k5k13/ / k9k14/ / k2k14/ / k6k14/ / k10k15/ / k3k15/ / k7k15/ / k111232191972186172314230256212115195571081525052562553111422061403620543246254413259699914711127325525452213056169284846323025561111061051016960264255254713197134131221336423725682131409573877551125625591213716423435911662512561012132851047967462255255/ 图/ 10AES/ 第一轮/ Cache/ 计时/ 内部/ 模板/ 攻击/ 恢复/ 密钥/ 3/ ×/ 8/ )/ 位/ AES/ 密钥/ ,/ 但/ 当/ 考虑/ 到/ Cache/ 访问/ 的/ 局部性/ 原理/ 时/ ,/ 对于/ 64/ 字节/ Cache/ 行/ 大小/ ,/ 每个/ Cache/ 行/ 16/ 个/ S/ 盒/ 元素/ 来说/ ,/ 理论/ 上/ 可/ 获取/ 48/ (/ 4/ ×/ 3/ ×/ 4/ )/ 位/ 密钥/ ./ 对/ OpenSSL/ -/ 0.9/ ./ 8a/ 中/ 的/ AES/ 进行/ 了/ 第一轮/ 内部/ 模板/ 攻击/ 实验/ ,/ 样本量/ 大小/ 为/ 220/ ,/ 10/ 次/ 攻击/ 各个/ 相关/ 密钥/ 字节/ 的/ 模板/ 匹配/ 度/ 排序/ 如表/ 3/ 所示/ ./ 实验/ 中/ 发现/ :/ 正确/ 的/ k4/ / k0/ ,/ k8/ / k0/ ,/ k8/ / k4/ ,/ k11/ / k7/ ,/ k12/ / k0/ ,/ k12/ / k4/ ,/ k12/ / k8/ ,/ k15/ / k3/ 字节/ 对应/ 匹配/ 度/ 一般/ 是/ 最高/ 的/ ./ 如图/ 11/ (/ a/ )/ 所示/ ,/ 3/ 组/ 攻击/ 中/ 的/ 256/ 个/ k4/ / k0/ 候选/ 值/ 匹配/ 度/ (/ 正确/ 值为/ 0xa2/ )/ 最高/ ./ 这同/ 3.2/ 节/ OpenSSL/ -/ 0.9/ ./ 8a/ 中/ 的/ AES/ 第一轮/ 外部/ 模板/ 攻击/ 可/ 精确/ 恢复/ k0/ ,/ k3/ ,/ k4/ ,/ k7/ ,/ k8/ ,/ k11/ ,/ k12/ ,/ k15/ 字节/ 的/ 结果/ 也/ 基本/ 对应/ ./ 实验/ 中/ ,/ 我们/ 还/ 发现/ 正确/ 的/ k11/ / k3/ ,/ k15/ / k11/ 字节/ 对应/ 匹配/ 度/ 常常/ 是/ 最小/ 的/ ,/ 3/ 组/ 攻击/ 中/ 的/ 256/ 个/ k15/ / k11/ 候选/ 值/ 匹配/ 度/ Page11/ (/ 正确/ 值为/ 0xb6/ )/ 如图/ 11/ (/ b/ )/ 所示/ ,/ 利用/ 该/ 特性/ ,/ 也/ 可以/ 恢复/ k11/ / k3/ ,/ k15/ / k11/ 字节/ ./ 图/ 11OpenSSL/ -/ 0.9/ ./ 8a/ 中/ AES/ 加密/ 第一轮/ 这样/ ,/ 在/ Windows/ 环境/ 下/ ,/ 使用/ 221/ 样本/ ,/ 应用/ 本/ 节/ 攻击/ ,/ 通过/ 对/ 恢复/ 的/ k4/ / k0/ ,/ k8/ / k0/ ,/ k8/ / k4/ ,/ k11/ / k7/ ,/ k12/ / k0/ ,/ k12/ / k4/ ,/ k12/ / k8/ ,/ k15/ / k3/ ,/ k11/ / k3/ ,/ k15/ / k11/ 字节/ 进行/ 分析/ ,/ 可/ 恢复/ OpenSSL/ -/ 0.9/ ./ 8a/ 中/ AES/ 的/ 48/ 位/ 密钥/ ./ 进一步/ 降低/ 密钥/ 搜索/ 空间/ 可/ 通过/ 下面/ 加大/ 攻击/ 样本量/ 或/ 开展/ 第二轮/ 分析/ 进行/ ./ 4.3/ 最后/ 一轮/ 攻击/ OpenSSL/ -/ 9.8/ ./ a/ 中/ AES/ 最后/ 一轮/ 仅/ 对/ T4/ 表/ 进行/ 了/ 16/ 次/ 查表/ ./ 根据/ 4.1/ 节/ 原理/ ,/ 最后/ 一轮/ 攻击/ 最多/ 可/ 获取/ 120/ 个/ k9/ 后/ 一轮/ 扩展/ 密钥/ K9/ ,/ 经/ 密钥/ 逆/ 推/ 恢复/ 初始/ 主/ 密钥/ K/ ./ 应用/ 4.1/ 节/ 分析模型/ ,/ 对/ OpenSSL/ -/ 0.9/ ./ 8a/ 中/ AES/ 最后/ 一轮/ 进行/ 攻击/ ,/ 219/ 样本/ 下/ ,/ 120/ 个/ 正确/ j/ 的/ 密钥/ 字节/ 匹配/ 度/ 排名/ 如图/ 13/ 所示/ ./ 可以/ 看/ i/ / k9k9/ 出/ ,/ OpenSSL/ -/ 9.8/ ./ a/ 中/ AES/ 最后/ 一轮/ 攻击/ 后/ ,/ 大约/ 110/ 个/ 左右/ 的/ k9/ 复/ AES/ 第/ 10/ 轮/ 的/ 120/ 位/ 扩展/ 密钥/ ,/ 经逆/ 推/ 和/ 暴力破解/ 恢复/ 初始/ 密钥/ ./ 4.4/ 两种/ 模板/ 攻击/ 比较/ 分析/ 在/ Athlon643000/ +/ 1.81/ GHz/ 处理器/ 、/ Windows/ 图/ 12AES/ 最后/ 一轮/ Cache/ 计时/ 内部/ 模板/ 攻击/ 恢复/ 密钥/ 图/ 13OpenSSL/ -/ 0.9/ ./ 8a/ 库中/ AES/ 的/ 正确/ k9XPSP2/ 、/ MicrosoftVisual/ C++/ 6.0/ 环境/ 下/ ,/ 我们/ 对/ OpenSSL/ -/ 0.9/ ./ 8a/ 密码/ 库中/ AES/ 实现/ 进行/ 了/ Cache/ 计时/ 外部/ 和/ 内部/ 模板/ 攻击/ 实验/ ./ 结果表明/ ,/ OpenSSL/ -/ 0.9/ ./ 8a/ 库中/ AES/ 最后/ 一轮/ 外部/ 模板/ 攻击/ 和/ 内部/ 模板/ 攻击/ 中/ 可/ 分别/ 使用/ 220/ 和/ 219/ 样本/ 恢复/ 128/ 位/ AES/ 密钥/ ./ 同/ 外部/ 模板/ 攻击/ 相比/ ,/ 内部/ 模板/ 攻击/ 具有/ 以下/ 特点/ :/ (/ 1/ )/ 降低/ 了/ 攻击/ 代价/ 外部/ 模板/ 攻击/ 假定/ 攻击者/ 可/ 预先/ 获取/ 一个/ 与/ 目标/ 密码/ 服务器/ 一样/ 配置/ 的/ 模板/ 密码/ 服务器/ ,/ 并/ 能够/ 使用/ 已知/ 密钥/ 执行/ 大量/ 的/ 加密/ 操作/ ,/ 采集/ 加密/ 时间/ 搭建/ 模板/ ./ 实际/ 情况/ 下/ ,/ 这种/ 条件/ 过于/ 严格/ ,/ 内部/ 模板/ 攻击/ 则/ 不/ 需要/ 该/ 条件/ ./ (/ 2/ )/ 提高/ 了/ 攻击/ 准确度/ 外部/ 模板/ 攻击/ 中/ ,/ 用于/ 搭建/ 模板/ 密码/ 服务器/ 上/ 的/ 运行/ 环境/ 很难/ 保证/ 同/ 目标/ 密码/ 服务器/ 完全一致/ ,/ 这种/ 环境/ 的/ 差异/ 信息/ 对/ 攻击/ 成功率/ 存在/ 很大/ 的/ 影响/ ./ 内部/ 模板/ 攻击/ 可/ 在/ 目标/ 服务器/ 上/ 直接/ 搭建/ 时间/ 模板/ ,/ 准确度/ 较/ 高/ ,/ 攻击/ 样本/ 相对/ 要/ 小/ ./ (/ 3/ )/ 可/ 获取/ 密钥/ 字节/ 异或/ 结果/ 外部/ 模板/ 攻击/ 可/ 直接/ 获取/ AES/ 轮/ 密钥/ 每个/ 字/ Page12/ 节/ ./ 内部/ 模板/ 攻击/ 中/ ,/ 由于/ 攻击/ 主要/ 利用/ 加密/ 不同/ 次/ 查找/ 同一/ 类型/ S/ 盒/ 访问/ 时间/ 差异/ ,/ 只能/ 直接/ 获取/ 对应/ 密钥/ 字节/ 异或/ 值/ ./ 在/ OpenSSL/ -/ 0.9/ ./ 8a/ 中/ AES/ 攻击/ 时/ ,/ 由于/ 第一轮/ 分别/ 查找/ 4/ 种/ 查找/ 表/ 4/ 次/ ,/ 第一轮/ 内部/ 模板/ 攻击/ 理论/ 上/ 可/ 恢复/ 96/ 位/ 密钥/ ,/ 比/ 外部/ 模板/ 攻击/ 128/ 位/ 的/ 理论值/ 小/ ;/ 由于/ 最后/ 一轮/ 仅/ 对/ T4/ 表/ 查找/ 16/ 次/ ,/ 内部/ 模板/ 攻击/ 可/ 获取/ 120/ 位/ AES/ 密钥/ ,/ 结果/ 比/ 128/ 位/ 的/ 理论值/ 小/ ./ 5/ 攻击/ 实验/ 扩展/ 与/ 比较/ 分析/ 在/ 实验/ 过程/ 中/ ,/ 课题组/ 还/ 在/ 本地/ 远程/ 环境/ 、/ 不同/ 操作系统/ 、/ 不同/ 加密/ 前/ Cache/ 初始状态/ 、/ 不同/ 密码/ 库下/ 的/ AES/ 实现/ 进行/ 了/ 多例/ 攻击/ 实验/ ,/ 以/ 评估/ 其抗/ Cache/ 计时/ 模板/ 攻击/ 安全性/ ./ 5.1/ 本地/ 、/ 远程/ 环境/ 攻击/ 前面/ 第/ 3/ 、/ 4/ 节/ 攻击/ 主要/ 在/ 本地/ 环境/ 下/ 进行/ ./ 在/ 此基础/ 上/ ,/ 我们/ 在/ 两种/ 远程/ 环境/ 下/ (/ Windows/ 环境/ )/ 对/ OpenSSL/ -/ 0.9/ ./ 8a/ 库中/ AES/ 最后/ 一轮/ 进行/ 了/ 外部/ 模板/ 攻击/ 实验/ ,/ 攻击/ 端/ 、/ 模板/ 密码/ 服务器/ 和/ 目标/ 密码/ 服务器/ 分别/ 被/ 部署/ 在/ 不同/ 的/ 电脑/ 上/ ./ (/ 1/ )/ 第/ 1/ 种/ 攻击/ 环境/ 同/ Bernstein/ [/ 8/ ]/ 攻击/ 类似/ ,/ 加密/ 服务器/ 在/ 收到/ 攻击/ 端/ 发送/ 的/ 明文/ 后/ ,/ 将/ 准确/ 的/ 加密/ 时间/ 同/ 密文/ 一起/ 反馈/ 给/ 攻击/ 端/ ,/ 攻击/ 端/ 再/ 利用/ 3.1/ 节/ 方法/ 分析/ 密钥/ ./ 与/ Bernstein/ 攻击/ 不同/ 的/ 是/ ,/ 攻击/ 端/ 向/ 加密/ 服务端/ 仅/ 发送/ 16/ 个/ 字节/ 的/ 明文/ ,/ 而/ Bernstein/ 攻击/ 每次/ 需/ 发送/ 400/ (/ 800/ )/ 字节/ 的/ 明文/ ./ 由于/ 计时/ 采集/ 不是/ 在/ 攻击/ 端/ 进行/ ,/ 攻击/ 可/ 称之为/ 伪/ 远程/ 攻击/ ./ 在/ 这种/ 环境/ 下/ ,/ 由于/ 服务端/ 接收/ 明文/ 和/ 发送/ 密文/ 、/ 加密/ 时间/ 需要/ 大量/ 地/ 访问/ Cache/ ,/ 能够/ 起到/ 间接/ 的/ 清空/ Cache/ 作用/ ,/ 其/ 攻击/ 的/ 最高/ 模板/ 匹配/ 度/ 同次/ 高/ 模板/ 匹配/ 度/ 的/ 差距/ 甚至/ 要/ 远大于/ 本地/ 攻击/ 时/ (/ 加密/ 前/ 清空/ Cache/ )/ 最高/ 模板/ 匹配/ 度/ 同次/ 高/ 模板/ 匹配/ 度/ 的/ 差距/ ,/ 攻击/ 效果/ 十分/ 明显/ ,/ 如图/ 3/ 所示/ ./ 实验/ 结果表明/ ,/ 此类/ 伪/ 远程/ 计时/ 攻击/ ,/ 无需/ 像/ Bernstein/ 攻击/ 每次/ 需/ 发送/ 400/ (/ 800/ )/ 字节/ 的/ 明文/ ,/ 正常/ 的/ 16/ 个/ 字节/ 明文/ 发送/ 加上/ 上次/ 信息/ 采集/ 中/ 密文/ 和/ 加密/ 时间/ 反馈/ 就/ 可以/ 基本/ 达到/ 清空/ Cache/ ,/ 将/ AES/ 查找/ 表从/ Cache/ 中/ 驱逐/ 出去/ 的/ 作用/ ./ (/ 2/ )/ 第/ 2/ 种/ 攻击/ 环境/ 中/ ,/ 攻击/ 端/ 负责/ 采集/ 从/ 发送/ 明文/ 到/ 接收/ 到/ 密文/ 之间/ 的/ 时间/ ,/ 这是/ 实际/ 攻击/ 中/ 常见/ 的/ 场景/ ./ 对/ AES/ 最后/ 一轮/ 进行/ 外部/ 模板/ 攻击/ 时/ ,/ 采集/ 的/ 模板/ 服务器/ 最后/ 一轮/ 第一次/ 查/ T4/ 表/ 的/ 256/ 个/ 索引/ 值/ 的/ 加密/ 平均/ 时间/ (/ 90000/ 个/ 时钟/ 周期/ )/ 及/ 标准差/ 同/ 目标/ 服务器/ (/ 1400/ 个/ 时钟/ 周期/ )/ 具有/ 很大/ 不同/ ,/ 时间/ 抖动/ 范围/ 很大/ (/ -/ 60/ 到/ 80/ 个/ 时钟/ 周期/ )/ ,/ 差异/ 很大/ ,/ 故/ 即使/ 是/ 正确/ 的/ 密钥/ 字节/ 值/ ,/ 其/ 模板/ 匹配/ 度/ 也/ 很/ 低/ ,/ 整个/ 模板/ 匹配/ 度/ 十分/ 不/ 准确/ (/ 如图/ 15/ (/ b/ )/ )/ ./ 而/ 在/ 伪/ 远程/ 攻击/ 时/ ,/ 模板/ 服务器/ 和/ 目标/ 服务器/ 的/ 查/ T4/ 表/ 的/ 256/ 个/ 索引/ 值/ 加密/ 平均/ 时间/ 标准差/ 基本/ 接近/ ,/ 时间/ 抖动/ 范围/ 非常/ 小/ (/ -/ 4/ 到/ 6/ 个/ 时钟/ 周期/ )/ ,/ 十分/ 接近/ ,/ 对于/ 正确/ 的/ 密钥/ 字节/ 值/ ,/ 模板/ 匹/ Page13/ 配度/ 很/ 高/ (/ 如图/ 15/ (/ a/ )/ )/ ./ 可以/ 说明/ ,/ Cache/ 计时/ 模板/ 攻击/ 在/ 真实/ 远程/ 环境/ 下/ 的/ 可行性/ 不/ 强/ ,/ 网络/ 传输/ 时延/ 甚至/ 其/ 抖动/ 即可/ 掩盖/ 了/ 加密/ 查/ 同一/ S/ 盒/ 不同/ 索引/ 操作/ 的/ 微弱/ 时间/ 差异/ ./ 5.2/ 不同/ 操作系统/ 下/ 攻击/ 同一/ 处理器/ 硬件/ 架构/ 在/ 不同/ 操作系统/ 环境/ 下/ ,/ 每个/ 查找/ 表/ 建立/ 的/ 时间/ 模板/ 信息/ 不同/ ,/ 噪声/ 大小/ 也/ 不尽相同/ ./ 我们/ 在/ Windows/ 环境/ 实验/ 的/ 基础/ 上/ ,/ 还/ 在/ Fedora8Linux/ 系统/ 、/ Gcc4/ ./ 1.8/ 编译器/ 环境/ 下/ 进行/ 了/ 攻击/ 实验/ ./ Linux/ 环境/ 下/ ,/ 其它/ 进程/ 给/ 攻击/ 带来/ 的/ 噪声/ 较/ 小/ ,/ S/ 盒/ 在/ Cache/ 中/ 往往/ 是/ 对齐/ 的/ (/ 对于/ 64B/ 的/ Cache/ 行/ 大小/ ,/ 1KB/ 大/ 小S/ 盒/ 恰好/ 对应/ 16/ 个/ Cache/ 行/ )/ ,/ 高/ 4/ 位/ 相同/ 的/ 密钥/ 值/ 对应/ 模板/ 匹配/ 度/ 基本相同/ ./ 这样/ ,/ 第一轮/ 攻击/ 一般/ 可/ 获取/ 每个/ 密钥/ 字节/ 的/ 高/ 4/ 位/ (/ 图/ 16/ )/ ;/ 而/ 在/ Windows/ 环境/ 下/ ,/ 由于/ 操作系统/ 进程/ 和/ 其它/ 进程/ 的/ 影响/ ,/ 即使/ 是/ 高/ 4/ 位/ 相同/ 的/ 密钥/ 字节/ ,/ 对应/ 的/ 匹配/ 度/ 也/ 有/ 很大/ 差异/ ,/ 大部分/ 情况/ 下/ 可/ 直接/ 获取/ 正确/ 密钥/ 字节/ 候选/ 值/ ./ 图/ 16Linux/ 和/ Windows/ 环境/ 下/ AES/ 第一轮/ 密钥/ k0/ 的/ 5.3/ 不同/ 加密/ 初始状态/ 攻击/ 在/ 前面/ 本地/ 攻击/ 实验/ 中/ ,/ 在/ 加密/ 前/ 大都/ 需/ 进行/ Cache/ 清空/ 操作/ ,/ 使得/ 加密/ 前/ 查找/ 表都/ 没有/ 预先/ 加载/ 到/ Cache/ 中/ ,/ 保证/ Cache/ 的/ 初始状态/ 一致/ ,/ 实验/ 效果/ 非常/ 理想/ ./ 当前/ 的/ 部分/ AES/ 软件/ 实现/ 将/ 查找/ 表/ 提前/ 加载/ 到/ Cache/ 中/ ,/ 这样/ 每次/ Cache/ 访问/ 都/ 会/ 发生/ Cache/ 命中/ ,/ 可/ 在/ 一定/ 程度/ 上/ 防御/ 时序/ 驱动/ Cache/ 攻击/ ./ 我们/ 尝试/ 在/ 加密/ 前/ 不/ 清空/ Cache/ 条件/ 下/ ,/ 在/ Linux/ 环境/ 下/ 对/ OpenSSL/ -/ 0.9/ ./ 8a/ 进行/ 了/ 模板/ 攻击/ ,/ 进行/ 了/ 两类/ 实验/ ./ 一类/ 是/ 通过/ 修改/ 算法/ ,/ 将/ AES/ 查找/ 表/ 预先/ 加载/ 到/ Cache/ 中/ ;/ 此外/ ,/ 我们/ 还/ 在/ 加密/ 前/ 不/ 执行/ 任何/ 操作/ 情况/ 下/ 进行/ 了/ 攻击/ 实验/ ,/ 实验/ 结果/ 同/ 加密/ 前/ 将/ AES/ 所有/ 查找/ 表/ 预先/ 加载/ 到/ Cache/ 中/ 攻击/ 效果/ 基本/ 接近/ ./ 第一轮/ 攻击/ 中/ ,/ 215/ 个/ 样本/ 采集/ 分析/ 后/ 可/ 获取/ 每个/ 密钥/ 字节/ 的/ 低/ 2/ ~/ 4/ 位/ ,/ 最终/ 获取/ 48/ 位/ 密钥/ (/ 图/ 17/ )/ ./ 最后/ 一轮/ 攻击/ 中/ ,/ 217/ 个/ 样本/ 下/ 可/ 直接/ 获取/ k96/ ,/ k93/ ,/ k9k9/ 图/ 18/ 加密/ 前/ 预先/ 加载/ S/ 盒/ 条件/ 下/ AES/ 最后/ 一轮/ 5.4/ 不同/ 密码/ 库下/ 攻击/ 为/ 检验/ 不同/ 密码/ 库中/ AES/ 实现/ 抗/ Cache/ 计时/ 模板/ 攻击能力/ ,/ 我们/ 以/ Cache/ 计时/ 外部/ 模板/ 攻击/ 为例/ ,/ 针对/ OpenSSL/ -/ 0.9/ ./ 8a/ 、/ Miracl5/ ./ 0/ [/ 39/ ]/ 、/ LibTom/ -/ Crypt1/ ./ 17/ [/ 40/ ]/ 、/ Crypto/ ++/ 5.6/ ./ 1/ [/ 41/ ]/ 4/ 类/ 典型/ 密码/ 库中/ 的/ AES/ 实现/ ,/ 在/ Windows/ 和/ Linux/ 环境/ 下/ ,/ 在/ 加密/ 前/ Cache/ 清空/ 和/ Cache/ 预热/ (/ 提前/ 加载/ S/ 盒到/ Cache/ 中/ )/ 两种/ 情况/ 下/ ,/ 开展/ 了/ 大量/ 的/ 攻击/ 实验/ ,/ 实验/ 结果/ 如表/ 4/ 所示/ ./ Page14/ 表/ 4/ 不同/ 密码/ 库中/ AES/ 实现/ Cache/ 计时/ 模板/ 攻击/ 结果/ 比较/ OpenSSL/ -/ 0.9/ ./ 8aMiracl5/ ./ 0LibTomCrypt1/ ./ 17WindowsCrypto/ ++/ 5.6/ ./ 1/ 由表/ 4/ 可知/ ,/ 这/ 4/ 种/ 典型/ 密码/ 库中/ 的/ 最新/ AES/ 实现/ 仍易/ 遭受/ Cache/ 计时/ 模板/ 攻击/ 的/ 威胁/ ,/ 安全隐患/ 较大/ ./ 此外/ ,/ 加密/ 前/ 进行/ Cache/ 预热/ 并/ 不能/ 很/ 好/ 地/ 防御/ Cache/ 计时/ 模板/ 攻击/ ./ 6/ 攻击/ 防御/ 措施/ 在/ 加密/ 前/ 将/ 查找/ 表/ 预先/ 加载/ 到/ Cache/ 中/ ,/ 可/ 有效/ 防御/ Cache/ 碰撞/ 计时/ 攻击/ 、/ 访问/ 驱动/ Cache/ 攻击/ 、/ 踪迹/ 驱动/ Cache/ 攻击/ ,/ 本文/ 大量/ 的/ 实验/ 证明/ 了/ 该/ 防御/ 措施/ 并/ 不能/ 有效/ 防御/ Cache/ 计时/ 模板/ 攻击/ ./ 为了/ 更好/ 地/ 防御/ 此类/ 攻击/ ,/ 可/ 通过/ 在/ 算法/ 实现/ 中/ 加入/ 一定/ 的/ 随机/ 时延/ [/ 8/ ,/ 14/ ,/ 34/ -/ 35/ ]/ (/ 如/ 插入/ 空/ 指令/ 、/ 垃圾/ 指令/ )/ 来/ 实现/ ./ 下面/ 我们/ 以/ Linux/ 系统/ 上/ Miracl5/ ./ 0/ 密码/ 库中/ AES/ 实现/ 为例/ ,/ 通过/ 插入/ 随机/ 个/ (/ 范围/ 为/ 1/ ~/ 10/ )/ 空/ 指令/ ,/ 研究/ 随机/ 时延/ 抗/ Cache/ 计时/ 模板/ 攻击/ 有效性/ ./ 表/ 5/ 、/ 图/ 19/ 、/ 图/ 20/ 为/ 未加/ 防御/ 、/ 预先/ 加载/ S/ 盒/ 、/ 预先/ 加载/ S/ 盒/ 并/ 加入/ 随机/ 时延/ 3/ 种/ 情况/ 下/ ,/ 对/ AES/ 进行/ 第一轮/ 攻击/ 和/ 最后/ 一轮/ 攻击/ 的/ 结果/ ./ 表/ 5Miracl5/ ./ 0/ 密码/ 库中/ 几种/ AES/ 实现/ 攻击/ 结果/ (/ 220/ 样本/ )/ AES/ 实现/ 未/ 加/ 防御/ 预先/ 加载/ S/ 盒/ 预先/ 加载/ S/ 盒/ 并/ 加入/ 随机/ 时延/ 144/ 从图/ 中/ 可以/ 看出/ :/ (/ 1/ )/ 未/ 加/ 防御/ 措施/ 的/ Miracl5/ ./ 0/ 密码/ 库中/ AES/ 实现/ 是/ 不/ 安全/ 的/ (/ 图/ 19/ (/ a/ )/ 、/ 图/ 20/ (/ a/ )/ )/ ;/ (/ 2/ )/ 预先/ 加载/ S/ 盒到/ Cache/ 后/ ,/ Miracl5/ ./ 0/ 中/ AES/ 执行/ 效率/ 接近/ 于/ 未加/ 防御/ 实现/ ,/ 但/ 第一轮/ 攻击/ 可/ 获取/ 到/ 密钥/ 字节/ 低/ 2/ ~/ 4/ 位/ (/ 图/ 19/ (/ b/ )/ )/ ;/ 最后/ 一轮/ 加密/ 初始状态/ Cache/ 清空/ Cache/ 预热/ Cache/ 清空/ Cache/ 预热/ Cache/ 清空/ Cache/ 预热/ Cache/ 清空/ Cache/ 预热/ Cache/ 清空/ Cache/ 预热/ Cache/ 清空/ Cache/ 预热/ Cache/ 清空/ Cache/ 预热/ Cache/ 清空/ Cache/ 预热/ 图/ 19Miracl5/ ./ 0/ 密码/ 库中/ AES/ 第一轮/ 攻击/ Page15/ 图/ 20Miracl5/ ./ 0/ 密码/ 库中/ AES/ 最后/ 一轮/ 攻击/ 攻击/ 正确/ 密钥/ 字节/ 模板/ 匹配/ 度/ 有所/ 降低/ ,/ 但/ 仍/ 可/ 攻击/ 成功/ (/ 图/ 20/ (/ b/ )/ )/ ;/ (/ 3/ )/ 加密/ 前/ 预先/ 加载/ S/ 盒到/ Cache/ 中/ 并/ 加入/ 随机/ 时延/ 的/ Miracl5/ ./ 0/ 密码/ 库中/ AES/ 实现/ ,/ 其/ 执行/ 效率/ 要/ 高出/ 未/ 加/ 防御/ 的/ AES/ 实现/ 约/ 20/ 个/ 时钟/ 周期/ ,/ 但/ 均/ 可/ 有效/ 防御/ AES/ 第一轮/ (/ 图/ 19/ (/ c/ )/ )/ 和/ 最后/ 一轮/ 攻击/ (/ 图/ 20/ (/ c/ )/ )/ ./ 需要/ 注意/ 的/ 是/ 如果/ 算法/ 防御/ 仅/ 加入/ 时延/ 而/ 不/ 进行/ 加密/ 前/ Cache/ 预热/ 处理/ ,/ 并/ 不能/ 有效/ 防御/ 访问/ 驱动/ Cache/ 攻击/ 和/ 踪迹/ 驱动/ Cache/ 攻击/ ./ 因此/ 在/ AES/ 实现/ 过程/ 中/ ,/ 将/ Cache/ 预热/ 和/ 随机/ 时延/ 结合/ 起来/ ,/ 可/ 有效/ 防御/ 目前/ 所有/ 的/ Cache/ 计时/ 攻击/ ./ 7/ 总结/ 本文/ 对/ AESCache/ 计时/ 模板/ 攻击/ 进行/ 了/ 研究/ ,/ 在/ 对/ Bernstein/ 的/ AES/ 第一轮/ Cache/ 计时/ 模板/ 攻击/ 基础/ 上/ ,/ 提出/ 了/ 一种/ 新/ 的/ 基于/ Pearson/ 相关性/ 系数/ 的/ Cache/ 计时/ 外部/ 模板/ 匹配/ 算法/ ,/ 对/ AES/ 第一轮/ 和/ 最后/ 一轮/ 进行/ 了/ 分析/ 应用/ ,/ 然后/ 利用/ 一次/ 加密/ 不同/ 次/ 查找/ 同一/ S/ 盒/ 时间/ 搭建/ 内部/ 模板/ ,/ 提出/ 了/ 一种/ 新/ 的/ Cache/ 计时/ 内部/ 模板/ 分析模型/ ,/ 并/ 对/ AES/ 第一轮/ 和/ 最后/ 一轮/ 进行/ 了/ 分析/ 应用/ ;/ 在/ 两种/ 模板/ 分析/ 的/ 模型/ 基础/ 上/ ,/ 对/ 不同/ 操作系统/ 、/ 不同/ 密码/ 库/ 、/ 不同/ 加密/ Cache/ 初始状态/ ,/ 对/ AES/ 实现/ 抗/ Cache/ 计时/ 模板/ 攻击能力/ 进行/ 了/ 研究/ ./ 结果表明/ ,/ 加密/ 前/ 将/ S/ 盒/ 预先/ 加载/ 到/ Cache/ 中/ 并/ 不能/ 消除/ 查找/ 不同/ S/ 盒/ 索引/ 的/ 访问/ 时间/ 差异/ ,/ 进而/ 不能/ 有效/ 防御/ Cache/ 计时/ 模板/ 攻击/ ;/ 最新/ 的/ 各类/ 密码/ 库中/ AES/ 实现/ 仍然/ 存在/ 安全隐患/ ,/ 仍易/ 遭受/ Cache/ 计时/ 模板/ 攻击/ 威胁/ ;/ 防御/ 此类/ 攻击/ 可/ 通过/ 在/ AES/ 加密/ 首轮/ 和/ 末/ 轮/ 提前/ 将/ 查找/ 表/ 加载/ 到/ Cache/ 中/ ,/ 并/ 增加/ 一定/ 的/ 随机/ 时延/ 来/ 实现/ ./ 

