Page1/ 基于/ Pr/ ü/ fer/ 序列/ 的/ RDF/ 数据/ 索引/ 与/ 查询/ 刘翔/ 宇/ 1/ )/ 吴刚/ 2/ )/ ,/ 3/ )/ 2/ )/ (/ 医学影像/ 计算/ 教育部/ 重点/ 实验室/ (/ 东北大学/ )/ 沈阳/ 110819/ )/ 1/ )/ (/ 东南大学/ 计算机科学/ 与/ 工程学院/ 南京/ 210096/ )/ 3/ )/ (/ 东北大学/ 信息科学/ 与/ 工程学院/ 沈阳/ 110819/ )/ 摘要/ 语义/ Web/ 作为/ 数据/ 之网/ 不断/ 汇集/ 并/ 组织/ Web/ 信息/ ,/ 相关/ 应用/ 因此/ 面临/ 着/ 对/ 语义/ Web/ 所含/ 大规模/ RDF/ 数据/ 高效/ 访问/ 的/ 挑战/ ./ 建立/ 有效/ 的/ 索引/ 机制/ 是/ 提升/ RDF/ 数据管理/ 和/ 查询/ 性能/ 的/ 一种/ 解决之道/ ./ 序列/ 式/ 索引/ 既/ 能够/ 支持/ 存储空间/ 压缩/ 又/ 便于/ 采用/ 成熟/ 的/ 序列/ 匹配/ 技术/ 进行/ 数据处理/ ,/ 具有/ 较/ 好/ 的/ 查询处理/ 性能/ ./ 文中/ 扩展/ Pr/ ü/ fer/ 序列/ 以/ 支持/ RDF/ 数据/ 上/ 的/ 索引/ 和/ 查询/ ,/ 实现/ 了/ 名为/ Prig/ 的/ 原型/ 系统/ ./ 实验/ 比较/ 并/ 分析/ 了/ 该/ 系统/ 与/ 对比/ 系统/ 在/ LUBM/ 和/ SP2Bench/ 两个/ 测试/ 基准/ 上/ 的/ 实验/ 结果/ ,/ 指出/ 扩展/ 的/ Pr/ ü/ fer/ 索引/ 在/ 大规模/ RDF/ 数据/ 上/ 有着/ 比/ 对比/ 系统/ 更好/ 的/ 查询处理/ 性能/ ./ 关键词/ RDF/ ;/ Pr/ ü/ fer/ 序列/ ;/ 索引/ ;/ 查询/ 1/ 引言/ 学界/ 和/ 工业界/ 在内/ 的/ 研究/ 人员/ 的/ 关注/ ./ 语义/ Web/ 中/ 的/ 数据/ 是/ 以/ RDF/ (/ ResourceDescriptionFramework/ )/ ①/ 数据/ 的/ 形式/ 进行/ 表示/ 的/ ./ RDF/ 提供/ 了/ 灵活/ 的/ 数据模型/ 以/ 用于/ 表达/ 数据/ 之间/ 的/ 关系/ ./ 基于/ 这种/ 模型/ 的/ 语义/ Web/ [/ 1/ ]/ 作为/ 下一代/ Web/ 正/ 越来越/ 受到/ 包括/ Page2/ 数据/ 提供/ 了/ 人/ 和/ 机器/ 均/ 易于/ 理解/ 的/ 语义/ ./ 本质/ 上/ RDF/ 数据/ 是/ 一个/ 巨大/ 的/ 有向图/ ./ 在/ 这个/ 图中/ ,/ 每个/ 现实/ 世界/ 中/ 可以/ 标识/ 的/ 实体/ 都/ 是/ 一个/ 结点/ ,/ 两个/ 实体/ 之间/ 的/ 相互/ 关系/ 可以/ 看作/ 是/ 连接/ 这/ 两个/ 实体/ 的/ 带/ 标记/ 的/ 有/ 向/ 边/ ./ RDF/ 数据模型/ 在/ 提供/ 这种/ 灵活/ 而/ 强大/ 的/ 能力/ 的/ 同时/ 也/ 带来/ 了/ 数据/ 存储/ 和/ 处理/ 复杂度/ 提高/ 的/ 问题/ ./ 如何/ 高效/ 地/ 存储/ 和/ 查询/ 大规模/ 的/ RDF/ 数据/ 一直/ 是/ 语义/ Web/ 数据管理/ 中/ 的/ 难题/ ./ 建立/ 有效/ 的/ 索引/ 机制/ 是/ 提升/ RDF/ 数据管理/ 和/ 查询/ 性能/ 的/ 一种/ 方法/ ./ 序列/ 式/ 索引/ 既/ 能够/ 支持/ 存储空间/ 压缩/ 又/ 便于/ 采用/ 成熟/ 的/ 序列/ 匹配/ 技术/ 进行/ 处理/ ,/ 具有/ 较/ 好/ 的/ 查询处理/ 性能/ ./ 考虑/ 到/ Pr/ ü/ fer/ 序列化/ ①/ 方法/ 能够/ 有效/ 图/ 1Prig/ 整体/ 架构/ 本文/ 将/ 首先/ 介绍/ RDF/ 数据模型/ 、/ SPARQL/ 查询语言/ ②/ 与/ Pr/ ü/ fer/ 序列化/ 方法/ ,/ 之后/ 介绍/ RDF/ 数据管理/ 和/ 序列化/ 相关/ 的/ 工作/ ,/ 第/ 4/ 节/ 详细/ 论述/ 实现/ 数据/ 和/ 查询/ 序列化/ 的/ 方法/ ;/ 第/ 5/ 节/ 论述/ 相应/ 的/ 匹配/ 规则/ ;/ 第/ 6/ 节/ 给出/ 实验/ 结果/ 并/ 加以分析/ ;/ 最后/ 对/ 本文/ 工作/ 总结/ ./ 2RDF/ 数据模型/ 与/ SPARQL/ 查询语言/ 2.1/ RDF/ 数据模型/ RDF/ 的/ 基本/ 构成/ 是/ 以/ 三元组/ 〈/ subject/ ,/ predicate/ ,/ object/ 〉/ 形式/ 存在/ 的/ 对/ 资源/ 的/ 陈述/ (/ statement/ )/ ./ 每/ 一个/ 三元组/ 包括/ 一个/ 主语/ (/ subject/ )/ 、/ 一个/ 谓语/ (/ predicate/ )/ 和/ 一个/ 宾语/ (/ object/ )/ ./ 三元组/ 的/ 集合/ 称为/ RDF/ 图/ ./ RDF/ 图/ 可以/ 通过/ 带有/ 标签/ 的/ 结点/ 和/ 带有/ 标签/ 的/ 边/ 表示/ ,/ 其中/ 每/ 一个/ 三元组/ 对应/ 为/ 图/ 上/ 的/ 一个/ “/ 结点/ -/ 边/ -/ 结点/ ”/ 的/ 子/ 图/ ,/ 陈述/ 了/ 由/ 谓语/ 表示/ 的/ 在/ 主语/ 和/ 宾语/ 所指/ 的/ 事物/ 之间/ 的/ 关系/ [/ 3/ ]/ ./ 一个/ RDF/ 图/ 的/ 结点/ 就是/ 它/ 包含/ 的/ 所有/ 三元组/ 的/ 主语/ 和/ 宾语/ ,/ 而边/ 的/ 方向/ 总是/ 指向/ 宾语/ ./ 通常/ 可以/ 把/ RDF/ 图/ 看作/ 一个/ 有/ 向/ 标记/ 图/ ./ 如图/ 2/ 所示/ ./ 地/ 支持/ 树形/ 结构/ 数据/ 的/ 索引/ 和/ 查询处理/ [/ 2/ ]/ ,/ 但尚/ 不能/ 支持/ 图/ 数据/ 的/ 索引/ 和/ 查询处理/ ,/ 本文/ 提出/ 了/ 一种/ 扩展/ Pr/ ü/ fer/ 序列化/ 的/ 方法/ ,/ 设计/ 并/ 实现/ 了/ 名为/ Prig/ (/ Pr/ ü/ fersequencesforIndexingGraph/ )/ 的/ 原型/ 系统/ 以/ 支持/ 对/ RDF/ 图/ 数据/ 的/ 相应/ 处理/ ./ 与/ 索引/ 和/ 查询/ 树形/ 结构/ 数据/ 类似/ ,/ Prig/ 系统/ 将/ RDF/ 数据/ 解析/ 成/ RDF/ 图/ ,/ 然后/ 利用/ 扩展/ 的/ Pr/ ü/ fer/ 序列化/ 方法/ 生成/ RDF/ 图/ 序列/ ,/ 并/ 进行/ 索引/ ;/ RDF/ 查询/ 语句/ 被/ 转换/ 为/ 查询/ 子图/ ,/ 同样/ 生成/ 扩展/ 的/ Pr/ ü/ fer/ 序列/ ;/ 通过/ 匹配/ 查询/ 子图/ 序列/ 与/ 原/ RDF/ 图/ 序列/ 以及/ 后处理/ 操作/ ,/ 即可/ 得到/ 查询/ 结果/ ./ 系统/ 架构/ 如图/ 1/ 所示/ ./ RDF/ 图/ 的/ 含义/ 就是/ 其/ 所有/ 三元组/ 陈述/ 的/ 合取/ ./ 例如/ 如下/ 三元组/ 集合/ 表示/ 的/ RDF/ 图/ 的/ 含义/ 是/ :/ XXX/ 是/ 一名/ 教授/ ,/ 他/ 在/ University1/ 工作/ ,/ 他/ 是/ Department1/ 的/ 成员/ ,/ Department1/ 是/ University1/ 的/ 一个/ 下属/ 机构/ ./ 〈/ XXX/ ,/ rdf/ :/ type/ ,/ Professor/ 〉/ ,/ 〈/ XXX/ ,/ worksFor/ ,/ University1/ 〉/ ,/ 〈/ XXX/ ,/ memberOf/ ,/ Department1/ 〉/ ,/ 〈/ Department1/ ,/ subOrgnizationOf/ ,/ University1/ 〉/ ./ 2.2/ SPARQL/ 查询语言/ SPARQL/ (/ SimpleProtocolandRDFQueryLanguage/ )/ 是/ 目前/ W3C/ (/ WorldWideWebConsor/ -/ tium/ )/ 针对/ RDF/ 查询语言/ 的/ 推荐/ 标准/ ,/ 它/ 定义/ 了/ RDF/ 查询语言/ 的/ 语法/ 和/ 语义/ ./ 例如/ ,/ “/ 查询/ 工作/ 于/ University1/ 并且/ 是/ Department1/ 成员/ 的/ 教授/ ”/ ,/ 可/ ①/ ②/ Page3/ 以/ 构造/ 如下/ SPARQL/ 语句/ :/ SELECT/ ?/ xWhere/ {/ ?/ xrdf/ :/ typeProfessor/ ./ 以上/ SPARQL/ 查询/ 可用/ 图/ 3/ 直观/ 表示/ ./ 三元组/ 模式/ 的/ 集合/ ,/ 称为/ 基本/ 图/ 模式/ (/ basicgraphpattern/ )/ ./ 三元组/ 模式/ 类似/ 于/ RDF/ 三元组/ ,/ 不同之处/ 在于/ 主语/ 、/ 谓语/ 和/ 宾语/ 可以/ 是/ 变量/ ./ 一个/ 基本/ 图/ 模式匹配/ RDF/ 数据/ 图/ 的/ 一个/ 子图/ ,/ 其/ 条件/ 是子/ 图中/ 的/ RDF/ 术语/ (/ 统一/ 资源/ 标识符/ 、/ 字面/ 量/ 、/ 空白/ 结点/ )/ 可以/ 被/ 变量/ 置换/ ,/ 置换/ 结果/ 和/ 原/ 基本/ 图/ 模式/ 等价/ ./ 2.3/ Pr/ ü/ fer/ 序列化/ 方法/ Pr/ ü/ fer/ 序列化/ 是/ 一种/ 通过/ 每次/ 删除/ 树上/ 的/ 一个/ 结点/ 来/ 构造/ 一个/ 序列/ 的/ 方法/ ./ 构造/ 序列/ 的/ 一般/ 方法/ 是/ 对/ 树/ 进行/ 后根/ 顺序/ 遍历/ ,/ 删除/ 叶/ 节点/ 的/ 同时/ 记录/ 删除/ 结点/ 的/ 双亲/ 结点/ ,/ 从而/ 生成/ 相应/ 序列/ ./ Pr/ ü/ fer/ 序列/ 中/ 的/ 每个/ 元素/ 与/ 树上/ 的/ 每个/ 结点/ 一一对应/ ./ 如图/ 4/ 所示/ 的/ 树/ 对应/ 的/ Pr/ ü/ fer/ 序列/ 是/ :/ (/ B/ ,/ 3/ )/ (/ B/ ,/ 3/ )/ (/ A/ ,/ 7/ )/ (/ B/ ,/ 6/ )/ (/ B/ ,/ 6/ )/ (/ A/ ,/ 7/ )/ ./ 扩展/ 的/ Pr/ ü/ fer/ 序列/ [/ 2/ ]/ 的/ 方法/ 被/ 应用/ 于/ XML/ 数据/ 的/ 索引/ 语/ 查询/ ,/ 其/ 生成/ 方式/ 与/ 标准/ 的/ Pr/ ü/ fer/ 序列/ 生成/ 方式/ 类似/ ,/ 只是/ 在/ 序列化/ 之前/ ,/ 先为/ 树中/ 的/ 每个/ 叶子/ 结点/ 添加/ 一个/ 空/ 节点/ 作为/ 子/ 节点/ ,/ 然后/ 生成/ Pr/ ü/ fer/ 序列/ ./ 这样/ 能够/ 将/ 叶子/ 结点/ 也/ 纳入/ 序列/ 中/ ./ 在/ 实现/ 中/ ,/ 序列/ 通常/ 被/ 分为/ 两/ 部分/ ,/ 一部分/ 为/ 标签/ 序列/ LPS/ (/ LabelPr/ ü/ ferSequence/ )/ ,/ 另/ 一部分/ 为/ 数字/ 序列/ NPS/ (/ NumberPr/ ü/ ferSequence/ )/ ./ 上图/ 中/ ,/ 结点/ 旁/ 标记/ 的/ 字母/ A/ ,/ B/ ,/ C/ 为/ 标签/ 名称/ ,/ 1/ ,/ 2/ ,/ 3/ ,/ 4/ ,/ …/ 是/ 用来/ 唯一/ 标识/ 结点/ 的/ 标记/ ./ LPS/ 就是/ 记录/ 结点/ 的/ 这些/ 信息/ 的/ 序列/ ,/ NPS/ 则/ 记录/ 了/ 相应/ 的/ 数字/ 标记/ 信息/ ./ 对于/ 大多数/ 查询/ 而言/ ,/ 只/ 需/ 提供/ 待查/ 的/ 标签/ 名称/ ,/ 要求/ 系统/ 返回/ 相应/ 的/ 数据/ ,/ 通过/ LPS/ 可以/ 确定/ 可能/ 的/ 候选/ 结果/ ,/ 进而/ 利用/ NPS/ 剔除/ 错误/ 结果/ ,/ 返回/ 正确/ 结果/ ./ 对于/ 上图/ 的/ 例子/ ,/ 采用/ 扩展/ 的/ Pr/ ü/ fer/ 序列化/ 方法/ 生成/ 的/ LPS/ 和/ NPS/ 如下/ :/ LPS/ :/ C/ ,/ B/ ,/ A/ ,/ B/ ,/ A/ ,/ A/ ,/ B/ ,/ B/ ,/ B/ ,/ A/ ;/ NPS/ :/ 1/ ,/ 3/ ,/ 2/ ,/ 3/ ,/ 7/ ,/ 4/ ,/ 6/ ,/ 5/ ,/ 6/ ;/ 7.3/ 相关/ 工作/ 3.1/ RDF/ 数据管理/ 目前/ RDF/ 数据/ 的/ 存储/ 和/ 查询/ 工具/ 主要/ 有/ Sesame/ [/ 4/ ]/ 、/ Jena/ [/ 5/ ]/ 、/ 3Store/ [/ 6/ ]/ 以及/ RDFStore/ [/ 7/ ]/ 等/ ./ Sesame/ 是/ 一个/ 独立/ 于/ 存储/ 的/ 支持/ SPARQL/ 查询/ 的/ 系统/ ,/ 采用/ 图/ 匹配/ 的/ 方法/ ,/ 支持/ 语义/ Web/ 上/ 的/ 数据/ 查询/ ./ 3Store/ 在/ 数据/ 存储/ 的/ 层面/ 上/ 采用/ 了/ MySQL/ 数据库/ ,/ 主要/ 关注/ 于/ 交互式/ 的/ 查询/ 性能/ 和/ 数据/ 导入/ 时间/ ./ 在/ Jena/ 中/ ,/ 数据/ 的/ 存储/ 可以/ 采用/ 多种/ 的/ 后台/ 数据库/ ,/ 但/ 大多数/ 情况/ 下/ 采用/ 简单/ 的/ 关系数据库/ :/ 对/ Statement/ 、/ URI/ 和/ Literal/ 分别/ 建立/ 数据表/ ./ 这些/ 工具/ 作为/ 目前/ RDF/ 数据管理/ 的/ 主要/ 工具/ ,/ 为/ 语义/ Web/ 的/ 发展/ 奠定/ 了/ 基础/ ,/ 但是/ 也/ 存在/ 一些/ 问题/ :/ (/ 1/ )/ RDF/ 数据/ 不能/ 直接/ 在/ 关系数据库/ 中/ 存储/ 和/ 查询/ ./ 通常/ 需要/ 使用/ 中间层/ 转换/ 工具/ 将/ SPARQL/ 查询/ 转换/ 为/ SQL/ 查询/ ,/ 这样/ 大大/ 地/ 降低/ 了/ 系统/ 的/ 性能/ ./ (/ 2/ )/ 一些/ 工具/ ,/ 例如/ Jena/ 采用/ 将/ RDF/ 数据/ 中/ 的/ 元素/ 分类/ 存储/ 的/ 办法/ ,/ 这/ 虽然/ 避免/ 了/ 使用/ 中间层/ 处理/ ,/ 但是/ 带来/ 了/ 大量/ 连接/ 操作/ ,/ 导致系统/ 性能/ 下降/ ./ 后续/ 的/ 改进/ 方案/ 中/ ,/ Jena/ 在/ 其/ 存储/ 中/ 使用/ 更加/ 详细/ 的/ 表/ 模式/ ,/ 这样/ 又/ 带来/ 了/ 存储/ 开销/ 增加/ 的/ 问题/ ./ 在/ 本文/ 所/ 提出/ 的/ Prig/ 系统/ 中将/ 使用/ Sesame/ 作为/ 性能/ 比较/ 的/ 基准/ ./ 选择/ Sesame/ 对比/ 的/ 主要/ 原因/ 是/ 考虑/ 到/ Sesame/ 采用/ 的/ 处理/ 方法/ 代表/ 了/ 传统/ 的/ RDF/ 数据处理/ 方式/ :/ 基于/ Triplestore/ ,/ 使用/ 大量/ 的/ 三元组/ 选择/ // 连接/ 操作/ 完成/ SPARQL/ 查询/ ,/ 可能/ 会/ 导致系统/ 性能/ 较/ 低/ ,/ 而/ Prig/ 则/ 针对/ 这一/ 问题/ 进行/ 了/ 另/ 一种/ 方式/ 的/ 探索/ ./ 3.2/ Pr/ ü/ fer/ 序列/ 在/ 文档/ 匹配/ 中/ 的/ 应用/ 采用/ Pr/ ü/ fer/ 序列化/ 方法/ 进行/ 文档/ 匹配/ 的/ 研究/ 工作/ 主要/ 集中/ 于/ 对/ 树形/ 结构/ 的/ XML/ 文档/ 的/ 匹配/ ./ ViST/ [/ 8/ ]/ 是/ 一种/ 将/ XML/ 文档/ 以及/ twig/ 查询/ 编码/ 为/ 一个/ 序列/ 的/ 方法/ ./ 该/ 序列/ 是/ 一个二维/ 结构/ :/ {/ (/ a1/ ,/ p1/ )/ ,/ (/ a2/ ,/ p2/ )/ …/ …/ }/ ,/ 其中/ ai/ 是/ 结点/ 元素/ ,/ pi/ 是/ 到/ ai/ 的/ 路径/ 信息/ ,/ 通过/ 路径/ 的/ 信息/ 实现/ 对/ XML/ 数据/ 的/ 查询/ 匹配/ ./ 在/ 最坏/ 情况/ 下/ ,/ 存储空间/ 复杂度/ 为/ O/ (/ n2/ )/ ,/ 且/ 查询/ 结果/ 集中/ 存在/ 错误/ 结果/ ./ PRIX/ [/ 2/ ]/ 通过/ 将/ 树形/ 结构/ 的/ XML/ 文档/ 生成/ LPS/ (/ LabelPr/ ü/ ferSequence/ )/ 和/ NPS/ (/ NumberPr/ ü/ ferSequence/ )/ ,/ 利用/ Page4/ 序列/ 中/ 元素/ 之间/ 的/ 一致性/ 和/ 间距/ 等/ 特性/ 进行/ 查询/ 和/ 结果/ 集/ 过滤/ ,/ 返回/ 最终/ 结果/ ./ 基于/ PRIX/ ,/ Prasad/ 等/ 人/ [/ 9/ ]/ 提出/ 了/ 一种/ 变化/ 的/ Pr/ ü/ fer/ 序列化/ 方法/ ,/ 生成/ 相应/ 序列/ ,/ 并/ 对/ 原有/ 的/ 树形/ XML/ 文档/ 进行/ 分层/ ,/ 进一步/ 优化/ 查询/ 效率/ ,/ 一次性/ 返回/ 正确/ 的/ 结果/ 集/ ./ Pr/ ü/ fer/ 序列/ 还/ 应用/ 于/ 本体/ 匹配/ 领域/ ,/ 将/ 本体/ 语义/ 信息/ 采用/ Pr/ ü/ fer/ 序列化/ 方法/ 表示/ ,/ 进而/ 进行/ 相应/ 的/ 匹配/ [/ 10/ ]/ ./ 现有/ 的/ 方法/ 不能/ 直接/ 应用/ 于图/ 数据/ 的/ 处理/ ,/ 当然/ 也/ 无法/ 直接/ 用于/ 处理/ RDF/ 图/ 数据/ ./ 这/ 主要/ 是/ 由于/ 以下/ 问题/ 决定/ 的/ :/ (/ 1/ )/ 对于/ 图中/ 的/ 边/ 含有/ 标记/ 信息/ 的/ 情况/ 下/ 匹配/ 难以/ 处理/ ./ (/ 2/ )/ 匹配/ 算法/ 对于/ RDF/ 图/ 的/ 特点/ 缺少/ 具有/ 针对性/ 的/ 解决/ 策略/ ,/ 造成/ 匹配/ 算法/ 运行/ 时间/ 开销/ 的/ 增加/ ./ 在/ 对/ RDF/ 图/ 进行/ 的/ 查询/ 中/ ,/ 经常/ 有/ 一些/ 查询/ 包含/ 了/ 对/ 结点/ 的/ 约束/ 信息/ ,/ 这些/ 查询/ 如果/ 用/ 一般/ 的/ 图/ 模式匹配/ 方法/ 会/ 造成/ 较大/ 的/ 开销/ ,/ 进而/ 影响/ 系统/ 的/ 性能/ ./ 在/ Prig/ 中/ ,/ 根据/ RDF/ 图/ 的/ 特点/ 改进/ Pr/ ü/ fer/ 序列/ 方法/ 生成/ 并/ 匹配/ 序列/ ,/ 可以/ 有效/ 降低/ 系统/ 开销/ ,/ 提高/ 系统/ 性能/ ./ 有关/ 图/ 的/ 管理/ 和/ 挖掘/ 的/ 相关/ 知识/ ,/ 可以/ 参见/ 文献/ [/ 11/ ]/ ./ 4RDF/ 图/ 和/ 查询/ 子图/ 的/ 序列化/ 4.1/ 问题/ 定义/ 在/ Prig/ 系统/ 中/ ,/ RDF/ 图/ 和/ 查询/ 子图/ 被/ 分别/ 转换/ 为/ Pr/ ü/ fer/ 序列/ ,/ 然后/ 通过/ 采用/ 序列/ 匹配/ 为/ 方法/ 完成/ 图/ 的/ 查询/ 匹配/ ./ 为此/ 我们/ 给出/ 如下/ 定义/ ./ 定义/ 1/ ./ 全图/ Pr/ ü/ fer/ 序列/ ./ RDF/ 图/ G/ 经过/ Pr/ ü/ fer/ 序列化/ 方法/ 生成/ 的/ Pr/ ü/ fer/ 序列/ 称为/ 全图/ Pr/ ü/ fer/ 序列/ ,/ 记为/ SG/ ./ |/ SG/ |/ 表示/ 序列/ 的/ 长度/ ,/ 即/ 序列/ 中/ 元素/ 的/ 数量/ ./ 用/ SGi/ 表示/ 序列/ 中/ 第/ i/ 个/ 元素/ ,/ 其中/ 1/ / i/ / |/ SG/ |/ ./ 在/ 本文/ 中/ 如果/ 不/ 特别/ 指明/ ,/ 将/ 全图/ Pr/ ü/ fer/ 序列/ 简称/ 为/ 全图/ 序列/ ./ 定义/ 2/ ./ 查询/ 子图/ Pr/ ü/ fer/ 序列/ ./ 由/ 查询/ 子图/ 经过/ Pr/ ü/ fer/ 序列化/ 方法/ 生成/ 的/ Pr/ ü/ fer/ 序列/ 称为/ 查询/ 子图/ Pr/ ü/ fer/ 序列/ ,/ 记为/ SQ/ ./ |/ SQ/ |/ 表示/ 序列/ 的/ 长度/ ,/ 即/ 序列/ 中/ 元素/ 的/ 数量/ ./ 用/ SQi/ 表示/ 序列/ 中/ 第/ i/ 个/ 元素/ ,/ 其中/ 1/ / i/ / |/ SQ/ |/ ./ 在/ 本文/ 中/ 如果/ 不/ 特别/ 指明/ ,/ 将/ 查询/ 子图/ Pr/ ü/ fer/ 序列/ 简称/ 为/ 查询/ 序列/ ./ 定义/ 3/ ./ 基于/ Pr/ ü/ fer/ 序列/ 匹配/ 的/ 查询/ ./ 依次/ 从/ SQ/ 中自/ 左至/ 右/ 选取/ 元素/ SQi/ ,/ 根据/ 匹配/ 规则/ 从/ SG/ 中/ 选取/ 相应/ 元素/ ,/ 完成/ 整个/ 序列/ 匹配/ 的/ 过程/ ./ 对于/ SQi/ (/ 1/ / i/ </ |/ SQ/ |/ )/ ,/ 若/ 存在/ SGj/ 与/ 之/ 匹配/ ,/ 则/ SQi/ +/ 1/ 其/ 候选/ 结点/ 自/ SGj/ 之后/ 继续/ 开始查找/ ./ 定义/ 4/ ./ 查询/ 结果/ Pr/ ü/ fer/ 序列/ ./ 由/ 满足/ 查询/ 条件/ 的/ SG/ 中/ 的/ 结点/ 构成/ 的/ 序列/ 称为/ 结果/ Pr/ ü/ fer/ 序列/ ,/ 记为/ SA/ ./ |/ SA/ |/ 表示/ 序列/ 的/ 长度/ ,/ 即/ 序列/ 中/ 元素/ 的/ 数量/ ./ 用/ SAi/ 表示/ 序列/ 中/ 第/ i/ 个/ 元素/ ,/ 其中/ 1/ / i/ / |/ SA/ |/ ./ 在/ 本文/ 中如/ 不/ 特别/ 指明/ ,/ 将/ 查询/ 结果/ Pr/ ü/ fer/ 序列/ 简称/ 为/ 结果/ 序列/ ./ SA/ 中/ 的/ 所有/ 元素/ 均/ 由/ SG/ 中/ 的/ 元素/ 组成/ 并/ 保持/ 了/ 其/ 在/ SG/ 中/ 的/ 相对/ 位置/ ,/ 因此/ SA/ 是/ SG/ 的/ 子/ 序列/ ./ 除/ 以上/ 定义/ 外/ ,/ 我们/ 还/ 做/ 如下/ 规定/ :/ 若/ 没有/ 指明/ 具体/ 使用/ 哪/ 一种/ 序列/ ,/ 则/ 将/ 直接/ 使用/ S/ 表示/ 以上/ 任意/ 一种/ Pr/ ü/ fer/ 序列/ ,/ 序列/ 中/ 的/ 元素/ 相应/ 记为/ Si/ ./ 对于/ 以上/ 序列/ 中/ 元素/ 所/ 对应/ 的/ 图上/ 结点/ 的/ 入度/ 和/ 出度/ 分别/ 记为/ di/ (/ )/ 和/ do/ (/ )/ ,/ 例如/ 查询/ 序列/ 中/ 元素/ i/ 对应/ 结点/ 的/ 入度/ 可以/ 记为/ di/ (/ SQi/ )/ ./ 序列/ 对应/ 图/ 的/ 出边/ 集合/ 用/ Eo/ (/ )/ 表示/ ,/ 例如/ 全图/ 序列/ SGi/ 对应/ 图/ 的/ 出边/ 集合/ 记为/ Eo/ (/ SGi/ )/ ./ 4.2/ RDF/ 图/ 转化/ 为/ Pr/ ü/ fer/ 序列/ 将/ RDF/ 图/ 转化/ 为/ Pr/ ü/ fer/ 序列/ 主要/ 面临/ 以下/ 几/ 方面/ 的/ 问题/ ./ 首先/ ,/ 在/ 树形/ 结构/ 中/ 生成/ Pr/ ü/ fer/ 序列/ 要求/ 结点/ 上/ 有/ 全局/ 标签/ (/ label/ )/ 信息/ ,/ 用于/ 标识/ 结点/ 所属/ 的/ 类别/ ,/ 多个/ 节点/ 可以/ 具有/ 相同/ 的/ 全局/ 标签/ ./ RDF/ 图中/ 这种/ 类别/ 信息/ 则/ 是/ 通过/ 三元组/ 来/ 表示/ 的/ ./ RDF/ 图中/ 结点/ 上/ 的/ 标签/ 则/ 唯一/ 标识/ 结点/ 的/ 标记/ ,/ 但/ 无法/ 表示/ 结点/ 所属/ 的/ 类别/ ./ 为了/ 能够/ 利用/ Pr/ ü/ fer/ 序列/ 方法/ ,/ 需要/ 相应/ 将/ 三元组/ 表示/ 的/ 信息/ 转化/ 为/ 结点/ 上/ 的/ 全局/ 标签/ 信息/ ./ 其次/ ,/ Pr/ ü/ fer/ 序列/ 起初/ 应用/ 于/ 树形/ 结构/ ./ 对于/ 图/ 的/ 一个/ 结点/ 允许/ 有/ 多个/ 双亲/ 结点/ ,/ 其/ 结构/ 较之于/ 树形/ 结构/ 更为/ 复杂/ ./ 因此/ ,/ 在/ 序列化/ 过程/ 中/ ,/ 记录/ 结点/ 的/ 双亲/ 结点/ 也/ 存在/ 一些/ 问题/ ./ 例如/ ,/ 在/ 图/ 5/ 中/ ,/ 结点/ course1/ 存在/ graduatestudent1/ 和/ profes/ -/ sor2/ 等/ 4/ 个/ 双亲/ 结点/ ,/ 与此同时/ ,/ graduatestudent1/ 又/ 是/ professor2/ 的/ 双亲/ 结点/ ,/ 这种/ 层次/ 上/ 的/ 混乱/ 在/ 树/ 中/ 是/ 不会/ 出现/ 的/ ./ 针对/ 树形/ 结构/ 构造/ 的/ Pr/ ü/ fer/ 序列/ 所/ 具有/ 的/ 一系列/ 性质/ ,/ 很大/ 程度/ 上/ 是/ 由于/ 单一/ 的/ 双亲/ 结点/ 对/ 孩子/ 结点/ 在/ 序列/ 中/ 的/ 位置/ 进行/ 了/ 分割/ [/ 2/ ]/ ./ 图中/ 多/ 双亲/ 关系/ 的/ 存在/ ,/ 弱化/ 了/ 这些/ 性质/ ,/ 使得/ 后续/ 在/ 剔除/ 错误/ 候选/ 结果/ 时/ 很/ 难/ 利用/ 这些/ 性质/ ./ 此外/ ,/ RDF/ 图/ 的/ 边/ 具有/ 标签/ 信息/ ./ 传统/ Pr/ ü/ fer/ 标记/ 方法/ 中/ 并未/ 考虑/ 树形/ 结构/ 中/ 结点/ 之间/ 边/ 的/ 标签/ 信息/ ./ 展/ Pr/ ü/ fer/ 序列化/ 方法/ 来/ 解决/ 以上/ 问题/ ./ Prig/ 提出/ 了/ 一种/ 针对/ 图/ (/ 特别/ 是/ RDF/ 图/ )/ 的/ 扩/ Page5/ 针对/ 缺少/ 全局/ 标签/ 的/ 情况/ ,/ Prig/ 中/ 采取/ 的/ 方法/ 是/ 将/ RDF/ 图中/ 所有/ 的/ 以/ rdf/ :/ type/ 为/ 谓语/ 的/ 三元组/ 中/ 宾语/ 的/ URI/ 作为/ 主语/ 结点/ 的/ 全局/ 标签/ ./ 本文/ 称之为/ “/ 一般化/ 处理/ ”/ ./ 为了/ 便于/ 描述/ ,/ 首先/ 将/ 图/ 5/ 中/ 的/ rdf/ :/ type/ 信息/ (/ 例如/ :/ GraduateStudent/ )/ 、/ 实体/ 信息/ (/ 例如/ :/ graduate1/ )/ 以及/ 边/ 信息/ (/ 例如/ :/ takesCourse/ )/ 等/ 分别/ 规定/ 其/ 简写/ 形式/ 并/ 赋予/ 其/ id/ ./ 具体/ 如表/ 1/ ~/ 3/ 所示/ ./ 如/ 无/ 特别/ 指明/ ,/ 本文/ 以后/ 提到/ 的/ 全局/ 标签/ 和/ 边/ 标签/ 将/ 均/ 用/ 简称/ 表述/ ./ 在/ RDF/ 中/ ,/ rdf/ :/ type/ 用来/ 说明/ 某个/ 实体/ 是/ 某个/ 类/ 的/ 一个/ 实例/ ./ 以图/ 5/ 为例/ ,/ graduateStudent1/ ,/ professor1/ 以及/ course1/ 的/ rdf/ :/ type/ 分别/ 为/ Graduate/ -/ Student/ ,/ Professor/ 和/ Course/ ;/ 经过/ 一般化/ 处理/ 将/ 结点/ 的/ rdf/ :/ type/ 信息/ 作为/ 结点/ 的/ 标签/ ./ 然而/ RDF/ 图中/ 并非/ 所有/ 结点/ 都/ 有/ 类/ 信息/ ./ 对于/ 这部分/ 结点/ ,/ 在/ 查询处理/ 中/ 不得不/ 匹配/ 任何/ 待/ 查询/ 的/ 标签/ ./ Prig/ 将/ 此类/ 结点/ 的/ 标签/ 统一/ 设为/ ANY/ _/ LABEL/ ./ 经过/ 一般化/ 处理/ 的/ RDF/ 图如图/ 6/ 所示/ ./ 对于/ 结点/ 可能/ 存在/ 多个/ 双亲/ 结点/ 的/ 问题/ ,/ 则/ 采用/ 合并/ 双亲/ 结点/ 的/ 方法/ 进行/ 处理/ :/ 记录/ 每个/ 待/ 删除/ 结点/ ,/ 将/ 其/ 所有/ 双亲/ 结点/ 的/ 集合/ 视为/ 一个/ 合并/ 后/ 的/ 结点/ ,/ 并/ 记录/ 在/ 删除/ 结点/ 之后/ ./ 为了/ 便于/ 描述/ ,/ 称/ 合并/ 后/ 的/ 双亲/ 结点/ 为/ 一个/ bag/ ./ 以图/ 6/ 为例/ ,/ 为了/ 能够/ 记/ RDF/ 图中/ 的/ 所有/ 结点/ 的/ 信息/ ,/ 扩展/ 的/ Pr/ ü/ fer/ 序列化/ 方法/ 在/ 1/ 之前/ 添加/ 一个/ 空/ 节点/ ,/ 采用/ 深度/ 优先/ 拓扑/ 排序/ 的/ 方式/ 删除/ 相应/ 结点/ 记录/ 双亲/ 结点/ ,/ 生成/ Pr/ ü/ fer/ 序列/ 如表/ 5/ 中/ NPS/ 栏/ 所示/ ./ 为了/ 支持/ 边/ 具有/ 标签/ 信息/ 这一/ 情况/ ,/ Prig/ 采用/ 在/ 删除/ 结点/ 记录/ 双亲/ 结点/ 的/ 同时/ 记录/ 边上/ 标签/ 的/ 方法/ ./ 这部分/ 信息/ 也/ 记录/ 在/ bag/ 中/ ./ 例如/ ,/ 对于/ 图/ 6/ 而言/ ,/ 删除/ 结点/ 1/ 时/ ,/ 记录/ 为/ 1/ (/ sB/ :/ 2tc/ :/ 3sB/ :/ 5tc/ :/ 4/ )/ ./ 通过/ 以上/ 方法/ 可以/ 将/ Pr/ ü/ fer/ 序列化/ 方法/ 扩展/ 应用/ 于/ RDF/ 图/ 的/ 序列化/ ./ 其中/ ,/ 在/ 本文/ 中/ 序列/ 元素/ 的/ 定义/ 不/ 包含/ 所/ 记录/ 的/ 双亲/ 结点/ 信息/ 和/ 边/ 标签/ 信息/ ,/ 即/ 不/ 包含/ 记录/ 在/ 序列/ 中括号/ 内/ 的/ 相关/ 信息/ ./ 因此/ ,/ 由/ 定义/ 1/ 或/ 2/ 可知/ ,/ 序列/ 的/ 长度/ 等于/ RDF/ 全图/ 或/ 查询/ 子图/ 中/ 结点/ 的/ 数量/ ./ 同时/ ,/ 序列/ 中/ 的/ 元素/ 与/ 图/ 中/ 的/ 结点/ 之间/ 具有/ 一一对应/ 关系/ ,/ 在/ 本文/ 中/ 不/ 特殊/ 说明/ 的/ 情况/ 下/ 可以/ 替换/ ./ 下面/ 给出/ RDF/ 图/ 转化/ 为/ Pr/ ü/ fer/ 序列/ 的/ 一般/ 步骤/ ./ 算法/ 1/ ./ 将/ RDF/ 图/ 转化/ 为/ Pr/ ü/ fer/ 序列/ 的/ 算法/ ./ 输入/ :/ 一个/ RDF/ 图/ G/ =/ V/ ×/ E/ ,/ 其中/ V/ 是/ 顶点/ 的/ 集合/ ,/ 输出/ :/ Pr/ ü/ fer/ 序列/ PSRDF/ _/ to/ _/ Pr/ ü/ ferSequence/ (/ G/ )/ 1/ ./ PS/ ←/ 空/ 序列/ 2/ ./ WHILE/ / n/ ∈/ V/ 使得/ n/ ./ label/ =/ NULL3/ ./ IFn/ 具有/ 类型/ tTHENn/ ./ label/ ←/ t4/ ./ ELSEn/ ./ label/ ←/ ANY/ _/ LABEL5/ ./ WHILE/ / n/ ∈/ V/ 使得/ n/ ./ id/ =/ NULL6/ ./ n/ ./ id/ ←/ hash/ (/ n/ )/ 7/ ./ 对/ G/ 进行/ 深度/ 优先/ 拓扑/ 排序/ ,/ NS/ ←/ 顶点/ 序列/ 8/ ./ FOREACHnINNS9/ ./ SS/ ←/ / // // 后继者/ 集合/ 10/ ./ FOREACH/ (/ e/ ,/ s/ )/ 使得/ 顶点/ -/ 边/ -/ 顶点/ (/ n/ ,/ e/ ,/ s/ )/ ∈/ G11/ ./ 将/ (/ e/ ,/ s/ )/ 加入/ SS12/ ./ 将/ (/ n/ ,/ SS/ )/ 追加/ 到/ PS/ 最后/ Page613/ ./ 将/ n/ 从/ G/ 中/ 删除/ 14/ ./ RETURNPS/ 算法/ 第/ 1/ ~/ 4/ 行将/ RDF/ 图/ 抽象/ 为/ 普通/ 图/ ./ 这个/ 过程/ 中/ ,/ 将/ RDF/ 图中/ 的/ 结点/ 的/ 类型信息/ 作为/ 全局/ 的/ 标签/ (/ label/ )/ ,/ 使/ RDF/ 图/ 抽象/ 为/ 一个/ Pr/ ü/ fer/ 序列化/ 方法/ 可用/ Pr/ ü/ fer/ 序列化/ 方法/ 处理/ 的/ 一般/ 图/ ,/ 对于/ 没有/ 类型信息/ 的/ 结点/ ,/ 将/ 其/ 标签/ 信息/ 设为/ ANY/ _/ LABEL/ ./ 这一/ 过程/ 同时/ 减少/ 了/ 图/ 中/ 的/ 边/ 和/ 结点/ 的/ 数量/ ./ 对于/ 上/ 一步/ 中/ 得到/ 的/ 一般化/ 图/ ,/ 采用/ 扩展/ 的/ Pr/ ü/ fer/ 序列化/ 方法/ 构造/ RDF/ 的/ Pr/ ü/ fer/ 序列/ ./ 这个/ 过程/ 采用/ 图/ 的/ 深度/ 优先/ 拓扑/ 排序/ (/ 即/ 基于/ 图/ 的/ 深度/ 优先/ 遍历/ 算法/ 的/ 拓扑/ 排序/ ,/ 参见/ 文献/ [/ 12/ ]/ )/ 方法/ 完成/ ,/ 其/ 主要/ 原因/ 是/ 由于/ 删除/ 结点/ 并/ 记录/ 其/ 后继/ 结点/ 的/ 操作/ ,/ 本质/ 上/ 与/ 图/ 的/ 拓扑/ 排序/ 是/ 一致/ 的/ ;/ 而且/ 为了/ 能够/ 充分/ 保留/ 并/ 利用/ 图上/ 结点/ 之间/ 的/ 关系/ 来/ 过滤/ 候选/ 集/ :/ 算法/ 5/ ~/ 7/ 行/ ,/ 对于/ RDF/ 图中/ 的/ 每/ 一个/ 结点/ ,/ 根据/ 其/ 结点/ 标记/ 信息/ (/ URI/ 值/ 或/ Literal/ 值/ )/ 进行/ Hash/ 操作/ ,/ 对/ 每个/ 结点/ 赋以/ 相应/ 的/ 数值/ ;/ 并/ 将/ 这个/ 值/ 作为/ 相应/ 结点/ 的/ Id/ (/ 全局/ 唯一/ )/ ;/ 算法/ 8/ ~/ 13/ 行/ ,/ 对于/ 上/ 一步/ 中/ 处理/ 过/ 的/ 图/ 进行/ 深度/ 优先/ 拓扑/ 排序/ ,/ 依次/ 记录/ 删除/ 结点/ 以及/ 该/ 结点/ 的/ 后继/ 结点/ 和/ 边/ 信息/ ./ 算法/ 同时/ 生成/ 两个/ 序列/ ,/ 一个/ 是/ 基于/ 全局/ 标签/ 的/ LPS/ (/ LabelPr/ ü/ ferSequence/ )/ ,/ 另/ 一个/ 是/ 基于/ 结点/ Id/ 的/ NPS/ (/ NumberPr/ ü/ ferSequence/ )/ ./ 在/ LPS/ 中/ ,/ 每个/ 元素/ 都/ 是/ 结点/ 的/ 全局/ 标签/ ,/ 每个/ bag/ 都/ 是/ 相应/ 的/ 边/ 信息/ 和/ 标签/ 信息/ ./ 在/ NPS/ 中/ ,/ 每个/ 元素/ 为/ 结点/ 的/ Id/ ,/ bag/ 中/ 记录/ 了/ 相应/ 的/ 边/ 信息/ 和/ Id/ 信息/ ./ 图/ 7/ 中/ 按照/ 相应/ 规则/ 生成/ 的/ Pr/ ü/ fer/ 序列/ 如表/ 4/ 所示/ ./ 1/ (/ 9/ :/ 211/ :/ 311/ :/ 49/ :/ 5/ )/ G/ (/ sB/ :/ Ptc/ :/ Ctc/ :/ CsB/ :/ P/ )/ 2/ (/ 10/ :/ 310/ :/ 7/ )/ 7456/ (/ 11/ :/ 3/ )/ 8/ (/ 11/ :/ 3/ )/ 34.3/ 对/ RDF/ 图/ 的/ Pr/ ü/ fer/ 序列/ 建立/ 索引/ NPS/ 分别/ 建立/ 索引/ ./ 为了/ 实现/ 查询/ 子图/ 的/ 快速/ 匹配/ ,/ 需要/ 对/ LPS/ 和/ 首先/ 对于/ LPS/ 和/ NPS/ ,/ 分别/ 为/ 其中/ 的/ 每个/ 元素/ 分配/ 一个/ 名为/ LEFTPOS/ 的/ 值/ ./ 这个/ 值/ 记录/ 从/ 序列/ 的/ 左侧/ 起始/ ,/ 该/ 元素/ 在/ 序列/ 中/ 的/ 位置/ (/ 此处/ 所/ 讲/ 的/ 元素/ 不/ 包括/ bag/ 元素/ ,/ 对于/ bag/ 元素/ ,/ 其/ LEFTPOS/ 值/ 定义/ 为/ 与其/ 相邻/ 的/ 左侧/ 的/ 元素/ 的/ LEFTPOS/ 值/ )/ ./ 对于/ 图/ 7/ 的/ Pr/ ü/ fer/ 序列/ 与其/ 对应/ 的/ LEFTPOS/ 如表/ 5/ 所示/ ./ 1/ (/ 9/ :/ 211/ :/ 311/ :/ 49/ :/ 5/ )/ G/ (/ sB/ :/ Ptc/ :/ Ctc/ :/ CsB/ :/ P/ )/ 12/ (/ 10/ :/ 310/ :/ 7/ )/ B/ (/ t/ :/ Ct/ :/ C/ )/ 7456/ (/ 11/ :/ 3/ )/ 8/ (/ 11/ :/ 3/ )/ 3/ 第/ 2/ 步/ ,/ 对/ NPS/ 建立/ B/ +/ 树/ 索引/ ./ NPS/ 序列/ 作为/ 一棵/ B/ +/ 树/ 存储/ ./ 索引/ 的/ 键/ 为/ NPS/ 中/ 元素/ 的/ LEFTPOS/ ,/ 其值/ 包含/ NPS/ 中/ 元素/ 的/ 数字/ Id/ 信息/ ./ 第/ 3/ 步/ ,/ 对/ LPS/ 建立/ 索引/ ,/ LPS/ 的/ 索引/ 同样/ 采用/ B/ +/ 树结构/ 实现/ ,/ 与/ NPS/ 索引/ 不同/ 的/ 是/ LPS/ 索引/ 是/ 针对/ 每/ 一种/ 全局/ 标签/ 分别/ 建立/ 一棵/ B/ +/ 树/ ./ 以图/ 6/ 为例/ ,/ 需要/ 分别/ 对/ 标签/ G/ ,/ P/ ,/ C/ 和/ U/ 建立/ 相应/ 的/ B/ +/ 树/ ./ B/ +/ 树/ 的/ 键/ 为/ 相应/ 结点/ 的/ LEFTPOS/ 值/ ,/ 值/ 由/ 以下/ 信息/ 组成/ :/ 定义/ 5/ ./ PARENT/ _/ LEFTPOS/ ./ 此处/ PARENT/ 是/ 指/ 在/ Pr/ ü/ fer/ 序列/ 中/ 位置/ 在/ 当前/ 元素/ 左侧/ 且/ 对应/ 结点/ 有/ 边/ 指向/ 当前/ 元素/ 对应/ 结点/ 的/ 所有/ 元素/ LEFTPOS/ 值中/ 最大者/ ./ 以图/ 6/ 的/ Pr/ ü/ fer/ 序列/ 为例/ ,/ NPS/ 中/ Id/ 为/ 3/ 的/ 元素/ LEFTPOS/ 值为/ 8/ ./ 有边/ 指向/ Id/ =/ 3/ 对应/ 结点/ 的/ Id/ 为/ 1/ ,/ 2/ ,/ 6/ ,/ 8/ ./ 根据/ 定义/ ,/ 标签/ 为/ B/ 的/ Id/ =/ 8/ 的/ 元素/ 的/ LEFTPOS/ =/ 7/ ,/ 是/ 这/ 4/ 个/ 结点/ 中/ LEFTPOS/ 值/ 最大者/ ./ 为此/ ,/ 我们/ 认为/ Id/ =/ 8/ 的/ 元素/ 为/ Id/ =/ 3/ 的/ 元素/ 的/ PARENT/ ./ 并/ 将/ 其/ LEFTPOS/ 值/ 作为/ Id/ =/ 3/ 的/ 元素/ 的/ PARENT/ _/ LEFTPOS/ 值/ ./ 如果/ 一个/ 结点/ 入度/ 为/ 0/ ,/ 则/ 其/ 对应/ 元素/ 无/ PARENT/ ,/ 其/ PARENT/ _/ LEFTPOS/ 值为/ 0/ ./ 定义/ 6/ ./ MAX/ _/ CHILD/ _/ LEFTPOS/ ./ 对于/ 一个/ Pr/ ü/ fer/ 序列/ 中/ 的/ 元素/ ,/ 其/ MAX/ _/ CHILD/ _/ LEFTPOS/ 定义/ 为/ 其/ 对应/ 结点/ 有/ 边/ 指向/ 的/ 所有/ 后继/ 结点/ 对应/ 元素/ 中/ LEFTPOS/ 值/ 最大者/ ./ Page7/ 对于/ 图/ 6/ 中/ ,/ G/ (/ sB/ :/ Ptc/ :/ Ctc/ :/ CsB/ :/ P/ )/ 而言/ ,/ 其所/ 指向/ 的/ 结点/ 中/ LEFTPOS/ 值/ 最大/ 的/ 结点/ 是/ Id/ =/ 3/ 的/ 结点/ ,/ 因此/ G/ 的/ MAX/ _/ CHILD/ _/ LEFTPOS/ 值为/ Id/ =/ 3/ 的/ 元素/ 的/ LEFTPOS/ 值/ ,/ 即/ 8/ ./ 定义/ 7/ ./ MINI/ _/ CHILD/ _/ LEFTP/ ./ 类似/ 于/ MAX/ _/ CHILD/ _/ LEFTPOS/ 定义/ ,/ 不同/ 的/ 是/ 选取/ 结点/ 对应/ 元素/ LEFTPOS/ 最小值/ 者/ ./ 定义/ 8/ ./ MAX/ _/ SIBLING/ _/ LEFTPOS/ ./ 对于/ 一个/ 三元组/ 〈/ S/ ,/ P/ ,/ O/ 〉/ ,/ 我们/ 定义/ S/ 是/ O/ 的/ 直接/ 前驱/ ./ RDF/ 图中/ ,/ 如果/ 一个/ 结点/ 与/ 其它/ 结点/ 有/ 共同/ 的/ 直接/ 前驱/ ,/ 则/ 这个/ 结点/ 与/ 其它/ 结点/ 存在/ SIBLING/ 关系/ ./ 从/ 存在/ 此/ 关系/ 的/ 结点/ 中/ 选择/ 对应/ 序列/ 元素/ 具有/ 最大/ LEFTPOS/ 者/ 作为/ 该/ 结点/ MAX/ _/ SIBLING/ _/ LEFTPOS/ ./ LPS/ 在/ Prig/ 的/ 整体/ 设计/ 中/ 具有/ 非常/ 重要/ 的/ 作用/ ./ 在/ LPS/ 的/ 索引/ 结构/ 中/ ,/ 以/ 结点/ 的/ LEFTPOS/ 作为/ key/ ,/ 以/ 其/ 指向/ 的/ 后继/ 结点/ 的/ PARENT/ _/ LEFTPOS/ 等/ 信息/ 作为/ value/ ,/ 因此/ 根据/ 以上/ 构建/ 的/ 情况/ ,/ 不难/ 得出/ 其/ 空间/ 复杂度/ 为/ O/ (/ m/ +/ n/ )/ ,/ 其中/ n/ 为/ 图/ 中/ 结点/ 的/ 数量/ ,/ m/ 是/ 图/ 中边/ 的/ 数量/ ./ 4.4/ 对于/ 查询/ 子图/ 的/ 处理/ 为了/ 实现/ 基于/ Pr/ ü/ fer/ 序列/ 匹配/ 的/ 查询/ ,/ 对于/ 查询/ 子图/ 同样/ 需要/ 转化/ 为/ Pr/ ü/ fer/ 序列/ ./ 其/ 基本/ 处理/ 流程/ 与/ RDF/ 图/ 序列化/ 的/ 处理/ 方法/ 一致/ ,/ 但是/ 由于/ 查询/ 子图/ 自身/ 的/ 特性/ ,/ 需要/ 解决/ 以下/ 两个/ 问题/ :/ (/ 1/ )/ 查询/ 子图/ 与/ RDF/ 全图/ 的/ 同构/ 问题/ [/ 11/ ]/ ;/ (/ 2/ )/ 查询/ 子图/ 标签/ 信息/ 的/ 获取/ ./ 根据/ Pr/ ü/ fer/ 序列/ 的/ 序列化/ 方法/ ,/ 图/ 7/ 中/ 的/ 查询/ 4.4/ ./ 1/ 对于/ 同构/ 问题/ 子图/ 可以/ 生成/ 以下/ LPS/ :/ 我们/ 可以/ 直观/ 看出/ 图/ 7/ 是/ 图/ 6/ 的/ 子/ 图/ ,/ 然而/ 图/ 7/ 的/ LPS/ 却/ 不是/ 图/ 6/ 的/ LPS/ ./ 这是/ 由于/ 查询/ 子图/ 拓扑/ 顺序/ 与/ RDF/ 图/ 拓扑/ 顺序/ 不/ 一致/ 造成/ 的/ ./ 用户/ 构造/ 查询/ 的/ 任意性/ 以及/ 变量/ 的/ 存在/ ,/ 都/ 会/ 导致/ 查询/ 子图/ 和/ 原/ RDF/ 图/ 拓扑/ 顺序/ 的/ 不/ 一致/ ,/ 进而/ 导致/ Pr/ ü/ fer/ 序列/ 之间/ 不/ 存在/ 子/ 序列/ 关系/ ./ 对于/ 这种/ 情况/ ,/ 考虑/ 到/ 查询/ 子图/ 通常/ 较/ 小/ ,/ 往往/ 只有/ 几个/ 结点/ ,/ 因此/ 可以/ 通过/ 枚举/ 所有/ 拓扑/ 顺序/ 的/ 方法/ 进行/ 解决/ ./ 将子/ 图/ 所有/ 拓扑/ 顺序/ 对应/ 生成/ 的/ Pr/ ü/ fer/ 序列/ 分别/ 与/ 原/ RDF/ 图/ 的/ 序列/ 进行/ 匹配/ 即可/ ./ 4.4/ ./ 2/ 查询/ 子图/ 标签/ 信息/ 的/ 获取/ 对/ 如下/ SPARQL/ 查询/ :/ 如果/ 查询/ 中/ 不/ 存在/ 任何/ 全局/ 标签/ 信息/ ,/ 那么/ 将/ 无法/ 生成/ LPS/ 序列/ ./ RDF/ 数据/ 是/ 一种/ 含有/ 丰富/ 语义/ 的/ 数据/ ,/ 采用/ 〈/ S/ ,/ P/ ,/ O/ 〉/ 的/ 结构/ ,/ 其中/ S/ 与/ O/ 间/ 的/ 关系/ 是/ 通过/ P/ 定义/ 的/ ./ 因此/ 通过/ P/ 可以/ 部分/ 地/ 获取/ S/ 与/ O/ 的/ 信息/ ./ 例如/ 一组/ 三元组/ :/ 〈/ a/ ,/ rdf/ :/ type/ ,/ GraduateStu/ -/ dent/ 〉/ ,/ 〈/ c/ ,/ rdf/ :/ type/ ,/ Course/ 〉/ ,/ 〈/ a/ ,/ takeCourse/ ,/ c/ 〉/ 表达/ 的/ 信息/ 为/ a/ 是/ 毕业生/ ,/ c/ 是/ 课程/ ,/ a/ 选修/ c/ 这门/ 课程/ ./ 若/ 得知/ a/ 选修/ c/ ,/ 则/ 可以/ 猜测/ a/ 的/ 标签/ 信息/ 可能/ 是/ 毕业生/ ,/ 而/ c/ 的/ 标签/ 信息/ 可能/ 是/ 课程/ ./ 基于/ 这样/ 一种/ 事实/ ,/ 在/ RDF/ 图/ 的/ 构造/ 过程/ 中/ 建立/ 一个/ 由边/ 到/ 标签/ 信息/ 的/ 索引/ ./ 对于/ 每种/ 边/ ,/ 记录/ 其/ 连接/ 的/ 术语/ 的/ 标签/ 信息/ ,/ 并且/ 记录/ 标签/ 位于/ 边/ 的/ 相对/ 位置/ ./ 以图/ 6/ 为例/ :/ sB/ 连接/ 的/ 标签/ 有/ (/ G/ ,/ P/ )/ ,/ t/ 连接/ 的/ 标签/ 有/ (/ P/ ,/ C/ )/ ,/ tc/ 连接/ 的/ 标签/ 有/ (/ U/ ,/ C/ )/ 和/ (/ G/ ,/ C/ )/ ./ 对于/ 查询/ 中/ 的/ 两个/ 三元组/ 模式/ 〈/ ?/ x/ ,/ sB/ ,/ ?/ y/ 〉/ 和/ 〈/ ?/ x/ ,/ tc/ ,/ ?/ z/ 〉/ ,/ 通过/ 查找/ 边到/ 标签/ 的/ 索引/ 中/ sB/ 和/ tc/ ,/ 并/ 在/ 第一个/ 相对/ 位置/ 上/ 做/ 连接/ 操作/ 可以/ 得到/ ?/ x/ 的/ 标签/ 为/ G/ ./ 依次/ 类推/ ,/ 可以/ 得到/ ?/ y/ 的/ 标签/ 为/ P/ ,/ ?/ z/ 的/ 标签/ 是/ C/ ./ 通过/ 以上/ 处理/ 可/ 将/ 查询/ 子图/ 转化/ 为/ 相应/ 的/ Pr/ ü/ fer/ 序列/ ./ 5Prig/ 查询处理/ 在/ 将/ RDF/ 图/ 和/ 查询/ 子图/ 分别/ 生成/ 相应/ 的/ Pr/ ü/ fer/ 序列/ 的/ 基础/ 上/ ,/ Prig/ 的/ 查询处理/ 是/ 通过/ 在/ RDF/ 图/ 的/ Pr/ ü/ fer/ 序列/ 中/ 找到/ 查询/ 子图/ Pr/ ü/ fer/ 序列/ 的/ 匹配/ 来/ 实现/ 的/ ./ 与/ 针对/ 树形/ 结构/ 的/ Prix/ 方法/ 类似/ ,/ 可以/ 采用/ ViST/ [/ 8/ ]/ 的/ 思想/ ,/ 利用/ B/ +/ 树/ 实现/ 一个/ Trie/ 结构/ ,/ 即/ 查询/ 子图/ Pr/ ü/ fer/ 序列/ 中/ 当前/ 元素/ 在/ 全图/ 序列/ 中/ 对应/ 的/ 位置/ 是/ 由/ 查询/ 子图/ 序列/ 中前/ 一个/ 元素/ 的/ 信息/ 以及/ 当前/ 的/ 匹配/ 规则/ 共同/ 决定/ 的/ ./ 本节/ 将/ 详细/ 讲述/ 查询/ 匹配/ 处理/ 算法/ 以及/ 匹配/ 规则/ ./ 算法/ 流程/ 如下/ 所示/ ./ 算法/ 2/ ./ 查询/ 子图/ Pr/ ü/ fer/ 序列/ 与/ 全图/ 序列/ 的/ 输入/ :/ i/ :/ 当前/ 元素/ 在/ 查询/ 序列/ 中/ 的/ 位置/ 匹配/ ./ 输出/ :/ 是否/ 匹配/ 成功/ Query/ (/ i/ ,/ SQ/ ,/ info/ )/ 1/ ./ LPS/ _/ Index/ ←/ SQ/ [/ i/ ]/ 的/ 全局/ 标签/ 所/ 对应/ 的/ B/ +/ 树/ 索引/ 2/ ./ relation/ ←/ cal/ _/ relation/ (/ SQ/ [/ i/ -/ 1/ ]/ ,/ SQ/ [/ i/ ]/ )/ 3/ ./ lb/ ←/ cal/ _/ left/ _/ bound/ (/ relation/ ,/ info/ )/ 4/ ./ rb/ ←/ cal/ _/ right/ _/ bound/ (/ relation/ ,/ info/ )/ 5/ ./ flag/ ←/ FALSEPage86/ ./ FORj/ =/ lbTOrbDO7/ ./ current/ _/ info/ =/ get/ _/ next/ (/ LPS/ _/ index/ ,/ j/ )/ 8/ ./ IFgeneral/ _/ match/ (/ current/ _/ info/ )/ THEN9/ ./ IFrela/ _/ match/ (/ relation/ ,/ info/ ,/ current/ _/ info/ )/ 10/ ./ IFQuery/ (/ i/ +/ 1/ ,/ SQ/ ,/ current/ _/ info/ )/ THEN11/ ./ store/ (/ SQ/ [/ i/ ]/ ,/ current/ _/ info/ )/ 12/ ./ flag/ ←/ TRUE13/ ./ RETURNflagQuery/ 算法/ 第/ 1/ ~/ 5/ 行/ 进行/ 初始化/ ./ 首先/ 获取/ 查询/ 序列/ 中/ SQi/ 处/ 的/ 全局/ 标签/ 所/ 对应/ 的/ LPS/ 索引/ B/ +/ 树/ ./ 然后/ 通过/ cal/ _/ relation/ (/ )/ 确定/ SQi/ 与/ SQi/ -/ 1/ 的/ 关系/ ./ 第/ 3/ 行/ 和/ 第/ 4/ 行/ 根据/ 前/ 一步/ 中/ 得出/ 的/ 关系/ 以及/ 满足/ SQi/ -/ 1/ 条件/ 的/ 匹配/ 元素/ 信息/ info/ (/ 如/ MAX/ _/ CHILD/ _/ LEFTPOS/ 等/ )/ 共同/ 确定/ LPS/ _/ Index/ 上/ 的/ 搜索/ 范围/ (/ lb/ 和/ rb/ )/ ./ 算法/ 第/ 6/ 行/ 开始/ ,/ 在/ 搜索/ 范围/ 内/ ,/ 通过/ get/ _/ next/ (/ )/ 依次/ 获得/ 索引/ 上/ 搜索/ 范围/ 内/ 的/ 各/ 元素/ ./ 此后/ ,/ 算法/ 第/ 8/ 行/ 首先/ 通过/ 函数/ general/ _/ match/ (/ )/ 进行/ 一般性/ 匹配/ 过滤/ ;/ 对于/ 通过/ 过滤/ 的/ 结果/ ,/ 算法/ 第/ 9/ 行再/ 根据/ relation/ 、/ info/ 和/ current/ _/ info/ 进行/ 关系/ 过滤/ rela/ _/ match/ (/ )/ ./ 对于/ 满足/ 关系/ 过滤/ 条件/ 的/ 结果/ ,/ 则/ 递归/ 调用/ Query/ 函数/ 对/ SQi/ +/ 1/ 匹配/ ./ 若/ SQi/ +/ 1/ 匹配/ 成功/ ,/ 则/ 认为/ SQi/ 在/ 当前/ 的/ 匹配/ 是/ 正确/ 的/ ,/ 存储/ 当前/ 匹配/ 作为/ 部分/ 结果/ ,/ 并/ 将/ 匹配/ 成功/ 标志/ 赋值/ 为/ 真/ ./ 算法/ 初始/ 调用/ 时/ ,/ i/ 初始值/ 为/ 1/ ,/ SQ/ 为/ 查询/ 序列/ ,/ info/ 初始值/ 为/ NULL/ ./ RDF/ 全图/ 与/ 查询/ 子图/ 各自/ 的/ 扩展/ Pr/ ü/ fer/ 序列/ 以及/ 序列/ 之间/ 存在/ 着/ 诸多/ 性质/ ./ Prig/ 根据/ 这些/ 性质/ 设计/ 了/ 能够/ 有效/ 过滤/ 错误/ 匹配/ 结点/ 的/ 匹配/ 规则/ ,/ 包括/ 一般性/ 过滤/ 规则/ 和/ 关系/ 过滤/ 规则/ ./ 5.1/ 一般性/ 过滤/ 规则/ 在/ 不/ 考虑/ 序列/ 中/ 相继/ 元素/ 对应/ 结点/ 间/ 的/ 拓扑/ 结构/ 关系/ 的/ 情况/ 下/ ,/ 序列/ 中/ 元素/ 存在/ 如下/ 可/ 用于/ 过滤/ 的/ 一般性/ 性质/ ./ 定理/ 1/ ./ 查询/ 结果/ 序列/ 中/ 元素/ SAi/ 的/ LEFTPOS/ 值/ 单调/ 递增/ ,/ 其中/ 1/ / i/ / |/ SA/ |/ ./ 证明/ ./ 采用/ 反证法/ ./ 假设/ 查询/ 序列/ 中/ 存在/ 两个/ 元素/ SAi/ 与/ SAj/ (/ 1/ / i/ </ j/ / n/ )/ ,/ 满足/ 关系/ SAi/ ./ LEFTPOS/ / SAj/ ./ LEFTPOS/ ./ 由/ 定义/ 3/ 以及/ LEFTPOS/ 的/ 定义/ 易知/ :/ RDF/ 图/ 序列/ 中/ 不/ 存在/ 两个/ LEFTPOS/ 相等/ 的/ 相异/ 元素/ ,/ 且/ 如果/ 有/ 如下/ 关系/ :/ SAi/ ./ LEFTPOS/ >/ SAj/ ./ LEFTPOS/ ,/ 则/ i/ >/ j/ ;/ 这/ 与/ 假设/ 相/ 矛盾/ ,/ 因此/ 假设/ 不/ 成立/ ./ 例/ 1/ ./ 以/ 查询/ 子图/ 序列/ ?/ x/ (/ sB/ :/ ?/ ytc/ :/ ?/ z/ )/ ?/ y/ (/ t/ :/ ?/ z/ )/ ?/ z/ 为例/ ,/ ?/ x/ ,/ ?/ y/ 和/ ?/ z/ 三者/ 的/ LEFTPOS/ 值/ 是/ 依次/ 递增/ 的/ ./ 因此/ 在/ 查询/ 匹配/ 过程/ 中/ ,/ 若/ 已知/ ?/ x/ 匹配/ 元素/ 的/ LEFTPOS/ 值/ ,/ 则/ 在/ 查找/ ?/ y/ 时/ ,/ 只/ 需/ 从/ 大于/ LEFTPOS/ 值处/ 开始查找/ ./ 此时/ 可以/ 过滤/ 索引/ 结构/ 中/ 所有/ 匹配/ ?/ y/ 标签/ 且/ 小于/ ?/ x/ 的/ LEFTPOS/ 值/ 的/ 元素/ ./ 定理/ 2/ ./ 如果/ SGj/ 是/ SQi/ 的/ 候选/ 匹配/ 元素/ ,/ 那么/ 其/ 对应/ 结点/ 的/ 入度/ 满足/ di/ (/ SGj/ )/ / di/ (/ SQi/ )/ ./ 证明/ ./ 采用/ 反证法/ ./ 假设/ SGj/ 是/ SQi/ 的/ 候选/ 匹配/ 元素/ ,/ 且/ di/ (/ SGj/ )/ </ di/ (/ SQi/ )/ ,/ 则/ SQi/ 对应/ 结点/ 至少/ 有/ 一条/ 出边/ 是/ SGj/ 所/ 没有/ 的/ ,/ 这/ 与/ 假设/ 中/ 候选/ 元素/ 条件/ 相/ 矛盾/ ,/ 因此/ 假设/ 错误/ ./ 例/ 2/ ./ 以图/ 6/ 产生/ 的/ Pr/ ü/ fer/ 序列/ 为例/ ,/ 假设/ 存在/ 查询/ 序列/ ?/ x/ (/ sB/ :/ ?/ ytc/ :/ ?/ z/ )/ ?/ y/ (/ t/ :/ ?/ z/ )/ ?/ z/ ./ 对于/ LEFTPOS/ =/ 4/ 的/ 元素/ ,/ 其/ 标签/ 是/ C/ ,/ 符合/ 查询/ 子图/ 中/ ?/ z/ 的/ 基本/ 要求/ ,/ 但/ 查询/ 子图/ 中/ ?/ z/ 的/ 入度/ 是/ 2/ ,/ LEFTPOS/ 值为/ 3/ 和/ 4/ 的/ 两个/ 元素/ 其入度/ 仅/ 为/ 1/ ,/ 因此/ 可以/ 将/ 其/ 过滤/ ./ 定理/ 3/ ./ 如果/ SGj/ 是/ SQi/ 的/ 候选/ 匹配/ 元素/ ,/ 那么/ 其/ 对应/ 结点/ 的/ 出度/ 满足/ do/ (/ SGj/ )/ / do/ (/ SQi/ )/ ,/ 且/ 出边/ 集合/ 满足/ Eo/ (/ SGj/ )/ / Eo/ (/ SOi/ )/ ./ 证明/ ./ 证明/ 同/ 性质/ 2/ ./ 例/ 3/ ./ 以图/ 6/ 为例/ ,/ 假设/ 有/ 查询/ 子图/ 的/ Pr/ ü/ fer/ 序列/ :/ ?/ y/ (/ t/ :/ ?/ z/ )/ ,/ 查询/ 变量/ ?/ y/ 的/ 标签/ 为/ P/ ,/ 在/ 全图/ 的/ Pr/ ü/ fer/ 序列/ 中/ LEFTPOS/ 值为/ 5/ 的/ 结点/ 其/ 标签/ 也/ 为/ P/ ,/ 但是/ 其边/ 集为/ 空/ ,/ 即/ 查询/ 子图/ 中/ ?/ y/ 的/ 边集/ 不是/ 该/ 结点/ 边集/ 的/ 子集/ ./ 因此/ 可/ 将/ 其/ 过滤/ ./ 以上/ 是/ 一般化/ 的/ 过滤/ 规则/ ,/ 接下来/ 的/ 部分/ 介绍/ 一些/ 关系/ 过滤/ 规则/ ./ 5.2/ 关系/ 过滤/ 规则/ 除/ 上述/ 一般性/ 性质/ 外/ ,/ 查序子/ 图/ Pr/ ü/ fer/ 序列/ 中/ 相继/ 元素/ 对应/ 结点/ 间/ 的/ 拓扑/ 结构/ 关系/ 也/ 存在/ 一定/ 性质/ ./ 查询/ 匹配/ 过程/ 依据/ 4/ 种/ 关系/ :/ 无/ 关系/ 、/ 父子关系/ 、/ 兄弟/ 关系/ 、/ 共同/ 祖先/ 关系/ ,/ 进行/ 相应/ 的/ 过滤/ ./ 定义/ 9/ ./ 无/ 关系/ ./ 设/ 序列/ S/ 中/ 相邻/ 两/ 元素/ Si/ 和/ Si/ +/ 1/ (/ 1/ / i/ </ |/ S/ |/ )/ ,/ 如果/ 满足/ di/ (/ Si/ +/ 1/ )/ =/ 0/ ,/ 则/ 称此/ 相邻/ 元素/ 对应/ 结点/ 间/ 无/ 关系/ ,/ 记为/ N/ _/ R/ (/ Si/ ,/ Si/ +/ 1/ )/ ./ 无/ 关系/ 过滤/ 规则/ ./ 对于/ 查询/ 序列/ SQ/ 中/ 相邻/ 元素/ 对应/ 结点/ SQi/ 和/ SQi/ +/ 1/ (/ 1/ / i/ </ |/ SQ/ |/ )/ ,/ 如果/ 满足/ 关系/ N/ _/ R/ (/ SQi/ ,/ SQi/ +/ 1/ )/ ,/ 则/ 对于/ SQi/ +/ 1/ 只/ 需要/ 按照/ 一般/ 过滤/ 规则/ 过滤/ 候选/ 结点/ ./ 例/ 4/ ./ 图/ 8Pr/ ü/ fer/ 序列/ 为/ ?/ x/ ?/ y/ ,/ 因为/ ?/ y/ 的/ 入度/ 为/ 0/ ,/ 则/ 称/ ?/ x/ 与/ ?/ y/ 无/ 关系/ ./ ?/ y/ 只/ 需/ 按/ 一般/ 规则/ 选取/ 候选/ 匹配/ 结点/ ./ 定义/ 10/ ./ 父子关系/ ./ 设/ 序列/ S/ 中/ 相邻/ 两元/ Page9/ 图/ 8/ 查询/ 子图/ 序列/ 中/ 相邻/ 元素/ 对应/ 结点/ 间/ 无/ 关系/ 素/ Si/ 和/ Si/ +/ 1/ (/ 1/ / i/ </ |/ S/ |/ )/ ,/ 如果/ 相应/ 结点/ 间/ 满足/ Si/ ./ LEFTPOS/ =/ Si/ +/ 1/ ./ PARENT/ _/ LEFTPOS/ ,/ 则/ 称/ Si/ 对应/ 结点/ 是/ Si/ +/ 1/ 的/ 双亲/ 结点/ ,/ Si/ +/ 1/ 对应/ 结点/ 是/ Si/ 的/ 孩子/ 结点/ ,/ 这种/ 关系/ 称为/ 父子关系/ ,/ 记为/ P/ _/ R/ (/ Si/ ,/ Si/ +/ 1/ )/ ./ 父子关系/ 过滤/ 规则/ ./ 对于/ 查询/ 序列/ SQ/ 中/ 相邻/ 元素/ 对应/ 结点/ SQi/ 和/ SQi/ +/ 1/ (/ 1/ / i/ </ |/ SQ/ |/ )/ ,/ 如果/ 满足/ 关系/ P/ _/ R/ (/ SQi/ ,/ SQi/ +/ 1/ )/ ,/ 则/ 在/ SQi/ +/ 1/ 其/ 标签/ 所属/ LPS/ 索引/ 上/ 的/ 查找/ 范围/ 为/ SQi/ ./ MINI/ _/ CHILD/ _/ LEFTPOS/ 和/ SQi/ ./ MAX/ _/ CHILD/ _/ LEFTPOS/ 之间/ ,/ 在/ 此/ 范围/ 内/ 同时/ 不/ 满足/ 以下/ 条件/ 的/ SGj/ 都/ 将/ 被/ 过滤/ 掉/ (/ 其中/ SAi/ 为/ 查询/ 结果/ 序列/ 的/ 第/ i/ 个/ 元素/ )/ :/ (/ 1/ )/ P/ _/ R/ (/ SAi/ ,/ SGj/ )/ ;/ (/ 2/ )/ SAi/ ./ LEFTPOS/ </ SGj/ ./ PARENT/ _/ LEFTPOS/ ./ 例/ 5/ ./ 图/ 9/ 的/ Pr/ ü/ fer/ 序列/ 为/ ?/ x/ (/ ?/ y/ )/ ,/ ?/ y/ ,/ 根据/ PARENT/ _/ LEFTPOS/ 定义/ ,/ 若/ ?/ y/ ./ PARENT/ _/ LEFT/ -/ POS/ =/ ?/ x/ ./ LEFTPOS/ ,/ 则/ ?/ y/ 是/ ?/ x/ 的/ 孩子/ ./ 因此/ 在/ 标签/ C/ 索引/ 中/ ,/ 可/ 将/ 查找/ 范围/ 定为/ ?/ x/ ./ MINI/ _/ CHILD/ _/ LEFTPOS/ 到/ ?/ x/ ./ MAX/ _/ CHILD/ _/ LEFTPOS/ 之间/ ./ 在/ 此/ 范围/ 内/ 首先/ 按照/ 一般/ 规则/ 过滤/ 候选/ 结点/ ,/ 这样/ 可以/ 有效/ 减小/ 搜索/ 空间/ ./ 然后/ ,/ 将/ ?/ y/ 的/ 候选/ 结点/ 与/ ?/ x/ 的/ 候选/ 结点/ 做/ 父子关系/ 判断/ ,/ 如果/ 满足/ 父子关系/ 则/ 纳入/ 候选/ 结果/ 集中/ (/ 对应/ 本/ 规则/ 中/ 的/ 条件/ 1/ )/ ./ 但/ 对于/ 以上/ 匹配/ 可能/ 会/ 漏掉/ 一类/ 正确/ 的/ 候选/ 结果/ ./ 如图/ 10/ 所示/ ,/ 生成/ 的/ Pr/ ü/ fer/ 序列/ 可能/ 为/ G/ (/ tc/ :/ c/ )/ P/ (/ t/ :/ B/ )/ C/ ,/ 此时/ 虽然/ C/ 的/ 双亲/ 之一/ 是/ G/ ,/ 但/ 其/ PARENT/ _/ LEFTPOS/ 却是/ P/ 的/ LEFTPOS/ 值/ ,/ 为此/ 我们/ 采取/ 如下/ 策略/ (/ 对应/ 本/ 规则/ 中/ 的/ 条件/ 2/ )/ 涵盖/ 这一/ 情况/ :/ 若/ ?/ y/ 的/ 候选/ 结点/ 的/ PARENT/ _/ LEFTPOS/ 大于/ ?/ x/ 的/ 候选/ 结点/ 的/ LEFTPOS/ 值/ ,/ 则/ 亦/ 将/ 其/ 纳入/ 候选/ 结果/ 集中/ ./ 其余/ 的/ 结果/ 都/ 将/ 被/ 过滤/ 掉/ ./ 定义/ 11/ ./ 兄弟/ 关系/ ./ 设/ 序列/ S/ 中/ 相邻/ 两/ 元素/ Si/ 和/ Si/ +/ 1/ (/ 1/ / i/ </ |/ S/ |/ )/ ,/ 如果/ 相应/ 结点/ 间/ 满足/ Si/ ./ PARENT/ _/ LEFTPOS/ =/ Si/ +/ 1/ ./ PARENT/ _/ LEFTPOS/ ,/ 则/ 称/ Si/ 和/ Si/ +/ 1/ 为/ 兄弟/ 关系/ ,/ 记为/ S/ _/ R/ (/ Si/ ,/ Si/ +/ 1/ )/ ./ 兄弟/ 关系/ 过滤/ 规则/ ./ 对于/ 查询/ 序列/ SQ/ 中/ 相邻/ 元素/ 对应/ 结点/ SQi/ 和/ SQi/ +/ 1/ (/ 1/ / i/ </ |/ SQ/ |/ )/ ,/ 如果/ 满足/ 关系/ S/ _/ R/ (/ SQi/ ,/ SQi/ +/ 1/ )/ ,/ 则/ 在/ SQi/ +/ 1/ 其/ 标签/ 所属/ LPS/ 索引/ 上/ 的/ 查找/ 范围/ 应该/ 在/ :/ (/ SAi/ ./ LEFTPOS/ ,/ SAi/ ./ MAX/ _/ SIBLING/ _/ LEFTPOS/ ]/ ,/ 在/ 此/ 范围/ 内/ 同时/ 不/ 满足/ 以下/ 条件/ 的/ SGj/ 都/ 将/ 被/ 过滤/ 掉/ (/ 其中/ SAi/ 为/ 查询/ 结果/ 序列/ 的/ 第/ i/ 个/ 元素/ )/ :/ (/ 1/ )/ S/ _/ R/ (/ SAi/ ,/ SGj/ )/ ./ (/ 2/ )/ SAi/ ./ PARENT/ _/ LEFTPOS/ </ SGj/ ./ PARENT/ _/ LEFTPOS/ ./ 例/ 6/ ./ 如图/ 11/ 对于/ ?/ y/ 和/ ?/ z/ ,/ 若/ 不/ 满足/ 无/ 关系/ 和/ 父子关系/ ,/ 则/ 进行/ 兄弟/ 关系/ 的/ 判断/ ./ 判断/ 为/ 兄弟/ 关系/ 的/ 条件/ 是/ ?/ y/ ./ PARENT/ _/ LEFTPOS/ =/ ?/ z/ ./ PARENT/ _/ LEFTPOS/ ./ 如果/ 满足/ 该/ 关系/ ,/ 则/ 对于/ ?/ z/ ,/ 根据/ LEFTPOS/ 的/ 单调/ 递增/ 性质/ ,/ 在/ 标签/ C/ 索引/ 中/ 只/ 需/ 搜索/ LEFTPOS/ 值/ 介于/ ?/ y/ ./ LEFTPOS/ 和/ ?/ y/ ./ MAX/ _/ SIBLING/ _/ LEFTPOS/ 之间/ 的/ 结点/ ,/ 这/ 有效/ 缩小/ 了/ 搜索/ 空间/ ./ 将/ ?/ y/ 的/ 候选/ 结果/ 与/ 之前/ ?/ x/ 的/ 候选/ 结果/ 做/ 兄弟/ 关系/ 判断/ ,/ 如果/ 满足/ 兄弟/ 关系/ ,/ 则/ 将/ 其/ 纳入/ 候选/ 结果/ 集中/ (/ 对应/ 本/ 规则/ 中/ 的/ 条件/ 1/ )/ ./ 同样/ ,/ 对于/ 以上/ 匹配/ 可能/ 会/ 漏掉/ 一类/ 正确/ 的/ 候选/ 结果/ ./ 如图/ 12/ 所示/ :/ 其/ 生成/ 的/ Pr/ ü/ fer/ 序列/ 可能/ 为/ G/ (/ sB/ :/ Ptc/ :/ C/ )/ PU/ (/ tc/ :/ C/ )/ C/ ./ 此时/ P/ 与/ C/ 虽然/ 有/ 共同/ 的/ 双亲/ G/ ,/ 但是/ C/ 的/ PARENT/ _/ LEFTPOS/ 与/ P/ 的/ PARENT/ _/ LEFTPOS/ 不同/ ./ 对此/ 我们/ 采取/ 如下/ 策略/ (/ 对应/ 本/ 规则/ 中/ 的/ 条件/ 2/ )/ 涵盖/ 这一/ 情况/ :/ 若/ ?/ y/ 的/ 候选/ 结点/ 的/ PARENT/ _/ LEFTPOS/ 小于/ ?/ z/ 候选/ 结点/ 的/ PARENT/ _/ LEFTPOS/ ,/ 则/ 亦/ 将/ 其/ 纳入/ 候选/ 结果/ 集中/ ,/ 其余/ 的/ 结果/ 都/ 将/ 被/ 过滤/ 掉/ ./ Page10/ 定义/ 12/ ./ 共同/ 祖先/ 关系/ ./ 设/ 序列/ S/ 中/ 相邻/ 两/ 元素/ Si/ 和/ Si/ +/ 1/ (/ 1/ / i/ </ |/ S/ |/ )/ ,/ 如果/ 相应/ 结点/ 间/ 不/ 存在/ 无/ 关系/ 、/ 父子关系/ 和/ 兄弟/ 关系/ ,/ 且/ 满足/ Si/ ./ PARENT/ _/ LEFTPOS/ </ Si/ +/ 1/ ./ PARENT/ _/ LEFTPOS/ ,/ 则/ 称/ 二者/ 具有/ 共同/ 祖先/ 关系/ ,/ 记为/ C/ _/ R/ (/ Si/ ,/ Si/ +/ 1/ )/ ./ 共同/ 祖先/ 关系/ 过滤/ 规则/ ./ 对于/ 查询/ 序列/ SQ/ 中/ 相邻/ 元素/ 对应/ 结点/ SQi/ 和/ SQi/ +/ 1/ (/ 1/ / i/ </ |/ SQ/ |/ )/ ,/ 如果/ 满足/ C/ _/ R/ (/ SQi/ ,/ SQi/ +/ 1/ )/ ,/ 则/ 在/ SQi/ +/ 1/ 其/ 标签/ 所属/ LPS/ 索引/ 上/ 查找/ 范围/ 是/ 索引/ 中/ 所有/ 满足/ 如下/ 关系/ 的/ 元素/ :/ SGj/ ./ LEFTPOS/ >/ SAi/ ./ LEFTPOS/ ,/ 在/ 此/ 范围/ 内/ 的/ SGj/ 都/ 可/ 作为/ 候选/ SAi/ +/ 1/ ,/ 否则/ 予以/ 过滤/ ./ 例/ 7/ ./ 如图/ 13/ 中/ 所示/ 的/ 查询/ 子图/ 的/ Pr/ ü/ fer/ 序列/ 为/ ?/ x/ (/ sB/ :/ ?/ y/ ,/ tc/ :/ ?/ u/ )/ ?/ y/ (/ t/ :/ z/ )/ ?/ z/ ?/ u/ 时/ ,/ 则/ 序列/ 中/ ?/ u/ 与其/ 左侧/ 相邻/ 元素/ 对应/ 结点/ 既/ 非/ 兄弟/ 关系/ ,/ 也/ 非/ 父子关系/ ,/ 而是/ 与/ ?/ z/ 为/ 共同/ 祖先/ 关系/ ,/ 其/ 判断/ 条件/ ?/ z/ ./ PARENT/ _/ LEFTPOS/ >/ ?/ u/ ./ PARENT/ _/ LEFTPOS/ ./ 此时/ ,/ 我们/ 可以/ 按照/ 共同/ 祖先/ 关系/ 过滤/ 规则/ 进行/ 候选/ 结点/ 的/ 选取/ 和/ 过滤/ ./ 图/ 14Sesame/ 与/ Prig/ 在/ LUBM/ 数据/ 集/ 的/ 查询/ 测试/ 实验/ 结果/ 首先/ ,/ Prig/ 与/ Sesame/ 的/ 查询处理/ 方法/ 不同/ ./ Sesame/ 以/ 主要/ 通过/ 垂直/ 表/ (/ verticaltable/ )/ 的/ 形式/ 组织/ 三元组/ ,/ 三元组/ 中/ 的/ 主语/ 、/ 谓语/ 、/ 宾语/ 分别/ 对应/ 元组/ 中/ 的/ 一项/ ./ 通过/ 调整/ 主语/ 、/ 谓语/ 、/ 宾语/ 上/ 建立/ 索引/ 的/ 顺序/ 可以/ 提高/ 三元组/ 访问/ 的/ 性能/ ./ 面对/ 复杂/ 查询/ Sesame/ 要/ 在/ 垂直/ 表上/ 进行/ 自/ 连接/ 操作/ ./ 而/ Prig/ 则/ 在/ 获取/ 查询/ 中/ 变量/ 的/ 候选/ 结点/ 过程/ 中/ ,/ 使用/ 一般性/ 过滤/ 和/ 关系/ 过滤/ 等/ 多种/ 过滤/ 规则/ 缩小/ 候选/ 集合/ ,/ 从而/ 提高/ 查询/ 的/ 处理/ 效率/ ./ 在/ 数据/ 规模较/ 小/ 的/ 情况/ 下/ ,/ Prig/ 过滤/ 过程/ 所/ 需/ 的/ 时间/ 开销/ 相对/ 于/ 缩小/ 候选/ 结/ 5.3/ 最终/ 结果/ 过滤/ 最后/ ,/ 对于/ 生成/ 的/ 候选/ 结果/ 集/ 采用/ 传统/ 的/ 图/ 匹配/ 算法/ 进行/ 相应/ 的/ 剔除/ 工作/ ,/ 去除/ 错误/ 的/ 结果/ ,/ 返回/ 正确/ 的/ 结果/ 集/ ./ 6/ 实验/ 结果/ 实验所/ 使用/ 的/ 硬件/ 为/ Intel/ (/ R/ )/ Pentium/ (/ R/ )/ 4CPU2/ ./ 80GHz/ ,/ 内存/ DDR2GB/ ,/ 磁盘/ 320GB/ ,/ 转速/ 7200rpm/ ./ 软件/ 环境/ 中/ 操作系统/ 为/ LinuxCentOSRelease5/ ./ 6/ ,/ 采用/ C++/ 作为/ 编程语言/ ,/ 开发/ 环境/ 为/ NetBeansIDE6/ ./ 9.1/ ./ 系统/ 采用/ Raptor/ ①/ 作为/ RDF/ 数据/ 解析/ 工具/ ,/ 使用/ BerkeleyDB/ ②/ 作为/ 后台/ 数据/ 存储/ 工具/ ./ 实验/ 中以/ 采用/ Native/ 存储/ 方式/ 的/ Sesame2/ ./ 2.4/ 作为/ 对比/ 系统/ ,/ 分别/ 采用/ LUBM/ 基准/ 数据/ 集/ 和/ SP2Bench/ 基准/ 数据/ 集/ 进行/ 了/ 对比/ 实验/ ./ 对于/ LUBM/ 数据/ 集中/ 14/ 个/ 标准/ 查询/ 分别/ 在/ LUBM/ (/ 10/ )/ ,/ LUBM/ (/ 100/ )/ ,/ LUBM/ (/ 1000/ )/ 上/ 进行/ 了/ 测试/ ,/ 实验/ 结果/ 如图/ 14/ 所示/ ./ 测试/ 结果显示/ 在/ 绝大多数/ 情况/ 下/ Prig/ 在/ 该/ 数据/ 集上/ 的/ 查询/ 响应/ 时间/ 低于/ Sesame/ ,/ 尤其/ 是/ 在/ 数据/ 规模/ 较大/ (/ LUBM/ (/ 1000/ )/ )/ 的/ 情况/ 下/ ./ 但/ 当/ 数据/ 规模较/ 小时/ (/ LUBM/ (/ 10/ )/ ,/ LUBM/ (/ 100/ )/ )/ ,/ Prig/ 在/ Q3/ ,/ Q4/ ,/ Q5/ ,/ Q6/ ,/ Q9/ ,/ Q10/ ,/ Q12/ ,/ Q13/ 等/ 查询/ 中/ 表现/ 出/ 性能/ 稍/ 落后/ 于/ Sesame/ ./ 其/ 主要/ 由/ 以下/ 两/ 方面/ 原因/ 造成/ :/ 果集/ 所/ 带来/ 的/ 性能/ 提高/ 要/ 更/ 突出/ ,/ 因此/ 表现/ 出/ Prig/ 的/ 查询/ 响应/ 时间/ 高于/ Sesame/ ./ 随着/ 数据/ 规模/ 的/ 增大/ ,/ Prig/ 缩小/ 候选/ 结果/ 集所/ 带来/ 的/ 查询/ 性能/ 改善/ 随之/ 显现/ ./ 而/ 此时/ ,/ Sesame/ 则/ 由于/ 缺少/ 有效/ 的/ 过滤/ 方法/ ,/ 面临/ 大量/ 的/ 连接/ 操作/ ./ 另一方面/ ,/ 以/ 查询/ Q4/ 为例/ ,/ 由于/ 存在/ 图同构/ 问题/ ,/ 查询/ 子图/ 生成/ 的/ Pr/ ü/ fer/ 序列/ 并/ 不/ 唯一/ ./ 在/ Prig/ ①/ ②/ Page11/ 系统/ 中/ 采取/ 枚举/ 所有/ 可能/ 的/ 查询/ 子/ 序列/ 的/ 方法/ ,/ 并/ 依次/ 进行/ 序列/ 匹配/ 查询/ ,/ 进而/ 可能/ 造成/ 查询/ 响应/ 时间/ 超过/ Sesame/ 的/ 现象/ ./ 但/ 由于/ Prig/ 所/ 具有/ 的/ 过滤/ 功能/ ,/ 使得/ 查询/ 性能/ 在/ 数据/ 规模/ 增大/ 的/ 情况/ 下/ 优于/ Sesame/ ./ 总体而言/ ,/ 随着/ LUBM/ 数据/ 规模/ 不断/ 增大/ ,/ Prig/ 相对/ 于/ Sesame/ 有着/ 更好/ 的/ 查询/ 性能/ ./ 如图/ 15/ 所示/ ,/ 我们/ 统计/ 了/ 在/ LUBM/ (/ 10/ )/ ,/ LUBM/ (/ 100/ )/ 以及/ LUBM/ (/ 1000/ )/ 3/ 个/ 数据/ 集下/ ,/ Sesame/ 和/ Prig/ 两个/ 系统/ 分别/ 执行/ 14/ 个/ 查询/ 的/ 时间/ 总和/ ./ 结果显示/ ,/ 相较/ 于/ Sesame/ ,/ Prig/ 分别/ 依次/ 提高/ 了/ 28.9/ %/ 、/ 43.3/ %/ 和/ 58.9/ %/ ./ 因此/ 在/ 数据/ 规模/ 增长/ 的/ 趋势/ 下/ ,/ Prig/ 有着/ 较/ 好/ 的/ 可伸缩性/ ./ 图/ 16/ 简单/ 图/ 模式/ 下/ Sesame/ 与/ Prig/ 在/ SP2Bench/ 数据/ 集/ 查询/ 性能/ 比较/ 在/ SP2Bench/ 数据/ 集中/ Prig/ 的/ 整体/ 性能/ 同比/ 仍/ 优于/ Sesame/ ./ 但/ 也/ 存在/ 与/ LUBM/ 数据/ 集中/ 类似/ 的/ 情况/ ,/ 如图/ 17/ 所示/ ,/ 在/ 数据/ 规模较/ 小/ 的/ 情况/ 下/ ,/ SP2Bench/ (/ 2.5/ M/ )/ 和/ SP2Bench/ (/ 10M/ )/ 时/ Q2/ ,/ Q4/ ,/ Q7/ ,/ Q11/ 相对/ 于/ Sesame/ 在/ 查询/ 性能/ 上/ 存在/ 着/ 一定/ 的/ 差距/ ,/ 但/ 这/ 一/ 问题/ 随着/ 数据/ 规模/ 的/ 增长/ 得到/ 改善/ ./ 总体而言/ ,/ Prig/ 在/ SP2Bench/ 数据/ 集上/ 仍然/ 有着/ 比较/ 好/ 的/ 伸缩性/ ,/ 性能/ 依次/ 提高/ 了/ 1.19/ %/ ,/ 3.89/ %/ ,/ 5.21/ %/ ./ 图/ 17Sesame/ 与/ Prig/ 在/ SP2Bench/ 的/ 查询/ 时间/ 总和/ 比较/ 对比/ 图/ 15/ 与/ 图/ 17/ ,/ Prig/ 在/ SP2Bench/ 数据/ 集中/ 所/ 表现/ 出/ 的/ 性能/ 相较/ 于/ 其/ 在/ LUBM/ 数据/ 集中/ 所/ 体现/ 的/ 性能/ 有所/ 下降/ ,/ 主要/ 有/ 以下/ 两/ 方面/ 原因/ :/ (/ 1/ )/ SP2Bench/ 数据/ 集中/ RDF/ 图/ 结构/ 要/ 比/ LUBM/ 数据/ 集/ 的/ 更/ 复杂/ ,/ 因此/ 在/ 序列/ 中/ 搜索/ 和/ 过滤/ 候选/ 结图/ 15Sesame/ 与/ Prig/ 在/ LUBM/ 数据/ 集/ 的/ 查询/ 时间/ 总和/ 比较/ 与此同时/ ,/ 我们/ 使用/ SP2Bench/ 数据/ 集/ ,/ 对/ 测试/ 基准/ 中/ 7/ 个/ 标准/ 查询/ 的/ 简单/ 查询/ 部分/ ①/ 分别/ 在/ SP2Bench/ (/ 2.5/ M/ )/ ,/ SP2Bench/ (/ 10M/ )/ ,/ SP2Bench/ (/ 40M/ )/ 上/ 进行/ 了/ 相关/ 的/ 测试/ ,/ 其/ 测试/ 结果/ 如图/ 16/ 所示/ ./ 点/ 的/ 开销/ 更大/ ,/ 造成/ 了/ 相对/ 较/ 高/ 的/ 时间/ 开销/ ./ (/ 2/ )/ SP2Bench/ 测试/ 基准/ 中/ 查询/ 子图/ 所/ 对应/ 的/ Pr/ ü/ fer/ 序列/ 大多/ 不/ 唯一/ ./ Prig/ 不得不/ 枚举/ 所有/ 可能/ 的/ 序列/ ,/ 然后/ 依次/ 进行/ 查询/ ./ 这/ 也/ 造成/ 了/ 很大/ 的/ 时间/ 开销/ ./ 通过/ 以上/ 在/ LUBM/ 和/ SP2Bench/ 测试/ 基准/ 上/ 的/ 实验/ 结果显示/ Prig/ 在/ 整体/ 上/ 优于/ Sesame/ ,/ 并且/ 在/ 数据/ 规模/ 增长/ 的/ 趋势/ 下/ ,/ 有着/ 较/ 好/ 的/ 可伸缩性/ ./ 这/ 表明/ Prig/ 所/ 采用/ 的/ 扩展/ Pr/ ü/ fer/ 序列化/ 方法/ 以及/ 提出/ 的/ 若干/ 过滤/ 规则/ 对/ RDF/ 数据/ 的/ 索引/ 和/ 查询/ 具有/ 较/ 好/ 效果/ ./ 7/ 结束语/ 本文/ 首次/ 将/ Pr/ ü/ fer/ 序列化/ 方法/ 引入/ RDF/ 图/ 的/ 查询/ 和/ 处理/ 工作/ 中/ ./ 扩展/ 了/ Pr/ ü/ fer/ 从/ 一般/ 树形/ 结构/ 查询/ 匹配/ 到/ 图/ 结构/ 查询/ 匹配/ 的/ 转变/ ,/ 提出/ 了/ 若干/ 有效/ 的/ 过滤/ 规则/ 来/ 提高/ 查询处理/ 性能/ ./ 实现/ 了/ 基于/ 这一/ 方法/ 的/ Prig/ 系统/ ./ 在/ 两个/ 测试/ 基准/ 上/ 的/ 实验/ 结果表明/ Prig/ 能够/ 提升/ RDF/ 数据/ 索引/ 和/ 管理/ 性能/ ./ ①/ 由于/ 目前/ Prig/ 原型/ 系统/ 仅/ 支持/ 简单/ 查询/ ,/ 因此/ 选取/ 了/ 查询/ Page12/ 

