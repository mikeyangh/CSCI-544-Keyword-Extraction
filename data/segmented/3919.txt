Page1/ 工作/ 模式/ 可/ 配置/ 的/ 路由器/ 共享/ 转发/ 引擎/ 陈/ 文龙/ 1/ )/ 蒋佰亨/ 2/ )/ 吴敏华/ 1/ )/ 1/ )/ (/ 首都师范大学/ 信息/ 工程学院/ 北京/ 100048/ )/ 2/ )/ (/ 吉林大学/ 计算机科学/ 与/ 技术/ 学院/ 长春/ 130021/ )/ 摘要/ 互联网/ 高速/ 发展/ 中/ 的/ 多种/ 应用/ 诉求/ ,/ 希望/ 路由/ 系统/ 能/ 提供/ 一种/ 工作/ 模式/ 可/ 配置/ 的/ 转发/ 引擎/ ./ 然而/ ,/ 现有/ 高性能/ 分布式/ 路由/ 系统/ 中线/ 卡/ 独享/ 固定/ 转发/ 引擎/ 的/ 结构/ ,/ 限制/ 了/ 转发/ 体系/ 的/ 灵活/ 扩展/ ./ 提出/ 了/ 转发/ 引擎/ 与/ 线卡/ 分离/ 的/ 新型/ 路由器/ 体系结构/ ,/ 形成/ 共享/ 的/ 、/ 可/ 扩展/ 的/ 转发/ 单元/ 群/ ./ 继而/ ,/ 设计/ 了/ 工作/ 模式/ 可/ 配置/ 的/ 共享/ 转发/ 引擎/ FERM/ (/ ForwardingEnginewithReconfigurableMode/ )/ ,/ 并/ 基于/ FERM/ 提出/ 了/ 负载/ 均衡/ 、/ 带宽/ 约束/ 和/ 绿色/ 节能/ 等/ 3/ 种/ 不同/ 的/ 转发/ 工作/ 模式/ ./ 最后/ ,/ 给出/ 了/ 面向/ 新型/ 转发/ 引擎/ 的/ 路由/ 系统/ 实现/ 方法/ ,/ 并/ 通过/ 模拟实验/ 分析/ 验证/ 了/ 其/ 优越性/ ./ 关键词/ 可/ 配置/ ;/ 转发/ 单元/ ;/ 负载/ 均衡/ ;/ 带宽/ 约束/ ;/ 绿色/ 节能/ ;/ 路由器/ 1/ 引言/ 互联网/ 规模/ 的/ 迅速/ 扩张/ ,/ 已/ 导致/ 全球/ 路由/ 信息/ 增长/ 至/ 433k/ ①/ ,/ 这/ 就/ 需要/ 互联网/ 中/ 核心/ 路由器/ 耗费/ 大量/ 的/ 存储资源/ 和/ 处理/ 资源/ ./ 现有/ 高端/ 路由/ 系统/ 转发/ 引擎/ 主要/ 采用/ TCAM/ 专用/ 芯片/ 进行/ 转/ 发表/ 的/ 存储/ 及/ 前缀/ 匹配/ ,/ 而/ TCAM/ 芯片/ 成本/ 较/ 高/ 、/ 价格昂贵/ ,/ 并且/ 消耗/ 大量/ 电力/ 资源/ [/ 1/ -/ 2/ ]/ ./ 另一方面/ ,/ 全球/ 范围/ 的/ 节能/ 减排/ 行动/ 要求/ 各种/ 电器设备/ 减少/ 电能/ 消耗/ ,/ 绿/ Page2/ 色/ 节能型/ 路由/ 系统/ 成为/ 设备/ 厂商/ 及/ 学术界/ 共同/ 关注/ 的/ 技术/ 问题/ ./ 此外/ ,/ 互联网/ 新型/ 应用/ 及/ 运营/ 模式/ 都/ 期望/ 路由/ 系统/ 能/ 提供/ 对/ 数据/ 流量/ 的/ 区分/ 服务/ ./ 互联网/ 的/ 多种/ 功能/ 诉求/ ,/ 需要/ 路由/ 系统/ 提供/ 一种/ 工作/ 模式/ 可/ 灵活/ 配置/ 的/ 转发/ 结构/ ./ 然而/ ,/ 典型/ 的/ 高性能/ 核心/ 路由器/ 基于/ 分布式/ 结构/ 实施/ ,/ 每/ 一块/ 线卡/ 都/ 配有/ 单独/ 的/ 转发/ 引擎/ ,/ 转/ 发表/ 需要/ 在/ 每块/ 线卡/ 中/ 进行/ 冗余/ 存储/ ./ 路由/ 系统/ 这种/ 线卡/ 独享/ 转发/ 引擎/ 的/ 结构/ ,/ 不仅/ 加剧/ 了/ 设备/ 的/ 能耗/ 及/ 硬件/ 成本/ 问题/ ,/ 还/ 禁锢/ 了/ 路由/ 系统/ 转发/ 体系/ 的/ 灵活/ 扩展/ ./ 基于/ 能/ 根据/ 运营/ 需求/ 进行/ 转发/ 模式/ 灵活/ 配置/ 的/ 诉求/ ,/ 本文/ 提出/ 了/ 新型/ SFU/ (/ SharedForwardingUnit/ )/ 转发/ 单元/ 共享/ 结构/ ,/ 将/ 转发/ 引擎/ 从/ 线卡/ 中/ 分离出来/ ,/ 形成/ 若干/ 共享/ 的/ 、/ 可/ 扩展/ 的/ 转发/ 单元/ 群/ ./ SFU/ 结构/ 中/ 的/ 转发/ 单元/ 具有/ 功能/ 简单/ 、/ 工作/ 独立/ 的/ 特点/ ./ 基于/ 此/ 结构/ ,/ 设计/ 了/ 工作/ 模式/ 可/ 灵活/ 配置/ 的/ 转发/ 引擎/ FERM/ (/ ForwardingEnginewithReconfigurableMode/ )/ ./ 路由/ 系统/ 可/ 根据/ 运营/ 需求/ 对/ 转发/ 引擎/ 进行/ 模式/ 配置/ ,/ 各种/ 转发/ 模式/ 都/ 以/ 5/ 元组/ 形式/ 完成/ 具体/ 转发/ 处理/ ,/ 并/ 确保/ 不同/ 模式/ 具有/ 一致/ 的/ API/ 接口/ ./ FERM/ 转发/ 引擎/ 的/ 核心思想/ 包括/ 3/ 个/ 方面/ :/ (/ 1/ )/ 路由/ 系统/ 可/ 根据/ 需求/ 进行/ 线卡/ 及/ 转发/ 单元/ 配置/ ,/ 提供/ 重构/ 的/ 转发/ 模式/ ;/ (/ 2/ )/ 系统/ 可/ 根据/ 负载/ 流量/ 对/ 转发/ 单元/ 实时/ 热/ 开启/ // 热/ 关闭/ ;/ (/ 3/ )/ 转发/ 引擎/ 面向/ 不同/ 工作/ 模式/ 的/ 具体/ 转发/ 事务/ 可/ 重构/ 复用/ ./ 本文/ 的/ FERM/ 转发/ 引擎/ 提供/ 了/ 基本/ 的/ 共享/ 式/ 转发/ 模式/ ,/ 并/ 以/ 其/ 为/ 基础/ 实现/ 了/ 带宽/ 约束/ 和/ 绿色/ 节能/ 两种/ 扩展/ 模式/ ./ 本文/ 的/ 主要/ 贡献/ 包括/ :/ (/ 1/ )/ 将/ 核心/ 转发/ 模块/ 从/ 线卡/ 中/ 分离/ ,/ 形成/ 独立/ 工作/ 的/ 转发/ 单元/ ,/ 构建/ 共享/ 式/ 转发/ 单元/ 群/ ,/ 为/ 转发/ 模式/ 可/ 配置/ 提供/ 了/ 结构/ 基础/ ;/ (/ 2/ )/ 提出/ 了/ 工作/ 模式/ 可/ 灵活/ 配置/ 的/ 转发/ 引擎/ FERM/ ,/ 能/ 针对/ 不同/ 目标/ 提供/ 重构/ 的/ 转发/ 模式/ ;/ (/ 3/ )/ 基于/ FERM/ 体系/ ,/ 设计/ 了/ 面向/ 负载/ 均衡/ 、/ 带宽/ 约束/ 、/ 绿色/ 节能/ 等/ 3/ 种/ 转发/ 模式/ 的/ 实现/ 方法/ ./ 本文/ 第/ 2/ 节/ 介绍/ 相关/ 研究/ 工作/ ;/ 第/ 3/ 节/ 介绍/ 工作/ 模式/ 可/ 灵活/ 配置/ 的/ 共享/ 转发/ 引擎/ FERM/ 以及/ 基本/ 的/ 负载/ 均衡/ 工作/ 模式/ ;/ 第/ 4/ 节/ 介绍/ 两种/ 扩展/ 工作/ 模式/ :/ 带宽/ 约束/ 模式/ 和/ 绿色/ 节能/ 模式/ ;/ 第/ 5/ 节/ 介绍/ FERM/ 转发/ 引擎/ 如何/ 在/ 路由/ 系统/ 的/ 实施/ 方法/ ;/ 第/ 6/ 节/ 进行/ 实验/ 及/ 结果/ 分析/ ;/ 第/ 7/ 节/ 总结/ 全文/ ./ 2/ 相关/ 研究/ 针对/ 分布式/ 路由/ 系统/ ,/ 业界/ 普遍/ 采用/ 线卡/ 独立/ 转发/ 引擎/ 结构/ [/ 3/ ]/ ./ 一般/ 由/ 主控/ 卡/ 集中/ 计算/ 出/ 整个/ 可/ 重构/ 路由器/ 的/ 核心/ 路由表/ ,/ 进而/ 通过/ 主动/ 广播/ 更新/ 方式/ 同步/ 所有/ 线卡/ 的/ 路由表/ ,/ 每块/ 线卡/ 都/ 存储转发/ 表/ 的/ 完全/ 镜像/ ./ 路由/ 系统/ 接收/ 的/ 外部/ 流量/ ,/ 必定/ 在/ 入/ 线卡/ 完成/ 前缀/ 匹配/ 、/ 确定/ 下/ 一/ 跳/ 路由器/ 等/ 核心/ 转发/ 流程/ ./ 该/ 结构/ 中/ ,/ 每块/ 线卡/ 都/ 配备/ 相同/ 的/ 转发/ 模块/ ,/ 与/ 线卡/ 的/ 处理/ 流量/ 大小/ 无关/ ,/ 这/ 就/ 容易/ 造成/ 线卡/ 间/ 转发/ 负载/ 的/ 极度/ 失衡/ 以及/ 转发/ 资源/ 的/ 严重/ 浪费/ ./ 近年来/ ,/ 学者/ 对/ 路由器/ 转发/ 引擎/ 进行/ 了/ 多方位/ 的/ 研究/ ,/ 包括/ 降低功耗/ 、/ 降低/ 转/ 发表/ 存储/ 开销/ 、/ 提供/ 流量/ 区分/ 服务/ 等/ ./ 文献/ [/ 2/ ]/ 指出/ 路由器/ 60/ %/ 的/ 功耗/ 来自/ 于/ 转发/ 引擎/ ,/ 因此/ 有效/ 降低/ 路由器/ 功耗/ 的/ 关键/ 是/ 降低/ 转发/ 引擎/ 的/ 功耗/ ./ 同时/ 文献/ [/ 4/ ]/ 提出/ 高能耗/ 带来/ 的/ 两个/ 问题/ :/ (/ 1/ )/ 高能耗/ 会/ 消耗/ 较/ 多/ 电能/ ,/ 增加/ 使用/ 成本/ ;/ (/ 2/ )/ 热量/ 集中/ ,/ 散热/ 成为/ 难题/ ,/ 需要/ 采用/ 较/ 多/ 的/ 散热/ 设备/ ,/ 影响/ 内部结构/ 和/ 布局/ ,/ 增加/ 制造/ 成本/ ./ 此外/ ,/ 文献/ [/ 5/ ]/ 提出/ 了/ 在/ TCAM/ 中/ 分块/ 处理/ 的/ 思想/ 来/ 减少/ 能耗/ ,/ 通过/ 激活/ 少量/ 的/ TCAM/ 模块/ ,/ 可以/ 大幅/ 降低/ 不必要/ 的/ 能耗/ 开销/ ./ 在/ 路由/ 存储/ 方面/ ,/ 文献/ [/ 2/ ]/ 预测/ ,/ 到/ 2050/ 年/ 核心/ 路由器/ 中/ 路由表/ 项可/ 增长/ 至/ 10M/ ./ 因此/ ,/ 转发/ 引擎/ 的/ 路由/ 存储/ 能力/ 将/ 面临/ 极大/ 的/ 考验/ ./ 文献/ [/ 6/ ]/ 提出/ 了/ 一个/ 新型/ 路由器/ 转发/ 模型/ ,/ 并/ 通过/ 实验/ 分析/ 得出/ :/ 一个/ 支持/ 5M/ 路由/ 前缀/ 存储/ 的/ 转发/ 引擎/ ,/ 在/ 160Gbps/ 的/ 转发/ 速度/ 时/ ,/ 所/ 需/ 的/ 能耗/ 花销/ 为/ 256/ 美元/ ./ 此外/ ,/ 新型/ 芯片/ 的/ 设计/ 代价/ 每/ 2/ 年/ 提升/ 1.5/ 倍/ ./ 因此/ ,/ 小/ 空间/ 转发/ 项/ 存储/ 算法/ 可/ 节约/ 路由/ 交换/ 设备/ 资源/ ,/ 降低/ 设计/ 成本/ ./ 文献/ [/ 1/ ]/ 给出/ 的/ DSF/ 模型/ ,/ 可以/ 根据/ IP/ 前缀/ 的/ 若干/ bit/ 位/ 实现/ 线卡/ 对/ 转/ 发表/ 的/ 分解/ 存储/ ,/ 并/ 只/ 带来/ 极少/ 的/ 冗余/ 存储/ ,/ 从而/ 降低/ 路由/ 存储/ 开销/ ./ 针对/ 转发/ 流量/ 的/ 区分/ 服务/ ,/ 目前/ 业界/ 主要/ 采用/ 资源/ 预留/ 协议/ [/ 7/ ]/ 为/ 网络/ 上/ 的/ 数据传输/ 预定/ 传输/ 资源/ 和/ 保证/ 服务质量/ ./ 文献/ [/ 8/ ]/ 针对/ 报文/ 转发/ 的/ 区分/ 服务/ ,/ 给出/ 了/ 一种/ 基于/ 专用/ 高性能/ 分组/ 转发/ 引擎/ 的/ QoS/ 实现/ 方法/ ./ 另外/ ,/ 可/ 重构/ 技术/ 使/ 同一/ 器件/ 支持/ 多/ 类型/ 服务/ 成为/ 可能/ ./ Lee/ 等/ 人/ 在/ 文献/ [/ 9/ ]/ 中/ 提出/ 了/ 路由/ 系统/ 功能/ 重构/ 的/ 概念/ ,/ 指出/ 路由器/ 功能/ 的/ 动态/ 可/ 重构/ 能够/ 提高/ 运营/ 网络/ 的/ 性能/ ,/ 具有/ 更好/ 的/ 适应性/ ./ 3/ 模式/ 可/ 配置/ 的/ 共享/ 转发/ 引擎/ 现有/ 分布式/ 路由/ 系统/ 中/ ,/ 每块/ 线卡/ 都/ 配置/ 有/ 独享/ 的/ 转发/ 引擎/ ,/ 这种/ 结构限制/ 了/ 系统对/ 转发/ 引擎/ 的/ Page3/ 灵活/ 控制/ ./ FERM/ 转发/ 引擎/ 的/ 结构/ 基础/ 就是/ 将/ 转发/ 引擎/ 从/ 线卡/ 分离/ ,/ 构成/ 若干/ 具有/ 独立/ 转发/ 功能/ 的/ 转发/ 单元/ ./ 分布式/ 路由/ 系统/ 中/ ,/ 转发/ 单元/ 群为/ 所有/ 线卡/ 服务/ ,/ 实现/ 转发/ 资源/ 的/ 共享/ ./ 定义/ 1/ (/ 转发/ 单元/ FU/ )/ ./ 可/ 按照/ 最长/ 前缀/ 匹配/ 等/ 规则/ ,/ 独立/ 完成/ 转/ 发表/ 查询/ ,/ 并/ 根据/ 查询/ 结果/ 将/ 报文/ 发送至/ 指定/ 出线/ 卡/ 的/ 功能模块/ ,/ 称之为/ 转发/ 单元/ ,/ 记为/ FU/ (/ ForwardingUnit/ )/ ./ 转发/ 单元/ 与/ 现有/ 线卡/ 上/ 的/ 转发/ 引擎/ 设计/ 相似/ ,/ 通过/ TCAM/ 专用/ 芯片/ 存储/ IP/ 前缀/ 进行/ 多/ 条目/ 并行/ 最长/ 前缀/ 匹配/ ./ 静态/ 随机/ 存储器/ (/ SRAM/ )/ 配合/ TCAM/ 查找/ ,/ 存储/ 匹配/ 结果/ 信息/ ,/ 如/ 出线/ 卡/ 、/ 出/ 接口/ 、/ 下/ 一/ 跳/ 等/ ./ 另外/ ,/ 利用/ FPGA/ 实现/ IP/ 报头/ 检查/ 等/ 其它/ 处理/ 逻辑/ ./ 转发/ 单元/ 工作/ 过程/ 简单/ ,/ 包括/ 3/ 个/ 步骤/ :/ 从/ 线卡/ 接收/ 报文/ 、/ 查找/ 转/ 发表/ 、/ 根据/ 匹配/ 结果/ 将/ 报文/ 送/ 至/ 目的/ 线卡/ ./ 可/ 配置/ 共享/ 转发/ 引擎/ 基于/ 图/ 1/ 所示/ 的/ 功能/ 结构/ 实施/ ,/ 称为/ SFU/ ,/ 具有/ 如下/ 功能/ 特点/ :/ (/ 1/ )/ 转/ 发表/ 查询/ 功能/ 完全/ 从/ 线卡/ 中/ 分离出来/ ,/ 由/ 转发/ 单元/ 完成/ ;/ (/ 2/ )/ 路由器/ 形成/ 瘦/ 线卡/ 模式/ ,/ 线卡/ 功能/ 极为/ 简单/ ,/ 功能/ 集中/ 于/ 外部/ 接口/ 的/ 报文/ 收发/ ,/ 从而/ 使得/ 线卡/ 极易/ 进行/ 功能/ 扩展/ 及/ 不同/ 类型/ 的/ 外部/ 接口/ 更换/ ;/ (/ 3/ )/ 转发/ 单元/ 功能/ 高度/ 聚合/ ,/ 独立/ 完成/ 转/ 发表/ 查找/ 功能/ ,/ 并/ 根据/ 查找/ 结果/ 将/ 报文/ 转/ 交给/ 目的/ 线卡/ ./ 基于/ 图/ 1/ 的/ 路由器/ 结构/ 提出/ 了/ 工作/ 模式/ 可/ 灵活/ 配置/ 的/ 转发/ 引擎/ FERM/ ./ 该/ 转发/ 引擎/ 中/ ,/ 系统/ 可/ 根据/ 不同/ 运营/ 需求/ ,/ 由/ 主控/ 、/ 线卡/ 和/ 转发/ 单元/ 协同工作/ ,/ 构建/ 面向/ 不同/ 目标/ 的/ 转发/ 模式/ ./ FERM/ 转发/ 结构/ 定义/ 为/ FERM/ =/ 〈/ MO/ ,/ IN/ ,/ ST/ ,/ FP/ ,/ FM/ 〉/ ,/ 各/ 符号/ 描述/ 如下/ ./ (/ 1/ )/ MO/ (/ Mode/ ,/ 运行/ 模式/ )/ ,/ 是/ 转发/ 引擎/ 某种/ 运行/ 模式/ 的/ 抽象/ 描述/ ,/ 如/ 负载/ 均衡/ 、/ 绿色/ 节能/ 等/ 模式/ ,/ 可用/ 脚本语言/ 描述/ ,/ 路由/ 系统/ 解释/ 脚本/ 描述/ 并/ 确定/ 转发/ 引擎/ 运行/ 模式/ ./ (/ 2/ )/ IN/ (/ Initialization/ ,/ 初始/ 设置/ )/ ,/ 针对/ 转发/ 引擎/ 特定/ 运行/ 模式/ 的/ 初始/ 配置管理/ ,/ 包括/ :/ 管理员/ 在/ 特定/ 工作/ 模式/ 下/ 的/ 参数/ 配置/ ,/ 无需/ 管理员/ 干涉/ 的/ 系统/ 设置/ ,/ 如/ 定时器/ 启动/ 或/ 参数值/ 指定/ 等/ ./ (/ 3/ )/ ST/ (/ State/ ,/ 状态/ 管理/ 及/ 调度/ )/ ,/ 指定/ 转发/ 模式/ 需/ 关心/ 的/ 系统资源/ 状态/ ,/ 扩展/ 的/ 转发/ 模式/ 需要/ 根据/ 系统/ 实时/ 运行/ 状态/ 进行/ 资源/ 调配/ ,/ 如/ 转发/ 单元/ 转发/ 报文/ 负荷/ 、/ FIB/ 表/ 容量/ 等/ ./ 另外/ ,/ FERM/ 需要/ 实时/ 调控/ 共享/ 转发/ 引擎/ 状态/ ,/ 如/ 转发/ 单元/ 负载/ 策略/ 调整/ 、/ 转发/ 单元/ 开启/ 及/ 关闭/ 等/ ./ (/ 4/ )/ FP/ (/ ForwardingProcess/ ,/ 转发/ 实施/ )/ ,/ 指/ 线卡/ 的/ 报文/ 转发/ 处理/ ,/ FERM/ 模型/ 中/ 主要/ 工作/ 是/ 为/ 当前/ 报文/ 选择/ 转发/ 单元/ ,/ 同时/ 调整/ 相关/ 状态/ 信息/ ./ (/ 5/ )/ FM/ (/ FibMaintenance/ ,/ 表项/ 维护/ )/ ,/ 负责/ 分布式系统/ 多个/ 转发/ 单元/ 转/ 发表/ 项/ 存储/ 的/ 一致性/ ./ 不同/ 的/ 重构/ 实例/ 不/ 影响/ 表项/ 维护/ API/ 接口/ 形式/ 上/ 的/ 一致性/ ./ 如图/ 2/ 所示/ ,/ FERM/ 根据/ 不同/ 的/ 运行/ 模式/ MO/ ,/ 实施/ 不同/ 的/ IN/ 、/ ST/ 、/ FP/ 、/ FM/ 等/ 相关/ 事务/ ,/ 并且/ 确保/ 不同/ 运行/ 模式/ 总是/ 提供/ 一致/ 的/ API/ 接口/ ./ FERM/ 转发/ 引擎/ 中/ ,/ 路由/ 系统/ 可/ 根据/ 运营/ 需求/ 提供/ 不同/ 的/ 转发/ 模式/ ,/ 并且/ 使/ 转发/ 事务/ 最大/ 粒度/ 的/ 重构/ 复用/ ./ 现有/ 分布式/ 路由/ 系统/ 中/ ,/ 线卡/ 与/ 转发/ 引擎/ 强制/ 绑定/ ,/ 线卡/ 转发/ 引擎/ 的/ 负载/ 完全/ 与/ 线卡/ 外部/ 接口/ 的/ 接收/ 流量/ 对应/ ./ 可见/ ,/ 分布式/ 路由/ 系统/ 实际/ 工作/ 时/ ,/ 经常/ 发生/ 转发/ 引擎/ 负载/ 严重/ 不/ 均衡/ 的/ 现象/ ,/ 限制/ 了/ 整个/ 系统/ 的/ 报文/ 转发/ 处理/ 能力/ ./ FERM/ 转发/ 引擎/ 的/ 基本/ 运行/ 模式/ 是/ 负载/ 均衡/ (/ LoadBalanceMode/ ,/ LBM/ )/ ,/ 系统/ 共享/ 转发/ 单元/ 群/ ,/ 保证/ 多个/ 转发/ 单元/ 均摊/ 所有/ 线卡/ 的/ 报文/ 转发/ 负载/ ,/ 从而/ 提升/ 系统/ 的/ 整体/ 转发/ 能力/ ./ 负载/ 均衡/ 模式/ 中/ ,/ 转发/ 单元/ 调配/ 高效/ 简单/ ,/ 对于/ 任/ 一线/ 卡/ 第/ i/ 个/ 待/ 转发/ 报文/ ,/ 交由/ 第/ j/ 个/ 转发/ 单元/ 处理/ ,/ 满足/ j/ =/ imodn/ ./ 令/ 系统/ 有/ n/ 个/ 转发/ 单元/ ,/ 每个/ 转发/ 单元/ 的/ 最大/ 转发/ 能力/ 均等/ ,/ 都/ 为/ Bm/ ,/ 则/ 系统/ 最大/ 转发/ 能力/ 为/ n/ ×/ Bm/ ./ 传统/ 转发/ 模型/ 中/ ,/ 同样/ 有/ n/ 个/ 线卡/ 且/ 每/ 线卡/ 的/ 转发/ 能力/ 也/ 为/ Bm/ ,/ 但/ 只有/ Page4Nu/ 个/ 线卡/ 连/ 有/ 外部/ 链路/ ,/ Nu/ </ n/ ./ 此时/ ,/ 系统/ 最大/ 转发/ 能力/ 只有/ Nu/ ×/ Bm/ ./ 显然/ ,/ 负载/ 均衡/ 模式/ 将/ 大大/ 提升/ 系统/ 的/ 转发/ 能力/ ./ 工作/ 在/ LBM/ 模式/ 下/ 的/ 路由/ 系统/ ,/ 基于/ 对/ 报文/ 大小/ 带来/ 的/ 极小/ 负载/ 差异/ 的/ 忽略/ ,/ 则/ 所有/ 转发/ 单元/ 的/ 报文/ 转发/ 负载量/ ,/ 在/ 任何/ 时候/ 都/ 基本/ 等同/ ./ 同时/ ,/ 任/ 一线/ 卡/ 的/ 转发/ 负载/ ,/ 都/ 大致/ 均摊/ 在/ 所有/ 转发/ 单元/ 上/ ./ 当然/ ,/ 可以/ 基于/ LBM/ 实施/ 以源/ 、/ 目的/ IP地址/ 的/ 分流/ 策略/ ,/ 确保/ 报文/ 按序/ 转发/ ,/ 此/ 部分/ 本文/ 不/ 作/ 深入分析/ ./ LBM/ 负载/ 均衡/ 模式/ 中/ 各/ 事务/ 描述/ 如下/ :/ (/ 1/ )/ IN1/ ./ 主控/ 及/ 线卡/ 中/ 相关/ 参数/ 初始化/ ,/ 包括/ 2/ 个/ 事务/ ./ IN1/ ./ 1/ ,/ 主控/ 读取/ 转发/ 单元/ 数/ n/ ,/ 当前工作/ 转发/ 单元/ 数/ k/ =/ n/ ,/ 并/ 通告/ 各/ 线卡/ ;/ IN1/ ./ 2/ ,/ 各/ 线卡/ 当前/ 转发/ 单元/ 序号/ 初始/ 为/ Ncur/ =/ 1/ ./ (/ 2/ )/ FP1/ ./ 线卡/ 总是/ 选择/ Ncur/ 号/ 转发/ 单元/ 为/ 当前/ 报文/ 实施/ 转发/ 处理/ ,/ 并/ 调整/ Ncur/ 的/ 值/ ,/ 包括/ 1/ 个/ 事务/ ./ FP1/ ./ 1/ ,/ 线卡/ 将/ 当前/ 报文/ 传递/ 给/ 第/ Ncur/ 号/ 转发/ 单元/ 处理/ ,/ 并/ 有/ Ncur/ =/ (/ Ncur/ +/ 1/ )/ modk/ ./ (/ 3/ )/ FM1/ ./ 由于/ 采用/ 全/ 冗余/ 备份/ 的/ 转/ 发表/ 存储/ 机制/ ,/ 转发/ 项/ 增加/ 和/ 删除/ 需/ 针对/ 每/ 一个/ 转发/ 单元/ 完成/ ,/ 具体/ 算法/ 不是/ 本文/ 的/ 研究/ 重点/ ,/ 可/ 参见/ 文献/ [/ 10/ ]/ ,/ 包括/ 1/ 个/ 事务/ ./ FM1/ ./ 1/ ,/ 主控/ 增加/ // 删除/ 一条/ 转发/ 项/ ,/ 并/ 通告/ 系统/ 所有/ 转发/ 单元/ 增加/ // 删除/ 对应/ 表项/ ./ 4/ 扩展/ 转发/ 模式/ FERM/ 中/ ,/ 分布式/ 路由器/ 中/ 所有/ 待/ 转发/ 流量/ 可/ 共享/ 系统/ 的/ 转发/ 资源/ ./ 除了/ 基本/ 的/ 转发/ 单元/ 分摊/ 负载/ 模式/ ,/ 本文/ 还/ 设计/ 了/ 两种/ 扩展/ 转发/ 模式/ :/ 带宽/ 约束/ 模式/ 和/ 绿色/ 节能/ 模式/ ./ 4.1/ 带宽/ 约束/ 模式定义/ 2/ (/ 报文/ 图/ PM/ )/ ./ 对于/ 符合/ 某种/ 规则/ 的/ 报文/ 集合/ 称之为/ 报文/ 图/ (/ PacketsbasedMap/ ,/ PM/ )/ ,/ 报文/ 图/ 的/ 匹配/ 规则/ 可以/ 是/ IP地址/ 、/ 报文/ 大小/ 、/ 协议/ 类型/ 等等/ ./ 定义/ 3/ (/ 默认/ 报文/ 图/ PM0/ )/ ./ 对于/ 没有/ 明确/ 进行/ 带宽/ 约束/ 指定/ 的/ 普通/ 报文/ 集合/ ,/ 被/ 称为/ 默认/ 报文/ 图/ ./ 带宽/ 约束/ 模式/ (/ BandwidthRestrictionMode/ ,/ BRM/ )/ 确保/ 转发/ 引擎/ 对于/ 符合/ 某些/ 规则/ 的/ 重要/ 数据/ 分组/ ,/ 提供/ 高级/ 别的/ 转发/ 服务/ ./ 同时/ ,/ 也/ 可/ 对/ 某些/ 低质量/ 的/ 数据/ 或/ 垃圾/ 数据/ ,/ 进行/ 带宽/ 限制/ ./ 本文/ 以/ 报文/ 图/ 描述/ 报文/ 集合/ ./ 工作/ 在/ BRM/ 模式/ 下/ 的/ 转发/ 引擎/ 配/ i/ =/ 1/ 置/ 多个/ 约束/ 服务/ 规则/ ,/ 为/ 不同/ 报文/ 图/ 提供/ 转发/ 带宽/ 约束/ ./ 带宽/ 约束/ 规则/ 表示/ 为/ 〈/ PM/ ,/ Ω/ 〉/ ,/ 其中/ Ω/ 为/ 约束/ 带宽/ 值/ ,/ 不同/ 的/ 报文/ 图可/ 指定/ 不同/ 的/ 约束/ 带宽/ 值/ ./ 假设/ 路由/ 系统配置/ 有/ m/ 个/ 带宽/ 约束/ 规则/ 〈/ PMi/ ,/ Ω/ i/ 〉/ ,/ 1/ / i/ / m/ ./ 对于/ 整个/ 路由/ 系统/ 特定/ 的/ 转发/ 能力/ ,/ 默认/ 报文/ 图/ 的/ 带宽/ 约束/ 可/ 根据上述/ 规则/ 计算/ 而/ 得/ ./ BRM/ 模式/ 的/ 实施/ 思想/ 继承/ 负载/ 均衡/ 策略/ 的/ 均摊/ 原则/ ./ 令/ 系统/ 有/ n/ 个/ 转发/ 单元/ ,/ 对于/ 某一/ 约束/ 规则/ 〈/ PMi/ ,/ Ω/ i/ 〉/ ,/ 系统/ 将/ 报文/ 图/ PMi/ 的/ 约束/ 带宽/ Ω/ i/ 平均分配/ 到/ n/ 个/ 转发/ 单元/ 上/ ,/ 每个/ 转发/ 单元/ 针对/ 报文/ 图/ PMi/ 提供/ 约束/ 转发/ 带宽/ Ω/ i/ // n/ ./ 所以/ ,/ 对于/ 所有/ 指定/ 的/ 转发/ 带宽/ 约束/ ,/ 每个/ 转发/ 单元/ 约束/ 带宽/ 总和/ BI/ 满足/ BI/ =/ ∑/ m/ Ω/ (/ )/ in/ ./ 接着/ ,/ 可/ 计算/ 每个/ 转发/ 单元/ 默认/ 报文/ 图/ ∑/ mPM0/ 享有/ 带宽/ 为/ Ω/ 0/ =/ Bm/ -/ BI/ =/ Bm/ -/ ∑/ m/ 带宽/ 约束/ 模式/ 根据/ 精确/ 程度/ 要求/ ,/ 以/ 时间段/ Δ/ t1/ 为/ 单位/ 进行/ 带宽/ 约束/ 控制/ ./ 对于/ 某一/ 约束/ 规则/ 〈/ PMi/ ,/ Ω/ i/ 〉/ ,/ Δ/ t1/ 时间/ 内/ 所有/ 匹配/ PMi/ 规则/ 的/ 转发/ 报文/ 带宽/ 不/ 超过/ (/ Δ/ t1/ ×/ Ω/ i/ )/ ,/ 超过/ 约束/ 带宽/ 的/ 报文/ 将/ 被/ 丢弃/ ./ FERM/ 中/ ,/ 带宽/ 约束/ 直接/ 在线/ 卡中/ 实施/ ./ 所以/ ,/ 系统/ 应/ 在/ 比/ Δ/ t1/ 更/ 小/ 的/ 时间/ 粒度/ 下/ 统计/ :/ 针对/ 不同/ 报文/ 图/ 的/ 实际/ 耗用/ 带宽/ ,/ 并/ 实时/ 通知/ 各/ 线卡/ ./ 令/ Φ/ i/ 为/ Δ/ t1/ 时间/ 内/ 系统/ 针对/ 报文/ 图/ PMi/ 的/ 实际/ 耗用/ 带宽/ ,/ 满足/ Φ/ i/ / (/ Δ/ t1/ ×/ Ω/ i/ )/ ./ 基于/ FERM/ 转发/ 引擎/ ,/ 带宽/ 约束/ 模式/ 中/ 各/ 转发/ 事务/ 描述/ 如下/ ./ (/ 1/ )/ IN2/ ./ 包括/ 3/ 个/ 事务/ ./ IN2/ ./ 1/ ,/ 主控/ 读取/ 转发/ 单元/ 数/ n/ ,/ 当前工作/ 转发/ 单元/ 数/ k/ =/ n/ ,/ 并/ 通告/ 各/ 线卡/ ;/ IN2/ ./ 2/ ,/ 各/ 线卡/ 为/ 每个/ 报文/ 图/ (/ 包括/ 默认/ 报文/ 图/ )/ 设置/ “/ 当前/ 转发/ 单元/ 序号/ Ncur/ (/ i/ )/ ”/ ,/ 并/ 初始/ 为/ Ncur/ (/ i/ )/ =/ 1/ ;/ IN2/ ./ 3/ ,/ 各/ 线卡/ 启动/ 循环/ 超时/ 定时器/ TM1/ ,/ 超时/ 时间/ 为/ Δ/ t1/ ./ (/ 2/ )/ ST2/ ./ 线卡/ 定时器/ TM1/ 超时/ 触发/ 1/ 个/ 事务/ ./ ST2/ ./ 1/ ,/ 对/ 上/ 一/ 时间段/ 统计/ 的/ 实际/ 耗用/ 带宽/ Φ/ i/ 清零/ ,/ 对/ 当前/ 转发/ 单元/ 序号/ 重新/ 赋值/ :/ Ncur/ (/ i/ )/ =/ 1/ ,/ 0/ / i/ / m/ ,/ 对于/ 默认/ 报文/ 图/ 的/ 处理/ 也/ 包含/ 其中/ ./ (/ 3/ )/ FP2/ ./ 线卡/ 根据/ 报文/ 图/ 将/ 待/ 转发/ 报文/ 交付给/ 不同/ 转发/ 单元/ ,/ 主要/ 是/ 分析/ 实际/ 耗用/ 带宽/ 和/ 指定/ 带宽/ ,/ 以此/ 为据/ 实施/ 转发/ 处理/ ,/ 包括/ 1/ 个/ 事务/ ./ FP2/ ./ 1/ ,/ 线卡/ 对/ 转发/ 报文/ 进行/ 报文/ 图/ 匹配/ ,/ 匹配/ 结果/ 为/ PMi/ ,/ 获取/ 对应/ 的/ Φ/ i/ 和/ Ω/ i/ ./ 若/ 满足/ Φ/ i/ </ (/ Δ/ t1/ ×/ Ω/ i/ )/ ,/ 将/ 报文/ 传递/ 给/ 第/ Ncur/ (/ i/ )/ 号/ 转发/ 单元/ ,/ 并/ Ncur/ (/ i/ )/ =/ (/ Ncur/ (/ i/ )/ +/ 1/ )/ modk/ ;/ 否则/ ,/ 丢弃/ 报文/ ./ Page5/ (/ 4/ )/ FM2/ ./ 一个/ 事务/ FM2/ ./ 1/ ,/ 它/ 与/ FM1/ ./ 1/ 相同/ ./ 4.2/ 节能/ 模式/ 节能/ 模式/ (/ PowerSavingMode/ ,/ PSM/ )/ 的/ 主要/ 思想/ 是/ :/ 用/ 尽量少/ 的/ 转发/ 单元/ 完成/ 数据/ 报文/ 的/ 正常/ 转发/ ,/ 并/ 关闭/ 多余/ 的/ 转发/ 单元/ 以/ 节省/ 电能/ 消耗/ ./ FERM/ 对/ 路由/ 系统/ 的/ 转发/ 带宽/ 进行/ 实时/ 监控/ ,/ 预判/ 后续/ 转发/ 负载/ ,/ 并/ 通过/ 开启/ 或/ 关闭/ 转发/ 单元/ 保证/ 以/ 最/ 经济/ 的/ 代价/ 完成/ 报文/ 转发/ ./ 节能/ 模式/ 以/ 负载/ 均衡/ 模式/ 为/ 基础/ 进行/ 实施/ ./ 令/ 当前/ 设备/ 状态/ 共有/ k/ 个/ 转发/ 单元/ 正在/ 工作/ ,/ 0/ </ k/ / n/ ,/ 则/ k/ 个/ 转发/ 单元/ 的/ 负载/ 能力/ 为/ (/ k/ ×/ Bm/ )/ ,/ k/ 个/ 转发/ 单元/ 的/ 实际/ 负载/ 为/ ∑/ k/ 定义/ 两个/ 百分比/ 阈值/ :/ 关闭/ 阈值/ λ/ off/ 和/ 开启/ 阈值/ λ/ on/ ./ 规则/ 1/ ./ 若/ 路由/ 系统/ 当前/ 实际/ 负载/ 小于/ (/ k/ -/ 1/ )/ 个/ 转发/ 单元/ 转发/ 能力/ 的/ 关闭/ 阈值/ 带宽/ ,/ 则/ 应/ 关闭/ 1/ 个/ 转发/ 单元/ ./ 即当/ 系统/ 转发/ 状态/ 满足/ 式/ (/ 1/ )/ 时/ ,/ 则/ 可/ 关闭/ 1/ 个/ 转发/ 单元/ ./ 显然/ ,/ 规则/ 1/ 实施/ 时/ 系统/ 应有/ 多于/ 1/ 个/ 工作/ 转发/ 单元/ ./ 规则/ 2/ ./ 若/ 系统/ 当前/ 实际/ 负载/ 大于/ k/ 个/ 转发/ 单元/ 转发/ 能力/ 的/ 开启/ 阈值/ 带宽/ ,/ 则/ 应/ 开启/ 1/ 个/ 未/ 工作/ 的/ 转发/ 单元/ ./ 即当/ 系统/ 状态/ 满足/ 式/ (/ 2/ )/ 时/ ,/ 则/ 可/ 开启/ 1/ 个/ 转发/ 单元/ ./ 显然/ ,/ 规则/ 2/ 实施/ 时/ 系统/ 的/ 工作/ 转发/ 单元/ 数应/ 少于/ n/ ./ 节能/ 模式/ 根据/ 精确度/ 要求/ ,/ 以/ 时间段/ Δ/ t2/ 为/ 单位/ 进行/ 调控/ ./ 系统分析/ 上/ 一个/ Δ/ t2/ 时间段/ 内/ 的/ 转发/ 引擎/ 负载/ ,/ 并/ 根据/ 规则/ 1/ 和/ 规则/ 2/ 进行/ 转发/ 单元/ 开启/ // 关闭/ 调控/ ./ 为了/ 避免/ 丢包/ 现象/ ,/ 规则/ 2/ 可/ 循环/ 实施/ ,/ 即/ 一次/ 调控/ 可/ 开启/ 多个/ 转发/ 单元/ ./ 因为/ 路由器/ 下/ 一/ 时刻/ 流量/ 与/ 前/ 一/ 时刻/ 流量/ 有着/ 密切/ 的/ 关系/ ,/ 因此/ 以此/ 为据/ 设定/ 关闭/ 阈值/ 和/ 开启/ 阈值/ 的/ 取值/ 范围/ ./ 只有/ 实际/ 处理/ 流量/ 远/ 小于/ 系统/ 当前/ 转发/ 引擎/ 的/ 最高/ 处理/ 流量/ 时/ ,/ 关闭/ 一个/ 转发/ 单元/ 才/ 不致于/ 导致/ 下/ 一/ 时刻/ 丢包/ ,/ 本文/ 初步/ 设定/ 关闭/ 阈值/ 的/ 范围/ 为/ 0/ ~/ 50/ %/ ./ 同理/ ,/ 实际/ 处理/ 流量/ 若/ 高于/ 转发/ 引擎/ 最大/ 处理/ 能力/ 的/ 50/ %/ 时/ ,/ 需要/ 开启/ 新/ 的/ 转发/ 单元/ ,/ 可/ 将/ 开启/ 阈值/ 范围/ 限定/ 于/ 50/ %/ ~/ 100/ %/ ./ 论文/ 后续/ 内容/ 会/ 对/ 不同/ 阈值/ 进行/ 实验/ ,/ 对比/ 节能/ 效果/ ./ 基于/ FERM/ 转发/ 引擎/ ,/ 节能/ 模式/ 中/ 各/ 事务/ 描述/ 如下/ ./ (/ 1/ )/ IN3/ ./ 包括/ 3/ 个/ 事务/ ./ IN3/ ./ 1/ ,/ 主控/ 读取/ 转发/ 单元/ 数/ n/ ,/ 当前工作/ 转发/ 单元/ 数/ k/ =/ n/ ,/ 并/ 通告/ 各/ 线卡/ ;/ IN3/ ./ 2/ ,/ 各/ 线卡/ 当前/ 转发/ 单元/ 序号/ 初始/ 为/ Ncur/ =/ 1/ ;/ IN3/ ./ 3/ ,/ 启动/ 循环/ 超时/ 定时器/ TM2/ ,/ 超时/ 时间/ 为/ Δ/ t2/ ./ (/ 2/ )/ ST3/ ./ 状态/ 调控/ 以/ Δ/ t2/ 时间/ 为/ 单位/ 执行/ ,/ TM2/ 超时/ 执行/ 3/ 个/ 事务/ ./ ST3/ ./ 1/ ,/ 主控/ 收集/ Δ/ t2/ 时间段/ 各/ 转发/ 单元/ 的/ 实际/ 负载/ 带宽/ B/ (/ i/ )/ ,/ 并/ 计算/ 得到/ 系统/ 总/ 转发/ 带宽/ 为/ ∑/ k/ 或/ 关闭/ 转发/ 单元/ ,/ 并/ 对/ k/ 重新/ 赋值/ ;/ ST3/ ./ 3/ ,/ 各/ 线卡/ 当前/ 转发/ 单元/ 序号/ 初始/ 为/ Ncur/ =/ 1/ ./ (/ 3/ )/ FP3/ ./ 线卡/ 总是/ 选择/ Ncur/ 号/ 转发/ 单元/ 为/ 当前/ 报文/ 实施/ 转发/ 处理/ ,/ 并/ 调整/ Ncur/ 的/ 值/ ,/ 包括/ 1/ 个/ 事务/ ./ FP3/ ./ 1/ ,/ 线卡/ 将/ 当前/ 报文/ 传递/ 给/ 第/ Ncur/ 号/ 转发/ 单元/ 处理/ ,/ 并/ 有/ Ncur/ =/ (/ Ncur/ +/ 1/ )/ modk/ ./ (/ 4/ )/ FM3/ ./ 一个/ 事务/ FM3/ ./ 1/ ,/ 与/ FM1/ ./ 1/ 相同/ ./ 5FERM/ 实施/ FERM/ 基于/ SFU/ 路由器/ 体系结构/ ,/ 由/ 主控/ 、/ 线卡/ 、/ 转发/ 单元/ 协同/ 实现/ ,/ 其/ 功能/ 结构/ 如图/ 3/ 所示/ ./ 主控/ 是/ FERM/ 的/ 控制中心/ ,/ 主要/ 涉及/ 3/ 个/ 功能模块/ ./ (/ 1/ )/ 表项/ 维护/ ./ 由/ 路由/ 协议/ 学习/ 路由/ 信息/ 汇聚/ 到/ 路由/ 管理/ 模块/ ,/ 并/ 计算/ 出/ 核心/ 路由表/ ,/ 这一/ 过程/ 与/ 传统/ 路由/ 系统/ 完全/ 一样/ ./ 不同/ 的/ 是/ ,/ 核心/ 路由表/ 同步/ [/ 10/ ]/ 的/ 对象/ 不再/ 是/ 线卡/ ,/ 而是/ 所有/ 转发/ 单元/ ./ 表项/ 维护/ 模块/ 针对/ 系统/ 任何/ 的/ 路由/ 变化/ :/ 增加/ 、/ 删除/ 、/ 修改/ ,/ 负责/ 与/ 所有/ 转发/ 单元/ 同步/ ;/ (/ 2/ )/ 初始/ 配置/ ./ 主要/ 完成/ 相关/ 参数/ 配置/ (/ 如/ 报文/ 图/ 、/ 开启/ // 关闭/ 阈值/ )/ 及/ 全局/ 状态/ 信息/ (/ 如/ 转发/ 单元/ 数/ )/ 的/ 获取/ ./ 同时/ ,/ 将/ 上述/ 参数/ 向/ 所有/ 线卡/ 通告/ ;/ (/ 3/ )/ 状态/ 管理/ 及/ 调度/ ./ 主要/ 在/ FERM/ 运行/ 过程/ 中/ 对系统/ 状态/ 进行/ 监测/ 、/ 分析/ ,/ 并/ 对/ 后续/ 系统/ 状态/ 进行/ 调整/ (/ 如/ 开启/ // 关闭/ 转发/ 单元/ )/ ./ FERM/ 中线/ 卡/ 功能/ 与/ 传统/ 实现/ 的/ 最大/ 区别/ 在于/ :/ 不再/ 存储转发/ 表/ ,/ 不/ 进行/ 转/ 发表/ 查找/ ./ 线卡/ 的/ 核心/ 工作/ 是/ 通过/ 网络接口/ 接收/ 外部/ 报文/ ,/ 并/ 根据/ 主控/ Page6/ 的/ 状态/ 通告/ ,/ 在/ 转发/ 实施/ 时/ 选择/ 转发/ 单元/ 对/ 报文/ 进行/ 处理/ ./ 同时/ ,/ 线卡/ 接收/ 来自/ 转发/ 单元/ 的/ 报文/ ,/ 并/ 通过/ 网络接口/ 发出/ ./ 另外/ ,/ 线卡/ 的/ “/ 初始/ 配置/ ”/ 和/ “/ 状态/ 管理/ 及/ 调度/ ”/ 模块/ 与/ 主控/ 协同/ 完成/ 状态参数/ 调整/ 及/ 定时器/ 服务/ ./ 转发/ 单元/ 是/ FERM/ 最/ 核心/ 的/ 部件/ ,/ 它/ 根据/ 主控/ 的/ 路由/ 通告/ 进行/ 转/ 发表/ 维护/ ./ 转发/ 单元/ 从/ 线卡/ 接收/ 报文/ ,/ 对/ 报文/ 目的/ 地址/ 进行/ 最长/ 前缀/ 匹配/ ,/ 并/ 根据/ 匹配/ 结果/ 将/ 报文/ 转交/ 到/ 出线/ 卡/ ./ 每/ 一个/ 转发/ 单元/ 都/ 独立/ 工作/ ,/ 并/ 与/ FERM/ 转发/ 引擎/ 的/ 不同/ 工作/ 模式/ 无表/ 1/ 不同/ 转发/ 模式/ 中/ 事务/ 的/ 重构/ 关系/ 状态/ 管理/ 及/ 调度/ 6/ 实验/ 及/ 性能/ 分析/ 使用/ Matlab/ 对/ 本文/ 工作/ 进行/ 模拟/ 分析/ ./ 对于/ 负载/ 均衡/ 模式/ ,/ 假设/ 拥有/ 4/ 个/ 转发/ 单元/ ,/ 每块/ 转发/ 引擎/ 最大/ 处理/ 带宽/ 为/ 10Gbps/ ,/ 采用/ 生成/ 随机数/ 的/ 方法/ 模拟/ 实际/ 流量/ ,/ 对/ 负载/ 均衡/ 模式/ LBM/ 模式/ 和/ 传统/ 转发/ 模式/ (/ TraditionalForwardingMode/ ,/ TFM/ )/ 进行/ 比较/ ./ 假设/ 每块/ 线卡/ 需要/ 处理/ 的/ 流量/ 在/ 0/ ~/ 15Gbps/ 之间/ 随机/ 分布/ ,/ 随机/ 生成/ 1000/ 个点/ ,/ 代表/ 需要/ 处理/ 的/ 1000/ 组/ 真实/ 流量/ ./ 图/ 4/ 显示/ 了/ 这/ 1000/ 个/ 随机/ 流量/ 与/ 实际/ 处理/ 的/ 流量/ 的/ 关系/ ./ 图/ 4/ 中/ 横坐标/ 为/ 转发/ 单元/ 收到/ 的/ 流量/ 总和/ ,/ 纵坐标/ 为/ 转发/ 单元/ 实际/ 处理/ 的/ 流量/ 总和/ ./ 三角/ 代表/ LBM/ 模式/ 的/ 实际/ 处理/ 流量/ ,/ 五角星/ 代表/ TFM/ 模式/ 的/ 实际/ 处理/ 流量/ ./ 可见/ ,/ LBM/ 模式/ 在/ 实际/ 流量/ 不/ 高于/ 4/ ×/ 10Gbps/ 带宽/ 时/ ,/ 能/ 确保/ 不/ 出现/ 任何/ 丢包/ ./ 而/ TFM/ 模式/ 中/ ,/ 因为/ 每块/ 线卡/ 的/ 关/ ./ 转发/ 单元/ 简单/ 、/ 模式/ 无关/ 的/ 特点/ ,/ 有效/ 地/ 保证/ 了/ FERM/ 的/ 高效性/ 和/ 灵活性/ ./ FERM/ 转发/ 引擎/ 不仅/ 支持/ 多种/ 转发/ 模式/ ,/ 还/ 实现/ 了/ 具体实施/ 事务/ 的/ 重构/ 复用/ ./ 本文/ 给出/ 的/ 负载/ 均衡/ 、/ 带宽/ 约束/ 和/ 绿色/ 节能/ 3/ 种/ 转发/ 模式/ ,/ 对应/ 着/ 不同/ 的/ 事务/ 流程/ ./ 表/ 1/ 汇总/ 了/ 3/ 种/ 转发/ 模式/ 的/ 相关/ 事务/ ,/ 并/ 分析/ 了/ 它们/ 之间/ 的/ 重构/ 关系/ ./ 显然/ ,/ FERM/ 转发/ 引擎/ 中/ 的/ 3/ 种/ 工作/ 模式/ ,/ 存在/ 大量/ 的/ 事务/ 重构/ 关系/ ,/ 说明/ 系统/ 可/ 基于/ 大量/ 重构/ 模块/ 完成/ 实现/ ./ 转发/ 引擎/ 只能/ 处理/ 10Gbps/ 的/ 流量/ ,/ 当/ 一块/ 线卡/ 接收/ 的/ 流量/ 高于/ 10Gbps/ 时/ ,/ 就/ 会/ 出现/ 丢包/ ./ 当且/ 仅/ 当/ 每块/ 线卡/ 都/ 接收/ 10Gbps/ 流量/ 时/ ,/ 系统/ 才/ 可/ 达到/ 最大/ 处理/ 流量/ 40Gbps/ ./ 然而/ ,/ 多数/ 情况/ 下/ 每个/ 线卡/ 接收/ 到/ 的/ 实际/ 流量/ 并/ 不/ 平均/ ./ 因此/ ,/ 由于/ TFM/ 模式/ 中/ 各/ 线卡/ 流量/ 不/ 均衡/ ,/ 系统/ 转发/ 能力/ 得不到/ 最大化/ 利用/ ./ PSM/ 模式/ 是/ 用/ 尽量少/ 的/ 转发/ 单元/ 完成/ 系统/ 的/ 转发/ 工作/ ,/ 并/ 关闭/ 空闲/ 转发/ 单元/ 节省/ 电能/ ./ 转发/ 单元/ 中/ 一块/ TCAM/ 的/ 能耗/ 在/ 12W/ ~/ 15W/ 之间/ ,/ 非/ 激活状态/ 为/ 2.5/ W/ ,/ 激活状态/ 为/ 14.3/ W/ [/ 4/ ]/ ./ 可见/ ,/ 关闭/ 空闲/ 转发/ 引擎/ 可以/ 大幅度降低/ 系统/ 能耗/ ./ 令/ Pact/ 为/ 激活状态/ 所/ 需/ 能耗/ ,/ Pinact/ 为/ 非/ 激活状态/ 所/ 需/ 能耗/ ,/ M/ 为/ 关闭/ 转发/ 引擎/ 个数/ ,/ T/ 为/ 关闭/ 时间/ ./ 节省/ 电能/ Psave/ 满足/ 公式/ :/ Psave/ =/ (/ Pact/ -/ Pinact/ )/ ×/ M/ ×/ T/ ./ 图/ 5/ 为/ 关闭/ 转发/ 引擎/ 个数/ 、/ 关闭/ 时间/ 与/ 可/ 节省/ 电能/ 的/ 理论/ 关系/ 图/ ./ 可见/ ,/ 当/ 关闭/ 转发/ 单元/ 的/ 个数/ 和/ 关闭/ 时间/ 逐渐/ 增加/ 时/ ,/ 能耗/ 节省/ 非常明显/ ./ Page7/ 此外/ ,/ 针对/ 网络/ 实际/ 流量/ 进行/ PSM/ 模式/ 的/ 节能/ 分析/ ./ 假设/ 可/ 重构/ 虚拟/ 转发/ 引擎/ 系统/ 每隔/ 10min/ 检测/ 一次/ 系统/ 流量/ ,/ 并/ 以此/ 判断/ 是否/ 可以/ 关闭/ 或者/ 需要/ 开启/ 若干/ 转发/ 单元/ ./ 假定/ 系统/ 中/ 包含/ 25/ 个/ 转发/ 单元/ ,/ 每个/ 转发/ 单元/ 使用/ 一块/ TCAM/ ,/ 并且/ 最高/ 处理/ 带宽/ 为/ 10Gbps/ ./ 我们/ 采用/ 真实/ 路由器/ “/ PAE/ -/ TEC/ ”/ 在/ 2011/ 年/ 11/ 月/ 4/ 日/ 零点/ 到/ 10/ 点/ 检测/ 的/ 数据/ ①/ 进行/ 分析/ ./ 为了/ 更/ 清晰/ 地/ 表现/ 数据/ ,/ 我们/ 将/ 其/ 流量/ 放大/ 1000/ 倍/ ./ 实验/ 结果/ 如图/ 6/ 所示/ ,/ 星形/ 直线/ 表示/ 传统模式/ 需要/ 开启/ 的/ 转发/ 单元/ 个数/ ,/ 10/ 个/ 小时/ 始终/ 开启/ 25/ 个/ 转发/ 单元/ ./ 折线/ 表示/ 使用/ PSM/ 模式/ 所/ 需/ 开启/ 的/ 转发/ 单元/ 个数/ ./ 传统模式/ 中/ ,/ 10/ 个/ 小时/ 转发/ 单元/ 消耗/ 总/ 电能/ 为/ 25/ ×/ 14.3/ ×/ 0.001/ ×/ 10/ =/ 3.575/ °/ ./ PSM/ 模式/ 中/ ,/ 消耗/ 的/ 电能/ 为/ 2.5007/ °/ ,/ 可/ 节省/ 电能/ 1.0743/ °/ ,/ 约/ 节省/ 30.05/ %/ ./ 可见/ ,/ PSM/ 模式/ 相比/ TFM/ 模式/ 在/ 节能/ 方面/ 有/ 了/ 显著/ 的/ 提升/ ./ 并且/ 由图/ 6/ 可知/ ,/ PSM/ 模式/ 中/ 开启/ 转发/ 单元/ 的/ 个数/ 基本/ 符合实际/ 流量/ 的/ 变化/ ./ 此外/ ,/ 根据/ 设定/ 的/ 开启/ 阈值/ 和/ 关闭/ 阈值/ 不同/ ,/ PSM/ 模式/ 的/ 转发/ 单元/ 启用/ 数量/ 会/ 略有不同/ ./ 因此/ ,/ 我们/ 也/ 对/ 不同/ 阈值/ 设置/ 分析/ 转发/ 单元/ 开启/ 关闭/ 次数/ 和/ 节能/ 比/ ./ 我们/ 将/ 关闭/ 阈值/ 分别/ 设为/ 20/ %/ 、/ 30/ %/ 、/ 40/ %/ ,/ 开启/ 阈值/ 分别/ 设为/ 60/ %/ 、/ 70/ %/ 、/ 80/ %/ ,/ 通过/ 两/ 两/ 组合/ ,/ 进行/ 9/ 次/ 模拟实验/ ./ 实验/ 环境/ 与/ 前述/ 实验/ 一致/ ,/ 选用/ 真实/ 路由器/ “/ PAETEC/ ”/ 流量/ 检测/ 的/ 数据/ 进行/ 分析/ ./ 实验/ 结果/ 如图/ 7/ 所示/ ./ 其中/ 黑色/ 柱/ 代表/ 关闭/ 次数/ ,/ 白色/ 柱/ 代表/ 开启/ 次数/ ,/ 灰色/ 柱/ 代表/ 节能/ 百分比/ ./ 从图/ 7/ 中/ 可以/ 看出/ ,/ 将/ 开启/ 阈值/ 和/ 关闭/ 阈值/ 设/ 为/ 最大值/ 时/ ,/ 省电/ 最多/ ,/ 但/ 同样/ 开启/ 和/ 关闭/ 次数/ 也/ 相对/ 增加/ ./ 此外/ ,/ 随着/ 阈值/ 的/ 增大/ ,/ 出现/ 丢包/ 的/ 概率/ 也/ 随之/ 增大/ ./ PSM/ 实施/ 时/ ,/ 应/ 根据/ 具体/ 需求/ 设置/ 转发/ 单元/ 开关/ 阈值/ ,/ 获得/ 节能/ 和/ 系统/ 传输/ 性能/ 间/ 的/ 最优/ 结合点/ ,/ 本文/ 不/ 做/ 深入分析/ ./ 7/ 总结/ 本文/ 提出/ 了/ 工作/ 模式/ 可/ 配置/ 的/ 共享/ 转发/ 引擎/ ,/ 旨在/ 为/ 不同/ 运营/ 需求/ 的/ 网络/ 提供/ 可/ 动态/ 变换/ 工作/ 模式/ 的/ 转发/ 引擎/ ./ 基于/ 转发/ 引擎/ 与/ 线卡/ 分离/ 的/ SFU/ 路由/ 系统结构/ ,/ 构建/ 独立/ 的/ 转发/ 单元/ 模块/ ./ 转发/ 单元/ 功能/ 简单/ 、/ 工作/ 独立/ ,/ 为/ 转发/ 引擎/ 的/ 工作/ 模式/ 可/ 配置/ 提供/ 了/ 底层/ 基础/ ./ 多个/ 转发/ 单元/ 可/ 形成/ 的/ 共享/ 转发/ 引擎/ ,/ 为/ 路由/ 系统/ 所有/ 线卡/ 提供/ 报文/ 转发/ 服务/ ./ 本文/ 设计/ 的/ 工作/ 模式/ 可/ 配置/ 的/ 转发/ 引擎/ FERM/ ,/ 通过/ 五元/ 组/ 形式/ 描述/ 了/ 转发/ 模式/ 与/ 实施/ 事务/ 的/ 关系/ ./ FERM/ 根据/ 不同/ 的/ 运行/ 模式/ 实施/ 不同/ 的/ 转发/ 事务/ ,/ 并且/ 确保/ 不同/ 运行/ 模式/ 总是/ 提供/ 一致/ 的/ API/ 接口/ ./ 基于/ FERM/ ,/ 路由/ 系统/ 可/ 根据/ 运营/ 需求/ 提供/ 不同/ 的/ 转发/ 模式/ ./ 除了/ 基本/ 的/ 负载/ 均衡/ 模式/ ,/ 还/ 设计/ 了/ 带宽/ 约束/ 和/ 绿色/ 节能/ 两种/ 扩展/ 转发/ 模式/ ,/ 并/ 给出/ 它们/ 的/ 具体实施/ 方法/ ./ 最后/ ,/ 本文/ 通过/ 模拟/ 分析/ 论证/ 了/ FERM/ 转发/ 引擎/ 中/ 各种/ 工作/ 模式/ 的/ 优越性/ 能/ ./ 当然/ ,/ FERM/ 在/ 路由/ 系统/ 中/ 真正/ 实施/ 需要/ 改变/ 现有/ 的/ 典型/ 路由器/ 体系结构/ ,/ 涉及/ 大量/ 的/ 板卡/ 结构设计/ 及/ 设备/ 管理工作/ ./ 而且/ ,/ 线卡/ 与/ 转发/ 单元/ 之间/ 的/ 高速/ 可靠/ 数据交换/ 是/ 结构/ 实现/ 的/ 基础/ ,/ 它/ 相对/ 于/ 传统/ 的/ 线卡/ 间/ 交换/ 更为/ 复杂/ ,/ 论文/ 后续/ 工作/ 将/ 重点/ 关注/ 此/ 方面/ 的/ 研究/ ./ 

