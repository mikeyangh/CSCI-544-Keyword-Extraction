Page1SDaaS/ :/ 一种/ 传感/ 流/ 数据/ 的/ 服务化/ 封装/ 方法/ 张仲妹/ 1/ )/ ,/ 2/ )/ ,/ 3/ )/ 刘晨/ 2/ )/ ,/ 3/ )/ 苏申/ 2/ )/ ,/ 3/ )/ 张守利/ 1/ )/ ,/ 2/ )/ ,/ 3/ )/ 韩燕波/ 1/ )/ ,/ 2/ )/ ,/ 3/ )/ 1/ )/ (/ 天津大学/ 计算机科学/ 与/ 技术/ 学院/ 天津/ 300072/ )/ 2/ )/ (/ 北方工业大学/ 大规模/ 流/ 数据/ 集成/ 与/ 分析/ 技术/ 北京市/ 重点/ 实验室/ 北京/ 100144/ )/ 3/ )/ (/ 北方工业大学/ 云/ 计算/ 研究/ 中心/ 北京/ 100144/ )/ 摘要/ 来自/ 不同/ 传感器/ 网络/ 的/ 流/ 数据共享/ 和/ 集成/ 对于/ 带动/ 相关/ 业务/ 和/ 行业/ 的/ 创新/ 具有/ 重要/ 意义/ ./ 现有/ 的/ 传感/ 网络/ 往往/ 是/ 任务/ 导向/ 或/ 领域/ 专用/ 的/ ,/ 仅/ 适用/ 于/ 特定/ 的/ 应用/ 场景/ ,/ 难以/ 有效/ 地/ 在/ 不同/ 应用/ 间/ 共享/ 和/ 重用/ 其/ 数据/ 资源/ ./ 传感/ 流/ 数据/ 的/ 服务化/ 是/ 一种/ 有效/ 解决/ 物理/ 传感/ 网络/ 数据/ 资源共享/ 和/ 重用/ 的/ 方法/ ./ 针对/ 已有/ 服务化/ 方法/ 在/ 应对/ 大规模/ 传感/ 流/ 数据共享/ 和/ 用户/ 并发/ 访问/ 方面/ 存在/ 的/ 局限性/ ,/ 该文/ 提出/ 了/ 一种/ 面向/ 传感/ 流/ 数据/ 的/ 服务化/ 封装/ 方法/ —/ —/ —/ SDaaS/ (/ StreamDataasaService/ )/ ,/ 该/ 方法/ 使用/ 事件/ 的/ 方式/ 驱动/ 传感/ 流/ 数据/ 的/ 处理/ 和/ 传输/ ,/ 通过/ 对/ 传感/ 数据/ 的/ 融合/ 操作/ 实现/ 服务/ 对/ 传感/ 流/ 数据/ 的/ 深层次/ 加工/ ,/ 并/ 基于/ Pub/ // Sub/ 机制/ 实现/ 传感/ 流/ 数据/ 的/ 按/ 需/ 分发/ ./ 文中/ 基于/ SparkStreaming/ 实现/ 对/ 大规模/ 流/ 数据/ 加工/ 操作/ 的/ 封装/ ,/ 并/ 通过/ 对/ 传统/ 的/ 基于/ 匹配/ 树/ 的/ 事件/ 匹配/ 算法/ 进行/ 改进/ 实现/ 了/ 高效/ 的/ 流/ 数据/ 内容/ 分发/ ,/ 以/ 保障/ 将/ 传感/ 数据/ 实时/ 的/ 分/ 发给/ 相应/ 需求/ ./ 该文/ 通过/ 实验/ 验证/ 了/ 流/ 数据服务/ 的/ 性能/ ,/ 印证/ 了/ 流/ 数据服务/ 能够/ 响应/ 不同/ 的/ 数据/ 需求/ ,/ 在/ 毫秒/ 级别/ 将/ 数据流/ 分/ 发给/ 不同/ 应用/ ./ 关键词/ 传感/ 流/ 数据/ ;/ 流/ 数据服务/ ;/ Pub/ // Sub/ 机制/ ;/ 事件驱动/ ;/ 事件/ 匹配/ ;/ 云/ 计算/ 1/ 引言/ 近年来/ ,/ 随着/ 传感/ 网络/ 技术/ 的/ 不断/ 发展/ ,/ 越来越/ 多/ 的/ 传感器/ 被/ 部署/ 到/ 物理/ 世界/ 中/ 并/ 连/ 接入网/ ./ 据/ 欧洲委员会/ 预计/ ,/ 到/ 2020/ 年/ 将/ 有/ 500/ ~/ 1000/ 亿/ 的/ 传感/ 设备/ 连接/ 到/ 因特网/ 上/ [/ 1/ ]/ ./ 传感/ 设备/ 能够/ 持续/ 产生/ 大量/ 的/ 传感/ 数据/ ,/ 进而/ 帮助/ 用户/ (/ 人类/ 或者/ 机器/ )/ 与其/ 所处/ 的/ 环境/ 互动/ ,/ 并/ 对/ 现实生活/ 中/ 的/ 事件/ 及时/ 反应/ ./ 这些/ 传感/ 数据/ 具有/ 实时/ 到达/ 、/ 持续/ 不间断/ 、/ 变化/ 快/ 等/ 特征/ ,/ 是/ 典型/ 的/ 流/ 数据/ ./ 来自/ 不同/ 传感器/ 网络/ 的/ 流/ 数据/ 的/ 共享/ 和/ 集成/ 对于/ 带动/ 相关/ 业务/ 和/ 行业/ 的/ 创新/ 具有/ 重要/ 意义/ ./ 然而/ 现有/ 的/ 传感器/ 网络/ 一般/ 是/ 领域/ 专用/ 或者/ 任务/ 导向/ 的/ ,/ 仅/ 服务/ 于/ 特定/ 的/ 应用/ ./ 因此/ 在/ 不同/ 企业/ 或/ 组织/ 之间/ 共享/ 传感/ 流/ 数据/ 存在/ 极大/ 障碍/ ./ 首先/ ,/ 数据/ 提供者/ 并/ 不/ 希望/ 对外/ 提供/ 与/ 隐私/ 相关/ 的/ 数据/ ,/ 因此/ 传感/ 流/ 数据/ 不能/ 直接/ 交付给/ 数据/ 消费者/ ./ 例如/ ,/ 对于/ 交管局/ 的/ 车牌/ 自动识别/ 流/ 数据/ (/ AutomaticNumberPlateRecognitionData/ ,/ ANPR/ )/ ,/ 实时/ 导航/ 可以/ 利用/ 车牌/ 流/ 数据/ 做/ 路况/ 分析/ ,/ 但/ 交管局/ 并/ 不/ 希望/ 暴露/ 具体/ 的/ 车牌/ ./ 其次/ ,/ 传感/ 流/ 数据/ 规模/ 一般/ 比较/ 大/ ,/ 数据/ 消费者/ 只/ 关心/ 其中/ 很少/ 的/ 一部分/ ,/ 而/ 不/ 希望/ 接受/ 并/ 处理/ 一个/ 大规模/ 的/ 数据流/ ./ 因此/ 更好/ 的/ 方案/ 是/ 按/ 需/ 的/ 推送/ 传感/ 流/ 数据/ ./ 为了/ 克服/ 上述/ 障碍/ ,/ 一些/ 现有/ 工作/ 本着/ “/ 数据/ 即/ 服务/ ”/ [/ 2/ ]/ 的/ 思想/ ,/ 以/ 服务化/ 的/ 方式/ 来/ 对外/ 提供/ 传感/ 流/ 数据/ ./ 比如/ ,/ 一些/ 传感器/ 网络/ (/ 如/ USTL/ [/ 3/ ]/ ,/ HomePort/ [/ 4/ ]/ 等/ )/ 以/ RESTful/ 服务/ 接口/ 的/ 形式/ 对外/ 提供/ 传感/ 数据/ ,/ 以/ 实现/ 方便/ 的/ 数据/ 访问/ ./ 为了/ 使/ 应用/ 能够/ 获取/ 不同/ 来源/ 的/ 传感/ 流/ 数据/ ,/ 一些/ 研究/ 团队/ 建立/ 了/ 面向/ 社区/ 的/ 流/ 数据/ 服务化/ 平台/ (/ 如/ 微软/ 的/ SenseWeb/ [/ 5/ ]/ ,/ GlobalSensorNetworks/ [/ 6/ ]/ 及/ LiveWeb/ [/ 7/ ]/ )/ ,/ 使得/ 用户/ 能够/ 将/ 不同/ 来源/ 的/ 传感/ 流/ 数据/ 组合/ 起来/ 以/ 创建/ 更/ 具有/ 价值/ 的/ 应用/ ./ 然而/ ,/ 前者/ 仅仅/ 对外/ 提供/ 了/ 获取数据/ 的/ 接口/ ,/ 并/ 不/ 考虑/ 第三方/ 对/ 获取数据/ 的/ 需求/ ;/ 后者/ 虽然/ 允许/ 编码/ 流/ 数据/ 的/ 处理/ 逻辑/ ,/ 但/ 往往/ 采用/ 集中处理/ 的/ 方式/ ,/ 且/ 需要/ 为/ 不同/ 种类/ 的/ 用户/ 需求/ 提供/ 不同/ 的/ 服务/ 接口/ ./ 因此/ 无法/ 有效/ 的/ 处理/ 大规模/ 流/ 数据/ ,/ 也/ 就/ 在/ 保障/ 用户/ 并发/ 访问/ 方面/ 具有/ 一定/ 的/ 局限性/ ./ 针对/ 已有/ 方法/ 在/ 流/ 数据/ 服务化/ 方面/ 存在/ 的/ 局限性/ ,/ 本文/ 提出/ 面向/ 传感/ 流/ 数据/ 的/ 服务化/ 封装/ 方法/ —/ —/ —/ SDaaS/ (/ StreamDataasaService/ )/ ,/ 以/ 实现/ 大规模/ 传感/ 流/ 数据/ 在/ 服务化/ 过程/ 中/ 的/ 深层次/ 数据/ 加工/ 和/ 按/ 需/ 定制/ ./ 具体/ 的/ ,/ 本文/ 主要/ 贡献/ 如下/ :/ (/ 1/ )/ 提出/ 一个/ 针对/ 传感/ 流/ 数据/ 的/ 服务化/ 封装/ 方法/ ,/ 通过/ 对流/ 数据/ 的/ 融合/ 操作/ 实现/ 传感/ 流/ 数据服务/ 的/ 深层次/ 加工/ ,/ 通过/ Pub/ // Sub/ 系统/ 实现/ 传感/ 流/ 数据/ 的/ 按/ 需/ 分发/ ,/ 并/ 将/ 该/ 服务/ 封装/ 方法/ 进行/ 模型/ 抽象/ ,/ 然后/ 面向/ 服务提供者/ 和/ 数据/ 消费者/ 抽象/ 封装/ 接口/ ;/ (/ 2/ )/ 根据/ 本文/ 提出/ 的/ 服务/ 封装/ 方法/ ,/ 提出/ 了/ 一个/ 可行/ 的/ 实现/ 方案/ ,/ 该/ 方案/ 基于/ SparkStreaming/ 实现/ 了/ 对流/ 数据/ 加工/ 操作/ 的/ 封装/ ,/ 基于/ 对/ 传统/ 匹配/ 树/ 算法/ 的/ 改进/ 实现/ 了/ 高效/ 的/ 流/ 数据/ 内容/ 分发/ ,/ 并/ 进一步/ 通过/ 性能/ 检验/ 验证/ 了/ 本文/ 提出/ 的/ 服务/ 封装/ 方法/ 的/ 可行性/ ./ 2/ 相关/ 工作/ 传感/ 流/ 数据/ 的/ 服务化/ 是/ 一种/ 有效/ 解决/ 传感/ 数据/ 资源共享/ 和/ 重用/ 的/ 方法/ ,/ 能够/ 依托/ 互联网/ 提供/ 跨/ 组织/ 共享/ 数据/ 能力/ ,/ 保障/ 数据/ 获取/ 时/ 的/ 安全性/ 和/ 私密性/ ./ 服务/ 需要/ 依托/ 流/ 数据/ 的/ 实时处理/ 来/ 对/ 原始/ 的/ 传感/ 流/ 数据/ 进行/ 加工/ 转换/ ,/ 在/ 流/ 数据/ 实时处理/ 领域/ ,/ 文献/ [/ 8/ -/ 10/ ]/ 采用/ 事件驱动/ 的/ 方式/ 对/ 数据/ 进行/ 抽象/ ./ 本文/ 采用/ 类似/ 的/ 思路/ ,/ 将/ 传感/ 设备/ 产生/ 的/ 数据/ 记录/ 视为/ 传感/ 事件/ ./ 这样/ 一个/ 传感/ 数据流/ 可以/ 视为/ 一个/ 传感/ 事件/ 流/ ,/ 多个/ 传感/ 事件/ 流/ 经过/ 过滤/ 、/ 聚合/ 和/ 关联/ 等/ 加工/ 之后/ 可以/ 生成/ 具有/ 更/ 丰富/ 语义/ 的/ 传感/ 事件/ 流/ ./ 然后/ 本文/ 利用/ 事件/ 订阅/ 系统/ 来/ 实现/ 服务/ 内容/ 的/ 分发/ 过程/ ,/ 将/ 经过/ 加工/ 处理/ 的/ 传感/ 事件/ 流/ 按/ 需分/ 发给/ 不同/ 的/ 订阅/ 请求/ ./ 2.1/ 流/ 数据/ 服务化/ SenseWeb/ [/ 5/ ]/ 允许/ 应用/ 在/ 其/ 提供/ 的/ Web/ 平台/ 上/ 共享/ 和/ 获取/ 传感/ 数据/ ./ GlobalSensorNetworks/ [/ 6/ ]/ 提/ Page3/ 供/ 一个/ 灵活/ 的/ 、/ 能够/ 动态/ 集成/ 和/ 管理/ 不同/ 传感/ 网络/ 数据/ 的/ 中间件/ ./ 文献/ [/ 5/ -/ 6/ ]/ 采用/ 了/ 轮询/ 的/ 方式/ 在/ 互联网/ 上/ 向/ 用户/ 提供数据/ ./ 早期/ 工作/ 均/ 采用/ 集中式/ 的/ 方式/ 实现/ 对流/ 数据/ 的/ 转换/ 、/ 查询/ 能力/ ./ 文献/ [/ 11/ -/ 13/ ]/ 采用/ 了/ 分布式/ 的/ 方式/ 实现/ 对流/ 数据/ 的/ 处理/ ./ 上述/ 工作/ 均/ 采用/ 传统/ 的/ 服务/ 模型/ ,/ 需要/ 创建/ 不同/ 服务/ 来/ 满足/ 流/ 数据共享/ 的/ 不同/ 需求/ ,/ 对/ 这些/ 服务/ 的/ 管理/ 势必会/ 对/ 整个/ 系统/ 造成/ 巨大/ 的/ 负担/ ./ 文献/ [/ 14/ -/ 15/ ]/ 提出/ 了/ “/ WebofThing/ ”/ 的/ 概念/ ,/ 将/ 来自/ 不同/ 物/ 联网/ 中/ 的/ 数据/ 在/ Web/ 之上/ 共享/ ,/ 并/ 提供/ 与/ 其他/ Web/ 服务/ 进行/ 组合/ (/ Mashup/ )/ 的/ 能力/ ./ 文献/ [/ 15/ ]/ 讨论/ 了/ 基于/ Web/ 向/ 用户/ 主动/ 推送/ 消息/ 的/ 几种/ 方式/ ,/ 由于/ 其/ 认为/ 传感/ 设备/ 的/ 采样/ 频率/ 很少/ 超过/ 1Hz/ ,/ 因此/ 采用/ 了/ WebHooks/ 的/ 推送/ 方式/ ./ LiveWeb/ [/ 7/ ]/ 提供/ 了/ 一个/ SensorWeb/ 服务/ 门户网站/ ,/ 允许/ 用户/ 随时/ 对/ 物理/ 世界/ 进行/ 实时/ 查询/ 、/ 监控/ ,/ 并/ 提供/ 离线/ 通知/ 功能/ ./ 文献/ [/ 15/ ]/ 和/ 文献/ [/ 7/ ,/ 16/ ]/ 分别/ 采用/ 了/ 基于/ 主题/ 和/ 基于/ 内容/ 的/ Pub/ // Sub/ 机制/ 实现/ 流/ 数据/ 在/ 不同/ 的/ 用户/ 之间/ 的/ 共享/ ,/ 但/ 不/ 支持/ 对流/ 数据/ 的/ 转换/ 融合/ 以及/ 用户/ 的/ 灵活/ 按/ 需/ 获取/ ,/ 因此/ 更/ 适用/ 于流/ 数据/ 产生/ 速率/ 较慢/ 的/ 情况/ ./ 目前/ 已有/ 部分/ 工作/ 在/ 其/ 传感/ 网络/ [/ 3/ -/ 4/ ]/ 或者/ 基于/ 传感/ 流/ 数据/ 的/ 具体/ 应用/ [/ 17/ -/ 18/ ]/ 中/ 采用/ 了/ 服务化/ 的/ 方式/ 共享/ 和/ 获取/ 传感/ 数据/ ./ 其中/ ,/ 文献/ [/ 4/ ,/ 17/ ]/ 采用/ 了/ 服务器发送/ 事件/ (/ ServerSendEvent/ ,/ SSE/ )/ 技术/ 实现/ 服务端/ 主动/ 推送/ 数据/ ./ 这些/ 工作/ 对外/ 共享/ 其/ 传感/ 数据/ 或者/ 处理/ 传感/ 数据/ 的/ 能力/ ,/ 但/ 第三方/ 应用/ 在/ 获取/ 其/ 传感/ 流/ 数据/ 或者/ 处理/ 能力/ 时/ 需要/ 根据/ 需求/ 对/ 传感/ 数据/ 进一步/ 处理/ 或者/ 对/ 处理/ 能力/ 进行/ 改进/ ./ 2.2/ 事件/ 匹配/ 方法/ 文献/ [/ 19/ ]/ 指出/ Pub/ // Sub/ 机制/ 由于/ 其以/ 数据/ 为/ 中心/ 、/ 多/ 对/ 多/ 的/ 通信/ 模式/ 、/ 动态性/ 及/ 低/ 耦合/ 的/ 特性/ ,/ 非常/ 适用/ 于/ 基于/ 传感/ 网络/ 的/ 应用/ ./ 然而/ 目前/ 在/ 传感/ 网络/ 领域/ 很少/ 有/ 工作/ 涉及/ 事件/ 匹配/ 算法/ ./ 目前/ 基于/ 内容/ 的/ Pub/ // Sub/ 系统/ 中/ 事件/ 匹配/ 算法/ 主要/ 分为/ 3/ 类/ :/ 基于/ 树状/ 结构/ 的/ 算法/ ,/ 基于/ 谓词/ 索引/ 的/ 算法/ ,/ 及/ 基于/ 分布式/ 哈希/ 表/ 的/ 算法/ ./ Gough/ 等/ 人/ [/ 20/ ]/ 提出/ 一种/ 基于/ 搜索/ 树/ 的/ 匹配/ 算法/ ,/ 但是/ 当/ 订阅/ 请求/ 增加/ 或者/ 取消/ 时/ ,/ 该/ 算法/ 难以/ 对/ 搜索/ 树/ 进行/ 修改/ ./ Aguilera/ 等/ 人/ 在/ 文献/ [/ 21/ ]/ 中/ 也/ 通过/ 对/ 匹配/ 树/ 进行/ 遍/ 历来/ 得到/ 所有/ 匹配/ 成功/ 的/ 订阅/ 请求/ ,/ 但是/ 该/ 算法/ 中/ 只能/ 考虑/ 部分/ 重复/ 的/ 谓词/ ./ Silvia/ 等/ 人/ 在/ 文献/ [/ 22/ ]/ 中/ 提出/ 了/ 基于/ R/ -/ tree/ 的/ 匹配/ 方法/ ,/ 将/ 每个/ 订阅/ 请求/ 视为/ 一个/ 范围/ ,/ 并/ 根据/ 订阅/ 请求/ 范围/ 之间/ 的/ 关系/ ,/ 构建/ 一个/ R/ -/ tree/ ./ 文献/ [/ 23/ -/ 24/ ]/ 中/ 同样/ 使用/ 了/ 基于/ R/ -/ tree/ 的/ 匹配/ 算法/ ,/ 主要/ 基于/ 订阅/ 请求/ 的/ 位置/ 约束/ 来/ 构建/ 树/ ./ 本文/ 中/ 的/ 订阅/ 请求/ 结构/ 较为/ 复杂/ ,/ 订阅/ 请求/ 整体/ 之间/ 的/ 关系/ 难以/ 表达/ ,/ 因此/ 不/ 适合/ 采用/ R/ -/ tree/ 的/ 方法/ ./ 文献/ [/ 25/ ]/ 提出/ 了/ 基于/ 谓词/ 索引/ 的/ 内容/ 匹配/ 算法/ ,/ 为/ 所有/ 订阅/ 请求/ 包含/ 的/ 谓词/ 建立/ 一个/ 保存/ 谓词/ 和/ 订阅/ 请求/ 映射/ 关系/ 的/ 表/ ,/ 在/ 匹配/ 时/ 遍历/ 这个/ 表/ 找出/ 满足/ 订阅/ 请求/ 的/ 谓词/ 数目/ ,/ 如果/ 与其/ 包含/ 的/ 谓词/ 数目/ 相同/ ,/ 则/ 说明/ 该/ 订阅/ 请求/ 与/ 事件/ 相匹配/ ./ 在/ 订阅/ 请求/ 包含/ 的/ 谓词/ 数目/ 较少/ 的/ 情况/ 下/ ,/ 文献/ [/ 25/ ]/ 有/ 较/ 高/ 的/ 吞吐量/ 和/ 较/ 低/ 的/ 时间延迟/ ./ 文献/ [/ 26/ -/ 29/ ]/ 在/ 谓词/ 索引/ 的/ 基础/ 上/ 进行/ 了/ 改进/ ,/ 其中/ [/ 28/ ]/ 通过/ 判断/ 事件/ 属性/ 间/ 的/ 重复/ 关系/ 、/ 订阅/ 请求/ 之间/ 的/ 重复/ 和/ 包含/ 关系/ 减少/ 不必要/ 的/ 匹配/ ,/ 能够/ 较/ 快/ 的/ 找到/ 与/ 事件/ 相匹配/ 的/ 订阅/ 请求/ ./ 谓词/ 索引/ 方法/ 避免/ 了/ 相同/ 的/ 谓词/ 被/ 多次/ 验证/ ,/ 但是/ 需要/ 对/ 所有/ 的/ 谓词/ 进行/ 验证/ ./ 基于/ 树状/ 结构/ 和/ 谓词/ 索引/ 的/ 算法/ 大都/ 基于/ 这样/ 的/ 思想/ :/ 对于/ 所有/ 订阅/ 请求/ 中/ 的/ 一些/ 重复/ 的/ 部分/ ,/ 只/ 需要/ 判断/ 一次/ ,/ 并/ 充分利用/ 索引/ 结构/ 来/ 缩短/ 匹配/ 时间/ ./ 基于/ 分布式/ 哈希/ 表/ 的/ 算法/ 将/ 订阅/ 请求/ 和/ 事件/ 分布/ 到/ 不同/ 的/ 哈希/ 区域/ 中/ ,/ 事件/ 仅/ 和/ 同一/ 区域/ 的/ 订阅/ 请求/ 进行/ 匹配/ ./ 文献/ [/ 30/ ]/ 利用/ 哈希/ 树/ 将/ 订阅/ 请求/ 分布/ 到/ 不同/ 的/ bucket/ 中/ ,/ 每个/ 事件/ 只/ 需要/ 对/ 相应/ 的/ bucket/ 的/ 订阅/ 请求/ 进行/ 匹配/ ./ 文献/ [/ 31/ ]/ 将/ 事件/ 和/ 订阅/ 请求/ 按照/ 事件/ 的/ 属性/ 值/ 和/ 订阅/ 请求/ 定义/ 的/ 范围/ 分配/ 到/ 不同/ 的/ 分区/ 中/ ,/ 对/ 不同/ 分区/ 的/ 订阅/ 请求/ 分别/ 进行/ 验证/ ./ 基于/ 分布式/ 哈希/ 表/ 的/ 匹配/ 算法/ 易于/ 实现/ 对/ 大规模/ 的/ 订阅/ 请求/ 进行/ 并行/ 化/ 匹配/ ,/ 可以/ 与/ 基于/ 树状/ 结构/ 或/ 基于/ 谓词/ 索引/ 的/ 算法/ 相结合/ ,/ 更进一步/ 的/ 提高/ 事件/ 匹配/ 的/ 效率/ ./ 2.3/ 流/ 数据/ 实时处理/ 早期/ 的/ 流/ 数据/ 管理系统/ (/ DataStreamManage/ -/ mentSystem/ ,/ DSMS/ )/ 采用/ 集中式/ 架构/ ,/ 包括/ Aurora/ [/ 32/ ]/ ,/ STREAM/ [/ 33/ ]/ ,/ TelegraphCQ/ [/ 34/ ]/ 等/ ./ 显然/ ,/ 一旦/ 负责/ 查询处理/ 的/ 节点/ 资源/ 出现/ 饱和状态/ ,/ 查询处理/ 的/ 速度/ 就/ 会/ 减慢/ ,/ 从而/ 导致/ 查询/ 结果/ 的/ 输出/ 时间延迟/ 变长/ ./ 近年来/ ,/ 分布式/ 的/ 流/ 处理/ 系统/ (/ DistributedStreamProcessingSystem/ )/ ,/ 如/ S4/ [/ 35/ ]/ ,/ Storm/ ①/ ,/ SparkStreaming/ [/ 36/ ]/ 成为/ 主流/ ./ 这些/ 平台/ 都/ 采用/ 分布式/ 架构/ ,/ 处理/ 能力/ 能够/ 随着/ 节点/ 数目/ 的/ 增长/ 而/ 得到/ 扩展/ ./ S4/ 是/ Yahoo/ 开发/ 的/ 分布式/ 、/ 可/ 扩展/ 的/ 、/ 对/ 等/ 的/ 流数/ ①/ Storm/ ,/ http/ :/ // // storm/ ./ apache/ ./ org/ // 2012Page4/ 据/ 处理/ 平台/ ,/ 处理/ 节点/ 间/ 保持/ 相对/ 的/ 独立性/ 、/ 对/ 等/ 性/ 和/ 高/ 并发/ 性/ ,/ 极大/ 的/ 提高/ 系统/ 性能/ ./ S4/ 仅/ 支持/ 部分/ 容错/ ,/ 当/ 数据流/ 速率/ 超过/ 一定/ 界限/ 时/ ,/ 数据处理/ 的/ 错误率/ 会/ 随着/ 速率/ 增加/ ./ Storm/ 是/ Twitter/ 支持/ 开发/ 的/ 一款/ 分布式/ 、/ 开源/ 、/ 实时/ 、/ 主从/ 式/ 的/ 流/ 数据/ 计算/ 系统/ ,/ 采用/ 简单/ 的/ 编程/ 模型/ ,/ 能够/ 保证/ 消息/ 的/ 快速/ 计算/ ,/ 目前/ 不/ 支持/ 数据/ 负载/ 的/ 动态变化/ ./ SparkStreaming/ 是/ Berkeley/ 开源/ 的/ 通用/ 分布式/ 流/ 数据处理/ 平台/ ,/ 引用/ 了/ 微/ 批次/ 的/ 概念/ ,/ 具有/ 高/ 容错性/ ./ SparkStreaming/ 可以/ 与/ Spark/ 框架/ 中/ 的/ 其他/ 项目/ (/ 如/ Spark/ 、/ SparkR/ 、/ MLlib/ 等/ )/ 无缝/ 对接/ ,/ 能够/ 减少/ 单独/ 编写/ 流/ 处理程序/ 和/ 历史/ 数据处理/ 程序/ ./ 3SDaaS/ 服务化/ 封装/ 方法/ 为了/ 方便/ 进一步/ 的/ 细节/ 描述/ ,/ 本/ 节/ 首先/ 参考文献/ [/ 37/ -/ 39/ ]/ 给出/ SDaaS/ 模型/ 的/ 基本/ 定义/ ,/ 然后/ 介绍/ 流/ 数据服务/ 模型/ 和/ 服务化/ 封装/ 方法/ ./ 3.1/ 传感/ 流/ 数据/ 相关/ 概念/ 和/ 定义/ 本文/ 将/ 传感/ 流/ 数据/ 视为/ 由/ 部署/ 在/ 物理/ 世界/ 的/ 传感/ 设备/ 或/ 应用程序/ 产生/ 的/ 、/ 有/ 时间/ 属性/ 的/ 传感/ 数据/ 记录/ 序列/ ./ 定义/ 1/ ./ 传感/ 流/ 数据/ ./ 传感/ 流/ 数据/ 可以/ 被/ 表示/ 为/ S/ =/ {/ d1/ ,/ d2/ ,/ …/ ,/ di/ ,/ …/ }/ ,/ 其中/ 每/ 一条/ 数据/ 记录/ 都/ 具有/ 相同/ 的/ 属性/ 集合/ {/ a1/ ,/ a2/ ,/ …/ ,/ am/ }/ ./ di/ =/ 〈/ vi1/ ,/ vi2/ ,/ …/ ,/ vim/ 〉/ 表示/ 传感/ 流/ 数据/ 的/ 一条/ 数据/ 记录/ ,/ 其中/ ,/ vik/ 表示/ 属性/ ak/ 在/ 记录/ di/ 中所/ 对应/ 的/ 取值/ ./ 图/ 1/ 给出/ 了/ 一个/ 来自/ 某/ 出租车/ 公司/ 的/ 真实/ GPS/ 数据/ 集/ 片段/ ./ GPS/ 数据流/ S/ 的/ 属性/ 集合/ 为/ {/ 车/ id/ ,/ 检测时间/ ,/ 经度/ ,/ 维度/ ,/ 速率/ ,/ 方向/ ,/ 卫星/ 个数/ }/ ,/ 根据/ 定义/ 1/ ,/ 流/ 数据/ 中/ 的/ 数据/ 记录/ 可以/ 表示/ 为/ d1/ =/ {/ 18834/ ,/ 2015/ -/ 04/ -/ 0108/ :/ 00/ :/ 21/ ,/ 121.441895/ ,/ 31.206928/ ,/ 38.5/ ,/ 228.0/ ,/ 7/ }/ ,/ d2/ =/ {/ 27320/ ,/ 2015/ -/ 04/ -/ 0108/ :/ 01/ :/ 21/ ,/ 121.562235/ ,/ 传感/ 流/ 数据/ 每条/ 最新/ 的/ 数据/ 记录/ 都/ 可以/ 视为/ 一个/ 事件/ e/ ,/ 数据/ 消费者/ 可以/ 通过/ 提交/ 订阅/ 请求/ 的/ 方式/ 获取/ 符合/ 其/ 需求/ 的/ 事件/ ./ 定义/ 2/ ./ 事件/ ./ 事件/ 由/ 一组/ 包含/ 属性/ 及其/ 属性/ 值/ 的/ 键值/ 对/ 组成/ ,/ 可以/ 表示/ 为/ 其中/ :/ ai/ 表示/ 属性/ 名/ ;/ vi/ 表示/ 具体/ 的/ 属性/ 值/ ./ 传感/ 流/ 数据/ S/ 的/ 每条/ 数据/ 记录/ di/ =/ 〈/ vi1/ ,/ vi2/ ,/ …/ ,/ vim/ 〉/ 可以/ 对应/ 一个/ 更新/ 事件/ ei/ =/ {/ 〈/ ai1/ ,/ vi1/ 〉/ ,/ 〈/ ai2/ ,/ vi2/ 〉/ ,/ …/ ,/ 〈/ aim/ ,/ vim/ 〉/ }/ ./ 比如/ 来自/ 出租车/ 公司/ 的/ GPS/ 传感/ 流/ 数据/ 所/ 产生/ 的/ 事件/ 可以/ 由/ {/ 〈/ id/ ,/ 18834/ 〉/ ,/ 〈/ longitude/ ,/ 121.441895/ 〉/ ,/ 〈/ latitude/ ,/ 31.206928/ 〉/ ,/ 〈/ direction/ ,/ 228.0/ 〉/ ,/ 〈/ speed/ ,/ 38.50/ 〉/ ,/ 〈/ siteNum/ ,/ 7/ 〉/ ,/ 〈/ time/ ,/ 2015/ -/ 04/ -/ 0108/ :/ 00/ :/ 21/ 〉/ }/ 表示/ ./ 定义/ 3/ ./ 事件/ 约束/ ./ 事件/ 约束/ constraints/ 表示/ 事件/ e/ 的/ 值域/ ,/ 由/ 其/ 包含/ 的/ 属性/ 可能/ 存在/ 的/ 取值/ 范围/ 组成/ ,/ 可以/ 表示/ 为/ 其中/ :/ ai/ 是/ 事件/ 所/ 包含/ 的/ 属性/ ;/ 属性/ 约束/ cai/ 表示/ 属性/ ai/ 所能/ 取值/ 的/ 范围/ ./ 如/ GPS/ 传感/ 流/ 数据/ 所/ 产生/ 的/ 事件/ 中/ 的/ 车速/ 属性/ 取值/ 一定/ 大于/ 0/ ,/ 该/ 事件/ 中/ 存在/ 一个/ 属性/ 约束/ cspeed/ =/ (/ speed/ >/ 0/ )/ ./ 显然/ 一个/ 事件/ 流中/ 所有/ 事件/ 的/ 格式/ 相同/ ,/ 因此/ 一个/ 事件/ 流/ 的/ 事件/ 约束/ 即/ 这个/ 事件/ 流中/ 每个/ 事件/ 的/ 约束/ ./ 定义/ 4/ ./ 操作/ 算子/ ./ 对/ 传感/ 流/ 数据/ 的/ 操作/ 算子/ op/ 可以/ 表示/ 为/ 一个/ 四元组/ :/ op/ =/ 〈/ name/ ,/ func/ ,/ in/ _/ events/ ,/ out/ _/ event/ 〉/ ,/ 其中/ :/ 集合/ ;/ 事件/ 流/ ./ (/ 1/ )/ name/ 表示/ 操作/ 算子/ 的/ 名称/ ;/ (/ 2/ )/ func/ 描述/ 具体/ 的/ 操作/ 逻辑/ ;/ (/ 3/ )/ in/ _/ events/ 表示/ 操作/ 算子/ 作用/ 的/ 事件/ 流/ 对象/ (/ 4/ )/ out/ _/ event/ 表示/ 经过/ 操作/ 转换/ 之后/ 所/ 生成/ 的/ 数据/ 消费者/ 可以/ 通过/ 提交/ 订阅/ 请求/ 的/ 方式/ 来/ 定义/ 对/ 传感/ 流/ 数据/ 的/ 内容/ 需求/ ./ 定义/ 5/ ./ 订阅/ 请求/ ./ 订阅/ 请求/ r/ 可以/ 由/ k/ (/ k/ / 1/ )/ 个/ 谓词/ pi/ 通过/ 逻辑/ 运算符/ “/ ∧/ ”/ 或/ “/ ∨/ ”/ 连接/ 而成/ 的/ 合取/ 或/ 析取范式/ 来/ 表示/ ,/ r/ 可以/ 等值/ 演算/ 为/ 由/ 有限/ 个/ 合取/ 式/ 所/ 组成/ 的/ 析取/ 式/ ,/ 记/ 作/ :/ Page5/ 如/ 应用/ 可以/ 通过/ 提交/ 订阅/ 请求/ :/ (/ 〈/ speed/ ,/ >/ ,/ 10/ 〉/ ∨/ 〈/ speed/ ,/ </ ,/ 60/ 〉/ )/ 其中/ ,/ 谓词/ pij/ 可以/ 定义/ 为/ 一个/ 三元组/ :/ 其中/ :/ aij/ 是/ 属性/ 名/ ;/ 关系/ 运算符/ roij/ ∈/ {/ </ ,/ / ,/ >/ ,/ / ,/ =/ ,/ ≠/ }/ ;/ vij/ 是/ 对应/ 属性/ aij/ 的/ 属性/ 值/ ,/ 谓词/ 的/ 定义/ 一定/ 在/ 事件/ 约束/ 的/ 范围/ 之内/ ./ r1/ =/ 〈/ vid/ ,/ =/ ,/ 京/ B34C91/ 〉/ ;/ r2/ =/ 〈/ longitude/ ,/ </ ,/ 126.89/ 〉/ ∧/ 〈/ longitude/ ,/ >/ ,/ 116.29/ 〉/ ∧/ 来/ 获取/ 相应/ 的/ 传感/ 数据/ ./ 其中/ ,/ 订阅/ 请求/ r2/ 可以/ 转换/ 为/ 一个/ 析取范式/ :/ r2/ =/ (/ 〈/ longitude/ ,/ </ ,/ 126.89/ 〉/ ∧/ 〈/ longitude/ ,/ >/ ,/ 116.29/ 〉/ ∧/ 〈/ speed/ ,/ >/ ,/ 10/ 〉/ )/ ∨/ (/ 〈/ longitude/ ,/ </ ,/ 126.89/ 〉/ ∧/ 〈/ longitude/ ,/ >/ ,/ 116.29/ 〉/ ∧/ 〈/ speed/ ,/ >/ ,/ 10/ 〉/ )/ ./ 定义/ 6/ ./ 事件/ 和/ 订阅/ 请求/ 的/ 匹配/ ./ 给定/ 事件/ e/ 和/ 订阅/ 请求/ r/ ,/ 事件/ 需要/ r/ 中/ 的/ 所有/ 谓词/ pi/ =/ 〈/ ai/ ,/ roi/ ,/ vi/ 〉/ ∈/ r/ 进行/ 验证/ 匹配/ ,/ 其中/ 对于/ 任意/ 的/ 谓词/ pi/ ,/ 当/ e/ 包含/ 键值/ 对/ 〈/ a/ ,/ v/ 〉/ ,/ 并且/ (/ a/ =/ ai/ )/ ∧/ (/ vroivi/ )/ 时/ ,/ e/ 与/ 谓词/ pi/ 相匹配/ ,/ 记/ 作/ :/ 将/ r/ 所有/ 谓词/ 的/ 匹配/ 结果/ 按照/ 定义/ 5/ 进行/ 逻辑/ 计算/ ,/ 当/ 计算结果/ 为/ 真时/ ,/ 事件/ 与/ 订阅/ 请求/ 相匹配/ ,/ 记/ 作/ :/ 例如/ ,/ 事件/ 中/ 的/ 属性/ 键值/ 对/ 〈/ speed/ ,/ 62/ 〉/ 与/ 谓词/ 〈/ speed/ ,/ >/ ,/ 60/ 〉/ 相匹配/ ,/ 因为/ 62/ >/ 60/ ;/ 事件/ {/ 〈/ id/ ,/ 18834/ 〉/ ,/ 〈/ longitude/ ,/ 121.441895/ 〉/ ,/ 〈/ latitude/ ,/ 31.206928/ 〉/ ,/ 〈/ direction/ ,/ 228.0/ 〉/ ,/ 〈/ speed/ ,/ 38.5/ 〉/ ,/ 〈/ siteNum/ ,/ 7/ 〉/ ,/ 〈/ time/ ,/ 2015/ -/ 04/ -/ 0108/ :/ 00/ :/ 21/ 〉/ }/ 与/ 订阅/ 请求/ r2/ 相匹配/ ./ 3.2/ 流/ 数据服务/ 模型/ 原始/ 传感/ 流/ 数据/ 除了/ 安全性/ 和/ 私密性/ 的/ 问题/ ,/ 还/ 存在/ 着/ 价值/ 密度/ 较/ 低/ 的/ 问题/ ./ 因此/ 我们/ 对/ 原始/ 的/ 传感/ 流/ 数据/ 进行/ 转换/ 、/ 以/ 服务/ 的/ 方式/ 共享/ 更/ 具有/ 价值/ 的/ 流/ 数据/ ./ 为了/ 更好/ 的/ 为/ 应用/ 所/ 重用/ ,/ 流/ 数据服务/ 能够/ 响应/ 不同/ 订阅/ 请求/ ,/ 仅/ 向/ 应用/ 分发/ 其所/ 需/ 的/ 事件/ ./ 本文/ 借鉴/ 前期/ 数据服务/ 模型/ [/ 40/ ]/ 和/ 基于/ 内容/ 的/ Pub/ // Sub/ 机制/ ,/ 对流/ 数据服务/ 进行/ 定义/ ./ 流/ 数据服务/ 相当于/ 部署/ 在/ 流/ 数据源/ 和/ 业务/ 应用/ 系统/ 之间/ 的/ 具有/ 处理/ 能力/ 、/ 可/ 配置/ 的/ “/ 软/ 传感器/ ”/ ,/ 能够/ 灵活/ 响应/ 不同/ 的/ 应用/ 需求/ ./ 定义/ 7/ ./ 流/ 数据服务/ ./ 一个/ 流/ 数据服务/ 是/ 一个/ 传感/ 流/ 数据/ 资源/ 的/ 统一/ 抽象/ 表示/ ,/ 从/ 构成/ 角度/ ,/ 一个/ 流/ 数据服务/ 可以/ 表示/ 为/ 一个多元/ 组/ :/ sds/ =/ {/ uri/ ,/ in/ _/ events/ ,/ ops/ ,/ out/ _/ event/ ,/ constraints/ ,/ rs/ ,/ disLogic/ }/ ,/ 其中/ :/ (/ 1/ )/ uri/ 是/ 服务/ 创建者/ 用来/ 描述/ 其流/ 数据服务/ 的/ 唯一/ 标示/ ,/ 服务/ 消费者/ 可以/ 使用/ HTTP/ 标准/ 方法/ 访问/ 该/ uri/ 来/ 获取数据/ ;/ (/ 2/ )/ in/ _/ events/ 表示/ 服务/ 所/ 接入/ 事件/ 流/ ,/ 事件/ 可以/ 来自/ 于/ 原始/ 传感/ 流/ 数据/ ,/ 也/ 可以/ 来自/ 于/ 其它/ 的/ 流/ 数据服务/ ;/ 逻辑/ 转换/ 之后/ 所/ 形成/ 的/ 事件/ 流/ ;/ 一组/ 由/ 操作/ 算子/ 组成/ 的/ 操作/ 逻辑/ ;/ (/ 3/ )/ ops/ 表示/ 服务/ 创建者/ 定义/ 在/ in/ _/ events/ 上/ 的/ (/ 4/ )/ out/ _/ event/ 表示/ in/ _/ events/ 在/ 经过/ ops/ 操作/ (/ 5/ )/ constraints/ 表示/ out/ _/ event/ 的/ 事件/ 约束/ ,/ 服务/ 消费者/ 定义/ 在/ 该/ 服务/ 上/ 的/ 订阅/ 请求/ 必须/ 符合/ 该/ 约束条件/ ;/ (/ 6/ )/ rs/ 表示/ 定义/ 在/ 流/ 数据服务/ 之上/ 的/ 订阅/ 请求/ ;/ (/ 7/ )/ disLogic/ 分发/ 逻辑/ 决定/ 流/ 数据服务/ 输出/ 的/ 事件/ 向/ 哪些/ 数据/ 消费者/ 进行/ 分发/ ./ 在/ 一个/ 流/ 数据服务/ 中/ ,/ in/ _/ events/ ,/ ops/ ,/ out/ _/ event/ 元素/ 面向/ 服务/ 创建者/ ,/ constraints/ ,/ rs/ 元素/ 面向/ 服务/ 消费者/ ./ 流/ 数据服务/ 接入/ 、/ 输出/ ,/ 及/ 通过/ 操作/ 算子/ 所/ 产生/ 的/ 中间/ 事件/ 都/ 按照/ 定义/ 2/ 所示/ 的/ 格式/ ./ 流/ 数据服务/ 对/ 数据/ 转换/ 融合/ 的/ 实时性/ 要求/ 较/ 高/ ,/ 需要/ 及时/ 的/ 输出/ 新/ 的/ 流/ 数据/ ,/ 在/ 创建/ 过程/ 中/ 选择/ 以/ 事件驱动/ 的/ 方式/ 接入/ 、/ 转换/ 、/ 输出/ 流/ 数据/ ./ 当/ 接收/ 到/ 来自/ 流/ 数据源/ 的/ 数据/ 后/ ,/ 主动/ 将/ 数据/ 以/ 事件/ 的/ 方式/ 发送到/ 相应/ 的/ 操作/ 算子/ ,/ 最终/ 得到/ 输出/ 结果/ ./ 3.3/ 服务化/ 封装/ 流/ 数据/ 的/ 共享/ 和/ 重用/ 问题/ 可以/ 映射/ 为/ 用户/ 订阅/ 请求/ 和/ 流/ 数据服务/ 所/ 输出/ 数据/ 的/ 适配/ 问题/ ./ 图/ 2/ 展示/ 了/ 传感/ 流/ 数据共享/ 和/ 重用/ 的/ 服务化/ 封装/ 的/ 总体/ 框架图/ ./ 从/ 体系结构/ 上/ 看/ ,/ 传感/ 流/ 数据/ 的/ 服务化/ 封装/ 主要/ 由/ 3/ 个/ 部分/ 组成/ :/ 服务/ 代理/ 、/ 事件/ 的/ 分发/ 逻辑/ 以及/ Page6/ 所有/ 在/ 服务/ 代理/ 上/ 注册/ 的/ 流/ 数据服务/ 及/ 用户/ 的/ 状态/ 信息/ ./ 服务/ 代理/ 负责管理/ 流/ 数据服务/ 的/ 创建/ 和/ 事件/ 分发/ 的/ 整个/ 过程/ ,/ 是/ 传感/ 流/ 数据/ 服务化/ 封装/ 中/ 的/ 核心/ ./ 事件/ 分发/ 逻辑/ 是/ 把/ 流/ 数据服务/ 产生/ 的/ 事件/ 分发/ 到/ 事件/ 目的地/ (/ 用户/ )/ 时所/ 使用/ 的/ 策略/ ./ 服务/ 状态/ 提供/ 所有/ 流/ 数据服务/ 的/ 实时/ 运行/ 状态/ 和/ 服务/ 元/ 数据/ ,/ 以及/ 与/ 服务/ 对应/ 的/ 用户/ 订阅/ 状态/ 和/ 元/ 数据/ ./ 基于/ 图/ 2/ 所示/ 的/ 结构/ ,/ 图/ 3/ 展示/ 了/ 传感/ 流/ 数据/ 服务化/ 封装/ 的/ 实例/ ./ 为了/ 实现/ 对/ 传感/ 流/ 数据/ 实时/ 、/ 按图/ 3/ 传感/ 流/ 数据/ 服务化/ 封装/ 实例/ 服务/ 创建者/ 通过/ 在/ 服务/ 代理/ 上/ 创建/ 并/ 注册/ 流数/ 3.3/ ./ 1/ 流/ 数据服务/ 管理/ 过程/ 据/ 服务/ 的/ 方式/ 来/ 共享/ 和/ 重用/ 传感/ 流/ 数据/ ./ 原始/ 的/ 传感/ 流/ 数据/ 具有/ 数据/ 规模/ 大/ ,/ 价值/ 密度/ 低/ 的/ 问题/ ,/ 服务/ 创建者/ 可以/ 将/ 其/ 拥有/ 的/ 传感/ 流/ 数据/ 根据/ 需求/ 配置/ 相应/ 的/ 处理/ 逻辑/ ,/ 将/ 其/ 转换/ 为/ 一个/ 新/ 的/ 数据流/ ,/ 并/ 根据/ 输出/ 事件/ 流/ 形成/ 事件/ 约束/ ./ 与此同时/ ,/ 服务/ 创建者/ 还/ 可以/ 选择/ 来自/ 其它/ 服务/ 的/ 流/ 数据/ 来/ 创建/ 流/ 数据服务/ ./ 如/ ANPR/ 数据/ 的/ 拥有者/ 可以/ 将/ 原始/ 的/ ANPR/ 数据/ 进行/ 聚集/ 操作/ (/ count/ )/ 将/ 其/ 转换/ 为/ 车流量/ 数据/ TrafficFlow/ ,/ 创建/ 流/ 数据服务/ 犵/ 犲/ 狀/ -/ 犜/ 狉/ 犪/ 犳/ 犳/ 犻/ 犮/ 犉/ 犾/ 狅/ 狑/ ./ 其中/ ,/ ANPR/ 数据/ 中/ 的/ 一条/ 数据/ 记录/ 可以/ 表示/ 为/ d1/ =/ {/ CAM3913/ ,/ 京/ K36452/ ,/ 2015/ -/ 04/ -/ 0108/ :/ 30/ :/ 56/ }/ ,/ 其/ 产生/ 的/ 事件/ 具有/ 属性/ 集/ {/ cid/ ,/ vid/ ,/ time/ }/ 和/ 事件/ 约束/ constraints/ =/ {/ 〈/ cid/ =/ / 〉/ ,/ 〈/ vid/ =/ / 〉/ ,/ 〈/ time/ >/ 2010/ // 01/ // 0100/ :/ 00/ :/ 00/ 〉/ }/ ,/ 表示/ ANPR/ 数据/ 的/ 时间/ 范围/ 为/ 2010/ 年/ 以后/ ./ Traffic/ -/ 需/ 的/ 共享/ 和/ 重用/ ,/ 本文/ 的/ 服务化/ 封装/ 方法/ 需要/ 对流/ 数据服务/ 和/ 订阅/ 请求/ 进行/ 管理/ ./ 其中/ ,/ 流/ 数据服务/ 管理/ 允许/ 数据/ 提供者/ (/ 服务/ 创建者/ )/ 对/ 传感/ 流/ 数据源/ 进行/ 转换/ 、/ 融合/ ,/ 将/ 新/ 的/ 、/ 可/ 公开/ 的/ 流/ 数据/ 以/ 服务/ 的/ 方式/ 公布/ 给/ 外界/ ./ 订阅/ 请求/ 管理/ 在/ 流/ 数据服务/ 的/ 基础/ 上/ 进一步/ 支持/ 数据/ 消费者/ (/ 服务/ 消费者/ )/ 按/ 需/ 的/ 共享/ 和/ 重用/ 流/ 数据服务/ 所/ 提供/ 的/ 数据/ ,/ 流/ 数据服务/ 能够/ 同时/ 响应/ 来自/ 不同/ 数据/ 消费者/ 的/ 订阅/ 请求/ ./ Flow/ 数据/ 的/ 事件/ 具有/ 属性/ 集合/ {/ cid/ ,/ flow/ ,/ time/ }/ 和/ 事件/ 约束/ constraints/ =/ {/ 〈/ cid/ =/ / 〉/ ,/ 〈/ flow/ >/ 0/ 〉/ ,/ 〈/ time/ >/ 2010/ // 01/ // 0100/ :/ 00/ :/ 00/ 〉/ }/ ,/ 表示/ 车流量/ 必须/ 大于/ 0/ ,/ 时间/ 范围/ 是/ 2010/ 年/ 以后/ ./ 相/ 比较/ 于/ ANPR/ 数据/ ,/ 车流量/ 数据/ 更/ 具有/ 价值/ 意义/ ./ 又/ 如/ 服务/ 创建者/ 可以/ 选择/ 不同/ 来源/ 的/ GPS/ 数据/ 作为/ 原始/ 传感/ 流/ 数据/ ,/ 对/ 其/ 进行/ 融合/ (/ merge/ )/ 处理/ ,/ 转换/ 为/ 一个/ 更/ 完整/ 的/ GPS/ 数据流/ ,/ 创建/ 流/ 数据服务/ 犻/ 狀/ 狋/ 犲/ 犌/ 犘/ 犛/ ./ 原始/ 的/ GPS/ 数据/ (/ 如图/ 1/ 所示/ )/ 和/ 转换/ 后/ 的/ GPS/ 数据/ 具有/ 相同/ 的/ 属性/ 集合/ 和/ 事件/ 约束/ constraints/ =/ {/ 〈/ vid/ =/ / 〉/ ,/ 〈/ 115.25/ </ longitude/ </ 117.30/ 〉/ ,/ 〈/ 39.26/ </ latitude/ </ 41.03/ 〉/ ,/ 〈/ speed/ >/ 0/ 〉/ ,/ 〈/ time/ >/ 2010/ // 01/ // 0100/ :/ 00/ :/ 00/ 〉/ }/ ,/ 表示/ GPS/ 事件/ 的/ 属性/ 值中/ ,/ 地理位置/ 在/ 北京市/ ,/ 速率/ 必须/ 大于/ 0/ ,/ 时间/ 范围/ 在/ 2010/ 年/ 以后/ ./ 一般/ 情况/ 下/ ,/ 服务/ 创建者/ 还/ 需要/ 自定义/ 操作/ 或者/ 算法/ ,/ 以/ 对流/ 数据源/ 进行/ 更/ 复杂/ 的/ 数据处理/ 或/ 融合/ ./ 如/ 本文/ 所在/ 团队/ 的/ 其他/ 工作/ [/ 41/ ]/ 中/ 实现/ 对/ ANPRPage7/ 数据/ 的/ 实时/ 分析/ ,/ 将/ ANPR/ 数据/ 转换/ 为/ 一个/ 包含/ 伴随/ 车组/ 信息/ 的/ 流/ 数据/ ./ 对于/ 车辆/ 追踪/ 、/ 实时/ 拼车/ 等/ 应用/ 都/ 更/ 具有/ 价值/ 意义/ ./ 在/ 流/ 数据服务/ 创建/ 过程/ 中/ ,/ 对/ 原始/ 的/ 传感/ 流/ 数据/ 的/ 处理/ 逻辑/ 是/ 基于/ 事件驱动/ 的/ ,/ 不需/ 事先/ 将/ 数据/ 存储/ 起来/ ,/ 因此/ 流/ 数据服务/ 所/ 接入/ 和/ 输出/ 的/ 数据/ 是/ 持续/ 不断/ 的/ ./ 基于/ 分布式/ 流/ 数据处理/ 平台/ ,/ 流/ 数据服务/ 对/ 原始/ 流/ 数据/ 的/ 处理/ 具有/ 高可用性/ 和/ 可伸缩性/ ,/ 能够/ 满足/ 流/ 数据/ 实时处理/ 的/ 需求/ [/ 42/ ]/ ./ 3.3/ ./ 2/ 订阅/ 请求/ 管理/ 过程/ 数据/ 消费者/ 可以/ 通过/ 向/ 指定/ 流/ 数据服务/ 提交/ 订阅/ 请求/ 的/ 方式/ 获取/ 传感/ 数据/ ./ 只要/ 数据/ 消费者/ 的/ 订阅/ 请求/ 符合/ 服务/ 输出/ 的/ 事件/ 约束/ ,/ 数据/ 消费者/ 便/ 可以/ 获得/ 其所/ 需/ 的/ 数据/ ,/ 而/ 无需/ 创建/ 专门/ 的/ 流/ 数据服务/ 或者/ 自行处理/ 原始/ 的/ 传感/ 流/ 数据/ ./ 面对/ 流/ 数据服务/ 所/ 产生/ 的/ 持续/ 不断/ 的/ 事件/ 以及/ 应用/ 不同/ 的/ 订阅/ 请求/ ,/ 流/ 数据服务/ 需要/ 一个/ 分发/ 逻辑/ —/ —/ —/ 即/ 事件/ 匹配/ 方法/ ,/ 负责/ 找到/ 与/ 当前/ 事件/ 相匹配/ 的/ 所有/ 订阅/ 请求/ ,/ 将/ 事件/ 分/ 发给/ 相应/ 订阅/ 请求/ ./ 在/ 图/ 3/ 的/ 例子/ 中/ ,/ 数据/ 消费者/ 想要/ 获取/ 指定/ 需求/ 的/ GPS/ 车辆/ 数据/ ,/ 首先/ 找到/ 流/ 数据服务/ 犻/ 狀/ 狋/ 犲/ 犌/ 犘/ 犛/ 并/ 得到/ 订阅/ 请求/ 需要/ 遵循/ 的/ 服务/ 约束/ ,/ 即/ 服务/ 输出/ 事件/ 的/ 事件/ 约束/ constraints/ =/ {/ 〈/ vid/ =/ / 〉/ ,/ 〈/ 115.25/ </ longitude/ </ 117.30/ 〉/ ,/ 〈/ 39.26/ </ latitude/ </ 41.03/ 〉/ ,/ 〈/ speed/ >/ 0/ 〉/ ,/ 〈/ time/ >/ 2010/ // 01/ // 0100/ :/ 00/ :/ 00/ 〉/ }/ ./ 遵循/ 服务/ 约束/ ,/ 数据/ 消费者/ 向流/ 数据服务/ 提交/ 订阅/ 请求/ ;/ 服务/ 将/ 按照/ 分发/ 逻辑/ 将/ 其/ 产生/ 的/ 每个/ 事件/ 分/ 发给/ 相应/ 的/ 订阅/ 请求/ ./ 例如/ :/ 假设/ 数据/ 消费者/ 提交/ 了/ 订阅/ 请求/ r2/ =/ {/ 〈/ longitude/ ,/ >/ ,/ 130/ 〉/ ,/ 〈/ latitude/ ,/ >/ ,/ 32/ 〉/ ,/ 〈/ speed/ ,/ </ ,/ 50/ 〉/ }/ 和/ r3/ =/ {/ 〈/ longitude/ ,/ >/ ,/ 130/ 〉/ ,/ 〈/ latitude/ ,/ >/ ,/ 34/ 〉/ ,/ 〈/ speed/ ,/ >/ ,/ 55/ 〉/ }/ 来说/ ,/ 对于/ 服务/ 犻/ 狀/ 狋/ 犲/ 犌/ 犘/ 犛/ 产生/ 的/ 事件/ e1/ =/ {/ 〈/ vid/ ,/ 京/ A57C23/ 〉/ ,/ 〈/ longitude/ ,/ 134.2/ 〉/ ,/ 〈/ latitude/ ,/ 36.41/ 〉/ ,/ 〈/ speed/ ,/ 56.0/ 〉/ }/ 和/ e2/ =/ {/ 〈/ vid/ ,/ 京/ B34A12/ 〉/ ,/ 〈/ longitude/ ,/ 151.4/ 〉/ ,/ 〈/ latitude/ ,/ 34.06/ 〉/ ,/ 〈/ speed/ ,/ 35.0/ 〉/ }/ 来说/ ,/ 事件/ e1/ 仅/ 发送到/ r3/ ,/ 事件/ e2/ 仅/ 发送到/ r2/ ./ 高效/ 的/ 事件/ 匹配/ 算法/ 是/ 保证数据/ 消费者/ 能够/ 实时/ 获取/ 所/ 需/ 数据/ 的/ 关键/ 之一/ ./ 一种/ 简单/ 的/ 事件/ 匹配/ 方法/ 是/ 将/ 事件/ 与/ 所有/ 的/ 订阅/ 请求/ 分别/ 进行/ 验证/ ./ 这种/ 方法/ 的/ 执行/ 时间/ 会/ 随着/ 订阅/ 请求/ 的/ 增加/ 而/ 线性/ 增长/ ,/ 并/ 不/ 适合/ 于/ 多流/ 数据/ 来源/ 及/ 多/ 应用/ 请求/ 的/ 场景/ ./ 当/ 订阅/ 请求/ 的/ 数量/ 较多时/ ,/ 组成/ 订阅/ 请求/ 的/ 各/ 谓词/ 之间/ 可能/ 存在/ 着/ 大量/ 相等/ 或者/ 包含/ 关系/ ,/ 本文/ 中/ 的/ 分发/ 逻辑/ 通过/ 考虑/ 不同/ 订阅/ 请求/ 之间/ 的/ 关系/ ,/ 来/ 减少/ 谓词/ 匹配/ 的/ 数目/ ,/ 以/ 提高/ 事件/ 匹配/ 的/ 效率/ ./ 如/ 订阅/ 请求/ r2/ 和/ r3/ 中/ 相同/ 的/ 谓词/ (/ longitude/ >/ 130/ )/ 仅/ 需要/ 匹配/ 一次/ ,/ 具有/ 包含/ 关系/ 的/ 谓词/ (/ latitude/ >/ 32/ 与/ latitude/ >/ 34/ )/ ,/ 存在/ (/ / e/ ∝/ (/ latitude/ >/ 32/ )/ →/ / e/ ∝/ (/ latitude/ >/ 34/ )/ )/ ∨/ (/ e/ ∝/ (/ latitude/ >/ 34/ )/ →/ e/ ∝/ (/ latitude/ >/ 32/ )/ )/ ./ 在/ 事件/ 向/ 数据/ 消费者/ 发送/ 时/ ,/ 可以/ 选择/ 三种/ 传输/ 模式/ :/ 轮询/ 、/ 长/ 连接/ 和/ 主动/ 连接/ 方式/ ./ 其中/ 轮询/ 模式/ 属于/ 被动/ 拉取/ 的/ 模式/ ,/ 相当于/ 传统/ 数据服务/ 的/ 轮询/ 方式/ 实现/ ;/ 长/ 连接/ 和/ 主动/ 连接/ 的/ 方式/ 属于/ 主动/ 推送/ 的/ 模式/ ./ 长/ 连接/ 模式/ 主要/ 基于/ 由/ 客户端/ 向/ 服务器端/ 建立/ 的/ 长/ 连接/ :/ 数据/ 消费者/ 通过/ 建立/ 一个/ 长/ 连接/ 向流/ 数据服务/ 提交/ 订阅/ 请求/ ,/ 流/ 数据服务/ 在/ 该长/ 连接/ 之上/ 将/ 符合/ 订阅/ 请求/ 的/ 事件/ 持续/ 的/ 发送给/ 数据/ 消费者/ ./ 主动/ 连接/ 传输/ 模式/ 更为/ 灵活/ :/ 数据/ 消费者/ 通过/ 短/ 连接/ 向流/ 数据服务/ 提交/ 或者/ 取消/ 其/ 订阅/ 请求/ ;/ 每当/ 事件/ 符合/ 订阅/ 请求/ 时/ ,/ 流/ 数据服务/ 主动/ 向/ 相应/ 数据/ 消费者/ 建起/ 连接/ 并/ 发送数据/ ./ 相/ 比较而言/ ,/ 主动/ 推送/ 方式/ 获取数据/ 的/ 效率/ 更高/ ./ 其中/ ,/ 长/ 连接/ 方式/ 对于/ 每个/ 订阅/ 请求/ 都/ 需要/ 维护/ 一个/ 长/ 连接/ ,/ 流/ 数据服务/ 支持/ 的/ 订阅/ 请求/ 数目/ 受到/ 系统/ 本身/ 的/ 限制/ [/ 43/ ]/ ./ 主动/ 连接/ 方式/ 不会/ 出现/ 连接/ 资源/ 浪费/ 以及/ 连接/ 限制/ 的/ 情况/ ,/ 然而/ 由于/ 连接/ 的/ 重复/ 建立/ ,/ 并/ 不适/ 用于/ 数据/ 发送/ 频率/ 较/ 高/ 的/ 场景/ ./ 由于/ 本文/ 目前/ 侧重于/ 支持/ 大规模/ 流/ 数据/ 的/ 实时/ 共享/ ,/ 因此/ 暂时/ 采用/ 了/ 基于/ 长/ 连接/ 的/ 传输方式/ ,/ 在/ 后续/ 研究/ 中/ ,/ 我们/ 将/ 界定/ 不同/ 方式/ 的/ 适用范围/ ,/ 灵活/ 选用/ 传感/ 数据/ 的/ 传输方式/ ./ 4SDaaS/ 实现/ 4.1/ 流/ 数据/ 融合/ 操作/ 本文/ 当前/ 实现/ 的/ 操作/ 算子/ 主要/ 包含/ 3/ 类/ :/ 针对/ 单个/ 流/ 数据源/ 的/ 转换/ 算子/ 、/ 基于/ 滑动/ 窗口/ 的/ 聚集/ 算子/ 以及/ 针对/ 多/ 源流/ 数据/ 的/ 融合/ 算子/ ./ 在/ 当前/ 实现/ 中/ ,/ 针对/ 接入/ 的/ 传感/ 流/ 数据源/ 可能/ 出现/ 数据/ 规模/ 较大/ 的/ 情况/ ,/ 操作/ 算子/ 被/ 映射/ 为/ 一个/ 或/ 多个/ SparkStreaming/ 方法/ ,/ 利用/ SparkStreaming/ 并行/ 框架/ 实现/ ./ 表/ 1/ 展示/ 了/ 流/ 数据服务/ 的/ 建模/ 操作/ 算子/ 及其/ 对应/ 的/ 部分/ SparkStreaming/ 方法/ ./ (/ 1/ )/ 转换/ 算子/ 过滤/ ./ 过滤/ 操作/ 可以/ 仅/ 输出/ 符合/ 相关/ 条件/ 的/ 事件/ ./ 过滤/ 操作/ 可以/ 表示/ 为/ Page8/ 表/ 1/ 流/ 数据服务/ 的/ 操作/ 算子/ 及/ 对应/ SparkStreaming/ 方法/ 类型/ 算子/ 转换/ 算子/ incrAggregatorreduceByWindow/ (/ fun/ (/ )/ ,/ wL/ ,/ sI/ )/ 聚集/ 算子/ 融合/ 算子/ 其中/ :/ a/ 为/ 事件/ 所/ 包含/ 的/ 属性/ ;/ ro/ ∈/ {/ </ ,/ >/ ,/ =/ ,/ ≠/ ,/ / ,/ / }/ 是/ 关系/ 运算符/ ;/ v/ 为/ 具体/ 的/ 属性/ 值/ ./ 经过/ 过滤/ 操作/ 转换/ 所得/ 的/ 流/ 数据/ 与/ 原始/ 的/ 流/ 数据/ 具有/ 相同/ 的/ 属性/ 集合/ ./ 性及/ 值/ 映射/ 新/ 的/ 数据流/ ,/ 可以/ 表示/ 为/ 投影/ ./ 投影/ 操作/ 可以/ 选择/ 输入/ 流/ 数据/ 的/ 若干/ 属/ 其中/ :/ A/ 为/ 从/ 原始/ 流/ 数据/ 中/ 选择/ 的/ 属性/ 集合/ ;/ A/ 为/ 新/ 指定/ 的/ 属性/ 集合/ ;/ M/ =/ {/ 〈/ a1/ ,/ a1/ 〉/ ,/ 〈/ a2/ ,/ a2/ 〉/ ,/ …/ ,/ 〈/ ak/ ,/ ak/ 〉/ }/ 是/ 新旧/ 属性/ 集合/ 的/ 映射/ 关系/ ,/ V/ =/ {/ 〈/ ai/ ,/ vi/ 〉/ }/ 在/ A/ 中/ 包含/ 原始/ 流/ 数据/ 属性/ 集合/ 以外/ 的/ 属性/ 时/ 指定/ 相应/ 的/ 默认/ 属性/ 值/ ./ 经过/ 投影/ 操作/ 转换/ 所/ 得到/ 的/ 流/ 数据/ 具有/ 新/ 的/ 属性/ 集合/ A/ ./ 排序/ ./ 排序/ 操作/ 可以/ 对/ 指定/ 窗口/ 内/ 的/ 事件/ 按照/ 指定/ 属性/ 值/ 进行/ 排序/ ,/ 可以/ 表示/ 为/ 其中/ :/ a/ 为/ 输入/ 事件/ 所/ 包含/ 的/ 属性/ ;/ o/ ∈/ {/ asce/ ,/ desc/ }/ 用来/ 指定/ 排序/ 的/ 方式/ 是/ 降序/ 还是/ 升序/ ;/ wL/ 表示/ 窗口/ 大小/ ;/ sI/ 表示/ 窗口/ 的/ 滑动/ 距离/ ./ 经过/ 排序/ 算子/ 转换/ 所/ 得到/ 的/ 流/ 数据/ 与/ 原始/ 的/ 流/ 数据/ 具有/ 相同/ 的/ 属性/ 集合/ ./ 与/ 过滤/ 操作/ 和/ 投影/ 操作/ 不同/ 的/ 是/ 排序/ 操作/ 属于/ 阻塞/ 式/ 操作/ [/ 44/ ]/ ,/ 对于/ 单条/ 数据/ 记录/ 做/ 排序/ 操作/ 是/ 毫无意义/ 的/ ./ 排序/ 操作/ 需要/ 额外/ 的/ 指定/ wL/ 和/ sI/ 参数/ 来/ 指定/ 操作/ 的/ 流/ 数据/ 输入/ 范围/ 和/ 操作/ 频率/ ./ 本文/ 中/ 所/ 使用/ 的/ 滑动/ 窗口/ 是/ 基于/ 元组/ 的/ 滑动/ 窗口/ [/ 45/ ]/ ./ (/ 2/ )/ 聚集/ 算子/ 聚集/ 操作/ 包含/ 求和/ 、/ 计数/ 、/ 最小值/ 、/ 最大值/ 以及/ 平均数/ 操作/ ./ 与/ 排序/ 操作/ 相同/ ,/ 聚集/ 操作/ 也/ 属于/ 阻塞/ 式/ 操作/ ,/ 需要/ 指定/ wL/ 及/ sI/ 参数/ ,/ 针对/ 指定/ 窗口/ wL/ 内/ 的/ 流/ 数据/ 记录/ 进行/ 操作/ ./ 本文/ 实现/ 两类/ 聚集/ 操作/ aggregator/ 和/ incrAggregator/ ,/ 其中/ :/ aggregator/ =/ {/ sum/ ,/ count/ ,/ min/ ,/ max/ ,/ avg/ }/ 仅/ 对/ 窗口/ 内/ 的/ 数据/ 进行/ 操作/ ,/ 每次/ 窗口/ 数据/ 改变/ 时以/ 新/ 计算/ 的/ 结果/ 代替/ 上/ 一次/ 的/ 计算结果/ ./ 以/ 最大值/ 操作/ 为例/ ,/ 最大值/ 操作/ 仅/ 输出/ 窗口/ 内/ 指定/ 属性/ 值/ 最大/ 的/ 事件/ ,/ 可以/ 表示/ 为/ 其中/ :/ a/ 为/ 输入/ 事件/ 所/ 包含/ 的/ 属性/ ;/ wL/ 表示/ 窗口/ 大小/ ;/ sI/ 表示/ 窗口/ 的/ 滑动/ 距离/ ./ incrAggregator/ =/ {/ incrSum/ ,/ incrCount/ ,/ incrMin/ ,/ incrMax/ ,/ incrAvg/ }/ 为/ 递增/ 式/ 的/ 聚集/ 操作/ ,/ 可以/ 对/ 多次/ 的/ 计算结果/ 进行/ 累加/ ./ 同样/ 以/ 递增/ 式/ 最大值/ 操作/ 为例/ ,/ 当前/ 窗口/ 内/ 指定/ 属性/ 值/ 最大/ 的/ 事件/ 会/ 与/ 上/ 一次/ 输出/ 的/ 事件/ 相/ 比较/ 输出/ 属性/ 值/ 较大/ 的/ 事件/ ,/ 可以/ 表示/ 为/ 其中/ :/ a/ 为/ 输入/ 事件/ 所/ 包含/ 的/ 属性/ ;/ wL/ 表示/ 窗口/ 大小/ ;/ sI/ 表示/ 窗口/ 的/ 滑动/ 距离/ ./ 经过/ 聚集/ 算子/ 转换/ 所/ 得到/ 的/ 流/ 数据/ 与/ 原始/ 的/ 流/ 数据/ 具有/ 相同/ 的/ 属性/ 集合/ ./ (/ 3/ )/ 融合/ 操作/ 流/ 数据服务/ 可以/ 利用/ 融合/ 操作/ 对/ 接入/ 的/ 多个/ 传感/ 流/ 数据/ 进行/ 融合/ ,/ 输出/ 更/ 具有/ 价值/ 的/ 流/ 数据/ ./ 为/ 一个/ 新/ 的/ 流/ 数据/ ,/ 可以/ 表示/ 为/ 合并/ ./ 合并/ 操作/ 能够/ 将/ 两个/ 同构/ 的/ 流/ 数据/ 合并/ 其中/ ,/ S/ 所/ 产生/ 的/ 事件/ 和/ 原始/ 流/ 数据/ 产生/ 的/ 事件/ 具有/ 相同/ 的/ 属性/ 集合/ ,/ 经过/ 合并/ 算子/ 转换/ 所/ 得到/ 的/ 流/ 数据/ 与/ 原始/ 的/ 流/ 数据/ 也/ 具有/ 相同/ 的/ 属性/ 集合/ ./ 连接/ ./ 连接/ 操作/ 可以/ 将/ 两个/ 描述/ 同一/ 对象/ 或/ 具有/ 相同/ 属性/ 的/ 传感/ 数据/ 连接/ 为/ 一个/ 流/ 数据/ ,/ 可以/ 表示/ 为/ 其中/ :/ S/ 与/ 原始/ 流/ 数据/ 描述/ 同一个/ 对象/ 或者/ 具有/ 相同/ 的/ 属性/ a/ ;/ wL/ 表示/ 窗口/ 大小/ ;/ sI/ 表示/ 窗口/ 的/ 滑动/ 距离/ ./ 连接/ 操作/ 能够/ 对/ 窗口/ 内/ 的/ 两个/ 流/ 数据/ 所/ 产生/ 的/ 事件/ 进行/ 笛卡尔/ 积/ 连接/ ,/ 或者/ 将/ 具有/ 相同/ 属性/ 值/ 的/ 事件/ 进行/ 连接/ ./ 使用/ 连接/ 操作/ 所/ 转换/ 得到/ 的/ 流/ 数据/ 包含/ 的/ 属性/ 集合/ 为/ {/ a1/ ,/ a2/ ,/ …/ ,/ am/ }/ ∪/ {/ a1/ ,/ a2/ ,/ …/ ,/ an/ }/ ,/ 其中/ ,/ {/ a1/ ,/ a2/ ,/ …/ ,/ an/ }/ 和/ {/ a1/ ,/ a2/ ,/ …/ ,/ am/ }/ 为/ 原始/ 流/ 数据/ 的/ 属性/ 集合/ ./ 目前/ 的/ 融合/ 操作/ 均/ 为/ 二元/ 操作/ ,/ 流/ 数据服务/ 可以/ 通过/ 多个/ 连续/ 的/ 融合/ 操作/ ,/ 实现/ 对/ 多/ 源流/ 数据/ 的/ 融合/ ./ 4.2/ 事件/ 订阅/ 系统/ 现有/ 的/ 事件/ 匹配/ 算法/ 大都/ 是/ 将/ 订阅/ 请求/ 组织/ 为/ 特定/ 的/ 数据结构/ ,/ 对/ 其/ 进行/ 遍历/ ,/ 从而/ 得到/ 与/ 事件/ 相匹配/ 的/ 订阅/ 请求/ ./ 文献/ [/ 20/ -/ 21/ ,/ 46/ ]/ 中/ 使用/ 树状/ 结构/ 来/ 对/ 订阅/ 请求/ 集合/ 进行/ 预处理/ ,/ 增加/ 事件/ 的/ 匹配/ 效/ Page9/ 率/ ,/ 这种/ 结构/ 被/ 称为/ 匹配/ 树/ ./ 本文/ 使用/ 了/ 改进/ 的/ 匹配/ 树来/ 获取/ 与/ 事件/ 相匹配/ 的/ 订阅/ 请求/ ,/ 并/ 实现/ 了/ 匹配/ 树/ 的/ 并行/ 化/ 验证/ ./ 4.2/ ./ 1/ 匹配/ 树/ 的/ 数据结构/ 匹配/ 树中/ 包含/ 3/ 种/ 类型/ 的/ 节点/ :/ 根/ 节点/ 、/ 叶子/ 节点/ 和/ 谓词/ 节点/ ,/ 其中/ ,/ 根/ 节点/ 用/ 虚拟/ 节点/ 表示/ ;/ 叶子/ 节点/ 代表/ 一个/ 订阅/ 请求/ ;/ 谓词/ 节点/ 包含/ 订阅/ 请求/ 中/ 的/ 一个/ 谓词/ ./ 定义/ 8/ ./ 匹配/ 树/ ./ 一个/ 匹配/ 树/ T/ 可以/ 由/ 其根/ 节点/ 和/ 多个/ 索引/ 结构/ 来/ 表示/ 其中/ :/ t/ _/ r/ 是/ 一个/ 虚拟/ 节点/ ,/ 代表/ 所有/ 订阅/ 请求/ 的/ 起点/ ;/ 索引/ 结构/ PL/ 用来/ 表述/ 树中/ 不同/ 谓词/ 节点/ 之间/ 的/ 相等/ 或者/ 包含/ 关系/ ,/ PL/ 的/ 数目/ 与/ 匹配/ 树所/ 对应/ 的/ 事件/ 所/ 包含/ 的/ 属性/ 数目/ 有关/ ./ 匹配/ 树/ 具有/ 以下/ 性质/ :/ (/ 1/ )/ 给定/ 事件/ e/ ,/ 对于/ 匹配/ 树中/ 的/ 任意/ 谓词/ 节点/ n/ ,/ 仅当/ e/ ∝/ n/ ./ p/ 时/ ,/ 访问/ n/ 的/ 所有/ 子/ 节点/ N/ ,/ 并/ 对于/ 谓词/ 节点/ n/ ∈/ N/ ,/ 验证/ e/ 与/ n/ ./ p/ 的/ 匹配/ 关系/ ;/ (/ 2/ )/ 给定/ 事件/ e/ ,/ 设/ 匹配/ 树中/ 的/ 所有/ 叶子/ 节点/ 为/ N/ ,/ N/ / N/ 是/ 事件/ e/ 对/ 匹配/ 树/ 遍历/ 验证/ 时所/ 访问/ 到/ 的/ 所有/ 叶子/ 节点/ ,/ 则/ R/ =/ n1/ ./ r/ ∪/ n2/ ./ r/ ∪/ …/ ∪/ nk/ ./ r/ ,/ ni/ ∈/ N/ ,/ N/ ∧/ 1/ / i/ / k/ 为/ 所有/ 与/ 事件/ 相匹配/ 的/ 订阅/ 请求/ ;/ (/ 3/ )/ 对于/ 任意/ 的/ 订阅/ 请求/ ri/ =/ pi1/ ∧/ pi2/ ∧/ …/ ∧/ pin/ 和/ rj/ =/ pj1/ ∧/ pj2/ ∧/ …/ ∧/ pjn/ ,/ 令/ pi1/ ∧/ pi2/ ∧/ …/ ∧/ pik/ 和/ pj1/ ∧/ pj2/ ∧/ …/ ∧/ pjk/ 为/ ri/ 和/ rj/ 的/ 前缀/ 谓词/ ,/ 其中/ 1/ / k/ / min/ (/ n/ ,/ m/ )/ ,/ 如果/ (/ pi1/ =/ pj1/ )/ ∧/ (/ pi2/ =/ pj2/ )/ ∧/ …/ ∧/ (/ pik/ =/ pjk/ )/ ,/ 那么/ ri/ 和/ rj/ 的/ 前/ k/ 个/ 谓词/ 可以/ 在/ 匹配/ 树上/ 共用/ k/ 个/ 谓词/ 节点/ ./ (/ 4/ )/ 对于/ 任意/ 的/ 谓词/ 节点/ ,/ n/ ∈/ PL/ 可以/ 根据/ n/ ./ p/ 的/ 验证/ 结果/ 推理/ 获取/ 部分/ 谓词/ 节点/ n/ ∈/ PL/ 的/ 谓词/ 匹配/ 结果/ ./ 下面/ 通过/ 介/ 一个/ 简单/ 的/ 匹配/ 树/ 实例/ 来/ 说明/ 匹配/ 树/ 的/ 性质/ ./ 例如/ ,/ 假如/ 存在/ 3/ 个/ 订阅/ 请求/ r1/ ,/ r2/ 和/ r3/ :/ 其中/ :/ r1/ 和/ r2/ 包含/ 相同/ 的/ 谓词/ p1/ ;/ r2/ 和/ r3/ 包含/ 相同/ 的/ 谓词/ p2/ ;/ 谓词/ p3/ 和/ p4/ 存在/ 一个/ 包含/ 关系/ p3/ / p4/ ,/ 这/ 3/ 个/ 订阅/ 请求/ 组成/ 的/ 匹配/ 树如图/ 4/ 所示/ ./ 在/ 图/ 4/ 中/ ,/ 对于/ 事件/ e/ ,/ 仅/ 在/ e/ ∝/ p1/ 时才/ 需要/ 对/ 节点/ p2/ 和/ p3/ 进行/ 访问/ 和/ 验证/ (/ 性质/ 1/ )/ ./ 对于/ 订阅/ 请求/ r1/ 来说/ ,/ 路径/ :/ 虚拟/ 节点/ →/ p1/ →/ p2/ →/ r1/ 代表/ 了/ 订阅/ 请求/ r1/ =/ p1/ ∧/ p2/ ./ 当/ 事件/ e/ 对/ 匹配/ 树/ 进行/ 遍历/ 验证/ 时/ ,/ 访问/ 到/ 的/ 所有/ 叶子/ 节点/ 即/ 为/ 与/ 事件/ e/ 相匹配/ 的/ 订阅/ 请求/ (/ 性质/ 2/ )/ ./ 订阅/ 请求/ r1/ 和/ r2/ 共同/ 拥有/ 谓词/ p1/ ,/ 它们/ 在/ 匹配/ 树/ 中共/ 用/ 同一个/ 谓词/ 节点/ (/ 性质/ 3/ )/ ./ 传统/ 匹配/ 树/ 只/ 在/ 不同/ 订阅/ 请求/ 具有/ 相同/ 的/ 前缀/ 谓词/ 时/ 才能/ 共享/ 谓词/ 节点/ ,/ 无法/ 涵盖/ 所有/ 的/ 谓词/ 关系/ ./ 如图/ 4/ 中/ 订阅/ 请求/ r2/ 和/ r3/ 包含/ 同样/ 的/ 谓词/ p2/ ,/ 但/ 它们/ 无法/ 共用/ 同一个/ 谓词/ 节点/ ./ 为了/ 进一步/ 减少/ 谓词/ 的/ 验证/ 次数/ ,/ 我们/ 在/ 匹配/ 树中/ 使用/ 了/ 多个/ 索引/ 结构/ 来/ 表述/ 谓词/ 节点/ 的/ 谓词/ 之间/ 关系/ ,/ 对/ 匹配/ 树/ 进行/ 优化/ ./ 如图/ 4/ 中/ 包含/ 两个/ 索引/ 结构/ ,/ 其中/ ,/ 对于/ 索引/ 结构/ index1/ 来说/ ,/ 两个/ 谓词/ 节点/ 的/ 匹配/ 结果/ 相同/ ,/ 对于/ 索引/ 结构/ index2/ 来说/ ,/ 由于/ p3p4/ ,/ 因此/ (/ e/ ∝/ p4/ →/ e/ ∝/ p3/ )/ ∧/ (/ / e/ ∝/ p3/ →/ e/ ∝/ p4/ )/ (/ 性质/ 4/ )/ ./ 4.2/ ./ 2/ 匹配/ 树/ 创建/ 根据/ 定义/ 5/ ,/ 本文/ 将/ 组成/ 订阅/ 请求/ ri/ 的/ 每/ 一个/ 简单/ 合取/ 式/ 称为/ 条件/ 表达式/ cij/ ,/ 对于/ 订阅/ 请求/ ri/ 来说/ ,/ / (/ e/ ∝/ cij/ )/ →/ (/ e/ ∝/ ri/ )/ ./ 定义/ 在/ 同一个/ 流/ 数据服务/ 之上/ 的/ 订阅/ 请求/ 所/ 包含/ 的/ 所有/ 条件/ 表达式/ 可以/ 转换/ 为/ 一颗/ 匹配/ 树/ ./ 匹配/ 树/ 构建/ 的/ 步骤/ 可以/ 分为/ :/ (/ 1/ )/ 初始化/ 匹配/ 树及/ (/ 2/ )/ 依次/ 向/ 匹配/ 树中/ 添加/ 新/ 的/ 条件/ 表达式/ ./ 在/ 向/ 匹配/ 树/ 添加/ 新/ 的/ 条件/ 表达式/ 时/ ,/ 给定/ 已有/ 的/ 匹配/ 树/ T/ 和/ 条件/ 表达式/ ci/ ,/ 对于/ 任意/ 的/ 谓词/ pij/ ∈/ ci/ ,/ 需要/ 遍历/ T/ 中/ 所有/ 谓词/ 节点/ 才能/ 获取/ 所有/ 可能/ 的/ 谓词/ 关系/ ,/ 这种/ 方式/ 复杂/ 且/ 不/ 易于/ 实现/ ./ 因此/ ,/ 我们/ 将/ 谓词/ 集合/ 按照/ 其所/ 定义/ 的/ 属性/ 名称/ 和/ 关系/ 运算符/ 来/ 逐级/ 建立/ 多级/ 索引/ ,/ 每/ 一个/ 最终/ 索引/ 项为/ 事件/ 所/ 包含/ 的/ 属性/ ,/ 按照/ 不同/ 的/ 关系/ 运算符/ 形成/ 谓词/ 列表/ PL/ ./ 如图/ 5/ 所示/ ,/ 对于/ 包含/ 判定/ 大小/ 关系/ 的/ 运算符/ 的/ 谓词/ ,/ 在/ PL/ 中/ 按照/ 谓词/ 的/ 包含/ 关系/ 进行/ 排序/ ,/ 即/ 对/ / pi/ ,/ pj/ ∈/ PL/ ,/ j/ </ j/ →/ pi/ / pj/ ./ 对于/ 这/ 一类/ PL/ ,/ 能/ Page10/ 够/ 得到/ (/ e/ ∝/ pi/ →/ e/ ∝/ {/ pj/ }/ )/ ∨/ (/ / e/ ∝/ pi/ →/ / e/ ∝/ {/ pk/ }/ )/ ,/ 其中/ pj/ 为排/ 在/ pi/ 后面/ 的/ 谓词/ ,/ pk/ 为排/ 在/ pi/ 前面/ 的/ 谓词/ ./ 对于/ 相等/ 和/ 不/ 相等/ 关系/ 运算符/ ,/ 该/ PL/ 实质/ 上/ 是/ 一个/ Hash/ 表/ ,/ 对于/ 相等/ 运算符/ 的/ PL/ 中/ 的/ 谓词/ 来说/ ,/ 存在/ e/ ∝/ pi/ →/ / e/ ∝/ {/ pj/ }/ ,/ 其中/ ,/ pj/ 为/ 除/ pi/ 之外/ 的/ 谓词/ ./ 对于/ 不/ 相等/ 运算符/ 的/ PL/ 来说/ ,/ 存在/ / e/ ∝/ pi/ →/ e/ ∝/ {/ pj/ }/ ,/ 其中/ ,/ pj/ 为/ 除/ pi/ 之外/ 的/ 谓词/ ./ 因此/ ,/ 对于/ 事件/ e/ =/ {/ 〈/ a1/ ,/ v1/ 〉/ ,/ 〈/ a2/ ,/ v2/ 〉/ ,/ …/ ,/ 〈/ am/ ,/ vm/ 〉/ }/ 来说/ ,/ 每/ 一个/ 属性/ ai/ 都/ 可以/ 定义/ 一个/ 多级/ 索引/ 结构/ 来/ 表述/ 定义/ 在/ 该/ 属性/ 上/ 不同/ 谓词/ 的/ 关系/ ./ 定义/ 在/ e/ 上/ 的/ 订阅/ 请求/ 所/ 形成/ 的/ 匹配/ 树/ 可以/ 由/ 一个/ 根/ 节点/ 以及/ m/ 个/ 多级/ 索引/ 结构/ 组成/ ./ 在/ 匹配/ 树中/ ,/ 如果/ 能够/ 事先/ 知道/ 每个/ 谓词/ 的/ 出现/ 概率/ ,/ 并/ 根据/ 概率/ 来/ 对/ 谓词/ 排序/ ,/ 可以/ 增加/ 不同/ 的/ 条件/ 表达式/ 共享/ 谓词/ 节点/ 的/ 可能性/ [/ 47/ ]/ ./ 然而/ ,/ 统计/ 谓词/ 出现/ 的/ 概率/ 并/ 进行/ 排序/ 需要/ 复杂/ 的/ 处理过程/ ,/ 且/ 谓词/ 出现/ 的/ 概率/ 会/ 随着/ 订阅/ 请求/ 的/ 改变/ 而/ 改变/ ./ 简化/ 起/ 见/ ,/ 本文/ 中/ 的/ 谓词/ 顺序/ 使用/ 字母/ 排序/ ,/ 即/ 对于/ 任意/ 条件/ 表达式/ :/ c/ =/ 〈/ a1/ ,/ ro/ ,/ v1/ 〉/ ∧/ 〈/ a2/ ,/ ro/ ,/ v2/ 〉/ ∧/ …/ ∧/ 〈/ ak/ ,/ ro/ ,/ vk/ 〉/ ./ 其/ 包含/ 的/ 属性/ {/ a1/ ,/ a2/ ,/ …/ ,/ ak/ }/ 存在/ a1/ / a2/ / …/ / ak/ ./ 图/ 6/ 展示/ 了/ 一个/ 优化/ 后/ 的/ 匹配/ 树/ ,/ 由于/ 匹配/ 树/ 对应/ 的/ 事件/ 包含/ 4/ 个/ 属性/ ,/ 匹配/ 树中/ 包含/ 一个/ 根/ 节点/ 以及/ 4/ 个/ 多级/ 索引/ 结构/ ./ 简单/ 起/ 见/ ,/ 图中/ 并/ 没有/ 将/ 所有/ 的/ 索引/ 结构/ 在/ 图/ 中画/ 出/ ./ 在/ 匹配/ 树中/ 从/ 根/ 节点/ 到任/ 一/ 叶子/ 节点/ 的/ 路径/ 上/ ,/ 对于/ 任意/ 的/ ai/ / aj/ ,/ ai/ 一定/ 出现/ 在/ aj/ 之前/ ./ 将/ 所有/ 的/ 条件/ 表达式/ 转换/ 为/ 匹配/ 树/ 的/ 伪/ 代码/ 如/ 算法/ 1/ 所示/ ./ 算法/ 1/ ./ 匹配/ 树/ 创建/ 算法/ ./ 输入/ :/ 条件/ 表达式/ 集合/ C/ 输出/ :/ 新/ 的/ 匹配/ 树/ T1/ ./ 过程/ create/ _/ Tree/ (/ C/ )/ 2/ ./ INITT/ ;/ 3/ ./ FOREACHcinC4/ ./ addConInTree/ (/ T/ ,/ c/ )/ ;/ 5/ ./ RETURNT/ ;/ 6/ ./ 过程/ addConToTree/ (/ T/ ,/ c/ )/ 7/ ./ qisthenumberofpredicatesinc/ ;/ 8/ ./ piisthei/ -/ thpredicateinc/ ;/ 9/ ./ n/ ←/ T/ ./ root/ ;/ i/ ←/ 1/ ;/ 10/ ./ IFnhasnochildTHENflag/ ←/ FALSE/ ;/ 11/ ./ ELSEIF12/ ./ flag/ ←/ TRUE/ ;/ 13/ ./ WHILEflagandi/ / qDO14/ ./ FOREACHchildnodemofn15/ ./ IFm/ ./ value/ =/ =/ pi16/ ./ THENn/ ←/ m/ ;/ i/ ←/ i/ +/ 1/ ;/ BREAK/ ;/ 17/ ./ IFtherearenochildofnequalwithp118/ ./ THENflag/ ←/ FALSE/ ;/ 19/ ./ IFflag/ =/ =/ FALSE20/ ./ WHILEi/ / qDO21/ ./ newnoden/ ←/ pi/ ;/ 22/ ./ findPLfornandinsertn/ ;/ 23/ ./ n/ ./ addChild/ (/ n/ )/ ;/ 24/ ./ n/ ←/ n/ ;/ 25/ ./ newnoden/ ←/ c/ ;/ n/ ./ addChild/ (/ n/ )/ ;/ 创建/ 匹配/ 树时/ ,/ 首先/ 需要/ 初始化/ 匹配/ 树/ (/ 行/ 2/ )/ ,/ 然后/ 向/ 匹配/ 树中/ 依次/ 添加/ 新/ 的/ 条件/ 表达式/ (/ 行/ 3/ ,/ 4/ )/ ./ 添加/ 新/ 的/ 表达式/ 时/ ,/ 我们/ 首先/ 判断/ 原始/ 的/ 匹配/ 树/ 的/ 根/ 节点/ 是否/ 不/ 含/ 任何/ 子/ 节点/ (/ 行/ 10/ )/ ,/ 如果/ 不/ 含/ 任何/ 子/ 节点/ ,/ 则/ 将/ 条件/ 表达式/ 的/ 每个/ 谓词/ 形成/ 的/ 谓词/ 节点/ 依次/ 添加/ 到/ 树/ 中/ (/ 行/ 19/ ~/ 24/ )/ ./ 如果/ 根/ 节点/ 具有/ 子/ 节点/ ,/ 判断/ 并/ 找到/ 匹配/ 树中/ 包含/ 的/ 条件/ 表达式/ 的/ 前缀/ 谓词/ ,/ 共享/ 谓词/ 节点/ (/ 行/ 12/ ~/ 18/ )/ ./ 然后/ 向树中/ 依次/ 添加/ 表达式/ 中/ 剩余/ 的/ 谓词/ (/ 行/ 19/ ~/ 24/ )/ ,/ 在/ 添加/ 谓词/ 节点/ 时/ ,/ 需要/ 根据/ 谓词/ 所/ 包含/ 的/ 属性/ 及/ 关系/ 运算符/ 找到/ 谓词/ 所在/ 的/ 索引/ 列表/ PL/ ,/ 并/ 将/ 其/ 插入/ 到/ PL/ 中/ (/ 行/ 22/ )/ ./ 最后/ 在/ 树/ 中/ 添加/ 一个/ 代表/ 该/ 条件/ 表达式/ Page11/ 的/ 叶子/ 节点/ (/ 行/ 25/ )/ ./ 在/ 创建/ 匹配/ 树时/ ,/ 每往/ 匹配/ 树中/ 插入/ 一个/ 新/ 的/ 节点/ 都/ 需要/ 查找/ 并/ 改变/ 该/ 节点/ 所属/ 的/ 索引/ 结构/ ./ 假设/ 事件/ 包含/ 的/ 属性/ 数目/ 为/ m/ ,/ 需要/ 对/ n/ 个/ 条件/ 表达式/ 创建/ 匹配/ 树/ ./ 这里/ 假设/ 每个/ 表达式/ 所/ 包含/ 的/ 谓词/ 为/ 2m/ ,/ 每个/ 属性/ 之上/ 的/ 谓词/ 数目/ 为/ 2n/ ./ 最好/ 的/ 情况/ 下/ ,/ 每次/ 插入/ 请求/ 时/ ,/ 插入/ 谓词/ 均/ 包含/ 其他/ 谓词/ 或者/ 与/ 其他/ 谓词/ 等价/ ,/ 匹配/ 树/ 的/ 创建/ 时间/ 复杂度/ 为/ 2mn/ ./ 最坏/ 的/ 情况/ 下/ ,/ 每次/ 插入/ 一个/ 谓词/ 节点/ 时/ ,/ 都/ 需要/ 与/ 同/ 层次/ 的/ 其他/ 节点/ 进行/ 比较/ ,/ 此时/ 的/ 时间/ 复杂度/ 为/ 2n/ ×/ (/ n/ +/ (/ m/ -/ 1/ )/ ×/ n/ )/ ./ 创建/ 匹配/ 树/ 的/ 平均/ 时间/ 复杂度/ 为/ O/ (/ mn2/ )/ ./ 空间/ 复杂度/ 方面/ ,/ 每个/ 条件/ 表达式/ 的/ 插入/ 需要/ 占用/ 至少/ 2m/ +/ 1/ 个/ 节点/ ,/ 由于/ 每个/ 节点/ 需要/ 有/ 链表/ 的/ 前后/ 驱/ 信息/ 和/ 树/ 的/ 父子/ 信息/ ,/ 所以/ 占用/ 空间/ 复杂度/ 为/ O/ (/ mn/ )/ ./ 匹配/ 树/ 的/ 生成/ 算法/ 允许/ 订阅/ 请求/ 的/ 动态/ 增加/ ./ 当新/ 的/ 订阅/ 请求/ 到来/ 时/ ,/ 仅/ 需要/ 对/ 其/ 进行/ 转换/ ,/ 然后/ 对/ 相应/ 的/ 条件/ 表达式/ 调用/ 算法/ 1/ 中/ 的/ 过程/ addConToTree/ 即可/ ./ 当/ 删除/ 订阅/ 条件/ 时/ ,/ 可以/ 通过/ 对/ 匹配/ 树/ 的/ 局部/ 节点/ 进行/ 删除/ ,/ 同时/ 对/ 相应/ 的/ 索引/ 结构/ 进行/ 调整/ ./ 4.2/ ./ 3/ 匹配/ 树/ 并行/ 化/ 验证/ 对于/ 可能/ 出现/ 的/ 大规模/ 的/ 应用/ 订阅/ 请求/ ,/ 为了/ 更好/ 的/ 保障/ 应用/ 获取/ 传感/ 流/ 数据/ 的/ 时效性/ ,/ 在/ 利用/ 匹配/ 树对/ 事件/ 进行/ 匹配/ 时/ ,/ 我们/ 可以/ 将/ 匹配/ 树/ 划分/ 为/ 多个/ 子树/ 并/ 对/ 其/ 行进/ 并行/ 化/ 遍历/ ./ 如图/ 6/ 中/ 的/ 匹配/ 树/ 可以/ 划分/ 为/ 图/ 7/ 所示/ 的/ 子树/ ./ 由图/ 7/ 可以/ 看到/ ,/ 匹配/ 树/ 可以/ 根据/ 不同/ 层次/ 的/ 子/ 节点/ 划分/ 为/ 不同/ 的/ 子树/ ./ 由于/ 构成/ 匹配/ 树/ 的/ 订阅/ 请求/ 数目/ 及其/ 所/ 包含/ 的/ 谓词/ 数目/ 都/ 不/ 相同/ ,/ 匹配/ 树/ 划分/ 的/ 子树/ 数目/ 会/ 受到/ 每层/ 节点/ 数目/ 的/ 影响/ ,/ 无法/ 动态/ 的/ 调节/ 匹配/ 树/ 验证/ 的/ 并行度/ ./ 而且/ 每个/ 子树/ 包含/ 的/ 谓词/ 数目/ 也/ 会/ 出现/ 倾斜/ 的/ 状况/ ./ 因此/ 我们/ 可以/ 先/ 将/ 匹配/ 树/ 划分/ 成/ 多个/ 子树/ ,/ 然后/ 将子/ 树/ 分配/ 到/ 不同/ 的/ 分块/ 中/ 重新/ 组成/ 一个/ 子树/ ,/ 并行/ 的/ 对/ 每个/ 分块/ 中/ 的/ 子树/ 进行/ 遍历/ ./ 为了/ 避免出现/ 分块/ 负载/ 过重/ 或者/ 负载/ 过/ 小/ 的/ 情况/ ,/ 在/ 对子/ 树/ 进行/ 划分/ 时/ 需要/ 尽量/ 保证/ 分块/ 的/ 均匀/ 性/ ./ 因此/ 本文/ 按照/ 子树/ 包含/ 的/ 谓词/ 数目/ 对/ 其/ 进行/ 划分/ ,/ 尽量/ 保证/ 同一/ 分块/ 中子/ 树/ 包含/ 谓词/ 的/ 总/ 数目/ 相近/ ./ 本文/ 将/ 匹配/ 树/ 的/ 划分/ 转换/ 为/ 典型/ 的/ 整数/ 划分/ 问题/ [/ 48/ ]/ 以/ 进行/ 求解/ ,/ 定义/ 9/ 给出/ 了/ 对/ 匹配/ 树/ 进行/ 划分/ 的/ 形式化/ 定义/ ./ 定义/ 9/ ./ 匹配/ 树/ 的/ 划分/ 策略/ ./ 给定/ 匹配/ 树/ T/ ,/ 可以/ 将/ 其/ 划分/ 为子/ 树/ 集合/ 犜/ ,/ 设/ 分块/ 数目/ 为/ k/ ,/ 基于/ 谓词/ 数目/ 的/ 匹配/ 树/ 划分/ 策略/ sp/ 是/ 一个/ 分块/ 函数/ sp/ (/ 犜/ ,/ k/ )/ =/ {/ 犜/ 1/ ,/ 犜/ 2/ ,/ …/ ,/ 犜/ k/ }/ ,/ 它/ 满足/ :/ 在/ 本文/ 中/ ,/ 我们/ 先/ 按照/ 设置/ 的/ 并行度/ 及/ 匹配/ 树中/ 每层/ 谓词/ 节点/ 的/ 数目/ 将/ 匹配/ 树/ 划分/ 为/ 多个/ 子树/ ,/ 所有/ 子树/ 包含/ 的/ 谓词/ 数目/ 便/ 形成/ 一个/ 数组/ ,/ 其中/ 每个/ 子树中/ 包含/ 的/ 谓词/ 数目/ 相当于/ 数组/ 中/ 的/ 一个/ 元子/ 树/ 包含/ 谓词/ 的/ 总/ 数目/ ./ (/ 1/ )/ 犜/ =/ ∪/ i/ =/ 1/ …/ k/ 犜/ i/ ;/ (/ 2/ )/ 犜/ i/ ∩/ 犜/ j/ =/ / ,/ i/ ,/ j/ =/ 1/ …/ k/ ∧/ i/ ≠/ j/ ;/ (/ 3/ )/ min/ ∑/ i/ ,/ j/ =/ 1/ …/ k/ 整数/ 划分/ 问题/ 就是/ 如何/ 把/ 一个/ 数组/ L/ 分成/ k/ 个子/ 数组/ ,/ 使得/ 每个/ 子树组/ 的/ 元素/ 之/ 和/ 大小/ 尽量/ 相等/ ./ 如/ 一个/ 数组/ {/ 3/ ,/ 1/ ,/ 1/ ,/ 2/ ,/ 2/ ,/ 1/ }/ 可以/ 分成/ 两个/ 子/ 数组/ L1/ =/ {/ 3/ ,/ 1/ ,/ 1/ }/ 和/ L2/ =/ {/ 2/ ,/ 2/ ,/ 1/ }/ ,/ 显然/ 这/ 两个/ 子/ 数组/ 满足/ 定义/ 9/ 的/ 所有/ 要求/ ./ Page12/ 素/ ./ 如图/ 7/ 中/ ,/ 假设/ 匹配/ 树/ 的/ 并行度/ 设置/ 为/ 2/ ,/ 按照/ 第一层/ 子/ 节点/ 的/ 数目/ 将/ 匹配/ 树/ 划分/ 为/ 3/ 个子/ 树/ ,/ 这些/ 子树/ 的/ 包含/ 的/ 谓词/ 数目/ 可以/ 组成/ 数组/ {/ 12/ ,/ 4/ ,/ 7/ }/ ./ 该/ 数组/ 可以/ 分成/ 两个/ 子/ 数组/ L1/ =/ {/ 12/ }/ 和/ L2/ =/ {/ 4/ ,/ 7/ }/ ./ 整数/ 划分/ 问题/ 是/ 一个/ NP/ 难/ 问题/ ./ 本文/ 采用/ 了/ 文献/ [/ 48/ ]/ 给出/ 的/ 时间/ 复杂度/ 为/ O/ (/ kn2/ )/ 的/ 算法/ ,/ 该/ 算法/ 并/ 不/ 打乱/ 原有/ 数组/ 元素/ 的/ 顺序/ ,/ 通过/ 将/ 数组/ 顺序/ 的/ 进行/ 划分/ 得到/ 一个/ 次优/ 解/ ./ 它/ 计算/ 各种/ 划分/ 的/ 可能/ 情况/ 的/ 最小/ 开销/ M/ [/ i/ ]/ [/ j/ ]/ 以及/ 相应/ 的/ 数组/ 划分/ 的/ 位置/ D/ [/ i/ ]/ [/ j/ ]/ ./ 其中/ ,/ M/ [/ i/ ]/ [/ j/ ]/ 表示/ 将/ 数组/ 的/ 前/ i/ 个/ 元素/ 分成/ j/ 个/ 分块/ 的/ 最小/ 开销/ ,/ D/ [/ i/ ]/ [/ j/ ]/ 用来/ 记录/ 元素/ 划分/ 的/ 位置/ 信息/ ./ 算法/ 的/ 详细信息/ 可以/ 见/ 参考文献/ [/ 48/ ]/ ./ 利用/ 匹配/ 树/ 的/ 划分/ 策略/ ,/ 我们/ 对/ 匹配/ 树/ 并行/ 的/ 进行/ 遍历/ 验证/ ./ 匹配/ 树/ 并行/ 化/ 验证/ 的/ 伪/ 代码/ 如/ 算法/ 2/ 所示/ :/ 算法/ 2/ ./ 匹配/ 树/ 并行/ 化/ 验证/ 算法/ ./ 输入/ :/ 匹配/ 树/ T/ ,/ 事件/ e/ ,/ 并行度/ k/ 输出/ :/ 匹配/ 成功/ 的/ 条件/ 表达式/ 集合/ C1/ ./ 过程/ match/ (/ T/ ,/ e/ )/ 2/ ./ 犜/ ←/ T/ ./ childTree/ ;/ 3/ ./ 犘/ 犜/ ←/ sp/ (/ 犜/ ,/ k/ )/ ;/ 4/ ./ FOREACH/ 犜/ iin/ 犘/ 犜/ 5/ ./ execsub/ _/ match/ (/ 犜/ i/ ,/ e/ )/ inparallel/ ;/ 6/ ./ 过程/ sub/ _/ match/ (/ 犜/ ,/ e/ )/ 7/ ./ INITC/ ;/ 8/ ./ FOREACHTiin/ 犜/ 9/ ./ nistherootofTi/ ;/ 10/ ./ visit/ (/ T/ ,/ n/ ,/ e/ ,/ R/ )/ ;/ 11/ ./ RETURNC/ ;/ 12/ ./ 过程/ visit/ (/ T/ ,/ n/ ,/ e/ ,/ C/ )/ 13/ ./ IFnisaleafnodeTHENC/ ./ add/ (/ n/ ./ value/ )/ ;/ 14/ ./ ELSE15/ ./ IFn/ ./ resultisNULL16/ ./ verifyn/ ./ valueone/ ;/ 17/ ./ findPLfornandsetresultforrelativenodes/ ;/ 18/ ./ IFn/ ./ resultisTRUE19/ ./ FOREACHchildnofn20/ ./ visit/ (/ T/ ,/ n/ ,/ e/ ,/ R/ )/ ;/ 我们/ 首先/ 获取/ 匹配/ 树/ 的/ 所有/ 子树/ (/ 行/ 2/ )/ ,/ 并/ 将子/ 树/ 集合/ 按照/ 定义/ 6/ 进行/ 划分/ (/ 行/ 3/ )/ ./ 对于/ 每/ 一个/ 分块/ 我们/ 并行/ 的/ 执行/ 子/ 匹配/ 过程/ sub/ _/ match/ (/ 行/ 4/ ,/ 5/ )/ ./ 在/ 每个/ 子/ 匹配/ 过程/ 中/ ,/ 对/ 每个/ 子树/ 递归/ 的/ 进行/ 遍历/ (/ 行/ 8/ ~/ 10/ )/ ,/ 所有/ 访问/ 到/ 的/ 叶子/ 节点/ 为/ 与/ 事件/ 相匹配/ 的/ 条件/ 表达式/ (/ 行/ 7/ )/ ./ 当/ 访问/ 到/ 谓词/ 节点/ 时/ ,/ 某些/ 谓词/ 节点/ 在/ 没有/ 遍历/ 到/ 的/ 情况/ 下/ 便/ 已经/ 通过/ 索引/ 结构/ 得到/ 了/ 匹配/ 结果/ ,/ 可以/ 先/ 查看/ 该/ 谓词/ 节点/ 是否/ 已经/ 存在/ 匹配/ 结果/ (/ 行/ 15/ )/ ./ 如果/ 没有/ 结果/ 再/ 对/ 其进/ 验证/ (/ 行/ 16/ )/ ,/ 然后/ 按照/ 其/ 匹配/ 结果/ 为/ 所在/ 索引/ 上/ 的/ 相关/ 节点/ 进行/ 赋值/ (/ 行/ 17/ )/ ./ 通过/ 对/ 匹配/ 树/ 进行/ 遍历/ ,/ 我们/ 可以/ 获得/ 更新/ 事件/ 相匹配/ 的/ 所有/ 的/ 条件/ 表达式/ ./ 通过/ 条件/ 表达式/ 与/ 订阅/ 请求/ 的/ 关系/ ,/ 便/ 可以/ 得到/ 与/ 更新/ 事件/ 相匹配/ 的/ 所有/ 订阅/ 请求/ ,/ 并/ 将/ 更新/ 事件/ 发送到/ 相应/ 的/ 订阅/ 请求/ ./ 在/ 匹配/ 树/ 验证/ 阶段/ ,/ 匹配/ 树/ 验证/ 的/ 时间/ 复杂度/ 与/ 每次/ 访问/ 验证/ 的/ 谓词/ 节点/ 的/ 数目/ 相关/ ./ 假设/ 将/ 匹配/ 树/ 平均/ 划分/ 为/ 若干/ 子树/ ,/ 根据/ 整数/ 划分/ 原理/ 每/ 棵子/ 树/ 包含/ 的/ 节点/ 数量/ 尽可能/ 相等/ ./ 子/ 树上/ 的/ 每个/ 谓词/ 节点/ 的/ 验证/ 消耗/ 包含/ 访问/ 和/ 谓词/ 验证/ 两/ 部分/ 的/ 时间/ 消耗/ ./ 对于/ 任意子/ 树中/ 的/ 第/ j/ 层/ 的/ 第/ i/ 个/ 谓词/ 节点/ nij/ ,/ 遍历/ 的/ 复杂度/ 可以/ 表示/ 为/ 其中/ :/ pk/ 为/ 从/ 根/ 节点/ 到/ nij/ 的/ 路径/ 上/ 第/ k/ 个/ 谓词/ 验证/ 结果/ 为/ 真的/ 概率/ ;/ p/ 为/ 已知/ nij/ 验证/ 结果/ 的/ 概率/ ;/ costvi/ 为/ 访问/ 的/ 时间/ 消耗/ ;/ costve/ 为/ 谓词/ 验证/ 的/ 时间/ 消耗/ ./ 简单/ 起/ 见/ ,/ 我们/ 假设/ 条件/ 表达式/ 中仅/ 包含/ 等值/ 谓词/ ,/ 设/ K/ 是/ 事件/ 所/ 包含/ 的/ 属性/ 个数/ ,/ V/ 是/ 每个/ 属性/ 可以/ 取值/ 范围/ ,/ S/ 是/ 子树/ 涉及/ 的/ 条件/ 表达式/ 集合/ ,/ C/ (/ S/ )/ 是/ 事件/ 与/ 该子/ 树/ 进行/ 验证/ 的/ 期望/ 时间/ ./ 利用/ 上文/ 介绍/ 的/ 整数/ 划分/ 原理/ 将/ 匹配/ 树/ 尽可能/ 均匀/ 的/ 划分/ 为/ 若干/ 子树/ ./ 假设/ 所有/ 的/ 事件/ 是/ 等/ 可能/ 发生/ 的/ ,/ 且/ 每个/ 订阅/ 请求/ 与/ 事件/ 相匹配/ 的/ 概率/ 是/ 相同/ 的/ ./ 当/ 并行/ 地/ 将/ 大量/ 事件/ 与/ 匹配/ 树/ 进行/ 匹配/ 时/ ,/ 订阅/ 请求/ 集合/ 将/ 均衡/ 分布/ 于/ 各个/ 子树/ ,/ 根据/ 概率论/ 可以/ 得到/ 每个/ 事件/ 将/ 以/ 相似/ 的/ 概率/ 与子/ 树中/ 的/ 订阅/ 请求/ 相匹配/ ,/ 从而/ 保障/ 并行/ 化/ 过程/ 的/ 负载/ 均衡/ ./ 的/ 期望/ 时间/ C/ (/ S/ )/ 满足/ C/ (/ S/ )/ / 2/ (/ k/ +/ 1/ )/ |/ S/ |/ 1/ -/ λ/ (/ lnV/ +/ ln/ (/ K/ +/ 1/ )/ )/ ×/ costvi/ +/ (/ k/ +/ 1/ )/ |/ S/ +/ 1/ |/ 1/ -/ λ/ (/ lnV/ +/ ln/ (/ K/ +/ 1/ )/ )/ ×/ costve/ (/ 2/ )/ 其中/ ,/ λ/ ·/ ·/ =/ lnV/ 基于/ 此/ 并行/ 化/ 方式/ ,/ 匹配/ 任意/ 一个/ 事件/ 所/ 消耗/ 首先/ 考虑/ 访问/ 的/ 时间/ 消耗/ ./ 引理/ 1/ ./ 对于/ 等/ 概论/ 出现/ 的/ VK/ 个/ 事件/ ,/ 存在/ 引理/ 2/ ./ 最多/ 有/ V/ η/ 个/ 节点/ 满足/ 证明/ ./ 满足/ Cvi/ (/ S/ )/ =/ VK/ -/ η/ 的/ 节点/ 只/ 存在/ 于/ 第/ η/ 层/ ./ 根据/ 匹配/ 树/ 的/ 构建/ 方式/ ,/ 最坏/ 情况/ 下/ 第/ η/ 层/ 所/ Page13/ 有/ 节点/ 都/ 需要/ 匹配/ ./ 这种/ 情况/ 下/ ,/ 最多/ 有/ V/ η/ 个/ 节点/ 满足/ Cvi/ (/ S/ )/ =/ VK/ -/ η/ ./ 显然/ 可/ 得/ :/ 易知/ ,/ 一个/ 树/ 最/ 多/ 含有/ (/ K/ +/ 1/ )/ ×/ |/ S/ |/ 个/ 节点/ ./ 将/ 一棵树/ 的/ 所有/ 节点/ 按照/ costvi/ (/ n/ )/ 排序/ ,/ 设/ f/ (/ n/ )/ 表示/ 第/ n/ 个/ 节点/ 的/ 代价/ cost/ ./ 根据/ Cvi/ (/ S/ )/ =/ ∑/ costvi/ (/ n/ )/ 有/ Cvi/ (/ S/ )/ =/ ∑/ (/ K/ +/ 1/ )/ ×/ S/ 设/ g/ (/ x/ )/ =/ (/ Ax/ +/ B/ )/ -/ λ/ ,/ 其中/ :/ f/ (/ j/ )/ 表示/ 第/ j/ 个/ 节点/ 的/ 访问/ 次数/ ,/ 则/ 有/ 如下/ 引理/ ./ 引理/ 3/ ./ f/ (/ x/ )/ / g/ (/ x/ )/ ./ 证明/ ./ 对于/ 任意/ 0/ / i/ / K/ ,/ 正整数/ j/ 满足/ ∑/ p/ =/ 0/ ,/ 1/ ,/ …/ ,/ i/ -/ 1/ ∑/ p/ =/ 0/ ,/ 1/ ,/ …/ ,/ i/ 由于/ f/ (/ j/ )/ 表示/ 第/ j/ 个/ 节点/ 的/ 访问/ 次数/ ,/ 且/ f/ (/ j/ )/ 为/ V/ (/ K/ +/ 1/ )/ -/ η/ 的/ 节点/ 个/ 数最多/ 为/ (/ K/ +/ 1/ )/ ×/ [/ (/ K/ +/ 1/ )/ ×/ V/ ]/ η/ ,/ 所以/ f/ (/ j/ )/ / V/ (/ K/ +/ 1/ )/ -/ i/ ./ 根据/ 等比数列/ 求和/ 公式/ :/ g/ ∑/ p/ =/ 0/ ,/ 1/ ,/ …/ ,/ ig/ (/ K/ +/ 1/ )/ ×/ [/ (/ K/ +/ 1/ )/ ×/ V/ ]/ i/ +/ 1/ -/ 1/ 根据/ g/ (/ x/ )/ 定义/ (/ g/ ∑/ p/ =/ 0/ ,/ 1/ ,/ …/ ,/ i/ 由于/ g/ (/ x/ )/ 是非/ 增函数/ :/ f/ (/ j/ )/ / V/ (/ K/ +/ 1/ )/ -/ i/ =/ (/ g/ ∑/ p/ =/ 0/ ,/ 1/ ,/ …/ ,/ i/ 推论/ 1/ ./ 证明/ ./ Cvi/ (/ S/ )/ / 2/ (/ k/ +/ 1/ )/ |/ S/ |/ 1/ -/ λ/ (/ lnV/ +/ ln/ (/ K/ +/ 1/ )/ )/ ×/ costvi/ ./ =/ V/ -/ K/ (/ A/ (/ K/ +/ 1/ )/ |/ S/ |/ )/ 1/ -/ λ/ -/ B1/ -/ λ/ =/ V/ (/ K/ +/ 1/ )/ (/ (/ V/ (/ K/ +/ 1/ )/ |/ S/ |/ -/ |/ S/ |/ +/ 1/ )/ 1/ -/ λ/ -/ 1/ )/ costvi/ 由于/ (/ V/ (/ K/ +/ 1/ )/ |/ S/ |/ -/ |/ S/ |/ +/ 1/ )/ / V/ (/ K/ +/ 1/ )/ |/ S/ |/ ,/ V/ (/ K/ +/ 1/ )/ 1/ -/ λ/ =/ (/ K/ +/ 1/ )/ ,/ V/ / 2/ ,/ K/ / 1/ ,/ 于是/ V/ ×/ (/ K/ +/ 1/ )/ V/ ×/ (/ K/ +/ 1/ )/ -/ 1/ / 4/ 因此/ :/ Cvi/ (/ S/ )/ / V/ (/ K/ +/ 1/ )/ [/ (/ K/ +/ 1/ )/ |/ S/ |/ 1/ -/ λ/ -/ 1/ ]/ [/ lnV/ +/ ln/ (/ K/ +/ 1/ )/ ]/ ×/ costvi/ / 2/ (/ k/ +/ 1/ )/ |/ S/ |/ 1/ -/ λ/ (/ lnV/ +/ ln/ (/ K/ +/ 1/ )/ )/ ×/ costvi/ ./ 证毕/ ./ Cve/ (/ S/ )/ / (/ k/ +/ 1/ )/ |/ S/ +/ 1/ |/ 1/ -/ λ/ (/ lnV/ +/ ln/ (/ K/ +/ 1/ )/ )/ ×/ costve/ ./ 5/ 实验/ 与/ 评价/ 同理/ 可得/ 本节/ 首先/ 对/ SDaaS/ 方法/ 与/ 现有/ 流/ 数据共享/ 和/ 重用/ 的/ 方法/ 进行/ 分析/ 对比/ ,/ 然后/ 从/ 性能/ 角度/ 比较/ 这/ 几种/ 方法/ 在/ 服务/ 响应/ 时间/ 和/ 系统/ 负载/ 方面/ 的/ 差别/ ./ 5.1/ 实验/ 数据/ 及/ 环境/ 本文/ 实验/ 使用/ 真实/ 的/ 交通/ 信息/ 数据/ 集及/ 模拟/ 数据/ 集/ ./ 近年来/ ,/ 本文/ 所在/ 团队/ 搜集/ 了/ 来自/ 市/ 交管局/ 的/ ANPR/ 数据/ (/ S1/ )/ 以及/ 来自/ 某/ 出租车/ 公司/ 的/ GPS/ 数据/ (/ S2/ )/ ./ 根据/ GPS/ 数据/ 集/ ,/ 我们/ 模拟/ 了/ GPS/ 数据/ 集/ ,/ 并/ 将/ 其/ 划分/ 为/ 某/ 公司/ 的/ GPS/ 数据/ 集/ (/ S3/ )/ 和/ 多个/ 私人/ 的/ GPS/ 数据/ (/ S4/ 等/ )/ ./ 表/ 2/ 展示/ 相应/ 的/ 交通/ 数据/ 集/ ./ 名称/ ANPR/ (/ S1/ )/ cid/ ,/ vid/ ,/ timeGPS/ (/ S2/ )/ GPS/ (/ S2/ )/ GPS/ (/ S4/ )/ 实验/ 在/ 拥有/ 5/ 个/ 节点/ 的/ 集群/ 上/ 进行/ ,/ 所有/ 节点均/ 为/ 装有/ CentOS/ -/ 6.4/ 的/ 虚拟机/ ,/ jdk/ 版本/ 为/ 1.70/ ./ 集群/ 所/ 使用/ 的/ Spark/ 版本/ 为/ 1.1/ ./ 0/ ,/ Hadoop/ 版本/ 为/ 2.3/ ./ 0/ ./ 集群/ 的/ 详细信息/ 见表/ 3/ ./ 其中/ 主/ 节点/ 、/ 工作/ 节点/ 1/ 及/ 工作/ 节点/ 2/ 作为/ 流/ 数据服务/ 实现/ 的/ 服务端/ ;/ 工作/ 节点/ 3/ 用来/ 模拟/ 传感/ 流/ 数据源/ ;/ 工作/ 节点/ 4/ 用来/ 模拟/ 应用/ 的/ 不同/ 请求/ ./ Page14/ 节点/ 角色/ 主/ 节点/ IntelXeonE312xx66/ 工作/ 节点/ 1IntelXeonE312xx66/ 工作/ 节点/ 2IntelXeonE312xx33/ 工作/ 节点/ 3IntelXeonE312xx33/ 工作/ 节点/ 4IntelXeonE312xx335/ ./ 2/ 服务/ 评价/ 指标/ 数据服务/ 进行/ 评价/ ./ 延迟/ (/ ServiceLatency/ ,/ SL/ )/ 可/ 被/ 定义/ 为/ 本文/ 参考文献/ [/ 31/ ]/ 定义/ 了/ 以下/ 几个/ 指标/ ,/ 对流/ (/ 1/ )/ 服务/ 延迟/ ./ 流/ 数据服务/ sds/ 对/ 用户/ i/ 的/ 平均/ 其中/ :/ tij/ _/ in/ 表示/ 服务/ 接入/ 数据/ 记录/ rij/ 的/ 时间/ ;/ tij/ _/ rec/ 表示/ 用户/ i/ 接收/ 到/ 数据/ 记录/ rij/ 的/ 时间/ ;/ n/ 为/ 用户/ i/ 接收/ 到/ 的/ 数据/ 记录/ 数目/ ./ 服务/ 延迟/ 由/ 两/ 部分/ 的/ 时间延迟/ 组成/ ,/ 分别/ 为/ 原始/ 的/ 流/ 数据服务/ 接入/ 流/ 数据服务/ 到/ 其/ 输出/ 新/ 的/ 流/ 数据/ 的/ 时间延迟/ 以及/ 流/ 数据服务/ 输出/ 流/ 数据/ 到/ 应用/ 获取/ 到/ 数据/ 的/ 时间延迟/ ./ (/ 2/ )/ 系统/ 负载/ ./ 系统/ 负载/ 指/ 用户/ 在/ 调用/ 流/ 数据服务/ sds/ 时/ 的/ 系统/ 负载/ 情况/ ,/ 主要/ 分为/ CPU/ ,/ 内存/ 以及/ 网络/ 的/ 负载/ 状况/ ./ (/ 3/ )/ 事件/ 匹配/ 率/ ./ 给定/ 流/ 数据服务/ sds/ ,/ 假定/ m/ 个/ 用户/ 同时/ 对/ 服务/ sds/ 进行/ 请求/ ,/ 其中/ ,/ 事件/ 匹配/ 率/ (/ EventMatchingRate/ ,/ EMR/ )/ 表示/ 流/ 数据服务/ 单位/ 时间/ 内/ (/ s/ )/ 能够/ 处理/ 的/ 事件/ 数目/ ./ 5.3/ 服务/ 效果/ 分析/ 为了/ 模拟/ 传感/ 流/ 数据/ 的/ 共享/ 和/ 重用/ ,/ 我们/ 选取/ 了/ 一天/ 的/ ANPR/ 数据/ 和/ GPS/ 数据/ 并/ 遵循/ 其/ 事件/ 约束/ 各自/ 随机/ 生成/ 1000/ 个/ 不同/ 的/ 订阅/ 请求/ ./ 我们/ 将/ 具有/ 相同/ 属性/ 的/ 订阅/ 请求/ 视为/ 一类/ 数据/ 需求/ ,/ 表/ 4/ 展示/ 了/ 订阅/ 请求/ 所/ 包含/ 的/ 数据/ 需求/ 种类/ 数目/ ./ 我们/ 按照/ 数据/ 记录/ 的/ 产生/ 时间/ 将/ 其/ 转换/ 为流/ 数据/ ,/ 然后/ 使用/ 不同/ 的/ 方式/ 实现/ 传感/ 流/ 数据/ 的/ 服务化/ ./ 现有/ 的/ 传感/ 流/ 数据/ 服务化/ 方法/ 主要/ 有/ :/ 采用/ 传统/ 服务/ 模型/ 的/ 服务化/ 方式/ (/ TS/ )/ [/ 5/ ]/ 、/ 基于/ 主题/ 的/ Pub/ // Sub/ 机制/ (/ TB/ _/ P/ // S/ )/ [/ 15/ ]/ 和/ 基于/ 内容/ 的/ Pub/ // Sub/ 机制/ (/ CB/ _/ P/ // S/ )/ [/ 16/ ]/ 的/ 服务化/ 实现/ 方式/ ./ 表/ 5/ 展示/ 了/ 使用/ 不同/ 服务化/ 方式/ 封装/ 服务/ 的/ 效果/ 分析/ ./ 服务化/ 方式/ 服务/ 数目/ 是否/ 需要/ 进一步/ 处理/ 数据/ DSaaSTB/ _/ P/ // SCB/ _/ P/ // S/ 采用/ 传统/ 服务/ 模型/ 的/ 服务化/ 方式/ 需要/ 为/ 每/ 一类/ 数据/ 需求/ 创建/ 一个/ 流/ 数据服务/ ,/ 基于/ 主题/ 或者/ 内容/ 的/ Pub/ // Sub/ 机制/ 需要/ 创建/ 4/ 个/ 主题/ 分别/ 对应/ 不同/ 的/ 传感/ 流/ 数据/ ./ 相/ 比较而言/ ,/ SDaaS/ 方法/ 仅/ 需要/ 创建/ 2/ 个/ 数据服务/ 犵/ 犲/ 狋/ 犃/ 犖/ 犘/ 犚/ 及/ 犻/ 狀/ 狋/ 犲/ 犌/ 犘/ 犛/ 便/ 可以/ 满足/ 不同/ 用户/ 的/ 订阅/ 请求/ ,/ 其中/ ,/ 犻/ 狀/ 狋/ 犲/ 犌/ 犘/ 犛/ 服务/ 对/ 原始/ 的/ 3/ 个/ GPS/ 数据/ 进行/ 了/ 融合/ 操作/ ,/ 输出/ 一个/ 完整/ 的/ GPS/ 数据流/ ./ 对于/ 基于/ 主题/ 的/ Pub/ // Sub/ 机制/ ,/ 它会/ 向/ 任/ 一个/ 主题/ 提交/ 订阅/ 请求/ 的/ 用户/ 都/ 会/ 获取/ 该/ 主题/ 上/ 的/ 所有/ 数据/ ,/ 用户/ 需要/ 对/ 其/ 获取/ 的/ 数据/ 进行/ 处理/ 才/ 能够/ 获取/ 其/ 需求/ 的/ 数据/ ./ 虽然/ 基于/ 内容/ 的/ Pub/ // Sub/ 机制/ 能够/ 向/ 用户/ 发送/ 其所/ 需/ 的/ 数据/ ,/ 但/ 对于/ 对/ 所有/ GPS/ 数据/ 都/ 有/ 需求/ 的/ 用户/ 来说/ ,/ 仍/ 需要/ 对/ 其/ 获取/ 的/ 数据/ 进行/ 融合/ 才能/ 得到/ 完整/ 的/ 数据/ ./ 相/ 比较而言/ ,/ 使用/ SDaaS/ 方法/ 用户/ 无需/ 对/ 其/ 获取/ 的/ 数据/ 进行/ 进一步/ 的/ 处理/ ./ 为了/ 验证/ SDaaS/ 方法/ 的/ 效果/ ,/ 我们/ 将/ 其/ 与/ 采用/ 传统/ 服务/ 模型/ 的/ 服务化/ 方式/ 进行/ 比较/ ,/ 以/ 检验/ SDaaS/ 是否/ 能够/ 按/ 需/ 的/ 将/ 数据/ 分/ 发给/ 不同/ 订阅/ 请求/ ./ 我们/ 首先/ 将/ 传感/ 流/ 数据/ 的/ 数据/ 频率/ 设为/ 1000Hz/ ,/ 将/ 用户/ 的/ 订阅/ 请求/ 数目/ 设置/ 为/ 250/ ,/ 分别/ 测试/ 在/ 订阅/ 请求/ 包含/ 不同/ 谓词/ 数目/ 情况/ 下/ ,/ 服务端/ 和/ 用户端/ 接收数据/ 量/ 的/ 情况/ ./ 实验/ 表明/ 在/ 相同/ 的/ 订阅/ 请求/ 数目/ 下/ ,/ 本文/ 的/ SDaaS/ 方法/ 和/ 采用/ 传统/ 服务/ 模型/ 的/ 服务化/ 方式/ 能够/ 接收/ 到/ 相同/ 的/ 数据/ ./ 此外/ ,/ 由于/ 用户/ 定义/ 在/ 同一个/ 服务/ 上/ 的/ 订阅/ 请求/ 并/ 不是/ 完全/ 独立/ 的/ ,/ 通过/ 对/ 服务/ 输出/ 事件/ 与/ 订阅/ 请求/ 的/ 匹配/ 过程/ 进行/ 优化/ ,/ 我们/ 可以/ 进一步提高/ 用户/ 获取数据/ 的/ 时效性/ ./ 在/ 本文/ 的/ 实验/ 环境/ 下/ ,/ 当/ 传感/ 流/ 数据/ 的/ 频率/ 设置/ 为/ 10000Hz/ 时/ ,/ 传统/ 的/ 服务/ 方式/ 在/ 单个/ 服务/ 节点/ 上仅/ 能/ 同时/ 支持/ 950/ 个/ 用户/ 的/ 订阅/ 请求/ ,/ 而/ SDaaS/ 方式/ 可以/ 支持/ 2697/ 个/ 订阅/ 请求/ ,/ 并且/ 服务/ 延迟/ 保持/ 在/ 30ms/ 以内/ ./ 5.4/ 服务/ 性能/ 评价/ 5.4/ ./ 1/ 请求/ 数目/ 对/ 服务/ 性能/ 的/ 影响/ 本/ 节/ 采用/ 传统/ 的/ 服务化/ 方式/ ,/ 基于/ 主题/ 及/ 基于/ 内/ Page15/ 容/ 的/ Pub/ // Sub/ 方式/ 作为/ 基准/ ,/ 与/ 本文/ 方法/ (/ SDaaS/ )/ 进行/ 了/ 对比/ ./ 我们/ 随机/ 选择/ 1000/ 条/ 订阅/ 请求/ ,/ 分别/ 利用/ 4/ 种/ 服务化/ 方式/ 获取数据/ ./ 对于/ Pub/ // Sub/ 机制/ ,/ 定义/ 在/ GPS/ 数据/ 上/ 的/ 订阅/ 请求/ 需要/ 同时/ 向/ 3/ 个/ GPS/ 源/ 提交/ 请求/ ./ 我们/ 将流/ 数据/ 的/ 频率/ 设置/ 为/ 10000Hz/ ,/ 订阅/ 请求/ 的/ 数目/ 设置/ 为/ 100/ 、/ 200/ 、/ 400/ 、/ 600/ 、/ 800/ 和/ 1000/ ,/ 分别/ 计算/ 4/ 种/ 方式/ 下/ 的/ 平均/ 服务/ 延迟/ 和/ 系统/ 负载/ ./ 图/ 8/ (/ a/ )/ 展示/ 了/ 服务/ 响应/ 时间/ 的/ 比较/ ,/ 可以/ 看出/ 基于/ 主题/ 的/ Pub/ // Sub/ 机制/ 具有/ 最低/ 的/ 服务/ 响应/ 时间/ ,/ 这/ 是因为/ 基于/ 主题/ 的/ Pub/ // Sub/ 机制/ 并/ 不/ 对/ 用户/ 的/ 订阅/ 请求/ 进行/ 任何/ 处理/ ,/ 直接/ 将/ 所有/ 的/ 数据/ 转发给/ 用户/ ,/ 因此/ 具有/ 最低/ 的/ 响应/ 时间/ ./ 图/ 8/ (/ b/ )/ 、/ (/ c/ )/ 、/ (/ d/ )/ 分别/ 展示/ 了/ 订阅/ 请求/ 数目/ 对系统/ 负载/ 的/ 影响/ ,/ 其中/ 由于/ TS/ ,/ TB/ _/ P/ // S/ 与/ DSaaS/ 方式/ 的/ 网络/ 负载/ 相同/ ,/ 因此/ 图/ 8/ (/ d/ )/ 中仅/ 展示/ 了/ DSaaS/ 的/ 变化/ 曲线/ ./ 由图/ 8/ (/ b/ )/ 、/ (/ c/ )/ 可以/ 看出/ 基于/ 传统/ 服务/ 模型/ 的/ 服务化/ 图/ 8/ 订阅/ 请求/ 数目/ 对流/ 数据服务/ 性能/ 的/ 影响/ 5.4/ ./ 2/ 事件/ 匹配/ 算法/ 对/ 服务/ 性能/ 的/ 影响/ 本文/ 中/ 的/ 事件/ 匹配/ 方法/ 是/ 保障/ 流/ 数据服务/ 能够/ 高效/ 的/ 将/ 数据/ 分/ 发给/ 不同/ 应用/ 的/ 关键/ ,/ 本节/ 对/ 本文/ 采用/ 的/ 事件/ 匹配/ 方法/ (/ ImprovedTree/ )/ 与/ 普通/ 的/ 匹配/ 树/ (/ NormalTree/ )/ [/ 21/ ]/ ,/ 谓词/ 索引/ 算法/ (/ PreIndex/ )/ [/ 28/ ]/ 以及/ 简单/ 的/ 事件/ 匹配/ 方法/ (/ BruteForce/ )/ 进行/ 比较/ ./ 方法/ 具有/ 最高/ 的/ 内存/ 和/ CPU/ 负载/ ,/ 这/ 是因为/ 这种/ 方式/ 对于/ 每/ 一个/ 订阅/ 请求/ 都/ 要/ 建立/ 一个/ 服务/ 实例/ 来/ 进行/ 相应/ 的/ 处理/ ,/ 每个/ 服务/ 处理/ 之间/ 是/ 彼此/ 独立/ 的/ ./ 由图/ 8/ (/ d/ )/ 可以/ 看出/ ,/ 基于/ 主题/ 的/ Pub/ // Sub/ 机制/ 具有/ 最高/ 的/ 网络/ 负载/ ./ 这/ 是因为/ 基于/ 主题/ 的/ Pub/ // Sub/ 机制/ 需要/ 将/ 所有/ 的/ 数据/ 转发给/ 用户/ ,/ 而/ 其他/ 方法/ 可以/ 仅/ 向/ 用户/ 传输/ 其所/ 需要/ 的/ 数据/ ,/ 因此/ 基于/ 主题/ 的/ Pub/ // Sub/ 机制/ 具有/ 更/ 高/ 的/ 网络/ 负载/ ,/ 而且/ 用户/ 还/ 需要/ 对/ 其/ 获取/ 的/ 数据/ 进行/ 进一步/ 的/ 处理/ ./ 基于/ 内容/ 的/ Pub/ // Sub/ 机制/ 和/ DSaaS/ 方法/ 具有/ 较/ 低/ 的/ 系统/ 负载/ 和/ 较/ 少/ 的/ 服务/ 响应/ 时间/ ,/ 其中/ 由于/ DSaaS/ 方法/ 采用/ 了/ 更/ 高效/ 的/ 事件/ 匹配/ 机制/ 和/ 分布式/ 的/ 数据处理/ 框架/ ,/ 因此/ 具有/ 更/ 高/ 的/ 效率/ 和/ 较/ 低/ 的/ 系统/ 负载/ ./ 在/ 1000/ 个/ 并发/ 订阅/ 请求/ 的/ 情况/ 下/ ,/ 服务/ 响应/ 时间/ 一直/ 维持/ 在/ 20ms/ 以内/ ./ 实验/ 说明/ SDaaS/ 方法/ 能够/ 支持/ 在/ 多用户/ 并发/ 请求/ 的/ 情况/ 下/ 在/ 毫秒/ 级别/ 内/ 将/ 数据/ 发送给/ 相应/ 用户/ ./ 为了/ 能够/ 应对/ 大规模/ 的/ 应用/ 并发/ 的/ 向/ 流/ 数据服务/ 发起/ 订阅/ 请求/ ,/ 本文/ 还/ 实现/ 了/ 事件/ 匹配/ 方法/ 的/ 并行/ 化/ ,/ 并/ 与/ 基于/ 子/ 匹配/ 树/ 数目/ 均匀/ 划分/ 的/ 策略/ 进行/ 比较/ ./ 我们/ 首先/ 将流/ 数据服务/ 输出/ 的/ 流/ 数据/ 频率/ 设置/ 为/ 10000Hz/ ,/ 订阅/ 请求/ 数目/ 设为/ 100/ ,/ 比较/ 在/ 订阅/ 请求/ 包含/ 的/ 谓词/ 数目/ 对/ 不同/ 事件/ 匹配/ 方法/ 效率/ 的/ 影/ Page16/ 响/ ./ 然后/ 将/ 订阅/ 请求/ 包含/ 的/ 谓词/ 数目/ 设为/ 6/ ,/ 比较/ 不同/ 数目/ 的/ 订阅/ 请求/ 对/ 事件/ 匹配/ 算法/ 效率/ 的/ 影响/ ./ 最后/ 我们/ 将/ 订阅/ 请求/ 的/ 数目/ 设置/ 为/ 1000/ ,/ 比较/ 两种/ 不同/ 的/ 并行/ 化/ 方式/ 的/ 事件/ 匹配/ 率/ ./ 如图/ 9/ (/ a/ )/ 、/ (/ b/ )/ 所示/ ,/ 当/ 订阅/ 请求/ 数目/ 或者/ 订阅/ 请求/ 包含/ 谓词/ 数目/ 较大/ 时/ ,/ BruteForce/ 算法/ 的/ 效率/ 最低/ ,/ 普通/ 的/ 匹配/ 树/ 和/ 谓词/ 索引/ 分别/ 在/ 订阅/ 请求/ 数目/ 较大/ 和/ 谓词/ 数目/ 较大/ 时/ 效率/ 次/ 低/ ./ 本文/ 采用/ 的/ 改进/ 的/ 匹配/ 树/ 的/ 事件/ 匹配/ 算法/ 由于/ 采用/ 了/ 多级/ 索引/ 结构/ ,/ 利用/ 谓词/ 之间/ 的/ 关系/ 减少/ 了/ 不必要/ 的/ 匹配/ 使得/ 该/ 算法/ 的/ 效率/ 在/ 不同/ 的/ 谓词/ 数目/ 和/ 不同/ 的/ 订阅/ 请求/ 数目/ 下均/ 具有/ 较/ 高/ 的/ 事件/ 匹配/ 率/ ./ 如图/ 9/ (/ c/ )/ 所示/ ,/ 随着/ 并行度/ 的/ 增加/ ,/ 两种/ 并行/ 化/ 方式/ 下/ 的/ 事件/ 匹配/ 率均/ 得到/ 提高/ ,/ 而/ 基于/ 谓词/ 的/ 划分/ 策略/ 具有/ 更/ 高/ 的/ 事件/ 匹配/ 率/ ./ 这/ 是因为/ 不同/ 的/ 子/ 匹配/ 树所/ 包含/ 的/ 谓词/ 数目/ 并不相同/ ,/ 简单/ 的/ 将/ 所有/ 的/ 子/ 匹配/ 树/ 均匀/ 的/ 划分/ 不能/ 保证/ 每个/ 分块/ 中/ 的/ 事件/ 匹配/ 过程/ 的/ 均衡/ ./ 然而/ ,/ 虽然/ 相/ 比较/ 对子/ 匹配/ 树/ 均匀/ 的/ 划分/ 来说/ ,/ 本文/ 的/ 划分/ 策略/ 能够/ 保证/ 每个/ 分块/ 中/ 包含/ 近似/ 数目/ 的/ 谓词/ ,/ 却/ 仍/ 不能/ 保证/ 分块/ 中/ 进行/ 访问/ 验证/ 的/ 谓词/ 节点/ 数目/ 的/ 均衡/ ./ 在/ 后期/ 工作/ 中/ 我们/ 会/ 针对/ 该/ 问题/ 对/ 划分/ 策略/ 进行/ 进一步/ 的/ 优化/ ./ 6/ 总结/ 为了/ 实现/ 传感/ 流/ 数据/ 在/ 不同/ 应用/ 之间/ 的/ 共享/ 和/ 重用/ ,/ 本文/ 提出/ 了/ 一种/ 面向/ 传感/ 流/ 数据/ 的/ 服务化/ 建模/ 方法/ SDaaS/ ,/ 能够/ 在/ 流/ 数据源/ 和/ 应用/ 系统/ 之间/ 部署/ 可/ 配置/ 的/ 流/ 数据服务/ ,/ 并/ 借鉴/ Pub/ // Sub/ 机制/ 实现/ 传感/ 流/ 数据/ 的/ 按/ 需/ 分发/ ./ 本文/ 基于/ SparkStreaming/ 实现/ 了/ 对流/ 数据/ 加工/ 操作/ 的/ 封装/ ,/ 能够/ 对/ 原始/ 流/ 数据/ 进行/ 转换/ 融合/ ,/ 以/ 服务/ 的/ 方式/ 公布/ 给/ 外界/ ;/ 由于/ 借鉴/ 基于/ 内容/ 的/ Pub/ // Sub/ 系统/ ,/ 相/ 比较/ 于/ 传统/ 的/ 服务/ 模型/ ,/ 能够/ 更好/ 的/ 实现/ 流/ 数据服务/ 的/ 重用/ ,/ 减少/ 系统/ 需要/ 维护/ 的/ 服务/ 数量/ ;/ 对/ 传统/ 匹配/ 数/ 算法/ 进行/ 了/ 改进/ 并/ 实现/ 了/ 高效/ 的/ 流/ 数据/ 内容/ 分发/ ./ 实验/ 验证/ 了/ 流/ 数据服务/ 能够/ 实现/ 对/ 不同/ 应用/ 请求/ 实时/ 、/ 按/ 需/ 的/ 发送数据/ ,/ 相比/ 于/ 现有/ 的/ 服务化/ 方法/ 具有/ 更/ 高/ 的/ 时效性/ 和/ 更/ 低/ 的/ 系统/ 负载/ ./ 

