Page1/ 基于/ MDP/ 的/ 服务/ 不确定性/ 自/ 适应/ 决策/ 方法/ 王忠杰/ 郑伟/ 徐晓飞/ 初/ 佃辉/ (/ 哈尔滨工业大学/ 计算机科学/ 与/ 技术/ 学院/ 哈尔滨/ 150001/ )/ 摘要/ 服务/ 系统/ 运行/ 中因/ 环境/ 变化/ 而/ 面临/ 各种/ 不确定性/ 事件/ ,/ 导致/ 期望/ 价值/ 无法/ 完全/ 实现/ ./ 有/ 多种/ 应对/ 不确定性/ 的/ 策略/ ,/ 不同/ 的/ 策略/ 导致/ 服务/ 最终/ 成功/ 执行/ 的/ 概率/ 不同/ ,/ 所/ 导致/ 的/ 质量/ 变化/ (/ 时间延迟/ 、/ 成本/ 溢出/ 等/ )/ 也/ 不同/ ,/ 需要/ 寻求/ 最优/ 的/ 应对/ 策略/ ,/ 使/ 不确定性/ 造成/ 的/ 损失/ 和/ 应对/ 策略/ 所/ 付出/ 的/ 代价/ 最小/ ./ 对/ 不确定性/ 事件/ 和/ 相应/ 的/ 应对/ 策略/ 进行/ 了/ 分类/ ,/ 根据/ 流程/ 结构/ 定义/ 服务/ 执行/ 中/ 的/ 各种/ 状态/ ,/ 采用/ 不确定性/ 触发/ 关系/ 图/ (/ UTG/ )/ 刻画/ 状态/ 与/ 决策/ 动作/ 之间/ 的/ 关系/ ,/ 进而/ 采用/ Markov/ 决策/ 过程/ (/ MDP/ )/ 进行/ 最优/ 策略/ 的/ 选择/ ./ 通过/ 仿真/ 实验/ 验证/ 了/ 方法/ 的/ 有效性/ ,/ 并/ 给出/ 了/ 影响/ 决策/ 效果/ 的/ 若干/ 因素/ ./ 关键词/ 运行/ 时/ 服务/ ;/ 不/ 确定/ 事件/ ;/ 自/ 适应/ 决策/ ;/ Markov/ 决策/ 过程/ ;/ 仿真/ 实验/ 1/ 引言/ 服务/ 计算/ 的/ 哲理/ 之一/ 是/ 利用/ 互联网/ 上/ 的/ 海量/ 候/ Page2/ 方/ 期望/ 的/ 价值/ 无法/ 完全/ 实现/ ,/ 还/ 可能/ 触发/ 其它/ 更/ 多/ 的/ 不确定性/ 事件/ ,/ 造成/ 各种/ 直接/ 和/ 潜在/ 的/ 影响/ ./ 本文/ 将/ “/ 不确定性/ ”/ 定义/ 为/ “/ 某个/ 已经/ 或/ 即将/ 发生/ 的/ 事件/ ,/ 它/ 使得/ 服务/ 实际/ 执行/ 结果/ 与/ 预先/ 达成/ 的/ 服务/ 级别/ 协议/ (/ ServiceLevelAgreement/ ,/ SLA/ )/ 之间/ 产生/ 了/ 偏差/ ”/ ./ 服务/ 执行/ 中/ 典型/ 的/ 不确定性/ 事件/ 包括/ :/ (/ 1/ )/ 某个/ 服务/ 环节/ 执行/ 之后/ 未/ 达到/ 期望/ 的/ 质量/ (/ QualityofService/ ,/ QoS/ )/ ;/ (/ 2/ )/ 某个/ 服务/ 环节/ 执行/ 失败/ ;/ (/ 3/ )/ 客户/ 需求/ 发生/ 变更/ 或/ 取消/ ;/ (/ 4/ )/ 可用/ 服务/ // 资源/ 的/ 数量/ 或/ 价格/ 发生/ 波动/ ;/ (/ 5/ )/ 外部/ 商业/ 环境/ 或/ 政策/ 发生变化/ ;/ 等等/ ./ 从/ 发生/ 时间/ 看/ ,/ 不确定性/ 事件/ 分为/ 已经/ 发生/ 并/ 已/ 造成/ 影响/ 的/ 事件/ 和/ 预测/ 可能/ 发生/ 但/ 尚未/ 发生/ 的/ 事件/ ./ 为了/ 应对/ 不确定性/ ,/ 核心/ 策略/ 就是/ “/ 按/ 需/ 应变/ ”/ :/ 根据/ 预期/ 或/ 已经/ 发生/ 的/ 不确定性/ 事件/ 对/ 服务/ 做出/ 调整/ ./ 这里/ 的/ “/ 变/ ”/ 即/ 各种/ 不确定性/ 事件/ ,/ “/ 应/ ”/ 即/ 所/ 采取/ 的/ 对策/ ,/ 而/ “/ 需/ ”/ 则/ 是/ 指/ 在/ 决定/ 采取/ 何种/ 对策/ 时应/ 考虑/ 客户/ // 提供者/ 的/ 特征/ ./ 按/ 需/ 应变/ 的/ 目标/ 是/ :/ 以/ 最小/ 的/ 代价/ ,/ 使/ 不确定性/ 造成/ 的/ 损失/ 最小化/ ./ 由于/ 不确定性/ 的/ 动态性/ ,/ 所/ 采取/ 的/ 应对/ 策略/ 也/ 不/ 可能/ 是/ 提前/ 计划/ 好/ 的/ 静态/ 策略/ ,/ 需要/ 根据/ 服务/ 执行/ 时/ 的/ 具体情况/ 选取/ 最优/ 的/ 应对/ 策略/ ./ 该/ 基本思路/ 如图/ 1/ 所示/ ./ 在/ 服务/ 执行/ 过程/ 中/ ,/ 对/ 各类/ 不确定性/ 事件/ 可能/ 有/ 多种/ 处理/ 对策/ (/ 重试/ 、/ 补偿/ 、/ 重组/ 、/ 替换/ 等/ )/ ,/ 不同/ 对策/ 对/ 服务/ 的/ 影响/ 不同/ ./ 如何/ 以/ 最小/ 的/ 代价/ 使/ 服务/ 回到/ 期望/ 轨道/ ,/ 需要/ 做出/ 最优/ 的/ 选择/ ./ 另外/ ,/ 由于/ 不确定性/ 是/ 可/ 传播/ 的/ ,/ 选择/ 决策/ 时/ 不能/ 仅/ 考虑/ 到/ 对/ 当前/ 环节/ 的/ 优化/ ,/ 还/ 需要/ 考虑/ 到/ 它/ 对/ 未来/ 的/ 长期/ 影响/ ,/ 从而/ 达到/ 整体/ 最优/ ,/ 因此/ 这是/ 一个/ 长期/ 的/ 动态/ 决策/ 过程/ ./ 本文/ 根据/ 软件/ 层面/ 的/ 服务/ (/ 例如/ WebService/ )/ 执行/ 中/ 发生/ 的/ 具体/ 不确定性/ ,/ 利用/ 不确定性/ 触发/ 关系/ 图/ (/ UTG/ )/ 刻画/ 不确定性/ 事件/ 所/ 导致/ 的/ 服务/ 状态/ 以及/ 所/ 采取/ 的/ 决策/ 动作/ 之间/ 的/ 转换/ 关系/ ,/ 以/ 服务/ 成功/ 执行/ 的/ 概率/ 最大/ 、/ 时间延迟/ 最小/ 、/ 成本/ 最低/ 作为/ 决策/ 优化/ 的/ 目标/ ,/ 建立/ 基于/ Markov/ 决策/ 过程/ (/ MDP/ )/ 的/ 不确定性/ 优化/ 决策/ 模型/ 并/ 加以/ 求解/ ,/ 生成/ 对/ 当前/ 服务/ 方案/ 的/ 最优/ 改进/ 策略/ ./ 限于/ 篇幅/ ,/ 本文/ 方法/ 定位/ 在/ 软件/ 服务/ 层面/ 的/ 不确定性/ 决策/ ,/ 并/ 将/ 已/ 发生/ 和/ 尚未/ 发生/ 的/ 不确定性/ 事件/ 统一/ 看待/ ./ 2/ 服务/ 不确定性/ 决策/ 的/ 相关/ 研究/ 在/ 按/ 需/ 服务/ 环境/ 中/ ,/ 服务/ 执行/ 之前/ 供需双方/ 在/ 性能/ 、/ 可靠性/ 和/ 可用性/ 等/ QoS/ 方面/ 达成/ 服务/ 级别/ 协议/ (/ SLA/ )/ ./ 目前/ 得以/ 广泛应用/ 的/ WebServiceLevelAgreement/ (/ WSLA/ )/ 是/ 一种/ 用于/ 定义/ 和/ 监测/ Web/ 服务/ 的/ SLA/ 描述语言/ 和/ 框架/ [/ 1/ ]/ ,/ 为/ SLA/ 的/ 建模/ 、/ 扩展/ 、/ 度量/ 和/ 监控/ 提供/ 支持/ ./ 文献/ [/ 2/ -/ 4/ ]/ 对/ 服务/ 运行/ 时/ 可能/ 发生/ 的/ 不确定性/ 进行/ 了/ 不同/ 角度/ 的/ 分类/ ,/ 从/ 不确定性/ 发生/ 的/ 层次/ (/ 应用/ 层面/ 、/ 服务/ 层面/ 、/ 基础设施/ // 中间件/ 层面/ )/ 、/ 不确定性/ 发生/ 时/ 的/ 表现/ (/ 服务/ // 数据/ 缺失/ 、/ 非/ 期望/ 的/ 服务/ 行为/ 、/ 性能/ 问题/ 、/ 协议/ 违反/ )/ 等/ 方面/ 阐述/ 了/ 不确定性/ 的/ 含义/ ,/ 通过/ 基于/ SLA/ 的/ 风险/ 度量/ 与/ 估算/ 方法/ 协助/ 发现/ 不确定性/ 及其/ 影响/ [/ 5/ ]/ ./ 服务/ 不确定性/ 与其/ 可靠性/ 息息相关/ ,/ 因此/ 可/ 采用/ 可靠性/ 保障/ 的/ 方法/ 来/ 解决/ Web/ 服务/ 中/ 的/ 不确定性/ 问题/ [/ 6/ ]/ ,/ 在/ 最初/ 构建/ 服务/ 方案/ 时/ 就/ 考虑/ 可能/ 面临/ 的/ 风险/ ,/ 将/ 可靠性/ 、/ 不确定性/ 等/ 因素/ 加入/ 到/ 服务/ 选择/ 与/ 服务/ 组合/ 模型/ // 算法/ 中/ ,/ 以/ 降低/ 未来/ 执行/ 中/ 的/ 风险/ ./ 使用/ 随机/ Petri/ 网等/ 工具/ 对/ Web/ 服务/ 组合/ 方案/ 进行/ 建模/ 并/ 计算/ 其/ 可靠性/ [/ 7/ ]/ ,/ 或者/ 将/ 服务/ 发生/ 风险/ 时/ 的/ 依赖/ 关系/ 作为/ 服务/ 组合/ 的/ 可靠性/ 优化/ 依据/ [/ 8/ ]/ ,/ 通过/ Markov/ 决策/ 过程/ (/ MDP/ )/ 等/ 方法/ 来/ 选择/ 最/ 符合/ 客户/ 风险/ 偏好/ 的/ 可靠/ 服务/ [/ 9/ -/ 10/ ]/ ./ 为了/ 在/ 服务/ 执行/ 产生/ 不/ 确定/ 事件/ 时/ 能够/ 通过/ 恢复/ 机制/ 来/ 保障/ 可靠性/ [/ 11/ ]/ ,/ 可/ 基于/ 冗余/ 策略/ 预先/ 配置/ 备用/ 服务/ 或/ 多个/ 替代/ 配置/ 方案/ (/ 配置/ 树/ 、/ 执行/ 计划/ )/ 来/ 提升/ 服务/ 方案/ 的/ 容错/ 能力/ [/ 12/ ]/ ,/ 目标/ 是/ 使/ 服务/ 方案/ 具备/ 自我/ 治愈/ 的/ 能力/ [/ 4/ ]/ ./ 当/ 现有/ 服务/ 无法/ 正常/ 执行/ 时/ 直接/ 由/ 备选/ 服务/ 接替/ 执行/ ,/ 也/ 可/ 采用/ 备选/ 流程/ 的/ 方式/ ,/ 在/ 当前/ 流程/ 出现/ 问题/ 时/ 直接/ 切换/ 到/ 备选/ 流程/ ./ 为此/ 需在/ 服务/ 建模/ 阶段/ 考虑/ 各种/ 不确定性/ ,/ 对/ 建模/ 元素/ 的/ 实现/ 机制/ 和/ 应用/ 场景/ 进行/ 扩展/ 以/ 提高/ 模型/ 描述/ 能力/ 和/ 适应性/ [/ 13/ ]/ ./ 服务/ 执行/ 过程/ 中/ 的/ 典型/ 动态/ 自/ 适应/ 策略/ 包括/ :/ 服务/ 替换/ 、/ 服务/ 重组/ 等/ 服务/ 重/ 配置/ 方法/ 、/ 恢复/ 与/ 补偿/ 机制/ 等/ 策略/ [/ 14/ ]/ ,/ 进而/ 在/ 运行/ 基础设施/ 层面/ 加以/ 支持/ [/ 15/ ]/ ./ 服务/ 替换/ 考虑/ 服务/ 的/ 功能/ 和/ 非/ 功能/ 特性/ ,/ 基于/ 服务/ 的/ 参数/ 类型/ 等/ 静态/ 属性/ 和/ 动态/ 行为/ 特性/ 的/ 匹配/ 保证/ 替换/ 前后/ 服务/ 过程/ 功能/ 的/ 一致性/ ,/ 基于/ 客户/ Page3/ 的/ QoS/ 偏好/ 对/ 服务/ 效用/ 进行/ 度量/ 来/ 保证/ 和/ 优化/ 替换/ 后/ 的/ 服务质量/ [/ 16/ ]/ ,/ 并/ 引入/ context/ 对/ 服务/ 的/ 可/ 替换/ 性/ 进行/ 判断/ [/ 17/ ]/ ./ 服务/ 重组/ 分为/ 服务/ 的/ 大规模/ 重/ 选取/ 和/ 服务/ 路径/ 的/ 重/ 规划/ ./ 文献/ [/ 18/ ]/ 使用/ 服务/ 片段/ 作为/ 重/ 规划/ 的/ 基本/ 单元/ 以/ 提升/ 效率/ ./ 文献/ [/ 19/ ]/ 提出/ 了/ 一组/ 系统化/ 的/ 原则/ 和/ 指南/ ,/ 指导/ 设计者/ 如何/ 构造/ // 重/ 规划/ 适应/ 变化/ 的/ 服务/ ./ 为/ 降低/ 重组/ 代价/ ,/ 对/ 服务/ 过程/ 内/ 处于/ 不同/ 执行/ 状态/ 的/ 部分/ 进行/ 划分/ ,/ 每次/ 尝试/ 都/ 期望/ 在/ 尽量/ 小/ 范围/ 内/ 弥补/ 不确定性/ 产生/ 的/ 后果/ ,/ 并/ 在/ 尝试/ 失败/ 后/ 逐渐/ 扩大/ 重组/ 范围/ [/ 20/ ]/ ./ 还/ 可/ 使用/ 修补/ 技术/ 对/ 当前/ 服务/ 组合/ 方案/ 进行/ 改变/ 和/ 增强/ ,/ 使/ 之/ 适应/ 各类/ 故障/ [/ 21/ ]/ ./ 还/ 可/ 根据/ 服务/ 执行/ 反馈/ 的/ 状况/ ,/ 采用/ 持续/ 规划/ 方式/ [/ 22/ ]/ ,/ 以/ 适应/ 执行/ 过程/ 中/ 出现/ 的/ 各类/ 不/ 确定/ 情况/ ./ 归纳起来/ ,/ 目前/ 对/ 服务/ 不确定性/ 决策/ 的/ 研究/ 分为/ 两类/ :/ (/ 1/ )/ 建模/ 阶段/ 对/ 服务/ 模型/ 进行/ 抗/ 风险/ 能力/ 的/ 增强/ ,/ 一旦/ 运行/ 时/ 发现/ 问题/ 即/ 按/ 预案/ 进行/ 应对/ ;/ (/ 2/ )/ 运行/ 阶段/ 对/ 相关/ 服务/ 进行/ 替换/ 、/ 重组/ 或/ 修补/ ,/ 并/ 确保操作/ 前后/ 服务/ 功能/ 和/ QoS/ 的/ 一致性/ ./ 尚有/ 两点/ 不足/ :/ (/ 1/ )/ 关注/ 替换/ 、/ 重组/ 、/ 修补/ 等/ 单一/ 决策/ 动作/ 如何/ 操作/ 、/ 如何/ 实施/ ,/ 对/ 哪种/ 动作/ 的/ 效果/ 最优/ 考虑/ 不足/ ;/ (/ 2/ )/ 决策/ 目标/ 定位/ 在/ 服务/ 功能/ 的/ 相容性/ 和/ QoS/ 的/ 可/ 保障性/ ,/ 较少/ 从/ 经济/ 角度/ 考虑/ 不确定性/ 带来/ 的/ 时间/ 和/ 成本/ 方面/ 的/ 损失/ ./ 本文/ 尝试/ 从/ 这两点/ 入手/ 展开/ 研究/ ,/ 试图/ 将/ 服务/ 层面/ 的/ 不确定性/ 与/ 业务/ 层/ 目标/ 结合/ 起来/ ,/ 寻求/ 处理/ 不确定性/ 的/ 最优/ 决策/ 动作/ ./ 3/ 服务/ 不确定性/ 事件/ 及/ 状态/ 模型/ 3.1/ 服务/ 方案/ 使用/ 服务/ 流程/ 表示/ 当前/ 执行/ 中/ 的/ 服务/ 方案/ ,/ 表示/ 为/ SPlan/ =/ (/ A/ ,/ E/ ,/ fc/ ,/ dc/ )/ ,/ 其中/ ,/ A/ =/ {/ a1/ ,/ a2/ ,/ …/ ,/ an/ }/ 是/ 活动/ 集合/ ,/ 每个/ 活动/ ai/ =/ (/ CSi/ ,/ Si0/ ,/ LSTi/ ,/ LETi/ )/ ,/ Si0/ 为/ 当前/ 被/ 选中/ 用于/ 执行/ 该/ 活动/ 的/ 具体/ 服务/ ,/ CSi/ =/ {/ Si1/ ,/ Si2/ ,/ …/ }/ 表示/ 活动/ 的/ 可/ 替换/ 服务/ 集/ ,/ LSTi/ 表示/ 最/ 晚/ 开始/ 时间/ ,/ LETi/ 为/ 最晚/ 结束/ 时间/ ./ / Sij/ ∈/ CSi/ ∪/ {/ Si0/ }/ ,/ Sij/ =/ (/ SIDij/ ,/ Tij/ ,/ Cij/ ,/ Rij/ )/ ,/ 其中/ 各个/ 分量/ 分别/ 表示/ 候选/ 服务/ Sij/ 的/ ID/ 和/ QoS/ 信息/ (/ 执行/ 时间/ 、/ 耗费/ 成本/ 、/ 可靠性/ )/ ./ 本文/ 站/ 在/ 顾客/ 角度/ 看待/ 服务/ ,/ 这里/ 的/ 执行/ 时间/ 是/ 服务/ 执行/ 所/ 消耗/ 的/ 时间/ ,/ 成本/ 指/ 顾客/ 为/ 调用/ 此/ 服务/ 所/ 需要/ 支付/ 的/ 费用/ (/ 而/ 非/ 是/ 指/ 服务/ 运行/ 的/ 资源/ 消耗/ ,/ 如/ CPU/ 、/ 存储/ 等/ )/ ,/ 可靠性/ 则/ 为/ 服务/ 成功/ 执行/ 的/ 概率/ ;/ E/ =/ {/ e1/ ,/ e2/ ,/ …/ ,/ em/ }/ 是/ 活动/ 之间/ 的/ 时序/ 依赖/ 关系/ ./ 服务/ 流程/ 中/ 存在/ 各种/ 复杂/ 结构/ 关系/ ,/ 本文/ 考虑/ 串行/ 与/ 并行/ 两种/ 基本/ 关系/ ,/ 使用/ e/ =/ (/ ai/ ,/ aj/ )/ 表示/ 活动/ aj/ 需在/ ai/ 执行/ 完成/ 后/ 才能/ 开始/ 执行/ ;/ fc/ 表示/ 服务/ 若/ 执行/ 失败/ ,/ 提供/ 方/ 需要/ 支付/ 给/ 客户/ 的/ 补偿金/ ;/ dc/ 表示/ 服务/ 若/ 执行/ 延期/ ,/ 每/ 单位/ 时间延迟/ 需要/ 支付/ 给/ 客户/ 的/ 补偿金/ ./ 3.2/ 服务/ 执行/ 过程/ 中/ 的/ 事件/ 本文/ 关注/ 的/ 是/ 服务/ 执行/ 过程/ 中/ 从/ 外界/ 可/ 观测/ 到/ 的/ 事件/ ,/ 即/ 站/ 在/ 服务/ 使用者/ 的/ 角度观察/ 系统/ 的/ 运行/ 状态/ ,/ 而/ 不/ 关心/ 服务/ 执行/ 环境/ 内部/ 是/ 何种/ 原因/ 而/ 产生/ 的/ 事件/ ./ 这/ 是因为/ ,/ 服务/ 方案/ 通常/ 是/ 由/ 服务/ 中介方/ 负责/ 构建/ 的/ ,/ 但/ 方案/ 中/ 使用/ 的/ 各/ 服务/ 并/ 不/ 受/ 其/ 控制/ ,/ 故/ 只能/ 从/ 外部/ 观察/ ./ 若站/ 在/ 服务提供者/ 的/ 角度/ 看待/ 服务/ 的/ 运行/ 状态/ ,/ 则/ 可以/ 观测/ 到/ 服务/ 执行/ 内部/ 的/ 运行/ 情况/ ,/ 例如/ :/ 站/ 在/ 云/ 计算/ 服务提供商/ 的/ 角度/ ,/ 若/ 服务/ 出现/ 故障/ ,/ 则/ 可以/ 观测/ 到/ 其/ 不确定性/ 事件/ 的/ 产生/ 原因/ ,/ 也许/ 是/ 主机/ 宕机/ ,/ 又/ 可能/ 是/ 停电/ 了/ ;/ 但/ 若/ 站/ 在/ 服务提供者/ 的/ 角度/ ,/ 则/ 顾客/ 观测/ 到/ 的/ 只是/ 服务商/ 无法/ 继续/ 提供/ 计算/ 服务/ ,/ 服务/ 不可/ 用/ 了/ ,/ 而/ 并/ 不/ 关心/ 也/ 无需/ 关心/ 服务/ 内部/ 产生/ 不确定性/ 事件/ 的/ 原因/ ,/ 因为/ 顾客/ 只/ 关心/ 自己/ 需求/ 的/ 服务/ 可以/ 被/ 正常/ 执行/ ./ 这/ 正是/ 本文/ 选择/ 站/ 在/ 服务/ 使用者/ (/ 顾客/ )/ 的/ 角度/ 来/ 观察/ 系统/ 运行/ 状态/ 的/ 原因/ ./ 事件/ 可/ 表示/ 为/ event/ =/ (/ t/ ,/ a/ ,/ EType/ )/ ,/ 其中/ ,/ t/ 为/ 事件/ 发生/ 的/ 时刻/ ;/ a/ 为/ 事件/ 所/ 涉及/ 的/ 活动/ ;/ EType/ 表示/ 事件/ 的/ 类型/ ./ 考虑/ 事件/ 的/ 类型/ EType/ ./ 服务/ 执行/ 过程/ 中/ 产生/ 的/ 事件/ 分为/ 两大类/ :/ 正常/ 事件/ 、/ 不确定性/ 事件/ ./ 前者/ 是/ 一个/ 服务/ 按计划/ 正常/ 开始/ 和/ 正常/ 执行/ 结束/ 时所/ 发出/ 的/ ,/ 后者/ 表征/ 了/ 活动/ 未/ 按/ 预期/ 开始/ 或/ 结束/ ,/ 或者/ 执行/ 失败/ ./ 按照/ 事件/ 触发/ 的/ 机制/ ,/ 可/ 分为/ 以下/ 3/ 类/ :/ (/ 1/ )/ 由/ 定时器/ 所/ 触发/ 的/ 事件/ ,/ 表示/ 某/ 活动/ ai/ 未/ 在/ 期望/ 时间/ 点上/ 开始/ 执行/ 或/ 执行/ 完成/ ./ 服务/ 执行/ 引擎/ 根据/ 服务/ 方案/ 中为/ 每个/ 活动/ 预设/ 的/ 最晚/ 开始/ 和/ 最晚/ 结束/ 时刻/ 对/ 服务/ 执行/ 进行/ 监控/ ,/ 如果/ 到达/ LSTi/ 或/ LETi/ 时刻/ 活动/ 未能/ 开始/ 或/ 结束/ ,/ 将/ 发出/ 以下/ 两类/ 事件/ :/ E01/ :/ ai/ 在/ 当前/ 时刻/ t/ 未/ 开始/ 执行/ ,/ 满足/ t/ >/ LSTi/ +/ δ/ (/ δ/ 是/ 一个/ 足够/ 小/ 的/ 时间/ 间隔/ )/ ,/ 一旦/ 系统/ 在/ LSTi/ +/ δ/ 时刻/ 未/ 发现/ ai/ 开始/ 执行/ ,/ 则/ 发出/ 该类/ 事件/ ;/ E02/ :/ 与/ 之/ 类似/ ,/ ai/ 在/ 当前/ 时刻/ t/ 未/ 按计划/ 执行/ 结束/ ,/ 满足/ t/ >/ LETi/ +/ δ/ ;/ (/ 2/ )/ 由/ 活动/ 的/ 开始/ 执行/ 所/ 触发/ 的/ 事件/ (/ E11/ )/ ./ 一旦/ 服务/ 活动/ 开始/ 执行/ ,/ 系统/ 即/ 产生/ 该类/ 事件/ ./ t/ / LSTi/ 表示/ 活动/ 提前/ 或/ 准时/ 开始/ ,/ 而/ t/ >/ LSTi/ 表示/ 活动/ 开始/ 迟/ 于/ 计划/ ./ Page4/ 下/ 两种/ 情况/ :/ (/ 3/ )/ 由/ 活动/ 执行/ 结束/ 所/ 触发/ 的/ 事件/ ,/ 可/ 分为/ 以/ E21/ :/ 活动/ 执行/ 失败/ 或/ 错误/ ,/ 未/ 得到/ 期望/ 结果/ ;/ E22/ :/ 活动/ 执行/ 成功/ ./ t/ / LETi/ 表示/ 活动/ 提前/ 或/ 准时/ 执行/ 结束/ ,/ 而/ t/ >/ LETi/ 表示/ 活动/ 有/ 延迟/ ./ 3.3/ 服务/ 执行/ 的/ 状态/ 服务/ 流程/ 在/ 执行/ 过程/ 中/ 产生/ 各种/ 正常/ 或/ 不/ 确定/ 事件/ ,/ 导致/ 服务/ 执行/ 不/ 确定/ 状态/ ./ 本节/ 给出/ 服务/ 执行/ 状态/ 的/ 刻画/ ./ 3.3/ ./ 1/ 单个/ 活动/ 的/ 状态/ 首先/ 定义/ 活动/ 的/ 状态/ ./ 对/ 活动/ ai/ ,/ 其/ 状态/ 可/ 表示/ 为/ state/ (/ ai/ )/ =/ STATE/ _/ TYPEN/ // U/ 〈/ T/ ,/ C/ 〉/ 或/ 简写/ 为/ STATE/ _/ TYPEN/ // U/ ./ STATE/ _/ TYPE/ 可为/ 以下/ 6/ 种/ 类型/ 之一/ (/ T/ 和/ C/ 表示/ ai/ 处于/ 当前/ 状态/ 时/ 相比/ 于/ 预期/ 服务/ 方案/ 的/ 时间延迟/ (/ TimeDelay/ )/ 和/ 成本/ 溢出/ (/ CostOverflow/ )/ ,/ N/ 和/ U/ 分别/ 表示/ 该/ 状态/ 为/ 正常/ 状态/ 或/ 不/ 正常/ 状态/ ,/ 正常/ 状态/ 表示/ 时间/ 和/ 成本/ 未/ 超出/ 初始/ 服务/ 方案/ 中/ 对/ ai/ 的/ 时间/ 与/ 成本/ 的/ 规划/ (/ T/ / 0/ ,/ C/ / 0/ )/ ,/ 不/ 正常/ 状态/ 是/ 指/ 当前/ 存在/ 时间延迟/ 或者/ 成本/ 溢出/ (/ T/ >/ 0/ ,/ C/ >/ 0/ )/ ./ 对/ NOT/ _/ READY/ 、/ FAIL/ 、/ CANCEL3/ 类/ 状态/ 来说/ ,/ 不/ 存在/ 正常/ 或/ 不/ 正常/ 的/ 分类/ ,/ 不需/ 标注/ 上标/ N/ 或/ U/ )/ :/ (/ 1/ )/ 未/ 执行/ (/ NOT/ _/ READY/ )/ :/ ai/ 至少/ 有/ 一个/ 前图/ 2/ 服务/ 活动/ 的/ 状态/ 转换/ 关系/ 3.3/ ./ 2/ 服务/ 执行/ 的/ 整体/ 状态/ 将/ 服务/ 执行/ “/ 前锋线/ ”/ (/ FrontLine/ )/ 上/ 的/ 各/ 服务/ 活动/ 的/ 状态/ 联合/ 起来/ ,/ 共同/ 表示/ 服务/ 执行/ 的/ 整体/ 状态/ state/ (/ SPlan/ )/ ./ 所谓/ “/ 前锋线/ ”/ ,/ 是/ 指/ 将/ 已经/ 执行/ 的/ 部分/ 和/ 尚未/ 执行/ 的/ 部分/ 分开/ 的/ 一条线/ ,/ 表示/ 为/ FL/ (/ SPlan/ )/ =/ {/ (/ ai/ ,/ state/ (/ ai/ )/ )/ }/ ,/ 它/ 由/ 一组/ 活动/ 及其/ 状态/ 构成/ ,/ prodecessor/ (/ FL/ )/ 、/ successor/ (/ FL/ )/ 分别/ 为/ 其/ 左侧/ 和/ 右侧/ 的/ 活动/ 集合/ ./ 处于/ FL/ 中/ 的/ 每/ 一个/ 服务/ ,/ 可能/ 是/ READYN/ // U/ 、/ EXECN/ // U/ 、/ FAIL/ 、/ FINISHN/ // U/ 的/ 某/ 一/ 状态/ ,/ 序/ 活动/ 尚未/ 执行/ 结束/ ,/ 故/ ai/ 尚无/ 开始/ 执行/ 的/ 条件/ ,/ 即/ / a/ ∈/ {/ aj/ |/ / e/ =/ (/ aj/ ,/ ai/ )/ }/ ,/ state/ (/ a/ )/ !/ =/ FINISH/ / state/ (/ ai/ )/ =/ NOT/ _/ READY/ ./ 这是/ 所有/ 活动/ 的/ 缺省/ 状态/ ;/ (/ 2/ )/ 待/ 执行/ (/ READY/ )/ :/ 若/ ai/ 的/ 所有/ 前序/ 活动/ 均/ 已/ 执行/ 完毕/ (/ 处于/ FINISH/ 状态/ )/ ,/ 且/ 对/ 这些/ 活动/ 的/ 决策/ 动作/ 均/ 非/ “/ 终止/ ”/ 时/ ,/ ai/ 具备/ 了/ 执行/ 的/ 先决条件/ ,/ 进入/ 该/ 状态/ ,/ 即/ / a/ ∈/ {/ aj/ |/ / e/ =/ (/ aj/ ,/ ai/ )/ }/ ,/ state/ (/ a/ )/ =/ FINISH/ ∧/ Action/ (/ a/ )/ !/ =/ STOP/ / state/ (/ ai/ )/ =/ READY/ ./ 当/ ai/ 处于/ READY/ 状态/ 且/ 产生/ E01/ 时/ ,/ 它/ 仍然/ 处于/ READY/ 状态/ ;/ (/ 3/ )/ 执行/ 中/ (/ EXEC/ )/ :/ 当本/ 活动/ 产生/ E11/ 、/ E02/ 事件/ 时/ ,/ ai/ 正在/ 执行/ 中/ ,/ 但/ 尚未/ 结束/ ;/ (/ 4/ )/ 执行/ 后/ 失败/ (/ FAIL/ )/ :/ 本/ 活动/ 产生/ E21/ 事件/ ,/ ai/ 执行/ 结束/ ,/ 但/ 未/ 得到/ 期望/ 输出/ ,/ 执行/ 失败/ ;/ (/ 5/ )/ 执行/ 后/ 成功/ (/ FINISH/ )/ :/ 本/ 活动/ 产生/ E22/ 事件/ ,/ ai/ 执行/ 结束/ ,/ 已/ 得到/ 期望/ 结果/ ;/ (/ 6/ )/ 取消/ (/ CANCEL/ )/ :/ 当某/ 活动/ 处于/ READYU/ 、/ FINISHU/ 或/ FAIL/ 状态/ ,/ 并且/ 决策/ 动作/ 将/ 该/ 活动/ 终止/ 时/ ,/ ai/ 被/ 人为/ 取消/ ,/ 服务/ 方案/ 停止/ 执行/ 而/ 完全/ 失败/ ./ 活动/ 的/ 状态/ 变化/ 是/ 由/ 事件/ 或/ 决策/ 动作/ 所/ 导致/ 的/ ,/ 图/ 2/ 给出/ 了/ 状态/ 之间/ 的/ 转换/ 关系/ 图/ ./ 其/ 所有/ 前序/ 活动/ 的/ 状态/ 必须/ 是/ FINISHN/ // U/ ,/ 其/ 所有/ 后序/ 活动/ 的/ 状态/ 必须/ 是/ NOT/ _/ READY/ ,/ 即/ / ai/ ∈/ FL/ ,/ state/ (/ ai/ )/ ∈/ {/ READYN/ // U/ ,/ EXECN/ // U/ ,/ FAIL/ ,/ FINISHN/ // U/ }/ ;/ / a/ ∈/ predecessor/ (/ FL/ )/ ,/ state/ (/ a/ )/ =/ FINISHN/ // U/ ;/ / a/ ∈/ successor/ (/ FL/ )/ ,/ state/ (/ a/ )/ =/ NOT/ _/ READY/ ./ 例如/ ,/ 在/ 某/ 一/ 时刻/ 服务/ 执行/ 状态/ 如图/ 3/ 所示/ ,/ 虚线/ 表示/ 流程/ 执行/ 的/ 前锋线/ ,/ 它/ 左侧/ 的/ 活动/ (/ a1/ ,/ a2/ ,/ a5/ )/ 均/ 处于/ FINISH/ 状态/ ,/ 它/ 右侧/ 的/ 活动/ (/ a7/ ,/ a8/ ,/ a9/ )/ 均/ 处于/ NOT/ _/ READY/ 状态/ ,/ 而/ 在线/ 上/ 的/ 3/ 个/ 活动/ (/ a3/ ,/ a4/ ,/ a6/ )/ ,/ 分别/ 处于/ READY/ 、/ EXEC/ 、/ FAIL/ 状态/ ./ Page5FL/ ,/ state/ (/ ai/ )/ =/ READYN/ ;/ successor/ (/ FL/ )/ !/ =/ / ;/ / ai/ ∈/ predecessor/ (/ FL/ )/ ,/ state/ (/ ai/ )/ =/ FINISHN/ // U/ ;/ state/ (/ SPlan/ )/ 可/ 分为/ 几类/ :/ (/ 1/ )/ 执行/ 前/ :/ predecessor/ (/ FL/ )/ =/ / ,/ 对/ / ai/ ∈/ (/ 2/ )/ 执行/ 中/ :/ FL/ !/ =/ / ,/ predecessor/ (/ FL/ )/ !/ =/ / ,/ (/ 3/ )/ 成功/ 结束/ :/ FL/ =/ / ,/ successor/ (/ FL/ )/ =/ / ,/ 对/ (/ 4/ )/ 失败/ 结束/ :/ FL/ !/ =/ / ,/ 且/ / ai/ ∈/ FL/ ,/ state/ (/ ai/ )/ =/ 面向/ 不确定性/ 的/ 优化/ 决策/ 的/ 目标/ 可/ 表述/ 为/ :/ 以/ 最小/ 的/ 时间延迟/ 和/ 成本/ 溢出/ ,/ 使/ 服务/ 以/ 最大/ 概率/ 进入/ 到/ “/ 成功/ 结束/ ”/ 状态/ ./ 4/ 面向/ 不确定性/ 的/ 服务/ 自/ 适应/ 决策/ FAIL/ ./ 模型/ 4.1/ 决策/ 动作/ 针对/ 每/ 一种/ 不确定性/ 所/ 导致/ 的/ 系统/ 异常/ 状态/ ,/ 有/ 多种/ 可用/ 的/ 决策/ 动作/ ./ 将/ 每/ 一次/ 决策/ 表示/ 为/ 四元组/ (/ SPlan/ ,/ ai/ ,/ state/ ,/ action/ ,/ SPlan/ )/ ,/ 含义/ 是/ :/ 当前/ 服务/ 执行/ 方案/ SPlan/ ,/ 出现/ 了/ 不确定性/ 事件/ 导致/ 某/ 服务/ 活动/ ai/ 进入状态/ state/ ,/ 此时/ 采取/ 对策/ action/ ,/ 对原/ 方案/ 变更/ 而/ 得到/ 新/ 的/ 方案/ SPlan/ ./ 将/ 决策/ 动作/ 归纳/ 为/ 5/ 类/ :/ (/ 1/ )/ 终止/ (/ terminate/ )/ ./ 停止/ 活动/ 的/ 执行/ ,/ state/ (/ ai/ )/ =/ CANCEL/ ,/ 客户/ 需求/ 无法/ 满足/ ,/ 服务/ 失败/ ,/ SPlan/ =/ / ;/ (/ 2/ )/ 不/ 作为/ (/ continue/ )/ ./ 不/ 做/ 额外/ 的/ 调整/ 对策/ ,/ 继续/ 按原/ 方案/ 执行/ 下去/ ,/ SPlan/ =/ SPlan/ ;/ (/ 3/ )/ 重试/ (/ retry/ )/ ./ 重新/ 执行/ 出现异常/ 的/ 活动/ ,/ 即令/ state/ (/ ai/ )/ =/ EXECU/ (/ T/ ,/ C/ )/ ;/ (/ 4/ )/ 替换/ (/ substitute/ )/ ./ 为/ 出现异常/ 的/ 活动/ ai/ 从/ 其/ 候选/ 服务/ 集/ CSi/ 中/ 选择/ 一个/ 新/ 服务/ Sij/ 替换/ 原/ 服务/ Si0/ ,/ 并/ 重新启动/ 执行/ ai/ ,/ 即/ Si0/ ←/ Sik/ ,/ 其中/ Sik/ ∈/ CSi/ ;/ (/ 5/ )/ 重组/ (/ recompose/ )/ ./ 对/ 当前/ 前锋线/ 的/ 右侧/ 尚未/ 执行/ 的/ 服务/ 活动/ 进行/ 重组/ ,/ 形成/ 替代/ 方案/ 并/ 启动/ 执行/ ./ 这/ 相当于/ 对/ 多个/ 服务/ 要素/ 进行/ 替换/ 操作/ ./ 即将/ 多个/ 服务/ Si0/ ,/ Si/ +/ 1/ ,/ 0/ ,/ …/ ,/ Sj0/ 分别/ 替换/ 为/ Sik/ ,/ Si/ +/ 1/ ,/ k/ ,/ …/ ,/ Sjk/ ,/ 其中/ Sik/ ∈/ CSi/ ,/ Si/ +/ 1/ ,/ k/ ∈/ CSi/ +/ 1/ ,/ …/ ,/ Sjk/ ∈/ CSj/ ./ 终止/ 、/ 不/ 作为/ 和/ 重试/ 对/ 服务/ 方案/ 的/ 结构/ 无/ 影响/ ,/ 替换/ 相当于/ 为/ 某/ 一/ 活动/ 进行/ 服务/ 选择/ ,/ 重组/ 相当于/ 对/ 后续/ 未/ 执行/ 服务/ 流程/ 进行/ 服务/ 重组/ ./ 替换/ 和/ 重组/ 是/ 为/ 尚未/ 执行/ 的/ 一个/ 或/ 多个/ 活动/ 选择/ 时间/ 更/ 短/ 或/ 价格/ 更/ 低/ 的/ 候选/ 服务/ ,/ 以此/ 来/ 消除/ 之前/ 因为/ 不/ 确定/ 事件/ 所/ 导致/ 的/ 时间/ 延误/ 或/ 成本/ 溢出/ ,/ 替换/ 可/ 相当于/ 对/ 1/ 个/ 活动/ 进行/ 重新/ 选择/ 和/ 组合/ 服务/ ,/ 它们/ 均/ 有/ 成熟/ 方法/ 可供参考/ (/ 见/ 第/ 2/ 节/ )/ ./ 限于/ 篇幅/ ,/ 本文/ 直接/ 使用/ 已有/ 方法/ 生成/ 服务/ 替换/ 方案/ 和/ 重组/ 方案/ ./ 在此之前/ ,/ 需要/ 根据/ SPlan/ 的/ 当前/ 状态/ 动态/ 生成/ 替换/ 和/ 重组/ 的/ 目标/ 函数/ ,/ 所/ 获得/ 的/ 替换/ // 重组/ 方案/ 能够/ 使/ 当前/ 造成/ 的/ 时间/ 延误/ 和/ 成本/ 溢出/ 得到/ 最大/ 程度/ 的/ 降低/ ./ 以下/ 简要/ 说明/ 上述/ 5/ 种/ 决策/ 动作/ 的/ 完备/ 性/ ./ 当/ 服务/ 出现/ 不确定性/ ,/ 顾客/ 所/ 能/ 采取/ 的/ 所有/ 策略/ 可/ 按/ 下列/ 方式/ 逐渐/ 进行/ 分类/ ,/ 即/ 所有/ 策略/ =/ 采取/ 动作/ ∪/ 不/ 采取/ 动作/ =/ 采取/ 动作/ ∪/ “/ 不/ 作为/ ”/ =/ 正向/ 动作/ ∪/ 负/ 向/ 动作/ ∪/ “/ 不/ 作为/ ”/ =/ 单点/ 动作/ ∪/ 多点/ 动作/ ∪/ “/ 终止/ ”/ ∪/ “/ 不/ 作为/ ”/ =/ “/ 重试/ ”/ ∪/ “/ 替换/ ”/ ∪/ “/ 重组/ ”/ ∪/ “/ 终止/ ”/ ∪/ “/ 不/ 作为/ ”/ ./ 因此/ ,/ 以上/ 给出/ 的/ 5/ 种/ 决策/ 动作/ 可以/ 涵盖/ 顾客/ 所/ 能/ 采取/ 的/ 可能/ 动作/ ./ 4.2/ 决策/ 、/ 事件/ 与/ 状态/ 之间/ 的/ 关系/ 在/ 服务/ 方案/ 执行/ 过程/ 中/ ,/ 若/ 产生/ 某一/ 不确定性/ 事件/ ,/ 则/ 导致/ 某一/ 活动状态/ 发生变化/ ./ 此时/ 进行/ 决策/ ,/ 根据/ 决策/ 动作/ 修正/ 服务/ 方案/ 并/ 更新/ 受/ 影响/ 的/ 活动状态/ ,/ 继续/ 投入/ 执行/ ./ 如此/ 循环往复/ ,/ 直到/ 服务/ 停止/ 或者/ 执行/ 成功/ ./ 对/ 活动/ 执行/ 前/ 、/ 执行/ 后/ 的/ 状态/ ,/ 一旦/ 该/ 状态/ 产生/ ,/ 马上/ 进行/ 决策/ ;/ 对/ 活动/ 执行/ 中/ 的/ 状态/ ,/ 等/ 活动/ 达到/ 执行/ 后/ 的/ 某/ 一/ 状态/ 时/ 再/ 进行/ 决策/ ./ 需要/ 说明/ 的/ 是/ ,/ 虽然/ 决策/ 针对/ 服务/ 的/ 整体/ 状态/ ,/ 但是/ 每次/ 动作/ 只/ 针对/ 前锋线/ 上/ 的/ 某/ 一个/ 活动/ 进行/ ./ 若/ 前锋线/ 上/ 多个/ 活动/ 均/ 处于/ 异常/ 状态/ ,/ 那么/ 多个/ 导致/ 异常/ 状态/ 的/ 事件/ 必然/ 是/ 有/ 先后/ 次序/ 到达/ 的/ ,/ 因而/ 决策/ 也/ 会/ 随/ 事件/ 到达/ 的/ 先后/ 次序/ 进行/ ./ 本文/ 的/ 决策/ 仅/ 针对/ 单一/ 活动/ 的/ 状态/ 进行/ ./ 针对/ 服务/ 所处/ 的/ 不同/ 状态/ ,/ 可能/ 采取/ 的/ 决策/ 动作/ 是/ 上述/ 5/ 类中/ 的/ 子集/ ./ 表/ 1/ 的/ 前/ 4/ 列/ 给出/ 了/ 某/ 一/ 活动/ 处于/ 不同/ 状态/ 时/ 可能/ 采用/ 的/ 决策/ 动作/ 集合/ ,/ 以及/ 决策/ 之后/ 可能/ 导致/ 的/ 新/ 状态/ ./ Page6/ 状态/ 类型/ 决策/ 动作/ 决策/ 后/ 可能/ 导致/ 的/ 状态/ 决策/ 后/ ,/ 服务/ 可/ 继续执行/ 的/ 概率/ (/ r/ )/ Δ/ T/ 表/ 1/ 服务/ 状态/ 与/ 决策/ 动作/ 之间/ 的/ 关系/ READYU/ (/ T/ ,/ C/ )/ 活动/ 执行/ 前/ 状态/ READYN/ (/ T/ ,/ C/ )/ 无需/ 决策/ FINISHN/ // U/ (/ T/ +/ Δ/ T/ ,/ C/ +/ Δ/ C/ )/ FAIL/ (/ T/ ,/ C/ )/ 活动/ 执行/ 后/ 状态/ FINISHU/ (/ T/ ,/ C/ )/ FINISHN/ (/ T/ ,/ C/ )/ 无需/ 决策/ / 后续/ 活动/ READYN/ (/ T/ ,/ C/ )/ 注/ :/ / 表示/ 是否/ 可以/ 过渡/ 到/ 后续/ 活动/ 的/ READY/ 状态/ ,/ 取决于/ 流程/ 的/ 结构/ ,/ 只有/ 后续/ 活动/ 的/ 所有/ 前序/ 活动/ 均/ 处于/ FINISH/ 且/ 不/ 采用/ “/ 终止/ ”/ 决策/ 时才/ 能够/ 过渡/ 到/ READY/ ./ 4.3/ 决策/ 收益/ 决策/ 动作/ 的/ 目标/ 是/ “/ 使/ 不确定性/ 造成/ 的/ 损失/ 尽可能/ 小/ ”/ ,/ 但/ 并/ 不/ 保证/ 服务/ 一定/ 能够/ 从/ 异常/ 状态/ 完全/ 回到/ 正常/ 轨道/ ,/ 因此/ 需要/ 分析/ 每种/ 决策/ 对/ 服务/ 执行/ 的/ 影响/ ,/ 计算/ 其/ 损失/ (/ 负/ 收益/ )/ ,/ 以此/ 作为/ 优化/ 决策/ 的/ 依据/ ./ 决策/ 动作/ 对/ 原有/ 的/ 服务/ 方案/ 进行/ 了/ 调整/ ,/ 对/ 它/ 的/ 收益/ 度量/ 从/ 以下/ 3/ 个/ 因素/ 入手/ :/ (/ 1/ )/ 使/ 服务/ 可以/ 继续/ 向/ 后/ 执行/ 的/ 概率/ ./ 一般/ 情况/ 下/ 服务/ 失败/ 后/ 需/ 支付/ 给/ 顾客/ 的/ 补偿/ (/ fc/ )/ 较/ 高/ ,/ 因此/ 决策/ 动作/ 应/ 尽可能/ 保证/ 服务/ 可以/ 继续执行/ 下去/ ./ 除了/ 补偿/ 上/ 的/ 考虑/ 之外/ ,/ 还/ 考虑/ 到/ 服务/ 执行/ 失败/ 可能/ 造成/ 的/ 客户/ 流失/ ./ 设/ 决策/ 动作/ 之后/ ,/ 受/ 影响/ 的/ 活动/ (/ 可能/ 为/ 当前/ 活动/ ,/ 也/ 可能/ 为/ 下/ 一步/ 活动/ )/ 执行/ 成功/ 的/ 概率/ 为/ r/ ,/ 那么/ 该/ 部分/ 代价/ 是/ (/ 1/ -/ r/ )/ ×/ fc/ ./ (/ 2/ )/ 若/ 造成/ 时间延迟/ 而/ 需/ 支付/ 的/ 延误/ 成本/ ./ 设/ 延误/ 时间/ 为/ Δ/ T/ ,/ 那么/ 该/ 部分/ 的/ 代价/ 是/ Δ/ T/ ×/ dc/ ./ (/ 3/ )/ 所/ 引入/ 的/ 新/ 成本/ Δ/ C/ ./ 对/ 终止/ 和/ 不/ 作为/ 两种/ 动作/ 来说/ ,/ 新/ 成本/ 为/ 0/ ;/ 对/ 重试/ 动作/ 来说/ ,/ 新/ 成本/ 为/ 重新/ 支付/ 的/ 当前/ 服务/ 使用/ 价格/ ;/ 对/ 替换/ 动作/ 来说/ ,/ 新/ 成本/ 为/ 所/ 选新/ 替代/ 服务/ 的/ 使用/ 价格/ ;/ 对/ 重组/ 动作/ 来/ (/ Si0/ 为/ 活动/ 当前/ 所用/ 的/ 服务/ )/ Rik/ (/ Sik/ 为/ 替换/ 后/ 的/ 服务/ )/ (/ Sik/ 为/ 重组/ 后/ 最先/ 执行/ 的/ 服务/ )/ Rik/ (/ Sik/ 为/ 替换/ 后/ 的/ 服务/ )/ (/ Sik/ 为/ 重组/ 后/ 最先/ 执行/ 的/ 服务/ )/ 说/ ,/ 新/ 成本/ 为/ 所选/ 的/ 多个/ 替代/ 服务/ 的/ 使用/ 价格/ 与/ 原/ 方案/ 中/ 相应/ 服务/ 的/ 使用/ 价格/ 之差/ ./ 因此/ ,/ 在/ 当前/ 状态/ 下/ state/ 采取/ 决策/ 动作/ action/ 所/ 带来/ 的/ 总/ 收益/ 是/ :/ Reward/ =/ -/ (/ (/ 1/ -/ r/ )/ ×/ fc/ +/ Δ/ T/ ×/ dc/ +/ Δ/ C/ )/ ,/ 其中/ r/ 、/ Δ/ T/ 、/ Δ/ C/ 的/ 计算/ 方式/ 如表/ 1/ 右侧/ 的/ 3/ 列/ 所示/ ./ 4.4/ 不确定性/ 触发/ 关系/ 图/ (/ UTG/ )/ 不确定性/ 本身/ 蕴含着/ 服务/ 的/ 一种/ 状态/ (/ 不/ 正常/ 状态/ )/ ,/ 它/ 是/ 可以/ 传播/ 的/ ,/ 若/ 不/ 采取任何/ 对策/ (/ 不/ 作为/ )/ ,/ 任由/ 某一/ 不确定性/ 蔓延/ 下去/ ,/ 将会/ 造成/ 更/ 严重/ 的/ 后果/ (/ 成本/ 溢出/ 、/ 时间/ 延误/ 、/ 执行/ 失败/ )/ ./ 即使/ 采取/ 了/ 某/ 一种/ 对策/ ,/ 弥补/ 了/ 某些/ 潜在/ 后果/ ,/ 但/ 可能/ 不会/ 完全/ 弥补/ ,/ 因此/ 也/ 会/ 扩散/ ./ 这里/ 提出/ 不确定性/ 触发/ 关系/ 图/ (/ UncertaintyTriggeringGraph/ ,/ UTG/ )/ 表达/ UC/ 之间/ 的/ 触发/ 关系/ ./ 利用/ UTG/ 来/ 计算/ 不确定性/ 事件/ 及/ 决策/ 动作/ 所/ 引发/ 的/ 直接/ 和/ 间接/ 代价/ ./ UTG/ 可/ 表示/ 为/ 包含/ 两类/ 节点/ 和/ 两类/ 边/ 的/ 有向图/ UTG/ =/ (/ rs/ ,/ SS/ ,/ AS/ ,/ TSA/ ,/ TAS/ )/ ,/ 其中/ :/ rs/ =/ (/ ai/ ,/ statei/ )/ 表示/ 根/ 状态/ ,/ 代表/ 活动/ ai/ 处于/ statei/ 时所/ 生成/ 的/ UTG/ ;/ Page7SS/ =/ {/ ss/ }/ 为/ 状态/ 节点/ 集合/ ,/ 其中/ 包含/ 两类/ 节点/ ,/ 第一类/ 为/ 原子/ 状态/ ss/ =/ (/ aj/ ,/ statej/ )/ ,/ 第二类/ 为/ 嵌套/ 的/ UTG/ 根/ 结点/ ,/ 可/ 扩展/ 为/ 一棵/ 完整/ 的/ UTG/ 树/ ;/ 点/ 的/ 有/ 向/ 边/ ;/ AS/ =/ {/ action/ }/ 为/ 决策/ 动作/ 节点/ 的/ 集合/ ;/ TSA/ =/ ss/ →/ action/ 表示/ 状态/ 节点/ 到/ 决策/ 动作/ 节/ TAS/ =/ action/ →/ ss/ 表示/ 决策/ 动作/ 节点/ 到/ 状态/ 节点/ 的/ 有/ 向/ 边/ ,/ 它/ 具有/ 3/ 个/ 属性/ :/ tp/ (/ 该/ 状态/ 转移/ 的/ 概率/ )/ 、/ Δ/ T/ (/ 该/ 状态/ 转移/ 所/ 造成/ 的/ 时间延迟/ )/ 、/ Δ/ C/ (/ 该/ 状态/ 转移/ 所/ 造成/ 的/ 成本增加/ )/ ./ 图/ 4/ 给出/ 了/ UTG/ 示意图/ ,/ 其中/ 菱形/ 框/ 表示/ 根/ 状态/ ,/ 圆形/ 节点/ 表示/ 原子/ 状态/ ,/ 矩形框/ 表示/ 决策/ 动作/ 节点/ ,/ 箭头/ 表示/ TSA/ 和/ TAS/ ./ 图/ 5/ 多棵/ UTG/ 的/ 连接/ 下面/ 给出/ 一个/ 小/ 例子/ ./ 假设/ 服务/ 方案/ 是/ 由/ 3/ 个/ 活动/ (/ a1/ ,/ a2/ ,/ a3/ )/ 串行/ 构成/ 的/ 流程/ ,/ 图/ 6/ (/ a/ )/ 表示/ 活动/ a1/ 在/ READYU/ 状态/ 下/ 的/ UTG/ ,/ 图/ 6/ (/ b/ )/ 表示/ 活动/ a1/ 在/ FINISHU/ 状态/ 下/ 的/ UTG/ ,/ 图/ 6/ (/ c/ )/ 表示/ a1/ 在/ FAIL/ 状态/ 下/ 的/ UTG/ ./ UTG/ 的/ 结构/ 与/ 服务/ 方案/ 的/ 流程/ 结构/ 密切相关/ ./ 当/ 出现/ 不确定性/ 事件/ 之后/ ,/ 更新/ 相关/ 活动/ 、/ 状态/ 和/ 前锋线/ 的/ 信息/ ,/ 进而/ 根据/ 表/ 1/ 的/ 相关/ 信息/ 生成/ UTG/ ./ 5/ 基于/ MDP/ 的/ 优化/ 决策/ 方法/ 根据/ 第/ 4/ 节/ 的/ 讨论/ ,/ 不确定性/ 是/ 可以/ 传播/ 的/ ,/ 因此/ 作/ 决策/ 时/ 不能/ 仅仅/ 考虑/ 当前/ 发生/ 的/ 不确定性/ ,/ 还/ 在/ UTG/ 模型/ 中/ ,/ 状态/ 节点/ 可以/ 是/ 一棵/ UTG/ 的/ 根/ 节点/ ,/ 这/ 代表/ 了/ 不同/ UTG/ 之间/ 的/ 连接/ (/ 不同/ 活动/ 的/ 不确定性/ 状态/ 之间/ 的/ 转换/ )/ ./ 若/ 将/ 此类/ UTG/ 节点/ 展开/ ,/ 即可/ 形成/ 如图/ 5/ 所示/ 的/ 形态/ ./ 要/ 考虑/ 到/ 在/ 采取/ 特定/ 决策/ 后续/ 可能/ 引起/ 的/ 其它/ 各种/ 潜在/ 的/ 不确定性/ ,/ 将/ 当前/ 及/ 未来/ 的/ 潜在/ 代价/ // 收益/ 计算/ 进去/ ,/ 得到/ 全局/ 的/ 最优/ 决策/ ./ 5.1/ 马尔可夫/ 决策/ 过程/ (/ MDP/ )/ 马尔可夫/ 决策/ 过程/ (/ MDP/ )/ [/ 23/ ]/ 将/ 马尔可夫/ 过程/ 与/ 确定性/ 的/ 动态/ 规划/ 相结合/ ,/ 决策者/ 周期/ 或/ 连续/ 观察/ 随机/ 动态/ 系统/ ,/ 序贯/ 地/ 做出/ 决策/ ,/ 系统/ 下/ 一步/ 的/ 状态/ 是/ 随机/ 的/ ,/ 并且/ 其/ 状态/ 转移/ 概率/ 具有/ 马尔可夫/ 性/ ./ 决策者/ 根据/ 新/ 观察/ 到/ 的/ 状态/ ,/ 再作/ 新/ 的/ 决策/ ,/ 依/ 此/ 反复/ 地/ 进行/ ./ 通过/ 此种/ 决策/ ,/ 使/ 系统/ 运行/ 的/ 全过程/ 达到/ 某种/ 最优/ 运行/ 效果/ ,/ 选取/ 控制系统/ 发展/ 的/ 最优/ 策略/ ./ 服务/ 执行/ 过程/ 中/ 面临/ 的/ 各种/ 不确定性/ 以及/ 对/ 其/ Page8/ 图/ 6UTG/ 的/ 3/ 个/ 例子/ 所/ 做出/ 的/ 决策/ ,/ 符合/ Markov/ 决策/ 过程/ 的/ 定义/ ./ 因此/ ,/ 采用/ 基于/ MDP/ 的/ 方法/ 进行/ 服务/ 自/ 适应/ 演化过程/ 中/ 的/ 决策/ ,/ 根据/ 当前/ 服务/ 执行/ 状态/ 、/ 发生/ 的/ 不确定性/ 事件/ 、/ 不确定性/ 事件/ 之间/ 的/ 触发/ 关系/ (/ UTG/ )/ ,/ 考虑/ 未来/ 的/ 收益/ 和/ 代价/ ,/ 做出/ 当前/ 不/ 确定/ 状态/ 下/ 的/ 最优/ 决策/ ./ 5.2/ 模型/ 按照/ MDP/ 的/ 数学模型/ ,/ 需要/ 首先/ 建立/ 决策/ 时刻/ T/ 、/ 服务/ 状态/ S/ 、/ 决策/ 动作/ A/ 、/ 转移/ 概率/ P/ 、/ 代价/ Reward/ 的/ 数学/ 表达/ ./ (/ 1/ )/ 时刻/ T/ ./ 当前/ 服务/ 环节/ 执行/ 中/ // 执行/ 后/ 发生/ 不/ 确定/ 事件/ 、/ 或者/ 预知/ 到/ 尚未/ 执行/ 的/ 环节/ 将会/ 发生/ 不/ 确定/ 事件/ 时/ 开始/ 决策/ ,/ 此时/ 为/ 时刻/ 0/ ./ 如图/ 4/ 所示/ 的/ 多棵/ UTG/ 连接/ 形成/ 完全/ 触发/ 关系/ 图/ ,/ 叶子/ 结点/ p/ (/ statej/ |/ statei/ ,/ action/ )/ =/ 1/ ,/ action/ =/ continue/ // terminate/ (/ 5/ )/ 报酬/ 函数/ Reward/ ./ 在/ 4.3/ 节中/ 已/ 给出/ ./ 5.3/ 算法/ 基于/ 上述/ 5/ 个/ 方面/ 的/ 基本/ 定义/ ,/ 采用/ 有限/ 阶段/ 向/ 后/ 递归/ 迭代/ MDP/ 算法/ 进行/ 最优/ 决策/ 序列/ 的/ 求解/ ,/ 得到/ 对/ 当前/ 服务/ 的/ 决策/ 动作/ ./ 算法/ 1/ ./ 基于/ MDP/ 的/ 服务/ 不确定性/ 优化/ 决策/ ./ 输入/ :/ 服务/ 方案/ SPlan/ 与/ 当前/ 发生/ 的/ 不确定性/ 事件/ 相关/ 输出/ :/ 最优/ 马氏/ 策略/ 及其/ 成本/ 1/ ./ 根据/ 出现/ 故障/ 的/ 活动/ a/ ,/ 按照/ 表/ 1/ 构造/ UTG/ ,/ 并/ 将/ 多/ 的/ 状态/ 处于/ 最终/ 时刻/ V/ ,/ “/ 完全/ 触发/ 关系/ 图/ ”/ 的/ 层数/ 是/ 周期/ 个数/ ./ 这是/ 一个/ 不定/ 周期/ 的/ 时刻/ 序列/ ;/ (/ 2/ )/ 状态/ S/ ./ 根据/ 3.3/ ./ 2/ 节/ 服务/ 执行/ 的/ 整体/ 状态/ 的/ 内容/ ,/ 将/ 服务/ 流程/ 的/ 前锋线/ 上/ 活动/ 的/ 6/ 种/ 状态/ 组成/ 一个/ 状态/ 集合/ ,/ 形成/ MDP/ 状态/ state/ ,/ 即/ state/ =/ 〈/ state/ (/ ai/ )/ ,/ state/ (/ ai/ +/ 1/ )/ ,/ …/ ,/ state/ (/ aj/ )/ 〉/ ,/ 每个/ 状态/ 附着/ 两个/ 参数/ (/ T/ 和/ C/ )/ ;/ (/ 3/ )/ 动作/ A/ ./ 根据/ 4.1/ 节/ 的/ 内容/ ,/ 共有/ 终止/ 、/ 不/ 作为/ 、/ 重试/ 、/ 替换/ 、/ 重组/ 5/ 个/ 动作/ ,/ 不同/ 状态/ 下/ 可/ 执行/ 的/ 动作/ 集合/ 有所不同/ (/ 见表/ 1/ )/ ;/ (/ 4/ )/ 转移/ 概率/ P/ ./ 转移/ 概率/ 由/ 当前/ 的/ 决策/ 动作/ 和/ 服务/ 活动/ 的/ 状态/ 联合/ 决定/ ,/ 具体/ 计算/ 方式/ 如下/ 所示/ ,/ 其中/ reliability/ 指/ 的/ 是/ 将要/ 执行/ 的/ 服务端/ 可靠性/ ,/ 若有/ 多个/ 服务/ ,/ 则/ 是/ 多个/ 服务/ 可靠性/ 之积/ ;/ 棵/ UTG/ 连接/ 形成/ “/ 完全/ 触发/ 关系/ 图/ ”/ ,/ 从而/ 形成/ 状态/ 转移/ 表/ ;/ 2/ ./ 定义/ 当前/ 的/ 不/ 确定/ 状态/ 为/ 时刻/ 0/ ,/ 以此/ 生成/ 向/ 后/ 衍生/ 的/ UTG/ ,/ 直至/ 服务/ 方案/ 最后/ 一个/ 结点/ ,/ 此时/ 为/ 最终/ 时刻/ V/ ./ 从而/ 生成/ 0/ 到/ V/ 的/ V/ +/ 1/ 个/ 时刻/ 的/ 若干个/ 状态/ 、/ 若干个/ 动作/ 、/ 相应/ 的/ 转移/ 概率/ 报酬/ ;/ uV/ (/ stateV/ )/ =/ RewardV/ (/ stateV/ )/ ;/ 3/ ./ 令/ t/ =/ V/ ,/ 且/ 对/ 所有/ V/ 时刻/ 的/ 状态/ stateV/ ∈/ S/ ,/ 令/ 4/ ./ 如果/ t/ =/ 0/ ,/ 则/ π/ =/ (/ f0/ ,/ f1/ ,/ …/ ,/ fV/ -/ 1/ )/ 为/ 最优/ 的/ 马氏/ 策略/ ,/ 而/ u0/ (/ state0/ )/ 为/ 最优/ 的/ 值/ 函数/ ,/ 算法/ 停止/ ./ 否则/ ,/ 令/ t/ =/ t/ -/ 1/ ,/ 进入/ 步/ 5/ ;/ 5/ ./ 对/ 所有/ statet/ ∈/ S/ ,/ 计算/ Page9ut/ (/ statet/ )/ =/ maxaction/ ∈/ Action/ (/ statet/ )/ {/ Rewardt/ (/ statet/ ,/ action/ )/ +/ 并记/ 集合/ Actiont/ (/ statet/ )/ =/ argmaxaction/ ∈/ Action/ (/ statet/ )/ {/ Rewardt/ (/ statet/ ,/ action/ )/ +/ 任意/ 取/ ft/ (/ statet/ )/ ∈/ Actiont/ (/ statet/ )/ ,/ 于是/ 定义/ 了/ t/ 时刻/ 的/ 决策/ 规则/ ft/ ./ 而/ 0/ 时刻/ 的/ 决策/ f0/ 则/ 是/ 对/ 当前/ 故障/ 时刻/ 的/ 故障/ 状态/ 采取/ 最优/ 的/ 直接/ 动作/ ;/ 6/ ./ 返回/ 步/ 3.5/ ./ 4/ 算法/ 分析/ 算法/ 的/ 步/ 1/ 和步/ 2/ 可/ 同时/ 进行/ ,/ 耗时/ out/ -/ degree/ (/ state/ )/ |/ V/ |/ ,/ 步/ 3/ 到步/ 6/ 为/ 采用/ 有限/ 阶段/ 向/ 后/ 递归/ 迭代/ 算法/ 求解/ 的/ MDP/ 属于/ 动态/ 规划/ 问题/ ,/ 其/ 时间/ 复杂度/ 为/ O/ (/ |/ V/ |/ ×/ |/ S/ |/ ×/ maxoutdegree/ (/ state/ )/ )/ ./ 其中/ V/ 为/ 决策/ 阶段/ 数/ ,/ |/ S/ |/ 为/ 状态/ 总/ 个数/ ,/ outdegree/ (/ state/ )/ 为/ 状态/ state/ 的/ 出度/ ./ 在/ 本/ 问题/ 中/ ,/ |/ V/ |/ 为/ UTG/ 的/ 层数/ ,/ |/ S/ |/ 为/ UTG/ 中/ 的/ 状态/ 总数/ (/ 实际/ 情况/ 只是/ UTG/ 一层/ 的/ 状态/ 个数/ )/ ,/ outdegree/ (/ state/ )/ 的/ 最大值/ 为/ 5/ (/ 共/ 5/ 种/ 动作/ )/ ,/ 每/ 一个/ 动作/ 可能/ 产生/ 1/ 个/ 或者/ 2/ 个/ 后继/ 状态/ ,/ 因此/ ,/ 算法/ 时间/ 复杂度/ 为/ O/ (/ outdegree/ (/ state/ )/ |/ V/ |/ +/ outdegree/ (/ state/ )/ ×/ |/ V/ |/ ×/ |/ S/ |/ )/ =/ O/ (/ 5/ |/ V/ |/ +/ 5/ ×/ 2/ ×/ |/ V/ |/ ×/ |/ S/ |/ )/ ./ 算法/ 执行/ 时间/ 与/ 流程/ 结构/ 紧密/ 相关/ ./ 在/ 最/ 理想/ 的/ 情况/ 下/ ,/ 服务/ 流程/ 结构/ 为/ 全/ 并行/ 且/ 活动/ 上/ 的/ 服务/ 执行/ 的/ 时间/ 相同/ ,/ 此时/ 状态/ 数/ |/ S/ |/ / 1/ +/ 5/ ×/ 2/ =/ 11/ (/ 1/ 个/ 故障/ 状态/ 、/ 采取/ 5/ 种/ 动作/ 、/ 每种/ 动作/ 生成/ 2/ 个/ 后继/ 状态/ )/ ,/ 阶段/ 数为/ |/ V/ |/ =/ 1/ ,/ 则/ 时间/ 复杂度/ 为/ O/ (/ 51/ +/ 5/ ×/ 1/ ×/ 11/ )/ =/ O/ (/ 1/ )/ ,/ 下降/ 为/ 常数/ ./ 最差/ 的/ 情况/ 下/ ,/ UTG/ 中/ 每个/ 状态/ 都/ 是/ 不/ 重复/ 的/ ,/ 这里/ UTG/ 的/ 第/ v/ 层/ (/ 第/ v/ 时刻/ )/ 有/ 5/ |/ v/ |/ 个/ 状态/ ,/ |/ v/ |/ 取/ 最大值/ |/ V/ |/ ,/ 则/ 算法/ 复杂度/ 为/ O/ (/ 5/ |/ V/ |/ +/ 5/ ×/ 2/ ×/ |/ V/ |/ ×/ |/ S/ |/ )/ =/ O/ (/ 5/ |/ V/ |/ +/ 5/ ×/ 2/ ×/ |/ V/ |/ ×/ 5/ |/ V/ |/ )/ =/ O/ (/ 5/ |/ V/ |/ )/ ./ 平均/ 情况/ 下/ ,/ 状态/ 有/ 部分/ 重复/ ,/ 因此/ |/ S/ |/ / 5/ |/ V/ |/ ,/ 虽然/ 理论/ 时间/ 复杂度/ 依然/ 是/ O/ (/ 5/ |/ V/ |/ )/ ,/ 但是/ 实际/ 运行/ 时间/ 并/ 不会/ 达到/ 这个/ 级别/ ./ 6/ 仿真/ 实验/ 6.1/ 实验/ 设置/ 实验/ 针对/ 以下/ 3/ 个/ 目标/ 进行/ 设置/ :/ (/ 1/ )/ 对比/ 仿真/ ./ 通过/ 仿真/ 的/ 方式/ 来/ 验证/ 本文/ 提出/ 的/ 方法/ 能否/ 有效/ 地/ 对/ 服务/ 不确定性/ 进行/ 决策/ ,/ 并/ 的/ 执行/ 效率/ ./ 与/ 传统/ 的/ 贪心/ 策略/ 对比/ ./ 参数/ 的/ 取值/ 对/ 决策/ 动作/ 有何/ 影响/ ;/ (/ 2/ )/ 证明/ 影响/ 决策/ 动作/ 的/ 因素/ ./ 分析/ fc/ 和/ dc/ 等/ (/ 3/ )/ 算法/ 复杂度/ ./ 通过/ 实验/ 分析/ 本文/ 所提/ 方法/ 因此/ ,/ 共/ 设计/ 以下/ 3/ 个/ 实验/ ./ 实验/ 1/ ./ 同一/ 服务/ 方案/ 下/ ,/ 执行/ 过程/ 中/ 面对/ 一组/ 按/ 时间/ 先后/ 次序/ 发生/ 的/ 不确定性/ 事件/ ,/ 分别/ 采用/ MDP/ 和/ 贪心/ 策略/ ,/ 对比/ 决策/ 效果/ ./ 此/ 实验/ 固定/ 服务/ 所有/ 参数/ ,/ 采用/ 仿真/ 进行/ 实验/ ,/ 变量/ 为/ 服务/ 不确定性/ 事件/ ,/ 实验/ 目标/ 观察/ 为/ MDP/ 和/ 贪心/ 的/ 决策/ 动作/ 的/ 差别/ ./ 实验/ 2/ ./ 针对/ 同一/ 服务/ 方案/ ,/ 在/ 服务/ 失败/ 赔偿/ 参数/ (/ fc/ )/ 取/ 不同/ 值/ 的/ 情况/ 下/ ,/ 对/ 决策/ 动作/ 和/ 相应/ 收益/ 的/ 影响/ ./ 此/ 实验/ 固定/ 已/ 绑定/ 服务/ 和/ 候选/ 服务/ QoS/ 参数/ (/ 包括/ T/ 、/ C/ 、/ R/ )/ ,/ 变量/ 为/ fc/ ./ 同理/ ,/ 变量/ 为/ dc/ 时/ 类似/ ./ 实验/ 3/ ./ 针对/ 不同/ 结构/ 、/ 不同/ 规模/ 的/ 流程/ ,/ 针对/ 一次/ 决策/ 所/ 耗费/ 时间/ 的/ 对比/ ./ 此/ 实验/ 固定/ 服务/ 相关/ 参数/ ,/ 包括/ 服务/ QoS/ 、/ fc/ 和/ dc/ ,/ 变量/ 为/ 服务/ 流程/ 中/ 活动/ 的/ 个数/ ,/ 实验/ 目标/ 是/ 观察/ 活动/ 个数/ 对/ 执行/ 时间/ 的/ 影响/ ./ 实验/ 1/ 是/ 实验/ 2/ 和/ 实验/ 3/ 的/ 基础/ ,/ 只有/ 完成/ 了/ 实验/ 对比/ 仿真/ ,/ 才能/ 说明/ 算法/ 的/ 有效性/ ,/ 才能/ 继续/ 说明/ 算法/ 中/ 的/ 参数/ 对/ 算法/ 的/ 影响/ (/ 实验/ 2/ )/ ,/ 进而/ 再/ 测试/ 算法/ 复杂性/ (/ 实验/ 3/ )/ ./ 上述/ 实验所/ 需/ 数据/ 由/ 程序/ 随机/ 生成/ ,/ 按照/ 3.1/ 节/ 给定/ 的/ 模型/ 为/ 流程/ 、/ 活动/ 、/ 候选/ 服务/ 设置/ 相应/ 的/ 属性/ ./ 其中/ ,/ 随机/ 生成/ 的/ 数据/ 指/ 服务/ 流程/ 中/ 已/ 绑定/ 的/ 服务/ 和/ 候选/ 服务/ ,/ 服务/ 的/ 数据/ 生成/ 即/ 是/ 其/ QoS/ 的/ 生成/ ./ 按照/ 两步/ 生成/ 服务/ :/ (/ 1/ )/ 随机/ 生成/ 服务/ 流程/ 中/ 活动/ 上/ 已经/ 绑定/ 的/ 服务/ QoS/ ;/ (/ 2/ )/ 数据/ 的/ 随机/ 生成/ 为了/ 与/ 现实/ 相符合/ ,/ 因此/ 不/ 应该/ 大量/ 出现/ 偏离/ 常规/ 的/ 奇异/ 数据/ ,/ 针对/ 每个/ 活动/ ,/ 伪/ 随机/ 生成/ 其/ 能够/ 替换/ 原来/ 服务/ 的/ 候选/ 服务/ ,/ 其/ 候选/ 服务/ T/ 、/ C/ 、/ R/ 的/ 值/ 分布/ 满足/ 如表/ 2/ 所示/ ,/ 其中/ “/ +/ ”/ 表示/ 比/ 已/ 绑定/ 在/ 活动/ 上/ 的/ 服务/ 相应/ 的/ 值/ 高/ ,/ “/ -/ ”/ 则/ 比/ 已/ 绑定/ 的/ 服务/ 相应/ 值/ 小/ ./ 候选/ 服务/ 如此/ 大致/ 正态分布/ 的/ 取值/ 也/ 与/ 实际/ 相吻合/ ,/ 例如/ ,/ 在/ 候选/ 服务/ 中/ ,/ 出现/ 执行/ 时间/ 长/ 、/ 价格/ 贵/ 、/ 可靠性/ 低/ 的/ 极端/ 服务/ 应该/ 较/ 少/ ,/ 而/ 实际/ 服务/ 执行/ 时间/ 长/ ,/ 相对/ 价格/ 则/ 会/ 便宜/ ,/ 可靠性/ 上/ 可/ 高/ 可/ 低/ ,/ 此类/ 服务/ 应该/ 数量/ 较/ 多/ ./ Page10/ 活动/ 上/ 已/ 绑定/ 的/ 服务/ 候选/ 服务/ 在/ 实验/ 1/ 中/ ,/ T/ 和/ C/ 的/ 具体/ 取值/ 多少/ 对/ 仿真/ 实验/ 并/ 没有/ 影响/ ,/ 本/ 实验/ 为了/ 仿真/ 展示/ 方便/ ,/ 范围/ 分别/ 为/ [/ 1/ ,/ 30/ ]/ 、/ [/ 1/ ,/ 100/ ]/ ;/ 而/ R/ 的/ 取值/ 范围/ 为了/ 与/ 实际/ 服务/ 可靠性/ 相吻合/ ,/ 因此/ 本/ 实验/ 取值/ 为/ [/ 0.5/ ,/ 1.0/ ]/ ,/ 另外/ ,/ 每个/ 候选/ 服务/ 的/ 个数/ 指定/ 为/ 100/ ./ 现实/ 中/ 大部分/ 情况/ ,/ 服务/ 执行/ 失败/ 时/ 的/ 赔偿/ 价格/ 往往/ 不会/ 太高/ 也/ 不会/ 太低/ ,/ 其/ 不/ 应该/ 大于/ 服务/ 流程/ 总/ 价格/ ,/ 也/ 不会/ 远远/ 低于/ 服务/ 流程/ 的/ 总/ 价格/ ./ 因此/ ,/ 总/ 为了/ 与/ 现实/ 相吻合/ ,/ fc/ =/ 0.5/ ×/ 服务/ 流程/ 总/ 价格/ ;/ 而/ 延时/ 赔偿/ 取值/ 为/ 已/ 绑定/ 的/ 服务/ 的/ C/ // T/ 的/ 平均值/ ,/ 因此/ dc/ 取/ 2.0/ 元/ // s/ ./ 服务/ 可靠性/ R/ 意味着/ 服务/ 不/ 出现/ 故障/ 的/ 概率/ ,/ 因此/ 实验/ 的/ 不确定性/ 事件/ 则/ 在/ 服务/ 执行/ 期间/ 内/ 按照/ 概率/ (/ 1/ -/ R/ )/ 随机/ 产生/ 不确定性/ 事件/ ,/ 这/ 与/ 现实/ 是/ 相吻合/ 的/ ./ 在/ 实验/ 2/ 中/ ,/ 变量/ fc/ 取/ 服务/ 流程/ 总/ 价格/ 的/ 0/ ~/ 2/ 倍/ ,/ 以/ 观察/ 决策/ 动作/ 随/ fc/ 的/ 变化/ 情况/ ./ 其余/ 服务/ 参数/ 的/ 生成/ 与/ 实验/ 1/ 相同/ (/ 包括/ 已/ 绑定/ 的/ 服务/ 和/ 候选/ 服务/ 的/ T/ 、/ C/ 、/ R/ ,/ 候选/ 服务/ 个数/ ,/ dc/ )/ ,/ 并且/ 固定/ 故障/ 服务/ 状态/ 为/ 失败/ ./ 在/ 实验/ 3/ 中/ ,/ 手工/ 生成/ 3/ 组/ 流程/ (/ 串行/ 、/ 并行/ 、/ 混合结构/ )/ ,/ 每组/ 包含/ 8/ 个/ 流程/ ,/ 每个/ 流程/ 中/ 包含/ 的/ 活动/ 数目/ 从/ 10/ 变化/ 到/ 80/ ./ 以/ 10/ 个/ 活动/ 来/ 说明/ 生成/ 的/ 流程/ 结构/ :/ 其中/ ,/ 串行/ 流程/ 则/ 10/ 活动/ 都/ 是/ 串行/ 执行/ ;/ 并行/ 流程/ 则/ 所有/ 活动/ 在/ 开始/ 1/ 个/ 活动/ 执行/ 后/ 分支/ 为/ 8/ 条/ 分支/ 同时/ 执行/ ,/ 之后/ 在/ 合并/ 为/ 1/ 个/ 最终/ 活动/ ;/ 混图/ 7MDP/ 与/ 贪心/ 策略/ 在/ 决策/ 效果/ 上/ 的/ 对比/ 分析/ (/ 1/ )/ 合则/ 是/ 其中/ 5/ 个/ 活动/ 采用/ 串行/ ,/ 5/ 个/ 活动/ 采用/ 并行/ ./ 测试/ 算法/ 执行/ 时间/ 与/ 服务/ T/ 、/ C/ 、/ R/ 无关/ ,/ 因此/ 其/ T/ 、/ C/ 、/ R/ 和/ 候选/ 服务/ 数量/ 与/ 实验/ 1/ // 2/ 相同/ ./ 另外/ ,/ 不确定性/ 事件/ 的/ 产生/ 概率/ 与/ 实验/ 1/ 一致/ ,/ 同/ 为/ (/ 1/ -/ R/ )/ ./ 采用/ 上面/ 的/ 实验/ 设置/ 生成/ 的/ 随机/ 数据/ ,/ 与/ 算法/ 无关/ 的/ 数据/ 如/ T/ 、/ C/ 的/ 范围/ 设置/ 完全/ 随机/ 给出/ ,/ 与/ 算法/ 有关/ 的/ 如/ fc/ 、/ dc/ 由/ 以上/ 分析/ 而取/ 与/ T/ 、/ C/ 对应/ 合适/ 的/ 值/ ,/ 服务/ 可靠性/ R/ 也/ 取/ 现实/ 服务/ 相当/ 的/ 范围/ ./ 在/ 服务/ 随机/ 生成/ 之后/ ,/ 不确定性/ 事件/ 的/ 生成/ 概率/ 依据/ 已/ 生成/ 的/ 服务/ 可靠性/ R/ ./ 这/ 使得/ 实验/ 基本/ 与/ 现实情况/ 符合/ ,/ 所/ 生成/ 的/ 数据/ 具有/ 代表性/ ,/ 实验/ 得出/ 的/ 结论/ 具有/ 较/ 高/ 的/ 可信度/ ./ MDP/ 和/ 贪心/ 算法/ 均/ 采用/ Java/ 语言/ ,/ 运行/ 环境/ 为/ JRE1/ ./ 764bit/ ,/ 系统/ 平台/ MicrosoftWindows764bit/ ,/ 处理器/ 为/ Intel/ ?/ Corei3CPU3/ ./ 0GHz/ ,/ 系统/ 内存/ 为/ 4GB/ ,/ JVM/ 分配/ 512MB/ 内存/ ./ 6.2/ 实验/ 结果/ 与/ 分析/ 6.2/ ./ 1/ 实验/ 1/ ./ 不同/ 决策/ 策略/ (/ MDP/ 与/ 贪心/ )/ 的/ 效/ 针对/ 特定/ 的/ 服务/ 流程/ ,/ 随机/ 产生/ 不确定性/ 事件/ ,/ 使用/ MDP/ 方法/ 和/ 贪心/ 方法/ 分别/ 生成/ 决策/ 动作/ ,/ 对/ 流程/ 进行/ 自/ 适应/ 修改/ ,/ 进而/ 对比/ 分析/ 两种/ 策略/ 在/ 收益/ 、/ 执行/ 成功率/ 、/ 时间延迟/ 、/ 成本/ 溢出/ 4/ 个/ 方面/ 的/ 差异/ ./ 实验/ 中/ ,/ 不/ 确定/ 事件/ 按照/ 流程/ 中/ 包含/ 的/ 服务/ 可靠性/ 为/ 参数/ 随机/ 产生/ ./ 所/ 采用/ 的/ “/ 贪心/ 策略/ ”/ 是/ 指/ :/ 不/ 展望未来/ 的/ 收益/ ,/ 直接/ 从/ 当前/ 所/ 能/ 采取/ 的/ 所有/ 决策/ 动作/ 中/ 选择/ 收益/ 最大/ 的/ 动作/ ./ 在/ 不同/ 的/ 实验/ 设置/ 下/ (/ T/ 、/ C/ 、/ R/ 的/ 取值/ 范围/ 分别/ 为/ [/ 1/ ,/ 30/ ]/ 、/ [/ 1/ ,/ 100/ ]/ 、/ [/ 0.5/ ,/ 1.0/ ]/ ,/ fc/ 和/ dc/ 取/ 不同/ 值时/ )/ 进行/ 实验/ ,/ 从中/ 选择/ 两次/ 有/ 代表性/ 的/ (/ T/ 、/ C/ 、/ R/ 的/ 取值/ 范围/ 分别/ 为/ [/ 1/ ,/ 30/ ]/ 、/ [/ 1/ ,/ 100/ ]/ 、/ [/ 0.5/ ,/ 1.0/ ]/ ,/ fc/ =/ 0.5/ ×/ 服务/ 流程/ 总/ 价格/ ,/ dc/ =/ 2.0/ 元/ // s/ )/ 结果/ ,/ 对比/ 分别/ 如图/ 7/ 和/ 图/ 8/ 所示/ ./ 图中/ 横轴/ 表示/ 时间/ ,/ 不确定性/ Page11/ 图/ 8MDP/ 与/ 贪心/ 策略/ 在/ 决策/ 效果/ 上/ 的/ 对比/ 分析/ (/ 2/ )/ 事件/ 在/ 不同/ 时刻/ 产生/ ,/ 曲线/ 上/ 的/ 每个/ 点/ 代表/ 一个/ 不/ 确定/ 事件/ ;/ 纵轴/ 分别/ 表示/ 不/ 确定/ 事件/ 发生/ 后/ 采取相应/ 决策/ 后/ 所/ 累积/ 的/ 总/ 收益/ 、/ 成本/ 溢出/ 、/ 时间延迟/ ./ 从图/ 7/ 可以/ 看出/ ,/ 在/ 服务/ 执行/ 的/ 最初/ 阶段/ ,/ 贪心/ 策略/ 比/ 马尔可夫/ 策略/ 的/ 报酬/ 更高/ ,/ 但/ 随着/ 流程/ 向/ 后/ 执行/ ,/ MDP/ 策略/ 比/ 贪心/ 策略/ 体现/ 更好/ 的/ 收益/ ./ 在/ 图/ 8/ 的/ 实验/ 中/ ,/ MDP/ 方法/ 采取/ 了/ “/ 终止/ ”/ 的/ 决策/ 动作/ 以/ 避免/ 损失/ (/ 负/ 收益/ )/ 过高/ ,/ 故/ 相应/ 曲线/ 在/ 中途/ 断开/ ;/ 而/ 贪心/ 策略/ 则/ 一直/ 执行/ 至/ 服务/ 流程/ 最终/ 结束/ ,/ 但/ 所/ 带来/ 的/ 成本/ 消耗/ 和/ 时间/ 延误/ 均/ 很/ 高/ ./ 由此/ 可以/ 看出/ ,/ 本文/ 给出/ 的/ MDP/ 方法/ 较之/ 贪心/ 策略/ 具有/ 更好/ 的/ 决策/ 效果/ ./ 6.2/ ./ 2/ 实验/ 2/ ./ 赔偿/ 参数/ 对/ 决策/ 的/ 影响/ 如/ 4.3/ 节/ 所述/ ,/ 决策/ 收益/ 取决于/ 3/ 个/ 方面/ 的/ 因素/ :/ 服务/ 继续/ 向/ 后/ 执行/ 的/ 概率/ 、/ 时间延迟/ 、/ 成本/ 溢出/ ./ 前/ 二者/ 可以/ 统一/ 转化/ 为/ 成本/ (/ 1/ -/ r/ )/ ×/ fc/ 、/ Δ/ T/ ×/ dc/ ,/ 它们/ 取决于/ fc/ 和/ dc/ (/ 失败/ 补偿/ 、/ 单位/ 时间延迟/ 补偿/ )/ 的/ 大小/ ./ 将/ 这/ 3/ 个/ 部分/ 成本/ 分别/ 记为/ C1/ 、/ C2/ 、/ C3/ ./ 本/ 实验/ 以/ fc/ 为主/ ,/ 针对/ 特定/ 流程/ 在/ 执行/ 过程/ 中/ 所/ 发生/ 的/ 一个/ 特定/ 不/ 确定/ 事件/ ,/ 在/ fc/ 取/ 不同/ 值/ 的/ 情况/ 下/ 寻找/ 最优/ 决策/ 动作/ ./ 实验/ 结果/ 如图/ 9/ 所示/ ,/ 横轴/ 为/ fc/ 与/ 服务/ 流程/ 总/ 价格/ 的/ 比值/ ,/ 取值/ 范围/ 为/ [/ 0.1/ ,/ 2/ ]/ ,/ 图/ 9/ (/ a/ )/ 的/ 纵轴/ 表示/ 所/ 采取/ 的/ 决策/ 动作/ ,/ 图/ 9/ (/ b/ )/ 的/ 纵轴/ 表示/ 相应/ 的/ 决策/ 总/ 收益/ (/ Reward/ )/ ./ 从图/ 9/ (/ a/ )/ 中/ 可以/ 看出/ ,/ 在/ 参数值/ / 0.3/ 时/ ,/ 决策/ 动作/ 为/ “/ 终止/ ”/ ;/ 参数值/ 在/ (/ 0.3/ ,/ 1.2/ ]/ 时/ ,/ 决策/ 动作/ 开始/ 倾向/ 于/ “/ 重试/ ”/ ;/ 参数值/ 大于/ 1.2/ 时/ ,/ 倾向/ 于/ 选择/ “/ 重组/ ”/ 或/ “/ 重试/ ”/ ./ 这/ 意味着/ ,/ 如果/ fc/ 较/ 小/ ,/ C1/ 相对/ 于/ C3/ 来说/ 很小/ ,/ 决策/ 更/ 倾向/ 于/ 停止/ ,/ 从而/ 避免/ 后续/ 出现/ 其它/ 不/ 确定/ 事件/ 及/ 相应/ 决策/ 在/ C3/ 上/ 较大/ 的/ 累积/ ;/ 如果/ fc/ 较大/ ,/ C1/ 在/ 总成本/ 中所/ 占/ 的/ 比重/ 随之/ 增加/ ,/ 决策/ 将/ 力争/ 让/ 服务/ 继续执行/ 下去/ ,/ 以/ 避免/ 因为/ 失败/ 而/ 引起/ 的/ 巨大/ C1/ ./ 另外/ 从图/ 8/ (/ b/ )/ 中/ 可以/ 看出/ ,/ 随着/ 参数值/ 的/ 升高/ ,/ 相应/ 的/ 负/ 收益/ 基本/ 呈/ 线性/ 增加/ ,/ 这/ 表示/ fc/ 对/ 决策/ 代价/ 造成/ 较大/ 影响/ ./ dc/ (/ 单位/ 延迟时间/ 的/ 补偿/ )/ 对/ 决策/ 结果/ 造成/ 的/ 影响/ 与/ fc/ 类似/ ./ 限于/ 篇幅/ ,/ 这里/ 不再/ 给出/ 实验/ 结果/ ./ 6.2/ ./ 3/ 实验/ 3/ ./ 时间/ 复杂性/ 根据/ 5.4/ 节/ 的/ 分析/ ,/ 本文/ 方法/ 的/ 时间/ 复杂性/ 与/ 服务/ 方案/ 的/ 流程/ 结构/ 复杂性/ 具有/ 密切/ 的/ 关系/ ./ 实验/ 中/ ,/ 生成/ 3/ 种/ 不同/ 结构/ 的/ 流程/ (/ 纯/ 串行/ 结构/ 、/ 纯/ 并行/ 结构/ 、/ 混合结构/ )/ ,/ 执行/ MDP/ 算法/ ,/ 记录/ 相应/ 的/ 执行/ 时间/ ,/ 结果/ 如图/ 10/ 所示/ ./ 图/ 10/ 不同/ 流程/ 结构/ 和/ 规模/ 下/ 的/ 时间/ 复杂度/ 对比/ Page12/ 可以/ 看出/ ,/ 时间/ 复杂度/ 呈/ 指数/ 上升/ ,/ 在/ 同样/ 活动/ 数目/ 的/ 情况/ 下/ ,/ 串行/ 结构/ 流程/ 的/ 时间/ 复杂度/ 最高/ ,/ 纯/ 并行/ 的/ 几乎/ 为/ 常数/ ,/ 而/ 混合结构/ 介于/ 两者之间/ ./ 这/ 与/ 5.4/ 节/ 算法/ 复杂度/ 分析/ 的/ 结果/ 一致/ ./ 7/ 结束语/ 考虑/ 到/ “/ 不确定性/ ”/ 的/ 传播/ 特征/ ,/ 本文/ 采用/ UTG/ 作为/ 工具/ 刻画/ 不确定性/ 事件/ 、/ 服务/ 运行/ 时/ 状态/ 、/ 决策/ 动作/ 三者/ 之间/ 的/ 关系/ ,/ 进而/ 使用/ MDP/ 作为/ 决策/ 工具/ ,/ 寻求/ 全局/ 的/ 最优/ 决策/ ./ 实验/ 除了/ 证实/ 该/ 方法/ 相比/ 于/ 贪心/ 决策/ 的/ 优良性/ 之外/ ,/ 还/ 验证/ 了/ 赔偿/ 参数/ 不同/ 取值/ 下/ 对/ MDP/ 决策/ 效果/ 的/ 影响/ ./ 与/ 当前/ 服务/ 不确定性/ 决策/ 的/ 研究/ 相比/ ,/ 本文/ 的/ 方法/ 侧重于/ 运行/ 时/ 的/ 自/ 适应/ 决策/ 而/ 非/ 构建/ 时/ 的/ 模型/ 增强/ ./ 本文/ 的/ 目的/ 也/ 不是/ 研究/ 重试/ 、/ 重组/ 、/ 替换/ 等/ 某/ 一种/ 特定/ 动作/ 的/ 具体/ 算法/ ,/ 而是/ 将/ 多种/ 策略/ 并列/ 起来/ ,/ 根据/ 不/ 确定/ 事件/ 发生/ 时/ 的/ 动态/ 信息/ 来/ 动态/ 选择/ 最优/ 的/ 一种/ 应对/ 策略/ ,/ 从/ 经济/ 角度/ 考虑/ 不确定性/ 带来/ 的/ 时间/ 和/ 成本/ 方面/ 的/ 损失/ ,/ 作为/ 评判/ 决策/ 动作/ 优劣/ 的/ 标准/ ./ 下/ 一步/ 的/ 工作/ 包括/ :/ (/ 1/ )/ 将/ “/ 不/ 确定/ ”/ 从/ 软件/ 层面/ 扩展/ 到/ 业务/ 层面/ 、/ 考虑/ 更/ 多/ 类型/ 的/ 不确定性/ 事件/ (/ 例如/ 需求/ 变更/ 、/ 需求/ 取消/ 、/ 资源/ 不可/ 用/ 等/ )/ ;/ (/ 2/ )/ 使用/ 多方/ 参与/ 的/ 服务/ 协同/ 模型/ (/ choreography/ )/ 而/ 不是/ 简单/ 的/ BPEL/ 模型/ 刻画/ 服务/ 方案/ ,/ 因为/ 现实/ 中/ 的/ 不确定性/ 事件/ 来源于/ 多方/ 之间/ 的/ 交互/ 环节/ ;/ (/ 3/ )/ 扩展/ 目前/ 的/ 5/ 种/ 决策/ 动作/ ,/ 增加/ 更/ 复杂/ 的/ 决策/ 动作/ ,/ 例如/ “/ 补偿/ ”/ (/ compensation/ )/ 、/ 回退/ (/ rollback/ )/ 等/ ./ 

