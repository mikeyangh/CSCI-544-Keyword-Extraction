Page1/ 可信/ PDA/ 计算/ 平台/ 系统结构/ 与/ 安全/ 机制/ 赵波/ 1/ )/ ,/ 2/ )/ 张焕国/ 1/ )/ ,/ 2/ )/ 李晶/ 1/ )/ ,/ 2/ )/ 陈璐/ 1/ )/ ,/ 2/ )/ 文松/ 1/ )/ ,/ 2/ )/ 1/ )/ (/ 武汉大学/ 计算机/ 学院/ 武汉/ 430079/ )/ 2/ )/ (/ 空天/ 信息安全/ 与/ 可信计算/ 教育部/ 重点/ 实验室/ 武汉/ 430079/ )/ 摘要/ PDA/ 作为/ 一种/ 手持/ 设备/ ,/ 面临/ 着/ 众多/ 的/ 安全/ 问题/ ./ 文中/ 利用/ 可信计算/ 思想/ 构造/ 了/ 可信/ PDA/ 的/ 体系结构/ 与/ 安全/ 机制/ ./ 首先/ 提出/ 了/ 一种/ 带/ 数据恢复/ 功能/ 的/ 星型/ 信任/ 结构/ ,/ 其/ 在/ 安全性/ 、/ 效率/ 及/ 可靠性/ 等/ 方面/ 较/ TCG/ 的/ 链式/ 信任/ 结构/ 都/ 有/ 很大/ 提升/ ./ 在/ 此基础/ 上/ ,/ 进一步/ 使用/ 总线/ 仲裁/ 等/ 技术/ 构造/ 了/ 可信/ PDA/ 的/ 体系结构/ 模型/ ./ 文中/ 还/ 提出/ 并/ 实现/ 了/ 针对/ 可信/ PDA/ 嵌入式操作系统/ 的/ 安全/ 增强/ 、/ 基于/ 可信/ PDA/ 平台/ 的/ 可信/ 网络连接/ (/ TNC/ )/ 以及/ SD/ 卡全卡/ 加密/ 等/ 新/ 的/ 安全/ 技术/ 与/ 方法/ ./ 在/ 此基础/ 上/ ,/ 给出/ 一种/ 可信/ PDA/ 的/ 原型/ 系统/ ./ 经过/ 实验/ 验证/ ,/ 这/ 款/ 可信/ PDA/ 在/ 各/ 方面/ 都/ 达到/ 了/ 可信计算/ 平台/ 的/ 技术/ 要求/ ./ 关键词/ 可信计算/ ;/ 可信计算/ 平台/ ;/ 可信/ PDA/ ;/ 星型/ 信任/ 结构/ 1/ 引言/ 化在/ 硬件/ 芯片/ 里面/ 的/ ,/ 不/ 存在/ 被/ 攻击/ 的/ 可能性/ ,/ 因此/ 对于/ PDA/ 系统/ 的/ 安全/ 问题/ ,/ 业界/ 并/ 没有/ 给予/ 重视/ 和/ 研究/ ./ 然而/ ,/ 随着/ PDA/ 的/ 技术/ 发展/ 与/ 广泛应用/ ,/ 长期以来/ ,/ 很多/ 人/ 认为/ PDA/ 系统/ 的/ 软件/ 是/ 固/ PDA/ 也/ 面临/ 着/ 巨大/ 的/ 安全/ 威胁/ :/ 首先/ ,/ PDA/ 是/ 一种/ Page2/ 手持/ 移动/ 设备/ ,/ 容易/ 丢失/ ,/ 由此/ 可能/ 被/ 冒用/ ,/ 造成/ 信息/ 泄露/ ;/ 其次/ ,/ 由于/ 存储器/ 技术/ 的/ 发展/ ,/ PDA/ 的/ 存储器/ 越来越/ 多地/ 采用/ 可编程/ FLASH/ 器件/ ./ 因此/ 病毒/ 等/ 恶意代码/ 完全/ 可以/ 攻击/ PDA/ 系统/ ;/ 再其次/ ,/ PDA/ 的/ 主要/ 通信/ 方式/ 为/ 无线通信/ ,/ 因此/ 会/ 产生/ 电磁/ 再次/ 辐射/ ,/ 极易/ 造成/ 通信/ 信息/ 的/ 泄露/ ./ 目前/ ,/ 对/ PDA/ 设备/ 及/ 嵌入式/ 系统安全/ 增强/ 的/ 方法/ ,/ 大部分/ 还是/ 采用/ 诸如/ SD/ 卡/ 加密/ 等/ 对/ 敏感数据/ 进行/ 保护/ 的/ 传统/ 安全/ 技术/ ./ 这种/ 安全/ 保护/ 并/ 没有/ 从/ 体系结构/ 和/ 操作系统/ 等/ 软硬件/ 底层/ 提供/ 根本性/ 的/ 安全/ 保障/ ./ 可信计算/ 技术/ 是/ 近年来/ 出现/ 的/ 一种/ 新/ 的/ 信息系统/ 安全/ 技术/ ,/ 目前/ 已/ 在/ 世界/ 范围/ 形成/ 了/ 热潮/ ./ 它/ 是/ 提高/ 计算机系统/ 安全性/ 的/ 行之有效/ 的/ 新/ 技术/ ,/ 因此/ 也/ 是/ 解决/ PDA/ 安全/ 问题/ 的/ 有效途径/ ./ 国内外/ 众多/ 研究/ 机构/ 、/ 学者/ 已经/ 对/ 该/ 领域/ 开展/ 了/ 许多/ 研究/ 工作/ ,/ 并/ 取得/ 了/ 一定/ 的/ 成果/ :/ 可信计算/ 组织/ TCG/ 已经/ 提出/ 了/ 用于/ 解决/ 移动/ 平台/ 的/ 安全/ 规范/ ①/ ②/ 和/ 设想/ ,/ 但是/ 尚未/ 有/ 任何/ 具体/ 的/ 实现/ 理论/ 和/ 技术/ 的/ 说明/ ;/ Intel/ 、/ IBM/ 、/ NTT/ 等/ 公司/ 提出/ 了/ 可信/ 移动/ 平台/ (/ TrustedMobilePlatform/ ,/ TMP/ )/ 项目/ ,/ 以/ TCG/ 的/ 可信/ 平台/ 模块/ (/ TrustedPlatformModule/ ,/ TPM/ )/ 为/ 基础/ ,/ 提出/ 了/ 可信/ 移动/ 平台/ 的/ 软件/ 、/ 硬件/ 体系结构/ 和/ 协议/ 规范/ ③/ ④/ ⑤/ ⑥/ ,/ 但/ 同样/ 缺乏/ 具体/ 的/ 实现/ 方案/ ;/ 国内/ 的/ 其他/ 学者/ [/ 1/ -/ 4/ ]/ 也/ 提出/ 了/ 利用/ 该/ TPM/ 模块/ 与/ 嵌入式/ CPU/ 进行/ 通信/ ,/ 以/ 改善/ 嵌入式/ 系统安全/ 水平/ 的/ 方法/ ,/ 这些/ 平台/ 构建/ 方案/ 都/ 是/ 基于/ TPM/ 模块/ ,/ 现有/ TPM/ 模块/ 是/ 针对/ PC/ 终端/ 设计/ 的/ ,/ 并/ 不能/ 满足/ 移动/ 平台/ 特有/ 的/ 属性/ 和/ 应用/ 需求/ ,/ 也/ 没有/ 解决/ TPM/ 和/ 嵌入式/ CPU/ 的/ 双/ CPU/ 结构/ 对系统/ 的/ 控制/ 等/ 问题/ ./ 目前/ ,/ 基于/ TCG/ 的/ 规范/ 标准/ ,/ 已经/ 有/ 了/ 比较/ 成熟/ 的/ 可信/ PC/ 产品/ ,/ TCG/ 对/ 可信/ PC/ [/ 5/ ]/ 的/ 链式/ 信任/ 关系/ 的/ 定义/ 和/ 实现/ 值得/ 研究/ 可信/ 嵌入式/ 平台/ 借鉴/ ./ 本文/ 描述/ 的/ 可信/ PDA/ 在/ 理论/ 上/ 提出/ 了/ 适合/ 嵌入式/ 系统/ 的/ 带/ 数据恢复/ 功能/ 的/ 星型/ 信任/ 结构/ ,/ 并/ 使用/ 总线/ 仲裁/ 等/ 新/ 技术/ 来/ 管理/ TPM/ 和/ 嵌入式/ CPU/ ,/ 解决/ 了/ 安全控制/ 和/ 系统/ 应用/ 之间/ 的/ 矛盾/ ,/ 提高/ 了/ 嵌入式/ 系统/ 的/ 可信性/ 和/ 工作效率/ ./ 可信/ PDA/ 还/ 支持/ 基于/ 硬件/ 的/ 存储设备/ 加密/ 、/ 基于/ 硬件/ 的/ 外部设备/ 安全/ 管理/ 等/ 功能/ 、/ 操作系统/ 安全/ 增强/ 和/ 可信/ 网络连接/ (/ TNC/ )/ ,/ 基本/ 实现/ 了/ 可信计算/ 对/ 嵌入式/ 系统安全/ 的/ 期望/ ./ 2/ 可信/ PDA/ 的/ 体系结构/ 可信/ PDA/ 除/ 提供/ 一般/ PDA/ 的/ 功能/ 之外/ ,/ 更/ 重要/ 的/ 是/ 能/ 为/ 用户/ 提供/ 可信/ 安全/ 保障/ ./ 可信/ PDA/ 采用/ 可信计算/ 机制/ ,/ 利用/ 可信/ 平台/ 模块/ (/ TPM/ )/ 和/ 信任/ 链/ 技术/ 对系统/ 安全性/ 进行/ 了/ 增强/ ,/ 提高/ 了/ PDA/ 的/ 安全性/ ./ 可信/ PDA/ 由/ S3c2410xARMCPU/ 、/ JetWay2810/ 安全/ 芯片/ ⑦/ 、/ FPGA/ 、/ 指纹识别/ 模块/ 、/ GPS/ 、/ WLAN/ 等/ 控制/ 芯片/ 构成/ ,/ 并/ 有/ TFT/ 触摸屏/ 、/ USB/ 等/ 外部/ 输入输出/ 设备/ ,/ 采用/ 包含/ 图形界面/ 的/ 嵌入式/ Linux/ 作为/ 操作系统/ ,/ 其/ 基本/ 结构/ 如图/ 1/ 所示/ ./ 除了/ 保持/ 传统/ PDA/ 的/ 特点/ 之外/ ,/ 还/ 根据/ 可信/ ≈/ 可靠/ +/ 安全/ 的/ 学术思想/ [/ 6/ -/ 7/ ]/ ,/ 从/ 理论/ 上/ 完成/ 了/ 星型/ 信任/ 结构/ 的/ 设计/ ,/ 并/ 从技术上/ 实现/ 了/ 如下/ 的/ 安全/ 特点/ :/ (/ 1/ )/ 具有/ 数据恢复/ 功能/ 的/ 星型/ 信任/ 结构/ ./ 信任/ 链是/ 保证/ 计算机设备/ 可信性/ 的/ 一个/ 基本/ 手段/ ,/ 可信/ PDA/ 针对/ 嵌入式/ 系统/ 的/ 自身/ 特点/ 和/ 可信/ PC/ 链式/ 信任/ 结构/ 的/ 不足之处/ ,/ 设计/ 了/ 全新/ 的/ 星型/ 信任/ 结构/ ,/ 这种/ 信任/ 结构/ 可以/ 降低/ 信任/ 传递/ 时/ 的/ 损耗/ ,/ 提高/ 信任/ 传递/ 的/ 效率/ 、/ 保护/ 可信/ 测量/ 根/ CTRM/ 的/ 物理/ 安全/ 等/ ./ 同时/ ,/ 信任/ 结构/ 还/ 带有/ 数据恢复/ 功能/ ,/ 启动/ 时/ 如果/ 发现/ 软件/ 部分/ 不/ 完整/ (/ 包括/ 人为/ 的/ 破坏/ 和/ 病毒/ 的/ 传染/ )/ ,/ 则/ 自动/ 启动/ 恢复/ 功能/ ,/ 以/ 备份/ 软件/ 覆盖/ 受损/ 内容/ ,/ 确保/ 平台/ 软件/ 的/ 完整性/ 和/ 可靠性/ ./ (/ 2/ )/ 包含/ 总线/ 仲裁/ 模块/ 的/ ETPM/ (/ EmbeddedSystem/ -/ TPM/ )/ 新/ 结构/ ./ 以/ JetWay2810/ 安全/ 芯片/ 为/ TPM/ 核心/ 芯片/ ,/ FPGA/ 以/ 总线/ 形式/ 与/ JetWay2810/ 相连/ ,/ 构成/ 了/ 包括/ 总线/ 仲裁/ 和/ 对称/ 密码/ 算法/ 模块/ 的/ ①/ ②/ trustedcomputinggroup/ ./ org/ // specs/ // mobilephone/ // tcg2mobile2/ -/ ③/ ④/ tion/ [/ EB/ // OL/ ]/ ./ [/ 2007206205/ ]/ ./ http/ :/ // // www/ ./ trustedmo/ -/ ⑤/ ⑥/ ⑦/ Page3/ 图/ 1/ 可信/ PDA/ 体系结构/ 框图/ 完整/ ETPM/ (/ 图/ 1/ 虚线/ 部分/ )/ ,/ 这/ 是/ 对/ TCG/ 规范/ 的/ 一个/ 改进/ ./ 可信/ PDA/ 上电/ 伊始/ 就/ 以/ TPM/ 为主/ 控/ 设备/ ,/ 用/ TPM/ ①/ 控制/ 指纹/ 模块/ 对/ 用户/ 身份/ 加以/ 识别/ ,/ 之后/ 对/ 所有/ 启动/ 部分/ 实施/ 完整性/ 度量/ ,/ 只有/ 经/ 完整性/ 度量/ 确认/ 环境/ 安全/ 之后/ ,/ 才/ 允许/ ARM/ 平台/ 启动/ ./ 相对/ 于/ 目前/ 可信/ PC/ 的/ 实现/ 方案/ ,/ 本/ 方法/ 更能/ 确保/ TPM/ 的/ 主控/ 地位/ ,/ 提高/ 安全性/ ./ JetWay2810/ 芯片/ 还/ 通过/ FPGA/ 对/ 部分/ 外设/ 通信/ 信道/ 的/ 硬件/ 通断/ 进行/ 物理层/ 控制/ ,/ 如/ USB/ 设备/ (/ 包括/ 无线/ 网卡/ 和/ GPS/ )/ ./ 这样/ 就/ 做到/ 了/ 既/ 安全/ 又/ 可控/ ,/ 符合/ 我国/ 政府/ 的/ 信息安全/ 政策/ ./ (/ 3/ )/ 操作系统/ 安全/ 增强/ ./ 在/ 嵌入式操作系统/ 上/ 实现/ 了/ 包括/ 加密/ 文件系统/ 、/ 重要/ 存储/ 区域/ 的/ 隔离/ 保护/ 、/ 日志/ 系统/ 、/ 强制/ 访问控制/ 等/ 安全/ 功能/ ,/ 提供/ 全面/ 的/ 操作系统/ 安全/ 保障/ ,/ 为/ 上层/ 应用软件/ 的/ 安全/ 提供/ 了/ 基础/ [/ 8/ ]/ ./ 用户/ 身份/ 使用/ 指纹/ 进行/ 识别/ ,/ 并/ 结合/ 本/ 机/ 硬件/ 特征/ 形成/ 各类/ 密钥/ ,/ 密钥/ 存储/ 于/ ETPM/ 中/ ,/ 并/ 受/ 其/ 物理/ 级别/ 的/ 保护/ ./ NandFlash/ 存储器/ 中/ 的/ 信息/ ,/ 以/ 密文/ 形式/ 存储/ ,/ 并/ 结合/ 硬件/ 密码/ 算法/ 模块/ 对/ SD/ 卡/ 实现/ 全卡/ 加密/ ,/ 被/ 加密/ 过/ 的/ SD/ 卡/ 只能/ 在/ 本机/ 使用/ ,/ 在/ 其它/ 设备/ 上/ 无法/ 读取/ 其/ 内容/ ,/ 从而/ 实现/ 了/ 软件/ 和/ 数据/ 的/ 防/ 复制/ 功能/ ,/ 可以/ 防止/ 可信/ PDA/ 丢失/ 后/ 的/ 冒用/ ./ (/ 4/ )/ 可信/ 网络连接/ ./ 可信/ 网络连接/ (/ TNC/ )/ 是/ 可信计算/ 向/ 网络/ 领域/ 扩展/ 的/ 一种/ 重要/ 技术/ ./ 它/ 将/ 可信计算/ 机制/ 引入/ 网络/ ,/ 把/ 信任/ 链/ 从/ 终端/ 平台/ 扩展/ 到/ 网络/ ,/ 使得/ 网络/ 成为/ 一种/ 可信/ 的/ 计算环境/ ./ 在/ 可信/ PDA/ 中/ 我们/ 设计/ 并/ 实现/ 了/ 基于/ 远程/ 证明/ 的/ 可信/ 网络连接/ (/ TNC/ )/ ②/ ,/ 即/ 在/ 使用/ 网络/ 功能/ 之前/ ,/ 对要/ 接入/ 网络/ 的/ 设备/ 进行/ 完整性/ 验证/ ③/ ,/ 以/ 保证/ 网络/ 环境/ 下/ 应用/ 的/ 安全/ ④/ ⑤/ [/ 9/ ]/ ./ 除此之外/ ,/ 可信/ PDA/ 还/ 配备/ 了/ 100M/ 速率/ 网卡/ ,/ 提供/ 图形化/ 的/ 操作/ 接口/ ,/ 实现/ 了/ 资源管理/ 器/ 、/ 音频/ 等/ 实用功能/ ,/ 方便/ 一般/ 用户/ 的/ 日常/ 工作/ 与/ 使用/ ./ 3/ 星型/ 的/ 信任/ 结构/ 对于/ 不同/ 的/ 实体/ ,/ 可以/ 使用/ 不同/ 的/ 组织/ 方式/ 来/ 表示/ 它们/ 之间/ 的/ 相互信任/ 关系/ ,/ 这种/ 组织/ 方式/ 即/ 为/ 信任/ 结构/ ./ 对于/ 各个/ 实体/ ,/ 最/ 直接/ 的/ 组织/ 方式/ 既/ 为/ 两/ 两/ 之间/ 都/ 有/ 直接/ 的/ 信任/ 关系/ ./ 如图/ 2/ 所示/ [/ 10/ ]/ ./ 这种/ 相互信任/ 结构/ 可以/ 非常/ 方便/ 地/ 表示/ 出/ 各个/ ①/ ②/ ③/ tectureforInteroperabilityRevision1/ ./ 1/ [/ EB/ // OL/ ]/ ./ Trustedinggroup/ ./ org/ ④/ ⑤/ Page4TCG/ 的/ 链式/ 信任/ 结构/ 存在/ 着/ 很多/ 的/ 不足之处/ :/ (/ 1/ )/ 可信/ 测量/ 根/ CRTM/ 置于/ TPM/ 之外/ ,/ 不受/ TPM/ 的/ 物理/ 保护/ ,/ 容易/ 受到/ 恶意/ 攻击/ 破坏/ ;/ (/ 2/ )/ 由于/ 可信/ 的/ 测量/ 值/ 采用/ 迭代/ 的/ 计算方法/ ,/ 因此/ 如果/ 在/ 信任/ 链/ 形成/ 后/ 增加/ 或者/ 删除/ 某个/ 部件/ ,/ 或者/ 软件/ 的/ 版本升级/ ,/ 都/ 必须/ 重新/ 计算/ 所有/ 的/ 信任/ 值/ ,/ 增加/ 了/ 维护/ 和/ 管理/ 的/ 难度/ ;/ (/ 3/ )/ 根据/ 信任/ 理论/ ,/ 信任/ 值/ 在/ 传递/ 过程/ 中会/ 有/ 损耗/ ,/ 传递/ 的/ 路径/ 越长/ ,/ 则/ 损耗/ 越大/ [/ 7/ ]/ ./ 由于/ 链式/ 信任/ 结构/ 的/ 信任/ 传递/ 路径/ 长/ ,/ 所以/ 容易/ 产生/ 信任/ 的/ 损耗/ ./ 3.1/ 星型/ 信任/ 结构/ 条/ 原则/ 如下/ [/ 12/ ]/ :/ 基于/ Dempster/ -/ Shafer/ 原理/ 的/ 计算/ 信任/ 值/ 的/ 两/ (/ 1/ )/ 信任/ 衰减/ 原则/ 如果/ 节点/ A/ 对/ 节点/ B/ 的/ 信任/ 值为/ T/ (/ A/ ,/ B/ )/ ,/ 节点/ B/ 对/ 节点/ C/ 的/ 信任/ 值为/ T/ (/ B/ ,/ C/ )/ ,/ TB/ (/ A/ ,/ C/ )/ 表示/ 经由/ B/ 点/ 传递/ 的/ A/ ,/ C/ 之间/ 的/ 信任/ 关系/ ./ 由/ 传递性/ 可以/ 推断出/ A/ 和/ C/ 之间/ 的/ 信任/ 关系/ ./ 实体/ 之间/ 的/ 相互信任/ 关系/ ,/ 但是/ ,/ 这种/ 结构/ 需要/ 维护/ 的/ 关系/ 表/ 很多/ ,/ 如果/ 实体/ 数量/ 较/ 多/ ,/ 实现/ 将/ 非常/ 困难/ ./ TCG/ 提出/ 了/ 一种/ 链式/ 的/ 信任/ 结构/ 来/ 实现/ 实体/ 的/ 信任/ 关系/ ,/ 与/ 相互信任/ 结构/ 相比/ ,/ 该/ 结构/ 更/ 易于/ 实现/ ./ 根据/ TCG/ 规范/ 中/ 的/ 定义/ ,/ 信任/ 传递/ 呈/ 一种/ 链式/ 结构/ ,/ 在/ 可信/ 平台/ 的/ 信任/ 链/ 传递/ 过程/ 中/ ,/ 各层/ 可信/ 代理/ 之间/ 层层/ 传递/ 信任/ 关系/ [/ 11/ ]/ ./ 定理/ 1/ ./ TB/ (/ A/ ,/ C/ )/ =/ T/ (/ A/ ,/ B/ )/ / T/ (/ B/ ,/ C/ )/ ./ 这里/ 符号/ / 表示/ 提取/ 两者之间/ 信任/ 最小值/ 的/ 概念/ ,/ 因此/ 有/ TB/ (/ A/ ,/ C/ )/ / min/ (/ T/ (/ A/ ,/ B/ )/ ,/ T/ (/ B/ ,/ C/ )/ )/ ./ (/ 2/ )/ 信任/ 聚合/ 原则/ 节点/ A/ 到/ 节点/ D/ 存在/ 两条/ 独立/ 的/ 路径/ ,/ 这/ 两条/ 路径/ 分别/ 给出/ 它们/ 的/ 信任/ 值/ TB/ (/ A/ ,/ D/ )/ 和/ TC/ (/ A/ ,/ D/ )/ ./ TB/ (/ A/ ,/ D/ )/ 表示/ 经由/ B/ 点/ 传递/ 的/ A/ ,/ D/ 之间/ 的/ 信任/ 关系/ ,/ TC/ (/ A/ ,/ D/ )/ 表示/ 经由/ C/ 点/ 传递/ 的/ A/ ,/ D/ 之间/ 的/ 信任/ 关系/ ./ 由此/ 可以/ 判断/ 出/ A/ 和/ D/ 之间/ 的/ 信任/ 关系/ ./ 定理/ 2/ ./ T/ (/ A/ ,/ D/ )/ =/ TB/ (/ A/ ,/ D/ )/ / TC/ (/ A/ ,/ D/ )/ ./ 这里/ 符号/ / 表示/ 提取/ 两者之间/ 信任/ 最大值/ 的/ 概念/ ,/ 因此/ 有/ T/ (/ A/ ,/ D/ )/ / max/ (/ TB/ (/ A/ ,/ D/ )/ ,/ TC/ (/ A/ ,/ D/ )/ )/ ./ 图/ 4/ 分别/ 图示/ 了/ 链式/ 信任/ 结构/ 和/ 星型/ 信任/ 结构/ ./ 在/ 图/ 4/ 中/ ,/ 依照/ 以上/ 两条/ 原则/ 递推/ :/ 由/ 链式/ 结构/ ,/ 信任/ 链/ 经过/ 节点/ :/ A/ -/ >/ B/ -/ >/ C/ -/ >/ D/ -/ >/ …/ -/ >/ L/ -/ >/ M/ -/ >/ N/ ,/ 则/ 链式/ 信任/ 结构/ 的/ 各级/ 信任/ 值有/ T/ (/ A/ ,/ C/ )/ =/ min/ (/ T/ (/ A/ ,/ B/ )/ ,/ T/ (/ B/ ,/ C/ )/ )/ ,/ T/ (/ A/ ,/ C/ )/ 表示/ 经过/ B/ 点/ 的/ A/ 、/ C/ 之间/ 的/ 信任/ 关系/ ,/ 以此类推/ ,/ 有/ T/ (/ B/ ,/ D/ )/ =/ min/ (/ T/ (/ B/ ,/ C/ )/ ,/ T/ (/ C/ ,/ D/ )/ )/ ,/ …/ ,/ 其/ 最终/ 信任/ 值/ Tline/ 不会/ 大于/ min/ (/ T/ (/ A/ ,/ B/ )/ ,/ T/ (/ B/ ,/ C/ )/ ,/ …/ ,/ T/ (/ L/ ,/ M/ )/ ,/ T/ (/ M/ ,/ N/ )/ )/ ,/ 并且/ ,/ 从/ 节点/ A/ 到/ 节点/ N/ 的/ 路径/ 上/ 任何/ 一个/ 信任/ 关系/ 的/ 破坏/ ,/ 都/ 会/ 完全/ 破坏/ 整个/ 信任/ 链/ ./ 结论/ 1/ ./ 如果/ 依照/ 星型/ 信任/ 结构/ ,/ 节点/ A/ 与/ 节点/ N/ 之间/ 有/ 多条/ 直接/ 路径/ :/ T1/ (/ A/ ,/ N/ )/ ,/ T2/ (/ A/ ,/ N/ )/ ,/ T3/ (/ A/ ,/ N/ )/ ,/ …/ ,/ Tn/ (/ A/ ,/ N/ )/ ;/ 则/ 最终/ 信任/ 值/ Tstar/ 不会/ 小于/ max/ (/ T1/ (/ A/ ,/ N/ )/ ,/ T2/ (/ A/ ,/ N/ )/ ,/ T3/ (/ A/ ,/ N/ )/ ,/ …/ ,/ Tn/ (/ A/ ,/ N/ )/ )/ ,/ 即/ 总有/ Tstar/ / Tline/ (/ Tstar/ 在/ 最坏/ 情况/ 下/ 等于/ Tline/ 在/ 最好/ 情况/ 下/ 的/ 值/ )/ ;/ 而且/ 星型/ 信任/ 关系/ 结构/ 较之/ 前者/ 健壮/ [/ 13/ ]/ ./ 结论/ 2/ ./ 在/ 星型/ 信任/ 结构/ 中/ ,/ 节点/ A/ 一般/ 作为/ 信任/ 根/ 出现/ ,/ 由/ 它/ 进行/ 对/ 其它/ 节点/ 的/ 度量/ 工作/ ,/ 其/ 作用/ 相当于/ TCG/ 定义/ 的/ TPM/ ,/ 然而/ ,/ 其/ 具体/ 的/ 结构/ 与/ TPM/ 略有不同/ ,/ 星型/ 信任/ 结构/ 的/ TPM/ 将/ 包含/ 可信/ Page5/ 将/ 链式/ 信任/ 结构/ 和/ 星型/ 信任/ 结构/ 进行/ 比较/ 可以/ 度量/ 根/ CRTM/ ,/ 这样/ 可以/ 最大/ 限度/ 地/ 保证/ CRTM/ 在/ 物理/ 上/ 是/ 安全/ 的/ ./ 结论/ 3/ ./ 星型/ 信任/ 结构/ 的/ 信任/ 值/ 计算/ 是/ 根/ 节点/ 与/ 每/ 一个/ 测量/ 节点/ 之间/ 的/ 独立/ 计算结果/ ,/ 互相/ 之间/ 不会/ 产生/ 影响/ ,/ 因此/ 添加/ 和/ 删除/ 组件/ 以及/ 软件/ 版本升级/ ,/ 只/ 需要/ 根/ 节点/ 对/ 该/ 节点/ 单独/ 重新/ 进行/ 计算/ 即可/ ,/ 不会/ 影响/ 到/ 整个/ 信任/ 链/ ./ 看出/ ,/ 星型/ 信任/ 结构/ 优于/ 链式/ 信任/ 结构/ ./ 星型/ 信任/ 结构/ 也/ 有/ 不足之处/ :/ 在/ 星型/ 结构/ 中/ ,/ 由于/ 根/ 节点/ 处于/ 中心/ 位置/ ,/ 在/ 平台/ 的/ 工作/ 过程/ 中/ 需要/ 不断/ 地/ 对/ 各/ 节点/ 进行/ 完整性/ 度量/ 和/ 可信度/ 的/ 判断/ ,/ 因此/ ,/ 根/ 节点/ 的/ 计算/ 压力/ 较大/ ,/ 可能/ 造成/ 平台/ 工作效率/ 的/ 损失/ ./ 但是/ ,/ PDA/ 系统/ 有/ 自己/ 的/ 特点/ ,/ 其/ TPM/ 与/ ARMCPU/ 的/ 计算能力/ 相当/ ,/ 因此/ TPM/ 的/ 工作/ 不会/ 带来/ 系统/ 整体/ 性能/ 明显/ 的/ 改变/ ./ 可信/ PDA/ 原型/ 系统/ 的/ 实际/ 运行/ 情况/ 也/ 证明/ 了/ 这/ 一点/ ./ 所以/ ,/ 可信/ PDA/ 使用/ 星型/ 信任/ 结构/ 是/ 可行/ 的/ ,/ 它/ 保证/ 了/ 系统/ 的/ 信任度/ 优于/ 可信/ PC/ 的/ 链式/ 信任/ 结构/ ./ 可信/ PDA/ 的/ 星型/ 信任/ 结构/ 以/ TPM/ 为/ 可信/ 根/ ,/ 作为/ 整个/ 嵌入式/ 平台/ 的/ 可信/ 测量/ 和/ 控制器/ ,/ 嵌入式/ 平台/ 作为/ 从/ 设备/ 受/ TPM/ 的/ 管理/ 和/ 控制/ ;/ TPM/ 内部/ 采用/ 物理/ 方式/ 集成/ 了/ 可信度/ 量根/ 、/ 可信/ 存储/ 根/ 和/ 可信/ 报告/ 根/ ,/ 对/ 自身/ 以及/ 连接/ 电路/ 有/ 良好/ 的/ 物理/ 保护/ ;/ TPM/ 启动/ 后/ ,/ 只有/ 身份/ 信息/ 和/ 存储器/ 内容/ 的/ 完整性/ 验证/ 完成/ 之后/ ,/ 可信/ 的/ 代码/ 才能/ 在/ 嵌入式/ 平台/ 上/ 执行/ ./ 星型/ 信任/ 结构/ 如图/ 5/ 所示/ ./ 星型/ 信任/ 结构/ 和/ 可信/ 启动/ 的/ 概念/ ,/ 已经/ 获得/ 国家专利/ 授权/ (/ 专利号/ ZL200710053331/ ./ 1/ ;/ ZL200710053330/ ./ 7/ )/ ./ 3.2/ 总线/ 仲裁/ 为了/ 实现/ 系统启动/ 前/ 的/ 星型/ 信任/ 结构/ 的/ 完整性/ 校验/ ,/ TPM/ 要/ 将/ NandFlash/ 中/ 的/ BootLoader/ ,/ Linuxkernel/ 等/ 内容/ 读入/ 进行/ 校验/ [/ 14/ ]/ ,/ 这/ 就/ 涉及/ 到/ 两个/ 问题/ :/ (/ 1/ )/ 启动/ 顺序/ ,/ 在/ 上/ 电后/ ,/ TPM/ 要/ 先/ 进行/ 完整性/ 检验/ ,/ 此时/ ARM/ 还/ 不能/ 启动/ ,/ 在/ TPM/ 校验/ 通过/ 后/ ,/ ARM/ 开始/ 启动/ ;/ (/ 2/ )/ S3C2410ARMCPU/ 和/ TPM/ 都/ 需要/ 读取/ NandFlash/ 的/ 值/ ,/ 因此/ 需要/ 对/ Flash/ 读取/ 的/ 总线/ 进行/ 仲裁/ ./ 总线/ 仲裁/ 的/ 体系结构/ 设计/ 框图/ 如图/ 6/ 所示/ ./ 在/ 图/ 6/ 中/ ,/ 使用/ FPGA/ 实现/ S3C2410/ 和/ TPM/ 对/ NandFlash/ 的/ 分时/ 操作/ ,/ TPM/ 为/ 控制/ 核心/ ,/ 由/ 它/ 来/ 控制/ 可信/ PDA/ 的/ 启动/ 流程/ ,/ 可以/ 根据/ 度量/ 情况/ 随时/ 将/ S3C2410/ 关断/ 和/ 启动/ ./ 这种/ 方法/ 解决/ 了/ 可信/ PC/ 中/ 可信/ 根/ 度量/ 和/ BIOS/ 同时/ 工作/ 的/ 尴尬/ 局面/ ,/ 真正/ 使/ TPM/ 处于/ 主控/ 地位/ ./ 总线/ 仲裁/ 的/ 实现/ 还/ 可以/ 带来/ 如下/ 的/ 好处/ :/ (/ 1/ )/ TPM/ 控制/ 方便/ ,/ 灵活/ ./ TPM/ 通过/ 对/ 总线/ 控制器/ 中/ 的/ 控制/ 寄存器/ 的/ 修改/ ,/ 可以/ 完全/ 使用/ 程序/ 来/ 灵活/ 控制/ S3C2410/ 的/ 启动/ ,/ TPM/ 也/ 可以/ 使用/ 程序/ 来/ 控制/ 读取/ NandFlash/ 的/ 信息量/ ./ (/ 2/ )/ 扩展/ 方便/ ./ 本/ 模块/ 设计/ 了/ TPM/ 对/ S3C2410/ 的/ 开启/ 与/ 关断/ ,/ 若想/ 实现/ 其它/ 安全控制/ ,/ 如/ 关闭/ 某个/ 外设/ ,/ 只/ 需要/ 对/ 体系结构/ 做/ 些许/ 修改/ [/ 6/ ,/ 15/ ]/ ;/ 此外/ ,/ 还/ 可以/ 非常容易/ 地/ 扩展/ 实现/ TPM/ 对/ NandFlash/ 的/ 读/ Page6/ 写/ 保护/ ./ 从/ 物理/ 上/ 保护/ 存储设备/ 中/ 内容/ 的/ 完整性/ 和/ 安全性/ ./ 可信/ PC/ 没有/ 考虑/ 总线/ 仲裁/ 问题/ ,/ 采用/ 了/ TPM/ 和/ CPU/ 同时/ 启动/ 的/ 可信/ 根/ 扩展/ 的/ 方法/ [/ 16/ ]/ ./ 这种/ 方法/ 是/ 对/ 现有/ PC/ 产品/ 的/ 一种/ 妥协/ ,/ 使得/ 对/ CRTM/ 的/ 保护/ 和/ 对/ BIOS/ 的/ 度量/ 都/ 难于/ 实现/ ./ 这是/ 目前/ 可信/ PC/ 的/ 一个/ 缺陷/ ./ 3.3/ 具有/ 数据恢复/ 功能/ 的/ 信任/ 结构/ 可信/ PDA/ 仅仅/ 具有/ 安全/ 功能/ 是/ 不够/ 的/ ,/ 根据/ 可信/ ≈/ 可靠/ +/ 安全/ 的/ 学术思想/ [/ 7/ ]/ (/ https/ :/ // // www/ ./ trustedcomputinggroup/ ./ org/ // network/ // )/ ,/ 可信/ 的/ 产品/ 也/ 应该/ 有/ 较/ 好/ 的/ 可靠性/ ./ 因此/ ,/ TPM/ 在/ 启动/ 时若/ 检测/ 到/ 可信/ PDA/ 的/ OS/ 、/ Bootloader/ 等/ 已经/ 受到/ 了/ 攻击/ 并/ 被/ 篡改/ 时/ ,/ 除了/ 阻止/ PDA/ 的/ 进一步/ 运行/ 之外/ ,/ 需要/ 提供/ 一种/ 机制/ 以/ 使得/ PDA/ 能够/ 恢复/ 到/ 其/ 正常/ 的/ 状态/ ,/ 保证/ PDA/ 的/ 正常/ 工作/ 不/ 受/ 干扰/ ./ 可信/ PDA/ 的/ 备份/ 恢复/ 机制/ 需要/ 对/ TCG/ 规范/ 中/ 的/ TPM/ 结构/ 进行/ 扩展/ ,/ 在/ TPM/ 内部/ 添加/ 一个/ 受/ 物理/ 保护/ 的/ 系统/ 备份/ 存储器/ ,/ 保存/ 计算机系统/ 引导/ 程序/ 和/ 操作系统/ 等/ 希望/ 被/ 保护/ 的/ 内容/ 代码/ ./ TPM/ 在/ 系统启动/ 之前/ 对/ PDA/ 引导/ 程序代码/ 及/ 操作系统/ 代码/ 进行/ 完整性/ 校验/ ,/ 若/ 校验/ 未/ 通过/ 则/ 认为/ 以上/ 内容/ 被/ 篡改/ ,/ TPM/ 将/ 使用/ 总线/ 仲裁/ 机制/ 获取/ 总线/ 控制权/ ,/ 从受/ 保护/ 的/ 备份/ 存储器/ 中/ 读取/ 相应/ 的/ 备份/ 代码/ ,/ 并/ 将/ 其/ 写入/ PDA/ 外部/ 工作/ 用/ 存储器/ ,/ 再次/ 进行/ 完整性/ 校验/ ,/ 若/ 通过/ 校验/ ,/ 表明/ 系统/ 恢复/ 成功/ ,/ TPM/ 将/ 交出/ 总线/ 控制权/ ,/ 允许/ PDA/ 设备/ 系统启动/ ./ 与/ 现有/ 的/ 技术/ 相比/ ,/ 该/ 方式/ 有/ 如下/ 优点/ :/ 由/ TPM/ 作为/ 系统/ 的/ 可信/ 根/ ,/ 对/ 可/ 执行/ 代码/ 进行/ 完整性/ 校验/ ,/ 同时/ 为/ 备份/ 存储器/ 提供/ 受/ 保护/ 的/ 安全/ 存储/ 环境/ ./ TPM/ 拥有/ 可信/ PDA/ 总线/ 控制权/ ,/ 在/ 进行/ 完整性/ 校验/ 和/ 系统/ 恢复/ 的/ 过程/ 中/ 不会/ 受到/ 外部/ 干扰/ ./ 图/ 7/ 为/ 基于/ TPM/ 控制/ 的/ 备份/ 恢复/ 体系结构/ ./ 经过/ 原型/ 系统/ 的/ 实际/ 测试/ ,/ 完成/ 一次/ 备份/ 恢复/ 的/ 时间/ 少于/ 1s/ (/ 恢复/ 内容/ 小于/ 32MB/ )/ ,/ 可以/ 满足/ 实际/ 使用/ 的/ 要求/ ./ 从而/ 大大提高/ 了/ 可信/ PDA/ 的/ 可靠性/ 和/ 可用性/ ./ 3.4/ 新型/ 的/ TPM/ 结构/ 可信/ PDA/ 是/ 自主/ 研发/ 的/ 可信/ 产品/ ,/ 目前/ 国内/ 尚无/ 适合/ 星型/ 信任/ 结构/ 的/ TPM/ 成品/ ./ 由/ 前文/ 所述/ ,/ 可信/ PDA/ 的/ TPM/ 包含/ 的/ 功能/ 比/ 常规/ 的/ TPM/ 芯片/ 多/ ,/ 因此/ ,/ 在/ 图/ 1/ 中/ ,/ 以/ JetWay2810/ 安全/ 芯片/ 和/ FPGA/ 设备/ 构成/ 了/ 一种/ 新/ 的/ TPM/ 模块/ 结构/ ./ 3.4/ ./ 1JetWay2810/ 芯片/ JetWay2810/ 的/ 安全/ 芯片/ 是/ 一款/ 通过/ 国家/ 认证/ 的/ 可信计算/ 平台/ 模块/ 芯片/ ./ 它/ 是/ 与/ AMD186/ 兼容/ 的/ 16/ 位/ 微控制器/ 芯片/ ,/ 采用/ 经/ SOSCA/ (/ SecureOpenSmartCardArchitecture/ )/ 指令集/ 增强/ 的/ X86/ 处理器/ 内核/ ,/ 集成/ 大容量/ 存储器/ ,/ 多/ 体制/ 密码/ 引擎/ ,/ USB/ ,/ ISO7816/ // 4/ 等/ 多种/ 外围/ 控制器/ ./ 该/ 芯片/ 具有/ 基本/ 的/ 密码/ 计算/ 和/ PCR/ 数据/ 存储/ 功能/ ,/ 经过/ 添加/ COS/ ,/ JetWay2810/ 可以/ 完成/ TCG/ 规定/ 的/ TPM/ 的/ 基本功能/ ,/ 并/ 提供/ TSS/ 的/ 底层/ 接口/ ./ 3.4/ ./ 2TPM/ 与/ TCMTPM/ 是/ 可信计算/ 平台/ 的/ 一个/ 重要/ 的/ 组成/ 部件/ ,/ 根据/ TCG/ 的/ 定义/ ,/ TPM/ 必须/ 由/ 硬件/ 来/ 实现/ ,/ 但是/ TCG/ 仅仅/ 在/ 理论/ 上/ 定义出/ 了/ TPM/ 应该/ 完成/ 的/ 功能/ ,/ 对/ 其/ 如何/ 实现/ ,/ 性能指标/ 要求/ ,/ 并/ 没有/ 统一/ 的/ 实现/ 规定/ ,/ 作为/ 一个/ 标准/ 的/ TPM/ ,/ 应/ 包含/ 执行/ 引擎/ 、/ 存储器/ 、/ I/ // O/ 、/ RSA/ 密码/ 引擎/ 、/ 随机数/ 产生器/ 等/ 部件/ ,/ 以/ 完成/ 加密/ 、/ 签名/ 、/ 认证/ 、/ 密钥/ 产生/ 等/ 安全/ 功能/ ./ 但是/ ,/ TCG/ 的/ TPM/ 定义/ 中/ 并/ 不/ 包含/ 对称/ 密码/ 算法/ 引擎/ ./ 一般/ TCG/ 建议/ 利用/ 其他/ 的/ 方式/ 实现/ ,/ 这/ 就/ 带来/ 一定/ 的/ 安全/ 和/ 性能/ 隐患/ ./ 我国/ 的/ TCM/ (/ TrustedCryptographyModule/ ,/ 可信/ 密码/ 模块/ )/ 标准/ [/ 16/ ]/ ,/ 是/ 由/ 国家/ 密码/ 管理局/ 主持/ 国内/ 一些/ IT/ 企业/ 推出/ 的/ ./ TCM/ 与/ TPM/ 最大/ 的/ 不同/ 在于/ ,/ 其/ 内部/ 的/ 核心/ 密码/ 算法/ 为/ 我国/ 自主/ 知识产权/ 的/ 算法/ 标准/ ,/ 特别/ 是/ 集成/ 了/ 我国/ 的/ 对称/ 密码/ 算法/ (/ SMS4/ )/ ./ 这样/ ,/ TCM/ 就/ 避免/ 了/ TPM/ 中/ 没有/ 对称/ 密码/ 算法/ 的/ 缺陷/ ./ 3.4/ ./ 3ETPM/ (/ EmbeddedSystemTPM/ )/ 可信/ PDA/ 由于/ 使用/ 了/ 前文/ 描述/ 的/ 星型/ 信任/ 结构/ ,/ 因此/ ETPM/ 的/ 体系结构/ 与/ TPM/ 和/ TCM/ 不同/ ,/ 其/ 基本/ 结构/ 如图/ 8/ 所示/ :/ 公钥/ 算法/ 采用/ 了/ RSA/ 的/ 2048/ 位/ (/ 也/ 可/ 使用/ ECC/ )/ ,/ 对称/ 密码/ 算法/ 采用/ 了/ SMS4/ ,/ 另外/ 还有/ 完成/ 正常/ 启动/ 顺序/ 的/ 总线/ 仲裁/ 、/ 备份/ 恢复/ 模块/ ./ 上述/ 几种/ 模块/ ,/ JetWay2810/ 没有/ 提供/ ,/ 故而/ 采用/ FPGA/ 硬件/ 实现/ ./ ETPM/ 构成/ 了/ 可信/ PDA/ 的/ 核心/ 根/ 模块/ ,/ 可以/ 很/ 好/ 地/ 实现/ 星型/ 信任/ 结构/ Page7/ 所/ 描述/ 的/ 功能/ ,/ 如图/ 1/ 和/ 图/ 5/ 所示/ ,/ 形成/ 了/ 一种/ 支持/ 嵌入式/ 系统/ 的/ 可信计算/ 体系结构/ 模块/ ./ 4/ 存储介质/ 和/ 操作系统/ 安全/ 对于/ 用户/ 而言/ ,/ 可信/ PDA/ 最/ 重要/ 的/ 功能/ 之一/ 就是/ 要/ 保证数据/ 信息/ 的/ 安全/ ,/ 需要/ 达到/ 如下/ 的/ 安全/ 效果/ :/ (/ 1/ )/ 实现/ 可信/ PDA/ 的/ 存储介质/ NandFlash/ 上/ 重要/ 数据/ 区域/ 的/ 写/ 操作/ 保护/ ,/ 提供/ 开机/ 启动/ 时/ 的/ 完整性/ 校验/ 支持/ ./ (/ 2/ )/ 保证/ 移动/ 设备/ 数据/ 存储/ 的/ 机密性/ ,/ 解决/ 未经/ 授权/ 的/ 访问/ 和/ 因/ 便携式/ 设备/ 的/ 失窃/ 引发/ 的/ 泄密/ 等/ 问题/ ./ (/ 3/ )/ 细化/ 文件/ 的/ 访问/ 粒度/ ,/ 限制/ 超级/ 用户/ 的/ 权限/ ./ 即使/ 是/ 授权/ 用户/ 在/ 访问/ 资源/ 时/ ,/ 行为/ 必须/ 符合/ 安全策略/ ,/ 操作/ 才能/ 执行/ ,/ 否则/ 将/ 拒绝/ ./ 防止/ 超级/ 用户/ 滥用/ 权限/ ./ (/ 4/ )/ 系统/ 的/ 安全/ 增强/ 模块/ 有/ 可以信赖/ 的/ 可信计算/ 基/ ./ 可信/ PDA/ 应/ 实现/ 对/ 用户/ 透明/ 的/ 安全/ 存储保护/ 模式/ ,/ 授权/ 用户/ 可以/ 像/ 使用/ 普通/ 文件系统/ 一样/ 完成/ 安全/ 功能/ 操作/ ./ 由于/ 嵌入式操作系统/ 资源/ 有限/ ,/ 安全/ 增强/ 模块/ 在/ 内核/ 层/ 实现/ ,/ 加密/ 模块/ 利用/ Linux/ 缓冲/ 机制/ 并/ 调用/ 硬件/ 密码/ 模块/ 进行/ 加密/ ,/ 并/ 在/ 访问控制/ 机制/ 中/ 添加/ 策略/ 缓存/ ,/ 提高/ 了/ 系统/ 性能/ (/ 见/ 本文/ 第/ 3/ 页/ 注释/ ④/ )/ 4.1/ 存储介质/ 的/ 安全/ 可信/ PDA/ 使用/ SD/ 卡/ 作为/ 外部/ 的/ 数据/ 存储器/ ,/ 用户/ 的/ 私密/ 信息/ 经常/ 存储/ 于此/ ./ 因此/ ,/ SD/ 卡内/ 的/ 数据保护/ 就/ 显得/ 尤为重要/ ./ SD/ 卡/ 使用/ TPM/ 中/ 的/ 硬件/ 加密/ 芯片/ 实现/ 加解密/ 操作/ ,/ 在/ 系统/ 的/ 性能/ 和/ 物理/ 安全/ 上/ 都/ 有/ 极大/ 的/ 提高/ ,/ 其/ 密钥/ 存入/ TPM/ 中/ ,/ 由/ TPM/ 提供/ 保护/ ./ SD/ 卡/ 加密/ 文件系统/ 主要/ 分为/ 加密/ 引擎/ 和/ 密钥/ 管理/ 两个/ 主要/ 部分/ [/ 17/ ]/ ./ 加密/ 引擎/ 是/ 在/ 内核/ 合适/ 的/ 加解密/ 位置/ 调用/ 硬件/ 加密/ 芯片/ 利用/ SMS4/ 完成/ 加解密/ 操作/ ;/ 密钥/ 管理/ 是/ 使用/ TSS/ 密钥/ 安全/ 存储/ 接口/ 访问/ TPM/ 芯片/ 中/ 存储/ 的/ 密钥/ ,/ 从而/ 利用/ 其/ 加密/ 以及/ 平台/ 绑定/ 功能/ 来/ 保证/ 密钥/ 的/ 可信/ 和/ 安全性/ ./ 其/ 体系结构/ 如图/ 9/ 所示/ ./ 由于/ 是/ 在/ 页/ 高速缓存/ 层/ 和/ 通用/ 块/ 层/ 之间/ 添加/ 了/ 数据/ 加解密/ 功能/ [/ 17/ ]/ ,/ 因此/ 对于/ 上层/ 用户/ 是/ 透明/ 的/ ,/ 使/ 用户/ 感觉/ 不到/ 文件/ 的/ 加密/ 过程/ ,/ 不/ 修改/ 文件系统/ 的/ 数据结构/ 且/ 用户/ 访问/ 加密/ 文件/ 的/ 过程/ 也/ 不变/ ./ SD/ 卡/ 一旦/ 丢失/ ,/ 非/ 合法/ 用户/ 也/ 无法/ 获得/ 其/ 内容/ ,/ 因/ 加密/ 层/ 在/ 文件系统/ 层/ 之下/ ,/ 非法/ 用户/ 甚至/ 连/ 文件/ 结构/ 都/ 不能/ 读取/ ./ 4.2/ 数据/ 隔离/ 保护/ 嵌入式/ 系统/ 中/ ,/ BootLoader/ 、/ kernel/ 和/ 根/ 文件系统/ 是/ 保障/ 系统安全/ 的/ 重要/ 区域/ ,/ 要求/ 用户/ 进程/ 不能/ 随便/ 改动/ ,/ 否则/ 将/ 导致系统/ 出错/ 甚至/ 无法/ 使用/ ./ 但/ 用户/ 存储/ 区内/ 的/ 数据/ 应/ 可/ 由/ 用户/ 任意/ 添加/ 、/ 删除/ 和/ 修改/ ./ 因此/ 有/ 必要/ 对/ 嵌入式/ 的/ 存储空间/ 进行/ 划分/ ,/ 以/ 用户/ 是否/ 可以/ 自由/ 修改/ 为/ 依据/ ,/ 可以/ 将/ 存储空间/ 划分/ 为/ 用户/ 数据/ 区/ 和/ 系统/ 数据/ 区/ ./ 在/ 操作系统/ 启动/ 之前/ ,/ TPM/ 会/ 自动/ 校验/ 系统/ 数据/ 区/ ,/ 校验/ 通过/ 后/ TPM/ 才/ 把/ 控制权/ 交给/ CPU/ ,/ 系统/ 运行/ ./ 至此/ 这些/ 区域/ 一直/ 由/ TPM/ 来/ 保护/ ./ 按照/ 目前/ 可信/ PC/ 的/ 运行/ 模式/ ,/ 在/ 操作系统/ 开始运行/ 之后/ ,/ TPM/ 不会/ 再/ 对/ 这些/ 区域/ 进行/ 保护/ ,/ 恶意/ 进程/ 和/ 用户/ 的/ 误操作/ 可能/ 会/ 改写/ 这些/ 区域/ 的/ 数据/ ,/ 因此/ 需要/ 保护/ 这些/ 重要/ 区域/ ,/ 防止/ 被/ 改写/ ./ 可信/ PDA/ 中/ 存储/ 隔离/ 保护/ 设计/ 的/ 核心思想/ 是/ 在/ 存储介质/ NandFlash/ 上/ 划分/ 出/ 一个/ 重要/ 分区/ 来/ Page8/ 进行/ 写/ 操作/ 保护/ [/ 18/ ]/ ./ 因为/ 文件系统/ 是/ 建立/ 在/ Nand/ -/ Flash/ 上/ ,/ 在/ 读写/ 请求/ 被/ 提交/ 给/ NandFlash/ 驱动/ 时/ ,/ NandFlash/ 驱动/ 要/ 检查/ 写/ 操作/ ,/ 如果/ 写/ 的/ 位置/ 是/ 这些/ 重要/ 区域/ ,/ 那么/ NandFlash/ 驱动/ 就/ 阻止/ 这次/ 写/ 操作/ ,/ 并/ 直接/ 返回/ 错误/ 值/ 给/ 进程/ ,/ 以/ 防止/ 这些/ 区域/ 被/ 篡改/ ./ NandFlash/ 之下/ 是/ MTD/ 块/ 设备/ ,/ 所以/ 确定/ 在/ 存储技术/ 设备/ 驱动/ 中/ 进行/ 修改/ ,/ 对于/ NandFlash/ 在/ 执行/ 写/ 操作前/ ,/ 检查/ 要/ 写/ 的/ 地址/ 是不是/ 在/ 指定/ 的/ 地址/ ,/ 如果/ 是/ ,/ 则/ 直接/ 返回/ 错误/ ,/ 否则/ 发起/ 写/ 操作/ ,/ 从而/ 来/ 提供/ 完整性/ 保护/ ./ 可信/ PDA/ 的/ MTD/ 设备/ 层次结构/ 如图/ 10/ 所示/ ,/ Flash/ 硬件/ 驱动/ 层/ 负责/ 在/ 初始化/ 时/ 驱动/ Flash/ 硬件/ ;/ MTD/ 原始/ 设备/ 层/ 一部分/ 是/ MTD/ 原始/ 设备/ 的/ 通用/ 代码/ [/ 17/ ]/ ,/ 另/ 一部分/ 是/ 各个/ 特定/ 的/ Flash/ 的/ 数据/ 例如/ 分区/ ,/ 定义/ 了/ 大量/ 的/ 关于/ MTD/ 的/ 数据/ 和/ 操作/ 函数/ ;/ MTD/ 设备/ 层/ 是/ 基于/ MTD/ 原始/ 设备/ ,/ 定义出/ MTD/ 的/ 设备/ 号/ 以及/ 注册/ 设备/ 操作/ ;/ 设备/ 节点/ 层/ 负责/ 建立/ MTD/ 字符/ 设备/ 节点/ (/ 主/ 设备/ 号/ 为/ 90/ )/ 和/ MTD/ 块/ 设备/ 节点/ (/ 主/ 设备/ 号/ 为/ 31/ )/ ,/ 通过/ 访问/ 此/ 设备/ 节点/ 即可/ 访问/ MTD/ 字符/ 设备/ 和/ 块/ 设备/ ./ 4.3/ 操作系统/ 内核/ 安全/ 增强/ 可信/ PDA/ 在/ 操作系统/ 内核/ 中/ 加入/ 钩子/ 函数/ [/ 19/ -/ 20/ ]/ ,/ 对/ 标准/ 内核/ 进行/ 了/ 以/ 安全/ 增强/ 为/ 目的/ 的/ 修改/ ,/ 并/ 以/ 配置文件/ 的/ 方式/ 实现/ 策略/ 逻辑/ ./ 当/ 需要/ 进行/ 访问/ 内核/ 时/ ,/ 首先/ 检查/ 是否/ 符合/ 既定/ 的/ 安全策略/ ,/ 如果/ 符合/ 则/ 通过/ 本次/ 访问/ ,/ 否则/ 拒绝/ ./ 在/ Linux/ 内核/ 中/ ,/ 钩子/ 函数/ 被/ 放置/ 于/ namei/ ./ c/ 、/ open/ ./ c/ 和/ readdir/ ./ c/ 的/ 相关/ 函数/ 中/ ./ 打开/ 文件/ 时/ ,/ 钩子/ 函数/ 就/ 先/ 查找/ 策略/ 配置文件/ 中/ 的/ 相关/ 策略/ [/ 21/ ]/ ,/ 如果/ 符合/ 策略/ ,/ 则/ 通过/ read/ _/ write/ ./ c/ 文件/ 中/ 的/ 相关/ 函数/ 执行/ 读写操作/ ,/ 如果/ 不/ 符合/ ,/ 则/ 直接/ 返回/ 错误/ ./ 图/ 11/ 所示/ 为/ 钩子/ 函数/ 的/ 调用/ 过程/ ./ 策略/ 文件/ 中/ 保存/ 了/ 主体/ (/ 可执行文件/ )/ 、/ 客体/ (/ 数据文件/ )/ 、/ 节点/ 号/ 、/ 访问/ 权限/ 信息/ ,/ 用以/ 指明/ 哪个/ 主体/ 可以/ 哪/ 种/ 方式/ 访问/ 哪个/ 客体/ [/ 22/ ]/ ./ 该/ 强制/ 访问控制/ 实现/ 简单/ [/ 23/ ]/ ,/ 策略/ 易于/ 定制/ ,/ 提供/ 策略管理/ 工具/ ,/ 适于/ 可信/ PDA/ 的/ 应用/ ./ 我们/ 测试/ 了/ 设置/ 为/ 只读/ 的/ 文件/ 如何/ 实现/ 访问控制/ (/ 图/ 12/ )/ ./ 利用/ 命令/ 重写/ 和/ 追加/ test/ _/ readonly/ 文件/ 时/ ,/ 终端/ 均/ 显示/ 为/ 操作/ 被/ 禁止/ ./ 使用/ cat/ 显示/ 未经/ 修改/ 的/ 文件/ 内容/ ,/ 表明/ 只读/ 文件/ 不/ 可以/ 被/ 修改/ 和/ 追加/ ./ 4.4/ 日志/ 系统/ 普通/ 的/ 嵌入式/ Linux/ 并/ 不/ 带有/ 日志/ 功能/ [/ 24/ ]/ ,/ 为了/ 让/ 用户/ 了解/ 可信/ PDA/ 的/ 运行/ 状态/ ,/ 进一步/ 增强/ 可信/ PDA/ 的/ 安全性/ [/ 16/ ]/ ,/ 并/ 为/ 日后/ 的/ 审计工作/ 提供/ 依据/ ,/ 我们/ 为/ 可信/ PDA/ 增加/ 了/ 日志/ 功能/ ./ 可信/ PDA/ 在/ 嵌入式/ Linux/ 内核/ 源码/ 中/ 编译/ 加入/ 了/ syslog/ 模块/ ,/ 能够/ 有效/ 节省/ 空间/ ./ 同时/ ,/ syslog/ 带有/ 日志/ 轮转/ 功能/ ,/ 能够/ 通过/ 对/ syslog/ 加/ 命令行/ 参数/ 来/ 打开/ 日志/ 轮转/ 的/ 功能/ ,/ 不/ 需要/ 另外/ 增加/ logro/ -/ tate/ 程序/ ,/ 以/ 提高/ 日志/ 记录/ 效率/ ./ 经过/ 综合/ 考虑/ 与/ 原型/ 系统/ 的/ 实验/ ,/ 由于/ 可信/ PDA/ 目前/ 所/ 要/ 记录/ 的/ 日志/ 量/ 不大/ ,/ 种类/ 也/ 不/ 多/ ,/ 为/ 实现/ 简单/ 起/ 见/ ,/ 采用/ 交叉/ 编译/ 的/ 方法/ ,/ 将/ syslog/ 编译/ 到/ busybox/ 中/ 即可/ ,/ 不/ 需要/ 另外/ 添加/ logrotate/ 工具/ ./ 可信/ PDA/ 上/ 的/ 日志/ 系统/ 主要/ 记录/ 以下/ 事件/ :/ (/ 1/ )/ 内核/ 的/ 输出/ 信息/ ;/ Page9/ (/ 2/ )/ 应用程序/ 的/ 日志/ ;/ (/ 3/ )/ 系统/ 出错/ 信息/ ./ 通过/ 对/ 日志/ 的/ 分析/ ,/ 用户/ 能够/ 了解/ 可信/ PDA/ 的/ 运行状况/ ,/ 及时发现/ 安全隐患/ ,/ 防范/ 于未然/ ,/ 并/ 为/ 日后/ 的/ 审计工作/ 提供/ 依据/ ./ 5/ 可信/ 的/ 网络连接/ 在/ 基于/ 远端/ 证明/ 的/ 可信/ PDA/ 无线网络/ 接入/ 控图/ 13/ 远程/ 证明/ 的/ 系统结构/ 在/ 该/ 系统/ 中/ ,/ 终端/ (/ 即/ 上/ 图/ 可信/ PC/ )/ 与/ 可信/ PDA/ 进行/ 远程/ 证明/ ,/ 完整性/ 参考/ 服务器/ 具有/ 双方/ 平台/ 的/ 标准/ 完整性/ 参考值/ ./ 可信/ PDA/ 通过/ 无线网络/ 与/ 终端/ 及/ 完整性/ 参考/ 服务器/ 相连接/ ,/ 终端/ 及/ PDA/ 都/ 有/ TPM/ 作/ 支持/ ./ 可信/ PC/ 上/ 完成/ 远程/ 证明/ 的/ 功能/ 组件/ 主要/ 包括/ 自行/ 开发/ 的/ TSS/ (/ 见/ TNCIF/ -/ TNCCS/ )/ ,/ RemoteAttestationService/ 和/ IMC/ (/ IntegrityMeas/ -/ urementCollector/ )/ ,/ 负责/ 读取/ 平台/ 的/ PCR/ 及/ Even/ -/ tLog/ 等/ 信息/ 并/ 报告/ 给/ PDA/ ./ 可信/ PDA/ 上/ 的/ 功能/ 组件/ 主要/ 包括/ TSS/ ,/ RemoteAttestationService/ 和/ IMV/ (/ IntegrityMeasurementVerifier/ )/ ,/ 负责/ 验证/ 要求/ 接入/ 的/ 平台/ 是否/ 可信/ (/ 见/ TNCIF/ -/ PEP/ )/ ./ 证明/ 过程/ 如下/ :/ (/ 1/ )/ 终端/ 正常/ 工作/ ,/ 通过/ 有/ 线或/ 无线网络/ 连入/ 局域网/ ;/ 完整性/ 参考/ 服务器/ 正常/ 工作/ ,/ 通过/ 有线/ 网络/ 连入/ 局域网/ ;/ 可信/ PDA/ 正常/ 工作/ ,/ 通过/ 无线网络/ 连入/ 局域网/ ./ (/ 2/ )/ 可信/ PDA/ 从/ 终端/ 获取/ 其/ TPM/ 中/ 的/ PCR/ 值/ 和/ EventLog/ ./ 制/ 方案/ 中/ ,/ PDA/ 与/ 终端/ 建立/ 连接/ 之前/ ,/ 首先/ 对/ 终端/ 的/ 身份/ 进行/ 认证/ ,/ 保证/ 只有/ 特定/ 的/ 终端/ 才/ 可以/ 与/ PDA/ 进行/ 连接/ ;/ 在/ 身份/ 认证/ 通过/ 之后/ ,/ 对/ 终端/ 的/ 平台/ 状态/ 进行/ 验证/ ;/ 若/ 符合要求/ ,/ 则/ 允许/ 终端/ 与其/ 建立/ 连接/ ,/ 这样/ 可以/ 避免/ 由于/ 终端/ 自身/ 的/ 安全/ 问题/ 而/ 导致/ 可信/ PDA/ 上/ 的/ 数据/ 遭到/ 破坏/ ./ 在/ 实现/ 系统/ 中/ ,/ 主要/ 有/ 3/ 个/ 实体/ :/ 可信/ PDA/ 、/ 接入/ 终端/ 和/ 完整性/ 参考/ 服务器/ ./ 系统/ 架构/ 如图/ 13/ 所示/ ./ (/ 3/ )/ 可信/ PDA/ 通过/ EventLog/ 计算/ PCR/ ,/ 并/ 与/ 获取/ 的/ PCR/ 比较/ ,/ 匹配/ 则/ 继续/ ,/ 否则/ 判断/ 终端/ 不可/ 信/ ,/ 程序/ 结束/ ./ (/ 4/ )/ 可信/ PDA/ 从/ 完整性/ 参考/ 服务器/ 获取/ 标准/ EventLog/ 值/ ,/ 并/ 参照/ 它/ 验证/ 从/ 终端/ 获取/ 的/ Even/ -/ tLog/ ,/ 从而/ 判断/ 终端/ 的/ 安全/ 状态/ ./ (/ 5/ )/ 若/ 匹配/ 则/ 说明/ 远程/ 证明/ 成功/ ,/ 终端/ 可信/ ,/ 否则/ 终端/ 不可/ 信/ ./ 通过/ 以上/ 过程/ ,/ 可以/ 利用/ 可信/ PDA/ 对/ 接入/ 网络/ 的/ 终端/ 进行/ 可信/ 验证/ ,/ 从而/ 实现/ 可信/ 网络连接/ ,/ 在/ 此基础/ 上/ ,/ 可以/ 完成/ 可信/ 数据传输/ ,/ 可信/ 资源共享/ ,/ 进一步/ 向/ 可信/ 网络/ 的/ 应用/ 发展/ ./ 6/ 结论/ 本文/ 提出/ 了/ 一种/ 带/ 数据恢复/ 功能/ 的/ 星型/ 信任/ 结构/ ,/ 其/ 在/ 安全性/ 、/ 效率/ 及/ 可靠性/ 等/ 方面/ 较/ TCG/ 的/ 链式/ 信任/ 结构/ 都/ 有/ 很大/ 提升/ ./ 在/ 此基础/ 上/ ,/ 进一步/ 使用/ 总线/ 仲裁/ 等/ 技术/ 构造/ 了/ 可信/ PDA/ 的/ 体系结构/ 模/ Page10/ 型/ ./ 文中/ 还/ 提出/ 并/ 实现/ 了/ 针对/ 可信/ PDA/ 嵌入式操作系统/ 的/ 安全/ 增强/ 、/ 基于/ 可信/ PDA/ 平台/ 的/ 可信/ 网络连接/ (/ TNC/ )/ 以及/ SD/ 卡/ 全盘/ 加密/ 等/ 新/ 的/ 安全/ 技术/ 与/ 方法/ ./ 这些/ 理论/ 和/ 方法/ 是/ 对/ 可信计算/ 技术/ 的/ 有益/ 发展/ ,/ 对/ PDA/ 等/ 嵌入式/ 平台/ 实现/ 可信计算/ 技术/ 具有/ 一定/ 的/ 应用/ 价值/ ,/ 而且/ 对/ 解决目前/ 可信/ PC/ 的/ 一些/ 问题/ 也/ 提供/ 了/ 较/ 好/ 的/ 思路/ ./ 可信/ PDA/ 的/ 研究/ 工作/ 是/ 在/ 国家/ “/ 八/ 六三/ ”/ 项目/ 支持/ 下/ 进行/ 的/ ,/ 通过/ 理论/ 研究/ 和/ 技术/ 实践/ ,/ 研制/ 出/ 我国/ 第一款/ 具有/ 自主/ 知识产权/ 的/ 可信/ PDA/ 原型/ 系统/ ,/ 如图/ 14/ 所示/ ./ 经过/ 实验/ 验证/ ,/ 这/ 款/ 可信/ PDA/ 在/ 各/ 方面/ 都/ 达到/ 了/ 可信计算/ 平台/ 的/ 技术/ 要求/ ,/ 实现/ 了/ 构建/ 可信/ 嵌入式/ 系统/ 的/ 目标/ ./ 

