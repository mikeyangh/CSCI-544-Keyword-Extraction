Page1/ 针对/ RSA/ 算法/ 的/ 踪迹/ 驱动/ 数据/ Cache/ 计时/ 攻击/ 研究/ 陈财森/ 1/ )/ ,/ 2/ )/ 王韬/ 2/ )/ 郭/ 世泽/ 3/ )/ 周平/ 2/ )/ 1/ )/ (/ 装甲兵/ 工程学院/ 科研部/ 北京/ 100072/ )/ 2/ )/ (/ 军械/ 工程学院/ 信息工程/ 系/ 石家庄/ 050003/ )/ 3/ )/ (/ 北方/ 电子设备/ 研究所/ 北京/ 100083/ )/ 摘要/ Cache/ 计时/ 攻击/ 是/ 旁路/ 攻击/ 领域/ 的/ 研究/ 热点/ ./ 针对/ 滑动/ 窗口/ 算法/ 实现/ 模幂/ 运算/ 的/ RSA/ 算法/ ,/ 分析/ 了/ RSA/ 算法/ 访问/ 驱动/ Cache/ 计时/ 攻击/ 的/ 难点/ ,/ 建立/ 了/ 踪迹/ 驱动/ 数据/ Cache/ 计时/ 攻击/ 模型/ ./ 在/ 攻击/ 模型/ 与/ 原有/ 踪迹/ 驱动/ 计时/ 攻击/ 算法/ 的/ 基础/ 上/ ,/ 利用/ 幂指数/ 与/ 操作/ 序列/ 的/ 相关性/ 、/ 窗口/ 大小/ 特征/ 和/ 预计/ 算表/ 索引/ 值/ 与/ 窗口/ 值/ 的/ 映射/ 关系/ ,/ 提出/ 了/ 一种/ 改进/ 的/ 幂指数/ 分析/ 算法/ ,/ 并/ 给出/ 了/ 利用/ 幂指数/ dp/ 和/ dq/ 的/ 部分/ 离散/ 位/ 恢复/ 出/ 私钥/ d/ 的/ 格/ 攻击/ 过程/ ./ 利用/ 处理器/ 的/ 同步/ 多线程/ 能力/ 实现/ 了/ 间谍/ 进程/ 与/ 密码/ 进程/ 的/ 同步/ 执行/ ,/ 针对/ OpenSSLv0/ ./ 9.8/ b/ 中/ 的/ RSA/ 算法/ ,/ 在/ 真实/ 环境/ 下/ 执行/ 攻击/ 实验/ ./ 实验/ 结果表明/ :/ 新/ 的/ 分析/ 算法/ 大约/ 能够/ 获取/ 512/ 位/ 幂指数/ 中/ 的/ 340/ 位/ ,/ 比/ 原有/ 算法/ 进一步/ 降低/ 了/ 密钥/ 恢复/ 的/ 复杂度/ ;/ 同时/ 对/ 实际/ 攻击/ 中/ 的/ 关键技术/ 以及/ 可能/ 遇到/ 的/ 困难/ 进行/ 分析/ ,/ 给出/ 相应/ 的/ 解决方案/ ,/ 进一步提高/ 了/ 攻击/ 的/ 可行性/ ./ 关键词/ RSA/ 密码/ 算法/ ;/ 旁路/ 攻击/ ;/ 数据/ Cache/ 计时/ 攻击/ ;/ 踪迹/ 驱动/ ;/ 滑动/ 窗口/ 算法/ ;/ 网络安全/ ;/ 信息安全/ 1/ 引言/ RSA/ 算法/ 是/ 目前/ 最为/ 广泛/ 使用/ 的/ 公钥/ 密码/ 算法/ 之一/ ,/ 其/ 安全性/ 是/ 依赖于/ 大/ 整数/ 因式分解/ 的/ 困难性/ ,/ 一定/ 长度/ 的/ 密钥/ 从/ 数学分析/ 的/ 角度/ 上/ 能够/ 保证/ 私钥/ 的/ 安全性/ ./ 然而/ 随着/ 旁路/ 分析/ 的/ 发展/ ,/ 研究/ 结果表明/ ,/ 由于/ 采用/ 窗口/ 算法/ 实现/ 的/ RSA/ 算法/ 存在/ 查找/ 预计/ 算表/ 的/ 操作/ ,/ 导致/ 其/ 遭受/ 数据/ Cache/ 攻击/ 的/ 威胁/ ./ 自从/ Kocher/ [/ 1/ ]/ 和/ Kelsey/ 等/ 人/ [/ 2/ ]/ 提出/ 将/ 高速缓冲存储器/ Cache/ 的/ 行为/ 信息/ 作为/ 旁路/ 泄露/ 信息/ 的/ 思想/ 以来/ ,/ 不少/ 密码/ 分析/ 学家/ 针对/ 各种/ 密码/ 算法/ 的/ Cache/ 攻击/ 展开/ 研究/ ./ 2002/ 年/ ,/ Page/ [/ 3/ ]/ 提出/ 了/ 一种/ 针对/ DES/ 的/ Cache/ 攻击/ 方法/ ,/ 利用/ 访问/ Cache/ 时/ 命中/ 与/ 失效/ 的/ 时间/ 差异/ 信息/ 与/ S/ 盒/ 查找/ 表/ 的/ 索引/ 值/ 以及/ 子/ 密钥/ 的/ 相关性/ ,/ 缩小/ 密钥/ 的/ 搜索/ 空间/ ,/ 将/ DES/ 密钥/ 搜索/ 空间/ 由/ 56/ 位/ 降低/ 到/ 32/ 位/ ;/ 2004/ 年/ ,/ Bernstein/ ①/ 提出/ 并/ 实现/ 了/ 一种/ 针对/ OpenSSL/ 中/ AES/ 算法/ 的/ 时序/ 驱动/ Cache/ 计时/ 攻击/ 方案/ ./ 由于/ 分组/ 密码/ 算法/ 实现/ 过程/ 中/ 大部分/ 存在/ 查找/ S/ 盒/ 的/ 操作/ ,/ 导致/ 很/ 容易/ 遭受/ Cache/ 攻击/ ,/ 因此/ 起初/ 的/ 研究/ 大都/ 针对/ 分组/ 密码/ 展开/ ,/ 而/ 针对/ 公钥/ 密码/ 算法/ 的/ Cache/ 攻击/ 研究/ 相对/ 较晚/ ./ 2005/ 年/ ,/ Percival/ [/ 4/ ]/ 首次/ 提出/ 了/ 利用/ 多线程/ 间/ 共享/ Cache/ 资源/ 的/ 特点/ ,/ 使/ 间谍/ 进程/ 能够/ 与/ 密码/ 进程同步/ 执行/ ,/ 并/ 监视/ 密码/ 进程/ 实现/ 过程/ 中/ 访问/ Cache/ 的/ 状态/ 信息/ ,/ 设计/ 并/ 实现/ 了/ 一种/ 针对/ 采用/ 滑动/ 窗口/ 算法/ 实现/ 的/ RSA/ 算法/ Cache/ 计时/ 攻击/ 方案/ ./ 2007/ 年/ ,/ Aciicmez/ 等/ 人/ [/ 5/ ]/ 提出/ 了/ 一种/ 新/ 的/ 旁路/ 攻击/ 概念/ ./ 微/ 架构/ 攻击/ (/ Micro/ -/ architecturalAttack/ ,/ MA/ )/ ,/ 将/ 攻击/ 的/ 微处理器/ 部件/ 单元/ 由/ 数据/ Cache/ 扩展/ 到/ 包括/ 指令/ Cache/ 和/ 分支/ 预测/ 单元/ 等/ 微/ 架构/ 元器件/ ,/ 主要/ 提出/ 了/ 基于/ 指令/ Cache/ [/ 6/ ]/ 和/ BPU/ [/ 7/ ]/ 的/ 攻击/ 模型/ 与/ 算法/ ,/ 但/ 只/ 停留/ 在/ 理论/ 验证/ 和/ 仿真/ 实验/ 阶段/ ,/ 而且/ 实验/ 细节/ 及/ 实验/ 结果/ 很少/ 公开/ ./ 国内/ 在/ 密码/ Cache/ 计时/ 攻击/ 方面/ 的/ 研究/ 起步/ 较晚/ ,/ 而且/ 大都/ 是/ 针对/ 分组/ 密码/ 算法/ ,/ 针对/ 公钥/ 密码/ 算法/ 的/ Cache/ 攻击/ 研究/ 较/ 少/ ,/ 仅仅/ 停留/ 在/ 攻击/ 机理/ 研究/ 阶段/ ./ 目前/ 针对/ 密码/ 算法/ 的/ Cache/ 攻击/ 按照/ 采集/ 的/ 时间/ 类型/ 不同/ 可/ 分为/ 时序/ 驱动/ 攻击/ ①/ 、/ 访问/ 驱动/ 攻击/ [/ 8/ ]/ 和/ 踪迹/ 驱动/ 攻击/ [/ 9/ ]/ ./ 时序/ 驱动/ 攻击/ 采集/ 的/ 是/ 密码/ 进程/ 整个/ 加解密/ 时间/ ,/ 执行/ 操作/ 简单/ ,/ 但/ 所/ 需/ 样本量/ 非常/ 大/ ,/ 且易/ 受/ 外界/ 因素/ 的/ 干扰/ ;/ 访问/ 驱动/ 攻击/ 利用/ 间谍/ 进程/ 采集/ 密码/ 进程/ 加解密/ 过程/ 中/ 访问/ Cache/ 的/ 特征/ 信息/ ,/ 利用/ 密码/ 进程/ 查找/ 表/ 操作/ 导致/ 间谍/ 进程/ 二次/ 访问/ 时/ 命中/ 和/ 失效/ 的/ 时间/ 差异/ 以及/ 查找/ 表/ 索引/ 值/ 与/ 密钥/ 信息/ 的/ 相关性/ 进行/ 密码/ 分析/ ,/ 主要/ 适用/ 于/ 基于/ S/ 盒/ 查找/ 的/ 分组/ 密码/ 算法/ ,/ 对于/ 不/ 存在/ 查找/ 表/ 操作/ 或/ 查找/ 表/ 很小/ 的/ 公钥/ 密码/ 算法/ 执行/ 此类/ 攻击/ 存在/ 一定/ 的/ 困难性/ ;/ 踪迹/ 驱动/ 攻击/ 利用/ 间谍/ 程序/ 采集/ 密码/ 进程/ 一次/ 加解密/ 过程/ 中/ 每次/ 查表/ Cache/ 访问/ 的/ 命中/ 和/ 失效/ 信息/ ,/ 具有/ 采集/ 方法/ 复杂/ 、/ 分析方法/ 简单/ 的/ 特点/ ,/ 先前/ 的/ 大部分/ 研究/ 是/ 通过/ 采集/ 功耗/ [/ 10/ ]/ 或/ 电磁/ ②/ 的/ 手段/ 进行/ 的/ ,/ 需要/ 物理/ 接触/ 密码/ 设备/ ,/ 实施/ 起来/ 较为/ 复杂/ ./ 本文/ 主要/ 针对/ RSA/ 算法/ 的/ 踪迹/ 驱动/ Cache/ 计时/ 攻击/ 展开/ 研究/ ./ 利用/ 采用/ 滑动/ 窗口/ 算法/ 实现/ 模幂/ 运算/ 过程/ 中/ 预计/ 算表/ 的/ 查找/ 操作/ 导致/ 的/ Cache/ 命中/ 与/ 失效/ 特性/ ,/ 建立/ 基于/ 数据/ Cache/ 的/ 踪迹/ 驱动/ 攻击/ 模型/ ;/ 利用/ 间谍/ 进程/ 采集/ 密码/ 进程/ 执行/ 过程/ 中/ 泄露/ 的/ Cache/ 访问/ 踪迹/ ,/ 获取/ 算法/ 执行/ 的/ 关键/ 操作/ 序列/ ,/ 提出/ 由/ 算法/ 操作/ 序列/ 推导/ 出/ 幂指数/ 位/ 信息/ 的/ 分析方法/ ;/ 利用/ 窗口/ 大小/ 特征/ 以及/ 预计/ 算表/ 索引/ 值/ 与/ 窗口/ 值/ 的/ 相关性/ ,/ 提出/ 一种/ 能/ 进一步/ 缩小/ 幂指数/ 搜索/ 空间/ 的/ 算法/ ;/ 最后/ 在/ 具有/ 同步/ 多线程/ 能力/ 的/ 处理器/ 上/ 执行/ 攻击/ 实验/ ,/ 精心/ 编写/ 能够/ 与/ 密码/ 进程同步/ 执行/ 的/ 间谍/ 程序/ ,/ 在/ 真实/ 环境/ 下/ 针对/ OpenSSLv0/ ./ 9.8/ b/ 密码/ 库中/ 的/ RSA/ 算法/ 执行/ 攻击/ ,/ 对/ 攻击/ 过程/ 中/ 的/ 难点/ 进行/ 分析/ 并/ 给出/ 相应/ 的/ 解决方案/ ./ 设计/ 并/ 执行/ 实验/ 成功/ 获取/ 幂指数/ dp/ 和/ dq/ 大约/ 340/ 位/ 的/ 幂指数/ 值/ ,/ 再/ 运用/ 格/ 攻击/ 的/ 分析方法/ 推导/ 出/ 完整/ 的/ 密钥/ 值/ ,/ 验证/ 了/ ①/ ②/ Page3/ 密钥/ 分析方法/ 与/ 踪迹/ 驱动/ 攻击/ 的/ 正确性/ 和/ 可行性/ ./ 目前/ 在/ 国内外/ 研究/ 中/ ,/ 针对/ RSA/ 算法/ 的/ 踪迹/ 驱动/ Cache/ 计时/ 攻击/ 研究成果/ 不/ 显著/ ,/ 还/ 没有/ 提出/ 一种/ 通用/ 的/ 针对/ 公钥/ 密码/ 算法/ 踪迹/ 驱动/ Cache/ 计时/ 攻击/ 分析/ 算法/ ,/ 原有/ 的/ 攻击/ 大都/ 通过/ 修改/ 源码/ 的/ 方式/ 将/ 间谍/ 进程/ 嵌入/ 密码/ 进程/ 的/ 方式/ 实现/ ,/ 实现/ 两个/ 进程/ 间/ 的/ 假/ 同步/ ,/ 而且/ 实验/ 还/ 处于/ 仿真/ 验证/ 阶段/ ,/ 尚未/ 有/ 真实/ 环境/ 下/ 的/ 攻击/ 实验/ 结果/ 公开/ ./ 依据/ 研究/ 现状/ ,/ 本文/ 的/ 主要/ 贡献/ 有/ :/ (/ 1/ )/ 通过/ 分析/ RSA/ 密码/ 算法/ 的/ 内部/ 执行/ 操作/ 流程/ ,/ 结合/ 针对/ 分组/ 密码/ 算法/ 的/ 访问/ 驱动/ 攻击/ 原理/ ,/ 指出/ 针对/ RSA/ 算法/ 访问/ 驱动/ Cache/ 计时/ 攻击/ 的/ 困难性/ ,/ 依据/ 踪迹/ 驱动/ 攻击/ 原理/ ,/ 建立/ 了/ 一种/ 通用/ 的/ 踪迹/ 驱动/ 数据/ Cache/ 计时/ 攻击/ 模型/ ./ (/ 2/ )/ 结合/ OpenSSL/ 密码/ 库中/ BIGNUM/ 类型/ 的/ 数据结构/ ,/ 深入分析/ 了/ RSA/ 算法/ 实现/ 过程/ 中/ 相关/ 算法/ 内部/ 执行/ 状态/ ,/ 利用/ 幂指数/ 位/ 与/ 平方/ 乘法/ 操作/ 序列/ 的/ 相关性/ 以及/ 预计/ 算表/ 虚拟内存/ 地址/ 与/ Cache/ 组/ 的/ 映射/ 关系/ ,/ 在/ 原有/ 分析/ 算法/ 的/ 基础/ 上/ ,/ 提出/ 了/ 一种/ 基于/ 窗口/ 大小/ 特征/ 的/ 分析/ 算法/ ,/ 进一步提高/ Cache/ 计时/ 信息/ 的/ 利用率/ ,/ 缩小/ 了/ 密钥/ 的/ 搜索/ 空间/ ./ (/ 3/ )/ 在/ 实际/ 环境/ 下/ 执行/ Cache/ 攻击/ 实验/ ,/ 对/ 攻击/ 的/ 关键技术/ 和/ 可能/ 遇到/ 的/ 难点/ 进行/ 分析/ ,/ 主要/ 对/ 有效/ 信息/ 筛选/ 、/ Cache/ 组/ 定位/ 以及/ 索引/ 值/ 与/ Cache/ 组/ 的/ 映射/ 等/ 关键性/ 问题/ 进行/ 阐述/ ,/ 并/ 给出/ 了/ 相应/ 的/ 解决方案/ ./ (/ 4/ )/ 给出/ 由/ 幂指数/ dp/ 和/ dq/ 的/ 部分/ 离散/ 位/ 信息/ 推导/ 出/ 完整/ 私钥/ d/ 的/ 格/ 攻击/ 过程/ ./ 针对/ OpenSSLv0/ ./ 9.8/ b/ 密码/ 库中/ 的/ RSA/ 算法/ ,/ 在/ 同步/ 多线程/ (/ SMT/ )/ 处理器/ 上/ 执行/ 攻击/ 实验/ ,/ 采集/ 真实/ 的/ 数据/ Cache/ 访问/ 时间/ ,/ 真正/ 实现/ 间谍/ 进程/ 与/ 密码/ 进程同步/ 执行/ ./ 实验/ 获取/ 512/ 位/ 幂指数/ 中/ 大约/ 340/ 位/ 离散/ 的/ 位/ 信息/ ,/ 利用/ 给出/ 的/ 格/ 攻击/ 算法/ 恢复/ 完整/ 密钥/ ,/ 证明/ 比/ 原有/ 算法/ 进一步/ 缩小/ 了/ 密钥/ 搜索/ 空间/ ./ 本文/ 第/ 2/ 节/ 给出/ RSA/ 算法/ 及/ 滑动/ 窗口/ 实现/ 算法/ 、/ Cache/ 访问/ 机制/ 和/ Cache/ 计时/ 攻击/ 等/ 相关/ 知识/ ;/ 第/ 3/ 节/ 给出/ 了/ 查找/ 预计/ 算表/ 访问/ Cache/ 时间/ 泄露/ 和/ 密钥/ 分析/ 的/ 机理/ ,/ 分析/ 了/ 针对/ RSA/ 算法/ 访问/ 驱动/ Cache/ 计时/ 攻击/ 的/ 困难性/ ,/ 建立/ 了/ 基于/ 数据/ Cache/ 的/ 踪迹/ 驱动/ 攻击/ 模型/ ;/ 第/ 4/ 节/ 依据/ 攻击/ 模型/ ,/ 给出/ 由/ Cache/ 踪迹/ 信息/ 推算/ 幂指数/ 的/ 分析/ 算法/ ;/ 第/ 5/ 节/ 分析/ 了/ 实际/ 攻击/ 中/ 存在/ 的/ 难点/ ,/ 并/ 给出/ 相应/ 的/ 解决方案/ ;/ 第/ 6/ 节/ 设计/ 并/ 实现/ 针对/ OpenSSL/ 的/ RSA/ 算法/ Cache/ 攻击/ 实验/ ,/ 给出/ 密钥/ 推导/ 过程/ ,/ 对/ 实验/ 结果/ 进行/ 对比/ 分析/ 并/ 讨论/ ;/ 第/ 7/ 节/ 进行/ 总结/ ./ 2/ 相关/ 知识/ 2.1/ RSA/ 算法/ 及其/ 实现/ RSA/ 密码/ 算法/ [/ 11/ ]/ 是/ 目前/ 最为/ 广泛/ 使用/ 的/ 公钥/ 密码/ 算法/ ,/ 是/ 第一个/ 既/ 能/ 用于/ 数据/ 加密/ 也/ 能/ 用于/ 数字签名/ 的/ 算法/ ./ 密钥/ 的/ 构造/ 过程/ :/ 首先/ 选择/ 两个/ 素数/ p/ 和/ q/ ,/ 计算/ N/ =/ pq/ ,/ 随机/ 选取/ 加密/ 密钥/ e/ ,/ 满足/ ed/ =/ 1mod/ (/ p/ -/ 1/ )/ (/ q/ -/ 1/ )/ ,/ 然后/ 采用/ 欧几里得/ 扩展/ 算法/ 获得/ 解密/ 密钥/ d/ ,/ 则/ d/ =/ e/ -/ 1mod/ (/ p/ -/ 1/ )/ (/ q/ -/ 1/ )/ ./ 其中/ e/ 和/ N/ 公开/ ,/ d/ 为/ 私钥/ ./ 设/ M/ 表示/ 明文/ ,/ C/ 表示/ 密文/ ,/ 则/ 算法/ 的/ 加密/ 操作/ 为/ C/ =/ MemodN/ ,/ 解密/ 操作/ 为/ M/ =/ CdmodN/ ,/ 实现/ 算法/ 的/ 核心/ 是/ 模幂/ 运算/ :/ S/ =/ mdmodN/ ./ 目前/ 流行/ 使用/ 的/ OpenSSL/ 密码/ 库/ ③/ 是/ 广大/ 密码/ 分析/ 学家/ 关注/ 的/ 主要/ 对象/ ,/ 为了/ 更好/ 地/ 掌握/ 时间/ 泄露/ 机理/ ,/ 现对/ RSA/ 算法/ 中模/ 幂/ 运算/ 具体/ 实现/ 进行/ 分析/ ./ 最/ 简单/ 的/ 实现/ 方式/ 是/ 平方/ 乘/ 算法/ ,/ 即将/ 模幂/ 运算/ 分解成/ 一系列/ 平方和/ 乘法/ 运算/ ,/ 包括/ 从左到右/ 和/ 从右到左/ 两种/ 算法/ ./ 但/ 平方/ 乘/ 算法/ 存在/ 运算/ 速度慢/ 的/ 缺点/ ,/ 为了/ 提高/ RSA/ 执行/ 速度/ ,/ 1982/ 年/ 比利时/ 的/ Quisquater/ 等/ 人/ [/ 12/ ]/ 首次/ 应用/ 著名/ 的/ 中国/ 剩余/ 定理/ 提高/ 了/ RSA/ 算法/ 的/ 运算/ 速度/ ,/ 将/ mdmodN/ 分解/ 为/ mdpmodp/ 和/ mdqmodq/ ,/ 降低/ 计算/ 复杂度/ ,/ 大约/ 能够/ 提高/ 4/ 倍/ 的/ 执行/ 速度/ ./ OpenSSL/ 算法/ 库/ 在/ 实现/ 模幂/ 运算/ 时/ ,/ 采用/ 滑动/ 窗口/ 算法/ [/ 13/ ]/ ./ 它/ 是/ 一种/ 优化/ 的/ 快速/ 计算/ 模幂/ 运算/ 算法/ ,/ 将模/ 幂/ 运算/ 分解/ 为/ 一系列/ 的/ 乘法/ 运算/ 和/ 平方/ 运算/ ,/ 幂指数/ 以/ 一定/ 大小/ 的/ 窗口/ 在/ 二进制/ 幂指数/ 上/ 进行/ 滑动/ ,/ 利用/ 预计/ 算表中/ 的/ 元素/ 直接/ 作为/ 乘数/ ,/ 减少/ 乘数/ 重复/ 计算/ 的/ 步骤/ ,/ 提高/ 运算/ 效率/ ./ 该/ 思想/ 也/ 在/ DSA/ 、/ ECC/ 等/ 公钥/ 密码/ 算法/ 中/ 得到/ 了/ 应用/ ,/ 是/ 本文/ 重点/ 关注/ 的/ 实现/ 算法/ ,/ 具体/ 描述/ 如/ 算法/ 1/ 所示/ ./ 算法/ 1/ ./ 模幂/ 运算/ 的/ 滑动/ 窗口/ 实现/ 算法/ ./ 输入/ :/ m/ 、/ N/ 和/ d/ =/ (/ dn/ -/ 1/ ,/ dn/ -/ 2/ ,/ …/ ,/ d1/ ,/ d0/ )/ ,/ win/ _/ size/ 输出/ :/ S/ =/ mdmodN/ 初始化/ 表/ T/ [/ 2/ / (/ win/ _/ size/ -/ 1/ )/ ]/ S/ =/ 1/ ;/ For/ (/ k/ =/ n/ -/ 1/ ,/ k/ >/ 0/ ,/ k/ -/ -/ )/ {/ ③/ TheOpenSSLProject/ :/ OpenSSL/ ./ TheopensourcetoolkitPage4IF/ (/ dk/ =/ =/ 0/ )/ {/ FOR/ (/ i/ =/ 1/ ;/ i/ </ win/ _/ size/ ;/ i/ ++/ )/ {/ 获取/ 窗口/ 位数/ wend/ 和/ 窗口/ 值/ wvalueFOR/ (/ j/ =/ 0/ ;/ i/ </ wend/ ;/ j/ ++/ )/ {/ }/ S/ =/ S/ ×/ T/ [/ wvalue/ / 1/ ]/ modN/ ;/ k/ =/ k/ -/ wend/ ;/ }/ ReturnS/ ;/ 算法/ 1/ 中/ ,/ 窗口/ 大小/ win/ _/ size/ 与/ 幂指数/ d/ 的/ 长度/ l/ 有关/ ,/ 在/ OpenSSLv0/ ./ 9.8/ b/ 中/ ,/ 通过/ 调用/ BN/ _/ window/ _/ bits/ _/ for/ _/ exponent/ _/ size/ (/ )/ 函数/ 计算/ 出/ 对应/ 窗口/ 大小/ ,/ 当/ l/ / 671/ 时/ win/ _/ size/ =/ 6/ ,/ 当/ 671/ >/ l/ >/ 239/ 时/ ,/ win/ _/ size/ =/ 5/ ./ 对于/ 通常/ 采用/ 的/ 1024/ 位/ RSA/ 密钥/ 来说/ ,/ CRT/ 实现/ 算法/ 中/ 涉及/ 的/ 幂指数/ dp/ 和/ dq/ 的/ 长度/ 约/ 为/ 512/ ,/ 因此/ 对应/ 的/ 窗口/ 大小/ 为/ 5.2/ ./ 2Cache/ 工作/ 原理/ 为/ 解决/ CPU/ 与/ 主存/ 之间/ 速度/ 不/ 匹配/ 的/ 问题/ ,/ 现代/ 微处理器/ 和/ 微型/ 计算机/ 中/ ,/ 大都/ 采用/ 高速缓存/ Cache/ [/ 14/ ]/ ,/ 为/ 处理器/ 提供/ 一种/ 快速/ 方便/ 地/ 访问/ 最/ 频繁/ 访问/ 的/ 数据/ 和/ 指令/ 的/ 方式/ ,/ 依据/ 级别/ 不同/ 可/ 分为/ L1Cache/ 、/ L2Cache/ 甚至/ 还有/ L3Cache/ ,/ 依据/ 类型/ 可/ 分为/ 数据/ Cache/ 和/ 指令/ Cache/ ./ 为了/ 解决/ 直接/ 映射/ 高速缓存/ 中/ 冲突/ 不/ 命中/ 造成/ 的/ 问题/ ,/ 目前/ Cache/ 一般/ 采用/ 组/ 相连/ 的/ 结构/ ,/ 设/ 整个/ Cache/ 包括/ S/ 个/ Cache/ 组/ ,/ W/ 路组/ 相连/ ,/ 每个/ Cache/ 行/ 大小/ 为/ B/ 字节/ ,/ 每个/ Cache/ 组有/ W/ 个/ Cache/ 行/ ,/ 则/ Cache/ 总/ 大小/ 为/ S/ ×/ W/ ×/ B/ 字节/ ./ Cache/ 的/ 工作/ 原理/ [/ 14/ ]/ :/ 以/ 数据/ Cache/ 为例/ ,/ 当/ 处理器/ 需要/ 从/ 主存/ 读取数据/ 时/ ,/ 它/ 首先/ 检测/ 这些/ 数据/ 是否/ 存在/ 数据/ Cache/ 中/ ,/ 如果/ 存在/ ,/ 处理器/ 立即/ 读取/ 这些/ 数据/ ,/ 而/ 不/ 需要/ 访问/ 主存/ (/ 发生/ Cache/ 命中/ )/ ;/ 否则/ ,/ 处理器/ 必须/ 从/ 更/ 高/ 一级/ 的/ Cache/ 或/ 主存/ 中/ 读取数据/ (/ 发生/ Cache/ 失效/ )/ ,/ 同时/ 将/ 数据/ 的/ 副本/ 存储/ 在/ Cache/ 中/ ,/ 可以/ 使得/ 以后/ 对/ 整块/ 数据/ 的/ 读取/ 都/ 从/ 缓存/ 中/ 进行/ ,/ 不必/ 再/ 调用/ 内存/ ./ 每/ 一次/ Cache/ 失效/ 都/ 会/ 产生/ 对/ 更/ 高/ 一级/ 存储器/ 的/ 访问/ ,/ 从而/ 导致/ 额外/ 的/ 存取/ 延迟时间/ 或/ 较大/ 的/ 能量消耗/ ./ 另外/ CPU/ 与/ Cache/ 之间/ 的/ 数据交换/ 以字/ 为/ 单位/ ,/ 而/ Cache/ 与/ 主存/ 之间/ 的/ 数据交换/ 是/ 以/ 字块/ 为/ 单位/ ./ 而且/ 根据/ 程序/ 局部性/ 原理/ ,/ 会/ 把/ 包括/ 要/ 访问/ 的/ 数据/ 在内/ 的/ 一整块/ Cache/ 行/ B/ 字节/ 大小/ 的/ 数据/ 从/ 主存/ 读出/ ,/ 装载/ 入/ Cache/ 中/ ./ 当/ 需要/ 驱逐/ Cache/ 时/ ,/ 为了/ 保证/ CPU/ 访问/ 时有/ 较/ 高/ 的/ 命中率/ ,/ 缓存/ 中/ 的/ 内容/ 应该/ 按/ 一定/ 的/ 算法/ 替换/ ./ 通常/ 采用/ 的/ 算法/ 是/ “/ 最近/ 最少/ 使用/ 算法/ ”/ (/ LRU/ 算法/ )/ ,/ 将/ 最近/ 一段时间/ 内/ 最少/ 被/ 访问/ 过/ 的/ Cache/ 行/ 淘汰/ 出局/ ./ 具体/ 查找/ Cache/ 行/ 是否/ 存在/ 的/ 过程/ 如下/ :/ 在/ 组/ 相连/ 的/ Cache/ 结构/ 中/ ,/ Cache/ 组中/ 的/ 任何/ 一行/ 都/ 可以/ 包含/ 被/ 映射/ 到/ 这个/ 组/ 的/ 存储/ 块/ ,/ 因此/ Cache/ 在/ 寻找/ 一个/ 有效/ 的/ 行时/ ,/ 必须/ 搜索/ 组中/ 的/ 每/ 一行/ ,/ 检查/ 其/ 标记/ 与/ 地址/ 中/ 的/ 标记/ 是否/ 相匹配/ ./ 如果/ 在/ Cache/ 中/ 找到/ 了/ ,/ 则/ 发生/ 命中/ ,/ 块/ 偏移/ 从/ 这个/ 块/ 中/ 选择/ 一个/ 字/ ,/ 否则/ 发生/ 失效/ ,/ 需要/ 从/ 主存/ 载入/ 再/ 读取/ ./ 以/ 本文/ 采用/ 的/ IntelPentium4/ 处理器/ 的/ L1/ 数据/ Cache/ 结构/ 为例/ ,/ 给出/ 虚拟内存/ 地址/ 的/ 逻辑/ 结构图/ 如图/ 1/ 所示/ ,/ 为/ 后面/ 的/ 密钥/ 分析/ 算法/ 做/ 准备/ ./ 总/ 大小/ 为/ 16KB/ ,/ Cache/ 行/ 大小/ 为/ 64/ 字节/ ,/ 8/ 路组/ 相连/ ,/ 因此/ 共/ 256/ 个/ Cache/ 行/ 被/ 分为/ 32/ 个/ Cache/ 组/ ./ 在/ 目标/ 系统/ 中/ 每个/ 虚拟存储器/ 地址/ 被/ 分为/ 3/ 个/ 部分/ :/ 最低/ 6/ 位为/ 块/ 偏移/ 位/ ,/ 用于/ 选择/ 每个/ Cache/ 行中/ 64/ 个/ 字节/ 起始/ 位置/ ;/ 与/ 之/ 邻近/ 的/ 5/ 位为/ 组/ 索引/ 位/ ,/ 用于/ 选择/ 32/ 个/ 相连/ 的/ Cache/ 组/ ,/ 剩余/ 的/ 21/ 位为/ 标记/ 位/ ,/ 用于/ 区分/ 关联/ 到/ 相同/ Cache/ 组/ 的/ 地址/ ,/ 标记/ 位/ 与/ 索引/ 位连/ 起来/ 唯一/ 地/ 标识/ 了/ 存储器/ 中/ 的/ 每个/ 块/ ./ 图/ 1/ 目标/ 系统/ 中/ 虚拟存储器/ 地址/ 的/ 逻辑/ 结构图/ Cache/ 攻击/ 正是/ 利用/ Cache/ 访问/ 的/ 时间/ 或者/ 能量消耗/ 差异/ 信息/ ,/ 得到/ Cache/ “/ 命中/ ”/ 和/ “/ 失效/ ”/ 特征/ 信息/ ,/ 然后/ 使用/ 相应/ 的/ 旁路/ 信息/ 分析方法/ ,/ 缩小/ 密钥/ 搜索/ 空间/ 甚至/ 得到/ 完整/ 密钥/ ./ 2.3/ Cache/ 计时/ 攻击/ Cache/ 计时/ 攻击/ [/ 15/ ]/ 属于/ 微/ 架构/ 攻击/ 的/ 一种/ ,/ 主要/ 利用/ 密码/ 算法/ 在/ 加解密/ 过程/ 中/ 通过/ 微/ 架构/ 元器件/ Cache/ 泄露/ 出来/ 的/ 时间/ 信息/ ,/ 结合/ 明文/ 或/ 密文/ ,/ 以及/ Cache/ 行为/ 和/ 密钥/ 信息/ 的/ 相关性/ 来/ 进行/ 密钥/ 分析/ 的/ 一种/ 攻击方式/ ,/ 属于/ 旁路/ 攻击/ 的/ 范畴/ ./ 依据/ Cache/ 工作/ 原理/ 可知/ ,/ 密码/ 进程/ 访问/ 数据/ 时/ ,/ 由于/ 目标/ 数据/ 当前/ 是否/ 存在/ 于/ Cache/ 中/ 可/ 通过/ 计时/ 手段/ 的/ 方式/ 进行/ 判断/ ,/ 同时/ 由于/ “/ 命中/ ”/ 与/ “/ 失效/ ”/ 的/ 时间/ 差异/ 信息/ 和/ 密钥/ 往往/ 是/ 紧密/ 相关/ 的/ ,/ 所以/ 只要/ 能/ 采集/ 到/ 足够/ 多/ 的/ 时间/ 旁路/ 信息/ ,/ 结合/ 分析/ 算法/ 就/ 有/ 可能/ 推测/ 出/ 密钥/ ./ Page5/ 根据/ Cache/ 类型/ ,/ 可/ 将/ 计时/ 攻击/ 分为/ 数据/ Cache/ 攻击/ 、/ 指令/ Cache/ 攻击/ 两种/ [/ 15/ ]/ ./ 由于/ 现代/ 分组/ 密码/ 大多/ 使用/ S/ 盒/ 查找/ 表/ 实现/ 非线性/ 混淆/ ,/ 而/ 查找/ 表/ 需要/ 对/ 数据/ Cache/ 进行/ 访问/ ,/ 所以/ 目前/ 利用/ 数据/ Cache/ 进行/ 的/ 攻击/ 对象/ 主要/ 为/ 分组/ 密码/ ,/ 如/ DES/ [/ 3/ ]/ 、/ AES/ ①/ ;/ 另外/ 有/ 部分/ 公钥/ 密码/ 算法/ ,/ 如/ RSA/ [/ 4/ ]/ ,/ 采用/ 窗口/ 算法/ 实现/ 实现/ 模幂/ 运算/ 时/ ,/ 存在/ 查找/ 表/ 的/ 操作/ ,/ 同样/ 存在/ 遭受/ 数据/ Cache/ 计时/ 攻击/ 的/ 可能/ ;/ 现代/ 公钥/ 加密/ 系统/ 大都/ 利用/ 经典/ 数学/ 问题/ 的/ 单向/ 陷门/ 特性/ ,/ 使用/ 了/ 大量/ 的/ 指令/ 访问/ 操作/ ,/ 其/ 加解密/ 过程/ 中/ 由于/ 密钥/ 位值/ 不同/ 所/ 要/ 进行/ 的/ 指令/ 访问/ 操作/ 数目/ 有/ 很大/ 的/ 区别/ ,/ 此时/ 会/ 导致/ 对/ 指令/ Cache/ 访问/ 次数/ 及/ 时间/ 存在/ 很大/ 区别/ ./ 所以/ ,/ 目前/ 利用/ 指令/ Cache/ 的/ 攻击/ 对象/ 主要/ 是/ 公钥/ 加密/ 系统/ ,/ 如/ RSA/ [/ 5/ -/ 6/ ]/ 、/ DSA/ [/ 16/ ]/ 、/ ECC/ [/ 17/ ]/ ./ 指令/ Cache/ 攻击/ 不/ 在/ 本文/ 的/ 讨论/ 范围/ 内/ ,/ 本文/ 主要/ 针对/ 数据/ Cache/ 计时/ 攻击/ 进行/ 分析/ ./ 根据/ 所/ 采集/ 的/ 时间/ 信息/ 类型/ 的/ 不同/ [/ 18/ ]/ ,/ 可/ 将/ 计时/ 攻击/ 分为/ 时序/ 驱动/ ①/ 、/ 访问/ 驱动/ [/ 8/ ]/ 、/ 踪迹/ 驱动/ [/ 9/ ]/ 3/ 种/ 方式/ ./ 时序/ 驱动/ 攻击/ 采集/ 的/ 是/ 密码/ 进程/ 整个/ 加解密/ 时间/ ,/ 采集/ 方法/ 简单/ ,/ 平台/ 适用性/ 强/ ,/ 但/ 所/ 需/ 样本量/ 大/ ,/ 一般/ 都/ 要/ 百万计/ ,/ 离线/ 分析方法/ 比较复杂/ ./ 更/ 重要/ 的/ 是/ ,/ 在/ 远程/ 环境/ 中/ ,/ 网络/ 传输/ 时延/ 甚至/ 是/ 抖动/ 时延/ 都/ 会/ 大大/ 影响/ 计时/ 的/ 精度/ ,/ 采集/ 到/ 精确/ 的/ 加密/ 时间/ 显得/ 极为/ 困难/ ./ 访问/ 驱动/ 攻击/ [/ 8/ ]/ 主要/ 利用/ 间谍/ 进程/ 两次/ 采集/ 密码/ 进程/ 加密/ 或/ 解密/ 前后/ 访问/ 的/ Cache/ 组/ 集合/ 差异/ 信息/ ,/ 采集/ 方法/ 比/ 时序/ 驱动/ 稍显/ 复杂/ ,/ 但/ 分析方法/ 比较简单/ ,/ 在/ 木马/ 植入/ 技术/ 日趋/ 成熟/ 的/ 今天/ ,/ 攻击/ 实现/ 的/ 可行性/ 比较/ 强/ ,/ 但/ 该/ 攻击方式/ 主要/ 适用/ 于/ 针对/ 使用/ S/ 盒/ 的/ 分组/ 密码/ 算法/ 的/ 攻击/ ,/ 对于/ 公钥/ 密码/ 算法/ 存在/ 一定/ 的/ 困难性/ ,/ 具体/ 在/ 3.1/ 节/ 进行/ 分析/ ./ 踪迹/ 驱动/ 攻击/ [/ 9/ ]/ 比/ 访问/ 驱动/ 攻击/ 信息/ 采集/ 精度/ 更高/ ,/ 攻击/ 方/ 需要/ 采集/ 密码/ 进程/ 一次/ 加密/ 或/ 解密/ 过程/ 中/ 每次/ 查表/ Cache/ 访问/ 的/ 命中/ 和/ 失效/ 信息/ ,/ 一般/ 通过/ 功耗/ 检测/ 手段/ 进行/ ,/ 但/ 该/ 手段/ 需要/ 特殊/ 的/ 信息/ 采集/ 设备/ 而且/ 需要/ 物理/ 接触/ 密码/ 设备/ ,/ 实现/ 起来/ 比较复杂/ ./ 采用/ 计时/ 的/ 手段/ ,/ 利用/ 处理器/ 的/ 同步/ 多线程/ 技术/ 可/ 实现/ 间谍/ 进程/ 与/ 密码/ 进程/ 的/ 同步/ 执行/ ,/ 不断/ 监视/ 密码/ 进程/ 执行/ 过程/ 中/ Cache/ 访问/ 的/ 状态/ 信息/ ,/ 可/ 获取/ 密码/ 进程/ 执行/ 过程/ 的/ 整个/ 踪迹/ ,/ 理想/ 情况/ 下/ 一条/ 完整/ 的/ 踪迹/ 信息/ 就/ 足以/ 推算出/ 整个/ 密钥/ ,/ 无论/ 在/ 本地/ 还是/ 远程/ 攻击/ 中/ 都/ 具有/ 较强/ 的/ 可行性/ ./ 通过/ 分析/ 对比/ 发现/ ,/ 采用/ 滑动/ 窗口/ 算法/ 实现/ 的/ 公钥/ 密码/ 算法/ 都/ 存在/ 遭受/ 踪迹/ 驱动/ 攻击/ 的/ 可能性/ ,/ 本文/ 以/ RSA/ 算法/ 为/ 分析/ 对象/ ,/ 研究/ 基于/ 数据/ Cache/ 的/ 踪迹/ 驱动/ 攻击/ 模型/ 以及/ 算法/ ./ 2.4/ 预先/ 定义/ 为了/ 更好/ 地/ 描述/ 攻击/ 过程/ ,/ 事先/ 做/ 如下/ 说明/ :/ (/ 1/ )/ Cache/ 结构/ 参数/ 本文/ 主要/ 针对/ 组/ 相连/ 的/ Cache/ 结构/ ,/ W/ 路组/ 相连/ ,/ 每个/ Cache/ 组/ 包含/ W/ 个/ Cache/ 行/ ,/ 每个/ Cache/ 行/ 大小/ 定义/ 为/ B/ 字节/ ,/ 每个/ 行由/ S/ 个/ 元素/ 组成/ ,/ 整个/ Cache/ 大小/ 为/ S/ ×/ W/ ×/ B/ 字节/ ,/ 每/ 一路/ Cache/ 的/ 大小/ 为/ S/ ×/ B/ 字节/ ./ 用/ S0/ ,/ S1/ ,/ S2/ ,/ …/ ,/ Ss/ -/ 1/ 分别/ 表示/ S/ 个/ Cache/ 组/ ,/ Si0/ ,/ Si1/ ,/ …/ ,/ Si/ (/ w/ -/ 1/ )/ ,/ 0/ / i/ </ W/ ,/ 表示/ 第/ i/ 个/ Cache/ 组/ 的/ w/ 个/ Cache/ 行/ ,/ 以此类推/ ./ (/ 2/ )/ RSA/ 密钥/ 的/ 推导/ 采用/ 中国/ 剩余/ 定理/ 实现/ RSA/ 算法/ 的/ 模幂/ 运算/ mdmodN/ ,/ 模数/ N/ 长度/ 为/ β/ -/ bit/ ,/ 将/ 其/ 分解/ 为/ mdpmodp/ 和/ mdqmodq/ 的/ 计算/ ,/ 其中/ dp/ 和/ dq/ 约/ 为/ β/ // 2/ -/ bit/ ,/ 只要/ 能够/ 获取/ dp/ 和/ dq/ 中/ 的/ 任何/ 一个/ 数/ ,/ 就/ 可/ 通过/ e/ ./ dp/ =/ 1mod/ (/ p/ -/ 1/ )/ 或/ e/ ./ dq/ =/ 1mod/ (/ q/ -/ 1/ )/ 计算/ 素数/ p/ 或/ q/ ;/ 如果/ 只/ 能够/ 获取/ dp/ 或/ dq/ 一半/ 以上/ 的/ 位/ 信息/ ,/ 可/ 利用/ 格/ 基化/ 约/ 减/ 的/ 方法/ 因式分解/ 模数/ N/ ,/ 从而/ 计算/ 出/ 私钥/ d/ ./ 本文/ 为了/ 描述/ 方便/ ,/ 以模/ 幂/ 运算/ mkmodn/ 为/ 分析/ 对象/ ,/ 幂指数/ k/ 为/ 攻击/ 要/ 获取/ 的/ 目标/ ,/ n/ 为/ 模数/ ./ (/ 3/ )/ 间谍/ 进程/ 、/ 密码/ 进程/ 与/ 攻击/ 进程/ 定义/ 间谍/ 进程/ 为/ SP/ ,/ 密码/ 进程/ 为/ CP/ ,/ 攻击/ 进程/ 为/ AP/ ./ (/ 4/ )/ 窗口/ 实现/ 算法/ 的/ 参数/ 定义/ 滑动/ 窗口/ 大小/ 为/ win/ _/ size/ ,/ 预计/ 算表为/ T/ [/ 2/ / (/ win/ _/ size/ -/ 1/ )/ ]/ ,/ 每次/ 滑动/ 的/ 窗口/ 大小/ 为/ wend/ ,/ 对应/ 的/ 二进制/ 值为/ wvalue/ ;/ 如果/ 是/ 固定/ 窗口/ 算法/ ,/ 窗口/ 大小/ 为/ win/ _/ size/ 时/ ,/ 预计/ 算表为/ T/ [/ 2/ / win/ _/ size/ ]/ ./ win/ _/ size/ 的/ 大小/ 由/ 幂指数/ 长度/ 决定/ ,/ 依据/ OpenSSLv0/ ./ 9.8/ b/ 的/ 实现/ 方式/ ,/ 当/ β/ // 2/ / 671/ 时/ win/ _/ size/ =/ 6/ ,/ 当/ 671/ >/ β/ // 2/ >/ 239/ 时/ win/ _/ size/ =/ 5/ ./ 由于/ 私钥/ d/ 只/ 包含/ 在/ RSA/ 的/ 解密/ 或/ 签名/ 计算/ 中/ ,/ 如/ 无/ 特别/ 说明/ ,/ 本文/ 的/ Cache/ 计时/ 攻击/ 针对/ 2014/ -/ bit/ 的/ RSA/ 解密/ 算法/ ,/ β/ // 2/ 大约/ 为/ 512/ ,/ 因此/ 窗口/ 大小/ win/ _/ size/ =/ 5.3/ 基于/ 数据/ Cache/ 的/ 踪迹/ 驱动/ 攻击/ 模型/ 3.1/ 针对/ RSA/ 算法/ 访问/ 驱动/ Cache/ 计时/ 攻击/ 的/ 困难性/ 访问/ 驱动/ Cache/ 计时/ 攻击/ [/ 8/ ]/ 主要/ 利用/ Cache/ 访/ Page6/ 问/ 时间/ 不确定性/ 和/ Cache/ 存储空间/ 资源共享/ 机制/ ,/ 利用/ 间谍/ 进程/ 监视/ 密码/ 进程/ Cache/ 访问/ 操作/ ,/ 在/ 密码/ 进程/ 一次/ 或/ 多次/ 解密/ 后/ ,/ 通过/ 计时/ 方法/ 采集/ 间谍/ 进程/ 二次/ 访问/ 数据/ 的/ Cache/ “/ 命中/ ”/ 和/ “/ 失效/ ”/ 特征/ 信息/ ,/ 间接/ 得到/ 密码/ 进程/ 的/ Cache/ 访问信息/ 并/ 对/ 其/ 进行/ 分析/ ,/ 预测/ 加密/ 查表/ 索引/ 信息/ ,/ 根据/ 查表/ 索引/ 、/ 明文/ (/ 或/ 密文/ )/ 对/ 以及/ 密钥/ 之间/ 的/ 关系/ 缩小/ 密钥/ 搜索/ 空间/ ./ 由于/ 多次/ 执行/ 密码/ 进程/ 会/ 导致/ Cache/ “/ 命中/ ”/ 和/ “/ 失效/ ”/ 信息/ 混乱/ ,/ 因此/ 攻击/ 一般/ 采取/ 在/ 间谍/ 进程/ 连续/ 两次/ 运行/ 之间/ 仅仅/ 进行/ 一次/ 加密/ 或/ 解密/ 操作/ ,/ 从而/ 使/ 间谍/ 采集/ 密码/ 进程/ 执行/ 过程/ 中/ 所有/ 可能/ 的/ Cache/ 访问/ 行为/ ./ 针对/ 分组/ 密码/ 算法/ 的/ 访问/ 驱动/ 攻击/ 算法/ ,/ 主要/ 是/ 基于/ 算法/ 实现/ 过程/ 中/ ,/ 查找/ 表/ 相关/ 信息/ 与/ 明文/ (/ 或/ 密文/ )/ 和子/ 密钥/ 三者/ 之间/ 存在/ 异或/ 操作/ 关系/ ,/ 即/ 查找/ 表/ 的/ 相关/ 信息/ 不仅仅/ 与子/ 密钥/ 有关/ ,/ 还/ 受/ 输入/ 的/ 明文/ 或/ 密钥/ 影响/ ./ 攻击/ 利用/ 不同/ 的/ 明文/ 执行/ 操作/ ,/ 采集/ 某/ 一轮/ 操作过程/ 中/ 的/ Cache/ 访问/ 行为/ ,/ 即/ 查找/ 表/ 的/ 信息/ ,/ 对/ 所/ 采集/ 的/ 信息/ 依据/ 是否/ 具有/ 某一/ 相同/ Cache/ 组/ 命中/ 或/ 失效/ 的/ 信息/ 进行/ 筛选/ ,/ 再/ 利用/ 三者/ 之间/ 的/ 相互/ 关系/ ,/ 在/ 一定/ 样本量/ 情况/ 下/ ,/ 通过/ 直接/ 分析法/ 或/ 排除/ 分析法/ 推导/ 出子/ 密钥/ 的/ 字节/ 信息/ ,/ 逐步/ 推导/ 出某/ 一轮/ 的/ 扩展/ 密钥/ 信息/ ,/ 最后/ 再/ 利用/ 子/ 密钥/ 和/ 主/ 密钥/ 的/ 扩展/ 关系/ 恢复/ 完整/ 密钥/ ./ 在/ 针对/ 公钥/ 密码/ 算法/ 的/ 访问/ 驱动/ 攻击/ 方面/ ,/ 主要/ 涉及/ 滑动/ 窗口/ 实现/ 算法/ 中/ ,/ 利用/ 预计/ 算表/ 的/ 索引/ 图/ 2/ 踪迹/ 驱动/ Cache/ 计时/ 攻击/ 模型/ 为了/ 方便/ 描述/ ,/ 图/ 2/ 中/ 对/ 内存/ 结构/ 和/ Cache/ 结构/ 进行/ 了/ 简化/ ,/ 假设/ CP/ 预计/ 算表/ 数据/ 和/ SP/ 数据/ 在/ 主存/ 中所/ 占/ 的/ 内存/ 块/ 分别/ 用/ CTD/ 和/ SPD/ 表示/ ,/ CTD/ 大小/ 即/ 为/ 预计/ 算表/ 的/ 大小/ ,/ SPD/ 大小/ 和/ Cache/ 存储空间/ 大小/ 相同/ (/ 图/ 2/ (/ a/ )/ )/ ./ 踪迹/ 驱动/ Cache/ 计时/ 值/ 与/ 窗口/ 值/ 的/ 对应/ 关系/ ,/ 推导/ 出/ 幂指数/ 的/ 片段/ 信息/ ,/ 但/ 该/ 方法/ 在/ 实现/ 过程/ 中/ 具有/ 一定/ 的/ 困难性/ ./ (/ 1/ )/ 由/ 幂指数/ 滑动/ 的/ 窗口/ 值/ 决定/ 预计/ 算表/ 的/ 索引/ 值/ ,/ 因此/ 预计/ 算表/ 的/ 相关/ 信息/ 只/ 与/ 幂指数/ 相关/ ,/ 而/ 与/ 输入/ 和/ 输出/ 值/ 无关/ ./ (/ 2/ )/ 由/ 滑动/ 窗口/ 实现/ 算法/ 可知/ ,/ 实现/ 过程/ 中/ 如果/ 幂指数/ 位/ 存在/ 若干/ 相同/ 的/ 窗口/ 值/ ,/ 则/ 会/ 对/ 同一/ 预计/ 算表/ 的/ 对应/ 元素/ 多次/ 访问/ ./ 由于/ 预计/ 算表/ 的/ 大小/ 一般/ 较/ 小/ ,/ 当/ 窗口/ 大小/ 为/ 5/ 时/ ,/ 其/ 大小/ 有/ 16/ 个/ 元素/ ,/ 即/ 有/ 16/ 种/ 可能/ 的/ 窗口/ 值/ {/ 1/ ,/ 3/ ,/ 5/ ,/ …/ ,/ 29/ ,/ 31/ }/ ,/ 且/ 多个/ 元素/ 可能/ 被/ 映射/ 到/ 相同/ 的/ Cache/ 组/ ,/ 如果/ 幂指数/ 包含/ 全部/ 的/ 窗口/ 值/ ,/ 则/ 预计/ 算表中/ 的/ 每个/ 元素/ 都/ 会/ 被/ 访问/ ,/ 导致/ 无法/ 推导/ 并/ 区分/ 出/ 窗口/ 值及/ 各个/ 窗口/ 值/ 的/ 数目/ ./ (/ 3/ )/ 最/ 主要/ 是/ 访问/ 驱动/ 攻击/ 采集/ 整个/ 密码/ 执行/ 过程/ 的/ Cache/ 访问/ 状态/ ,/ 而/ 没有/ 记录/ 获取/ Cache/ 组/ 访问/ “/ 命中/ ”/ 和/ “/ 失效/ ”/ 的/ 顺序/ 以及/ 次数/ ,/ 从而/ 不能/ 判断/ 窗口/ 值/ 的/ 位置/ ,/ 导致/ 即使/ 能够/ 获取/ 了/ 部分/ 窗口/ 值/ ,/ 最多/ 也/ 只有/ 80/ =/ 16/ ×/ 5/ 个/ 窗口/ 位/ ,/ 这/ 对于/ 恢复/ 512/ 位/ 幂指数/ ,/ 其/ 计算/ 量/ 仍然/ 是/ 不可/ 忍受/ 的/ ./ 3.2/ 踪迹/ 驱动/ Cache/ 计时/ 攻击/ 模型/ 踪迹/ 驱动/ 攻击/ 比/ 访问/ 驱动/ 攻击/ 信息/ 采集/ 的/ 精度/ 更高/ ,/ 需要/ 间谍/ 进程/ SP/ 与/ 密码/ 进程/ CP/ 同步/ 执行/ ,/ 采集/ CP/ 一次/ 解密/ 过程/ 中/ 每次/ 查表/ Cache/ 访问/ 的/ 命中/ 和/ 失效/ 序列/ ,/ 利用/ 获取/ 的/ 状态/ 序列/ 推导/ 出/ 幂指数/ k/ 的/ 值/ ./ 具体/ 攻击/ 模型/ 如图/ 2/ 所示/ ./ 攻击/ 步骤/ 如下/ :/ (/ 1/ )/ 采集/ 一条/ Cache/ 踪迹/ 计时/ 信息/ ./ 间谍/ 进程/ 与/ 密码/ 进程/ 在/ 同一/ 台/ PC/ 上/ 同步/ 运行/ ,/ 攻击/ 进程/ AP/ 控制/ 间谍/ SP/ 在/ CP/ 执行/ 解密/ 之前/ 先/ 启动/ ,/ 将/ SPD/ 数据/ 全部/ 加载/ 到/ 数据/ Cache/ 中/ ,/ 清空/ 整个/ Cache/ (/ 图/ 2Page7/ (/ b/ )/ )/ ;/ 然后/ 触发/ AP/ 执行/ CP/ 解密/ 操作/ ,/ 运算/ 过程/ 中/ 可能/ 会/ 执行/ 查表/ 操作/ ,/ 从而/ 将/ SP/ 部分/ 预先/ 加载/ 的/ 数据/ 从/ Cache/ 中/ 驱逐/ 出去/ ,/ 而/ 将/ 查到/ 的/ 表/ 元素/ 加载/ 到/ Cache/ 中/ (/ 图/ 2/ (/ c/ )/ )/ ;/ SP/ 与/ CP/ 同步/ 执行/ ,/ 循环/ 访问/ 私有/ 数据/ SPD/ 并/ 测量/ 访问/ 每个/ Cache/ 行/ 的/ 执行/ 时间/ ,/ SP/ 再次/ 对/ 所有/ 私有/ 数据/ SPD/ 进行/ 访问/ 时/ ,/ 对/ 那些/ 已/ 被/ CP/ 从/ Cache/ 中/ 驱除/ 出来/ 的/ 数据/ 进行/ 访问/ 时会/ 发生/ Cache/ “/ 失效/ ”/ ,/ 需/ 访问/ 更高/ 一级/ 的/ 存储器/ 而/ 消耗/ 更/ 多/ 的/ 时间/ (/ 图/ 2/ (/ d/ )/ )/ ,/ 如果/ CP/ 没有/ 执行/ 查表/ 操作/ ,/ 则/ 访问/ 时/ 发生/ Cache/ “/ 命中/ ”/ (/ 图/ 2/ (/ e/ )/ )/ ,/ 并/ 通过/ 计算/ 每个/ Cache/ 组中/ 所有/ Cache/ 行/ 访问/ 时间/ 之/ 和/ 作为/ 每个/ Cache/ 组/ 的/ 访问/ 时间/ ./ (/ 2/ )/ 采集/ 完整/ 的/ Cache/ 踪迹/ 计时/ 信息/ :/ AP/ 使/ SP/ 以/ 一定/ 的/ 频率/ 按照/ 步骤/ (/ 1/ )/ 循环/ 执行/ 整个/ Cache/ 填充/ 并/ 测量/ 每个/ Cache/ 组/ 的/ 执行/ 时间/ ,/ 不断/ 获取/ CP/ 执行/ 时/ 的/ Cache/ 访问/ 踪迹/ ,/ 直到/ CP/ 执行/ 完毕/ ,/ 将/ 采集/ 的/ 踪迹/ 计时/ 信息/ 按照/ 时间/ 顺序/ 进行/ 排列/ ,/ 最终/ 得到/ 整个/ CP/ 执行/ 的/ Cache/ 踪迹/ 计时/ 信息/ (/ 图/ 2/ (/ f/ )/ )/ 和/ CP/ 的/ 执行/ 踪迹/ (/ 图/ 2/ (/ g/ )/ )/ ./ (/ 3/ )/ 分析/ Cache/ 踪迹/ 计时/ 信息/ :/ 根据/ 所/ 采集/ 的/ 计时/ 信息/ ,/ 推算出/ CP/ 执行/ 过程/ 中/ 的/ 操作/ 序列/ ,/ 利用/ 查表/ 操作/ 与/ CP/ 算法/ 执行/ 的/ 操作/ 序列/ 相关性/ ,/ 得到/ 部分/ 幂指数/ 的/ 位/ 信息/ ,/ 再/ 依据/ 查找/ 表/ Cache/ 组与/ 查表/ 索引/ 值/ 之间/ 的/ 映射/ 关系/ 以及/ 查表/ 索引/ 值/ 与/ 窗口/ 位/ 的/ 对应/ 关系/ ,/ 恢复/ 幂指数/ 的/ 窗口/ 位/ 信息/ ,/ 然后/ 运用/ 格/ 攻击/ [/ 22/ ]/ 推导/ 算法/ 恢复/ 完整/ 密钥/ ./ 4/ 踪迹/ 驱动/ Cache/ 计时/ 攻击/ 算法/ 4.1/ Cache/ 踪迹/ 计时/ 数据/ 采集/ 依据/ 建立/ 的/ 踪迹/ 驱动/ 计时/ 攻击/ 模型/ ,/ 为/ 间谍/ 进程/ SP/ 分配/ 与/ L1/ 数据/ Cache/ 大小/ 相等/ 的/ 字节/ 数组/ A/ [/ 0/ ,/ …/ ,/ S/ ×/ W/ ×/ B/ -/ 1/ ]/ ,/ 依据/ Cache/ 的/ 结构特征/ ,/ 让/ SP/ 从/ A/ 中/ 每隔/ B/ 字节/ 顺序/ 读取/ 数组/ 数据/ 元素/ 占据/ 整个/ Cache/ ,/ 初始化/ Cache/ 的/ 状态/ ,/ 为/ 采集/ CP/ 执行/ 时/ 的/ Cache/ 踪迹/ 做/ 准备/ ,/ 具体/ 数据/ 采集/ 步骤/ 如下/ :/ (/ 1/ )/ 在/ Cache/ 状态/ 初始化/ 完毕/ 后/ ,/ AP/ 通知/ CP/ 开始/ 对/ 随机/ 生成/ 的/ 密文/ 执行/ 解密/ 操作/ ;/ (/ 2/ )/ 在/ CP/ 的/ 执行/ 过程/ 中/ ,/ SP/ 与其/ 同步/ 执行/ ,/ 不断/ 访问/ 数组/ A/ 的/ 元素/ ,/ 按照/ 元素/ A/ [/ i/ ×/ S/ ×/ B/ +/ j/ ×/ B/ ]/ ,/ 0/ / i/ </ W/ ,/ 0/ / j/ </ S/ 的/ 顺序/ 进行/ 访问/ ,/ 并/ 测量/ 访问/ 每个/ Cache/ 行/ 的/ 时间/ ,/ 从而/ 获取/ 每个/ Cache/ 组中/ 所有/ Cache/ 行/ 的/ 访问/ 时间/ ,/ 循环/ 一次/ 操作/ 就/ 可/ 获取/ 一条/ 踪迹/ 计时/ 信息/ 集合/ Ttl/ ,/ 0/ / t/ </ Time/ ,/ 0/ / l/ </ S/ ,/ Time/ 为/ SP/ 循环/ 采集/ 的/ 总/ 次数/ ,/ 如果/ 发生/ 查表/ 操作/ ,/ 则/ 同时/ 获取/ 表/ 的/ 索引/ 值/ Kindex/ (/ 3/ )/ 设置/ Time/ 的/ 值/ ,/ 使得/ SP/ 在/ CP/ 执行/ 完毕/ 之后/ 才/ 停止/ 循环/ 已/ 采集/ 完整/ 的/ 踪迹/ 计时/ 信息/ 集合/ T/ ,/ 重复/ 步骤/ (/ 2/ )/ ,/ 直到/ CP/ 执行/ 完毕/ ,/ 将/ 所/ 采集/ 的/ 计时/ 信息/ 集合/ 以及/ 查表/ 索引/ 值/ 集合/ 分别/ 保存/ 为/ T/ 和/ K/ ./ 4.2/ 幂指数/ 分析/ 算法/ (/ 1/ )/ 基于/ 查找/ 表与/ 操作/ 相关性/ 的/ 指数/ 位/ 推导/ 算法/ 由/ 算法/ 1/ 的/ 执行/ 过程/ 可以/ 看出/ ,/ 只有/ 执行/ 乘法/ 运行/ 时才/ 会/ 发生/ 查表/ 操作/ ,/ 其余/ 的/ 均/ 为/ 平方/ 操作/ ./ 而且/ 滑动/ 窗口/ 算法/ 中/ 每个/ 窗口/ 值/ 都/ 是/ 奇数/ ,/ 即/ 窗口/ 最后/ 一位/ 的/ 值/ 为/ 1/ ,/ 因此/ 如果/ 发生/ 查表/ 操作/ 即可/ 推算出/ 相应/ 的/ 指数/ 位为/ 1/ ;/ 另外/ 窗口/ 每次/ 滑动/ 都/ 是/ 以/ 一定/ 窗口/ 的/ 大小/ 进行/ 滑动/ 的/ ,/ 窗口/ 的/ 首位/ 值为/ 1/ ,/ 滑动/ 时/ 是/ 以/ 指数/ 位为/ 1/ 开始/ 计算/ 窗口/ 大小/ 的/ ,/ 由于/ win/ _/ size/ =/ 5/ ,/ 因此/ 从/ 执行/ 的/ 平方/ 乘法/ 操作/ 序列/ 可以/ 发现/ ,/ 如果/ 连续/ 出现/ 5/ 次/ 以上/ 的/ 平方/ 操作/ 时/ ,/ 可/ 推算出/ 窗口/ 大小/ 开始/ 计算/ 前滑过/ 指数/ 位是/ 0/ 的/ 数目/ ./ 图/ 3/ 举例/ 给出/ 幂指数/ 位/ 与/ 操作/ 序列/ 的/ 映射/ 关系/ ./ 图/ 3/ 给出/ 执行/ 过程/ 中/ 观察/ 到/ 的/ 部分/ 操作/ 序列/ ,/ 可以/ 看出/ 起始/ 操作/ 为/ 乘法/ 操作/ ,/ 由/ 前面/ 分析/ 可以/ 判断/ 对应/ 的/ 指数/ 位为/ 1/ ,/ 以/ 窗口/ 大小/ win/ _/ size/ =/ 5/ 开始/ 从/ 左向右/ 滑动/ ,/ 除/ 第一个/ 平方/ 操作/ 外/ ,/ 共有/ 3/ 个/ 窗口/ ,/ 以/ 乘法/ 操作/ 为/ 结束/ 点/ ;/ 可以/ 判断/ 第一个/ 窗口/ 大小/ 1/ / wend1/ / 2/ ,/ 2/ 种/ 可能/ 情况/ ,/ 因此/ 推算出/ 指数/ 位/ 片段/ k1/ =/ {/ x1/ }/ ;/ 从/ k3/ 开始/ 出现/ 连续/ 5/ 个/ 以上/ 的/ 平方/ 操作/ 序列/ ,/ 第/ 3/ 个/ 窗口/ 大小/ 为/ 1/ / wend3/ / 5/ ,/ 5/ 种/ 可能/ 情况/ ,/ 推算出/ 指数/ 位/ 片段/ k3/ =/ {/ 000/ }/ ,/ k4/ =/ {/ xxxx1/ }/ ./ 如果/ wend3/ =/ 1/ ,/ k4/ =/ {/ 00001/ }/ ;/ 如果/ wend3/ =/ 2/ ,/ k4/ =/ {/ 00011/ }/ ;/ 如果/ wend3/ =/ 3/ ,/ k4/ =/ {/ 001x1/ }/ ,/ 以此类推/ ;/ 同样/ 推导/ 出/ k2/ =/ {/ xxxx1/ }/ ./ 依据/ 该/ 方法/ 大约/ 可以/ 推导/ 出/ 512/ 位/ 幂指数/ 中/ 256/ 位/ 的/ 值/ ./ (/ 2/ )/ 利用/ 窗口/ 大小/ 的/ 特征/ 缩小/ 幂指数/ 空间/ 除了/ 利用/ 操作/ 序列/ 进行/ 指数/ 位/ 片段/ 的/ 推导/ 外/ ,/ 还/ 可以/ 利用/ 窗口/ 大小/ 的/ 特征/ 缩小/ 幂指数/ 空间/ ./ 从/ 算法/ 1/ 可知/ ,/ 窗口/ 是/ 以/ win/ _/ size/ =/ 5/ 进行/ 滑动/ 的/ ,/ 以/ 指数/ 位为/ 1/ 结束/ ,/ 当/ 滑动/ 的/ 窗口/ 小于/ 5/ 时/ ,/ 可以/ 判断/ 窗口/ Page8/ 之后/ 存在/ 与/ win/ _/ size/ 的/ 差值/ 数目/ 相等/ 的/ 幂指数/ 位为/ 0/ ./ 以图/ 3/ 为例/ ,/ 由于/ k1/ =/ {/ x1/ }/ ,/ 1/ / wend1/ / 2/ ./ 当/ wend1/ =/ 1/ 时/ ,/ k1/ =/ {/ 01/ }/ ,/ 则/ 可/ 推算出/ k2/ =/ {/ 00001/ }/ ;/ 当/ wend1/ =/ 2/ 时/ ,/ k1/ =/ {/ 11/ }/ ,/ 则/ 可/ 推算出/ k2/ =/ {/ 000x1/ }/ ./ 利用/ 这一/ 特征/ 关系/ 可以/ 进一步/ 缩小/ 密钥/ 的/ 搜索/ 空间/ ,/ 并/ 有利于/ 定位/ 索引/ 值/ 与/ Cache/ 组/ 的/ 对应/ 关系/ ./ (/ 3/ )/ 依据/ 查找/ 表/ 索引/ 值/ 与/ 窗口/ 位/ 对应/ 关系/ 的/ 幂指数/ 窗口/ 位/ 推导/ 算法/ 从/ 算法/ 1/ 发现/ ,/ 查找/ 预计/ 算表/ 的/ 索引/ 值/ Kt/ 等于/ wvalue/ / 1/ ,/ 而且/ 由于/ wvalue/ 为/ 奇数/ ,/ 即/ wvalue/ =/ 2/ ×/ Kt/ +/ 1/ ,/ 因此/ 如果/ 知道/ 表/ 的/ 索引/ 值/ 就/ 可以/ 计算/ 出/ 对应/ 的/ 窗口/ 值/ wvalue/ ./ 攻击/ 过程/ 中是/ 利用/ 预计/ 算表/ 与/ Cache/ 组/ 的/ 映射/ 关系/ ,/ 通过/ 间谍/ 进程/ 监视/ Cache/ 组/ 的/ 访问/ 状态/ 判断/ 出/ 是否/ 发生/ 查表/ 操作/ ,/ 对表中/ 的/ 哪些/ 元素/ 进行/ 访问/ ,/ 从而/ 获取/ 索引/ 值/ ,/ 推算出/ 窗口/ 位/ ,/ 理论/ 上/ 能够/ 恢复/ 完整/ 的/ 幂指数/ 位/ ./ 本文/ 针对/ 的/ 窗口/ 大小/ 为/ 5/ ,/ 预计/ 算表/ 的/ 大小/ 为/ 16/ 个/ 元素/ ,/ 据/ OpenSSL/ 提供/ 的/ BIGNUM/ 类型/ 分析/ 可知/ ,/ 每个/ 元素/ 的/ 大小/ 为/ 20/ 个/ 字节/ ,/ 共/ 320/ 个/ 字节/ ,/ 而/ Cache/ 行/ 大小/ 为/ 64/ 字节/ ,/ 因此/ 16/ 个/ 预计/ 算表/ 元素/ 对应/ 5/ ~/ 6/ 个/ 连续/ Cache/ 组/ 区域/ ,/ 即/ 多个/ 表/ 元素/ 会/ 被/ 映射/ 到/ 同图/ 4/ 采集/ 的/ Cache/ 计时/ 数据/ 的/ 伪/ 彩色/ 图/ 表示/ 结果/ 图/ 4/ 中用/ 颜色/ 的/ 深浅/ 表示/ 访问/ 每个/ Cache/ 组/ 的/ 时钟/ 周期/ 数/ ,/ 颜色/ 越深/ 表示/ 所/ 消耗/ 的/ 时间/ 越短/ ./ 横坐标/ X/ 表示/ 循环/ 的/ 序列/ ,/ 对应/ 于/ 采集/ 的/ 时间/ 顺序/ ,/ 纵坐标/ Y/ 表示/ 32/ 个/ Cache/ 组/ 对应/ 的/ 计时/ 数据/ ./ 从图/ 中/ 可以/ 明显/ 判断/ CP/ 是从/ X/ =/ 25/ 时/ 开始/ 执行/ 解密/ 操作/ 的/ ,/ 因为/ 此时/ 只/ 执行/ SP/ 进程/ ,/ 基本上/ 访问/ 所有/ 的/ Cache/ 组都/ 发生/ Cache/ 命中/ ,/ 除了/ 部分/ 受/ 系统/ 进程/ 干扰/ 外/ ./ 从/ X/ =/ 80/ 时/ 开始/ 出现/ 有/ 规律/ 的/ Cache/ 访问/ 踪迹/ ,/ 可以/ 判断/ CP/ 此时/ 开始/ 执行/ 滑动/ 窗口/ 计算/ ;/ 利用/ 同样/ 的/ 方法/ 可以/ 判断/ CP/ 执行/ 滑动/ 窗口/ 计算/ 的/ 结束/ 位置/ 以及/ 整个/ 模幂/ 运算/ 执行/ 完毕/ 的/ 位置/ ,/ 从而/ 筛选/ 出/ 对应/ 于/ 滑动/ 窗口/ 算法/ 执行/ 过程/ 的/ 计时/ 信息/ 集/ 一个/ Cache/ 组/ ,/ 因此/ 实际/ 攻击/ 时/ 无法/ 精确定位/ 索引/ 值/ ,/ 而是/ 通过/ 定位/ Cache/ 组/ 缩小/ 索引/ 值/ 的/ 搜索/ 空间/ ./ 5/ 攻击/ 难点/ 分析/ 及/ 解决方案/ 5.1/ 计时/ 信息/ 筛选/ 由于/ SP/ 采集/ 的/ 信息/ 包括/ CP/ 运行/ 前后/ 的/ Cache/ 访问/ 状态/ ,/ 而且/ 在/ CP/ 运行/ 过程/ 中/ ,/ 也/ 并非/ 一/ 开始/ 就/ 执行/ 滑动/ 窗口/ 算法/ 操作/ ,/ 其中/ 还/ 包括/ 蒙哥马利/ 乘法/ 运行/ 时/ 需要/ 将/ 参与/ 运行/ 的/ 数/ 进行/ 蒙哥马利/ 形式/ 变换/ ,/ 临时/ 变量/ 的/ 初始化/ 与/ 释放/ 等/ 其它/ 运算/ 操作/ ,/ 因此/ 首先/ 需要/ 对/ 采集/ 的/ 数据/ 进行/ 筛选/ ,/ 尽可能/ 剔除/ 与/ 滑动/ 窗口/ 算法/ 操作/ 无关/ 的/ Cache/ 访问/ 状态/ 对应/ 的/ 计时/ 信息/ ./ 为了/ 保证/ SP/ 是/ 在/ CP/ 执行/ 前/ 启动/ ,/ 在/ CP/ 执行/ 完毕/ 后/ 终止/ ,/ 当/ AP/ 启动/ CP/ 时/ ,/ 先/ 调用/ 高精度/ 休眠/ 函数/ nanosleep/ ,/ 将/ 休眠/ 时间/ 精确/ 到/ 毫微秒/ 级/ 的/ ,/ 实验/ 中/ 设置/ 的/ timespec/ 的/ 参数/ 为/ {/ 0/ ,/ 0x28000/ }/ ,/ SP/ 循环/ 采集/ 的/ 次数/ 为/ 4000/ 次/ ,/ 采集/ 的/ 部分/ 结果/ 以伪/ 彩色/ 图/ 表示/ 如图/ 4/ 所示/ ./ 合/ Ts/ ./ 5.2/ 预计/ 算表/ 对应/ Cache/ 组/ 的/ 定位/ 本文/ 针对/ OpenSSL/ 密码/ 库/ 的/ RSA/ 算法/ 执行/ 攻击/ ,/ win/ _/ size/ =/ 5/ 时/ ,/ 预计/ 算表/ 的/ 大小/ 为/ 16/ 个/ 元素/ ,/ 每个/ BIGNUM/ 变量/ 的/ 大小/ 为/ 20/ 个/ 字节/ ③/ ,/ 在/ Cache/ 行/ 大小/ 为/ 64/ 字节/ 的/ Cache/ 中/ ,/ 整个/ 320/ 字节/ 大小/ 的/ 预计/ 算表/ 对应/ 于/ 5/ ~/ 6/ 个/ 连续/ Cache/ 组/ 区域/ ./ 对/ 前面/ 筛选/ 的/ Ts/ 中/ 的/ 每/ 一个/ Cache/ 组/ 访问/ 时间/ 取/ 平均值/ ,/ 结果/ 如图/ 5/ 所示/ ,/ 从图/ 中/ 可以/ 看出/ 6/ 个/ 连续/ 出现/ 的/ 较/ 小值/ (/ 图中/ 标注/ 映射/ Cache/ 组/ 范围/ 的/ 区域/ )/ 刚好/ 对应/ 于图/ 4/ 中/ 的/ 第/ 11/ ~/ 16/ 行/ ,/ 因此/ 可以/ 判断/ 出/ 预计/ 算表/ 对应/ Cache/ 组/ 的/ 起始/ 位置/ ./ Page9/ 图/ 5Ts/ 中/ 32/ 个/ Cache/ 组/ 对应/ 的/ 平均/ 访问/ 时钟/ 周期/ 分布/ 情况/ 由于/ 320/ 字节/ 大小/ 的/ 预计/ 算表/ 刚好/ 等于/ 5/ 个/ Cache/ 行/ 的/ 大小/ ,/ 因此/ 只有/ 当/ 第一个/ 表/ 元素/ 的/ 起始/ 位置/ 对应/ 于/ Cache/ 行/ 的/ 偏移/ 地址/ 为/ 0/ 时/ ,/ 预计/ 算表/ 对应/ 的/ Cache/ 组/ 数目/ 才/ 为/ 5/ ,/ 否则/ 都/ 为/ 6.5/ ./ 3/ 预计/ 算表/ 索引/ 值/ 与/ Cache/ 组/ 的/ 映射/ 当/ 依据/ 查找/ 表/ 索引/ 值/ 与/ 窗口/ 位/ 对应/ 关系/ 推导/ 出/ 幂指数/ 窗口/ 位时/ ,/ 需要/ 知道/ 预计/ 算表/ 索引/ 值/ 与/ Cache/ 组/ 的/ 映射/ 关系/ ./ 由于/ 预计/ 算表/ 的/ 16/ 个/ 元素/ 映射/ 到/ 5/ ~/ 6/ 个/ Cache/ 组/ 区域/ ,/ 而且/ 表/ 元素/ 在/ Cache/ 中/ 存储/ 是/ 连续/ 的/ ,/ 从图/ 1/ 虚拟存储器/ 地址/ 的/ 逻辑/ 结构/ 可以/ 看出/ ,/ 当块/ 偏移/ 地址/ 为/ 0/ 时/ ,/ 第/ 1/ 个表/ 元素/ 对应/ Cache/ 行/ 的/ 起始/ 位置/ ,/ 此时/ 预计/ 算表/ 刚好/ 映射/ 到/ 5/ 个/ Cache/ 组/ 区域/ ,/ 可以/ 很快/ 从/ 定位/ 的/ 5/ 个/ Cache/ 组中/ 推算出/ 第/ 1/ 个/ Cache/ 组/ 映射/ 的/ 索引/ 值为/ {/ 1/ ,/ 3/ ,/ 5/ ,/ 7/ }/ ,/ 第/ 2/ 个/ Cache/ 组/ 映射/ 的/ 索引/ 值为/ {/ 7/ ,/ 9/ ,/ 11/ ,/ 13/ }/ ,/ 依次/ 类推/ ./ 而/ 实际/ 情况/ 下/ 往往/ 不是/ 这样/ 的/ ,/ 从/ 实验/ 结果/ 可知/ ,/ 预计/ 算表/ 往往/ 占据/ 6/ 个/ Cache/ 组/ 区域/ ,/ 第/ 1/ 个/ 或/ 最后/ 一个/ Cache/ 组/ 可能/ 映射/ 1/ ~/ 3/ 个表/ 元素/ 索引/ 值/ ,/ 其余/ 均/ 映射/ 4/ 个表/ 元素/ 索引/ 值/ ./ 从/ OpenSSL/ 密码/ 库/ 可知/ 预计/ 算表/ 元素/ 的/ 类型/ 为/ BIGNUM/ ,/ 该/ 类型/ 为/ 结构/ 体/ ,/ 共/ 包含/ 5/ 个/ 结构/ 体/ 元素/ ③/ ,/ 且/ 每个/ 结构/ 体/ 元素/ 的/ 大小/ 均/ 为/ 4/ 个/ 字节/ ./ 由于/ 元素/ 在/ Cache/ 中/ 的/ 存储/ 是/ 连续/ 的/ ,/ 因此/ 对于/ 64/ 字节/ 的/ Cache/ 行/ 大小/ ,/ 可以/ 推算出/ 第一个/ 表/ 元素/ 在/ 对应/ Cache/ 组中/ 的/ Cache/ 行/ 起始/ 位置/ 有/ 16/ 种/ 可能/ 情况/ ,/ 攻击/ 时/ 需要/ 对/ 每种/ 可能性/ 进行/ 分析/ ./ 实际上/ 可以/ 依据/ 4.2/ 节中/ 基于/ 窗口/ 大小/ 特征/ 的/ 幂指数/ 空间/ 缩小/ 算法/ ,/ 通过/ 判断/ 相邻/ 索引/ 值/ 的/ Cache/ 组/ 映射/ 情况/ ,/ 结合/ 算法/ 的/ 操作/ 序列/ ,/ 能够/ 进一步/ 缩小/ 这/ 16/ 种/ 可能/ 的/ 情况/ ./ 例如/ 推算出/ 相邻/ 的/ 两个/ 表/ 索引/ 值/ 1/ 与/ 3/ 分别/ 映射/ 到/ 相邻/ 的/ 两个/ Cache/ 组/ 区域/ ,/ 则/ 可以/ 将/ Cache/ 行/ 起始/ 位置/ 的/ 情况/ 缩小/ 为/ 4/ 种/ 情况/ ,/ 再/ 分别/ 对/ 每种/ 情况/ 分析判断/ 后面/ 索引/ 值/ 对应/ 的/ Cache/ 组/ 是否/ 正确/ ,/ 经过/ 多次/ 分析/ 能够/ 确定/ 或/ 进一步/ 缩小/ Cache/ 行/ 的/ 起始/ 位置/ ,/ 从而/ 能够/ 利用/ 索引/ 值/ 推导/ 出/ 对应/ 窗口/ 位/ 的/ 可能/ 值/ ./ 6/ 实验/ 结果/ 及/ 分析/ 6.1/ 实验/ 配置/ 与/ 攻击/ 步骤/ Cache/ 攻击/ 可以/ 在/ 同步/ 多线程/ (/ SMT/ )/ 处理器/ 上/ 执行/ ,/ 也/ 可以/ 在/ 普通/ 单线程/ 处理器/ 上/ 执行/ ./ 但是/ 在/ SMT/ 处理器/ 上/ ,/ 比较/ 容易/ 实现/ 间谍/ 进程/ 与/ 密码/ 进程/ 在/ 同一个/ 物理/ 核中/ 的/ 两个/ 虚拟/ 核上/ 同步/ 执行/ [/ 19/ ]/ ,/ 并/ 监视/ 密码/ 进程/ 的/ 执行/ 过程/ ./ 而/ 在/ 单线程/ 处理器/ 上/ 实现/ 攻击/ 则/ 较为/ 困难/ ,/ 攻击者/ 需要/ 利用/ 间谍/ 进程/ 与/ 密码/ 进程/ 之间/ 的/ “/ Ping/ -/ Pong/ ”/ 效应/ 切换/ 两个/ 进程/ 的/ 执行/ 进度/ ,/ 通过/ 操作系统/ 的/ 调度/ 机制/ ,/ 恶意/ 垄断/ CPU/ 周期/ [/ 20/ ]/ ./ 本文/ 为了/ 便于/ 研究/ ,/ 在/ 具有/ SMT/ 能力/ 的/ Pentium4/ 处理器/ 上/ 执行/ 攻击/ 实验/ ,/ 具体/ 实验/ 环境/ 配置/ 如表/ 1/ 所示/ ./ 表/ 1/ 针对/ RSA/ 算法/ 的/ Cache/ 攻击/ 实验/ 环境/ 配置/ 配置/ 项/ 操作系统/ 超线程/ 是否/ 开启/ OpenSSLCPU/ 内存/ L1CacheCachesize/ :/ 16KBassociativesize/ :/ 8wayL2CacheCachesize/ :/ 2048KBassociativesize/ :/ 8way/ 在/ Linux/ 操作系统/ 中/ ,/ 攻击/ 进程/ AP/ 启动/ 间谍/ 进程/ SP/ ,/ 同时/ 利用/ fork/ 函数/ 创建/ 一个/ 带有/ 独立/ 虚拟地址/ 空间/ 的/ 新/ 进程/ ,/ 执行/ 解密/ 操作/ ,/ 当/ fork/ 在/ 新/ 进程/ 中/ 返回/ 时/ ,/ 新/ 进程/ 现在/ 的/ 虚拟存储器/ 刚好/ 和/ 调用/ fork/ 时/ 存在/ 的/ 虚拟存储器/ 相同/ ,/ 使得/ 间谍/ 进程/ 与/ 密码/ 进程/ 共享/ 同一/ 数据/ Cache/ ./ 为了/ 保证/ SP/ 能够/ 在/ CP/ 执行/ 前/ 启动/ ,/ 而/ 在/ CP/ 执行/ 完毕/ 后/ 终止/ ,/ 当/ AP/ 调用/ fork/ 函数/ 启动/ CP/ 进程/ 时/ ,/ 先/ 调用/ 高精度/ 休眠/ 函数/ nanosleep/ ,/ 将/ 休眠/ 时间/ 精确/ 到/ 毫微秒/ 级/ ,/ 实验/ 中/ 设置/ timespec/ 的/ 参数/ 为/ {/ 0/ ,/ 0x28000/ }/ ,/ 同时/ 依据/ CP/ 的/ 执行/ 时间/ 长短/ 以及/ SP/ 单次/ 采集/ 数据/ 所/ 需/ 的/ 时间/ 长短/ ,/ 设置/ SP/ 循环/ 采集/ 的/ 次数/ 为/ 4000/ 次/ ./ 实验/ 过程/ 中/ ,/ 为了/ 提高/ 采集/ 数据/ 的/ 精度/ ,/ 最小化/ 其它/ 系统/ 进程/ ./ Page106/ ./ 2/ 踪迹/ 信息/ 采集/ 依据/ L1Cache/ 结构/ ,/ SP/ 的/ 构造/ 大小/ 为/ 16KB/ 的/ 字节/ 数组/ A/ [/ 16384/ ]/ ,/ 以/ 64/ 为/ 步长/ ,/ 逐次/ 访问/ A/ [/ index/ ]/ 、/ A/ [/ index/ +/ 0x800/ ]/ 、/ A/ [/ index/ +/ 0x1000/ ]/ 、/ A/ [/ index/ +/ 0x1800/ ]/ 、/ A/ [/ index/ +/ 0x2000/ ]/ 、/ A/ [/ index/ +/ 0x2800/ ]/ 、/ A/ [/ index/ +/ 0x3000/ ]/ 、/ A/ [/ index/ +/ 0x3800/ ]/ ,/ 其中/ index/ =/ j/ ×/ 64/ ,/ 0/ / j/ </ 32/ ,/ 并/ 通过/ 调用/ CPU/ 的/ 时间/ 戳/ 指令/ RDSTC/ ,/ 测量/ 访问/ 每个/ Cache/ 组中/ 所有/ Cache/ 行/ 的/ 时钟/ 周期/ 数/ ti/ ,/ 从而/ 获取/ 一条/ 计时/ 踪迹/ 图/ 6/ 部分/ Cache/ 计时/ 数据/ 的/ 伪/ 彩色/ 图/ 表示/ 结果/ 6.3/ 幂指数/ 分析/ 针对/ 图/ 6/ 结果/ ,/ 利用/ 前面/ 的/ 分析方法/ ,/ 可以/ 推导/ 出/ 算法/ 执行/ 的/ 平方/ 乘法/ 操作/ 序列/ ./ 图中圈/ 出/ 了/ 乘法/ 操作/ 发生/ 的/ 序列/ ,/ 其余/ 为/ 平方/ 操作/ ,/ 因此/ 对应/ 的/ 操作/ 序列/ 为/ “/ MSSSSMSMSSSSMSSSMSSM/ ”/ ,/ 其中/ S/ 表示/ 平方/ 操作/ ,/ M/ 表示/ 乘法/ 操作/ ,/ 依据/ 算法/ 1/ 可知/ 第一个/ 操作/ 为/ 乘法/ 操作/ ./ 对/ 筛选/ 过/ 的/ Cache/ 计时/ 数据/ Ts/ ,/ 利用/ 4.2/ 节/ 的/ 密钥/ 分析/ 算法/ ,/ 对/ 幂指数/ 位/ 的/ 值/ 展开/ 分析/ ./ 在/ 一次/ 实验/ 中/ ,/ OpenSSL/ 密码/ 库/ 随机/ 生成/ 的/ 1024/ 位/ RSA/ 密钥/ ,/ 对于/ 第一个/ 512/ 位/ 幂指数/ dp/ ,/ 共/ 执行/ 88/ 次/ 乘法/ 操作/ ,/ 511/ 次/ 平方/ 操作/ ,/ 出现/ 69/ 次/ 5/ 个/ 连续/ 的/ 平方/ 操作/ ,/ 利用/ 操作/ 序列/ 与/ 幂指数/ 相关性/ 可/ 推算出/ dp/ 中/ 89/ 个值/ 为/ 1/ 的/ 比特/ 位/ (/ 包含/ 第一位/ 的/ 值/ 为/ 1/ )/ ,/ 121/ 个值/ 为/ 0/ 的/ 比特/ 位/ ,/ 并/ 通过/ 平方/ 操作/ 数目/ 可知/ 第/ 1/ 个/ 窗口/ 值为/ 1/ ;/ 利用/ 窗口/ 大小/ 特征/ 可/ 推导/ 出/ 剩余/ 的/ 302/ 个/ 幂指数/ 位中/ 15/ 个值/ 为/ 0/ 的/ 比特/ 位/ ;/ 最后/ 利用/ 索引/ 值/ 的/ 映射/ 关系/ 缩小/ 窗口/ 位/ 的/ 搜索/ 空间/ 大约/ 能够/ 获取/ 115/ 位/ 左右/ 的/ 幂指数/ 位/ ,/ 最终/ 大约/ 获取/ 340/ 位/ 的/ 值/ ./ 利用/ 相同/ 的/ 方法/ 可以/ 获取/ 第/ 2/ 个/ 幂指数/ dq/ 的/ 大约/ 340/ 位/ 的/ 信息/ ./ 6.4/ 密钥/ 推导/ 理论/ 上/ 利用/ 前面/ 3/ 种/ 幂指数/ 分析/ 算法/ 可/ 完整/ 推算出/ 幂指数/ 的/ 值/ ,/ 但/ 实际/ 攻击/ 中/ 一方面/ 由于/ 临时/ 变/ Ti/ =/ {/ t0i/ ,/ t1i/ ,/ …/ ,/ t31i/ }/ ./ 从/ 采集/ 的/ 实验/ 结果/ 可知/ :/ 平方/ 操作/ 没有/ 执行/ 查表/ 操作/ 时/ 对应/ 的/ 时钟/ 周期/ 数为/ 165/ ~/ 220/ ;/ 乘法/ 操作/ 发生/ 查表/ 时/ 对应/ 的/ 时钟/ 周期/ 数为/ 280/ ~/ 330/ ./ 采集/ 的/ Cache/ 计时/ 结果/ 以伪/ 彩色/ 图/ 表示/ 为/ 如图/ 4/ ,/ 利用/ 前面/ 的/ 分析/ 算法/ 对/ 采集/ 的/ 数据/ 进行/ 筛选/ ,/ 同时/ 定位/ Cache/ 组/ 的/ 范围/ 以及/ 预计/ 算表/ 索引/ 值/ 对应/ Cache/ 行/ 的/ 起始/ 位置/ ./ 下面/ 对/ 其中/ 的/ 部分/ 结果/ 进行/ 分析/ ,/ 如图/ 6/ 所示/ ./ 量/ 也/ 可能/ 映射/ 到/ 预计/ 算表所/ 映射/ 的/ Cache/ 组中/ ,/ 导致/ SP/ 无法/ 采集/ 有效/ 的/ 信息/ ;/ 另一方面/ 由于/ 同一个/ Cache/ 组/ 映射/ 于/ 多个/ 表/ 索引/ 值/ ,/ 同一个/ 表/ 索引/ 值/ 可能/ 对应/ 于/ 两个/ 相邻/ 的/ Cache/ 组/ ,/ 因此/ 攻击者/ 只能/ 获取/ dp/ 和/ dq/ 的/ 部分/ 信息/ ,/ 还/ 需要/ 利用/ 获取/ 的/ 信息/ 推导/ 出/ 私钥/ d/ 的/ 值/ ./ 尽管/ 文献/ [/ 21/ ]/ 已经/ 表明/ 在/ 获得/ 其中/ 一个/ 因子/ 一半/ 的/ 位数/ 时/ ,/ 就/ 足以/ 在/ 多项式/ 时间/ 内/ 采用/ 格基约化/ [/ 22/ ]/ 的/ 方法/ 分解/ 模数/ N/ ,/ 但是/ 这一/ 方法/ 的/ 前提/ 是/ 获得/ 的/ 密钥/ 位/ 必须/ 是/ 连续/ 的/ ,/ 使得/ 该/ 方法/ 不/ 适合/ 本文/ 的/ 攻击/ ./ 因此/ 必须/ 找到/ 一种/ 新/ 的/ 方法/ 能够/ 利用/ 我们/ 所/ 获取/ 的/ 信息/ 因式分解/ 模数/ N/ ./ 给定/ 模数/ N/ 和/ 公钥/ e/ ,/ 假设/ 我们/ 已经/ 获取/ CRT/ 算法/ 中/ 通过/ 模/ p/ 和/ q/ 所/ 获取/ 的/ 幂指数/ dp/ 和/ dq/ 的/ 部分/ 信息/ ,/ 那么/ 从/ RSA/ 的/ 结构/ 我们/ 可以/ 得到/ edp/ ≡/ 1/ (/ modp/ -/ 1/ )/ 和/ edq/ ≡/ 1/ (/ modq/ -/ 1/ )/ ./ 那么/ 设/ kp/ ,/ kq/ ∈/ Z/ / e/ 可得/ edp/ ≡/ kp/ (/ p/ -/ 1/ )/ +/ 1/ 和/ edq/ ≡/ kq/ (/ q/ -/ 1/ )/ +/ 1/ ./ 利用/ 上面/ 等式/ 经过/ 简单/ 的/ 代数/ 计算/ 可/ 得/ 等式/ :/ Nkpkq/ =/ (/ pkp/ )/ ./ (/ qkq/ )/ =/ (/ edp/ +/ kp/ -/ 1/ )/ ./ (/ edq/ +/ kq/ -/ 1/ )/ 接下来/ 构造/ 一个/ 满足/ 等式/ (/ 1/ )/ mode/ ./ 2n/ 的/ 4/ 维/ 数组/ (/ kp/ ,/ kq/ ,/ dp/ ,/ dq/ )/ 集合/ Sn/ ,/ n/ 表示/ dp/ 和/ dq/ 的/ 位/ 长度/ ,/ 并且/ 与/ 所/ 获取/ 的/ dp/ 和/ dq/ 的/ 部分/ 观察/ 值/ 匹配/ ,/ 其/ Page11/ 中/ 0/ / dp/ ,/ dq/ </ 2n/ ./ 其中/ 集合/ S0/ =/ (/ kp/ ,/ kq/ ,/ 0/ ,/ 0/ )/ ,/ 则/ 有/ Nkpkqmode/ =/ (/ kp/ -/ 1/ )/ ./ (/ kq/ -/ 1/ )/ mode/ ,/ 那么/ kq/ 由/ N/ 和/ kp/ 的/ 值/ 唯一/ 确定/ ,/ 且/ |/ S0/ |/ </ e/ ./ 此外/ ,/ 如果/ 我们/ 获得/ 集合/ Sn/ ,/ 由于/ dp/ 的/ 第/ nth/ 位/ 可能/ 为/ 0/ 或者/ 1/ ,/ 那么/ 可以/ 通过/ 遍历/ Sn/ 中/ 的/ dp/ 第/ nth/ 位值/ 的/ 两种/ 情况/ ,/ 组成/ 2/ 个/ 4/ 元组/ 计算/ 得到/ Sn/ +/ 1/ ,/ 再/ 通过/ 等式/ (/ 1/ )/ 判断/ dq/ 第/ nth/ 位/ 的/ 值/ ,/ 并且/ 抛弃/ 其它/ 任何/ 不/ 满足/ 该/ 等式/ 的/ 4/ 元组/ 候选/ 值/ ./ 如果/ 我们/ 都/ 无法/ 确定/ 指数/ dp/ 和/ dq/ 第/ nth/ 位/ 的/ 值/ ,/ 则/ 有/ |/ Sn/ +/ 1/ |/ =/ 2/ |/ Sn/ |/ ,/ 其中/ |/ Sn/ |/ 表示/ 集合/ Sn/ 的/ 大小/ ;/ 如果/ 我们/ 知道/ 其中/ 一个/ 指数/ 第/ nth/ 位/ 的/ 值/ ,/ 那么/ Sn/ 中/ 每个/ 4/ 元组/ 与/ Sn/ +/ 1/ 有/ 唯一/ 匹配/ 的/ 4/ 元组/ ,/ 则/ 有/ |/ Sn/ +/ 1/ |/ =/ |/ Sn/ |/ ;/ 如果/ 两个/ 指数/ 第/ nth/ 位/ 的/ 值/ 都/ 知道/ 的话/ ,/ 那么/ Sn/ +/ 1/ 的/ 大小/ 约/ 为/ Sn/ 的/ 一半/ ./ Sn/ ≈/ e/ ×/ (/ 1/ // 2/ )/ k/ ×/ 2l/ ,/ 其中/ k/ 表示/ dp/ 和/ dq/ 第/ nth/ 位值/ 都/ 已知/ 的/ 数目/ ,/ l/ 表示/ dp/ 和/ dq/ 第/ nth/ 位值/ 都/ 未知/ 的/ 数目/ ./ 由于/ 获取/ 的/ dp/ 和/ dq/ 的/ 部分/ 信息/ 是/ 随机/ 分布/ 的/ ,/ 因此/ Sn/ 的/ 大小/ 随着/ n/ 的/ 逐渐/ 增大/ ,/ 会以/ e/ 为/ 起始/ 点/ 呈/ 随机/ 分布/ 趋势/ ,/ 但/ 由于/ 已经/ 获取/ 的/ 幂指数/ 位/ 数目/ 比/ 未知/ 幂指数/ 位/ 数目/ 多/ ,/ 因此/ Sn/ 的/ 大小/ 随着/ n/ 的/ 增大/ 会/ 呈/ 整体/ 下降/ 趋势/ ./ 当/ 已知/ 位/ 的/ 数目/ 多于/ 一半/ 时/ ,/ 最终/ S512/ 的/ 大小/ 小于/ e/ ./ 那么/ 一旦/ 获取/ S512/ 就/ 可以/ 简单/ 地/ 测试/ 剩余/ 的/ 候选/ 指数/ 位/ ,/ 因式分解/ 模数/ N/ 从而/ 恢复/ 出/ 密钥/ d/ 的/ 值/ ./ 利用/ 6.3/ 节/ 获取/ 的/ dp/ 和/ dq/ 的/ 部分/ 信息/ 进行/ 分析/ ,/ 其中/ e/ =/ 65537/ ,/ 集合/ Sn/ 的/ 大小/ 与/ n/ 的/ 关系/ 如图/ 7/ 所示/ ,/ 总共/ 需要/ 遍历/ 的/ 集合/ 数目/ 大约/ 为/ 3.97/ ×/ 106/ 个/ 即可/ 获得/ 私钥/ d/ 的/ 值/ ./ 获取/ dp/ 和/ dq/ 的/ 部分/ 信息/ 分布/ 不同/ ,/ Sn/ 的/ 大小/ 也/ 随之/ 更改/ ./ 总体/ 上/ ,/ 获取/ 的/ 信息/ 越/ 丰富/ ,/ 恢复/ 私钥/ d/ 的/ 复杂度/ 越小/ ./ 6.5/ 结果/ 对比/ 分析/ 与/ 讨论/ 目前/ 国外/ 在/ 踪迹/ 驱动/ 数据/ Cache/ 计时/ 攻击/ 研究/ 中/ ,/ 主要/ 针对/ 分组/ 密码/ 算法/ 展开/ ,/ 而/ 针对/ RSA/ 算法/ 的/ 研究/ 相对/ 较/ 少/ ,/ 只有/ Percival/ 利用/ 多线程/ 间/ 共享/ Cache/ 资源/ 的/ 特点/ ,/ 提出/ 了/ 一种/ 针对/ RSA/ 算法/ 的/ Cache/ 计时/ 攻击/ 思想/ [/ 4/ ]/ ,/ 并/ 进行/ 实验/ 验证/ ;/ 国内/ 在/ 该/ 领域/ 的/ 研究/ 还仅/ 处于/ 理论/ 研究/ 阶段/ ,/ 并/ 没有/ 进行/ 实验/ 验证/ ./ 本文/ 与/ 分组/ 密码/ 算法/ 的/ Cache/ 攻击/ ①/ [/ 3/ ]/ 、/ 针对/ RSA/ 算法/ 的/ 指令/ Cache/ 攻击/ [/ 5/ -/ 6/ ]/ 以及/ 功耗/ 踪迹/ 分析/ [/ 10/ ]/ 因/ 分析/ 对象/ 、/ 方法/ 不同/ 而/ 不/ 具有/ 太大/ 的/ 可比性/ ,/ 因此/ 只/ 与/ 文献/ [/ 4/ ]/ 做/ 如下/ 比较/ :/ (/ 1/ )/ 原有/ 的/ 攻击/ 算法/ 针对/ OpenSSLv0/ ./ 9.7/ c/ 的/ RSA/ 执行/ 攻击/ 实验/ ,/ 实验/ 中/ 在/ 平方/ 操作/ 中/ 手工/ 加入/ 时延/ ,/ 以/ 控制/ 间谍/ 进程/ 与/ 密码/ 进程/ 的/ 执行/ 时机/ ,/ 从/ 某种意义/ 上/ 来说/ 还/ 只是/ 处于/ 仿真/ 实验/ 阶段/ ,/ 并/ 没有/ 应用/ 于/ 实际/ 的/ 攻击/ ;/ 本文/ 在/ SMT/ 处理器/ 上/ ,/ 针对/ 版本/ 较/ 新/ 的/ OpenSSLv0/ ./ 9.8/ b/ 中/ 的/ RSA/ 算法/ 执行/ 攻击/ 实验/ ,/ 真正/ 意义/ 上/ 实现/ 了/ 间谍/ 进程/ 与/ 密码/ 进程/ 的/ 同步/ 执行/ ,/ 而且/ 还/ 给出/ 了/ 实际/ 攻击/ 中/ 密码/ 进程/ 执行/ 踪迹/ 起始/ 点/ 以及/ 滑动/ 窗口/ 算法/ 执行/ 起始/ 点/ 和/ 结束/ 点/ 的/ 判断/ 方法/ ,/ 对/ 预计/ 算表/ 映射/ 的/ Cache/ 组/ 进行/ 定位/ ,/ 确定/ 了/ 表/ 索引/ 值/ 与/ Cache/ 组/ 的/ 映射/ 关系/ ,/ 筛选/ 出/ 有用/ 的/ Cache/ 计时/ 踪迹/ ,/ 执行/ 真实/ 环境/ 下/ 的/ 攻击/ ./ (/ 2/ )/ 原有/ 的/ 分析/ 算法/ 大约/ 能够/ 获取/ 512/ 位/ 幂指数/ 中/ 的/ 310/ 位/ ;/ 本文/ 在/ 原有/ 分析/ 算法/ 的/ 基础/ 上/ 提出/ 了/ 一种/ 新/ 的/ 幂指数/ 分析/ 算法/ ,/ 利用/ 窗口/ 大小/ 特征/ 和/ 索引/ 值/ 与/ Cache/ 组/ 的/ 映射/ 关系/ ,/ 大约/ 能够/ 获取/ 512/ 位/ 幂指数/ 中/ 的/ 340/ 位/ ,/ 进一步/ 减小/ 了/ 密钥/ 分析/ 的/ 复杂度/ ./ (/ 3/ )/ 原有/ 攻击/ 算法/ 在/ 获取/ 部分/ 的/ 幂指数/ 位/ 信息/ 后/ ,/ 只/ 指出/ 能够/ 用格/ 攻击/ 的/ 思想/ 恢复/ 完整/ 的/ 私钥/ ,/ 并/ 没有/ 给出/ 具体/ 的/ 推导/ 算法/ ;/ 本文/ 分析/ 并/ 参考/ 了/ 利用/ dp/ 和/ dq/ 部分/ 连续/ 幂指数/ 位/ 恢复/ 私钥/ d/ 的/ 推导/ 算法/ ,/ 给出/ 由/ 部分/ 离散/ 幂指数/ 位/ 恢复/ 完整/ 私钥/ d/ 的/ 格/ 攻击/ 过程/ ,/ 并/ 结合/ 实验/ 结果/ 进行/ 复杂度/ 分析/ ./ 通过/ 前面/ 的/ 分析/ ,/ 我们/ 运用/ 踪迹/ 驱动/ 数据/ Cache/ 攻击/ 模型/ 以及/ 算法/ ,/ 实现/ 了/ 对/ OpenSSL/ 密码/ 库中/ RSA/ 算法/ 的/ Cache/ 计时/ 攻击/ ./ 攻击/ 算法/ 在/ 理论/ 上/ ,/ 只/ 需要/ 采集/ 一次/ 密码/ 算法/ 执行/ 的/ Cache/ 计时/ 踪迹/ ,/ 就/ 能够/ 恢复/ 出/ 完整/ 的/ 密钥/ ,/ 不像/ 时序/ 攻击/ 一样/ 需要/ 采集/ 百万/ 次/ 以上/ 的/ 数据/ ,/ 能够/ 有效/ 地/ 缩小/ 密钥/ 的/ 搜索/ 空间/ ,/ 提高/ Cache/ 攻击/ 的/ 效率/ ./ 利用/ 精心/ 编写/ 的/ 间谍/ 进程/ 不仅/ 能够/ 执行/ 本地/ 攻击/ ,/ 而且/ 利用/ 植入/ 木马/ 的/ 方式/ 同样/ 能够/ 作用/ 于/ 远程/ 攻击/ ./ 在/ 未来/ 的/ 研究/ 工作/ 中/ ,/ 针对实际/ 的/ 攻击/ 过程/ ,/ 还有/ 如下/ 的/ 问题/ 值得注意/ :/ (/ 1/ )/ 由于/ 受/ 操作系统/ 中/ 其它/ 进程/ 噪声/ 的/ 干扰/ ,/ 影响/ Cache/ 组/ 定位/ 的/ 精度/ ,/ 可能/ 在/ 同/ 一次/ 采集/ 的/ 计/ Page12/ 时/ 数据/ 中/ ,/ 同时/ 出现/ 多个/ Cache/ 组/ 访问/ 失效/ 的/ 情况/ ,/ 很难/ 精确定位/ 具体/ 的/ Cache/ 组/ ./ (/ 2/ )/ 经/ 研究/ 发现/ OpenSSL/ 中/ 采用/ BIGNUM/ 类型/ 的/ 大数/ 操作过程/ 中/ 需要/ 分配/ 临时/ 变量/ ,/ 分配/ 的/ 数目/ 与/ 操作/ 的/ 复杂度/ 有关/ ,/ 以/ BN/ _/ CTX/ 类型/ 进行/ 内存/ 的/ 动态分配/ ,/ 因此/ 同样/ 会/ 对/ Cache/ 组/ 访问/ 时间/ 的/ 采集/ 以及/ 预计/ 算表/ 对应/ Cache/ 组/ 的/ 定位/ 带来/ 一定/ 的/ 影响/ ./ (/ 3/ )/ 预计/ 算表不像/ 分组/ 密码/ 算法/ 的/ S/ 盒/ 是/ 固定/ 不变/ 的/ ,/ 它/ 是/ 在/ 模幂/ 运算/ 中/ 动态/ 生成/ 的/ ,/ 因此/ 可能/ 每次/ 执行/ 时所/ 得到/ 的/ 预计/ 算表/ 对应/ 的/ Cache/ 组/ 位置/ 以及/ 数目/ 都/ 不/ 相同/ ,/ 会/ 对/ 分析/ 算法/ 带来/ 一定/ 的/ 影响/ ./ 综上所述/ ,/ 新/ 的/ 攻击/ 算法/ 尽管/ 能够/ 比/ 原有/ 算法/ 进一步/ 缩小/ 密钥/ 的/ 搜索/ 空间/ ,/ 但是/ 在/ 实际/ 攻击/ 应用/ 中/ 仍/ 有/ 不少/ 困难/ 需要/ 克服/ ,/ 在/ 下/ 一步/ 的/ 研究/ 中/ ,/ 我们/ 需要/ 研究/ 如何/ 尽量/ 排除/ 或/ 减小/ 噪声/ 的/ 影响/ ,/ 比如/ 可以/ 采用/ 汇编语言/ 实现/ 间谍/ 进程/ ,/ 使/ 其中/ 部分/ 指令/ 能够/ 绕过/ Cache/ 的/ 方式/ 执行/ ,/ 从而/ 减少/ 间谍/ 进程/ 本身/ 记录/ Cache/ 访问/ 时间/ 等/ 操作/ 对/ Cache/ 的/ 影响/ ;/ 寻找/ 能够/ 进一步/ 消除/ 或/ 减小/ 噪声/ 的/ 数据分析/ 方法/ ,/ 同时/ 给出/ 能够/ 有效/ 抵御/ Cache/ 计时/ 攻击/ 的/ 措施/ ./ 7/ 结论/ 本文/ 对/ RSA/ 算法/ 的/ 踪迹/ 驱动/ Cache/ 计时/ 攻击/ 进行/ 了/ 一些/ 相关/ 研究/ ,/ 建立/ 了/ 针对/ RSA/ 算法/ 的/ 踪迹/ 驱动/ 数据/ Cache/ 计时/ 攻击/ 模型/ ,/ 提出/ 了/ 能够/ 进一步/ 有效/ 利用/ 采集/ 的/ Cache/ 计时/ 信息/ 的/ 分析/ 算法/ ,/ 指出/ 实际/ 攻击/ 过程/ 中/ 存在/ 的/ 难点/ 并/ 给出/ 相应/ 的/ 解决方案/ ,/ 最终/ 针对/ OpenSSL/ 密码/ 库/ 的/ RSA/ 算法/ 进行/ 攻击/ 实验/ 验证/ ,/ 研究/ 结果表明/ :/ 采用/ 滑动/ 窗口/ 算法/ 实现/ 模幂/ 运算/ 的/ RSA/ 算法/ 存在/ 遭受/ Cache/ 计时/ 攻击/ 的/ 安全漏洞/ ,/ 此类/ 攻击方式/ 对/ 其它/ 同样/ 采用/ 窗口/ 算法/ 实现/ 的/ 公钥/ 密码/ 算法/ 安全性/ 带来/ 一定/ 的/ 威胁/ ,/ 能够/ 作用/ 于/ “/ Cache/ -/ Memory/ ”/ 层次/ 存储/ 结构/ 的/ 计算机/ 平台/ ;/ 针对/ RSA/ 算法/ 的/ 访问/ 驱动/ Cache/ 计时/ 攻击/ 存在/ 一定/ 的/ 困难性/ ,/ 新/ 的/ 幂指数/ 分析/ 算法/ 能比/ 原有/ 攻击/ 算法/ 能够/ 获取/ 更/ 多/ 的/ 幂指数/ 位/ ,/ 进一步/ 缩小/ 了/ 密钥/ 恢复/ 的/ 复杂度/ ;/ 由于/ 此类/ 攻击/ 相/ 比较/ 于/ 时序/ 驱动/ 攻击/ 和/ 访问/ 驱动/ 攻击/ 所/ 需/ 的/ 样本量/ 小/ ,/ 攻击性/ 强/ ,/ 应/ 引起/ 充分/ 的/ 关注/ ./ 在/ 实际/ 攻击/ 过程/ 中/ ,/ 由于/ Cache/ 计时/ 攻击/ 受/ 外界/ 因素/ 影响/ 较大/ ,/ 不同/ 的/ 执行/ 环境/ 、/ 不同/ 的/ 密码/ 库/ 以及/ 密码/ 算法/ 实现/ 方式/ 等/ 因素/ 都/ 会/ 影响/ 攻击/ 的/ 执行/ 效果/ ,/ 仍然/ 存在/ 噪声/ 干扰/ 大/ 以及/ Cache/ 组/ 定位/ 不准/ 等/ 问题/ ;/ 另外/ 如何/ 寻找/ 一种/ 既/ 能/ 有效/ 抵御/ 此类/ 攻击/ 又/ 能/ 保证/ 密码/ 算法/ 性能/ 的/ 防御/ 措施/ ,/ 这/ 都/ 需要/ 我们/ 做/ 进一步/ 的/ 工作/ ./ 

