Page1/ 基于/ 星型/ 模式/ 的/ 一个/ 多路/ top/ -/ 犽/ join/ 算法/ 曹立/ 新高/ 宏/ (/ 哈尔滨工业大学/ 计算机科学/ 与/ 技术/ 学院/ 哈尔滨/ 150001/ )/ 摘要/ top/ -/ kjoin/ 查询/ 返回/ 用户/ 最/ 感兴趣/ 的/ k/ 个/ 连接/ 结果/ ./ 近来/ top/ -/ kjoin/ 已经/ 成为/ 一个/ 重要/ 的/ 研究课题/ ,/ 且/ 在/ Web/ 数据库/ 、/ 信息/ 抽取/ 和/ 数据挖掘/ 中均/ 有/ 应用/ ./ 星型/ 模式/ 的/ 数据仓库/ 在/ 实际/ 应用/ 中/ 也/ 存在/ top/ -/ kjoin/ 查询/ ,/ 如/ 有时/ 决策者/ 只想/ 查询/ 星型/ 连接/ 结果/ 中/ 他/ 最/ 感兴趣/ 的/ k/ 个/ ./ 然而/ ,/ 现有/ top/ -/ kjoin/ 算法/ 不/ 适合/ 星型/ 模式/ ./ 为了/ 在/ 星型/ 模式/ 上/ 有效/ 地/ 支持/ top/ -/ kjoin/ 查询/ ,/ 文中/ 提出/ 两类/ 索引/ 并/ 基于/ 这/ 两类/ 索引/ 提出/ 一个/ 适用/ 于/ 星型/ 模式/ 的/ 多路/ top/ -/ kjoin/ 算法/ ./ 该/ 算法/ 通过/ 采用/ 一个/ 比/ 现有/ 算法/ 更优/ 的/ 上界/ 和/ 一个/ 剪枝/ 策略/ 获得/ 了/ 更/ 高/ 的/ 效率/ ./ 此外/ ,/ 实验/ 也/ 表明/ 文中/ 的/ 算法/ 比/ 现有/ 算法/ 效率/ 更高/ ./ 关键词/ 数据仓库/ ;/ 星型/ 模式/ ;/ 星型/ 连接/ ;/ top/ -/ k/ ;/ 多路/ top/ -/ kjoin/ 算法/ 1/ 引言/ top/ -/ kjoin/ 查询/ 返回/ 用户/ 最/ 感兴趣/ 的/ k/ 个/ 连接/ 结果/ ./ 近来/ top/ -/ kjoin/ 已经/ 成为/ 一个/ 重要/ 的/ 研究课题/ ,/ 且/ 在/ Web/ 数据库/ 、/ 信息/ 抽取/ 和/ 数据挖掘/ 中均/ 有/ 应用/ ./ 在/ 数据仓库/ 应用/ 中/ ,/ 星型/ 模式/ 是/ 最/ 常用/ 的/ 数据表示/ 模型/ ,/ 包括/ 一个/ 事实/ 表/ 和/ 多个/ 维表/ ./ SSBM/ [/ 1/ ]/ (/ StarSchemaBenchmark/ )/ 数据/ 集中/ ,/ 存在/ 星型/ 模式/ ,/ 如图/ 1/ 所示/ :/ 事实/ 表/ LINEORDER/ 和/ 4/ 个维表/ CUSTOMER/ 、/ SUPPLIER/ 、/ PART/ 和/ DATE/ ./ 在/ 基于/ 星型/ 模式/ 的/ OLAP/ (/ OnlineAnalyticalProcessing/ )/ 查/ Page2/ 询中/ ,/ 涉及/ 最多/ 的/ 操作/ 就是/ 维表/ 和/ 事实/ 表/ 的/ 连接/ ,/ 又/ 被/ 称为/ 星型/ 连接/ ./ 星型/ 连接/ 返回/ 连接/ 的/ 全部/ 结果/ ,/ 是/ OLAP/ 查询/ 中/ 代价/ 最高/ 的/ 操作/ 之一/ ./ 星型/ 模式/ 的/ 数据仓库/ 的/ 实际/ 应用/ 中/ 也/ 存在/ top/ -/ kjoin/ 查询/ ./ 如/ 有时/ 决策者/ 只想/ 查询/ 星型/ 连接/ 结果/ 中/ 他/ 最/ 感兴趣/ 的/ k/ 个/ ./ 例如/ ,/ 在/ 图/ 1/ 所示/ 的/ 星型/ 模式/ 中/ ,/ 决策者/ 只想/ 查看/ 那些/ 订单/ 时间/ 距今/ 较/ 短/ 、/ 供应商/ 地址/ 距离/ 公司/ 较近/ 、/ 客户/ 信誉/ 较/ 好/ 、/ 配件/ 品牌/ 较/ 好/ 、/ 订单/ 采购/ 量/ 较大/ 的/ k/ 个/ 订单/ ,/ 其/ 对应/ 的/ 查询/ 如例/ 1/ 所示/ ./ 例/ 1/ ./ SELECT/ / FROMLineorderF/ ,/ CustomerC/ ,/ SupplierS/ ,/ PartP/ ,/ WHEREF/ ./ custkey/ =/ C/ ./ custkeyandF/ ./ suppkey/ 图/ 1SSBM/ 数据/ 集中/ 的/ 星型/ 模式/ 本文/ 的/ 主要/ 贡献/ 如下/ :/ 查询/ ,/ 本文/ 提出/ 了/ 两类/ 索引/ ;/ (/ 1/ )/ 为了/ 有效/ 地/ 支持/ 星型/ 模式/ 上/ 的/ top/ -/ kjoin/ (/ 2/ )/ 基于/ 这/ 两类/ 索引/ ,/ 本文/ 提出/ 了/ 一个/ 适用/ 于/ 星型/ 模式/ 的/ 多路/ top/ -/ kjoin/ 算法/ ./ 该/ 算法/ 通过/ 采用/ 一个/ 比/ 现有/ 算法/ 更优/ 的/ 上界/ 和/ 一个/ 剪枝/ 策略/ 获得/ 了/ 更/ 高/ 的/ 效率/ ./ 本文/ 第/ 2/ 节/ 介绍/ 相关/ 工作/ ;/ 第/ 3/ 节/ 介绍/ 问题/ 定/ ORDERBYF/ ./ squantity/ +/ C/ ./ scredit/ +/ S/ ./ saddress/ +/ STOPAFTERk/ ;/ 对于/ 该/ 查询/ ,/ 一个/ 直观/ 的/ 做法/ 是/ 先生/ 成/ 星型/ 连接/ 的/ 结果/ ,/ 再/ 对/ 这些/ 结果/ 排序/ 得到/ 上述/ 的/ top/ -/ kjoin/ 查询/ 结果/ ./ 由于/ 星型/ 连接/ 的/ 结果/ 极/ 多/ ,/ 故此/ 方法/ 效率/ 极低/ ./ 但/ 如果/ 我们/ 在/ 数据仓库/ 中/ 创建/ 一些/ 索引/ 并/ 应用/ top/ -/ kjoin/ 算法/ ,/ 那么/ 无需/ 产生/ 连接/ 的/ 全部/ 结果/ 就/ 能/ 得到/ top/ -/ kjoin/ 查询/ 结果/ ./ 故/ 基于/ 星型/ 模式/ 的/ top/ -/ kjoin/ 问题/ 的/ 研究/ 具有/ 重要/ 意义/ ./ 更/ 重要/ 的/ 是/ ,/ 我们/ 发现/ 现有/ top/ -/ kjoin/ 算法/ 因/ 没有/ 充分考虑/ 星型/ 模式/ 的/ 固有/ 特点/ 而/ 不/ 适合/ 星型/ 模式/ ,/ 因而/ 本文/ 提出/ 一个/ 基于/ 星型/ 模式/ 的/ 多路/ top/ -/ kjoin/ 算法/ ./ 义/ 以及/ 相关/ 索引/ 的/ 数据结构/ ;/ 第/ 4/ 节/ 给出/ 基于/ 星型/ 模式/ 的/ 多路/ top/ -/ kjoin/ 算法/ ;/ 第/ 5/ 节/ 通过/ 实验/ 验证/ 该/ 算法/ 的/ 效率/ ;/ 第/ 6/ 节对/ 全文/ 进行/ 总结/ ./ 2/ 相关/ 工作/ 通常/ ,/ top/ -/ kjoin/ 算法/ 中有/ 如下/ 3/ 个/ 假设/ :/ (/ 1/ )/ 每个/ 元组/ 包含/ 若干/ 打分/ 属性/ (/ scoreattribute/ )/ ./ 打/ 分属/ Page3/ 性为/ 度量/ 某种/ 语义/ 的/ 属性/ ,/ 如/ 一个/ 关于/ 酒店/ 信息/ 的/ 关系/ 表中/ ,/ 可能/ 含有/ 若干/ 分别/ 表示/ 酒店/ 的/ 卫生/ 程度/ 、/ 交通/ 便利/ 程度/ 等/ 的/ 打分/ 属性/ ./ (/ 2/ )/ 数据/ 访问/ 模型/ (/ dataaccessmodel/ )/ 分为/ 数据/ 有序/ 访问/ 模型/ 和/ (/ 或/ )/ 数据/ 随机/ 访问/ 模型/ ./ 数据/ 有序/ 访问/ 是/ 指/ 数据/ 可/ 按照/ 打分/ 属性/ 值/ 的/ 大小/ 被/ 顺序/ 访问/ ;/ 数据/ 随机/ 访问/ 是/ 指/ 数据/ 的/ 任何/ 一个/ 元组/ 可以/ 被/ 随机/ 访问/ ./ (/ 3/ )/ 算法/ 的/ 打分/ 函数/ 一般/ 只/ 考虑/ 线性/ 单调/ 函数/ ./ top/ -/ kjoin/ 问题/ 已经/ 有/ 很多/ 的/ 研究成果/ ,/ 相关/ 工作/ 按照/ 输入/ 数据/ 的/ 确定性/ 、/ 数据/ 访问/ 模型/ 种类/ 、/ 打分/ 函数/ 的/ 性质/ 、/ 连接/ 的/ 类型/ 、/ 输出/ 结果/ 的/ 精确性/ 可以/ 分成/ 若干类/ ./ 不失/ 一般性/ ,/ 本文/ 的/ 研究/ 算法/ 以/ 确定/ 数据/ 作为/ 输入/ ,/ 数据/ 访问/ 模型/ 为/ 一个/ 表只/ 支持/ 有序/ 访问/ ,/ 其它/ 表/ 同时/ 支持/ 有序/ 访问/ 和/ 随机/ 访问/ ,/ 打分/ 函数/ 取/ 线性/ 单调/ 函数/ ,/ 只/ 考虑/ 等值/ 连接/ 并/ 输出/ 精确/ 结果/ ./ rank/ -/ join/ [/ 2/ ]/ 、/ PBRJ/ [/ 3/ ]/ 和/ FPRA/ [/ 4/ ]/ 均/ 以/ 确定/ 数据/ 作为/ 输入/ ,/ 数据/ 访问/ 模型/ 为/ 大部分/ 表只/ 支持/ 有序/ 访问/ ,/ 小/ 部分/ 表/ 同时/ 支持/ 有序/ 访问/ 和/ 随机/ 访问/ ,/ 打分/ 函数/ 取/ 线性/ 单调/ 函数/ ,/ 只/ 考虑/ 等值/ 连接/ 并/ 输出/ 精确/ 结果/ ./ rank/ -/ join/ 是/ 基于/ 关系数据库/ 的/ 多路/ top/ -/ kjoin/ 算法/ ,/ 其/ 一般化/ 算法/ [/ 2/ ]/ 利用/ 某些/ 表对/ 随机/ 访问/ 的/ 支持/ 以/ 获得/ 更/ 小/ 的/ 上界/ ./ PBRJ/ [/ 3/ ]/ 和/ FPRA/ [/ 4/ ]/ 考虑/ 打分/ 函数/ 在/ 每个/ 表中取/ 多个/ 打分/ 属性/ 作为/ 输入/ ./ FPRA/ 是/ PBRJ/ 的/ 后续/ 改进/ 算法/ ./ 虽然/ FPRA/ 的/ IO/ 很少/ ,/ 但/ 其/ 计算/ 复杂度/ 非常/ 高/ ./ 而且/ 当/ 打分/ 函数/ 在/ 每个/ 表只/ 取/ 一个/ 打分/ 属性/ 作为/ 输入/ 时/ ,/ FPRA/ 退化/ 为/ rank/ -/ join/ ./ 此外/ ,/ FPRA/ 有个/ 限制/ :/ 所有/ 输入/ 必须/ 按照/ 打分/ 函数/ 值/ 的/ 上界/ 降序/ 排列/ ./ 这/ 也就是说/ 当/ 打分/ 函数/ 在/ 每个/ 表取/ e/ (/ e/ / 2/ )/ 个/ 打分/ 属性/ 作为/ 输入/ 时/ ,/ FPRA/ 必须/ 预先/ 知道/ 打分/ 函数/ ./ 这/ 在/ ad/ -/ hoc/ 查询/ 中是/ 不/ 可能/ 的/ ./ 和/ rank/ -/ join/ 相比/ ,/ J/ / [/ 5/ ]/ 考虑/ 的/ 连接/ 条件/ 更/ 宽泛/ ,/ 不/ 局限于/ 等值/ 连接/ ./ 但/ 在/ 等值/ 连接/ 时/ ,/ 相比/ 于/ rank/ -/ join/ ,/ J/ / 因/ 中间/ 结果/ 集/ 较大/ 而/ 效率/ 较/ 低/ ./ J/ / e/ -/ approx/ [/ 5/ ]/ 产生/ 近似/ 的/ top/ -/ kjoin/ 结果/ ./ OPTU/ -/ Topk/ [/ 6/ ]/ 、/ MS/ _/ Topk/ [/ 7/ ]/ 是/ 在/ 不/ 确定/ 数据/ 上/ 的/ top/ -/ kjoin/ 算法/ ./ 此外/ ,/ 还有/ 一类/ 研究/ 问题/ 被/ 称为/ top/ -/ kselection/ ,/ 其/ 相当于/ top/ -/ kjoin/ 问题/ 的/ 一种/ 特例/ ./ 它/ 假设/ 每个/ 表/ 包含/ 的/ 元组/ 都/ 来自/ 同/ 一组/ 对象/ 集合/ ./ NRA/ [/ 8/ ]/ 、/ TA/ [/ 8/ ]/ 、/ CA/ [/ 8/ ]/ 、/ Upper/ // Pick/ [/ 9/ ]/ 、/ Mpro/ [/ 10/ ]/ 都/ 属于/ 这/ 一类/ 问题/ 的/ 算法/ ./ 综上所述/ ,/ rank/ -/ join/ 、/ PBRJ/ 和/ FPRA/ 这/ 3/ 个/ 算法/ 与/ 本文/ 研究/ 的/ 算法/ 相近/ ./ FPRA/ 是/ PBRJ/ 的/ 改进/ 算法/ ,/ 其/ IO/ 虽然/ 很少/ ,/ 但/ 计算/ 复杂度/ 却/ 非常/ 高/ ,/ 而且/ 当/ 打分/ 函数/ 在/ 每个/ 表中取/ e/ (/ e/ / 2/ )/ 个/ 打分/ 属性/ 作为/ 输入/ 时/ ,/ FPRA/ 必须/ 预先/ 知道/ 打分/ 函数/ ,/ 这/ 在/ ad/ -/ hoc/ 查询/ 中是/ 不/ 可能/ 的/ ./ 当/ e/ =/ 1/ 时/ ,/ FPRA/ 退化/ 为/ rank/ -/ join/ ./ 故/ 本文/ 只/ 考虑/ 将/ rank/ -/ join/ 作为/ 对比/ 算法/ ./ rank/ -/ join/ 经过/ 一些/ 修改/ 可以/ 适合/ 星型/ 模式/ ,/ 但/ 在/ 实验/ 中/ 我们/ 发现/ 其/ 效率/ 较/ 低/ ./ 3/ 问题/ 定义/ 与/ 索引/ 结构/ 3.1/ 问题/ 定义/ 定义/ 1/ (/ 星型/ 模式/ )/ ./ m/ 维/ 的/ 星型/ 模式/ 包含/ 一个/ 事实/ 表/ F/ 和/ m/ 个维表/ D1/ ,/ D2/ ,/ …/ ,/ Dm/ ./ 其中/ 事实/ 表/ 包含/ 3/ 类/ 属性/ :/ (/ 1/ )/ 主键/ ;/ (/ 2/ )/ 对应/ 维表/ 的/ 外键/ ;/ (/ 3/ )/ 度量/ 属性/ ./ 维表/ 包含/ 两类/ 属性/ :/ (/ 1/ )/ 主键/ ;/ (/ 2/ )/ 描述/ 属性/ —/ —/ —/ 描述/ 维/ 详细信息/ 的/ 属性/ ./ 维表中/ 的/ 这/ 两类/ 属性/ 在/ 本文/ 中/ 被/ 统称/ 为维/ 属性/ ./ 定义/ 2/ (/ 扩展/ 星型/ 模式/ )/ ./ 在/ m/ 维/ 的/ 星型/ 模式/ 中/ ,/ 为了/ 支持/ 其上/ 的/ top/ -/ kjoin/ 查询/ ,/ 对于/ 决策者/ 感兴趣/ 的/ 每个/ 度量/ 属性/ a/ 和/ 维/ 属性/ b/ ,/ 我们/ 在/ 相应/ 的/ 事实/ 表和维表中/ 引入/ 新/ 属性/ sa/ ,/ sb/ ,/ 分别/ 度量/ a/ 和/ b/ 语义/ 的/ 分值/ ,/ 称之为/ 打分/ 属性/ ./ 打分/ 属性/ 值/ 的/ 大小/ ∈/ [/ 0/ ,/ 1/ ]/ ,/ 表示/ 决策者/ 对/ a/ 和/ b/ 的/ 感兴趣/ 程度/ ./ 打分/ 属性/ 值越/ 大/ 表示/ 决策者/ 对/ 其/ 相应/ 属性/ 值/ 的/ 感兴趣/ 程度/ 越高/ ./ 本文/ 称/ 上述/ 加入/ 打分/ 属性/ 之后/ 的/ 星型/ 模式/ 为/ m/ 维/ 的/ 扩展/ 星型/ 模式/ ./ 打分/ 属性/ 值/ 大小/ 可/ 由/ 决策者/ 指定/ ,/ 也/ 可/ 由/ 相应/ 的/ 度量/ 属性/ 或维/ 属性/ 计算/ 得到/ ./ 如/ 在/ SSBM/ 数据/ 集中/ ,/ 系统/ 可/ 根据/ 维/ 属性/ DATEKEY/ 的/ 值/ 计算/ 其/ 对应/ 的/ 打分/ 属性/ 值/ ./ 基于/ m/ 维/ 的/ 扩展/ 星型/ 模式/ ,/ 本文/ 考虑/ 的/ 打分/ 函数/ 以/ 若干/ 打分/ 属性/ 作为/ 输入/ 项/ ./ 对应/ 决策者/ 的/ 不同/ 查询/ ,/ 这些/ 打分/ 属性/ 可能/ 来自/ 事实/ 表/ ,/ 也/ 可能/ 来自/ 维表/ ,/ 并且/ 同一个/ 维表/ 或/ 事实/ 表中/ 可取/ e/ (/ e/ / 0/ )/ 个/ 打分/ 属性/ 作为/ 打分/ 函数/ 的/ 输入/ ./ 当/ e/ / 2/ 时/ ,/ 系统/ 可以/ 先/ 将/ 这/ e/ 个/ 打分/ 属性/ 的/ 打分/ 函数/ 值/ 计算出来/ ,/ 然后/ 将/ 这个/ 函数/ 值/ 看做/ 一个/ 打分/ 属性/ ./ 这样/ 打分/ 函数/ 在/ 一个/ 维表/ 或/ 事实/ 表中取/ 多个/ 打分/ 属性/ 作为/ 输入/ 的/ 问题/ 就/ 可以/ 转化/ 为取/ 一个/ 打分/ 属性/ 作为/ 输入/ 的/ 问题/ ./ 所以/ 接下来/ 本文/ 考虑/ 的/ 打分/ 函数/ 的/ 形式/ 为/ Score/ (/ s1/ ,/ s2/ ,/ …/ ,/ sn/ ,/ sn/ +/ 1/ )/ ,/ 其中/ 的/ n/ +/ 1/ (/ n/ ∈/ {/ 1/ ,/ 2/ ,/ …/ ,/ m/ }/ )/ 个/ 打分/ 属性/ 分别/ 来自/ 不同/ 的/ 维表/ 和/ 事实/ 表/ ./ 该/ 打分/ 函数/ 记作/ Score/ ./ 例/ 1/ 即/ 为/ 以/ sum/ 为/ 打分/ 函数/ 的/ top/ -/ kjoin/ 查询/ ,/ 其中/ 的/ F/ ./ squantity/ 、/ C/ ./ scredit/ 、/ S/ ./ saddress/ 、/ P/ ./ sbrand1/ 、/ D/ ./ stime/ 分别/ 代表/ 订单/ 采购/ 量/ 、/ 客户/ 信誉/ 、/ 供应商/ 地址/ 、/ 配件/ 品牌/ 和/ 订单/ 时间/ 对应/ 的/ 打分/ 属性/ ./ Page4/ 为了/ 方便/ 叙述/ ,/ 本文/ 不失/ 一般性/ 地/ 假设/ 打分/ 函数/ 中/ 的/ 打分/ 属性/ s1/ ,/ s2/ ,/ …/ ,/ sn/ 和/ sn/ +/ 1/ 分别/ 来自/ D1/ ,/ D2/ ,/ …/ ,/ Dn/ 和/ F/ ,/ 称/ n/ 为/ 打分/ 函数/ 中/ 输入/ 的/ 维数/ ./ 根据上述/ 描述/ ,/ 本文/ 研究/ 问题/ 的/ 形式化/ 定义/ 如下/ ./ 定义/ 3/ (/ 问题/ 定义/ )/ ./ 给定/ m/ 维/ 的/ 扩展/ 星型/ 模式/ ,/ 其上/ 的/ top/ -/ kjoin/ 问题/ 以/ 一个/ n/ +/ 3/ 元组/ (/ F/ ,/ D1/ ,/ D2/ ,/ …/ ,/ Dn/ ,/ Score/ ,/ k/ )/ 为/ 输入/ ,/ 输出/ 按/ 打分/ 函数/ 值/ 降序/ 排列/ 的/ 前/ k/ 个/ 连接/ 结果/ ,/ 每/ 一个/ 结果/ ∈/ (/ (/ F/ / / D1/ )/ / / D2/ )/ …/ / / Dn/ ./ 其中/ :/ (/ 1/ )/ F/ 支持/ 有序/ 访问/ ,/ D1/ ,/ D2/ ,/ …/ ,/ Dn/ 支持/ 有序/ 访问/ 和/ 随机/ 访问/ ;/ (/ 2/ )/ 打分/ 函数/ Score/ 的/ 形式/ 为/ 上述/ 的/ Score/ (/ s1/ ,/ s2/ ,/ …/ ,/ sn/ ,/ sn/ +/ 1/ )/ ;/ (/ 3/ )/ 0/ </ k/ / |/ (/ (/ F/ / / D1/ )/ / / D2/ )/ …/ / / Dn/ |/ ./ 3.2/ 索引/ 结构/ 显然/ ,/ 一个/ 数据库/ 中/ 支持/ 有序/ 访问/ 和/ (/ 或/ )/ 随机/ 访问/ 的/ 表越/ 多/ ,/ top/ -/ kjoin/ 算法/ 的/ 打分/ 函数/ 值/ 上界/ 就/ 会/ 越/ 优/ ./ 因此/ ,/ 我们/ 尽可能/ 最大化/ m/ 维/ 的/ 扩展/ 星型/ 模式/ 中/ 支持/ 有序/ 访问/ 和/ (/ 或/ )/ 随机/ 访问/ 的/ 表/ 的/ 数目/ ./ 息/ 索引/ ./ 定义/ 4/ (/ 维/ 信息/ 索引/ )/ ./ 给定/ 一个/ m/ 维/ 的/ 扩展/ 星型/ 模式/ ,/ 一个/ 打分/ 属性/ sj/ (/ sj/ ∈/ Di/ )/ 对应/ 一个/ 维/ 信息/ 索引/ DIj/ 一个/ 三元组/ (/ score/ ,/ key/ ,/ count/ )/ ,/ 其中/ :/ (/ 1/ )/ score/ 表示/ Di/ 中/ 的/ 打分/ 属性/ sj/ ,/ 且/ DIj/ 序/ 排列/ ;/ (/ 2/ )/ key/ 表示/ 打分/ 属性/ score/ 对应/ 的/ Di/ 主键/ ;/ (/ 3/ )/ count/ 被/ 称为/ 频率/ 属性/ ,/ 记录/ key/ 在/ 事实/ 表中/ 作为/ 外键/ 出现/ 的/ 频数/ ./ 实际/ 应用/ 中/ ,/ 对应/ 决策者/ 在/ 维表中/ 感兴趣/ 的/ 每个/ 打分/ 属性/ ,/ 系统/ 分别/ 建立/ 一个/ 维/ 信息/ 索引/ ./ 图/ 1/ 中/ SUPPLIER/ 的/ 打分/ 属性/ saddress/ 对应/ 的/ 维/ 信息/ 索引/ 的/ 形式/ 如表/ 1/ ./ 其中/ saddress/ 为/ SUPPLIER/ 中维/ 属性/ address/ 对应/ 的/ 打分/ 属性/ ,/ 用来/ 度量/ 供应商/ 地址/ 距离/ 公司/ 的/ 远近/ ./ 为了/ 使维表/ 支持/ 有序/ 访问/ ,/ 本文/ 提出/ 一类/ 维信表/ 1SUPPLIER/ 中/ 狊/ address/ 对应/ 的/ 维/ 信息/ 索引/ saddress0/ ./ 57352210.5735119/ 同理/ ,/ 为了/ 使/ 事实/ 表/ 支持/ 有序/ 访问/ ,/ 本文/ 提出/ 一类/ 事实/ 表/ 信息/ 索引/ ./ 定义/ 5/ (/ 事实/ 表/ 信息/ 索引/ )/ ./ 给定/ 一个/ m/ 维/ 的/ 扩展/ 星型/ 模式/ ,/ 一个/ 打分/ 属性/ si/ (/ si/ ∈/ F/ )/ 对应/ 一个/ 事实/ 表/ 信息/ 索引/ FIi/ (/ FactinformationIndex/ )/ ./ FIi/ 为/ 一个/ m/ +/ 2/ 元组/ (/ score/ ,/ key/ ,/ FK1/ ,/ FK2/ ,/ …/ ,/ FKm/ )/ ./ 其中/ :/ (/ 1/ )/ score/ 表示/ F/ 中/ 的/ 打分/ 属性/ si/ ,/ 且/ FIi/ 中/ 元组/ 按/ score/ 值/ 大小/ 降序/ 排列/ ;/ (/ 2/ )/ key/ 表示/ 打分/ 属性/ score/ 对应/ 的/ F/ 主键/ ;/ (/ 3/ )/ FKi/ 是/ key/ 对应/ Di/ 的/ 外键/ ,/ i/ ∈/ {/ 1/ ,/ 2/ ,/ …/ ,/ m/ }/ ./ 实际/ 应用/ 中/ ,/ 对应/ 决策者/ 在/ 事实/ 表中/ 感兴趣/ 的/ 每个/ 打分/ 属性/ ,/ 系统/ 分别/ 建立/ 一个/ 事实/ 表/ 信息/ 索引/ ./ 图/ 1/ 中/ LINEORDER/ 的/ 打分/ 属性/ squantity/ 对应/ 的/ 事实/ 表/ 信息/ 索引/ 的/ 形式/ 如表/ 2/ ./ 其中/ 的/ squantity/ 为/ LINE/ -/ ORDER/ 中/ 度量/ 属性/ quantity/ 对应/ 的/ 打分/ 属性/ ;/ orderkey/ 和/ linenumber/ 为/ LINEORDER/ 的/ 主键/ ;/ 其它/ 属性/ 为/ 外键/ ./ 表/ 2LINEORDER/ 中/ 狊/ quantity/ 对应/ 的/ 事实/ 表/ 信息/ 索引/ squantityorderkeylinenumbercustkeysuppkeypartkeyorderdate0/ ./ 5437236357214313441890199507180.542412843519765172315639019980821/ 因为/ 本文/ 考虑/ 的/ 打分/ 函数/ 在/ 同一个/ 维表/ 或/ 事实/ 表中/ 只取/ 一个/ 打分/ 属性/ 作为/ 输入/ ./ 故/ 为了/ 方便/ 叙述/ ,/ 下文/ 中/ 的/ DIj/ 由于/ 事实/ 表/ 通常/ 较大/ ,/ 其/ 对应/ 事实/ 表/ 信息/ 索引/ 也/ 较大/ (/ 一般/ 不能/ 被/ 读入/ 内存/ )/ ,/ 因此/ 事实/ 表不/ 支持/ 随机/ 访问/ ./ 而维表/ 一般/ 较/ 小/ (/ 在/ scalefactor/ =/ 1/ 的/ SSBM/ 数据/ 集中/ ,/ 维表/ 大小/ 不到/ 事实/ 表/ 的/ 4/ %/ )/ ,/ 其/ 对应/ 的/ 维/ 信息/ 索引/ 也/ 较/ 小/ ,/ 所以/ 维/ 信息/ 索引/ DI1/ ,/ DI2/ ,/ …/ ,/ DIm/ 可/ 支持/ 随机/ 访问/ ./ 因为/ top/ -/ kjoin/ 算法/ 中/ 需要/ 的/ 打分/ 属性/ 、/ 主键/ 等/ 均/ 在/ 维/ 信息/ 索引/ 中/ ,/ 所以/ 维/ 信息/ 索引/ 支持/ 随机/ 访问/ 也/ 就/ 相当于/ 维表/ 支持/ 随机/ 访问/ ./ 通过/ Di/ (/ i/ ∈/ {/ 1/ ,/ 2/ ,/ …/ ,/ m/ }/ )/ 的/ 主键/ (/ 记作/ KEYi/ )/ 对/ DIi/ 随机/ 访问/ 的/ 方法/ 为/ :/ 系统/ 对应/ 每/ 一个/ 维/ 信息/ 索引/ DIi/ 建立/ 一个/ 位置/ 转换/ 表/ POSi/ ./ 该表/ 用于/ 将/ KEYi/ 转换/ 为/ 其/ 在/ DIi/ 中/ 的/ 索引/ 位置/ (/ 记作/ orderi/ )/ ./ 索引/ 位置/ 表/ POSi/ 为/ 一个/ Hash/ 表/ ,/ 包括/ 两项/ :/ (/ 1/ )/ KEYi/ ;/ (/ 2/ )/ orderi/ ./ 基于/ 位置/ 转换/ 表/ POSi/ ,/ 系统/ 可/ 通过/ KEYi/ 随机/ 访问/ DIi/ 而/ 得到/ DIi/ 在/ orderi/ 的/ 详细信息/ (/ 记作/ DIi/ [/ orderi/ ]/ )/ ./ 4/ 基于/ 星型/ 模式/ 的/ 多路/ top/ -/ 犽/ join/ 算法/ 4.1/ 算法/ 相关/ 概念/ 与/ 原理/ 基于/ 维/ 信息/ 索引/ 和/ 事实/ 表/ 信息/ 索引/ ,/ 本文/ 提出/ 一个/ 适用/ 于/ 星型/ 模式/ 的/ 多路/ top/ -/ kjoin/ 算法/ :/ MTJS/ ./ 算法/ 采用/ 一个/ 优先级/ 队列/ (/ 记作/ Q/ )/ 来/ 保存/ 算法/ 的/ 中间/ 结果/ ,/ Q/ 中/ 最小/ 的/ 打分/ 函数/ 值/ 记作/ Smin/ ./ 当/ MTJS/ 顺序/ 访问/ 事实/ 表/ 信息/ 索引/ 中/ 的/ 一个/ 元组/ 时/ ,/ 就/ 将/ 该/ 元组/ 外键/ 在/ 相应/ 维/ 信息/ 索引/ 中/ 对应/ Page5/ 的/ count/ 值减/ 1/ ./ 基于/ count/ 值/ 的/ 更新/ ,/ 我们/ 给出/ 若干/ 定义/ 如下/ ./ 定义/ 6/ (/ 上/ 边界/ 位/ )/ ./ 设/ DIi/ 为/ m/ 维/ 的/ 扩展/ 星型/ 模式/ 上/ 的/ 一个/ 维/ 信息/ 索引/ ,/ 其/ 对应/ 的/ 上/ 边界/ 位/ Hi/ =/ max/ {/ p/ |/ DIi/ [/ p/ ]/ ./ count/ ≠/ 0/ }/ ./ 其中/ :/ (/ 1/ )/ p/ 表示/ DIi/ 中/ 索引/ 项/ 的/ 位置/ (/ 简称/ 为/ 索引/ 位置/ )/ ,/ 且/ p/ ∈/ [/ 0/ ,/ Card/ (/ DIi/ )/ -/ 1/ ]/ ./ p/ 越/ 小/ 的/ 项/ 的/ 打分/ 属性/ 值越/ 高/ ,/ Card/ (/ DIi/ )/ 表示/ DIi/ 中/ key/ 的/ 基数/ ./ (/ 2/ )/ DIi/ [/ p/ ]/ ./ count/ 表示/ DIi/ 在/ p/ 的/ 频率/ 属性/ 值/ ./ 定义/ 7/ (/ 维/ 最高分/ )/ ./ 设/ DIi/ 为/ m/ 维/ 的/ 扩展/ 星型/ 模式/ 上/ 的/ 一个/ 维/ 信息/ 索引/ ,/ 其/ 对应/ 的/ 维/ 最高分/ DIi/ ./ max/ =/ DIi/ [/ Hi/ ]/ ./ score/ (/ i/ ∈/ {/ 1/ ,/ 2/ ,/ …/ ,/ m/ }/ )/ ./ 其中/ DIi/ [/ Hi/ ]/ ./ score/ 表示/ DIi/ 在/ Hi/ 处/ 的/ 打分/ 属性/ 值/ ./ MTJS/ 通过/ 顺序/ 访问/ FI/ 得到/ 元组/ t/ 并/ 随机/ 访问/ 相应/ 的/ DIi/ 来/ 构成/ 连接/ 结果/ ./ 由于/ DIi/ 中/ count/ 值为/ 零/ 的/ 元组/ 在/ 将来/ 不会/ 再/ 与/ 顺序/ 访问/ FI/ 得到/ 的/ 元组/ 构成/ 连接/ 结果/ ,/ 所以/ DIi/ ./ max/ 为/ 当前/ 未见/ 连接/ 结果/ 在/ DIi/ 上/ 的/ 最高/ 可能/ 打分/ 属性/ 值/ ./ 定义/ 8/ (/ 维上界/ )/ ./ DIi/ 中/ p/ 处/ 的/ 维上界/ upperbound/ (/ p/ ,/ i/ )/ =/ Score/ (/ FI/ ./ latest/ ,/ DIi/ [/ p/ ]/ ./ score/ ,/ DI1/ ./ max/ ,/ …/ ,/ DIi/ -/ 1/ ./ max/ ,/ DIi/ +/ 1/ ./ max/ ,/ …/ ,/ DIn/ ./ max/ )/ ./ 其中/ :/ (/ 1/ )/ FI/ ./ latest/ 表示/ MTJS/ 对/ FI/ 最近/ 一次/ 顺序/ 访问/ 得到/ 的/ 打分/ 属性/ 值/ ;/ (/ 2/ )/ p/ 表示/ DIi/ 中/ 的/ 索引/ 位置/ ;/ (/ 3/ )/ DIi/ [/ p/ ]/ ./ score/ 表示/ DIi/ 在/ p/ 处/ 的/ 打分/ 属性/ 值/ ;/ (/ 4/ )/ DIj/ ./ max/ (/ j/ ∈/ {/ 1/ ,/ 2/ ,/ …/ ,/ n/ }/ andj/ ≠/ i/ )/ 表示/ DIj/ 的/ 维/ 最高分/ ./ 定义/ 9/ (/ 下/ 边界/ 位/ )/ ./ 设/ DIi/ 为/ m/ 维/ 的/ 扩展/ 星型/ 模式/ 上/ 的/ 一个/ 维/ 信息/ 索引/ ,/ 其/ 对应/ 的/ 下/ 边界/ 位/ Li/ =/ min/ {/ p/ |/ upperbound/ (/ p/ ,/ i/ )/ >/ Smin/ }/ ./ 其中/ :/ (/ 1/ )/ upperbound/ (/ p/ ,/ i/ )/ 表示/ DIi/ 中/ p/ 处/ 的/ 维上界/ ;/ (/ 2/ )/ Smin/ 为/ 中间/ 结果/ 中/ 最小/ 的/ 打分/ 函数/ 值/ ./ 根据上述/ 定义/ ,/ 我们/ 有/ 如下/ 定理/ ./ 定理/ 1/ ./ 给定/ m/ 维/ 的/ 扩展/ 星型/ 模式/ ,/ 设/ t/ 为/ FI/ 中/ 元组/ ,/ FKi/ 为/ t/ 对应/ DIi/ 的/ 外键/ ,/ orderi/ 为/ DIi/ 中/ 主键/ 为/ FKi/ 元组/ 的/ 索引/ 位置/ ,/ 在/ MTJS/ 算法/ 中/ ,/ 如果/ 存在/ orderi/ >/ Li/ (/ i/ ∈/ {/ 1/ ,/ 2/ ,/ …/ ,/ n/ }/ )/ ,/ 则/ t/ 一定/ 不是/ 最终/ 结果/ 之一/ ./ 证明/ ./ 根据/ 定义/ 8/ ,/ DIi/ 中/ orderi/ 处/ 对应/ 的/ 维上界/ upperbound/ (/ orderi/ ,/ i/ )/ =/ Score/ (/ FI/ ./ latest/ ,/ DIi/ [/ orderi/ ]/ ./ score/ ,/ DI1/ ./ max/ ,/ …/ ,/ 其中/ 因为/ FI/ 中/ 被/ 顺序/ 访问/ 过/ 的/ 元组/ 不会/ 再/ 构成/ 新/ 的/ 连接/ 结果/ ,/ 故/ FI/ ./ latest/ 表示/ 当前/ 未见/ 连接/ 结果/ 在/ FI/ 的/ 最高/ 可能/ 打分/ 属性/ 值/ ,/ 又/ 因为/ DIj/ ./ max/ 表示/ 当前/ 未见/ 连接/ 结果/ 在/ DIj/ 的/ 最高/ 可能/ 打分/ 属性/ 值/ ,/ 进而/ 根据/ 打分/ 函数/ 的/ 单调/ 性/ 可知/ upperbound/ (/ orderi/ ,/ i/ )/ 是/ DIi/ 中/ orderi/ 处/ 的/ 打分/ 属性/ 在/ 当前/ 所/ 构成/ 连接/ 结果/ 的/ 打分/ 函数/ 值/ 上界/ ./ 再/ 根据/ Li/ 定义/ 和/ orderi/ >/ Li/ 有/ upperbound/ (/ orderi/ ,/ i/ )/ / Smin/ ,/ 即/ t/ 构成/ 的/ 连接/ 结果/ 的/ 打分/ 函数/ 值/ 上界/ 小于/ 或/ 等于/ Smin/ ,/ 故/ t/ 一定/ 不是/ 最终/ 结果/ 之一/ ./ 本文/ 基于/ 定理/ 1/ 提出/ 一个/ 剪枝/ 策略/ :/ 当/ MTJS/ 顺序/ 访问/ FI/ 得到/ 一个/ 元组/ t/ 时/ ,/ 如果/ t/ 对应/ 的/ 某个/ 外键/ 在/ 其维/ 信息/ 索引/ 中/ 的/ 索引/ 位置/ 大于/ 该/ 外键/ 所在/ 维/ 信息/ 索引/ 的/ 下/ 边界/ 位/ ,/ 则/ MTJS/ 可以/ 不必/ 随机/ 访问/ 维/ 信息/ 索引/ 以/ 生成/ t/ 对应/ 的/ 连接/ 结果/ 并/ 计算/ 该/ 连接/ 结果/ 的/ 打分/ 函数/ 值/ ./ 根据/ 定理/ 1/ ,/ 该/ 剪枝/ 策略/ 不会/ 剪去/ 任何/ 一个/ 最终/ 结果/ ,/ 故其/ 是/ 正确/ 的/ ./ 设/ Li/ 处/ 频率/ 属性/ 值为/ c/ ,/ 维数/ 为/ m/ ,/ 那么/ 根据/ 定理/ 1/ ,/ 只要/ Li/ 增加/ 1/ ,/ 就/ 最/ 多/ 可能/ 有/ c/ ×/ m/ 次/ 随机/ 访问/ 和/ c/ 次/ 打分/ 函数/ 值/ 计算/ 被/ 剪枝/ ./ 而维/ 信息/ 索引/ 中/ 的/ 频率/ 属性/ 值/ 一般/ 较大/ ,/ 故该/ 剪枝/ 策略/ 具有/ 重要/ 意义/ ./ top/ -/ kjoin/ 算法/ 中/ ,/ 通常/ 有/ 一个/ 上/ 界/ 用于/ 表示/ 当前/ 未见/ 连接/ 结果/ 的/ 打分/ 函数/ 值/ 上界/ ,/ 本文/ 称之为/ 总上界/ ./ 引理/ 1/ ./ MTJS/ 的/ 总/ 上界/ 为/ Score/ (/ FI/ ./ latest/ ,/ DI1/ ./ max/ ,/ …/ ,/ DIn/ ./ max/ )/ ./ 证明/ ./ 因为/ FI/ ./ latest/ ,/ DI1/ ./ max/ ,/ …/ ,/ DIn/ ./ max/ 均/ 为/ 当前/ 未见/ 连接/ 结果/ 在/ FI/ ,/ DI1/ ,/ DI2/ ,/ …/ ,/ DIn/ 的/ 最高/ 可能/ 打分/ 属性/ 值/ ,/ 故/ 根据/ 打分/ 函数/ 的/ 单调/ 性/ ,/ Score/ (/ FI/ ./ latest/ ,/ DI1/ ./ max/ ,/ …/ ,/ DIn/ ./ max/ )/ 是/ MTJS/ 的/ 总/ 上界/ ./ 定理/ 2/ ./ 在/ n/ 个维/ 信息/ 索引/ DI1/ ,/ DI2/ …/ ,/ DIn/ 上/ ,/ MTJS/ 按/ 定义/ 更新/ Li/ 、/ Hi/ 和/ Q/ ./ 只要/ 某/ 时刻/ 有/ 一个/ 上/ 、/ 下/ 边界/ 位/ 满足/ Li/ </ Hi/ ,/ MTJS/ 就/ 可以/ 结束/ 并/ 返回/ 正确/ 的/ top/ -/ kjoin/ 结果/ ./ 当/ Li/ </ Hi/ 时/ ,/ 由下/ 边界/ 位/ 定义/ 可知/ upper/ -/ bound/ (/ Hi/ ,/ i/ )/ / Smin/ (/ 式/ (/ 1/ )/ )/ ./ 其中/ upperbound/ (/ Hi/ ,/ i/ )/ =/ Score/ (/ FI/ ./ latest/ ,/ DIi/ [/ Hi/ ]/ ./ score/ ,/ DI1/ ./ max/ ,/ …/ ,/ DIi/ -/ 1/ ./ max/ ,/ DIi/ +/ 1/ ./ max/ ,/ …/ ,/ DIn/ ./ max/ )/ ,/ 而/ DIi/ [/ Hi/ ]/ ./ score/ =/ DIi/ ./ max/ ,/ 故/ upperbound/ (/ Hi/ ,/ i/ )/ =/ Score/ (/ FI/ ./ latest/ ,/ DI1/ ./ max/ ,/ …/ ,/ DIn/ ./ max/ )/ (/ 式/ (/ 2/ )/ )/ ./ 由/ 引理/ 1/ ,/ Score/ (/ FI/ ./ latest/ ,/ DI1/ ./ max/ ,/ …/ ,/ DIn/ ./ max/ )/ 为/ MTJS/ 的/ 总/ 上界/ ./ 于是/ 根据/ 式/ (/ 1/ )/ ,/ 式/ (/ 2/ )/ 有/ MTJS/ 的/ 总/ 上界/ / Smin/ ,/ 故/ 此时/ MTJS/ 可以/ 结束/ ,/ 并且/ 当前/ Q/ 中/ 的/ k/ 个/ 连接/ 结果/ 为/ 正确/ 结果/ ./ 4.2/ 算法/ 描述/ MTJS/ 的/ 主要/ 思想/ 是/ :/ 首先/ ,/ 算法/ 根据/ 维/ 信息/ 索引/ 中/ 的/ 频率/ 属性/ 值来/ 更新/ 上/ 边界/ 位/ ,/ 从而/ 使/ 总/ 上界/ 在/ 维/ 信息/ 索引/ 上/ 对应/ 的/ 维/ 最高分/ 得到/ 更新/ ./ 其次/ ,/ 根/ Page6/ 据/ 定理/ 1/ ,/ 算法/ 利用/ 下/ 边界/ 位/ 过滤/ 不必要/ 的/ 随机/ 访问/ 和/ 计算/ ./ 最后/ 根据/ 定理/ 2/ ,/ 当/ 存在/ 某个/ 上/ 边界/ 位/ 大于/ 其/ 对应/ 的/ 下/ 边界/ 位时/ ,/ 算法/ 结束/ ./ MTJS/ 分为/ 两步/ ;/ 第/ 1/ 步/ 初始化/ 相关/ 变量/ ;/ 第/ 2/ 步/ 计算/ top/ -/ kjoin/ 的/ 结果/ ./ 第/ 2/ 步中/ ,/ MTJS/ 首先/ 顺序/ 访问/ 事实/ 表/ 信息/ 索引/ 得到/ 一个/ 元组/ ,/ 并/ 更新/ 该/ 元组/ 外键/ 在/ 相应/ 维/ 信息/ 索引/ 中/ 对应/ 的/ 频率/ 属性/ 值/ ;/ 接下来/ 重新/ 确定/ 上/ 、/ 下/ 边界/ 位/ ;/ 然后/ 依据/ 定理/ 1/ 判断/ 是否/ 可以/ 剪枝/ ;/ 如果/ 不能/ 剪枝/ ,/ 则/ 算法/ 生成/ 该/ 连接/ 结果/ 并/ 考虑/ 其/ 能否/ 成为/ 中间/ 结果/ ./ 如此/ 下去/ ,/ 直到/ 存在/ 一个/ 维/ 信息/ 索引/ 的/ 下/ 边界/ 位/ 小于/ 其上/ 边界/ 位时/ 算法/ 结束/ ./ 为了/ 避免/ 在/ 每次/ 更新/ 频率/ 属性/ 值/ 之后/ 都/ 重新/ 计算/ 每/ 一个/ 下/ 边界/ 位/ 对应/ 的/ 维上界/ 和/ 判断/ 能否/ 更新/ 各个/ 下/ 边界/ 位/ ,/ MTJS/ 中/ 引入/ 最佳/ 维/ 的/ 概念/ ./ 定义/ 10/ (/ 最佳/ 维/ )/ ./ 如果/ DIbest/ 在/ 该/ 时刻/ 位于/ 其下/ 边界/ 位处/ 的/ 维上界/ 在/ 所有/ 维/ 信息/ 索引/ 中/ 最小/ ,/ 称/ best/ 为/ 某/ 时刻/ 的/ 最佳/ 维/ ./ MTJS/ 只/ 需/ 考虑/ 更新/ DIbest/ 中/ Lbest/ 处/ 对应/ 的/ 维上界/ 和/ Lbest/ ,/ 原因/ 如下/ :/ (/ 1/ )/ 在/ 被选为/ 最佳/ 维时/ ,/ 最佳/ 维下/ 边界/ 位/ Lbest/ 处/ 的/ 维上界/ 最小/ ,/ 故/ Lbest/ 将来/ 被/ 更新/ 的/ 可能性/ 最大/ ,/ 进而/ MTJS/ 可/ 获得/ 较/ 好/ 的/ 剪枝/ 效果/ ;/ (/ 2/ )/ 不/ 考虑/ 其它/ 下/ 边界/ 位/ 的/ 更新/ ,/ 算法/ 也/ 可/ 正确/ 结束/ ./ 因为/ 如果/ 某/ 时刻/ MTJS/ 的/ 总/ 上界/ / Smin/ (/ 式/ (/ 1/ )/ )/ ,/ 那么/ 一定/ 有/ Lbest/ </ Hbest/ ,/ 进而/ 根据/ 定理/ 2/ ,/ 算法/ 可/ 正确/ 结束/ ./ 假设/ 如果/ 此时/ Lbest/ 不/ 小于/ Hbest/ ,/ 那么/ 有/ upperbound/ (/ Lbest/ ,/ best/ )/ / MTJS/ 的/ 总/ 上界/ (/ 式/ (/ 2/ )/ )/ ,/ 故可由式/ (/ 1/ )/ 、/ 式/ (/ 2/ )/ 推出/ upperbound/ (/ Lbest/ ,/ best/ )/ / Smin/ (/ 式/ (/ 3/ )/ )/ ./ 而/ 根据/ 下/ 边界/ 位/ 定义/ 和/ 式/ (/ 3/ )/ ,/ Lbest/ 会/ 一直/ 更新/ 至/ Hbest/ -/ 1/ ,/ 故/ 假设/ 失败/ ,/ 算法/ 此时/ 可/ 正确/ 结束/ ./ MTJS/ 的/ 输入/ 为/ 一个/ 四元组/ (/ k/ ,/ G/ ,/ P/ ,/ Score/ )/ ,/ 称之为/ 扩展/ 星型/ 模式/ 下/ top/ -/ kjoin/ 的/ 输入/ 四/ 要素/ ./ 其中/ :/ (/ 1/ )/ k/ 为/ 查询/ 结果/ 大小/ ;/ (/ 2/ )/ G/ 为/ top/ -/ kjoin/ 查询/ 相关/ 的/ 维/ 信息/ 索引/ 和/ 事实/ 表/ 信息/ 索引/ 的/ 集合/ ;/ (/ 3/ )/ P/ 为/ 对应/ G/ 的/ 位置/ 转换/ 表/ 集合/ ;/ (/ 4/ )/ Score/ 为/ 2.1/ 节中/ 的/ 打分/ 函数/ ./ 为了/ 方便/ 下面/ 的/ 算法/ 描述/ ,/ 本文/ 接下来/ 不失/ 一般性/ 地/ 假设/ G/ =/ {/ DI1/ ,/ DI2/ ,/ …/ ,/ DIn/ ,/ FI/ }/ ,/ P/ =/ {/ POS1/ ,/ POS2/ ,/ …/ ,/ POSn/ }/ ./ MTJS/ 的/ 详细/ 内容/ 如下/ ./ 算法/ 1/ ./ MTJS/ ./ 输入/ :/ 扩展/ 星型/ 模式/ 下/ top/ -/ kjoin/ 的/ 输入/ 四/ 要素/ 输出/ :/ (/ (/ FI/ / / DI1/ )/ / / DI2/ )/ …/ / / DIn/ 中/ 打分/ 函数/ 值/ 最/ 第/ 1/ 步/ ./ 初始化/ ./ 1/ ./ 初始化/ 相关/ 数据结构/ :/ Q/ ,/ DI1/ ,/ DI2/ ,/ …/ ,/ DIn/ ,/ FI/ ,/ 2/ ./ foreachi/ (/ 1/ / i/ / n/ )/ 3/ ./ while/ (/ Q/ ./ size/ (/ )/ / k/ )/ // // 先生/ 成/ k/ 个/ 连接/ 结果/ 4/ ./ 根据/ 定义/ 计算/ Smin/ ,/ Hi/ ,/ DIi/ ./ max/ ,/ FI/ ./ latest/ ,/ Li/ ;/ 5/ ./ best/ =/ Min/ (/ )/ ;/ // // Min/ (/ )/ 返回/ 当前/ 的/ 最佳/ 维第/ 2/ 步/ ./ 计算/ top/ -/ kjoin/ 结果/ ./ 6/ ./ if/ (/ L1/ </ H1orL2/ </ H2or/ …/ orLn/ </ Hn/ )/ then/ 返回/ Q/ 中/ top/ -/ kjoin/ 结果/ ;/ endif7/ ./ 顺序/ 访问/ FI/ 得到/ 下/ 一个/ 元组/ t/ ,/ 更新/ FI/ ./ latest/ ;/ 8/ ./ foreachi/ (/ 1/ / i/ / n/ )/ {/ orderi/ =/ POSi/ (/ t/ ./ FKi/ )/ ;/ 9/ ./ foreachi/ (/ 1/ / i/ / n/ )/ // // 更新/ 上/ 边界/ 位/ {/ while/ (/ DIi/ [/ Hi/ ]/ ./ count/ =/ 0andLi/ / Hi/ )/ 10/ ./ 更新/ 最佳/ 维在/ Lbest/ 的/ 维上界/ upperbound/ (/ Lbest/ ,/ 11/ ./ if/ (/ upperbound/ (/ Lbest/ ,/ best/ )/ / SminandLbest/ / Hbest/ )/ 12/ ./ if/ (/ order1/ >/ L1ororder2/ >/ L2or/ …/ orordern/ >/ Ln/ )/ 13/ ./ 读取/ DI1/ [/ order1/ ]/ ./ score/ ,/ …/ ,/ DIn/ [/ ordern/ ]/ ./ score/ 和/ t14/ ./ if/ (/ t/ 对应/ 连接/ 结果/ 的/ 打分/ 函数/ 值/ >/ Smin/ )/ 15/ ./ goto6/ ./ 4.3/ 算法/ 分析/ (/ 1/ )/ 若/ 在/ m/ 维/ 的/ 扩展/ 星型/ 模式/ 上/ 利用/ 上述/ 索引/ 应用/ rank/ -/ join/ 的/ 一般化/ 算法/ ,/ 其/ 总/ 上界/ 大于/ MTJS/ 的/ 总/ 上界/ ./ Rank/ -/ join/ 的/ 总/ 上界/ 为/ 以/ FI/ ./ latest/ 和/ 每个/ 维/ 信息/ 索引/ 的/ 第一个/ 打分/ 属性/ 值/ DIi/ ./ top/ 作/ 输入/ Page7/ 得到/ 的/ 打分/ 函数/ 值/ :/ Score/ (/ FI/ ./ latest/ ,/ DI1/ ./ top/ ,/ …/ ,/ DIn/ ./ top/ )/ ./ 因为/ DIi/ ./ max/ 会/ 随着/ 频率/ 属性/ 值/ 的/ 更新/ 而/ 不断更新/ ,/ 而/ DIi/ ./ top/ 固定/ 不变/ 且/ DIi/ ./ top/ / DIi/ ./ max/ ,/ 所以/ 根据/ 打分/ 函数/ 的/ 单调/ 性/ ,/ rank/ -/ join/ 的/ 总/ 上界/ 大于/ MTJS/ 的/ 总/ 上界/ ./ 因为/ 总上界/ 更/ 小/ ,/ 故/ 和/ rank/ -/ join/ 相比/ ,/ MTJS/ 具有/ 更少/ 的/ 顺序/ 访问/ 次数/ ./ (/ 2/ )/ 参考/ Theorem3/ [/ 2/ ]/ 关于/ rank/ -/ join/ 近似/ 最优/ (/ instanceoptimal/ [/ 8/ ]/ )/ 的/ 证明/ ,/ 不难/ 得出/ MTJS/ 也/ 是/ 近似/ 最优/ 的/ ./ 近似/ 最优/ 的/ 定义/ 如下/ ./ 定义/ 11/ (/ 近似/ 最优/ )/ ./ “/ 设/ / 是/ 一类/ 算法/ ,/ / 是/ 一类/ 数据库/ ,/ 对应/ 算法/ A/ ∈/ / 和/ 数据库/ D/ ∈/ / ,/ 算法/ 代价/ 函数/ cost/ (/ A/ ,/ D/ )/ 返回/ 在/ D/ 上/ 应用/ A/ 导致/ 的/ 代价/ ,/ 称/ 一个/ 算法/ B/ 在/ / 和/ / 上/ 是/ 近似/ 最优/ 的/ ,/ 如果/ B/ ∈/ / ,/ 并且/ 对于/ 任意/ A/ ∈/ / 和/ 任意/ D/ ∈/ / ,/ cost/ (/ B/ ,/ D/ )/ =/ O/ (/ cost/ (/ A/ ,/ D/ )/ )/ 成立/ ./ 即/ 对于/ 任意/ A/ ∈/ / 和/ 任意/ D/ ∈/ / ,/ 存在/ 常数/ c/ ,/ c/ >/ 0/ ,/ 使/ cost/ (/ B/ ,/ D/ )/ / c/ ×/ cost/ (/ A/ ,/ D/ )/ +/ c/ ./ c/ 被/ 称为/ 最优/ 比/ (/ optimalityratio/ )/ ”/ [/ 8/ ]/ ./ 定理/ 3/ ./ 设/ / 是/ m/ 维/ 的/ 扩展/ 星型/ 模式/ ,/ 包括/ 1/ 个/ 只/ 支持/ 有序/ 访问/ 的/ 事实/ 表/ ,/ m/ 个/ 既/ 支持/ 有序/ 访问/ 又/ 支持/ 随机/ 访问/ 的/ 维表/ ,/ / 是/ 一类/ 算法/ ,/ 其/ 在/ / 上/ 产生/ 正确/ 的/ top/ -/ kjoin/ 结果/ ./ cost/ (/ A/ ,/ D/ )/ =/ SumCost/ (/ A/ ,/ D/ )/ ,/ 则/ MTJS/ 在/ / 和/ / 上/ 是/ 近似/ 最优/ 的/ ./ 其中/ ,/ 算法/ 代价/ 函数/ SumCost/ (/ A/ ,/ D/ )/ 度量/ 算法/ A/ (/ A/ ∈/ / )/ 在/ D/ (/ D/ ∈/ / )/ 上/ 对/ FI/ 顺序/ 访问/ 和/ 对/ DIi/ (/ i/ ∈/ {/ 1/ ,/ 2/ ,/ …/ ,/ n/ }/ )/ 随机/ 访问/ 的/ 总/ 代价/ ./ 下面/ 用/ CS/ (/ A/ ,/ D/ )/ ,/ CR/ (/ A/ ,/ D/ )/ 分别/ 表示/ A/ 在/ D/ 上/ 应用/ 导致/ 的/ 对/ FI/ 的/ 顺序/ 访问/ 次数/ 和/ 对/ DIi/ 的/ 随机/ 访问/ 次数/ ./ 因为/ 随机/ 访问速度/ (/ 内存/ 读写/ 速度/ )/ 大约/ 是/ 顺序/ 访问速度/ (/ 磁盘/ 读写/ 速度/ )/ 的/ 103/ 倍/ ,/ 所以/ 我们/ 令/ SumCost/ (/ A/ ,/ D/ )/ =/ CR/ (/ A/ ,/ D/ )/ ×/ 0.001/ +/ CS/ (/ A/ ,/ D/ )/ ./ 虽然/ 0.001/ 很小/ ,/ 但是/ 因为/ CR/ (/ A/ ,/ D/ )/ 很大/ 且/ 打分/ 函数/ 值/ 的/ 计算/ 次数/ 和/ CR/ (/ A/ ,/ D/ )/ 成正比/ ,/ 故/ SumCost/ 中/ 不能/ 忽略/ CR/ (/ A/ ,/ D/ )/ ./ 下面/ 给出/ 定理/ 3/ 的/ 详细/ 证明/ ./ 证明/ ./ 设/ A/ 为/ / 中/ 任意/ 算法/ ./ 如暂/ 不/ 考虑/ CR/ (/ A/ ,/ D/ )/ 的/ 代价/ ,/ 参考/ Theorem3/ [/ 2/ ]/ 的/ 证明/ ,/ 显然/ MTJS/ 的/ 最优/ 比/ 至多/ 为/ 1/ ,/ 故有/ CS/ (/ MTJS/ ,/ D/ )/ / CS/ (/ A/ ,/ D/ )/ +/ c/ (/ 式/ (/ 1/ )/ )/ 成立/ ./ 本文/ 考虑/ MTJS/ 中/ 的/ 一次/ 顺序/ 访问/ 在/ D/ 中/ 至多/ 对应/ m/ 次/ 随机/ 访问/ ,/ 故/ SumCost/ (/ MTJS/ ,/ D/ )/ / (/ 1/ +/ 0.001/ ×/ m/ )/ ×/ CS/ (/ MTJS/ ,/ D/ )/ (/ 式/ (/ 2/ )/ )/ ./ 再/ 根据/ 式/ (/ 1/ )/ 有/ (/ 1/ +/ 0.001/ ×/ m/ )/ ×/ CS/ (/ MTJS/ ,/ D/ )/ / (/ 1/ +/ 0.001/ ×/ m/ )/ ×/ CS/ (/ A/ ,/ D/ )/ +/ c/ (/ 式/ (/ 3/ )/ )/ ,/ 又/ 因为/ CS/ (/ A/ ,/ D/ )/ / SumCost/ (/ A/ ,/ D/ )/ ,/ 故/ (/ 1/ +/ 0.001/ ×/ m/ )/ ×/ CS/ (/ A/ ,/ D/ )/ +/ c/ / (/ 1/ +/ 0.001/ ×/ m/ )/ ×/ SumCost/ (/ A/ ,/ D/ )/ +/ c/ (/ 式/ (/ 4/ )/ )/ 成立/ ,/ 综合/ 式/ (/ 2/ )/ 、/ 式/ (/ 3/ )/ 和/ 式/ (/ 4/ )/ 可知/ SumCost/ (/ MTJS/ ,/ D/ )/ / (/ 1/ +/ 0.001/ ×/ m/ )/ ×/ SumCost/ (/ A/ ,/ D/ )/ +/ c/ ,/ 即/ MTJS/ 是/ 近似/ 最优/ 的/ 且/ 最优/ 比为/ 1/ +/ 0.001/ ×/ m/ ./ 5/ 实验/ 结果/ 与/ 分析/ 5.1/ 实验/ 配置/ 数据/ 集/ ./ 因为/ top/ -/ kjoin/ 算法/ 一般/ 只/ 访问/ 每个/ 表/ 的/ 前/ 一部分/ 就/ 能/ 结束/ ,/ 所以/ 数据/ 集/ 的/ 大小/ 不/ 作为/ 其/ 实验/ 参数/ 之一/ [/ 4/ ]/ ./ 本文/ 使用/ scalefactor/ 为/ 1/ 的/ SSBM/ 数据/ 集/ 作为/ 实验/ 数据/ 集/ ./ 对应/ m/ 维/ 的/ 扩展/ 星型/ 模式/ ,/ 我们/ 在/ SSBM/ 数据/ 集上/ 做/ 了/ 一个/ 修改/ :/ 在/ 每个/ 维表/ 和/ 事实/ 表中/ 分别/ 引入/ 一个/ 打分/ 属性/ ./ 按照/ 打分/ 属性/ 值/ 分布/ 的/ 不同/ ,/ 本文/ 的/ 实验/ 数据/ 集/ 分为/ 指数分布/ 的/ 数据/ 集/ 和/ 正态分布/ 的/ 数据/ 集/ ,/ 简称/ 为/ 指数分布/ 数据/ 和/ 正态分布/ 数据/ ./ 指数分布/ 中/ λ/ =/ 2/ 、/ 正态分布/ 中/ μ/ =/ 0.6/ ,/ σ/ =/ 0.2/ ./ 此外/ ,/ 实验/ 考虑/ 了/ Bruno/ 等/ 人/ [/ 9/ ]/ 在/ ICDE2002/ 中/ 提出/ 的/ 相关系数/ cf/ (/ correlationfactor/ )/ 对/ 算法/ 性能/ 的/ 影响/ ./ 按照/ DIi/ (/ i/ ∈/ {/ 1/ ,/ 2/ ,/ …/ ,/ n/ }/ )/ 与/ FI/ 的/ 相关系数/ 的/ 不同/ ,/ 指数分布/ 数据/ 和/ 正态分布/ 数据/ 又/ 分别/ 对应/ 一组/ 实验/ 数据/ 集/ ./ 相关系数/ 的/ 定义/ 如下/ ./ 定义/ 12/ (/ 相关系数/ )/ ./ 设/ L/ 是/ 按/ 打分/ 属性/ Ls/ 降序/ 排列/ 的/ 表/ ,/ R/ 是/ 按/ 打分/ 属性/ Rt/ 降序/ 排列/ 的/ 表/ ,/ R/ 的/ 外键/ 是/ L/ 的/ 主键/ ,/ 对于/ L/ 任意/ 一个/ 主键/ key/ ,/ 其/ 在/ L/ 中/ 对应/ 的/ Ls/ 值为/ s/ ,/ 在/ R/ 中/ 对应/ 的/ Rt/ 值为/ t/ ,/ cf/ ∈/ [/ -/ 1/ ,/ 1/ ]/ ,/ 我们/ 称/ L/ 与/ R/ 正/ 相关/ ,/ 如果/ cf/ / 0/ ,/ 且/ t/ ∈/ [/ max/ (/ 0/ ,/ s/ -/ (/ 1/ -/ cf/ )/ )/ ,/ min/ (/ 1/ ,/ s/ +/ (/ 1/ -/ cf/ )/ )/ ]/ ;/ 称/ L/ 与/ R/ 负相关/ ,/ 如果/ cf/ </ 0/ ,/ 且/ t/ ∈/ [/ max/ (/ 0/ ,/ 1/ -/ s/ -/ (/ 1/ -/ |/ cf/ |/ )/ )/ ,/ min/ (/ 1/ ,/ 1/ -/ s/ +/ (/ 1/ -/ |/ cf/ |/ )/ )/ ]/ ./ cf/ 被/ 称为/ L/ 与/ R/ 的/ 相关系数/ ./ 相关系数/ 的/ 含义/ 为/ ,/ key/ 在/ L/ 中/ 打分/ 属性/ 值/ 和/ key/ 在/ R/ 中/ 打分/ 属性/ 值/ 的/ 相关/ 程度/ ./ 观察/ 定义/ 12/ ,/ 当/ cf/ =/ 0/ 时/ ,/ t/ ∈/ [/ 0/ ,/ 1/ ]/ ,/ 即/ t/ 的/ 大小/ 与/ s/ 无关/ ./ 因为/ 打分/ 属性/ 值/ 高低/ 与/ 排序/ 位置/ 相关/ ,/ 故/ 此时/ key/ 在/ R/ 中/ 的/ 对应/ 元组/ 可以/ 出现/ 在/ R/ 中/ 任意/ 位置/ ./ 当/ cf/ >/ 0/ 时/ ,/ s/ 如果/ 越高/ ,/ t/ 就/ 可能/ 越高/ ./ 如/ s/ =/ 0.5/ ,/ cf/ =/ 0.9/ ,/ 则/ t/ ∈/ [/ 0.4/ ,/ 0.6/ ]/ ./ 此时/ key/ 在/ L/ 排得/ 越/ 靠/ 前/ ,/ 那么/ key/ 在/ R/ 中排/ 得/ 也/ 越/ 可能/ 靠前/ ./ 故/ L/ 与/ R/ 正/ 相关/ 时/ ,/ 顺序/ 访问/ R/ 中/ 元组/ 而/ 生成/ 的/ 连接/ 结果/ 的/ 打分/ 函数/ 值会/ 较/ 高/ (/ 打分/ 属性/ 值高/ 的/ 元组/ 连接/ 打分/ 属性/ 值高/ 的/ 元组/ )/ ,/ 此时/ top/ -/ kjoin/ 算法/ 相应/ 地会/ 较/ 快/ 结束/ ./ 反之/ ,/ 当/ cf/ </ 0/ 时/ ,/ key/ 在/ R/ 排得/ 越/ 靠/ 前/ ,/ 那么/ key/ 在/ L/ 中排/ 得/ 越/ 可能/ 靠/ 后/ ./ 故/ 此时/ 顺序/ 访问/ R/ 中/ 元组/ 而/ 生成/ 的/ 连接/ 结果/ 的/ 打分/ 函数/ 值会/ 较/ 低/ (/ 打分/ 属性/ 值高/ 的/ 元组/ 连接/ 打分/ 属性/ 值低/ 的/ 元组/ )/ ,/ 此时/ Page8top/ -/ kjoin/ 算法/ 相应/ 地会/ 结束/ 较慢/ ./ 实验/ 环境/ ./ 主机/ CPU/ :/ P43/ ./ 4GHz/ ;/ 磁盘/ 大小/ :/ 80GB/ ;/ 磁盘/ 读写/ 平均速度/ :/ 50MB/ // s/ ;/ 操作系统/ :/ WindowsXP/ ;/ 编译/ 环境/ :/ vs2005/ ;/ 内存大小/ :/ 1GB/ ./ 测度/ ./ 我们/ 以/ 执行/ 时间/ (/ 记作/ time/ )/ 和/ SumCost/ 的/ 函数/ 值为/ 测度/ 衡量/ 实验/ 中/ 算法/ 的/ 性能/ ./ 对比/ 算法/ ./ 为了/ 使/ rank/ -/ join/ 适合/ 星型/ 模式/ 的/ 特点/ ,/ 本文/ 将/ 其/ 修改/ 如下/ (/ 修改/ 后/ 的/ rank/ -/ join/ 记作/ RJ/ _/ Adapt/ )/ :/ (/ 1/ )/ rank/ -/ join/ 没有/ 必要/ 顺序/ 访问/ DIi/ (/ i/ ∈/ {/ 1/ ,/ 2/ ,/ …/ ,/ n/ }/ )/ ,/ 因为/ 顺序/ 访问/ DIi/ 得到/ 的/ 元组/ 之间/ 不能/ 连接/ ,/ 故会/ 产生/ 若干/ 不/ 完整/ 的/ 连接/ 结果/ ,/ 而/ 这些/ 结果/ 不/ 可能/ 被/ 输出/ ,/ 因为/ 它们/ 只是/ 维/ 信息/ 索引/ 中/ 的/ 一个/ 元组/ ,/ 故其/ 打分/ 函数/ 值/ 下界/ 必定/ 小于/ 或/ 等于/ 1/ ,/ 而/ 其/ 总/ 上界/ 一般/ 大于/ n/ ./ 此外/ ,/ 顺序/ 访问/ DIi/ 不能/ 降低/ 其/ 总/ 上界/ ./ (/ 2/ )/ 由/ 修改/ (/ 1/ )/ ,/ rank/ -/ join/ 没有/ 必要/ 考虑/ 对/ DI1/ ,/ DI2/ ,/ …/ ,/ DIn/ 和/ FI/ 顺序/ 访问/ 的/ 优先/ 次序/ ./ 5.2/ MTJS/ 与/ RJ/ _/ Adapt/ 的/ 性能/ 比较/ 不失/ 一般性/ ,/ 实验/ 中/ 的/ 打分/ 函数/ 取/ 线性/ 加权/ 函数/ (/ 其它/ 线性/ 单调/ 函数/ 的/ 实验/ 也/ 表明/ MTJS/ 的/ 效率/ 较/ 高/ ,/ 但/ 由于/ 篇幅/ 所/ 限/ ,/ 这里/ 略去/ )/ ./ 权值/ 的/ 赋值/ 可/ 分为/ 两种/ 情况/ ,/ 即/ 或者/ 事实/ 表/ 打分/ 属性/ 的/ 权值/ 较大/ ,/ 或者/ 维表/ 打分/ 属性/ 的/ 权值/ 较大/ ,/ 故/ 我们/ 用/ 后者/ 与/ 前者/ 的/ 比值/ 大小/ 来/ 表示/ 权值/ 的/ 不同/ 赋值/ ,/ 本文/ 称之为/ 相对/ 权值/ ,/ 记作/ W/ ./ 这里/ 我们/ 分别/ 在/ 不同/ 的/ 打分/ 属性/ 值/ 分布/ 、/ 相关系数/ (/ cf/ )/ 、/ 查询/ 结果/ 大小/ (/ k/ )/ 、/ 相对/ 权值/ (/ W/ )/ 与/ 打分/ 函数/ 中/ 输入/ 的/ 维数/ (/ n/ )/ 下/ 进行/ 实验/ ./ 默认设置/ 打分/ 属性/ 值/ 分布/ 为/ 正态分布/ ,/ cf/ =/ 0.5/ ,/ k/ =/ 100/ ,/ W/ =/ 1/ ,/ n/ =/ 4/ ./ 之所以/ DIi/ (/ i/ ∈/ {/ 1/ ,/ 2/ …/ ,/ n/ }/ )/ 与/ FI/ 的/ cf/ 默认/ 取/ 0.5/ ,/ 是因为/ 一般/ DIi/ 和/ FI/ 正/ 相关/ ./ 例如/ ,/ 如果/ 一个/ 订单/ 的/ 供应商/ 地址/ 距离/ 公司/ 越近/ ,/ 客户/ 信誉/ 值越/ 高/ ,/ 那么/ 一般/ 该/ 订单/ 的/ 采购/ 量/ 也/ 越/ 大/ ./ 5/ 组/ 实验/ 的/ 详细/ 对比/ 结果/ 如下/ ./ 5.2/ ./ 1/ 打分/ 属性/ 值/ 分布/ 的/ 影响/ 图/ 2/ 比较/ 了/ Join/ 、/ RJ/ _/ Adapt/ 、/ MTJS3/ 个/ 算法/ 在/ 打分/ 属性/ 值取/ 不同/ 分布/ 时/ 的/ 性能/ 差异/ ./ 图中/ Normal/ 代表/ 正态分布/ ,/ Exp/ 代表/ 指数分布/ ./ Join/ 是/ 最/ 直观/ 的/ 做法/ ,/ 先/ 连接/ 再/ 排序/ 得到/ top/ -/ kjoin/ 结果/ ./ 由图/ 2/ 可知/ ,/ Join/ 的/ 效率/ 很/ 低/ ,/ 所以/ 本文/ 在/ 下面/ 的/ 对比/ 实验/ 中/ 忽略/ 此/ 算法/ ./ 和/ RJ/ _/ Adapt/ 相比/ ,/ MTJS/ 的/ 性能/ 更优/ :/ 在/ 指数分布/ 中/ ,/ 其/ SumCost/ 的/ 值/ 有/ 32/ %/ 左右/ 的/ 减少/ ,/ time/ 有/ 34/ %/ 左右/ 的/ 减少/ ;/ 在/ 正态分布/ 中/ ,/ 其/ SumCost/ 的/ 值/ 有/ 15/ %/ 左右/ 的/ 减少/ ,/ time/ 有/ 18/ %/ 左右/ 的/ 减少/ ./ 其/ time/ 的/ 减少/ 多于/ SumCost/ 的/ 值/ 的/ 减少/ 是因为/ :/ MTJS/ 除/ 减少/ 了/ 顺序/ 访问/ 次数/ 和/ 随机/ 访问/ 次数/ 之外/ ,/ 还/ 避免/ 了/ 多次/ 打分/ 函数/ 值/ 的/ 计算/ ,/ 且/ 使用/ 了/ 最佳/ 维等/ 方法/ ./ 5.2/ ./ 2/ 相关系数/ (/ cf/ )/ 的/ 影响/ ./ 图/ 3/ 比较/ 了/ RJ/ _/ Adapt/ 、/ MTJS/ 在/ DIi/ (/ i/ ∈/ {/ 1/ ,/ 2/ ,/ …/ ,/ n/ }/ )/ 与/ FI/ 的/ cf/ 不/ 同时/ 的/ 性能/ 差异/ ./ 当/ cf/ </ 0/ 时/ ,/ 因为/ DIi/ 与/ FI/ 负相关/ ,/ Hi/ 对应/ 的/ 维/ 主键/ 一般/ 在/ FI/ 中/ 的/ 索引/ 位置/ 较大/ ,/ 故当/ 顺序/ 访问/ FI/ 的/ 次数/ 较/ 少时/ ,/ Hi/ 处/ 的/ 频率/ 属性/ 值/ 一直/ 不能/ 被/ 更新/ 至/ 零/ ./ 此时/ ,/ MTJS/ 的/ Hi/ 更新/ 得/ 较/ 少/ ,/ 其/ 总/ 上界/ 相应/ 地/ 更新/ 得/ 也/ 较/ 少/ ,/ 所以/ MTJS/ 和/ RJ/ _/ Adapt/ 的/ 性能/ 基本/ 持平/ :/ 如/ cf/ =/ -/ 0.5/ 时/ ,/ 和/ RJ/ _/ Adapt/ 相比/ ,/ MTJS/ 的/ SumCost/ 的/ 值/ 大约/ 减少/ 1/ %/ ,/ time/ 大约/ 减少/ 1/ %/ ./ 反之/ ,/ 当/ cf/ >/ 0/ 时/ ,/ MTJS/ 的/ Hi/ 会/ 更新/ 较/ 多/ ,/ 其/ 总/ 上界/ 相应/ 的/ 更新/ 也/ 较/ 多/ ,/ 故/ 和/ RJ/ _/ Adapt/ 相比/ ,/ MTJS/ 的/ 性能/ 更优/ :/ 如/ cf/ =/ 0.75/ 时/ ,/ 其/ SumCost/ 的/ 值/ 大约/ 减少/ 24/ %/ ,/ time/ 大约/ 减少/ 26/ %/ ./ Page95/ ./ 2.3/ 查询/ 结果/ 大小/ (/ k/ )/ 的/ 影响/ :/ 由图/ 4/ 可知/ ,/ 在/ k/ (/ k/ / 10/ )/ 较/ 小时/ ,/ 两个/ 算法/ 的/ 性能/ 基本/ 持平/ ./ 因为/ 在/ k/ 较/ 小时/ ,/ 两个/ 算法/ 返回/ 得/ 都/ 很快/ ./ 此时/ MTJS/ 顺序/ 访问/ FI/ 的/ 次数/ 较/ 少/ ,/ 所以/ Hi/ 更新/ 得/ 较/ 少/ ,/ 其/ 总/ 上界/ 相应/ 地/ 更新/ 得/ 也/ 较/ 少/ ,/ 因而/ 二者/ 的/ 性能/ 差异/ 不大/ ./ 如/ k/ =/ 10/ 时/ ,/ 和/ RJ/ _/ Adapt/ 相比/ ,/ MTJS/ 的/ SumCost/ 的/ 值/ 有/ 3/ %/ 左右/ 的/ 减少/ ,/ time/ 有/ 4/ %/ 左右/ 的/ 减少/ ./ 相反/ ,/ 在/ k/ 较大/ 时/ ,/ MTJS/ 的/ Hi/ 有/ 了/ 较/ 多/ 的/ 更新/ ,/ 其/ 总/ 上界/ 相应/ 地/ 更新/ 得/ 也/ 较/ 多/ ,/ 所以/ MTJS/ 的/ 性能/ 和/ RJ/ _/ Adapt/ 相比/ 有/ 了/ 较大/ 提升/ ./ 如/ k/ =/ 1000/ 时/ ,/ SumCost/ 的/ 值/ 有/ 28/ %/ 左右/ 的/ 减少/ ,/ time/ 有/ 30/ %/ 左右/ 的/ 减少/ ./ 5.2/ ./ 4/ 线性/ 加权/ 函数/ 中/ 相对/ 权值/ (/ W/ )/ 的/ 影响/ :/ 图/ 5/ 比较/ 了/ 在/ 线性/ 加权/ 函数/ 中/ 相对/ 权值/ 不/ 同时/ 两个/ 算法/ 性能/ 的/ 差异/ ./ 这里/ 相对/ 权值/ W/ 分别/ 取/ 五组/ 数据/ :/ 0.25/ ,/ 0.5/ ,/ 1/ ,/ 2/ ,/ 4/ ./ W/ 较/ 小时/ ,/ 因为/ 事实/ 表/ 打分/ 属性/ 的/ 权值/ 较大/ ,/ 故/ MTJS/ 的/ 总/ 上界/ 大小/ 更/ 依赖/ F/ ./ latest/ ,/ 而/ F/ ./ latest/ 与/ FI/ 中/ 当前/ 未见/ 的/ 打分/ 属性/ 值/ 的/ 误差/ 更/ 小/ ,/ 故/ 此时/ 两个/ 算法/ 的/ 总/ 上界/ 都/ 较优/ ,/ 进而/ 两个/ 算法/ 一般/ 都/ 会/ 很快/ 结束/ ./ 由于/ MTJS/ 很快/ 结束/ 时/ ,/ 频率/ 属性/ 值/ 更新/ 得/ 较/ 少/ ,/ 上/ 边界/ 位/ 相应/ 地/ 更新/ 得/ 较/ 少/ ,/ 其/ 总/ 上界/ 相应/ 地/ 更新/ 得/ 也/ 较/ 少/ ,/ 故/ 两个/ 算法/ 的/ 性能/ 差异/ 不大/ ./ 如/ W/ =/ 0.5/ 时/ ,/ 和/ RJ/ _/ Adapt/ 相比/ ,/ MTJS/ 的/ SumCost/ 的/ 值/ 有/ 大约/ 0.5/ %/ 的/ 减少/ ,/ time/ 有/ 大约/ 1/ %/ 的/ 减少/ ./ 反之/ ,/ W/ 较大/ 时/ ,/ 根据/ 上边/ 的/ 分析/ ,/ 两个/ 算法/ 都/ 不会/ 很快/ 地/ 结束/ ./ 因而/ MTJS/ 对/ FI/ 的/ 顺序/ 访问/ 次数/ 较/ 多/ ,/ Hi/ 随之/ 更新/ 得/ 也/ 较/ 多/ ,/ 其/ 总/ 上界/ 相应/ 地/ 更新/ 得/ 也/ 较/ 多/ ,/ 故/ 此时/ MTJS/ 的/ 性能/ 优势/ 较为/ 明显/ ./ 如/ W/ =/ 2/ 时/ ,/ 和/ RJ/ _/ Adapt/ 相比/ ,/ MTJS/ 的/ SumCost/ 的/ 值/ 有/ 大约/ 34/ %/ 的/ 减少/ ,/ time/ 有/ 大约/ 36/ %/ 的/ 减少/ ./ 5.2/ ./ 5/ 打分/ 函数/ 中/ 输入/ 的/ 维数/ (/ n/ )/ 的/ 影响/ :/ 图/ 6/ 比较/ 了/ 在/ n/ 不/ 同时/ 两个/ 算法/ 的/ 性能/ 差异/ ./ 为/ 完成/ n/ =/ 5/ 时/ 的/ 实验/ ,/ 我们/ 在/ SSBM/ 数据/ 集中/ 添加/ 了/ 一个/ 维/ ,/ n/ =/ 6/ 时/ 同理/ ./ 当/ n/ 较/ 小时/ ,/ 两个/ 算法/ 的/ 总/ 上界/ 中取/ 最高/ 可能/ 打分/ 属性/ 值/ 的/ 项数/ 都/ 较/ 少/ ,/ 所以/ 它们/ 的/ 总/ 上界/ 都/ 相对/ 较/ 小/ ,/ 故/ 两个/ 算法/ 都/ 较/ 早/ 结束/ ./ 因此/ ,/ MTJS/ 的/ Hi/ 更新/ 得/ 较/ 少/ ,/ 其/ 总/ 上界/ 相应/ 地/ 更新/ 得/ 也/ 较/ 少/ ,/ 故其/ 和/ RJ/ _/ Adapt/ 的/ 性能/ 差异/ 并不大/ ./ 如/ 在/ n/ =/ 3/ 时/ ,/ 和/ RJ/ _/ Adapt/ 相比/ ,/ MTJS/ 的/ SumCost/ 的/ 值/ 减少/ 了/ 2.5/ %/ 左右/ ,/ time/ 减少/ 了/ 3/ %/ 左右/ ./ 反之/ ,/ 当/ n/ 较大/ 时/ ,/ MTJS/ 的/ Hi/ 更新/ 得/ 较/ 多/ ,/ 其/ Page10/ 总上界/ 相应/ 地/ 更新/ 得/ 也/ 较/ 多/ ,/ 故其/ 性能/ 优势/ 明显/ ./ 如/ 在/ n/ =/ 5/ 时/ ,/ 和/ RJ/ _/ Adapt/ 相比/ ,/ MTJS/ 的/ SumCost/ 的/ 值/ 减少/ 了/ 31/ %/ 左右/ ,/ time/ 减少/ 了/ 33/ %/ 左右/ ./ 6/ 结论/ 本文/ 考虑/ 基于/ 星型/ 模式/ 的/ 数据仓库/ 上/ 的/ top/ -/ kjoin/ 查询/ ,/ 提出/ 两类/ 索引/ 并/ 基于/ 这/ 两类/ 索引/ 给出/ 一个/ 适用/ 于/ 星型/ 模式/ 的/ 多路/ top/ -/ kjoin/ 算法/ ./ 该/ 算法/ 通过/ 采用/ 一个/ 比/ 现有/ 算法/ 更优/ 的/ 上界/ 和/ 一个/ 剪枝/ 策略/ 而/ 获得/ 了/ 更/ 高/ 的/ 效率/ ./ 以/ 执行/ 时间/ 和/ 一个/ 算法/ 代价/ 函数/ 的/ 值/ 为/ 测度/ ,/ 我们/ 对/ 本文/ 算法/ 和/ rank/ -/ join/ 的/ 一个/ 适应/ 算法/ 进行/ 了/ 若干组/ 对比/ 实验/ ./ 这些/ 实验/ 验证/ 了/ 本文/ 算法/ 的/ 性能/ 优于/ 对比/ 算法/ ./ 

