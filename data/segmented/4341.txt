Page1/ 基于/ 模糊/ XML/ 的/ 小枝/ 查询处理/ 刘健/ 马宗民璩/ 秋龙/ (/ 东北大学/ 信息科学/ 与/ 工程学院/ 沈阳/ 110004/ )/ 摘要/ 现实/ 世界/ 中/ 存在/ 大量/ 的/ 不/ 精确/ 和/ 不/ 确定/ 信息/ ,/ 因此/ ,/ 针对/ 模糊/ 数据/ 的/ 表示/ 和/ 处理/ 的/ 研究/ 工作/ 已经/ 广泛/ 展开/ ./ 作为/ 下一代/ Web/ 语言/ ,/ XML/ 已经/ 成为/ 当前/ Web/ 数据表示/ 与/ 交换/ 的/ 标准/ ./ 不/ 精确/ 和/ 不/ 确定/ 数据/ 的/ 出现/ 对/ XML/ 提出/ 了/ 新/ 的/ 挑战/ ,/ 现有/ 的/ 研究成果/ 已/ 不能/ 满足/ 模糊/ XML/ 环境/ 下/ 智能化/ 数据管理/ 的/ 迫切/ 需求/ ./ 为此/ ,/ 文中/ 在/ 模糊/ XML/ 数据模型/ 的/ 基础/ 上/ ,/ 从/ 编码/ 技术/ 入手/ ,/ 讨论/ 模糊/ XML/ 环境/ 下/ 的/ 结点/ 编码/ 问题/ ,/ 进而/ 研究/ 模糊/ XML/ 环境/ 下/ 的/ 小枝/ 查询/ 问题/ ./ 文中/ 提出/ 了/ 基于/ 模糊/ XML/ 的/ 小枝/ 模式匹配/ 算法/ ,/ 给出/ 了/ 加速/ 小枝/ 匹配/ 的/ 索引/ 算法/ ,/ 并/ 最终/ 通过/ 实验/ 证明/ 了/ 所/ 提/ 方法/ 的/ 优越性/ ./ 关键词/ Web/ ;/ 模糊/ 数据/ ;/ XML/ ;/ 小枝/ 匹配/ ;/ 索引/ 1/ 引言/ 随着/ Web/ 的/ 广泛/ 使用/ ,/ 互联网/ 已/ 成为/ 人们/ 获取信息/ 的/ 主要/ 工具/ ./ 由于/ 互联网/ 数据/ 存在/ 着/ 异构/ 性/ ,/ 为/ Page2/ 的/ 子集/ ,/ 其/ 目标/ 是/ 允许/ 普通/ 的/ SGML/ 在/ Web/ 上以/ 目前/ HTML/ 的/ 方式/ 被/ 服务/ 、/ 接收/ 和/ 处理/ ./ 与/ HTML/ 相比/ ,/ XML/ 提供/ 描述/ 结构化/ 数据/ 的/ 格式/ ,/ 具有/ 简单/ 、/ 自我/ 描述/ 的/ 特点/ ./ XML/ 是/ 一个/ 格式/ 独立/ 、/ 与/ 平台/ 和/ 应用程序/ 无关/ 的/ 语言/ ,/ 只要/ 应用程序/ 支持/ XML/ 词汇/ ,/ 就/ 能/ 在/ 应用程序/ 之间/ 无缝/ 的/ 交换/ 数据/ ./ 因此/ ,/ 处理/ XML/ 数据/ 的/ 理论/ 和/ 技术/ 成为/ 了/ 数据库/ 领域/ 中/ 的/ 一个/ 研究/ 热点/ ./ 目前/ 的/ 研究/ 主要/ 包括/ XML/ 数据模型/ 的/ 研究/ 、/ XML/ 数据/ 存储/ 、/ 查询/ 和/ 索引/ 等/ 方向/ ./ 鉴于/ 查询/ 技术/ 在/ 数据管理/ 中/ 的/ 突出/ 地位/ ,/ 如何/ 有效/ 的/ 查询/ XML/ 数据/ 自然/ 地/ 成为/ 了/ 目前/ XML/ 方向/ 研究/ 的/ 焦点/ ,/ 引起/ 了/ 学术界/ 的/ 高度/ 关注/ [/ 1/ -/ 6/ ]/ ./ 例如/ ,/ 文献/ [/ 1/ ]/ 中/ 给出/ 了/ 在/ 匹配/ 过程/ 中/ 利用/ 小枝/ 分解/ 查询处理/ 再/ 合并/ 结果/ 的/ 方法/ 寻找/ 匹配/ 解/ 的/ Stack/ -/ Tree/ 算法/ ./ 但/ 这种/ 分解/ 的/ 方法/ 通常/ 会/ 产生/ 大量/ 无用/ 的/ 中间/ 结果/ ,/ 因此/ 会/ 带来/ 较大/ 的/ 查询/ 开销/ ./ 为了/ 提高/ 查询/ 效率/ ,/ 文献/ [/ 2/ ]/ 提出/ 了/ 整体/ 匹配/ 的/ 查询/ 策略/ ,/ 该/ 方法/ 能/ 在/ 仅/ 扫描/ 一次/ 结点/ 的/ 基础/ 上/ ,/ 避免/ 不必要/ 的/ 中间/ 结果/ 的/ 产生/ ,/ 从而/ 保证/ 其/ 高效性/ ./ 在/ 现实/ 世界/ 应用/ 中/ ,/ 信息/ 通常/ 是/ 不/ 精确/ 和/ 不/ 确定/ 的/ ./ 现实/ 世界/ 具有/ 主观性/ ,/ 因此/ ,/ 某些/ 数据/ 在/ 本质/ 上/ 是/ 具有/ 模糊性/ 的/ ./ 例如/ ,/ 对于/ 一部/ 电影/ 的/ 评价/ ,/ 不同/ 的/ 人会/ 有/ 不同/ 的/ 倾向性/ ,/ 其/ 结果/ 必然/ 会/ 导致/ 评分/ 存在/ 不/ 精确/ 和/ 不确定性/ ./ 基于/ 关系/ 数据模型/ 的/ 模糊/ 关系数据库/ 已经/ 引起/ 了/ 学者/ 广泛/ 的/ 研究/ [/ 7/ -/ 9/ ]/ ,/ 当前/ 对/ 模糊/ 数据/ 的/ 研究/ 主要/ 集中/ 在/ 不/ 精确/ 和/ 不/ 确定/ 信息/ 概念/ 数据模型/ 、/ 面向对象/ 数据库/ 和/ 模糊/ 数据库/ 概念设计/ 上/ ,/ 而/ 对/ 在/ XML/ 环境/ 下/ 如何/ 有效/ 表示/ 和/ 查询/ 不/ 精确/ 和/ 不/ 确定/ 信息/ 的/ 研究/ 还/ 很少/ ,/ 只有/ 含/ 不/ 完全/ 信息/ 的/ XML/ [/ 10/ -/ 11/ ]/ 和/ 含/ 概率/ 信息/ 的/ XML/ [/ 12/ -/ 15/ ]/ 在/ 研究/ 文章/ 中/ 有所/ 讨论/ ./ 文献/ [/ 15/ ]/ 在/ 简单/ 概率模型/ 和/ 模糊/ 树/ 模型/ 的/ 基础/ 上/ ,/ 分析/ 了/ 概率/ XML/ 信息/ 的/ 有效/ 表示/ 问题/ ,/ 同时/ 也/ 解决/ 了/ 概率/ XML/ 的/ 更新/ 问题/ ./ 文献/ [/ 12/ ]/ 提出/ 了/ 一种/ 基于/ 概率/ 树结构/ 的/ 概率/ XML/ 模型/ ProTDB/ ,/ 该/ 模型/ 将/ 数据/ 信息/ 直接/ 存储/ 在/ XML/ 数据库/ 中/ ,/ 解决/ 了/ 实际/ 应用/ 中/ 关系数据库/ 难于/ 表述/ 概率/ 结构/ 数据/ 的/ 问题/ ./ 鉴于/ 小枝/ 查询/ 在/ XML/ 查询/ 问题/ 中/ 占据/ 核心/ 地位/ ,/ 文献/ [/ 16/ ]/ 提出/ 了/ 一种/ 基于/ 投影/ 的/ 概率/ XML/ 小枝/ 查询/ 算法/ ,/ 但/ 该/ 算法/ 需要/ 对/ XML/ 数据/ 进行/ 重复/ 读取/ 以/ 获得/ 最终/ 匹配/ 结果/ ,/ 这/ 需要/ 较/ 高/ 的/ 代价/ ./ 借鉴/ 整体/ 匹配/ 的/ 思想/ ,/ 文献/ [/ 17/ ]/ 利用/ 阈值/ 信息/ 对/ XML/ 数据/ 进行/ 预先/ 过滤/ ,/ 提升/ 了/ 不/ 确定/ XML/ 环境/ 下/ 的/ 小枝/ 查询/ 算法/ 效率/ ./ 从/ 现有/ 的/ 关于/ 模糊/ XML/ 研究/ 的/ 主要/ 文献/ 来看/ ,/ 该/ 领域/ 虽然/ 吸引/ 了/ 一批/ 学者/ 开展/ 研究/ 工作/ ,/ 但是/ 整体/ 来说/ 研究成果/ 还/ 很少/ [/ 18/ -/ 23/ ]/ ,/ 特别/ 对/ 模糊/ XML/ 环境/ 下/ 的/ 小枝/ 查询/ 问题/ 的/ 研究/ 还/ 处于/ 起步/ 阶段/ ,/ 许多/ 重要/ 的/ 理论/ 问题/ 和/ 技术/ 难点/ 当前/ 还是/ 研究/ 空白/ ,/ 现有/ 的/ 研究成果/ 无法/ 满足/ 在/ 模糊/ XML/ 环境/ 下/ 高效/ 处理/ 数据/ 的/ 需求/ ./ 为此/ 本文/ 将/ 重点/ 研究/ 如何/ 在/ 模糊/ XML/ 环境/ 下/ 高效/ 地/ 执行/ 小枝/ 查询/ ./ 本文/ 讨论/ 了/ 模糊/ XML/ 环境/ 下/ 的/ 结点/ 编码/ 技术/ ,/ 并/ 在/ 此基础/ 上/ ,/ 设计/ 了/ 一种/ 高效/ 的/ 小枝/ 匹配/ 算法/ ./ 同时/ 本文/ 给出/ 了/ 适于/ 用/ 模糊/ XML/ 的/ 索引/ 算法/ ,/ 该/ 算法/ 利用/ 索引/ 加速/ 了/ 无关/ 结点/ 的/ 过滤/ ,/ 进而/ 提升/ 了/ 小枝/ 查询/ 的/ 效率/ ./ 本文/ 第/ 2/ 节/ 介绍/ 模糊/ XML/ 数据模型/ 的/ 背景/ 知识/ ;/ 第/ 3/ 节/ 介绍/ 现有/ 的/ 模糊/ XML/ 结点/ 编码/ 技术/ ;/ 第/ 4/ 节/ 研究/ 模糊/ XML/ 环境/ 下/ 的/ 小枝/ 匹配/ 问题/ ;/ 第/ 5/ 节/ 讨论/ 如何/ 利用/ 索引/ 提升/ 小枝/ 查询/ 效率/ ;/ 第/ 6/ 节/ 展示/ 实验/ 结果/ ;/ 第/ 7/ 节/ 总结/ 全文/ ./ 2/ 模糊/ XML/ 数据模型/ 模糊/ XML/ 文档/ 中有/ 两类/ 模糊性/ :/ (/ 1/ )/ 一类/ 是/ 元素/ 的/ 模糊性/ ,/ 可/ 使用/ 成员/ 度/ 与/ 这样/ 的/ 元素/ 关联/ ;/ (/ 2/ )/ 一类/ 是/ 元素/ 属性/ 值/ 的/ 模糊性/ ,/ 用/ 可能性/ 分布/ 表示/ 这样/ 的/ 值/ ./ 依据/ 文献/ [/ 20/ -/ 21/ ]/ 的/ 介绍/ 可知/ ,/ 一个/ 取值/ 为/ [/ 0/ ,/ 1/ ]/ 的/ 可能性/ 属性/ “/ Poss/ ”/ 应当/ 首先/ 引入/ ,/ 它/ 与/ 一个/ 称作/ “/ Val/ ”/ 的/ 模糊/ 构造/ 子/ 共同/ 用于/ 说明/ 一个/ 给定/ 元素/ 存在/ 于/ XML/ 文档/ 的/ 可能性/ ./ 以图/ 1/ 中/ 的/ 第/ 3/ 行为/ 例/ ,/ 〈/ ValPoss/ =/ “/ 0.8/ ”/ 〉/ 表明/ 给定/ 的/ 部门/ “/ 计算机科学/ 与/ 工程/ ”/ 这个/ 元素/ 属于/ “/ 香港城市大学/ ”/ 的/ 可能性/ 等于/ 0.8/ ./ 对于/ 可能性/ 为/ 1.0/ 的/ 元素/ ,/ 标签/ 对/ 〈/ ValPoss/ =/ “/ 1.0/ ”/ 〉/ 和/ 〈/ // Val/ 〉/ 可以/ 从/ XML/ 文档/ 中/ 省略/ 掉/ ./ 基于/ 标签/ 对/ 〈/ ValPoss/ 〉/ 和/ 〈/ // Val/ 〉/ ,/ 元素/ 的/ 可能性/ 分布/ 可以/ 表示/ 出来/ ,/ 而/ 可能性/ 分布/ 也/ 可以/ 用于/ 表示/ 模糊/ 的/ 元素/ 值/ ./ 为此/ ,/ 需要/ 引入/ 一个/ 称作/ “/ Dist/ ”/ 的/ 模糊/ 构造/ 子/ ,/ 以/ 说明/ 一个/ 可能性/ 分布/ ./ 一个/ Dist/ 元素/ 典型/ 地有/ 多个/ Val/ 元素/ 作为/ 孩子/ 元素/ ,/ 每/ 一个/ 孩子/ 元素/ 带有/ 一个/ 相关联/ 的/ 可能/ 度/ ./ 例如/ 回顾/ 图/ 1/ 中/ 的/ 例子/ ,/ 第/ 24/ ~/ 34/ 行/ 和/ 第/ 38/ ~/ 44/ 行/ 分别/ 表示/ 学生/ “/ TomSmith/ ”/ 的/ 年龄/ 和/ 电子邮件/ 地址/ 可能性/ 分布/ ./ 应当/ 说明/ 的/ 是/ ,/ 在/ 实际/ 应用/ 中/ 新/ 增加/ 的/ 模糊/ 标签/ (/ 模糊/ 结点/ Dist/ ,/ Val/ 和/ Poss/ )/ 可能/ 在/ 源/ 文档/ 中/ 已经/ 存在/ ./ 此时/ 为了/ 避免/ 混淆/ ,/ 我们/ 可以/ 利用/ XML/ 命名/ 空间/ (/ namespaces/ )/ 来/ 解决/ 命名/ 冲突/ 的/ 问题/ ./ 具体来讲/ ,/ 我们/ 将/ 在/ 这些/ 模糊/ 标签/ 前/ 添加/ 独特/ 的/ 标示/ 符/ (/ 例如/ 用/ f/ :/ Dist/ ,/ f/ :/ Val/ 等/ 表示/ 模糊/ 构造/ 子/ )/ 用以/ 制/ Page31/ ./ 〈/ universities/ 〉/ 2/ ./ 〈/ universityUName/ =/ “/ 香港城市大学/ ”/ 〉/ 3/ ./ 〈/ ValPoss/ =/ “/ 0.8/ ”/ 〉/ 4/ ./ 〈/ departmentDName/ =/ “/ 计算机科学/ 与/ 工程/ ”/ 〉/ 5/ ./ 〈/ employeeFID/ =/ “/ 85431095/ ”/ 〉/ 6/ ./ 〈/ Disttype/ =/ “/ disjunctive/ ”/ 〉/ 7/ ./ 〈/ ValPoss/ =/ “/ 0.8/ ”/ 〉/ 8/ ./ 〈/ fname/ 〉/ ChrisFung/ 〈/ // name/ 〉/ 9/ ./ 〈/ position/ 〉/ 副教授/ 〈/ // position/ 〉/ 10/ ./ 〈/ office/ 〉/ B1024/ 〈/ // office/ 〉/ 11/ ./ 〈/ course/ 〉/ 数据库系统/ 〈/ // course/ 〉/ 12/ ./ 〈/ // Val/ 〉/ 13/ ./ 〈/ ValPoss/ =/ “/ 0.6/ ”/ 〉/ 14/ ./ 〈/ fname/ 〉/ ChrisFungr/ 〈/ // name/ 〉/ 15/ ./ 〈/ position/ 〉/ 教授/ 〈/ // position/ 〉/ 16/ ./ 〈/ office/ 〉/ B1024/ 〈/ // office/ 〉/ 17/ ./ 〈/ course/ 〉/ 数据库系统/ 〈/ // course/ 〉/ 18/ ./ 〈/ // Val/ 〉/ 19/ ./ 〈/ // Dist/ 〉/ 20/ ./ 〈/ // employee/ 〉/ 21/ ./ 〈/ studentSID/ =/ “/ 96421027/ ”/ 〉/ 22/ ./ 〈/ sname/ 〉/ TomSmith/ 〈/ // name/ 〉/ 23/ ./ 〈/ age/ 〉/ 24/ ./ 〈/ Disttype/ =/ “/ disjunctive/ ”/ 〉/ 25/ ./ 〈/ ValPoss/ =/ “/ 0.4/ ”/ 〉/ 23/ 〈/ // Val/ 〉/ 26/ ./ 〈/ ValPoss/ =/ “/ 0.6/ ”/ 〉/ 25/ 〈/ // Val/ 〉/ 27/ ./ 〈/ ValPoss/ =/ “/ 0.8/ ”/ 〉/ 27/ 〈/ // Val/ 〉/ 28/ ./ 〈/ ValPoss/ =/ “/ 1.0/ ”/ 〉/ 29/ 〈/ // Val/ 〉/ 29/ ./ 〈/ ValPoss/ =/ “/ 1.0/ ”/ 〉/ 30/ 〈/ // Val/ 〉/ 30/ ./ 〈/ ValPoss/ =/ “/ 1.0/ ”/ 〉/ 31/ 〈/ // Val/ 〉/ 31/ ./ 〈/ ValPoss/ =/ “/ 0.8/ ”/ 〉/ 33/ 〈/ // Val/ 〉/ 32/ ./ 〈/ ValPoss/ =/ “/ 0.6/ ”/ 〉/ 35/ 〈/ // Val/ 〉/ 33/ ./ 〈/ ValPoss/ =/ “/ 0.4/ ”/ 〉/ 37/ 〈/ // Val/ 〉/ 34/ ./ 〈/ // Dist/ 〉/ 35/ ./ 〈/ // age/ 〉/ 36/ ./ 〈/ sex/ 〉/ Male/ 〈/ // sex/ 〉/ 37/ ./ 〈/ email/ 〉/ 38/ ./ 〈/ Disttype/ =/ “/ conjunctive/ ”/ 〉/ 39/ ./ 〈/ ValPoss/ =/ “/ 0.60/ ”/ 〉/ TSmith/ @/ yahoo/ ./ com/ 〈/ // Val/ 〉/ 40/ ./ 〈/ ValPoss/ =/ “/ 0.85/ ”/ 〉/ T/ ./ Smith/ @/ yahoo/ ./ com/ 〈/ // Val/ 〉/ 41/ ./ 〈/ ValPoss/ =/ “/ 0.85/ ”/ 〉/ T/ ./ Smith/ @/ hotmail/ ./ com/ 〈/ // Val/ 〉/ 42/ ./ 〈/ ValPoss/ =/ “/ 0.55/ ”/ 〉/ TSmith/ @/ hotmail/ ./ com/ 〈/ // Val/ 〉/ 43/ ./ 〈/ ValPoss/ =/ “/ 0.45/ ”/ 〉/ TSmith/ @/ msn/ ./ com/ 〈/ // Val/ 〉/ 44/ ./ 〈/ // Dist/ 〉/ 45/ ./ 〈/ // email/ 〉/ 46/ ./ 〈/ // student/ 〉/ 47/ ./ 〈/ // department/ 〉/ 48/ ./ 〈/ // Val/ 〉/ 49/ ./ 〈/ // university/ 〉/ 50/ ./ 〈/ universityUname/ =/ “/ 东北大学/ ”/ 〉/ 51/ ./ 〈/ // university/ 〉/ 52/ ./ 〈/ // universities/ 〉/ 定/ 模糊/ 标签/ 的/ 有效/ 命名/ 空间/ ,/ 从而/ 避免/ 命名/ 混淆/ 的/ 问题/ ./ 模糊/ XML/ 文档/ 可以/ 用/ 包含/ 精确/ 结点/ (/ 即非/ 模糊/ 构造/ 子/ 和/ 可能性/ 属性/ 结点/ )/ 、/ 模糊/ 构造/ 子/ (/ Val/ 和/ Dist/ 结点/ )/ 和/ 可能性/ 属性/ (/ Poss/ 结点/ )/ 的/ 标签/ 树来/ 表示/ ./ 下面/ 我们/ 将/ 给出/ 模糊/ XML/ 数据模型/ 的/ 形式化/ 定义/ ./ 定义/ 1/ ./ 模糊/ XML/ 文档/ 树/ 定义/ 为/ 一个/ 六元/ 组/ T/ =/ (/ V/ ,/ E/ ,/ r/ ,/ φ/ ,/ ε/ ,/ δ/ )/ ,/ 其中/ :/ (/ 1/ )/ V/ 表示/ 有限/ 结点/ 集/ ,/ V/ =/ Vcri/ ∨/ Vcon/ ∨/ Vposs/ ,/ 其中/ Vcri/ 表示/ 精确/ 结点/ 的/ 集合/ ,/ Vcon/ 表示/ 模糊/ 构造/ 子/ 结点/ 的/ 集合/ ,/ Vposs/ 表示/ 可能性/ 属性/ 结点/ 的/ 集合/ ;/ Vcon/ =/ VDist/ ∨/ VVal/ ,/ VDist/ 表示/ Dist/ 模糊/ 构造/ 子/ 的/ 集合/ ,/ VVal/ 表示/ Val/ 模糊/ 构造/ 子/ 的/ 集合/ ./ (/ 2/ )/ E/ / V/ ×/ V/ 为边/ 的/ 集合/ ./ (/ 3/ )/ r/ 为树/ T/ 的/ 根/ 结点/ ./ (/ 4/ )/ φ/ :/ Vcri/ →/ L/ 表示/ 精确/ 结点/ 的/ 标示/ 函数/ ,/ 其中/ L/ 表示/ 元素/ 和/ 属性/ 名/ 的/ 集合/ ;/ φ/ :/ Vcon/ →/ {/ “/ Dist/ ”/ ,/ “/ Val/ ”/ ,/ “/ Poss/ ”/ }/ 表示/ 模糊/ 结点/ 的/ 标示/ 函数/ ,/ / v/ ∈/ VDist/ ,/ φ/ (/ v/ )/ =/ “/ Dist/ ”/ ,/ / v/ ∈/ VVal/ ,/ φ/ (/ v/ )/ =/ “/ Val/ ”/ ,/ / v/ ∈/ Vposs/ ,/ φ/ (/ v/ )/ =/ “/ Poss/ ”/ ./ (/ 5/ )/ ε/ :/ Vleaf/ →/ D/ 表示/ 叶子/ 结点/ 的/ 数据/ 值/ ,/ 其中/ Vleaf/ 表示/ 叶子/ 结点/ 的/ 集合/ ,/ D/ 表示/ 数据/ 值/ 的/ 集合/ ./ (/ 6/ )/ δ/ :/ Vcri/ ∨/ Vposs/ →/ p/ 表示/ 结点/ 的/ 可能性/ 值/ ,/ 0/ / p/ / 1.3/ 结点/ 编码/ 所谓/ XML/ 结点/ 编码/ ,/ 是/ 指/ 按照/ 某种/ 规则/ 对/ XML/ 树/ 的/ 每/ 一个/ 结点/ 分配/ 唯一/ 的/ 编码/ ,/ 目的/ 是/ 通过/ 任意/ 两个/ 结点/ 的/ 编码/ ,/ 能够/ 直接判断/ 两个/ 结点/ 之间/ 的/ 结构/ 关系/ (/ 祖先/ -/ 后代/ 关系/ 或者/ 父子关系/ )/ ,/ 进而/ 提升/ XML/ 数据处理/ 的/ 效率/ ./ 在/ 模糊/ XML/ 环境/ 下/ ,/ 为了/ 高效/ 的/ 处理/ 数据/ ,/ 我们/ 同样/ 地/ 引入/ 了/ 结点/ 编码/ 的/ 思想/ ./ 依据/ 文献/ [/ 18/ ]/ 的/ 介绍/ 可知/ ,/ 我们/ 可以/ 用/ 一个/ 五元/ 组/ (/ DocId/ ,/ LeftPos/ :/ RightPos/ ,/ LevelNum/ ,/ Fuzzy/ ,/ FuzzySequence/ )/ 表示/ 模糊/ XML/ 中/ 的/ 结点/ 编码/ 信息/ ,/ 其中/ ,/ (/ 1/ )/ DocId/ 是/ 文档/ 的/ 标识/ ;/ (/ 2/ )/ LeftPos/ 和/ RightPos/ 按照/ 先序/ 遍历/ 和/ 回溯/ 的/ 位置/ 编号/ ./ LeftPos/ 是/ 在/ 第一次/ 访问/ 该/ 结点/ 时/ 产生/ 的/ 序列号/ 信息/ ,/ RightPos/ 是/ 在/ 遍历/ 完该/ 结点/ 的/ 所有/ 后裔/ 结点/ 后/ 再/ 一次/ 访问/ 该/ 结点/ 时/ 产生/ 的/ 序列号/ 信息/ ./ 若/ LeftPos/ =/ RightPos/ ,/ 则/ 此时/ 结点/ 是/ 叶子/ 结点/ ;/ (/ 3/ )/ LevelNum/ 标识/ 结点/ 所在/ 的/ 层数/ 信息/ ./ 通常/ 认为/ 根/ 结点/ 为/ 第/ 1/ 层/ ,/ 每/ 向下/ 一层/ ,/ LevelNum/ 都/ 会/ 自动/ 加/ 1/ ;/ (/ 4/ )/ Fuzzy/ 标识/ 结点/ 的/ 性质/ (/ 区分/ 精确/ 结点/ 和/ 模糊/ 结点/ )/ ,/ 是/ 一个/ 布尔值/ 信息/ ./ 若/ Fuzzy/ =/ 1/ ,/ 则/ 表示/ 该/ 结点/ 为/ 模糊/ 结点/ ;/ 若/ Fuzzy/ =/ 0/ ,/ 则/ 表示/ 该/ 结点/ 为/ 精确/ 结点/ ;/ (/ 5/ )/ FuzzySequence/ 是/ 一个/ 有序/ 模糊/ 结点/ 集/ ,/ 用来/ 存储/ 从根/ 结点/ 到/ 当前/ 结点/ 路径/ 下/ 经过/ 的/ 模糊/ 结点/ 名称/ 、/ 类型/ 、/ 隶属/ 度/ 信息/ ./ 当/ 从/ 根/ 结点/ 到/ 当前/ 结点/ 路径/ 下/ 不/ 存在/ 模糊/ 结点/ 时/ ,/ FuzzySequence/ 为空/ ./ Page4/ 图/ 2/ 是/ 基于/ 模糊/ XML/ 文档/ 的/ 编码/ 实例/ ,/ 这里/ 我们/ 用/ “/ 圆/ ”/ 表示/ 精确/ 结点/ ,/ 用/ “/ 三角/ ”/ 表示/ 模糊/ 结点/ ./ 简便/ 起/ 见/ ,/ 本文/ 用/ Vi/ 表示/ FuzzySequence/ 信息/ ./ 由图/ 2/ 模糊/ XML/ 结点/ 编码/ 下面/ 考虑/ 模糊/ XML/ 中/ 结点/ 间/ 的/ 结构/ 关系/ 判定/ 问题/ ,/ 由于/ 模糊/ 信息/ 的/ 存在/ ,/ 我们/ 需要/ 在/ 上述/ 编码/ 基础/ 上/ 对/ 结点/ 间/ 结构/ 关系/ ,/ 尤其/ 是/ 父子/ 结构/ 关系/ 进行/ 重新/ 定义/ ./ 此时/ ,/ 结点/ 间/ 结构/ 关系/ 有/ 如下/ 定义/ ./ 定义/ 2/ ./ 设/ 结点/ Node1/ (/ D1/ ,/ L1/ :/ R1/ ,/ LN1/ ,/ F1/ ,/ FS1/ )/ ,/ Nodei/ (/ Di/ ,/ Li/ :/ Ri/ ,/ LNi/ ,/ Fi/ ,/ FSi/ )/ ,/ Noden/ (/ Dn/ ,/ Ln/ :/ Rn/ ,/ LNn/ ,/ Fn/ ,/ FSn/ )/ ,/ 1/ / i/ / n/ ,/ 分别/ 表示/ 模糊/ XML/ 中/ 的/ 结点/ 编码/ 信息/ :/ (/ 1/ )/ 若/ D1/ =/ Di/ ,/ L1/ </ Li/ ,/ Ri/ </ R1/ ,/ F2/ ∩/ Fk/ ∩/ Fi/ -/ 1/ =/ 0/ (/ 2/ / k/ / i/ -/ 1/ ,/ i/ / 3/ )/ ,/ 则/ Nodei/ 是/ Node1/ 的/ 后代/ 结点/ ,/ 二者之间/ 的/ 结构/ 关系/ 是/ 祖先/ -/ 后代/ 关系/ (/ AD/ )/ ;/ (/ 2/ )/ 若/ D1/ =/ Di/ ,/ L1/ </ Li/ ,/ Ri/ </ R1/ ,/ F1/ ∪/ Fi/ =/ 0/ ,/ LN1/ +/ 1/ =/ LNi/ ,/ 则/ Node1/ 是/ Nodei/ 的/ 实父/ 结点/ ,/ 二者之间/ 的/ 结构/ 关系/ 是/ 实/ 父子关系/ (/ RPC/ )/ ;/ (/ 3/ )/ 若/ D1/ =/ Dn/ ,/ L1/ </ Ln/ ,/ Rn/ </ R1/ ,/ F1/ ∪/ Fn/ =/ 0/ ,/ LN1/ +/ i/ =/ LNn/ ,/ 且/ Fi/ =/ 1/ ,/ 则/ Node1/ 是/ Noden/ 的/ 实父/ 结点/ ,/ 二者之间/ 的/ 结构/ 关系/ 是/ 实/ 父子关系/ (/ RPC/ )/ ;/ (/ 4/ )/ 若/ D1/ =/ Di/ ,/ L1/ </ Li/ ,/ Ri/ </ R1/ ,/ F1/ ∪/ Fi/ =/ 1/ ,/ LN1/ +/ 1/ =/ LNi/ ,/ 则/ Node1/ 是/ Nodei/ 的/ 模糊/ 父/ 结点/ ,/ 二者之间/ 的/ 结构/ 关系/ 是/ 模糊/ 父子关系/ (/ FPC/ )/ ./ 在/ 模糊/ XML/ 中/ ,/ 父子关系/ PC/ 可以/ 进一步/ 分为/ 实/ 父子关系/ RPC/ 和/ 模糊/ 父子关系/ FPC/ ./ 由/ 定义/ 2/ 可知/ ,/ (/ 1/ )/ 若/ 结点/ m/ 的/ LeftPos/ 值/ 小于/ 结点/ n/ 的/ LeftPos/ 值/ ,/ 且/ 结点/ m/ 的/ RightPos/ 值/ 大于/ 结点/ n/ 的/ RightPos/ 值时/ ,/ 则/ 结点/ m/ 必为/ n/ 的/ 祖先/ 结点/ ;/ (/ 2/ )/ 若/ 结点/ m/ 的/ LeftPos/ 值/ 小于/ 结点/ n/ 的/ LeftPos/ 值/ ,/ 且/ 结点/ m/ 不是/ n/ 的/ 祖先/ 结点/ ,/ 假设/ 结点/ k/ 的/ LeftPos/ 值/ 大于/ 结点/ n/ 的/ LeftPos/ 值/ ,/ 则/ m/ 一定/ 不是/ k/ 的/ 祖先/ 结点/ ;/ (/ 3/ )/ 若/ 在/ 同/ 一根/ 到/ 叶/ 路径/ 下/ ,/ 结点/ m/ 和/ n/ 之间/ 不/ 存在/ 其它/ 结点/ ,/ 且/ m/ 和/ n/ 同为/ 精确/ 结点/ ,/ 则/ m/ 和/ n/ 必图/ 2/ 可知/ ,/ 该/ 编码方案/ 具有/ 极强/ 的/ 描述性/ ,/ 能/ 有效/ 地/ 支持/ 精确/ 结点/ 和/ 模糊/ 结点/ 的/ 识别/ ,/ 为/ 模糊/ XML/ 中/ 的/ 小枝/ 匹配/ 处理/ 奠定/ 基础/ ./ 为实/ 父子关系/ ;/ (/ 4/ )/ 若/ 在/ 同/ 一根/ 到/ 叶/ 路径/ 下/ ,/ 精确/ 结点/ m/ 和/ n/ 之间/ 存在/ χ/ 个/ 结点/ ,/ 且/ 这/ χ/ 个/ 结点/ 同/ 为/ 模糊/ 结点/ ,/ 则/ m/ 和/ n/ 必为实/ 父子关系/ ;/ (/ 5/ )/ 若/ 在/ 同/ 一根/ 到/ 叶/ 路径/ 下/ ,/ 结点/ m/ 和/ n/ 不同/ 为/ 精确/ 结点/ ,/ 且/ m/ 和/ n/ 之间/ 不/ 存在/ 其他/ 结点/ ,/ 则/ m/ 和/ n/ 必为/ 模糊/ 父子关系/ ./ 下面/ 将/ 通过/ 图/ 2/ 具体/ 实例/ 说明/ 模糊/ XML/ 中/ 的/ 结构/ 关系/ ,/ 其中/ 结点/ CV0/ ,/ …/ ,/ CV10/ 为/ 精确/ 结点/ ,/ 结点/ V1/ ,/ V2/ ,/ V3/ ,/ V4/ ,/ V5/ 为/ 模糊/ 结点/ ./ 首先/ ,/ 由于/ CV0/ 的/ LeftPos/ 值/ 小于/ CV8/ 的/ LeftPos/ 值/ ,/ 且/ CV0/ 的/ RightPos/ 值/ 大于/ CV8/ 的/ RightPos/ 值/ ,/ 所以/ CV0/ 和/ CV8/ 之间/ 的/ 结构/ 关系/ 为/ AD/ ./ 由于/ CV1/ 的/ LeftPos/ 值/ 小于/ CV3/ 的/ LeftPos/ 值/ ,/ 且/ CV1/ 不是/ CV3/ 的/ 祖先/ 结点/ ,/ 因此/ 对于/ LeftPos/ 值/ 大于/ CV3/ 的/ LeftPos/ 值/ 的/ 任意/ 结点/ (/ 如/ CV4/ ,/ CV5/ ,/ …/ ,/ CV10/ )/ ,/ CV1/ 不/ 可能/ 为/ 其/ 祖先/ 结点/ ./ 精确/ 结点/ CV1/ 和/ CV2/ 之间/ 不/ 存在/ 其它/ 结点/ ,/ 因此/ 可知/ CV1/ 和/ CV2/ 的/ 结构/ 关系/ 为/ RPC/ ./ 对于/ 精确/ 结点/ CV3/ 和/ CV4/ ,/ 由于/ CV3/ 和/ CV4/ 之间/ 的/ 结点/ 同/ 为/ 模糊/ 结点/ ,/ 因此/ 可知/ CV3/ 和/ CV4/ 之间/ 的/ 结构/ 关系/ 也/ 是/ RPC/ ./ 对于/ 结点/ V1/ 和/ CV1/ ,/ 由于/ 不同/ 为/ 精确/ 结点/ ,/ 因此/ V1/ 和/ CV1/ 之间/ 的/ 结构/ 关系/ 为/ FPC/ ./ 同样/ 可知/ CV9/ 与/ V5/ 以及/ V2/ 与/ V3/ 之间/ 的/ 结构/ 关系/ 同为/ FPC/ ./ 4/ 模糊/ XML/ 中/ 的/ 小枝/ 查询/ 本节/ 将/ 在/ 讨论/ 模糊/ XML/ 成员/ 度/ 的/ 评估/ 以及/ 小枝/ 匹配/ 定义/ 的/ 基础/ 上/ ,/ 给出/ 小枝/ 查询/ 算法/ TwigFX/ ./ 4.1/ 成员/ 度/ 评估/ 和/ 小枝/ 匹配/ 在/ 模糊/ XML/ 树中/ ,/ 通常/ 会/ 存在/ 下面/ 3/ 类/ 包含/ Page5/ 模糊/ 信息/ 的/ 结构/ 树/ [/ 23/ ]/ :/ (/ 1/ )/ 模糊/ 信息/ 只/ 出现/ 在/ 单一/ 路径/ 中/ (/ 第/ 1/ 类/ )/ ./ (/ 2/ )/ 模糊/ 信息/ 出现/ 在/ 分叉/ 树中/ (/ 第/ 2/ 类/ )/ ./ (/ 3/ )/ 模糊/ 信息/ 出现/ 在/ 复杂/ 树中/ (/ 第/ 3/ 类/ )/ ./ 任意/ 复杂/ 的/ 模糊/ XML/ 树/ 都/ 可以/ 看成/ 是/ 由/ 上述/ 三类/ 模糊/ 树结构/ 合并/ 而/ 形成/ 的/ ./ 在/ 对/ 模糊/ XML/ 数据/ 进行/ 查询/ 时/ ,/ 首先/ 要/ 保证/ 返回/ 的/ 结果/ 绝对/ 可能性/ 不能/ 低于/ 给定/ 的/ 阈值/ 限制/ ./ 这/ 是因为/ 在/ 实际/ 应用/ 中/ 可能性/ 过低/ 的/ 结果/ 对/ 用户/ 来说/ 通常/ 是/ 无/ 意义/ 的/ ./ 我们/ 选用/ 一个/ 整体/ 成员/ 度/ 信息/ δ/ whole/ 来/ 表示/ 返回/ 结果/ 的/ 绝对/ 可能性/ ./ 图/ 3/ 举例说明/ 了/ 在/ 模糊/ XML/ 中/ 模糊/ 信息/ 可能/ 出现/ 的/ 位置/ 以及/ 相应/ 的/ 整体/ 成员/ 度/ 的/ 计算方法/ ./ 简便/ 起/ 见/ ,/ 图中/ 只/ 标注/ 了/ 成员/ 度/ 信息/ ./ 其中/ A/ ,/ B/ ,/ C/ 和/ D/ 分别/ 代表/ 结点/ 信息/ ,/ δ/ 1/ ,/ δ/ 2/ ,/ δ/ 3/ 分别/ 表示/ 的/ A/ ,/ B/ ,/ C/ 成员/ 度/ 信息/ (/ 相对/ 可能性/ )/ ,/ δ/ whole/ 表示/ 整体/ 成员/ 度/ ./ 绝对/ 可能性/ 可以/ 用/ 返回/ 结果/ 的/ 所有/ 成员/ 度/ 信息/ 的/ 交来/ 计算/ 得出/ ./ 在/ 以往/ 的/ 模糊/ 系统/ 中/ ,/ 成员/ 度/ 之间/ 的/ 交/ 运算/ 通常/ 是/ 采用/ Zadeh/ 的/ 最大/ 最小/ 技术/ [/ 24/ -/ 25/ ]/ ./ 该/ 技术/ 反映/ 了/ 人们/ 对待/ 利害/ 的/ 取舍/ 原则/ ,/ 具有/ 计算/ 简便/ 等/ 特点/ ,/ 因此/ 成为/ 最为/ 广泛/ 的/ 一对/ 算子/ ./ 然而/ ,/ 在/ 模糊/ XML/ 小枝/ 查询/ 过程/ 中/ ,/ 通过/ 该/ 算子/ 得到/ 的/ 结果/ 与/ 参与/ 运算/ 的/ 各个/ 成员/ 度/ 信息/ 缺乏/ 有效/ 的/ 交互/ ./ 例如/ ,/ 假设/ a/ 到/ b/ 的/ 路径/ 下/ 的/ 相对/ 可能性/ 为/ 0.5/ (/ 简记/ 为/ δ/ (/ a/ →/ b/ )/ =/ 0.5/ )/ ,/ 且/ δ/ (/ a/ →/ c1/ )/ =/ 0.6/ ,/ δ/ (/ a/ →/ c2/ )/ =/ 0.7/ ,/ 此时/ 在/ Zadeh/ 运算符/ 的/ 交/ 运算/ 作用/ 下/ ,/ 有/ δ/ (/ a/ →/ b/ 且/ a/ →/ c1/ )/ =/ δ/ (/ a/ →/ b/ 且/ a/ →/ c2/ )/ =/ 0.5/ ./ 而/ 在/ 实际/ 应用/ 中/ 上述/ 交/ 运算/ 结果/ 对于/ 用户/ 来说/ 应该/ 是/ 有所区别/ 的/ ./ 另外/ ,/ 若/ 已知/ δ/ (/ a/ →/ b/ 且/ a/ →/ c2/ )/ =/ 0.5/ 且/ δ/ (/ a/ →/ b/ )/ =/ 0.5/ ,/ 此时/ 通过/ Zadeh/ 运算符/ 的/ 反向/ 计算/ 并/ 不能/ 确定/ δ/ (/ a/ →/ c2/ )/ 的/ 具体/ 值/ ,/ 只能/ 是/ 获得/ 一个/ 可能/ 取值/ 区间/ ./ 由此/ 可以/ 看出/ Zadeh/ 运算/ 是/ 一种/ 粗粒度/ 运算/ ,/ 使用/ 其/ 计算/ 得到/ 的/ 结果/ 可能/ 会/ 与/ 用户/ 意图/ 有所/ 偏差/ ./ 因此/ ,/ 本文/ 选取/ 支持/ 隶属/ 度/ 交互/ 计算/ 的/ Einstein/ 算子/ [/ 23/ ]/ 作为/ 支持/ 模糊/ XML/ 小枝/ 查询/ 的/ 交/ 运算/ 因子/ ,/ 即/ 有/ 这里/ δ/ i/ 和/ δ/ j/ 分别/ 表示/ 结点/ i/ 和/ j/ 的/ 成员/ 度/ ,/ δ/ whole/ 表示/ i/ 和/ j/ 经过/ 交/ 运算/ 后/ 得到/ 的/ 整体/ 成员/ 度/ ./ XML/ 中/ 的/ 小枝/ 查询/ 实际上/ 是/ 对/ XML/ 文档/ 中/ 的/ 多个/ 结点/ 作/ 选择/ 谓词/ 运算/ ./ 小枝/ 查询/ 上/ 的/ 每/ 一个/ 结点/ ,/ 都/ 有/ 相对/ 应/ 的/ 谓词/ (/ 在/ 小枝/ 或者/ 文本/ 值上/ )/ ,/ 结点/ 之间/ 满足/ 一定/ 的/ 结构/ 关系/ (/ 祖先/ -/ 后代/ 关系/ 或者/ 父子关系/ )/ ./ 在/ 模糊/ XML/ 环境/ 下/ ,/ 小枝/ 查询/ 的/ 主旨/ 就是/ 搜索/ 模糊/ XML/ 树/ 得到/ 满足/ 给定/ 小枝/ 模式/ 的/ 查询/ 结果/ ./ 定义/ 3/ ./ 给定/ 一个/ 小枝/ 查询/ 模式/ Q/ 和/ 一个/ 模糊/ XML/ 数据库/ D/ ,/ Q/ 在/ D/ 上/ 的/ 一个/ 匹配/ 是/ 指/ 在/ Q/ 的/ 结点/ 与/ D/ 的/ 结点/ 之间/ 存在/ 这样/ 的/ 一个/ 映射/ 关系/ :/ (/ 1/ )/ 对应/ 于/ 查询/ 结点/ 的/ 目标/ 结点/ 所含/ 的/ 数据/ 必须/ 满足/ 查询/ 结点/ 上/ 的/ 谓词/ 条件/ ;/ (/ 2/ )/ 目标/ 结点/ 间/ 的/ 结构/ 关系/ 与/ 查询/ 结点/ 组合/ 间/ 的/ 结构/ 关系/ 必须/ 一致/ ;/ (/ 3/ )/ 在/ D/ 中/ 目标/ 结点/ 间/ 的/ 整体/ 成员/ 度要/ 不/ 小于/ 给定/ 的/ 阈值/ u/ (/ 0/ / u/ / 1/ )/ ./ 应当/ 说明/ 的/ 是/ ,/ 对/ 出现/ 在/ 局部/ 路径/ i/ →/ j/ 中/ 的/ 多重/ 模糊/ 信息/ ,/ 我们/ 将/ 尝试/ 对/ 其/ 进行/ 修正/ 处理/ 以/ 得到/ 一个/ 综合/ 的/ 局部/ 修正/ 成员/ 度/ δ/ revise/ (/ i/ ,/ j/ )/ ./ 通过/ 处理/ 第/ 3/ 节/ 介绍/ 的/ 编码方案/ 中/ 的/ FuzzySequence/ 特征/ ,/ 我们/ 可以/ 得到/ 一个/ 包含/ 路径/ i/ →/ j/ 中/ 的/ 所有/ 成员/ 度/ 信息/ 的/ 集合/ f/ (/ i/ ,/ j/ )/ ,/ 即/ f/ (/ i/ ,/ j/ )/ =/ (/ FSj/ -/ FSi/ )/ ./ 此时/ ,/ 局部/ 修正/ 成员/ 度/ δ/ revise/ (/ i/ ,/ j/ )/ 可/ 计算/ 如下/ :/ 这里/ ft/ 是/ 集合/ f/ (/ i/ ,/ j/ )/ 中/ 的/ 元素/ ,/ χ/ 是/ 集合/ 中/ 元素/ 的/ 个数/ ./ 现/ 举例说明/ 模糊/ XML/ 文档/ 中/ 的/ 小枝/ 匹配/ 结果/ ./ 图/ 4/ 给出/ 了/ 两个/ 不同/ 结构/ 的/ 小枝/ 查询/ (/ 简便/ 起/ 见/ ,/ 图中用/ “/ // ”/ 表示/ PC/ 关系/ ,/ “/ // // ”/ 表示/ AD/ 关系/ )/ ,/ 其中/ ,/ Q1/ 是/ 一个/ 简单/ 的/ PC/ 路径/ 查询/ ,/ Q2/ 是/ 一个/ 带/ 分支/ 结构/ 的/ AD/ 路径/ 小枝/ 查询/ ./ 在/ 图/ 2/ 中/ 数据/ 树上/ 查询/ Q1/ ,/ 由/ 模糊/ XML/ 环境/ 下/ 的/ 小枝/ 匹配/ 定义/ 可知/ ,/ 图/ 2/ 中共/ 有/ 3/ 个/ 可能/ 数据/ 树/ 满足/ 给定/ 的/ 查询/ 模式/ ,/ 它们/ 分别/ 是/ m1/ :/ {/ CV0/ →/ CV3/ →/ V/ δ/ (/ 2/ ,/ 3/ )/ →/ CV4/ }/ ,/ m2/ :/ {/ CV0/ →/ CV3/ →/ V/ δ/ (/ 2/ ,/ 4/ )/ →/ CV5/ }/ 和/ m3/ :/ {/ CV0/ →/ CV9/ →/ V5/ →/ CV10/ }/ ./ 这里/ ,/ V/ δ/ (/ 2/ ,/ 3/ )/ 和/ V/ δ/ (/ 2/ ,/ 4/ )/ 是/ 局部/ 修正/ 成员/ 度/ ,/ δ/ (/ 2/ ,/ 3/ )/ =/ δ/ 2/ ∩/ δ/ 3/ ≈/ 0.07/ ,/ δ/ (/ 2/ ,/ 4/ )/ =/ δ/ 2/ ∩/ δ/ 4/ =/ 0.25/ ./ 如果/ 给定/ 阈值/ 为/ 0.1/ 时/ ,/ 此时/ 只有/ m2/ 和/ m3/ 是/ 满足/ Page6/ 查询/ 模式/ 的/ 结果/ ,/ 而/ m1/ 不是/ ./ 这/ 是因为/ m1/ 的/ 整体/ 成员/ 度/ 小于/ 给定/ 的/ 阈值/ ,/ 也就是说/ m1/ 并/ 不/ 满足/ 模糊/ XML/ 环境/ 下/ 的/ 小枝/ 查询/ 定义/ ,/ 因此/ 其/ 将/ 不会/ 作为/ 结果/ 输出/ ./ 4.2/ 小枝/ 匹配/ 算法/ 4.2/ ./ 1/ 相关/ 符号/ 为了/ 简化/ 描述/ ,/ 首先/ 将/ 对/ 本节/ 使用/ 的/ 一些/ 符号/ 进行/ 说明/ ./ 假设/ 小枝/ 查询/ 模式/ Q/ ,/ 它/ 的/ 根/ 结点/ 为/ q/ ,/ 在/ 不/ 引起/ 混淆/ 的/ 情况/ 下/ ,/ 通常/ 也/ 直接/ 使用/ q/ 表示/ 以/ q/ 为根/ 结点/ 的/ 小枝/ 查询/ 模式/ ./ 分别/ 用/ Sq/ 和/ Tq/ 表示/ 小枝/ 查询/ 模式/ q/ 中/ 的/ 每/ 一个/ 查询/ 结点/ q/ 所/ 对应/ 的/ 栈/ 和/ 流/ 信息/ ./ 流/ Tq/ 是/ 查询/ 结点/ q/ 在/ XML/ 文档/ 流中/ 所/ 对应/ 的/ 所有/ 数据/ 结点/ 的/ 有/ 序列表/ ,/ 这里/ 的/ 数据/ 结点/ 是/ XML/ 文档/ 树中/ 的/ 元素/ 结点/ ,/ 流/ Tq/ 的/ 所有/ 数据/ 结点/ 按/ (/ DocId/ ,/ LeftPos/ )/ 升序/ 排列/ ./ 针对/ 小枝/ 查询/ 模式/ Q/ 使用/ 如下/ 的/ 结点/ 函数/ [/ 23/ ]/ :/ isLeaf/ :/ Node/ →/ Bool/ ;/ isRoot/ :/ Node/ →/ Bool/ ;/ Parent/ :/ Node/ →/ Node/ ;/ children/ :/ Node/ →/ {/ Node/ }/ ;/ subtreeNodes/ :/ Node/ →/ {/ Node/ }/ ./ 其中/ ,/ subtreeNodes/ (/ q/ )/ 返回/ 查询/ Q/ 中/ 的/ 结点/ q/ 和/ 它/ 的/ 所有/ 后裔/ 结点/ ./ / (/ i/ ,/ j/ )/ 计算/ 路径/ i/ →/ j/ 下/ 的/ 局部/ 修正/ 成员/ 度/ ,/ 若/ i/ ,/ j/ 之间/ 存在/ 模糊/ 信息/ ,/ 则/ 有/ / (/ i/ ,/ j/ )/ =/ δ/ revise/ (/ i/ ,/ j/ )/ ;/ 否则/ / (/ i/ ,/ j/ )/ =/ 1/ ./ 针对/ 流/ Tq/ 使用/ 如下/ 函数/ :/ eof/ ,/ advance/ ,/ next/ ,/ nextL/ 和/ nextR/ ./ 其中/ ,/ next/ (/ Tq/ )/ 函数/ 获得/ 流/ Tq/ 中/ 当前/ 数据/ 结点/ 的/ 下/ 一个/ 数据/ 结点/ ,/ advance/ (/ Tq/ )/ 函数/ 使流/ Tq/ 的/ 指针/ 指向/ 下/ 一个/ 数据/ 结点/ (/ 即/ 指针/ 下移/ 操作/ )/ ,/ nextL/ (/ Tq/ )/ 和/ nextR/ (/ Tq/ )/ 函数/ 分别/ 返回/ 流/ Tq/ 中下/ 一个/ 数据/ 结点/ 的/ LeftPos/ 和/ RightPos/ 值/ ./ 针对/ 栈/ Sq/ 的/ 函数/ 有/ empty/ 、/ pop/ 、/ push/ 、/ topL/ 和/ topR/ ,/ 最后/ 两个/ 函数/ 返回/ 栈顶/ 数据/ 结点/ 的/ LeftPos/ 和/ RightPos/ 值/ ./ 4.2/ ./ 2TwigFX/ 算法/ 下面/ 将/ 具体/ 给出/ TwigFX/ 查询/ 算法/ ,/ TwigFX/ 算法/ 通过/ 两/ 阶段/ 操作/ 找到/ 满足/ 小枝/ 查询/ 的/ 匹配/ 结果/ ./ 在/ 第/ 1/ 个/ 阶段/ (/ 第/ 1/ ~/ 15/ 行/ )/ ,/ 输出/ 满足/ 从/ 根到/ 叶子/ 的/ 单个/ 路径/ 查询/ 以及/ 阈值/ 限制/ 的/ 局部/ 匹配/ 结果/ ,/ 第/ 2/ 阶段/ (/ 第/ 16/ 行/ )/ 将/ 得到/ 的/ 局部/ 匹配/ 结果/ 合并/ 生成/ 满足/ 给定/ 小枝/ 查询/ 的/ 最终/ 匹配/ 结果/ ./ 算法/ 1/ ./ TwigFX/ (/ Q/ )/ ./ 输入/ :/ 小枝/ 查询/ Q/ ,/ XML/ 文档/ 流/ T/ ,/ 阈值/ u/ 输出/ :/ Q/ 的/ 匹配/ 结果/ 1/ ./ whilenotend/ (/ q/ )/ 2/ ./ qact/ =/ getNext/ (/ q/ )/ 3/ ./ if/ (/ notisRoot/ (/ qact/ )/ )/ 4/ ./ cleanStack/ (/ parent/ (/ qact/ )/ ,/ nextL/ (/ qact/ )/ )/ 5/ ./ endif6/ ./ if/ (/ isRoot/ (/ qact/ )/ ∪/ notempty/ (/ Sparent/ (/ qact/ )/ )/ )/ 7/ ./ cleanStack/ (/ qact/ ,/ nextL/ (/ qact/ )/ )/ 8/ ./ moveToStack/ (/ Tqact/ ,/ Sqact/ ,/ pointertotop/ (/ Sparent/ (/ qact/ )/ )/ )/ 9/ ./ if/ (/ isLeaf/ (/ qact/ )/ )/ 10/ ./ showSolutionsWithBlocking/ (/ Sqact/ ,/ 1/ )/ 11/ ./ pop/ (/ Sqact/ )/ 12/ ./ endif13/ ./ elseadvance/ (/ Tqact/ )/ 14/ ./ endif15/ ./ endwhile16/ ./ mergeAllPathSolutions/ (/ )/ FunctioncleanStack/ (/ S/ ,/ a/ )/ 1/ ./ while/ (/ notempty/ (/ S/ )/ ∧/ (/ topR/ (/ S/ )/ </ a/ )/ )/ 2/ ./ pop/ (/ S/ )/ 3/ ./ endwhileFunctionmoveToStack/ (/ Tq/ ,/ Sq/ ,/ p/ )/ 1/ ./ push/ (/ Sq/ ,/ (/ next/ (/ Tq/ )/ ,/ p/ )/ )/ 2/ ./ advance/ (/ Tq/ )/ Functionend/ (/ q/ )/ 1/ ./ return/ / ni/ ∈/ subtreeNodes/ (/ q/ )/ :/ isLeaf/ (/ ni/ )/ →/ eof/ (/ Tf/ )/ TwigFX/ 算法/ 在/ 第/ 2/ 行/ 循环/ 调用/ getNext/ 获得/ 下/ 一/ 处理/ 结点/ ,/ 第/ 4/ 行/ 和/ 第/ 7/ 行/ 过滤/ 掉/ 不能/ 被/ 扩展/ 成为/ 最终/ 匹配/ 的/ 结点/ ,/ 第/ 16/ 行/ 合并/ 所有/ 满足/ 从/ 根到/ 叶子/ 的/ 单个/ 路径/ 查询/ 以及/ 阈值/ 限制/ 的/ 局部/ 匹配/ 并/ 生成/ 最终/ 的/ 小枝/ 匹配/ 结果/ ./ getNext/ 算法/ 主要/ 用来/ 保证/ 其/ 返回/ 的/ 每/ 一个/ 结点/ 都/ 具有/ 一个/ 扩展/ 解/ (/ 即/ 这些/ 结点/ 满足/ 模糊/ XML/ 中/ 的/ 小枝/ 匹配/ 定义/ 且/ 都/ 会/ 参与/ 生成/ 最终/ 的/ 匹配/ 结果/ )/ ./ 若/ getNext/ (/ q/ )/ 返回/ 查询/ 树/ q/ 中/ 的/ 结点/ 为/ qi/ ,/ 则/ qi/ 满足/ :/ (/ 1/ )/ 必须/ 至少/ 有/ 一个/ 扩展/ 解/ ;/ (/ 2/ )/ 如果/ qi/ 有/ 兄弟/ 结点/ ,/ 则/ 它/ 的/ 兄弟/ 结点/ 也/ 必须/ 有/ 扩展/ 解/ (/ 否则/ 在/ 第/ 9/ 行将/ 返回/ 一个/ 更/ 低层/ 的/ 查询/ 结点/ ,/ 也就是说/ 同/ 一层/ 的/ 兄弟/ 中/ ,/ qi/ 的/ LeftPos/ 值/ 是/ 所有/ 的/ 兄弟/ 中/ 最小/ 的/ )/ ;/ (/ 3/ )/ 若/ qi/ !/ =/ q/ ,/ 则/ qi/ 的/ LeftPos/ 值要/ 比/ q/ 的/ LeftPos/ 值/ 小/ ,/ 也就是说/ ,/ qi/ 的/ 父亲/ 结点/ 也/ 不/ 具有/ 扩展/ 解/ ./ Page7/ 算法/ 2/ ./ getNext/ (/ q/ )/ ./ 1/ ./ if/ (/ isLeaf/ (/ q/ )/ )/ 2/ ./ while/ (/ / (/ parent/ (/ qi/ )/ ,/ qi/ )/ </ u/ ∪/ / (/ q/ ,/ qi/ )/ </ u/ )/ 3/ ./ advance/ (/ q/ )/ 4/ ./ returnq5/ ./ while/ (/ / (/ parent/ (/ qi/ )/ ,/ qi/ )/ </ u/ ∪/ / (/ q/ ,/ qi/ )/ </ u/ )/ 6/ ./ advance/ (/ q/ )/ 7/ ./ forqiinchildren/ (/ q/ )/ 8/ ./ ni/ =/ getNext/ (/ qi/ )/ 9/ ./ if/ (/ ni/ ≠/ qi/ )/ returnni10/ ./ nmin/ =/ minargninextL/ (/ Tni/ )/ 11/ ./ nmax/ =/ maxargninextL/ (/ Tni/ )/ 12/ ./ while/ (/ nextR/ (/ Tq/ )/ </ nextL/ (/ Tnmax/ )/ orwholeM/ (/ Tq/ )/ </ u/ )/ 13/ ./ advance/ (/ Tq/ )/ 14/ ./ if/ (/ nextL/ (/ Tq/ )/ </ nextL/ (/ Tnmin/ )/ )/ returnq15/ ./ elsereturnnminFunctionwholeM/ (/ q/ )/ 1/ ./ forqiinchildren/ (/ q/ )/ 2/ ./ mi/ =/ subWholeM/ (/ qi/ )/ 3/ ./ mj/ =/ subM/ (/ qi/ )/ // // subM/ (/ qi/ )/ returns/ δ/ revise/ (/ parent/ (/ qi/ )/ ,/ qi/ )/ 4/ ./ m/ =/ mi/ ×/ mj5/ ./ returnm/ ×/ supM/ (/ qi/ )/ // // supM/ (/ qi/ )/ returns/ δ/ revise/ (/ q/ ,/ qi/ )/ FunctionsubWholeM/ (/ q/ )/ 1/ ./ forqiinchildren/ (/ q/ )/ 2/ ./ mi/ =/ subWholeM/ (/ qi/ )/ 3/ ./ mj/ =/ subM/ (/ qi/ )/ 4/ ./ returnm/ =/ mi/ ×/ mj/ 从/ 查询/ 根/ 结点/ 出发/ ,/ getNext/ (/ q/ )/ 首先/ 判断/ 当前/ 结点/ 是否/ 为/ 叶子/ 结点/ ,/ 若/ 是/ 叶子/ 结点/ ,/ 则/ 找到/ 符合/ 查询/ 条件/ 的/ 叶子/ 结点/ 返回/ (/ 第/ 4/ 行/ )/ ./ 第/ 6/ 行/ 过滤/ 不/ 满足/ 阈值/ 限制/ (/ / (/ parent/ (/ qi/ )/ ,/ qi/ )/ / u/ 且/ / (/ q/ ,/ qi/ )/ / u/ )/ 的/ 结点/ ./ 在/ 第/ 8/ ~/ 10/ 行/ ,/ 我们/ 循环/ 调用/ getNext/ 来/ 返回/ 给定/ q/ 结点/ ,/ 在/ 这个/ 过程/ 中/ ,/ 需要/ 保证/ 其/ 孩子/ 结点/ 都/ 有/ 扩展/ 解/ ./ 在/ 第/ 10/ ~/ 15/ 行/ ,/ getNext/ (/ q/ )/ 通过/ 递归/ 调用/ 从/ 最/ 左边/ 的/ 叶子/ 结点/ 开始/ 向上/ 检查/ ,/ 查找/ 尽可能/ 高/ 的/ 具有/ 扩展/ 解/ 的/ 查询/ 结点/ ./ 若流/ Tq/ 不/ 存在/ Tni/ 的/ 公共/ 祖先/ ,/ 则/ 返回/ 具有/ 最小/ LeftPos/ 值/ 的/ 孩子/ 结点/ nmin/ ,/ 此时/ getNext/ 将/ 进入/ 第/ 9/ 行/ 并/ 依次/ 返回/ 结点/ ni/ ./ 下面/ 将/ 通过/ 例子/ 说明/ TwigFX/ 如何/ 通过/ getNext/ 算法/ 在/ 图/ 5/ 所示/ 的/ 模糊/ XML/ 数据/ 上/ 查询/ 图/ 4/ 中/ 的/ 小枝/ 模式/ Q2/ ./ 图/ 5/ 中/ 每个/ 元素/ 的/ 下标/ 表示/ 该/ 元素/ 所在/ 的/ 数据/ 序列/ 中/ 的/ 顺序/ ,/ 简便/ 起/ 见/ ,/ 我们/ 用/ 一个/ 上下/ 双向/ 箭头/ 表示/ 在/ 两个/ 结点/ i/ ,/ j/ 间/ 存在/ 模糊/ 信息/ ,/ 它们/ 之前/ 的/ 值/ 表示/ 其/ 局部/ 修正/ 成员/ 度/ δ/ revise/ (/ i/ ,/ j/ )/ ./ 流/ A/ ,/ B/ ,/ C/ 和/ D/ 初始/ 指向/ a1/ ,/ b1/ ,/ c1/ 和/ d1/ ,/ 假设/ 给定/ 的/ 阈值/ 为/ 0.2/ ./ 算法/ 首先/ 调用/ getNext/ (/ A/ )/ 来/ 判断/ A/ 是否/ 有解/ ,/ 由于/ A/ 是/ 根/ 结点/ 且/ / (/ a1/ ,/ a1/ )/ =/ 1/ ,/ 满足/ 匹配/ 条件/ ,/ 所以/ 对/ A/ 的/ 孩子/ B/ 调用/ getNext/ 算法/ ,/ 由于/ / (/ a1/ ,/ b1/ )/ =/ 0.9/ >/ 0.2/ ,/ 故对/ B/ 的/ 孩子/ C/ 和/ D/ 调用/ getNext/ 算法/ 并/ 判断/ 其/ 是否/ 有解/ ,/ 在/ 调用/ getNext/ (/ C/ )/ 的/ 时候/ ,/ 由于/ C/ 是/ 叶子/ 结点/ 且/ / (/ a1/ ,/ c1/ )/ =/ 0.9/ ×/ 0.8/ // (/ 1/ +/ 0.1/ ×/ 0.2/ )/ ≈/ 0.71/ >/ 0.2/ ,/ 所以/ c1/ 被/ 返回/ 上/ 一层/ (/ getNext/ (/ B/ )/ )/ 调用/ ./ 同理/ ,/ 在/ 调用/ getNext/ (/ D/ )/ 的/ 时候/ ,/ 由于/ D/ 是/ 叶子/ 结点/ 且/ / (/ a1/ ,/ d1/ )/ =/ 0.9/ ×/ 0.7/ // (/ 1/ +/ 0.1/ ×/ 0.3/ )/ ≈/ 0.61/ >/ 0.2/ ,/ 所以/ d1/ 被/ 返回/ 上/ 一层/ (/ getNext/ (/ B/ )/ )/ 调用/ ./ 由/ subWholeM/ (/ b1/ )/ =/ 0.8/ ×/ 0.7/ // (/ 1/ +/ 0.2/ ×/ 0.3/ )/ ≈/ 0.53/ >/ 0.2/ 且/ wholeM/ (/ b1/ )/ =/ 0.53/ ×/ 0.9/ // (/ 1/ +/ 0.37/ ×/ 0.1/ )/ ≈/ 0.46/ >/ 0.2/ 可知/ ,/ 结点/ b1/ 具有/ 扩展/ 解/ ,/ 所以/ b1/ 被/ 返回/ 上/ 一层/ (/ getNext/ (/ A/ )/ )/ 调用/ ./ 由于/ a1/ 是/ b1/ 的/ 父/ 结点/ ,/ 也就是说/ a1/ 满足/ 匹配/ 条件/ 我们/ 将/ 其/ 压入/ 栈/ SA/ 中/ ./ 接下来/ 将/ 对/ 具有/ 最小/ LeftPos/ 值/ 的/ b1/ 调用/ getNext/ 算法/ 进行/ 新一轮/ 的/ 判断/ ,/ 由/ 先前/ 的/ 分析/ 我们/ 已经/ 知道/ b1/ 同样/ 具有/ 扩展/ 解/ ,/ 所以/ 我们/ 将/ b1/ 压入/ 栈/ SB/ 中/ ./ 类似/ 地/ ,/ c1/ 和/ d1/ 分别/ 被/ 压入/ 栈/ SC/ 和/ SD/ 中/ ./ 进而/ 可知/ ,/ (/ a1/ ,/ b1/ ,/ c1/ ,/ d1/ )/ 是/ 查询/ 的/ 一个/ 匹配/ 结果/ ./ 接下来/ 进入/ 新一轮/ 循环/ ,/ 算法/ 再次/ 调用/ getNext/ (/ A/ )/ ,/ 重复/ 先前/ 的/ 调用/ 过程/ ,/ 首先/ 对/ A/ 的/ 孩子/ B/ 调用/ getNext/ 算法/ ,/ 再/ 对/ B/ 的/ 孩子/ C/ 和/ D/ 调用/ getNext/ ,/ 由于/ subWholeM/ (/ b2/ )/ =/ 0.5/ ×/ 0.5/ // (/ 1/ +/ 0.5/ ×/ 0.5/ )/ =/ 0.2/ ,/ 而/ wholeM/ (/ b2/ )/ =/ 0.2/ ×/ 0.8/ // (/ 1/ +/ 0.8/ ×/ 0.2/ )/ ≈/ 0.14/ </ 0.2/ ,/ 进而/ 可知/ ,/ 结点/ b2/ 不/ 具有/ 扩展/ 解/ ,/ 此时/ b2/ 将/ 被/ 跳/ 过/ ,/ 并/ 将/ 流/ 数据/ TB/ 向下/ 移动/ 到/ b3/ ./ 再/ 经过/ 两次/ 调用/ getNext/ (/ A/ )/ ,/ 当前/ 流/ 指针/ 将/ 指向/ (/ a2/ ,/ b3/ ,/ c3/ ,/ d3/ )/ ,/ 在/ 下/ 一次/ 调用/ getNext/ (/ A/ )/ 时/ ,/ 由于/ / (/ a1/ ,/ c3/ )/ =/ 0.6/ ×/ 0.2/ // (/ 1/ +/ 0.4/ ×/ 0.8/ )/ ≈/ 0.09/ </ 0.2/ ,/ 可知/ 其/ 不/ 具有/ 扩展/ 解/ ,/ 所以/ 将流/ 数据/ TC/ 向下/ 移动/ ,/ 经过/ 4/ 次/ 对流/ 数据/ TC/ 的/ 判断/ ,/ 直到/ 流/ 数据/ TC/ 的/ 末尾/ 也/ 未/ 发现/ 满足/ / (/ q/ ,/ qi/ )/ / u/ 条件/ 的/ C/ 结点/ ./ 类似/ 地/ ,/ 直到/ 流/ 数据/ TD/ 的/ 末尾/ 也/ 未/ 发现/ 满足/ / (/ q/ ,/ qi/ )/ / u/ 条件/ 的/ D/ 结点/ ./ 据此/ 可/ 进一步/ 判断/ ,/ 流/ 数据/ TA/ 和/ TB/ 余下/ 的/ 结点/ 都/ 不/ 具有/ 扩展/ 解/ ,/ 至此/ 算法/ 处理完毕/ ./ Page8/ 定理/ 1/ ./ 算法/ TwigFX/ 能/ 保证/ 只有/ 能/ 形成/ 最终/ 匹配/ 解/ 的/ 有用/ 元素/ 可以/ 入栈/ 且/ 每个/ 局部/ 匹配/ 解都/ 将/ 参与/ 到/ 最终/ 解/ 的/ 构成/ 中/ ./ 证明/ ./ 根据/ 算法/ 2/ 可知/ ,/ getNext/ 算法/ 所/ 返回/ 的/ 查询/ 结点/ q/ 都/ 可以/ 得到/ 一个/ 能/ 形成/ 最终/ 匹配/ 解/ 的/ 有用/ 元素/ Tq/ ./ 由/ 算法/ 1/ 可知/ ,/ 如果/ 一个/ 元素/ 不能/ 形成/ 最终/ 的/ 匹配/ 解/ ,/ 则/ 相应/ 的/ 流/ 数据/ 在/ 算法/ 1/ 的/ 第/ 13/ 行将/ 前移/ 到/ 下/ 一个/ 元素/ ;/ 若/ 一个/ 元素/ 能/ 形成/ 最终/ 的/ 匹配/ 解/ ,/ 则/ 它/ 将/ 被/ 压入/ 栈/ 中/ 保存/ ,/ 此时/ 该/ 元素/ 和/ 其他/ 关联/ 栈中/ 的/ 元素/ 之间/ 满足/ 给定/ 查询/ 的/ 结构/ 以及/ 阈值/ 的/ 约束条件/ ./ 因此/ 每个/ 仅/ 由/ 有用/ 元素/ 构成/ 的/ 局部/ 匹配/ 解将/ 参与/ 到/ 最终/ 的/ 匹配/ 解/ 的/ 构成/ 中/ ./ 证毕/ ./ 定理/ 2/ ./ 对于/ 给定/ 的/ 小枝/ 查询/ Q/ 和/ 模糊/ XML/ 文档/ D/ ,/ 算法/ TwigFX/ 正确/ 返回/ Q/ 在/ D/ 上/ 的/ 所有/ 解/ ./ 证明/ ./ 算法/ 1/ 递归/ 调用/ 算法/ 2/ 用以/ 返回/ 具有/ 扩展/ 解/ 的/ 每/ 一个/ 结点/ ./ 由/ 定理/ 1/ 可知/ ,/ 所有/ 有用/ 元素/ 都/ 将/ 入栈/ 保存/ ./ 当/ 处理/ 到/ 查询/ 叶子/ 元素/ 时/ ,/ 将/ 在/ 算法/ 1/ 第/ 10/ 行/ 产生/ 相应/ 的/ 局部/ 匹配/ 解/ ,/ 并/ 将/ 在/ 算法/ 1/ 第/ 16/ 行/ 形成/ 最终/ 匹配/ 解/ ./ 由于/ 产生/ 的/ 局部/ 匹配/ 解/ 包含/ 了/ 能/ 形成/ 最终/ 匹配/ 解/ 的/ 所有/ 有用/ 元素/ ,/ 因此/ 说/ 算法/ TwigFX/ 能/ 正确/ 返回/ 给定/ 查询/ Q/ 在/ 模糊/ XML/ 文档/ D/ 上/ 的/ 所有/ 解/ ./ 在/ 最坏/ 情况/ 下/ ,/ 对于/ 仅/ 包含/ 祖先/ 后代/ 边/ 的/ 小枝/ 查询/ TwigFX/ 算法/ 的/ I/ // O/ 和/ CPU/ 时间/ 复杂度/ 与/ n/ 个/ 输入/ 列表/ 大小/ 和/ 最后/ 匹配/ 结果/ 大小/ 的/ 总和/ 成/ 线性关系/ ,/ 即为/ O/ (/ |/ T1/ |/ +/ |/ T2/ |/ +/ …/ +/ |/ Tn/ |/ +/ |/ output/ |/ )/ ,/ 与/ 从/ 根到/ 叶子/ 路径/ 查询/ 的/ 局部/ 匹配/ 结果/ 的/ 大小/ 无关/ ;/ 空间/ 复杂度/ (/ 即栈/ 链/ 的/ 大小/ )/ 是/ n/ 个/ 输入/ 列表/ 大小/ 总和/ 与/ 模糊/ XML/ 文档/ 树/ 高度/ 的/ n/ 倍/ 两者/ 中/ 的/ 最小值/ ,/ 即为/ min/ (/ |/ T1/ |/ +/ |/ T2/ |/ +/ …/ +/ |/ Tn/ |/ ,/ n/ ×/ height/ (/ T/ )/ )/ ./ 应当/ 说明/ 的/ 是/ ,/ 对于/ 包含/ 父子/ 边/ 的/ 小枝/ 查询/ ,/ TwigFX/ 算法/ 不能/ 保证/ I/ // O/ 和/ CPU/ 是/ 最优/ 的/ ./ 此时/ ,/ 对于/ 小枝/ 模式/ 的/ 一条/ 从/ 根到/ 叶/ 的/ 路径/ 查询/ ,/ 算法/ 可能/ 产生/ 一个/ 局部/ 匹配/ 结果/ ,/ 它/ 不能/ 和/ 其他/ 的/ 局部/ 匹配/ 结果/ 进行/ 合并/ 连接/ ./ 5/ 优化/ TwigFX/ 算法/ 需要/ 对/ 所有/ 的/ 输入/ 列表/ 分别/ 顺序/ 扫描/ 一次/ 以/ 获得/ 所有/ 匹配/ 结果/ ,/ 当/ 输入/ 列表/ 很大/ 时/ ,/ 这种/ 扫描/ 往往/ 会/ 需要/ 一定/ 的/ I/ // O/ 开销/ ./ 在/ 实际/ 处理/ 中/ 我们/ 通常/ 可以/ 利用/ 索引/ 来/ 尽可能/ 多地/ 跳/ 过/ 并/ 不/ 参与/ 合并/ 连接/ 的/ 数据/ 结点/ ,/ 进而/ 提升/ 小枝/ 匹配/ 效率/ ./ 为此/ 在/ 传统/ XB/ -/ tree/ [/ 2/ ]/ 基础/ 上/ ,/ 本节/ 将/ 着重/ 介绍/ 如何/ 在/ 模糊/ XML/ 环境/ 下/ 利用/ XB/ -/ tree/ 索引/ 来/ 加速/ 小枝/ 匹配/ ./ 在/ 模糊/ XML/ 中/ ,/ XB/ -/ tree/ 中/ 的/ 每/ 一个/ 结点/ 都/ 代表/ 一组/ 流/ 数据/ (/ 该组/ 流/ 数据/ 中/ 的/ 任意/ 结点/ i/ 都/ 包含/ 在/ 限定/ 的/ (/ LeftPos/ :/ RightPos/ )/ 区间/ 内/ ,/ 即/ 其/ 满足/ i/ ./ LeftPos/ >/ LeftPos/ 和/ i/ ./ RightPos/ </ RightPos/ )/ ,/ 位于/ XB/ -/ tree/ 的/ 叶子/ 结点/ (/ 简称/ 叶子/ 页/ )/ 记录/ 着/ 包含/ 编码/ 信息/ (/ LeftPos/ :/ RightPos/ ,/ LevelNum/ ,/ Fuzzy/ ,/ FuzzySequence/ )/ 的/ XML/ 流/ 数据/ ,/ 而/ XB/ -/ tree/ 中/ 的/ 非/ 叶子/ 结点/ (/ 简称/ 非/ 叶子/ 页/ )/ 中/ 只/ 存储/ 索引/ 范围/ 信息/ ,/ 而/ 并/ 不/ 包含/ 实际/ 的/ XML/ 流/ 数据/ ,/ 用/ (/ LeftPos/ :/ RightPos/ ,/ N/ ./ pointer/ )/ 形式/ 来/ 记录/ 其/ 信息内容/ ,/ 其中/ N/ ./ pointer/ 是/ 一个/ 指针/ ,/ 该/ 指针/ 指向/ XB/ -/ tree/ 的/ 一个/ 孩子/ ,/ 该/ 孩子/ 中/ 的/ 所有/ 数据/ 都/ 包含/ 在/ (/ LeftPos/ :/ RightPos/ )/ 区间/ 内/ ./ XB/ -/ tree/ 中/ 每/ 一/ 结点/ P/ 都/ 含有/ 一个/ 指针/ P/ ./ Parent/ 和/ 一个/ 整数/ P/ ./ ParentIndex/ ,/ P/ ./ Parent/ 指向/ 该/ 结点/ 的/ 父/ 结点/ ,/ P/ ./ ParentIndex/ 用于/ 定位/ 父/ 结点/ 中/ 的/ 一个/ 元素/ (/ 该/ 元素/ 记录/ 索引/ 范围/ 信息/ )/ ,/ 该/ 元素/ 的/ 指针/ 指/ 回/ 当前/ 结点/ P/ ,/ XB/ -/ tree/ 中/ 结点/ 按照/ LeftPos/ 值/ 的/ 升序/ 顺序排列/ ./ 我们/ 将/ 用/ 指针/ actPointer/ =/ (/ actPage/ ,/ actIndex/ )/ 来/ 维护/ 并/ 记录/ 当前/ 数据流/ 的/ 位置/ ./ 当/ XML/ 数据/ 发生/ 更新/ 时/ ,/ 对于/ 需要/ 删除/ 的/ XML/ 结点/ ,/ 我们/ 只/ 在/ 该/ 删除/ 结点/ 作/ 删除/ 标记/ ,/ 而/ 并/ 不/ 在/ 其/ 物理/ 结构/ 上/ 真正/ 删除/ 该/ 结点/ ,/ 从而/ 保持/ 索引/ 结构/ 的/ 完整性/ ./ 此时/ ,/ XB/ -/ tree/ 索引/ 维护/ 的/ 主要/ 问题/ 就/ 转变成/ 了/ 新/ 插入/ 结点/ 或子/ 树/ 的/ 编码/ 更新/ 问题/ ./ 在/ 实际/ 维护/ 中/ ,/ 我们/ 可以/ 在/ 建立/ XB/ -/ tree/ 索引/ 的/ 过程/ 中/ 预留/ 部分/ 空间/ 以便/ 未来/ 新/ 结点/ 的/ 插入/ ,/ 即当/ 插入/ 结点/ 时/ 尽量/ 引起/ 叶子/ 页/ 的/ 内部/ 调整/ ,/ 而/ 不是/ 整个/ 索引/ 文件/ 结构/ 的/ 调整/ ,/ 从而/ 增强/ XB/ -/ tree/ 索引/ 的/ 可维护性/ ./ XB/ -/ tree/ 索引/ 的/ 所/ 需/ 空间/ 大小/ 等于/ 叶子/ 页/ 所/ 占/ 空间/ 与非/ 叶子/ 页/ 所/ 占/ 空间/ 之/ 和/ ./ 假设/ 一个/ 页/ (/ 数据/ 块/ )/ 的/ 大小/ 为/ N/ ,/ 每个/ 页/ 中/ 必须/ 保留/ 的/ 最小/ 空间/ 比例/ 为/ 1/ -/ p/ ,/ XML/ 结点/ 数为/ n/ ,/ 叶子/ 页/ 中/ 每个/ 索引/ 行/ 的/ 大小/ 为/ m/ ,/ 非/ 叶子/ 页/ 中/ 每个/ 索引/ 行/ 的/ 大小/ 为/ k/ ,/ 则/ 可知/ 所/ 需/ 的/ XB/ -/ tree/ 叶子/ 页/ 的/ 个数/ 为/ mn/ // Np/ ,/ 所/ 需非/ 叶子/ 页/ 的/ 个数/ 为/ mnk/ // (/ Np/ )/ 2/ ./ 因此/ XB/ -/ tree/ 索引/ 的/ 大小/ 为/ mn/ (/ Np/ +/ k/ )/ // Np2/ ./ 应当/ 指出/ 的/ 是/ ,/ 由于/ 我们/ 为/ 每个/ 查询/ 结点/ q/ 所/ 对应/ 的/ 流/ Tq/ 数据/ 结点/ 都/ 建立/ 了/ 一个/ 对应/ 的/ XB/ -/ tree/ 索引/ ,/ 且/ 在/ 索引/ 建立/ 以及/ 维护/ 过程/ 中/ 采用/ 了/ 预留/ 空间/ 以及/ 添加/ 删除/ 标记/ 的/ 策略/ ,/ 因此/ 所/ 建/ 索引/ 具有/ 很/ 好/ 的/ 可伸缩性/ ./ XB/ -/ tree/ 主要/ 有/ 两个/ 操作/ :/ (/ 1/ )/ advance/ 操作/ ,/ 如果/ Page9/ 当前/ 指针/ actPointer/ =/ (/ actPage/ ,/ actIndex/ )/ 没有/ 指向/ 最后/ 一个/ 结点/ ,/ 我们/ 只是/ 简单/ 的/ 前移/ actIndex/ ,/ 否则/ 我们/ 利用/ (/ actPage/ ./ parent/ ,/ actPage/ ./ parentIndex/ )/ 来/ 代替/ actPointer/ ,/ 并/ 将/ 它/ 前移/ ;/ (/ 2/ )/ drilldown/ 操作/ ,/ 如果/ 当前/ 指针/ actPointer/ =/ (/ actPage/ ,/ actIndex/ )/ 中/ actPage/ 不是/ XB/ -/ tree/ 中/ 叶子/ 页/ ,/ 而/ N/ 是/ 第/ actIndex/ 个/ 结点/ 时/ ,/ 我们/ 将/ 用/ (/ N/ ./ pointer/ ,/ 0/ )/ 替换/ actPointer/ 来/ 指向/ N/ ./ Pointer/ 中/ 的/ 第一个/ 孩子/ 结点/ ./ 算法/ 3/ ./ TwigIndex/ (/ Q/ )/ ./ 输入/ :/ 小枝/ 查询/ Q/ ,/ XML/ 文档/ 流/ T/ ,/ 阈值/ u/ 输出/ :/ Q/ 的/ 匹配/ 结果/ 1/ ./ whilenotend/ (/ q/ )/ 2/ ./ qact/ =/ getNextNode/ (/ q/ )/ 3/ ./ if/ (/ isPlainValue/ (/ Tqact/ )/ )/ 4/ ./ if/ (/ notisRoot/ (/ qact/ )/ )/ 5/ ./ cleanStack/ (/ parent/ (/ qact/ )/ ,/ nextL/ (/ qact/ )/ )/ 6/ ./ endif7/ ./ if/ (/ isRoot/ (/ qact/ )/ ∪/ notempty/ (/ Sparent/ (/ qact/ )/ )/ )/ 8/ ./ cleanStack/ (/ qact/ ,/ nextL/ (/ qact/ )/ )/ 9/ ./ moveToStack/ (/ Tqact/ ,/ Sqact/ ,/ pointertotop/ (/ Sparent/ (/ qact/ )/ )/ )/ 10/ ./ if/ (/ isLeaf/ (/ qact/ )/ )/ 11/ ./ showSolutionsWithBlocking/ (/ Sqact/ ,/ 1/ )/ 12/ ./ pop/ (/ Sqact/ )/ 13/ ./ endif14/ ./ elseadvance/ (/ Tqact/ )/ 15/ ./ endif16/ ./ elseif/ (/ notisRoot/ (/ qact/ )/ ∩/ empty/ (/ Sparent/ (/ qact/ )/ )/ ∩/ 17/ ./ advance/ (/ Tqact/ )/ 18/ ./ elsedrilldown/ (/ Tqact/ )/ 19/ ./ endwhile20/ ./ mergeAllPathSolutions/ (/ )/ 下面/ 我们/ 将/ 介绍/ 基于/ 索引/ 的/ TwigIndex/ 算法/ ,/ 该/ 算法/ 是/ 在/ TwigFX/ 算法/ 基础/ 上/ 利用/ XB/ -/ tree/ 索引/ 来/ 尽可能/ 多地/ 跳/ 过/ 并/ 不/ 参与/ 连接/ 的/ 结点/ ./ 在/ 模糊/ XML/ 环境/ 下/ 生成/ 的/ 所有/ 匹配/ 解要/ 经过/ 三重/ 过滤/ :/ 第一重/ 过滤/ 是/ 指/ 当前/ 结点/ qact/ 与/ 它/ 的/ 查询/ 父亲/ 结点/ parent/ (/ qact/ )/ 要/ 满足条件/ / (/ parent/ (/ qact/ )/ ,/ qact/ )/ / u/ 的/ 限制/ ,/ 不/ 满足/ 此/ 限制/ 的/ 结点/ 将/ 首先/ 被/ 过滤/ 掉/ ;/ 第二重/ 过滤/ 是/ 指/ 当前/ 结点/ 到/ 查询/ 根/ 结点/ qroot/ 需/ 满足/ / (/ qroot/ ,/ qact/ )/ / u/ 的/ 限制/ ,/ 不/ 满足/ 此/ 限制/ 的/ 结点/ 将/ 被/ 过滤/ 掉/ ;/ 第三重/ 过滤/ 是/ 指/ 如果/ 当前/ 结点/ 是/ 分支/ 结点/ 的话/ ,/ 则/ 它/ 需要/ 满足/ wholeM/ (/ qact/ )/ / u/ 的/ 条件/ 限制/ ,/ 不/ 满足/ 该/ 限制/ 的/ 结点/ 并/ 不会/ 参与/ 最终/ 匹配/ ,/ 因此/ 也/ 应该/ 被/ 过滤/ 掉/ ./ TwigIndex/ 算法/ 同样/ 也/ 分/ 两/ 阶段/ 执行/ ,/ 在/ 第一阶段/ (/ 第/ 1/ ~/ 19/ 行/ )/ 将/ 输出/ 经过/ 三重/ 过滤/ 满足/ 从/ 根到/ 叶子/ 的/ 单个/ 路径/ 查询/ 的/ 局部/ 匹配/ 结果/ ,/ 第二阶段/ (/ 第/ 20/ 行/ )/ 将/ 前/ 一/ 阶段/ 得到/ 的/ 局部/ 匹配/ 结果/ 合并/ 得到/ 最终/ 解/ ./ 函数/ isPlainValue/ (/ 第/ 3/ 行/ )/ 是/ 一个/ bool/ 函数/ ,/ 若/ 当前/ 结点/ 流/ 指针/ 指向/ XB/ -/ tree/ 的/ 叶子/ 页/ 结点/ ,/ 则/ 其/ 返回/ true/ ,/ 否则/ 将/ 返回/ false/ ./ 一旦/ 确认/ 当前/ 结点/ 为/ XB/ -/ tree/ 叶子/ 页/ 结点/ 时/ ,/ TwigIndex/ 将/ 对/ 栈/ 中/ 结点/ 进行/ 清栈/ (/ 第/ 5/ 行/ 和/ 第/ 8/ 行/ )/ ,/ 并/ 输出/ 经过/ 三重/ 过滤/ 的/ 从/ 根到/ 叶子/ 的/ 单/ 路径/ 解/ (/ 第/ 11/ 行/ )/ ./ 若/ 当前/ 结点/ qact/ 不是/ 根/ 结点/ ,/ 其父/ 结点/ 栈/ Sparent/ (/ qact/ )/ 为空/ ,/ 且/ 其父/ 结点/ 流中/ 当前/ 结点/ Tparent/ (/ qact/ )/ 的/ LeftPos/ 值/ 大于/ 当前/ 结点/ 流中/ 结点/ Tqact/ 的/ RightPos/ 值/ ,/ 此时/ 当前/ 结点/ Tqact/ 及其/ 后代/ 结点/ 都/ 不能/ 参与/ 生成/ 最终/ 解/ ,/ 因此/ 它们/ 将/ 被/ 直接/ 跳过/ (/ 第/ 16/ ~/ 18/ 行/ )/ ./ 与/ getNext/ 类似/ ,/ getNextNode/ 首先/ 将/ 对/ 当前/ 结点/ 进行/ 判断/ ,/ 并/ 过滤/ 掉/ 不/ 满足/ 前/ 两重/ 过滤/ 条件/ 的/ 结点/ (/ 第/ 3/ 和/ 6/ 行/ )/ ./ 紧接着/ ,/ 将/ 对/ 当前/ 结点/ 的/ 每/ 一个/ 孩子/ 递归/ 调用/ getNextNode/ (/ 第/ 7/ ~/ 9/ 行/ )/ ,/ 若/ 调用/ 后/ 的/ 结点/ ni/ 不是/ 当前/ 孩子/ 结点/ 或是/ isPlainValue/ 返回/ false/ 值/ ,/ 则/ 将/ 返回/ ni/ ,/ 因为/ :/ (/ 1/ )/ 如果/ 递归/ 调用/ 后/ 得到/ 的/ 结点/ 不是/ 当前/ 孩子/ 结点/ ,/ 则/ 存在/ 具有/ 更/ 小/ LeftPos/ 值/ 的/ 可能/ 满足/ 查询/ 的/ 结点/ 没有/ 处理/ ;/ (/ 2/ )/ 若/ isPlainValue/ (/ Tni/ )/ 返回/ false/ 值/ ,/ 则/ 不能/ 确定/ 当前/ 结点/ 是否/ 有/ 扩展/ 解/ (/ 因为/ XB/ -/ tree/ 非/ 叶子/ 页/ 只/ 存储/ 索引/ 范围/ 信息/ ,/ 而/ 并/ 不/ 包含/ 实际/ 的/ XML/ 流/ 数据/ )/ ,/ 所以/ 同样/ 需要/ 返回/ ni/ ./ getNextNode/ 算法/ 主要/ 用来/ 返回/ 一个/ 结点/ ,/ 该/ 结点/ 若/ 是/ XB/ -/ tree/ 非/ 叶子/ 页/ 中/ 的/ 一个/ 结点/ ,/ 则/ 它/ 将/ 不会/ 成为/ 最终/ 解/ 的/ 一部分/ ,/ 此时/ 将/ 进入/ TwigIndex/ 算法/ 的/ 第/ 16/ ~/ 18/ 行/ 运行/ ;/ 若/ 其/ 是/ XB/ -/ tree/ 叶子/ 页/ 中/ 的/ 一个/ 结点/ (/ 该/ 结点/ 已经/ 过/ 三重/ 过滤/ )/ ,/ 则/ 将/ 进入/ TwigIndex/ 算法/ 的/ 第/ 4/ ~/ 15/ 行/ 运行/ ./ 算法/ 4/ ./ getNextNode/ (/ q/ )/ ./ 1/ ./ if/ (/ isLeaf/ (/ q/ )/ )/ 2/ ./ while/ (/ parent/ (/ qi/ )/ ,/ qi/ )/ </ u/ ∪/ / (/ q/ ,/ qi/ )/ </ u/ )/ 3/ ./ advance/ (/ q/ )/ 4/ ./ returnq5/ ./ while/ (/ / (/ parent/ (/ qi/ )/ ,/ qi/ )/ </ u/ ∪/ / (/ q/ ,/ qi/ )/ </ u/ )/ 6/ ./ advance/ (/ q/ )/ 7/ ./ forqiinchildren/ (/ q/ )/ 8/ ./ ni/ =/ getNextNode/ (/ qi/ )/ 9/ ./ if/ (/ ni/ ≠/ qi/ ∪/ notisPlainValue/ (/ Tni/ )/ )/ returnni10/ ./ nmin/ =/ minargninextL/ (/ Tni/ )/ 11/ ./ nmax/ =/ maxargninextL/ (/ Tni/ )/ 12/ ./ while/ (/ nextR/ (/ Tq/ )/ </ nextL/ (/ Tnmax/ )/ orwholeM/ (/ Tq/ )/ </ u/ )/ 13/ ./ advance/ (/ Tq/ )/ 14/ ./ if/ (/ nextL/ (/ Tq/ )/ </ nextL/ (/ Tnmin/ )/ )/ returnq15/ ./ elsereturnnminPage10/ 下面/ 将/ 通过/ 例子/ 说明/ TwigIndex/ 算法/ 如何/ 在/ 图/ 6/ 所示/ 的/ 模糊/ XB/ -/ tree/ 上/ 执行/ 图/ 4/ 中/ 的/ 小枝/ 查询/ Q2/ ./ 初始状态/ 时/ ,/ A/ ,/ B/ ,/ C/ 和/ D4/ 个流/ 指针/ 分别/ 指向/ (/ 1225/ ,/ pointer/ )/ ,/ (/ 310/ ,/ pointer/ )/ ,/ (/ 49/ ,/ pointer/ )/ 和/ (/ 1623/ ,/ pointer/ )/ ./ 第一次/ 调用/ getNextNode/ (/ A/ )/ 时/ ,/ 将/ 调用/ getNextNode/ (/ B/ )/ ,/ 进而/ 调用/ getNextNode/ (/ C/ )/ 和/ getNextNode/ (/ D/ )/ ./ 调用/ getNextNode/ (/ C/ )/ 时/ 将/ 返回/ 当前/ C/ 的/ 指针/ (/ 49/ ,/ pointer/ )/ ,/ 因为/ 该/ 结点/ 是非/ 叶子/ 页/ 结点/ 且/ 其/ RightPos/ 值/ 大于/ 父亲/ 流/ B/ 当前/ 结点/ 的/ LeftPos/ 值/ ,/ 因此/ 流/ C/ 的/ 指针/ 将/ 指向/ (/ 45/ ,/ 4/ ,/ 0/ ,/ 0.90/ ./ 80.7/ )/ (/ 参见/ TwigIndex/ 算法/ 的/ 第/ 18/ 行/ )/ ./ 同理/ 调用/ getNextNode/ (/ D/ )/ 时流/ D/ 的/ 指针/ 将/ 指向/ (/ 1617/ ,/ 4/ ,/ 0/ ,/ 0.80/ ./ 70.8/ )/ ./ 返回/ getNextNode/ (/ B/ )/ 的/ 调用/ 后/ ,/ 将/ 返回/ 当前/ 结点/ (/ 310/ ,/ pointer/ )/ ,/ 因为/ 流/ B/ 当前/ 结点/ 的/ RightPos/ 值/ 小于/ 父亲/ 流/ A/ 当前/ 结点/ 的/ LeftPos/ 值/ ,/ 且/ A/ 栈为/ 空/ ,/ B/ 不为/ 根/ ,/ 所以/ TwigIn/ -/ dex/ 将流/ B/ 的/ 指针/ 前移/ 到/ 结点/ (/ 1324/ ,/ pointer/ )/ ,/ 由此/ 直接/ 跳过/ 了/ 流/ B/ 中/ 不/ 参与/ 匹配/ 的/ 结点/ (/ (/ 310/ ,/ 3/ ,/ 0/ ,/ 0.90/ ./ 8/ )/ 和/ (/ 69/ ,/ 4/ ,/ 0/ ,/ 0.90/ ./ 80.7/ )/ )/ ./ 当/ 第二次/ 调用/ getNextNoede/ (/ A/ )/ 时/ ,/ 同样/ 地/ 递归/ 调用/ getNextNode/ (/ B/ )/ ,/ 继而/ 递归/ 调用/ getNextNode/ (/ C/ )/ 和/ getNextNode/ (/ D/ )/ ./ getNextNode/ (/ C/ )/ 将/ 返回/ (/ 45/ ,/ 4/ ,/ 00.90/ ./ 80.7/ )/ ,/ getNextNode/ (/ D/ )/ 将/ 返回/ (/ 1617/ ,/ 图/ 6/ 模糊/ XB/ -/ tree6/ 性能/ 测试/ 与/ 分析/ 6.1/ 实验/ 设置/ 为了/ 评价/ 算法/ 的/ 性能/ ,/ 我们/ 进行/ 了/ 大量/ 的/ 实验/ ,/ 本/ 节/ 描述/ 实验/ 的/ 结果/ ,/ 并/ 对/ 其/ 进行/ 分析/ ./ 我们/ 选择/ 了/ 基于/ PossibleWorlds/ 的/ EVALDP/ 算法/ [/ 16/ ]/ 以及/ C/ -/ Twig/ 算法/ [/ 18/ ]/ 作为/ 基于/ 整体/ 匹配/ 方法/ 的/ 代表/ 与/ 本文/ 提出/ 的/ 算法/ 进行/ 比较/ ./ 选取/ 它们/ 作/ 比较/ 是因为/ 它们/ 是/ 目前/ 处理/ 基于/ 模糊/ XML/ 小枝/ 查询/ 问题/ 中/ 4/ ,/ 0/ ,/ 0.80/ ./ 70.8/ )/ ./ 当/ 返回/ getNextNode/ (/ B/ )/ 调用/ 时/ ,/ 由于/ 流/ C/ 当前/ 结点/ 的/ LeftPos/ 值/ 小于/ 父亲/ 流/ B/ 当前/ 结点/ 的/ LeftPos/ 值/ ,/ 所以/ 流/ C/ 的/ 指针/ 前移/ 到/ 结点/ (/ 78/ ,/ 5/ ,/ 0/ ,/ 0.90/ ./ 80.70/ ./ 6/ )/ ./ 再次/ 调用/ getNextNode/ (/ A/ )/ 时/ ,/ TwigIndex/ 会/ 重复/ 前/ 两次/ 调用/ getNextNode/ (/ A/ )/ 的/ 过程/ ,/ 将会/ 返回/ 流/ C/ 中/ 结点/ (/ 78/ ,/ 5/ ,/ 0/ ,/ 0.90/ ./ 80.70/ ./ 6/ )/ ,/ 并/ 将/ 指针/ 下移/ 到/ 结点/ (/ 1415/ ,/ 4/ ,/ 0/ ,/ 0.80/ ./ 70.6/ )/ ./ 下/ 一次/ 调用/ getNextNode/ 将/ 返回/ 流/ B/ 中/ 结点/ (/ 1324/ ,/ pointer/ )/ ,/ 在/ 处理/ 完流/ B/ 中/ 结点/ (/ 1318/ ,/ 3/ ,/ 0/ ,/ 0.80/ ./ 7/ )/ 后/ 进入/ 下/ 一次/ getNextNode/ 调用/ 时/ ,/ 将/ 对流/ A/ 中/ 返回/ 结点/ (/ 1225/ ,/ 2/ ,/ 0/ ,/ 0.8/ )/ 入栈/ ,/ 此时/ 流/ A/ 处理完毕/ ./ 下/ 一次/ 调用/ getNextNode/ 将/ 对流/ B/ 中/ 结点/ (/ 1318/ ,/ 3/ ,/ 0/ ,/ 0.80/ ./ 7/ )/ 入栈/ ,/ 并/ 下移/ 当前/ 指针/ 到/ 结点/ (/ 1924/ ,/ 3/ ,/ 0/ ,/ 0.80/ ./ 7/ )/ ./ 同样/ 地/ 将/ 对流/ C/ 中/ 返回/ 的/ 结点/ (/ 1415/ ,/ 4/ ,/ 0/ ,/ 0.80/ ./ 70.6/ )/ 以及/ 流/ D/ 中/ 返回/ 的/ 结点/ (/ 1617/ ,/ 4/ ,/ 0/ ,/ 0.80/ ./ 70.8/ )/ 入栈/ 处理/ 并/ 下移/ 对应/ 的/ 当前/ 指针/ ,/ 输出/ 匹配/ 结果/ (/ (/ 1225/ ,/ 2/ ,/ 0/ ,/ 0.8/ )/ ,/ (/ 1318/ ,/ 3/ ,/ 0/ ,/ 0.80/ ./ 7/ )/ ,/ (/ 1415/ ,/ 4/ ,/ 0/ ,/ 0.80/ ./ 70.6/ )/ ,/ (/ 1617/ ,/ 4/ ,/ 0/ ,/ 0.80/ ./ 70.8/ )/ 是/ Q2/ 的/ 第一个/ 解/ )/ ./ 在/ 下/ 一次/ 调用/ getNextNode/ 时/ ,/ 由于/ 流/ D/ 中/ 的/ 当前/ 结点/ (/ 2223/ ,/ 4/ ,/ 0/ ,/ 0.80/ ./ 70.1/ )/ 不能/ 满足/ 三重/ 过滤/ 的/ 要求/ ,/ 且流/ A/ ,/ B/ ,/ C/ 和/ D/ 都/ 已/ 指向/ 末尾/ ,/ 故/ 整个/ 处理完毕/ ./ 非常/ 有/ 代表性/ 的/ 算法/ ./ 所有/ 的/ 测试程序/ 均/ 用/ JAVA/ 编写/ ,/ 实验/ 测试/ 平台/ 是/ 采用/ IntelPentiumDual1/ ./ 80GHzCPU/ 、/ 1GBRAM/ 、/ 160GB/ 硬盘/ 、/ WindowsXP/ 专业版/ 的/ PC机/ ./ 实验/ 采用/ 了/ XML/ 数据/ 集/ ①/ TreeBank/ 和/ Mondial/ ,/ 其中/ ,/ TreeBank/ 数据/ 集/ 的/ 大小/ 为/ 82MB/ ,/ 有/ 2437666/ 个/ 元素/ 结点/ ,/ 最大/ 深度/ 是/ 36/ ,/ 平均/ 深度/ 为/ 7.9/ ./ ①/ UniversityofWashingtonXMLRepository/ ./ AvailablefromPage11Mondial/ 数据/ 集/ 的/ 大小/ 为/ 1MB/ ,/ 有/ 22453/ 个/ 元素/ 结点/ ,/ 最大/ 深度/ 是/ 5/ ,/ 平均/ 深度/ 为/ 3.6/ ./ TreeBank/ 数据/ 集/ 深度/ 较大/ ,/ 结点/ 数量/ 和/ 类型/ 较/ 多/ ,/ 相对来说/ ,/ Mondial/ 数据/ 集/ 深度/ 较/ 小/ ,/ 结点/ 数量/ 和/ 类型/ 较少/ ./ 为了/ 与/ 现有/ 的/ 基于/ 模糊/ XML/ 的/ 小枝/ 查询/ 算法/ 进行/ 有效/ 比较/ ,/ 我们/ 选用/ 了/ 文献/ [/ 16/ ]/ 中/ 使用/ 的/ RandomWalk/ 的/ 方法/ 来/ 生成/ 模糊/ XML/ 文档/ ./ 所谓/ RandomWalk/ 是/ 指/ 对于/ 一个/ 随机/ 选取/ 的/ 结点/ v/ ,/ 随机/ 生成/ 模糊/ 结点/ (/ 生成/ 过程/ 中/ 可以/ 控制/ 模糊/ 结点/ 的/ 数量/ ,/ 模糊/ 结点/ 的/ 成员/ 度/ 取值/ 范围/ 为/ [/ 0/ ,/ 1/ ]/ )/ 作为/ v/ 的/ 孩子/ 结点/ ,/ 新/ 生成/ 的/ 模糊/ 结点/ 将/ 作为/ 原来/ v/ 的/ 孩子/ 结点/ 的/ 父/ 结点/ ./ 为了/ 方便/ 测试/ ,/ 我们/ 从/ TreeBank/ 中/ 抽取/ 部分/ 并/ 采用/ RandomWalk/ 方法/ 生成/ 3/ 个/ 不同/ 大小/ 的/ FTreeBank/ 测试数据/ 集/ (/ 简记/ 为/ FTB1/ ,/ FTB2/ 和/ FTB3/ ,/ 默认/ 情况/ 下/ 将/ 选取/ FTB3/ 作为/ FTreeBank/ 的/ 测试数据/ 集/ )/ ,/ 这/ 3/ 个/ 数据/ 集/ 分别/ 包含/ 100/ 万/ ,/ 150/ 万/ 和/ 200/ 万个/ 结点/ ./ 我们/ 用/ RandomWalk/ 方法/ 同时/ 生成/ 了/ FMondial/ 测试数据/ 集/ ,/ 该/ 数据/ 集/ 包含/ 4/ 万个/ 结点/ ./ 生成/ 的/ FTreeBank/ 和/ FMondial/ 保留/ 了/ TreeBank/ 和/ Mndial/ 数据/ 集/ 的/ 深度/ 和/ 结点/ 类型/ 等/ 结构特征/ ,/ 具体/ 使用/ 到/ 的/ 查询/ 如表/ 1/ 和表/ 2/ 所示/ ./ 查询/ FT1FT2FT3FT4/ 查询/ FM1/ // // mondial/ // // country/ // // province/ // // cityFM2/ // // country/ [/ // // population/ ]/ // // province/ // // nameFM3/ // // mondial/ // // country/ [/ // // province/ ]/ // // populationFM4/ // // mondial/ [/ // continent/ ]/ // // country/ [/ // province/ ]/ // // border6/ ./ 2/ 实验/ 结果/ 与/ 分析/ 为了/ 评估/ 算法/ 的/ 性能/ ,/ 我们/ 选取/ 访问/ 结点/ 数量/ 图/ 7FTreeBank/ 上/ 算法/ 性能/ 比较/ 和/ 执行/ 时间/ 作为/ 评价/ 指标/ ,/ 前者/ 能/ 反映/ 算法/ 跳过/ 不/ 相关/ 结点/ 的/ 能力/ ,/ 而/ 后者/ 用于/ 反映/ 算法/ 的/ 综合性/ 能/ ./ 首先/ 分别/ 在/ 具有/ 不同/ 结构/ 的/ FTreeBank/ 和/ FMondial/ 数据/ 集上/ 对/ 所有/ 算法/ 进行/ 测试/ ,/ 实验/ 结果/ 如图/ 7/ 和/ 图/ 8/ 所示/ ./ 从图/ 7/ (/ a/ )/ 和/ 图/ 8/ (/ a/ )/ 可知/ ,/ 在/ 处理/ 小枝/ 查询/ 时/ ,/ TwigIndex/ 需要/ 访问/ 的/ 结点/ 数目/ 明显/ 要/ 少于/ 其他/ 算法/ ./ 这/ 是因为/ :/ (/ 1/ )/ EVALDP/ 在/ 合并/ 局部/ 解/ 过程/ 中/ 需要/ 重复/ 读取/ 大量/ 的/ 中间/ 连接/ 结点/ ;/ (/ 2/ )/ C/ -/ Twig/ 和/ TwigFX/ 在/ 生成/ 结果/ 过程/ 中/ ,/ 虽然/ 不/ 存在/ 重复/ 读取/ 中间/ 结点/ 的/ 问题/ ,/ 但是/ 仍/ 需/ 访问/ 所有/ 输入/ 列表/ 中/ 的/ 结点/ ;/ (/ 3/ )/ TwigIndex/ 既/ 不/ 存在/ 重复/ 读取/ 中间/ 结点/ 的/ 问题/ ,/ 又/ 不/ 需要/ 对/ 所有/ 输入/ 列表/ 中/ 的/ 结点/ 进行/ 扫描/ ,/ 而是/ 利用/ 索引/ 大量/ 地/ 跳/ 过/ 了/ 并/ 不/ 参与/ 合并/ 连接/ 的/ 结点/ ./ 另外/ ,/ 从图/ 7/ (/ b/ )/ 和/ 图/ 8/ (/ b/ )/ 可以/ 看出/ ,/ EVALDP/ 需要/ 的/ 运行/ 时间/ 最/ 多/ ,/ C/ -/ Twig/ 次之/ ,/ 接下来/ 是/ TwigFX/ ,/ 而/ TwigIndex/ 要/ 明显/ 地快/ 于/ 其他/ 算法/ ./ 这是/ 由于/ :/ (/ 1/ )/ EVALDP/ 未/ 充分/ 对/ 不/ 参与/ 合并/ 连接/ 结点/ 进行/ 过滤/ ,/ 进而/ 产生/ 了/ 大量/ 无用/ 的/ 中间/ 结果/ ,/ 带来/ 了/ 较大/ 的/ 查询/ 开销/ ;/ (/ 2/ )/ 尽管/ C/ -/ Twig/ 和/ TwigFX/ 读取/ 相同/ 数量/ 的/ 结点/ ,/ 但/ C/ -/ Twig/ 是/ 在/ 合并/ 之后/ 再/ 对/ 中间/ 结果/ 进行/ 整体/ 成员/ 度/ 过滤/ ,/ 而/ TwigFX/ 则/ 是/ 在/ getNext/ 过程/ 中/ 对/ 返回/ 结点/ 进行/ 整体/ 成员/ 度/ 过滤/ ./ 这/ 也就是说/ ,/ C/ -/ Twig/ 仍然/ 会/ 产生/ 一定/ 的/ 冗余/ 中间/ 结果/ ,/ 自然/ 也/ 需要/ 一定/ 的/ 额外/ 开销/ ./ 但是/ 由于/ TwigFX/ 仍/ 需/ 扫描/ 一次/ 所有/ 输入/ 列表/ 中/ 的/ 结点/ ,/ 并/ 没有/ 充分/ 跳过/ 不/ 参与/ 合并/ 连接/ 的/ 结点/ ,/ 因此/ 查询/ 效率/ 仍/ 有/ 提升/ 空间/ ;/ (/ 3/ )/ TwigIndex/ 利用/ 索引/ 和/ 阈值/ 信息/ ,/ 充分/ 过滤/ 了/ 不/ 参与/ 合并/ 连接/ 的/ 结点/ ,/ 因此/ 性能/ 要/ 优于/ 其他/ 算法/ ./ 从图/ 7/ 和/ 图/ 8/ 可以/ 看出/ ,/ TwigIndex/ 在/ 不同/ 结构/ 的/ 数据/ 集下/ 始终/ 要/ 比/ TwigFX/ 、/ C/ -/ Twig/ 和/ EVALDP/ 的/ 执行/ 效率高/ 很多/ ./ 由此/ 可以/ 分析/ 出/ ,/ 本文/ 所/ 提出/ 的/ 索引/ 优化/ 技术/ 对于/ 具有/ 不同/ 结构/ 的/ 模糊/ XML/ 数据/ 集都/ 能/ 起到/ 提升/ 查询/ 性能/ 的/ 作用/ ./ Page12/ 图/ 8FMondial/ 上/ 算法/ 性能/ 比较/ 图/ 9/ 给出/ 了/ 所有/ 算法/ 在/ 不同/ 大小/ FTreeBank/ 数据/ 集/ (/ FTB1/ 、/ FTB2/ 和/ FTB3/ )/ 下/ 执行/ FT4/ 查询/ 时/ 的/ 访问/ 结点/ 数目/ 以及/ 查询/ 响应/ 时间/ 的/ 变化/ 曲线/ (/ 因为/ FT1/ 、/ FT2/ 和/ FT3/ 的/ 变化/ 曲线图/ 与/ FT4/ 类似/ ,/ 简便/ 起/ 见/ ,/ 我们/ 这里/ 省略/ 了/ FT1/ 、/ FT2/ 和/ FT3/ 的/ 变化/ 曲线图/ )/ ./ 从图/ 9/ 中/ 可以/ 看到/ ,/ 随着/ 访问/ 结点/ 数目/ 的/ 增加/ ,/ 所有/ 算法/ 的/ 执行/ 时间/ 都/ 会/ 平稳/ 地/ 增大/ ,/ 但图/ 9/ 不同/ 大小/ FTreeBank/ 数据/ 集下/ 算法/ 性能/ 比较/ 图/ 10/ 给出/ 了/ 查询/ FM4/ 随着/ FMondial/ 文档/ 中/ 模糊/ 结点/ 数目/ 变化/ 时/ 查询/ 响应/ 时间/ 的/ 变化/ 曲线/ (/ 因为/ FM1/ ,/ FM2/ 和/ FM3/ 的/ 变化/ 曲线图/ 与/ FM4/ 类似/ ,/ 简便/ 起/ 见/ ,/ 我们/ 这里/ 省略/ 了/ FM1/ ,/ FM2/ 和/ FM3/ 的/ 变化/ 曲线图/ )/ ./ 从图/ 10/ 中/ 可以/ 发现/ ,/ TwigFX/ 和/ Twig/ -/ Index/ 在/ 模糊/ 结点/ 数目/ 增多/ 时其/ 所/ 需/ 执行/ 时间/ 都/ 比较稳定/ ./ 由此/ 可以/ 分析/ 出/ 模糊/ XML/ 文档/ 中/ 模糊/ 结点/ 数目/ 对/ 查询/ 性能/ 影响/ 并/ 不是/ 很大/ ./ 这/ 是因为/ TwigFX/ 和/ TwigIndex/ 只/ 需要/ 扫描/ 与/ 查询/ 有关/ 的/ 输入/ 列表/ 中/ 的/ 结点/ (/ 而/ 不是/ 所有/ 结点/ )/ ,/ 就/ 可以/ 得到/ 所有/ 参与/ 合并/ 连接/ 的/ 结点/ ,/ 因此/ ,/ 其/ 运行/ 时间/ 并/ 不会/ 随/ 模糊/ 结点/ 的/ 增多/ 而/ 发生/ 显著/ 变化/ ./ 另外/ 从图/ 10/ 中/ 还/ 可以/ 看出/ TwigIndex/ 始终保持/ 着/ 对/ TwigFX/ 的/ 性能/ 优势/ ,/ 而/ 这种/ 优势/ 并/ 不/ 随/ 模糊/ 结点/ 数目/ 变化/ 而/ 变化/ ./ 这/ 是因为/ TwigIndex/ 比/ TwigFX/ 更能/ 有效/ 地/ 过滤/ 掉/ 不/ 参与/ 合并/ 连接/ 的/ 结点/ ,/ 因此/ ,/ TwigIndex/ 的/ 查询/ 性能/ 更高/ ./ TwigIndex/ 在/ 所有/ 测试/ 集下/ 始终/ 要/ 比/ TwigFX/ 、/ C/ -/ Twig/ 和/ EVALDP/ 更加/ 高效/ ./ 由此/ 可以/ 分析/ 出/ ,/ 本文/ 所/ 提出/ 的/ 索引/ 优化/ 技术/ 对于/ 不同/ 大小/ 的/ 模糊/ XML/ 数据/ 集都/ 能/ 起到/ 提升/ 查询/ 性能/ 的/ 作用/ ./ 结合/ 之前/ 图/ 7/ 和/ 图/ 8/ 的/ 实验/ 结果/ 可以/ 有效/ 地/ 证明/ ,/ 本文/ 所/ 提出/ 的/ 索引/ 方法/ 对/ 查询/ 优化/ 起/ 作用/ ,/ 能/ 显著/ 地/ 提升/ 模糊/ XML/ 环境/ 下/ 的/ 小枝/ 查询/ 性能/ ./ 7/ 结论/ XML/ 已经/ 成为/ 了/ 当前/ Web/ 信息/ 表示/ 和/ 交换/ 的/ 标准/ ./ 在/ 实际/ 应用/ 中/ ,/ 由于/ 信息/ 通常/ 具有/ 不/ 精确/ 和/ 不确定性/ ,/ 因此/ 模糊/ XML/ 的/ 研究/ 得到/ 了/ 广泛/ 的/ 重视/ ./ 本文/ 针对/ XML/ 查询/ 中/ 的/ 核心/ 操作/ -/ 小枝/ 查询/ 匹配/ 问题/ 进行/ 了/ 研究/ ,/ 讨论/ 了/ 模糊/ XML/ 环境/ 下/ 的/ 小枝/ Page13/ 查询/ 及其/ 索引/ 技术/ ,/ 研究/ 了/ 如何/ 在/ 模糊/ XML/ 环境/ 下/ 实现/ 对/ 小枝/ 模式/ 的/ 查询/ 匹配/ ./ 在/ 引入/ 编码/ 技术/ 的/ 基础/ 上/ ,/ 本文/ 设计/ 了/ 一种/ 高效/ 的/ 小枝/ 匹配/ 算法/ ,/ 另外/ ,/ 本文/ 还/ 设计/ 了/ 适于/ 用/ 模糊/ XML/ 数据/ 的/ 索引/ 算法/ ,/ 利用/ 其/ 尽可能/ 多地/ 跳/ 过/ 并/ 不/ 参与/ 合并/ 连接/ 的/ 数据/ 结点/ ,/ 进而/ 提升/ 整体/ 小枝/ 查询/ 算法/ 的/ 效率/ ./ 未来/ 工作/ 将/ 继续/ 关注/ 模糊/ XML/ 环境/ 下/ 包含/ 父子/ 边/ 的/ 小枝/ 查询/ 优化/ 技术/ 以及/ 如何/ 在/ 动态/ 更新/ 情况/ 下/ 查询/ 小枝/ 模式/ 和/ 建立/ 索引/ 等/ 问题/ ./ 

