Page1/ 移动/ 设备/ 应用程序/ 的/ 体系结构/ 特征分析/ 黄永兵/ 陈明宇/ (/ 中国科学院/ 大学/ 北京/ 100190/ )/ (/ 中国科学院计算技术研究所/ 先进/ 计算机系统/ 研究/ 中心/ 北京/ 100190/ )/ 摘要/ 移动/ 设备/ 如/ 智能手机/ 、/ 平板/ 电脑/ 已/ 成为/ 最/ 主要/ 的/ 电子/ 消费品/ ,/ 且/ 呈现出/ 快速增长/ 的/ 趋势/ ./ 移动/ 设备/ 上/ 运行/ 的/ 应用程序/ 种类/ 丰富/ 多样/ ,/ 对/ 硬件平台/ 上/ 不同/ 资源/ 的/ 需求/ 也/ 大不相同/ ;/ 而/ 移动/ 设备/ 的/ 硬件平台/ 在/ 性能/ 和/ 功耗/ 上/ 有/ 其/ 自身/ 的/ 局限性/ ./ 因而/ ,/ 分析/ 移动/ 设备/ 应用程序/ 体系结构/ 层次/ 的/ 特征/ ,/ 对于/ 硬件平台/ 如/ 处理器/ 、/ 内存/ 等/ 资源/ 部件/ 的/ 设计/ ,/ 以及/ 应用程序/ 的/ 优化/ ,/ 具有/ 指导性/ 的/ 意义/ ./ 文中/ 选取/ 了/ Android/ 操作系统/ 上/ 的/ 多类/ 常用/ 的/ 应用程序/ ,/ 深入/ 地/ 分析/ 了/ 其/ 在/ 主流/ 移动/ 设备/ 上/ 的/ 微/ 体系结构/ 相关/ 的/ 特征/ ./ 结果表明/ ,/ 移动/ 设备/ 的/ 应用程序/ 普遍存在/ 较/ 高/ 的/ 指令/ 缓存/ 和/ 指令/ 转换/ 后援/ 缓冲器/ 缺失/ 率/ ,/ 并且/ 分支/ 预测/ 失败率/ 也/ 较/ 高/ ./ 基于/ 各/ 程序/ 的/ 体系结构/ 特征/ ,/ 文中/ 抽取/ 了/ 部分/ 最具/ 代表性/ 特征/ 的/ 应用程序/ ,/ 并/ 提出/ 了/ 一个/ 用于/ 体系结构/ 研究/ 的/ 移动/ 设备/ 基准/ 测试程序/ Moby/ ./ Moby/ 测试程序/ 包括/ 了/ 浏览器/ 、/ 邮件/ 客户端/ 、/ 音乐/ 及/ 视频/ 播放器/ 、/ 文档/ 阅读器/ 及/ 地图/ 等/ 应用/ ./ 同时/ ,/ 文中/ 还/ 详细分析/ 了/ Moby/ 测试程序/ 微/ 体系结构/ 无关/ 的/ 特征/ ,/ 如/ 指令/ 的/ 组成/ 、/ 指令/ 局部性/ 特征/ 、/ 工作/ 集/ 大小/ 及/ 指令/ 执行/ 流等/ ./ 关键词/ 移动/ 设备/ ;/ 应用程序/ ;/ 体系结构/ 特征/ ;/ 移动/ 互联网/ ;/ 移动/ 设备/ 基准/ 测试程序/ 1/ 引言/ 移动/ 互联网/ 的/ 兴起/ 正在/ 逐渐/ 地/ 改变/ 用户/ 的/ 生活/ 方式/ ,/ 移动/ 设备/ 从/ 简单/ 的/ 通信/ 功能/ 机/ 转变/ 为/ 执行/ 信息/ 收集/ 、/ 集成/ 、/ 共享/ 等/ 功能/ 复杂/ 的/ 智能/ 终端/ ./ 移动/ 设备/ 如/ 智能手机/ 、/ 平板/ 电脑/ 已/ 成为/ 最/ 主要/ 的/ 电子/ 消费品/ ,/ 而且/ 依旧/ 呈现出/ 迅速/ 发展/ 的/ 趋势/ ./ 至/ 2013/ 年/ 6/ 月/ ,/ 全球/ 智能手机/ 的/ 用户数/ 已/ 达到/ 15/ 亿/ ,/ 相比/ 2012/ 年/ 有/ 31/ %/ 的/ 增长/ ,/ 但/ 仅/ 占/ 全球/ 人数/ 的/ 21/ %/ ,/ 仍/ 有/ 较大/ 的/ 发展潜力/ ./ 移动/ 互联网/ 主要/ 催生/ 了/ 两大/ 产业/ :/ 移动/ 设备/ 的/ 应用程序/ 以及/ 硬件平台/ ./ 移动/ 设备/ 上/ 的/ 应用程序/ 种类/ 及/ 功能/ 繁多/ 、/ 形式多样/ 、/ 实现/ 方式/ 灵活/ ./ 数以亿计/ 的/ 移动/ 应用/ 被/ 开发/ 和/ 使用/ ,/ 苹果/ 的/ AppStore/ 仅/ 2012/ 年单/ 下载量/ 就/ 接近/ 200/ 亿次/ ./ 不同/ 的/ 应用程序/ 由于/ 功能/ 、/ 编程语言/ 、/ 运行/ 方式/ 等/ 的/ 差异/ ,/ 对/ 硬件资源/ 的/ 需求/ 也/ 大不相同/ ./ 例如/ ,/ 在/ 移动/ 设备/ 的/ 操作系统/ 中/ ,/ Android/ 和/ iOS/ 拥有/ 最高/ 的/ 市场占有率/ ./ 但/ 由于/ Android/ 和/ iOS/ 分别/ 利用/ Java/ 和/ Object/ -/ C/ 作为/ 应用/ 的/ 编程语言/ ,/ 其/ 移动/ 应用/ 的/ 编程/ 和/ 运行/ 方式/ 不同/ ,/ 在/ 相同/ 硬件平台/ 上/ 的/ 运行/ 性能/ 也/ 可能/ 存在/ 较大/ 的/ 差异/ ./ 从/ 硬件平台/ 的/ 角度/ 来看/ ,/ ARM/ 处理器/ ①/ 占有/ 最大/ 的/ 市场份额/ ,/ 具有/ 代表性/ 的/ 有/ 苹果/ 的/ Ax/ 处理器/ ,/ 高通/ 的/ 骁龙/ (/ Snapdragon/ )/ 处理器/ ./ 此外/ ,/ Intel/ 的/ Atom/ 系列/ 处理器/ 也/ 是/ 常用/ 的/ 移动/ 设备/ 处理器/ ./ 移动/ 处理器/ 的/ 性能/ 增长/ 迅猛/ ,/ 主频/ 趋向/ 2GHz/ ,/ 四核/ 芯片/ 也/ 逐渐/ 成为/ 主流/ ./ 同时/ ,/ 移动/ 处理器/ 的/ 体系结构/ 也/ 在/ 变革/ ,/ 指令/ 执行/ 方式/ 从/ 简单/ 的/ 顺序/ 执行/ 转变/ 为/ 多/ 发射/ 乱序执行/ ,/ 缓存/ (/ Cache/ )/ 的/ 容量/ 和/ 层次/ 也/ 在/ 不断/ 增加/ ./ 但/ 总体/ 来说/ ,/ 核心/ 芯片/ 扩充/ 核数/ 的/ 趋势/ 将/ 放缓/ ,/ 功耗/ 及/ 优化/ 成为/ 发展/ 的/ 重点/ ./ 一方面/ 现有/ 操作系统/ 技术/ 及/ 移动/ 应用程序/ 与/ 多/ 核/ 硬件平台/ 并/ 不/ 匹配/ ,/ 另一方面/ 多核/ 同时/ 运行/ 时/ 功耗/ 偏高/ ,/ 使得/ 只/ 在/ 极少数/ 应用/ 场景/ 下/ 才能/ 充分发挥/ 多核/ 性能/ ./ 优化/ 移动/ 设备/ 硬件平台/ 的/ 性能/ 及/ 功耗/ ,/ 关键在于/ 分析/ 移动/ 应用程序/ 对/ 硬件资源/ 的/ 利用率/ ,/ 以及/ 其/ 在/ 运行/ 过程/ 中/ 呈现/ 出来/ 的/ 体系结构/ 特征/ ./ 针对/ 这个/ 需求/ ,/ 本文/ 挑选/ 了/ 大量/ 的/ 移动/ 应用程序/ ,/ 并/ 在/ 真实/ 移动/ 平台/ 上/ 详细/ 地/ 分析/ 了/ 这些/ 应用程序/ 的/ 微/ 体系结构/ 相关/ 的/ 特征/ ./ 根据/ 应用程序/ 的/ 功能/ 以及/ 流行/ 度/ 等/ 标准/ ,/ 本文/ 从/ GooglePlay/ ②/ 和/ 国内/ 的/ 一些/ 应用/ 市场/ 中/ 挑选/ 了/ 一批/ AndroidOS/ 的/ 应用程序/ 作为/ 实验/ 目标/ ,/ 包括/ 性能/ 测试/ 、/ 社交/ 、/ 新闻/ 、/ 网络/ 购物/ 、/ 视频/ 播放/ 、/ 音频/ 播放/ 、/ 文档/ 处理/ 、/ 图像编辑/ 、/ 地图/ 导航/ 及/ 电子邮件/ 等/ 应用/ ./ 这些/ 应用程序/ 基本/ 覆盖/ 了/ 各类/ 常见/ 的/ 移动/ 应用/ ,/ 具有/ 代表性/ ./ 本文/ 在/ 真实/ 的/ ARM/ 平台/ 上/ 测试/ 了/ 与/ 应用/ 性能/ 密切相关/ 的/ 体系结构/ 特征/ ,/ 包括/ 指令和数据/ 缓存/ (/ I/ // DCache/ )/ 、/ 分支/ 预测/ 、/ 转换/ 后援/ 缓冲器/ (/ TLB/ )/ 、/ 二级缓存/ (/ L2Cache/ )/ 和/ 内存/ 访问/ 等/ 指标/ ./ 微/ 体系结构/ 相关/ 特征/ 的/ 实验/ 结果表明/ ,/ 大部分/ 应用程序/ 有/ 较/ 高/ 的/ 指令/ 周期/ 数/ (/ CPI/ )/ ,/ 这/ 意味着/ 应用程序/ 不能/ 充分/ 有效/ 地/ 利用/ 硬件平台/ 提供/ 的/ 资源/ ./ 指令/ 相关/ 的/ 部件/ 如/ 指令/ Cache/ 、/ ITLB/ 的/ 缺失/ 率/ 也/ 比较严重/ ,/ 这/ 体现/ 了/ 移动/ 应用/ 的/ 指令/ 执行/ 相对/ 复杂/ ,/ 而/ 以往/ 的/ 处理器/ 设计/ 的/ 优化/ 主要/ 着重于/ 数据/ 相关/ 的/ 部件/ ./ 此外/ ,/ 交互式/ 应用/ 的/ 指令/ Cache/ 缺失/ 率要/ 明显/ 高于/ 自动化/ 行为/ 应用/ ,/ 而/ 自动化/ 行为/ 的/ 应用程序/ 的/ 数据/ Cache/ 缺失/ 率要/ 明显/ 高于/ 交互式/ 应用/ ./ 移动/ 设备/ 上/ 的/ 应用程序/ 和/ 移动/ 处理器/ 间/ 存在/ 不/ 匹配/ 的/ 现象/ ,/ 这/ 意味着/ ,/ 移动/ 处理器/ 需要/ 根据/ 应用程序/ 的/ 特征/ 来/ 改进/ 其/ 体系结构/ 的/ 设计/ ./ 从/ 处理器/ 优化/ 的/ 角度/ 来说/ ,/ 基准/ 测试程序/ 和/ 体系结构/ 模拟器/ 是/ 研究/ 的/ 基础/ ./ 本文/ 从/ 上述/ 被/ 分析/ 的/ 大量/ 应用程序/ 中/ 挑选出/ 部分/ 具有/ 代表性/ 特征/ 的/ 应用程序/ ,/ 形成/ 一个/ 移动/ 设备/ 的/ 基准/ 测试程序/ 集/ (/ Moby/ )/ [/ 1/ ]/ ./ Moby/ 基准/ 测试程序/ 集/ 主要/ 用于/ 研究/ 移动/ 设备/ 的/ 体系结构/ ,/ 已/ 被/ 移植/ 到/ 全/ 系统/ 的/ 体系结构/ 模拟器/ Gem5/ [/ 2/ ]/ 上/ ,/ 并/ 实现/ 开源/ ③/ ./ 然而/ ,/ 移动/ 端的/ 应用程序/ 经常/ 需要/ 用户/ 的/ 交互/ 操作/ ,/ 而/ 模拟器/ 特别/ 是/ 全/ 系统/ 的/ 体系结构/ 模拟器/ 不能/ 有效/ 地/ 处理/ 和/ 重现/ 特定/ 的/ 用户/ 行为/ ./ 尽管/ 用户/ 交互/ 操作/ 可以/ 通过/ 自动化/ 工具/ 如/ AutoGUI/ [/ 3/ ]/ 来/ 模拟/ ,/ 但/ 本文/ 提出/ 利用/ 应用程序/ 的/ 代表性/ 操作/ 来/ 模拟/ 应用/ 的/ 行为/ ./ 代表性/ 操作/ 允许/ 以/ 命令行/ 的/ 方式/ 来/ 执行/ 应用程序/ 的/ 主要/ 活动/ (/ Activity/ )/ ,/ 而/ 无需/ 用户/ 的/ 交互/ ./ 这/ 可以/ 大大简化/ 移动/ 应用/ 在/ 模拟器/ 上/ 移植/ 和/ 执行/ 的/ 难度/ ./ 为了/ 进一步/ 地/ 刻画/ Moby/ 基准/ 测试程序/ 集/ 的/ 行/ index/ ./ php/ ①/ ②/ ③/ Page3/ 为/ ,/ 本文/ 还/ 分析/ 了/ 其中/ 各/ 应用程序/ 与/ 硬件平台/ 微/ 体系结构/ 无关/ 的/ 特征/ ,/ 包括/ 调用/ 库/ 的/ 数量/ 、/ 不同/ 类型/ 指令/ 的/ 特征/ 、/ 指令/ 局部性/ 、/ 工作/ 集/ 大小/ 以及/ 应用/ 运行/ 过程/ 中/ 的/ 指令/ 执行/ 轨迹/ 等/ ./ 实验/ 结果表明/ ,/ 移动/ 应用程序/ 在/ 运行/ 时会/ 创建/ 数十个/ 进程/ 或/ 线程/ ,/ 并/ 调用/ 数十个/ 应用/ 库函数/ ./ 这/ 无疑/ 会/ 增加/ 硬件平台/ 指令/ 部件/ 的/ 处理/ 复杂度/ ,/ 降低/ 指令/ 部件/ 的/ 执行/ 性能/ ./ 总体而言/ ,/ 本文/ 的/ 主要/ 贡献/ 如下/ :/ (/ 1/ )/ 选取/ 移动/ 设备/ 上/ 大量/ 不同/ 类别/ 的/ Android/ 应用程序/ ,/ 并/ 深入/ 地/ 分析/ 了/ 它们/ 的/ 微/ 体系结构/ 相关/ 的/ 特征/ ;/ (/ 2/ )/ 发现/ 移动/ 设备/ 的/ 应用程序/ 与/ 硬件平台/ 间/ 存在/ 不/ 匹配/ 的/ 现象/ ,/ 而且/ 处理器/ 中/ 与/ 指令/ 相关/ 的/ 部件/ 执行/ 效率/ 差/ ;/ (/ 3/ )/ 提出/ 移动/ 设备/ 的/ 基准/ 测试程序/ Moby/ ,/ 用于/ 体系结构/ 的/ 研究/ ,/ 并/ 支持/ 在/ 全/ 系统/ 体系结构/ 模拟器/ 上/ 运行/ ;/ (/ 4/ )/ 详细/ 地/ 分析/ 了/ Moby/ 各/ 应用程序/ 与/ 微/ 体系结构/ 无关/ 的/ 特征/ ./ 本文/ 第/ 2/ 节/ 讨论/ 本文/ 评测/ 的/ 移动/ 设备/ 应用程序/ 集/ ;/ 第/ 3/ 节/ 介绍/ 实验/ 平台/ 和/ 相关/ 工具/ ;/ 第/ 4/ 节/ 分析/ 移动/ 应用程序/ 与/ 平台/ 相关/ 的/ 微/ 体系结构/ 特征/ ;/ 第/ 5/ 节/ 描述/ 本文/ 提出/ 的/ 移动/ 设备/ 基准/ 测试程序/ Moby/ ;/ 第/ 6/ 节/ 进一步/ 介绍/ Moby/ 与/ 微/ 体系结构/ 无关/ 的/ 特征/ ;/ 第/ 7/ 节/ 简要/ 介绍/ 与/ 本文/ 相关/ 的/ 研究/ 工作/ ;/ 第/ 8/ 节对/ 全文/ 进行/ 总结/ ./ 2/ 测评/ 应用程序/ 集/ 应用/ 测试/ 集/ 的/ 选择/ 直接/ 决定/ 了/ 其/ 呈现/ 的/ 特征/ 是否/ 具有/ 代表性/ ,/ 然而/ 数以亿计/ 的/ 应用程序/ 不/ 可能/ 被/ 完全/ 代表/ ./ 因而/ ,/ 本文/ 从/ 常用/ 的/ GooglePlay/ 应用/ 市场/ 入手/ ,/ 并/ 根据/ 其/ 整理/ 的/ 应用/ 分类/ ,/ 依次/ 从/ 各/ 分类/ 中/ 挑选出/ 部分/ 应用程序/ ./ 在/ 各/ 应用/ 分类/ 中/ ,/ 本文/ 主要/ 用/ 新颖/ 度/ 、/ 下载量/ 、/ 用户/ 热度/ 、/ 交互性/ 、/ 发行/ 版本号/ 这/ 5/ 个/ 指标/ 作为/ 衡量标准/ [/ 4/ ]/ ./ (/ 1/ )/ 新颖/ 度/ ./ 每隔/ 一段时间/ 都/ 会/ 出现/ 一些/ 新颖/ 的/ 应用/ ,/ 它们/ 属于/ 应用/ 商店/ 分类/ 中/ 的/ 一种/ ,/ 但是/ 比/ 同类/ 的/ 应用/ 更/ 受欢迎/ ,/ 因为/ 它们/ 满足/ 了/ 用户/ 的/ 新/ 需求/ ./ (/ 2/ )/ 下载量/ ./ 下载量/ 标志/ 着/ 这个/ 应用/ 的/ 市场份额/ ,/ 同时/ 标志/ 着/ 受/ 用户/ 的/ 欢迎/ 程度/ 和/ 流行/ 程度/ ./ (/ 3/ )/ 用户/ 热度/ ./ 用户/ 热度/ 标志/ 了/ 用户/ 对/ 这个/ 应用/ 的/ 接受/ 和/ 使用/ 程度/ ./ (/ 4/ )/ 交互性/ ./ 在/ 移动/ 应用/ 中/ ,/ 交互式/ 应用/ 占据/ 了/ 90/ %/ 的/ 市场份额/ ./ 根据/ 交互/ 设计/ 的/ 原则/ 进行/ 设计/ ,/ 只有/ 能/ 吸引/ 用户/ 的/ 设计/ 才能/ 获得成功/ ./ (/ 5/ )/ 发行/ 版本号/ ./ 发行/ 版本号/ 标志/ 着/ 一个/ 应用/ 的/ 迭代/ 发行/ 次数/ ,/ 优秀/ 的/ 应用程序/ 都/ 有/ 稳定/ 的/ 迭代/ 发行/ 版本/ ./ 所示/ ./ 按照/ 上述/ 原则/ ,/ 本文/ 挑选出/ 的/ 应用程序/ 如表/ 1/ 类型/ 性能/ 测试/ 应用/ BBench/ ,/ Antutu/ ,/ SunSpider/ 自动化/ 行为/ 社交/ 类/ 应用/ QQ/ ,/ Fanfou/ ,/ SinaWeibo/ ,/ Renren/ 交互式/ 应用/ 新闻/ 类/ 应用/ ZAKER/ ,/ FeedGoal/ ,/ NetEaseNews/ 交互式/ 应用/ 网络/ 购物/ 类/ eBay/ ,/ Taobao/ ,/ 360Buy/ 交互式/ 应用/ 视频/ 播放/ 类/ YouKu/ ,/ VLC/ ,/ MXPlayer/ 自动化/ 行为/ 音频/ 播放器/ Duomiyinyue/ ,/ SubSonic/ ,/ Douban/ ,/ 文档/ 编辑/ 类/ Evernote/ ,/ TomDroid/ ,/ PDF/ 阅读/ 工具/ VuDroid/ ,/ AdobeReader/ ,/ FBReader/ 自动化/ 行为/ 图像编辑/ 类/ 文件/ 查看器/ 地图/ 导航/ 类/ GoogleMap/ ,/ BaiduMap/ 交互式/ 应用/ 电子邮件/ 类/ 游戏类/ AngryBird/ ,/ FrozenBubble/ 交互式/ 应用/ 3/ 实验/ 平台/ 和/ 工具/ 本文/ 使用/ Pandaboard/ -/ ES/ 作为/ 移动/ 设备/ 的/ 硬件平台/ ,/ 运行/ LinaroAndroid4/ ./ 0.1/ ①/ 操作系统/ ./ Pandaboard/ -/ ES/ 是/ 一个/ 开放/ 的/ OMAP4/ 开发/ 平台/ ,/ 由/ 德州仪器/ 的/ OMAP4460/ 处理器/ 和/ 以此/ 为/ 核心/ 的/ 外围设备/ 构成/ ./ OMAP4460/ 含有/ 主频/ 为/ 1.2/ GHz/ 的/ 双核/ ARMCortexA9/ 处理器/ ,/ 并/ 集成/ 了/ 1GB/ 的/ LPDDR2/ 内存/ 单元/ ./ CortexA9/ 处理器/ 包括/ 了/ 大小/ 为/ 32KB/ 的/ 4/ 路组/ 相联/ 指令和数据/ Cache/ ,/ 以及/ 512KB/ 大小/ 的/ 16/ 路组/ 相联/ 的/ L2Cache/ ./ CortexA9/ 处理器/ 的/ 性能/ 监控/ 单元/ (/ Perform/ -/ anceMonitoringUnit/ )/ 提供/ 了/ 一套/ 性能/ 计数器/ 以及/ 许多/ 性能/ 事件/ ,/ 用于/ 监控/ 处理器/ 各/ 资源/ 部件/ 的/ 利用/ 情况/ ./ 其/ 处理器/ 的/ 参考手册/ ②/ 中/ 列出/ 了/ CortexA9/ 处理器/ 支持/ 的/ 性能/ 事件/ 及其/ 编号/ ,/ 每/ 一个/ 性能/ 事件/ 都/ 对应/ 一个/ 微/ 体系结构/ 的/ 特征/ ./ 本文/ 第/ 4/ 节/ 所述/ 的/ 微/ 体系结构/ 相关/ 的/ 特征值/ ,/ 就是/ 利用/ 处理器/ 提供/ 的/ 性能/ 计数器/ 得到/ 的/ ./ 然而/ ,/ 由于/ 性能/ 计数器/ 的/ 数量/ 有限/ ,/ 本文/ 所/ 提到/ 的/ 微/ 体系结构/ 特征/ 并/ 不能/ 一次/ 测出/ ,/ 需要/ 多次/ 测量/ ./ 此外/ ,/ 部分/ 应用程序/ 依赖于/ 用户/ 的/ 交互/ ,/ 测量/ 的/ 结果/ 存在/ 一定/ 的/ 波动/ ./ 在/ 实验/ 中/ ,/ 本文/ 通过/ 10/ 次/ 测量/ 取/ 平均值/ 的/ 方式/ 来/ 统计/ ./ 所有/ 的/ 微/ 体系结构/ 特征/ 由/ 轻量级/ 、/ 低/ 开销/ 的/ 性能/ 计数器/ 工具/ TopMC/ ③/ 来/ 获得/ ./ ①/ ②/ ③/ Page4/ 为了/ 分析/ Moby/ 基准/ 测试程序/ 集中/ 各/ 应用程序/ 与/ 微/ 体系结构/ 无关/ 的/ 特征/ ,/ 也/ 就是/ 应用程序/ 自身/ 的/ 特征/ ,/ 本文/ 使用/ 全/ 系统/ 模拟器/ Gem5/ [/ 2/ ]/ 来/ 获取/ 相应/ 的/ 参数/ ./ Gem5/ 模拟器/ 是/ 一个/ 常用/ 的/ 体系结构/ 模拟器/ ,/ 能够/ 在/ 其/ 上/ 运行/ 完整/ 的/ 操作系统/ 和/ 应用程序/ ,/ 并/ 详细/ 地/ 模拟/ 了/ 处理器/ 及/ 内存/ 等/ 硬件/ 部件/ ,/ 支持/ Alpha/ 、/ ARM/ 及/ x86/ 等/ 架构/ ./ 同时/ ,/ Gem5/ 自带/ 有/ 几种/ 常见/ ARMSoC/ 的/ 配置/ ,/ 如/ ARMRealView/ 和/ VersatileExpress/ 平台/ 的/ 处理器/ 、/ 内存/ 、/ I/ // O/ 外设/ 等/ 的/ 配置/ 参数/ ./ PandaboardES/ 开发板/ 与/ VersatileExpress/ 平台/ 类似/ ,/ 可以/ 参考/ 其/ 配置/ ./ 4/ 微/ 体系结构/ 相关/ 的/ 特征分析/ 4.1/ 平均/ 指令/ 周期/ 数/ 和/ 分支/ 预测/ 失败率/ 平均/ 指令/ 周期/ 数/ (/ CPI/ )/ 是/ 反映/ 应用程序/ 在/ 硬件平台/ 上/ 运行/ 性能/ 最/ 直观/ 的/ 体现/ ./ CPI/ 越高/ ,/ 表示/ 每条/ 指令/ 需要/ 的/ 处理器/ 周期/ 数越/ 多/ ./ Cortex/ -/ A9/ 的/ 理想/ 图/ 1/ 平均/ 指令/ 周期/ 数图/ 2/ 分支/ 预测/ 失效率/ 值/ 是/ 0.5/ ./ 然而/ ,/ 如图/ 1/ 所示/ ,/ 这些/ 应用/ 的/ CPI/ 值/ 都/ 在/ 1.5/ 以上/ ,/ 只有/ Antutu/ 跑/ 分/ 测试/ 在/ 1/ 附近/ ./ 交互式/ 应用/ 的/ CPI/ 值/ 基本/ 都/ 接近/ 3.5/ ,/ 自动化/ 行为/ 应用/ 的/ CPI/ 都/ 在/ 2/ 附近/ 波动/ ,/ 豆瓣/ 客户端/ 在/ 2/ 以上/ ,/ 其他/ 的/ 都/ 在/ 2/ 以下/ ./ 可以/ 看出/ ,/ 这些/ 应用/ 在/ Cortex/ -/ A9/ 上/ 运行/ 得/ 并/ 不/ 良好/ ,/ 部分/ 原因/ 是/ 交互式/ 行为/ 的/ 弊端/ :/ 交互式/ 行为/ 提高/ 了/ 应用/ 的/ 鲜活/ 度/ ,/ 较/ 好/ 的/ 交互/ 环境/ 设计/ 能/ 提升/ 用户/ 体验/ ,/ 但是/ 也/ 带来/ 了/ 性能/ 的/ 损失/ ./ 在/ 现代/ 处理器/ 设计/ 中/ ,/ 分支/ 预测/ 技术/ 确保/ 了/ 处理器/ 的/ 并行/ 能力/ ,/ 并且/ 作为/ 高性能/ 处理器/ 的/ 支持/ 技术/ ,/ 还/ 保证/ 了/ 指令/ 级/ 并行/ 的/ 可能性/ ./ 本文/ 统计/ 了/ 测试程序/ 集/ 的/ 分支/ 预测/ 失败率/ ,/ 图/ 2/ 描述/ 了/ 分支/ 预测/ 的/ 情况/ :/ 交互式/ 应用/ 的/ 分支/ 预测/ 未/ 命中率/ 比/ 自动化/ 行为/ 的/ 应用/ 要/ 高/ ./ 从/ 程序/ 轨迹/ 分析/ ,/ 现代/ 编程/ 模型/ 是/ 消息/ 驱动/ 的/ ,/ 主线/ 程用/ 消息/ 泵/ 将/ 消息/ 派发/ 到/ 对应/ 的/ 回调/ 函数/ ,/ 本身/ 在/ 无限/ 循环/ ,/ 因此/ ,/ 程序/ 的/ 行为/ 变得/ 无法/ 估计/ ,/ 可预测性/ 不强/ ./ 移动/ 处理器/ 需要/ 扩充/ 其/ 分支/ 预测/ 部件/ ,/ 主要/ 是/ 分析程序/ 调用/ 栈/ 的/ 规律/ ./ Page54/ ./ 2/ 指令/ 、/ 数据/ 缓存/ 和/ TLB/ 未/ 命中率/ 本文/ 统计/ 了/ 指令/ 缓存/ 和/ 数据/ 缓存/ 的/ 缺失/ 率/ ,/ 统计/ 的/ 单位/ 是/ 每/ 一千条/ 指令/ 发生/ 缺失/ 的/ 次数/ ./ 从图/ 3/ 中/ 可以/ 看出/ ,/ 交互式/ 应用/ 和/ 非/ 交互式/ 应用/ 在/ 数据/ 缓存/ 缺失/ 这/ 一项/ 上/ 没有/ 太大/ 的/ 差别/ ,/ 都/ 在/ 5/ 上下/ 波动/ ./ 而/ 指令/ 缓存/ 缺失/ 不同/ ./ 新闻/ 阅读/ 类/ 软件/ 的/ 指令/ 缺失/ 率/ 明显/ 要/ 高于/ 播放/ 类/ 软件/ ,/ 两者/ 的/ 最大/ 距离/ 可以/ 达到/ 10/ 以上/ ./ 播放/ 类/ 软件/ 的/ 主要/ 工作/ 是/ 对/ 媒体文件/ 重图/ 3/ 指令/ 缓存/ 、/ 数据/ 缓存/ 和/ TLB/ 缺失/ 率/ 旁路/ 后援/ 缓冲器/ (/ TranslationLookasideBuffer/ ,/ TLB/ )/ ,/ 也/ 可以/ 看做/ 是/ 缓存/ 的/ 一种/ ,/ 它/ 缓存/ 的/ 是/ 虚拟地址/ 到/ 物理地址/ 的/ 映射/ 关系/ ./ 引起/ ITLB/ 缺失/ 的/ 原因/ 有/ 很多/ ,/ 比如/ 进程/ 切换/ 、/ 调用/ 未/ 被/ 访问/ 过/ 的/ 动态/ 库/ 、/ 以及/ 由于/ ITLB/ 的/ 项数/ 有限/ 而/ 发生/ 的/ TLB/ 替换/ ./ 如图/ 3/ 所示/ 的/ 是/ 各/ 应用程序/ 每/ 一千条/ 指令/ 中/ ITLB/ 缺失/ 的/ 数目/ ./ FeedGoal/ 的/ 值/ 为/ 4.9/ ,/ 播放器/ 类/ 应用/ 的/ 值/ 在/ 1/ 左右/ ,/ 而/ 其他/ 大部分/ 应用/ 都/ 在/ 2/ 附近/ ./ 这/ 说明/ 播放器/ 类/ 的/ 应用/ 的/ 指令/ 访问/ 局部性/ 相对/ 较/ 好/ ./ 而/ 对于/ DTLB/ 的/ 缺失/ ,/ VLC/ 、/ MXPlayer/ 和/ GoogleMap/ 每/ 一千条/ 指令/ 的/ 缺失/ 数/ 接近/ 14/ ,/ 高出/ 其他/ 应用/ 近/ 一倍/ ./ VLC/ 和/ MXPlayer/ 主要/ 是/ 对/ 视频文件/ 进行/ 编解码/ ,/ 需要/ 频繁/ 地/ 读取/ 新/ 的/ 数据/ ,/ 因此/ 会/ 造成/ DTLB/ 的/ 缺失/ ./ 而/ 其他/ 大部分/ 应用/ 仅/ 访问/ 或/ 操作/ 小量/ 的/ 数据/ ,/ 现有/ CortexA9/ 处理器/ 的/ DTLB/ 项数/ 以及/ 分配/ 替换/ 策略/ 能/ 有效/ 地/ 处理/ 这些/ 数据/ 的/ 映射/ 关系/ ./ 4.3/ 流水线/ 阻塞/ 流水线/ 技术/ 的/ 引入/ ,/ 大大提高/ 了/ CPU/ 的/ 并行/ 复地/ 进行/ 编解码/ ,/ 执行/ 的/ 指令/ 相对/ 比较/ 固定/ ./ 总体而言/ ,/ Android/ 上/ 的/ 应用程序/ 会/ 频繁/ 地/ 调用/ 许多/ 应用/ 库/ ,/ 如/ JVM/ 运行/ 相关/ 的/ 库函数/ 等/ ./ 因而/ ,/ 移动/ 设备/ 上/ 应用程序/ 的/ 指令/ 执行/ 会/ 相对/ 复杂/ ,/ 局部性/ 会/ 有所/ 降低/ ./ 以/ KingsoftOffice/ 应用/ 为例/ ,/ 本文/ 在/ 第/ 6/ 节/ 分析/ 了/ 其/ 指令/ 执行/ 流/ ,/ 可以/ 看出/ 移动/ 应用程序/ 复杂/ 的/ 指令/ 特征/ ./ 处理/ 性能/ ./ 但是/ ,/ 指令/ 之间/ 的/ 依赖性/ 产生/ 的/ 冲突/ ,/ 包括/ 资源分配/ 、/ 数据/ 争夺/ 及/ 控制流/ 的/ 冲突/ ,/ 是/ 不可避免/ 的/ ./ 流水线/ 在/ 发生/ 上述情况/ 的/ 时候/ 不得不/ 停滞/ ./ 当/ 分支/ 预测/ 失效/ 时/ ,/ 需要/ 排空/ 流水/ ,/ 并/ 重新/ 用/ 正确/ 的/ 指令流/ 填满/ ;/ 当/ 出现/ 数据/ 冲突/ 的/ 时候/ ,/ 流水线/ 需要/ 停滞/ ,/ 等待/ 资源/ ./ 本文/ 分别/ 统计/ 了/ 流水线/ 被/ 阻塞/ 的/ 众多/ 原因/ 中/ 常见/ 的/ 3/ 项/ :/ TLB/ 缺失/ 、/ 数据/ 缓存/ 缺失/ 及/ 指令/ 缓存/ 缺失/ ./ 图/ 4/ 所示/ 的/ 是/ 因/ 不同/ 部件/ 缺失/ 导致/ 处理器/ 停滞/ 的/ 周期/ 数占/ 整个/ 程序运行/ 周期/ 数/ 的/ 比例/ ./ 除了/ 3/ 个/ 列出/ 的/ 处理器/ 停滞/ 原因/ ,/ 其他/ 部件/ 造成/ 处理器/ 停滞/ 的/ 比例/ 相对/ 较/ 小/ ,/ 因而/ 剩余/ 的/ 周期/ 数/ 可以/ 当成/ 是/ 处理器/ 正常/ 运行/ 的/ 周期/ 数/ ./ 从图/ 中/ 可以/ 看出/ ,/ 由/ 指令/ 缓存/ 缺失/ 导致/ 的/ 阻塞/ ,/ 交互式/ 应用/ 都/ 在/ 40/ %/ 左右/ 波动/ ,/ 只有/ 测试/ 类/ 的/ SunSpider/ 略低/ ./ 图/ 5/ 中/ 描述/ 了/ TLB/ 、/ 指令/ Cache/ 或/ 数据/ Cache/ 缺失/ 各/ 引入/ 流水线/ 停滞/ 的/ 平均/ 周期/ 数/ ./ 可以/ 看出/ ,/ 数据/ Cache/ 缺失/ 导致/ 的/ 阻塞/ 比/ 其他/ 两种/ 原因/ 都/ 要/ 严重/ 得/ 多/ ,/ 而/ 属/ 文档/ 处理/ 类/ 软件/ 中/ 特别/ 明显/ ./ Page6/ 图/ 4/ 处理器/ 的/ 停滞/ 周期/ 比例图/ 5/ 不同/ 部件/ 缺失/ 引入/ 的/ 处理器/ 停滞/ 周期/ 4.4/ 二级缓存/ 的/ 缺失/ 率图/ 6/ 所示/ 的/ 是/ 二级缓存/ (/ L2Cache/ )/ 的/ 缺失/ 率/ ./ 大部分/ 应用/ 的/ L2Cache/ 缺失/ 率/ 都/ 比较/ 平缓/ ,/ 在/ 20/ %/ ~/ 30/ %/ 之间/ ./ 但是/ KingsoftOffice/ 、/ AdobeReader/ 和/ VLC/ 的/ L2Cache/ 缺失/ 率/ 仍/ 达到/ 50/ %/ ./ 图/ 6/ 二级/ Cache/ 缺失/ 率/ 为了/ 进一步/ 分析/ L2Cache/ 缺失/ 的/ 现象/ ,/ 本文/ 分别/ 统计/ 了/ L2Cache/ 数据/ 及/ 指令/ 请求/ 各自/ 的/ 缺失/ 率/ ,/ 如图/ 7/ 所示/ ./ 整体而言/ ,/ 数据/ 请求/ 的/ 缺失/ 率/ 偏高/ ,/ 基本/ 都/ 达到/ 40/ %/ ,/ 而/ 大部分/ 应用程序/ 的/ 指令/ 请求/ 缺失/ 率/ 也/ 接近/ 20/ %/ ,/ 都/ 相对/ 偏高/ ./ 这正/ 说明/ 移动/ 应用/ 的/ 指/ Page7/ 图/ 7/ 二级缓存/ 中/ 数据/ 及/ 指令/ 请求/ 的/ 缺失/ 率令/ 相比/ SPECCPU2006/ 等/ 高性能/ 应用/ ,/ 执行/ 流/ 比较复杂/ ./ 同时/ ,/ 观察/ 发现/ ,/ KingsoftOffice/ 、/ AdobeReader/ 及/ VLC/ 的/ 数据/ 请求/ 缺失/ 率竟/ 接近/ 70/ %/ ./ 而/ 这/ 几个/ 应用/ 需要/ 对/ 文件/ 进行/ 处理/ ,/ 数据/ 请求/ 会/ 占据/ 较大/ 的/ 比例/ ,/ 因而/ 导致/ 整体/ 的/ L2Cache/ 缺失/ 率/ 偏高/ ./ 5/ 基准/ 测试程序/ Moby/ 上/ 一节/ 对/ 各/ 移动/ 应用程序/ 在/ 指定/ 开发板/ 上/ 的/ 微/ 体系结构/ 相关/ 特征/ 的/ 分析/ ,/ 揭示/ 了/ 移动/ 设备/ 上/ 的/ 应用程序/ 和/ 移动/ 处理器/ 间/ 存在/ 不/ 匹配/ 的/ 现象/ ,/ 这/ 意味着/ ,/ 移动/ 处理器/ 需要/ 根据/ 应用程序/ 的/ 特征/ 来/ 改进/ 其/ 体系结构/ 的/ 设计/ ./ 在/ 处理器/ 体系结构/ 研究/ 中/ ,/ 基准/ 测试程序/ 和/ 体系结构/ 模拟器/ 是/ 基本/ 的/ 工具/ ./ 然而/ ,/ 现有/ 移动/ 设备/ 端的/ 基准/ 测试程序/ 或者/ 只/ 关注/ 某/ 几种/ 特定/ 的/ 应用程序/ ①/ ②/ ,/ 或者/ 不能/ 在/ 模拟器/ 上/ 直接/ 运行/ [/ 5/ ]/ ./ 而/ 高性能/ 计算/ 的/ 基准/ 测试程序/ 如/ SPECCPU2006/ [/ 6/ ]/ 与/ 交互式/ 的/ 移动/ 应用/ 存在/ 较大/ 的/ 差异/ ,/ 不/ 适合/ 用于/ 研究/ 移动/ 设备/ 的/ 体系/ 架构/ ./ 为此/ ,/ 本文/ 设计/ 并/ 提出/ 了/ 移动/ 设备/ 的/ 基准/ 测试程序/ Moby/ ./ 首先/ ,/ Moby/ 集合/ 了/ 多类/ 常用/ 的/ 应用程序/ ,/ 包括/ 浏览器/ 、/ 邮件/ 客户端/ 、/ 社交/ 网络/ 、/ 新闻/ 客户端/ 、/ 文档/ 处理/ 、/ 地图/ 、/ 音视频/ 播放器/ 及/ 游戏/ 共/ 8/ 类/ 应用/ ./ 这/ 8/ 类/ 应用程序/ 基本/ 覆盖/ 了/ 用户/ 使用/ 频度/ 较/ 高/ 的/ 应用/ ./ 其次/ ,/ Moby/ 的/ 应用程序/ 从/ 上/ 一节/ 中/ 描述/ 的/ 应用/ 中/ 选取/ ,/ 并且/ 其微/ 体系结构/ 相关/ 的/ 特征/ 尽量/ 具有/ 代表性/ ./ 再次/ ,/ 对于/ 模拟器/ ,/ 特别/ 是/ 体系结构/ 全/ 系统/ 模拟器/ 来说/ ,/ 用户/ 的/ 交互/ 操作/ 会/ 阻碍/ 应用程序/ 的/ 模拟/ 以及/ 可/ 重现/ 性/ ./ 尽管/ 用户/ 操作/ 的/ 监控/ 软件/ 如/ AutoGUI/ [/ 3/ ]/ 能够/ 准确/ 录制/ 并/ 回放/ 用户/ 的/ 动作/ ,/ 但/ 这类/ 软件/ 需要/ 在/ 低速/ 的/ 模拟器/ 精心/ 地/ 制作/ 录制/ 用户/ 的/ 行为/ ,/ 效率/ 相对/ 比较/ 低下/ ./ 通过/ 分析/ 认为/ ,/ 移动/ 设备/ 应用程序/ 的/ 主要/ 功能/ 一般/ 都/ 会/ 以/ 活动/ (/ Activity/ )/ 的/ 形式/ 存在/ ,/ 而且/ 能够/ 以/ 命令行/ 的/ 形式/ 执行/ ,/ 只/ 需/ 手动/ 指令/ 命令/ 的/ 参数/ 如/ 输入输出/ 文件/ 等/ ,/ 而/ 无需/ 用户/ 的/ 交互/ ./ 这种/ 主要/ 活动/ 在/ 本文/ 中/ 被/ 称为/ 典型/ 操作/ ./ 表/ 2/ 介绍/ 了/ Moby/ 选取/ 的/ 10/ 个/ 应用程序/ 、/ 其/ 使用/ 类别/ ,/ 以及/ 适用/ 于/ 模拟器/ 的/ 典型/ 操作/ ./ 目前/ ,/ Moby/ 基准/ 测试程序/ 已经/ 开源/ ./ 应用程序/ BBench/ [/ 5/ ]/ 浏览器/ K9Mail/ 邮件/ 客户端/ 加载/ 并/ 显示/ 邮件/ SinaWeibo/ 社交/ 网络/ NeteaseNews/ 新闻/ 客户端/ 检查/ 并/ 加载/ 新闻/ KingsoftOffice/ 文档/ 处理器/ 打开/ doc/ // xls/ // ppt/ 格式文件/ AdobeReader/ 文档/ 处理器/ 打开/ pdf/ 格式文件/ BaiduMap/ 地图/ MXPlayer/ 视频/ 播放器/ TTPod/ 音频/ 播放器/ FrozenBubble/ 游戏/ 6Moby/ 微/ 体系结构/ 无关/ 的/ 特征分析/ 微/ 体系结构/ 相关/ 的/ 特征/ ,/ 能够/ 说明/ 应用程序/ 与/ 硬件平台/ 的/ 匹配/ 度/ ./ 如果/ 硬件平台/ 改变/ ,/ 如/ 处理器/ 及/ 内存/ 资源/ 的/ 容量/ 、/ 分配/ 策略/ 等/ 参数/ 的/ 变化/ ,/ 微/ 体系结构/ 相关/ 的/ 特征/ 可能/ 缺少/ 参考/ 意义/ ./ 而微/ 体系结构/ 无关/ 的/ 特征/ 能够/ 真正/ 了解/ 应用程序/ 自身/ 内在/ 的/ 特性/ ./ ①/ ②/ Page8/ 因而/ ,/ 本节/ 将/ 主要/ 介绍/ Moby/ 各/ 应用程序/ 与/ 微/ 体系结构/ 无关/ 的/ 特征/ ,/ 包括/ 了/ 指令/ 分解/ 、/ 工作/ 集/ 大小/ 、/ 应用/ 的/ 进程/ 或/ 线程/ 数/ 、/ 调用/ 库/ 特征/ 等/ ./ 与/ 执行/ 长时间/ 计算/ 操作/ 的/ 高性能/ 计算/ 应用/ 不同/ ,/ 大部分/ 移动/ 应用/ 的/ 典型/ 操作/ 只/ 执行/ 简单/ 的/ 操作/ ,/ 因而/ Moby/ 各/ 应用程序/ 执行/ 的/ 指令/ 数仅/ 几十亿/ (/ Billion/ )/ ./ 不过/ ,/ 这个/ 数量级/ 的/ 指令/ 数/ 更/ 适合/ 在/ 全/ 系统/ 的/ 模拟器/ 上/ 运行/ ./ 本文/ 利用/ Gem5/ 模拟器/ 执行/ 了/ 表/ 2/ 所示/ 各/ 应用/ 的/ 典型/ 操作/ ,/ 并/ 获得/ 如下/ 与/ 微/ 体系结构/ 无关/ 的/ 特征/ ./ 6.1/ 指令/ 特征/ 及/ 工作/ 集/ 大小/ 应用程序/ 执行/ 指令/ 的/ 组成/ ,/ 可以/ 大致/ 反映/ 出/ 程序运行/ 过程/ 中/ 对/ 各/ 硬件资源/ 的/ 需求/ ./ 例如/ ,/ 分支/ 指令/ 的/ 数量/ 直接/ 决定/ 着/ 分支/ 预测/ 部件/ 的/ 处理/ 压力/ ,/ 而/ load/ // store/ 指令/ 体现/ 应用程序/ 对/ Cache/ 及/ 内存容量/ 及/ 性能/ 的/ 敏感度/ ./ 表/ 3/ 描述/ 了/ Moby/ 各/ 应用程序/ 指令/ 特征/ 的/ 总结/ ./ 对于/ 大部分/ 应用/ 来说/ ,/ Load/ 指令/ 和/ Store/ 指令/ 分别/ 占据/ 指令/ 总量/ 的/ 25/ %/ 和/ 12/ %/ 左右/ ./ 与/ SPECCPU2006/ 的/ 整数/ 测试程序/ 相比/ ,/ Moby/ 中/ 应用程序/ 的/ Load/ 指令/ 和/ Store/ 指令/ 的/ 特征/ 都/ 比较/ 接近/ ,/ 差异/ 不大/ ./ 这/ 说明/ ,/ Android/ 的/ 应用/ 执行/ 框架/ 和/ 运行/ 环境/ 在/ 其/ 应用程序/ 的/ 指令/ 中/ 占据/ 着/ 重要/ 的/ 地位/ ./ 除了/ 应用程序/ 指令/ 数量/ BBench2/ ./ 4814.423/ ./ 112.280/ K9Mail1/ ./ 1811.020/ ./ 09.364/ SinaWeibo2/ ./ 2316.927/ ./ 214.7114/ NeteaseNews2/ ./ 6516.625/ ./ 912.2104/ KingsoftOffice2/ ./ 2416.626/ ./ 114.187/ AdobeReader2/ ./ 0915.223/ ./ 712.283/ BaiduMap3/ ./ 5314.322/ ./ 812.3102/ MXPlayer3/ ./ 8418.223/ ./ 812.897/ TTPod3/ ./ 8715.225/ ./ 512.8126/ FrozenBubble0/ ./ 2815.621/ ./ 59.747/ 图/ 8/ 指令/ Cache/ 的/ 重用/ 距离/ MXPlayer/ 和/ K9Mail/ 这/ 两个/ 应用/ ,/ 其他/ 应用/ 中/ 15/ %/ 的/ 指令/ 是/ 分支/ 预测/ 指令/ ./ 而且/ ,/ 在/ 分支/ 预测/ 指令/ 中/ ,/ 有/ 70/ %/ 的/ 指令/ 是/ 条件/ 分支/ 指令/ ./ 这/ 意味着/ ,/ 大部分/ 分支/ 指令/ 都/ 有/ 可能/ 造成/ 分支/ 预测/ 错误/ ,/ 进而/ 导致/ 流水线/ 的/ 回滚/ 及/ 性能/ 的/ 损失/ ./ 应用程序/ 工作/ 集/ 的/ 统计/ 方式/ 可以/ 有/ 多种/ ,/ 既/ 可以/ 是/ Cache/ 行/ 的/ 粒度/ ,/ 也/ 可以/ 是/ 物理/ 页面/ 的/ 粒度/ ./ 本文/ 为了/ 分析/ 内存/ 访问/ 的/ 特征/ ,/ 选取/ 4KB/ 大小/ 的/ 物理/ 页面/ 作为/ 监控/ 粒度/ ./ 由于/ Moby/ 各/ 应用/ 的/ 典型/ 操作/ 仅/ 执行/ 几秒/ 的/ 时间/ ,/ 本文/ 分析/ 的/ 工作/ 集/ 大小/ 是/ 整个/ 操作/ 执行/ 过程/ 中/ 访问/ 过/ 的/ 不同/ 物理/ 页面/ 数/ ./ 由表/ 3/ 可以/ 看出/ ,/ 半数/ 应用程序/ 的/ 工作/ 集/ 接近/ 或/ 超过/ 100MB/ ./ 仅/ K9Mail/ 和/ FrozenBubble/ 的/ 工作/ 集/ 小于/ 65MB/ ,/ 这/ 与/ 它们/ 执行/ 的/ 指令/ 数/ 相对/ 应/ ./ 所有/ 应用/ 的/ 工作/ 集/ 大小/ 都/ 远远/ 超过/ 了/ 最后/ 一级/ Cache/ 的/ 容量/ ./ 然而/ ,/ 除了/ 播放/ 视频/ 的/ MXPlayer/ 应用/ ,/ Moby/ 中/ 其他/ 应用程序/ 的/ 输入/ 集都/ 相对/ 不/ 大/ ,/ 仅/ 为数/ MB/ ./ 这种/ 现象/ 显示/ ,/ Moby/ 应用/ 会/ 访问/ 很多/ 物理/ 页面/ ,/ 但是/ 大部分/ 物理/ 页面/ 仅/ 有/ 小量/ 的/ 数据/ 被/ 访问/ 过/ ./ 鉴于/ 移动/ 处理器/ 的/ TLB/ 项数/ 有限/ ,/ 这/ 暗示着/ 应用/ 程序运行/ 过程/ 中/ 可能/ 会/ 发生/ 频繁/ 的/ TLB/ 缺失/ ./ 6.2/ 指令/ 局部性/ 从/ 微/ 体系结构/ 相关/ 的/ 特征分析/ 中/ 可以/ 得出/ ,/ 指令/ Cache/ 的/ 缺失/ 率/ 较大/ ,/ 也就是说/ 局部性/ 不好/ ./ 本节/ 从/ 应用程序/ 与/ 微/ 体系结构/ 无关/ 的/ 特征/ 中/ ,/ 对此/ 现象/ 进行/ 阐述/ ./ 本文/ 利用/ 重用/ 距离/ 这个/ 指标/ 来/ 反映/ 指令/ 的/ 局部性/ ./ 重用/ 距离/ 是/ 指/ 连续/ 两次/ 访问/ 请求/ 期间/ ,/ 其他/ 访问/ 请求/ 的/ 数量/ ./ 指令/ 的/ 重用/ 距离/ ,/ 这里/ 指/ 连续/ 访问/ 同一/ Cache/ 的/ 时间/ 间隔/ 内/ ,/ 其他/ 访问/ 指令/ Cache/ 的/ 请求/ 数/ ./ 图/ 8/ 所示/ 的/ 是/ Moby/ 各/ 应用程序/ 对应/ 指令/ Cache/ 的/ 重用/ 距离/ ./ 从图/ 可知/ ,/ 所有/ 应用/ 中仅/ 有/ 30/ %/ 指令/ Page9/ 请求/ 的/ 重用/ 距离/ 小于/ 4/ ./ 而/ 本文/ 实验/ 中/ 移动/ 平台/ 的/ 指令/ Cache/ 是/ 4/ 路组/ 相联/ 的/ ./ 以/ Cache/ 中/ 最/ 常用/ 的/ 最近/ 最少/ 使用/ (/ LRU/ )/ 替换/ 策略/ 而言/ ,/ 重用/ 距离/ 大于/ 4/ ,/ 意味着/ 请求/ 从/ 第一次/ 访问/ 时/ 的/ MRU/ 位置/ ,/ 会/ 慢慢/ 地/ 移动/ 到/ LRU/ 位置/ ,/ 直至/ 被/ 替换/ 出去/ ./ 当下/ 一次/ 访问/ 时/ ,/ 请求/ 就/ 会/ 发生/ 缺失/ ./ 这/ 也/ 就/ 说明/ 了/ Moby/ 应用程序/ 的/ 指令/ Cache/ 缺失/ 率高/ 的/ 原因/ ./ 就算/ 采用/ L2Cache/ 的/ 16/ 路组/ 相联/ 策略/ ,/ 也/ 仅/ 有/ 60/ %/ 的/ 请求/ 会/ 命中/ ,/ 仍然/ 会/ 有/ 接近/ 40/ %/ 的/ 指令/ 请求/ 会/ 发生/ 缺失/ ,/ 而/ 去/ 访问/ 开销/ 较大/ 的/ 内存/ ./ 6.3/ 指令/ 执行/ 流/ 移动/ 设备/ 的/ 应用程序/ 一般/ 都/ 呈现出/ 复杂/ 的/ 指令/ 执行/ 轨迹/ ./ 一方面/ ,/ 移动/ 应用/ 依赖于/ 图像/ 显示/ 界面/ ,/ 需要/ 频繁/ 地/ 调用/ 图像/ 库来/ 描绘/ 、/ 合成/ 新/ 的/ 图像/ ;/ 另一方面/ ,/ Android/ 上/ 的/ 应用程序/ 利用/ 面向对象/ 的/ Java/ 语言/ 编程/ ,/ 运行/ 过程/ 中/ 也/ 依赖/ JVM/ 相关/ 的/ 库函数/ ./ 此外/ ,/ 移动/ 设备/ 中/ 存在/ 许多/ 后台/ 进程/ 或/ 线程/ ,/ 用于/ 监控/ 用户/ 的/ 操作/ 、/ 硬件平台/ 的/ 资源/ 利用/ 情况/ ,/ 这/ 也/ 可能/ 改变/ 应用/ 程序运行/ 过程/ 中/ 指令/ 的/ 执行/ 轨迹/ ./ 图/ 9/ 显示/ 了/ Moby/ 各/ 应用/ 程序运行/ 过程/ 中/ 创建/ 的/ 进程/ 或/ 线程/ 数及/ 调用/ 库/ 的/ 数量/ ./ 大部分/ 应用/ 都/ 创建/ 了/ 数十个/ 进程/ 或/ 线程/ ,/ 调用/ 库函数/ 的/ 数量/ 基本/ 都/ 超过/ 了/ 15/ 个/ ./ 其中/ ,/ 有/ 6/ 个/ 应用/ 甚至/ 调用/ 了/ 20/ 多个/ 库函数/ ./ 这些/ 库函数/ 会/ 显著/ 地/ 增加/ 代码/ 足迹/ ,/ 并/ 给/ 指令/ 相关/ 的/ 部件/ 如/ 指令/ Cache/ 和/ 指令/ TLB/ 的/ 性能/ 提出/ 了/ 更/ 高/ 的/ 要求/ ./ 而且/ ,/ 多个/ 进程/ 或/ 线程/ 并发/ 指令/ ,/ 也/ 会/ 相互/ 干扰/ 各自/ 的/ 执行/ 流程/ ,/ 竞争/ 硬件平台/ 的/ 资源/ ./ 图/ 9Moby/ 应用程序/ 的/ 进程/ 或/ 线程/ 数/ 以及/ 调用/ 库/ 的/ 数量/ 为了/ 更好/ 地/ 了解/ 指令/ 的/ 动态/ 行为/ ,/ 本文/ 收集/ 了/ 指令/ 的/ 访问/ 序列/ ,/ 并/ 将/ 其/ 对应/ 到/ 指令/ 所在/ 的/ 可执行文件/ ,/ 例如/ 源代码/ 、/ 库函数/ 、/ 操作系统/ 内核/ 等/ ./ 图/ 10/ 刻画/ 了/ KingsoftOffice/ 应用/ 的/ 指令/ 执行/ 流程图/ ./ 横坐标/ 代表/ 在/ 时间/ 序上/ 应用/ 已/ 执行/ 的/ 指令/ 数/ ,/ 而/ 纵坐标/ 显示/ 各/ 指令/ 对应/ 的/ 二进制/ 文件/ ./ 大体上/ ,/ 操作系统/ 内核/ 以及/ 5/ 个/ 库函数/ 主导/ 了/ KingsoftOffice/ 应用/ 的/ 指令/ ./ 这/ 5/ 个/ 库函数/ 分别/ 是/ dalvik/ -/ jit/ -/ code/ -/ cache/ 、/ libdvm/ ./ so/ 、/ libcutils/ ./ so/ 、/ libnativehelper/ ./ so/ 以及/ libc/ ./ so/ ./ 这/ 几个/ 库函数/ 主要/ 分为/ 3/ 类/ ,/ Java/ 语言/ 相关/ 、/ C语言/ 相关/ ,/ 以及/ 系统/ 相关/ 的/ 函数/ ./ 同时/ ,/ 应用程序/ 会/ 在/ 不同/ 的/ 文件/ 中/ 频繁/ 地/ 切换/ ,/ 如/ libc/ ./ so/ 和/ 内核/ 基本/ 是/ 交叉/ 执行/ 的/ ./ 在/ 这种/ 情形/ 下/ ,/ 指令/ 的/ 局部性/ 以及/ 分支/ 预测/ 的/ 准确度/ 都/ 会/ 受到/ 影响/ ./ 6.4/ 主/ 成分/ 特征分析/ 要/ 设计/ 一个/ 基准/ 测试程序/ 集/ ,/ 不仅/ 要/ 详细/ 地/ 刻画/ 各/ 应用程序/ 的/ 特征/ ,/ 还/ 需/ 证明/ 应用程序/ 间/ 存在/ 较大/ 的/ 差异/ ,/ 能够/ 代表/ 具有/ 不同/ 特征/ 的/ 应用/ 类别/ ./ 然而/ ,/ 不同/ 的/ 性能指标/ 间/ 都/ 会/ 存在/ 一定/ 的/ 关联/ ,/ 有的是/ 松/ 耦合/ ,/ 有的是/ 紧/ 耦合/ ./ 因此/ ,/ 不能/ 单纯/ 地/ 根据/ 差异/ 指标/ 的/ 数量/ 来/ 衡量/ ./ 本文/ 采用/ 主/ 成分/ 分析法/ ①/ 区分/ 指标/ 间/ 的/ 关联度/ ,/ 以及/ 不同/ 指标/ 的/ 重要/ 度/ ./ 主/ 成分/ 分析法/ 可以/ 将/ 多个/ 指标/ 映射/ 到/ 形成/ 多个/ 关联度/ 不大/ 的/ 主/ 成员/ ,/ 而主/ 成员/ 的/ 重要/ 度/ 通过/ 概率/ 权值/ 来/ 描述/ ./ 第一/ 主/ 成员/ ,/ 也/ 就是/ 概率/ 权值/ 最大/ 的/ 主/ 成员/ ,/ 很大/ 程度/ 上/ 反映/ 了/ 应用/ 间/ 的/ 关系/ ./ 如果/ 两个/ 应用/ 的/ 主/ 成员/ 概率/ 权值/ 类似/ ,/ 则/ 说明/ 它们/ 之间/ 的/ 相似/ 度/ 较大/ ./ 以/ 上述/ 微/ 体系结构/ 无关/ 的/ 特征/ 指标/ 为例/ ,/ 本文/ 分析/ 了/ Moby/ 中/ 应用程序/ 主/ 成分/ 分析/ 的/ 结果/ ,/ 如图/ 11/ 所示/ ./ 横坐标/ 显示/ 各/ 应用/ 第一/ 主/ 成员/ (/ Dim1/ )/ 的/ 值/ ,/ 而/ 纵坐标/ 刻画/ 第二/ 主/ 成员/ (/ Dim2/ )/ 的/ 权值/ ./ 第一/ 主/ 成员/ 代表/ 了/ 65/ %/ 的/ 差异/ 度/ ,/ 第二/ 主/ 成员/ 则/ 代表/ ①/ Principalcomponentanalysis/ ./ https/ :/ // // en/ ./ wikipedia/ ./ org/ // Page1019/ %/ 的/ 差异/ 度/ ./ 因而/ ,/ 这/ 两个/ 主/ 成员/ 基本/ 代表/ 了/ 应用程序/ 间/ 的/ 差异/ 度/ ./ 两个/ 点/ 距离/ 越近/ ,/ 意味着/ 两个/ 应用/ 的/ 差异/ 度越/ 低/ ./ 由图/ 可以/ 看出/ ,/ Moby/ 的/ 10/ 个/ 应用程序/ 基本/ 分散/ 在/ 不同/ 的/ 区域/ ./ 这/ 也就是说/ ,/ Moby/ 的/ 应用程序/ 具有/ 各自/ 独特/ 的/ 特征/ ,/ 能够/ 代表/ 不同/ 类型/ 的/ 应用程序/ ./ 图/ 11Moby/ 应用程序/ 体系结构/ 无关/ 特征/ 的/ 主/ 成分/ 分析/ 7/ 相关/ 工作/ 目前/ ,/ 市场/ 上/ 有/ 很多/ 专业/ 的/ 评估/ 软件/ ,/ 用于/ 对/ 大型/ 手机/ 厂商/ 新/ 上市/ 的/ 机器/ 做出/ 测评/ ,/ 测评/ 的/ 内容/ 包括/ CPU/ 计算/ 性能/ 、/ GPU/ 运算/ 性能/ 、/ 内存/ 读写/ 性能/ 等/ ,/ 类似/ 的/ 有/ EEMBC/ ①/ 、/ Antutu/ 、/ 3DGLBenchMark/ ②/ 、/ Geekbench/ ③/ 以及/ 测试/ JavaScript/ 的/ SunSpider/ ,/ 测试/ HTML5/ 的/ Vellamo/ ④/ ,/ 视频/ 软解/ 测试/ 等/ 软件/ ./ 然而/ ,/ 大多数/ 测试/ 应用/ 都/ 是非/ 开源/ 的/ ,/ 而且/ 针对性/ 很强/ ,/ 不利于/ 反映/ 普遍/ 情况/ ,/ 因此/ ,/ 我们/ 只/ 挑选/ 了/ 几个/ 专业/ 测试/ 应用/ ./ 在/ 研究/ 领域/ ,/ MiBench/ [/ 7/ ]/ 是/ 常用/ 的/ 嵌入式/ 系统/ 的/ 基准/ 测试程序/ ,/ 包含/ 了/ 6/ 类共/ 35/ 个/ 应用程序/ ./ 不过/ 这些/ 应用程序/ 与/ 移动/ 设备/ 上/ 的/ 应用程序/ 存在/ 较大/ 的/ 差异/ ,/ 包括/ 编程语言/ 及/ 实现/ 功能/ 等/ ./ Gutierrez/ 等/ 人/ 在/ 文献/ [/ 5/ ]/ 中/ ,/ 挑选/ 并/ 分析/ 了/ 几个/ 应用程序/ 作为/ 测试程序/ 例如/ 浏览器/ 应用/ BBench/ 、/ 视频/ 客户端/ ,/ 不过/ 其/ 分析/ 的/ 应用程序/ 种类/ 不/ 多/ ,/ 没有/ 包括/ 地图/ 、/ 文档/ 处理/ 等/ 类别/ 的/ 应用/ ./ MobileBench/ [/ 8/ ]/ 仅/ 选择/ 浏览器/ 、/ 图像处理/ 和/ 视频/ 播放/ 应用/ ,/ 并/ 详细/ 地/ 分析/ 了/ 它们/ 对/ 不同/ 体系结构/ 部件/ 如/ Cache/ 、/ TLB/ 等/ 的/ 敏感度/ ./ Sunwoo/ 等/ 人/ [/ 3/ ]/ 分析/ 了/ 几类/ 应用/ 的/ Java/ 虚拟机/ 、/ SQLite/ 和/ 整体/ 系统/ 的/ 性能/ ./ 总体/ 来说/ ,/ 已有/ 工作/ 仅/ 分析/ 了/ 部分/ 移动/ 设备/ 上/ 的/ 应用程序/ ,/ 不能/ 覆盖/ 现有/ 用户/ 对/ 应用程序/ 的/ 需求/ ./ 8/ 总结/ 移动/ 设备/ 应用/ 越来越/ 广泛/ ,/ 包括/ 工业生产/ 、/ 日常/ 办公/ 、/ 生活/ 娱乐/ 、/ 学校/ 教育/ 等/ ./ 由于/ 移动/ 设备/ 依靠/ 电池/ 续航/ ,/ 因此/ 在/ 设计/ 过程/ 中/ 对/ 功耗/ 和/ 性能/ 之间/ 的/ 权衡/ 显得/ 尤为重要/ ./ 并且/ ,/ 在/ 移动/ 设备/ 上/ 的/ 应用程序/ 中/ ,/ 不同/ 类型/ 的/ 应用/ 对于/ 硬件资源/ 的/ 需求/ 不同/ ,/ 对于/ 处理器/ 资源/ 的/ 利用/ 并/ 不/ 高/ ,/ 很少/ 应用/ 能够/ 得益于/ 多核/ 处理/ 的/ 设计/ ./ 因此/ ,/ 需要/ 对/ 这些/ 应用/ 进行/ 优化/ ,/ 让/ 它们/ 能够/ 更好/ 地/ 运行/ 在/ 移动/ 设备/ 上/ ./ 作为/ 优化/ 的/ 指导/ ,/ 需要/ 分析/ 不同/ 应用程序/ 的/ 体系结构/ 特征/ ./ 本文/ 选取/ 12/ 类/ 应用程序/ 并/ 对/ 它们/ 进行/ 的/ 微/ 体系结构/ 相关/ 的/ 特征/ 进行/ 了/ 分析/ ,/ 包括/ 指令/ 缓存/ 、/ 数据/ 缓存/ 、/ TLB/ 、/ 二级缓存/ 相关/ 的/ 体系结构/ 特征/ ./ 实验/ 结果表明/ ,/ 大部分/ 移动/ 设备/ 上/ 的/ 应用程序/ 都/ 有/ 较/ 高/ 的/ 指令/ Cache/ 和/ 指令/ TLB/ 缺失/ 率/ ,/ 存在/ 较大/ 的/ 优化/ 空间/ ./ 为了/ 方便/ 移动/ 处理器/ 的/ 体系结构/ 优化/ ,/ 本文/ 提出/ 了/ 一个/ 移动/ 设备/ 的/ 基准/ 测试程序/ 集/ Moby/ ./ Moby/ 包含/ 了/ 浏览器/ 、/ 邮件/ 客户端/ 、/ 音视频/ 播放器/ 、/ 文档/ 处理软件/ 、/ 地图/ 及/ 游戏/ 等/ 10/ 个/ 移动/ 应用程序/ ./ 接着/ ,/ 本文/ 对/ 这/ 10/ 个/ 应用程序/ 的/ 自身/ 特征/ ,/ 也/ 就是/ 微/ 体系结构/ 无关/ 的/ 特征/ ,/ 进行/ 了/ 详细/ 的/ 分析/ ./ 该/ 基准/ 测试程序/ 集已/ 被/ 移植/ 到/ 常用/ 的/ 体系结构/ 模拟器/ Gem5/ 上/ ,/ 并/ 实现/ 开源/ ./ 

