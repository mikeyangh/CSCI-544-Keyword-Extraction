Page1/ 路由/ 协议/ 的/ 符号化/ 测试/ 生成/ 邢熠/ 1/ )/ ,/ 2/ )/ ,/ 3/ )/ 叶新铭/ 2/ )/ 谢高岗/ 1/ )/ 1/ )/ (/ 中国科学院计算技术研究所/ 北京/ 100190/ )/ 2/ )/ (/ 内蒙古大学/ 计算机/ 学院/ 呼和浩特/ 010021/ )/ 3/ )/ (/ 中国科学院/ 研究生院/ 北京/ 100049/ )/ 摘要/ 协议/ 一致性/ 测试/ 用于/ 验证/ 协议/ 实现/ 的/ 正确性/ ./ 文中/ 根据/ 路由/ 协议/ 的/ 消息/ 复杂/ 特点/ ,/ 提出/ 基于/ on/ -/ the/ -/ fly/ 策略/ 符号/ 测试/ 生成/ 与/ 动态/ 执行/ 的/ 算法/ :/ 建立/ 了/ 一种/ 新/ 的/ 统一/ 符号/ 语义/ 模型/ ,/ 该/ 模型/ 把/ 数据/ 操作/ 和/ 控制/ 都/ 抽象/ 为/ 动作/ 行为/ ;/ 以该/ 语义/ 模型/ 为/ 基础/ ,/ 扩展/ 了/ 行为/ 之间/ 的/ 关系/ 以及/ 一致性/ 测试/ 关系/ ;/ 给出/ 了/ 基于/ on/ -/ the/ -/ fly/ 策略/ 符号/ 测试/ 生成/ 与/ 符号/ 动态/ 执行/ 的/ 算法/ ,/ 在/ 符号/ 动态/ 执行/ 中/ ,/ 使用/ 了/ 统计/ 的/ 聚类/ 算法/ 来/ 进行/ 符号/ 的/ 数据/ 选择/ ./ 论文/ 最后/ 用/ 具体/ 的/ 测试/ 例/ 说明/ 该/ 算法/ 在/ OSPFv3/ 协议/ 一致性/ 测试/ 上/ 的/ 应用/ ./ 关键词/ 协议/ 一致性/ 测试/ ;/ 统一/ 语义/ 模型/ ;/ 符号/ 测试/ 生成/ ;/ 符号执行/ ;/ 数据/ 选择/ 1/ 引言/ 一致性/ 测试/ 可以/ 有效/ 地/ 衡量/ 网络协议/ 的/ 实现/ 与/ 协议/ 规范/ 说明/ 的/ 行为/ 保持一致/ 的/ 程度/ ,/ 主要/ 包括/ 测试/ 生成/ 、/ 执行/ ./ 手工/ 进行/ 测试/ 生成/ 与/ 执行/ 具有/ 效率/ 低/ 和/ 覆盖/ 不/ 全面/ 的/ 缺点/ ,/ 自动化/ 测试/ 是/ 改进/ 这些/ 缺陷/ 的/ 一个/ 有效途径/ ./ 协议/ 规范/ 的/ 形式化/ 模型/ 是/ 自动化/ 测试/ 基础/ ,/ 可以/ 充分/ 描述/ 协议/ 的/ 行为/ 与/ 属性/ ;/ 通过/ 形式化/ 模型/ 就/ 可以/ 定义/ 被测/ 实现/ 与/ 规范/ 说明/ 一致性/ 的/ Page2/ 标准/ ,/ 也/ 就是/ 一致性/ 关系/ ;/ 根据/ 一致性/ 关系/ 就/ 可以/ 产生/ 抽象/ 测试/ 套/ ,/ 然后/ 转化/ 为/ 可/ 执行/ 测试/ 套/ ,/ 在/ 测试/ 执行/ 系统/ 上/ 执行/ 来/ 验证/ 被测/ 实现/ 是否/ 满足/ 一致性/ 关系/ ./ 在/ 协议/ 测试/ 实践/ 中/ ,/ 由于/ 协议/ 自身/ 的/ 复杂性/ ,/ 对/ 形式化/ 模型/ 、/ 一致性/ 关系/ 、/ 测试/ 生成/ 、/ 测试/ 执行/ 提出/ 了/ 更/ 多/ 的/ 挑战/ ./ 路由/ 协议/ 的/ 突出/ 特点/ 是/ 消息/ 数据/ 与/ 行为/ 的/ 极大/ 相关性/ ./ 根据/ 消息/ 数据/ 的/ 不同/ 属性/ 字/ 段/ ,/ 会/ 产生/ 完全/ 不同/ 的/ 行为/ ./ 如/ OSPFv3/ 协议/ 在/ 建立/ 邻居/ 关系/ 时/ ,/ 只有/ 当/ 收到/ 期望/ 的/ 标识符/ ,/ 同时/ 回应/ 相应/ 的/ 响应/ 才/ 可能/ 建立/ 关系/ ./ 所以/ 在/ 路由/ 协议/ 的/ 一致性/ 测试/ 时/ 就要/ 充分考虑/ 这种/ 数据/ 对/ 控制/ 行为/ 的/ 影响/ ,/ 行为/ 和/ 数据/ 是/ 不可/ 分/ 的/ ./ 这些/ 新/ 的/ 特点/ 要求/ 建模/ 时/ 就要/ 统一/ 考虑/ 控制/ 行为/ 和/ 消息/ 数据/ ./ 现有/ 的/ 路由/ 协议/ 测试/ 研究/ 主要/ 集中/ 在/ 两个/ 方面/ ,/ 一个/ 是/ 基于/ 控制/ 行为/ 的/ 测试/ 生成/ ./ 状态机/ [/ 1/ -/ 4/ ]/ 或/ 标记/ 变迁/ 系统/ [/ 5/ ]/ 模型/ 进行/ 测试/ 生成/ 主要/ 关注/ 协议/ 说明/ 的/ 控制/ 行为/ ,/ 而/ 忽略/ 了/ 消息/ 的/ 处理/ ,/ 需要/ 人工/ 根据/ 生成/ 的/ 抽象/ 测试/ 套/ 加入/ 消息/ 数据/ 形成/ 最终/ 的/ 测试/ 套/ ,/ 由于/ 人工/ 的/ 介入/ ,/ 造成/ 了/ 测试/ 套/ 覆盖/ 的/ 主观性/ 和/ 不/ 全面性/ ./ 另/ 一个/ 是/ 符号/ 技术/ 的/ 测试/ 产生/ ./ 文献/ [/ 6/ -/ 9/ ]/ 在/ 测试/ 生成/ 时/ ,/ 同时/ 关注/ 了/ 控制/ 行为/ 和/ 消息/ 数据/ ,/ 而且/ 消息/ 数据/ 采取/ 了/ 符号化/ 的/ 技术/ ,/ 但是/ 对/ 数据/ 的/ 处理/ 和/ 行为/ 处理/ 仍然/ 采取/ 独立/ 的/ 策略/ ,/ 同时/ 忽略/ 了/ 符号化/ 数据/ 的/ 选择/ 问题/ ./ 由于/ 已有/ 测试/ 模型/ 不能/ 有效/ 地/ 解决/ 路由/ 协议/ 测试/ ,/ 本文/ 的/ 工作/ 围绕/ 以下/ 3/ 个/ 方面/ 展开/ :/ 第/ 1/ 个/ 方面/ 是/ 基础/ ,/ 提出/ 了/ 一种/ 新/ 的/ 路由/ 协议/ 的/ 需求/ 模型/ ,/ 集中/ 在/ 操作/ 语义/ 层面/ ,/ 给出/ 了/ 扩展/ 的/ 符号化/ 输入输出/ 变迁/ 系统/ EIOSTS/ (/ ExtendedInput/ -/ OutputSymbolicTransitionSystem/ )/ ,/ 主要/ 拓展/ 了/ 行为/ 的/ 范围/ ,/ 不仅/ 包括/ 控制/ 行为/ ,/ 而且/ 涵盖/ 消息/ 数据/ 上/ 的/ 操作/ ,/ 使得/ 控制/ 行为/ 和/ 数据/ 操作/ 采取/ 统一/ 的/ 形式/ 进行/ 描述/ ;/ 从/ 扩展/ 语义/ 模型/ 出发/ ,/ 提出/ 新/ 的/ 一致性/ 关系/ ,/ 即/ 扩展/ 的/ 符号/ 一致性/ 关系/ ./ 第/ 2/ 个/ 方面/ 关于/ 测试/ 生成/ ,/ 本文/ 采取/ on/ -/ the/ -/ fly/ 和/ 符号/ 推迟/ 策略/ 来/ 进行/ 产生/ 符号/ 测试/ 套/ ,/ 从而/ 极大/ 地/ 减少/ 了/ 状态/ 空间/ 的/ 容量/ ./ 最后/ 是/ 关于/ 符号/ 测试/ 套/ 的/ 执行/ ,/ 符号/ 的/ 实例/ 化/ 通过/ 统计/ 的/ 聚类/ 方法/ 实现/ ./ 根据/ 以上/ 的/ 思路/ ,/ 文章/ 按/ 如下/ 方式/ 进行/ 组织/ :/ 首先/ 提出/ 协议/ 操作/ 语义/ 模型/ ,/ 主要/ 包括/ EIOSTS/ 模型/ 和/ 相关/ 的/ 符号/ 一致性/ 关系/ ;/ 然后/ 是/ 符号化/ 模型/ EIOSTS/ 下/ 测试/ 框架/ ,/ 给出/ 了/ 该/ 框架/ 下/ 的/ 符号/ 测试/ 生成/ 和/ 符号/ 测试/ 执行/ 算法/ ,/ 同时/ 提出/ 了/ 基于/ 聚类/ 的/ 数据/ 选择/ 算法/ ;/ 最后/ 通过/ OSPFv3/ 协议/ 实例/ 给出/ 该/ 生成/ 算法/ 的/ 说明/ ./ 2EIOSTS/ 模型/ 协议/ 规范/ 和/ 被/ 测/ 实现/ 的/ 操作/ 语义/ 模型/ 是/ 产生/ 测试/ 的/ 基础/ ,/ 本文/ 使用/ 扩展/ 输入输出/ 符号/ 变迁/ 系统/ EIOSTS/ 描述/ 协议/ 规范/ 和/ 被/ 测/ 实现/ 的/ 行为/ 活动/ 和/ 符号/ 一致性/ 关系/ ./ 下面/ 是/ 该/ 模型/ 的/ 语法/ 和/ 标记/ ./ 2.1/ EIOSTS/ 的/ 语法/ 和/ 语义/ 为了/ 方便/ 研究/ ,/ 本文/ 使用/ 的/ 消息/ 数据/ 采取/ 变量/ 的/ 定义/ ./ X/ 表示/ 变量/ 集合/ ,/ 元素/ 记为/ x/ ,/ y/ ,/ …/ ./ F/ 表示/ 数值/ 计算/ 函数/ 的/ 集合/ ,/ 是从/ 变量/ x/ 到/ 数值/ v/ 的/ 函数/ ,/ 记/ 为/ ρ/ ,/ ρ/ [/ v/ // x/ ]/ 表示/ 把/ 变量/ x/ 换成/ 数值/ v/ 后/ 得到/ 的/ 结果/ ./ 对于/ 路由/ 协议/ ,/ 计算/ 函数/ ρ/ 包括/ 解包/ Unpack/ 、/ 打包/ Pack/ 、/ 提取/ 字/ 段/ 变量/ Get/ 、/ 变量/ 赋值/ Entail/ 、/ 变量/ 比较/ Choice/ 、/ 变量/ 计算/ Com/ ./ Exp/ 表示/ 表达式/ 的/ 集合/ ,/ 记为/ e/ ,/ 它/ 可以/ 包含/ 变量/ x/ 和/ 数值/ v/ ,/ ρ/ (/ e/ )/ 代表/ 在/ 表达式/ e/ 上/ 进行/ 的/ 计算/ ./ 定义/ 1/ ./ EIOSTS/ (/ InputOutputSymbolicTran/ -/ sitionSystems/ )/ 是/ 一个/ 6/ 元组/ EIOSTS/ =/ 〈/ S/ ,/ L/ ,/ X/ ,/ Σ/ ,/ T/ ,/ s0/ 〉/ ./ 其中/ (/ 1/ )/ S/ 表示/ 系统/ 的/ 可数/ 状态/ 集/ ./ (/ 2/ )/ s0/ 表示/ 初始状态/ ./ (/ 3/ )/ X/ 表示/ 数据/ 变量/ 集/ ,/ 变量/ 具有/ 有限/ 的/ 值域/ ./ (/ 4/ )/ L/ 表示/ 接口/ 集/ ./ 为了/ 讨论/ 方便/ ,/ 假定/ 接口/ L/ 分成/ 输入/ 接口/ LI/ 和/ 输出/ 接口/ LO/ ./ (/ 5/ )/ 系统活动/ Σ/ =/ {/ LI/ ?/ x/ ,/ LO/ !/ e/ ,/ ρ/ (/ e/ )/ }/ ∪/ τ/ ,/ Σ/ O/ =/ {/ LO/ !/ e/ |/ e/ ∈/ Exp/ }/ ,/ Σ/ I/ =/ {/ LI/ ?/ x/ |/ x/ ∈/ X/ }/ ,/ τ/ 表示/ 内部/ 动作/ ,/ Σ/ m/ =/ ρ/ (/ e/ )/ 表示/ 消息/ 数据/ 的/ 处理/ ./ (/ 6/ )/ T/ / S/ ×/ Σ/ ×/ S/ 是/ 变迁/ 关系/ ./ 简记/ 为/ S/ →/ Σ/ S/ 表示/ 系统/ 从/ 状态/ S/ 经历/ 活动/ Σ/ 后/ 到达/ 新/ 的/ 状态/ S/ ./ 对于/ 该/ 模型/ ,/ 本文/ 假定/ 是/ 强/ 收敛/ 的/ ,/ 即/ 不会/ 执行/ 无限/ 的/ 内部/ 活动/ ./ 同时/ 弱/ 输入/ 是/ 可能/ 的/ ,/ 即/ 在/ 任何/ 情况/ 下/ 都/ 不能/ 拒绝/ 输入/ 活动/ ./ 输入输出/ 符号/ 变迁/ 系统/ 可以/ 图示/ 为/ 有/ 向/ 标记/ 图/ ,/ 节点/ 对应状态/ ,/ 标记/ 边/ 对应/ 符号/ 变迁/ ./ 2.2/ EIOSTS/ 的/ 行为/ 描述/ 具备/ 了/ 以上/ 的/ 语义/ 模型/ ,/ 就/ 可以/ 给出/ 基于/ EIOSTS/ 的/ 行为/ 描述/ ./ 为了/ 讨论/ 上/ 的/ 方便/ ,/ 采用/ 如下/ 标记/ :/ P/ =/ 〈/ S/ ,/ L/ ,/ X/ ,/ Σ/ ,/ T/ ,/ s0/ 〉/ ;/ s/ ,/ s/ ∈/ S/ ;/ a/ ,/ a1/ ,/ a2/ ,/ …/ ,/ an/ ∈/ Σ/ ;/ Page3/ ε/ 表示/ 空/ 活动/ ;/ σ/ ∈/ (/ Σ/ )/ / 表示/ 活动/ 序列/ ,/ Ο/ / Σ/ 表示/ 活动/ 集/ 的/ 子集/ ./ 定义/ 行为/ 如下/ :/ (/ 1/ )/ s/ →/ ρ/ (/ e/ )/ s/ 表示/ 系统/ 在/ 状态/ s/ 进行/ 数据处理/ ρ/ (/ e/ )/ 后/ 进入状态/ s/ ./ (/ 2/ )/ s/ / as/ ≡/ def/ / s1/ ,/ s2/ ∈/ S/ ,/ s/ / ε/ s1/ →/ as2/ / ε/ s/ 系统/ 从/ 状态/ 经过/ 可/ 观察/ 活动/ a/ 到达/ 状态/ s/ ./ (/ 3/ )/ safter/ σ/ =/ def/ {/ s/ ∈/ S/ :/ s/ / σ/ s/ }/ 表示/ 状态/ s/ 经历/ 某个/ 可/ 观察/ 活动/ 序列/ σ/ 到达/ 的/ 某些/ 状态/ s/ 集/ ./ (/ 4/ )/ safter/ σ/ refuseO/ =/ def/ / s/ :/ s/ / σ/ sandinit/ (/ s/ )/ ∩/ O/ =/ / 状态/ s/ 经历/ 可/ 观察/ 活动/ 序列/ σ/ 到达/ 状态/ s/ ,/ 在/ 状态/ s/ ,/ 系统/ 不/ 可能/ 进行/ 任何/ 包含/ 在/ 活动/ 集/ O/ 中/ 的/ 活动/ ./ (/ 5/ )/ safter/ σ/ deadlocks/ =/ defafter/ σ/ refuse/ Σ/ 状态/ s/ 经历/ 可/ 观察/ 活动/ 序列/ σ/ 到达/ 状态/ s/ ;/ 在/ 状态/ s/ ,/ 系统/ 不/ 可能/ 进行/ 任何/ 活动/ ,/ 进入/ 死锁/ ./ 2.3/ EIOSTS/ 上/ 的/ 一致性/ 关系/ 为了/ 便于/ 讨论/ ,/ 被测/ 实现/ 、/ 协议/ 规范/ 、/ 测试/ 器/ 都/ 建模/ 为/ EIOSTS/ 同时/ 采取/ 如下/ 标记/ :/ u/ ,/ i/ ,/ s/ ∈/ EIOSTS/ ./ 文献/ [/ 10/ ]/ 中/ 定义/ 了/ 符号化/ 一致性/ 关系/ eiosconf/ ,/ 下面/ 是/ 该/ 定义/ 的/ 形式化/ 描述/ ./ 定理/ 1/ ./ i/ ,/ s/ ∈/ EIOSTS/ (/ Σ/ I/ ,/ Σ/ O/ )/ ,/ i/ / eiosconfsiff/ / σ/ ∈/ (/ Σ/ O/ ∪/ Σ/ I/ ∪/ Σ/ m/ )/ / :/ out/ (/ iafter/ σ/ )/ / out/ (/ safter/ σ/ )/ 该/ 定理/ 表明/ ,/ 对于/ 任意/ 由/ 输出/ 、/ 输入/ 、/ 数据/ 计算/ 形成/ 的/ 行为/ 迹/ σ/ ,/ 如果/ 在/ 实现/ i/ 执行/ 所/ 产生/ 的/ 输出/ 包含/ 在/ 相应/ 的/ 规范/ 上/ 执行/ 所/ 产生/ 的/ 输出/ ,/ 就/ 认为/ 实现/ i/ 与/ 规范/ s/ 满足/ 一致性/ 关系/ ./ 3/ 测试/ 生成/ 与/ 执行/ 3.1/ 测试/ 框架/ 在/ 协议/ 规范/ 和/ 被/ 测/ 实现/ 的/ 模型/ 以及/ 符号化/ 一致性/ 关系/ eiosconf/ 基础/ 上/ 就/ 可以/ 进行/ 测试/ 例/ 的/ 生成/ ./ 我们/ 仍然/ 把/ 测试/ 例/ 建模/ 为/ 符号/ 变迁/ 系统/ ,/ 根据/ 文献/ [/ 9/ ]/ 中/ 测试/ 例/ 特性/ ,/ 采用/ 如下/ 的/ 测试/ 例/ 定义/ ./ Σ/ ,/ T/ ,/ s0/ ,/ υ/ 〉/ ,/ 其中/ 号/ 变迁/ 系统/ ,/ 而且/ 只有/ 有限/ 的/ 活动/ ./ 定义/ 2/ ./ 测试/ 例是/ 一个/ 7/ 元组/ ,/ t/ =/ 〈/ S/ ,/ L/ ,/ X/ ,/ (/ 1/ )/ 〈/ S/ ,/ L/ ,/ X/ ,/ Σ/ ,/ F/ ,/ T/ ,/ s0/ 〉/ 是/ 确定/ 的/ 输入输出/ 符/ (/ 2/ )/ 测试/ 例在/ 任何/ 状态/ t/ 只能/ 在/ 输入/ 活动/ 、/ 输出/ 活动/ 、/ 数据/ 计算/ 、/ 等待/ 或者/ 静止/ 中/ 选择/ 一种/ ./ (/ 3/ )/ υ/ :/ S/ →/ {/ pass/ ,/ fail/ }/ 是/ 断言/ 函数/ ./ 测试/ 套/ T/ 是/ 测试/ 例/ t/ 的/ 集合/ ./ 3.2/ 测试/ 生成/ 与/ 执行/ 基于/ 符号/ 变迁/ 模型/ 和/ 变迁/ 图/ 的/ 同构/ 关系/ ,/ 本文/ 采用/ 变迁/ 图/ 的/ 强/ 连通/ 图来/ 产生/ 测试/ 例/ ./ 由于/ 数据处理/ 行为/ 直接/ 影响/ 了/ 测试/ 的/ 选择/ 和/ 执行/ ,/ 本/ 算法/ 采取/ 了/ 动态/ 生成/ 和/ 执行/ 的/ 两步/ 策略/ ./ 算法/ 1/ 是/ 符号/ 测试/ 套/ 的/ 动态/ 生成/ 算法/ ./ 输入/ 是/ 协议/ 规范/ 和/ 测试/ 目的/ ,/ 测试/ 目的/ 的/ 作用/ 就是/ 在/ 测试/ 生成/ 的/ 过程/ 中/ 裁剪/ 掉/ 与/ 之/ 无关/ 的/ 分支/ ,/ 从而/ 大大降低/ 了/ 状态/ 空间/ ,/ 输出/ 结果/ 是/ 符号化/ 的/ 测试/ 套/ ,/ 符号化/ 的/ 数据/ 还/ 没有/ 进行/ 数据/ 选择/ ./ 算法/ 2/ 是/ 符号/ 测试/ 的/ 动态/ 执行/ ,/ 输入/ 是/ 算法/ 1/ 的/ 输出/ ,/ 即/ 符号化/ 测试/ 套/ ,/ 在/ 执行/ 过程/ 中/ 动态/ 地/ 进行/ 数据/ 选择/ ,/ 从而/ 实例/ 化/ 符号化/ 数据/ ,/ 这样/ 就/ 可以/ 裁剪/ 掉/ 与/ 具体/ 数据/ 无关/ 的/ 分支/ ,/ 降低/ 了/ 时间/ 和/ 空间/ 规模/ ./ 算法/ 1/ 首先/ 生成/ 协议/ 说明/ 和/ 测试/ 目的/ 的/ 组合/ 图/ ,/ 然后/ 根据/ 测试/ 目的/ 选择性/ 地/ 生成/ 测试/ 套/ ./ 根据/ 文献/ [/ 11/ -/ 12/ ]/ 给出/ 图/ 1/ 的/ 符号/ 测试/ 生成/ 算法/ ,/ 输入/ 是/ 协议/ 说明/ 和/ 测试/ 目的/ 的/ 笛卡尔/ 积/ ,/ 表示/ 成/ 符号/ 变迁/ 模型/ ,/ 即/ 符号/ 变迁/ 图/ ,/ 测试/ 目的/ 增加/ 了/ Accept/ 和/ Reject/ 状态/ 便于/ 测试/ 选择/ ./ 使用/ 的/ 数据结构/ Dfs/ _/ Stack/ :/ 保存/ 搜索/ 过程/ 中/ 当前/ 遍历/ 序列/ 的/ 堆栈/ ,/ Scc/ _/ Stack/ 保存/ 当下/ 的/ 联通/ 分量/ Scc/ 中/ 所有/ 已经/ 访问/ 的/ 状态/ ./ 节点/ s/ 是/ 个/ 结构化/ 的/ 变量/ State/ ./ 包含/ act/ :/ 到达/ 节点/ (/ 状态/ )/ s/ 的/ 图边/ ;/ number/ :/ 访问/ 编号/ ;/ lowlink/ :/ 根/ 节点/ 编号/ ;/ L2A/ :/ LeadingtoAcceptstate/ ./ 过程/ Adj/ _/ Set/ (/ p/ )/ ·/ ·/ =/ {/ (/ a/ ,/ q/ )/ |/ (/ p/ ,/ a/ ,/ q/ )/ ∈/ T/ }/ 计算/ 与/ 状态/ p/ 相连/ 的/ 状态/ 和/ 边/ 的/ 集合/ ./ SCC/ 的/ 构建/ 过程/ 中/ ,/ 遍历/ 的/ 边/ 可以/ 分为/ 以下/ 4/ 类/ :/ tree/ -/ arc/ 到达/ 新/ 状态/ 的/ 边/ ,/ 如果/ 在/ 同一个/ SCC/ 中/ ,/ 就是/ tree/ -/ arcin/ ,/ 不同/ 的/ SCC/ 中/ ,/ 表示/ 为/ tree/ -/ arcout/ ;/ fronds/ 从/ 子孙/ 到/ 祖先/ 的/ 边/ ;/ short/ -/ cut/ 从/ 祖先/ 到/ 子孙/ 的/ 边/ ,/ 同样/ 分为/ short/ -/ cutin/ ,/ short/ -/ cutout/ ;/ cross/ -/ link/ 从/ 一个/ 子树到/ 另/ 一个/ 子树/ 的/ 边/ ,/ 细化/ 为/ cross/ -/ linkin/ ,/ cross/ -/ linkout/ ./ 算法/ 2/ 根据/ 符号/ 数据/ 的/ 实例/ 化对/ 算法/ 1/ 得到/ 的/ 符号化/ 测试/ 套/ 进行/ 裁剪/ ,/ 形成/ 最终/ 可/ 执行/ 测试/ 套/ ./ 输入/ 是/ 符号化/ 测试/ 套/ Ts/ ,/ 输出/ 是/ 经过/ 数据/ 选择/ 的/ 实例/ 化/ 测试/ 套/ TD/ ./ 数据/ 变量/ 的/ 实例/ 化/ 主要/ 通过/ 函数/ 来/ 实现/ :/ DataSelect/ (/ )/ ./ 根据/ 文献/ [/ 13/ -/ 18/ ]/ 数据/ 说明/ SP/ 的/ 穷尽/ 测试/ 集/ exhaustive/ (/ SP/ )/ 是/ 数据项/ 所有/ 可能/ 的/ 实例/ 化/ 集合/ ./ 通常/ exhaustive/ (/ SP/ )/ 太/ 大/ ,/ 并/ 不/ 实用/ ,/ 所以/ 可以/ 对/ 被/ 测/ 实现/ 的/ 活动/ 增加/ 更强/ 的/ 假设/ 来/ 减少/ 必要/ 测试/ 的/ 数量/ ,/ 这些/ 假设/ 通称/ 为/ 选择/ 假设/ ,/ 最/ 常用/ 的/ 包括/ 一致性/ 假设/ 和/ 规则性/ 假设/ ./ 数据/ 实例/ 化/ 的/ 过程/ Page4/ 可以/ 采取/ 两种/ 策略/ ,/ 一种/ 是/ 用/ 数据/ 代数/ 的/ 所有/ 可能/ 值/ 首先/ 实例/ 化/ ,/ 然后/ 再/ 进行/ 数据/ 值/ 的/ 选择/ ;/ 另/ 一种/ 策略/ 是/ 在/ 实例/ 化/ 的/ 过程/ 中/ 就/ 采取/ 一定/ 的/ 策略/ 进行/ 实例/ 化/ ,/ 从而/ 避免/ 了/ 后面/ 的/ 测试/ 选择/ 过程/ ./ 本文/ 中/ 采取/ 后/ 一种/ 策略/ ./ 算法/ 1/ ./ 测试/ 套/ 生成/ :/ TG/ (/ State/ :/ pstart/ ∈/ S/ ×/ TP/ )/ // / / depthfirstsearch/ / / // State/ :/ psource/ ,/ ptarget/ ,/ ppred/ ;/ Adj/ _/ set/ :/ Adjsource/ ,/ Adjtarget/ ,/ AdjpredbeginInit/ (/ Dfs/ _/ Stack/ )/ ;/ Init/ (/ Scc/ _/ Stack/ )/ ;/ pstart/ ./ number/ ·/ ·/ =/ pstart/ ./ lowlink/ ·/ ·/ =/ i/ ·/ ·/ =/ i/ +/ 1/ ;/ pstart/ ./ act/ =/ ε/ ;/ pstart/ ./ L2A/ ·/ ·/ =/ pstart/ ∈/ Accept/ ;/ if/ (/ pstart/ ∈/ Reject/ )/ thenremoveall/ (/ pstart/ ,/ a/ ,/ p/ )/ fromtransitionsTPush/ (/ (/ pstart/ ,/ Adj/ _/ Set/ (/ pstart/ )/ )/ ,/ Dfs/ _/ Stack/ )/ ;/ Push/ (/ (/ pstart/ )/ ,/ Scc/ _/ Stack/ )/ ;/ whilenotemptyDfs/ _/ Stackdobegin/ (/ psource/ ,/ Adjsource/ )/ ·/ ·/ =/ top/ (/ Dfs/ _/ Stack/ )/ ;/ ifnotemptyAdjsourcethenbeginifptargetisn/ ’/ tnumberedthenbegin/ // / / tree/ -/ arc/ / / // elsebegin/ // / / nottree/ -/ arc/ ,/ isfrondorcross/ -/ linkin/ / / // if/ (/ ptarget/ ./ number/ </ psource/ ./ number/ ∧/ ifptarget/ ./ number/ </ psource/ ./ numberthenelsebegin/ // / / Adjsourceempty/ / / // ifpsource/ ./ lowlink/ =/ psource/ ./ numberthenbeginifnotempty/ (/ Dfs/ _/ Stack/ )/ thenbeginendend/ 算法/ 2/ ./ 测试/ 套/ 裁减/ :/ TD/ (/ State/ :/ Pstart/ ∈/ Ts/ )/ // / / breadthfirstsearch/ / / // State/ :/ psource/ ,/ ptarget/ ./ beginInit/ (/ Bfs/ _/ Stack/ )/ ;/ Init/ (/ TC/ _/ Stack/ )/ ;/ push/ (/ (/ pstart/ ,/ Adj/ _/ Set/ (/ pstart/ )/ )/ ,/ Bfs/ _/ Stack/ )/ ;/ whilenotemptyBfs/ _/ Stackdobegin/ (/ psource/ ,/ a/ ,/ ptarget/ )/ ·/ ·/ =/ Pop/ (/ Bfs/ _/ Stack/ )/ ;/ endendend/ 消息/ 的/ 数据/ 选择/ 过程/ 采用/ 了/ 基于/ 统计/ 的/ 聚类/ 选/ 因为/ 在/ 执行/ 过程/ 中/ 动态/ 生成/ 和/ 执行/ 测试/ 例/ ,/ 所以/ 必须/ 有/ 相关/ 的/ 支持/ 环境/ ./ 过程/ getmessage/ (/ m/ )/ ,/ CheckConstraint/ (/ m/ )/ ,/ DataSelect/ (/ a/ ,/ m/ )/ ,/ Outmes/ -/ sage/ (/ m/ )/ 都/ 是/ 执行/ 系统/ 提供/ 的/ 支持/ 服务/ ./ 下面/ 只/ 介绍/ 数据/ 选择/ 算法/ 的/ 架构/ ./ 3.3/ 数据/ 选择/ 算法/ 择/ 方法/ ,/ 使用/ 框架/ 法来/ 表示/ 消息/ ./ 为了/ 提高/ 数据/ 值/ 的/ 真实性/ ,/ 我们/ 采取/ 了/ 基于/ 网络/ 监测/ 的/ 统计/ 方法/ 来/ 生成/ 数据/ 框架/ 的/ 具体/ 值/ ./ 数据/ 的/ 来源/ 是/ 网络/ 中/ 实际/ 运行/ 节点/ 所/ 交换/ 的/ 各种/ 消息/ 样本/ ./ 由于/ 现实/ 网络/ 中/ 消息/ 中/ 每个/ 字/ 段/ 取值/ 的/ 多样性/ ,/ 采取/ 聚类/ 的/ 方法/ 将/ 那些/ 看上去/ 会/ 自然/ 落/ 在/ 一起/ 的/ 样本/ 集合/ 在/ 一起/ ,/ 形成/ 相应/ 的/ 数据/ 分类/ ./ 最终/ 的/ 数据/ 值会/ 存入/ 框架/ 数据库/ 中/ ,/ 以备/ 后来/ 的/ 数据/ 选择/ ./ 现有/ 的/ 聚类/ 算法/ 主要/ 是/ 以下/ 几种/ ,/ 即/ k/ 均值/ 聚类/ 算法/ 、/ 递增/ 聚类/ 算法/ 和/ 基于/ 概率/ 的/ 算法/ ./ 由于/ 协议/ 消息/ 字段/ 都/ 是/ 数值/ 类型/ ,/ 同时/ 聚类/ 的/ 目标/ 是/ 寻找/ 数据/ 的/ 最/ 有/ 可能/ 的/ 聚类/ ,/ 所以/ 采取/ 基于/ 统计/ 的/ 聚类/ 算法/ ./ 统计/ 聚类/ 的/ 基础/ 是/ 建立/ 在/ 一个/ 称为/ 有限/ 混合/ 的/ 统计/ 模型/ 上/ ./ 混合/ 是/ 指用/ x/ 个/ 概率分布/ 代表/ x/ 个/ 聚/ Page5/ 类/ ,/ 对/ 每个/ 具体/ 数据/ 实例/ ,/ 每个/ 分布/ 会/ 给出/ 它/ 实属/ 这个/ 聚类/ 的/ 概率/ ,/ 每个/ 聚类/ 都/ 有/ 不同/ 的/ 分布/ ./ 各个/ 聚类/ 并/ 不是/ 同等/ 可能/ 的/ ,/ 概率分布/ 可以/ 反应/ 这种/ 差异/ ./ 这种/ 算法/ 的/ 前提条件/ 是/ 已经/ 知道/ 了/ 数据/ 实例/ 的/ 概率分布/ 和/ 分布/ 参数/ ,/ 通过/ 贝叶斯/ 公式/ 很/ 容易/ 计算/ 数据/ 属于/ 某个/ 聚类/ 的/ 概率/ ./ 假设/ 论域/ 上/ 有/ m/ 个/ 聚类/ ω/ 1/ ,/ ω/ 2/ ,/ …/ ,/ ω/ m/ ;/ x/ 是/ 数据/ 实例/ ,/ x/ 属于/ 聚类/ ω/ i/ 的/ 概率/ 如下/ :/ 其中/ p/ (/ ω/ i/ )/ 表示/ 聚类/ ω/ i/ 的/ 先验概率/ ./ P/ (/ x/ // ω/ i/ )/ 表示/ 当/ 输入/ x/ 属于/ 聚类/ ω/ i/ ,/ x/ 出现/ 的/ 条件/ 概率/ ./ P/ (/ ω/ i/ // x/ )/ 表示/ 给定/ 输入/ x/ ,/ x/ 属于/ 聚类/ ω/ i/ 的/ 后验/ 条件/ 概率/ ./ 它/ 表明/ x/ 发生/ 的/ 相对/ 频率/ ,/ 值越/ 大/ ,/ 表示/ 发生/ 的/ 相对/ 频率/ 越高/ ./ 贝叶斯/ 聚类/ 法则/ :/ 若/ 存在/ i/ ∈/ {/ 1/ ,/ 2/ ,/ …/ ,/ m/ }/ ,/ 使得/ 对/ 所有/ 的/ j/ (/ j/ =/ 1/ ,/ 2/ ,/ …/ ,/ i/ -/ 1/ ,/ i/ +/ 1/ ,/ …/ ,/ m/ )/ 均/ 有/ 因为/ 本文/ 中/ 处理/ 的/ 数据/ 只有/ 一个/ 正整数/ 属性/ ,/ 所以/ 根据/ 大数/ 定理/ 可以/ 假定/ 每个/ 聚类/ 呈/ 正态分布/ ./ 算法/ 的/ 输入/ 取自/ 网络/ 监测/ 中/ 的/ 协议/ 消息/ 样本/ ,/ 我们/ 以/ OSPFv3/ 消息/ 的/ 数据/ 聚类/ 为例/ 在/ 图/ 3/ 中/ 说明/ 算法/ 3/ ./ 数据/ 聚类/ 算法/ :/ DataCluster/ (/ m/ )/ 输入/ :/ m/ =/ {/ x1/ ,/ x2/ ,/ …/ ,/ xn/ }/ 是/ 消息/ 字段/ 集/ ,/ xi/ =/ {/ di1/ ,/ di2/ ,/ …/ ,/ din/ }/ 是/ 字/ 段/ 的/ 样本/ 数据/ 集/ DataCluster/ (/ m/ )/ {/ Prepare/ (/ m/ )/ // / 获得/ 消息/ 样本/ ,/ 并/ 进行/ 预处理/ ,/ 满足/ 聚类/ 的/ 输入/ 要求/ / // swith/ (/ m/ ./ type/ )/ {/ casehello/ :/ // / / 邻居/ 发现/ 的/ 聚类/ 处理/ / / // {/ for/ (/ i/ =/ 1/ ;/ i/ </ =/ n/ ;/ i/ ++/ )/ {/ }/ caseDatabaseDescription/ :/ // / / 数据库/ 描述/ 的/ 聚类/ 处理/ / / // {/ …/ }/ …/ }/ BsyesCluster/ (/ x/ )/ {/ // / / 基于/ 贝叶斯/ 统计/ 的/ 聚类/ 算法/ x/ =/ {/ d1/ ,/ d2/ ,/ …/ ,/ dn/ }/ / / // Init/ _/ D/ =/ {/ D1/ ,/ D2/ ,/ …/ ,/ Dn/ }/ While/ (/ n/ >/ 1/ )/ {/ p/ (/ ω/ i/ // x/ )/ =/ f/ (/ x/ ;/ ui/ ,/ σ/ i/ )/ ×/ p/ (/ ω/ i/ )/ // // 根据/ 正态分布/ 的/ 贝叶斯/ 聚类/ 式/ (/ 2/ )/ 计算/ 聚类/ 概率/ }/ p/ =/ max/ {/ p/ (/ ω/ i/ // x/ )/ }/ Di/ =/ Di/ ∪/ {/ x/ }/ // / / 合并/ 聚类/ 集合/ / / // }/ 了/ 算法/ ./ 经过/ 上述/ 贝叶斯/ 聚类/ 算法/ ,/ 就/ 可以/ 形成/ 每个/ 字段/ 的/ 实际/ 数据/ 的/ 聚类分析/ ./ 只要/ 把/ 每个/ 聚类/ 的/ 平均值/ 存入/ 框架/ 数据库/ ,/ 在/ 进行/ 数据/ 选择/ 时/ ,/ 就/ 可以/ 根据/ 聚类/ 的/ 种类/ 来/ 指导/ 测试数据/ 的/ 生成/ ./ 如/ 在/ OSPFv3/ 协议/ hello/ 消息/ 的/ helloInterval/ 和/ Router/ -/ DeadInterval/ 字段/ 就/ 可以/ 通过/ 聚类/ 算法/ 来/ 获得/ 实际/ 的/ 参考值/ ./ 3.4/ 算法/ 分析/ 在/ 算法/ 1/ 的/ 测试/ 生成/ 阶段/ ,/ 根据/ 图论/ 的/ 结论/ ,/ 复杂度/ 可以/ 控制/ 在/ O/ (/ n/ +/ |/ e/ |/ )/ 以内/ ./ 关于/ 效率/ ,/ 首先/ 由于/ 测试/ 目的/ 的/ 介入/ ,/ 大大减少/ 了/ 符号化/ 测试/ 例/ 的/ 数量/ ,/ 根据/ 我们/ 的/ 实验/ 研究/ ,/ 可以/ 减掉/ 80/ %/ 以上/ 的/ 无用/ 边/ ,/ 只/ 留下/ 了/ 与/ 测试/ 目的/ 相关/ 的/ 状态/ 和/ 变迁/ ,/ 形成/ 了/ 导向/ 正确/ 终点/ 和/ 错误/ 终点/ 的/ 连通/ 图/ ./ 在/ 算法/ 2/ 的/ 测试/ 执行/ 阶段/ 根据/ 数据/ 的/ 动态/ 选择/ 策略/ ,/ 随机/ 地/ 执行/ 变迁/ 序列/ ,/ 从而/ 裁剪/ 了/ 不可/ 达/ 的/ 变迁/ ,/ 最终/ 形成/ 了/ 测试/ 变迁/ 序列/ ./ 与/ 已有/ 的/ 符号化/ 测试方法/ 比较而言/ ,/ TGV/ 是/ 提供/ 了/ 符号化/ 的/ 测试/ 生成/ 算法/ ,/ 但是/ 在/ 数据/ 建模/ 上/ ,/ 仍然/ 采取/ 了/ 与/ 控制/ 行为/ 不同/ 的/ 方式/ ,/ 如一阶/ 逻辑/ 等/ 方法/ ,/ 这样/ 就/ 割裂/ 了/ 数据/ 与/ 行为/ 之间/ 的/ 天然/ 联系/ ,/ 所以/ 在/ 生成/ 阶段/ 数据/ 只是/ 符号/ 的/ 表示/ ,/ 没有/ 充分体现/ 数据/ 的/ 重要/ 作用/ ,/ 并且/ 没有/ 延伸/ 到/ 符号/ 的/ 执行/ ,/ 形成/ 了/ 执行/ 的/ 空白/ ./ 另/ 一个/ 工具/ 是/ Torx/ ,/ 它/ 提供/ 了/ 测试/ 生成/ 与/ 执行/ 的/ 同步/ ,/ 但是/ 没有/ 考虑/ 生成/ 过程/ 中/ 数据/ 的/ 建模/ 和/ 执行/ 过程/ 的/ 数据/ 选择/ 问题/ ,/ 而且/ 在/ 执行/ 时/ 都/ 是/ 随机/ 选择/ 执行/ 序列/ ,/ 增加/ 了/ 测试/ 的/ 不确定性/ ./ 本文/ 在/ 已经/ 研究/ 的/ 基础/ 上/ ,/ 统一/ 了/ 数据处理/ 与/ 控制/ 行为/ 的/ 系统/ 建模/ ,/ 在/ 测试/ 生成/ 算法/ 过程/ 中/ 采取/ 了/ on/ -/ the/ -/ fly/ 策略/ 从而/ 大大减少/ 了/ 测试/ 例/ 数量/ ,/ 最后/ 在/ 执行/ 算法/ 过程/ 中/ 引入/ 了/ 基于/ 聚类/ 的/ 动态数据/ 选择/ ,/ 又/ 进一步/ 减少/ 了/ 测试/ 例/ 的/ 数量/ ./ 4/ 应用/ 举例/ 下面/ 通过/ OSPFv3/ 协议/ 作为/ 实例/ 来/ 说明/ 上面/ 提出/ 的/ 测试/ 生成/ 算法/ ./ OSPFv3/ 协议/ 规范/ 说明/ SOSPFv3/ =/ 〈/ Ss/ ,/ Ls/ ,/ Xs/ ,/ Σ/ s/ ,/ Ts/ ,/ ss0/ 〉/ ,/ 测试/ 目的/ TP/ =/ 〈/ STP/ ,/ LTP/ ,/ XTP/ ,/ Σ/ TP/ ,/ TTP/ ,/ sTP0/ 〉/ ./ SOSPFv3/ 用图/ 4/ 表示/ ./ 该/ 协议/ 图/ 表示/ 在/ 收到/ hello/ 消息/ 后/ ,/ 经过/ one/ -/ way/ 状态/ 进入/ 到/ two/ -/ way/ 状态/ ,/ hello/ 代表/ hello/ 数据包/ ,/ DD/ 表示/ 数据库/ 描述符/ 包/ ./ 测试/ 目的/ STP/ 用图/ 5/ 来/ 说明/ ,/ 该/ 协议/ 通过/ 发送/ hello/ 数据包/ 建立/ 双向/ 关系/ ./ 协议/ 规范/ 与/ 测试/ 目的/ 的/ 笛卡尔/ 积在/ 图/ 6/ 中/ 给出/ ./ Page6/ 执行/ 算法/ 1/ 、/ 2/ 后/ 所/ 得到/ 的/ 测试/ 例如/ 图/ 7/ 所示/ ,/ 测试/ 例中/ 引入/ 了/ Pass/ 、/ Fail/ 状态/ ./ 图/ 7/ 中/ Hello/ _/ T1/ 和/ Hello/ _/ T2/ 消息/ 都/ 是/ 测试/ 器/ 动态/ 实例/ 化后/ 所/ 得到/ 的/ 数据包/ ,/ 图/ 8/ 是/ 以/ 我们/ 自己/ 设计/ 的/ 测试/ 例/ 描述语言/ 进行/ 描述/ ,/ 该种/ 描述语言/ 已经/ 移植/ 到/ 商业/ 应用/ ./ 在/ 上述/ 描述/ 中/ ,/ 有些/ 字段/ 是/ 通过/ 聚类/ 算法/ 获得/ 的/ 取值/ ,/ 有些/ 字/ 段/ 没有/ 取/ 确定/ 的/ 数值/ ,/ 而是/ 用/ 变量/ 来/ 表示/ ,/ 主要/ 是/ 为了/ 方便/ 用户/ 的/ 测试/ ./ 用户/ 可以/ 在/ 测试/ 前/ 和/ 测试/ 中/ 根据/ 具体/ 值来/ 实例/ 化该/ 字/ 段/ ,/ 这种/ 方法/ 增加/ 了/ 执行/ 时/ 的/ 灵活性/ ./ 数据包/ 格式/ :/ packetHello/ _/ Init/ {/ headerOSPF/ {/ Version/ =/ 3/ // // 版本/ 类型/ }/ OSPFChecksum/ }/ 5/ 结论/ 现实/ 协议/ 的/ 测试/ 需求/ 引入/ 了/ 符号化/ 的/ 测试/ 模型/ ,/ 现有/ 的/ 基于/ 符号化/ 模型/ 在/ 进行/ 测试/ 生成/ 时/ ,/ 截然/ 分成/ 两个/ 阶段/ ,/ 第/ 1/ 个/ 阶段/ 是/ 生成/ 符号化/ 的/ 测试/ 例/ ,/ 根据/ 生成/ 的/ 策略/ ,/ 又/ 可/ 进一步/ 分成/ 静态/ 生成/ 和/ 动态/ 生成/ ;/ 第/ 2/ 个/ 阶段/ 是/ 符号化/ 测试/ 套/ 的/ 执行/ ,/ 根据/ 符号/ 实例/ 化/ 的/ 时机/ ,/ 也/ 可以/ 分成/ 静态/ 赋值/ 和/ 动态/ 赋值/ ./ 本文/ 根据/ 协议/ 的/ 现实/ 需求/ ,/ 把/ 测试/ 生成/ 和/ 测试/ 执行/ 集成/ 在/ 一起/ ,/ 而且/ 都/ 采取/ 了/ 动态/ 策略/ ,/ 这样/ 就/ 充分体现/ Page7/ 了/ 符号化/ 模型/ 的/ 优势/ ,/ 避免/ 了/ 由于/ 数据/ 引入/ 所/ 造成/ 的/ 空间/ 爆炸/ ,/ 在/ 很早/ 的/ 阶段/ 就/ 裁剪/ 了/ 无用/ 的/ 分支/ ,/ 从而/ 节约/ 了/ 空间/ 和/ 时间/ ,/ 极大地提高/ 了/ 效率/ ./ 当然/ ,/ 在/ 我们/ 的/ 实践/ 中/ ,/ 对模型/ 进行/ 了/ 一些/ 假设/ ,/ 这/ 不可避免/ 地/ 与/ 现实/ 有/ 一些/ 差距/ ,/ 主要/ 是/ 在/ 数据/ 的/ 选择/ 上/ 不够/ 智能化/ ,/ 希望/ 在/ 以后/ 的/ 工作/ 引入/ 学习/ 机制/ ,/ 可以/ 更好/ 地/ 选择/ 与/ 实际/ 接近/ 的/ 数据/ ./ 

