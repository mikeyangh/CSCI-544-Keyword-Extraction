Page1/ 基于/ 多/ HA/ 部署/ 的/ MIPv6/ 网络服务/ 可用性/ 提升/ 方法/ 张瀚文/ 1/ )/ 张玉军/ 1/ )/ 许智君/ 1/ )/ ,/ 2/ )/ 马超/ 1/ )/ ,/ 2/ )/ 李/ 忠诚/ 1/ )/ 周继华/ 3/ )/ 1/ )/ (/ 中国科学院计算技术研究所/ 北京/ 100190/ )/ 2/ )/ (/ 中国科学院/ 大学/ 北京/ 100049/ )/ 3/ )/ (/ 重庆/ 金美/ 通信/ 有限责任/ 公司/ 重庆/ 400030/ )/ 摘要/ 移动/ IPv6/ 是/ 实现/ 下一代/ 互联网/ 移动/ 特性/ 的/ 核心技术/ ,/ 依赖于/ 部署/ 在/ 家乡/ 链路/ 的/ 家乡/ 代理/ (/ HA/ )/ 实现/ 节点/ 移动/ 过程/ 中/ 的/ 可/ 寻址/ 性/ ./ 家乡/ 链路/ 的/ 单一/ HA/ 部署/ ,/ 将/ 成为/ 系统/ 的/ 单点故障/ 隐患/ 及/ 性能/ 瓶颈/ ,/ 难以/ 保证系统/ 服务/ 可用性/ ./ 为/ 提升/ 移动/ IPv6/ 网络/ 的/ 系统/ 服务/ 可用性/ 和/ 系统/ 性能/ ,/ 需要/ 在/ 家乡/ 链路/ 部署/ 多/ HA/ ,/ 解决/ 其/ 单点故障/ 问题/ ,/ 并/ 有效/ 均衡/ 多/ 家乡/ 代理/ 间/ 的/ 负载/ ./ 文中/ 研究/ 移动/ IPv6/ 网络/ 多/ 家乡/ 代理/ 部署/ 方法/ ,/ 引入/ 检测/ 备份/ 环对/ 多/ HA/ 间/ 进行/ 有效/ 组织/ ,/ 基于/ 此/ 实现/ HA/ 容错/ 和/ 负载/ 均衡/ ./ 多/ 家乡/ 代理/ 采用/ 单一/ HA/ 映像/ 以/ 实现/ 容错/ 及/ 负载/ 均衡/ 处理/ 对/ 移动/ 节点/ 的/ 透明性/ ,/ 减小/ 处理/ 延迟/ 和/ 开销/ ./ 关键词/ 移动/ IPv6/ ;/ 家乡/ 代理/ ;/ 容错/ ;/ 负载/ 均衡/ ;/ 服务/ 可用性/ 1/ 引言/ 移动/ IPv6/ (/ MobileIPv6/ ,/ MIPv6/ )/ [/ 1/ ]/ 是/ IP/ 网络/ 中/ 支持/ 移动/ 的/ 核心技术/ ,/ 定义/ 了/ 节点/ 移动/ 过程/ 中/ 保持/ 可/ 寻址/ 性/ 的/ 机制/ ./ MIPv6/ 依赖于/ 家乡/ 代理/ (/ HomeAgent/ ,/ HA/ )/ 实现/ 移动/ 节点/ (/ MobileNode/ ,/ MN/ )/ 移动/ 过程/ 中/ 的/ 可/ 寻址/ 性/ ./ HA/ 作为/ 实现/ MIPv6/ 系统/ 服务/ 的/ 关键/ 节点/ ,/ 仅/ 在/ 家乡/ 链路/ 部署/ 单一/ HA/ ,/ 将会/ 成为/ 系统/ 单点故障/ 隐患/ 及/ 服务/ 能力/ 的/ 瓶颈/ ,/ 应/ 考虑/ 在/ 同一/ 链路/ 部署/ 多/ HA/ ,/ 解决/ HA/ 容错/ 和/ 负载/ 均衡/ 问题/ ,/ 提升/ MIPv6/ 网络服务/ 的/ 可用性/ ./ 本文/ 研究/ MIPv6/ 家乡/ 链路/ 多/ HA/ 部署/ 方法/ ./ 引入/ 检测/ 备份/ 环对/ 多/ HA/ 进行/ 合理/ 组织/ ,/ 通过/ HA/ 间/ 主动/ 的/ 失效/ 检测/ 和/ 服务/ 迁移/ 实现/ HA/ 容错/ ,/ 各/ HA/ 同时/ 作为/ 服务/ 节点/ 和/ 备份/ 节点/ ,/ 避免/ 设备/ 冗余/ ,/ 充分利用/ 系统资源/ ,/ 提升/ 系统/ 总体/ 服务/ 可用性/ 和/ 服务/ 效率/ ;/ 通过/ 单一/ HA/ 映像/ 实现/ 多/ HA/ 部署/ 及/ 容错/ 和/ 负载/ 均衡/ 处理/ 对/ MN/ 的/ 透明性/ ,/ 提高效率/ 的/ 同时/ 降低/ 处理/ 开销/ ./ 本文/ 第/ 2/ 节对/ 多/ HA/ 部署/ 下/ 的/ 两个/ 关键问题/ 的/ 研究/ 现状/ 进行/ 介绍/ 和/ 分析/ ,/ 即/ HA/ 容错/ 和/ 负载/ 均衡/ ;/ 第/ 3/ 节/ 提出/ 基于/ 多/ HA/ 部署/ 的/ MIPv6/ 服务/ 可用性/ 方案/ (/ MultipleHADeploymentScheme/ ,/ MHADS/ )/ ;/ 第/ 4/ 节/ 和/ 第/ 5/ 节/ 通过/ 数值/ 分析/ 和/ 系统/ 仿真/ ,/ 对/ 本文/ 所提/ 方法/ 进行/ 性能/ 评价/ ,/ 并/ 与/ 现有/ 方法/ 进行/ 比较/ 分析/ ;/ 最后/ 总结/ 全文/ ./ 2/ 相关/ 工作/ 从/ MIPv6/ 协议/ 标准/ 设计/ 之初/ 就/ 有/ 研究/ 关注/ 多/ HA/ 部署/ 下/ 的/ 容错/ 和/ 负载/ 均衡/ 问题/ ./ 在/ 负载/ 均衡/ 方面/ ,/ 早期/ 的/ 静态/ 方案/ 通过/ 预/ 配置/ 将/ MN/ 分配/ 给/ 某/ HA/ [/ 2/ ]/ ,/ 这种/ 静态/ 方案/ 可以/ 将/ 所有/ MN/ 均匀/ 地/ 分配/ 给/ 各/ HA/ ,/ 但/ 各/ MN/ 的/ 通信量/ 强度/ 及/ 业务/ 类型/ 各不相同/ ,/ 难以/ 有效/ 实现/ 负载/ 均衡/ ./ 更/ 多/ 的/ 研究/ 采取/ 动态/ 方案/ ./ 有/ 基于/ 动态/ HA/ 发现/ (/ DHAAD/ )/ 的/ 负载/ 均衡/ 方案/ [/ 3/ -/ 4/ ]/ ,/ 试图/ 利用/ 任播/ (/ anycast/ )/ 技术/ 动态/ 发现/ 最优/ HA/ ./ 这些/ 方案/ 都/ 是/ 由/ MN/ 发起/ ,/ 无法/ 对/ MN/ 透明/ ,/ 且会/ 增加/ 处理/ 延迟/ 和/ 开销/ ./ 文献/ [/ 5/ -/ 6/ ]/ 也/ 是/ 通过/ 动态/ 的/ 移动/ 锚点/ 选择/ 实现/ 负载/ 均衡/ ./ 文献/ [/ 7/ ]/ 引入/ 浮动/ 令牌/ 和/ 负载/ 阈值/ 实现/ 动态/ 负载/ 均衡/ ,/ 基于/ 负载/ 阈值/ 实现/ 负载/ 迁移/ 和/ 浮动/ 令牌/ 的/ 移交/ ,/ 所有/ 的/ 注册/ 请求/ 都/ 由/ 唯一/ 的/ 、/ 持有/ 浮动/ 令牌/ 的/ HA/ 处理/ ./ 在/ 文献/ [/ 8/ ]/ 中/ ,/ 当某/ 一/ HA/ 的/ 数据包/ 到达/ 率/ 大于/ 确定/ 阈值/ 时/ 进行/ 负载/ 迁移/ ./ 文献/ [/ 9/ ]/ 提出/ 一种/ 双/ 阈值/ 转移/ 策略/ ./ 现有/ 负载/ 均衡/ 方案/ 仅仅/ 基于/ 被动/ 的/ 过载/ 迁移/ ,/ 没有/ 实现/ 主动/ 的/ 过载/ 预防/ ,/ 且/ 负载/ 均衡/ 过程/ 对/ MN/ 不/ 透明/ ./ 在/ HA/ 容错/ 方面/ ,/ 现有/ 的/ 方案/ 主要/ 分为/ 两类/ :/ 基于/ 集中/ 管理系统/ 的/ 方案/ 和/ 基于/ 信息/ 备份/ 的/ 方案/ ./ 文献/ [/ 10/ ]/ 基于/ 资源共享/ 的/ 思想/ ,/ 把/ 失效/ 家乡/ 代理/ 的/ 负载/ 重定向/ 到/ 有效/ 的/ 代理/ 上/ ,/ 需要/ 部署/ 强大/ 的/ 网络/ 管理系统/ 承担/ 移动/ 代理/ 的/ 失效/ 监测/ 、/ 备份/ 代理/ 的/ 选择/ 、/ 负载/ 信息/ 的/ 重新/ 采集/ 、/ 负载/ 重定向/ 等/ 功能/ ./ 文献/ [/ 9/ ,/ 11/ ]/ 提出/ 了/ 注册/ 信息/ 全/ 备份/ 的/ 容错/ 方法/ ,/ 所有/ HA/ 维护/ 完全相同/ 的/ 注册/ 信息/ ,/ 当/ 一个/ HA/ 失效/ 后/ ,/ 其他/ HA/ 可以/ 继续/ 为/ MN/ 服务/ ,/ 但/ 这种/ 方案/ 难以实现/ 注册/ 信息/ 在/ 所有/ HA/ 之间/ 的/ 同步/ ,/ 而且/ 浪费/ 存储空间/ ./ 文献/ [/ 12/ ]/ 提出/ 在/ 家乡/ 链路/ 上/ 采用/ 非易失/ 存储器/ 备份/ 注册/ 信息/ 的/ 容错/ 方法/ ,/ 当/ 一个/ HA/ 失效/ 后/ ,/ 有效/ 的/ HA/ 需要/ 花费/ 较/ 多/ 时间/ 从/ 非易失/ 存储器/ 中/ 获取/ 注册/ 信息/ ;/ 当/ 存储器/ 发生/ 故障/ 时/ ,/ 这种/ 方法/ 不再/ 有效/ ./ 现有/ 的/ 容错/ 方案/ 均/ 对/ MN/ 不/ 透明/ ,/ 普遍存在/ 信息冗余/ 大/ 、/ 迁移/ 效率/ 低/ 、/ 失效恢复/ 延时/ 长/ 等/ 问题/ ,/ 影响/ 上层/ 应用/ 特别/ 是/ 实时/ 应用/ 的/ 服务质量/ ./ 3MHADS/ 方案/ 本文/ 提出/ 一种/ 基于/ 多/ HA/ 部署/ 的/ MIPv6/ 服务/ 能力/ 提升/ 方案/ (/ MHADS/ )/ ./ 多/ HA/ 间/ 的/ 组织/ 结构/ ,/ 是/ 实现/ HA/ 容错/ 和/ 负载/ 均衡/ 的/ 基础/ ,/ MHADS/ 引入/ 一种/ 全新/ 的/ 多/ HA/ 组织/ 方式/ ,/ 在/ 此基础/ 上/ ,/ 通过/ HA/ 间/ 主动/ 的/ 失效/ 检测/ 和/ 服务/ 迁移/ 实现/ HA/ 容错/ ,/ 基于/ 主动/ 过载/ 预防/ 的/ 思想/ 实现/ 全局/ 任务/ 在/ 多/ HA/ 间/ 的/ 负载/ 均衡/ ./ MHADS/ 的/ 基本/ 思想/ 是/ :/ 将/ 家乡/ 链路/ 的/ 多/ HA/ 组织/ 成/ 环状/ 的/ 相互/ 检测/ 和/ 信息/ 备份/ 关系/ ,/ 通过/ 检测/ // 备份/ 环/ (/ Detection/ &/ BackupRing/ ,/ DBR/ )/ 中下游/ 节点/ 对/ 上游/ 节点/ 主动/ 的/ 有效性/ 检测/ 和/ 移动/ 管理/ 信息/ 备份/ ,/ 实现/ 快速/ 的/ HA/ 失效/ 检测/ 和/ 失效/ 实体/ 的/ 服务/ 接管/ ;/ 通过/ 移动/ 管理/ 信息/ 在/ 下游/ 节点/ 的/ 唯一/ 备份/ ,/ 降低/ 信息/ 冗余度/ ,/ 并/ 省略/ 服务/ 接管/ 目标/ 的/ 选择/ ,/ 实现/ 快速/ 的/ 失效恢复/ ./ 为/ 实现/ 检测/ // 备份/ 环/ 的/ 构造/ 与/ 维护/ ,/ 同时/ 实现/ 多/ HA/ 间/ 的/ 负载/ 均衡/ ,/ 引入/ 超/ 节点/ (/ SupervisorHA/ ,/ SHA/ )/ ./ SHA/ 也/ 作为/ 家乡/ 链路/ 多个/ HA/ 面向/ MN/ 的/ 统一/ 服务/ 接口/ ,/ 实现/ 多/ HA/ 对/ MN/ 的/ 单一/ 映像/ ,/ 从而/ 实现/ HA/ 容错/ 和/ 负载/ 均衡/ 对/ MN/ 的/ 透明性/ ./ MHSDS/ 系统结构/ 如图/ 1/ 所示/ ./ Page3/ 图/ 1MHADS/ 中多/ HA/ 组织/ 结构/ 检测/ // 备份/ 环/ (/ DBR/ )/ 生成/ 方法/ 如下/ :/ 在/ 家乡/ 链路/ 存在/ n/ 个/ 有效/ HA/ 的/ 情况/ 下/ ,/ 采用/ 一种/ 明确/ 的/ 、/ 结果/ 唯一/ 的/ 排序/ 方法/ 形对/ n/ 个/ HA/ 进行/ 排序/ ,/ 排序/ 结果/ 为/ 首尾/ 连结/ 形成/ 一个/ 相互/ 检测/ 和/ 备份/ 的/ 环状/ 链/ HA1/ ,/ HA2/ ,/ …/ ,/ HAn/ ,/ HA1/ ./ 本文/ 给出/ 一种/ 基于/ HA/ 优先级/ 和/ 地址/ 的/ DBR/ 构造/ 实例/ :/ 首先/ 按照/ HA/ 的/ 优先级/ 由高到/ 低/ 进行/ 排序/ ;/ 对于/ 优先级/ 相同/ 的/ HA/ ,/ 则/ 按照/ 地址/ 组成/ 的/ 字符串/ 由小到大/ 进行/ 排序/ ./ 超/ 节点/ 作为/ 检测/ // 备份/ 环/ 的/ 管理者/ 和/ 多/ HA/ 面向/ MN/ 的/ 统一/ 服务/ 接口/ ./ 在/ 任意/ 时刻/ ,/ 有且/ 仅/ 有/ 一个/ HA/ 拥有/ 管理/ 令牌/ (/ SupervisorToken/ ,/ ST/ )/ ,/ 作为/ SHA/ ,/ 配置/ 多/ HA/ 所/ 共享/ 的/ 唯一/ HA/ 地址/ ,/ 广播/ 代理/ 宣告/ ./ SHA/ 作为/ 检测/ // 备份/ 环/ 的/ 管理者/ ,/ 负责/ 环/ 的/ 构造/ 和/ 维护/ :/ SHA/ 动态/ 维护/ 环中/ 各/ 节点/ 状态/ 信息/ (/ 包括/ 各/ HA/ 在/ DBR/ 中/ 的/ 序号/ 、/ 地址/ 、/ 状态/ 、/ 负载/ 、/ 所/ 服务/ MN/ 的/ 信息/ 、/ 优先级/ )/ ;/ 当有/ 节点/ 加入/ 或/ 退出/ 时/ ,/ 根据/ 排序/ 规则/ 重构/ 检测/ // 备份/ 环/ ,/ 并/ 向/ 环/ 重构/ 所/ 涉及/ 图/ 2MHADS/ 方案/ 关键/ 过程/ 3.1/ MN/ 移动/ 注册/ SHA/ 配置/ 链路/ 唯一/ 的/ HA/ 地址/ (/ SHA/ _/ Addr/ )/ ,/ 作为/ 面向/ MN/ 的/ 统一/ 服务/ 接口/ ./ 所有/ MN/ 不再/ 需要/ 通过/ DHAAD/ 过程/ 发现/ 选择/ 服务/ HA/ ,/ 而是/ 直接/ 将/ SHA/ _/ Addr/ 配置/ 为/ HA/ 地址/ ./ 移动/ 到/ 外地/ 网络/ 的/ MN/ 发往/ 家乡/ 链路/ 的/ 移动/ 的/ 相关/ 节点/ 通告/ 其新/ 的/ 上下游/ 节点/ 信息/ ./ SHA/ 同时/ 也/ 作为/ 家乡/ 链路/ 所/ 部署/ 的/ 多/ HA/ 面向/ MN/ 的/ 统一/ 服务/ 接口/ ./ 家乡/ 链路/ 所有/ HA/ 共享/ 一个/ 全局/ 地址/ ,/ 整个/ HA/ 集群/ 体现/ 为/ 一个/ 单一/ HA/ ,/ 通过/ 统一/ 服务/ 接口/ SHA/ ,/ 被/ 用户/ 访问/ ,/ 具体/ 的/ 服务/ 节点/ 对/ MN/ 而言/ 透明/ ./ SHA/ 配置/ 多/ HA/ 所/ 共享/ 的/ 唯一/ HA/ 地址/ ,/ 并/ 在/ 链路/ 广播/ 代理/ 宣告/ ./ 单一/ HA/ 映像/ ,/ 使得/ 多/ HA/ 部署/ 以及/ HA/ 容错/ 、/ 负载/ 均衡/ 等/ 处理/ 对/ MN/ 完全/ 透明/ ,/ 所有/ 操作/ 仅/ 在/ 家乡/ 链路/ 内部/ 的/ 多/ HA/ 间/ 完成/ ,/ 同时/ 省略/ MN/ 注册/ 时/ 的/ 动态/ HA/ 发现/ (/ DHAAD/ )/ 过程/ ,/ 减小/ MN/ 注册/ 、/ HA/ 容错/ 及/ 负载/ 均衡/ 的/ 处理/ 延时/ 和/ 开销/ ./ SHA/ 作为/ 统一/ 服务/ 接口/ 接收/ 所有/ MN/ 的/ 服务/ 请求/ ,/ 可/ 根据/ 全局/ HA/ 状态/ 及/ 负载/ 为/ 每个/ 到达/ 家乡/ 链路/ 的/ 移动/ 注册/ 请求/ 动态/ 选择/ 最优/ 服务/ 实体/ ,/ 更/ 利于/ 实现/ 全局/ 任务/ 在/ 多/ HA/ 间/ 的/ 实时/ 均衡/ ./ 以/ DBR/ 为/ 基础/ ,/ MHADS/ 实现/ 多/ HA/ 间/ 的/ 负载/ 均衡/ 及/ 容错/ ,/ 几个/ 关键/ 过程/ 如图/ 2/ 所示/ ,/ 以下/ 分别/ 进行/ 介绍/ ./ 注册/ 请求/ 将/ 首先/ 到达/ 统一/ 服务/ 接口/ SHA/ ./ SHA/ 根据/ 全局/ 负载/ 状态/ 为/ 每个/ 移动/ 注册/ 请求/ 动态/ 选择/ 当前/ 最优/ 的/ 服务/ 节点/ ,/ 将/ 请求/ 重定向/ 至/ 选中/ 的/ 目标/ HA/ ,/ 由该/ HA/ 完成/ 此次/ 移动/ 注册/ 请求/ 的/ 处理/ ,/ 并/ 负责/ 承担/ 请求/ 发送/ MN/ 后续/ 的/ 移动/ 代理服务/ ./ 图/ 3/ 描述/ 了/ HA/ 为/ MN/ 隧道/ 转发/ 数据/ 的/ 具体/ 实现/ 过程/ ./ Page4/ 图/ 3/ 数据/ 转发/ 任务/ 具体/ 实现/ SHA/ 作为/ 统一/ 服务/ 接口/ 为/ MN/ 的/ 移动/ 注册/ 请求/ 进行/ 最优/ 服务/ 实体/ 动态/ 选择/ ./ 为/ 在/ 选择/ 时/ 作出/ 最佳/ 决策/ ,/ SHA/ 需要/ 准确/ 并/ 及时/ 地/ 获取/ 各/ HA/ 的/ 负载/ 信息/ ,/ 为此/ 设计/ 了/ 动态/ 加权/ 负载/ 评估/ 算法/ 和/ 基于/ 切片/ 的/ 负载/ 报告/ 算法/ ,/ 具体/ 算法/ 参见/ 文献/ [/ 13/ ]/ ./ 3.2/ HA/ 失效/ 检测/ 在/ MHADS/ 中/ ,/ 由于/ 仅/ 有/ SHA/ 在/ 家乡/ 链路/ 广播/ 代理/ 宣告/ 消息/ ,/ 无法/ 基于/ 代理/ 宣告/ 实现/ HA/ 间/ 的/ 失效/ 检测/ ,/ 因此/ 引入/ 心跳/ 机制/ 实现/ HA/ 的/ 有效性/ 检测/ :/ (/ 1/ )/ DBR/ 中/ 的/ 任意/ HAi/ 以/ 间隔时间/ HEART/ -/ BEAT/ _/ INTERVAL/ 周期性地/ 向/ 其/ 下游/ 节点/ HAi/ +/ 1/ 发送/ 心跳/ 应答/ 消息/ ./ (/ 2/ )/ HAi/ +/ 1/ 每次/ 接收/ 到/ HAi/ 的/ 心跳/ 应答/ 后/ ,/ 将/ 为/ 其/ 维护/ 的/ Missing/ _/ Heatbeat/ 计数器/ 置/ 0/ ,/ 并/ 重置/ 心跳/ 计时器/ (/ 值为/ HEARTBEAT/ _/ INTERVAL/ )/ ./ (/ 3/ )/ 心跳/ 计时器/ 到期/ ,/ HAi/ +/ 1/ 将/ 为/ HAi/ 维护/ 的/ Missing/ _/ Heatbeat/ 值增/ 1/ 后/ ,/ 重置/ 心跳/ 计时器/ ./ (/ 4/ )/ 当/ Missing/ _/ Heatbeat/ 值/ 达到/ 预设/ 的/ 上/ 限值/ Missing/ _/ Heatbeat/ _/ Allowed/ 时/ ,/ HAi/ +/ 1/ 向/ HAi/ 发送/ 心跳/ 请求/ 消息/ ,/ 请求/ 对端/ 应答/ ./ (/ 5/ )/ 若/ HAi/ +/ 1/ 接收/ 到/ HAi/ 回复/ 的/ 心跳/ 消息/ ,/ 则/ 执行/ 步/ (/ 2/ )/ ./ (/ 6/ )/ 若/ HAi/ +/ 1/ 等待/ 对方/ 应答/ 超时/ (/ 超时/ 时间/ HEARTBEAT/ _/ REQ/ _/ TIMER/ )/ ,/ 则/ 判断/ HAi/ 失效/ ./ 3.3/ 失效/ HA/ 服务/ 迁移/ 若/ 失效节点/ HAi/ 为/ 普通/ 节点/ ,/ 它/ 的/ 下游/ 节点/ HAi/ +/ 1/ 在/ 检测/ 到/ 其/ 失效/ 后/ ,/ 向/ SHA/ 通告/ HAi/ 的/ 失效/ ./ SHA/ 从/ DBR/ 中/ 删除/ HAi/ ,/ 根据/ 排序/ 规则/ 重构/ DBR/ ;/ SHA/ 向/ 环/ 重构/ 所/ 涉及/ 的/ 相关/ 节点/ 通告/ 其新/ 的/ 上下游/ 节点/ 信息/ ./ 失效节点/ 的/ 下游/ 节点/ HAi/ +/ 1/ 根据/ 所/ 备份/ 的/ 移动/ 管理/ 信息/ 直接/ 接管/ 其/ 服务/ ,/ 在/ 家乡/ 链路/ 为/ 接管/ 的/ MN/ 广播/ 代理/ 邻居/ 宣告/ ,/ 将/ 这些/ MN/ 的/ HoA/ 地址/ 绑定/ 到/ 自己/ 的/ 物理地址/ ,/ 此后/ 为/ 这些/ MN/ 隧道/ 转发/ 数据包/ ;/ 同时/ 向/ 下游/ 节点/ HAi/ +/ 2/ 同步/ 备份/ 新/ 接管/ MN/ 的/ 移动/ 管理/ 信息/ ./ 若/ 失效节点/ HAi/ 为/ SHA/ ,/ 它/ 的/ 下游/ 节点/ HAi/ +/ 1/ 在/ 检测/ 到/ 其/ 失效/ 后/ ,/ 获得/ 管理/ 令牌/ ,/ 配置/ SHA/ _/ Addr/ ,/ 成为/ 新/ 的/ SHA/ ,/ 接管/ 失效/ SHA/ 作为/ HA/ 所/ 服务/ 的/ MN/ ,/ 同时/ 接管/ SHA/ 服务/ ,/ 包括/ 通过/ 广播/ 代理/ 宣告/ 通告/ 向/ 其他/ HA/ 自己/ 的/ SHA/ 身份/ ;/ 从/ DBR/ 中/ 删除/ 已/ 失效/ 的/ SHA/ ,/ 根据/ 排序/ 规则/ 重构/ DBR/ ;/ 向/ 环/ 重构/ 所/ 涉及/ 的/ 相关/ 节点/ 通告/ 其新/ 的/ 上下游/ 节点/ 信息/ ./ 4MHADS/ 方案/ 性能/ 分析/ 本节/ 和/ 下节/ 通过/ 理论/ 分析/ 和/ 系统/ 仿真/ ,/ 对/ IETF/ 的/ RHASM/ 方案/ [/ 9/ ]/ 和/ 本文/ 所提/ 的/ MHADS/ 方案/ 进行/ 比较/ ./ 为/ 实现/ IPsec/ 支持/ ,/ RHASM/ 需/ 采用/ 硬/ 切换/ 和/ 虚拟/ 切换/ 两种/ 模式/ ,/ 在/ 硬/ 切换/ 模式/ 下/ ,/ 失效/ HA/ 的/ 服务/ 迁移/ 需要/ MN/ 参与/ ,/ 向/ 接管/ 实体/ 进行/ 重/ 注册/ ./ 图/ 4/ 为/ HA/ 容错/ 方案/ 性能/ 分析/ 的/ 网络/ 模型/ ./ 其中/ :/ tmr/ 表示/ MN/ 与/ 基站/ 或/ 无线/ 接入点/ (/ BS/ // AP/ )/ 间/ 的/ 无线/ 链路/ 传输/ 延时/ ;/ tra/ 表示/ BS/ // AP/ 与/ 本地网络/ 接入/ 路由器/ AR/ 间/ 的/ 单向/ 传输/ 延时/ ;/ tah/ 表示/ MN/ 当前/ 所在/ 网络/ 的/ AR/ 与/ MN/ 家乡/ 网络/ 间/ 的/ 单向/ 传输/ 延时/ ;/ thh/ 表示/ 家乡/ 链路/ 内部/ 各/ HA/ 间/ 的/ 单向/ 传输/ 延时/ ;/ tca/ 、/ tch/ 分别/ 为/ MN/ 的/ 通信/ 节点/ CN/ 与/ MN/ 当前/ 所在/ 网络/ 的/ AR/ 间/ 、/ CN/ 与/ MN/ 的/ HA/ 间/ 的/ 单向/ 传输/ 延迟/ ./ 各/ 参数/ 经验值/ 如表/ 1/ 所示/ [/ 14/ -/ 15/ ]/ ./ Page5tmrtratahthhtcatch10/ (/ WLAN/ )/ 50/ (/ 3G/ 网络/ )/ 150/ (/ 卫星网络/ )/ HA/ 容错/ 时间/ Tft/ 包括/ HA/ 失效/ 检测时间/ Tfd/ 和/ 失效/ HA/ 服务/ 迁移/ 时间/ Tss/ ./ RHASM/ 和/ MHADS/ 的/ HA/ 失效/ 检测时间/ 分析/ 如图/ 5/ 所示/ ./ RHASM/ 方案/ 如图/ 5/ (/ a/ )/ 所示/ ,/ HAi/ 在/ 失效/ 前以/ 间隔时间/ HELLO/ _/ INTERVAL/ (/ Ihl/ )/ 在/ 家乡/ 链路/ 周期性/ 广播/ Hello/ 消息/ ,/ ti/ 时刻/ 为/ HAi/ 在/ 失效/ 前/ 发送/ 的/ 最后/ 一个/ Hello/ 消息/ ,/ ti/ +/ 1/ 时刻/ 该/ 消息/ 的/ 生命期/ (/ LThl/ )/ 到期/ ,/ HAi/ 的/ 检测/ 节点/ HAj/ 将/ 主动/ 向/ HAi/ 发送/ Hello/ 请求/ ,/ ti/ +/ 2/ 时刻/ HAj/ 等待/ HAi/ 的/ Hello/ 应答/ 超时/ (/ 令/ 超时/ 时间/ 为/ TOhlr/ )/ ,/ 判断/ 其/ 失效/ ./ 令/ σ/ 表示/ HAi/ 失效/ 发生/ 到/ ti/ +/ 1/ 时刻/ 的/ 时间/ 间隔/ ,/ 那么/ ,/ σ/ 服图/ 5HA/ 失效/ 检测时间/ 分析/ RHASM/ 方案/ 的/ 硬/ 切换/ 模式/ ,/ 活跃/ HA/ 失效/ 后/ 的/ 服务/ 迁移/ 需/ 经过/ MN/ 与/ 新/ 活跃/ HAj/ 的/ 多轮/ 交互/ :/ HAj/ 向/ 各/ MN/ 通告/ 重/ 配置/ HA/ ;/ MN/ 与/ HAj/ 通过/ IKE/ 过程/ 协商/ IPSecSA/ (/ 该/ 过程/ 至少/ 需要/ MN/ -/ HA/ 间/ 两轮/ 往返/ 交互/ )/ ;/ MN/ 向/ HAj/ 进行/ 家乡/ 注册/ ./ 忽略/ 消息/ 在/ 各/ 节点/ 的/ 处理/ 时间/ ,/ 该/ 模式/ 下/ 的/ 服务/ 迁移/ 时间/ 为/ TRHASM/ -/ Hss/ =/ 7/ ×/ tmh/ =/ 7/ ×/ (/ tmr/ +/ tra/ +/ tah/ )/ ./ RHASM/ 方案/ 的/ 虚拟/ 切换/ 模式/ ,/ 活跃/ HA/ 失效/ 后/ 的/ 服务/ 迁移/ 过程/ 需从/ 备用/ HA/ 中/ 选举/ 产生/ 一新/ 的/ 活跃/ HA/ ,/ 接管/ 失效/ HA/ 的/ 服务/ ,/ 服务/ 迁移/ 时间/ 主要/ 为/ 接管/ 实体/ 的/ 选举/ 时间/ TRHASM/ -/ V/ 从/ [/ 0/ ,/ LThl/ ]/ 上/ 的/ 均匀分布/ ./ RHASM/ 的/ HA/ 失效/ 检测时间/ 为/ TRHASMMHADS/ 方案/ 如图/ 5/ (/ b/ )/ 所示/ ,/ HAi/ 以/ 间隔时间/ HEARTBEAT/ _/ INTERVAL/ (/ Ihb/ )/ 周期性地/ 向/ 下游/ 节点/ HAi/ +/ 1/ 发送/ 心跳/ 消息/ ./ HAi/ 失效/ 发生/ 在/ 第/ i/ 和/ i/ +/ 1/ 次/ 心跳/ 消息/ 的/ 间隔/ 周期/ 内/ ./ 从/ ti/ +/ 1/ 开始/ ,/ HAi/ +/ 1/ 每隔/ Ihb/ 时间/ 都/ 会/ 将/ HAi/ 维护/ 的/ MISSING/ _/ HEARTBEAT/ 值增/ 1/ ,/ 直到/ ti/ +/ Nmhb/ 时刻/ MISSING/ _/ HEARTBEAT/ 值/ 达到/ Nmhb/ (/ 令/ Nmhb/ 为/ MISSING/ _/ HEARTBEATS/ _/ ALLOWED/ )/ ,/ HAi/ +/ 1/ 将/ 主动/ 向/ HAi/ 发送/ 心跳/ 请求/ 消息/ ,/ 到/ tj/ 时刻/ HAi/ +/ 1/ 等待/ HAi/ 的/ 心跳/ 应答/ 超时/ (/ 令/ 超时/ 时间/ 为/ TOhbr/ )/ ,/ 判断/ 其/ 失效/ ./ 令/ θ/ 表示/ HAi/ 失效/ 发生/ 到/ 下/ 一次/ 心跳/ 间隔/ 到期/ 的/ 时间/ ,/ 则/ θ/ 服从/ [/ 0/ ,/ Ihb/ ]/ 上/ 的/ 均匀分布/ ./ MHADS/ 的/ HA/ 失效/ 检测时间/ 为/ TMHADSIhb/ +/ TOhbr/ ./ MHADS/ 方案/ 中/ ,/ 某/ 节点/ HAi/ 失效/ 后/ ,/ 将/ 由/ 它/ 唯一/ 的/ 备份/ 节点/ HAi/ +/ 1/ 基于/ 同步/ 备份/ 的/ 信息/ 直接/ 接管/ 其/ 服务/ ,/ 若/ 忽略/ 节点/ 处理/ 时间/ ,/ 其/ 服务/ 迁移/ 时间/ 可/ 忽略/ 不记/ ,/ 该/ 方案/ 的/ 容错/ 时间/ 主要/ 由/ 失效/ 检测时间/ 决定/ ./ RHASM/ 硬/ 切换/ 模式/ 、/ 虚拟/ 切换/ 模式/ 及/ MHADS/ 的/ 容错/ 时间/ 均值/ 分别/ 为/ ft/ ]/ =/ LThl/ // 2/ +/ TOhlr/ +/ 7/ ×/ (/ tmr/ +/ tra/ +/ tah/ )/ ,/ E/ [/ TRHASM/ -/ Hft/ ]/ =/ LThl/ // 2/ +/ TOhlr/ +/ tvote/ ,/ E/ [/ TRHASM/ -/ VE/ [/ TDBRMft/ ]/ =/ (/ Nmhb/ -/ 1/ // 2/ )/ ×/ Ifdm/ +/ TOhbr/ (/ 1/ )/ 图/ 6/ 给出/ 了/ RHASM/ 硬/ 切换/ 、/ 虚拟/ 切换/ 和/ Page6MHADS/ 方案/ 的/ 容错/ 时间/ 均值/ ,/ 其中/ ,/ LThl/ =/ 3Ifdm/ ,/ Nmhb/ =/ 2/ ,/ TOhlr/ =/ TOhbr/ =/ 6thh/ ,/ tvote/ =/ 20ms/ ./ 图/ 6/ (/ a/ )/ 为/ 容错/ 时间/ 均值/ 随/ 失效/ 检测/ 消息/ 间隔/ 周期/ Ifdm/ 的/ 变化/ 情况/ ./ 三者/ 都/ 随着/ Ifdm/ 线性/ 增长/ ,/ E/ [/ TMHADS/ 终/ 最小/ ,/ E/ [/ TRHASM/ -/ V/ 需要/ 经过/ 接管/ 实体/ 选举/ 过程/ ./ 而/ E/ [/ TRHASM/ -/ H/ 远高于/ 前/ 两者/ ,/ 主要/ 因为/ RHASM/ 硬/ 切换/ 的/ 服务/ 迁移/ 过程/ 需要/ MN/ 参与/ ,/ 并/ 需要/ MN/ -/ HA/ 间/ 的/ 多轮/ 交互/ ./ 现有/ HA/ 容错/ 方案/ 中/ Ifdm/ 典型/ 取值/ 为/ 50ms/ ./ 从图/ 中/ 可以/ 看到/ ,/ 当/ Ifdm/ </ 150ms/ 时/ ,/ E/ [/ TMHADSft/ ]/ 都/ 小于/ 250ms/ (/ 上层/ 音频/ 业务/ 容忍/ 的/ 最/ E/ [/ TRHASM/ -/ V/ 大/ 传输/ 延时/ )/ ,/ Ifdm/ 的/ 建议/ 取值/ 范围/ 为/ 10ms/ ~/ 150ms/ ./ 而/ E/ [/ TRHASM/ -/ Hft/ ]/ 的/ 最小值/ 也/ 远大于/ 250ms/ ,/ RHASM/ 硬/ 切换/ 无法/ 避免/ HA/ 失效/ 对/ MN/ 上层/ 应用/ 尤其/ 是/ 音频/ 业务/ 造成/ 影响/ ./ 图/ 6/ (/ b/ )/ 为/ 容错/ 时间/ 均值/ 随/ MN/ -/ HA/ 间/ 传输/ 延时/ 的/ 变化/ 情况/ ,/ RHASM/ 硬/ 切换/ 的/ 容错/ 过程/ 需要/ MN/ 参与/ ,/ 使得/ 其/ 容错/ 时间/ 随/ MN/ -/ HA/ 间/ 传输/ 延时/ 的/ 增大/ 而/ 显著/ 增大/ ./ 而/ RHASM/ 虚拟/ 切换/ 和/ MHADS/ 由于/ 对/ MN/ 透明/ ,/ 容错/ 处理/ 在/ 家乡/ 链路/ 内/ 实现/ ,/ 使得/ 其/ 容错/ 时间/ 与/ MN/ -/ HA/ 间/ 传输/ 延时/ 无关/ ./ 5MHADS/ 方案/ 系统/ 仿真/ 本文/ 在/ NS/ -/ 2/ 中/ ,/ 通过/ 扩展/ MIPv6/ 协议/ 模块/ MobiWan/ ,/ 仿真/ 实现/ 了/ MHADS/ 和/ RHASM/ 方案/ ./ 仿真/ 场景/ 设置/ :/ 家乡/ 链路/ 设置/ 为/ 10GB/ 以太网/ ,/ 一个/ 边界/ 路由器/ ER/ ,/ 6/ 个/ HA/ ./ MHADS/ 中/ 6/ 个/ HA/ 组成/ 检测/ // 备份/ 环/ ;/ RHASM/ 中/ 6/ 个/ HA/ 分别/ 属于/ 两个/ 冗余/ 备份/ 集/ ,/ 各/ 冗余/ 备份/ 集/ 包括/ 一个/ 活跃/ HA/ 和/ 两个/ 备用/ HA/ ./ 100/ 个/ MN/ 移动/ 在/ 5/ 条/ 外地/ 链路/ ./ 各/ MN/ 的/ 移动/ 注册/ 请求/ 服从/ 发送/ 率为/ λ/ mn/ -/ reg/ 的/ 泊松/ 分布/ ./ 每个/ MN/ 的/ 数据包/ 到达/ 率/ 设置/ 为/ λ/ mn/ -/ data/ 的/ 泊松/ 分布/ ./ 仿真/ 参数设置/ 如表/ 2/ 所示/ ./ 表/ 2MHADS/ 和/ RHASM/ 方案/ 仿真/ 参数设置/ MN/ -/ AP/ 间/ 无线/ 链路/ CN/ 、/ AP/ 、/ ER/ 与/ Router/ 间/ 链路/ 带宽/ 100MB/ ,/ 单向/ 传输/ 延时/ 10ms/ 失效/ 检测/ 消息/ 间隔/ 周期/ Ifdm10ms/ ~/ 100ms/ 各/ MN/ 移动/ 注册/ 请求/ 率/ λ/ mn/ -/ reg0/ ./ 125/ 个/ // s/ (/ 1/ 个/ // 8s/ )/ 各/ MN/ 数据/ 到达/ 率/ λ/ mn/ -/ data5/ ~/ 90/ 个/ // sMHADS/ 方案/ 负载/ 评估/ 及/ 报告/ 算法/ 系统/ 参数值/ 仿真/ 时间/ 5.1/ 容错/ 时间/ 图/ 7/ 为/ RHASM/ 硬/ 切换/ 、/ 虚拟/ 切换/ 和/ MHADS/ 方案/ 容错/ 时间/ 随/ 失效/ 检测/ 消息/ 间隔/ 周期/ Ifdm/ 的/ 变化/ 情况/ ./ 与/ 理论/ 分析/ 结果/ 一致/ ,/ 三者/ 都/ 随/ Ifdm/ 线性/ 增长/ ./ 在/ 10ms/ ~/ 100ms/ 范围/ 内/ ,/ TMHADS/ 终/ 小于/ 250ms/ ./ RHASM/ 虚拟/ 切换/ 模式/ 的/ 服务/ 迁移/ 由于/ 需要/ 经过/ 接管/ 实体/ 选举/ 过程/ ,/ TRHASM/ -/ V/ 大于/ TMHADS5/ ./ 2/ 移动/ 注册/ 请求/ 失败率/ 本节/ 和/ 下节/ 分别/ 比较/ MHADS/ 和/ RHASM/ 方案/ 在/ 各种/ 系统/ 负载/ 状况/ 下/ 的/ 系统/ 总体/ 服务/ 可用/ 率/ Page7/ (/ 移动/ 注册/ 请求/ 失败率/ )/ 和/ 系统/ 服务/ 性能/ (/ 移动/ 注册/ 平均/ 延时/ )/ ./ 家乡/ 链路/ 总/ 的/ 利用率/ ρ/ hl/ 反映/ 系统/ 负载/ ./ λ/ mn/ -/ reg/ =/ 0.125/ (/ 1/ 个/ // 8s/ )/ ,/ λ/ mn/ -/ data/ 从/ 5/ ~/ 90/ 变化/ ,/ 则/ ρ/ hl/ 从/ 0.1/ ~/ 1.5/ 变化/ ./ 图/ 8/ 给出/ MHADS/ 和/ RHASM/ 方案/ 在/ 不同/ 系统/ 负载/ 状况/ (/ 家乡/ 链路/ 利用率/ )/ 下/ 的/ 移动/ 注册/ 请求/ 失败率/ ./ 当/ 系统/ 负载/ 较/ 轻/ ,/ 即/ ρ/ hl/ / 0.3/ 时/ ,/ 两种/ 方案/ 的/ 移动/ 注册/ 失败率/ 都/ 为/ 0/ ./ 当/ ρ/ hl/ >/ 0.3/ 时/ ,/ 随/ 系统/ 负载/ 的/ 增大/ ,/ RHASM/ 方案/ 下/ 的/ 移动/ 注册/ 请求/ 失败率/ rf/ 大幅/ 增大/ ,/ 当/ ρ/ hl/ =/ 1/ 时/ ,/ PRHASMPRHASM/ 而/ MHADS/ 方案/ 的/ 移动/ 注册/ 请求/ 失败率/ 始终/ 为/ 0/ ,/ 直到/ ρ/ hl/ 增大/ 到/ 1.1/ ,/ PMHADS/ 部署/ MIPv6/ 系统/ 时/ ,/ 会/ 考虑/ 到/ 系统/ 总/ 服务/ 能力/ ,/ 将/ 系统/ 所/ 支持/ 的/ 最大/ MN/ 数/ 设置/ 在/ 其/ 能力/ 范围/ 内/ ./ 即/ 通过/ 设置/ 系统/ 所/ 服务/ MN/ 个数/ 的/ 上/ 限值/ ,/ 使得/ 预期/ 的/ 家乡/ 链路/ 总/ 利用率/ ρ/ hl/ / 1/ ./ 也就是说/ 在/ 系统/ 实际/ 部署/ 中/ ,/ MHADS/ 方案/ 的/ 移动/ 注册/ 请求/ 失败率/ 几乎/ 为/ 0.5/ ./ 3/ 移动/ 注册/ 平均/ 延时/ 图/ 9/ 给出/ 两种/ 方案/ 在/ 不同/ 系统/ 负载/ 状况/ (/ 家乡/ 链路/ 利用率/ )/ 下/ 的/ 移动/ 注册/ 平均/ 延时/ ./ 当/ 系统/ 负载/ 较/ 轻/ ,/ 即/ ρ/ hl/ / 0.3/ 时/ ,/ 两种/ 方案/ 下/ 的/ 移动/ 注册/ 平均/ 延时/ 都/ 在/ 100ms/ 左右/ ./ 当/ ρ/ hl/ >/ 0.3/ 时/ ,/ 随着/ 系统/ 负载/ 的/ 增大/ ,/ RHASM/ 方案/ 下/ 的/ 移动/ 注册/ 平均/ 延时/ reg/ 大幅/ 增长/ ,/ 当/ ρ/ hl/ 增大/ 到/ 0.5/ 时/ ,/ TRHASMTRHASM/ 达/ 750ms/ 左右/ ,/ 当/ ρ/ hl/ =/ 1/ 时/ ,/ TRHASM/ 右/ ,/ 如此/ 高/ 的/ 注册/ 延时/ 将/ 严重/ 影响/ MN/ 上层/ 应用/ ;/ 而/ MHADS/ 方案/ 的/ 移动/ 注册/ 平均/ 延时/ TMHADS/ ρ/ hl/ / 1/ 时/ 始终/ 在/ 100ms/ 左右/ ./ 5.4/ 容错/ 信令/ 开销/ 图/ 10/ 为/ MHADS/ 和/ RHASM/ 方案/ 所/ 引入/ 的/ 单位/ 时间/ 信令/ 开销/ CMHADS/ 测/ 消息/ 间隔时间/ Ifdm/ 的/ 反比例/ 函数/ ,/ Ifdm/ 越小/ ,/ 即/ 失效/ 检测/ 消息/ 发送/ 越/ 频繁/ ,/ HA/ 容错/ 时间/ 将/ 越/ 小/ ./ 系统/ 设置/ 时/ ,/ 需在/ 权衡/ 容错/ 时间/ 和/ 引入/ 开销/ 的/ 基础/ 上/ 配置/ 恰当/ 的/ Ifdm/ 值/ ./ MHADS/ 方案/ 基于/ 检测/ // 备份/ 环/ 减小/ 了/ 移动/ 管理/ 信息/ 备份/ 开销/ ,/ 使得/ CMHADSft/ ./ 除了/ 容错/ 信令/ 开销/ ,/ RHASM/ 引入/ 了/ 大量/ 的/ CRHASM/ 设备/ 冗余/ 开销/ 和/ 信息/ 存储/ 开销/ ./ 备份/ HA/ 仅/ 用于/ 信息/ 备份/ ,/ 造成/ 系统资源/ 浪费/ ;/ 移动/ 管理/ 信息/ 在/ 多个/ 实体/ 同时/ 备份/ ,/ 信息冗余/ 大/ ,/ 造成/ 大量/ 存储/ 开销/ ./ 而/ MHADS/ 引入/ 检测/ // 备份/ 环/ 实现/ 多/ HA/ 间/ 的/ 合理/ 组织/ ,/ 所有/ 节点/ 同时/ 作为/ 服务/ 节点/ 和/ 备份/ 节点/ ,/ 避免/ 设备/ 冗余/ ,/ 同时/ 实现/ 了/ 多/ HA/ 间/ 的/ 负载/ 均衡/ ,/ 充分利用/ 系统资源/ ,/ 提升/ 系统/ 总体/ 服务/ 能力/ ./ 6/ 结语/ 本文/ 提出/ 一种/ 基于/ 多/ HA/ 部署/ 的/ MIPv6/ 服务/ 能力/ 提升/ 方案/ (/ MHADS/ )/ ,/ 该/ 方案/ 将/ 家乡/ 链路/ 的/ 多/ HA/ 组织/ 成/ 环状/ 的/ 相互/ 检测/ 和/ 信息/ 备份/ 关系/ ,/ 通过/ 检测/ // 备份/ 环/ 中下游/ 节点/ 对/ 上游/ 节点/ 主动/ 的/ 有效性/ 检测/ 和/ 移动/ 管理/ 信息/ 备份/ ,/ 实现/ 失效/ 实体/ 的/ 快速/ 失效/ 检测/ 和/ 服务/ 接管/ ./ 引入/ 逻辑/ 功能/ 实体/ SHA/ 作为/ 检测/ // 备份/ 环/ 的/ 管理者/ 和/ 家乡/ 链路/ 整个/ HA/ 集群/ 面向/ MN/ 的/ 统一/ 服务/ 接口/ ,/ 通过/ 多/ HA/ 对/ MN/ 的/ 单一/ 映像/ ,/ 实现/ 多/ HA/ 部署/ 及/ 容错/ 过程/ 对/ MN/ 的/ 透明性/ ,/ 减小/ 容错/ 时间/ ,/ 同时/ 通过/ 统一/ 服务/ 接口/ 为/ 每个/ Page8MN/ 进行/ 最优/ 服务/ 实体/ 选择/ ,/ 实现/ 全局/ 任务/ 在/ 各/ HA/ 间/ 的/ 动态/ 均衡/ ,/ 提升/ 系统/ 总体/ 服务/ 能力/ ./ 

