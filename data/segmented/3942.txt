Page1/ 一种/ 容/ 三盘/ 失效/ 纠/ 删码/ 的/ 单/ 数据/ 盘/ 失效/ 快速/ 重建/ 方法/ 邱丽娜/ 王芳/ 李楚/ (/ 华中科技大学/ 计算机/ 学院/ 武汉/ 430074/ )/ (/ 武汉/ 光电/ 国家/ 实验室/ 武汉/ 430074/ )/ (/ 教育部/ 信息/ 存储/ 及/ 应用/ 实验室/ 武汉/ 430074/ )/ 摘要/ 现代/ 存储系统/ 采用/ 纠/ 删码/ 避免/ 因/ 磁盘/ 故障/ 导致/ 的/ 数据/ 丢失/ ,/ 提高/ 系统/ 的/ 可靠性/ 和/ 可用性/ ./ 因容/ 三盘/ 失效/ 纠/ 删码/ ,/ 如/ TP/ 编码/ 和/ STAR/ 编码/ ,/ 可/ 同时/ 容忍/ 系统/ 中/ 任意/ 3/ 个/ 磁盘/ 损坏/ ,/ 可靠性/ 超过/ RAID6/ 编码/ ,/ 故而/ 受到/ 越来越/ 多/ 的/ 关注/ ./ 针对/ 发生/ 频率/ 最高/ 的/ 单盘/ 故障/ 实现/ 快速/ 重建/ 恢复/ 数据服务/ ,/ 尚未/ 得到/ 有效/ 实现/ ./ 重建/ 方案/ 有/ 多种/ ,/ 选择/ 何种/ 重建/ 方案/ 会/ 影响/ 重建/ 性能/ 甚至/ 影响/ 前端/ 服务/ 的/ 响应/ 时间/ ./ 传统/ 的/ 单盘/ 重建/ 方法/ 不仅/ 耗时/ 良久/ 而且/ 会/ 造成/ 带宽/ 的/ 浪费/ ./ 针对/ 单盘/ 重建/ 中/ 传统/ 方法/ 的/ 缺点/ ,/ 提出/ 一种/ 均分/ 机制/ 方法/ ,/ 利用/ 处于/ “/ 均分/ 状态/ ”/ 的/ 重建/ 校验/ 集合/ 推理/ 出/ 单盘/ 重建/ 时所/ 使用/ 的/ 数据量/ 的/ 最优/ 解/ 从而/ 找出/ 最佳/ 重建/ 方案/ ,/ 减少/ 磁盘/ I/ // O/ 时间/ ,/ 以/ 加速/ 重建/ 过程/ ./ 测试/ 结果表明/ 与/ 传统/ 方法/ 相比/ ,/ 均分/ 机制/ 方法/ 减少/ TP/ 编码/ 25/ %/ ~/ 30.6/ %/ 和/ STAR/ 编码/ 30/ %/ ~/ 33.64/ %/ 的/ 磁盘/ 读数据/ 量/ ,/ 使/ 重建/ 时间/ 显著/ 减少/ ;/ 且/ 在/ 不同/ 的/ 数据/ 块/ 和/ 不同/ 的/ 磁盘/ 个数/ 时/ ,/ 均分/ 机制/ 方法/ 的/ 重建/ 性能/ 均/ 优于/ 传统/ 方法/ ./ 关键词/ 磁盘阵列/ ;/ 可靠性/ ;/ 磁盘/ 损坏/ ;/ 重建/ 算法/ 1/ 引言/ 现代/ 存储系统/ 在/ 存储/ 数据/ 时/ 不仅/ 会/ 将/ 数据/ 条带/ 化/ 处理/ 以/ 提高/ 访问/ 性能/ ,/ 还/ 往往/ 存储/ 冗余/ 信息/ 以/ 保证/ 系统可靠性/ 和/ 数据/ 的/ 可用性/ ./ 备份/ 和/ 纠/ 删码/ 是/ 构成/ 冗余/ 信息/ 的/ 两种/ 方式/ ,/ 因/ 备份/ 会/ 造成/ 存储空间/ 的/ 极度/ 浪费/ ,/ 纠/ 删码/ 成为/ 存储/ 冗余/ 信息/ 的/ 优选/ ,/ 相关/ 研究/ 也/ 层出不穷/ ./ 长期以来/ ,/ 针对/ 容/ 两盘/ 错/ 的/ RAID6/ 编码/ 的/ 研究/ 占据/ 了/ 主流/ ./ 但/ 随着/ 分布式文件系统/ 的/ 广泛应用/ 和/ 存储/ 规模/ 的/ 扩大/ ,/ 传统/ RAID6/ 方案/ 已/ 满足/ 不了/ 需求/ ./ 容/ 三盘/ 错/ 的/ 纠/ 删码/ ,/ 如/ STAR/ 编码/ [/ 1/ ]/ 、/ TripleParity/ [/ 2/ ]/ (/ TP/ )/ 编码/ 和/ 扩展/ 的/ EVEVODD/ 编码/ [/ 3/ ]/ ,/ 可以/ 向/ 系统/ 提供/ 高于/ RAID6/ 方案/ 的/ 可靠性/ ,/ 使/ 系统/ 即便/ 在/ 三个/ 存储/ 节点/ 的/ 数据/ 同时/ 失效/ 时/ 也/ 能/ 利用/ 幸存/ 节点/ 上/ 的/ 数据恢复/ 所有/ 失效/ 数据/ ./ 由于/ Chen/ 等/ 人/ [/ 4/ ]/ 指出/ 磁盘/ 失效/ 的/ 发生/ 不是/ 独立/ 存在/ 的/ ,/ 一旦/ 出现/ 第/ 1/ 个/ 失效/ 磁盘/ ,/ 其它/ 磁盘/ 失效/ 的/ 概率/ 会/ 大大增加/ ,/ 更/ 多/ 磁盘/ 失效/ 会/ 随后/ 发生/ ,/ 这/ 极大地提高/ 了/ 失效/ 磁盘/ 的/ 总数/ 超出/ 系统/ 容错/ 能力/ 的/ 概率/ ,/ 一旦/ 系统/ 中/ 失效/ 磁盘/ 的/ 个数/ 高于/ 它们/ 的/ 容错/ 级别/ 时/ ,/ 系统/ 将/ 不可/ 修复/ ,/ 数据/ 会/ 永久/ 丢失/ ./ 因此/ ,/ 当/ 系统/ 中/ 出现/ 第/ 1/ 个/ 磁盘/ 失效/ 时/ ,/ 需要/ 尽快/ 修复/ 至/ 正常/ 状态/ ./ 现阶段/ 关于/ 容/ 三盘/ 失效/ 纠/ 删码/ 的/ 研究/ [/ 1/ -/ 3/ ]/ 大多/ 关注/ 于/ 创建/ 新/ 的/ 编码/ 、/ 解码/ 规则/ 来/ 降低/ 计算/ 复杂度/ 和/ 更新/ 数据/ 时/ 的/ 复杂度/ ,/ 很少/ 关注/ 单盘/ 失效/ 时/ 的/ 快速/ 重建/ ./ 另外/ ,/ 尽管/ 单/ 节点/ 失效/ 的/ 快速/ 重建/ 已经/ 得到/ 充分/ 的/ 研究/ ,/ 但/ 大部分/ 是/ 基于/ RAID6/ 编码方法/ 的/ ,/ 很少/ 有/ 针对/ 容/ 三盘/ 失效/ 纠/ 删码/ 的/ 重建/ 研究/ ./ 例如/ ,/ RDOR/ [/ 5/ ]/ 方法/ 是/ 为/ RDP/ [/ 6/ ]/ 的/ 单/ 节点/ 失效/ 所/ 设计/ ,/ PDRS/ [/ 7/ ]/ 是/ 为/ P/ -/ Code/ [/ 8/ ]/ 和/ X/ -/ Code/ [/ 9/ ]/ 所/ 设计/ 等/ ./ Wang/ 等/ 人/ [/ 10/ ]/ 提出/ 了/ 类似/ 的/ 方法/ ./ Zhu/ 等/ 人/ [/ 11/ ]/ 解决/ 使用/ RAID6/ 编码/ 的/ 异构/ 环境/ 下/ 的/ 单点故障/ 快速/ 重建/ 问题/ ./ NCCloud/ [/ 12/ ]/ 中/ 的/ F/ -/ MSR/ (/ FunctionalMinimum/ -/ StorageRegeneratingCode/ )/ 编码/ 能够/ 快速/ 重建/ 网络/ 存储/ 中/ 的/ 单点故障/ ,/ 但/ 它/ 的/ 容错/ 能力/ 和/ 存储/ 性能/ 仍/ 是/ RAID6/ 级别/ 的/ ./ 面对/ 容/ 三盘/ 失效/ 的/ 编码/ 在/ 单盘/ 出错/ 的/ 情况/ ,/ 也/ 有/ 一些/ 相关/ 方法/ ,/ 但/ 这些/ 方法/ 均/ 不是/ 最佳/ 的/ ./ 采用/ 传统/ 方法/ 重建/ 时会/ 从/ 磁盘/ 上/ 反复/ 读取/ 已/ 读取/ 过/ 的/ 数据/ ,/ 数据/ 有效/ 利用率/ 低/ ,/ 重建/ 时间/ 长/ ./ Khan/ 等/ 人/ [/ 13/ -/ 14/ ]/ 提出/ 枚举/ 所有/ 重建/ 方案/ 以/ 得到/ 最佳/ 重建/ 方案/ (/ 即/ 从/ 磁盘/ 读取数据/ 量/ 最少/ 的/ 方案/ )/ ,/ 但/ 求取/ 最佳/ 方案/ 的/ 过程/ 耗时/ 巨大/ ,/ 尤其/ 是/ 当/ 存储系统/ 中/ 节点/ 数目/ 较大/ 时/ ./ 单盘/ 失效/ 时/ 系统/ 需要/ 以/ 最快/ 的/ 速度/ 重建/ 的/ 另/ 一个/ 重要/ 原因/ 是/ 多数/ 情况/ 下/ ,/ 重建/ 时/ ,/ 系统/ 仍/ 需要/ 响应/ 来自/ 用户/ 的/ 请求/ ./ 用户/ 读/ // 写/ 请求/ 会/ 与/ 重建/ 进程/ I/ // O/ 请求/ 竞争/ 磁盘/ I/ // O/ ,/ 不仅/ 导致/ 重建/ 过程/ 延长/ ,/ 而且/ 用户/ 请求/ 相应/ 时间/ 也/ 延长/ ,/ 降低/ 了/ 服务质量/ ./ 因此/ ,/ 为了/ 尽快/ 向/ 用户/ 提供/ 高质量/ 的/ 服务/ 减少/ 用户/ 的/ 不/ 满意度/ ,/ 单/ 节点/ 失效/ 时/ 需要/ 尽可能/ 地/ 减少/ 重建/ 时间/ ,/ 使/ 系统/ 尽快恢复/ 至/ 正常/ 状态/ ./ 容/ 三盘/ 失效/ 的/ 编码/ 系统/ 中有/ 3/ 种/ 校验/ 方式/ ,/ 传统/ 方法/ 只/ 使用/ 其中/ 的/ 一种/ 校验/ 方式/ 进行/ 重建/ 计算/ ./ 事实上/ ,/ 同时/ 使用/ 3/ 种/ 校验/ 方式/ 重建/ 会/ 找到/ 最佳/ 重建/ 方案/ ,/ 提高/ 数据/ 有效/ 利用率/ ./ 最佳/ 重建/ 方案/ 需要/ 从/ 磁盘/ 读取/ 的/ 数据量/ (/ 即/ 最小/ 数据量/ )/ 不能/ 直接/ 求得/ ,/ 但/ 可以/ 推导/ 出/ 范围/ ./ 基于/ 以上/ 发现/ ,/ 我们/ 提出/ 均分/ 机制/ 方法/ ,/ 经过/ 数学分析/ 和/ 推理/ 定位/ 最小/ 数据量/ 的/ 取值/ 范围/ ,/ 依次/ 经过/ 启发式/ 搜索/ 快速/ 返回/ 最佳/ 重建/ 方案/ ,/ 从而/ TP/ 编码/ 在/ 重建/ 时/ 从/ 磁盘/ 读取/ 的/ 数据量/ 减少/ 大约/ 25/ %/ ~/ 30.6/ %/ ,/ 减少/ 磁盘/ I/ // O/ 时间/ ,/ 使/ 系统/ 快速/ 重建/ 至/ 正常/ 状态/ ./ 该/ 方法/ 同样/ 适用/ 于/ STAR/ 编码/ 、/ 通用/ EVENODD/ 编码/ 等/ 常用/ 的/ 容/ 三盘/ 错/ 的/ 编码/ 系统/ ./ 2/ 相关/ 研究/ 2.1/ 定义/ 本文/ 中/ 我们/ 按照/ Plank/ 使用/ 的/ 编码/ 术语/ 来/ 描述/ [/ 15/ ]/ ./ 假设/ 一个/ 由/ n/ 个/ 磁盘/ 构成/ 的/ 存储系统/ ,/ 其中/ k/ 个/ 磁盘/ 存储/ 原始数据/ ,/ 剩余/ 的/ n/ -/ k/ 个/ 磁盘/ 存储/ 校验/ 数据/ ./ 每个/ 磁盘/ 容量/ 相同/ ,/ 划分/ 成/ 多个/ 由/ w/ 个/ 元素/ 组成/ 的/ 条带/ 单元/ ,/ 每个/ 元素/ 代表/ 一定/ 数量/ 的/ 数据/ 块/ ./ 在/ 该/ 磁盘阵列/ 中/ ,/ 所有/ 磁盘/ 上/ 位于/ 相同/ 偏移/ 的/ 不同/ Page3/ 条带/ 单元/ 构成/ 一个/ 条带/ ,/ 如图/ 1/ 所示/ ./ 在/ 一个/ 条带/ 内部/ ,/ 数据/ 元素/ 根据/ 一定/ 的/ 编码/ 规则/ 生成/ 相应/ 的/ 校验/ 元素/ ,/ 它们/ 共同/ 组成/ 一个/ 校验/ 组/ ./ 数据/ 的/ 编解码/ 是/ 以/ 条带/ 为/ 单元/ 进行/ 的/ ,/ 不同/ 条带/ 间/ 编解码/ 相互/ 独立/ ./ 不失/ 一般性/ 地/ ,/ 在/ 讨论/ 最佳/ 重建/ 方案/ 时/ 我们/ 假设/ 磁盘阵列/ 只/ 包含/ 一个/ 条带/ ,/ 用/ 一个/ R/ 行/ n/ 列/ 的/ 阵列/ ,/ 即/ R/ ×/ n/ 阵列/ 描述/ 此/ 单一/ 条带/ 内部结构/ ./ 图/ 1TP/ 的/ 对角线/ 校验/ 和/ 反/ 对角线/ 校验/ 的/ 编码/ 规则/ 2.2/ 容三/ 节点/ 失效/ 纠/ 删码/ 本文/ 主要/ 研究/ TP/ 编码/ 和/ STAR/ 编码/ 的/ 单点/ 失效/ 快速/ 重建/ ,/ 因为/ 相比/ 其它/ 纠/ 删码/ ,/ TP/ 和/ STAR/ 的/ 编码/ 和/ 解码/ 复杂度/ 非常低/ ,/ 而/ 这/ 是/ 影响/ 人们/ 选择/ 同一/ 级别/ 的/ 纠/ 删码/ 的/ 重要/ 因素/ ./ TP/ 编码/ 是/ 由/ RDP/ 编码/ 衍生/ 出来/ 的/ ,/ 它/ 包含/ 3/ 种/ 斜率/ 的/ 校验/ :/ 行/ 校验/ 、/ 对角线/ 校验/ 和/ 反/ 对角线/ 校验/ ./ 在/ 采用/ TP/ 编码/ 的/ 系统/ 中/ ,/ 一个/ 条带/ 可以/ 用/ (/ p/ -/ 1/ )/ ×/ (/ p/ +/ 2/ )/ 阵列/ 来/ 描述/ ,/ p/ 是/ 大于/ 2/ 的/ 素数/ ./ 图/ 1/ 描述/ 的/ 是/ 在/ p/ =/ 5/ 时/ ,/ 由/ 7/ 个/ 磁盘/ 构成/ 的/ 系统/ 中/ 单一/ 条带/ 的/ 示意图/ ,/ 前/ 4/ 列/ 代表/ 数据/ 盘/ ,/ 后/ 3/ 列/ 分别/ 代表/ 行/ 校验/ 、/ 对角线/ 校验/ 和/ 反/ 对角线/ 校验/ 的/ 校验/ 盘/ ./ 为/ 方便/ 表述/ ,/ 用/ Di/ ,/ j/ 表示/ 位于/ 第/ i/ 行/ ,/ 第/ j/ 列/ 的/ 数据/ 元素/ ,/ 其中/ 0/ / i/ / p/ -/ 2/ ,/ 0/ / j/ / p/ -/ 2/ ;/ Bi/ ,/ v/ 表示/ 位于/ 第/ i/ 行/ ,/ 第/ (/ p/ -/ 1/ +/ v/ )/ 列/ 的/ 校验/ 元素/ ,/ 其中/ 0/ / i/ / p/ -/ 2/ ,/ 0/ / v/ / 2/ ./ 实际上/ ,/ 当/ v/ =/ 0/ 或/ 1/ 时/ ,/ Bi/ ,/ v/ 所在/ 的/ 校验/ 组/ 的/ 斜率/ 是/ v/ ,/ Bi/ ,/ v/ 代表/ 行/ 校验/ 元素/ 或/ 对角线/ 校验/ 元素/ ;/ 当/ v/ =/ 2/ 时/ ,/ Bi/ ,/ v/ 所在/ 的/ 校验/ 组/ 的/ 斜率/ 是/ -/ 1/ ,/ Bi/ ,/ v/ 代表/ 反/ 对角线/ 校验/ 元素/ ./ 我们/ 将/ Bi/ ,/ v/ 所在/ 的/ 校验/ 组/ 称为/ Bi/ ,/ v/ 校验/ 组/ ./ 行/ 校验/ 的/ 编码/ 规则/ 是/ 由/ 同一/ 行/ 的/ 数据/ 元素/ 异或/ 计算/ 出行/ 校验/ 元素/ ,/ 如/ D0/ ,/ 0/ +/ D0/ ,/ 1/ +/ D0/ ,/ 2/ +/ D0/ ,/ 3/ 求得/ B0/ ,/ 0/ ./ 对角线/ 和/ 反/ 对角线/ 校验/ 的/ 编码/ 规则/ 如图/ 1/ 所示/ ./ STAR/ 纠/ 删码/ 的/ 编码/ 规则/ 与/ TP/ 类似/ ,/ 但/ STAR/ 中/ 的/ 条带/ 是/ (/ p/ -/ 1/ )/ ×/ (/ p/ +/ 3/ )/ 阵列/ ,/ 且/ STAR/ 的/ 行/ 校验/ 元素/ 不像/ TP/ 编码/ 中/ 那样/ 参与/ 计算/ 对角线/ // 反/ 对角线/ 校验/ 元素/ ./ 2.3/ 相关/ 研究/ 当/ 磁盘阵列/ 中/ 的/ 失效/ 磁盘/ 为/ 校验/ 盘时/ ,/ 校验/ 盘上/ 的/ 校验/ 信息/ 可以/ 按照/ 最初/ 计算/ 的/ 过程/ 再次/ 求解/ ,/ 这是/ 唯一/ 的/ 方法/ ,/ 没有/ 优化/ 的/ 空间/ ./ 本文/ 关注/ 的/ 是/ 失效/ 数据/ 盘/ 的/ 单盘/ 快速/ 重建/ 方法/ ./ (/ 1/ )/ 传统/ 重建/ 方法/ ./ 传统/ 方法/ 读取/ 行/ 校验/ 元素/ 和/ 同一/ 校验/ 组下/ 有效/ 的/ 数据/ 元素/ ,/ 经过/ 异或/ 运算/ ,/ 求得/ 失效/ 的/ 数据/ 元素/ ,/ 失效/ 条带/ 单元/ 上/ 的/ 所有/ 数据/ 元素/ 都/ 根据/ 此/ 过程/ 重建/ ./ 以图/ 1/ 为例/ ,/ 假设/ 数据/ 盘/ D0/ 失效/ ,/ 4/ 个/ 数据/ 元素/ D0/ ,/ 0/ ,/ D1/ ,/ 0/ ,/ D2/ ,/ 0/ ,/ D3/ ,/ 0/ 的/ 数据/ 失效/ ./ 恢复/ D0/ ,/ 0/ 的/ 数据/ ,/ 传统/ 方法/ 从/ 磁盘/ 上/ 读取/ D0/ ,/ 1/ ,/ D0/ ,/ 2/ ,/ D0/ ,/ 3/ 和/ B0/ ,/ 0/ 进行/ 异或/ 运算/ ;/ 类似/ 地/ ,/ 恢复/ D1/ ,/ 0/ 的/ 数据/ ,/ 传统/ 方法/ 从/ 磁盘/ 上/ 读取/ D1/ ,/ 1/ ,/ D1/ ,/ 2/ ,/ D1/ ,/ 3/ 和/ B1/ ,/ 0/ 进行/ 异或/ 运算/ ;/ 恢复/ D2/ ,/ 0/ 的/ 数据/ ,/ 传统/ 方法/ 从/ 磁盘/ 上/ 读取/ D2/ ,/ 1/ ,/ D2/ ,/ 2/ ,/ D2/ ,/ 3/ 和/ B2/ ,/ 0/ 进行/ 异或/ 运算/ ;/ 恢复/ D3/ ,/ 0/ 的/ 数据/ ,/ 传统/ 方法/ 从/ 磁盘/ 上/ 读取/ D3/ ,/ 1/ ,/ D3/ ,/ 2/ ,/ D3/ ,/ 3/ 和/ B3/ ,/ 0/ 进行/ 异或/ 运算/ ./ 重建/ 整个/ 条带/ ,/ 需要/ 从/ 磁盘/ 读取/ 的/ 数据量/ 是/ 16/ 个/ 元素/ (/ 包含/ 数据/ 元素/ 和校验/ 元素/ )/ ./ 传统/ 重建/ 方法/ 只/ 使用/ 行/ 校验/ 一种/ 校验/ 方式/ ,/ 忽略/ 了/ 在/ 容/ 三盘/ 出错/ 纠/ 删码/ 中/ 一个/ 数据/ 元素/ 受到/ 多个/ 不同/ 的/ 校验/ 组/ 保护/ 的/ 现象/ ,/ 不是/ 一种/ 高效/ 快速/ 的/ 重建/ 方法/ ./ 当/ 采用/ 多种/ 校验/ 方式/ 来/ 重建/ 时/ ,/ 不同/ 校验/ 方式/ 的/ 校验/ 组/ 之间/ 共同/ 包含/ 的/ 数据/ 元素/ 只/ 需读/ 一次/ ,/ 可/ 有效/ 地/ 减少/ 磁盘/ 数据/ 读取/ 量/ ./ (/ 2/ )/ 枚举法/ ./ 枚举法/ 基于/ 编码/ 的/ 产生/ 矩阵/ 列出/ 所有/ 可能/ 重建/ 方案/ ,/ 从中/ 取出/ 最佳/ 的/ 方案/ ./ 这种/ 方法/ 对/ 任何/ 级别/ 的/ 基于/ 异或/ 运算/ 的/ 纠/ 删码/ 均/ 适用/ ./ 以图/ 2/ 为例/ 说明/ 枚举法/ 的/ 详细/ 步骤/ ./ 图/ 2/ 描述/ 了/ TP/ (/ p/ =/ 5/ )/ 通过/ 产生/ 矩阵/ 生成/ 校验/ 的/ 规则/ ./ 产生/ 矩阵/ 和/ 数据/ 元素/ 表示/ 的/ 列/ 向量/ 相乘/ 求得/ 编码/ 向量/ ./ 阴影/ 小/ 方格/ 表示/ 取值/ 1/ ,/ 白色/ 小/ 方格/ 表示/ 取值/ 0/ ./ 假设/ 磁盘/ D0/ 失效/ ,/ 需要/ 重建/ 其上/ 的/ 4/ 个/ 数据/ 元素/ Page4D0/ ,/ 0/ ,/ D1/ ,/ 0/ ,/ D2/ ,/ 0/ ,/ D3/ ,/ 0/ ./ 枚举法/ 使用/ 重建/ 方程/ 减少/ 重建/ 所/ 需/ 元素/ 的/ 数目/ ./ 重建/ 方程/ 由/ 一组/ 元素/ 组成/ ,/ 这些/ 元素/ 对应/ 于/ 产生/ 矩阵/ 中/ 的/ 行向量/ 的/ 异或/ 值为/ 0/ ./ 例如/ D0/ ,/ 0/ ,/ D0/ ,/ 1/ ,/ D0/ ,/ 2/ ,/ D0/ ,/ 3/ 和/ B0/ ,/ 0/ 所在/ 的/ 行向量/ 的/ 异或/ 值为/ 0/ ,/ 故/ 它们/ 组成/ 一个/ 重建/ 方程/ ./ 我们/ 可以/ 使用/ 重建/ 方程/ 中/ 其余/ 幸存/ 的/ 元素/ 来/ 恢复/ 任意/ 一个/ 失效/ 元素/ ./ 例如/ ,/ 当/ D0/ ,/ 0/ 失效/ 时/ ,/ D0/ ,/ 1/ ,/ D0/ ,/ 2/ ,/ D0/ ,/ 3/ 和/ B0/ ,/ 0/ 通过/ 异或/ 运算/ 可以/ 恢复/ D0/ ,/ 0/ ./ 需要/ 注意/ 的/ 是/ ,/ D0/ ,/ 0/ 可/ 与/ 其它/ 元素/ 组成/ 重建/ 方程/ ,/ 故/ 也/ 可/ 通过/ 其它/ 重建/ 方程/ 重建/ ./ 当/ 重建/ 失效/ 磁盘/ D0/ 时/ ,/ 首先/ 根据/ 产生/ 矩阵/ ,/ 枚举/ 出/ 所有/ 的/ 重建/ 方程/ ,/ 然后/ 按/ 以下/ 步骤/ 恢复/ D0/ 上/ 失效/ 元素/ :/ 给出/ 4/ 个/ 集合/ E0/ ,/ E1/ ,/ E2/ 和/ E3/ ,/ Ei/ 是/ 失效/ 元素/ Di/ ,/ 0/ (/ 0/ / i/ / 3/ )/ 所在/ 的/ 所有/ 重建/ 方程/ 组成/ 的/ 集合/ ;/ 从/ 每个/ Ei/ 中/ 选取/ 一个/ 重建/ 方程/ ei/ 使得/ 所有/ ei/ 组成/ 的/ 并/ 集中/ 元素/ 数目/ 最少/ ./ 本例/ 中/ ,/ 通过/ 枚举法/ 获得/ 的/ 一个/ 最佳/ 重建/ 方案/ 如下/ :/ ①/ e0/ :/ D0/ ,/ 0/ ,/ D0/ ,/ 1/ ,/ D0/ ,/ 2/ ,/ D0/ ,/ 3/ ,/ B0/ ,/ 0/ ②/ e1/ :/ D1/ ,/ 0/ ,/ D1/ ,/ 1/ ,/ D1/ ,/ 2/ ,/ D1/ ,/ 3/ ,/ B1/ ,/ 0/ ③/ e2/ :/ D2/ ,/ 0/ ,/ D1/ ,/ 1/ ,/ D0/ ,/ 2/ ,/ B3/ ,/ 0/ ,/ B2/ ,/ 1/ ④/ e3/ :/ D3/ ,/ 0/ ,/ D2/ ,/ 1/ ,/ D1/ ,/ 2/ ,/ D0/ ,/ 3/ ,/ B3/ ,/ 1e0/ ,/ e1/ ,/ e2/ 和/ e3/ 的/ 并/ 集/ 除去/ 4/ 个/ 失效/ 元素/ D0/ ,/ 0/ ,/ D1/ ,/ 0/ ,/ D2/ ,/ 0/ ,/ D3/ ,/ 0/ 和/ 4/ 个/ 公共/ 元素/ D1/ ,/ 1/ ,/ D0/ ,/ 2/ ,/ D1/ ,/ 2/ ,/ D0/ ,/ 3/ 共有/ 12/ 个/ 元素/ ,/ 使用/ 这/ 12/ 个/ 元素/ 可以/ 完成/ 磁盘/ D0/ 的/ 重建/ ./ 然而/ ,/ 枚举法/ 需要/ 列出/ 每个/ 失效/ 元素/ 的/ 所有/ 重建/ 方程/ ,/ 之后/ 通过/ 枚举/ 求/ 出/ 使得/ 恢复/ 各个/ 失效/ 元素/ 的/ 重建/ 方程/ 的/ 并/ 集中/ 元素/ 个数/ 最小/ 的/ 组合/ ./ 当/ 磁盘/ 个数/ 增加/ 时/ ,/ 重建/ 方程/ 的/ 个数/ 指数/ 增长/ ,/ 耗时/ 巨大/ ./ 通常/ 情况/ 下/ ,/ 使用/ 枚举法/ 找/ 最佳/ 重建/ 方案/ 的/ 问题/ 是/ NP/ 问题/ ./ 3/ 均分/ 机制/ 方法/ TP/ 编码/ 规则/ 的/ 图解/ 如图/ 1/ 所示/ ,/ 求解/ 校验/ 的/ 数学公式/ 表述/ 如下/ (/ 〈/ 〉/ 代表/ 模/ p/ 运算/ )/ :/ Bi/ ,/ v/ =/ ∑/ p/ -/ 2Bi/ ,/ v/ 代表/ 位于/ 第/ i/ 行/ ,/ 第/ (/ p/ -/ 1/ +/ v/ )/ 列/ 的/ 校验/ 元素/ ,/ “/ +/ ”/ 和/ “/ ∑/ ”/ 表示/ 异或/ 运算/ ./ 单个/ 磁盘/ 失效/ 时/ ,/ 表现/ 为/ 存储/ 在/ 其/ 上/ 的/ 条带/ 单元/ 上/ 的/ 数据/ 不可/ 用/ ,/ 重建/ 需要/ 恢复/ 该/ 条带/ 单元/ 上/ (/ p/ -/ 1/ )/ 个/ 数据/ 元素/ ./ 每个/ 失效/ 的/ 数据/ 元素/ 可以/ 通过/ 将/ 其/ 所在/ 的/ 校验/ 组中/ 其余/ 幸存/ 的/ 元素/ 进行/ 异或/ 运算/ 而/ 恢复/ ./ 因此/ ,/ 我们/ 的/ 目标/ 是/ 选取/ (/ p/ -/ 1/ )/ 个/ 合适/ 的/ 校验/ 组/ ,/ 既/ 可以/ 将/ 失效/ 元素/ 全部/ 重建/ ,/ 又/ 可以/ 使/ 重建/ 成本/ 最小/ ,/ 重建/ 速度/ 最快/ ./ 传统/ 方法/ 选取/ 的/ 是/ (/ p/ -/ 1/ )/ 个行/ 校验/ 组/ ,/ 根据/ 式/ (/ 1/ )/ 可知/ ,/ (/ p/ -/ 1/ )/ 个行/ 校验/ 组/ 包含/ 的/ 数据/ 元素/ 和校验/ 元素/ 的/ 个数/ 之/ 和/ (/ 除去/ 失效/ 元素/ )/ 为/ N/ =/ (/ p/ -/ 1/ )/ ×/ (/ p/ -/ 1/ )/ ,/ 且/ 这/ (/ p/ -/ 1/ )/ 个行/ 校验/ 组/ 彼此/ 不/ 相交/ ,/ 彼此/ 没有/ 公用/ 的/ 数据/ 元素/ ./ 然而/ 某些/ 校验/ 组/ 之间/ 拥有/ 公用/ 的/ 数据/ 元素/ ,/ 若/ 选取/ 合适/ 的/ 满足/ 重建/ 要求/ 的/ (/ p/ -/ 1/ )/ 个/ 校验/ 组/ (/ 不仅/ 限于/ 行/ 校验/ 组/ )/ ,/ 使/ 这些/ 校验/ 组/ 之间/ 的/ 交点/ 最/ 多/ ,/ 则/ 从/ 磁盘/ 上/ 需要/ 读取/ 的/ 元素/ 的/ 总数/ R/ 会/ 达到/ 最小/ ,/ 数值/ 为/ (/ N/ -/ 交点/ 总数/ ∑/ )/ ./ 下面/ ,/ 我们/ 分析/ 影响/ 交点/ 个数/ 的/ 因素/ ./ 从式/ (/ 1/ )/ 和/ 式/ (/ 2/ )/ 得出/ ,/ 对/ 所有/ 的/ j/ =/ 0/ ,/ 1/ ,/ …/ ,/ p/ -/ 2/ 来说/ ,/ 都/ 满足/ 如下/ 现象/ :/ 每个/ 行/ 校验/ 组/ Bi/ ,/ 0/ 包含/ 一个/ 数据/ 元素/ Di/ ,/ 〈/ j/ -/ i/ 〉/ ∈/ Bj/ ,/ 1/ 对角线/ 校验/ 组/ ,/ 每个/ 对角线/ 校验/ 组/ Bi/ ,/ 1/ 包含/ 一个/ 数据/ 元素/ Dj/ ,/ 〈/ i/ -/ j/ 〉/ ∈/ Bj/ ,/ 0/ 行/ 校验/ 组/ ./ 因此/ ,/ 每个/ 对角线/ 校验/ 组/ Bi/ ,/ 1/ (/ i/ =/ 0/ ,/ 1/ ,/ …/ ,/ p/ -/ 2/ )/ 与/ 每个/ 行/ 校验/ 组/ Bj/ ,/ 0/ (/ j/ =/ 0/ ,/ 1/ ,/ …/ ,/ p/ -/ 2/ )/ 均/ 相交/ 于/ 一个/ 数据/ 元素/ ,/ 交点/ 有且/ 仅/ 有/ 一个/ ,/ 我们/ 把/ 相交/ 的/ 元素/ 称为/ 公共/ 块/ ./ 同理/ ,/ 每个/ 反/ 对角线/ 校验/ 组/ Bi/ ,/ 2/ (/ i/ =/ 0/ ,/ 1/ ,/ …/ ,/ p/ -/ 2/ )/ 与/ 每个/ 行/ 校验/ 组/ Bj/ ,/ 0/ (/ j/ =/ 0/ ,/ 1/ ,/ …/ ,/ p/ -/ 2/ )/ 也/ 均/ 有/ 一个/ 公共/ 块/ ./ 而/ 并非/ 每个/ 对角线/ Page5/ 校验/ 组/ Bi/ ,/ 1/ 与/ 每个/ 反/ 对角线/ 校验/ 组/ Bj/ ,/ 2/ 均/ 相交/ ,/ 当/ i/ 和/ j/ 的/ 关系/ 满足/ 公式/ 时/ ,/ 两者/ 相交/ 于/ 编码/ 结构/ 的/ 虚拟/ 行第/ p/ -/ 1/ 行/ ,/ 产生/ 的/ 交点/ 称作/ 虚拟/ 公共/ 块/ ./ 由于/ 虚拟/ 公共/ 块/ 不是/ 真实/ 存在/ 的/ ,/ 求/ 交点/ 总数/ 时应/ 减去/ 它们/ 的/ 个数/ ./ 同一/ 类型/ 的/ 不同/ 校验/ 组/ 之间/ 彼此/ 不/ 相交/ ,/ 例如/ 所有/ 的/ 对角线/ 校验/ 组/ 彼此之间/ 不/ 存在/ 公共/ 块/ ./ 假设/ 我们/ 选取/ 的/ 用以/ 重建/ 的/ 校验/ 集合/ 为/ 包含/ (/ p/ -/ 1/ )/ 个/ 校验/ 组/ 的/ 集合/ ,/ 其中/ 有/ α/ 个行/ 校验/ 组/ ,/ β/ 个/ 对角线/ 校验/ 组/ ,/ γ/ 个/ 反/ 对角线/ 校验/ 组/ ,/ 且/ 有/ α/ +/ β/ +/ γ/ =/ p/ -/ 1/ ./ 由于/ 任意/ 一个/ 行/ 校验/ 组同/ 任意/ 一个/ 对角线/ 校验/ 组/ 产生/ 一个/ 公共/ 块/ ,/ 则/ α/ 个行/ 校验/ 组与/ β/ 个/ 对角线/ 校验/ 组/ 产生/ α/ ×/ β/ 个/ 公共/ 块/ ;/ 由于/ 任意/ 一个/ 行/ 校验/ 组同/ 任意/ 一个/ 反/ 对角线/ 校验/ 组/ 产生/ 一个/ 公共/ 块/ ,/ 则/ α/ 个行/ 校验/ 组与/ γ/ 个/ 反/ 对角线/ 校验/ 组/ 产生/ α/ ×/ γ/ 个/ 公共/ 块/ ./ 由于/ 对角线/ 校验/ 组和反/ 对角线/ 校验/ 组并/ 不/ 总是/ 产生/ 有效/ 的/ 公共/ 块/ (/ 即会/ 产生/ 虚拟/ 公共/ 块/ )/ ,/ 产生/ 虚拟/ 公共/ 块/ 的/ 对角线/ 校验/ 组和反/ 对角线/ 校验/ 组/ 的/ 组合/ 个数/ 为/ η/ ,/ 且/ 0/ / η/ / (/ p/ -/ 1/ )/ 校验/ 组和/ γ/ 个/ 反/ 对角线/ 校验/ 组/ 产生/ 的/ 公共/ 块/ 总数/ 至少/ 为/ β/ ×/ γ/ -/ η/ ./ 值得注意/ 的/ 是/ ,/ 有些/ 公共/ 块/ 是/ 3/ 个/ 校验/ 组/ 的/ 交点/ ,/ 由/ 集合/ 理论/ 知/ 应从/ 中/ 减去/ 这/ 类/ 公共/ 块/ 的/ 个数/ / 才/ 得到/ 正确/ 的/ 交点/ 总数/ ./ 因此/ 我们/ 得出/ 式/ (/ 4/ )/ ,/ R/ 表示/ 重建/ 单条/ 带/ 所/ 需/ 的/ 元素/ 总数/ (/ 也/ 可/ 称为/ 数据量/ )/ ./ R/ / (/ p/ -/ 1/ )/ ×/ (/ p/ -/ 1/ )/ -/ (/ α/ β/ +/ α/ γ/ +/ β/ γ/ -/ η/ -/ / )/ / (/ p/ -/ 1/ )/ 2/ +/ (/ α/ +/ β/ )/ 2/ -/ α/ 烐/ 烏/ 烑/ β/ / (/ p/ -/ 1/ )/ 2/ +/ 3/ =/ 2/ / 2/ 式/ (/ 4/ )/ 推算出/ 单条/ 带/ 的/ 单盘/ 重建/ 时/ ,/ 需要/ 从/ 磁盘/ 上/ 读取/ 的/ 元素/ 总数/ R/ 的/ 下界/ ./ 当/ α/ ,/ β/ ,/ γ/ 的/ 值/ 彼此/ 接近/ 时/ ,/ R/ 的/ 取值/ 会/ 无限/ 逼近/ 下界/ 2/ α/ +/ β/ +/ γ/ =/ p/ -/ 1/ ,/ 故/ p/ -/ 1/ 们/ 重建/ 策略/ 选取/ 3/ 类/ 校验/ 组/ 个数/ α/ 、/ β/ 和/ γ/ 的/ 值/ 彼此/ 接近/ 的/ 策略/ ,/ 我们/ 定义/ 同时/ 包含/ 3/ 类/ 校验/ 组且/ 每种/ 类型/ 的/ 校验/ 组/ 个数/ 彼此/ 接近/ 的/ 重建/ 校验/ 集合/ 为/ 处于/ “/ 均分/ ”/ 状态/ 下/ 的/ 重建/ 校验/ 集合/ ./ 单盘/ 失效/ 情况/ 下/ ,/ 为/ 使/ 从/ 磁盘/ 读取/ 的/ 用以/ 重建/ 的/ 数据量/ R/ 尽可能/ 最小/ ,/ 重建/ 时/ 采用/ 的/ 校验/ 集合/ 是/ B3n/ +/ v/ ,/ v/ ,/ 其中/ v/ =/ 0/ 、/ 1/ 或/ 2/ ,/ 0/ / 3n/ +/ v/ / p/ -/ 2/ ./ 我们/ 选取/ 的/ 校验/ 集合/ 中/ ,/ 任意/ 一个/ 对角线/ 校验/ 组和/ 任意/ 一个/ 反/ 对角线/ 校验/ 组均/ 不/ 满足/ 式/ (/ 3/ )/ ,/ 所以/ 不/ 存在/ 虚拟/ 公共/ 块/ ./ 接下来/ 分析/ 采用/ 3/ 类/ 校验/ 集合/ 重建/ 时/ ,/ R/ 的/ 值/ 是否/ 可以/ 确定/ 下来/ ./ 若/ 3/ 个/ 校验/ 集合/ B3n/ ,/ 0/ ,/ B3m/ +/ 1/ ,/ 1/ ,/ B3l/ +/ 2/ ,/ 2/ 在/ 第/ y/ 列有/ 个/ 公共/ 块/ ,/ 由式/ (/ 1/ )/ 和/ (/ 2/ )/ 得出/ ,/ 3n/ ≡/ 3m/ +/ 1/ -/ y/ ≡/ 3l/ +/ 2/ +/ y/ (/ modp/ )/ ./ 因此/ ,/ 2y/ ≡/ 6/ (/ m/ -/ n/ )/ +/ 2/ ≡/ 3/ (/ m/ -/ l/ )/ -/ 1/ (/ modp/ )/ ,/ 继续/ 推导/ 出/ n/ -/ l/ ≡/ m/ -/ n/ +/ 1/ (/ modp/ )/ ./ 由于/ 0/ / m/ ,/ n/ ,/ l/ </ p/ // 3/ / -/ p/ // 3/ </ n/ -/ l/ ,/ m/ -/ n/ </ p/ ,/ 则/ n/ -/ l/ =/ m/ -/ n/ +/ 1/ / 2n/ =/ m/ +/ l/ +/ 1/ ,/ 且/ m/ +/ l/ 的/ 和/ 必须/ 是/ 奇数/ ./ 若/ m/ 的/ 值/ 固定/ ,/ 令/ K/ =/ p/ -/ 13/ ./ 则/ (/ m/ ,/ n/ ,/ l/ )/ 的/ 取值/ 有/ 两种/ 情况/ :/ (/ 1/ )/ 0/ / m/ </ n/ / l/ / K/ ,/ (/ 2/ )/ 0/ / l/ </ n/ / m/ / K/ ./ 若/ 0/ / m/ </ n/ / l/ / K/ ,/ 满足/ 2n/ =/ m/ +/ l/ +/ 1/ 的/ (/ n/ ,/ l/ )/ 对/ 的/ 个数/ 不/ 大于/ (/ K/ -/ m/ -/ 1/ )/ // 2/ +/ 1/ ;/ 若/ 0/ / l/ </ n/ / m/ / K/ ,/ 满足/ 2n/ =/ m/ +/ l/ +/ 1/ 的/ (/ n/ ,/ l/ )/ 对/ 的/ 个数/ 不/ 大于/ (/ m/ +/ 1/ )/ // 2/ ./ 因此/ ,/ 满足/ 等式/ 2n/ =/ m/ +/ l/ +/ 1/ 的/ (/ n/ ,/ m/ ,/ l/ )/ 取值/ 的/ 个数/ 为/ / / ∑/ K/ 由式/ (/ 5/ )/ 知/ ,/ / 的/ 取值/ 只/ 跟/ p/ 的/ 取值/ 有关/ ./ 且/ 有/ 单/ 节点/ 故障/ 情况/ 下/ ,/ 重建/ 单条/ 带/ 需/ 从/ 磁盘/ 读取/ 的/ 数据量/ R/ 满足/ 以下/ 公式/ :/ R/ =/ (/ p/ -/ 1/ )/ (/ p/ -/ 1/ )/ -/ (/ α/ β/ +/ α/ γ/ +/ β/ γ/ -/ / )/ </ (/ p/ -/ 1/ )/ 2/ -/ (/ K2/ +/ K2/ +/ K2/ )/ +/ 1/ </ 1318p2/ +/ 31/ 其中/ (/ p/ -/ 4/ )/ // 3/ </ K/ / (/ p/ -/ 1/ )/ // 3/ ./ 传统/ 方法/ 中/ ,/ 仅仅/ 使用/ 一类/ 校验/ 组来/ 重建/ 单条/ 带中/ 的/ 失效/ 的/ 数据/ 条带/ 单元/ 时/ ,/ 从/ 磁盘/ 读取/ 的/ 数据量/ 是/ N/ =/ (/ p/ -/ 1/ )/ 2/ 个/ 元素/ ;/ 由式/ (/ 4/ )/ 和/ (/ 6/ )/ 知/ ,/ 若/ 使用/ 3/ 类/ 校验/ 组且/ 每种/ 类型/ 的/ 校验/ 组/ 个数/ 彼此/ 接近/ 时/ ,/ R/ 的/ 取值/ 介于/ Rlow/ =/ 2N/ // 3/ 和/ Rhigh/ =/ 13N/ // 18/ 之间/ ,/ 与/ 传统/ 方法/ 相比/ 降低/ 了/ 27.8/ %/ ~/ 33.3/ %/ ./ 事实上/ ,/ 虽然/ 从/ 磁盘/ 读取/ 的/ 数据量/ 的/ 最小值/ R/ 不能/ 直接/ 确定/ ,/ 但/ 由于/ m/ =/ 0Rhigh/ 相对/ Rlow/ 增长/ 了/ 8.33/ %/ ,/ 取/ 增长率/ 的/ 平均值/ w/ =/ 4.2/ %/ 来/ 确定/ R/ 的/ 平均值/ Ravg/ ,/ 以此/ 作为/ 在/ 单条/ 带/ 的/ 单/ 节点/ 快速/ 重建/ 情况/ 下/ ,/ 从/ 磁盘/ 读取/ 的/ 数据量/ 的/ 最优/ 解/ ./ 在/ 容/ 三盘/ 纠/ 删码/ 存储系统/ 中/ 单盘/ 失效/ 的/ Page6/ 情况/ 下/ ,/ 同时/ 使用/ 行/ 校验/ 组/ ,/ 对角线/ 校验/ 组和反/ 对角线/ 校验/ 组/ 3/ 类/ 校验/ 组/ 进行/ 重建/ ,/ 且/ 3/ 类/ 校验/ 组/ 的/ 个数/ 彼此/ 接近/ ,/ 这是/ 均分/ 机制/ 方法/ 的/ 基础/ ,/ 也/ 是/ 核心/ ./ 由于/ 重建/ 校验/ 集合/ 处于/ “/ 均分/ ”/ 状态/ 是/ 该/ 重建/ 校验/ 集合/ 是/ 最佳/ 重建/ 校验/ 集合/ 的/ 必要/ 不/ 充分条件/ ,/ 因为/ 有些/ 均分/ 校验/ 集合/ 不能/ 完全/ 覆盖/ 所有/ 失效/ 的/ 数据/ 元素/ 而/ 不足以/ 用来/ 重建/ ./ 在/ 提出/ 均分/ 机制/ 方法/ 的/ 具体/ 算法/ 之前/ ,/ 首先/ 探讨/ 失效/ 的/ 数据/ 元素/ 被/ 哪几种/ 校验/ 组/ 覆盖/ ./ 在/ 一个/ (/ p/ -/ 1/ )/ ×/ (/ p/ +/ 2/ )/ 的/ TP/ 编码/ 的/ 条带/ 中/ ,/ 假设/ 第/ k/ (/ 0/ / k/ / p/ -/ 2/ )/ 列/ 的/ 条带/ 单元/ 失效/ ,/ 其/ 包含/ 的/ p/ -/ 1/ 个/ 数据/ 元素/ Di/ ,/ k/ (/ 0/ / i/ / p/ -/ 2/ )/ 需要/ 恢复/ ./ 定义/ 重建/ 校验/ 集合/ π/ =/ {/ xi/ |/ 0/ / i/ / p/ -/ 2/ ,/ xi/ =/ 0/ ,/ 1or2/ }/ 描述/ 重建/ 方案/ ,/ xi/ 表示/ 在/ 重建/ 失效/ 的/ 条带/ 单元/ 所/ 包含/ 的/ 第/ i/ 行/ 数据/ 元素/ 时/ ,/ 需要/ 使用/ 该/ 数据/ 元素/ 所在/ 的/ 何种/ 类型/ 的/ 校验/ 组/ ./ 若/ xi/ 分别/ 取值/ 0/ 、/ 1/ 和/ 2/ ,/ 则/ 分别/ 代表/ 需/ 使用/ 该/ 数据/ 元素/ 所在/ 的/ 行/ 校验/ 组/ ,/ 对角线/ 校验/ 组和反/ 对角线/ 校验/ 组/ 恢复/ 该/ 数据/ 元素/ 的/ 数据/ ./ 引理/ 1/ ./ (/ 1/ )/ 若/ i/ =/ p/ -/ 1/ -/ k/ ,/ 失效/ 的/ 数据/ 元素/ Di/ ,/ k/ 可以/ 使用/ 其/ 所在/ 的/ 行/ 校验/ 组/ Bi/ ,/ 0/ 和/ 其/ 所在/ 的/ 反/ 对角线/ 校验/ 组/ B/ 〈/ i/ -/ k/ 〉/ ,/ 2/ 恢复/ 失效/ 数据/ ./ (/ 2/ )/ 若/ i/ =/ 〈/ k/ -/ 1/ 〉/ ,/ 失效/ 的/ 数据/ 元素/ Di/ ,/ k/ 可以/ 使用/ 其/ 所在/ 的/ 行/ 校验/ 组/ Bi/ ,/ 0/ 和/ 对角线/ 校验/ 组/ B/ 〈/ i/ +/ k/ 〉/ ,/ 1/ 恢复/ 失效/ 数据/ ./ (/ 3/ )/ 若/ i/ ≠/ p/ -/ 1/ -/ kandi/ ≠/ 〈/ k/ -/ 1/ 〉/ ,/ 失效/ 的/ 数据/ 元素/ Di/ ,/ k/ 可以/ 使用/ 其/ 所在/ 的/ 行/ 校验/ 组/ Bi/ ,/ 0/ ,/ 对角线/ 校验/ 组/ B/ 〈/ i/ +/ k/ 〉/ ,/ 1/ 和/ 反/ 对角线/ 校验/ 组/ B/ 〈/ i/ -/ k/ 〉/ ,/ 2/ 任意/ 一种/ 恢复/ 失效/ 数据/ ./ 情况/ (/ 1/ )/ 和/ 情况/ (/ 2/ )/ 的/ 存在/ 是/ 由于/ 这些/ 失效/ 数据/ 元素/ 正好/ 位于/ 不/ 参与/ 计算/ 校验/ 的/ 缺失/ 对角线/ 或/ 缺失/ 反/ 对角线/ 上/ ,/ 这些/ 数据/ 元素/ 只/ 参与/ 计算/ 到/ 两种/ 类型/ 的/ 校验/ 组中/ ,/ 受/ 两个/ 校验/ 组/ 的/ 保护/ ./ 情况/ (/ 3/ )/ 是/ 大多数/ 情况/ ,/ 这些/ 数据/ 元素/ 参与/ 计算/ 3/ 种/ 类型/ 的/ 校验/ 组而受/ 3/ 种/ 校验/ 组/ 的/ 保护/ ./ 对/ 单一/ 条带/ 的/ (/ p/ -/ 1/ )/ 个/ 数据/ 条带/ 单元/ 而言/ ,/ 除/ 第/ 0/ 列/ 的/ 条带/ 单元/ 的/ 所有/ 数据/ 元素/ 均/ 受/ 3/ 个/ 校验/ 组/ 保护/ ,/ 其余/ 列/ 的/ 条带/ 单元/ 均会/ 有且/ 仅/ 有/ 两个/ 数据/ 元素/ 分别/ 满足/ 情况/ (/ 1/ )/ 和/ 情况/ (/ 2/ )/ 的/ 情况/ ,/ 其余/ (/ p/ -/ 3/ )/ 个/ 数据/ 元素/ 满足/ 情况/ (/ 3/ )/ 而/ 受到/ 3/ 种/ 校验/ 组/ 的/ 保护/ ./ 下面/ 依据/ 引理/ 1/ 举例/ 验证/ 校验/ 组/ 的/ 可行性/ ./ 假设/ 图/ 1/ 表示/ 的/ 存储系统/ 中/ 编号/ 为/ k/ =/ 1/ 的/ 磁盘/ 因/ 软硬件/ 故障/ 而/ 失效/ ,/ 反映/ 到/ 图/ 1/ 为/ 编号/ 为/ D1/ 的/ 条带/ 单元/ 失效/ ,/ 有/ D0/ ,/ 1/ 、/ D1/ ,/ 1/ 、/ D2/ ,/ 1/ 、/ D3/ ,/ 14/ 个/ 数据/ 元素/ 需要/ 恢复/ ./ D0/ ,/ 1/ 由于/ i/ =/ 0/ =/ 〈/ k/ -/ 1/ 〉/ ,/ 根据/ 情况/ (/ 2/ )/ 只能/ 通过/ 行/ 校验/ 组/ B0/ ,/ 0/ 和/ 对角线/ 校验/ 组/ B1/ ,/ 1/ 恢复/ ,/ 在/ 重建/ 方案/ 中/ x0/ =/ 0/ 或/ x0/ =/ 1/ ;/ D1/ ,/ 1/ 和/ D2/ ,/ 1/ 符合/ 情况/ (/ 3/ )/ ,/ 均/ 能/ 通过/ 3/ 种/ 校验/ 组/ 恢复/ ,/ 它们/ 分别/ 是/ B1/ ,/ 0/ 、/ B2/ ,/ 1/ 、/ B0/ ,/ 2/ 恢复/ D1/ ,/ 1/ 和/ B2/ ,/ 0/ 、/ B3/ ,/ 1/ 、/ B1/ ,/ 2/ 恢复/ D2/ ,/ 1/ ,/ 在/ 重建/ 方案/ 中/ x1/ 和/ x2/ 的/ 值/ 均/ 可取/ 0/ 、/ 1/ 或/ 2/ 中/ 任意/ 一个/ ;/ D3/ ,/ 1/ 由于/ i/ =/ p/ -/ 1/ -/ k/ ,/ 根据/ 情况/ (/ 1/ )/ 只能/ 通过/ 行/ 校验/ 组/ B3/ ,/ 0/ 和/ 反/ 对角线/ 校验/ 组/ B2/ ,/ 2/ 恢复/ ,/ 在/ 重建/ 方案/ 中/ x3/ =/ 0/ 或/ x3/ =/ 2/ ./ 给出/ 一条/ 重建/ 校验/ 集合/ π/ 0/ =/ {/ 2001/ }/ ,/ 尽管/ π/ 0/ 处于/ “/ 均分/ ”/ 状态/ ,/ 但/ 基于/ 引理/ 的/ 分析/ ,/ π/ 0/ 是非/ 可行/ 的/ ,/ 不足以/ 重建/ 失效/ 条带/ 单元/ 中/ 的/ 所有/ 元素/ ,/ 因此/ 该/ 集合/ 绝非/ 最佳/ 重建/ 方案/ ./ 若/ 重建/ 校验/ 集合/ 处于/ “/ 均分/ ”/ 状态/ 且/ 可行/ 并且/ 依据/ 该/ 校验/ 集合/ 从/ 磁盘/ 读取/ 的/ 数据量/ 等于/ Ravg/ ,/ 则/ 该/ 校验/ 集合/ 是/ 最佳/ 重建/ 校验/ 集合/ ./ 算法/ 1/ 给出/ 求解/ 最佳/ 重建/ 校验/ 集合/ 的/ 算法/ ./ 算法/ 1/ ./ 均分/ 机制/ 方法/ (/ EDS/ )/ ./ 输入/ :/ 素数/ p/ ,/ 失效节点/ 的/ 编号/ k/ 输出/ :/ 最佳/ 重建/ 校验/ 组/ 1/ ./ InitializeN/ =/ 3p/ -/ 1/ ,/ sign/ =/ true2/ ./ step/ :/ 3/ ./ FORi/ =/ 0toN4/ ./ // / 计算/ 重建/ 校验/ 组/ S/ / // 5/ ./ convertiintoanintegersequenceS6/ ./ // / 检验/ 重建/ 校验/ 组/ S/ 是否/ 处于/ “/ 均分/ ”/ 状态/ 且/ 可行/ / // 7/ ./ IFFilter/ (/ S/ ,/ k/ )/ =/ =/ falseTHEN8/ ./ GOTOstep9/ ./ ENDIF10/ ./ // / 计算/ 重建/ 校验/ 组/ S/ 需要/ 从/ 磁盘/ 读取/ 的/ 元素/ 的/ 个/ 11/ ./ computeR/ =/ numberofelementreadsforS/ ;/ 12/ ./ // / 检验/ R/ 是否/ 小于/ 等于/ 最优/ 解/ Ropt/ / // 13/ ./ IFR/ </ =/ RoptTHEN14/ ./ RETURNS/ ;/ 15/ ./ ELSE16/ ./ GOTOstep/ ;/ 17/ ./ ENDFOR/ ./ 4/ 性能/ 评估/ 本/ 节/ 首先/ 实现/ 了/ TP/ 编码/ 单盘/ 失效/ 重建/ 的/ 均分/ 机制/ 方法/ 、/ 枚举法/ 和/ 传统/ 法/ ,/ 并/ 对/ 均分/ 机制/ 方法/ 和/ 枚举法/ 在/ 搜索/ 到/ 最优/ 重建/ 校验/ 集合/ 过程/ 中/ 所/ 消耗/ 的/ 时间/ 和/ 各自/ 最优/ 重建/ 校验/ 集合/ 在/ 重建/ 时/ 从/ 磁盘/ 读取/ 的/ 元素/ 数目/ 进行/ 对比/ ./ 实验/ 还/ 对比/ 了/ 均分/ 机制/ 方法/ 和/ Page7/ 传统/ 法从/ 磁盘/ 读取/ 的/ 元素/ 数目/ 的/ 差异/ ,/ 并/ 与/ 理论/ 分析/ 的/ 最小值/ 进行/ 对比/ ./ 为了/ 证明/ 均分/ 机制/ 方法/ 的/ 有效性/ ,/ 即/ 它/ 能/ 通过/ 减少/ 重建/ 过程/ 中/ 元素/ 的/ 读取/ 数目/ ,/ 减少/ 磁盘/ 读数据/ 量/ ,/ 而/ 减少/ 重建/ 过程/ 的/ 总/ 时间/ ,/ 实验/ 对比/ 测试/ 了/ 均分/ 机制/ 方法/ 和/ 传统/ 方法/ 在/ 重建/ 相同/ 数量/ 的/ 数据/ 情况/ 下/ 所/ 花费/ 的/ 时间/ ./ 为了/ 验证/ 算法/ 适用性/ ,/ 同时/ 对/ TP/ 编码/ 和/ STAR/ 编码/ 进行/ 测试/ ,/ 并/ 测试/ 在/ 不同/ 大小/ 的/ 条带/ 单元/ 和/ 不同/ 个数/ 的/ 磁盘/ 数目/ 时/ 的/ 重建/ 时间/ ./ 另外/ ,/ 为了/ 验证/ 均分/ 机制/ 方法/ 对/ 在线/ 重建/ 的/ 适用性/ ,/ 实验/ 测试/ 了/ TP/ 编码/ 和/ STAR/ 编码/ 在/ 不同/ 负载/ 下/ 的/ 重建/ 时间/ ./ 实验/ 选取/ 了/ 来自/ 多个/ 国际/ 企业/ 数据中心/ 的/ 5/ 种/ 工作/ 负载/ ①/ :/ financial1/ (/ fin1/ )/ ,/ financial2/ (/ fin2/ )/ ,/ websearch1/ (/ web1/ )/ ,/ websearch2/ (/ web2/ )/ ,/ web/ -/ search3/ (/ web3/ )/ ./ 两个/ financial/ 的/ I/ // Otrace/ 来自/ 于/ 两个/ 大型/ 财务/ 公司/ 的/ 在线/ 交易/ 处理软件/ ,/ 3/ 个/ websearch/ 的/ I/ // Otrace/ 来自/ 于/ 一个/ 广泛应用/ 的/ 搜索引擎/ ./ 这些/ trace/ 被/ 广泛应用/ 于/ 各项/ 研究/ [/ 16/ -/ 17/ ]/ ./ 4.1/ 实验/ 设置/ 及/ 测试方法/ 搜索/ 性能/ 评估/ 和/ 重建/ 数据量/ 评估/ 实验/ 在/ 配置/ 为/ IntelXeonE56202/ ./ 4GHzCPU/ 和/ 4GBRAM/ 的/ Linux/ 服务器上进行/ ./ DiskSim/ [/ 18/ ]/ 是/ 卡耐基/ 梅隆/ 大学/ 研发/ 的/ 磁盘/ 系统/ 模拟器/ ,/ 广泛应用/ 于/ 存储系统/ 结构/ 的/ 各项/ 研究/ 中/ ./ 本节/ 中/ 重建/ 性能/ 评估/ 用/ DiskSim/ 模拟/ 磁盘/ 访问/ ,/ 所/ 模拟/ 的/ 磁盘/ 规格/ 为/ 15000/ -/ RPM/ 的/ SeagateCheetah/ ,/ 容量/ 146GB/ ./ 测试/ TP/ 编码/ 时/ ,/ 使用/ (/ p/ +/ 2/ )/ 个/ 磁盘/ ;/ 测试/ STAR/ 编码/ 时/ ,/ 使用/ (/ p/ +/ 3/ )/ 个/ 磁盘/ ./ 重建/ 过程/ 是/ 在/ 离线/ 模式/ 下/ 进行/ ,/ 即/ 在/ 重建/ 过程/ 中/ 没有/ 来自/ 前端/ 访问/ 的/ 请求/ ./ 磁盘/ 上/ 的/ 所有/ 数据/ 根据/ 相应/ 的/ 编码/ 规则/ 条带/ 化/ 存放/ 于/ 各个/ 磁盘/ ./ 在/ 衡量/ 重建/ 性能/ 时/ ,/ 我们/ 以/ 重建/ 每/ MB/ 数据/ 所/ 消耗/ 的/ 时间/ 作为/ 标准/ ./ 测试方法/ 如下/ :/ 首先/ 将/ TP/ 编码/ 和/ STAR/ 编码/ 的/ 均分/ 机制/ 方法/ 和/ 传统/ 方法/ 均/ 实现/ 到/ DiskSim/ 环境/ 中/ ;/ 重建/ 每个/ 条带/ 时/ ,/ 内存/ 一旦/ 计算/ 完毕/ 失效/ 条带/ 单元/ 的/ 数据/ ,/ 便/ 立即/ 将/ 它们/ 写入/ 备份/ 的/ 数据/ 盘/ ./ 为了/ 确保/ 实验/ 结果/ 的/ 可信性/ ,/ 获得/ 每个/ 重建/ 时间/ 均/ 执行/ 4/ 次/ 程序/ ,/ 每次/ 均/ 在/ 所有/ 数据/ 磁盘/ 上/ 执行/ 一遍/ ,/ 即/ 假定/ 所有/ 数据/ 盘/ 失效/ 的/ 概率/ 是/ 相等/ 的/ ./ 例如/ TP/ 编码/ (/ p/ =/ 7/ )/ ,/ 一共/ 有/ 6/ 个/ 数据/ 磁盘/ ,/ 在/ 求取/ 单盘/ 失效/ 的/ 重建/ 时间/ 时/ ,/ 一共/ 执行/ 了/ 4/ ×/ 6/ 次/ 操作/ ,/ 然后/ 在/ 24/ 次/ 结果/ 上取/ 平均/ 作为/ 最终/ 结果/ ./ 实验/ 过程/ 中/ ,/ 我们/ 假定/ 每个/ 元素/ 由/ 一个/ 数据/ 块/ 构成/ ,/ 且/ 数据/ 块/ 的/ 大小/ 通常/ 会/ 较大/ ./ 这是/ 由于/ 现代/ 的/ 分布式系统/ 中/ 往往/ 对大/ 数据/ 块/ 进行/ 操作/ ,/ 例如/ GFS/ [/ 19/ ]/ 使用/ 数据/ 块/ 的/ 大小/ 是/ 64MB/ ./ 4.4/ 节将/ 描述/ 数据/ 块/ 的/ 大小/ 对/ 重建/ 性能/ 的/ 影响/ ./ 4.2/ 搜索/ 性能/ 评估/ 本文/ 针对/ 均分/ 机制/ 方法/ 和/ 枚举法/ 返回/ 最佳/ 重建/ 序列/ 的/ 搜索/ 时间/ 进行/ 测试/ ,/ 结果/ 如表/ 1/ 所示/ ./ 枚举法/ 无法/ 预先/ 锁定/ 最佳/ 重建/ 校验/ 集合/ 所处/ 的/ 状态/ ,/ 随着/ p/ 的/ 增长/ ,/ 重建/ 方程/ 的/ 数目/ 爆炸式/ 增长/ 且/ 枚举法/ 需要/ 枚举/ 出/ 所有/ 重建/ 方程/ 的/ 组合/ 才能/ 确定/ 下来/ 最优/ 的/ 组合/ ,/ 导致/ 搜索/ 时间/ 指数/ 攀升/ ./ 均分/ 机制/ 方法/ 预先/ 将/ 最佳/ 重建/ 数组/ 锁定/ 在/ 处于/ 均分/ 状态/ 且/ 可行/ ,/ 且/ 由于/ 从/ 磁盘/ 读取/ 的/ 最佳/ 数据量/ 已/ 确定/ ,/ 当/ 符合/ 以上/ 条件/ 的/ 重建/ 校验/ 集合/ 出现/ 时/ 立即/ 停止/ 搜索/ ,/ 作为/ 最佳/ 重建/ 校验/ 集合/ 返回/ ./ 与/ 枚举法/ 相比/ ,/ 均分/ 机制/ 方法/ 的/ 搜索/ 时间/ 大大减少/ ./ 当/ p/ / 17/ 时/ ,/ 枚举法/ 的/ 搜索/ 时间/ 较/ 短/ ;/ 当/ p/ =/ 19/ 时/ ,/ 枚举法/ 需要/ 花费/ 超过/ 18min/ 的/ 时间/ 找到/ 最佳/ 的/ 重建/ 数组/ ;/ 当/ p/ =/ 23/ 时/ ,/ 搜索/ 时间/ 接近/ 2/ 天/ 3/ 个/ 小时/ ./ 当/ p/ / 23/ 时/ ,/ 搜索/ 到/ 最佳/ 重建/ 数组/ 所/ 花费/ 的/ 时间/ 最多/ 不/ 超过/ 5s/ ,/ 大部分/ 是/ ms/ 数量级/ ./ p/ 时间/ (/ Enumeration/ )/ 时间/ (/ EDS/ )/ 5711131719234.3/ 重建/ 数据量/ 评估/ 首先/ 使用/ 仿真/ 实验/ 比较/ 重建/ 时/ 分别/ 使用/ 传统/ 方法/ ,/ 均分/ 机制/ 方法/ 从/ 磁盘/ 读取数据/ 量/ ,/ 并/ 与/ 数据量/ 的/ 下界/ 对比/ ,/ 结果/ 如图/ 3/ 所示/ ./ 当/ p/ </ 40/ 时/ ,/ 均分/ 机制/ 方法/ 所/ 需/ 的/ 数据量/ 与/ 下界/ 十分/ 逼近/ ./ 图/ 3TP/ 编码/ 单条/ 带/ 重建/ 时/ 所/ 需/ 从/ 磁盘/ 读取/ 的/ 元素/ 的/ 数目/ ①/ http/ :/ // // traces/ ./ cs/ ./ umass/ ./ edu/ // index/ ./ php/ // Storage/ // StoragePage8/ 为了/ 验证/ 均分/ 机制/ 方法/ 的/ 有效性/ ,/ 我们/ 也/ 评估/ 了/ 枚举法/ 与/ 传统/ 方法/ 相比/ 的/ 节省/ 量/ ,/ 实验/ 结果/ 如图/ 4/ 所示/ ./ 当/ p/ =/ 5/ 和/ p/ =/ 11/ 时/ ,/ 均分/ 机制/ 方法/ 的/ 表现/ 和/ 枚举法/ 一样/ 优/ ,/ 均/ 能/ 达到最佳/ 重建/ 数组/ ./ 当/ p/ 取/ 其它/ 值时/ ,/ 均分/ 机制/ 方法/ 达到/ 次优/ 解/ ,/ 但/ 与/ 枚举法/ 的/ 最优/ 解/ 的/ 差异/ 仅/ 在/ 0.7/ %/ ~/ 2.8/ %/ 之间/ ./ 与/ 传统/ 方法/ 相比/ 时/ ,/ 均分/ 机制/ 方法/ 节省/ 了/ 25/ %/ ~/ 30.6/ %/ 的/ 元素/ 读取/ 量/ ;/ 枚举法/ 节省/ 了/ 25/ %/ ~/ 31.5/ %/ 的/ 元素/ 读取/ 量/ ./ 若/ 系统/ 中/ 单个/ 节点/ 的/ 容量/ 是/ 1TB/ ,/ 共有/ 13/ 个/ 磁盘/ (/ p/ =/ 11/ )/ ,/ 其中/ 有/ 10/ 个/ 数据/ 盘/ ./ 单/ 节点/ 失效/ 重建/ 时/ ,/ 采用/ 传统/ 方法/ 从/ 磁盘/ 读取数据/ 共/ 10TB/ ,/ 而/ 采用/ 均分/ 机制/ 方法/ 从/ 磁盘/ 读取数据/ 只/ 需/ 6.9/ TB/ ./ 目前/ 磁盘/ I/ // O/ 速度/ 为/ 100MB/ // s/ ,/ 为了/ 不/ 影响/ 前台/ 服务/ ,/ 重建/ 速度/ 配置/ 为/ 30MB/ // s/ 时/ ,/ 采用/ 均分/ 机制/ 方法/ 重建/ 可/ 因少/ 读取/ 3.1/ TB/ 的/ 数据/ 使得/ 重建/ 时间/ 减少/ 2.87/ h/ (/ 3.1/ ×/ 106/ // (/ 10/ ×/ 30/ ×/ 3600/ )/ )/ ,/ 这里/ 假设/ 读/ 磁盘/ 的/ 过程/ 为/ 并发/ 多线程/ 读/ ,/ 且/ 所有/ 磁盘/ 读/ 的/ 时间/ 相等/ ./ 均分/ 机制/ 方法/ 使得/ 从/ 磁盘/ 读取/ 的/ 数据量/ 大幅/ 减少/ ,/ 加速/ 了/ 重建/ 过程/ ,/ 大大提高/ 了/ 重建/ 性能/ ./ 图/ 4TP/ 枚举法/ 和/ 均分/ 法/ 重建/ 时/ 所/ 需/ 元素/ 的/ 数目/ 使用/ STAR/ 编码/ 的/ 存储系统/ 在/ 单/ 节点/ 失效/ 时/ ,/ 也/ 可/ 采用/ 均分/ 机制/ 方法/ 进行/ 最优/ 重建/ 校验/ 集合/ 的/ 查找/ ./ 我们/ 也/ 评估/ 了/ STAR/ 编码/ 分别/ 使用/ 均分/ 机制/ 方法/ 和/ 枚举法/ 的/ 重建/ 性能/ ,/ 并/ 与/ 传统/ 法/ 进行/ 比较/ ,/ 结果/ 如图/ 5/ 所示/ ./ 总体/ 来看/ ,/ 均分/ 机制/ 方法/ 和/ 枚举法/ 的/ 表现/ 非常/ 接近/ ,/ 按照/ 两者/ 寻找/ 到/ 的/ 最佳/ 重建/ 数组/ 重建/ 时/ 从/ 磁盘/ 读取/ 的/ 数据量/ (/ 每/ 条带/ )/ 与/ 传统/ 法比/ 分别/ 节约/ 30/ %/ ~/ 33.64/ %/ 和/ 33.33/ %/ ~/ 35.71/ %/ ./ 如图/ 5/ ,/ p/ =/ 7/ 时/ ,/ 虽然/ 均分/ 机制/ 方法/ 节省/ 的/ 百分比/ 相较/ 于/ 枚举法/ 少/ 5/ %/ ,/ 但/ 事实上/ 两者/ 的/ 最优/ 重建/ 数组/ 所/ 需/ 的/ 数据量/ 仅仅/ 相差/ 1/ ./ 当/ p/ 越大时/ ,/ 均分/ 机制/ 方法/ 的/ 表现/ 越/ 趋于/ 枚举法/ ,/ 能/ 找到/ 全局/ 最优/ 的/ 重建/ 校验/ 集合/ ./ 图/ 5STAR/ 枚举法/ 和/ 均分/ 法/ 重建/ 时/ 所/ 需/ 元素/ 的/ 数目/ 4.4/ 重建/ 性能/ 评估/ 实验/ 1/ ./ 数据/ 块/ 的/ 大小/ 对/ 性能/ 的/ 影响/ ./ 实验/ 时/ 我们/ 固定/ p/ 的/ 值/ ,/ 假定/ p/ 取值/ 分别/ 为/ 7/ 、/ 13/ 和/ 19/ ,/ 每个/ p/ 对应/ 一定/ 的/ 磁盘/ 数目/ ,/ 选取/ 不同/ 大小/ 的/ 数据/ 块/ ,/ 从/ 512KB/ 变化/ 到/ 8196KB/ ,/ 来/ 评估/ 数据/ 块/ 的/ 大小/ 对/ 重建/ 性能/ 的/ 影响/ ./ 图/ 6/ (/ a/ )/ 和/ (/ b/ )/ 分别/ 表示/ 使用/ 传统/ 方法/ 和/ 均分/ 机制/ 方法/ 重建/ 每/ MB/ 数据/ 所/ 消耗/ 的/ 时间/ ,/ 实验/ 结果表明/ 数据/ 块/ 大小/ 在/ 512KB/ 到/ 8192KB/ 间/ 变化/ 时/ ,/ 均分/ 机制/ 方法/ 均/ 优于/ 传统/ 方法/ ,/ 即/ 重建/ 相同/ 的/ 数据/ 耗时/ 更/ 短/ ./ 当/ 数据/ 块/ 的/ 大小/ 增加/ 时/ ,/ 每/ MB/ 数据/ 的/ 重建/ 时间/ 会/ 减少/ ,/ 并且/ 减少/ 的/ 速率/ 随着/ 数据/ 块/ 的/ 增加/ 而/ 变缓/ ./ 因此/ 我们/ 预测/ 当/ 数据/ 块/ 的/ 大小/ 增加/ 到/ 一定/ 数值/ 时/ ,/ 每/ MB/ 数据/ 的/ 重建/ 时间/ 趋于/ 某一/ 稳定/ 值/ ./ 如图/ 6/ 所示/ ,/ TP/ 和/ STAR/ 的/ 传统/ 方法/ 和/ 均分/ 机制/ 方法/ 均/ 符合/ 上述/ 趋势/ ./ 实验/ 2/ ./ 磁盘/ 个数/ 对/ 重建/ 性能/ 的/ 影响/ ./ 我们/ 分别/ 测试/ 了/ TP/ 和/ STAR/ 在/ 不同/ p/ 对应/ 的/ 磁盘/ 个数/ 下/ 的/ 重建/ 性能/ ./ 实验/ 时/ 我们/ 固定/ 数据/ 块/ 的/ 大小/ ,/ 假定/ 数据/ 块/ 大小/ 取值/ 分别/ 为/ 512KB/ 、/ 1024KB/ 和/ 2048KB/ ,/ 选取/ 不同/ 的/ 素数/ p/ ,/ 依次/ 为/ 7/ 、/ 11/ 、/ 13/ 、/ 17/ 和/ 19/ ,/ 来/ 评估/ 磁盘/ 个数/ 对/ 重建/ 性能/ 的/ 影响/ ,/ 实验/ 结果/ 如图/ 7/ 所示/ ./ 对/ TP/ 编码/ 和/ STAR/ 编码/ 来说/ ,/ 与/ 传统/ 方法/ 相比/ ,/ 均分/ 机制/ 方法/ 均/ 减少/ 了/ 每/ MB/ 数据/ 的/ 重建/ 时间/ ,/ 这是/ 由于/ 均分/ 机制/ 方法/ 能/ 显著/ 减少/ 重建/ 过程/ 中/ 从/ 磁盘/ 读取/ 的/ 数据量/ ./ 以/ TP/ 编码/ 为例/ ,/ 数据/ 块/ 大小/ 为/ 512KB/ 时/ ,/ 每/ MB/ 数据/ 重建/ 时间/ 减少/ 6.00/ %/ ~/ 19.3/ %/ ;/ 数据/ 块/ 大小/ 为/ 1024KB/ 时/ ,/ 每/ MB/ 数据/ 重建/ 时间/ 减少/ 22.1/ %/ ~/ 27.3/ %/ ;/ 数据/ 块/ 大小/ 为/ 2048KB/ 时/ ,/ 每/ MB/ 数据/ 重建/ 时间/ 减少/ 24.5/ %/ ~/ 29.0/ %/ ./ 图/ 7/ (/ b/ )/ 表示/ STAR/ 编码/ 的/ 测试/ 结果/ ,/ 使用/ 均分/ 机制/ 方法/ 重建/ 时/ 每/ MB/ 数据/ 的/ 重建/ 时间/ 明显/ 减少/ ,/ 说明/ 均分/ 机制/ 方法/ 对/ STAR/ 编码/ 同样/ 适用/ ./ Page9/ 图/ 6/ 数据/ 块/ 的/ 大小/ 对/ 重建/ 性能/ 的/ 影响/ 图/ 7/ 磁盘/ 个数/ 对/ 重建/ 性能/ 的/ 影响/ Page104/ ./ 3/ 节/ 显示/ TP/ 编码/ 减少/ 25/ %/ ~/ 30.6/ %/ 的/ 读数据/ 量/ ,/ STAR/ 编码/ 减少/ 30/ %/ ~/ 33.64/ %/ 的/ 读数据/ 量/ ,/ 但/ 在/ 4.4/ 节/ 的/ 实验/ 1/ 和/ 实验/ 2/ 中/ ,/ 读数据/ 量减少/ 的/ 百分比/ 没有/ 完全/ 转化/ 为/ 重建/ 时间/ 减少/ 的/ 百分比/ ,/ 这是/ 由于/ 均分/ 法/ 改变/ 了/ 磁盘/ 顺序/ 读/ 的/ 特性/ ,/ 使得/ 磁头/ 在/ 寻道/ 和/ 旋转/ 上/ 有/ 一定/ 的/ 延迟/ ./ 但/ 这种/ 影响/ 细微/ ,/ 尤其/ 数据/ 块/ 较大/ 时/ ./ 总之/ ,/ 重建/ 性能/ 评估/ 实验/ 说明/ 对图/ 8/ 不同/ 工作/ 负载/ 下/ 的/ 重建/ 性能/ 图/ 8/ (/ a/ )/ 表示/ TP/ 编码/ 的/ 在线/ 重建/ 性能/ ./ 离线/ 重建/ 时/ ,/ 重建/ 每/ MB/ 数据/ 均分/ 法比/ 传统/ 法/ 节省/ 了/ 26.2/ %/ 的/ 时间/ ;/ 在线/ 重建/ 时/ ,/ 对/ 所有/ 的/ trace/ 而言/ ,/ 重建/ 每/ MB/ 数据/ 均分/ 法/ 仍/ 比/ 传统/ 法/ 的/ 重建/ 速度/ 快/ ,/ 节省/ 27.4/ %/ ~/ 32.0/ %/ 的/ 时间/ ./ 从图/ 8/ (/ a/ )/ 看出/ ,/ 当/ 采取/ 传统/ 法/ 重建/ 时/ ,/ 在线/ 重建/ 速度/ 比/ 离线/ 重建/ 速度/ 要慢/ ,/ 这是/ 由于/ 在线/ 重建/ 时/ ,/ 重建/ I/ // O/ 和/ 前台/ 应用程序/ 的/ I/ // O/ 共同/ 竞争/ 磁盘/ 带宽/ ,/ 传统/ 方法/ 重建/ 时/ 从/ 磁盘/ 读取/ 的/ 数据量/ 大/ ,/ 因此/ 强烈/ 的/ 竞争/ 导致/ 重建/ 速度/ 明显/ 放缓/ ./ 而/ 采取/ 均分/ 法/ 重建/ 时/ ,/ 虽然/ 重建/ I/ // O/ 和/ 前台/ 应用程序/ 的/ I/ // O/ 也/ 会/ 竞争/ ,/ 但/ 由于/ 均分/ 法/ 大大减少/ 了/ 重建/ I/ // O/ 使得/ 竞争/ 激烈/ 程度/ 降低/ ,/ 因此/ 在线/ 重建/ 的/ 速度/ 减缓/ 程度/ 较/ 小/ ./ 图/ 8/ (/ b/ )/ 表示/ STAR/ 编码/ 的/ 测试/ 结果/ ,/ 使用/ 均分/ 法/ 在线/ 重建/ 仍能/ 明显/ 加速/ 重建/ 速度/ ,/ 说明/ 均分/ 法对/ STAR/ 编码/ 在线/ 重建/ 同样/ 适用/ ./ 5/ 结论/ 和/ 进一步/ 研究/ 本文/ 提出/ 了/ 一种/ 新型/ 的/ 均分/ 机制/ 方法/ ,/ 旨在/ 解决/ 容/ 三盘/ 失效/ 纠/ 删码/ 在/ 单盘/ 失效/ 时/ 快速/ 重建/ 的/ 问题/ ./ 该/ 方法/ 能/ 快速/ 地为/ TP/ 编码/ 和/ STAR/ 编码/ 等容/ 三盘/ 出错/ 纠/ 删码/ 寻找/ 到/ 最佳/ 重建/ 校验/ 组/ ,/ 从而/ 使得/ 重建/ 时/ 从/ 磁盘/ 上/ 读取/ 的/ 数据量/ 大大降低/ ./ 由于/ 磁盘/ TP/ 和/ STAR/ 而言/ ,/ 不同/ 的/ 数据/ 块/ 和/ 不同/ 的/ 磁盘/ 个数/ ,/ 在/ 重建/ 性能/ 上/ 均分/ 法均/ 优于/ 传统/ 方法/ ./ 实验/ 3/ ./ 在线/ 重建/ 性能/ 测试/ ./ 实验/ 时/ ,/ 我们/ 选取/ 元素/ 大小/ 为/ 1024KB/ 的/ TP/ (/ p/ =/ 13/ )/ 和/ STAR/ (/ p/ =/ 13/ )/ 做/ 代表/ 来/ 测试/ 每/ MB/ 数据/ 的/ 重建/ 时间/ ,/ 以此/ 衡量/ 在线/ 重建/ 的/ 性能/ ,/ 实验/ 结果/ 如图/ 8/ 所示/ ./ 读/ 在/ 重建/ 过程/ 占据/ 大部分/ 的/ 时间/ ,/ 最优/ 重建/ 校验/ 组/ 由于/ 大大减少/ 磁盘/ 读/ 的/ 时间/ ,/ 会/ 加速/ 重建/ 过程/ ./ 本文/ 首先/ 给出/ 满足/ 最优/ 重建/ 校验/ 组/ 的/ 充分/ 必要条件/ ,/ 即/ 处于/ 均分/ 状态/ 且/ 可行/ 且/ 从/ 磁盘/ 读取/ 的/ 数据量/ 最少/ ;/ 在/ 此基础/ 上/ 给出/ 均分/ 机制/ 方法/ 的/ 算法/ 步骤/ ./ 实验/ 表明/ ,/ 均分/ 机制/ 方法/ 能/ 返回/ 与/ 枚举法/ 相当/ 的/ 最佳/ 重建/ 校验/ 组/ ,/ 并且/ 与/ 枚举法/ 相比/ ,/ 搜寻/ 时间/ 大幅度/ 减少/ ./ 理论/ 分析表明/ ,/ 与/ 传统/ 方法/ 相比/ ,/ 均分/ 机制/ 方法/ 在/ 重建/ 读/ 磁盘/ 时/ 减少/ 了/ 27.8/ %/ ~/ 33.3/ %/ 的/ 数据量/ ./ 实验/ 表明/ 与/ 传统/ 方法/ 相比/ ,/ 均分/ 机制/ 方法/ 在/ 重建/ 时间/ 方面/ 有/ 明显/ 的/ 优势/ ./ 下/ 一步/ 工作/ 主要/ 包括/ 对/ 均分/ 机制/ 方法/ 处于/ 实际/ 系统/ 时/ 进行/ 重建/ 时间/ 的/ 评估/ ,/ 并/ 把/ 它/ 实现/ 到/ 分布式/ 存储系统/ 中/ 观察/ 性能/ ./ 我们/ 计划/ 做/ 更/ 多/ 实验/ ,/ 以便/ 更加/ 全面/ 和/ 合理/ 地/ 验证/ 均分/ 机制/ 方法/ 的/ 有效性/ ./ 

