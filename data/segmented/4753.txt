Page1/ 高阶/ 熵/ 压缩/ 的/ 全文/ 自/ 索引/ 霍红卫/ 陈晓阳/ 陈龙/ 刚于/ 强/ (/ 西安电子科技大学/ 计算机/ 学院/ 西安/ 710071/ )/ 摘要/ 大/ 数据/ 集/ 正在/ 以/ 前所未有/ 的/ 速度/ 产生/ ,/ 研制/ 大/ 数据/ 集/ 的/ 实用/ 压缩/ 全文/ 自/ 索引/ 是/ 目前/ 的/ 挑战/ 问题/ 之一/ ./ 该文/ 提出/ 了/ 一种/ 高阶/ 熵/ 压缩/ 的/ 全文/ 自/ 索引/ ./ 对于/ 长为/ n/ 的/ 文本/ T/ 以及/ 任意/ k/ / clog/ σ/ n/ -/ 1/ 和/ c/ </ 1/ ,/ 该/ 压缩/ 索引/ 占用/ 2nHk/ (/ T/ )/ +/ n/ +/ o/ (/ n/ )/ 位/ 的/ 空间/ ,/ 其中/ Hk/ (/ T/ )/ 表示/ 文本/ T/ 的/ k/ 阶/ 经验/ 熵/ ,/ σ/ 为/ 字符/ 表/ 的/ 大小/ ./ 此外/ ,/ 该/ 压缩/ 索引/ 可/ 在/ 线性/ 时间/ O/ (/ n/ )/ 内/ 构造/ ./ 在/ 此基础/ 上/ ,/ 该文/ 还/ 给出/ 了/ 上述/ 压缩/ 索引/ 的/ 一种/ 实用/ 改进/ ./ 这种/ 改进/ 引入/ 了/ 混合/ 编码方法/ ,/ 额外/ 的/ 空间/ 开销/ 为/ o/ (/ n/ )/ 位/ ./ 对于/ Pizza/ &/ ChiliCorpus/ 上/ 的/ 三类/ 典型/ 数据/ 的/ 实验/ 表明/ :/ 该文/ 的/ 压缩/ 索引/ 较之/ 主流/ 压缩/ 索引/ 在/ 压缩率/ 和/ 查询/ 时间/ 上/ 具有/ 显著/ 的/ 优势/ ./ 该文/ 所述/ 的/ 压缩/ 索引/ 软件/ 可/ 在/ GitHub/ 上/ 访问/ ./ 关键词/ 大/ 数据/ ;/ 压缩/ 索引/ ;/ 自/ 索引/ ;/ 高阶/ 熵/ ;/ 混合/ 编码/ 1/ 引言/ 大/ 数据/ 正以/ 前所未有/ 的/ 速度/ 产生/ ./ 现实/ 世界/ 的/ 数据源/ 如/ WWW/ 数据/ 、/ 社交/ 网络/ 、/ 基因组/ 数据/ 、/ 音乐/ Page2/ 传感/ 网和物/ 联网/ 的/ 蓬勃发展/ 是/ 大/ 数据/ 的/ 又/ 一/ 推动力/ ,/ 各个/ 城市/ 的/ 视频/ 监控/ 每时每刻/ 都/ 在/ 采集/ 巨量/ 的/ 流媒体/ 数据/ ./ 大/ 数据/ 的/ 不断/ 激增/ 为/ 数据/ 存储/ 、/ 管理/ 、/ 检索/ 和/ 从/ 数据/ 中/ 搜索/ 可用/ 信息/ 提出/ 了/ 新/ 的/ 挑战/ [/ 2/ ]/ ./ Gartner/ 提出/ 了/ 大/ 数据/ 的/ 3/ 个/ 主要/ 特征/ [/ 1/ ]/ :/ 海量/ (/ Volume/ )/ 、/ 多样性/ (/ Variety/ )/ 及/ 速度/ (/ Velocity/ )/ ./ 海量/ 是/ 指/ 数据量/ 大/ ,/ 使用/ 传统/ 基础设施/ 进行/ 处理/ 的/ 难度/ 变大/ ./ 多样性/ 是/ 指/ 数据类型/ 、/ 表现形式/ 和/ 语义/ 解释/ 的/ 异质性/ ./ 过去/ 的/ 数据/ 更/ 多/ 的/ 是/ 结构化/ 的/ 数据/ ./ 现在/ 越来越/ 多/ 的/ 数据/ 是/ 半/ 结构/ 数据/ ,/ 甚至/ 是/ 完全/ 没有/ 结构/ 的/ 数据/ ./ 据/ IBM/ 大/ 数据/ 的/ 报告/ ,/ 2013/ 年/ 世界/ 上/ 的/ 数据量/ 大约/ 是/ 1.6/ ZB/ ./ 在/ 这/ 1.6/ ZB/ 的/ 数据/ 中/ ,/ 约/ 80/ %/ 的/ 数据/ 是/ 无/ 结构/ 的/ 数据/ ,/ 因而/ ,/ 存在/ 很多/ 数据源/ 是/ 传统/ 技术/ 不能/ 管理/ 或/ 分析/ 的/ ./ 速度/ 有/ 两层/ 含义/ :/ 一是/ 数据/ 到达/ 的/ 速率/ ;/ 另/ 一个/ 是/ 必须/ 对/ 数据处理/ 的/ 速率/ ./ 模式匹配/ 是/ 理论/ 计算机科学/ 最/ 古老/ 的/ 研究/ 领域/ 之一/ [/ 3/ -/ 4/ ]/ ,/ 是/ 理论/ 领域/ 为/ 许多/ 应用领域/ 提供/ 切实可行/ 解决方案/ 的/ 典范/ ./ 从/ KMP/ 算法/ [/ 3/ ]/ (/ 几乎/ 所有/ 算法/ 教科书/ 中/ 最/ 重要/ 的/ 内容/ 之一/ )/ 到/ Boyer/ -/ Moore/ 算法/ [/ 4/ ]/ (/ 所有/ 文本编辑/ 器中/ 搜索/ 命令/ 的/ 核心/ )/ ,/ 由于/ 其/ 在/ 信息检索/ 、/ Web/ 数据挖掘/ 、/ 计算/ 生物学/ 和/ 图像处理/ 等/ 领域/ 的/ 应用/ ,/ 一直/ 得到/ 广泛/ 关注/ ./ 模式识别/ 从/ 一/ 开始/ 就是/ 设法/ 解决/ 大型/ 异质/ 数据/ 集/ 的/ 搜索/ 问题/ ./ 如果/ 是/ 在/ 一个/ 小型/ 的/ 文件/ 中/ 搜索/ 某个/ 特定/ 的/ 单词/ ,/ 是/ 不/ 需要/ 什么/ 特殊/ 算法/ 的/ ./ 然而/ ,/ 如果/ 要/ 在/ 人类/ 基因组/ 中/ 查找/ 某个/ 基因/ ,/ 而/ 基因组/ 中/ 没有/ 单词/ 分隔/ 界限/ ,/ 而且/ 数据/ 规模/ 和/ 搜索/ 的/ 模式/ 都/ 很大/ ,/ 那么/ 理解/ 如何/ 重用/ 扫描/ 过/ 的/ 数据/ 就/ 变得/ 至关重要/ ./ 因此/ ,/ 上述/ 的/ KMP/ 算法/ [/ 3/ ]/ 和/ Boyer/ -/ Moore/ 算法/ [/ 4/ ]/ 的/ 重要性/ 就/ 体现/ 出来/ 了/ ./ 在/ 出现/ 更为/ 复杂/ 的/ 问题/ 时/ ,/ 例如/ ,/ 给定/ 一个/ 大型/ 非/ 文本/ 数据库/ (/ 如/ 数值数据/ 、/ 音频/ 数据/ 或/ 生物/ 序列/ )/ ,/ 我们/ 能够/ 索引/ 它/ 并/ 能/ 快速/ 回答/ 搜索/ 查询/ 吗/ ?/ 正是/ 因为/ 这个/ 问题/ ,/ 所以/ 发明/ 了/ 后缀/ 树/ [/ 5/ -/ 6/ ]/ 和/ 后缀/ 数组/ [/ 7/ ]/ 这样/ 的/ 数据结构/ ./ 虽然/ 后缀/ 数组/ 和/ 后缀/ 树均/ 能/ 在/ 最优/ 或/ 几乎/ 最优/ 时间/ 内/ 支持/ 模式匹配/ 查询/ ,/ 但/ 对于/ 输入/ 规模/ 为/ n/ 的/ 文本/ T/ ,/ 它们/ 使用/ O/ (/ n/ )/ 字/ 的/ 空间/ ,/ 即/ O/ (/ nlogn/ )/ ①/ 位/ ./ 在/ 空间/ 复杂度/ 方面/ ,/ 这个/ 大小/ 要/ 比/ 文本/ T/ 自身/ 的/ 大小/ O/ (/ nlog/ σ/ )/ 位要/ 大得多/ ,/ 其中/ σ/ 为/ 字符/ 表/ 的/ 大小/ ,/ 且/ 在/ 实际/ 中/ 这些/ 数据结构/ 所/ 占/ 空间/ 为/ 原文/ 本/ 的/ 5/ ~/ 20/ 倍/ [/ 2/ ]/ ./ 1.1/ 已有/ 相关/ 研究/ 工作/ 压缩/ 后缀/ 数组/ [/ 8/ -/ 13/ ]/ (/ CompressedSuffixArray/ ,/ CSA/ )/ 和/ FM/ -/ Index/ [/ 14/ -/ 16/ ]/ 利用/ 了/ 文本/ 的/ 可压缩性/ 和/ 规则性/ ,/ 克服/ 了/ 空间/ 上/ 的/ 局限性/ ,/ 同时/ 能/ 支持/ 后缀/ 数组/ 和/ 后缀/ 树/ 的/ 功能/ ./ 压缩/ 后缀/ 数组/ 和/ FM/ -/ Index/ 是/ 不/ 需要/ 原始/ 文本/ 的/ 自/ 索引/ (/ self/ -/ indexing/ )/ ,/ 也就是说/ ,/ 它们/ 既/ 能/ 作为/ 压缩/ 的/ 原始/ 文本/ ,/ 也/ 能/ 作为/ 索引/ ,/ 原始/ 文本/ 可以/ 抛弃/ ./ 从/ 实际/ 的/ 角度/ 来看/ ,/ 这是/ 首次/ 获得/ 的/ 模式匹配/ 的/ 空间/ 高效/ 的/ 压缩/ 索引/ 方法/ ./ 此外/ ,/ 这些/ 索引/ 技术/ 在/ 空间/ 和/ 时间/ 上/ 还/ 能/ 与/ 搜索引擎/ 中/ 所/ 使用/ 的/ 著名/ 的/ 倒排/ 索引/ (/ invertedindexes/ )/ 技术/ [/ 17/ -/ 18/ ]/ 相媲美/ ./ 因为/ 倒排/ 索引/ 是/ 一种/ 词/ 索引/ 技术/ ,/ 适合/ 做/ 关键字/ 搜索/ ,/ 不/ 适合/ 短语/ 搜索/ ;/ 如果/ 用/ 倒排/ 索引/ 进行/ 短语/ 搜索/ 效率/ 不高/ [/ 19/ ]/ ,/ 因而/ 这些/ 索引/ 则/ 提供/ 了/ 更为/ 一般/ 的/ 搜索/ 能力/ ./ Grossi/ 和/ Vitter/ [/ 8/ -/ 9/ ]/ 首次/ 建立/ 了/ 压缩/ 后缀/ 数组/ 理论/ (/ CompressedSuffixArray/ ,/ CSA/ )/ ,/ 使用/ O/ (/ nlog/ σ/ )/ 位/ 的/ 空间/ ,/ 可/ 在/ o/ (/ m/ // log/ σ/ n/ +/ occlog/ σ/ n/ )/ 时间/ 内/ 支持/ 模式匹配/ 查询/ ,/ 其中/ m/ 为/ 模式/ P/ 的/ 长度/ ,/ occ/ 表示/ P/ 在/ 文本/ 中/ 出现/ 的/ 次数/ ./ 在/ Grossi/ 和/ Vitter/ [/ 8/ -/ 9/ ]/ 的/ CSA/ 中/ ,/ 后缀/ 数组/ 的/ 值/ 间接/ 编码/ ,/ 以/ Φ/ 函数/ (/ 又称/ 近邻/ 函数/ [/ 8/ -/ 9/ ]/ )/ 存储/ ,/ 其中/ Φ/ (/ i/ )/ =/ SA/ -/ 1/ [/ SA/ [/ i/ ]/ +/ 1/ ]/ ./ Φ/ 函数/ 可压缩/ 为/ 熵/ 含义/ 下/ 的/ 最优/ 空间/ ,/ 每个/ SA/ 的/ 值/ 可/ 在/ O/ (/ polylogn/ )/ 时间/ 使用/ Φ/ 函数/ 的/ 一小部分/ 值/ 计算/ 出/ ./ Sadakane/ [/ 12/ -/ 13/ ]/ 给出/ 了/ 将/ Grossi/ 和/ Vitter/ 的/ CSA/ 变为/ 自/ 索引/ 的/ 方法/ ,/ 该/ 索引/ 使用/ (/ 1/ // / )/ nH0/ +/ O/ (/ nloglog/ σ/ )/ +/ σ/ log/ σ/ 位/ 的/ 空间/ ,/ 可/ 在/ O/ (/ mlogn/ +/ occlog/ / n/ )/ 时间/ 内/ 支持/ 模式匹配/ 查询/ ./ Ferragina/ 和/ Manzini/ [/ 14/ -/ 15/ ]/ 提出/ 了/ 基于/ BWT/ (/ Burrows/ -/ WheelerTransform/ )/ 变换/ [/ 20/ ]/ 的/ FM/ -/ Index/ ./ 其/ 索引/ 至多/ 使用/ 5nHk/ +/ o/ (/ nlog/ σ/ )/ 位/ 的/ 空间/ ,/ k/ / log/ σ/ (/ n/ // logn/ )/ -/ ω/ (/ 1/ )/ ,/ 可/ 在/ O/ (/ m/ +/ occlog1/ +/ / n/ )/ 时间/ 内/ 检索/ P/ 在/ 文本/ T/ 中/ 的/ 出现/ 次数/ occ/ ,/ 其中/ 0/ </ / </ 1/ ,/ Hk/ 表示/ 文本/ T/ 的/ k/ 阶/ 经验/ 熵/ ,/ k/ / 0/ ./ Grossi/ 等/ 人/ [/ 10/ ]/ 提出/ 了/ 理论/ 上/ 可/ 证明/ 达到/ 渐近/ 空间/ 最优性/ 的/ 第/ 1/ 个/ 自/ 索引/ ,/ 即/ 高阶/ 项前/ 的/ 系数/ 为/ 常数/ 1/ ./ 该/ 自/ 索引/ 使用/ nHk/ +/ o/ (/ n/ )/ 位/ 的/ 空间/ ,/ 达到/ 了/ O/ (/ mlog/ σ/ +/ polylogn/ )/ 的/ 查询/ 时间/ ./ 同样/ 的/ 分析/ 也/ 适用/ 于/ FM/ -/ Index/ ,/ 因而/ FM/ -/ Indx/ 也/ 达到/ 了/ 这样/ 的/ 最优性/ ./ Foschini/ 等/ 人/ [/ 21/ ]/ 给出/ 了/ 压缩/ 后缀/ 数组/ 的/ 一种/ 新/ 的/ 存储/ 结构/ ,/ 空间/ 达到/ 了/ 熵/ 界/ ;/ 他们/ 的/ 方法/ 不仅/ 保持/ 了/ 以往/ 工作/ 理论/ 上/ 的/ 性能/ ,/ 且/ 在/ 实际/ 中/ 显示/ 了/ 良好/ 的/ 结果/ ./ Krkkinen/ 和/ Puglisi/ [/ 22/ ]/ 提出/ 了/ 一种/ 固定/ 块/ 压缩/ 提升/ 技术/ ,/ 类似/ 于/ 上下文/ 块/ 提升/ 技术/ ,/ 将/ BWT/ 变换/ 分成/ 固定/ 大小/ 的/ 块/ ,/ 而/ 不是/ 按照/ 字符/ 表/ ①/ 本文/ 中/ 不/ 特别/ 指明/ 情况/ 下/ ,/ 对数/ 都/ 以/ 2/ 为底/ ./ Page3/ 的/ 分块/ ./ 虽然/ 这种/ 划分/ 不是/ 最优/ 的/ ,/ 但/ 他们/ 表明/ 了/ 这种/ 技术/ 不会/ 比/ 最优/ 划分/ 差/ 很多/ ./ 这种/ 对/ BWT/ 变换/ L/ 进行/ 固定/ 块/ 划分/ 的/ 技术/ ,/ 其/ 数据结构/ 较为/ 简洁/ 、/ 快速/ ./ Mkinen/ 等/ 人/ [/ 23/ ]/ 提出/ 了/ 一种/ 针对/ 高度/ 重复/ 序列/ 的/ 压缩/ 自/ 索引/ ,/ 称为/ RLCSA/ ./ 他们/ 提出/ 了/ 后缀/ 数组/ 采样/ 的/ 一种/ 新策略/ ./ 实验/ 结果表明/ RLCSA/ 对于/ 高度/ 重复/ DNA/ 序列/ 如/ 酵母/ 序列/ 表现/ 出/ 了/ 良好/ 的/ 性能/ ./ Huo/ 等/ 人/ [/ 24/ ]/ 提出/ 了/ 表示/ CSA/ 的/ 近邻/ 函数/ Φ/ 的/ 一种/ 新/ 结构/ ,/ 理论/ 上/ 空间/ 保持/ 了/ 高阶/ 熵/ ,/ 设计/ 了/ 一种/ 查找/ 表/ 支持/ 快速/ 解码/ ./ Ferragina/ 等/ 人/ [/ 25/ ]/ 从/ 实践/ 角度/ 将/ 已有/ 索引/ 进行/ 了/ 实现/ ,/ 并/ 做/ 了/ 对比/ ./ Navarro/ 和/ Mkinen/ [/ 26/ ]/ 综述/ 了/ 这方面/ 的/ 成果/ ./ Gog/ 和/ Navarro/ [/ 27/ ]/ 扩展/ 了/ CSA/ 的/ 模式/ 定位/ 功能/ ./ Gog/ 和/ Petri/ [/ 28/ ]/ 实现/ 了/ 一个/ 包含/ GGV/ -/ CSA/ 和/ FM/ -/ Index/ 的/ 简明/ 数据结构/ 库/ ./ 1.2/ 本文/ 的/ 贡献/ 本文/ 提出/ 了/ 一种/ 基于/ 压缩/ 后缀/ 数组/ (/ Com/ -/ pressedSuffixArray/ ,/ CSA/ )/ 的/ 高阶/ 熵/ 压缩/ 的/ 全文/ 自/ 索引/ ./ 对于/ 长为/ n/ 的/ 文本/ T/ ,/ 我们/ 的/ 压缩/ 索引/ 可/ 在/ 线性/ 时间/ 内/ 构造/ ./ 对于/ 任意/ k/ / clog/ σ/ n/ -/ 1/ 和/ c/ </ 1/ ,/ 我们/ 的/ 压缩/ 索引/ 占用/ 2nHk/ +/ n/ +/ o/ (/ n/ )/ 位/ 的/ 空间/ ,/ 其中/ Hk/ 表示/ 文本/ T/ 的/ k/ 阶熵/ ,/ σ/ 为/ 字符/ 表/ 的/ 大小/ ./ 此外/ ,/ 本文/ 还/ 给出/ 了/ 上述/ 描述/ 的/ 压缩/ 索引/ 的/ 一种/ 实用/ 改进/ ,/ 称之为/ ACSA/ (/ AdaptiveCSA/ )/ ./ 这种/ 实用/ 改进/ 引入/ 了/ 混合/ 编码方法/ ,/ 额外/ 的/ 空间/ 开销/ 为/ o/ (/ n/ )/ 位/ ./ 对于/ PizzaChiliCorpus/ 上/ 的/ 三类/ 典型/ 数据/ 的/ 实验/ 表明/ ,/ 我们/ 的/ 压缩/ 索引/ 较之/ 主流/ 压缩/ 索引/ 在/ 压缩率/ 和/ 查询/ 时间/ 上/ 具有/ 显著/ 的/ 优势/ ./ 所/ 开发/ 的/ 压缩/ 索引/ 可/ 在/ GitHub/ 上/ 访问/ :/ https/ :/ // // github/ ./ com/ // chenlonggang/ // Compressed/ -/ Suffix/ -/ Array/ 和/ https/ :/ // // github/ ./ com/ // chenlonggang/ // Adaptive/ -/ CSA/ ./ 2/ 预备/ 知识/ 2.1/ 问题/ 定义/ 和/ 符号/ 含义/ 文本/ 索引/ 问题/ :/ 给定/ 大小/ 为/ n/ 的/ 文本/ T/ ,/ 其中/ 字符/ 取自/ 大小/ 为/ σ/ 的/ 字符/ 表/ Σ/ ./ 文本/ 索引/ 的/ 目标/ 是/ 构建/ T/ 的/ 一个/ 索引/ ,/ 使得/ 对于/ 任一/ 查询/ 模式/ P/ ,/ 能够/ 高效/ 地/ 确定/ P/ 是否/ 在/ T/ 中/ 出现/ ./ 对于/ 具体/ 应用/ 问题/ ,/ 我们/ 可能/ 希望/ 确定/ 模式/ P/ 在/ T/ 中/ 的/ 出现/ 次数/ occ/ ;/ 或者/ 定位/ 模式/ P/ 在/ T/ 中/ 出现/ 的/ 所有/ 位置/ ;/ 或者/ 展示/ 文本/ T/ 的/ 子串/ T/ [/ s/ ,/ s/ +/ len/ -/ 1/ ]/ ,/ 给定/ 子串/ 起始/ 位置/ s/ 和/ 长度/ len/ ./ 在/ 压缩/ 空间/ ,/ 本文/ 索引/ 的/ 目标/ 是/ 构建/ 空间/ 占用/ 逼近/ 文本/ 熵/ 压缩/ 大小/ 的/ 压缩/ 索引/ ,/ 同时/ 支持/ 快速/ 查询/ 性能/ ./ 表/ 1/ 中/ 给出/ 了/ 本文/ 中/ 使用/ 的/ 符号/ 及/ 含义/ ./ 符号/ T/ 文本/ Tn/ 文本/ T/ 的/ 长度/ P/ 模式/ Pm/ 模式/ P/ 的/ 长度/ Σ/ 字符/ 表/ {/ α/ 1/ ,/ …/ ,/ α/ σ/ }/ σ/ 字符/ 表/ 的/ 大小/ Σ/ k/ 定义/ 在/ 字符/ 表/ Σ/ 上长/ 为/ k/ 的/ 串集/ SAT/ 的/ 后缀/ 数组/ (/ suffixarray/ )/ T/ [/ i/ ]/ T/ 中/ 第/ i/ 个字符/ T/ [/ i/ ../ n/ ]/ T/ 的/ 第/ i/ 个/ 后缀/ ,/ 1/ / i/ / nSA/ [/ i/ ]/ 第/ i/ 个/ 字典/ 序/ 最小/ 后缀/ 在/ T/ 中/ 的/ 起始/ 位置/ SA/ -/ 1/ [/ i/ ]/ 后缀/ T/ [/ i/ ../ n/ ]/ 的/ 排名/ ./ 称/ SA/ -/ 1/ 为/ 逆/ 后缀/ 数组/ CSA/ 压缩/ 后缀/ 数组/ (/ CompressedSuffixArray/ )/ Φ/ (/ i/ )/ 近邻/ 函数/ ,/ 满足/ Φ/ (/ i/ )/ =/ j/ ,/ ifSA/ [/ j/ ]/ =/ (/ SA/ [/ i/ ]/ +/ 1/ )/ modnx/ -/ list/ 以/ x/ 开始/ 的/ 所有/ 后缀/ 位置/ 的/ 一个/ 递增/ 序列/ Hk/ (/ T/ )/ T/ 的/ k/ 阶/ 经验/ 熵/ ,/ 简称/ k/ 阶熵/ ni/ 字符/ i/ 在/ T/ 中/ 出现/ 的/ 次数/ wsk/ -/ contextT/ 中/ 后缀/ 的/ 长为/ k/ 的/ 前缀/ C/ [/ x/ ]/ T/ 中/ 所有/ 小于/ x/ 的/ 字符/ 出现/ 次数/ 的/ 总和/ occ/ 模式/ P/ 在/ T/ 中/ 的/ 出现/ 次数/ count/ 确定/ 模式/ P/ 在/ T/ 中/ 的/ 出现/ 次数/ locate/ 确定/ 模式/ P/ 在/ T/ 中/ 出现/ 的/ 所有/ 位置/ extract/ 返回/ T/ [/ start/ ../ start/ +/ len/ -/ 1/ ]/ ,/ 给定/ start/ 和/ lenpolylognn/ 的/ 对数/ 多项式/ 2.2/ 后缀/ 数组/ 令/ T/ [/ 1/ ../ n/ ]/ 为/ 长度/ 为/ n/ 的/ 文本/ ,/ 其中/ 字符/ 取自/ 大小/ 为/ σ/ 的/ 字符/ 表/ Σ/ ./ 形如/ T/ [/ i/ ../ n/ ]/ 的/ T/ 的/ 子串/ (/ i/ =/ 1/ ,/ 2/ ,/ …/ ,/ n/ )/ 称为/ T/ 的/ 后缀/ ./ 后缀/ 数组/ (/ suffixarray/ )/ SA/ [/ 1/ ../ n/ ]/ 是/ n/ 个/ 元素/ 的/ 整型/ 数组/ ,/ SA/ [/ i/ ]/ =/ j/ 表示/ 第/ i/ 个/ 字典/ 序/ 最小/ 的/ 后缀/ 在/ T/ 中/ 的/ 起始/ 位置/ 为/ j/ ./ 类似/ 地/ ,/ 我们/ 可以/ 定义/ 逆/ 后缀/ 数组/ :/ SA/ -/ 1/ [/ i/ ]/ =/ j/ ,/ 表示/ 后缀/ T/ [/ i/ ../ n/ ]/ 的/ 排名/ 为/ j/ ,/ 即/ T/ 中/ 由/ i/ 起始/ 的/ 后缀/ 的/ 排名/ 为/ j/ ./ 如果/ 模式/ P/ 出现/ 在/ 文本/ T/ 中/ ,/ 那么/ 存在/ 整数/ L/ 和/ R/ (/ L/ / R/ )/ ,/ 满足/ SA/ [/ L/ ]/ ,/ SA/ [/ L/ +/ 1/ ]/ ,/ …/ ,/ SA/ [/ R/ ]/ 存储/ 了/ P/ 在/ T/ 中/ 出现/ 的/ 所有/ 位置/ ./ 2.3/ 压缩/ 后缀/ 数组/ Grossi/ &/ Vitter/ (/ GV/ -/ CSA/ )/ 压缩/ 后缀/ 数组/ [/ 8/ -/ 10/ ]/ 解决/ 了/ 后缀/ 数组/ 作为/ 索引/ 时/ 空间/ 占用/ 过大/ 的/ 问题/ ,/ 其/ 核心/ 是/ 如何/ 高效/ 地/ 表示/ 近邻/ 函数/ Φ/ [/ 8/ -/ 10/ ]/ ,/ 定义/ 如下/ :/ Φ/ (/ i/ )/ =/ j/ ,/ ifSA/ [/ j/ ]/ =/ (/ SA/ [/ i/ ]/ +/ 1/ )/ modn/ (/ 1/ )/ Φ/ 函数/ 将/ SA/ 中/ 的/ 某个/ 位置/ i/ (/ 满足/ SA/ [/ i/ ]/ =/ p/ )/ 映射/ 到/ 另/ 一个/ 位置/ j/ (/ 满足/ SA/ [/ j/ ]/ =/ p/ +/ 1/ )/ ,/ 其/ 核心/ 在于/ 把/ 当前/ 位置/ 和/ 下/ 一个/ 位置/ 联系/ 起来/ ,/ 不仅/ 利用/ 了/ 上下文/ 信息/ ,/ 且/ 有利于/ 压缩/ ,/ 又/ 提供/ 了/ 通过/ Φ/ 函数/ 访问/ 整个/ 文本/ 串/ 的/ 能力/ ,/ 从而/ 提供/ 了/ 检索/ 和/ 数据/ Page4/ 恢复/ 的/ 能力/ ./ Grossi/ 等/ 人/ [/ 10/ ]/ (/ GGV/ -/ CSA/ )/ 所/ 提出/ 的/ 达到/ 渐近/ 空间/ 最优性/ 的/ 压缩/ 自/ 索引/ 引入/ 了/ Σ/ -/ list/ 的/ 概念/ (/ 此后/ 我们/ 称/ x/ -/ list/ )/ ,/ 这些/ x/ -/ list/ (/ x/ ∈/ Σ/ )/ 可/ 对/ 文本/ 中/ 的/ 所有/ 后缀/ 及其/ 关联/ 的/ Φ/ 值/ 按照/ 其/ 前缀/ 进行/ 划分/ ./ 通过/ 对/ 后缀/ 指针/ 按/ 其/ 长度/ 为/ 2k/ (/ k/ =/ 0/ ,/ 1/ ,/ i01234567891011121314151617181920212223242526272829303132333435TabfgdbfbgdfccbgacefcegcdefgbfcadbgafSA01530345271133272912112216194312391724203562810182521433262138/ Φ/ 61417232425293031352711182022482126272833091012153234135131619/ 图/ 1/ 后缀/ 数组/ SA/ 和/ 近邻/ 函数/ Φ/ 2.4/ 犽/ 阶/ 经验/ 熵/ 令/ T/ 为/ 长度/ 为/ n/ 的/ 文本/ 串/ ,/ 其中/ 字符/ 取自/ 大小/ 为/ σ/ 的/ 字符/ 表/ Σ/ ./ 由/ 信息论/ 可/ 得/ ,/ 使用/ 经验/ 熵/ (/ empiricalentropy/ )/ 可以/ 界定/ 存储/ 文本/ T/ 所需/ 空间/ 的/ 下界/ ./ 经验/ 熵/ 类似/ 于/ 概率/ 意义/ 上/ 所/ 定义/ 的/ 熵/ ,/ 不同之处/ 在于/ 经验/ 熵/ 是/ 根据/ 所/ 观察/ 到/ 的/ T/ 中/ 字符/ 频率/ 来/ 定义/ 的/ ,/ 而/ 不是/ 由/ 字符/ 概率/ 来/ 定义/ 的/ ./ 可用/ 经验/ 熵/ 来/ 度量/ 一个/ 压缩算法/ 的/ 性能/ ,/ 它/ 是/ 文本/ 串/ 结构/ 的/ 一个/ 函数/ ,/ 不/ 对/ 输入/ 做/ 任何/ 假设/ ./ 文本/ 串/ T/ 的/ 0/ 阶/ 经验/ 熵/ 定义/ 为/ [/ 29/ ]/ 其中/ :/ ni/ 是/ 字符/ i/ 在/ T/ 中/ 出现/ 的/ 次数/ ,/ ∑/ inH0/ (/ T/ )/ 表示/ 理想/ 压缩器/ 的/ 输出/ 大小/ ,/ 该/ 压缩器/ 使用/ -/ logni/ (/ )/ n/ 位/ 对/ 字符/ 表/ Σ/ 中/ 的/ 符号/ 进行/ 编码/ ./ 这是/ 使用/ 唯一/ 可/ 解码/ 编码/ 所/ 能/ 达到/ 的/ 最大/ 压缩率/ ,/ 其中/ 字符/ 表中/ 的/ 每个/ 字符/ 被/ 赋以/ 一个/ 固定/ 的/ 码字/ ./ 如果/ 用于/ 每个/ 字符/ 的/ 码字/ 依赖于/ 其/ 在/ T/ 中/ 的/ 前/ k/ 个字符/ ,/ 那么/ 还/ 可以/ 达到/ 更好/ 的/ 压缩率/ ./ 对于/ 长为/ k/ 的/ 串/ w/ ∈/ Σ/ k/ ,/ 令/ ws/ 是/ 连接/ w/ 在/ T/ 中/ 每次/ 出现/ 之后/ 的/ 字符/ 所/ 形成/ 的/ 串/ ./ |/ ws/ |/ 是/ 该/ 串/ 的/ 长度/ ./ T/ 的/ k/ 阶/ 经验/ 熵/ 定义/ 为/ [/ 29/ ]/ 值/ nHk/ (/ T/ )/ 表示/ 如果/ 使用/ 的/ 编码/ 依赖于/ 前/ k/ 个/ 最近/ 所见/ 的/ 符号/ ,/ 所/ 能/ 达到/ 压缩率/ 的/ 下界/ ./ 注意/ ,/ 对于/ 任意/ 串/ 和/ k/ / 0/ ,/ 有/ Hk/ +/ 1/ (/ T/ )/ / Hk/ (/ T/ )/ / log/ σ/ ./ 1/ 阶/ 经验/ 熵/ 如下/ 计算/ :/ H0/ (/ T/ )/ =/ -/ (/ 1/ // 4/ )/ log/ (/ 1/ // 4/ )/ -/ (/ 1/ // 4/ )/ log/ (/ 1/ // 4/ )/ -/ 例如/ ,/ 对于/ T/ =/ abcdabcdabcd/ ,/ 其/ 0/ 阶/ 经验/ 熵/ 和/ 2/ ,/ …/ )/ 的/ 前缀/ 进行/ 划分/ ,/ 可/ 得/ 这些/ x/ -/ list/ ./ 这些/ x/ -/ list/ 的/ 简单/ 连接/ 恰好/ 为/ 近邻/ 函数/ 值/ ./ 每个/ x/ -/ list/ 形成/ 关于/ 文本/ 位置/ 的/ 一个/ 递增/ 序列/ ,/ 如图/ 1/ 所示/ ./ 其中/ 标示出/ 了/ a/ -/ list/ 和/ c/ -/ list/ ./ 因此/ ,/ 如果/ 对/ 递增/ 序列/ 的/ 间隔/ 长度/ 进行/ 编码/ ,/ 就/ 能/ 实现/ 对/ 文本/ 的/ 压缩/ ./ =/ (/ 1/ // 4/ )/ H0/ (/ bbb/ )/ +/ (/ 1/ // 4/ )/ H0/ (/ ccc/ )/ +/ 上例/ T/ 的/ 所有/ 高阶/ 熵/ 均/ 为/ 0/ ./ 这/ 表明/ 如果/ 我们/ 随机/ 均匀/ 地/ 从/ T/ 中/ 选择/ 一个/ 字符/ 来/ 猜测/ ,/ 其/ 不确定性/ 为/ 2/ ./ 如果/ 猜测/ 之前/ 我们/ 知道/ 其前/ 一个/ 字符/ ,/ 那么/ 可以/ 肯定/ 结果/ 答案/ ./ 在/ 一般/ 情况/ 下/ ,/ 对于/ 给定/ 的/ 文本/ 串/ T/ ,/ 存在/ N/ ,/ 满足/ 对于/ k/ / N/ ,/ 有/ Hk/ (/ T/ )/ =/ 0.3/ 压缩/ 后缀/ 数组/ 的/ 存储/ 结构/ 3.1/ Φ/ 的/ 简明/ 表示/ 为了/ 方便/ 叙述/ 起/ 见/ ,/ 我们/ 根据/ 上下文/ 交替/ 使用/ Φ/ (/ )/ 函数/ 和/ Φ/ [/ ]/ 数组/ 这/ 两种/ 形式/ ./ GGV/ _/ CSA/ [/ 10/ ]/ 是/ 一种/ 多层/ 递归结构/ ,/ 按照/ k/ -/ context/ [/ 10/ ]/ 对/ Φ/ 进行/ 划分/ ,/ 达到/ 了/ 文本/ 的/ 高阶/ 熵/ ,/ 且/ 最高/ 项/ 系数/ 为/ 1/ ./ 我们/ 在/ 这/ 一/ 理论/ 的/ 基础/ 上/ ,/ 考虑/ 实际/ ,/ 对此/ 进行/ 简化/ ,/ 并/ 结合/ 后/ 向/ 查找/ 过程/ ,/ 提出/ 了/ 一种/ 相对/ 简明/ 、/ 易/ 实现/ 的/ 单层/ CSA/ 结构/ ,/ 同时/ 空间/ 上/ 保持/ 了/ 理论/ 上/ 的/ 高阶/ 熵/ ./ 我们/ 的/ 结构/ 采用/ 两层/ 模式/ :/ 一层/ 是/ 超块/ (/ superblock/ ,/ SB/ )/ ,/ 另/ 一层/ 是/ 块/ (/ block/ ,/ B/ )/ ./ 过程/ 如下/ :/ (/ 1/ )/ 首先/ 把/ 长为/ n/ 的/ Φ/ 数组/ 分为/ 长为/ a/ =/ (/ logn/ )/ 2/ (/ 2/ )/ 其次/ 把/ 每个/ 超块/ 分成/ a/ // b/ 个块/ ,/ 每个/ 块/ 包含/ 的/ 超块/ ,/ 故/ 共有/ n/ // a/ 个/ 超块/ ./ b/ 个/ 整数/ ,/ b/ =/ (/ logn/ )/ 2/ // loglogn/ ./ (/ 3/ )/ 最后/ 对/ 每个/ 块/ 内/ 的/ 整数/ 序列/ 做/ 差分/ ,/ 对/ 差分/ 后/ 的/ 每个/ 差值/ 进行/ EliasGamma/ 编码/ [/ 30/ ]/ ,/ 连接起来/ 即/ 得到/ Φ/ 数组/ 的/ 表示/ ,/ 记为/ S/ ./ 但/ 我们/ 必须/ 处理/ 一种/ 特殊/ 情形/ ./ 假设/ x/ 表示/ 前/ 一个/ Φ/ 值/ ,/ y/ 表示/ 当前/ Φ/ 值/ ,/ 当/ 差值/ gap/ =/ y/ -/ x/ </ 0/ 时/ ,/ Gamma/ 编码/ 无法/ 处理/ ,/ 此时/ 令/ gap/ =/ y/ -/ x/ +/ n/ ,/ Page5/ 再/ 将/ 该/ gap/ 值/ 进行/ Gamma/ 编码/ ./ 这是/ 由于/ (/ x/ -/ z/ )/ modn/ =/ (/ x/ +/ n/ -/ z/ )/ modn/ ,/ 其中/ x/ 和/ z/ 都/ 是/ 正整数/ ./ 在/ 我们/ 的/ 结构/ 中/ ,/ 需要/ 保存/ 超块/ 的/ 偏移量/ 表/ SB/ ,/ 块/ 的/ 偏移量/ 表/ B/ ,/ Φ/ 的/ 采样/ 表/ SAM/ 以及/ 最终/ 的/ Gamma/ 编码序列/ S/ ,/ 我们/ 用/ 这/ 4/ 个/ 结构/ 表示/ Φ/ 数组/ ./ 图/ 2/ 给出/ 了/ 大小/ n/ =/ 36/ 的/ Φ/ 数组/ 及其/ 表示/ ,/ 其中/ 超块/ 长度/ a/ =/ 9/ ,/ 块/ 长度/ b/ =/ 3/ ,/ 超块/ 中/ 的/ 块/ 数/ r/ =/ 3/ ./ 图/ 2/ 中/ 每个/ x/ -/ list/ (/ x/ ∈/ Σ/ )/ 内/ 对应/ 的/ 所有/ 后缀/ 都/ 具有/ 相同/ 的/ 首/ 字符/ ,/ 如/ a/ -/ list/ 内/ 对应/ 的/ 所有/ 后缀/ 都/ 具有/ 相同/ 的/ 首/ 字符/ a/ ./ 每个/ x/ -/ list/ 内/ 的/ Φ/ 值/ 呈/ 升序/ i01234567891011121314151617181920212223242526272829303132333435/ Φ/ 61417232425293031352711182022482126272833091012153234135131619gap08301101103507201840510530120172022033S00010000111111011001010011101000001001000100001011001010111010000010001010010010011011SBB010120816061401218SAM623293511222128915113/ 图/ 2/ Φ/ 的/ 表示/ (/ n/ =/ 36/ ,/ a/ =/ 9/ ,/ r/ =/ 3/ ,/ b/ =/ 3/ )/ EliasGamma/ 编码/ [/ 30/ ]/ 是/ 一种/ 前缀/ 无关/ 码/ ,/ 因此/ 解码/ 是/ 唯一/ 的/ ./ 理论/ 上/ ,/ 对于/ 一个/ 大小/ 为/ x/ 的/ 整数/ 应用/ Gamma/ 编码/ ,/ 需要/ 2logx/ +/ 1/ 位/ 表示/ 这个/ 整数/ ./ Gamma/ 编码/ 由/ 两/ 部分/ 组成/ ,/ 前/ 一部分/ 是/ logx/ 个/ 0/ ,/ 后/ 一部分/ 是/ x/ 的/ 二进制/ 表示/ ,/ 使用/ logx/ +/ 1/ 位/ ./ 解码/ 时/ 从左到右/ 数出/ 连续/ 0/ 的/ 个数/ ,/ 不妨/ 设为/ c/ 个/ ,/ 然后/ 解码/ c/ +/ 1/ 位即/ 得/ x/ ./ 例如/ :/ gap/ =/ 8/ ,/ log8/ =/ 3/ ,/ 表示/ 前/ 一部分/ 含有/ 3/ 个/ 0/ ,/ 由于/ 8/ 的/ 二进制/ 表示/ 为/ 1000/ ,/ 即后/ 一部分/ 为/ 1000/ ,/ 因此/ 8/ 的/ Gamma/ 编码/ 为/ 0001000/ ./ 解码/ 时/ ,/ 从左到右/ 数出/ 连续/ 0/ 的/ 个数/ ,/ 为/ 3/ ,/ 然后/ 解码/ c/ +/ 1/ =/ 3/ +/ 1/ =/ 4/ 位/ ,/ 即得/ 8/ ./ SB/ 表示/ 每个/ 超块/ 在/ 编码序列/ S/ 中/ 的/ 偏移/ 位置/ ,/ 例如/ ,/ 上表/ 中/ 的/ 第/ 2/ 个/ 超块/ 的/ 第/ 2/ 个/ 差值/ 3/ (/ 因为/ 每块/ 中/ 的/ 第/ 1/ 个/ Φ/ 值会/ 被/ 采样/ ,/ 不/ 需要/ 保存/ 在/ S/ 中/ )/ 的/ 编码/ 在/ S/ 中/ 的/ 偏移/ 为/ 14/ ,/ 所以/ SB/ [/ 1/ ]/ =/ 14/ ./ B/ 中/ 保存/ 的/ 是/ 块/ 中/ 第/ 2/ 个/ 差值/ (/ 即/ 每个/ 块/ 内/ 之后/ 的/ 那个/ 数/ )/ 的/ 偏移量/ ,/ 这个/ 偏移量/ 是/ 相对/ 于/ 该/ 块/ 所在/ 超块/ 的/ 相对/ 偏移量/ ,/ 如/ 第/ 5/ 个块/ 是/ 在/ 第/ 2/ 个/ 超块/ 中/ ,/ 且/ 相对/ 偏移量/ 为/ 8/ ,/ 所以/ B/ [/ 4/ ]/ =/ 8/ ./ 上表/ 中/ 的/ SAM/ 数组/ 保存/ 的/ 是/ 每个/ 块/ 中/ 的/ 第/ 1/ 个数/ 的/ 值/ ,/ 即/ Φ/ 的/ 采样/ 值/ ./ 如果/ 要/ 访问/ Φ/ (/ i/ )/ ,/ 就要/ 进行/ 解码/ ./ 解码/ 过程/ 是/ 首先/ 查询/ SB/ 和/ B/ 结构/ 后/ 确定/ 所属/ 块/ 在/ S/ 中/ 的/ 位置/ ,/ 然后/ 解码/ S/ 序列/ ,/ 加上/ 相应/ 的/ 采样/ 值/ SAM/ ,/ 即可/ 得到/ Φ/ 值/ ./ Φ/ (/ i/ )/ 的/ 表示/ 如下/ :/ 排列/ ,/ 但/ 不同/ 的/ x/ -/ list/ 之间/ 不/ 存在/ 这种/ 关系/ ./ 表中/ 的/ gap/ 数组/ 是/ 各个/ 块/ 内求/ 差分/ 后/ 的/ 值/ ,/ 每个/ 块/ 内/ 的/ 第/ 1/ 个数/ 会/ 被/ 采样/ ,/ 所以/ 没有/ 与/ 之/ 对应/ 的/ “/ 差值/ ”/ ,/ 表中/ 这些/ 位置/ 标记/ 为/ 0/ ,/ 实际/ 编码/ 的/ gap/ 序列/ 不/ 包含/ 块/ 中/ 的/ 这些/ 0/ ./ 需要/ 注意/ 的/ 是/ 第/ 4/ 、/ 6/ 、/ 8/ 个块/ ,/ 因为/ 这些/ 块/ 中/ 的/ 3/ 个/ 整数/ 分属/ 两个/ x/ -/ list/ ,/ 所以/ 出现/ 了/ 差分/ 后/ 为/ 负值/ 的/ 情况/ ,/ 此时/ gap/ =/ Φ/ [/ i/ ]/ -/ Φ/ [/ i/ -/ 1/ ]/ +/ n/ ,/ 对于/ 本例/ ,/ 第/ 4/ 个块/ 的/ gap/ =/ 2/ -/ 35/ +/ 36/ =/ 3/ ,/ 所以/ 该/ gap/ 编码/ 为/ 011/ ,/ 对于/ 第/ 6/ 个块/ ,/ gap/ =/ 4/ -/ 22/ +/ 36/ =/ 18/ ,/ 因而/ 对应/ 的/ 编码/ 为/ 000010010/ ./ Φ/ (/ i/ )/ =/ (/ SAM/ [/ i/ // b/ ]/ +/ decompress/ (/ S/ ,/ SB/ [/ i/ // a/ ]/ +/ 其中/ a/ 为/ 超块/ 长度/ ,/ b/ 为块/ 长度/ ./ decompress/ 过程/ 完成/ 在/ Gamma/ 编码序列/ S/ 上/ 的/ 解码/ ,/ 解码/ 的/ 起始/ 位置/ 由/ SB/ [/ i/ // a/ ]/ +/ B/ [/ i/ // b/ ]/ 确定/ ,/ 即/ 第/ i/ 个值/ 所属/ 块/ 的/ 起始/ 位置/ ./ imodb/ 为/ 要/ 解码/ 的/ 次数/ ,/ 最后/ 将/ 解码/ 值/ 与/ 第/ 1/ 项/ SAM/ [/ i/ // b/ ]/ 相加/ 得到/ Φ/ (/ i/ )/ 值/ ./ 对于/ 图/ 2/ 示例/ ,/ 如果/ 要求/ Φ/ (/ 11/ )/ ,/ 首先/ 求得/ SAM/ [/ 11/ // b/ ]/ =/ SAM/ [/ 11/ // 3/ ]/ =/ 35/ ,/ 又/ 由于/ SB/ [/ 11/ // a/ ]/ +/ B/ [/ 11/ // b/ ]/ =/ SB/ [/ 11/ // 9/ ]/ +/ B/ [/ 11/ // 3/ ]/ =/ SB/ [/ 1/ ]/ +/ B/ [/ 3/ ]/ =/ 14/ ,/ 即/ 解码/ 起始/ 位置/ 为/ 14/ ,/ 且/ 11mod3/ =/ 2/ ,/ 所以/ 从/ S/ 表中/ 的/ 第/ 14/ 个/ 位置/ 开始/ 解码/ ,/ 连续/ 解码/ 2/ 次/ 和/ SAM/ [/ 3/ ]/ 累加/ 即可/ ,/ S/ 表中/ 第/ 14/ 个/ 位置/ 解码/ 第/ 1/ 次/ 得到/ 3/ ,/ 第/ 2/ 次/ 解码/ 得/ 5/ ,/ 因此/ Φ/ (/ 11/ )/ =/ (/ 35/ +/ 3/ +/ 5/ )/ mod36/ =/ 7/ ./ 如果/ 要求/ Φ/ (/ 25/ )/ ,/ 首先/ 求得/ SAM/ [/ 25/ // b/ ]/ =/ SAM/ [/ 25/ // 3/ ]/ =/ 9/ ,/ 又/ 由于/ SB/ [/ 25/ // a/ ]/ +/ B/ [/ 25/ // b/ ]/ =/ SB/ [/ 25/ // 9/ ]/ +/ B/ [/ 25/ // 3/ ]/ =/ SB/ [/ 2/ ]/ +/ B/ [/ 8/ ]/ =/ 58/ ,/ 即/ 解码/ 起始/ 位置/ 为/ 58/ ,/ 且/ 25mod3/ =/ 1/ ,/ 所以/ 从/ S/ 表中/ 的/ 第/ 58/ 个/ 位置/ 开始/ 解码/ ,/ 解码/ 1/ 次/ 和/ SAM/ [/ 8/ ]/ 累加/ 即可/ ,/ S/ 表中/ 第/ 58/ 个/ 位置/ 解码/ 1/ 次/ 得到/ 1/ ,/ 因此/ Φ/ (/ 25/ )/ =/ (/ 9/ +/ 1/ )/ mod36/ =/ 10.3/ ./ 2/ 空间/ 占用/ 令/ gj/ 为/ x/ -/ list/ 内/ 第/ j/ 个/ gap/ 的/ 长度/ ,/ nx/ 为/ 该表中/ 的/ 元素/ 数/ ./ 由/ x/ -/ list/ 的/ 定义/ 可知/ ,/ nx/ 恰好/ 为/ 字符/ xPage6/ 在/ 文本/ T/ 中/ 出现/ 的/ 次数/ ./ 我们/ 使用/ EliasGamma/ 对/ gj/ =/ Φ/ (/ j/ +/ 1/ )/ -/ Φ/ (/ j/ )/ 进行/ 编码/ ,/ 该/ 编码/ 长度/ 包含/ 2gj/ +/ 1/ 位/ ./ 因此/ ,/ 该表内/ 的/ gap/ 总长度/ 为/ 所/ 需要/ 的/ 总/ 编码/ 位数/ 至多/ 为/ ∑/ nx/ -/ 1/ Φ/ (/ j/ )/ )/ +/ 1/ )/ 位/ ,/ 最坏/ 情况/ 下为/ 2nxlog/ (/ n/ // nx/ )/ +/ nx/ 位/ ,/ 其中/ nx/ =/ n/ -/ 1/ ./ 对/ 所有/ 表上/ 的/ gap/ 编码/ 位数/ 求和/ ,/ 可/ 得/ ∑/ x/ ∈/ Σ/ 2nxlogn/ // n/ (/ )/ x/ +/ n/ 其中/ n/ =/ n/ -/ σ/ ,/ σ/ 为/ 字符/ 表/ Σ/ 的/ 大小/ ./ 使用/ 文献/ [/ 21/ ]/ 中/ 的/ 方法/ ,/ 对表内/ gap/ 编码/ 进行/ 更为/ 细致/ 的/ 分析/ ,/ 可/ 得/ 更好/ 的/ 一个/ 空间/ 上界/ ./ 令/ Φ/ (/ i/ )/ 的/ k/ -/ context/ 表示/ T/ [/ SA/ [/ Φ/ (/ i/ )/ ]/ ]/ 长为/ k/ 的/ 前缀/ ./ 按照/ k/ -/ context/ 划分/ ,/ 每个/ x/ -/ list/ 可/ 被/ 划分/ 为/ 至多/ σ/ k/ 个子/ 表/ ,/ 由此可见/ ,/ ∑/ log/ (/ Φ/ (/ j/ +/ 1/ )/ -/ Φ/ (/ j/ )/ )/ / nHk/ ,/ 其中/ 求和/ 取自/ 同一/ 表内/ 及/ 同一/ k/ -/ context/ 内/ 的/ 所有/ gap/ ./ 不/ 在/ 同一/ k/ -/ context/ 内/ 的/ gap/ 数目/ 至多/ 为/ σ/ k/ +/ 1/ ./ 同一/ k/ -/ context/ 内/ 的/ 所有/ gap/ 的/ 编码/ 总长度/ 为/ 2nHk/ +/ n/ ,/ 其他/ gap/ 的/ 编码/ 总长度/ 为/ 2/ σ/ k/ +/ 1logn/ ./ 值得一提的是/ ,/ 我们/ 的/ 结果/ 对于/ 任何/ k/ 都/ 成立/ ./ 然而/ ,/ 我们/ 还/ 需要/ 处理/ 一种/ 情况/ ,/ 那/ 就是/ 有些/ gap/ (/ 每块/ 中/ 的/ 第/ 1/ 个/ )/ 是/ 不/ 需要/ 编码/ 的/ ,/ 因为/ 它们/ 已/ 被/ 采样/ ,/ 这部分/ 的/ 编码/ 大小/ 可以/ 去掉/ ./ 这些/ gap/ 所/ 占/ 总/ 空间/ 至多/ 为/ (/ n/ // b/ )/ (/ 2loggi/ +/ 1/ )/ =/ o/ (/ n/ )/ ,/ 因为/ b/ =/ (/ logn/ )/ 2/ // loglogn/ ./ 现在/ 考虑/ 结构/ SB/ ,/ B/ 和/ SAM/ 所/ 占/ 空间/ ./ 每个/ 超块/ 的/ 起始/ 位置/ 至多/ 为/ |/ S/ |/ =/ O/ (/ (/ n/ // b/ )/ (/ lognH/ )/ )/ ,/ 其中/ H/ 是/ 编码/ 每/ 符号/ 的/ 平均/ 位数/ ;/ 而/ 每块/ 在/ 其/ 超块/ 内/ 的/ 相对/ 位置/ 至多/ 为/ O/ (/ (/ logn/ )/ 2/ )/ ./ 我们/ 还/ 需/ 存储/ O/ (/ n/ // b/ )/ =/ O/ (/ n/ // (/ (/ logn/ )/ 2/ // loglogn/ )/ )/ 个/ Φ/ 值/ 采样/ ,/ 每个/ 值/ 需要/ logn/ 位/ ./ 因此/ ,/ 结构/ SB/ ,/ B/ 和/ SAM/ 所/ 占/ 总/ 空间/ 为/ O/ (/ (/ n/ // a/ )/ log/ |/ S/ |/ +/ (/ n/ // b/ )/ log/ |/ b/ |/ +/ (/ n/ // b/ )/ logn/ )/ 位/ ./ 将/ a/ =/ (/ logn/ )/ 2/ 和/ b/ =/ (/ logn/ )/ 2/ // loglogn/ 代入/ ,/ 可得/ 这/ 3/ 个/ 结构/ 所/ 占/ 总/ 空间/ 为/ (/ On/ (/ logn/ )/ 2log/ (/ )/ nH/ +/ nloglog/ (/ )/ n/ 将/ 以上/ 各/ 部分/ 所/ 占/ 空间/ 加/ 起来/ ,/ 可得/ 总/ 空间/ 界为/ 2nHk/ +/ n/ +/ 2/ σ/ k/ +/ 1logn/ +/ o/ (/ n/ )/ 位/ ./ 定理/ 1/ ./ 对于/ 任意/ k/ / clog/ σ/ n/ -/ 1/ 及/ 常数/ c/ </ 1/ ,/ Φ/ 的/ 简明/ 表示/ 所/ 占/ 空间/ 为/ 2nHk/ +/ n/ +/ o/ (/ n/ )/ 位/ ,/ 其中/ Hk/ 表示/ 文本/ T/ 的/ k/ 阶/ 经验/ 熵/ ./ 3.3/ 加速/ Φ/ 值/ 访问/ 给定/ 编码序列/ S/ 及/ 解码/ 位置/ p/ ./ 对于/ 大小/ 为/ O/ (/ logn/ )/ 的/ 块/ ,/ 最坏/ 情况/ 下/ 需要/ O/ (/ logn/ )/ 时间/ 访问/ Φ/ ./ 通过/ 维持/ 一个/ 宽度/ 为/ W/ =/ O/ (/ logn/ // 2/ )/ 的/ 表/ R/ (/ 如表/ 2/ 所示/ )/ ,/ 可/ 在/ 几乎/ 常量/ 时间/ 内/ 访问/ Φ/ ./ 表/ R/ 由/ 四/ 部分/ 组成/ ,/ 分别/ 记为/ R1/ 、/ R2/ 、/ R3/ 和/ R4/ ./ R1/ 用来/ 快速/ 确定/ 宽度/ 为/ W/ 的/ 位串/ 中/ 从/ 左端/ 起/ 连续/ 出现/ 的/ 0/ 的/ 个数/ ./ R2/ 表示/ 宽度/ 为/ W/ 的/ 位串/ 中/ 可以/ 完整/ 解码/ 的/ gap/ 数目/ ./ R3/ 表示/ 该/ 宽度/ 为/ W/ 的/ 位串/ 可以/ 正确/ 解码/ 的/ 位数/ ./ R4/ 表示/ 可以/ 正确/ 解码/ (/ gap/ )/ 值/ 的/ 累加/ 和/ ,/ 这/ 与/ 我们/ 用/ 差值/ 保存/ Φ/ 是/ 对应/ 的/ ,/ 直接/ 保存/ 累加/ 值/ ,/ 省掉/ 了/ 累加/ 的/ 过程/ ./ 例如/ ,/ 对于/ 表/ 2/ 中/ 的/ 第/ 1/ 行/ ,/ 16/ 位全/ 是/ 0/ ,/ 所以/ R1/ 列值/ 为/ 16/ ,/ 该/ 16/ 位串/ 一个/ gap/ 都/ 解码/ 不/ 出来/ ,/ 所以/ R2/ 列为/ 0/ ,/ R3/ 、/ R4/ 列/ 也/ 就/ 都/ 为/ 0/ ./ 该表中/ 的/ 第/ 6/ 行/ 的/ 位串/ 0010101110100110/ ,/ 可以/ 完整/ 解码/ 的/ gap/ 数目/ 为/ 5/ ,/ 所以/ R2/ =/ 5/ ./ 这些/ gap/ 所/ 对应/ 的/ 解码/ 位数/ 之/ 和/ 为/ 15/ ,/ 故/ R3/ =/ 15/ ,/ 解码/ gap/ 值/ 总和/ R4/ =/ 14/ ,/ 所剩/ 1/ 位是/ 不可/ 解码/ 的/ ./ 0000000000000000160000000000000000001150000000000111111110711525500101011101001102515140010110010101110251515101010100111100107131111111111111111110161616/ 可用/ 2WlogW/ 位/ 存储/ 每个/ Ri/ (/ i/ =/ 1/ ,/ 2/ ,/ 3/ )/ 表/ ,/ 因为/ 每个/ Ri/ 表中/ 的/ 元素/ 在/ [/ 1/ ,/ W/ ]/ 中取/ 整数/ 值/ ,/ 因而/ 每个/ 元素/ 可用/ logW/ 位/ 表示/ ./ 代入/ W/ =/ logn/ // 2/ ,/ 可得/ 这/ 3/ 个表所/ 占/ 总/ 空间/ 为/ 3/ 槡/ n/ (/ loglogn/ -/ 1/ )/ 位/ ./ 类似/ 分析/ 可得/ R4/ 所/ 占/ 空间/ 为/ (/ 1/ // 4/ )/ 槡/ nlogn/ 位/ ,/ 因为/ R4/ 至多/ 有/ 2W/ // 2/ 个/ 元素/ ,/ 每个/ 元素/ 至/ 多用/ logn/ 表示/ ./ 因此/ ,/ R/ 表所/ 需/ 总/ 空间/ 为/ 3/ 槡/ n/ (/ loglogn/ -/ 1/ )/ +/ (/ 1/ // 4/ )/ 槡/ nlogn/ =/ o/ (/ n/ )/ 位/ ./ 利用/ R/ 表/ ,/ 可以/ 加速/ Φ/ (/ i/ )/ 值/ 的/ 获取/ ./ 设/ i/ 表示/ 需要/ 解码/ 的/ 次数/ ,/ temp/ 表示/ 某次/ 查找/ 表/ 可以/ 解码/ 的/ Gamma/ 编码/ 数/ (/ 即/ 可以/ 解码/ 的/ gap/ 数/ )/ ,/ num/ 表示/ 已经/ 解码/ 的/ 编码/ 个数/ ,/ 则/ 获取/ Φ/ 的/ 过程/ 如下/ :/ (/ 1/ )/ 读取/ SAM/ 、/ SB/ 和/ B/ ,/ 得到/ 采样/ 值/ 和/ 偏移量/ ./ Page7/ (/ 2/ )/ 读取/ W/ 位/ ,/ 用/ 查找/ 表/ 解码/ ,/ temp/ 为/ 本次/ 可以/ 解码/ 的/ Gamma/ 编码/ 数/ ,/ 更新/ num/ =/ num/ +/ temp/ ,/ 如果/ num/ </ i/ ,/ 重复/ 该步/ ,/ 否则/ ,/ 后退/ 一步/ ,/ 抛弃/ 本次/ 解码/ 值/ ,/ 转到/ 步/ (/ 3/ )/ ./ (/ 3/ )/ 由步/ (/ 2/ )/ 的/ 结束/ 位置/ 开始/ ,/ 顺序/ 解码/ ,/ 每/ 解码/ 一次/ ,/ num/ 自增/ ,/ 直至/ num/ =/ i/ 为止/ ,/ 此时/ 返回/ 解码/ 值/ 的/ 累加/ 和/ ./ 假设/ 待/ 解码/ 序列/ 为/ S/ ,/ 当前/ 位置/ 为/ p/ ,/ 需要/ 连续/ 解码/ 10/ 次/ ,/ 则/ 利用/ 查找/ 表/ 的/ 解码/ 过程/ 如下/ :/ 获取/ S/ 序列/ 的/ 前/ W/ (/ W/ =/ 16/ )/ 位/ ,/ 不妨/ 说/ 1010101001111001/ ,/ 查表/ R2/ ,/ 发现/ 该/ 16/ 位串/ 可以/ 解码/ 7/ 个数/ (/ gap/ )/ ,/ 即该/ 16/ 位串/ 包含/ 7/ 个/ 完整/ 的/ Gamma/ 编码/ ,/ 查表/ R4/ ,/ 得到/ 对应/ 解码/ (/ gap/ )/ 的/ 累加/ 值/ ,/ 即/ 11/ ,/ 查表/ R3/ 得到/ 正确/ 解码/ 的/ 位数/ ,/ 即/ 这/ 7/ 个/ 完整/ Gamma/ 编码/ 的/ 解码/ 位数/ 总和/ 为/ 13/ 位/ ,/ 所以/ 本次/ 查表/ 解码/ 7/ 个数/ ,/ 累加/ 值为/ 11/ ,/ 正确/ 解码/ 的/ 位数/ 为/ 13/ ./ 下/ 一次/ 从/ p/ +/ 13/ 位置/ 开始/ ,/ 再/ 解码/ 10/ -/ 7/ =/ 3/ 次/ ,/ 继续/ 累加/ 即可/ ,/ 新/ 的/ 16/ 位串/ 为/ 0010101110100110/ ,/ 查表/ R2/ ,/ 该串/ 可以/ 解码/ 5/ 个数/ ,/ 大于/ 剩余/ 解码/ 次数/ 3/ ,/ 则/ 结合/ R1/ 表/ ,/ 按照/ 步/ 3/ ,/ 顺序/ 解码/ 3/ 次/ ,/ 分别/ 得到/ 5/ ,/ 3/ ,/ 1/ ,/ 与/ gap/ 当前/ 累加/ 值/ 累加/ ,/ 得到/ decompress/ (/ S/ ,/ p/ ,/ 10/ )/ =/ 20/ ,/ 则/ 一个/ 完整/ 的/ decompress/ 操作/ 完成/ ./ 3.4/ 字符/ 频数/ 统计/ 统计/ 字符/ 频数/ 是/ 为了/ 支持/ 自/ 索引/ ./ 按照/ 字典/ 序/ ,/ C/ [/ x/ ]/ 表示/ 原文/ 本/ T/ 中/ 所有/ 小于/ x/ 的/ 字符/ 出现/ 次数/ 总和/ ,/ C/ [/ x/ ]/ 的/ 实际/ 含义/ 为/ :/ 第/ 1/ 次以/ 字符/ x/ 打头/ 的/ 后缀/ 的/ 排名/ ./ 表/ 3/ 给出/ 了/ 图/ 1/ 中/ 文本/ T/ 的/ C/ 值/ ./ 为了/ 方便/ ,/ 我们/ 在/ 字符/ 频数/ 统计表/ 的/ 最后/ 一个/ 位置/ 增添/ 一项/ ,/ 填入/ n/ 值/ ./ abcdefg04101620233036/ 利用/ C/ 表/ 和/ Φ/ 的/ 表示/ 结构/ ,/ 可以/ 恢复/ SA/ [/ i/ ]/ 对应/ 的/ 后缀/ T/ [/ SA/ [/ i/ ]/ ../ n/ -/ 1/ ]/ ,/ 因此/ T/ 可以/ 丢弃/ ./ 对于/ i/ =/ j/ ,/ Φ/ [/ j/ ]/ ,/ Φ/ [/ Φ/ [/ j/ ]/ ]/ …/ ,/ 后缀/ T/ [/ SA/ [/ i/ ]/ ../ n/ -/ 1/ ]/ 的/ 第/ 1/ 个字符/ T/ [/ SA/ [/ i/ ]/ ]/ 在/ SA/ 中是/ 连续/ 且/ 字符/ 表/ 有序/ 的/ ./ 因而/ T/ [/ SA/ [/ i/ ]/ ]/ 必定/ 为/ 满足/ C/ [/ c/ ]/ </ i/ / C/ [/ c/ +/ 1/ ]/ 的/ 字符/ ./ 因此/ 我们/ 可以/ 首先/ 对/ i/ 在/ C/ 上/ 做/ 二分/ 查找/ ,/ 确定/ i/ 所属/ 的/ 字符/ 区间/ ,/ 然后/ 利用/ 以下/ 的/ incode/ 表/ ,/ 就/ 可以/ 恢复/ 出/ 首/ 字符/ ,/ 然后/ 改变/ i/ 为/ Φ/ [/ i/ ]/ ,/ 重复/ 上述/ 过程/ ,/ 即可/ 恢复/ 后缀/ T/ [/ SA/ [/ i/ ]/ ../ n/ -/ 1/ ]/ ./ 字符/ 重/ 映射/ 的/ 含义/ 为/ :/ 假设/ T/ 中/ 出现/ 了/ σ/ 个/ 不同/ 的/ 字符/ ,/ 按照/ 其/ ASCII/ 编码/ 排序/ 这/ σ/ 个字符/ ,/ 由小到大/ 重/ 映射/ 为/ 0/ ~/ σ/ -/ 1/ ,/ 即/ 编码/ 为/ 0/ ~/ σ/ -/ 1/ ./ 在/ 需要/ 时/ ,/ 也/ 需要/ 把/ 0/ ~/ σ/ -/ 1/ 之内/ 的/ 数字编码/ 值/ 再/ 映射/ 回原/ 字符/ ./ 这/ 两个/ 映射/ 可以/ 使用/ 大小/ 分别/ 为/ 256/ 和/ σ/ 的/ 数组/ 完成/ ./ 以图/ 1/ 为例/ ,/ 假设/ code/ 表/ 完成/ 由/ 字符/ 到/ 编码/ 的/ 映射/ ,/ incode/ 表/ 完成/ 由/ 编码/ 到/ 字符/ 的/ 映射/ ,/ 表/ 4/ 和表/ 5/ 分别/ 给出/ 了/ 这/ 两个/ 映射/ 的/ 实例/ ./ 字符/ 0/ …/ abcdefg/ …/ 255/ 编码/ …/ …/ 0123456/ …/ …/ 编码/ 0123456/ 字符/ a4/ 索引/ 构造/ 我们/ 可/ 在/ O/ (/ n/ )/ 的/ 时间/ 内/ 完成/ 压缩/ 后缀/ 数组/ 构造/ (/ 不/ 包括/ 计算/ 后缀/ 数组/ 的/ 时间/ )/ ,/ 主要/ 由/ 4/ 步/ 组成/ ./ 步/ 1/ (/ 预处理/ )/ ./ 读取/ 原文件/ T/ ,/ 计算/ 字符/ 频数/ 统计表/ C/ ,/ 计算/ SA/ ./ 步/ 2/ (/ 构造/ Φ/ 数组/ )/ ./ 利用/ 表/ C/ 、/ SA/ 、/ T/ 计算/ Φ/ 值/ ,/ 删除/ T/ ./ 步/ 3/ (/ 采样/ SA/ &/ SA/ -/ 1/ )/ ./ 采样/ SA/ 和/ SA/ -/ 1/ 数组/ ,/ 保存/ 采样/ 值/ ,/ 删除/ SA/ ./ 步/ 4/ (/ 编码/ Φ/ )/ ./ 采样/ 、/ 编码/ Φ/ 数组/ ,/ 即用/ 图/ 1/ 中/ 的/ S/ 、/ SB/ 、/ B/ 和/ SAM/ 结构/ 保存/ Φ/ 数组/ ,/ 完成/ 之后/ ,/ 删除/ Φ/ 数组/ ./ 4.1/ 构造/ 近邻/ 函数/ Φ/ 读取/ 源文件/ ,/ 完成/ 统计/ 工作/ ,/ 必要/ 时/ 过滤/ 非法/ 字符/ ,/ 创建/ 字符/ 统计表/ C/ 、/ 字符/ 映射/ 表/ code/ 、/ 重/ 映射/ 表/ incode/ ,/ 计算/ SA/ 等/ 都/ 可以/ 在/ 这/ 一步/ 完成/ ./ 算法/ constructPhi/ 给出/ 了/ 近邻/ 函数/ Φ/ 的/ 构造/ 过程/ ./ 算法/ 1/ ./ constructPhi/ ./ 输入/ :/ C/ ,/ SA/ ,/ T/ 输出/ :/ Φ/ 1/ ./ temp/ ←/ C/ [/ lastchar/ ]/ 2/ ./ FORi/ ←/ 0ton/ -/ 1DO3/ ./ pos/ ←/ SA/ [/ i/ ]/ 4/ ./ IFpos/ =/ 0THEN5/ ./ h/ ←/ i6/ ./ ELSE7/ ./ c/ ←/ T/ [/ pos/ -/ 1/ ]/ 8/ ./ Φ/ [/ C/ [/ c/ ]/ ]/ ←/ i9/ ./ C/ [/ c/ ]/ ←/ C/ [/ c/ ]/ +/ 110/ ./ Φ/ [/ temp/ ]/ ←/ h11/ ./ RETURN/ Φ/ Page8/ 算法/ 计算公式/ (/ 1/ )/ 中/ 定义/ 的/ Φ/ 值/ ./ 第/ 1/ 行/ 记录/ 后缀/ T/ [/ n/ -/ 1/ ]/ (/ lastchar/ 是/ T/ 的/ 最后/ 一个/ 字符/ )/ 的/ 排名/ ,/ 保存/ 在/ temp/ 中/ ,/ 即/ SA/ [/ temp/ ]/ =/ n/ -/ 1/ ./ 算法/ 的/ 第/ 4/ 、/ 5/ 行/ 记录/ SA/ [/ i/ ]/ =/ 0/ 时/ 的/ i/ 值/ ,/ 保存/ 在/ h/ 中/ ./ 根据/ 式/ (/ 1/ )/ ,/ Φ/ [/ temp/ ]/ =/ h/ ,/ 因为/ SA/ [/ h/ ]/ =/ (/ SA/ [/ temp/ ]/ +/ 1/ )/ modn/ =/ 0/ ./ 对于/ 图/ 1/ 中/ 的/ 示例/ ,/ SA/ [/ 0/ ]/ =/ 0/ ,/ 所以/ h/ =/ 0/ ,/ C/ [/ lastchar/ ]/ =/ C/ [/ f/ ]/ =/ 23/ ,/ 故/ temp/ =/ 23/ ,/ 所以/ Φ/ [/ 23/ ]/ =/ 0/ ./ 显然/ ,/ 该/ 算法/ 的/ 时间/ 复杂度/ 为/ O/ (/ n/ )/ ./ 该/ 算法/ 基于/ 以下/ 事实/ :/ 当/ 扫描/ 整个/ 后缀/ 数组/ 时/ ,/ 假设/ 此时/ 在/ 处理/ 后缀/ SA/ [/ i/ ]/ =/ j/ ,/ 如果/ c/ =/ T/ [/ j/ -/ 1/ ]/ ,/ 且/ c/ 是/ 在/ 某个/ 后缀/ 之前/ 第/ k/ 次/ 出现/ ,/ 则/ c/ -/ list/ [/ k/ ]/ =/ i/ ,/ 即/ Φ/ [/ C/ [/ c/ ]/ ]/ =/ i/ ./ 算法/ 第/ 9/ 行中/ C/ [/ c/ ]/ 每次/ 自增/ ,/ 所以/ C/ [/ c/ ]/ 始终/ 指向/ c/ -/ list/ 表中/ 第/ 1/ 个/ 需要/ 赋值/ 的/ 单元/ ./ 在/ 算法/ 伪/ 代码/ 的/ 描述/ 中/ ,/ 我们/ 假设/ 数组/ C/ [/ ]/ 是/ 一个/ 局部变量/ ./ 当/ 算法/ constructPhi/ 执行/ 完时/ ,/ C/ 表值/ 复位/ ./ 4.2/ 采样/ 犛/ 犃/ 及/ 犛/ 犃/ -/ 1/ 被/ 采样/ 的/ 后缀/ 数组/ SA/ 及/ 逆/ 后缀/ 数组/ SA/ -/ 1/ 中/ 的/ 点将/ 作为/ 锚点/ (/ anchor/ )/ 保留/ 下来/ ,/ 用来/ 恢复/ 未/ 采样/ 点/ 的/ 值/ ./ 采样/ 过程中将/ 产生/ SAl/ 和/ SA/ -/ 1/ 设/ SA/ 的/ 采样/ 步长/ 为/ c/ ,/ SA/ -/ 1/ 的/ 采样/ 步长/ 为/ d/ ,/ 采样/ 过程/ 如下/ ./ 算法/ 2/ ./ samplingSA/ &/ SA/ -/ 1/ ./ 输入/ :/ SA/ ,/ c/ ,/ d/ 输出/ :/ SAl/ ,/ SA/ -/ 11/ ./ k/ ←/ (/ n/ -/ 1/ )/ // c2/ ./ FORi/ ←/ 0tok/ -/ 1DO3/ ./ SAl/ [/ i/ ]/ ←/ SA/ [/ i/ ·/ c/ ]/ 4/ ./ FORi/ ←/ 0ton/ -/ 1DO5/ ./ IFSA/ [/ i/ ]/ modd/ =/ 0THEN6/ ./ SA/ -/ 17/ ./ RETURNSAlandSA/ -/ 1l/ 算法/ 的/ 第/ 2/ ~/ 3/ 行/ 计算/ SAl/ ,/ 每隔/ c/ 个/ SA/ 值/ 采样/ 一个/ 值/ ,/ 即/ 保留/ 那些/ 下标/ 为/ c/ 的/ 倍数/ 的/ SA/ [/ i/ ]/ 值/ ,/ SAl/ 结构/ 可用/ 来/ 支持/ getpos/ 过程/ (/ 第/ 5/ 节中/ 描述/ )/ ,/ 用于/ 返回/ SA/ [/ i/ ]/ 的/ 值/ ./ 第/ 4/ ~/ 6/ 行/ 计算/ SA/ -/ 1/ 是/ 对/ 逆/ 后缀/ 数组/ SA/ -/ 1/ 进行/ 采样/ (/ 利用/ SA/ 与/ SA/ -/ 1/ 互逆/ 的/ 特点/ ,/ 所以/ 采样/ 时/ 不/ 需要/ SA/ -/ 1/ 的/ 存在/ )/ ,/ 用来/ 支持/ extract/ (/ start/ ,/ len/ )/ 操作/ ,/ 即/ 返回/ T/ [/ start/ ../ start/ +/ len/ -/ 1/ ]/ ./ 我们/ 知道/ ,/ 对于/ 某个/ 已知/ 具体/ 排名/ 的/ 后缀/ 可以/ 方便/ 的/ 恢复/ 该/ 后缀/ ,/ 所以/ 如何/ 将/ 位置/ start/ 转换成/ 排名/ i/ 成为/ 唯一/ 的/ 难点/ ./ 我们/ 可以/ 首先/ 确定/ start/ // d/ 的/ 排名/ i/ ,/ 再/ 重复/ 执行/ startmodd/ 次/ i/ ←/ Φ/ [/ i/ ]/ 即可/ ./ 得到/ 排名/ 后/ ,/ 按照/ 3.4/ 节/ 的/ 方法/ ,/ 就/ 可以/ 恢复/ T/ [/ start/ ../ start/ +/ len/ -/ 1/ ]/ ,/ 当然/ 我们/ 需要/ 处理/ start/ +/ len/ 大于/ n/ 的/ 情况/ ./ 4.3/ 编码/ Φ/ 该/ 过程/ 主要/ 完成/ S/ 、/ SB/ 、/ B/ 和/ SAM/ 这/ 4/ 个/ 结构/ 的/ 初始化/ 工作/ ./ 假设/ 超块/ 长度/ 为/ a/ ,/ 块/ 长度/ 为/ b/ ,/ 且/ a/ 是/ b/ 的/ 倍数/ ,/ 并/ 假设/ S/ 、/ SB/ 、/ B/ 和/ SAM/ 所需/ 空间/ 已经/ 在/ 该步/ 的/ 预处理/ 阶段/ 分配/ 完成/ ./ 算法/ 过程/ 如下/ ./ 算法/ 3/ ./ codingPhi/ ./ 输入/ :/ Φ/ 输出/ :/ S/ ,/ SB/ ,/ B/ ,/ SAM1/ ./ Initializeindex1/ ,/ index2/ ,/ index3/ ,/ len1/ ,/ len2tobe02/ ./ FORi/ ←/ 0ton/ -/ 1DO3/ ./ IFimoda/ =/ 0THEN4/ ./ len2/ ←/ len15/ ./ SB/ [/ index3/ ]/ ←/ len26/ ./ index3/ ←/ index3/ +/ 17/ ./ IFimodb/ =/ 0THEN8/ ./ SAM/ [/ index1/ ]/ ←/ Φ/ [/ i/ ]/ 9/ ./ index1/ ←/ index1/ +/ 110/ ./ B/ [/ index2/ ]/ ←/ len1/ -/ len211/ ./ index2/ ←/ index2/ +/ 112/ ./ pre/ ←/ Φ/ [/ i/ ]/ 13/ ./ ELSE14/ ./ gap/ ←/ Φ/ [/ i/ ]/ -/ pre15/ ./ IFgap/ </ 0THEN16/ ./ gap/ ←/ gap/ +/ n17/ ./ pre/ ←/ Φ/ [/ i/ ]/ 18/ ./ len1/ ←/ len1/ +/ 2bl/ (/ gap/ )/ -/ 119/ ./ append/ (/ gap/ ,/ S/ )/ 20/ ./ RETURNS/ ,/ SB/ ,/ B/ ,/ andSAM/ 当/ 第/ 3/ 行/ 的/ IF/ 条件/ 成立/ 时/ ,/ 该点/ 就是/ 超块/ 的/ 采样/ 点/ ,/ 只/ 保留/ 采样/ 点/ 在/ Gamma/ 编码/ 串中/ 的/ 绝对/ 偏移量/ ,/ index3/ 是/ 该/ 结构/ (/ 超块/ )/ 的/ 下标/ ./ 第/ 7/ 行/ 的/ IF/ 条件/ 成立/ 时/ ,/ 该点/ 对应/ 块/ 的/ 一个/ 采样/ 点/ ,/ 需要/ 保留/ 采样/ 点/ 的/ Φ/ 值/ ./ 第/ 8/ ~/ 9/ 行/ 完成/ 这一/ 工作/ ,/ 也/ 需要/ 保存/ 该/ 采样/ 点/ 相对/ 于/ 所属/ 超块/ 采样/ 点/ 的/ 偏移量/ ,/ 所以/ 第/ 10/ 行/ 保存/ len1/ ~/ len2/ ,/ 显然/ len2/ 为/ 采样/ 点/ 所属/ 超块/ 的/ 绝对/ 偏移量/ ,/ len1/ 为/ 当前/ S/ 序列/ 的/ 长度/ ./ 第/ 12/ 行/ 和/ 17/ 行/ 更新/ pre/ 值/ ,/ 表示/ 前/ 一个/ Φ/ 值/ ./ 当前/ 两个/ IF/ 条件/ 都/ 不/ 成立/ 时/ ,/ 执行/ 14/ ~/ 19/ 行/ ,/ 计算/ 差值/ gap/ ,/ 如果/ 发生/ gap/ </ 0/ 的/ 情况/ ,/ 第/ 16/ 行/ 修正/ ./ 第/ 18/ 行/ bl/ (/ gap/ )/ 表示/ gap/ 的/ 二进制码/ 长/ ,/ 所以/ 2bl/ (/ gap/ )/ -/ 1/ 就是/ gap/ 的/ Gamma/ 编码/ 长度/ ./ 第/ 19/ 行/ append/ 操作/ 把/ gap/ 值/ 按照/ Gamma/ 编码/ 的/ 方式/ ,/ 追加/ 到/ S/ 结构/ 上/ ./ 显然/ ,/ 整个/ 过程/ 的/ 时间/ 复杂度/ 为/ O/ (/ n/ )/ ./ 因此/ ,/ 索引/ CSA/ 的/ 构造/ 过程/ 可以/ 在/ 线性/ 时间/ 内/ 完成/ ,/ 最终/ 保存/ 的/ 结构/ 为/ S/ 、/ SB/ 、/ B/ 、/ SAM/ 、/ SAl/ 和/ Page9l/ 结构/ ,/ S/ 、/ SB/ 、/ B/ 和/ SAM/ 加在一起/ 在/ 逻辑/ 上充/ SA/ -/ 1/ 当/ Φ/ 数组/ ,/ Φ/ [/ i/ ]/ 可由式/ (/ 4/ )/ 得到/ ./ 也/ 可以/ 用/ 3.3/ 节/ 介绍/ 的/ 查找/ 表/ 加速/ 计算/ ./ 5/ 模式匹配/ 5.1/ 查找/ 查找/ 过程/ 可以/ 分为/ 计数/ 查询/ 和/ 定位/ 查询/ ,/ 分别/ 用/ count/ 和/ locate/ 表示/ ./ count/ 返回/ 模式/ P/ 在/ T/ 中/ 的/ 出现/ 次数/ ./ 本质/ 上/ 说/ ,/ count/ 查询/ 确定/ T/ 中以/ P/ 为/ 前缀/ 的/ 那些/ 后缀/ 的/ 范围/ [/ L/ ,/ R/ ]/ ./ 一旦/ 完成/ count/ 查询/ ,/ 我们/ 就/ 能/ 得到/ [/ L/ ,/ R/ ]/ 中/ 每个/ 后缀/ 在/ T/ 中/ 的/ 起始/ 位置/ ./ 算法/ 采用/ 后/ 向/ 查找/ 技术/ ,/ 并/ 结合/ 3.4/ 节/ 的/ C/ 表/ ,/ 可以/ 实现/ 自/ 索引/ ./ 算法/ 摆脱/ 了/ 基于/ 字符串/ 比较/ 的/ 查询/ 框架/ ,/ 在/ 查询/ 的/ 过程/ 中/ ,/ 不断/ 利用/ Φ/ 数组/ ,/ 缩小/ 结果/ 范围/ [/ L/ ,/ R/ ]/ ,/ 当/ 迭代/ 到/ 模式/ 的/ 首/ 字符/ 时/ ,/ SA/ [/ L/ ,/ R/ ]/ 内/ 的/ 所有/ 后缀/ 都/ 以/ P/ 为/ 前缀/ ,/ 算法/ 描述/ 如下/ ./ 算法/ 4/ ./ count/ ./ 输入/ :/ P/ ,/ Φ/ 输出/ :/ L/ ,/ R1/ ./ c/ ←/ P/ [/ m/ -/ 1/ ]/ 2/ ./ L/ ←/ C/ [/ c/ ]/ 3/ ./ R/ ←/ C/ [/ c/ +/ 1/ ]/ -/ 14/ ./ FORi/ ←/ m/ -/ 2downto0DO5/ ./ c/ ←/ P/ [/ i/ ]/ 6/ ./ LL/ ←/ C/ [/ c/ ]/ 7/ ./ RR/ ←/ C/ [/ c/ +/ 1/ ]/ -/ 18/ ./ newL/ ←/ min/ {/ j/ :/ j/ ∈/ [/ LL/ ,/ RR/ ]/ &/ Φ/ [/ j/ ]/ ∈/ [/ L/ ,/ R/ ]/ }/ 9/ ./ newR/ ←/ max/ {/ j/ :/ j/ ∈/ [/ LL/ ,/ RR/ ]/ &/ Φ/ [/ j/ ]/ ∈/ [/ L/ ,/ R/ ]/ }/ 10/ ./ L/ ←/ newL11/ ./ R/ ←/ newR12/ ./ IFL/ >/ RTHEN13/ ./ RETURN/ “/ patterndoesnotexist/ ”/ 14/ ./ ELSE15/ ./ RETURNLandR/ 其中/ m/ 表示/ P/ 的/ 长度/ ,/ 第/ 8/ ~/ 9/ 行/ 的/ 含义/ 为/ 确定/ 新/ 的/ 左右/ 边界/ ,/ 该/ 算法/ 建立/ 在/ Φ/ 变换/ 的/ 实际/ 含义/ 和/ 特点/ 上/ ./ 该/ 算法/ 由/ 模式/ 的/ 最后/ 一个/ 字符/ 开始/ ,/ 循环/ 到/ 模式/ 的/ 第/ 1/ 个字符/ 结束/ ./ 显然/ ,/ 该/ 算法/ 在/ 执行/ 过程/ 中/ 保持/ 下列/ 循环/ 不变式/ :/ 当/ 算法/ 执行/ 完/ 倒数第/ k/ 个字符/ 时/ ,/ [/ L/ ,/ R/ ]/ 区间/ 之内/ 的/ 后缀/ 以/ 模式/ P/ 的/ 后/ k/ 个字符/ 为/ 前缀/ ,/ 证明/ 如下/ :/ 初始化/ ./ 算法/ 执行/ 1/ ~/ 3/ 行/ ,/ 完成/ 初始化/ ,/ 显然/ 此时/ L/ 对应/ c/ -/ list/ 的/ 第/ 1/ 个/ 元素/ ,/ R/ 对应/ c/ -/ list/ 的/ 最后/ 一个/ 元素/ ,/ 所以/ 此时/ 区间/ [/ L/ ,/ R/ ]/ 就是/ c/ -/ list/ 区间/ ,/ 该/ 区间/ 内/ 的/ 所有/ 后缀/ 均/ 以/ 字符/ c/ 开头/ ,/ 得证/ ./ 保持/ ./ 假设/ 算法/ 已经/ 执行/ 到/ 了/ 倒数第/ k/ 个字符/ c/ ,/ 即/ 此时/ 区间/ [/ L/ ,/ R/ ]/ 内/ 的/ 后缀/ 以/ 模式/ P/ 最后/ 面/ 的/ k/ -/ 1/ 个字符/ 为/ 前缀/ ./ 算法/ 在/ 第/ 6/ ~/ 7/ 行/ 确定/ c/ -/ list/ 的/ 区间/ [/ LL/ ,/ RR/ ]/ ,/ 并且/ 该/ 区间/ 内/ 的/ Φ/ 值/ 都/ 是/ 升序/ 的/ ./ Φ/ [/ i/ ]/ 值/ 的/ 实际/ 含义/ 为/ 该/ 后缀/ “/ 剔除/ ”/ 掉首/ 字符/ 后/ 的/ 后缀/ 的/ 排名/ ,/ 如果/ T/ 中/ 包含/ 该/ 模式/ ,/ 即会/ 出现/ pkpk/ -/ 1pk/ -/ 2/ …/ plen/ -/ 1/ ,/ 那么/ 区间/ [/ LL/ ,/ RR/ ]/ 中/ 一定/ 有/ 一个/ 连续/ 片段/ [/ newL/ ,/ newR/ ]/ ,/ 其中/ 所有/ 的/ Φ/ 值/ 都/ 在/ 区间/ [/ L/ ,/ R/ ]/ 内/ ,/ 因为/ [/ L/ ,/ R/ ]/ 区间/ 内/ 的/ 后缀/ 都/ 以/ pk/ -/ 1pk/ -/ 2/ …/ plen/ -/ 1/ 为/ 前缀/ ,/ 所以/ 执行/ 完该/ 次/ 循环/ ,/ 以/ [/ newL/ ,/ newR/ ]/ 为/ 新/ 的/ [/ L/ ,/ R/ ]/ ,/ 即该/ 区间/ 内/ 的/ 后缀/ 都/ 以/ 模式/ 的/ 最后/ k/ 个字符/ 为/ 前缀/ ./ 结束/ ./ 算法/ 有/ 两个/ 退出/ 位置/ ,/ 第/ 13/ 行/ 或/ 第/ 14/ 行/ ./ 由/ 第/ 13/ 行/ 退出/ 时/ ,/ 表示/ 模式/ 不/ 存在/ ,/ 当由/ 第/ 14/ 行/ 退出/ 时/ ,/ 区间/ [/ L/ ,/ R/ ]/ 内/ 的/ 所有/ 后缀/ 都/ 以/ 模式/ P/ 为/ 前缀/ ./ 因此/ 当该/ 算法/ 结束/ 时/ ,/ 当/ L/ / R/ 时/ ,/ 模式/ 出现/ R/ -/ L/ +/ 1/ 次/ ,/ 当由/ 第/ 13/ 行/ 退出/ 时/ ,/ L/ >/ R/ ,/ 表示/ 模式/ 没有/ 出现/ ./ 以/ P/ =/ “/ bga/ ”/ 为例/ ,/ 算法/ 执行/ 过程/ 如下/ :/ 1/ ~/ 3/ 行/ 初始化/ ./ 确定/ 区间/ L/ =/ C/ [/ a/ ]/ =/ 0/ ,/ R/ =/ C/ [/ a/ +/ 1/ ]/ -/ 1/ =/ C/ [/ b/ ]/ -/ 1/ =/ 3/ ,/ 即/ 区间/ [/ L/ ,/ R/ ]/ =/ [/ 0/ ,/ 3/ ]/ 内/ 的/ 后缀/ 都/ 以/ 字符/ a/ 打头/ ,/ 对应/ a/ -/ list/ ./ 第/ 1/ 次/ 循环/ ./ 此时/ LL/ =/ C/ [/ g/ ]/ =/ 30/ ,/ RR/ =/ C/ [/ g/ +/ 1/ ]/ -/ 1/ =/ 35/ ,/ 即/ 区间/ [/ 30/ ,/ 35/ ]/ 内/ 的/ 后缀/ 都/ 以/ 字符/ g/ 打头/ ,/ [/ 30/ ,/ 35/ ]/ 内/ 的/ Φ/ 值为/ {/ 1/ ,/ 3/ ,/ 5/ ,/ 13/ ,/ 16/ ,/ 19/ }/ ,/ 其中/ 前/ 两个/ 的/ Φ/ 值/ 属于/ 区间/ [/ L/ ,/ R/ ]/ ,/ 所以/ [/ newL/ ,/ newR/ ]/ 为/ [/ 30/ ,/ 31/ ]/ ,/ 第/ 10/ 、/ 11/ 行将/ [/ L/ ,/ R/ ]/ 更新/ 为/ [/ 30/ ,/ 31/ ]/ ,/ 即该/ 区间/ 内/ 的/ 后缀/ 以/ “/ ga/ ”/ 为/ 前缀/ ,/ 可以/ 从图/ 1/ 得到/ 验证/ ./ 第/ 2/ 次/ 循环/ ./ 此时/ [/ L/ ,/ R/ ]/ 为/ [/ 30/ ,/ 31/ ]/ ,/ LL/ =/ C/ [/ b/ ]/ =/ 4/ ,/ RR/ =/ C/ [/ b/ +/ 1/ ]/ -/ 1/ =/ C/ [/ c/ ]/ -/ 1/ =/ 9/ ,/ [/ 4/ ,/ 9/ ]/ 内/ 的/ Φ/ 值为/ {/ 24/ ,/ 25/ ,/ 29/ ,/ 30/ ,/ 31/ ,/ 35/ }/ ,/ 所以/ [/ newL/ ,/ newR/ ]/ =/ [/ 7/ ,/ 8/ ]/ ,/ 满足/ R/ / L/ 的/ 条件/ ,/ 更新/ [/ L/ ,/ R/ ]/ 为/ [/ 7/ ,/ 8/ ]/ ,/ 循环/ 结束/ ,/ 返回/ ./ 所以/ 最终/ [/ 7/ ,/ 8/ ]/ 区间/ 内/ 的/ 后缀/ 以/ “/ bga/ ”/ 为/ 前缀/ ./ 在/ 具体/ 确定/ newL/ 和/ newR/ 时/ ,/ 由于/ [/ LL/ ,/ RR/ ]/ 区间/ 内/ 的/ Φ/ 值/ 都/ 是/ 升序/ 的/ 且/ 采样/ 点/ 的/ 值/ 是/ 直接/ 存储/ 的/ ,/ 所以/ 先/ 在/ 采样/ 点上/ 执行/ 二分/ 查找/ ,/ 确定/ newL/ 、/ newR/ 的/ 目标/ 区间/ Bi/ ,/ 然后/ 在/ 目标/ 区间/ Bi/ 上/ 利用/ 查找/ 表/ 顺序/ 解码/ ,/ 确定/ 具体/ 的/ 位置/ ./ 采样/ 点上/ 二分/ 过程/ 的/ 时间/ 复杂度/ 为/ O/ (/ log/ (/ n/ // b/ )/ )/ ,/ b/ 表示/ 块/ 大小/ ./ 假设/ H/ 表示/ Gamma/ 编码/ 的/ 平均/ 长度/ ,/ 则/ 一个/ B/ 块/ 对应/ bH/ 位/ ,/ 一次/ 查找/ 表/ 可以/ 解码/ W/ 位/ ,/ W/ 表示/ 查找/ 表/ 宽度/ ,/ 所以/ 顺序/ 解码/ 过程/ 的/ 复杂度/ 为/ O/ (/ bH/ // W/ )/ ./ 所以/ 算法/ Page10/ 第/ 8/ ~/ 9/ 行/ 的/ 复杂度/ 为/ O/ (/ log/ (/ n/ // b/ )/ +/ bH/ // W/ )/ ./ 对于/ 块/ 大小/ b/ =/ (/ logn/ )/ 2/ // loglogn/ ,/ 计数/ 查询/ 算法/ 的/ 时间/ 复杂度/ 为/ O/ (/ mlogn/ // loglogn/ )/ ,/ m/ 为/ 模式/ P/ 的/ 长度/ ./ 算法/ 的/ 返回值/ 为/ L/ 和/ R/ ,/ 表示/ 区间/ SA/ [/ L/ ,/ R/ ]/ 内/ 的/ 后缀/ 以/ 模式/ P/ 作为/ 前缀/ ,/ 故/ P/ 出现/ 的/ 次数/ 为/ R/ -/ L/ +/ 1/ 次/ ./ 如果/ 查询/ 的/ 模式/ 不/ 存在/ ,/ 某次/ 循环/ 第/ 12/ 行/ 的/ IF/ 条件/ 将/ 成立/ ,/ 跳出/ 循环/ ,/ 直接/ 返回/ 模式/ 不/ 存在/ ./ 定理/ 2/ ./ 给定/ 长为/ m/ 的/ 模式/ P/ ,/ 借助于/ 查找/ 表/ R/ (/ 3.3/ 节/ 描述/ )/ ,/ 计数/ 查询/ 可/ 在/ O/ (/ mlogn/ // loglogn/ )/ 时间/ 内/ 完成/ ,/ 空间/ 占用/ 由/ 定理/ 1/ 给出/ ,/ 额外/ C/ 表/ 开销/ 为/ σ/ logn/ 位/ ,/ 其中/ σ/ 为/ 字符/ 表/ 大小/ ./ 算法/ locate/ 以/ count/ 过程/ 返回/ 的/ [/ L/ ,/ R/ ]/ 作为/ 输入/ ,/ 然后/ 利用/ getpos/ (/ i/ )/ 操作/ 确定/ SA/ [/ i/ ]/ 的/ 值/ ,/ i/ ∈/ [/ L/ ,/ R/ ]/ ./ 在/ T/ 中/ 的/ 起始/ 位置/ ./ 算法/ 过程/ 如下/ ./ 算法/ 5/ ./ locate/ ./ 输入/ :/ P/ ,/ L/ ,/ R/ 输出/ :/ ans1/ ./ ans/ [/ 0/ …/ R/ -/ L/ ]/ ←/ 02/ ./ FORi/ ←/ LtoRDO3/ ./ ans/ [/ i/ -/ L/ ]/ ←/ getpos/ (/ i/ )/ 4/ ./ RETURNansgetpos/ (/ i/ )/ 过程/ 返回/ SA/ [/ i/ ]/ ,/ 即/ 第/ i/ 个/ 最小/ 后缀/ 过程/ 犵/ 犲/ 狋/ 狆/ 狅/ 狊/ (/ 犻/ )/ ./ 1/ ./ step/ ←/ 02/ ./ WHILEimodc/ ≠/ 0DO3/ ./ step/ ←/ step/ +/ 14/ ./ i/ ←/ Φ/ [/ i/ ]/ 5/ ./ i/ ←/ i/ // c6/ ./ RETURN/ (/ SAl/ [/ i/ ]/ -/ step/ )/ modngetpos/ 从/ 某点/ i/ ∈/ [/ L/ ,/ R/ ]/ 出发/ ,/ 沿着/ i/ (/ Φ/ [/ i/ ]/ )/ ,/ i/ (/ Φ/ [/ i/ ]/ )/ ,/ …/ ,/ 顺序/ 后移/ ,/ 满足/ SA/ [/ i/ ]/ +/ 1/ =/ SA/ [/ i/ ]/ ,/ SA/ [/ i/ ]/ +/ 1/ =/ SA/ [/ i/ ]/ ,/ …/ ,/ 直至/ 遇到/ 被/ 采样/ 的/ 某点/ SAl/ [/ i/ ]/ ./ 令/ step/ 表示/ 后移/ 的/ 步数/ ,/ 则/ 结果/ 返回/ 为/ SAl/ [/ i/ ]/ -/ step/ ,/ 该/ 结果/ 在/ 算法/ 第/ 6/ 行/ 返回/ ./ 因为/ 对于/ b/ =/ (/ logn/ )/ 2/ // loglogn/ ,/ 使用/ 宽度/ 为/ W/ =/ O/ (/ logn/ // 2/ )/ 的/ 查找/ 表/ ,/ 访问/ Φ/ 的/ 时间/ 为/ O/ (/ logn/ // loglogn/ )/ ./ 因此/ ,/ locate/ 算法/ 的/ 时间/ 复杂度/ 为/ occ/ ·/ c/ ·/ O/ (/ (/ logn/ )/ 2/ // loglogn/ )/ ,/ 其中/ c/ 为/ SA/ 的/ 采样/ 步长/ ,/ occ/ 为/ 模式/ 在/ T/ 中/ 出现/ 的/ 次数/ ./ 定理/ 3/ ./ 给定/ 长为/ m/ 的/ 模式/ P/ 及/ 模式/ 出现/ 的/ 范围/ [/ L/ ,/ R/ ]/ ,/ 定位/ 查询/ 可/ 在/ occ/ ·/ c/ ·/ O/ (/ (/ logn/ )/ 2/ // loglogn/ )/ 时间/ 内/ 完成/ ,/ 其中/ c/ 为/ SA/ 的/ 采样/ 步长/ ,/ occ/ 为/ 模式/ 出现/ 的/ 次数/ ./ 继续/ 以/ 模式/ “/ bga/ ”/ 为例/ ,/ count/ 过程/ 求/ 出/ [/ 7/ ,/ 8/ ]/ 区间/ 内/ 的/ 所有/ 后缀/ 具有/ “/ bga/ ”/ 前缀/ ,/ 所以/ locate/ 过程/ 用/ getpos/ 分别/ 求出/ SA/ [/ 7/ ]/ ,/ SA/ [/ 8/ ]/ 的/ 值/ ./ 以求/ SA/ [/ 8/ ]/ 为例/ ,/ 简单/ 描述/ getpos/ 过程/ (/ c/ =/ 3/ )/ ./ step/ =/ 0/ ,/ i/ =/ 8/ ,/ WHILE/ 循环/ 开始/ ./ 8mod3/ ≠/ 0/ ,/ step/ =/ 1/ ,/ 更新/ i/ =/ Φ/ [/ i/ ]/ =/ Φ/ [/ 8/ ]/ =/ 31/ ;/ 31mod3/ ≠/ 0/ ,/ step/ =/ 2/ ,/ 更新/ i/ =/ Φ/ [/ 31/ ]/ =/ 3.3/ mod3/ =/ 0/ ,/ 循环/ 结束/ ./ 第/ 5/ 行/ i/ =/ i/ // 3/ =/ 3/ // 3/ =/ 1/ ,/ 算法/ 在/ 第/ 6/ 行/ 返回/ SAl/ [/ i/ ]/ -/ 2/ =/ 34/ -/ 2/ =/ 32.5/ ./ 2/ 展示/ 文本/ 串/ 给定/ 子串/ 起始/ 位置/ start/ 和/ 长度/ len/ ,/ extract/ (/ start/ ,/ len/ )/ 操作/ 可以/ 展示/ T/ 中/ 起始/ 位置/ start/ 处/ 长度/ 为/ len/ 的/ 子串/ ,/ 即/ T/ [/ start/ ../ start/ +/ len/ -/ 1/ ]/ ./ 4.2/ 节/ 采样/ SA/ -/ 1/ 数组/ ,/ 产生/ SA/ -/ 1/ 数组/ 实现/ extract/ (/ start/ ,/ len/ )/ 操作/ ,/ 返回/ 这个/ 子串/ ./ 在/ 3.4/ 节中/ 我们/ 讨论/ 了/ 如何/ 恢复/ 后缀/ SA/ [/ i/ ]/ ,/ 即/ 返回/ 后缀/ T/ [/ SA/ [/ i/ ]/ ../ n/ ]/ ,/ 该/ 过程/ 会/ 用到/ Φ/ 的/ 表示/ 结构/ 和/ C/ 表/ (/ 字符/ 统计表/ )/ ./ 因此/ 我们/ 只/ 需/ 把/ 某个/ 后缀/ 的/ 起始/ 位置/ start/ 转换成/ 对应/ 的/ 排名/ i/ ,/ extract/ (/ start/ ,/ len/ )/ 操作/ 就/ 能/ 借助/ 3.4/ 节/ 的/ 方法/ 完成/ ./ 由/ 4.2/ 节/ 可知/ ,/ 对于/ 排名/ 为/ i/ 的/ 后缀/ ,/ 可以/ 在/ C/ 表上/ 进行/ 二分/ 查找/ ,/ 确定/ i/ 所属/ 的/ 区段/ index/ ,/ 则/ 排名/ 为/ i/ 的/ 后缀/ 的/ 第/ 1/ 个字符/ 就是/ incode/ [/ index/ ]/ ,/ 后续/ 部分/ 用/ f/ (/ i/ )/ 表示/ 这一/ 过程/ ,/ 即/ 返回/ 排名/ 为/ i/ 的/ 后缀/ 的/ 首/ 字符/ ./ 显然/ ,/ 过程/ f/ (/ i/ )/ 的/ 时间/ 复杂度/ 由/ C/ 表/ 的/ 二分/ 过程/ 决定/ ,/ 为/ O/ (/ log/ σ/ )/ ,/ σ/ 表示/ C/ 表/ 大小/ ,/ 即/ 字符/ 表/ 的/ 大小/ ./ 更新/ i/ =/ Φ/ [/ i/ ]/ ,/ 重复/ 上述/ 过程/ ,/ 可以/ 确定/ 整个/ 后缀/ ./ 以下/ 描述/ 过程/ restore/ (/ i/ ,/ len/ )/ ,/ 该/ 过程/ 返回/ 排名/ 为/ i/ 的/ 后缀/ T/ [/ SA/ [/ i/ ]/ ../ SA/ [/ i/ ]/ +/ len/ -/ 1/ ]/ ./ 过程/ 狉/ 犲/ 狊/ 狋/ 狅/ 狉/ 犲/ ./ 输入/ :/ i/ ,/ len/ 输出/ :/ substr1/ ./ FORj/ ←/ 0tolen/ -/ 1DO2/ ./ substr/ [/ j/ ]/ ←/ f/ (/ i/ )/ 3/ ./ i/ ←/ Φ/ [/ i/ ]/ 4/ ./ RETURNsubstr/ 以下/ transform/ 将/ 后缀/ 的/ 起始/ 位置/ start/ 转换/ 过程/ 狋/ 狉/ 犪/ 狀/ 狊/ 犳/ 狅/ 狉/ 犿/ ./ 输入/ :/ start/ 输出/ :/ i1/ ./ i/ ←/ SA/ -/ 12/ ./ step/ ←/ startmodd3/ ./ FORj/ ←/ 0tostep/ -/ 1DO4/ ./ i/ ←/ Φ/ [/ i/ ]/ 5/ ./ RETURNi/ 成/ 排名/ i/ ./ Page11d/ 表示/ SA/ -/ 1/ 数组/ 的/ 采样/ 步长/ ,/ 该/ 过程/ 先/ 查找/ 比/ start/ 小/ 的/ 最大/ 的/ SA/ -/ 1/ 数组/ 采样/ 点/ start/ // d/ ,/ 得到/ 该点/ 排名/ i/ ,/ 然后/ 重复/ 执行/ startmodd/ 次/ i/ =/ Φ/ [/ i/ ]/ ,/ 根据/ Φ/ [/ i/ ]/ 的/ 物理/ 含义/ ,/ 此时/ 的/ i/ 就是/ start/ 位置/ 开始/ 的/ 后缀/ 的/ 排名/ i/ ./ 算法/ 6/ ./ extract/ ./ 输入/ :/ start/ ,/ len/ 输出/ :/ substr1/ ./ i/ ←/ transform/ (/ start/ )/ 2/ ./ substr/ ←/ restore/ (/ i/ ,/ len/ )/ 3/ ./ RETURNsubstr/ 算法/ 的/ 时间/ 复杂度/ 由/ 两个/ 过程/ f/ (/ i/ )/ 和/ Φ/ [/ i/ ]/ 决定/ ./ 由本节/ 分析/ 可知/ ,/ f/ (/ i/ )/ 的/ 时间/ 复杂度/ 为/ O/ (/ log/ σ/ )/ ./ Transform/ 最坏/ 情况/ 下/ 执行/ d/ 次/ Φ/ [/ i/ ]/ 操作/ ,/ restore/ 执行/ len/ 次/ Φ/ [/ i/ ]/ 操作/ ,/ 因而/ extract/ 操作/ 的/ 时间/ 复杂度/ 为/ O/ (/ (/ d/ +/ len/ )/ (/ logn/ // loglogn/ )/ +/ lenlog/ σ/ )/ ./ 定理/ 4/ ./ 给定/ 子串/ 起始/ 位置/ start/ 和/ 长度/ len/ ,/ i01234567891011121314151617181920212223242526272829303132333435TabfgdbfbgdfccbgacefcegcdefgbfcadbgafSA01530345271133272912112216194312391724203562810182521433262138SAl03417111923246181421SA/ -/ 106293416424935192612117301142027152233131821283252510217831323SA/ -/ 1l034241911127332152316/ 改进/ 不同/ 数据/ 的/ 分布/ 特点/ 是/ 不同/ 的/ ,/ 体现/ 在/ Φ/ 的/ gap/ 序列/ 中/ 1/ 的/ 比例/ ./ 我们/ 的/ 统计/ 实验/ 表明/ ,/ 像/ dna/ 这样/ 的/ 数据/ ,/ 其/ gap/ 值为/ 1/ 的/ 比例/ 大约/ 占/ 到/ 总数/ 的/ 40/ %/ ~/ 60/ %/ 左右/ ;/ 像/ english/ 这样/ 的/ 数据/ ,/ 其/ gap/ 值为/ 1/ 的/ 比例/ 大约/ 占/ 到/ 总数/ 的/ 50/ %/ ~/ 70/ %/ 左右/ ;/ 像/ influenza/ 这样/ 高度/ 重复/ 的/ (/ highly/ -/ repetive/ )/ 序列/ ,/ 其/ gap/ 值为/ 1/ 的/ 比例/ 可高达/ 80/ %/ 以上/ ./ 因此/ gap/ 序列/ 中/ 势必/ 存在/ 大量/ 连续/ 的/ 1/ (/ 也/ 称长/ 游程/ ,/ longruns/ )/ ,/ 单纯/ 一种/ Gamma/ 编码/ 不能/ 很/ 好/ 的/ 适应/ 这种/ 情况/ ,/ 需要/ 结合/ run/ -/ length/ 编码/ ,/ 而/ run/ -/ length/ 编码/ 可以/ 很/ 高效/ 的/ 处理/ 这种/ 具有/ 长/ 游程/ 的/ 数据/ ./ 对/ Φ/ 的/ gap/ 序列/ 运用/ run/ -/ length/ 编码/ 之后/ ,/ 解码/ 速度/ 也/ 会/ 有所/ 提升/ ,/ 因为/ 一个/ runs/ 可能/ 会/ 对应/ 好多个/ gap/ ,/ 不再/ 需要/ 逐个/ 恢复/ ,/ 所以/ gap/ 中/ 1/ 的/ 比例/ 越高/ ,/ 则/ 倾向/ 于/ 应用/ run/ -/ length/ 编码/ ,/ 块/ 大小/ 也/ 可以/ 适当/ 的/ 取/ 的/ 大些/ ./ 但/ 并/ 不是/ 所有/ 的/ gap/ 片段/ 都/ 呈现/ 很/ 好/ 的/ runs/ 特性/ ,/ 因而/ 我们/ 仍然/ 需要/ Gamma/ 编码方法/ 作为/ 展示/ 子串/ 查询/ 可/ 在/ O/ (/ (/ d/ +/ len/ )/ (/ logn/ // loglogn/ )/ +/ lenlog/ σ/ )/ 时间/ 内/ 完成/ ,/ 其中/ d/ 为/ SA/ -/ 1/ 的/ 采样/ 步长/ ./ 图/ 3/ 给出/ 了/ c/ =/ d/ =/ 3/ 时/ 对/ 后缀/ 数组/ SA/ 和/ 逆/ 后缀/ 数组/ SA/ -/ 1/ 的/ 采样/ 结果/ ,/ 分别/ 用/ SAl/ 和/ SA/ -/ 1/ 示/ ./ 我们/ 将/ SAl/ 和/ SA/ -/ 1/ 位/ 的/ 数组/ 里/ ./ 结合/ 图/ 3/ ,/ 执行/ extract/ (/ 14/ ,/ 4/ )/ 的/ 过程/ 如下/ :/ 第/ 1/ 步/ ./ 确定/ 位置/ 14/ 的/ 排名/ ,/ 图/ 3/ 中/ SA/ -/ 1/ 的/ 采样/ 步长/ 为/ 3/ ,/ 不/ 超过/ 14/ 的/ 最大/ 采样/ 点为/ 12/ ,/ 对应/ SA/ -/ 1/ (/ 下标/ 从/ 0/ 开始/ )/ ,/ 得/ i/ =/ 11/ ,/ 即/ 位置/ 12/ 开始/ 的/ 后缀/ 的/ 排名/ 为/ 11/ ,/ 14mod3/ =/ 2/ ,/ 重复/ 执行/ 两次/ i/ =/ Φ/ [/ i/ ]/ ,/ 最终/ i/ =/ 30/ ,/ 即/ 位置/ 14/ 开始/ 的/ 后缀/ 的/ 排名/ 为/ 30/ ,/ 该/ 计算/ 由/ transform/ 过程/ 完成/ ./ 第/ 2/ 步/ ./ len/ =/ 4/ ,/ 循环/ 4/ 次/ ./ 首先/ ,/ i/ =/ 30/ ,/ 属于/ g/ -/ list/ 范围/ ,/ 故/ 第/ 1/ 个字符/ 为/ ‘/ g/ ’/ ./ 其次/ ,/ i/ =/ Φ/ [/ 30/ ]/ =/ 1/ ,/ 属于/ a/ -/ list/ 范围/ ,/ 故/ 第/ 2/ 个字符/ 为/ ‘/ a/ ’/ ./ 然后/ ,/ i/ =/ Φ/ [/ 1/ ]/ =/ 14/ ,/ 属于/ c/ -/ list/ 范围/ ,/ 故/ 第/ 3/ 个字符/ 为/ ‘/ c/ ’/ ./ 最后/ ,/ i/ =/ Φ/ [/ 14/ ]/ =/ 20/ ,/ 属于/ e/ -/ list/ 范围/ ,/ 故/ 第/ 4/ 个字符/ 为/ ‘/ e/ ’/ ./ 因此/ T/ [/ 14/ ../ 17/ ]/ =/ “/ gace/ ”/ ./ l/ 示例/ 第/ 2/ 种/ 编码方法/ ,/ 当/ run/ -/ length/ 编码/ 失效/ 时/ ,/ 使用/ Gamma/ 编码/ ./ 最终/ 我们/ 的/ 数据/ 感知/ 的/ 、/ 自/ 适应/ 的/ 编码/ 策略/ 如下/ :/ 候选/ 编码方法/ 有/ Gamma/ 编码/ ,/ run/ -/ length/ 编码/ ,/ 块/ 大小/ 根据/ gap/ 中/ 1/ 的/ 比例/ 决定/ ,/ 块/ 内/ 编码方法/ 在/ Gamma/ 和/ run/ -/ length/ 编码/ 中/ 择优/ 选取/ ./ 最终/ 的/ 结果/ 是/ :/ 我们/ 改进/ 的/ CSA/ 能/ 根据/ 数据分布/ 的/ 不同/ ,/ 自动/ 的/ 选择/ 合适/ 的/ 编码方法/ 和/ 块/ 大小/ ,/ 具有/ 数据/ 感知/ 和/ 自/ 适应/ 的/ 特点/ ./ 如何/ 把/ run/ -/ length/ 编码/ 结合/ 进来/ 是/ 个/ 很/ 艺术/ 的/ 问题/ ,/ 区分/ 一个/ 值/ y/ (/ 表示/ 待/ 编码/ 的/ 值/ )/ 是/ gap/ 还是/ 1/ 的/ runs/ ,/ 一种/ 简单/ 的/ 策略/ 如下/ :/ h/ (/ )/ y/ =/ 2y/ -/ 3/ ,/ 如果/ y/ 是/ 一个/ gap/ 这样/ 解码/ 时/ 通过/ 奇偶/ 判断/ 就/ 能/ 确定/ 编码/ 的/ 是/ gap/ 还是/ 1/ 的/ runs/ 值/ ./ 这里/ 可/ 做/ 进一步/ 优化/ ,/ 将/ y/ 映射/ 为/ 2y/ -/ 1/ 时/ ,/ 所有/ 被/ 编码/ 的/ 值/ 都/ 大于/ 1/ ,/ 此时/ 我们/ 可以/ 修改/ Gamma/ 编码/ 的/ 规则/ ,/ 当/ y/ 的/ 二进制/ 需要/ x/ 位时/ ,/ 在/ y/ 的/ 二进制/ 前面/ 追加/ x/ -/ 2/ 个/ 0/ ,/ 而/ 不是/ 原来/ 的/ x/ -/ 1/ 个/ 0/ ./ 此外/ ,/ 高度/ 重复/ 数据/ 的/ runs/ 值/ Page12/ 或/ 偶尔/ 出现/ 的/ 非/ 1gap/ 的/ 值/ 都/ 较大/ ,/ 所以/ EliasDelta/ 编码/ 更/ 合适/ ,/ 按照/ 类似/ 的/ 方式/ 修改/ Delta/ 编码/ 规则/ ,/ “/ 剔除/ ”/ 最/ 左/ 端的/ 0/ ./ 我们/ 的/ 改进版/ 称为/ ACSA/ (/ adaptiveCSA/ )/ ,/ 改进版/ 在结构上/ 比图/ 2/ 多/ 了/ 记录/ 编码方法/ 的/ methods/ 域/ ,/ 每个/ 块/ 对应/ 一个/ ceil/ ,/ 每个/ ceil/ 需要/ 2/ 位/ ,/ 可/ 表示/ 4/ 种/ 编码方法/ (/ Gamma/ ,/ RLG/ ,/ RLD/ ,/ All1/ )/ ./ 其中/ Gamma/ 表示/ 对/ y/ 使用/ Gamma/ 编码/ ,/ RLG/ 表示/ 对/ y/ 使用/ run/ -/ lengthGamma/ 编码/ ,/ RLD/ 表示/ 对/ y/ 使用/ run/ -/ lengthDelta/ 编码/ ,/ All1/ 表示/ 整个/ 块/ 为/ 1/ 的/ runs/ ,/ 这样/ 的/ 块/ 不/ 编码/ ./ 这个/ methods/ 域/ 所用/ 空间/ 为/ 2/ (/ n/ // b/ )/ =/ o/ (/ n/ )/ ,/ 对于/ b/ =/ (/ logn/ )/ 2/ // loglogn/ ./ 实现/ 时/ ,/ 超块/ 大小/ 固定/ 为块/ 大小/ 的/ 16/ 倍/ ,/ 块/ 大小/ 自/ 适应/ ,/ 以/ gap/ 序列/ 中/ 1/ 的/ 比例/ 为/ 依据/ ./ 如果/ 数据/ 是/ 高度/ 重复/ 的/ ,/ 设为/ 512/ ,/ 如果/ 数据/ 是/ 像/ english/ 这样/ 的/ ,/ 设为/ 256/ ,/ 否则/ 设为/ 128/ ,/ 令/ b/ 表示/ 块/ 大小/ ,/ 则/ 在/ 实际/ 中/ b/ 值/ 取值/ 如下/ :/ 其中/ r/ 为/ gap/ 序列/ 中/ 1/ 的/ 比率/ ./ 我们/ 的/ 实现/ 中/ ,/ 提供/ 了/ speedlevel/ 参数/ ,/ 该/ 参数/ 决定/ 3/ 个/ 典型/ 的/ 阈值/ :/ speedlevel/ =/ 0/ 对应/ 阈值/ (/ l1/ ,/ l2/ )/ =/ (/ 0.50/ ,/ 0.60/ )/ ,/ 此时/ 压缩率/ 较/ 好/ ,/ count/ 查询/ 较慢/ ./ speedlevel/ =/ 1/ 对应/ 阈值/ (/ l1/ ,/ l2/ )/ =/ (/ 0.60/ ,/ 0.75/ )/ ,/ 该/ 阈值/ 是/ 个/ 比较/ 好/ 的/ 权衡/ 值/ ./ speedlevel/ =/ 2/ 对应/ 阈值/ (/ l1/ ,/ l2/ )/ =/ (/ 0.65/ ,/ 0.80/ )/ ,/ 此时/ 压缩率/ 较差/ ,/ count/ 查询/ 较/ 好/ ./ 这些/ 阈值/ 和/ speedlevel/ 的/ 取值/ 都/ 只是/ 经验值/ ,/ 可以/ 根据/ 需求/ 进行/ 权衡/ ./ speedlevel/ 值/ 偏/ 小时/ ,/ 侧重于/ 压缩率/ ,/ speedlevel/ 值/ 偏大时/ ,/ 侧重于/ 查询/ 速度/ ./ 图/ 4/ Φ/ 结构/ 大小/ 7/ 实验/ 结果/ 与/ 分析/ 7.1/ 实验/ 环境/ 设置/ 实验/ 中/ 没有/ 运行/ 其他/ 大型/ 程序/ ,/ 任何/ 系统/ 设置/ 保持/ 默认/ ,/ 运行/ Ubuntu12/ ./ 04LTS32/ 位/ 系统/ ,/ g/ ++/ 4.4/ ./ 1/ 编译/ ,/ 加/ -/ O3/ 优化/ 参数/ ./ 机器/ 情况/ :/ HPZ400/ ,/ CPU/ :/ Inter/ (/ R/ )/ Xeon/ (/ R/ )/ 2/ @/ 2.53/ ;/ RAM/ :/ 4GB/ ,/ L3/ :/ 4MB/ ./ 我们/ 使用/ 源自/ CanterburyCorpus/ (/ http/ :/ // // corpus/ ./ canterbury/ ./ ac/ ./ nz/ )/ 和/ Pizza/ &/ ChiliCorpus/ (/ http/ :/ // // pizzachili/ ./ dcc/ ./ uchile/ ./ cl/ // indexes/ ./ html/ )/ 的/ 数据测试/ 所提/ 方法/ 的/ 性能/ ./ 我们/ 的/ 两个/ 版本/ 可/ 在/ https/ :/ // // github/ ./ com/ // chenlonggang/ // Adaptive/ -/ CSA/ 及/ https/ :/ // // github/ ./ com/ // chenlonggang/ // Compressed/ -/ Suffix/ -/ Array/ 上/ 获取/ ./ 7.2/ 参数/ 对/ 性能/ 的/ 影响/ 我们/ 的/ CSA/ 结构/ 是/ 带/ 参数/ 的/ ,/ 参数/ 的/ 选取/ 影响/ 着/ 压缩/ 索引/ 的/ 空间/ 和/ 时间/ 性能/ ./ 本节/ 简要/ 讨论/ 这些/ 参数/ 对/ 算法/ 性能/ 的/ 影响/ ./ 假设/ a/ 表示/ 超块/ 的/ 大小/ ,/ b/ 表示/ 块/ 的/ 大小/ ,/ c/ 表示/ SA/ 的/ 采样/ 步长/ ,/ d/ 表示/ SA/ -/ 1/ 的/ 采样/ 步长/ ,/ SAM/ 、/ SB/ 、/ B/ 按照/ 紧凑/ 方式/ 存储/ ./ 为了/ 降低/ 空间/ ,/ 我们/ 固定/ d/ =/ 16c/ ./ 本节/ 我们/ 将/ 讨论/ a/ 和/ b/ 的/ 最佳/ 倍数/ 关系/ ,/ 在/ 此基础/ 上/ 确定/ 参数/ b/ 、/ c/ 对/ 算法/ 实现/ 性能/ 的/ 影响/ ,/ 最终/ 确定/ 一组/ 最佳/ 的/ 参数/ ./ 图/ 4/ 表示/ b/ 取/ 不同/ 的/ 值/ ,/ a/ =/ kb/ 时/ ,/ 随着/ k/ 的/ 变化/ ,/ Φ/ 结构/ 大小/ (/ bps/ ,/ bitspersymbol/ )/ 的/ 变化趋势/ ,/ 横轴/ 表示/ 系数/ k/ ,/ 纵轴/ 表示/ Φ/ 结构/ 的/ 大小/ ./ 从图/ 4/ 中/ 可以/ 看到/ ,/ 当/ n/ =/ 50M/ 、/ 100M/ 时/ ,/ 当/ k/ 大于/ 18/ 左右/ 之后/ ,/ 空间/ 不再/ 降低/ ,/ 甚至/ 有变/ 大/ 的/ 趋势/ ,/ 所以/ 选取/ a/ =/ 18b/ 是/ 合适/ 的/ ./ 后续/ 的/ 实验/ 都/ 是/ 建立/ 在/ a/ =/ 18b/ 的/ 基础/ 上/ 的/ ./ Page13/ 现在/ 讨论/ 参数/ b/ 、/ c/ 对/ 性能/ 的/ 影响/ ,/ 实验/ 中以/ 50MB/ 大小/ xml/ 数据/ 为例/ ./ 第/ 1/ 组/ ./ 参数/ b/ 对/ 性能/ 的/ 影响/ 本组/ 测试/ 参数/ b/ 对/ 性能/ (/ 压缩率/ 、/ 查询/ 时间/ 等/ )/ 的/ 影响/ ,/ 如图/ 5/ 所示/ ./ 实验/ 中/ 参数/ c/ =/ 32/ ,/ 参数/ b/ 由/ 16/ 开始/ 变化/ ,/ 以/ 16/ 为/ 步幅/ ,/ 增加/ 到/ 160/ ./ 参数/ b/ 表示/ Φ/ 块/ 的/ 大小/ ,/ 即/ Φ/ [/ ib/ ]/ 的/ 点将/ 被/ 采样/ ,/ 直接/ 保存/ ,/ 并且/ 还会/ 保存/ 该点/ 相对/ 于/ 所属/ 超块/ 的/ 偏移量/ ,/ 随着/ 参数/ b/ 的/ 增大/ ,/ Φ/ 的/ 辅助/ 结构/ 会/ 越来越/ 小/ ,/ 但/ 随着/ b/ 的/ 增大/ ,/ 压缩率/ 的/ 降低/ 趋势/ 会/ 放缓/ ,/ 图/ 5/ (/ a/ )/ 表明/ 了/ 这/ 一点/ ./ 参数/ b/ 对/ 压缩/ 时间/ 的/ 影响/ 不/ 大/ ,/ 如果/ 假设/ 某个/ 点/ 被/ 采样/ 和/ 被/ 编码/ 的/ 时间/ 代价/ 相当/ ,/ 则/ 不管/ 参数/ b/ 如何/ 变化/ ,/ 压缩/ 时间/ 都/ 不会/ 有/ 明显/ 的/ 变化/ ,/ 这/ 一点/ 可以/ 从图/ 5/ (/ b/ )/ 中/ 看出/ ./ 图/ 5/ (/ c/ )/ 和/ 图/ 5/ (/ d/ )/ 清楚/ 的/ 说明/ 了/ Φ/ 块/ 大小/ b/ 对/ 计数/ 查询/ 、/ 定位/ 查询/ 时间/ 的/ 影响/ ,/ 因为/ 这/ 两个/ 操作/ 都/ 需要/ Φ/ 结构/ 的/ 支持/ ,/ 增大/ b/ 应该/ 会/ 显著/ 的/ 影响/ 计数/ 查找/ 的/ 时间/ ,/ 因为/ 增大/ b/ 会/ 增大/ Φ/ 获取/ 过程/ 中/ 的/ 跳跃/ 次数/ ,/ 但是/ 图/ 5/ (/ c/ )/ 表明/ 参数/ b/ 的/ 变化/ 对/ 计数/ 查找/ 的/ 影响/ 不/ 大/ ,/ 这/ 得益于/ 对/ 查找/ 表/ 的/ 充分利用/ ./ 图/ 5/ (/ d/ )/ 中/ 参数/ b/ 由/ 16/ 变化/ 到/ 160/ 时/ ,/ 定位/ 查询/ 图/ 5/ 参数/ b/ 对/ 性能/ 的/ 影响/ 时间/ 变为/ 原来/ 的/ 2/ 倍/ 左右/ ,/ 图/ 5/ (/ a/ )/ 表明/ 压缩率/ 变为/ 原来/ 的/ 0.6/ 倍/ 左右/ ,/ 观察/ 图/ 5/ (/ a/ )/ ,/ 图/ 5/ (/ d/ )/ 的/ 走势/ ,/ 不/ 建议/ 选取/ 大于/ 128/ 的/ b/ 值/ ,/ 因为/ b/ >/ 128/ 后/ ,/ 对/ 压缩率/ 的/ 贡献/ 降低/ ,/ 但/ 定位/ 查找时间/ 显著/ 上升/ ./ 第/ 2/ 组/ ./ 参数/ c/ 对/ 性能/ 的/ 影响/ 本组/ 测试/ 固定/ 参数/ b/ =/ 128/ ,/ 参数/ c/ 由/ 16/ 开始/ 变化/ ,/ 以/ 16/ 为/ 步幅/ ,/ 增加/ 到/ 160/ ./ 在/ 图/ 6/ (/ a/ )/ 中/ ,/ 参数/ c/ 由/ 16/ ~/ 160/ 变化/ 时/ ,/ 压缩率/ 逐渐/ 降低/ ,/ 但/ 随着/ c/ 的/ 增大/ ,/ 降幅/ 逐渐/ 减小/ ,/ 在/ 整个/ 过程/ 中/ ,/ 压缩率/ 由/ 0.49/ 左右/ 降到/ 0.30/ 左右/ ,/ 变为/ 原来/ 的/ 0.6/ 倍/ 左右/ ./ 压缩/ 时间/ 依然/ 没有/ 显著/ 变化/ ,/ 调整/ c/ 并/ 不/ 影响/ 计数/ 查找/ ,/ 因为/ 计数/ 查找/ 只/ 需要/ 字符/ 频数/ 统计表/ C/ 和/ Φ/ 数组/ 的/ 支持/ ./ 图/ 6/ (/ d/ )/ 表示/ 定位/ 查找时间/ ,/ c/ =/ 16/ 、/ 160/ 时/ 的/ 增幅/ 高达/ 16/ 倍/ 左右/ ,/ 而图/ 5/ (/ d/ )/ 中/ 的/ 增幅/ 只有/ 2/ 倍/ 左右/ ,/ 这个/ 结果/ 是/ 我们/ 实际/ 中将/ 参数/ b/ 选择/ 较大/ ,/ 而/ 将/ 参数/ c/ 选择/ 较/ 小/ 的/ 重要依据/ ./ 综合/ 考虑/ 上述/ 实验/ ,/ 我们/ 选取/ b/ =/ 128/ ,/ a/ =/ 18b/ ,/ c/ =/ 32/ ,/ d/ =/ 16c/ 作为/ 我们/ 算法/ 的/ 默认值/ ,/ 该值/ 既/ 可以/ 保证/ Φ/ 数组/ 的/ 辅助/ 空间/ 较/ 小/ ,/ 同时/ 又/ 保证/ 了/ 查询/ 算法/ 的/ 速度/ ,/ 后续/ 实验/ 都/ 基于/ 该组/ 参数值/ ./ 对于/ ACSA/ ,/ 参数/ b/ 取值/ 分/ 3/ 档/ ,/ 128/ ,/ 256/ 和/ 512/ ,/ speedlevel/ 可/ 取值/ 0/ ,/ 1/ 和/ 2/ ,/ 对应/ 的/ 阈值/ 分别/ 为/ Page14/ 图/ 6/ 参数/ c/ 对/ 性能/ 的/ 影响/ (/ 0.5/ ,/ 0.6/ )/ ,/ (/ 0.6/ ,/ 0.75/ )/ 和/ (/ 0.65/ ,/ 0.80/ )/ ./ 此时/ 阈值/ 为/ Φ/ 的/ gap/ 序列/ 中/ 1/ 的/ 比例/ ,/ speedlevel/ 的/ 默认值/ 为/ 1/ ,/ 即当/ 1/ 的/ 比例/ 低于/ 0.6/ 时/ ,/ b/ 取值/ 128/ ,/ 当/ 1/ 的/ 比例/ 在/ 0.6/ 到/ 0.75/ 之间/ 时/ ,/ b/ 取值/ 256/ ,/ 大于/ 0.75/ 时/ ,/ b/ 取值/ 512/ ./ 这些/ 参数/ 的/ 取值/ 都/ 是/ 在/ 上述/ 实验/ 的/ 基础/ 上/ 综合/ 考虑/ 的/ 结果/ ./ 7.3/ 结果/ 与/ 分析/ 本/ 节/ 采用/ Pizza/ &/ Chili/ 网站/ 上/ 的/ 数据/ 进行/ 测试/ ,/ 与/ 当前/ 主流/ 方法/ 在/ 压缩率/ 和/ 查询/ 速度/ 方面/ 进行/ 了/ 比较/ ./ 表/ 6/ 给出/ 了/ 有/ 代表性/ 的/ 数据文件/ (/ 100M/ )/ 的/ 统计/ 信息/ ./ 它们/ 包括/ 像/ dna/ 这样/ 的/ 数据/ (/ 符号/ 分布/ 几乎/ 均匀/ )/ ,/ 像/ influenza/ 这样/ 的/ 高度/ 重复/ 的/ 数据/ 以及/ 介于/ 这/ 两者之间/ 的/ 数据/ ,/ 如像/ english/ 文本/ 这样/ 的/ 数据/ ./ 文件/ dnaproteinsxmlsourceenglish/ 字符集/ 162596227215/ 待/ 比较/ 的/ 方法/ 包含/ :/ CSA/ (/ 本文/ 第/ 3/ 节/ 的/ 方法/ )/ ,/ ACSA/ (/ 本文/ 第/ 6/ 节/ 的/ 方法/ )/ ,/ speedlevel/ =/ 1/ ,/ FM/ -/ Index/ [/ 14/ -/ 15/ ]/ ,/ RLCSA/ [/ 23/ ]/ ,/ Sad/ -/ CSA/ [/ 12/ -/ 13/ ]/ ,/ SDSL/ -/ CSA/ [/ 28/ ]/ ./ 除了/ ACSA/ 的/ 块/ 大小/ 自/ 适应/ 之外/ ,/ 其他/ 被/ 比较/ 的/ 方法/ ,/ 块/ 大小/ b/ =/ 128/ ./ 我们/ 在/ 索引/ 构造/ 时间/ 、/ 压缩率/ 和/ 模式/ 查询/ 时间/ 上/ 与/ 现有/ 主流/ 方法/ 进行/ 了/ 比较/ ./ 压缩率/ bps/ (/ bitspersymbol/ )/ 定义/ 为/ CSA/ 结构/ 大小/ 与源/ 文本文件/ 大小/ 的/ 比值/ 再/ 乘以/ 8/ ,/ 表示/ 文件/ 压缩/ 后/ 每个/ 字符/ 平均/ 所/ 需要/ 的/ 比特/ 数/ ./ 对于/ 每个/ 文件/ ,/ 我们/ 随机/ 生成/ 一万个/ 长度/ 为/ 20/ 的/ 模式/ ,/ 获取/ 平均/ 的/ 查询/ 时间/ (/ 单位/ 为/ us/ )/ ./ 每个/ 算法/ 查询/ 的/ 10000/ 个/ 模式/ 是/ 一样/ 的/ ./ 表/ 7/ ~/ 10/ 中/ 的/ 黑体字/ 说明/ 的/ 是/ 这些/ 方法/ 在/ 每/ 一列/ 不同/ 数据/ 上/ 表现/ 最好/ 的/ 前/ 两个/ 结果/ ./ 表/ 7/ 给出/ 了/ 上述/ 的/ 压缩/ 索引/ 方法/ 在/ 不同/ 特征/ 数据/ 集上/ 的/ 构造/ 时间/ ./ 在/ 所/ 测试/ 的/ 7/ 组/ 数据/ 中/ ,/ CSA/ 的/ 构造/ 时间/ 在/ 其中/ 4/ 组/ 数据/ 上/ 显著/ 优于/ 其他/ 压缩/ 索引/ 的/ 构造/ 时间/ ./ FM/ -/ Index/ 在/ 其余/ 的/ 3/ 组/ 数据/ 上/ 的/ 构造/ 时间/ 表现/ 最佳/ ./ 但/ 在/ 这/ 3/ 组/ 数据/ 上/ ,/ CSA/ 的/ 构造/ 时间/ 与/ FM/ -/ Index/ 的/ 构造/ 时间/ 接近/ ./ 表/ 8/ 显示/ 了/ 对/ 不同/ 的/ 数据/ 采用/ 不同/ 的/ 压缩/ 索引/ Page15/ 方法/ 得到/ 的/ 压缩率/ ./ 由表/ 8/ 可见/ ,/ 除了/ 高度/ 重复/ 的/ 数据/ influenza/ 和/ kernel/ 以及/ sources/ ,/ ACSA/ 的/ 压缩率/ 显著/ 优于/ 所/ 比较/ 的/ 其他/ 压缩/ 索引/ 方法/ 的/ 压缩率/ ./ 而/ 对于/ 所/ 测试/ 的/ 数据/ ,/ CSA/ 的/ 压缩率/ 也/ 有/ 一定/ 的/ 优势/ ./ 而/ 对于/ 高度/ 重复/ 的/ 数据/ influenza/ 和/ kernel/ ,/ RLCSA/ 的/ 压缩率/ 最佳/ ,/ 但/ 我们/ ACSA/ 的/ 压缩率/ 与/ 之/ 相当/ ./ FM/ -/ Index/ 的/ 压缩率/ 在/ 所/ 比较/ 的/ 压缩/ 索引/ 上/ 表现/ 最佳/ ,/ 而/ ACSA/ 的/ 压缩率/ 也/ 能/ 与/ 之/ 相当/ ./ 随机/ 选取/ 数据文件/ 中/ 的/ 长度/ 为/ 20/ 的/ 模式/ 串/ ,/ 我们/ 测试/ 了/ 不同/ 压缩/ 索引/ 的/ count/ 和/ locate/ 查询/ 时间/ ,/ 其/ 结果/ 如表/ 9/ 和表/ 10/ 所示/ ./ 由表/ 9/ 可知/ ,/ 与/ 其他/ 所/ 比较/ 的/ 压缩/ 索引/ 方法/ 相比/ ./ CSA/ 的/ 计数/ 查询/ 时间/ 是/ 最快/ 的/ ,/ 这是/ 由于/ 我们/ 设计/ 了/ 一个/ 快速/ 查找/ 表/ ,/ 加速/ 了/ Φ/ 值/ 的/ 解码/ 过程/ ./ 改进/ 后/ 的/ ACSA/ ,/ 在/ 压缩率/ 表/ 7/ 索引/ 构造/ 时间/ FM/ -/ Index22/ ./ 1523.3322/ ./ 9618.3321/ ./ 1129.7322/ ./ 65RLCSA46/ ./ 3536.4052/ ./ 0639.8440/ ./ 0143.5142/ ./ 22Sad/ -/ CSA50/ ./ 3648.4557/ ./ 3637.4441/ ./ 5464.2776/ ./ 63SDSL/ -/ CSA33/ ./ 5936.2632/ ./ 0426.1927/ ./ 1930.9727/ ./ 18MethodACSACSAMethodACSACSAFM/ -/ Index4/ ./ 03RLCSASad/ -/ CSA4/ ./ 81SDSL/ -/ CSA5/ ./ 31MethodACSACSA/ 表/ 8/ 压缩率/ 比较/ (/ 犫/ 狆/ 狊/ ,/ 犫/ 犻/ 狋/ 狊/ 狆/ 犲/ 狉/ 狊/ 狔/ 犿/ 犫/ 狅/ 犾/ )/ 表/ 9Count/ 查询/ 时间/ FM/ -/ Index416/ ./ 003666.703221/ ./ 192606.052651/ ./ 240493.020576/ ./ 641RLCSA73/ ./ 39958.61061/ ./ 12561.58539/ ./ 25667.00163/ ./ 920Sad/ -/ CSA46/ ./ 69741.04841/ ./ 57538.89634/ ./ 52542.39838/ ./ 534SDSL/ -/ CSA95/ ./ 70661.83296/ ./ 09970.26549/ ./ 89381.78073/ ./ 042/ 表/ 10Locate/ 定位/ 时间/ MethodACSA1023/ ./ 569186.42624/ ./ 44102969.0025831/ ./ 302985.05191733/ ./ 00CSAFM/ -/ Index3488/ ./ 0410745.611368/ ./ 2497021.69115336/ ./ 059160.00425353/ ./ 25RLCSA4302/ ./ 6224595.901304/ ./ 99198446.0032463/ ./ 908335.38379402/ ./ 00Sad/ -/ CSA617/ ./ 539159.41559/ ./ 5448222.973041/ ./ 82314.596779/ ./ 30SDSL/ -/ CSA455/ ./ 081964.81270/ ./ 4213406.399178/ ./ 77701.1223723/ ./ 74/ 上/ 进一步/ 改善/ 的/ 同时/ ,/ 在/ 查询/ 时间/ 上/ 略逊/ 于/ CSA/ ./ 但/ ACSA/ 的/ 查询/ 效率/ 在/ 多数/ 情况/ 下/ 仍然/ 优于/ 其他/ 压缩/ 索引/ 的/ 计数/ 查询/ 时间/ ./ 由表/ 10/ 可知/ ,/ 在/ 定位/ 查询/ locate/ 中/ ,/ CSA/ 在/ 5/ 组/ 测试数据/ 上/ 优于/ Sad/ -/ CSA/ ,/ 在/ 4/ 组/ 测试数据/ 上/ 优于/ SDSL/ -/ CSA/ ./ 改进/ 后/ 的/ ACSA/ 增加/ 了/ 解码/ 的/ 复杂度/ ,/ 定位/ 查询/ 效率/ 逊于/ CSA/ ,/ 优于/ RLCSA/ 和/ FM/ -/ Index/ ./ ACSA/ 和/ CSA/ 相比/ ,/ 在/ 压缩率/ 上/ 有/ 很/ 好/ 的/ 提升/ ,/ 特别/ 是/ 对于/ 高度/ 重复/ 的/ 序列/ 数据/ ,/ 比如/ influenza/ 数据/ ,/ 压缩/ 效果/ 提升/ 3.54/ 倍/ ,/ 块/ 的/ 增大/ 并/ 没有/ 显著/ 增大/ count/ 查询/ 时间/ ,/ 这/ 归功于/ run/ -/ length/ 编码/ ./ 和/ RLC/ -/ SA/ 相比/ ,/ CSA/ 和/ ACSA/ 的/ count/ 查询/ 时间/ 优势/ 明显/ ,/ 压缩率/ 在/ dna/ 这样/ 的/ 数据/ 和/ english/ 这样/ 的/ 数据/ 上/ 优势/ 也/ 很/ 明显/ ,/ 但/ 在/ 高度/ 重复/ 序列/ 上/ 略逊一筹/ ./ 2.252/ ./ 902.242/ ./ 554.144/ ./ 24Page168/ 结论/ 与/ 进一步/ 工作/ 本文/ 提出/ 了/ 一种/ 高阶/ 熵/ 压缩/ 的/ 全文/ 自/ 索引/ ./ 对于/ 长为/ n/ 的/ 文本/ T/ ,/ 我们/ 的/ 压缩/ 索引/ 可/ 在/ 线性/ 时间/ 内/ 构造/ ./ 对于/ 任意/ k/ / clog/ σ/ n/ -/ 1/ 和/ c/ </ 1/ ,/ 我们/ 的/ 压缩/ 索引/ 占用/ 2nHk/ +/ n/ +/ o/ (/ n/ )/ 位/ 的/ 空间/ ,/ 其中/ Hk/ 表示/ 文本/ T/ 的/ k/ 阶熵/ ,/ σ/ 为/ 字符/ 表/ 的/ 大小/ ./ 此外/ ,/ 本文/ 还/ 给出/ 了/ 上述/ 描述/ 的/ 压缩/ 索引/ 的/ 一种/ 实用/ 改进/ ./ 这种/ 实用/ 改进/ 引入/ 了/ 混合/ 编码方法/ ,/ 能/ 根据/ 1/ 在/ gap/ 序列/ 中/ 的/ 分布/ 选择/ 最佳/ 的/ 编码方法/ ,/ 其/ 额外/ 的/ 空间/ 开销/ 为/ o/ (/ n/ )/ 位/ ,/ 可以/ 忽略不计/ ./ 对于/ Pizza/ &/ ChiliCorpus/ 上/ 的/ 三类/ 典型/ 数据/ 的/ 实验/ 表明/ ,/ 我们/ 的/ 压缩/ 索引/ 较之/ 主流/ 压缩/ 索引/ 在/ 压缩率/ 和/ 查询/ 时间/ 上/ 具有/ 显著/ 的/ 优势/ ./ 虽然/ 我们/ 提出/ 了/ 一种/ 高阶/ 熵/ 压缩/ 的/ 全文/ 自/ 索引/ ,/ 并/ 开发/ 出/ 了/ 相应/ 的/ 软件/ ./ 但/ 还/ 存在/ 以下/ 问题/ 有待/ 进一步/ 深入研究/ ./ 首先/ ,/ 第一个/ 问题/ 是/ ,/ 运行/ 时/ 内存/ 过大/ ,/ 严重/ 影响/ 其/ 实用性/ ./ 这是/ 由于/ 在/ 索引/ 构建/ 过程/ 中/ ,/ 首先/ 要建/ 后缀/ 数组/ ,/ 这/ 就/ 需要/ 比/ 原文/ 本大/ 5/ 倍/ 以上/ 的/ 空间/ ./ 其二/ ,/ 目前/ 我们/ 的/ 方法/ 只/ 提供/ 在/ 压缩/ 索引/ 上/ 支持/ 精确/ 模式匹配/ 查询/ ,/ 下/ 一步/ 需要/ 研究/ 支持/ 近似/ 模式匹配/ 查询/ 的/ 压缩/ 索引/ ./ 这/ 两个/ 问题/ 高效/ 地/ 解决/ 后/ ,/ 我们/ 的/ 压缩/ 索引/ 才/ 既/ 能/ 作为/ 文档/ 检索/ 的/ 基础/ ,/ 也/ 能/ 行使/ 倒排/ 索引/ 的/ 功能/ 并/ 可能/ 应用/ 于/ 搜索引擎/ ,/ 且/ 比/ 倒排/ 索引/ 支持/ 更为/ 广泛/ 的/ 查询/ ./ 致谢/ 各位/ 评阅/ 人/ 给出/ 了/ 诸多/ 建设性/ 的/ 意见/ ,/ 在/ 此/ 致谢/ !/ 

