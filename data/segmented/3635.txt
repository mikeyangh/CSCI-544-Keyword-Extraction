Page1/ 面向/ 物/ 联网/ 海量/ 传感器/ 采样/ 数据管理/ 的/ 数据库/ 集群/ 系统/ 框架/ 丁治明/ 1/ )/ 高需/ 1/ )/ ,/ 2/ )/ 1/ )/ (/ 中国科学院/ 软件/ 研究所/ 基础/ 软件/ 国家/ 工程/ 研究/ 中心/ 北京/ 100190/ )/ 2/ )/ (/ 中国科学院/ 研究生院/ 北京/ 100049/ )/ 摘要/ 物/ 联网/ 是/ 目前/ 国际/ 和/ 国内/ 新兴/ 的/ 一项/ 热门/ 技术/ ,/ 正在/ 给/ 人们/ 的/ 生产/ 和/ 生活/ 方式/ 带来/ 深刻/ 的/ 变革/ ./ 物/ 联网/ 在/ 带来/ 诸多/ 好处/ 的/ 同时/ ,/ 也/ 给/ 软件/ 乃至/ 整个/ 信息技术/ 领域/ 带来/ 了/ 前所未有/ 的/ 挑战/ ./ 该文/ 针对/ 物/ 联网/ 传感器/ 采样/ 数据管理/ 中/ 所/ 面临/ 的/ 数据/ 海量/ 性/ 、/ 异构/ 性/ 、/ 时空/ 敏感性/ 、/ 动态/ 流式/ 特性/ 等/ 问题/ ,/ 提出/ 一种/ 面向/ 物/ 联网/ 海量/ 传感器/ 采样/ 数据管理/ 的/ 数据库/ 集群/ 系统/ 框架/ IoT/ -/ ClusterDB/ ./ 实验/ 结果表明/ ,/ IoT/ -/ ClusterDB/ 具有/ 良好/ 的/ 传感器/ 数据/ 接入/ 与/ 查询处理/ 性能/ ,/ 为物/ 联网/ 海量/ 异构/ 传感器/ 采样/ 数据/ 的/ 存储/ 与/ 查询处理/ 提供/ 了/ 一种/ 可行/ 的/ 解决方案/ ./ 关键词/ 物/ 联网/ ;/ 传感器/ ;/ 时空/ 数据/ ;/ 海量/ 数据管理/ ;/ 数据库/ 集群/ 系统/ 1/ 引言/ 物/ 联网/ (/ TheInternetofThings/ ,/ IoT/ )/ 的/ 概念/ 是/ Page2/ 的/ 远程/ 感知/ 和/ 控制/ ,/ 由此/ 生成/ 一个/ 更加/ 智慧/ 的/ 生产/ 和/ 生活/ 体系/ ./ 目前/ ,/ 物/ 联网/ 已经/ 成为/ 一个/ 新/ 的/ 技术/ 热点/ ,/ 得到/ 了/ 世界/ 各国/ 研究者/ 和/ 产业界/ 的/ 广泛/ 关注/ ./ 然而/ ,/ 物/ 联网/ 的/ 研究/ 与/ 产业化/ 还/ 存在/ 着/ 诸多/ 局限/ ,/ 大部分/ 的/ 工作/ 还/ 集中/ 在/ 物/ 联网/ 中/ 单个/ 传感器/ 或/ 小型/ 传感器/ 网络/ 方面/ (/ 如/ 智能/ 传感器/ 技术/ 、/ 压缩/ 传感/ 技术/ 等/ )/ ,/ 或者/ 集中/ 在/ 物/ 联网/ 硬件/ 和/ 网络/ 层面/ (/ 如/ 新型/ 网络/ 互连/ 技术/ 、/ 高通量/ 服务器/ 技术/ 等/ )/ [/ 3/ -/ 7/ ]/ ,/ 而/ 对于/ 物/ 联网/ 欲/ 与/ 互联网/ 相比/ 肩所/ 面临/ 的/ 核心/ 问题/ ,/ 即/ 海量/ 异构/ 传感器/ 数据/ 的/ 存储/ 与/ 查询处理/ 、/ 大量/ 传感器/ 的/ 智能/ 分析/ 与/ 协同工作/ 、/ 复杂/ 事件/ 的/ 自动/ 探测/ 与/ 有/ 效应/ 对/ 等/ 技术/ 的/ 研究/ 还/ 比较/ 有限/ ./ 在/ 物/ 联网/ 系统/ 中/ ,/ 对/ 传感器/ 海量/ 采样/ 数据/ 的/ 集中/ 存储/ 与/ 查询处理/ 是/ 十分/ 重要/ 的/ ./ 通过/ 对/ 海量/ 传感器/ 采样/ 数据/ 的/ 集中管理/ ,/ 用户/ 不仅/ 可以/ 直接/ 在/ 数据中心/ 获得/ 任一/ 传感器/ 的/ 历史/ 与/ 当前/ 状态/ ,/ 而且/ 通过/ 对/ 集中/ 存放/ 的/ 群体/ 数据/ 进行/ 分析/ ,/ 可以/ 实现/ 复杂/ 事件/ 与/ 规律/ 的/ 感知/ ./ 此外/ ,/ 传感器/ 采样/ 数据/ 的/ 集中管理/ 还/ 使得/ 物物/ 互联/ (/ WebofThings/ )/ 、/ 基于/ 物/ 的/ 搜索引擎/ 、/ 传感器/ 采样/ 数据/ 的/ 统计分析/ 与/ 数据挖掘/ 等/ 成为/ 可能/ ./ 在/ 传感器/ 采样/ 数据/ 的/ 集中/ 管理系统/ 中/ ,/ 大量/ 的/ 传感器/ 结点/ 根据/ 预先/ 制定/ 的/ 采样/ 及/ 传输/ 规则/ ,/ 不断/ 地向/ 数据中心/ 传递/ 所/ 采集/ 的/ 数据/ ,/ 从而/ 形成/ 海量/ 的/ 异构/ 数据流/ ./ 数据中心/ 不仅/ 需要/ 正确/ 地/ 理解/ 这些/ 数据/ ,/ 而且/ 需要/ 及时/ 地/ 分析/ 和/ 处理/ 这些/ 数据/ ,/ 进而/ 实现/ 有效/ 的/ 感知/ 和/ 控制/ ./ 通过/ 分析/ 我们/ 不难看出/ ,/ 物/ 联网/ 的/ 以下/ 4/ 个/ 特点/ 对/ 数据处理/ 技术/ 形成/ 了/ 巨大/ 的/ 挑战/ :/ (/ 1/ )/ 物/ 联网/ 数据/ 的/ 海量/ 性/ ./ 物/ 联网/ 系统/ 通常/ 包含/ 着/ 海量/ 的/ 传感器/ 结点/ ./ 其中/ ,/ 大部分/ 传感器/ (/ 如/ 温度传感器/ 、/ GPS/ 传感器/ 、/ 压力/ 传感器/ 等/ )/ 的/ 采样/ 数据/ 是/ 数值/ 型/ 的/ ,/ 但/ 也/ 有/ 许多/ 传感器/ 的/ 采样/ 值/ 是/ 多媒体/ 数据/ (/ 如/ 交通/ 摄像头/ 视频/ 数据/ 、/ 音频/ 传感器/ 采样/ 数据/ 、/ 遥感/ 成像/ 数据/ 等/ )/ ./ 每/ 一个/ 传感器/ 均/ 频繁/ 地/ 产生/ 新/ 的/ 采样/ 数据/ ,/ 系统/ 不仅/ 需要/ 存储/ 这些/ 采样/ 数据/ 的/ 最新/ 版本/ ,/ 而且/ 在/ 多数/ 情况/ 下/ ,/ 还/ 需要/ 存储/ 某个/ 时间段/ (/ 如/ 1/ 个/ 月/ )/ 内/ 所有/ 的/ 历史/ 采样/ 值/ ,/ 以/ 满足/ 溯源/ 处理/ 和/ 复杂/ 数据分析/ 的/ 需要/ ./ 可以/ 想象/ ,/ 上述/ 数据/ 是/ 海量/ 的/ ,/ 对/ 它们/ 的/ 存储/ 、/ 传输/ 、/ 查询/ 以及/ 分析/ 处理/ 将/ 是/ 一个/ 前所未有/ 的/ 挑战/ ./ (/ 2/ )/ 传感器/ 结点/ 及/ 采样/ 数据/ 的/ 异构/ 性/ ./ 在/ 同一个/ 物/ 联网/ 系统/ 中/ ,/ 可以/ 包含/ 形形色色/ 的/ 传感器/ ,/ 如/ 交通/ 类/ 传感器/ 、/ 水文/ 类/ 传感器/ 、/ 地质/ 类/ 传感器/ 、/ 气象/ 类/ 传感器/ 、/ 生物/ 医学类/ 传感器/ 等/ ,/ 其中/ 每/ 一类/ 传感器/ 又/ 包括/ 诸多/ 具体/ 的/ 传感器/ ,/ 如/ 交通/ 类/ 传感器/ 可以/ 细分/ 为/ GPS/ 传感器/ 、/ RFID/ 传感器/ 、/ 车牌/ 识别/ 传感器/ 、/ 电子/ 照相/ 身份/ 识别/ 传感器/ 、/ 交通流量/ 传感器/ (/ 红外/ 、/ 线圈/ 、/ 光学/ 、/ 视频/ 传感器/ )/ 、/ 路况/ 传感器/ 、/ 车况/ 传感器/ 等/ ./ 这些/ 传感器/ 不仅/ 结构/ 和/ 功能/ 不同/ ,/ 而且/ 所/ 采集/ 的/ 数据/ 也/ 是/ 异构/ 的/ ./ 这种/ 异构/ 性/ 极大地提高/ 了/ 软件开发/ 和/ 数据处理/ 的/ 难度/ ./ (/ 3/ )/ 物/ 联网/ 数据/ 的/ 时空/ 相关性/ ./ 与/ 普通/ 互联网/ 结点/ 不同/ ,/ 物/ 联网/ 中/ 的/ 传感器/ 结点/ 普遍存在/ 着/ 空间/ 和/ 时间/ 属性/ —/ —/ —/ 每个/ 传感器/ 结点/ 都/ 有/ 地理位置/ ,/ 每个/ 数据/ 采样/ 值/ 都/ 有/ 时间/ 属性/ ,/ 而且/ 许多/ 传感器/ 结点/ 的/ 地理位置/ 还是/ 随着/ 时间/ 的/ 变化/ 而/ 连续/ 移动/ 的/ ,/ 如/ 智能/ 交通系统/ 中/ ,/ 每个/ 车辆/ 安装/ 了/ 高精度/ 的/ GPS/ 或/ RFID/ 标签/ ,/ 在/ 交通网络/ 中/ 动态/ 地/ 移动/ ./ 与物/ 联网/ 数据/ 的/ 时空/ 相关性/ 相对/ 应/ ,/ 物/ 联网/ 应用/ 中/ 对/ 传感器/ 数据/ 的/ 查询/ 也/ 并/ 不仅仅/ 局限于/ 关键字/ 查询/ ./ 很多/ 时候/ ,/ 我们/ 需要/ 基于/ 复杂/ 的/ 逻辑/ 约束条件/ 进行/ 查询/ ,/ 如/ 查询/ 某个/ 指定/ 地理/ 区域/ 中/ 所有/ 地质/ 类/ 传感器/ 在/ 规定/ 时间段/ 内所/ 采集/ 的/ 数据/ ,/ 并/ 对/ 它们/ 进行/ 统计分析/ ./ 由此可见/ ,/ 对物/ 联网/ 数据/ 的/ 空间/ 与/ 时间/ 属性/ 进行/ 智能化/ 的/ 管理/ 与/ 分析/ 处理/ 是/ 至关重要/ 的/ ./ (/ 4/ )/ 物/ 联网/ 数据/ 的/ 序列/ 性/ 与/ 动态/ 流式/ 特性/ ./ 在/ 物/ 联网/ 系统/ 中/ ,/ 要/ 查询/ 某个/ 监控/ 对象/ 在/ 某/ 一/ 时刻/ 的/ 物理/ 状态/ 是/ 不能/ 简单/ 地/ 通过/ 对/ 时间/ 点/ 的/ 关键字/ 匹配/ 来/ 完成/ 的/ ,/ 这/ 是因为/ 采样/ 过程/ 是/ 间断/ 进行/ 的/ ,/ 查询/ 时间/ 与/ 某个/ 采样/ 时间/ 正好/ 匹配/ 的/ 概率/ 极低/ ./ 为了/ 有效/ 地/ 进行/ 查询处理/ ,/ 需要/ 将/ 同一个/ 监控/ 对象/ 的/ 历次/ 采样/ 数据/ 组合成/ 一个/ 采样/ 数据/ 序列/ ,/ 并/ 通过/ 插值/ 计算/ 的/ 方式/ 得到/ 监控/ 对象/ 在/ 指定/ 时刻/ 的/ 物理/ 状态/ ./ 采样/ 数据/ 序列/ 反映/ 了/ 监控/ 对象/ 的/ 状态/ 随/ 时间/ 变化/ 的/ 完整/ 过程/ ,/ 因此/ 包含/ 比/ 单个/ 采样/ 值/ 丰富/ 得/ 多/ 的/ 信息/ ./ 此外/ ,/ 采样/ 数据/ 序列/ 表现/ 出/ 明显/ 的/ 动态/ 流式/ 特性/ —/ —/ —/ 随着/ 新/ 采样/ 值/ 的/ 不断/ 到来/ 和/ 过时/ 采样/ 值/ 的/ 不断/ 淘汰/ ,/ 采样/ 数据/ 序列/ 是/ 不断/ 的/ 动态变化/ 的/ ./ 针对/ 物/ 联网/ 海量/ 数据管理/ 所/ 面临/ 的/ 上述/ 挑战/ ,/ 目前/ 尚/ 没有/ 有效/ 的/ 解决/ 方法/ ./ 在/ 海量/ 数据处理/ 方面/ ,/ 最/ 有效/ 的/ 方法/ 之一/ 是/ 云/ 数据管理/ 技术/ ,/ 但/ 几乎/ 所有/ 的/ 云/ 数据/ 管理系统/ 均/ 为/ “/ 键/ -/ 值/ ”/ 数据库/ ,/ 即/ 按照/ 主/ 关键字/ 对/ 数据/ 进行/ 分布/ 组织/ 和/ 查询处理/ ./ 这种/ 方法/ 无法/ 有效/ 地/ 支持/ 对/ 传感器/ 采样/ 数据/ 的/ 时空/ 查询处理/ ./ 另/ 一种/ 海量/ 数据管理/ 方法/ 是/ 并行/ 数据库/ 技术/ ,/ 通过/ 将/ 多个/ 关系数据库/ 组织/ 成/ 数据库/ 集群/ 来/ 支持/ 海量/ 结构化/ 数据/ 的/ 处理/ ,/ 但/ 这种/ 方法/ 在/ 处理/ 关键字/ 查询/ 时/ Page3/ 的/ 性能/ 要远/ 低于/ “/ 键/ -/ 值/ ”/ 数据库/ ;/ 此外/ ,/ 由于/ 采用/ 了/ 严格/ 的/ 事务处理/ 机制/ ,/ 在/ 传感器/ 采样/ 数据/ 频繁/ 更新/ 的/ 条件/ 下/ ,/ 并行/ 数据库/ 的/ 数据处理/ 效率/ 十分/ 低下/ ./ 在/ 传感器/ 采样/ 数据/ 的/ 表示/ 方面/ ,/ 最/ 自然/ 的/ 想法/ 是/ 采用/ 时空/ 数据库/ 的/ 有关/ 方法/ ./ 但是/ ,/ 传感器/ 采样/ 数据/ 除了/ 时空/ 属性/ 之外/ ,/ 还/ 包含/ 物理/ 目标/ 的/ 种种/ 其它/ 属性/ (/ 如/ 温度/ 、/ 压力/ 、/ 交通流/ 密度/ 、/ 速度/ 等/ )/ ,/ 如何/ 对/ 这些/ 异构/ 的/ 物理/ 属性/ 进行/ 统一/ 的/ 表示/ 是/ 目前/ 尚未/ 解决/ 的/ 问题/ ./ 此外/ ,/ 目前/ 的/ 时空/ 数据库/ 方法/ 主要/ 针对/ 单个/ 数据库/ 结点/ ,/ 在/ 大规模/ 时空/ 数据库/ 集群/ 方面/ 尚/ 没有/ 有效/ 的/ 解决方案/ ./ 针对/ 上述/ 问题/ ,/ 本文/ 提出/ 一种/ “/ 面向/ 物/ 联网/ 海量/ 传感器/ 采样/ 数据管理/ 的/ 数据库/ 集群/ 系统/ 框架/ ”/ (/ IoTDatabaseClusterSystemFrameworkforManagingMassiveSensorSamplingData/ ,/ IoT/ -/ ClusterDB/ )/ ./ 在/ IoT/ -/ ClusterDB/ 中/ ,/ 同一个/ 监控/ 对象/ 的/ 历次/ 传感器/ 采样/ 值/ 被/ 组织/ 成/ 采样/ 数据/ 序列/ 进行/ 存储/ ,/ 通过/ 查询/ 操作/ 及时/ 空/ 计算/ ,/ 可以/ 支持/ 对/ 传感器/ 采样/ 数据/ 的/ 复杂/ 逻辑/ 条件/ 查询/ ./ 此外/ ,/ IoT/ -/ ClusterDB/ 是/ 一个/ 由/ 大量/ 数据库/ 组成/ 的/ 分布式系统/ ,/ 通过/ 建立/ 分布式/ 的/ 全局/ 关键字/ 索引/ 和/ 全局/ 时空/ 索引/ ,/ IoT/ -/ ClusterDB/ 可以/ 支持/ 高效率/ 的/ 关键字/ 查询/ 和/ 时空/ 查询/ ./ 本文/ 第/ 2/ 节/ 综述/ 物/ 联网/ 海量/ 数据管理/ 方面/ 的/ 相关/ 工作/ ;/ 第/ 3/ 节/ 阐述/ IoT/ -/ ClusterDB/ 的/ 体系结构/ 及其/ 核心/ 工作/ 机理/ ;/ 第/ 4/ 节/ 和/ 第/ 5/ 节/ 分别/ 阐述/ IoT/ -/ ClusterDB/ 的/ 单个/ 结点/ 及/ 集群/ 系统/ 的/ 组织/ 方法/ ;/ 第/ 6/ 节/ 讨论/ 系统/ 的/ 实现/ 与/ 实验/ 结果/ ;/ 第/ 7/ 节/ 给出/ 相关/ 结论/ ./ 2/ 相关/ 工作/ 在/ 传感器/ 采样/ 数据/ 的/ 存储/ 与/ 查询处理/ 方面/ ,/ 传统/ 的/ 方法/ 主要/ 是/ 分布式/ 的/ 存储/ 方法/ ./ 分布式/ 存储/ 方法/ [/ 8/ -/ 10/ ]/ 是/ 指/ 将/ 采样/ 数据/ 直接/ 存储/ 在/ 各/ 传感器/ 结点/ ,/ 或者/ 存放/ 在/ Sink/ 节点/ ,/ 查询处理/ 时/ 再/ 通过/ 远程/ 访问/ 获取数据/ ./ 如果/ 查询/ 涉及/ 到/ 不同/ 的/ 传感器/ 网络/ ,/ 则/ 需要/ 通过/ 中间件/ 来/ 进行/ 模型/ 转换/ ,/ 进而/ 实现/ 异构/ 传感器/ 网络/ 之间/ 的/ 互操作/ [/ 11/ -/ 12/ ]/ ./ 上述/ 方法/ 的/ 好处/ 是/ :/ 由于/ 传感器/ 数据/ 直接/ 存储/ 在/ 本地/ 或/ 就近/ 的/ Sink/ 结点/ ,/ 因此/ 避免/ 了/ 数据/ 存储/ 时/ 的/ 传输/ 通信/ 开销/ ./ 但是/ ,/ 上述/ 方式/ 并/ 不/ 适合/ 于/ 以/ 密集/ 复杂/ 查询/ 和/ 异构/ 数据/ 集/ 成为/ 特征/ 的/ 大规模/ 物/ 联网/ 环境/ ,/ 原因/ 如下/ :/ (/ 1/ )/ 物/ 联网/ 系统/ 中/ 通常/ 涉及/ 密集型/ 的/ 复杂/ 查询处理/ ,/ 如/ 时空/ 约束条件/ 查询/ 、/ 群体/ 数据/ 查询/ 、/ 统计分析/ 查询/ 等/ ,/ 这/ 类/ 查询/ 往往/ 需要/ 对/ 大面积/ 的/ 传感器/ 进行/ 反复/ 的/ 扫描/ ,/ 因此/ 查询处理/ 会/ 涉及/ 密集/ 的/ 远程/ 访问/ ,/ 带来/ 庞大/ 的/ 通信/ 开销/ ,/ 抵消/ 了/ 本地/ 数据/ 采集/ 不/ 需要/ 进行/ 通信/ 传输/ 的/ 好处/ ./ (/ 2/ )/ 物/ 联网/ 系统/ 中/ 通常/ 会/ 涉及/ 多种/ 异构/ 的/ 传感器/ 类型/ ,/ 通过/ 模型/ 转换/ 的/ 方式/ 不仅/ 表示/ 能力/ 有限/ ,/ 而且/ 模型/ 转换/ 需要/ 额外/ 的/ 计算/ 开销/ ,/ 导致/ 查询处理/ 的/ 效率/ 较为/ 低下/ ./ (/ 3/ )/ 物/ 联网/ 中/ 通常/ 需要/ 存储/ 长时间/ 的/ 历史/ 与/ 当前/ 采样/ 数据/ ,/ 以/ 满足/ 溯源/ 处理/ 和/ 统计分析/ 的/ 需要/ ,/ 而/ 传感器/ 和/ Sink/ 结点/ 的/ 存储/ 能力/ 是/ 相对/ 有限/ 的/ ,/ 难以/ 满足/ 长时间/ 采样/ 数据/ 存储/ 的/ 要求/ ./ 鉴于/ 分布式/ 存储/ 方式/ 的/ 上述/ 局限/ ,/ 近年来/ 越来越/ 多/ 的/ 研究/ 转向/ 了/ 集中式/ 的/ 传感器/ 数据管理/ ./ 在/ 集中式/ 数据/ 管理系统/ 中/ ,/ 各/ 传感器/ 按照/ 一定/ 的/ 采样/ 规则/ ,/ 将/ 所/ 采集/ 的/ 数据/ 上/ 传到/ 数据中心/ 进行/ 统一/ 的/ 存储管理/ ,/ 使得/ 查询处理/ 可以/ 直接/ 在/ 数据中心/ 完成/ ,/ 而/ 不/ 需要/ 给/ 传感器/ 或/ Sink/ 结点/ 带来/ 额外/ 的/ 计算/ 与/ 通信/ 开销/ ./ 由于/ 数据中心/ 具有/ 相对/ 强大/ 得/ 多/ 的/ 存储/ 与/ 计算能力/ ,/ 因此/ 这种/ 方式/ 可以/ 支持/ 各种/ 复杂/ 的/ 、/ 密集型/ 的/ 查询/ ,/ 更加/ 适合/ 于物/ 联网/ 的/ 相关/ 应用环境/ ./ 在/ 集中式/ 的/ 传感器/ 数据处理/ 方面/ ,/ 最/ 直接/ 的/ 方法/ 是/ 采用/ 云/ 数据管理/ 及其/ 相关/ 技术/ [/ 13/ -/ 16/ ]/ ./ 云/ 计算/ 是/ 最近/ 几年/ 新兴/ 的/ 一个/ 技术/ 领域/ ,/ 其/ 核心/ 特点/ 是/ 通过/ 一种/ 协同/ 机制/ ,/ 动态/ 管理/ 几万/ 台/ 、/ 几十万/ 台/ 甚至/ 上百万/ 台/ 计算机/ 资源/ 所/ 具有/ 的/ 总/ 处理/ 能力/ ,/ 并/ 按需分配/ 给/ 全球/ 用户/ ,/ 使/ 它们/ 可以/ 在/ 此/ 之上/ 构建/ 稳定/ 而/ 快速/ 的/ 存储/ 以及/ 其它/ IT/ 服务/ ,/ 因此/ 为物/ 联网/ 海量/ 数据处理/ 提供/ 了/ 一种/ 可能/ ./ 然而/ ,/ 目前/ 绝大多数/ 的/ 云/ 数据/ 管理系统/ 属于/ “/ 键/ -/ 值/ ”/ 数据库/ ,/ 如/ Bigtable/ [/ 17/ ]/ 、/ Dynamo/ [/ 18/ ]/ 、/ HBase/ [/ 19/ ]/ 、/ PNUTS/ [/ 20/ ]/ 、/ HIVE/ [/ 21/ ]/ 等/ (/ 少量/ 的/ 云/ 数据库系统/ 采用/ 下面/ 将/ 讨论/ 的/ 并行/ 数据库/ 技术/ ,/ 如/ SQLAzure/ [/ 22/ ]/ 等/ )/ ./ “/ 键/ -/ 值/ ”/ 数据库/ 能够/ 高效/ 地/ 处理/ 基于/ 主/ 关键字/ 的/ 查询/ ,/ 但/ 不能/ 有效/ 地/ 支持物/ 联网/ 数据/ 的/ 时空/ 关系/ 表示/ 与/ 存储/ 、/ 时空/ 逻辑/ 条件/ 查询/ 以及/ 属性/ 约束条件/ 查询/ 等/ ./ 另/ 一种/ 集中式/ 的/ 传感器/ 数据管理/ 方法/ 是/ 采用/ 并行/ 数据库/ 技术/ [/ 23/ -/ 25/ ]/ ./ 并行/ 数据库/ 通过/ 将/ 多个/ 关系数据库/ 组织/ 成/ 数据库/ 集群/ 来/ 支持/ 海量/ 结构化/ 数据/ 的/ 处理/ ,/ 但/ 这种/ 方法/ 在/ 处理/ 关键字/ 查询/ 时/ 的/ 性能/ 要远/ 低于/ “/ 键/ -/ 值/ ”/ 数据库/ ,/ 无法/ 根据/ 传感器/ 的/ 标识/ 快速/ 地/ 检索/ 到/ 所/ 需要/ 的/ 数据/ ./ 此外/ ,/ 由于/ 采用/ 了/ 严格/ 的/ 分布式/ 事务处理/ 机制/ (/ 如/ 两/ 阶段/ 提交/ 协议/ 、/ 数据/ 加锁/ 协议/ 等/ )/ ,/ 在/ 传感器/ 采样/ 数据/ 频繁/ 上传/ 和/ 更新/ 的/ 情况/ 下/ ,/ Page4/ 数据处理/ 的/ 效率/ 十分/ 低下/ ./ 最后/ ,/ 传统/ 的/ 并行/ 数据库/ 技术/ 主要/ 针对/ 通用/ 的/ 数据类型/ ,/ 尚/ 不能/ 有效/ 地/ 支持物/ 联网/ 中/ 传感器/ 时空/ 相关/ 数据/ 的/ 并行/ 存储/ 与/ 查询处理/ ./ 文献/ [/ 26/ ]/ 讨论/ 了/ 传感器/ 数据中心/ (/ SDC/ )/ 的/ 数据/ 复制/ 与/ 负载/ 均衡/ 问题/ ./ 作者/ 虽然/ 对/ 集中式/ 传感器/ 数据中心/ 的/ 最终目标/ 进行/ 了/ 描述/ ,/ 但是/ 目前/ 的/ 研究/ 还/ 比较/ 初步/ ./ 所/ 给出/ 的/ SDC/ 框架/ 是/ 直接/ 建立/ 在/ 计算机/ 集群/ 上/ 的/ ,/ 而/ 不是/ 通过/ 数据库/ 集群/ 的/ 方式/ ,/ 因此/ 没有/ 解决/ 传感器/ 异构/ 时空/ 数据/ 的/ 表示/ 模型/ 、/ 全局/ 索引/ 、/ 全局/ 查询/ 机制/ 等/ 关键技术/ 问题/ ./ 在/ 异构/ 传感器/ 采样/ 数据/ 的/ 统一/ 表示/ 方法/ 方面/ ,/ 最/ 直接/ 的/ 思路/ 是/ 采用/ 空间/ 数据库/ 及时/ 空/ 数据库/ 的/ 有关/ 方法/ [/ 27/ -/ 28/ ]/ ,/ 解决/ 传感器/ 数据/ 的/ 异构/ 性/ 和/ 时空/ 相关性/ 问题/ ./ 但是/ ,/ 传感器/ 采样/ 数据/ 除了/ 时空/ 属性/ 之外/ ,/ 还/ 包含/ 物理/ 对象/ 的/ 种种/ 其它/ 属性/ (/ 如/ 温度/ 、/ 压力/ 、/ 交通流/ 密度/ 、/ 速度/ 等/ )/ ,/ 如何/ 对/ 这些/ 异构/ 的/ 物理/ 属性/ 进行/ 统一/ 的/ 表示/ 是/ 目前/ 尚未/ 解决/ 的/ 问题/ ./ 此外/ ,/ 空间/ 数据库/ 主要/ 面向/ 静态/ 的/ 空间/ 对象/ ,/ 而/ 时空/ 数据库/ 虽然/ 可以/ 处理/ 动态/ 上传/ 的/ 数据/ (/ 如/ 时空/ 轨迹/ 数据/ )/ ,/ 但/ 目前/ 的/ 研究/ 主要/ 针对/ 单个/ 时空/ 数据库/ 结点/ ,/ 在/ 大规模/ 图/ 1IoT/ -/ ClusterDB/ 的/ 体系结构/ 如图/ 1/ 所示/ ,/ IoT/ -/ ClusterDB/ 是/ 由/ 多个/ 传感器/ 时空/ 数据库/ 结点/ (/ IoTSensorSpatial/ -/ TemporalDataBaseNode/ ,/ IoT/ -/ NodeDB/ )/ 所/ 组成/ 的/ 一个/ 数据库/ 集群/ ./ 在/ IoT/ -/ ClusterDB/ 中/ ,/ 并/ 不是/ 原封不动/ 地/ 存放/ 所有/ 的/ 传感器/ 采样/ 数据/ ,/ 而是/ 只/ 存放/ 数值/ 型/ 的/ 关键/ 采样/ 数据/ ./ 为此/ ,/ 系统/ 需要/ 通过/ 传感器/ 接入/ 处理器/ 对/ 数据/ 进行/ 预处理/ ./ 此外/ ,/ 原始/ 的/ 传感器/ 采样/ 数据/ 也/ 保存/ 在/ 各个/ 传感器/ 接入/ 处理器/ 中/ ,/ 以/ 满足/ 溯源/ 处理/ 的/ 要求/ ./ 从/ 层次/ 划分/ 的/ 角度/ 来看/ ,/ 传感器/ 接入/ 处理器/ 位于/ 传感器/ 网络层/ 之上/ ,/ 因此/ 对/ 各种/ 传感器/ 网络/ 本身/ 的/ 数据/ 采集/ 、/ 通信/ 模式/ 没有/ 特殊要求/ ,/ 从而/ 增加/ 了/ 整个/ 系统/ 的/ 灵活性/ 和/ 可扩充性/ ./ 的/ 时空/ 数据库/ 集群/ 方面/ 的/ 研究/ 尚/ 处于/ 空白/ ./ 从/ 数据流/ 处理/ 的/ 角度/ 来看/ ,/ 虽然/ 物/ 联网/ 传感器/ 采样/ 数据/ 表现/ 出/ 动态/ 上传/ 的/ 流式/ 特性/ ,/ 但是/ 其/ 处理/ 方法/ 与/ 流/ 数据管理/ 技术/ 有着/ 根本/ 的/ 不同/ :/ 目前/ 的/ 绝大多数/ 流/ 数据库/ ,/ 如/ TelegraphCQ/ [/ 29/ ]/ 、/ Gigascope/ [/ 30/ ]/ 、/ SystemS/ [/ 31/ ]/ 、/ Net/ -/ Fli/ [/ 32/ ]/ 等/ ,/ 主要/ 解决/ 如何/ 在/ 数据流/ 到来/ 的/ 过程/ 中/ ,/ 实时/ 地/ 解析/ 出/ 查询/ 结果/ (/ 通常/ 针对/ 相对/ 简单/ 的/ 查询/ ,/ 如/ 查找/ 某个/ 特定/ 的/ 数据项/ 或/ 序列/ 模式/ 等/ )/ ,/ 数据库/ 内/ 并/ 不/ 存储/ 长时间/ 的/ 历史数据/ ;/ 而物/ 联网/ 中/ 需要/ 保存/ 长时间/ 的/ 历史数据/ ,/ 并/ 在/ 此基础/ 上/ 实现/ 复杂/ 和/ 灵活/ 得/ 多/ 的/ 查询处理/ ./ 综合/ 以上/ 分析/ 可以/ 看出/ ,/ 针对/ 物/ 联网/ 中/ 传感器/ 采样/ 数据管理/ 所/ 面临/ 的/ 海量/ 性/ 、/ 异构/ 性/ 、/ 时空/ 相关性/ 及/ 动态/ 流式/ 特性/ 等/ 挑战/ ,/ 目前/ 尚/ 没有/ 成熟/ 的/ 解决方案/ ,/ 需要/ 有/ 针对性/ 地/ 进行/ 专门/ 的/ 研究/ ./ 3IoT/ -/ ClusterDB/ 的/ 系统结构/ 在/ 本节/ ,/ 我们/ 描述/ IoT/ -/ ClusterDB/ 的/ 体系结构/ (/ 见图/ 1/ )/ 与/ 工作/ 机理/ ./ 3.1/ 传感器/ 的/ 接入/ 与/ 预处理/ 在/ IoT/ -/ ClusterDB/ 中/ ,/ 允许/ 接入/ 的/ 监控/ 设备/ 包括/ 物/ 联网/ 系统/ 中/ 所/ 管理/ 的/ 各类/ 传感器/ 设备/ 、/ 视频/ 与/ 音频/ 监控/ 设备/ 、/ 部署/ 在/ 某个/ 区域/ 的/ 无线/ 传感器/ 网络/ (/ WSN/ )/ 等/ ./ 此外/ ,/ IoT/ -/ ClusterDB/ 还/ 允许/ 以/ 人工/ 的/ 方式/ 输入/ 感知/ 数据/ ./ 所有/ 这些/ 方式/ 获得/ 的/ 数据/ ,/ 我们/ 均/ 统一/ 地/ 称之为/ “/ 传感器/ 采样/ 数据/ ”/ ./ 通常/ 情况/ 下/ ,/ 传感器/ 的/ 采样/ 数据/ 是/ 数值/ 型/ 的/ ,/ 如/ 温度传感器/ 、/ 压力/ 传感器/ 、/ GPS/ 传感器/ 、/ 无线/ 传感器/ 网络/ 等/ 所/ 获得/ 的/ 数据/ ./ 但是/ ,/ IoT/ -/ ClusterDB/ 也/ 允许/ 多媒体/ 设备/ (/ 如/ 视频/ 监控/ 设备/ 、/ 遥感/ 成像/ 设备/ 、/ 高空/ 成像/ 设备/ 等/ )/ 接入/ 系统/ ,/ 通过/ 相应/ 的/ 多媒体/ 分析/ ,/ 可/ Page5/ 以/ 从/ 这些/ 设备/ 所/ 获得/ 的/ 多媒体/ 数据/ (/ 如/ 交通/ 摄像头/ 采集/ 的/ 视频/ 数据流/ )/ 中/ 提取/ 出/ 有/ 意义/ 的/ 数值/ 型/ 数据/ (/ 如/ 道路交通/ 流/ 的/ 平均速度/ 、/ 车辆/ 密度/ 、/ 交通流量/ 等/ )/ ./ 因此/ ,/ 多媒体/ 设备/ 连同/ 传感器/ 接入/ 处理器/ (/ 见图/ 2/ )/ 中/ 相应/ 的/ 多媒体/ 分析/ 模块/ ,/ 可以/ 达到/ 与/ 普通/ 传感器/ 一样/ 的/ 效果/ ,/ 所以/ 在/ 本文/ 中/ 我们/ 也/ 将/ 它们/ 统一/ 地/ 纳入/ 传感器/ 的/ 范畴/ ./ 通过/ 上述/ 分析/ 可以/ 看出/ ,/ 本文/ 所说/ 的/ “/ 传感器/ 数据/ ”/ 事实上/ 是/ 一个/ 广义/ 的/ 概念/ ,/ 包括/ 任意/ 类型/ 带有/ 时空/ 特性/ 的/ 、/ 反映/ 物理/ 世界/ 状态/ 的/ 数据/ ./ 例如/ ,/ 在/ 发生/ SARS/ 疫情/ 时/ ,/ 每/ 一个/ 病例/ 登记/ 即可/ 看成/ 一个/ 传感器/ 采样/ 数据/ ,/ 该/ 数据/ 反映/ 了/ 病例/ 发生/ 的/ 时间/ 、/ 地点/ 、/ 规模/ 等/ 信息/ ./ 又/ 如/ ,/ 在/ 大面积/ 布设/ 的/ WSN/ 中/ ,/ 系统/ 本身/ 即可/ 根据/ 多个/ 传感器/ 个体/ 的/ 采样/ 值/ 获得/ 汇总/ 数据/ (/ 如/ 污染带/ 的/ 面积/ 、/ 位置/ 等/ )/ ,/ 这些/ 汇总/ 数据/ 也/ 可以/ 看成/ 传感器/ 采样/ 数据/ (/ 在/ 这种/ 情况/ 下/ ,/ 可以/ 将/ 整个/ WSN/ 看成/ 一个/ 传感器/ ,/ 而/ 不/ 需要/ 对/ 其中/ 的/ 单个/ 传感器/ 进行/ 管理/ )/ ./ 传感器/ 将/ 采样/ 数据/ 上/ 传给/ 传感器/ 接入/ 处理器/ (/ SensorConnectingProcessor/ ,/ SCP/ )/ 的/ 方式/ 可/ 分为/ 两种/ :/ 主动/ 上传/ 与/ 被动/ 上传/ ./ 其中/ ,/ 主动/ 上传/ 是/ 根据/ 预先/ 定义/ 的/ 条件/ ,/ 由/ 传感器/ 自身/ 进行/ 计算/ 和/ 判断/ ,/ 只有/ 当/ 规定/ 的/ 条件/ 满足/ 时才/ 上传/ 数据/ ,/ 这种/ 方式/ 具有/ 较/ 好/ 的/ 数据传输/ 效率/ ,/ 但/ 需要/ 传感器/ 具备/ 一定/ 的/ 计算能力/ ;/ 而/ 被动/ 上传/ 则/ 是/ 以/ 一定/ 的/ 频率/ 周期性/ 地上/ 传/ 数据/ ,/ 这种/ 方式/ 虽然/ 具有/ 较大/ 的/ 通信/ 代价/ ,/ 但/ 对/ 传感器/ 的/ 计算能力/ 要求/ 很小/ ,/ 因此/ 也/ 得到/ 了/ 广泛/ 的/ 应用/ ./ 在/ IoT/ -/ ClusterDB/ 中/ ,/ 传感器/ 采样/ 数据/ 是/ 以/ “/ 原子/ 监控/ 对象/ (/ atomicmonitoredobject/ )/ ”/ 为/ 单位/ 进行/ 组织/ 的/ ,/ 而/ 不是/ 以/ 传感器/ 为/ 单位/ ./ 同一个/ 监控/ 对象/ 的/ 所有/ 传感器/ 采样/ 值/ 按照/ 时间/ 序列/ 组织/ 在/ 一起/ ,/ 形成/ 该/ 监控/ 对象/ 的/ “/ 采样/ 数据/ 序列/ ”/ ,/ 并/ 作为/ 一个/ 属性/ 存放/ 在/ 该/ 监控/ 对象/ 的/ 元组/ 记录/ 中/ ./ 在/ 绝大多数/ 情况/ 下/ ,/ 一个/ 监控/ 对象/ 即/ 对应/ 于/ 一个/ 传感器/ (/ 如/ 太湖/ 中/ 的/ 一个/ 温度传感器/ 可/ 看成/ 是/ 一个/ 监控/ 对象/ ,/ 对应/ 于/ 一个/ 具体/ 的/ 温度/ 监测点/ ,/ 因此/ 太湖/ 中/ 可/ 包含/ 大量/ 的/ 监控/ 对象/ )/ ;/ 但/ 某些/ 时候/ 两者/ 并/ 不/ 具有/ 一一对应/ 的/ 关系/ ,/ 例如/ RFID/ 传感器/ 与/ 所/ 监控/ 的/ 车辆/ 或/ 货物/ 之间/ 并/ 没有/ 固定/ 的/ 对应/ 关系/ —/ —/ —/ 带有/ RFID/ 标签/ 的/ 监控/ 对象/ 的/ 采样/ 数据/ 序列/ 是/ 由/ 整个/ 系统/ 中/ 的/ 多个/ RFID/ 传感器/ 所/ 采集/ 的/ 数据/ 汇总/ 而成/ 的/ ./ 根据/ 监控/ 对象/ 的/ 位置/ 是否/ 移动/ ,/ 我们/ 可以/ 将/ 它们/ 分为/ 两大类/ :/ 静止/ 监控/ 对象/ (/ 如/ 太湖/ 中/ 固定/ 布设/ 的/ 温度传感器/ 、/ 车库/ 中/ 的/ 剩余/ 车位/ 计数器/ 、/ 无线/ 传感器/ 网络/ 等/ )/ 和/ 移动/ 监控/ 对象/ (/ 如带/ GPS/ 、/ RFID/ 标签/ 、/ 条形码/ 的/ 车辆/ 与/ 货物/ 、/ 浮动/ 车上/ 布设/ 的/ 视频/ 交通流/ 传感器/ 等/ )/ ./ 传感器/ 接入/ 处理器/ 可以/ 实现/ 大量/ 传感器/ 的/ 接入/ ,/ 实现/ 对/ 传感器/ 原始/ 采样/ 数据/ 的/ 分析/ 、/ 过滤/ 与/ 转换/ ,/ 完成/ 原始/ 采样/ 数据/ 的/ 本地/ 存储/ ,/ 并/ 将/ 处理/ 后/ 的/ 数值/ 型/ 关键/ 采样/ 数据/ 上/ 传到/ IoT/ -/ ClusterDB/ 数据库/ 集群/ 中/ 做/ 进一步/ 的/ 处理/ ./ 传感器/ 接入/ 处理器/ 分担/ 了/ 整个/ 系统/ 的/ 很大/ 一部分/ 数据处理/ 与/ 存储/ 任务/ ,/ 使得/ IoT/ -/ ClusterDB/ 只/ 需/ 处理/ 相对/ 较少/ 的/ 、/ 带有/ 语义/ 信息/ 的/ 数值/ 型/ 关键/ 采样/ 数据/ ./ 图/ 2/ 给出/ 了/ 传感器/ 接入/ 处理器/ 的/ 工作/ 过程/ ./ 如下/ :/ 如图/ 2/ 所示/ ,/ 传感器/ 接入/ 处理器/ 的/ 主要/ 工作/ 过程/ (/ 1/ )/ 非/ 数值/ 型/ 采样/ 数据/ 的/ 数值/ 化/ ./ 对于/ 多媒体/ 原始/ 采样/ 数据/ ,/ 传感器/ 接入/ 处理器/ 需要/ 进行/ 相关/ 的/ 多媒体/ 数据分析/ ,/ 获得/ 能够/ 反映/ 监控/ 对象/ 物理/ 状态/ 的/ 数值/ 型/ 导出/ 数据/ ,/ 如/ 通过/ 对/ 交通/ 摄像头/ 视频/ 图像/ 的/ 分析/ ,/ 可以/ 提取/ 出/ 监控/ 地点/ 的/ 车辆/ 密度/ 、/ 平均/ 车速/ 、/ 交通流量/ 等/ 参数信息/ ;/ 通过/ 对/ 高空/ 遥感/ 图像/ 的/ 分析/ ,/ 可以/ 提取/ 出/ 污染/ 区域/ 及/ 火灾/ 区域/ 的/ 地理/ 几何/ 形状/ 等/ 空间数据/ 信息/ ./ (/ 2/ )/ 密集/ 采集/ 数据/ 的/ 稀疏/ 化/ ./ 无论是/ 通过/ 多媒体/ 数据分析/ 所/ 获得/ 的/ 数值/ 型/ 导出/ 数据/ ,/ 还是/ 直接/ 从/ 传感器/ 获得/ 的/ 数值/ 型/ 原始/ 采样/ 数据/ ,/ 它们/ 仍然/ 存在/ 着/ 采样/ 频率/ 过高/ 的/ 缺陷/ ./ 如果/ 将/ 这些/ 数据/ 全部/ 传入/ IoT/ -/ ClusterDB/ 进行/ 管理/ ,/ 则/ 会/ 导致/ 数据中心/ 数据量/ 的/ 急剧/ 膨胀/ ./ 为此/ ,/ 传感器/ 接入/ 处理器/ 需要/ 通过/ 关键/ 数据/ 的/ 提取/ 操作/ ,/ 从/ 原始数据/ 流中/ 抽取/ 出/ 能够/ 反映/ 监控/ 目标/ 物理/ 状态/ 变化/ 的/ 关键/ 采样/ 数据/ ,/ 仅/ 将/ 关键/ 采样/ 数据/ 上/ 传给/ IoT/ -/ ClusterDB/ 进行/ 处理/ ./ Page6/ 在/ 关键/ 数据/ 的/ 提取/ 方面/ ,/ 一种/ 简单/ 的/ 方法/ 是/ 基于/ 状态/ 变化/ 阈值/ 的/ 关键/ 数据/ 提取/ 方法/ —/ —/ —/ 对于/ 每/ 一种/ 传感器/ 可以/ 定义/ 一个/ 状态/ 变化/ 阈值/ ,/ 如果/ 新/ 的/ 采样/ 数据/ 与/ 上次/ 上传/ 的/ 关键/ 采样/ 数据/ 之间/ 的/ 差值/ 没有/ 超过/ 该/ 阈值/ ,/ 则/ 不/ 需要/ 进行/ 任何/ 处理/ ;/ 仅当/ 它们/ 之间/ 的/ 差值/ 超过/ 规定/ 的/ 阈值/ 时/ ,/ 新/ 的/ 采样/ 数据/ 才/ 成为/ 需要/ 上传/ 的/ 关键/ 采样/ 数据/ ./ 此外/ ,/ 我们/ 还/ 可以/ 采取/ 其它/ 的/ 更加/ 智能化/ 的/ 数据/ 提取/ 方法/ ,/ 在/ 保证/ 关键/ 数据/ 上传/ 的/ 前提/ 下/ ,/ 过滤/ 掉/ 大量/ 的/ 冗余/ 数据/ (/ 注意/ ,/ 如果/ 传感器/ 采用/ 主动/ 上传/ 的/ 方式/ ,/ 则/ 采样/ 数据/ 已经/ 进行/ 了/ 稀疏/ 化/ 处理/ ,/ SCP/ 不/ 需要/ 再/ 进行/ 相应/ 的/ 处理/ )/ ./ (/ 3/ )/ RFID/ 、/ 条形码/ 阅读器/ 采样/ 数据/ 的/ 提取/ ./ 对于/ RFID/ 传感器/ 、/ 条形码/ 阅读器/ 等/ 所/ 采集/ 的/ 数据/ ,/ 传感器/ 接入/ 处理器/ 需要/ 提取/ 出/ 移动/ 监控/ 对象/ 的/ 标识/ ,/ 并/ 连同/ 相关/ 的/ 采样/ 时间/ 与/ 采样/ 地点/ 组成/ 采样/ 记录/ ,/ 然后/ 将/ 该/ 采样/ 记录/ 发送给/ IoT/ -/ ClusterDB/ 进行/ 处理/ ./ IoT/ -/ ClusterDB/ 将/ 同一个/ 移动/ 监控/ 对象/ 的/ 、/ 来自/ 于/ 不同/ RFID/ 传感器/ 或/ 条形码/ 阅读器/ 的/ 采样/ 数据/ 集中/ 起来/ ,/ 可以/ 获得/ 该/ 监控/ 对象/ 的/ 采样/ 数据/ 序列/ ,/ 该/ 数据/ 序列/ 反映/ 了/ 其/ 完整/ 的/ 时空/ 移动/ 过程/ ./ (/ 4/ )/ 原始/ 采样/ 数据/ 的/ 存储/ ./ 对于/ 具有/ 保留/ 价值/ 的/ 原始/ 采样/ 数据/ (/ 如/ 视频/ 监控/ 多媒体/ 数据/ 、/ 油库/ 温度/ 原始/ 采样/ 数据/ 等/ )/ 也/ 由/ 传感器/ 接入/ 处理器/ 进行/ 存储管理/ ./ 在/ IoT/ -/ ClusterDB/ 中/ ,/ 每个/ 监控/ 对象/ 的/ 元组/ 数据/ 中均/ 含有/ 存储/ 该/ 对象/ 的/ 原始/ 采样/ 数据/ 的/ SCP/ 标识/ ,/ 通过/ 这些/ 标识/ ,/ 查询/ 用户/ 可以/ 连接/ 到/ 相应/ 的/ SCP/ ,/ 并/ 通过/ 相应/ 的/ 数据/ 访问/ 接口/ 检索/ 和/ 回放/ 完整/ 的/ 历史/ 与/ 当前/ 原始/ 采样/ 数据/ ./ 3.2/ IoT/ -/ ClusterDB/ 数据库/ 集群/ IoT/ -/ ClusterDB/ 数据库/ 集群/ 是/ 由/ 大量/ 的/ 同构/ 传感器/ 时空/ 数据库/ 结点/ IoT/ -/ NodeDB/ 所/ 组成/ 的/ ,/ 每个/ IoT/ -/ NodeDB/ 可以/ 对/ 各类/ 异构/ 的/ 传感器/ 采样/ 数据/ 进行/ 统一化/ 的/ 管理/ ./ 在/ IoT/ -/ NodeDB/ 中/ ,/ 数据/ 是/ 以/ 监控/ 对象/ 为/ 单位/ 进行/ 管理/ 的/ —/ —/ —/ 每个/ 监控/ 对象/ 对应/ 于/ 一个/ 元组/ ,/ 该/ 监控/ 对象/ 的/ 所有/ 关键/ 采样/ 数据/ 存放/ 在/ 一起/ 构成/ 一个/ 采样/ 数据/ 序列/ ,/ 并/ 作为/ 一个/ 属性/ 值/ 存放/ 在/ 该/ 元组/ 中/ ./ 此外/ ,/ 每个/ 监控/ 对象/ 的/ 元组/ 中/ 还/ 包含/ 存放/ 原始/ 采样/ 数据/ 的/ SCP/ 标识/ ,/ 使得/ 各个/ 传感器/ 接入/ 处理器/ 与/ IoT/ -/ ClusterDB/ 能够/ 分担/ 系统/ 的/ 计算/ 与/ 存储/ 任务/ 并/ 协同工作/ ./ 在/ IoT/ -/ ClusterDB/ 数据库/ 集群/ 中/ ,/ 大量/ 的/ IoT/ -/ NodeDB/ 被/ 组成/ 双层/ 树形/ 结构/ ,/ 其中/ 叶/ 结点/ 存储/ 实际/ 的/ 传感器/ 采样/ 数据/ ,/ 而根/ 结点/ 则/ 存储/ 为了/ 进行/ 全局/ 查询/ 所/ 需要/ 的/ 全局/ 数据/ 字典/ ./ 所有/ 的/ 查询/ 均/ 提交/ 给/ 根/ 结点/ ,/ 根/ 结点/ 通过/ 全局/ 查询处理/ 模块/ ,/ 实现/ 对/ 查询/ 的/ 全局/ 处理/ ./ 在/ IoT/ -/ ClusterDB/ 中/ ,/ 通过/ 建立/ 分布式/ 的/ 全局/ 关键字/ 索引/ 和/ 全局/ 时空/ 索引/ ,/ 整个/ 系统/ 可以/ 同时/ 支持/ 快速/ 的/ 关键字/ 查询/ 、/ 时空/ 查询/ 以及/ 复杂/ 的/ 逻辑/ 条件/ 约束/ 查询/ ./ 4/ 传感器/ 时空/ 数据库/ 模型/ 在/ 本节/ ,/ 我们/ 讨论/ IoT/ -/ ClusterDB/ 中/ 的/ 各/ 传感器/ 时空/ 数据库/ 结点/ (/ IoT/ -/ NodeDB/ )/ 的/ 数据管理/ 方法/ ,/ 并/ 重点/ 讨论/ 如何/ 使用/ 统一/ 的/ 数据库/ 表示/ 方式/ ,/ 对/ 异构/ 的/ 传感器/ 关键/ 采样/ 数据/ 进行/ 存储/ 与/ 查询处理/ ./ 我们/ 假设/ 数据库/ 中/ 已经/ 实现/ 了/ 标准/ 数据类型/ 、/ 空间/ 数据类型/ 以及/ 基于/ 这些/ 类型/ 的/ 相关/ 查询/ 操作/ ,/ 并/ 采用/ 文献/ [/ 27/ -/ 28/ ]/ 中/ 的/ 符号/ 表示/ 方法/ 对/ 数据类型/ 和/ 操作/ 进行/ 相关/ 的/ 表示/ ./ 如前所述/ ,/ 在/ IoT/ -/ ClusterDB/ 中/ 可以/ 接/ 入海量/ 的/ 异构/ 传感器/ 结点/ ./ 每/ 一种/ 类型/ 的/ 传感器/ 所/ 获得/ 的/ 采样/ 数据/ 均/ 可以/ 具有/ 不同/ 的/ 数据格式/ ,/ 但/ 它们/ 的/ 共同/ 特点/ 是/ 均/ 具有/ 时空/ 特性/ :/ 即/ 每个/ 传感器/ 采样/ 数据/ 均/ 对应/ 于/ 一个/ 具体/ 的/ 采样/ 时间/ t/ ∈/ Instant/ 和/ 一个/ 具体/ 的/ 采集/ 地点/ loc/ ∈/ Point/ ∪/ Region/ ./ 在/ 多数/ 情况/ 下/ ,/ 传感器/ 数据/ 的/ 采样/ 地点/ 是/ 一个/ 精确/ 的/ 位置/ (/ 即/ loc/ ∈/ Point/ )/ ,/ 如/ 风力/ 与/ 风向/ 传感器/ 、/ GPS/ 传感器/ 等/ 采集/ 的/ 数据/ ./ 但是/ ,/ 有时候/ 也/ 存在/ 采样/ 位置/ 不/ 精确/ 的/ 情况/ (/ 即/ loc/ ∈/ Region/ )/ ,/ 如/ 在/ 无线/ 传感器/ 网络/ 中/ ,/ 通常/ 在/ 某个/ 区域/ 中/ 可以/ 布设/ 一群/ 传感器/ ,/ 此时/ 所/ 得到/ 的/ 采样/ 数据/ (/ 可以/ 是/ 单个/ 传感器/ 的/ 采样/ 值/ ,/ 或者/ 是/ 群体/ 传感器/ 的/ 汇总/ 数据/ )/ 对应/ 的/ 采样/ 地点/ 即/ 为/ 一个/ 地理/ 区域/ ./ 此外/ ,/ 为了/ 快速/ 地/ 查询/ 和/ 分析/ 各/ 监控/ 对象/ 的/ 历次/ 采样/ 信息/ ,/ 传感器/ 采样/ 数据/ 应该/ 以/ 监控/ 对象/ 为/ 单位/ 进行/ 组织/ ,/ 使得/ 同一个/ 监控/ 对象/ 的/ 所有/ 数据/ 都/ 存放/ 在/ 一起/ ,/ 并/ 随着/ 时间/ 而/ 动态变化/ ./ 因此/ 传感器/ 采样/ 数据/ 表现/ 出/ 序列/ 性/ 和/ 动态变化/ 的/ 流式/ 特性/ ./ 在/ IoT/ -/ NodeDB/ 中/ ,/ 为了/ 对/ 异构/ 的/ 传感器/ 流式/ 时空/ 相关/ 数据/ 进行/ 有效/ 的/ 管理/ ,/ 需要/ 定义/ 相应/ 的/ 数据类型/ 与/ 查询/ 操作/ ,/ 在/ 数据库/ 内核/ 一级/ 实现/ 传感器/ 采样/ 数据/ 的/ 高效/ 存储/ 与/ 查询处理/ ./ 4.1/ 数据类型/ 在/ 本/ 小节/ ,/ 我们/ 首先/ 定义/ 单个/ 传感器/ 采样/ 值/ 的/ 表示/ 方法/ ,/ 在/ 此基础/ 上/ ,/ 给出/ 监控/ 对象/ 的/ 采样/ 数据/ 序列/ 的/ 表示/ 方法/ ./ 通过/ 这些/ 数据类型/ ,/ 数据库/ 内核/ 可以/ 对/ 异构/ 的/ 传感器/ 关键/ 采样/ 数据流/ 进行/ 统一/ 的/ 表示/ 与/ 存储/ 处理/ ./ Page7/ 定义/ 1/ (/ 传感器/ 采样/ 值/ )/ ./ 传感器/ 的/ 单个/ 采样/ 值/ SamplingValue/ 可以/ 表示/ 为/ 如下/ 形式/ :/ SamplingValue/ =/ (/ t/ ,/ loc/ ,/ npos/ ,/ schema/ ,/ value/ )/ ,/ 其中/ :/ t/ ∈/ Instant/ 是/ 该/ 采样/ 数据/ 所/ 对应/ 的/ 采样/ 时间/ ;/ loc/ ∈/ Point/ ∪/ Region/ 是/ 采样/ 地点/ ;/ npos/ ∈/ String/ 是/ 该/ 采样/ 数据/ 所/ 对应/ 的/ 交通网络/ 位置/ (/ 以有/ 向/ 道路/ 的/ ID/ 表示/ ;/ 当/ 采样/ 位置/ 不/ 在/ 交通网络/ 中时/ npos/ 为/ 空值/ )/ ;/ schema/ ∈/ String/ 和/ value/ ∈/ String/ 分别/ 是/ 采样/ 数据/ 的/ “/ 型/ ”/ 和/ “/ 值/ ”/ ,/ 其中/ “/ 型/ ”/ 描述/ 了/ 采样/ 数据/ 的/ 格式/ 及/ 语义/ ,/ “/ 值/ ”/ 是/ 具体/ 的/ 采样/ 数据/ 值/ ./ 由于/ schema/ 和/ value/ 均/ 可能/ 包含/ 多个/ 分量/ ,/ 因此/ 需要/ 用/ 括号/ 对/ 它们/ 的/ 边界/ 进行/ 划分/ ./ 在/ 上述/ 定义/ 中/ ,/ 采样/ 地点/ loc/ 的/ 表示/ 形式/ 取决于/ 监控/ 对象/ 的/ 类型/ ./ 对于/ 移动/ 监控/ 对象/ (/ 通常/ 通过/ GPS/ 、/ RFID/ 或/ 条形码/ 阅读器/ 进行/ 定位/ )/ ,/ 必然/ 有/ loc/ ∈/ Point/ ;/ 而/ 对于/ 静止/ 监控/ 对象/ ,/ 可以/ 包含/ loc/ ∈/ Point/ (/ 如/ 固定/ 布设/ 的/ 交通流/ 传感器/ )/ 和/ loc/ ∈/ Region/ (/ 如/ 无线/ 传感器/ 网络/ 中/ 成片/ 布设/ 的/ 传感器/ )/ 两种/ 情况/ ./ 表/ 1/ 给出/ 了/ 各种/ 不同/ 类型/ 的/ 传感器/ 关键/ 采样/ 数据/ 的/ 例子/ (/ 设/ t1/ ~/ t5/ 是/ 采样/ 时间/ ,/ e201/ ~/ e202/ 是/ 有/ 向/ 道路/ 的/ 标识/ )/ ./ 传感器/ 类型/ 传感器/ 采样/ 值/ (/ SamplingValue/ 数据类型/ )/ 温度传感器/ (/ 部署/ 在/ 某/ 区域/ 的/ WSN/ )/ GPS/ 传感器/ (/ t2/ ,/ (/ 39.3/ ,/ 144.3/ )/ ,/ e201/ ,/ (/ speed/ :/ real/ ,/ 风速/ 风向/ 传感器/ (/ t3/ ,/ (/ 39.3/ ,/ 144.3/ )/ ,/ NULL/ ,/ (/ windspeed/ :/ 交通流/ 视频/ 分析/ 传感器/ 高空/ 遥感/ 识别/ 传感器/ (/ 火灾/ 区域/ 识别/ )/ 传感器/ 的/ 采样/ 值/ 可以/ 由/ 多个/ 分量/ 组成/ ,/ 如表/ 1/ 中/ GPS/ 传感器/ 的/ 采样/ 值/ 具有/ 两个/ 分量/ :/ 速度/ 和/ 方向/ (/ 注意/ :/ GPS/ 所/ 采集/ 的/ 经度/ 、/ 纬度/ 信息/ 是/ 传感器/ 采样/ 值/ 的/ 基本/ 信息/ ,/ 表示/ 在/ loc/ 属性/ 中/ ,/ 所以/ 并/ 不/ 属于/ 采样/ 值/ 的/ 分量/ )/ ./ 为了/ 进一步/ 表示/ 传感器/ 采样/ 值/ 的/ 分量/ ,/ 我们/ 定义/ 如下/ SamplingComponent/ 数据类型/ ./ 定义/ 2/ (/ 采样/ 值/ 的/ 分量/ )/ ./ 传感器/ 采样/ 值/ 的/ 分量/ SamplingComponent/ 可以/ 表示/ 为/ 如下/ 形式/ :/ SamplingComponent/ =/ (/ cSchema/ ,/ cValue/ )/ ,/ 其中/ ,/ cSchema/ ∈/ String/ ,/ cValue/ ∈/ String/ 分别/ 是/ 采样/ 值/ 分量/ 的/ “/ 型/ ”/ 和/ “/ 值/ ”/ ./ 例如/ ,/ 表/ 1/ 中/ GPS/ 传感器/ 采样/ 值/ 的/ 速度/ 与/ 方向/ 分量/ 分别/ 表示/ 为/ (/ speed/ :/ real/ ,/ (/ schema/ ,/ (/ (/ ti/ ,/ loci/ ,/ nposi/ ,/ valuei/ ,/ flagi/ )/ )/ n62/ ./ 5/ )/ 和/ (/ direction/ :/ real/ ,/ 22/ )/ ./ 定义/ 3/ (/ 采样/ 数据/ 序列/ )/ ./ 同一个/ 监控/ 对象/ 的/ 历次/ 采样/ 值/ (/ 可以/ 来自/ 于/ 同一个/ 传感器/ ,/ 也/ 可以/ 来自/ 于/ 多个/ 传感器/ (/ 如/ RFID/ 、/ 条形码/ 阅读器/ 等/ )/ )/ 按照/ 时间/ 序列/ 存放/ 在/ 一起/ ,/ 构成/ 该/ 对象/ 的/ 采样/ 数据/ 序列/ SamplingSequence/ ,/ 表示/ 为/ 如下/ 形式/ :/ SamplingSequence/ =/ 其中/ ,/ schema/ ∈/ String/ 是/ 采样/ 序列/ 中/ 各/ 采样/ 值/ 的/ “/ 型/ ”/ ,/ ti/ ∈/ Instant/ 、/ loci/ ∈/ Point/ ∪/ Region/ 、/ nposi/ ∈/ String/ 和/ valuei/ ∈/ String/ 分别/ 是/ 第/ i/ 个/ 采样/ 值/ 的/ 采样/ 时间/ 、/ 采样/ 地点/ 、/ 采样/ 地点/ 对应/ 的/ 网络/ 位置/ 以及/ 实际/ 的/ 采样/ 数值/ ,/ flagi/ 表示/ 第/ i/ 个/ 采样/ 值/ 是否/ 为/ 该/ 数据/ 序列/ 中/ 的/ 一个/ “/ 间断/ 点/ ”/ ,/ 即/ 一个/ 新/ 片断/ 的/ 起点/ ./ 下面/ 让/ 我们/ 来/ 进一步/ 讨论/ flagi/ ./ 在/ IoT/ -/ Clus/ -/ terDB/ 中/ ,/ 数据/ 是/ 根据/ 地理/ 区域/ 进行/ 分布/ 的/ (/ 详见/ 第/ 5.1/ 节/ )/ ./ 对于/ 移动/ 监控/ 对象/ (/ 如/ GPS/ 传感器/ 、/ RFID/ 、/ 条形码/ 阅读器/ 监控/ 的/ 对象/ )/ 来说/ ,/ 其/ 采样/ 数据/ 序列/ 可以/ 被/ 分割/ 成/ 多个/ 片段/ ,/ 并/ 被/ 存储/ 在/ 不同/ 的/ 数据库/ 结点/ 中/ ./ 如果/ 某个/ 移动/ 监控/ 对象/ mobj/ 多次/ 进入/ 同一个/ 数据库/ 结点/ 所/ 对应/ 的/ 地理/ 区域/ ,/ 则/ 该/ 数据库/ 结点/ 中/ 存放/ 的/ mobj/ 的/ 采样/ 数据/ 序列/ 包含/ 多个/ 片段/ (/ 如图/ 3/ 所示/ )/ ,/ 而/ flagi/ 则/ 用于/ 表示/ 对应/ 的/ 采样/ 值/ 是否/ 为/ 一个/ 新/ 片段/ 的/ 起点/ ./ 对于/ 静止/ 监控/ 对象/ ,/ 由于/ 其/ 历次/ 采样/ 值/ 的/ loc/ 属性/ 保持/ 不变/ ,/ 因此/ SamplingSequence/ 的/ 格式/ 可以/ 简化/ 为/ (/ 注意/ 此时/ 尽管/ 不/ 存在/ 采样/ 数据/ 序列/ 分割/ 的/ 问题/ ,/ 但/ flagi/ 仍然/ 是/ 需要/ 的/ ,/ 用于/ 表示/ 监控/ 过程/ 被/ 暂时/ 挂/ 起/ 的/ 情况/ )/ :/ SamplingSequence/ =/ (/ schema/ ,/ loc/ ,/ npos/ ,/ (/ (/ ti/ ,/ valuei/ ,/ lagi/ )/ )/ n/ 上述/ 两种/ SamplingSequence/ 表示/ 方式/ 在/ 格式/ Page8/ 上/ 稍/ 有/ 区别/ ,/ 由/ 数据库系统/ 自动/ 进行/ 区分/ 和/ 处理/ ./ 在/ 系统/ 实现/ 时/ ,/ SamplingSequence/ 数据类型/ 被/ 设计/ 成/ 一个/ 指向/ 外存/ 文件/ 数据/ 块/ 的/ 指针/ ,/ 真实/ 的/ 采样/ 数据/ 序列/ 被/ 存放/ 在/ 文件/ 块/ 中/ ,/ 而/ 不是/ 直接/ 存放/ 在/ 元组/ 中/ ./ 这样/ 当新/ 的/ 采样/ 数据/ 到来/ 并/ 淘汰/ 旧/ 的/ 采样/ 数据/ 时/ ,/ 只/ 需要/ 直接/ 修改/ 文件/ 数据/ 块/ 即可/ ,/ 而/ 不/ 需要/ 对/ 数据库/ 元组/ 进行/ 修改/ ,/ 从而/ 提高/ 了/ 处理/ 的/ 效率/ ./ 通过/ 上述/ 数据类型/ ,/ 我们/ 可以/ 建立/ 关系/ 表/ 用以/ 表示/ 和/ 存储/ 物/ 联网/ 中/ 各/ 监控/ 对象/ 的/ 采样/ 数据/ 序列/ ,/ 如/ CREATETABLEIoTData/ (/ ObjID/ :/ String/ ,/ 在/ 上述/ 关系/ 表/ 模式/ 中/ ,/ ObjID/ 、/ ObjType/ 、/ Deployed/ -/ By/ 、/ DepoyedTime/ 分别/ 是/ 监控/ 对象/ 的/ 标识/ 、/ 监控/ 对象/ 的/ 具体/ 类型/ (/ 如/ GPS/ 、/ RFID/ 、/ 摄像/ 识别/ 传感器/ 、/ 温度传感器/ 等/ )/ 、/ 部署/ 者/ 、/ 部署/ 时间/ ,/ HostObj/ 是/ 该/ 监控/ 对象/ 的/ 宿主/ 对象/ (/ 如/ 太湖/ 中/ 的/ 传感器/ 的/ 宿主/ 对象/ 为/ 太湖/ )/ ,/ Samplings/ 是/ 该/ 监控/ 对象/ 的/ 采样/ 数据/ 序列/ ./ 此外/ ,/ IoT/ -/ NodeDB/ 中/ 每个/ 监控/ 对象/ 的/ 元组/ 还/ 隐式/ 地/ 包含/ 一个/ SCPSet/ 属性/ 和/ 一个/ StaticMov/ 属性/ ,/ 其中/ SCPSet/ 中/ 存放/ 该/ 监控/ 对象/ 的/ 原始/ 采样/ 数据/ 的/ SCP/ 集合/ ,/ 而/ StaticMov/ 是/ 一个/ Bool/ 型/ 的/ 标记/ ,/ 用于/ 区分/ 静止/ 监控/ 对象/ 和/ 移动/ 监控/ 对象/ ./ 4.2/ 查询/ 操作/ 上述/ 数据类型/ 允许/ 我们/ 在/ 数据库/ 内核/ 中以/ 统一/ 的/ 数据格式/ 表示/ 异构/ 的/ 传感器/ 采样/ 数据流/ ./ 为了/ 对/ 传感器/ 数据/ 进行/ 查询/ ,/ 我们/ 还/ 需要/ 在/ 这些/ 数据类型/ 的/ 基础/ 上/ 定义/ 一系列/ 的/ 查询/ 操作/ ./ 4.2/ ./ 1/ 针对/ SamplingSequence/ 数据类型/ 的/ 操作/ 针对/ SamplingSequence/ 数据类型/ 的/ 最/ 重要/ 的/ 查询/ 操作/ 是/ atInstant/ 操作/ ,/ 该/ 操作/ 用于/ 计算/ 监控/ 对象/ 在/ 某个/ 给定/ 时间/ tq/ 的/ 状态值/ ,/ 其/ 语法/ 格式/ 如下/ (/ 在/ 操作/ 的/ 语法/ 格式/ 定义/ 中/ ,/ 符号/ “/ →/ ”/ 两边/ 分别/ 是/ 该/ 操作/ 的/ 输入/ 数据/ 和/ 输出/ 数据/ 的/ 数据类型/ ;/ 如果/ 操作/ 有/ 多个/ 输入/ 数据/ ,/ 则/ 输入/ 数据类型/ 之间/ 用/ “/ ×/ ”/ 进行/ 连接/ )/ :/ atInstant/ :/ SamplingSequence/ ×/ Instant/ →/ SamplingValue/ ./ 假设/ atInstant/ 操作/ 的/ 两个/ 输入/ 分别/ 是/ sequ/ ∈/ SamplingSequence/ 和/ tq/ ∈/ Instant/ ,/ 其中/ sequ/ =/ (/ schema/ ,/ (/ (/ ti/ ,/ loci/ ,/ nposi/ ,/ valuei/ ,/ flagi/ )/ )/ ntq/ 正好/ 为/ 某个/ 关键/ 采样/ 值/ 所/ 对应/ 的/ 时间/ ,/ 即/ tq/ =/ tj/ (/ j/ ∈/ [/ 1/ ,/ n/ ]/ )/ ,/ 则/ atInstant/ 操作/ 直接/ 将/ 该/ 关键/ 采样/ 值/ (/ tj/ ,/ locj/ ,/ nposj/ ,/ schema/ ,/ valuej/ )/ 作为/ 结果/ 返回/ ,/ 否则/ 表示/ )/ ;/ (/ 1/ )/ 如果/ tq/ </ t1/ ,/ 则/ 直接/ 返回/ “/ 未定义/ ”/ (/ 用/ “/ ⊥/ ”/ (/ 2/ )/ 如果/ tj/ -/ 1/ </ tq/ </ tj/ (/ j/ ∈/ [/ 2/ ,/ n/ ]/ )/ ,/ 则/ 需要/ 进一步/ 检查/ flagj/ :/ 如果/ flagj/ =/ True/ ,/ 则/ 表明/ 第/ j/ 个/ 采样/ 值为/ 间断/ 点/ ,/ 此时/ 返回/ “/ ⊥/ ”/ ;/ 如果/ flagj/ =/ False/ ,/ 则/ 需要/ 通过/ 插值/ 的/ 方法/ 得到/ tq/ 时刻/ 的/ 结果/ ./ 在/ 进行/ 插值/ 计算/ 时/ ,/ 根据/ 采样/ 值/ 的/ npos/ 属性/ 是否/ 为/ 有效/ 的/ 网络/ 位置/ ,/ 可以/ 选用/ 基于/ 交通网络/ 的/ 插值/ 方法/ 或/ 基于/ Euclidean/ 空间/ 的/ 插值/ 方法/ ;/ (/ 3/ )/ 如果/ tq/ >/ tn/ ,/ 则/ 返回/ (/ tn/ ,/ locn/ ,/ nposn/ ,/ schema/ ,/ valuen/ )/ (/ 注意/ ,/ 此时/ 返回值/ 中用/ 的/ 是/ tn/ 而/ 不是/ tq/ ,/ 用以/ 表明/ 采样/ 的/ 实际/ 时间/ )/ ./ 通过/ atInstant/ 操作/ ,/ 数据库/ 可以/ 支持/ 对/ 监控/ 对象/ 在/ 监控/ 时间段/ 内/ 任意/ 时刻/ 的/ 状态/ 查询/ ./ 空间/ 投影/ 操作/ sProjectLines/ 、/ sProjectPoint/ 、/ sProjectNetPos/ 和/ 时间/ 投影/ 操作/ sProjectTime/ 分别/ 将/ 采样/ 数据/ 序列/ 向/ 空间/ 平面/ 和/ 时间轴/ 上/ 投影/ ,/ 它们/ 的/ 语法/ 格式/ 如下/ :/ 进行/ 如下/ 处理/ :/ sProjectLines/ :/ SamplingSequence/ →/ Lines/ (/ 针对/ 移动/ 监控/ 对象/ )/ sProjectPoint/ :/ SamplingSequence/ →/ Point/ (/ 针对/ loc/ ∈/ Point/ 的/ 静止/ 监控/ 对象/ )/ sProjectRegion/ :/ SamplingSequence/ →/ Region/ (/ 针对/ loc/ ∈/ Region/ 的/ 静止/ 监控/ 对象/ )/ sProjectNetPos/ :/ SamplingSequence/ →/ Set/ (/ String/ )/ sProjectTime/ :/ SamplingSequence/ →/ Periods/ 在/ 上述/ 空间/ 投影/ 操作/ 中/ ,/ sProjectPoint/ 、/ sPro/ -/ jectLines/ 和/ sProjectRegion/ 分别/ 针对/ 特定/ 的/ 监控/ 对象/ ,/ 对于/ 其它/ 类型/ 的/ 监控/ 对象/ 则/ 返回/ “/ ⊥/ ”/ ;/ sProject/ -/ NetPos/ 操作/ 返回/ 空间/ 投影/ 值/ 所/ 对应/ 的/ 网络/ 位置/ ./ 空间/ 截取/ 操作/ sTruncateGeo/ 和/ 时间/ 截取/ 操作/ sTruncateTime/ 分别/ 根据/ 给定/ 的/ 空间/ 范围/ 和/ 时间/ 范围/ 截取/ 采样/ 数据/ 序列/ 的/ 一部分/ ,/ 它们/ 的/ 语法/ 格式/ 如下/ :/ sTruncateGeo/ :/ SamplingSequence/ ×/ Region/ →/ SamplingSequence/ ;/ sTruncateTime/ :/ SamplingSequence/ ×/ Periods/ →/ SamplingSequence/ ./ 为了/ 支持/ 新/ 采样/ 值到/ 采样/ 数据/ 序列/ 的/ 插入/ ,/ 我们/ 定义/ samplingAppend/ 操作/ ./ 该/ 操作/ 将/ 一个/ 新/ 的/ 采样/ 值/ (/ 连同/ 表示/ 是否/ 为/ 间断/ 点/ 的/ flag/ 标识/ )/ 附加/ 到/ 采样/ 数据/ 序列/ 的/ 末尾/ ,/ 同时/ 根据/ 系统/ 中/ 预定/ 义/ 的/ 监控/ 时间/ 长度/ (/ 如/ 3/ 个/ 月/ )/ 淘汰/ 采样/ 数据/ 序列/ 中/ 过时/ Page9/ 的/ 采样/ 数据/ ./ 该/ 操作/ 的/ 语法/ 格式/ 如下/ :/ samplingAppend/ :/ SamplingSequence/ ×/ SamplingValue/ ×/ Bool/ →/ SamplingSequence/ ./ 4.2/ ./ 2/ 针对/ SamplingValue/ 数据类型/ 的/ 操作/ 针对/ SamplingValue/ 的/ 操作/ 主要/ 包括/ 对/ 采样/ 值/ 的/ 投影/ 操作/ vProjectTime/ 、/ vProjectPoint/ 、/ vPro/ -/ jectRegion/ 和/ vProjectNetPos/ 以及/ 数据/ 提取/ 操作/ getComponent/ ./ 它们/ 的/ 语法/ 格式/ 如下/ :/ vProjectTime/ :/ SamplingValue/ →/ Instant/ ;/ vProjectPoint/ :/ SamplingValue/ →/ Point/ (/ 针对/ loc/ ∈/ Point/ 的/ 监控/ 对象/ )/ ;/ vProjectRegion/ :/ SamplingValue/ →/ Region/ (/ 针对/ loc/ ∈/ Region/ 的/ 监控/ 对象/ )/ ;/ vProjectNetPos/ :/ SamplingValue/ →/ String/ ;/ getComponent/ :/ SamplingValue/ ×/ integer/ →/ SamplingComponent/ ./ 如果/ 将/ SamplingSequence/ 看成/ 监控/ 对象/ 的/ 状态/ 曲线/ ,/ 则/ 一个/ SamplingValue/ 值/ 实际上/ 对应/ 于/ 监控/ 对象/ 状态/ 曲线/ 中/ 的/ 一个点/ ./ 因此/ ,/ vProjectTime/ 、/ vProjectPoint/ 和/ vProjectNetPos/ 操作/ 的/ 结果/ 分别/ 是/ Instant/ 、/ Point/ // Region/ 和/ String/ 型/ 的/ 值/ ./ 由于/ SamplingValue/ 型/ 的/ 值/ 可以/ 有/ 多个/ 分量/ ,/ getComponent/ 操作/ 根据/ 指定/ 的/ 分量/ 序号/ i/ ,/ 取出/ 采样/ 值/ 的/ 第/ i/ 个/ 分量/ ./ 4.2/ ./ 3/ 其它/ 操作/ 为了/ 实现/ SamplingComponent/ 数据类型/ 与/ 数据库/ 中/ 其它/ 数据类型/ 的/ 交互/ 操作/ ,/ 还/ 需要/ 通过/ “/ lifting/ ”/ [/ 27/ -/ 28/ ]/ 的/ 方式/ ,/ 对/ 数据库/ 中/ 的/ 各种/ 标准/ 查询/ 操作/ (/ 如/ +/ 、/ -/ 、/ ×/ 、/ // 、/ </ 、/ =/ 、/ >/ 等/ )/ 和/ 空间/ 查询/ 操作/ (/ 如/ inside/ ,/ intersect/ ,/ touches/ ,/ distance/ ,/ direction/ ,/ overlap/ 等/ )/ 进行/ 扩充/ ,/ 使得/ SamplingComponent/ 可以/ 作为/ 这些/ 操作/ 的/ 输入/ 数据类型/ 参与/ 这些/ 操作/ 的/ 计算/ ./ 例如/ ,/ “/ =/ ”/ 操作/ 在/ 扩充/ 之后/ 的/ 语法/ 格式/ 为/ (/ 设/ “/ BASE/ ”/ 和/ “/ SPATIAL/ ”/ 分别/ 是/ 标准/ 数据类型/ 的/ 集合/ 和/ 空间/ 数据类型/ 的/ 集合/ )/ :/ 其中/ α/ ,/ β/ ∈/ {/ samplingComponent/ }/ ∪/ BASE/ ∪/ SPATIAL/ ./ 此外/ ,/ 在/ IoT/ -/ NodeDB/ 中/ ,/ 所有/ 的/ 查询/ 均/ 是/ 以/ SQL/ 语句/ 的/ 格式/ 提交/ 的/ ,/ 即便/ 对于/ 关键字/ 查询/ 也/ 套用/ SQL/ 语句/ 的/ 格式/ ./ 为此/ ,/ 我们/ 定义/ 如下/ keySearch/ 操作/ ,/ 以/ 提供/ 关键字/ 查询/ 接口/ :/ 如前所述/ ,/ IoT/ -/ NodeDB/ 中/ 每个/ 监控/ 对象/ 的/ 元组/ 均/ 隐含/ 一个/ SCPSet/ 属性/ ,/ 用以/ 表示/ 存放/ 该/ 监控/ 对象/ 原始/ 采样/ 数据/ 的/ SCP/ 的/ 标识/ ./ 为了/ 获得/ SCPSet/ 属性/ 的/ 值/ ,/ 我们/ 定义/ 操作/ GetRawSites/ ,/ 该/ 操作/ 的/ 输入/ 为/ 监控/ 对象/ 的/ 标识/ ObjID/ ∈/ String/ ,/ 输出/ 为/ SCP/ 的/ 标识/ 集合/ ./ GetRawSites/ 操作/ 的/ 语法/ 格式/ 如下/ :/ 查询/ 用户/ 通过/ GetRawSites/ 操作/ 获得/ 相应/ SCP/ 的/ 标识/ 之后/ ,/ 可以/ 直接/ 与/ 相应/ 的/ SCP/ 进行/ 通信/ ,/ 并/ 通过/ 原始/ 采样/ 数据/ 浏览/ 接口/ 进行/ 相关/ 数据/ 的/ 存取/ 与/ 访问/ ./ 4.2/ ./ 4/ 对/ 传感器/ 采样/ 数据/ 进行/ 查询/ 的/ 例子/ 本/ 节前/ 部分/ 定义/ 的/ 所有/ 数据类型/ 和/ 查询/ 操作/ 均/ 实现/ 为/ 数据库系统/ 的/ 内嵌/ 形式/ ,/ 因此/ 查询语言/ (/ 包括/ 数据/ 定义语言/ DDL/ 和/ 数据/ 操纵/ 语言/ DML/ )/ 是/ 扩充/ 后/ 的/ SQL/ 语言/ 形式/ ./ 下面/ 给出/ 一些/ 查询/ 的/ 例子/ :/ [/ 查询/ Q1/ ]/ 通过/ 关键字/ 查询/ 获得/ 监控/ 对象/ objID1/ 的/ 采样/ 数据/ 序列/ SELECTkeySearch/ (/ objID1/ )/ ./ SamplingsFROMIoTData/ ;/ 在/ 上述/ 查询/ 中/ ,/ keySearch/ 操作/ 返回/ 一组/ 元组/ 的/ 集合/ (/ 由于/ objID1/ 只/ 对应/ 一个/ 元组/ ,/ 因此/ 该/ 集合/ 中/ 只/ 含/ 一个/ 元素/ )/ ,/ 而/ keySearch/ (/ objID1/ )/ ./ Samplings/ 返回/ 这些/ 元组/ 的/ “/ Samplings/ ”/ 属性/ 值/ ./ [/ 查询/ Q2/ ]/ 通过/ 关键字/ 查询/ 获得/ 所有/ 由/ “/ BeijingTraffic/ ”/ 部署/ 的/ 监控/ 对象/ 的/ 采样/ 数据/ 序列/ SELECTkeySearch/ (/ “/ BeijingTraffic/ ”/ )/ ./ SamplingsFROMIoTData/ ;/ [/ 查询/ Q3/ ]/ 通过/ 属性/ 约束条件/ 实现/ 查询/ Q2SELECTSamplingsFROMIoTDataWHEREDeployedBy/ =/ “/ BeijingTraffic/ ”/ ;/ 查询/ Q2/ 和/ Q3/ 的/ 区别/ 在于/ Q2/ 采用/ 关键字/ 查询/ ,/ 因此/ 其/ 执行/ 速度/ 可能/ 会快/ 于/ 采用/ SQL/ 查询/ 的/ Q3/ ./ [/ 查询/ Q4/ ]/ 查询/ 所有/ 位于/ 地理/ 区域/ region1/ 内且/ 在/ t1/ 时刻/ 的/ 风速/ 大于/ 50/ 的/ 风力/ 监控/ 对象/ ,/ 返回/ 除了/ “/ Samplings/ ”/ 属性/ 之外/ 的/ 其它/ 属性/ 值/ SELECTObjID/ ,/ ObjType/ ,/ DeployedBy/ ,/ DepoyedTime/ ,/ HostObjFROMIoTDataWHEREObjType/ =/ “/ Windsensor/ ”/ ANDinside/ (/ sProjectPoint/ (/ Samplings/ )/ ,/ region1/ )/ ANDgetComponent/ (/ atInstant/ (/ Samplings/ ,/ t1/ )/ ,/ 1/ )/ >/ 50/ ;/ [/ 查询/ Q5/ ]/ 查询/ 所有/ t1/ 时刻/ 位于/ 地理/ 区域/ region1/ 内/ 的/ 视频/ 交通流/ 监控/ 移动/ 目标/ (/ 如/ 安装/ 在/ 公交/ 车辆/ 上/ 的/ 摄像头/ )/ Page10SELECT/ / FROMIoTDataWHEREObjType/ =/ “/ BusTrafficVideo/ ”/ ANDinside/ (/ vProjectPoint/ (/ atInstant/ (/ Samplings/ ,/ t1/ )/ )/ ,/ region1/ )/ ./ 5IoT/ -/ ClusterDB/ 数据库/ 集群/ 全局/ 处理/ 物/ 联网/ 系统/ 中/ 海量/ 的/ 传感器/ 对/ 各种/ 物理/ 目标/ 的/ 状态/ 进行/ 着实/ 时/ 的/ 监控/ ./ 为了/ 对/ 海量/ 传感器/ 数据/ 进行/ 快速/ 处理/ ,/ 我们/ 需要/ 大量/ 的/ 数据库/ 结点/ 并/ 将/ 它们/ 组织/ 成/ 一个/ 协同工作/ 的/ 物/ 联网/ 集群/ 存储系统/ ./ 如前所述/ ,/ IoT/ -/ ClusterDB/ 采用/ 一种/ 双层/ 树形/ 结构/ ,/ 其中/ 叶/ 结点/ 存储/ 真正/ 的/ 传感器/ 采样/ 数据/ ,/ 而根/ 结点/ 则/ 存储/ 为了/ 进行/ 全局/ 查询/ 所/ 需要/ 的/ 全局/ 数据/ 字典/ ./ IoT/ -/ ClusterDB/ 的/ 体系结构/ 如图/ 4/ 所示/ ./ 在/ IoT/ -/ ClusterDB/ 中/ ,/ 每个/ 数据库/ 结点/ (/ 包括/ 根/ 结点/ 和/ 各个/ 叶/ 结点/ )/ 均/ 为/ 传感器/ 时空/ 数据库/ ./ 各/ 结点/ 除了/ 具有/ 第/ 4/ 节所/ 描述/ 的/ 数据类型/ 和/ 查询/ 操作/ 之外/ ,/ 还/ 协同/ 建立/ 了/ 分布式/ 的/ 全局/ 索引/ 及/ 全局/ 查询处理/ 模块/ ./ 为了/ 提高/ 系统/ 的/ 可靠性/ ,/ 根/ 结点/ 和/ 每个/ 叶/ 结点/ 都/ 包含/ 两个/ 或/ 多个/ 数据库/ 副本/ ,/ 如果/ 其中/ 一个/ 副本/ 失效/ ,/ 其它/ 的/ 副本/ 可以/ 接管/ 其/ 工作/ ./ 5.1/ 数据分布/ 策略/ 在/ IoT/ -/ ClusterDB/ 中/ ,/ 每个/ 叶/ 结点/ site/ 对应/ 于/ 一个/ 地理/ 区域/ ,/ 称之为/ 该/ 结点/ 的/ “/ 管辖/ 区域/ ”/ ,/ 记/ 为/ α/ (/ site/ )/ ./ 所有/ 叶/ 结点/ 的/ 管辖/ 区域/ 均/ 登记/ 在/ 根/ 结点/ 和/ 采样/ 数据/ 接收/ 服务器/ 中/ 的/ 管辖/ 区域/ 分区表/ (/ ServiceAreaPartitioningTable/ ,/ SAP/ -/ Table/ )/ 中/ ./ 设/ IoT/ -/ ClusterDB/ 系统/ 包含/ n/ 个叶/ 结点/ :/ site1/ ,/ site2/ ,/ …/ ,/ siten/ ,/ 且/ 总/ 的/ 应用/ 地理/ 区域/ 为/ A/ ,/ 则/ 有/ 如下/ 条件/ 成立/ :/ (/ 1/ )/ / i/ ,/ j/ (/ i/ ≠/ j/ )/ :/ α/ (/ sitei/ )/ ∩/ α/ (/ sitej/ )/ =/ / ;/ (/ 2/ )/ ∪/ n/ 在/ IoT/ -/ ClusterDB/ 中/ ,/ 数据/ 是/ 按照/ 地理/ 区域/ 进行/ 分布/ 的/ ./ 各/ 采样/ 值/ 根据/ 其/ 采样/ 地点/ 所属/ 的/ 管辖/ 区域/ 被/ 分布/ 到/ 不同/ 的/ 叶/ 结点/ 进行/ 存储/ ,/ 总/ 的/ 数据分布/ 原则/ 如下/ (/ 设/ 数据库/ 采用/ 第/ 4.1/ 节中/ 所/ 描述/ 的/ 模式/ )/ :/ (/ 1/ )/ 对于/ 任意/ 一个/ 移动/ 监控/ 对象/ mobj/ ,/ 设/ sites/ (/ mobj/ )/ 是/ mobj/ 在/ 监控/ 时间/ 范围/ 内/ 经过/ 了/ 其管辖/ 区域/ 的/ 叶/ 结点/ 的/ 集合/ ,/ 则/ mobj/ 对应/ 于/ 多个/ 元组/ ,/ sites/ (/ mobj/ )/ 中/ 的/ 每个/ 叶/ 结点/ 中/ 存放/ 其中/ 的/ 一个/ 元组/ ,/ 这些/ 元组/ 除了/ “/ Samplings/ ”/ 属性/ 之外/ 的/ 其它/ 属性/ 值/ 是/ 相互/ 复制/ 的/ ,/ 而/ 其/ “/ Samplings/ ”/ 属性/ 值则/ 在/ sites/ (/ mobj/ )/ 中/ 的/ 各叶/ 结点/ 之间/ 进行/ 分割/ :/ 对于/ 任/ 一叶/ 结点/ site/ ∈/ sites/ (/ mobj/ )/ ,/ 它/ 仅/ 存放/ “/ Samplings/ ”/ 与/ α/ (/ site/ )/ 在/ 空间/ 上/ 相交/ 的/ 部分/ ,/ 即/ sTruncateGeo/ (/ Samplings/ ,/ α/ (/ site/ )/ )/ ,/ 如图/ 5/ 所示/ ./ 图/ 5/ “/ Samplings/ ”/ 属性/ 值/ 在/ 各叶/ 结点/ 之间/ 的/ 分割/ (/ 2/ )/ 对于/ 静止/ 监控/ 对象/ sobj/ ,/ 如果/ 其/ 采样/ 地点/ loc/ ∈/ Point/ 且/ loc/ ∈/ α/ (/ sitei/ )/ ,/ 则/ sobj/ 仅/ 对应/ 于/ 一个/ 元组/ ,/ 该/ 元组/ 存放/ 在/ 叶/ 结点/ sitei/ 中/ ;/ (/ 3/ )/ 对于/ 静止/ 监控/ 对象/ sobj/ ,/ 如果/ 其/ 采样/ 地点/ loc/ ∈/ Region/ 且/ sites/ (/ sobj/ )/ 是/ 管辖/ 区域/ 与/ loc/ 相交/ 的/ 叶/ 结点/ 集合/ ,/ 则/ sites/ (/ sobj/ )/ 中/ 的/ 每个/ 叶/ 结点/ 存放/ sobj/ 的/ 一个/ 元组/ ,/ 这些/ 元组/ 是/ 彼此/ 复制/ 关系/ ,/ 且/ 每个/ 元组/ 的/ “/ Samplings/ ”/ 属性/ 均/ 包含/ 完整/ 的/ 采样/ 数据/ 序列/ ./ 在/ IoT/ -/ ClusterDB/ 中/ ,/ 所有/ 新/ 的/ 采样/ 值均/ 被/ 发送给/ 采样/ 数据/ 接收/ 服务器/ (/ 见图/ 4/ )/ ,/ 采样/ 数据/ 接收/ 服务器/ 根据/ SAP/ -/ Table/ 将/ 采样/ 数据/ 值/ 发送给/ 不同/ 的/ 叶/ 结点/ 进行/ 存储/ ./ 如果/ 新/ 的/ 采样/ 值/ 属于/ 移动/ 监控/ 对象/ 且/ 与/ 上次/ 采样/ 值/ 相比/ 跨越/ 了/ 不同/ 叶/ 结点/ 的/ 管辖/ 区域/ ,/ 则/ 采样/ 数据/ 接收/ 服务器/ 需要/ 通过/ 插值/ 计算/ 得到/ 边界/ 处/ 的/ 采样/ 值/ ,/ 并/ 将/ 插值/ 点/ 也/ 发送给/ 相应/ 的/ 叶/ 结点/ 进行/ 存储/ (/ 详见/ 第/ 5.3/ 节/ )/ ./ 5.2/ 全局/ 索引/ 及/ 全局/ 查询处理/ 为了/ 支持/ 全局/ 查询处理/ ,/ 在/ IoT/ -/ ClusterDB/ 中/ 需要/ 建立/ 分布式/ 的/ 全局/ 关键字/ 索引/ 和/ 全局/ 时空/ 索引/ ./ Page115/ ./ 2.1/ 分布式/ 全局/ 关键字/ 索引/ 及/ 全局/ 关键字/ 查询/ 为了/ 在/ IoT/ -/ ClusterDB/ 中/ 支持/ 关键字/ 查询/ ,/ 需要/ 建立/ 一个/ 全局/ 关键字/ B/ +/ 树/ 索引/ (/ GlobalFull/ -/ TextKeywordB/ +/ -/ Tree/ ,/ GFTKB/ +/ -/ Tree/ )/ ,/ 图/ 6/ 给出/ 了/ GFTKB/ +/ -/ Tree/ 的/ 结构/ ./ 如图/ 6/ 所示/ ,/ GFTKB/ +/ -/ Tree/ 是/ 一个/ 分布式/ 的/ 索引/ ,/ 采用/ 3/ 层/ 结构/ ,/ 其中/ :/ 第/ 1/ 层/ 是/ 存放/ 在/ IoT/ -/ ClusterDB/ 根/ 结点/ 中/ 的/ 全局/ 关键字/ 分区表/ (/ GlobalKeywordRangeTable/ ,/ GKR/ -/ Table/ )/ ./ GKR/ -/ Table/ 的/ 记录/ 格式/ 为/ (/ keyR/ -/ ange/ ,/ siteID/ )/ ,/ 其中/ keyRange/ 是/ 关键字/ 值域/ 中/ 的/ 一个/ 区域/ 范围/ ,/ siteID/ 是/ 与/ 该/ 范围/ 相对/ 应/ 的/ 叶/ 结点/ 的/ 标识/ ,/ 该叶/ 结点/ 中/ 的/ KSMB/ +/ -/ Tree/ 索引/ 该/ 范围/ 内/ 的/ 关键字/ ./ 第/ 2/ 层/ 是/ 一组/ 存放/ 在/ IoT/ -/ ClusterDB/ 各叶/ 结点/ 中/ 的/ keyword/ 到/ SiteID/ 的/ 映射/ B/ +/ 树/ (/ keyword/ -/ to/ -/ SiteIDMappingB/ +/ -/ Tree/ ,/ KSMB/ +/ -/ Tree/ )/ ./ KSMB/ +/ -/ Tree/ 的/ 叶/ 结点/ 记录/ 格式/ 为/ (/ keyword/ ,/ set/ (/ siteID/ )/ )/ ,/ 其中/ keyword/ 是/ 关键字/ ,/ set/ (/ siteID/ )/ 是/ 所有/ 包含/ 该/ 关键字/ 的/ 叶/ 结点/ 的/ 标识/ 的/ 集合/ ./ 在/ 创建/ KSMB/ +/ -/ Tree/ 时/ ,/ 每个/ 叶/ 结点/ 从/ 自己/ 的/ 本地/ 元组/ 中/ 提取/ 关键字/ ,/ 并/ 对/ 每个/ 关键字/ 生成/ 一个/ (/ keyword/ ,/ siteID/ )/ 偶对/ (/ 其中/ siteID/ 即/ 为/ 该/ 叶/ 结点/ 自己/ 的/ 标识/ )/ ;/ 随后/ ,/ 该叶/ 结点/ 根据/ GKR/ -/ Table/ 将/ 各个/ 偶对/ 发送给/ 相应/ 的/ 叶/ 结点/ ,/ 这样/ 每个/ 叶/ 结点/ 可以/ 收到/ 一组/ 来自/ 于/ 整个/ 系统/ 中/ 其它/ 各个/ 叶/ 结点/ 的/ (/ keyword/ ,/ siteID/ )/ 集合/ ,/ 并/ 在/ 此基础/ 上/ 构建/ KSMB/ +/ -/ Tree/ ./ 第/ 3/ 层/ 是/ 一组/ 存放/ 在/ IoT/ -/ ClusterDB/ 叶/ 结点/ 中/ 的/ 本地/ 全文/ 关键字/ B/ +/ 树/ 索引/ (/ LocalFull/ -/ TextKeywordB/ +/ -/ TreeIndex/ ,/ LFTKB/ +/ -/ Tree/ )/ ./ LFTKB/ +/ -/ Tree/ 是/ IoT/ -/ NodeDB/ 针对/ 本地/ 数据/ 建立/ 的/ 全文/ 关键字/ 索引/ ,/ 其叶/ 结点/ 的/ 记录/ 格式/ 为/ (/ keyword/ ,/ set/ (/ tupID/ )/ )/ ,/ 其中/ keyword/ 是/ 一个/ 关键字/ ,/ set/ (/ tupID/ )/ 是/ 所有/ 包含/ 该/ 关键字/ 的/ 所有/ 元组/ 的/ 标识/ 集合/ ./ 让/ 我们/ 结合/ 第/ 4.2/ ./ 4/ 小节/ 中/ 的/ 查询/ Q1/ 和/ Q2/ 来/ 讨论/ 对/ 全局/ 关键字/ 查询/ 的/ 处理/ ./ 在/ IoT/ -/ ClusterDB/ 中/ ,/ 所有/ 的/ 查询/ 均/ 发送给/ 根/ 结点/ 进行/ 处理/ ./ 当根/ 结点/ 接收/ 到/ 一个/ 关键字/ 查询/ 时/ ,/ 将/ 首先/ 查询/ GKR/ -/ Table/ ,/ 从而/ 判断/ 应该/ 进一步/ 查询/ 哪个/ 叶/ 结点/ 的/ KSMB/ +/ -/ Tree/ ;/ 然后/ ,/ 根据/ 对应/ 叶/ 结点/ 的/ KSMB/ +/ -/ Tree/ ,/ 可以/ 得到/ 一组/ 叶/ 结点/ 的/ siteID/ ,/ 这些/ 叶/ 结点/ 均/ 包含/ 被/ 查询/ 的/ 关键字/ ;/ 最后/ ,/ 根/ 结点/ 将/ 查询/ 广播/ 给/ 这些/ 叶/ 结点/ 并行执行/ ,/ 执行/ 结果/ 由根/ 结点/ 汇总/ 并/ 返回/ 给/ 查询/ 用户/ ./ 各叶/ 结点/ 在/ 执行/ 来自/ 于根/ 结点/ 的/ 关键字/ 查询/ 时/ ,/ 将/ 调用/ 本地/ 的/ LFTKB/ +/ -/ Tree/ 快速/ 地/ 得到/ 查询/ 结果/ ./ 算法/ 1/ 给出/ 了/ 全局/ 关键字/ 查询/ 的/ 处理过程/ ./ 算法/ 1/ ./ 全局/ 关键字/ 查询处理/ 算法/ ./ 输入/ :/ 全局/ 关键字/ 索引/ GFTKB/ +/ -/ Tree/ 输出/ :/ 查询/ 结果/ R1/ ./ key/ =/ getkey/ (/ Q/ )/ ;/ 2/ ./ ksmb/ _/ site/ =/ retrieve/ (/ key/ ,/ GFTKB/ +/ -/ Tree/ ./ GKR/ -/ Table/ )/ ;/ 3/ ./ ksmb/ _/ tree/ =/ get/ _/ tree/ (/ ksmb/ _/ site/ ,/ KSMB/ +/ -/ Tree/ )/ ;/ 4/ ./ lftkb/ _/ sites/ =/ retrieve/ (/ key/ ,/ ksmb/ _/ tree/ )/ ;/ 5/ ./ FOREACHsite/ ∈/ lftkb/ _/ sitesDO/ (/ INPARALLEL/ )/ 6/ ./ lftkb/ _/ tree/ =/ get/ _/ tree/ (/ site/ ,/ LFTKB/ +/ -/ Tree/ )/ ;/ 7/ ./ tupleids/ =/ retrive/ (/ key/ ,/ lftkb/ _/ tree/ )/ ;/ 8/ ./ res/ =/ evaluate/ (/ Q/ ,/ tupleids/ )/ ;/ 9/ ./ sendMaster/ (/ res/ )/ ;/ 10/ ./ ENDFOR/ ;/ 11/ ./ 根/ 结点/ 收集/ 各叶/ 结点/ 发来/ 的/ 查询/ 结果/ 并/ 存入/ R/ ;/ 12/ ./ Return/ (/ R/ )/ ./ 在/ 算法/ 1/ 中/ ,/ getkey/ (/ Q/ )/ 函数/ 返回/ 查询/ Q/ 要/ 检索/ 的/ 关键字/ ;/ retrieve/ (/ (/ key/ ,/ ds/ )/ 函数/ 根据/ 关键字/ key/ 在/ 数据结构/ ds/ 中/ 进行/ 检索/ ,/ 并/ 返回/ 相应/ 的/ 结果/ ;/ get/ _/ tree/ (/ site/ ,/ treeName/ )/ 函数/ 返回/ 指定/ 叶/ 结点/ site/ 中/ 的/ treeName/ 索引/ 子树/ ,/ evaluate/ (/ Q/ ,/ tupleids/ )/ 函数/ 在/ tupleids/ 元组/ 集合/ 的/ 基础/ 上/ 执行/ 查询/ 并/ 返回/ 结果/ ,/ sendMaster/ (/ res/ )/ 将/ 结果/ res/ 发送给/ 根/ 结点/ ./ 5.2/ ./ 2/ 分布式/ 全局/ 时空/ 索引/ 及/ 全局/ 时空/ 查询处理/ 除了/ 关键字/ 查询/ 之外/ ,/ 物/ 联网/ 系统/ 中/ 的/ 另一类/ 重要/ 的/ 查询/ 类型/ 是/ 带有/ 时空/ 约束条件/ 的/ 查询/ ,/ 如/ 第/ 4.2/ ./ 4/ 小节/ 中/ 的/ 查询/ Q4/ 和/ Q5/ ./ 为了/ 支持/ 这/ 类/ 查询/ ,/ 我们/ 需要/ 建立/ 全局/ 时空/ R/ 树/ 索引/ (/ GlobalSpatial/ -/ TemporalR/ -/ Tree/ ,/ GSTR/ -/ Tree/ )/ ./ 由于/ 在/ IoT/ -/ ClusterDB/ 中/ 数据/ 是/ 根据/ 其/ 空间/ 属性/ 进行/ 分布/ 的/ ,/ 因此/ GSTR/ -/ Tree/ 的/ 构建/ 可以/ 得到/ 简化/ ,/ 图/ 7/ 给出/ 了/ 其/ 总体/ 结构/ ./ Page12/ 如图/ 7/ 所示/ ,/ GSTR/ -/ Tree/ 是/ 一个/ 两层/ 的/ 分布式/ 全局/ 索引/ ,/ 其中/ :/ 第/ 1/ 层/ 是/ IoT/ -/ ClusterDB/ 根/ 结点/ 中/ 的/ 管辖/ 区域/ 分区表/ (/ SAP/ -/ Table/ )/ ./ SAP/ -/ Table/ 中/ 的/ 记录/ 的/ 格式/ 为/ (/ area/ ,/ siteID/ )/ ,/ 其中/ area/ 为/ 一个/ 管辖/ 区域/ ,/ siteID/ 是/ 与/ 该/ 管辖/ 区域/ 对应/ 的/ 叶/ 数据库/ 结点/ 的/ 标识/ ;/ 第/ 2/ 层/ 是/ IoT/ -/ ClusterDB/ 各叶/ 结点/ 中/ 的/ 针对/ 本地/ 数据/ 的/ 传感器/ 采样/ 数据/ 序列/ 时空/ 索引/ 树/ (/ Sensor/ -/ Sampling/ -/ SequenceSpatial/ -/ TemporalTree/ ,/ S4T/ -/ Tree/ )/ ,/ 用以/ 对/ 本地/ 数据/ 中/ 采样/ 数据/ 序列/ 的/ 时空/ 属性/ 进行/ 索引/ ./ S4T/ -/ Tree/ 实际上/ 包括/ 两个/ 子树/ :/ 一个/ 空间/ R/ 树/ (/ SpatialR/ -/ Tree/ ,/ SR/ -/ Tree/ )/ 用以/ 对/ 静止/ 监控/ 对象/ 的/ 空间/ 位置/ (/ 包括/ loc/ ∈/ Point/ 和/ loc/ ∈/ Region/ 两种/ 情况/ )/ 进行/ 索引/ ,/ 一个/ 格栅/ 概略/ 化/ 时空/ R/ 树/ (/ Grid/ -/ SketchedSpatial/ -/ TemporalR/ -/ Tree/ ,/ GSSTR/ -/ Tree/ )/ 用于/ 对/ 移动/ 监控/ 对象/ 的/ 随/ 时间/ 动态变化/ 的/ 位置/ (/ 亦/ 称为/ “/ 时空/ 轨迹/ -/ trajectory/ ”/ )/ 进行/ 索引/ ./ 图/ 8/ 给出/ 了/ GSSTR/ -/ Tree/ 的/ 结构/ ./ 从图/ 8/ 可以/ 看出/ ,/ 移动/ 监控/ 对象/ 时空/ 轨迹/ 的/ 变化/ 十分/ 频繁/ ,/ 因为/ 每/ 一次/ 新/ 采样/ 值/ 的/ 到来/ 均会/ 导致/ 向/ 轨迹/ 中/ 插入/ 新/ 的/ 轨迹/ 单元/ (/ 轨迹/ 单元/ 是/ 轨迹/ 时空/ 曲线/ 中/ 相邻/ 两个/ 采样/ 点/ 构成/ 的/ 一条/ 直线/ 段/ )/ ./ 如果/ 直接/ 以/ 轨迹/ 单元/ 作为/ 索引/ 记录/ 的/ 基本/ 单位/ ,/ 则/ 索引/ 的/ 更新/ 频率/ 将/ 等同于/ 采样/ 数据/ 插入/ 数据库/ 的/ 频率/ ,/ 从而/ 导致/ 索引/ 更新/ 代价/ 升高/ ./ 为了/ 解决/ 上述/ 问题/ ,/ 我们/ 首先/ 将/ X/ ×/ Y/ ×/ T/ 空间/ 划分/ 成/ 粒度/ 较/ 粗/ 的/ 等距/ 格栅/ ./ 然后/ ,/ 将/ 每个/ 移动/ 监控/ 对象/ 的/ 轨迹/ 映射/ 成/ 对应/ 的/ “/ 概略/ 化/ ”/ 轨迹/ ,/ 概略/ 化/ 轨迹/ 单元/ 是/ 原始/ 轨迹/ 所/ 穿过/ 的/ 格栅/ 单元/ 的/ 中心点/ 连线/ ,/ 因此/ 其/ 粒度/ 比/ 原始/ 轨迹/ 要/ 大得多/ ./ 最后/ 对/ 概略/ 化/ 轨迹/ 单元/ 进行/ 索引/ 并/ 建立/ GSSTR/ -/ Tree/ ./ GSSTR/ -/ Tree/ 的/ 叶/ 结点/ 记录/ 的/ 格式/ 为/ (/ stu/ ,/ set/ (/ tupleID/ )/ )/ ,/ 其中/ stu/ 是/ 概略/ 化/ 轨迹/ 单元/ ,/ set/ (/ tupleID/ )/ 是/ 其/ 概略/ 化/ 轨迹/ 包含/ stu/ 的/ 所有/ 移动/ 监控/ 对象/ 元组/ 标识/ 的/ 集合/ (/ 注意/ ,/ 多个/ 移动/ 监控/ 对象/ 的/ 概略/ 化/ 轨迹/ 可以/ 共享/ 同一个/ 轨迹/ 单元/ )/ ./ 概略/ 化/ 轨迹/ 的/ 变化/ 频率/ 比/ 原始/ 轨迹/ 低得/ 多/ ,/ 因此/ GSSTR/ -/ Tree/ 有效/ 地/ 降低/ 了/ 索引/ 更新/ 的/ 频率/ ./ 在/ 进行/ 时空/ 查询处理/ 时/ ,/ 根/ 结点/ 首先/ 检查/ SAP/ -/ Table/ ,/ 看看/ 哪些/ 叶/ 结点/ 的/ 管辖/ 区域/ 与/ 查询/ 地理/ 区域/ 相交/ ,/ 然后/ 将/ 查询/ 发送给/ 这些/ 叶/ 结点/ 并行执行/ ;/ 叶/ 结点/ 在/ 处理/ 来自/ 于根/ 结点/ 的/ 查询/ 请求/ 时/ ,/ 可以/ 通过/ 本地/ 的/ S4T/ -/ Tree/ 快速/ 地/ 得到/ 查询/ 结果/ :/ 如果/ 查询/ 是/ 针对/ 静态/ 监控/ 对象/ 的/ (/ 如/ Q4/ )/ ,/ 则/ 仅/ 需/ 查询/ S4T/ -/ Tree/ 的/ 空间/ R/ 树/ 部分/ ;/ 如果/ 查询/ 针对/ 移动/ 监控/ 对象/ (/ 如/ Q5/ )/ ,/ 则/ 需要/ 根据/ 时空/ 约束条件/ 对/ S4T/ -/ Tree/ 的/ GSSTR/ -/ Tree/ 部分/ 进行/ 搜索/ ;/ 根/ 结点/ 收到/ 各叶/ 结点/ 返回/ 的/ 结果/ 之后/ ,/ 还/ 需要/ 进行/ 必要/ 的/ 合并/ 操作/ ,/ 并/ 将/ 最后/ 的/ 结果/ 返回/ 给/ 查询/ 用户/ ./ 全局/ 时空/ 查询处理/ 算法/ 如/ 算法/ 2/ 所示/ ./ 算法/ 2/ ./ 全局/ 时空/ 查询处理/ 算法/ ./ 输入/ :/ 全局/ 时空/ 索引/ GSSTR/ -/ Tree/ 输出/ :/ 查询/ 结果/ R1/ ./ georange/ =/ getgeo/ (/ Q/ )/ ;/ 2/ ./ timerange/ =/ getperiod/ (/ Q/ )/ ;/ 3/ ./ sites/ =/ retrievegeo/ (/ georange/ ,/ GSSTR/ -/ Tree/ ./ SAP/ -/ Table/ )/ ;/ 4/ ./ FOREACHsite/ ∈/ sitesDO/ (/ INPARALLEL/ )/ 5/ ./ StaticMov/ =/ getobjtype/ (/ Q/ )/ ;/ 6/ ./ IFStaticMov/ =/ Static/ // // staticobjects7/ ./ sr/ _/ tree/ =/ get/ _/ tree/ (/ site/ ,/ SR/ -/ Tree/ )/ ;/ 8/ ./ tupleids/ =/ retrivegeo/ (/ georange/ ,/ sr/ _/ tree/ )/ ;/ 9/ ./ ELSE10/ ./ gsstr/ _/ tree/ =/ get/ _/ tree/ (/ site/ ,/ GSSTR/ -/ Tree/ )/ ;/ Page1311/ ./ tupleids/ =/ retrivegeotempo/ (/ georange/ ,/ 12/ ./ ENDIF/ ;/ 13/ ./ res/ =/ evaluate/ (/ Q/ ,/ tupleids/ )/ ;/ 14/ ./ sendMaster/ (/ res/ )/ ;/ 15/ ./ ENDFOR/ ;/ 16/ ./ 根/ 节点/ 收集/ 各叶/ 结点/ 发来/ 的/ 查询/ 结果/ 并/ 存入/ R/ ;/ 17/ ./ 根/ 节点/ 对/ R/ 中/ 的/ 结果/ 按照/ ObjID/ 进行/ 合并/ ;/ 18/ ./ Return/ (/ R/ )/ ./ 在/ 算法/ 2/ 中/ ,/ 函数/ getgeo/ (/ Q/ )/ 和/ getperiod/ (/ Q/ )/ 分别/ 返回/ Q/ 的/ 查询/ 地理/ 区域/ 和/ 时间/ 区域/ ;/ getobjtype/ (/ Q/ )/ 返回/ Q/ 所/ 查询/ 的/ 监控/ 对象/ 类型/ ,/ retrievegeo/ (/ georange/ ,/ ds/ )/ 和/ retrievegeotempo/ (/ georange/ ,/ timerange/ ,/ ds/ )/ 分别/ 根据/ 地理/ 区域/ georange/ 和/ 时空/ 区域/ 在/ 相关/ 数据结构/ ds/ 中/ 查询/ ,/ 得到/ 的/ 结果/ 为/ 一组/ 指针/ ./ 5.2/ ./ 3/ 其它/ 查询/ 类型/ 的/ 处理/ 对于/ 属性/ 约束条件/ 查询/ (/ 如/ 查询/ Q3/ )/ ,/ 尽管/ 不是/ 关键字/ 查询/ ,/ 但是/ IoT/ -/ ClusterDB/ 仍然/ 可以/ 通过/ GFTKB/ +/ -/ Tree/ 中/ 的/ GKR/ -/ Table/ 和/ KSMB/ +/ -/ Tree/ 来/ 缩小/ 需要/ 查询/ 的/ 叶/ 结点/ 范围/ ,/ 然后/ 再/ 在/ 各/ 相关/ 叶/ 结点/ 上/ 执行/ 对应/ 的/ SQL/ 语句/ ./ 在/ 执行/ SQL/ 语句/ 时/ ,/ 叶/ 结点/ 不能/ 调用/ 本地/ 的/ LFTKB/ +/ -/ Tree/ ,/ 但/ 通过/ 属性/ B/ +/ 树/ 仍然/ 可以/ 获得/ 较/ 快/ 的/ 查询/ 速度/ ./ 对于/ 更加/ 复杂/ 的/ 查询/ (/ 如/ 多个/ 约束条件/ 通过/ AND/ 或者/ OR/ 连接/ )/ ,/ IoT/ -/ ClusterDB/ 可以/ 通过/ 相应/ 的/ 全局/ 索引/ ,/ 针对/ 每个/ 约束条件/ 获得/ 一个/ 叶/ 结点/ 集合/ ,/ 然后/ 根据/ 连接/ 条件/ 对/ 这些/ 集合/ 进行/ 相应/ 的/ 交集/ 或/ 并/ 集/ 计算/ ,/ 最终/ 获得/ 真正/ 需要/ 执行/ 查询/ 的/ 叶/ 结点/ 范围/ ,/ 并/ 在/ 这些/ 叶/ 结点/ 上/ 执行/ 查询/ 从而/ 得到/ 最后/ 的/ 查询/ 结果/ ./ 5.3/ 新/ 采样/ 数据/ 触发/ 的/ 数据/ 更新/ 处理/ 在/ IoT/ -/ ClusterDB/ 中/ 包含/ 多个/ 采样/ 数据/ 接收/ 服务器/ ,/ 这些/ 服务器/ 组成/ 一个/ 集群/ ,/ 共同/ 对/ 传感器/ 接入/ 处理器/ 上传/ 的/ 新/ 采样/ 值/ 进行/ 处理/ ./ 新/ 采样/ 值/ 的/ 数据格式/ 为/ (/ objID/ ,/ staticMov/ ,/ svalue/ )/ ,/ 其中/ objID/ 是/ 监控/ 对象/ 的/ 标识/ ,/ staticMov/ 标明/ 监控/ 对象/ 是/ 静止/ 的/ 还是/ 移动/ 的/ ,/ svalue/ =/ (/ t/ ,/ loc/ ,/ npos/ ,/ schema/ ,/ value/ )/ 是/ 一个/ samplingValue/ 类型/ 的/ 值/ ./ 采样/ 数据/ 接收/ 服务器/ 接收/ 到/ 上述/ 数据/ 之后/ ,/ 首先/ 判断/ staticMov/ ,/ 如果/ 是/ 静止/ 监控/ 对象/ ,/ 则/ 可/ 通过/ SAP/ -/ Table/ 找到/ 管辖/ 区域/ 与/ loc/ 相交/ 的/ 叶/ 结点/ (/ loc/ ∈/ Region/ 时/ 可以/ 有/ 多个/ 叶/ 结点/ 与/ loc/ 相交/ )/ ,/ 然后/ 将/ 采样/ 数据/ 转发给/ 相应/ 的/ 叶/ 结点/ 进行/ 存储/ 处理/ ;/ 如果/ 是/ 移动/ 监控/ 对象/ ,/ 则/ 需要/ 进一步/ 判断/ 上次/ 提交/ 了/ 采样/ 值/ 之后/ 该/ 监控/ 对象/ 是否/ 跨越/ 了/ 叶/ 结点/ 的/ 管辖/ 区域/ 边界/ ,/ 若/ 是/ ,/ 则/ 需要/ 进行/ 相应/ 的/ 插值/ 计算/ ,/ 并/ 将/ 插值/ 结果/ 也/ 发送给/ 相应/ 的/ 叶/ 结点/ ./ 为此/ ,/ 采样/ 数据/ 接收/ 服务器/ 需要/ 保存/ 各/ 移动/ 监控/ 对象/ 上/ 一次/ 提交/ 的/ 采样/ 数据/ 值/ ./ 叶/ 结点/ 接收/ 到/ 新/ 的/ 采样/ 数据/ 之后/ ,/ 直接/ 通过/ samplingAppend/ 操作/ 将/ 之/ 附加/ 到/ 相应/ 监控/ 对象/ 的/ “/ Samplings/ ”/ 属性/ 值中/ ./ 6/ 系统/ 实现/ 及/ 性能/ 分析/ 本文/ 提出/ 的/ IoT/ -/ ClusterDB/ 系统/ 框架/ 已经/ 在/ PostgreSQL8/ ./ 2.4/ (/ 带有/ 空间数据/ 扩展/ 模块/ Post/ -/ GIS1/ ./ 3.1/ )/ 的/ 基础/ 上/ 进行/ 了/ 编码/ 实现/ ./ PostgreSQL/ 是/ 一个/ 开源/ 的/ 对象/ 关系/ 型/ 数据库系统/ ,/ 支持/ 数据库/ 内核/ 一级/ 的/ 数据类型/ 、/ 查询/ 操作/ 以及/ 索引/ 的/ 扩充/ ./ 此外/ ,/ 我们/ 还/ 在/ PostgreSQL/ 的/ 基础/ 上/ 实现/ 了/ 相应/ 的/ 全局/ 索引/ 机制/ ,/ 并/ 在/ 此基础/ 上/ 实现/ 了/ 一个/ 全局/ 查询/ 处理器/ ,/ 使得/ 多个/ PostgreSQL/ 服务器/ 可以/ 组合/ 在/ 一起/ ,/ 形成/ 一个/ 协同工作/ 的/ IoT/ -/ ClusterDB/ 集群/ 系统/ ./ 为了/ 对/ IoT/ -/ ClusterDB/ 的/ 性能/ 进行/ 比较/ 与/ 分析/ ,/ 我们/ 在/ 上述/ 原型/ 系统/ 的/ 基础/ 上/ 进行/ 了/ 实验/ ./ 实验/ 中/ 的/ 传感器/ 数据/ 采用/ 第/ 3.1/ 节中/ 描述/ 的/ 数据库/ 模式/ 进行/ 组织/ ,/ 数据/ 包括/ 两个/ 部分/ :/ (/ 1/ )/ 移动/ 传感器/ 数据/ 是/ 在/ 北京/ 1/ 万个/ 出租车/ 所/ 采集/ 的/ 真实/ GPS/ 数据/ 的/ 基础/ 上/ ,/ 通过/ 一个/ 数据/ 模拟程序/ 生成/ 的/ ,/ 该/ 模拟程序/ 通过/ 对/ 原始/ GPS/ 采样/ 数据/ 的/ 插值/ 和/ 倍增/ ,/ 可以/ 动态/ 模拟/ 12800/ ~/ 32000/ 个/ 移动/ 传感器/ 的/ 数据/ 采样/ ;/ (/ 2/ )/ 静止/ 传感器/ 数据/ 是/ 通过/ 一个/ 模拟程序/ 随机/ 生成/ 的/ ,/ 该/ 模拟程序/ 可以/ 模拟出/ 128000/ ~/ 320000/ 个/ 静止/ 传感器/ 的/ 动态数据/ 采样/ ./ 将/ 上述/ 两/ 部分/ 数据/ 按照/ 一定/ 的/ 比例/ (/ 如/ 移动/ 传感器/ 与/ 静止/ 传感器/ 的/ 比例/ 为/ 110/ )/ 进行/ 合成/ ,/ 从而/ 可以/ 得到/ 实验/ 中/ 所/ 需要/ 的/ 总体/ 数据/ 集/ ./ 表/ 2/ 列出/ 了/ 实验/ 中/ 的/ 主要参数/ ./ 参数/ 名/ 参数值/ (/ 单位/ )/ NMovSensors12800/ ~/ 32000/ 移动/ 传感器/ 的/ 数目/ NStaticSensors128000/ ~/ 320000/ 静止/ 传感器/ 的/ 数目/ NSensors140800/ ~/ 352000/ 传感器/ 的/ 总/ 数目/ (/ 其中/ 移动/ 传感/ ξ/ Sampling/ ξ/ KeySampling300sSCP/ 结点/ 抽取/ 的/ 关键/ 采样/ 数据/ NMasterNodes1/ 根/ 结点/ 服务器/ 的/ 数目/ NLeafNodes2/ ~/ 32/ 叶/ 结点/ 服务器/ 的/ 数目/ Page14/ 在/ 实验/ 中/ ,/ 我们/ 重点/ 针对/ IoT/ -/ ClusterDB/ 的/ 查询/ 响应/ 时间/ 及/ 加速/ 比/ 进行/ 了/ 分析/ ./ 由于/ 在/ 海量/ 传感器/ 采样/ 数据/ 的/ 云/ 存储/ 以及/ 时空/ 数据处理/ 方面/ ,/ 目前/ 尚/ 没有/ 系统性/ 的/ 相关/ 工作/ ,/ 我们/ 将/ IoT/ -/ ClusterDB/ 与/ 单/ 数据库/ 结点/ 处理/ 机制/ (/ SingleNodeQueryPro/ -/ cessing/ ,/ SNQP/ )/ 进行/ 了/ 比较/ ./ 此外/ ,/ 为了/ 分析/ 传感器/ 数据/ 动态/ 采集/ 对/ 查询/ 性能/ 所/ 造成/ 的/ 影响/ ,/ 在/ 实验/ 的/ 过程/ 中/ ,/ 由/ 数据/ 模拟/ 生成/ 程序/ 根据/ 实验/ 数据/ 集/ ,/ 持续/ 向/ IoT/ -/ ClusterDB/ 发送/ 并/ 插入/ 传感器/ 采样/ 数据/ ./ 实验/ 的/ 测试用例/ 分别/ 采用/ 第/ 3.2/ ./ 4/ 节中/ 介绍/ 的/ 关键字/ 查询/ Q1/ 、/ 属性/ 约束条件/ 查询/ Q3/ 和/ 时空/ 约束条件/ Q5/ ./ 图/ 9/ 给出/ 了/ IoT/ -/ ClusterDB/ 处理/ 各个/ 查询/ 的/ 响应/ 时间/ (/ 为了/ 更好/ 地/ 分析属性/ 约束条件/ 查询/ Q3/ 的/ 性能/ ,/ 我们/ 在/ 各叶/ 结点/ 中/ 没有/ 对/ 相关/ 属性/ 建立/ 局部/ 索引/ )/ ./ 从图/ 9/ 可以/ 看出/ ,/ IoT/ -/ ClusterDB/ 可以/ 有效/ 地/ 支持/ 关键字/ 查询/ Q1/ ,/ 且/ 在/ 不同/ 的/ 数据量/ 及/ 不同/ 的/ 叶/ 结点/ 规模/ 的/ 情况/ 下/ ,/ 关键字/ 查询/ 的/ 响应/ 时间/ 基本/ 保持稳定/ ./ 这/ 是因为/ IoT/ -/ ClusterDB/ 通过/ GFTKB/ +/ -/ Tree/ 和/ KSMB/ +/ -/ Tree/ 对/ 关键字/ 进行/ 了/ 全局/ 索引/ ,/ 因此/ 数据量/ 及/ 结点/ 规模/ 的/ 变化/ 对/ 查询/ 响应/ 时间/ 的/ 影响/ 很小/ ./ 对于/ 属性/ 约束条件/ 查询/ Q3/ ,/ 查询/ 响应/ 时间/ 明显/ 地/ 依赖于/ 数据量/ 及/ 结点/ 的/ 规模/ —/ —/ —/ 数据量/ 越大则/ 查询/ 响应/ 时间/ 越长/ ,/ 且/ 在/ 同等/ 数据量/ 的/ 情况/ 下/ ,/ 查询/ 响应/ 时间/ 随着/ 结点/ 规模/ 的/ 增大/ 而/ 减少/ ./ 这/ 是因为/ 在/ 各叶/ 结点/ 上/ 没有/ 建立/ 属性/ 索引/ ,/ 因此/ 查询/ 的/ 响应/ 时间/ 主要/ 取决于/ 各叶/ 结点/ 的/ 平均/ 数据量/ ./ 对于/ 时空/ 约束条件/ 查询/ Q5/ ,/ 其/ 查询/ 响应/ 时间/ 的/ 总体/ 变化趋势/ 与/ Q3/ 相似/ ,/ 但/ 其/ 变化/ 幅度/ 不如/ Q3/ 明显/ ,/ 且/ 查询/ 性能/ 总体/ 上/ 优于/ Q3/ ./ 这/ 是因为/ 在/ IoT/ -/ ClusterDB/ 中/ 数据/ 是/ 按照/ 地理/ 空间/ 属性/ 进行/ 分布/ 的/ ,/ 根/ 结点/ 上/ 的/ SAP/ -/ Table/ 和/ 各叶/ 结点/ 上/ 的/ 时空/ 索引/ S4T/ -/ Tree/ 共同/ 构成/ 了/ 一个/ 全局/ 时空/ 索引/ ,/ 加快/ 了/ 时空/ 查询处理/ 的/ 速度/ ,/ 并/ 降低/ 了/ 叶/ 结点/ 数据量/ 对/ 查询/ 性能/ 的/ 影响/ ./ 为了/ 进一步/ 分析/ IoT/ -/ ClusterDB/ 中叶/ 结点/ 规模/ 对非/ 关键字/ 查询处理/ 性能/ 的/ 影响/ ,/ 我们/ 在/ 表/ 3/ 和表/ 4/ 中/ 分别/ 给出/ IoT/ -/ ClusterDB/ 在/ 处理/ Q3/ 和/ Q5/ 时/ 的/ 加速/ 比/ 实验/ 结果/ ./ 加速/ 比/ Speedup/ 定义/ 为/ 其中/ ξ/ SNQP/ 和/ ξ/ IoTClusterDB/ 分别/ 是/ SNQP/ 和/ IoT/ -/ ClusterDB/ 的/ 查询/ 响应/ 时间/ ./ NLeafNodes2481632NLeafNodes2481632/ 从表/ 3/ 可以/ 看出/ ,/ IoT/ -/ ClusterDB/ 在/ 处理/ 属性/ 约束条件/ 查询/ Q3/ 时/ ,/ 加速/ 比/ 随着/ 叶/ 结点/ 个数/ 的/ 增加/ 几乎/ 呈/ 线性/ 增长/ ,/ 而且/ 数据量/ 越大/ ,/ 加速/ 比/ 增加/ 得/ 也/ 越/ 明显/ ./ 这/ 是因为/ 在/ IoT/ -/ ClusterDB/ 中/ 所有/ 的/ 数据/ 均/ 是/ 统一/ 存放/ 在/ 单个/ 关系/ 表中/ 的/ ,/ 不/ 牵涉到/ 连接/ 运算/ ,/ 因此/ 查询/ 的/ 响应/ 时间/ 基本上/ 取决于/ 各叶/ 结点/ 的/ 平均/ 数据量/ ./ 此外/ ,/ 多个/ 数据库/ 结点/ 的/ 协同工作/ 也/ 分担/ 了/ 传感器/ 数据/ 更新/ 所/ 带来/ 的/ 繁重/ 通信/ 与/ 计算/ 开销/ ./ 从表/ 4/ 可以/ 看出/ ,/ IoT/ -/ ClusterDB/ 在/ 处理/ 时空/ 约束条件/ 查询/ Q5/ 时/ ,/ 加速/ 比/ 也/ 随着/ 叶/ 结点/ 个数/ 的/ 增加/ 而/ 随之/ 增大/ ,/ 但/ 与/ Q3/ 相比/ ,/ Q5/ 的/ 加速/ 比/ 变化/ 不如/ Q3/ 变化/ 明显/ ,/ 这是/ 由于/ 全局/ 时空/ 索引/ 的/ 影响/ 而/ 导致/ 的/ ./ 另外/ ,/ 轨迹/ 的/ 分割/ 与/ 合并/ 也/ 给/ 全局/ 查询处理/ 带来/ 了/ 额外/ 的/ 计算/ 开销/ ./ 系统/ 的/ 查询处理/ 性能/ 通常/ 受到/ 数据/ 更新/ 的/ 影响/ ./ 为了/ 测试/ 传感器/ 数据/ 上传/ 对系统/ 查询处理/ 性能/ Page15/ 的/ 影响/ ,/ 我们/ 比较/ 了/ 打开/ 数据/ 更新/ 和/ 没有/ 数据/ 更新/ 两种/ 情况/ 下/ 的/ 查询/ 响应/ 时间/ (/ 每/ 一轮/ 实验/ 均取/ Q1/ ~/ Q5/ 五个/ 查询/ 的/ 平均/ 响应/ 时间/ )/ ./ 由于/ 和/ 静态/ 传感器/ 相比/ ,/ 移动/ 传感器/ 的/ 数据/ 更新/ 代价/ 更大/ (/ 因为/ 需要/ 动态/ 维护/ GSSTR/ -/ Tree/ )/ ,/ 因此/ 我们/ 选择/ 移动/ 对象/ 来/ 进行/ 测试/ ./ 同时/ ,/ 为了/ 增加/ 每个/ 叶/ 结点/ 服务器/ 的/ 压力/ ,/ 在/ 实验/ 中/ 我们/ 选择/ 相对/ 较少/ 的/ 服务器/ 数量/ (/ 4/ ~/ 16/ 个/ )/ ./ 图/ 10/ 给出/ 了/ 相关/ 的/ 实验/ 结果/ ./ 图/ 10IoT/ -/ ClusterDB/ 中/ 数据/ 更新/ 对/ 查询/ 响应/ 时间/ 的/ 影响/ 从图/ 10/ 可以/ 看出/ ,/ IoT/ -/ ClusterDB/ 在/ 叶/ 结点/ 数目/ 一定/ 的/ 情况/ 下/ ,/ 所/ 接入/ 的/ 传感器/ 数目/ 越/ 多/ ,/ 则/ 采样/ 数据/ 更新/ 对/ 查询/ 性能/ 的/ 影响/ 越大/ ./ 此外/ ,/ 当/ 传感器/ 的/ 数目/ 一定/ 时/ ,/ 随着/ 叶/ 结点/ 数目/ 的/ 增长/ ,/ 采样/ 数据/ 更新/ 对/ 查询/ 性能/ 的/ 影响/ 也/ 随之/ 降低/ ./ 当叶/ 结点/ 的/ 个数/ 为/ 16/ ,/ 所/ 接入/ 的/ 传感器/ 数目/ 为/ 91200/ 个/ 时/ ,/ 系统/ 的/ 查询/ 响应/ 时间/ 仅为/ 没有/ 数据/ 更新/ 时/ 的/ 1.5/ 倍/ ,/ 仍然/ 表现/ 了/ 良好/ 的/ 查询处理/ 性能/ ./ 综合/ 以上/ 分析/ ,/ IoT/ -/ ClusterDB/ 在/ 海量/ 传感器/ 采样/ 数据管理/ 方面/ 提供/ 了/ 良好/ 的/ 数据/ 接入/ 与/ 查询处理/ 性能/ ,/ 为物/ 联网/ 海量/ 数据管理/ 提供/ 了/ 一种/ 可行/ 的/ 解决方案/ ./ 7/ 结论/ 物/ 联网/ 打破/ 了/ 物理/ 世界/ 和/ 数字/ 世界/ 的/ 界限/ ,/ 将/ 信息技术/ 延伸/ 到/ 了/ 物理/ 世界/ 和/ 人类/ 社会/ ,/ 是/ 促使/ 未来/ 信息技术/ 产业/ 变革/ 的/ 关键性/ 技术/ ./ 本文/ 从物/ 联网/ 海量/ 数据处理/ 技术/ 的/ 角度/ 出发/ ,/ 对物/ 联网/ 所/ 提出/ 的/ 挑战/ 及/ 相关/ 对策/ 进行/ 了/ 分析/ ,/ 并/ 提出/ 了/ 一种/ 面向/ 物/ 联网/ 海量/ 传感器/ 采样/ 数据管理/ 的/ 数据库/ 集群/ 系统/ 框架/ IoT/ -/ ClusterDB/ ./ 本文/ 的/ 的/ 主要/ 创新/ 点/ 如下/ :/ (/ 1/ )/ 提出/ 了/ 一种/ 能够/ 同时/ 支持/ “/ 键/ -/ 值/ ”/ 查询/ 和/ 普通/ SQL/ 查询/ 的/ 物/ 联网/ 数据库/ 集群/ 框架/ ./ 通过/ 在/ 关系数据库/ 集群/ 的/ 基础/ 上/ 建立/ 分布式/ 的/ 全局/ 关键字/ 索引/ 及/ 全局/ 关键字/ 查询处理/ 机制/ ,/ 使得/ IoT/ -/ ClusterDB/ 可以/ 兼容/ 多种/ 查询/ 类型/ 的/ 快速/ 处理/ ,/ 突破/ 了/ 目前/ 云/ 数据管理/ 技术/ 主要/ 针对/ “/ 键/ -/ 值/ ”/ 查询/ 、/ 并行/ 数据库/ 技术/ 主要/ 针对/ SQL/ 查询/ 的/ 局限/ ./ (/ 2/ )/ 提出/ 了/ 一种/ 能够/ 应对/ 传感器/ 采样/ 数据/ 的/ 异构/ 性/ 、/ 时空/ 相关性/ 和/ 动态/ 流式/ 特性/ 的/ 传感器/ 时空/ 数据库/ 模型/ ./ 通过/ 采样/ 数据/ 序列/ 等/ 数据类型/ 和/ 相应/ 的/ 查询/ 操作/ ,/ 在/ 数据库/ 内核/ 一级/ 实现/ 了/ 传感器/ 采样/ 数据/ 的/ 统一/ 表示/ 、/ 存储/ 、/ 计算/ 和/ 查询/ ,/ 突破/ 了/ 目前/ 时空/ 数据库/ 主要/ 针对/ 静态/ 的/ 空间数据/ 或/ 相对/ 单一/ 的/ 时空/ 数据/ 、/ 缺乏/ 有效/ 的/ 异构/ 数据流/ 表示/ 方法/ 的/ 局限/ ./ (/ 3/ )/ 提出/ 了/ 一种/ 地理/ 区域/ 敏感/ 的/ 传感器/ 采样/ 数据分布/ 策略/ ,/ 并/ 在/ 此基础/ 上/ 提出/ 了/ 一种/ 分布式/ 的/ 全局/ 时空/ 索引/ 和/ 全局/ 时空/ 查询处理/ 方法/ ,/ 突破/ 了/ 目前/ 时空/ 数据库/ 主要/ 针对/ 单机/ 环境/ 、/ 缺乏/ 时空/ 数据库/ 集群/ 相关/ 方法/ 的/ 局限/ ./ 物/ 联网/ 海量/ 数据处理/ 技术/ 具有/ 广阔/ 的/ 应用/ 前景/ ./ 例如/ ,/ 通过/ 电网/ 中/ 的/ 传感器/ 结点/ ,/ 可以/ 获知/ 电网/ 中/ 的/ 电力/ 变化/ 及/ 用户/ 的/ 用电/ 规律/ ,/ 并/ 进一步/ 实现/ 智能化/ 的/ 电力/ 传输/ ;/ 通过/ 湖泊/ 中/ 布设/ 的/ 传感器/ ,/ 可以/ 对/ 污染/ 数据/ 进行/ 采样/ 并/ 进行/ 异常情况/ 的/ 报警/ ;/ 通过/ 在/ 交通系统/ 中/ 设置/ 的/ 大量/ 传感器/ ,/ 可以/ 实现/ 车/ 联网/ 和/ 先进/ 的/ 智能/ 交通/ 控制/ 与/ 管理/ 等/ ./ 随着/ 研究/ 的/ 不断深入/ 及/ 技术/ 的/ 不断/ 发展/ ,/ 可以/ 想见/ ,/ 物/ 联网/ 必将/ 在/ 国民经济/ 和/ 人民/ 生活/ 中/ 扮演/ 重要/ 的/ 角色/ ,/ 并/ 给/ 人们/ 的/ 生活/ 和/ 工作/ 方式/ 带来/ 深刻/ 的/ 变革/ ./ 致谢/ 感谢/ 中国科学院/ 软件/ 研究所/ 的/ 郭黎敏/ ,/ 她/ 在/ 本文/ 实验/ 中/ 做/ 了/ 大量/ 工作/ !/ 

