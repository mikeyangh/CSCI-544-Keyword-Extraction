Page1/ 基于/ 相变/ 存储器/ 的/ 非易失/ 内存/ 数据/ 机密性/ 保护/ 赵鹏/ 朱龙云/ (/ 清华大学/ 计算机科学/ 与/ 技术/ 系/ 北京/ 100084/ )/ 摘要/ 相变/ 存储器/ (/ Phase/ -/ ChangeMemory/ )/ 是/ 计算机/ 体系结构/ 中/ 的/ 下一代/ 内存/ 技术/ ,/ 具有/ 高密度/ 、/ 低功耗/ 、/ 非易失/ 等/ 优点/ ,/ 具备/ 替代/ 现有/ DRAM/ 内存/ 的/ 实力/ ,/ 但/ 非易失/ 的/ 自然/ 属性/ 会/ 带来/ 一系列/ 潜在/ 计算机/ 数据/ 隐私/ 方面/ 的/ 隐患/ ./ 比如/ 掉电/ 后/ 内存/ 中/ 依然/ 保留/ 了/ 很多/ 明文/ 形式/ 的/ 敏感数据/ ,/ 同时/ 相变/ 存储器/ 的/ 存储单元/ 还有/ 写/ 次数/ 有限/ 的/ 问题/ ./ 文中/ 提出/ 一种/ 基于/ 加密技术/ 和/ 减少/ 相变/ 存储器/ 写/ 次数/ 的/ 方法/ ./ 它/ 能/ 保护/ 基于/ 相变/ 存储器/ 的/ 内存/ 中/ 的/ 数据/ ,/ 即使/ 在/ 系统/ 断电/ 的/ 状态/ 下/ 内存/ 中/ 的/ 敏感数据/ 也/ 不能/ 被/ 攻击者/ 获取/ ,/ 同时/ 极大/ 延长/ 了/ 系统/ 内存/ 的/ 使用寿命/ ,/ 加强/ 了/ 非易失/ 内存/ 的/ 机密性/ 和/ 可靠性/ ./ 实验/ 结果表明/ ,/ 增加/ 处理单元/ 后/ ,/ 整体/ 系统/ 性能/ 只/ 下降/ 3.6/ %/ ,/ 同时/ 在/ 加密/ 操作/ 的/ 条件/ 下/ 相变/ 内存/ 的/ 寿命/ 平均/ 延长/ 2.6/ 倍/ ,/ 所提/ 设计方案/ 可以/ 很/ 好/ 地/ 达到/ 预期/ 目的/ ./ 关键词/ 相变/ 存储器/ ;/ 加密/ 内存/ ;/ 机密性/ ;/ 写/ 操作/ 1/ 引言/ 随着/ 计算机/ 体系结构/ 的/ 发展/ ,/ 计算机/ 的/ 运算/ 能力/ 显著/ 提高/ ,/ 同时/ 系统对/ 内存/ 的/ 要求/ 也/ 越来越/ 高/ ./ 目前/ 所/ 使用/ 的/ 动态随机/ 存储器/ (/ DRAM/ )/ 的/ 发展/ 逐渐/ 遇到/ 了/ 瓶颈/ ,/ 片载/ 容量/ 和/ 能耗/ 问题/ 日益突出/ ,/ 研究/ 人员/ 开始/ 寻找/ 能/ 解决问题/ 的/ 替代/ 产品/ ./ 相变/ 存储器/ 技/ Page2/ 术/ (/ Phase/ -/ ChangeMemory/ )/ 以下/ 简称/ PCM/ ,/ 作为/ 一种/ 新型/ 的/ 存储技术/ 正/ 日趋/ 成熟/ ./ 由于/ PCM/ 的/ 读写/ 速度/ 和/ DRAM/ 的/ 读写/ 速度/ 相近/ ,/ 和/ DRAM/ 相比/ ,/ 既/ 节约/ 能耗/ ,/ 片载/ 密度/ 又/ 高/ ,/ 所以/ PCM/ 成为/ 一种/ 很/ 好/ 的/ DRAM/ 替代品/ ,/ 成为/ 下一代/ 内存/ 技术/ 的/ 主要/ 候选/ 对象/ ./ PCM/ 尽管/ 拥有/ 众多/ 优点/ ,/ 但/ 要/ 作为/ 计算机系统/ 的/ 内存/ 依然/ 面临/ 很多/ 挑战/ ./ PCM/ 的/ 一个/ 重要/ 特性/ 是非/ 易/ 失性/ ,/ 保存/ 在/ PCM/ 存储单元/ 中/ 的/ 信息/ 在/ 没有/ 电力/ 供给/ 的/ 情况/ 下/ 可以/ 永久/ 保持/ ,/ 拥有/ 同/ 磁盘/ 、/ Flash/ 闪存/ 等/ 一样/ 的/ 数据/ 非易失/ 特性/ ./ PCM/ 不仅/ 可以/ 替代/ DRAM/ ,/ 也/ 可以/ 替代/ 磁盘/ 或/ Flash/ 闪存/ ./ 由于/ 在/ 现代/ 计算机/ 体系/ 架构/ 中/ ,/ 内存/ 占有/ 核心/ 地位/ ,/ 即使/ 在/ 外存/ 或/ 网络/ 传输/ 中/ 对/ 数据/ 进行/ 了/ 加密/ 保护/ ,/ 一旦/ 数据/ 要/ 进行/ 处理/ ,/ 就要/ 被/ 调入/ 内存/ ./ 当/ 处于/ 内存/ 中/ 的/ 数据/ 要/ 进行/ 处理/ 时/ 都/ 会/ 脱离/ 原来/ 的/ 保护/ ,/ 比如/ 从/ 密文/ 转换/ 为/ 明文/ 参与/ 运算/ 处理/ ./ 这/ 就/ 给/ 攻击者/ 带来/ 了/ 可乘之机/ ./ 攻击者/ 可以/ 直接/ 对/ 内存/ 数据/ 进行/ 扫描/ 然后/ 进行/ 数据分析/ ,/ 寻找/ 他们/ 感兴趣/ 的/ 数据/ ,/ 比如/ 用户/ 的/ 银行/ 账户/ 和/ 密码/ ,/ 用户/ 的/ 个人隐私/ 数据/ 等/ ./ 即使/ 系统/ 断电/ 之后/ ,/ 攻击者/ 仍然/ 可以/ 获得/ 数据/ ./ 文献/ [/ 1/ ]/ 采用/ 了/ coldboot/ 攻击/ ,/ 在/ 系统/ 关机/ 掉电/ 后/ ,/ 用/ 液氮/ 来/ 冷冻/ DRAM/ 内存/ ,/ 原本/ 掉电/ 后/ 消失/ 的/ 数据/ 还/ 会长/ 时间/ 保存/ 在/ DRAM/ 中/ ,/ 攻击者/ 将/ 冷冻/ 的/ DRAM/ 内存/ 插入/ 到/ 自己/ 的/ 计算机/ 中/ ,/ 就/ 可以/ 拷贝/ 内存/ 数据/ 并/ 进行/ 数据分析/ 进而/ 获得/ 共享/ 密钥/ 等/ 信息/ ./ 当/ PCM/ 作为/ 内存/ 时/ ,/ 自身/ 的/ 非易失/ 特性/ 决定/ 了/ 即使/ 掉电/ 后/ 内存/ 中/ 的/ 数据/ 也/ 不会/ 消失/ ,/ 这/ 就/ 更/ 方便/ 了/ 攻击者/ ./ 攻击者/ 只/ 需/ 将/ 掉电/ 后/ 的/ PCM/ 内存/ 插入/ 到/ 自己/ 的/ 计算机/ 中/ 就/ 可以/ 按部就班/ 地/ 完成/ 剩下/ 的/ 数据/ 获取/ 步骤/ ./ 这会/ 给/ 计算机系统/ 造成/ 极大/ 的/ 安全隐患/ ./ 还有/ 一个/ PCM/ 需要/ 面对/ 的/ 挑战/ 是/ 本身/ 写/ 次数/ 有限/ 的/ 问题/ ./ 每个/ PCM/ 存储单元/ 目前/ 的/ 可/ 写/ 次数/ 大约/ 是/ 108/ 次/ ,/ 作为/ 内存/ 的/ 存储单元/ 中/ 的/ 数据/ 更新/ 会/ 很/ 频繁/ ,/ 当写/ 次数/ 达到/ 上限/ 后/ ,/ 该/ 存储单元/ 会/ 失效/ 进而/ 造成/ 数据/ 丢失/ ,/ 这/ 在/ 一定/ 程度/ 上/ 降低/ 了/ PCM/ 内存/ 自身/ 的/ 稳定性/ ./ 本文/ 在/ 分析/ 了/ PCM/ 内/ 存在/ 数据保护/ 方面/ 所/ 面临/ 的/ 挑战/ 后/ ,/ 提出/ 一种/ 基于/ 加密技术/ 和/ 减少/ 相变/ 存储器/ 写/ 次数/ 的/ 方法/ ./ 该/ 方法/ 既/ 能/ 保护/ 基于/ 相变/ 存储器/ 的/ 内存/ 中/ 的/ 数据/ ,/ 即使/ 在/ 系统/ 断电/ 的/ 状态/ 下/ 内存/ 中/ 的/ 敏感数据/ 也/ 不能/ 被/ 攻击者/ 获取/ ,/ 同时/ 极大/ 延长/ 了/ 系统/ 内存/ 的/ 使用寿命/ ,/ 从而/ 加强/ 了/ 非易失/ 内存/ 数据/ 的/ 机密性/ 和/ 可靠性/ ./ 本文/ 第/ 2/ 节/ 介绍/ 相关/ 工作/ ;/ 第/ 3/ 节/ 介绍/ 整体/ 解决方案/ ,/ 并/ 分别/ 从/ 数据保护/ 、/ 数据/ 加密/ 对/ 数据/ 写/ 回/ 的/ 影响/ 及/ 有效/ 减少/ 写/ 次数/ 的/ 方法/ 三个/ 方面/ 详细/ 介绍/ 解决方案/ ;/ 第/ 4/ 节/ 给出/ 本文/ 所提/ 方案/ 的/ 一些/ 实验/ 结果/ 并/ 进行/ 了/ 相关/ 比较/ ;/ 第/ 5/ 节/ 做/ 了/ 总结/ 和/ 展望/ ./ 2/ 相关/ 工作/ 2.1/ 相变/ 存储器/ 技术/ 传统/ DRAM/ 存储单元/ 使用/ 1/ 个/ 电容/ 存储/ 1/ 比特/ 信息/ ./ 而/ 一个/ 相变/ 存储单元/ 使用/ 含有/ 一种/ 或/ 多种/ 氧族/ 元素/ 的/ 玻璃/ 材质/ 来/ 存储/ 1/ 比特/ 信息/ ./ 这种/ 介质/ 可以/ 稳定/ 地/ 存在/ 两种/ 状态/ :/ 非晶体/ 状态/ 和/ 晶体/ 状态/ ./ 可以/ 用来/ 代表/ 逻辑/ 上/ 的/ ‘/ 0/ ’/ 和/ ‘/ 1/ ’/ ./ 两种/ 状态/ 可以/ 通过/ 加热/ 来/ 进行/ 状态/ 转换/ ./ 当/ 温度/ 达到/ 结晶/ 温度/ 以上/ 并/ 小于/ 熔点/ 时/ ,/ 材质/ 由/ 非晶体/ 状态/ 转变/ 为/ 晶体/ 状态/ (/ ‘/ 1/ ’/ )/ ./ 当/ 加热/ 温度/ 超过/ 熔点/ 温度/ 后/ ,/ 材质/ 又/ 变为/ 非晶体/ 状态/ (/ ‘/ 0/ ’/ )/ ./ 这种/ 材质/ 还/ 可以/ 通过/ 加热/ 温度/ 的/ 不同/ 来/ 形成/ 多种/ 可以/ 区分/ 的/ 状态/ 来/ 存储/ 更/ 多/ 的/ 信息/ ./ 图/ 1/ 为/ 利用/ 相变/ 存储单元/ 构成/ 的/ PCM/ 存储阵列/ ,/ 可以/ 像/ DRAM/ 那样/ 存储/ 多位/ 数据/ ./ 2.2/ 延长/ PCM/ 写/ 寿命/ 技术/ 大/ 类/ :/ 目前/ 延长/ PCM/ 写/ 寿命/ 的/ 方法/ 主要/ 分为/ 两/ (/ 1/ )/ 减少/ 数据/ 的/ 写/ 次数/ 由于/ PCM/ 可以/ 按位/ 寻址/ ,/ 所以/ 最小/ 的/ 写/ 操作/ 单位/ 是/ 比特/ 位/ ./ Cacheline/ 级别/ 的/ 写/ 回/ 策略/ [/ 3/ ]/ 只/ 把/ 修改/ 过/ 的/ cacheline/ 写回/ ,/ 而/ 不是/ 把/ 整个/ 页/ 写/ 回/ PCM/ 内存/ ./ 同样/ ,/ 部分/ 写/ 的/ 方法/ (/ partialwrites/ )/ [/ 4/ ]/ 是/ 当/ cacheline/ 被/ 替换/ 时/ ,/ 只/ 把/ 包含/ 修改/ 过/ 比特/ 位/ 的/ 脏字/ 写回/ PCM/ 内存/ ./ Redundantbit/ -/ writeremoval/ [/ 2/ ]/ 设计/ 了/ 一个/ 硬件/ 电路/ ,/ 会/ 将/ 现有/ 数据/ 和/ 新/ 的/ 将要/ 写入/ 的/ 数据/ 进行/ 对比/ ,/ 仅仅/ 将/ 那些/ 不同/ 的/ 数据位/ 写回/ ./ Flip/ -/ N/ -/ write/ [/ 5/ ]/ 将/ 修改/ 的/ 数据/ 位数/ 控制/ 在/ 50/ %/ 以内/ ./ (/ 2/ )/ 磨损/ 均衡/ 磨损/ 均衡/ 的/ 目的/ 是/ 使/ 写/ 操作/ 均匀分布/ 到/ 各个/ 存/ Page3/ 储/ 单元/ ./ Segmentswapping/ [/ 2/ ]/ 当/ 一个/ 段/ 的/ 擦写/ 次数/ 过多时/ ,/ 将/ 其/ 与/ 其它/ 擦写/ 次数/ 少/ 的/ 段/ 进行/ 交换/ ./ Start/ -/ gap/ [/ 6/ ]/ 当写/ 操作/ 次数/ 达到/ 一定/ 程度/ 时/ ,/ 通过/ 一个/ 空闲/ cacheline/ 来/ 对/ 存储/ 块/ 进行/ 调整/ ,/ 同时/ 改变/ 逻辑/ 地址/ 和/ 物理地址/ 的/ 对应/ 关系/ 来/ 达到/ 磨损/ 均衡/ ./ 这/ 两类/ 技术/ 均/ 可以/ 有效/ 地/ 解决/ PCM/ 的/ 写/ 寿命/ 问题/ ,/ 通常/ 可以/ 混合/ 使用/ ./ 2.3/ 存储/ 加密技术/ 为了/ 防止/ 被/ 攻击者/ 轻易/ 看到/ 明文/ 数据/ ,/ 通常/ 采用/ 对/ 数据/ 进行/ 加密/ 的/ 方法/ 来/ 保证数据/ 的/ 机密性/ ./ 最/ 简单/ 的/ 方式/ 是/ 采用/ 直接/ 加密/ 的/ 方式/ ,/ 也/ 就是/ 直接/ 用/ 密钥/ 通过/ 对称/ 加密/ 的/ 分组/ 加密算法/ 对/ 明文/ 信息/ 进行/ 加密/ ./ 但/ 这样/ 做/ 的/ 一个/ 很大/ 的/ 缺点/ 是/ 性能/ 不好/ ,/ 很大/ 程度/ 地/ 降低/ 了/ 系统/ 的/ 数据处理/ 能力/ ./ 另外/ 一种/ 通用/ 的/ 方法/ 是/ 采用/ 基于/ 计数器/ 的/ 加密/ 方式/ [/ 7/ ]/ 来/ 提高/ 加密/ 图/ 2/ 数据处理/ 流程/ 设计图/ 数据/ 从/ PCM/ 内存/ 中/ 读取/ ./ 在/ PCM/ 内存/ 中/ ,/ 数据/ 以/ 加密/ 形式/ 存在/ ./ 当/ 处理器/ 调用/ 内存/ 数据/ 时/ ,/ 调用/ 到/ 的/ 加密/ 数据/ 将/ 进入/ 到/ 安全/ 处理/ 区域/ ./ 首先/ 通过/ 减少/ 写/ 操作/ 的/ 处理单元/ ,/ 进行/ 数据/ 预处理/ ./ 然后/ 同/ 加密/ // 解密/ 单元/ 中/ 生成/ 的/ 加密/ 块/ 做/ 异或/ 操作/ ,/ 完成/ 数据/ 解密/ 过程/ ./ 最后/ 明文/ 数据/ 进入/ 缓存/ ./ 数据/ 写回/ PCM/ 内存/ ./ 当/ 数据/ 发生/ 改变/ 被/ 缓存/ 换出/ 时/ ,/ 需要/ 将/ 数据/ 写回/ PCM/ 内存/ 中/ ./ 按照/ 读取数据/ 的/ 逆/ 过程/ ,/ 对/ 数据/ 进行/ 异或/ 加密/ 处理/ 后/ 再/ 进行/ 减少/ 写/ 操作/ 的/ 处理/ 形成/ 加密/ 数据/ ,/ 写/ 回到/ PCM/ 内存/ ./ 设计方案/ 的/ 重点/ 和/ 难点/ 在于/ 如何/ 生成/ 安全/ 的/ 加密/ 块/ ,/ 也/ 就是/ 如何/ 选择/ 加密算法/ 种子/ 实现/ 加密/ 块/ 的/ 唯一性/ ,/ 从而/ 保证数据/ 的/ 机密性/ ./ 这/ 将/ 在/ 3.2/ 小节/ 中/ 进行/ 详细/ 叙述/ ./ 研究/ 发现/ ,/ 由于/ 加密算法/ 的/ 扩散/ 效应/ 会/ 导致/ 数据/ 的/ 改动/ 很大/ ,/ 这/ 就/ 给/ 有/ 写/ 次数/ 限制/ 的/ PCM/ 内存/ 带来/ 了/ 考验/ ./ 为了/ 降低/ 加密/ 对/ PCM/ 内存/ 的/ 影响/ ,/ 延长/ PCM/ 使用寿命/ ,/ 本/ 方案/ 中/ 增加/ 了/ 减少/ 写/ 操作/ 的/ 处理单元/ ,/ 有效/ 地/ 缓解/ 了/ 加密/ 带来/ 的/ 影响/ ./ 性能/ ./ 它/ 利用/ 计数器/ 和/ 对称/ 加密算法/ 生成/ 一个/ 一次/ 一密/ 的/ 加密/ 块/ ,/ 然后/ 加密/ 块/ 和/ 数据/ 进行/ 异或/ 处理/ ./ 这样/ 加密/ 过程/ 和/ 数据/ 获取/ 过程/ 可以/ 并行执行/ 从而/ 提高/ 性能/ ./ 3/ 设计方案/ 3.1/ 整体/ 设计/ 框架/ 如图/ 2/ 所示/ ,/ 将/ 计算机系统/ 分为/ 两个/ 区域/ :/ 信任/ 区域/ 和/ 不/ 信任/ 区域/ ,/ 在/ 信任/ 区域/ 可以/ 使用/ 明文/ 来/ 直接/ 对/ 数据/ 进行/ 操作/ ;/ 在/ 不/ 信任/ 区域/ 数据/ 均/ 为/ 加密/ 形式/ ./ 本/ 设计方案/ 的/ 主要/ 内容/ 是/ 增加/ 了/ 一个/ 安全/ 处理/ 区域/ ,/ 位于/ 缓存/ 和/ 内存/ 之间/ ,/ 来/ 完成/ 对/ 数据/ 的/ 加解密/ 和/ 减少/ 写/ 操作/ 的/ 处理/ ./ 3.2/ 数据/ 机密性/ 保护/ 首先/ 分析/ 一下/ 在/ 计数器/ 加密/ 模式/ 下/ 的/ 安全性/ ./ 加密算法/ 通过/ 加密/ 种子/ 数据/ 来/ 生成/ 一个/ 加密/ 块/ ,/ 然后/ 要/ 加密/ 的/ 数据/ 同/ 加密/ 块/ 做/ 异或/ 运算/ 生成/ 加密/ 数据/ ./ 这种/ 加密/ 方式/ 的/ 安全性/ 关键在于/ 要/ 确保/ 每次/ 加密/ 时/ 的/ 加密/ 块/ 不能/ 重复/ ,/ 也/ 就是/ 要/ 保证/ 种子/ 数据/ 的/ 唯一性/ ./ 假定/ 两个/ 明文/ 数据/ 块/ 分别/ 为/ P1/ 和/ P2/ ,/ 加密/ 后/ 的/ 数据/ 块/ 为/ C1/ 和/ C2/ ,/ 对/ 两个/ 数据/ 块/ 采用/ 相同/ 的/ 种子/ 数据/ Seed1/ =/ Seed2/ ,/ 由于/ 分组/ 加密算法/ 是/ 一对一/ 映射函数/ ,/ 那么/ 它们/ 产生/ 的/ 加密/ 块/ 也/ 相同/ ./ 两边/ 经过/ 异或/ 运算/ ,/ 得到/ 根据/ 异或/ 的/ 运算/ 性质/ 最后/ 可以/ 得到/ C1XORC2/ =/ (/ P1XOREkey/ (/ Seed1/ )/ )/ XOR/ 从/ 最后/ 得到/ 的/ 公式/ 可以/ 看到/ 如果/ 知道/ 任意/ 3/ 个/ Page4/ 未知数/ 的/ 值/ ,/ 另外/ 一个/ 未知数/ 也/ 可以/ 计算/ 得到/ ./ 很多/ 情况/ 下/ ,/ 攻击者/ 可以/ 得到/ 加密/ 过/ 的/ 数据/ ,/ 然后/ 通过/ 一些/ 手段/ 可以/ 获得/ 一个/ 明文/ 数据/ ,/ 那么/ 最后/ 一个/ 未知数/ 将会/ 被/ 破解/ ./ 所以/ 在/ 这种/ 加密/ 模式/ 中要/ 达到/ 安全性/ 就/ 要求/ 种子/ 数据/ 必须/ 是/ 唯一/ 的/ 、/ 不可/ 重复/ 的/ ./ 为了/ 保证/ 种子/ 数据/ 的/ 唯一性/ ,/ 我们/ 借鉴/ 了/ 文献/ [/ 7/ ]/ 中/ 的/ 设计/ 思路/ ./ 将/ 数据/ 的/ 虚拟地址/ 和/ 计数器/ 结合/ 来/ 构成/ 种子/ 数据/ ./ 利用/ 内存/ 数据/ 块/ 的/ 虚拟地址/ 来/ 保证/ 在/ 空间/ 上/ 的/ 唯一性/ ,/ 利用/ 计数器/ 来/ 保证/ 时间/ 上/ 的/ 唯一性/ ./ 利用/ 这种/ 方式/ 可以/ 避免/ 在/ 同一/ 地址/ 上/ 写/ 回/ 不同/ 的/ 种子/ 数据/ ,/ 达到/ 种子/ 数据/ 的/ 全局/ 唯一/ 的/ 目的/ ./ 在/ 安全/ 处理/ 区域/ 中/ 增加/ 一个/ 全局/ 的/ 64/ 位非/ 易失/ 寄存器/ 作为/ 全局/ 计数器/ ./ 采用/ 大/ 位数/ 的/ 寄存器/ 可以/ 保证/ 计数器/ 不/ 轻易/ 溢出/ ,/ 从而/ 排除/ 相同/ 种子/ 的/ 可能/ ./ 当/ 需要/ 对/ 内存/ 进行/ 写/ 操作/ 时/ ,/ 计数器/ 自动/ 加/ 1/ ,/ 即使/ 掉电/ ,/ 计数器/ 也/ 不会/ 丢失/ 数据/ ./ 当/ 数据/ 写回/ 内存/ 后/ ,/ 数据/ 加密/ 时所/ 对应/ 的/ 计数器/ 同样/ 写入/ 内存/ 的/ 特定/ 区域/ ./ 当/ 解密/ 时/ ,/ 需要/ 将/ 数据/ 对应/ 的/ 计数器/ 读入/ 安全/ 处理/ 区域/ ,/ 为了/ 提高/ 运算/ 性能/ ,/ 在/ 安全/ 处理/ 区域/ 中/ 设计/ 了/ 8MB/ 的/ 计数器/ 缓存/ ,/ 可以/ 缓存/ 1MB/ 计数器/ 的/ 数值/ ,/ 从而/ 提高/ 处理/ 性能/ ./ 此外/ ,/ 分组/ 加密算法/ 采用/ 标准/ 的/ AES/ 加密/ ,/ 密钥/ 是/ AES/ 加密/ 引擎/ 自身/ 提供/ 的/ 私有/ 密钥/ 或是/ 外部/ 提供/ 的/ 可/ 信任/ 的/ 私有/ 密钥/ ,/ 每个/ 引擎/ 的/ 密钥/ 均/ 不同/ ./ 当/ 数据/ P/ 写回/ 内存/ 时/ :/ GlobalCounter/ 是/ 全局/ 计数器/ 中/ 的/ 当前/ 值/ ,/ Local/ -/ Counter/ 随/ 数据/ P/ 一同/ 写入/ 内存/ ./ 当/ 数据/ P/ 从/ 内存/ 读取/ 时/ ,/ 首先/ 从/ 计数器/ 缓存/ 中/ 查找/ 相应/ 的/ 计数器/ 是否/ 存在/ ./ 若/ 命中/ ,/ 直接/ 调用/ ;/ 若/ 缺失/ ,/ 则/ 需/ 从/ 内存/ 中/ 读取/ :/ 3.3/ 分析/ 数据/ 加密/ 对/ 数据/ 写/ 回/ 的/ 影响/ 在/ 上面/ 所/ 设计/ 的/ 数据保护/ 方案/ 中/ ,/ 当/ 数据/ 需要/ 被/ 写/ 回/ PCM/ 内存/ 时/ ,/ 数据/ 将/ 进行/ 加密/ 操作/ ,/ 加密/ 后/ 的/ 数据/ 和/ 内存/ 中/ 原来/ 的/ 数据/ 差别/ 越大/ ,/ 意味着/ 需要/ 修改/ 的/ PCM/ 存储单元/ 越多/ ./ 为了/ 延长/ PCM/ 存储单元/ 寿命/ ,/ 修改/ 的/ 位数/ 越少/ 越/ 好/ ./ 下面/ 通过/ 一个/ 简单/ 的/ 实验/ 来/ 分析/ 数据/ 加密/ 对/ 数据/ 写/ 回/ 的/ 影响/ ./ 假定/ 采用/ AES/ 算法/ 进行/ 数据/ 加密/ ,/ 分组/ 大小/ 和/ 密钥/ 长度/ 均/ 为/ 128/ 位/ ./ 需要/ 加密/ 的/ 数据/ 为/ 00000000000000000000000000000000/ ,/ 修改/ 后/ 的/ 数据/ 00000000000000000000000000000001/ ./ 密钥/ 为/ 0123456789ABCDEF0123456789ABCDEF/ ./ 所列/ 数据/ 均/ 为/ 十六进制/ 表示/ ./ 如图/ 4/ 所示/ ,/ 一个/ 数据/ 块/ 在/ 未/ 采用/ 加密/ 方式/ 时/ 只/ 修改/ 了/ 一位/ ,/ 当/ 采用/ 加密/ 方式/ 后/ ,/ 由于/ 加密算法/ 所/ 具有/ 的/ 扩散/ 效应/ 使/ 多位/ 数据/ 产生/ 变化/ ,/ 从图/ 4/ 中/ 的/ 例子/ 中/ 看到/ 原始数据/ 需要/ 修改/ 63/ 位/ ,/ 占/ 到/ 了/ 数据/ 块/ 的/ 一半/ ./ 这/ 加快/ 了/ 对/ PCM/ 内存/ 存储单元/ 的/ 磨损/ ./ 3.4/ 减少/ PCM/ 写/ 次数/ 当写/ 回/ 的/ cacheline/ 数据/ 经过/ 加密/ 处理/ 后/ ,/ 数据/ 的/ 改动/ 就/ 不会/ 是/ 局部性/ 的/ 变动/ ,/ 而是/ 分散/ 到/ 了/ 多个/ 位上/ ./ 上/ 一节/ 的/ 实验/ 中/ 可以/ 看到/ 这一/ 现象/ ./ 由于/ PCM/ 存在/ 存储单元/ 写/ 次数/ 受限/ 的/ 问题/ ,/ 为了/ 减小/ 加密/ 操作/ 对/ PCM/ 内存/ 寿命/ 的/ 伤害/ ,/ 我们/ 设计/ 增加/ 了/ 一种/ 减少/ PCM/ 写/ 次数/ 的/ 处理单元/ 来/ 延长/ PCM/ 存储单元/ 的/ 寿命/ ./ 设计/ 的/ 要点/ 是/ 在/ PCM/ 内存/ 中为/ 每个/ cacheline/ 大小/ 的/ 数据/ 块/ 增加/ 两个/ 标志/ 位/ ./ 在/ 图/ 2/ 中/ 的/ 减少/ 写/ 操作/ 处理单元/ 中/ 增加/ 一个/ cacheline/ 大小/ 的/ 只读/ 辅助/ 寄存器/ ,/ 初值/ 为/ 1010/ …/ 1010/ ./ 下面/ 对/ 数据/ 的/ 读取/ 和/ 写入/ 两个/ 过程/ 详细描述/ ./ 3.4/ ./ 1/ 数据/ 写入/ 过程/ 如图/ 5/ 所示/ ,/ 数据/ 写入/ 时所/ 经历/ 的/ 过程/ :/ (/ 1/ )/ 首先/ 需要/ 将/ 写/ 回/ 的/ 数据/ 块/ 进行/ 预处理/ ,/ 分别/ Page5/ 进行/ 取反/ 、/ 异或/ 和/ 同/ 或/ 运算/ ;/ 原始数据/ 块/ ;/ 取/ 的/ 原始数据/ 块求/ 汉明/ 距离/ ;/ (/ 2/ )/ 在/ 运算/ 的/ 同时/ 从/ PCM/ 内存/ 中/ 读取/ 相应/ 的/ (/ 3/ )/ 分别/ 将/ 预处理/ 后/ 的/ 数据/ 同/ PCM/ 内存/ 中读/ (/ 4/ )/ 选择/ 汉明/ 距离/ 最小/ 的/ 相应/ 预处理/ 结果/ 写回/ 存储单元/ ,/ 并/ 置/ 相应/ 的/ 标志/ 位/ ;/ 完成/ 写入/ 过程/ ./ 2/ 位/ 标志/ 位/ 可以/ 表示/ 4/ 种/ 状态/ ,/ 汉明/ 距离/ 最小/ 表明/ 需要/ 写/ 回/ 的/ 预处理/ 数据/ 同/ 原始数据/ 块/ 的/ 差别/ 最小/ ./ 3.4/ ./ 2/ 数据/ 读取/ 过程/ 如图/ 6/ 所示/ ,/ 数据/ 读取/ 时所/ 经历/ 的/ 过程/ 包括/ :/ (/ 1/ )/ 首先/ 读取数据/ 块/ 及/ 相应/ 标志/ 位/ ;/ (/ 2/ )/ 通过/ 标志/ 位来/ 判断/ 采取/ 哪/ 种/ 运算/ ,/ 如/ :/ 标志/ 位为/ 01/ ,/ 将/ 数据/ 块/ 直接/ 进行/ 取反/ 操作/ 即可/ 得到/ 数据/ 块/ ;/ 若/ 标志/ 位为/ 10/ ,/ 数据/ 块/ 需要/ 结合/ 辅助/ 寄存器/ 进行/ 异或/ 操作/ 得到/ 需要/ 的/ 数据/ 块/ ;/ 若/ 标志/ 位为/ 00/ ,/ 则/ 直接/ 读取数据/ 块/ ;/ 若/ 标志/ 位为/ 11/ ,/ 则/ 结合/ 辅助/ 寄存器/ 进行/ 同/ 或/ 操作/ 得到/ 数据/ ./ 4/ 实验/ 评测/ 4.1/ 实验/ 环境/ 实验/ 采用/ GEM5/ [/ 8/ ]/ 体系结构/ 模拟器/ 进行/ ./ GEM5/ 可/ 按照/ 指令/ 周期/ 模拟/ 计算机硬件/ 系统/ 运行状况/ ./ 按照/ 设计/ 要求/ 对/ 其/ 进行/ 了/ 修改/ ,/ 增加/ 了/ PCM/ 的/ 模拟/ ,/ 构建/ 了/ PCM/ 内存/ ./ 表/ 1/ 为/ 实验/ 系统/ 的/ 简要/ 配置/ ./ 实验/ 所用/ 系统/ 环境/ 包含/ 双核/ X86/ _/ 64/ 处理器/ 架构/ 、/ 两级/ cache/ 结构/ 、/ 4GB/ 的/ PCM/ 内存/ ./ 部分/ 测试程序/ 选自/ SPECCPU2000/ &/ SPECCPU2006/ 标准/ 测试程序/ 中/ 的/ 访存/ 密集型/ 程序/ ,/ 实验/ 结果/ 中/ 各/ 程序/ 均/ 运行/ 1/ 亿个/ 指令/ 周期/ ./ 设置/ 访存/ 延迟/ 为/ 100/ 个/ 时钟/ 周期/ ,/ 加解密/ 的/ 访问/ 延迟/ 为/ 50/ 个/ 时钟/ 周期/ ./ 参数/ 处理器/ 参数/ 2/ 个/ 乱序执行/ 处理单元/ ,/ 运行/ 频率/ 为/ 2GHz/ ,/ L1/ 缓存/ 参数/ 处理单元/ 私有/ L1/ 缓存/ ,/ 分离式/ ,/ LRUL2/ 缓存/ 参数/ 共享/ ,/ 4MB/ ,/ 16/ -/ way/ ,/ 256b/ // line/ ,/ LRU/ 内存/ 控制器/ 单/ 内存/ 控制器/ 内存/ 配置/ 4GBPCM/ 内存/ ,/ 1DIMM/ ,/ 4Ranks/ // DIMM/ ,/ 4.2/ 系统/ 性能/ 比较/ 通过/ 在/ 基于/ PCM/ 内存/ 的/ 系统/ 上/ 运行/ 标准/ 测试程序/ 来/ 评测/ 我们/ 的/ 设计方案/ 是否/ 有效/ ./ 由于/ 我们/ 的/ 设计方案/ 是/ 在/ 原有/ 计算机系统/ 处理/ 流程/ 中/ 加入/ 了/ 加解密/ 和/ 减少/ 写/ 次数/ 两个/ 处理单元/ ,/ 数据/ 从/ 内存/ 到达/ CPU/ 的/ 时间/ 会/ 产生/ 额外/ 延迟/ ./ 此外/ ,/ 在/ 减少/ 写/ 次数/ 的/ 处理单元/ 中/ 需要/ 读取/ 原始数据/ 块/ 进行/ 比较/ ,/ 这/ 也/ 带来/ 了/ 额外/ 系统/ 开销/ ,/ 增加/ 了/ 延迟/ ./ 但/ 在/ 处理过程/ 中/ ,/ 数据/ 预处理/ 和/ 读取/ 原始/ 内存/ 数据/ 部分/ 可以/ 并行执行/ ,/ 这/ 在/ 一定/ 程度/ 上/ 减少/ 了/ 系统/ 开销/ ./ 图/ 7/ 为/ 我们/ 的/ 实验/ 结果/ ./ 实验/ 中用/ 无/ 保护措施/ 的/ 系统/ 作为/ 标准/ ,/ 记为/ 100/ %/ ./ 相应/ 地/ 统计/ 了/ 只有/ 加密/ 单元/ 和/ 加密/ +/ 减少/ 写/ 操作/ 同时/ 作用/ 的/ 系统配置/ 下/ 的/ 系统/ 性能/ 情况/ ./ 加密/ 单元/ 带来/ 的/ 平均/ 系统/ 延迟时间/ 为/ 1.6/ %/ ,/ 减少/ 写/ 次数/ 的/ 处理单元/ 带来/ 的/ 平均/ 系统/ 延迟时间/ 为/ 2/ %/ ,/ 系统/ 整体/ 平均/ 增加/ 延迟时间/ 为/ 3.6/ %/ ./ Page64/ ./ 3/ 对/ PCM/ 内存/ 写/ 次数/ 的/ 影响/ 本组/ 实验/ 的/ 目的/ 主要/ 是/ 验证/ 我们/ 提出/ 的/ 减少/ 写/ 操作方法/ 可以/ 极大/ 减少/ 写/ 次数/ ./ 对比/ 的/ 是/ Flip/ -/ N/ -/ write/ 算法/ ./ 该/ 算法/ 思想/ 是/ 判断/ 汉明/ 距离/ 是否/ 大于/ 整组/ 数据/ 位数/ 的/ 一半/ ./ 若/ 大于/ ,/ 则/ 将/ 数据/ 全部/ 求反/ ,/ 然后/ 再/ 修改/ 内存/ 中/ 的/ 数据/ ./ 本组/ 实验/ 的/ cacheline/ 长度/ 为/ 256/ 位/ ,/ 写/ 回/ 的/ 数据/ 为/ 随机/ 生成/ 的/ 数据/ 集/ ./ 两种/ 方法/ 在/ 同一个/ 实验/ 下/ 使用/ 的/ 数据/ 相同/ ./ 实验/ 结果/ 如图/ 8/ 所示/ ,/ x/ 轴为/ 写/ 回/ 内存/ 的/ 次数/ ,/ y/ 轴为/ 总共/ 修改/ 的/ 数据/ 位数/ ./ 当/ 随机/ 数据/ 写回/ PCM/ 内存/ 10000/ 次时/ ,/ 我们/ 的/ 方法/ 平均/ 只/ 修改/ 了/ 89386/ 比特/ 位/ ,/ Flip/ -/ N/ -/ write/ 方法/ 则/ 在/ 相同/ 随机/ 数据/ 的/ 情况/ 下/ 需要/ 修改/ 707333/ 比特/ 位/ ;/ 当/ 随机/ 数据/ 写回/ 10000000/ 次时/ ,/ 我们/ 的/ 方法/ 只/ 需要/ 修改/ 90107606/ 次/ ,/ 而/ Flip/ -/ N/ -/ write/ 方法/ 则/ 需要/ 修改/ 707557428/ 次/ ./ 由/ 实验/ 数据/ 对比/ ,/ 可以/ 看出/ 我们/ 的/ 方法/ 可以/ 更好/ 地/ 减少/ PCM/ 内存/ 的/ 修改/ 位数/ ,/ 从而/ 提高/ PCM/ 内存/ 的/ 使用寿命/ ./ 4.4/ 与/ 其它/ 算法/ 的/ 比较/ 数据/ 经过/ 加密/ 操作/ 后/ ,/ 被/ 修改/ 的/ 数据/ 经过/ 扩散作用/ ,/ 需要/ 修改/ 的/ 数据位/ 普遍/ 增多/ ./ 很多/ 减少/ 写/ 操作/ 的/ 方法/ 经过/ 加密/ 操作/ 后/ ,/ 效果/ 大打折扣/ ./ 图/ 9/ 给出/ 了/ 几种/ 算法/ 在/ 带有/ 加密/ 处理/ 的/ 情况/ 下/ 和/ 我们/ 算法/ 的/ 比较/ ./ 可以/ 看出/ 我们/ 的/ 算法/ 可以/ 使/ 4GB/ 容量/ 的/ PCM/ 内存/ 平均/ 延长/ 3/ 年/ 寿命/ ./ 若/ 不/ 加入/ 减少/ 写/ 操作/ 处理/ ,/ 则/ 该/ 内存/ 只能/ 稳定/ 运行/ 将/ 约/ 2/ 年/ 时间/ ./ 我们/ 的/ 方法/ 可以/ 使该/ 内存/ 延长/ 2.6/ 倍/ 的/ 平均/ 使用寿命/ ./ 5/ 结论/ 新型/ 基于/ 相变/ 存储器/ 的/ 内存/ 不仅/ 会/ 具有/ 低功耗/ 、/ 高集成度/ 等/ 诸多/ 优势/ ,/ 同时/ 也/ 会/ 带来/ 安全性/ 隐患/ ./ 它/ 的/ 非易/ 失性/ 使/ 系统/ 停机/ 后/ ,/ 内存/ 数据/ 不会/ 消失/ ,/ 别有用心/ 的/ 攻击者/ 会/ 分析/ 提取/ 内存/ 中/ 的/ 数据/ ,/ 获得/ 隐私/ 数据/ ./ 本文/ 设计/ 了/ 一个/ 针对/ 相变/ 内存/ 的/ 数据保护/ 方案/ ,/ 主要/ 包括/ 基于/ 计数器/ 的/ 机密/ 单元/ 和/ 减少/ 写/ 操作/ 单元/ ./ 实验/ 表明/ 加入/ 加密/ 操作/ 后/ ,/ 性能/ 下降/ 并不多/ ,/ 同时/ 减少/ 写/ 操作/ 的/ 机制/ 可以/ 有效/ 提高/ PCM/ 的/ 写/ 寿命/ ./ 致谢/ 本文/ 作者/ 得到/ 了/ 清华大学/ 计算机科学/ 与/ 技术/ 系/ 操作系统/ 实验室/ 的/ 老师/ 与/ 同学/ 们/ 的/ 许多/ 帮助/ 和/ 有益/ 建议/ ,/ 在/ 此/ 表示感谢/ !/ 

