Page1/ 一种/ 互联网/ 的/ 稳定/ 路由/ 选择/ 策略/ 李琦/ 徐明伟/ 吴建平/ (/ 清华大学/ 计算机科学/ 与/ 技术/ 系/ 北京/ 100084/ )/ 摘要/ 互联网/ 中/ 网络故障/ 频繁/ ,/ 域间/ 路由/ 协议/ (/ BGP/ )/ 并/ 不能/ 很/ 好/ 地/ 适应/ 网络故障/ ./ 一般/ 情况/ 下/ ,/ 域间/ 路由/ 协议/ 会/ 经历/ 一个/ 比较/ 漫长/ 的/ 路由/ 搜索/ 过程/ ,/ 导致/ 互联网/ 中/ 大量/ 的/ 数据包/ 丢包/ ./ 虽然/ 目前/ 已/ 提出/ 了/ 很多/ 改进/ 的/ BGP/ 算法/ ,/ 但/ 这些/ 算法/ 复杂度/ 非常/ 高/ ,/ 给/ 路由器/ 增加/ 很多/ 额外/ 的/ 计算/ 代价/ ./ 为了/ 解决/ 这个/ 问题/ ,/ 作者/ 提出/ 了/ 一个/ 稳定/ 的/ 域间/ 路由/ 选择/ 算法/ sBGP/ ./ 在/ sBGP/ 中/ ,/ 当/ 路由器/ 收到/ 由/ 故障/ 触发/ 的/ 路由/ 通告/ 后/ ,/ 采用/ 启发式/ 的/ 路由/ 选择/ 算法/ 选择/ 目前/ 可选/ 的/ 最/ 稳定/ 路由/ 为/ 最佳/ 路由/ ./ 通过/ 稳定/ 路由/ 选择/ ,/ 路由器/ 可以/ 选择/ 有效/ 的/ 稳定/ 路由/ ,/ 以/ 避免/ 无效/ 的/ 路由/ 搜索/ 以及/ 路由/ 不断更新/ 引入/ 的/ 路由器/ 处理/ 开销/ ./ 分析/ 和/ 模拟实验/ 表明/ sBGP/ 不仅/ 能够/ 有效/ 提高/ BGP/ 的/ 收敛/ 性能/ ,/ 而且/ 可以/ 减少/ 收敛/ 过程/ 中/ 的/ 通信/ 开销/ ./ 关键词/ 域间/ 路由/ 协议/ ;/ BGP/ ;/ 稳定/ 路由/ 选择/ ;/ sBGP/ ;/ 路由/ 收敛/ 1/ 引言/ 边界/ 网关/ 协议/ BGP/ [/ 1/ ]/ 是/ 互联网/ 域间/ 路由/ 的/ 标准协议/ ./ BGP/ 路由/ 的/ 可用性/ 和/ 稳定性/ 对/ 整个/ 互联网/ 路由/ 有/ 很大/ 的/ 影响/ ./ Labovitz/ 等/ 人/ [/ 2/ ]/ 发现/ 实际/ 网络/ 中/ BGP/ 路由/ 会/ 经历/ 漫长/ 的/ 路由/ 搜索/ 过程/ ./ 互联网/ 上/ 的/ 测量/ 研究/ 表明/ ,/ 80/ %/ 左右/ 的/ 网络故障/ 延时/ 不/ 超过/ 180s/ [/ 3/ -/ 4/ ]/ ./ 然而/ ,/ 这些/ 故障/ 导致/ 的/ 路由/ 失效/ 和/ 无效/ 路由/ 切换/ 导致/ 的/ BGP/ 路由/ 收敛/ 延时/ 会长/ 达/ 几十分/ Page2/ 钟/ [/ 5/ ]/ ./ 无效/ 的/ 路由/ 搜索/ 不仅/ 增加/ 了/ 路由器/ 的/ 处理/ 开销/ ,/ 并且/ 延长/ 了/ 互联网/ 路由/ 中/ 的/ 路由/ 黑洞/ 和/ 回路/ ./ 由此/ 进一步/ 增加/ 了/ 数据包/ 在/ 网络/ 中/ 的/ 传输/ 延时/ 和/ 丢/ 包率/ [/ 6/ ]/ ,/ 并/ 直接/ 影响/ 现有/ 各种/ 互联网/ 实时/ 应用/ 的/ 性能/ [/ 7/ ]/ ./ 在/ BGP/ 中/ ,/ 链路/ 或者/ 设备/ 故障/ 会/ 使/ 网络/ 中/ 一些/ 路由/ 成为/ 无效/ 路由/ ./ 这些/ 无效/ 路由/ 是/ 同一/ 事件/ 引起/ 的/ 相关/ 路由/ ,/ 不会/ 立即/ 从/ 网络/ 中/ 消失/ ./ 路由器/ 不断/ 地/ 在/ 无效/ 路由/ 中/ 搜索/ 最优/ 路由/ 并/ 传播/ ,/ 直到/ 稳定/ 的/ 可靠/ 路由/ 被/ 选择/ 为止/ ./ 路径/ 搜索/ 过程/ 大大增加/ 了/ BGP/ 路由/ 收敛/ 延时/ [/ 8/ ]/ ./ 为了/ 解决/ 这些/ 路由/ 的/ 慢/ 收敛/ 问题/ ,/ 本文/ 提出/ 了/ 一种/ 稳定/ 的/ BGP/ 稳定/ 路由/ 选择/ 算法/ (/ sBGP/ )/ ,/ 利用/ 路由/ 相关性/ 使/ 稳定/ 路由/ 得到/ 更/ 多/ 的/ 机会/ 被选为/ 最优/ 路由/ ,/ 缩短/ 路径/ 搜索/ 过程/ 以/ 改善/ BGP/ 路由/ 收敛/ 性能/ ./ 稳定/ 路由/ 选择/ 机制/ 的/ 基本/ 思想/ 是/ ,/ 记录/ Adj/ -/ RIBs/ -/ IN/ 中/ 每条/ 路由/ 的/ 申明/ 时间/ ,/ 根据/ 多条/ 路由/ 在/ Adj/ -/ RIBs/ -/ IN/ 的/ 时间/ 判断/ 它们/ 的/ 稳定性/ ./ 一旦/ 路由/ 发生变化/ 则/ Adj/ -/ RIBs/ -/ IN/ 中路/ 由/ 计时/ 将/ 被/ 清零/ ./ 当/ 链路/ 发生/ 故障/ 以后/ ,/ 由该/ 故障/ 链路/ 触发/ 的/ 路由/ 更新/ 携带/ 故障/ 源/ 信息/ ./ 当/ 路由器/ 收到/ 路由/ 更新/ ,/ 则/ sBGP/ 将/ 首先/ 判断/ 当前/ 所选/ 的/ 路由/ 是否/ 受/ 故障/ 影响/ ./ 如果/ 其中/ 所选/ 的/ 路由/ 受/ 影响/ ,/ 则/ BGP/ 重新/ 执行/ 路由/ 选择/ ,/ 并/ 选择/ Adj/ -/ RIBs/ -/ IN/ 中/ 最/ 稳定/ 的/ 路由/ ./ 如果/ 路由/ 不/ 受/ 影响/ ,/ 则/ sBGP/ 直接/ 忽略/ 这个/ 由于/ 故障/ 触发/ 的/ 病态/ 路由/ 更新/ 事件/ ./ 于是/ ,/ sBGP/ 在/ 路由/ 选择/ 算法/ 的/ 简单/ 修改/ 不仅/ 改进/ 了/ BGP/ 的/ 收敛/ 性能/ ,/ 而且/ 限制/ 了/ 故障/ 信息/ 传播/ 范围/ 并/ 提高/ 了/ BGP/ 的/ 稳定性/ ./ 目前/ 我们/ 已经/ 在/ 自主/ 研发/ 的/ 虚拟/ 路由器/ [/ 9/ ]/ 中/ 实现/ 了/ sBGP/ 方案/ ,/ 下/ 一步/ 将/ 在/ CERNET2/ 中/ 进行/ 大规模/ 部署/ 以/ 研究/ 和/ 分析/ sBGP/ 在/ 真实/ 互联网/ 中/ 的/ 性能/ ./ 本文/ 第/ 2/ 节/ 介绍/ BGP/ 路由/ 选择/ 策略/ 和/ 问题/ ,/ 包括/ BGP/ 路由/ 传播/ 过程/ 选路/ 问题/ 、/ 由此/ 形成/ 的/ 域间/ 路由/ 收敛/ 问题/ 和/ BGP/ 路由/ 的/ 主要/ 问题/ 以及/ 相关/ 的/ 研究/ 工作/ ;/ 第/ 3/ 节/ 介绍/ sBGP/ 启发式/ 路由/ 选择/ 机制/ 的/ 原理/ ,/ 并/ 给出/ 具体/ 关闭/ 算法/ 以及/ 实例/ 分析/ ;/ 第/ 4/ 节/ 通过/ 模拟实验/ 的/ 结果/ 评价/ 了/ sBGP/ 和/ 相关/ BGP/ 改进/ 方案/ 的/ 性能/ ;/ 最后/ 第/ 5/ 节/ 总结/ 全文/ ./ 2BGP/ 路由/ 选择/ 策略/ 和/ 问题/ 本/ 节/ 首先/ 分析/ BGP/ 路由/ 的/ 基本/ 思想/ 以及/ 存在/ 的/ 问题/ ,/ 接着/ 分析/ 和/ 评价/ 现有/ BGP/ 路由/ 选择/ 的/ 改进/ 方案/ ./ 2.1/ BGP/ 选路/ 问题/ 互联网/ 由/ 不同/ 的/ 自治/ 系统/ (/ AS/ )/ 组成/ ,/ 各个/ 自治/ 系统/ 通过/ BGP/ 协议/ 互联/ ./ BGP/ 路由/ 信息/ 封装/ 在/ BGP/ 的/ 通告/ 消息/ 中/ ,/ 其中/ 包括/ 路由/ 的/ 声明/ 和/ 路由/ 撤销/ 消息/ ./ 当/ 一个/ BGP/ 路由器/ 发现/ 一条/ 新路/ 由/ ,/ 路由/ 声明/ 消息/ 将/ 这条/ 路由/ 传播/ 给/ 邻居/ 路由器/ ./ 这条/ 路由/ 声明/ 消息/ 包括/ 目前/ 网络/ 的/ IP地址/ 前缀/ 以及/ 描述/ 这/ 条/ 路由/ 的/ 属性/ 信息/ ;/ 当/ 一个/ BGP/ 路由器/ 发现/ 到/ 某个/ 目的/ 网络/ 的/ 路由/ 不可/ 用/ ,/ 则/ 向/ 邻居/ 路由器/ 发送/ 路由/ 撤销/ 的/ 通告/ 消息/ ;/ 当/ BGP/ 路由器/ 发生/ 路由/ 改变/ (/ 由于/ 路由/ 策略/ 配置/ 变化/ 或者/ 收到/ 路由/ 变化/ 的/ 通告/ 消息/ )/ ,/ 就/ 向/ 邻居/ 路由器/ 发送/ 路由/ 声明/ 消息/ ,/ 在/ 这种/ 情况/ 下/ 缺省/ 取消/ 前面/ 已/ 使用/ 的/ 路由/ ./ BGP/ 会话/ 分为/ 内部/ 的/ BGP/ 会话/ (/ iBGP/ )/ 以及/ 外部/ 的/ BGP/ 会话/ (/ eBGP/ )/ ./ iBGP/ 仅/ 在/ 一个/ 自治/ 系统/ 中/ 发送/ 路由/ 通告/ 消息/ 以/ 达到/ 自治/ 系统/ 内/ 路由/ 的/ 一致性/ ,/ 而/ eBGP/ 提供/ BGP/ 路由器/ 向/ 其它/ 自治/ 性/ 的/ 邻居/ 路由器/ 发送/ 路由/ 通告/ 消息/ ./ iBGP/ 和/ eBGP/ 会话/ 路由/ 决策/ 过程/ 是/ 相同/ 的/ ,/ 唯一/ 的/ 区别/ 是/ BGP/ 收到/ 的/ iBGP/ 通告/ 消息/ 后/ 决策/ 得到/ 的/ 路由/ 不会/ 继续/ 向/ 自治/ 系统/ 内/ 的/ 其它/ BGP/ 通告/ ./ BGP/ 路由器/ 收到/ BGP/ 通告/ 消息/ 以后/ 将/ 执行/ 的/ 路由/ 选路/ 决策/ 过程/ 如表/ 1/ 所示/ ,/ 即/ 每/ 一个/ 路由器/ 的/ 路由/ 决策/ 结果/ 由/ BGP/ 通告/ 消息/ 中/ 的/ 属性/ 来/ 决定/ ./ 表/ 1/ 中/ 的/ 每/ 一步/ 的/ 计算结果/ 是/ 从前/ 一步/ 的/ 计算结果/ 重新/ 选择/ 获得/ 一个/ 路由/ 的/ 子集合/ ./ 通过/ 增加/ 、/ 修改/ 和/ 过滤/ 通告/ 消息/ 中/ 的/ 属性/ 值/ ,/ 管理员/ 可以/ 控制/ 到达/ 目的/ 网络/ 的/ 路由/ 选择/ 决策/ 过程/ ./ 2.2/ BGP/ 和/ 改进/ BGP/ 方案/ 的/ 问题/ 由于/ 域间/ 路由/ 协议/ BGP/ 的/ 设计/ 原则/ 路径/ 向量/ 路由/ 的/ 特点/ 以及/ 策略/ 配置/ 的/ 灵活性/ [/ 1/ ]/ 导致/ 了/ 整个/ 互联网/ 路由/ 的/ 慢/ 收敛/ 甚至/ 不/ 收敛/ ./ 我们/ 通过/ 采用/ 同步/ 网络/ 模型/ 分析/ B/ -/ 团/ (/ B/ -/ clique4/ )/ 网络/ 的/ 路由/ 收敛/ 过程/ 来/ 分析/ 这些/ 问题/ ./ 如图/ 1/ 所示/ ,/ 由/ 6/ 个/ AS/ 组成/ 全/ 连接/ B/ -/ 团/ 拓扑/ ,/ AS0/ 的/ 网络设备/ 发生/ 故障/ 后/ ,/ 到达/ 目的/ 结点/ 的/ 路由/ 会/ 在/ AS1/ ,/ AS2/ ,/ AS3/ 和/ AS4/ 中/ 经历/ 路径/ 搜索/ 过程/ ./ 在/ 图/ 1/ 中/ ,/ 带/ 下划线/ 的/ 路由/ 表示/ Page3AS/ 当前/ 所/ 选择/ 的/ 最优/ 路由/ ,/ [/ ]/ 表示/ 没有/ 到达/ 目的/ 结点/ 的/ 路由/ ,/ 实线/ 方框/ 中/ 的/ 路由/ 表示/ 该/ AS/ 本轮/ 发送给/ 邻居/ 的/ 路由/ ,/ 没有/ 使用/ 实线/ 方框/ 围起来/ 的/ 表示/ 上/ 一轮/ 发送给/ 邻居/ 的/ 路由/ ,/ w/ 表示/ 发送/ 的/ 是/ 路由/ 取消/ ./ 为了/ 便于/ 分析/ ,/ 本文/ 采用/ 同步/ 网络/ 模型/ 描述/ 到达/ 目的/ 结点/ 的/ 路由/ 的/ 收敛/ 过程/ ./ 同步/ 网络/ 具有/ 3/ 个/ 含义/ :/ (/ 1/ )/ 任意/ AS/ 间/ 的/ 传输/ 延时/ 都/ 是/ 固定值/ ,/ 本文/ 的/ 例子/ 设为/ 1s/ ;/ (/ 2/ )/ 网络/ 中/ 的/ AS/ 同时/ 收到/ 邻居/ 在/ 上/ 一轮/ 发送/ 来/ 的/ 路由/ 消息/ ,/ 选择/ 新/ 的/ 最优/ 路由/ 并/ 传播/ 出去/ ;/ (/ 3/ )/ AS/ 优先选择/ 优先级/ 高/ 的/ 路由/ ./ 图/ 1/ 所示/ BGPAdj/ -/ RIBs/ -/ IN/ 中/ 的/ 路由/ 已/ 按/ 优先级/ 高低/ 排列/ ./ 当/ AS0/ 和/ AS5/ 之间/ 的/ 链路/ 失效/ 以后/ ,/ 在/ t/ =/ 1/ 时刻/ ,/ AS1/ 和/ AS2/ 删除/ 来自/ AS5/ 的/ 所有/ 路由/ ,/ 在/ AS1/ ,/ AS2/ ,/ AS3/ ,/ AS4/ 都/ 存在/ 到达/ 目的/ 地址/ 的/ 路由/ ,/ 路径/ 分别/ 为/ [/ 205/ ]/ ,/ [/ 105/ ]/ ,/ [/ 105/ ]/ ,/ [/ 3105/ ]/ ./ 尽管/ 这/ 3/ 条/ 路由/ 由于/ AS5/ 和/ AS0/ 的/ 链路/ 故障/ 成为/ 无效/ 路由/ ,/ 但是/ AS1/ 和/ AS2/ 都/ 无法/ 知道/ 这个/ 信息/ ./ 于是/ 分别/ 从/ 所/ 选择/ 的/ [/ 205/ ]/ 和/ [/ 105/ ]/ 作为/ 新路/ 由/ ,/ 并/ 发送/ [/ 1205/ ]/ 和/ [/ 2105/ ]/ 给/ 邻居/ ./ 在/ t/ =/ 2/ 时刻/ ,/ 所有/ AS/ 同图/ 1B/ -/ 团/ 拓扑/ 的/ 路由/ 搜索/ 过程/ 一般来说/ ,/ 域间/ 路由/ 协议/ BGP/ 的/ 以下/ 几个/ 问题/ 导致/ 了/ 整个/ 互联网/ 路由/ 的/ 慢/ 收敛/ 甚至/ 不/ 收敛/ :/ (/ 1/ )/ 故障/ 的/ 错误/ 检测/ ./ 在/ BGP/ 协议/ 中/ ,/ 路由器/ 通过/ 基于/ TCP/ 可靠/ 连接/ 的/ Keepalive/ 消息/ 来/ 检测/ 邻居/ 路由器/ ,/ 但是/ TCP/ 会话/ 的/ 异常/ 终止/ 会/ 引起/ BGP/ 路由器/ 不必要/ 的/ 路由/ 重/ 计算/ ./ 这种/ 不必要/ 的/ 路由/ 重时/ 收到/ 邻居/ t/ =/ 1/ 时刻/ 发送/ 过来/ 的/ 路由/ 声明/ ,/ 更新/ 对应/ 的/ Adj/ -/ RIBs/ -/ IN/ 并/ 重新/ 选择/ 路由/ ./ 由于/ 收到/ 的/ 来自/ AS1/ 和/ AS2/ 的/ 路由/ ,/ 收到/ AS1/ 的/ [/ 1205/ ]/ ,/ AS3/ 选择/ [/ 1205/ ]/ 为/ 最优/ 路由/ ,/ 并/ 通告/ 给/ 邻居/ ./ 类似/ 地/ ,/ 当/ t/ =/ 3/ 时刻/ ,/ 当/ 由于/ 收到/ 来自/ AS3/ 和/ AS4/ 的/ 路由/ 形成/ 了/ 回路/ ,/ AS1/ 不再/ 有/ 到达/ 目的/ 地址/ 的/ 路由/ ,/ 向/ 邻居/ 发送/ 路由/ 撤销/ 通告/ ./ 同样/ AS2/ 也/ 检测/ 到/ 回路/ ,/ 撤销/ 路由/ ./ 由于/ AS3/ 先/ 收到/ AS1/ 的/ 路由/ 撤销/ 通告/ ,/ AS3/ 将/ 选择/ [/ 2105/ ]/ ./ 但/ 由于/ 受/ MARI/ 限制/ ,/ AS3/ 不会/ 马上/ 发送/ [/ 32105/ ]/ 给/ 邻居/ ./ 当/ t/ =/ 4/ 时刻/ ,/ AS3/ 在/ MARI/ 时钟/ 超时/ 前/ 收到/ 了/ AS2/ 发送/ 的/ 路由/ 撤销/ 通告/ ./ 同时/ ,/ AS4/ 收到/ AS2/ 的/ 撤销/ 通告/ ,/ 从/ Adj/ -/ RIBs/ -/ IN/ 中/ 删除/ [/ 2105/ ]/ ./ 直到/ t/ =/ 4/ +/ t/ 时刻/ ,/ AS3/ 收到/ AS2/ 的/ 撤销/ 通告/ ,/ 删除/ Adj/ -/ RIBs/ -/ IN/ 中/ 的/ 路由/ ,/ 并/ 发送/ 撤销/ 通告/ 给/ 邻居/ ./ AS4/ 收到/ 路由/ 撤销/ 通告/ ,/ 删除/ Adj/ -/ RIBs/ -/ IN/ 中/ 所有/ 路由/ ,/ 路由/ 收敛/ 过程/ 结束/ ./ 可见/ ,/ 在/ BGP/ 路由/ 收敛/ 的/ 过程/ 中/ ,/ 每个/ AS/ 会/ 在/ 所有/ 邻居/ 的/ Adj/ -/ RIBs/ -/ IN/ 中/ 不断/ 搜索/ 、/ 选择/ 和/ 传播/ 无效/ 路由/ ,/ 直到/ 所有/ AS/ 的/ Adj/ -/ RIBs/ -/ IN/ 中/ 都/ 不再/ 存在/ 任何/ 路由/ ./ 计算/ 会/ 引起/ 全局/ 相关/ BGP/ 路由/ 的/ 重/ 计算/ ,/ 从而/ 导致/ 网络/ 的/ 不/ 稳定/ ./ (/ 2/ )/ 路由/ 计算/ 时间/ 过长/ ./ 不同于/ 域/ 内/ 协议/ ,/ 作为/ 一个/ 路径/ 向量/ 协议/ ,/ BGP/ 协议/ 在/ 路由/ 被/ 取消/ 或/ 路由/ 发生/ 切换/ 时/ 可能/ 会/ 经历/ 时间/ 较长/ 的/ 路径/ 搜索/ 过程/ ,/ 在/ 路由/ 重/ 计算/ 过程/ 中/ ,/ BGP/ 路由器/ 经常/ 选择/ 的/ 一些/ Page4/ 路由/ 可能/ 已/ 不再/ 可用/ ,/ 这样/ 的/ 搜索/ 过程/ 导致/ 了/ 整个/ Internet/ 中/ BGP/ 路由/ 收敛/ 时间/ 过长/ [/ 8/ ]/ ./ (/ 3/ )/ 路由/ 传播/ 时延/ 过长/ ./ BGP/ 协议/ 中/ 的/ 一些/ 改进/ 机制/ 也/ 直接/ 影响/ 到/ BGP/ 中/ 的/ 路由/ 更新/ 传播/ ./ 例如/ ,/ BGP/ 协议/ 中/ 规定/ BGP/ 路由器/ 向/ 其/ 邻居/ 发送/ 到达/ 同一/ 目的/ 网络/ 路由/ 的/ 最小/ 时间/ 间隔/ 值/ 限定/ 为/ 一/ 确定/ 值/ MRAI/ (/ MinimumRouteAdvertisementIn/ -/ terval/ )/ ./ MARI/ 虽然/ 可以/ 在/ 一定/ 程度/ 上/ 减小/ 通信/ 开销/ ,/ 但/ 同时/ 也/ 增加/ 了/ 路由/ 收敛/ 时间/ [/ 8/ ]/ ./ (/ 4/ )/ BGP/ 路由/ 不/ 收敛/ ./ BGP/ 策略/ 设置/ 的/ 灵活性/ 和/ 隐蔽性/ 可能/ 导致/ 路由/ 的/ 不/ 收敛/ ./ 不同/ 的/ AS/ 分别/ 由/ 不同/ 的/ 组织/ 或/ 机构/ 管理/ ,/ 它们/ 根据/ 自身/ 的/ 需要/ 设置/ 不同/ 的/ BGP/ 路由/ 策略/ ,/ 具有/ 很大/ 的/ 灵活性/ ./ 此外/ ,/ 由于/ 出于/ 安全性/ 等/ 方面/ 的/ 考虑/ ,/ 各个/ AS/ 的/ BGP/ 路由/ 策略/ 通常/ 是/ 不/ 对外/ 公开/ 的/ ,/ 具有/ 很强/ 的/ 隐蔽性/ ./ BGP/ 策略/ 的/ 这种/ 特性/ 使得/ 每个/ AS/ 都/ 无法/ 获得/ 全部/ 路由/ 策略信息/ ,/ 不能/ 判断/ 策略/ 冲突/ ,/ 可能/ 最终/ 导致/ 路由/ 的/ 不/ 收敛/ [/ 10/ ]/ ./ 很多/ 改进/ 的/ BGP/ 方案/ 缓解/ 或者/ 解决/ 了/ 上面/ 的/ 4/ 个/ 问题/ ,/ 但是/ 由于/ 这些/ 方案/ 本身/ 设计/ 的/ 缺点/ 并/ 不能/ 实际/ 部署/ ,/ 以/ 有效/ 提高/ BGP/ 收敛/ 性能/ ./ RCN/ [/ 8/ ]/ 和/ EPIC/ [/ 11/ ]/ 通过/ 在/ BGP/ 通告/ 消息/ 中/ 增加/ 路由/ 变化/ 的/ 根源/ 信息/ 以/ 加快/ 路由/ 的/ 收敛/ ,/ 但/ 它们/ 的/ 改进/ 性能/ 在/ 很大/ 程度/ 上/ 依赖于/ 网络/ 的/ 拓扑/ 结构/ ,/ 而且/ 这些/ 方案/ 并/ 不/ 支持/ 增量/ 部署/ ./ CA/ 方案/ [/ 12/ ]/ 通过/ 检测/ 路由/ 通告/ 中/ 的/ 无效/ 路由/ 加快/ 路由/ 收敛/ ,/ 但/ 这个/ 方案/ 给/ 路由器/ 增加/ 了/ 很大/ 的/ 计算/ 负载/ ./ GhostFlushing/ 方案/ [/ 13/ ]/ 通过/ 在/ 通告/ 新路/ 由前/ 撤销/ 旧/ 路由/ 加快/ 路由/ 收敛/ ,/ 但/ 无法/ 避免/ 路由/ 的/ 无效/ 搜索/ 过程/ ./ 此外/ ,/ GhostFlushing/ 方案/ 增加/ 了/ 很多/ BGP/ 通告/ 消息/ ,/ 而且/ 这个/ 方案/ 会/ 恶化/ 故障/ 恢复/ 时/ 的/ 收敛/ 性能/ ./ 由于/ BFD/ 方案/ [/ 14/ ]/ 已经/ 解决/ 了/ BGP/ 协议/ 的/ 故障/ 检测/ 问题/ ,/ 所以/ ,/ 本文/ 将/ 重点/ 解决问题/ 2/ 、/ 3/ 和/ 4.3/ 稳定/ 路由/ 选择/ 本节/ 将/ 介绍/ 稳定/ 路由/ 选择/ 方案/ (/ sBGP/ )/ ./ 路由/ 稳定/ 选择/ 方案/ 将/ 有效/ 避免/ 由于/ 不/ 稳定/ 路由/ 或者/ 无效/ 路由/ 引起/ 的/ 互联网/ 路由/ 的/ 有效性/ 和/ 稳定性/ 问题/ ./ 通过/ 这个/ 方案/ ,/ 路由/ 的/ 有效性/ 和/ 稳定性/ 将/ 大幅度提高/ ./ 首先/ 改进/ 域间/ 路由/ 协议/ (/ StableBGP/ )/ 的/ 基本/ 原则/ ,/ 其次/ 介绍/ 稳定/ 路由/ 选择/ 路由/ 协议/ 的/ 基本/ 算法/ ,/ 最后/ 通过/ 实例/ 分析/ 介绍/ 稳定/ 路由/ 选择/ 的/ 有效性/ ./ 3.1/ 基本/ 思想/ 和/ 原则/ 域间/ 路由/ 协议/ 的/ 目标/ 是/ 确保/ 互联网/ 路由/ 的/ 有效/ 和/ 稳定性/ ,/ 特别/ 在/ 发生/ 网络故障/ 的/ 情况/ 下/ 的/ 路由/ 有效性/ 和/ 稳定性/ ./ 由于/ 域间/ 路由/ 本身/ 的/ 设计/ 原则/ ,/ 路由/ 选择/ 的/ 决策/ 并/ 不/ 准确/ ,/ 短暂/ 的/ 网络故障/ 会/ 导致/ 域间/ 路由/ 的/ 很多/ 问题/ ,/ 例如/ 路由/ 收敛/ 过程/ 中/ 漫长/ 的/ 路由/ 搜索/ 过程/ 以及/ 域间/ 路由/ 的/ 不稳定性/ 问题/ ./ 为了/ 解决/ 这些/ 问题/ ,/ 我们/ 提出/ 一个/ 启发式/ 的/ BGP/ 路由/ 选择/ 算法/ ,/ StableBGP/ (/ sBGP/ )/ ./ 有别于/ 目前/ 的/ BGP/ 协议/ ,/ sBGP/ 的/ 目标/ 是/ 通过/ 稳定/ 路由/ 选择/ 本地化/ 处理/ 路由/ 故障/ ,/ 尽量/ 使/ 路由/ 变化/ 再/ 小/ 范围/ 内/ 发生/ ./ 我们/ 在/ sBGP/ 决策/ 过程/ 中/ 增加/ 了/ 额外/ 的/ 两个/ 路由/ 选择/ ,/ 即/ 选择/ 目前/ 可用/ 路由/ 和/ 选择/ 运行/ 时间/ 最长/ 的/ 路由/ ./ 表/ 2/ 所示/ sBGP/ 的/ 路由/ 选择/ 决策/ 过程/ ./ 表中/ 步骤/ 1/ 和/ 步骤/ 2/ 是/ sBGP/ 路由/ 的/ 核心/ 过程/ ./ 选择/ 最佳/ 的/ 路由/ 的/ 第/ 1/ 个/ 步骤/ 是/ 优先选择/ 目前/ 可用/ 的/ 路由/ 避免/ 了/ 不必要/ 的/ 路由/ 重/ 计算/ 过程/ ./ 由于/ 收到/ 一个/ 新路/ 由/ 通告/ 消息/ 可能/ 是/ 由于/ 旧/ 路由/ 无效/ 的/ 事件/ 触发/ ,/ 所以/ 在/ 路由器/ 通告/ 中/ 增加/ 一个/ 属性/ 来/ 标识/ 路由/ 变化/ 的/ 事件/ 源/ ./ 第/ 2/ 个/ 步骤/ 选择/ 运行/ 时间/ 最长/ 的/ 路由/ ,/ 确保/ sBGP/ 选择/ 最/ 稳定/ 的/ 路由/ 以/ 减少/ 由于/ 不/ 稳定/ 路由/ 导致/ 的/ 路由/ 不/ 稳定/ 情况/ ./ 由于/ 目前/ 的/ 主流/ 路由器/ ,/ 例如/ Cisco/ 路由器/ ,/ 已经/ 在/ Adj/ -/ RIBs/ -/ IN/ 中/ 标识/ 了/ 已选/ 的/ 最佳/ 路由/ 以及/ 记录/ 了/ 每条/ 路由/ 的/ 达到/ 时间/ ,/ 所以/ sBGP/ 没有/ 增加/ 改进/ 路由/ 选择/ 的/ 实现/ 复杂度/ ./ 需要/ 注意/ 的/ 是/ ,/ 在/ sBGP/ 中/ ,/ 路由器/ 缺省/ 将/ 采用/ 初始/ BGP/ 的/ 路由/ 决策/ 过程/ ,/ 而/ 启发式/ 路由/ 选择/ 仅/ 在/ 路由/ 发生变化/ 时/ 执行/ ./ 这种/ 启发式/ 的/ 路由/ 决策/ 过程/ 保留/ 了/ 原始/ BGP/ 路由/ 的/ 所有/ 特征/ ,/ 例如/ 确保/ 基于/ 路由/ 策略/ 的/ 路由/ 优先选择/ ./ 通过/ 这种/ 方式/ 可以/ 在/ 保证/ 管理员/ 策略/ 配置/ 有效/ 的/ 情况/ 下/ 提供/ 域间/ 路由/ 的/ 有效性/ ./ 3.2/ sBGP/ 的/ 路由/ 选择/ 算法/ 与/ 传统/ 的/ BGP/ 协议/ 不同/ ,/ sBGP/ 不是/ 仅仅/ 在/ Page5BGP/ 通告/ 消息/ 标识/ 路由/ 变化/ 的/ 事件/ 源/ ,/ 它/ 提供/ 的/ 启发式/ 的/ 路由/ 决策/ 过程/ 选择/ 最/ 稳定/ 路由/ ./ 由于/ sBGP/ 能够/ 准确/ 识别/ 可选/ 的/ 最/ 稳定/ 路由/ ,/ 有效/ 避免/ 了/ BGP/ 不断/ 地/ 选择/ 无效/ 路由/ ,/ 从而/ 确保/ 了域/ 间/ 路由/ 选择/ 的/ 稳定性/ 和/ 有效性/ ./ 在/ sBGP/ 协议/ 的/ 设计/ 中/ ,/ 我们/ 的/ 目标/ 是/ 解决/ BGP/ 的/ 路径/ 搜索/ 时间/ 长/ 、/ 路由/ 的/ 传播/ 时间/ 长/ 以及/ 路由/ 策略/ 导致/ 的/ 路由/ 不/ 收敛/ 问题/ ①/ ./ 表/ 2/ 中/ 的/ 步骤/ 1/ 和/ 步骤/ 2/ 分别/ 是/ 实现/ sBGP/ 稳定/ 路由/ 选择/ 的/ 核心/ ,/ 解决/ 了/ 目前/ BGP/ 路由/ 的/ 问题/ ./ 具体来说/ ,/ 路由/ 决策/ 过程/ 中/ 的/ 这/ 两个/ 步骤/ 通过/ 识别/ 路由/ 变化/ 的/ 故障/ 源/ 以及/ 所有/ 不/ 稳定/ 的/ 路由/ 以/ 实现/ 稳定/ 路由/ 选择/ 的/ 决策/ ./ sBGP/ 通过/ 识别/ 路由/ 变化/ 的/ 故障/ 源/ ,/ 避免/ 了/ 路由器/ 收到/ 撤销/ 消息/ 后/ 搜索/ 无效/ 的/ 路由/ ,/ 所以/ 避免/ 了/ 漫长/ 的/ 路由/ 搜索/ 时间/ ./ sBGP/ 路由器/ 只有/ 在/ 当前/ 路由/ 无效/ 的/ 时候/ 才/ 会/ 进行/ 路由/ 的/ 重新/ 决策/ ,/ 因此/ sBGP/ 路由器/ 每次/ 声明/ 出来/ 的/ 路由/ 总是/ 当前/ 路由/ 中/ 最/ 稳定/ 的/ ,/ 有效/ 避免/ 了/ 路由/ 的/ 反复/ 声明/ 而/ 引起/ 的/ 路由/ 抑制/ ./ 类似/ 地/ ,/ 由于/ sBGP/ 路由器/ 只有/ 当/ 当前/ 路由/ 不可/ 用时/ 进行/ 路由/ 重新/ 决策/ ,/ 而/ 决策/ 过程/ 中仅/ 选择/ 自己/ 可选/ 的/ 最/ 稳定/ 路由/ ,/ 因此/ sBGP/ 不会/ 出现/ 由于/ 路由/ 策略/ 问题/ 而/ 导致/ 的/ 路由/ 不/ 收敛/ 问题/ ./ 在/ sBGP/ 路由/ 决策/ 步骤/ 2/ 中/ ,/ 如果/ 路由/ 的/ 有效/ 时间/ 小于/ τ/ ,/ 则/ 采用/ 收到/ 的/ 新/ 申明/ 路由/ ./ 我们/ 通过/ τ/ 来/ 进行/ 稳定/ 路由/ 选择/ 的/ 判断/ ./ 具体/ 算法/ 如/ 算法/ 1/ 所示/ ,/ 我们/ 首先/ 选择/ 路由/ 运行/ 时间/ 最长/ 的/ 路由/ ,/ 而且/ 该/ 路由/ 的/ 有效/ 时间/ 超过/ 了/ τ/ ./ 如果/ 目前/ 所有/ 路由/ 的/ 有效/ 时间/ 都/ 没有/ 超过/ τ/ ,/ 则/ 选择/ 收到/ 的/ 新/ 声明/ 的/ 路由/ ,/ 这时/ 所/ 选择/ 的/ 路由/ 也/ 是/ 稳定/ 的/ 路由/ ./ 这个/ 原则/ 也/ 是/ BGP/ 的/ 稳定/ 路由/ 的/ 选择/ 策略/ ,/ 因为/ sBGP/ 有/ 以下/ 的/ 定理/ ./ 算法/ 1/ ./ sBGP/ 路由/ 决策/ 算法/ ./ avail/ (/ r/ )/ :/ returntheavailabletimeofroutercontains/ (/ u/ ,/ v/ )/ :/ returniftheroutecontainsthefailedlink/ 输入/ :/ Routeriswithdrawnorreplaced/ ,/ whichis/ 图/ 2sBGP/ 在/ B/ -/ 团/ 拓扑/ 中/ 的/ 收敛/ 过程/ 输出/ :/ thebestrouter1/ ./ // // ASdeterminesthecurrentrouter/ / isimpacted2/ ./ Ifr/ / ./ contains/ (/ u/ ,/ v/ )/ =/ =/ FALSEThen3/ ./ return/ ;/ 4/ ./ Else/ // // ASneedstorecomputedthebestrouters5/ ./ chooserinRIB/ -/ INwiththelongestavailable6/ ./ while/ (/ r/ !/ =/ null/ )/ {/ 7/ ./ Ifr/ ./ contains/ (/ u/ ,/ v/ )/ =/ =/ FALSEThen8/ ./ r/ =/ r/ ;/ 9/ ./ break/ ;/ 10/ ./ Else11/ ./ re/ -/ chooserinRIB/ -/ INwiththesub/ -/ longest12/ ./ Endif13/ ./ }/ 14/ ./ If/ (/ avail/ (/ r/ )/ </ τ/ )/ Then15/ ./ // // AvailabletimeofallroutesinRIB/ -/ Inisless16/ ./ IfexistsannouncedrouterThen17/ ./ selecttheannouncedrouter/ ;/ 18/ ./ Endif19/ ./ Endif20/ ./ Endif/ 定理/ 1/ ./ 在/ sBGP/ 中/ ,/ 由于/ 新/ 申明/ 的/ 路由/ 是/ 邻居/ 路由器/ 采用/ 的/ 最长/ 时间/ 的/ 可用/ 路由/ ,/ 所以/ 当/ 本地/ 无/ 可用/ 稳定/ 路由/ 时/ 选择/ 收到/ 的/ 申明/ 路由/ 也/ 是/ 一种/ 稳定/ 路由/ 的/ 选择/ 策略/ ./ 在/ sBGP/ 中当/ AS/ 收到/ 上层/ AS/ 所选/ 的/ 稳定/ 路由/ ,/ 则/ 说明/ 这/ 条/ 路由/ 在/ 网络/ 中/ 的/ 稳定/ 时间/ 已经/ 大于/ τ/ ./ 所以/ ,/ 当/ 路由/ 发生/ 改变/ 而/ 当/ 本地/ 无可/ 选/ 的/ 稳定/ 路由/ 时/ (/ 即/ 路由/ 有效/ 时间/ 大于/ τ/ )/ ,/ sBGP/ 可以/ 选择/ 上层/ AS/ 所/ 选择/ 的/ 稳定/ 路由/ 作为/ 自己/ 的/ 稳定/ 路由/ ./ 这个/ 定理/ 比较简单/ ,/ 详细/ 的/ 证明/ 在/ 本文/ 中/ 省略/ ./ 3.3/ sBGP/ 实例/ 分析/ 为了/ 便于/ 与/ 传统/ 的/ BGP/ 比较/ 和/ 分析/ ,/ 我们/ 同样/ 采用/ 同步/ 网络/ 模型/ 来/ 分析/ sBGP/ 的/ 性能/ ./ 如图/ 2/ 所/ ①/ 本文/ 仅/ 关注/ 路由/ 发生变化/ 以后/ 导致/ 的/ 路由/ 不/ 收敛/ 问题/ ./ Page6/ 示/ ,/ AS5/ 和/ AS0/ 的/ 链路/ 失效/ ,/ AS0/ 发布/ 给/ AS1/ 和/ AS2/ 路由/ 撤销/ 路由/ 通告/ ./ 由于/ 撤销/ 通告/ 包含/ 了/ 故障/ 链路/ 信息/ ,/ AS1/ 和/ AS2/ 会/ 选择/ 一个/ 不/ 受/ 故障/ 影响/ 的/ 路由/ ./ 但是/ ,/ 由于/ AS1/ 和/ AS2/ 中/ 不/ 存在/ 可用/ 路由/ ,/ 所以/ 它们/ 在/ t/ =/ 1/ 时刻/ 分别/ 发布/ 带有/ 链路/ 故障/ 信息/ 的/ 路由/ 撤销/ ./ t/ =/ 2/ 时刻/ ,/ AS3/ 和/ AS4/ 分别/ 收到/ 来自/ AS1/ 和/ AS2/ 的/ 路由/ 撤销/ ./ 同样/ ,/ 由于/ AS3/ 和/ AS4/ 均/ 无/ 可用/ 的/ 稳定/ 路由/ ./ 到/ t/ =/ 3/ 时刻/ ,/ 所有/ AS/ 删除/ 所有/ 故障/ 路由/ ,/ 达到/ 稳定/ 状态/ ./ 与/ 传统/ 的/ BGP/ 相比/ (/ 如图/ 1/ 所示/ )/ ,/ sBGP/ 在/ 这个/ 拓扑/ 中/ 缩短/ 了/ 2/ +/ t/ 的/ 收敛/ 时间/ ./ 在/ 发生/ 故障/ 后/ sBGP/ 采用/ 稳定/ 路由/ 选择/ 策略/ ,/ 可以/ 有效/ 避免/ 由于/ 故障/ 导致/ 的/ 路由/ 不/ 收敛/ 问题/ ./ 我们/ 采用/ 文献/ [/ 10/ ]/ 中/ 的/ 拓扑/ 和/ 策略/ 配置/ 实例/ 进行/ 分析/ 和/ 比较/ ./ 如图/ 3/ 所示/ ,/ 如果/ AS0/ 和/ AS4/ 链路/ 发生/ 故障/ ,/ 传统/ 的/ BGP/ 选择/ 路由/ 会/ 导致/ 各个/ AS/ 将/ 处在/ 不断/ 在/ Adj/ -/ RIBs/ -/ IN/ 中/ 选择/ 路由/ 而/ 导致/ 路由/ 不/ 收敛/ [/ 10/ ]/ ./ sBGP/ 很/ 好地解决/ 了/ 这个/ 问题/ ./ 当/ 链路/ 发生/ 故障/ 以后/ ,/ t/ =/ 2/ 时刻/ AS2/ 和/ AS3/ 分别/ 收到/ 新/ 的/ 路由/ 通告/ 以后/ ,/ 由于/ 当前/ 路由/ 不/ 受/ 故障/ 影响/ ./ AS2/ 和/ AS3/ 路由/ 不/ 受/ 变化/ ,/ 此时/ 路由/ 收敛/ ./ 3.4/ sBGP/ 讨论/ sBGP/ 在/ 选择/ 稳定/ 路由/ 的/ 过程/ 中/ 提供/ 了/ 路由/ 的/ 可用性/ ./ 由于/ 所/ 选择/ 的/ 是/ 稳定/ 路由/ ,/ sBGP/ 极大/ 地/ 减少/ 了/ 路由/ 变化/ 次数/ ,/ 消除/ 了/ 路由/ 收敛/ 过程/ 中/ 的/ 无效/ 路由/ 搜索/ ,/ 提高/ 了/ 路由/ 的/ 稳定性/ ./ 路由/ 重/ 计算/ 仅/ 在/ 当前/ 所/ 选/ 路由/ 受/ 故障/ 影响/ 的/ 路由器/ 中/ 进行/ ,/ 所以/ 路由/ 故障/ 信息/ 只/ 在/ 有限/ 结点/ 中/ 传播/ ,/ 解决/ 了/ 路由/ 传播/ 时间/ 过长/ 的/ 问题/ ;/ 在/ Adj/ -/ RIBs/ -/ IN/ 中/ 不/ 存在/ 两个/ 具有/ 相同/ 稳定性/ 的/ 路由/ ,/ 所以/ sBGP/ 解决/ 了/ 路由/ 故障/ 发生/ 后/ 的/ 不/ 收敛/ 问题/ ./ 此外/ ,/ sBGP/ 可以/ 灵活/ 支持/ 增量/ 部署/ ,/ 解决/ 了/ BGP/ 改进/ 方案/ 的/ 部署/ 复杂性/ 问题/ ./ 但是/ ,/ sBGP/ 可能/ 会/ 引入/ 路径/ 长度/ 延长/ 以及/ 选择/ 非/ 最优/ 路由/ 问题/ ./ 现有/ 研究/ 表明/ 80/ %/ 左右/ 的/ 网络故障/ 都/ 是/ 短暂/ 的/ ,/ 一般/ 故障/ 延时/ 都/ 小于/ 180s/ [/ 3/ -/ 4/ ]/ ./ sBGP/ 会/ 在/ 发生/ 这些/ 故障/ 时/ 快速/ 找到/ 有效/ 路径/ 从而/ 有效/ 避免/ 无效/ 路由/ 的/ 搜索/ 以及/ 路由/ 黑洞/ 和/ 回路/ ./ 然而/ ,/ 当/ 发生/ 网络故障/ 以后/ ,/ sBGP/ 可能/ 会/ 选择/ 一些/ ISP/ 中/ 设置/ 低优先级/ 的/ 路由/ ./ 我们/ 认为/ 从/ 保证/ 全局/ 路由/ 可用性/ 和/ 稳定性/ 的/ 角度/ 来看/ ,/ sBGP/ 取得/ 了/ 比较/ 好/ 的/ 折中/ 方案/ ./ 特别/ 当/ 故障/ 发生/ 后/ 出现/ 路由/ 不/ 收敛/ 的/ 时候/ ,/ sBGP/ 可以/ 选择/ 稳定/ 路由/ 来/ 中止/ 路由/ 不/ 收敛/ ./ sBGP/ 中/ 还/ 实现/ 了/ 恢复正常/ 路由/ 选择/ 机制/ ./ sBGP/ 在/ 选择/ 稳定/ 路由/ 后/ 启动/ 一个/ 稳定/ 选择/ 计时器/ ./ 如果/ 路由/ 在/ 计时器/ 超时/ 时间/ 内/ 不/ 发生变化/ ,/ 则/ 计时器/ 超时/ 后/ 路由器/ 将/ 重新/ 启用/ 传统/ 的/ 路由/ 选择/ 算法/ ./ 如果/ 计时器/ 超时/ 之前/ 路由/ 发生/ 了/ 变化/ ,/ 则/ 计时器/ 重新启动/ ./ 4/ 性能/ 分析/ 4.1/ 实验/ 环境/ 和/ 设置/ 为了/ 评价/ sBGP/ 的/ 性能/ ,/ 我们/ 在/ 模拟/ 软件/ SSFNet/ ①/ 的/ BGP/ 代码/ 里/ 实现/ 了/ sBGP/ ./ 实验/ 中/ 使用/ 了/ 简单/ 网络拓扑/ 和/ 由/ SSFNet/ 提供/ 的/ 真实/ 互联网/ 拓扑/ ./ 简单/ 拓扑/ 分别/ 使用/ 了/ 包含/ 15/ 个/ AS/ 的/ 二叉树/ 拓扑/ ,/ 5/ 个/ AS/ 的/ 环/ 拓扑/ ,/ 32/ 个/ AS/ 的/ B/ -/ 团/ 拓扑/ ,/ 5/ 个/ AS/ 的/ 线/ 拓扑/ ,/ 6/ 个/ AS/ 的/ 团/ 拓扑/ 和/ 16/ 个/ AS/ 的/ 网格/ 拓扑/ 等/ 几种/ 典型/ 的/ 拓扑/ ./ 真实/ 的/ 互联网/ 拓扑/ 采用/ 了/ 包含/ 6/ 个/ AS/ ,/ 29/ 个/ AS/ ,/ 110/ 个/ AS/ 以及/ 208/ 个/ AS/ 的/ 拓扑/ ,/ 其中/ 后面/ 3/ 个/ 拓扑/ 是/ 根据/ 真实/ 互联网/ 中路/ 由/ 信息/ 提出/ 构造/ [/ 9/ ]/ ./ 在/ 路由/ 模拟/ 中/ ,/ 每个/ AS/ 都/ 通告/ 各自/ 的/ 前缀/ 信息/ ./ 由于/ GhostFlushing/ 方案/ [/ 13/ ]/ 和/ ConsistencyAssertions/ 方案/ [/ 12/ ]/ 无法/ 有效/ 避免/ 无效/ 路径/ 的/ 搜索/ ,/ 所以/ 本文/ 将/ 不/ 对/ 这/ 两类/ 方案/ 进行/ 分析/ 和/ 评价/ ./ 在/ 不同/ 的/ 拓扑/ 上/ 分别/ 对/ 传统/ BGP/ ,/ RCN/ 方案/ [/ 8/ ,/ 11/ ]/ 以及/ sBGP/ 进行/ 了/ 模拟/ ,/ 并/ 分析/ 和/ 评价/ 不同/ 方案/ 的/ 收敛/ 时间/ 以及/ 更新/ 消息/ 数量/ ./ 4.2/ 性能/ 评价/ 首先/ ,/ 为了/ 分析/ 稳定/ 路由/ 的/ 性能/ 我们/ 分别/ 用/ 不同/ τ/ 取值/ 在/ 32/ 个/ AS/ 的/ B/ -/ 团/ 拓扑/ 和/ 110/ 个/ AS/ 的/ 真实/ 拓扑/ 进行/ 模拟/ ./ 由于/ 模拟/ 环境/ 无法/ 准确/ 刻画/ 互联网/ 的/ 故障/ 特性/ ,/ 因而/ 无法/ 准确/ 学习/ 到/ τ/ 的/ 最优/ 取值/ ./ 如图/ 4/ 所示/ ,/ 在/ 简单/ 拓扑/ 和/ 真实/ 拓扑/ 中/ 分别/ 只有/ 一个/ 故障/ 的/ 性能/ 受/ τ/ 的/ 设置/ 影响/ ,/ 但/ 收敛/ 时间/ ①/ TheSSFnetproject/ ./ http/ :/ // // www/ ./ ssfnet/ ./ org/ // homepage/ ./ Page7/ 的/ 影响/ 仅/ 在/ 1/ %/ 以内/ ./ 这是/ 由于/ 发生/ 故障/ 以后/ ,/ 在/ Adj/ -/ RIBs/ -/ IN/ 中/ 所有/ 的/ 稳定/ 路由/ 比较/ 多/ ./ 因此/ ,/ 根据/ 模拟实验/ 可知/ τ/ 的/ 选取/ 对/ sBGP/ 收敛/ 性能/ 影响/ 不大/ ./ 在/ 本文/ 的/ 实验/ 中/ ,/ 我们/ 取/ τ/ 为/ 45s/ ./ 图/ 4/ 不同/ 延迟/ 参数/ τ/ 对/ BGP/ 收敛/ 性能/ 的/ 影响/ 图/ 5/ 分别/ 对/ 不同/ 的/ 简单/ 拓扑/ 的/ 收敛性/ 和/ 更新/ 消息/ 数量/ 进行/ 分/ 模拟/ ./ 如图/ 5/ (/ a/ )/ 所示/ ,/ RCN/ 和/ sBGP/ 在/ B/ -/ 团/ 的/ 拓扑/ 中/ 消除/ 了/ 无效/ 路径/ 搜索/ ,/ 收敛/ 时间/ 分别/ 改进/ 了/ 96/ %/ 和/ 94/ %/ ./ 在/ 网格/ 拓扑/ 中/ ,/ 由于/ 故障/ 链路/ 没有/ 引入/ 无效/ 搜索/ ,/ RCN/ 获得/ 了/ 和/ 传统/ BGP/ 同样/ 的/ 性能/ ./ 但/ sBGP/ 有效/ 消除/ 了/ 无效/ 的/ 路由/ 计算/ ,/ 因此/ 改进/ 了/ 21/ %/ 的/ 收敛/ 性能/ ./ 其它/ 拓扑/ 中/ 不/ 存在/ 无效/ 路由/ ,/ 而且/ 拓扑/ 中/ 不/ 存在/ 很多/ 有效/ 的/ 路由/ ,/ 因此/ RCN/ 、/ sBGP/ 以及/ 传统/ BGP/ 的/ 收敛/ 性能/ 类似/ ./ 图/ 5/ (/ b/ )/ 为/ 各个/ 拓扑/ 的/ 更新/ 数量/ ,/ B/ -/ 团/ 拓扑/ 中/ ,/ RCN/ 和/ sBGP/ 都/ 减少/ 了/ 75/ %/ 和/ 的/ 消息/ 数量/ ./ 其它/ 拓扑/ 中/ ,/ 3/ 种/ 方案/ 的/ 更新/ 数量/ 类似/ ./ 图/ 6/ 显示/ 了/ 不同/ 网络/ 规模/ 的/ 性能/ ./ 在/ 6/ 个/ AS/ 和/ 29/ 个/ AS/ 的/ 拓扑/ 中/ 没有/ 很多/ 可选/ 的/ 稳定/ 路由/ ,/ RCN/ 、/ sBGP/ 和/ 传统/ BGP/ 的/ 性能/ 是/ 类似/ 的/ ./ 但/ 随着/ 网络/ 规模/ 的/ 变大/ ,/ sBGP/ 的/ 收敛/ 性能/ 改进/ 越多/ ./ 例如/ ,/ 在/ 110/ 个/ AS/ 和/ 208/ 个/ AS/ 的/ 网络拓扑/ 中/ ,/ sBGP/ 获得/ 了/ 比较/ 好/ 的/ 性能/ 改进/ ./ RCN/ 获得/ 了/ 传统/ BGP/ 类似/ 的/ 性能/ ,/ 这是/ 由于/ 故障/ 的/ 链路/ 并部/ 没有/ 引入/ 大量/ 的/ 无效/ 路由/ 搜索/ ./ 在/ 110/ 个/ AS/ 的/ 拓扑/ 中/ ,/ 与/ RCN/ 和/ 传统/ BGP/ 相比/ ,/ sBGP/ 的/ 收敛/ 性能/ 分别/ 改进/ 了/ 77/ %/ 和/ 79/ %/ ,/ 更新/ 消息/ 数/ 分别/ 减少/ 了/ 1/ %/ 和/ 31/ %/ ./ 在/ 208/ 个/ AS/ 的/ 拓扑/ 中/ ,/ sBGP/ 改进/ 了/ 大约/ 64/ %/ 的/ 收敛/ 时间/ 以及/ 减少/ 了/ 34/ %/ 的/ 更新/ 消息/ 数量/ ./ 由此/ 可以/ 看出/ ,/ sBGP/ 随着/ 网络/ 规模/ 的/ 增加/ ,/ 性能/ 改进/ 的/ 效果/ 越好/ ./ 因此/ ,/ sBGP/ 能够/ 提高/ 现有/ 互联网/ 路由/ 性能/ 应对/ 网络故障/ 并/ 提高/ 收敛/ 性能/ ./ 5/ 结束语/ BGP/ 路由/ 慢/ 收敛/ 问题/ 直接/ 影响/ 互联网/ 路由/ 的/ 性能/ ./ 本文/ 提出/ 了/ 稳定/ 路由/ 选择/ (/ sBGP/ )/ 的/ 算法/ 以改/ Page8/ 善/ BGP/ 路由/ 收敛/ ./ 首先/ 检测/ 了/ 算法/ 路由/ 的/ 有效性/ ./ 只有/ 当/ 目前/ 所/ 选/ 路由/ 受/ 故障/ 影响/ ,/ sBGP/ 才/ 会/ 重新/ 选择/ 路由/ ./ 不同于/ 传统/ 的/ BGP/ ,/ sBGP/ 选择/ 可选/ 的/ 最/ 稳定/ 路由/ 作为/ 最佳/ 选择/ ./ 模型/ 分析/ 和/ 模拟实验/ 结果表明/ sBGP/ 能够/ 大大缩短/ BGP/ 路由/ 收敛/ 时间/ 并且/ 有效/ 减少/ 收敛/ 过程/ 中/ 的/ BGP/ 路由/ 更新/ 消息/ 数量/ ./ 目前/ 我们/ 已经/ 在/ 自主/ 研发/ 的/ 虚拟/ 路由器/ 中/ 实现/ 了/ sBGP/ 方案/ ,/ 下/ 一步/ 将/ 在/ CERNET2/ 中/ 进行/ 大规模/ 部署/ 以/ 研究/ 和/ 分析/ sBGP/ 在/ 真实/ 互联网/ 中/ 的/ 性能/ ./ 

