Page1/ 形状/ 图/ 理论/ 的/ 定理/ 证明/ 张昱/ 陈意云/ 李兆鹏/ (/ 中国/ 科学技术/ 大学/ 计算机科学/ 与/ 技术/ 学院/ 合肥/ 230026/ )/ (/ 中国/ 科学技术/ 大学/ 苏州/ 研究院/ 软件/ 安全/ 实验室/ 江苏/ 苏州/ 215123/ )/ 摘要/ 验证/ 操作/ 易变/ 数据结构/ 的/ 指针/ 程序/ 仍/ 面临/ 很多/ 挑战/ ./ 数据结构/ 中/ 严重/ 的/ 指针/ 别名/ 显著/ 地/ 复杂化/ 对/ 操作/ 这些/ 结构/ 的/ 程序/ 的/ 推理/ ./ 为/ 分析/ 和/ 验证/ 操作/ 易变/ 数据结构/ 的/ 指针/ 程序/ ,/ 文中/ 提出/ 了/ 形状/ 图/ 逻辑/ ./ 形状/ 图是/ 描述/ 程序/ 中/ 静态/ 声明/ 的/ 堆/ 指针/ 变量/ 和/ 动态分配/ 的/ 结构/ 体中/ 指针/ 域/ 变量/ 的/ 指向/ 的/ 一种/ 有向图/ ,/ 能/ 准确/ 表达/ 指针/ 的/ 有效性/ 和/ 指针/ 之间/ 的/ 相等/ 性/ ,/ 可/ 用于/ 判断/ 两个/ 访问/ 表达式/ 是否是/ 别名/ ./ 形状/ 图/ 逻辑/ 是/ Hoare/ 逻辑/ 的/ 一种/ 扩展/ ,/ 是/ 一种/ 直接/ 将/ 形状/ 图/ 作为/ 程序/ 中/ 指针/ 断言/ 集/ 的/ 程序逻辑/ ./ 该文/ 研究/ 形状/ 图/ 的/ 等价/ 理论/ 和/ 蕴含/ 理论/ 以及/ 它们/ 的/ 判定/ 方法/ 和/ 应用/ ./ 首先/ ,/ 把/ 形状/ 图/ 及其/ 等价/ 规则/ 和/ 蕴含/ 规则/ 分别/ 类比/ 为/ 代数/ 项/ 及其/ 等式/ 规则/ 和/ 重写/ 规则/ ,/ 像/ 研究/ 代数/ 规范/ 的/ 理论/ 那样/ 来/ 研究/ 形状/ 图/ 理论/ ./ 该文/ 定义/ 了/ 形状/ 图/ 的/ 语法/ 理论/ 和/ 语义/ 理论/ ,/ 定义/ 了/ 形状/ 图/ 重写/ 系统/ 及其/ 终止/ 性/ 、/ 局部/ 合流/ 性/ 和/ 合流/ 性/ ,/ 然后/ 得到/ 基于/ 形状/ 图/ 重写/ 的/ 形状/ 图/ 等价/ 判定/ 和/ 蕴含/ 判定/ 的/ 方法/ ./ 其次/ ,/ 提出/ 循环/ 不变/ 形状/ 图/ 和/ 递归函数/ 前后/ 形状/ 图/ 的/ 自动/ 推断/ 方法/ ./ 借助/ 形状/ 图/ 理论/ 的/ 判定/ 方法/ ,/ 该文/ 把/ 一个/ 基于/ 抽象/ 解释/ 的/ 推断/ 循环/ 不变式/ 的/ 一般/ 方法/ 改编/ 成/ 推断/ 循环/ 不变/ 形状/ 图/ 的/ 方法/ ./ 由于/ 计算/ 终止/ 的/ 递归函数/ 总有/ 非/ 递归/ 的/ 出口/ ,/ 可以/ 先/ 通过/ 非/ 递归/ 路径/ 得到/ 函数/ 的/ 后/ 形状/ 图/ 的/ 初值/ ,/ 然后/ 再/ 在/ 递归/ 路径/ 上/ 迭代/ 求解/ ./ 从而/ ,/ 可以/ 像/ 推断/ 循环/ 不变/ 形状/ 图/ 那样/ 来/ 推断/ 递归函数/ 的/ 前后/ 形状/ 图/ ./ 第三/ ,/ 参照/ Nelson/ -/ Oppen/ 框架/ ,/ 提出/ 形状/ 图/ 理论/ 和/ 整数/ 理论/ 组合/ 的/ 一种/ 判定/ 方法/ ./ 对/ 易变/ 数据结构/ ,/ 除了/ 关心/ 数据结构/ 各/ 节点/ 是否/ 连成/ 预定/ 的/ 形状/ 外/ ,/ 往往/ 还/ 关心/ 数据/ 在/ 这些/ 节点/ 间/ 的/ 排列/ 等/ 特性/ ,/ 它们/ 不能/ 脱离/ 易变/ 数据结构/ 的/ 形状/ 特征/ 而/ 单独/ 验证/ ./ 为此/ ,/ 所/ 提出/ 的/ 组合/ 判定/ 方法/ 针对/ 这/ 类/ 程序/ 的/ 验证/ 条件/ 的/ 特点/ ,/ 利用/ 程序/ 分析阶段/ 得到/ 的/ 形状/ 图对/ 验证/ 条件/ 的/ 前件/ 中/ 的/ 符号/ 断言/ 按/ 形状/ 图/ 的/ 节点/ 分组/ ;/ 然后/ 运用/ 整数/ 理论/ 为/ 各/ 节点/ 推导/ 出/ 尽可能/ 多/ 的/ 性质/ ;/ 最后/ 才/ 交由/ 定理/ 证明/ 器/ Z3/ 去/ 自动/ 验证/ ./ 这种/ 方式/ 有效/ 地/ 避免/ 验证/ 条件/ 证明/ 过程/ 的/ 不/ 终止/ ./ 基于/ 形状/ 图/ 逻辑/ 以及/ 文中/ 的/ 工作/ ,/ 我们/ 所/ 开发/ 的/ 程序验证/ 系统/ 原型/ 减轻/ 了/ 自动/ 定理/ 证明/ 器/ 的/ 负担/ ,/ 并且/ 能/ 验证/ 易变/ 数据结构/ 上/ 较为/ 复杂/ 的/ 程序/ ,/ 如/ 有序/ 循环/ 双向/ 链表/ 、/ 二叉/ 排序/ 树/ 、/ 伸展/ 树/ 、/ 树堆/ 、/ 二叉/ 平衡/ 树/ 和/ AA/ 树/ 的/ 插入/ 和/ 删除/ 函数/ ./ 关键词/ 形状/ 图/ 逻辑/ ;/ 形状/ 分析/ ;/ 程序验证/ ;/ 自动/ 定理/ 证明/ ;/ 循环/ 不变式/ 的/ 推断/ 1/ 引言/ 形式/ 验证/ (/ 包括/ 抽象/ 解释/ 、/ 模型/ 检测/ 和/ 演绎/ 验证/ 等/ 途径/ )/ 是/ 提高/ 软件/ 可信/ 程度/ 的/ 重要/ 方法/ ,/ 并/ 在/ 工业界/ 已经/ 逐步/ 得到/ 应用/ ,/ 尤其/ 是/ 抽象/ 解释/ 和/ 模型/ 检测/ ./ 例如/ ,/ 空客/ 公司/ 在/ A400M/ 军用/ 运输机/ 以及/ A380/ 和/ A350/ 客机/ 的/ 开发/ 上/ ,/ 已经/ 用/ 形式/ 验证/ 取代/ 了/ 部分/ 安全/ 攸关/ 嵌入式软件/ 的/ 测试/ ./ 和/ 单元测试/ 相比/ ,/ 单元/ 证明/ 降低/ 了/ 投入/ ,/ 主要/ 是因为/ 它/ 方便/ 了/ 维护/ [/ 1/ ]/ ./ 演绎/ 验证/ 在/ 工业界/ 的/ 应用/ 虽/ 有限/ 但/ 也/ 在/ 拓展/ ,/ 达索/ 航空公司/ 在/ 健壮性/ 的/ 形式/ 验证/ 方面/ ,/ 已有/ 约/ 15/ %/ 的/ 断言/ 是/ 用/ 演绎/ 验证/ 方式/ 证明/ 的/ [/ 1/ ]/ ./ 在/ 演绎/ 验证/ 方法/ 中/ ,/ 有关/ 自动/ 程序验证/ 的/ 大部分/ 研究/ 按/ 这样/ 的/ 途径/ 开展/ :/ 程序员/ 提供/ 函数/ 前后/ 条件/ 和/ 循环/ 不变式/ ,/ 系统对/ 程序/ 采用/ 某种/ 正向/ 或/ 逆向/ Page3/ 的/ 演算/ 来/ 产生/ 验证/ 条件/ (/ 即/ 把/ 对/ 程序/ 满足/ 某些/ 性质/ 的/ 证明/ 转化/ 为/ 对/ 一些/ 验证/ 条件/ 的/ 证明/ )/ ,/ 然后/ 用/ 自动/ 定理/ 证明/ 器来/ 证明/ 验证/ 条件/ ,/ 如/ Ynot/ [/ 2/ ]/ 、/ Spe/ c#/ [/ 3/ ]/ 和/ ESC/ // Java/ [/ 4/ ]/ ./ 有些/ 研究/ 依靠/ 符号计算/ 及其/ 过程/ 中/ 的/ 定理/ 证明/ 来/ 避免/ 验证/ 条件/ 的/ 生成/ ,/ 如/ smallfoot/ [/ 5/ ]/ 和/ jStar/ [/ 6/ ]/ ./ 无论/ 用/ 哪种/ 策略/ ,/ 演绎/ 验证/ 方法/ 都/ 使用/ 严谨/ 的/ 方式/ 对/ 软件系统/ 进行/ 数学/ 推理/ ,/ 并且/ 都/ 借助/ 定理/ 证明/ 软件/ ,/ 如/ 定理/ 证明/ 器/ Isabelle/ // HOL/ [/ 7/ ]/ 、/ 定理/ 证明/ 辅助工具/ Coq/ ①/ 、/ SMT/ (/ SatisfiabilityModuloTheories/ )/ 求解/ 器/ Z3/ [/ 8/ ]/ ./ 基于/ 演绎推理/ 的/ 自动/ 形式/ 验证/ 方法/ 对/ 自动/ 定理/ 证明/ 器/ 的/ 能力/ 有/ 较/ 高/ 期待/ ./ 首先/ ,/ 定理/ 证明/ 器/ 在/ 程序验证/ 过程/ 中/ 频繁/ 使用/ ./ 大到/ 验证/ 条件/ 的/ 证明/ 和/ 循环/ 不变式/ 的/ 推断/ ,/ 小到/ 下标/ 变量/ 的/ 别名/ 判断/ 和/ 数组/ 边界/ 检查/ ,/ 都/ 需要/ 或/ 可以/ 使用/ 定理/ 证明/ 器/ ./ 其次/ ,/ 需要/ 能够/ 应对/ 各种/ 领域/ 专用/ 逻辑/ 的/ 定理/ 证明/ ./ 应用程序/ 的/ 代码/ 中/ 可能/ 涉及/ 多种/ 数据类型/ ,/ 操作系统/ 的/ 代码/ 依赖于/ 硬件/ 特性/ ,/ 为/ 完成/ 对/ 这些/ 程序/ 的/ 验证/ ,/ 需要/ 定理/ 证明/ 器/ 能够/ 覆盖/ 这些/ 领域/ 专用/ 逻辑/ 的/ 定理/ 证明/ ./ 第三/ ,/ 需要/ 定理/ 证明/ 器能/ 处理/ 各种/ 理论/ 的/ 组合/ ./ 例如/ 面向/ 数组/ 类型/ 的/ 数组/ 逻辑/ ,/ 它/ 由/ 下标/ 逻辑/ 和/ 元素/ 逻辑/ 组成/ ./ 对于/ 操作/ 数组/ 的/ 程序/ 的/ 验证/ ,/ 定理/ 证明/ 器要/ 能/ 证明/ 这/ 两种/ 逻辑/ 的/ 相应/ 理论/ (/ 可能/ 还/ 包括/ 等式/ 理论/ 和/ 未解释/ 函数/ 理论/ )/ 组合/ 后/ 形成/ 的/ 组合/ 理论/ 上/ 的/ 定理/ ./ 组合/ 理论/ 的/ 问题/ 复杂性/ 在于/ :/ 即使/ 两个/ 理论/ 分别/ 可/ 判定/ ,/ 其/ 组合/ 理论/ 未必/ 可/ 判定/ [/ 9/ ]/ ./ 数组/ 理论/ 就是/ 这样/ 的/ 例子/ ./ 本文/ 研究/ 操作/ 易变/ 数据结构/ (/ 包括/ 单/ // 双向/ 链表/ 、/ 循环/ 单/ // 双向/ 链表/ ②/ 和/ 二叉/ 链/ 表示/ 的/ 二叉树/ )/ 的/ 指针/ 程序/ 的/ 自动/ 验证/ 中/ 的/ 一些/ 定理/ 证明/ 问题/ ./ 这类/ 程序/ 的/ 验证/ 非常/ 困难/ ./ 首先/ ,/ 难以/ 给出/ 表达/ 程序/ 性质/ 的/ 函数/ 前后/ 条件/ ,/ 尤其/ 是/ 循环/ 不变式/ ./ 因为/ 它们/ 涉及/ 所/ 操作/ 的/ 数据结构/ 的/ 结构/ 性质/ (/ 常/ 使用/ 带/ 量词/ 的/ 命题/ 和/ 可达性/ 谓词/ 来/ 表达/ )/ 以及/ 在/ 数据结构/ 中/ 各/ 节点/ 内/ 的/ 数据/ 的/ 性质/ ,/ 而/ 后者/ 的/ 描述/ 可能/ 紧密/ 依赖于/ 数据结构/ 的/ 结构/ 性质/ ,/ 例如/ 平衡/ 二叉树/ 节点/ 的/ 平衡/ 因子/ 和/ AA/ 树/ 节点/ 的/ level/ 值/ ./ 其次/ ,/ 难以/ 证明/ 这/ 类/ 程序/ 的/ 验证/ 条件/ ,/ 因为/ 在/ 验证/ 条件/ 中/ 经常出现/ 对/ 数据结构/ 所有/ 节点/ 的/ 某种/ 全称/ 量化/ ./ 这/ 导致/ 不能/ 使用/ 像/ Nelson/ -/ Oppen/ 框架/ [/ 9/ ]/ 这样/ 仅/ 适用/ 于/ 无/ 量词/ 理论/ 的/ 传统/ 的/ 理论/ 组合/ ./ Z3/ 虽然/ 通过/ 使用/ E/ -/ graph/ 匹配/ 技术/ 能够/ 处理/ 量化/ 公式/ ,/ 但/ 也/ 难以/ 适应/ 复杂/ 的/ 量化/ 公式/ ./ 除了/ 要/ 用/ 量词/ 刻画/ 性质/ 以及/ 涉及/ 的/ 理论/ 组合/ 之外/ ,/ 验证/ 条件/ 的/ 证明/ 可能/ 还要/ 用到/ 数据结构/ 的/ 归纳/ 理论/ ./ 例如/ ,/ 对于/ 用根/ 节点/ 的/ 中序/ 前驱/ (/ 其/ 左子/ 树中/ 最右/ 下/ 的/ 节点/ )/ 代替/ 根/ 节点/ 的/ 、/ 删除/ 二叉/ 排序/ 树根/ 节点/ 的/ 函数/ ,/ 若/ 要/ 证明/ 结果/ 仍然/ 是/ 二叉/ 排序/ 树/ ,/ 则/ 需要/ 用到/ 二叉/ 排序/ 树/ 的/ 两个/ 性质/ :/ 左子/ 树中/ 任何/ 节点/ 的/ 值/ 一定/ 小于/ 右子/ 树中/ 各/ 节点/ 的/ 值/ ,/ 左子/ 树中/ 最右/ 下/ 节点/ 的/ 值/ 大于/ 左子/ 树中/ 其他/ 节点/ 的/ 任何/ 值/ ./ 它们/ 都/ 是/ 二叉/ 排序/ 树/ 的/ 归纳/ 性质/ ,/ 但是/ 基于/ 演绎推理/ 的/ 自动/ 定理/ 证明/ 器/ 不/ 可能/ 从/ 二叉/ 排序/ 树/ 的/ 归纳定义/ 推导/ 出/ 这些/ 性质/ ,/ 因而/ 无法/ 证明/ 依赖/ 这些/ 性质/ 的/ 验证/ 条件/ ./ 为/ 验证/ 操作/ 易变/ 数据结构/ 的/ 指针/ 程序/ ,/ 我们/ 提出/ 了/ 形状/ 图/ 逻辑/ [/ 10/ ]/ ./ 形状/ 图是/ 描述/ 程序/ 所/ 操作/ 的/ 静态/ 声明/ 的/ 指针/ 型/ 变量/ (/ 简称/ 声明/ 指针/ )/ 和/ 动态分配/ 的/ 结构/ 体中/ 指针/ 型域/ 变量/ (/ 简称/ 域/ 指针/ )/ 的/ 指向/ 的/ 一种/ 有向图/ ./ 它/ 准确/ 表达/ 了/ 指针/ 的/ 有效性/ (/ 指针/ 有效/ 是/ 说/ 该/ 指针/ 指向/ 已/ 分配/ 且/ 尚未/ 释放/ 的/ 内存/ 块/ )/ 和/ 指针/ 的/ 相等/ 性/ ,/ 因而/ 可/ 作为/ 指针/ 程序/ 中/ 指针/ 有效性/ 和/ 相等/ 性/ 的/ 断言/ ./ 形状/ 图/ 逻辑/ 就是/ 一种/ 直接/ 把/ 形状/ 图/ 作为/ 程序/ 中/ 指针/ 断言/ 集/ 的/ 程序逻辑/ ./ 它/ 是/ Hoare/ 逻辑/ 的/ 一种/ 扩展/ ,/ 为/ 指针/ 操作/ 语句/ 设计/ 了/ 专门/ 的/ 推理/ 规则/ ,/ 这些/ 规则/ 用/ 图形/ 方式/ 描述/ 指针/ 操作/ 语句/ 引起/ 的/ 形状/ 图上/ 被/ 关注/ 部分/ 的/ 变化/ ./ 利用/ 形状/ 图/ 还/ 可以/ 方便/ 地/ 消除/ 访问/ 路径/ 别名/ ,/ 使/ 易变/ 数据结构/ 上/ 数据/ 性质/ 的/ 验证/ 仍/ 可用/ Hoare/ 逻辑/ 的/ 规则/ 进行/ 推理/ ./ 本文/ 补足/ 文献/ [/ 10/ ]/ 所/ 缺少/ 的/ 部分/ 理论/ 和/ 算法/ ./ 文献/ [/ 10/ ]/ 主要/ 围绕/ 程序逻辑/ 层面/ ,/ 提出/ 把/ 形状/ 图/ 作为/ 指针/ 断言/ ,/ 并/ 在/ 此基础/ 上/ 设计/ 了/ 推理/ 指针/ 程序/ 的/ 形状/ 图/ 逻辑/ 和/ 检查/ 形状/ 合法性/ 的/ 形状/ 系统/ ./ 本文/ 围绕/ 作为/ 指针/ 断言/ 的/ 形状/ 图/ ,/ 研究/ 形状/ 图/ 的/ 等价/ 理论/ 和/ 蕴涵/ 理论/ 以及/ 它们/ 的/ 判定/ 方法/ 和/ 应用/ ./ 本文/ 的/ 贡献/ 有/ 如下/ 3/ 点/ :/ (/ 1/ )/ 提出/ 形状/ 图/ 理论/ 的/ 一种/ 判定/ 方法/ ./ 本文/ 把/ 形状/ 图/ 及其/ 等价/ 规则/ 和/ 蕴涵/ 规则/ 分别/ 类比/ 为/ 代数/ 项/ 及其/ 等式/ 规则/ 和/ 重写/ 规则/ ,/ 像/ 研究/ 代数/ 规范/ 的/ 理论/ 那样/ 来/ 研究/ 形状/ 图/ 理论/ ./ 本文/ 类似/ 地/ 定义/ 形状/ 图/ 的/ 语法/ 理论/ 和/ 语义/ 理论/ ,/ 定义/ 形状/ 图/ 重写/ 系统/ 及其/ 终止/ 性/ 、/ 局部/ 合流/ 性/ 和/ 合流/ 性/ ,/ 最后/ 得到/ 基于/ 形状/ 图/ 重写/ 的/ 形状/ 图/ 等价/ 判定/ 和/ 蕴涵/ 判定/ 的/ 方法/ ./ (/ 2/ )/ 提出/ 循环/ 不变/ 形状/ 图/ 和/ 递归函数/ 前后/ 形状/ ①/ ②/ Page4/ 图/ 的/ 自动/ 推断/ 算法/ ./ 借助/ 形状/ 图/ 理论/ 的/ 判定/ 方法/ ,/ 本文/ 把/ 一个/ 通过/ 迭代/ 推断/ 循环/ 不变式/ 的/ 一般/ 方法/ [/ 11/ ]/ 改编/ 成/ 一个/ 推断/ 循环/ 不变/ 形状/ 图/ 的/ 方法/ ;/ 进一步/ 设计/ 该/ 方法/ 的/ 一个/ 变种/ 来/ 迭代/ 推断/ 递归函数/ 的/ 前后/ 形状/ 图/ ./ (/ 3/ )/ 提出/ 形状/ 图/ 理论/ 和/ 整数/ 理论/ 组合/ 的/ 一种/ 判定/ 方法/ ./ 对/ 易变/ 数据结构/ ,/ 除了/ 关心/ 数据结构/ 各/ 节点/ 是否/ 连成/ 预定/ 的/ 形状/ 外/ ,/ 往往/ 还/ 关心/ 数据/ 在/ 这些/ 节点/ 间/ 的/ 排列/ 特性/ ,/ 它们/ 不能/ 脱离/ 易变/ 数据结构/ 的/ 结构/ 特点/ 而/ 单独/ 验证/ ./ 于是/ 需要/ 研究/ 形状/ 图/ 理论/ 和/ 整数/ 上/ 线性/ 算术/ 理论/ (/ 假定/ 节点/ 数据/ 是/ 整型/ )/ 组合/ 的/ 判定/ 问题/ ./ 本文/ 针对/ 验证/ 条件/ 的/ 特点/ ,/ 利用/ 程序/ 分析阶段/ 得到/ 的/ 形状/ 图/ ,/ 参照/ Nelson/ -/ Oppen/ 框架/ ,/ 提出/ 形状/ 图/ 理论/ 和/ 整数/ 上/ 线性/ 算术/ 理论/ 组合/ 的/ 一种/ 判定/ 方法/ ./ 本文/ 第/ 2/ 节/ 简要/ 回顾/ 文献/ [/ 10/ ]/ 提出/ 的/ 形状/ 图/ 、/ 形状/ 图/ 变换/ 规则/ 和/ 形状/ 图/ 逻辑/ ;/ 第/ 3/ 节/ 介绍/ 形状/ 图/ 理论/ 的/ 判定/ 方法/ ;/ 第/ 4/ 节/ 介绍/ 循环/ 不变/ 形状/ 图/ 的/ 推断/ 和/ 递归函数/ 前后/ 形状/ 图/ 的/ 推断/ ;/ 第/ 5/ 节/ 介绍/ 形状/ 图/ 理论/ 和/ 整数/ 理论/ 组合/ 的/ 判定/ 方法/ ;/ 第/ 6/ 节是/ 验证/ 实例/ ;/ 第/ 7/ 节是/ 和/ 相关/ 研究/ 工作/ 的/ 比较/ ;/ 第/ 8/ 节是/ 总结/ ./ 2/ 形状/ 图/ 和/ 形状/ 图/ 逻辑/ 2.1/ 形状/ 图/ 的/ 结构/ 体中域/ 指针/ 的/ 指向/ 关系/ 的/ 一种/ 有向图/ ./ 形状/ 图是/ 描述/ 程序/ 中/ 静态/ 声明/ 指针/ 和/ 动态分配/ 形状/ 图/ 的/ 顶点/ (/ 也/ 称/ 节点/ )/ 有/ 6/ 种/ ,/ 其/ 图形化/ 语法/ 形式/ 见图/ 1/ ./ 其中/ 声明/ 节点/ 和/ 结构/ 节点/ 分别/ 表示/ 静态/ 声明/ 指针/ 和/ 动态分配/ 的/ 结构/ 体/ ./ null/ 节点/ 和/ 悬空/ 节点/ 的/ 用意/ 稍后/ 会/ 提到/ ./ 浓缩/ 节点/ 是/ 若干个/ 结构/ 节点/ 和/ 它们/ 之间/ 的/ 有/ 向/ 边/ 的/ 浓缩/ 表示/ ,/ 其/ 灰色/ 矩形/ 下侧/ 的/ 表达式/ e/ 和/ 断言/ a/ 分别/ 表示/ 被/ 浓缩/ 的/ 结构/ 节点/ 的/ 个数/ 以及/ 对/ e/ 的/ 取值/ 范围/ 的/ 约束/ ./ 若/ 灰色/ 矩形/ 下/ 无/ e/ 和/ a/ ,/ 称为/ 无约束/ 浓缩/ 节点/ ,/ 它/ 表示/ 被/ 浓缩/ 的/ 结构/ 节点/ 个数/ 任意/ ,/ 可以/ 是/ 0/ 个/ ./ 谓词/ 节点/ 代表/ 满足/ 指定/ 谓词/ 的/ 若干/ 节点/ 和/ 它们/ 之间/ 的/ 有/ 向/ 边/ ,/ 其/ 矩形/ 节点/ 下/ 侧/ 标有/ 谓词/ 名/ name/ ,/ 还/ 可能/ 有/ 与/ 浓缩/ 节点/ 含义/ 一致/ 的/ 表达式/ e/ 和/ 断言/ a/ ./ 指向/ 谓词/ 节点/ 的/ 有/ 向/ 边/ 以及/ 该/ 节点/ 下侧/ 的/ e/ 和/ a/ 是/ 该/ 节点/ 所/ 代表/ 的/ 谓词/ 的/ 变元/ ,/ 例如/ 图/ 2/ 给出/ 了/ 几种/ 用/ 形状/ 图/ 定义/ 的/ 数据结构/ ,/ 以/ 单链/ 表为例/ ,/ 图中/ 谓词/ 节点/ 的/ 变元/ 和/ 左侧/ 的/ 符号/ 谓词/ list/ (/ s/ ,/ e/ ,/ a/ )/ 的/ 变元/ 是/ 一致/ 的/ ./ 形状/ 图中/ 的/ 有/ 向/ 边/ 表示/ 声明/ 指针/ 和域/ 指针/ 的/ 指向/ ,/ 指向/ 同一个/ 节点/ (/ 悬空/ 节点/ 除外/ )/ 的/ 指针/ 相等/ ./ 有/ 向/ 边/ 及其/ 连接/ 的/ 节点/ 满足/ 如下/ 语法/ 约束/ :/ (/ 1/ )/ 声明/ 节点/ ./ 只有/ 唯一/ 的/ 出边/ ,/ 没有/ 入边/ ,/ 出/ (/ 2/ )/ 结构/ 节点/ 和/ 浓缩/ 节点/ ./ 有入/ 边/ 和/ 出边/ ,/ 其中/ 出边/ 的/ 条数/ 与/ 结构/ 节点/ 所/ 代表/ 的/ 结构/ 体的域/ 指针/ 个数/ 一致/ ,/ 各出/ 边/ 的/ 标记/ 分别/ 是/ 各域/ 指针/ 名/ ./ 边/ 的/ 标记/ 就是/ 声明/ 指针/ 名/ ./ (/ 3/ )/ null/ 节点/ 、/ 悬空/ 节点/ 和/ 谓词/ 节点/ ./ 有入/ 边/ ,/ 没有/ 出边/ ./ null/ 节点/ 和/ 悬空/ 节点/ 分别/ 用来/ 表示/ 指向/ 它们/ 的/ 有/ 向/ 边/ 代表/ null/ 指针/ 和/ 悬空/ 指针/ ./ 形状/ 图/ 的/ 定义/ :/ (/ 1/ )/ 节点/ 和/ 有/ 向/ 边/ 满足/ 上述/ 语法/ 约束/ ,/ 各/ 声明/ 节点/ 出边/ 标记/ 相异/ ,/ 且/ 边/ 被/ 视为/ 无向/ 时/ 则/ 连通/ 的/ 图形/ 是/ 形状/ 图/ ;/ (/ 2/ )/ 若/ 形状/ 图/ G1/ ,/ G2/ ,/ …/ ,/ Gn/ 的/ 声明/ 节点/ 出边/ 标记/ 集两/ 两/ 相交/ 都/ 为/ 空/ ,/ 则/ 由/ 逻辑/ 合取/ 符号/ ∧/ 连接/ 的/ G1/ ∧/ G2/ ∧/ …/ ∧/ Gn/ 也/ 是/ 形状/ 图/ ./ Page5/ 其中/ ,/ 不/ 含/ 符号/ ∧/ 的/ 形状/ 图/ G/ 被/ 称为/ 形状/ 子图/ ;/ (/ 3/ )/ 若/ 形状/ 图/ G1/ ,/ G2/ ,/ …/ ,/ Gn/ 的/ 声明/ 节点/ 出边/ 标记/ 集都/ 相同/ ,/ 则/ 逻辑/ 析取/ 符号/ ∨/ 连接/ 的/ G1/ ∨/ G2/ ∨/ …/ ∨/ Gn/ 也/ 是/ 形状/ 图/ ./ 从/ 文献/ [/ 10/ ]/ 有关/ 形状/ 图/ 的/ 语义/ 知道/ ,/ 一个/ 不/ 含/ 析取/ 符号/ 并且/ 没有/ 浓缩/ 节点/ 和/ 谓词/ 节点/ 的/ 形状/ 图是/ 程序/ 状态/ 中/ 指针/ 型/ 数据/ 的/ 图形/ 表示/ ,/ 不/ 含/ 析取/ 符号/ 的/ 一般/ 形状/ 图/ G/ 则/ 是/ 程序/ 状态/ 集/ 的/ 图形/ 表示/ ./ G1/ ∧/ G2/ 中/ 的/ G1/ 和/ G2/ 各/ 代表/ 程序/ 状态/ 的/ 不同/ 部分/ ./ G1/ ∨/ G2/ 中/ 的/ G1/ 和/ G2/ 则/ 代表/ 不同/ 的/ 程序/ 状态/ 集/ ./ 若/ 无/ 特别/ 说明/ ,/ 符号/ G/ 仅/ 表示/ 不/ 含/ 符号/ ∨/ 的/ 形状/ 图/ ./ 图/ 2/ 给出/ 基于/ 形状/ 图/ 定义/ 的/ 单链/ 表/ (/ 域/ 指针/ nt/ 是/ 下文/ next/ 或/ nxt/ 的/ 简称/ ,/ 本文/ 不/ 区分/ 这/ 3/ 个/ 名称/ )/ 、/ 双向/ 链表/ 和/ 二叉/ 链/ 表示/ 的/ 二叉树/ (/ 系统/ 还/ 支持/ 的/ 循环/ 单链/ 表/ 和/ 循环/ 双向/ 链表/ 的/ 定义/ 见/ 文献/ [/ 10/ ]/ )/ ./ 在/ 图/ 2/ 中/ ,/ 定义/ 式/ 最/ 左边/ 的/ dlist/ (/ s/ ,/ e/ ,/ a/ )/ 等/ 符号/ 表示/ 是/ 为了/ 便于/ 在/ 文中/ 引用/ ./ 可以/ 看出/ ,/ 把/ dlist/ (/ s/ ,/ e/ ,/ a/ )/ 的/ 2/ 个/ 定义/ 中/ 的/ e/ 和/ a/ 部分/ 略去/ ,/ 再用/ 符号/ ∨/ 连接/ 它们/ ,/ 就/ 得到/ dlist/ (/ s/ )/ 的/ 定义/ ./ 若用/ 符号/ 谓词/ 表示/ ,/ 图/ 2/ 的/ 二叉树/ 定义/ 相当于/ tree/ (/ s/ )/ / s/ =/ =/ NULL/ ∨/ s/ !/ =/ NULL/ ∧/ tree/ (/ s/ →/ r/ )/ ∧/ tree/ (/ s/ →/ l/ )/ ./ 图/ 3/ (/ 循环/ )/ 单链/ 表/ 的/ 等价/ 规则/ 的/ 3/ 个/ 例子/ 2.2/ 形状/ 图/ 的/ 等价/ 和/ 蕴涵/ 规则/ 等价/ 规则/ 是/ 保持/ 形状/ 图/ 语义/ 等价/ 的/ 变换/ 规则/ ./ 图/ 3/ 列出/ 了/ 在/ 文献/ [/ 10/ ]/ 的/ 2.3/ 节中/ 定义/ 的/ (/ 循环/ )/ 单链/ 表/ 的/ 部分/ 等价/ 规则/ ./ 第/ 3/ 节/ 还/ 会/ 列举/ 一些/ 等价/ 规则/ ./ 除了/ 等价/ 规则/ 外/ ,/ 形状/ 图/ 还有/ 蕴涵/ 规则/ ,/ 蕴涵/ 规则/ 是/ 保持/ 形状/ 图/ 语义/ 蕴涵/ 的/ 变换/ 规则/ ./ 文献/ [/ 10/ ]/ 中/ 2.3/ 节/ 定义/ 的/ 形状/ 图/ 蕴涵/ 规则/ 分成/ 三/ 部分/ ./ (/ 1/ )/ 从/ 等价/ 规则/ W/ / W1/ ∨/ W2/ 可得/ W1/ / W/ 和/ W2/ / W/ 两条/ 蕴涵/ 规则/ ./ 例如/ ,/ 从图/ 3/ (/ 3/ )/ 的/ 等价/ 规则/ 可以/ 得到/ 两条/ 蕴涵/ 规则/ ./ (/ 2/ )/ 若/ 等价/ 规则/ W1/ / W2/ 的/ 副/ 条件/ 是/ (/ (/ e1/ =/ =/ e2/ ∧/ a1/ )/ / a2/ )/ ∧/ (/ (/ e2/ =/ =/ e1/ ∧/ a2/ )/ / a1/ )/ ,/ 则/ 有/ 蕴涵/ 规则/ W1/ / W2/ 和/ W2/ / W1/ ,/ 其/ 副/ 条件/ 分别/ 是/ (/ (/ e1/ =/ =/ 一个/ 形状/ 图/ 的/ 某/ 形状/ 子图/ 中用/ 点/ 划线/ 方框/ 标明/ 并/ 满足/ 下面/ 条件/ 的/ 部分/ 称为/ 窗口/ ,/ 窗口/ 描述/ 形状/ 子图/ 上/ 被/ 关注/ 的/ 那/ 部分/ ,/ 形状/ 图/ 的/ 其余部分/ 称为/ 窗口/ 的/ 上下文/ ./ 不得/ 与/ 窗口/ 的/ 方框/ 边界/ 相交/ ./ (/ 1/ )/ 形状/ 图/ 的/ 各/ 节点/ 处于/ 窗口/ 内/ 或/ 上下文/ 中/ ,/ (/ 2/ )/ 窗口/ 内/ 各/ 节点/ 之间/ 的/ 边/ 都/ 位于/ 窗口/ 中/ ./ (/ 3/ )/ 表达/ 窗口/ 中/ 节点/ 与/ 上下文/ 中/ 节点/ 联系/ 的/ 、/ 穿越/ 方框/ 边界/ 的/ 边/ 属于/ 窗口/ ,/ 这些/ 边/ 的/ 另/ 一份/ 副本/ 在/ 上下文/ 中/ ./ 窗口/ W/ 和/ 上下文/ G/ [/ ]/ 的/ 匹配/ 就是/ 检查/ 穿越/ W/ 边界/ 的/ 边/ 和/ G/ [/ ]/ 中/ 的/ 副本/ 边/ 能否/ 重合/ ,/ 重合/ 后/ 得到/ 的/ 形状/ 图用/ G/ [/ W/ ]/ 表示/ ./ 在/ 形状/ 图/ 变换/ 规则/ 中/ 出现/ 的/ 窗口/ 有/ 如下/ 的/ 缩写/ 约定/ :/ 对/ 窗口/ 中/ 的/ 某/ 节点/ 而言/ ,/ 若/ 要求/ 从/ 窗口/ 外/ 指向/ 该/ 节点/ 至少/ 要/ 有/ 一条/ 边/ (/ 如图/ 3/ 的/ p1/ )/ ,/ 则/ 可能/ 还有/ 的/ 、/ 指向/ 该/ 节点/ 的/ 其他/ 边/ (/ 可以/ 是/ 0/ 条/ )/ 用/ 一条/ 标记/ 为/ pk/ 的/ 边/ 统一/ 表示/ ./ 窗口/ 用来/ 定义/ 形状/ 图/ 的/ 等价/ 规则/ 和/ 蕴涵/ 规则/ (/ 见/ 文献/ [/ 10/ ]/ 的/ 2.3/ 节/ )/ 及/ 形状/ 图/ 逻辑/ 的/ 推理/ 规则/ (/ 见/ 文献/ [/ 10/ ]/ 的/ 3.1/ 节/ )/ ./ e2/ )/ ∧/ a1/ )/ / a2/ 和/ (/ (/ e2/ =/ =/ e1/ )/ ∧/ a2/ )/ / a1/ ./ 例如/ ,/ 从图/ 4/ 的/ 每条/ 等价/ 规则/ 都/ 可/ 得到/ 两条/ 蕴涵/ 规则/ ./ 图/ 4/ 对/ 浓缩/ 节点/ 的/ 约束/ 数据/ 进行/ 变换/ 的/ 部分/ 等价/ 规则/ (/ 3/ )/ 将/ 等价/ 规则/ 中有/ 约束/ 浓缩/ 节点/ 改成/ 无约束/ 浓缩/ 节点/ 而/ 得到/ 蕴涵/ 规则/ ./ 例如/ ,/ 图/ 5/ 中/ 蕴涵/ 规则/ Page6/ (/ 3/ )/ 和/ (/ 4/ )/ 分别/ 从/ 等价/ 规则/ (/ 1/ )/ 和/ (/ 2/ )/ 得到/ ./ 蕴涵/ 方向/ 的/ 选择/ (/ 称为/ 定向/ )/ 取决于/ 规则/ 的/ 左右/ 两边/ 谁/ 蕴涵/ 谁/ ./ 以/ 浓缩/ 节点/ 所/ 代表/ 的/ 结构/ 节点/ 的/ 个数/ n/ 来/ 直观/ 解释/ ,/ (/ 3/ )/ 和/ (/ 4/ )/ 的/ 定向/ 分别/ 基于/ n/ =/ =/ 1/ / n/ >/ =/ 1/ 和/ n/ >/ =/ 1/ / n/ >/ =/ 0/ ./ 图/ 6/ 指针/ 赋值/ 语句/ 的/ 一条/ 规则/ 需要/ 注意/ 的/ 是/ ,/ 由于/ u/ 、/ v/ 代表/ 访问/ 路径/ ,/ 为/ 便于/ 描述/ 推理/ 规则/ ,/ 图/ 6/ 采用/ 2.1/ 节中/ 窗口/ 概念/ 的/ 一种/ 扩展/ 表示/ :/ 将/ 标记/ u/ 和/ v/ 等/ 放在/ 边/ 的/ 下方/ ,/ 以/ 表示/ u/ 和/ v/ 等/ 是/ 访问/ 路径/ ,/ 而/ 不是/ 边/ 的/ 标记/ (/ 边/ 的/ 标记/ 放在/ 边/ 的/ 上方/ )/ ;/ 它们/ 要求/ 在/ 应用/ 规则/ 到/ 某/ 形状/ 图时/ ,/ 形状/ 图上/ 应有/ 相应/ 的/ 访问/ 路径/ ./ 例如/ ,/ 使用/ 图/ 6/ 的/ 规则/ 图/ 7/ 指针/ 赋值/ 语句/ 的/ 另/ 一条/ 规则/ 图/ 8/ 是/ 两个/ 表示/ 单链/ 表/ 的/ 形状/ 图/ ./ 假定/ head/ 指向/ 的/ 单链/ 表/ 至少/ 有/ 一个/ 表元/ ,/ 程序/ 片段/ ptr1/ =/ head/ ;/ ptr/ =/ head/ →/ next/ ;/ while/ (/ ptr/ !/ =/ NULL/ )/ {/ 2.3/ 形状/ 图/ 逻辑/ 的/ 推理/ 规则/ 在/ 形状/ 图/ 逻辑/ 中/ ,/ 有关/ 指针/ 操作/ 语句/ 的/ 推理/ 规则/ 都/ 是/ 相应/ 语句/ 操作/ 语义/ 的/ 图形/ 表示/ ./ 因为/ 推理/ 规则/ 体现/ 语句/ 执行/ 前后/ 形状/ 图/ 的/ 变化/ ,/ 而/ 形状/ 图是/ 程序/ 状态/ 的/ 图形/ 表示/ ,/ 因此/ 形状/ 图/ 的/ 变化/ 自然/ 就是/ 相应/ 语句/ 引起/ 的/ 程序/ 状态/ 变化/ ./ 这里/ 以/ 指针/ 赋值/ 语句/ u/ =/ v/ 的/ 部分/ 推理/ 规则/ 为例/ ,/ 介绍/ 形状/ 图/ 逻辑/ 中/ 指针/ 操作/ 语句/ 的/ 推理/ 规则/ ./ 其中/ u/ 、/ v/ 代表/ 从/ 声明/ 指针/ 名/ 出发/ 、/ 经/ 若干条/ 域/ 指针/ 边/ 组成/ 的/ 访问/ 路径/ ,/ 如/ q/ 或/ p/ →/ next/ →/ next/ ./ 图/ 6/ 是/ u/ 指向/ null/ 节点/ 、/ v/ 指向/ (/ 循环/ )/ 单链/ 表/ 结构/ 节点/ 时/ 的/ 推理/ 规则/ (/ v/ 指向/ 浓缩/ 或/ 谓词/ 节点/ 的/ 规则/ 类似/ )/ ./ 从/ 赋值/ 前/ 形状/ 图/ G/ 到/ 赋值/ 后/ 形状/ 图/ G/ 的/ 变化/ 就是/ 让/ u/ 也/ 指向/ v/ 原来/ 指向/ 的/ 节点/ ./ 图/ 6/ 花/ 括号/ 中/ 的/ 不是/ 形状/ 图/ ,/ 而/ 只是/ 其中/ 被/ 所/ 关注/ 的/ 若干个/ 窗口/ ./ 若图/ 6/ 中/ 的/ 4/ 个/ 窗口/ 自/ 左向右/ 依次/ 用/ W11/ 、/ W12/ 、/ W21/ 和/ W22/ 表示/ ,/ 则/ 对/ 任意/ 能够/ 使/ G/ [/ W11/ ,/ W12/ ]/ 成为/ 形状/ 图/ 的/ 上下文/ G/ [/ ]/ ,/ 有/ 推理/ 规则/ 其中/ G/ [/ W11/ ,/ W12/ ]/ 上/ 的/ 窗口/ W11/ 和/ W12/ 无/ 重迭/ 部分/ ./ 因此/ ,/ 严格/ 说图/ 6/ 只是/ 规则/ 的/ 窗口/ 而/ 不是/ 规则/ ,/ 简单/ 起见/ 仍/ 称为/ 规则/ ./ 时/ ,/ G/ [/ W11/ ,/ W12/ ]/ 要/ 有/ 从/ 某/ 声明/ 节点/ 到达/ W11/ 中/ 节点/ 的/ 访问/ 路径/ ,/ 访问/ 路径/ 上/ 各边/ 的/ 标记/ 顺次/ 连接/ 构成/ u/ ./ 图/ 7/ 是/ u/ 指向/ (/ 循环/ )/ 单链/ 表/ 结构/ 节点/ 、/ v/ 指向/ null/ 节点/ 时/ 的/ 推理/ 规则/ (/ v/ 指向/ 浓缩/ 或/ 谓词/ 节点/ 的/ 规则/ 也/ 类似/ )/ ./ 若/ 赋值/ 前/ 只有/ u/ 指向/ 结构/ 节点/ ,/ 则/ 报告/ 内存/ 泄漏/ ./ ptr1/ =/ ptr/ ;/ ptr/ =/ ptr/ →/ next/ ;/ }/ 的/ 循环/ 不变/ 形状/ 图/ 就是/ 图/ 8/ (/ 1/ )/ ./ 当/ ptr/ !/ =/ NULL/ 为/ 真/ 进入/ 循环/ 时/ ,/ 利用/ 图/ 3/ (/ 3/ )/ 的/ 规则/ ,/ 把/ ptr/ 指向/ 的/ 浓/ Page7/ 缩/ 节点/ 展开/ 成/ 两种/ 情况/ ,/ 其一/ 与/ ptr/ !/ =/ NULL/ 矛盾/ 被/ 略去/ ,/ 另/ 一种/ 情况/ 就是/ 图/ 8/ (/ 2/ )/ 的/ 形状/ 图/ ./ 把/ 语句/ ptr1/ =/ ptr/ 当作/ 语句/ 序列/ dummy/ =/ ptr/ ;/ ptr1/ =/ NULL/ ;/ ptr1/ =/ dummy/ ;/ dummy/ =/ NULL/ ,/ 按图/ 6/ 和/ 图/ 7/ 的/ 规则/ 逐步/ 修改/ 图/ 8/ (/ 2/ )/ ,/ 其中/ dummy/ 是/ 初值/ 为/ NULL/ 的/ 虚拟/ 局部/ 指针/ 变量/ ./ 引入/ dummy/ 主要/ 是/ 为了/ 避免/ 为/ 某些/ 特殊/ 的/ 指针/ 赋值/ 情况/ 设计/ 复杂/ 的/ 专用/ 规则/ ,/ 见/ 文献/ [/ 10/ ]/ 的/ 3.1/ 节/ ./ 对/ ptr/ =/ ptr/ →/ next/ 也/ 继续/ 用/ 类似/ 的/ 方法/ 修改/ 形状/ 图/ ,/ 再/ 把/ 得到/ 的/ 形状/ 图用/ 类似/ 图/ 3/ (/ 3/ )/ 的/ 规则/ ,/ 把/ ptr1/ 原先/ 指向/ 的/ 结构/ 节点/ 逆向/ 折叠/ 进/ 左边/ 的/ 浓缩/ 节点/ ,/ 得到/ 图/ 8/ (/ 1/ )/ ./ 3/ 形状/ 图/ 理论/ 的/ 判定/ 方法/ 形状/ 图/ 的/ 等价/ 推理/ 规则/ 集由/ 文献/ [/ 10/ ]/ 中/ 2.3/ 节/ 的/ 形状/ 图/ 等价/ 规则/ (/ 不/ 包括/ 那些/ 推导/ 形状/ 图/ 析取/ G1/ ∨/ G2/ 的/ 规则/ ,/ 例如/ 本文/ 图/ 3/ (/ 3/ )/ )/ 和/ 任何/ 等价/ 推理/ 系统/ 都/ 有/ 的/ 自反/ 、/ 对称/ 和/ 传递/ 规则/ 组成/ ./ 该/ 规则/ 集/ 可用/ 来/ 证明/ 形状/ 图/ 之间/ 的/ 等价/ 性/ ./ 若/ 等价/ 形状/ 图/ 的/ 集合/ E/ 是/ 封闭/ 于/ 可/ 证明/ 的/ ,/ 即/ / / G1/ / G2/ 蕴涵/ G1/ / G2/ ∈/ / ,/ 则/ 把/ / 叫做/ 形状/ 图/ 的/ 一个/ 语法/ 等价/ 理论/ ./ 类似/ 地/ 可以/ 定义/ 形状/ 图/ 相应/ 的/ 语义/ 等价/ 理论/ ,/ 即/ / / G1/ / G2/ 蕴涵/ G1/ / G2/ ∈/ / ./ 由/ 文献/ [/ 10/ ]/ 中/ 2.4/ 节/ 关于/ 等价/ 规则/ 的/ 性质/ 定理/ ,/ 不难/ 证明/ / / G1/ / G2/ 当且/ 仅/ 当/ / / G1/ / G2/ ./ 类似/ 地/ 根据/ 形状/ 图/ 的/ 蕴涵/ 规则/ ,/ 可以/ 定义/ 形状/ 图/ 的/ 语法/ 蕴涵/ 理论/ 和/ 语义/ 蕴涵/ 理论/ 及/ 证明/ / / G1/ / G2/ 当且/ 仅/ 当/ / / G1/ / G2/ ./ 本节/ 介绍/ 形状/ 图/ 的/ 重写/ 系统/ 和/ 这/ 两种/ 理论/ 的/ 判定/ 方法/ ./ 3.1/ 形状/ 图/ 的/ 等价/ 重写/ 系统/ 形状/ 图/ 的/ 等价/ 重写/ 系统/ 可/ 比照/ 代数/ 项/ 的/ 重写/ 系统/ [/ 12/ ]/ 来/ 讨论/ ./ 它/ 用于/ 形状/ 分析/ 和/ 验证/ 过程/ 中/ 对/ 形状/ 图/ 进行/ 等价/ 化简/ ./ 形状/ 图/ 等价/ 规则/ 限制/ 为/ 单向/ 后/ 得到/ 的/ 蕴涵/ 规则/ 就是/ 一条/ 形状/ 图/ 重写/ 规则/ ./ 一组/ 形状/ 图/ 重写/ 规则/ 构成/ 一个/ 形状/ 图/ 重写/ 系统/ ./ 不能/ 用该/ 系统/ 的/ 规则/ 再/ 进行/ 归约/ 的/ 形状/ 图/ 称为/ 最简/ 形状/ 图/ ./ 不/ 存在/ 无穷/ 归约/ 序列/ 的/ 系统/ 称为/ 具有/ 终止/ 性/ 的/ 系统/ ./ 可以/ 参照/ 项/ 重写/ 系统/ 继续/ 定义/ 系统/ 的/ 临界/ 对/ (/ criticalpair/ )/ 、/ 局部/ 合流/ 性/ 和/ 合流/ 性/ ./ 仿照/ Knuth/ -/ Bendix/ 完备化/ 过程/ [/ 13/ ]/ ,/ 可以/ 把/ 文献/ [/ 10/ ]/ 中/ 2.3/ 节/ 的/ 等价/ 规则/ 集/ 变换/ 成/ 一个/ 与/ 之/ 等价/ 并且/ 终止/ 与/ 合流/ 的/ 形状/ 图/ 重写/ 系统/ / ./ 下面/ 先/ 以/ 一个/ 简单/ 的/ 项/ 重写/ 系统/ 为/ 例来/ 熟悉/ 项/ 重写/ 系统/ 的/ 一些/ 概念/ ,/ 然后/ 说明/ 项/ 重写/ 和/ 形状/ 图/ 重写/ 之间/ 的/ 主要/ 异同/ ./ 例如/ ,/ 代数/ 等式/ x/ +/ 0/ =/ x/ ,/ x/ +/ (/ -/ x/ )/ =/ 0/ ,/ (/ x/ +/ y/ )/ +/ z/ =/ x/ +/ (/ y/ +/ z/ )/ 是/ 属于/ 包含/ 0/ 、/ 加/ 和/ 一元/ 减/ 的/ 自然数/ 等式/ 系统/ 中/ 的/ 等式/ ,/ 把/ 它们/ 从左到右/ 定向/ ,/ 得到/ 3/ 条/ 重写/ 规则/ x/ +/ 0/ →/ x/ ,/ x/ +/ (/ -/ x/ )/ →/ 0/ ,/ (/ x/ +/ y/ )/ +/ z/ →/ x/ +/ (/ y/ +/ z/ )/ 项/ x/ +/ (/ y/ +/ (/ -/ y/ )/ )/ 的/ 子项/ y/ +/ (/ -/ y/ )/ 与/ 第/ 2/ 条/ 规则/ 的/ 左部/ 匹配/ ,/ 因此/ x/ +/ (/ y/ +/ (/ -/ y/ )/ )/ 可用/ 第/ 2/ 条/ 规则/ 重/ 写成/ x/ +/ 0/ ,/ 再/ 依据/ 第/ 1/ 条/ 规则/ 重写/ 为/ x/ ./ 不难/ 证明/ 这/ 3/ 条/ 规则/ 构成/ 的/ 重写/ 系统/ 是/ 终止/ 的/ ./ 要/ 证明/ 合流/ 性/ ,/ 需要/ 考察/ 临界/ 对/ ./ 第/ 3/ 条/ 规则/ 左部/ 的/ 子项/ x/ +/ y/ 和/ 该/ 规则/ 左部/ (/ x/ +/ y/ )/ +/ z/ (/ 加撇号/ 以便/ 区别/ )/ 合一/ ,/ 得到/ 临界/ 对/ 〈/ (/ x/ +/ y/ )/ +/ (/ z/ +/ z/ )/ ,/ (/ x/ +/ (/ y/ +/ z/ )/ )/ +/ z/ 〉/ 该/ 临界/ 对/ 中/ 的/ 两个/ 项/ 都/ 能/ 归约/ 到/ x/ +/ (/ y/ +/ (/ z/ +/ z/ )/ )/ ./ 可以/ 类似/ 地/ 计算/ 该/ 重写/ 系统/ 的/ 其它/ 临界/ 对/ 并/ 证明/ 每一/ 临界/ 对/ 中/ 的/ 两个/ 项/ 都/ 能/ 归约/ 到/ 同一个/ 项/ ,/ 所以/ 该/ 系统/ 具有/ 局部/ 合流/ 性/ ./ 再/ 由/ 终止/ 性可得/ 该/ 系统/ 具有/ 合流/ 性/ ./ 在/ 上述/ 项/ 重写/ 系统/ 中/ ,/ 规则/ 的/ 左部/ 和/ 右部/ 都/ 是/ 项/ ,/ 被/ 重写/ 的/ 也/ 是/ 项/ ./ 而/ 形状/ 图/ 系统/ 与/ 项/ 重写/ 系统/ 相比/ ,/ 最大/ 的/ 区别/ 是/ :/ 规则/ 的/ 左部/ 和/ 右部/ 都/ 是/ 窗口/ ,/ 被/ 重写/ 的/ 是/ 形状/ 图/ ./ 产生/ 该/ 区别/ 的/ 根源/ 在于/ 形状/ 图是/ 二维/ 的/ ./ 基于/ 同样/ 的/ 原因/ ,/ 合一/ 和/ 匹配/ 的/ 描述/ 也/ 有/ 区别/ ./ 但是/ 两个/ 系统/ 的/ 本质/ 概念/ 和/ 方法/ 是/ 一致/ 的/ ./ 下面/ 先/ 给出/ 节点/ 相同/ 和/ 形状/ 图/ 相同/ 的/ 定义/ ./ 定义/ 1/ ./ 节点/ n1/ 和/ n2/ 若/ 满足/ 下面/ 两个/ 条件/ ,/ 则/ 称/ n1/ 和/ n2/ 相同/ :/ (/ 1/ )/ n1/ 和/ n2/ 是/ 同类/ 节点/ ,/ 并且/ 若/ 都/ 是/ 声明/ 节点/ 、/ 结构/ 节点/ 或/ 浓缩/ 节点/ ,/ 则/ 有/ 同样/ 的/ 出边/ 及其/ 标记/ ;/ 若/ 都/ 是/ 谓词/ 节点/ ,/ 则/ 谓词/ 名/ 相同/ ./ (/ 2/ )/ 若/ n1/ 和/ n2/ 是/ 同类/ 浓缩/ 节点/ 或/ 谓词/ 节点/ ,/ 且/ 分别/ 带/ e1/ 与/ a1/ 和/ e2/ 与/ a2/ ,/ 则/ 必须/ 满足/ (/ e1/ =/ =/ e2/ ∧/ a1/ )/ / a2/ 并且/ (/ e1/ =/ =/ e2/ ∧/ a2/ )/ / a1/ ./ 其中/ ,/ 无约束/ 浓缩/ Page8/ 节点/ 在/ 此/ 都/ 被/ 视为/ 带/ m/ 与/ m/ >/ =/ 0/ 的/ 浓缩/ 节点/ ./ 下面/ 讨论/ 判定/ 方法/ 时/ 也/ 作/ 如此/ 假设/ ./ 定义/ 2/ ./ 形状/ 子图/ G1/ 和/ G2/ 若/ 满足/ 下面/ 两个/ 条件/ ,/ 则/ 称/ G1/ 和/ G2/ 相同/ ./ (/ 1/ )/ G1/ 和/ G2/ 的/ 节点/ 一一对应/ ./ (/ 2/ )/ G1/ 和/ G2/ 的/ 对应/ 节点/ 都/ 是/ 相同/ 节点/ ,/ 并且/ 若/ 它们/ 有/ 出边/ ,/ 则/ 标记/ 相同/ 的/ 出边/ 所/ 指向/ 的/ 节点/ 是/ 对应/ 节点/ ./ 定义/ 3/ ./ 形状/ 图/ G1/ 和/ G2/ 若/ 满足/ 下面/ 的/ 条件/ ,/ 则/ 称/ G1/ 和/ G2/ 相同/ ./ G1/ 和/ G2/ 的/ 形状/ 子图/ 一一对应/ 并且/ 相同/ ./ 在/ 从/ 形状/ 图/ 的/ 等价/ 规则/ 构造/ 重写/ 系统/ 时/ ,/ 可以/ 忽略/ 如图/ 4/ 那样/ 仅/ 替换/ 浓缩/ 节点/ 的/ e/ 和/ a/ 的/ 那些/ 等价/ 规则/ ,/ 因为/ 定义/ 1/ 已/ 把/ 替换/ 前后/ 的/ 浓缩/ 节点/ 定义/ 为/ 相同/ ./ 在/ 完备化/ 过程/ 中/ ,/ 文献/ [/ 10/ ]/ 中/ 2.3/ 节/ 的/ (/ 循环/ )/ 单链/ 表/ 、/ (/ 循环/ )/ 双向/ 链表/ 和/ 二叉树/ 的/ 等价/ 规则/ 按照/ 节点/ 数/ 减少/ 的/ 方向/ 定为/ 重写/ 规则/ ,/ 例如/ 图/ 9/ 的/ 等价/ 规则/ (/ 1/ )/ 和/ (/ 2/ )/ 定向/ 为/ 从/ 右/ 向/ 左/ 的/ 重写/ 规则/ ./ 规则/ (/ 1/ )/ 和/ (/ 2/ )/ 其实/ 是/ 同/ 一条/ 规则/ ,/ 只要/ 把/ 其中/ 一条/ 规则/ 中/ 边上/ 的/ 标记/ r/ 和/ l/ 对调/ 一下/ 就/ 可/ 看出/ ,/ 这里/ 写成/ 两条/ 是/ 为了/ 便于/ 下面/ 理解/ 和/ 讨论/ 临界/ 对/ ./ 对/ 那些/ 两边/ 节点/ 数/ 相等/ 的/ 各种/ 等价/ 规则/ ,/ 可/ 按/ 下面/ 的/ 方式/ 之一/ 定向/ :/ (/ 1/ )/ 对于/ 1/ 个/ 结构/ 节点/ 和/ e/ 等于/ 1/ 的/ 浓缩/ 节点/ 之间/ 的/ 等价/ 规则/ ,/ 定向/ 为/ 向/ 浓缩/ 节点/ 的/ 重写/ ,/ 例如/ 图/ 9/ (/ 3/ )/ 定向/ 为/ 从/ 左向右/ ./ 按/ 这个/ 方向/ 定向/ 是/ 便于/ 若干个/ 相邻/ 的/ 结构/ 节点/ 归约/ 成/ 浓缩/ 节点/ ./ (/ 2/ )/ 对于/ 出自/ 链表/ 定义/ 的/ 等价/ 规则/ ,/ 定向/ 为/ 向/ 谓词/ 节点/ 的/ 重写/ ,/ 例如/ 图/ 9/ 的/ 规则/ (/ 4/ )/ 和/ (/ 5/ )/ 定向/ 为/ 从/ 右/ 向/ 左/ ./ 形状/ 图/ 的/ 归约/ 一定/ 会/ 终止/ ,/ 因为/ 每次/ 归约/ 都/ 会/ 使节/ 点数/ 减少/ 或/ 保持/ 不变/ ,/ 而/ 节点/ 数/ 保持/ 不变/ 的/ 重写/ 情况/ 受/ 上面/ 两条/ 的/ 限定/ ,/ 因此/ 归约/ 一定/ 会/ 终止/ ./ / 的/ 合流/ 性/ 可以/ 参照/ 项/ 重写/ 系统/ 合流/ 性/ 的/ 证明/ 方法/ 来/ 证明/ ./ 首先/ 考虑/ 临界/ 对/ ,/ 例如/ ,/ 由图/ 9/ 的/ 等价/ 规则/ (/ 1/ )/ 和/ (/ 2/ )/ 得到/ 两条/ 重写/ 规则/ R1/ 和/ R2/ ./ R1/ 和/ R2/ 的/ 左部/ (/ 对应/ 图/ 9/ 等价/ 规则/ (/ 1/ )/ 和/ (/ 2/ )/ 的/ 右部/ )/ 经/ 两种/ 方式/ 合一/ ,/ 得到/ 2/ 个/ 临界/ 对/ ,/ 分别/ 是/ 图/ 10/ 的/ (/ 1/ )/ 和/ (/ 2/ )/ 与/ 图/ 10/ 的/ (/ 3/ )/ 和/ (/ 4/ )/ ,/ 它们/ 分别/ 都/ 能/ 化简/ 到/ 相同/ 的/ 窗口/ ./ 其余/ 的/ 临界/ 对/ 也/ 都/ 是/ 由于/ 规则/ 的/ 窗口/ 中有/ (/ 循环/ )/ 单链/ 表/ 、/ (/ 循环/ )/ 双向/ 链表/ 或/ 二叉树/ 的/ 浓缩/ 节点/ 而/ 产生/ 的/ ,/ 例如/ 对应/ 图/ 3/ (/ 1/ )/ 和/ (/ 2/ )/ 的/ 相应/ 重写/ 规则/ 也/ 会/ 产生/ 2/ 个/ 临界/ 对/ ./ 很/ 容易/ 检查/ 它们/ 都/ 可/ 归约/ 到/ 同样/ 的/ 窗口/ ,/ 因而/ 证明/ / 是/ 局部/ 合流/ 的/ ./ 再/ 根据/ / 的/ 局部/ 合流/ 性/ 和/ 终止/ 性/ 可以/ 证明/ / 是/ 合流/ 的/ ./ 基于/ 形状/ 图/ 等价/ 重写/ 系统/ 以及/ 图/ 4/ 这样/ 的/ 规则/ ,/ 参照/ 代数/ 项上/ 的/ 证明/ 方法/ ,/ 不难/ 证明/ 下面/ 的/ 定理/ ./ 定理/ ./ 形状/ 图/ G1/ 和/ G2/ 等价/ ,/ 即/ G1/ / G2/ ,/ 当且/ 仅/ 当/ 它们/ 化简/ 后/ 的/ 最简/ 形状/ 图/ G1/ 和/ G2/ 相同/ ./ 3.2/ 犌/ 1/ ,/ 1/ ∨/ …/ ∨/ 犌/ 1/ ,/ 犿/ / 犌/ 2/ ,/ 1/ ∨/ …/ ∨/ 犌/ 2/ ,/ 狀/ 的/ 判定/ 方法/ 抽象地/ 说/ ,/ 判定/ G1/ ,/ 1/ ∨/ …/ ∨/ G1/ ,/ m/ / G2/ ,/ 1/ ∨/ …/ ∨/ G2/ ,/ n/ 可以/ 先用/ 3.1/ 节/ 的/ 等价/ 重写/ 系统/ 把/ 两边/ 所有/ 的/ 形状/ 图/ 分别/ 化简/ ,/ 然后/ 比较/ 两边/ 的/ 各个/ 最简/ 形状/ 图/ 是否/ 都/ 能/ 在/ 对方/ 找到/ 相同/ 的/ 形状/ 图/ ./ 但是/ 3.1/ 节/ 的/ Page9/ 等价/ 重写/ 系统/ 并未/ 考虑/ 个数/ 不同/ 的/ 形状/ 图/ 之间/ 的/ 等价/ 性/ ,/ 为此/ 需要/ 利用/ 文献/ [/ 10/ ]/ 中/ 2.3/ 节里/ 的/ W/ / W1/ ∨/ W2/ 等价/ 规则/ (/ 如图/ 11/ )/ 展开/ 形状/ 图/ ,/ 以期/ 建立/ 个数/ 不同/ 的/ 形状/ 图/ 之间/ 的/ 等价/ 性/ ./ 结合/ 应用/ 场合/ 的/ 特点/ ,/ 本文/ 讨论/ 的/ 等价/ 式/ 中/ 各/ 形状/ 图/ 的/ 声明/ 变量/ 集都/ 相同/ ,/ 等价/ 式/ 的/ 判定/ 方法/ 如下/ :/ (/ 1/ )/ 若/ G1/ ,/ 1/ 和/ G2/ ,/ 1/ 的/ 声明/ 变量/ 集/ 不同/ 则/ 该/ 等价/ 式/ 不/ 成立/ ./ 否则/ 继续/ 下面/ 步骤/ ./ (/ 2/ )/ 将/ 上式/ 中/ 所有/ 的/ 形状/ 图/ ,/ 用/ 3.1/ 节/ 介绍/ 的/ 形状/ 图/ 重写/ 系统/ 把/ 它们/ 归约/ 到/ 最简/ 形状/ 图/ ./ 仍用/ 原来/ 的/ 符号/ G1/ ,/ i/ (/ 1/ / i/ / m/ )/ 或/ G2/ ,/ j/ (/ 1/ / j/ / n/ )/ 代表/ 各/ 形状/ 图/ 的/ 最简/ 形状/ 图/ ./ (/ 3/ )/ 若/ 某个/ G1/ ,/ i/ (/ 1/ / i/ / m/ )/ 的/ 某条/ 尽可能/ 长/ 的/ 且/ 不/ 经过/ 浓缩/ 节点/ 的/ 访问/ 路径/ 是/ 某个/ G2/ ,/ j/ (/ 1/ / j/ / n/ )/ 的/ 某条/ 不/ 经过/ 浓缩/ 节点/ 的/ 访问/ 路径/ 的/ 真/ 前缀/ ,/ 并且/ 若/ G1/ ,/ i/ 中/ 的/ 这条/ 访问/ 路径/ 指向/ 的/ 节点/ 可以/ 用/ W/ / W1/ ∨/ W2/ 的/ 等价/ 规则/ 展开/ ,/ 则/ 将/ 其/ 展开/ ./ 反之亦然/ ./ 直到/ 不/ 存在/ 这样/ 的/ 路径/ 或者/ 虽/ 存在/ 但/ 不能/ 展开/ 为止/ ./ 为/ 防止/ 滥用/ W/ / W1/ ∨/ W2/ 这类/ 等价/ 规则/ ,/ 需要/ 从/ 访问/ 路径/ 的/ 比较/ 上/ 加以/ 限制/ ./ 例如/ ,/ 若/ G1/ ,/ i/ 中有/ 不能/ 再/ 延长/ 的/ 二叉树/ 访问/ 路径/ p/ →/ l/ ,/ G2/ ,/ j/ 中有/ 访问/ 路径/ p/ →/ l/ →/ r/ ,/ 且/ 在/ G1/ ,/ i/ 中/ p/ →/ l/ 指向/ 谓词/ 节点/ ,/ 则/ 可以/ 根据/ 图/ 11/ 的/ 二叉树/ 等价/ 规则/ 将/ G1/ ,/ i/ 展开/ ,/ 其中/ 等价/ 规则/ 中/ 的/ s/ 是/ 占位/ 符/ ,/ 可以/ 通配/ 访问/ 路径/ p/ →/ l/ 中/ 的/ l/ ./ 该/ 规则/ 由图/ 2/ 的/ 二叉树/ 定义/ 得到/ ./ 文献/ [/ 10/ ]/ 中/ 2.3/ 节里/ 的/ 所有/ 的/ W/ / W1/ ∨/ W2/ 都/ 像/ 图/ 11/ 这样/ ,/ 右边/ W1/ 或/ W2/ 中/ 指向/ 谓词/ 节点/ 或/ 浓缩/ 节点/ 的/ 访问/ 路径/ 比/ W/ 的/ 多/ 一个/ 结构/ 体/ 的/ 指针/ 域/ ,/ 因此/ 不会/ 出现/ 等价/ 式/ 左右/ 两边/ 的/ 形状/ 图/ 不断/ 交替/ 展开/ 而/ 不/ 终止/ 的/ 情况/ ./ 经过/ 这样/ 的/ 展开/ ,/ 原/ 等价/ 式/ 变换/ 成/ G1/ ,/ 1/ ∨/ …/ ∨/ G1/ ,/ m/ / G2/ ,/ 1/ ∨/ …/ ∨/ G2/ ,/ n/ ./ (/ 4/ )/ 对/ 每个/ G1/ ,/ i/ (/ 1/ / i/ / m/ )/ ,/ 若/ 存在/ 某个/ G2/ ,/ j/ (/ 1/ / j/ / n/ )/ ,/ 使得/ G1/ ,/ i/ 和/ G2/ ,/ j/ 相同/ ,/ 并且/ 反之亦然/ ,/ 则/ G1/ ,/ 1/ ∨/ …/ ∨/ G1/ ,/ m/ / G2/ ,/ 1/ ∨/ …/ ∨/ G2/ ,/ n/ ,/ 否则/ 该式/ 不/ 成立/ ./ 显然/ ,/ 若/ 上述/ 方法/ 中/ 涉及/ 的/ 由/ 整型/ 线性/ 表达式/ 之间/ 的/ 关系式/ 所/ 构成/ 的/ 断言/ 都/ 可/ 判定/ ,/ 则/ G1/ ,/ 1/ ∨/ …/ ∨/ G1/ ,/ m/ / G2/ ,/ 1/ ∨/ …/ ∨/ G2/ ,/ n/ 可/ 判定/ ./ 3.3/ 犌/ 1/ ,/ 1/ ∨/ …/ ∨/ 犌/ 1/ ,/ 犿/ / 犌/ 2/ ,/ 1/ ∨/ …/ ∨/ 犌/ 2/ ,/ 狀/ 的/ 判定/ 方法/ 该/ 判定/ 方法/ 用于/ 程序/ 分析/ 和/ 验证/ 过程/ 中/ 对/ 形状/ 图/ 蕴涵/ 关系/ 的/ 判定/ ,/ 例如/ 第/ 4/ 节/ 的/ 循环/ 不变/ 形状/ 图/ 和/ 递归函数/ 前后/ 形状/ 图/ 的/ 推断/ 算法/ 需要/ 用到/ 该/ 方法/ ./ 先/ 定义/ 节点/ 相容/ 和/ 形状/ 图/ 相容/ ./ n1/ 相容/ 于/ n2/ (/ 与/ 定义/ 1/ 的/ 区别/ 仅/ 在/ 条件/ (/ 2/ )/ )/ ./ 定义/ 4/ ./ 节点/ n1/ 和/ n2/ 若/ 满足/ 下面/ 的/ 条件/ ,/ 则/ (/ 1/ )/ n1/ 和/ n2/ 是/ 同类/ 节点/ ./ 并且/ 若/ 都/ 是/ 声明/ 节点/ 、/ 结构/ 节点/ 或/ 浓缩/ 节点/ ,/ 则/ 有/ 同样/ 的/ 出边/ 及其/ 标记/ ;/ 若/ 都/ 是/ 谓词/ 节点/ ,/ 则/ 谓词/ 名/ 相同/ ./ (/ 2/ )/ 若/ n1/ 和/ n2/ 是/ 同类/ 浓缩/ 节点/ 或/ 谓词/ 节点/ ,/ 且/ 分别/ 带/ e1/ 与/ a1/ 和/ e2/ 与/ a2/ ,/ 则/ 必须/ 满足/ (/ e1/ =/ =/ e2/ ∧/ a1/ )/ / a2/ ./ 定义/ 5/ ./ 形状/ 子图/ G1/ 和/ G2/ 若/ 满足/ 下面/ 3/ 个/ 条件/ ,/ 则/ 称/ G1/ 相容/ 于/ G2/ ./ (/ 1/ )/ G1/ 的/ 节点/ 集/ N1/ 到/ G2/ 的/ 节点/ 集/ N2/ 有/ 一对一/ 的/ 函数/ f/ ,/ 使得/ N2/ -/ f/ (/ N1/ )/ 若非/ 空/ ,/ 则/ 其中/ 只有/ 浓缩/ 节点/ 并且/ 每个/ 浓缩/ 节点/ 的/ (/ e/ =/ =/ 0/ )/ ∧/ a/ 可/ 满足/ ,/ 即/ 这些/ 浓缩/ 节点/ 可以/ 有/ e/ 等于/ 0/ 的/ 情况/ ./ (/ 2/ )/ 对/ 任何/ n/ ∈/ N1/ ,/ n/ 相容/ 于/ f/ (/ n/ )/ ./ (/ 3/ )/ 对/ 任何/ n/ ∈/ N1/ ,/ 若/ n/ 和/ f/ (/ n/ )/ 的/ 某/ 标记/ 相同/ 的/ 出边/ 分别/ 指向/ 节点/ n1/ 和/ n2/ ,/ 则/ n2/ 经过/ m/ 个/ (/ m/ / 0/ )/ 属于/ N2/ -/ f/ (/ N1/ )/ 的/ 浓缩/ 节点/ 后/ 所/ 到达/ 的/ n2/ 和/ n1/ 满足/ f/ (/ n1/ )/ =/ n2/ ./ 对于/ 图/ 12/ 的/ G1/ 和/ G2/ ,/ G1/ 的/ 那个/ 浓缩/ 节点/ 经/ f/ 函数/ 映射/ 到/ G2/ 最/ 右边/ 的/ 那个/ 浓缩/ 节点/ ./ 因为/ G2/ 左边/ 两个/ 浓缩/ 节点/ 的/ m/ 和/ k/ 都/ 可以/ 等于/ 0/ ,/ 所以/ G1/ 相容/ 于/ G2/ ./ 则/ 称/ G1/ 相容/ 于/ G2/ ./ 定义/ 6/ ./ 形状/ 图/ G1/ 和/ G2/ 若/ 满足/ 下面/ 的/ 条件/ ,/ G1/ 和/ G2/ 的/ 形状/ 子图/ 一一对应/ 并且/ G1/ 的/ 每个/ 形状/ 子图/ 相容/ 于/ G2/ 中/ 对应/ 的/ 形状/ 子图/ ./ 在/ 证明/ 形状/ 图/ 之间/ 的/ 蕴涵/ 时/ ,/ 需要/ 考虑/ 在/ 用/ 等/ Page10/ 价/ 重写/ 系统化/ 简/ 形状/ 图后/ ,/ 适当/ 地/ 使用/ 形状/ 图/ 的/ 蕴涵/ 规则/ ./ 所/ 使用/ 的/ 蕴涵/ 规则/ 是/ 2.2/ 节中/ 第/ (/ 1/ )/ 类/ 蕴涵/ 规则/ ,/ 即/ 由/ W/ / W1/ ∨/ W2/ 得到/ 的/ W1/ / W/ 和/ W2/ / W/ ;/ 而/ 对于/ 第/ (/ 2/ )/ 和/ (/ 3/ )/ 类/ 蕴涵/ 规则/ ,/ 由于/ 它们/ 都/ 是/ 针对/ 浓缩/ 节点/ 的/ e/ 和/ a/ 的/ 规则/ ,/ 其/ 效果/ 已/ 体现/ 在/ 节点/ 相容/ 的/ 定义/ 中/ ,/ 因而/ 不必/ 作为/ 重写/ 规则/ ./ G1/ ,/ 1/ ∨/ …/ ∨/ G1/ ,/ m/ / G2/ ,/ 1/ ∨/ …/ ∨/ G2/ ,/ n/ 的/ 判定/ 方法/ 可/ 通过/ 略微/ 修改/ 3.2/ 节/ 的/ 等价/ 式/ 判断/ 方法/ 中/ 的/ (/ 3/ )/ 和/ (/ 4/ )/ 两点/ 即可/ 得到/ :/ (/ 3/ )/ 若/ 某个/ G2/ ,/ j/ (/ 1/ / j/ / n/ )/ 的/ 某条/ 尽可能/ 长/ 的/ 且/ 不/ 经过/ 浓缩/ 节点/ 的/ 访问/ 路径/ 是/ 某个/ G1/ ,/ i/ (/ 1/ / i/ / m/ )/ 的/ 某条/ 不/ 经过/ 浓缩/ 节点/ 的/ 访问/ 路径/ 或/ 其/ 真/ 前缀/ ,/ 但/ 不是/ 指向/ 同类/ 节点/ ,/ 则/ 尝试/ 使用/ 上面/ 提到/ 的/ 蕴涵/ 规则/ 对/ G1/ ,/ i/ 进行/ 重写/ ./ 例如/ ,/ 若图/ 11/ 规则/ 右部/ 两个/ 窗口/ 之一/ 和/ 左部/ 窗口/ 分别/ 出现/ 在/ G1/ ,/ i/ 和/ G2/ ,/ j/ 中/ 的/ 上述/ 位置/ ,/ 则/ 使用/ 相应/ 蕴涵/ 规则/ 重写/ G1/ ,/ i/ ,/ 把/ 窗口/ 中/ 内容/ 归约/ 成/ 谓词/ 节点/ ./ (/ 4/ )/ 对/ 每个/ G1/ ,/ i/ (/ 1/ / i/ / m/ )/ ,/ 若/ 存在/ 某个/ G2/ ,/ j/ (/ 1/ / j/ / n/ )/ ,/ 使得/ G1/ ,/ i/ 相容/ 于/ G2/ ,/ j/ ,/ 则/ G1/ ,/ 1/ ∨/ …/ ∨/ G1/ ,/ m/ / G2/ ,/ 1/ ∨/ …/ ∨/ G2/ ,/ n/ ,/ 否则/ 该/ 蕴涵/ 式/ 不/ 成立/ ./ 4/ 循环/ 不变/ 形状/ 图/ 和/ 递归函数/ 前后/ 形状/ 图/ 的/ 推断/ 本/ 节/ 应用/ 第/ 3/ 节/ 的/ 形状/ 图/ 理论/ 判定/ 方法/ 来/ 推断/ 循环/ 不变/ 形状/ 图/ ./ 该/ 推断/ 方法/ 的/ 一个/ 变种/ 可用/ 来/ 推断/ 递归函数/ 的/ 前后/ 形状/ 图/ ./ 形状/ 图是/ 指针/ 有效性/ 和/ 指针/ 相等/ 性/ 断言/ 的/ 集合/ 的/ 图形/ 表示/ ,/ 循环/ 不变/ 形状/ 图/ 就是/ 循环/ 不变式/ 中/ 有关/ 指针/ 断言/ 的/ 那/ 部分/ 不变式/ ,/ 函数/ 前后/ 形状/ 图/ 就是/ 函数/ 前后/ 条件/ 中/ 有关/ 指针/ 的/ 那/ 部分/ 断言/ ./ 面/ 功能/ 之一/ :/ 对/ 易变/ 数据结构/ 的/ 处理/ ,/ 循环/ 语句/ 通常/ 完成/ 下/ (/ 1/ )/ 寻找/ 数据结构/ 中/ 的/ 操作/ 位置/ 或/ 依次/ 对/ 各/ 节点/ 上/ 数据/ 进行/ 操作/ ./ 这时/ ,/ 除了/ 某些/ 声明/ 指针/ 的/ 指向/ 在/ 节点/ 间/ 移动/ 外/ ,/ 形状/ 图/ 没有/ 其他/ 变化/ ./ (/ 2/ )/ 循环体/ 的/ 每次/ 迭代/ 都/ 在/ 对/ 数据结构/ 进行/ 节点/ 插入/ 或/ 删除/ ./ 循环体/ 执行/ 过程/ 中/ 虽然/ 破坏/ 了/ 数据结构/ 的/ 形状/ ,/ 但/ 每次/ 到达/ 循环体/ 结束/ 点时/ ,/ 形状/ 得到/ 恢复/ ,/ 仅/ 节点/ 个数/ 发生变化/ ./ (/ 3/ )/ 循环体/ 的/ 每次/ 迭代/ 都/ 在/ 对/ 数据结构/ 某些/ 节点/ 的/ 边/ 的/ 指向/ 进行/ 调整/ ,/ 并且/ 有/ 可能/ 出现/ 这样/ 的/ 情况/ :/ 每次/ 迭代/ 结束/ 时/ 形状/ 并未/ 得到/ 恢复/ ,/ 但/ 在/ 整个/ 循环/ 执行/ 结束/ 时/ 形状/ 得到/ 恢复/ ./ 例如/ 文献/ [/ 10/ ]/ 中例/ 2/ 使用/ 的/ 双向/ 链表/ 倒置/ 算法/ ./ 对于/ 这/ 类/ 循环/ ,/ 在/ 循环体/ 的/ 每条/ 执行/ 路径/ 上/ ,/ 声明/ 指针/ 在/ 形状/ 图上/ 的/ 移动/ 引起/ 的/ 形状/ 图/ 变化/ 主要/ 体现/ 在/ 浓缩/ 节点/ 所/ 代表/ 的/ 节点/ 个数/ 的/ 变化/ 上/ ./ 4.1/ 循环/ 不变/ 形状/ 图/ 推断/ 算法/ 的/ 框架/ 根据/ 基于/ 抽象/ 解释/ 的/ 循环/ 不变式/ 推断/ 框架/ [/ 11/ ]/ ,/ 循环/ 不变/ 形状/ 图/ 的/ 推断/ 算法/ 框架/ 如图/ 13/ ./ 为/ 表达/ 简单/ 起/ 见/ ,/ 本节/ 用/ 字母/ / 表示/ 可以/ 出现/ 形状/ 图/ 析取/ 的/ 形状/ 图/ ./ 对于/ 循环/ while/ (/ B/ )/ S/ (/ 1/ )/ 计算/ 循环/ 前/ 条件/ / 0/ =/ / pre/ ./ i/ =/ 0/ ./ (/ 2/ )/ 根据/ 形状/ 图/ 逻辑/ 的/ 规则/ 计算/ / i/ +/ 1/ ,/ 使得/ (/ 3/ )/ 应用/ 抽象/ 规则/ 计算/ / i/ +/ 1/ ,/ 使得/ / i/ +/ 1/ / / i/ +/ 1/ ./ (/ 4/ )/ 若/ / i/ +/ 1/ / / 0/ ∨/ …/ ∨/ / i/ ,/ 则/ / 0/ ∨/ …/ ∨/ / i/ 是/ 循环/ 不变/ 形状/ 下面/ 对图/ 13/ 的/ 算法/ 框架/ 做/ 一些/ 解释/ :/ (/ 1/ )/ 算法/ 第/ (/ 2/ )/ 步/ 根据/ 形状/ 图/ 逻辑/ 的/ 规则/ 计算/ / i/ +/ 1/ ,/ / i/ ∧/ B/ 代表/ 形状/ 图/ / i/ 和/ 符号/ 断言/ B/ 的/ 合取/ [/ 11/ ]/ ./ 若/ 碰到/ 引起/ 内存/ 泄漏/ 的/ 操作/ 、/ 悬空/ 指针/ 或/ null/ 指针/ 脱/ 引用/ (/ dereference/ )/ 操作/ ,/ 则/ 无规则/ 可用/ ,/ 报告/ 错误/ ./ (/ 2/ )/ 算法/ 第/ (/ 3/ )/ 步/ 的/ 抽象/ 是/ 指/ :/ 对/ 形状/ 图上/ 随/ 循环/ 迭代/ 次数/ 变化/ 而/ 变化/ 的/ 浓缩/ 节点/ (/ 指其/ 代表/ 的/ 结构/ 节点/ 数随/ 迭代/ 次数/ 变化/ 而/ 变化/ )/ ,/ 把/ 其/ 代表/ 结构/ 节点/ 数/ 的/ 表达式/ 换成/ 能/ 概括/ 多次/ (/ 甚至/ 全部/ )/ 迭代/ 情况/ 的/ 表达式/ ./ 应用/ 的/ 抽象/ 规则/ 是/ 采用/ 文献/ [/ 10/ ]/ 中/ 第/ 2.3/ 节/ 的/ 蕴涵/ 规则/ ./ (/ 3/ )/ 算法/ 第/ (/ 4/ )/ 步/ / i/ +/ 1/ / / 0/ ∨/ …/ ∨/ / i/ 的/ 证明/ 是/ 采用/ 3.3/ 节/ 的/ 判定/ 方法/ ./ 以/ 2.3/ 节/ 的/ 那段/ 单链/ 表/ 代码/ (/ 假定/ 至少/ 有/ 一个/ 表元/ )/ 的/ 循环/ 不变/ 形状/ 图/ (/ 图/ 8/ (/ 1/ )/ )/ 的/ 推断/ 为例/ ./ 各/ 程序/ 点/ 的/ 形状/ 图见/ 图/ 14/ ,/ 图中/ j/ 是/ 形状/ 分析/ 系统/ 引入/ 的/ 虚拟/ 变量/ ./ 第/ 1/ 次/ 迭代/ 后/ G1/ / G0/ 不/ 成立/ ,/ 但/ 第/ 2/ 次/ 迭代/ 后能/ 证明/ G2/ / G0/ ∨/ G1/ ,/ 因此/ G0/ ∨/ G1/ 是/ 循环/ 不变/ 形状/ 图/ ./ 由于/ G0/ / G1/ ,/ 因此/ G0/ ∨/ G1/ 可简化/ 为/ G1/ ./ 由于/ 没有/ 程序/ 变量/ 可以/ 替代/ G1/ 中/ 的/ 虚拟/ 变量/ j/ ,/ 则/ 略去/ j/ ,/ 得到/ 结果/ 就是/ 图/ 8/ (/ 1/ )/ ./ 4.2/ 算法/ 终止/ 的/ 讨论/ 图/ 13/ 算法/ 终止/ 取决于/ 下面/ 3/ 点/ :/ (/ 1/ )/ 算法/ 第/ (/ 3/ )/ 步/ 的/ 抽象/ 能够/ 成功/ ./ (/ 2/ )/ 算法/ 第/ (/ 4/ )/ 步/ 的/ 蕴涵/ 式/ 的/ 证明/ 因/ 得到/ 结果/ 而/ 终止/ 或/ 因/ 形状/ 检查/ 发现错误/ 而/ 终止/ ./ Page11/ 蕴涵/ 式/ 最终/ 会/ 成立/ ./ (/ 3/ )/ 若/ 形状/ 检查/ 没有/ 发现错误/ ,/ 算法/ 第/ (/ 4/ )/ 步/ 的/ 该/ 算法/ 终止/ 的/ 理由/ 概述/ 如下/ :/ (/ 1/ )/ 本文/ 为/ 循环体/ S/ 的/ 每条/ 执行/ 路径/ 都/ 安排/ 累计/ 该/ 路径/ 执行/ 次数/ 的/ 虚拟/ 变量/ ./ 选择/ 一种/ 合适/ 的/ 虚拟/ 变量/ 命名/ 方式/ ,/ 能/ 应对/ 出现/ 并列/ 和/ 嵌套循环/ 的/ 情况/ 以及/ 循环体/ 中/ 出现/ 并列/ 和/ 嵌套/ 条件/ 语句/ 的/ 情况/ ./ 在/ 增加/ 虚拟/ 变量/ 时/ ,/ 还要/ 把/ 表达/ 虚拟/ 变量/ 之间/ 关系/ 的/ 等式/ 或/ 不等式/ 加/ 到/ 相关/ 形状/ 图中/ ./ 通过/ 增设/ 虚拟/ 变量/ ,/ 结合/ 下面/ (/ 2/ )/ 有关/ 浓缩/ 节点/ 的/ e/ 表达式/ 为/ 线性/ 的/ 讨论/ ,/ 算法/ 第/ (/ 3/ )/ 步/ 的/ 抽象/ 就/ 能够/ 成功/ ,/ 即/ 可以/ 把/ 浓缩/ 节点/ 所/ 概括/ 的/ 节点/ 数/ 抽象/ 为/ 用/ 含/ 相应/ 虚拟/ 变量/ 的/ 线性/ 表达式/ 来/ 表示/ ./ (/ 2/ )/ 从/ 第/ 3/ 节/ 知道/ ,/ 形状/ 图/ 蕴涵/ 关系/ 判定/ 方法/ 的/ 终止/ 性/ 依赖于/ 判断/ 浓缩/ 节点/ 之间/ 蕴涵/ 与否/ 的/ (/ e/ =/ =/ e/ ∧/ a/ )/ / a/ 的/ 证明/ 的/ 终止/ 性/ ./ 下面/ 是/ 相关/ 的/ 分析/ ./ 对于/ 循环体/ S/ 的/ 任意/ 一条/ 执行/ 路径/ ,/ 对于/ 除/ 第/ 1/ 次/ 迭代/ 计算/ 以外/ 的/ 其他/ 各/ 次/ 迭代/ 计算/ 的/ 结果/ 形状/ 图/ ,/ 若/ 与/ 上次/ 迭代/ 计算/ 的/ 结果/ 形状/ 图/ 相比/ ,/ 某/ 浓缩/ 节点/ 所/ 代表/ 的/ 节点/ 数/ 发生变化/ ,/ 则/ 再次/ 迭代/ 计算/ 引起/ 的/ 变化/ 与/ 本次/ 迭代/ 计算/ 的/ 变化/ 相同/ ./ 若/ 循环/ 前/ 某/ 浓缩/ 节点/ 代表/ ax/ +/ b/ 个/ 节点/ ,/ 第/ 1/ 次/ 迭代/ 时/ ,/ 个数/ 变化/ 是/ d/ ,/ 随后/ 各/ 次/ 迭代/ 的/ 个数/ 变化/ 是/ c/ ,/ 则/ 该/ 路径/ 执行/ y/ (/ y/ >/ 1/ )/ 次/ 结束/ 时/ ,/ 该/ 浓缩/ 节点/ 代表/ 的/ 节点/ 数是/ (/ ax/ +/ b/ )/ +/ (/ cy/ +/ d/ )/ ,/ 由于/ (/ ax/ +/ b/ )/ 在/ 循环/ 执行/ 过程/ 中/ 不变/ ,/ 因此/ 在/ 图/ 13/ 算法/ 中/ 证明/ 形状/ 图/ 之间/ 的/ 蕴涵/ 时/ 可/ 当成/ 常量/ ./ 这样/ ,/ 在/ 每次/ 迭代/ 计算/ 过程/ 中/ ,/ 浓缩/ 节点/ 所/ 代表/ 节点/ 的/ 个数/ 本质/ 上/ 可用/ 该/ 路径/ 的/ 虚拟/ 变量/ 的/ 线性/ 表达式/ 来/ 表示/ ,/ 这/ 就/ 保证/ 了/ 该/ 浓缩/ 节点/ 的/ 表达式/ e/ 维持/ 为/ 线性/ ./ 类似/ 的/ 分析/ 可知/ a/ 中/ 的/ 整型/ 表达式/ 也/ 是/ 线性/ ./ 这/ 就/ 保证/ (/ e/ =/ =/ e/ ∧/ a/ )/ / a/ 的/ 证明/ 会/ 终止/ ./ 图/ 14/ 例子/ 的/ 迭代/ 过程/ 体现/ 了/ 这里/ 所说/ 的/ 对/ 浓缩/ 节点/ 的/ 抽象/ ./ 另一方面/ ,/ 在/ 有/ p/ =/ p/ →/ next/ 这样/ 指针/ 赋值/ 的/ 情况/ 下/ ,/ 除/ 第/ 1/ 次/ 迭代/ 计算/ 外/ ,/ 若/ 一次/ 迭代/ 计算/ 的/ 结果/ 形状/ 图中/ 出现/ 无/ 声明/ 节点/ 指向/ 的/ 结构/ 节点/ ,/ 但/ 又/ 不能/ 折叠/ 成/ (/ 或/ 并入/ 相邻/ )/ 浓缩/ 节点/ ./ 则/ 表明/ 该/ 结构/ 节点/ 的/ 出边/ 的/ 指向/ 不/ 符合/ 数据结构/ 定义/ 的/ 要求/ ,/ 先前/ 关于/ 循环/ 语句/ 的/ 3/ 种/ 用法/ 中/ 不会/ 出现/ 这样/ 的/ 情况/ ./ 因此/ ,/ 若经/ 抽象/ 后/ ,/ 相邻/ 2/ 个/ 声明/ 指针/ 所/ 指向/ 的/ 节点/ 之间/ 的/ 结构/ 和/ 浓缩/ 节点/ 的/ 个数/ 大于/ 3/ (/ 简称/ 节点/ 个数/ 约束/ )/ ,/ 则/ 在/ 循环体/ 结束/ 点/ 的/ 形状/ 检查/ [/ 10/ ]/ 会/ 报告/ 错误/ 并/ 终止/ 迭代/ ./ 例如/ ,/ 对于/ 各/ 节点/ 都/ 有/ 指针/ 域/ l/ 和/ r/ 的/ 双向/ 非空/ 链表/ ,/ 用/ 循环/ 依次/ 将/ 各/ 节点/ 的/ l/ 域置/ 为/ NULL/ 且/ r/ 域/ 的/ 指向/ 不变/ ./ 代码/ 如下/ :/ p/ =/ head/ ;/ while/ (/ p/ →/ r/ !/ =/ NULL/ )/ {/ p/ =/ p/ →/ r/ ;/ p/ →/ l/ =/ NULL/ ;/ }/ 这/ 相当于/ 废弃/ l/ 域/ ,/ 用/ r/ 来/ 构成/ 一个/ 单链/ 表/ ./ 图/ 15/ (/ 1/ )/ 是/ 循环/ 入口/ 的/ 形状/ 图/ ,/ 图/ 15/ (/ 2/ )/ 是/ 经过/ 3/ 次/ 迭代/ 的/ 形状/ 图/ ./ 本/ 算法/ 无法/ 把/ 已经/ 遍历/ 过/ 的/ 结构/ 节点/ 折叠为/ 浓缩/ 节点/ ,/ 因为/ 双向/ 链表/ 没有/ 相应/ 的/ 规则/ ./ 形状/ 检查/ 会因/ 两个/ 相邻/ 声明/ 节点/ 超出/ 节点/ 个数/ 约束/ 而/ 报告/ 错误/ ./ Page12/ 图/ 15/ 循环/ 不变/ 形状/ 图/ 推断/ 过程/ 报告/ 错误/ 的/ 例子/ (/ 3/ )/ 由于/ 声明/ 指针/ 的/ 个数/ 有限/ ,/ 再/ 加上/ (/ 2/ )/ 提到/ 的/ 节点/ 个数/ 约束/ ,/ 在/ 循环体/ 结束/ 点能/ 形成/ 的/ 不等价/ 形状/ 图/ 有限/ ./ 若未见/ 报告/ 程序/ 错误/ ,/ 则/ 一定/ 存在/ i/ ,/ 使得/ / i/ +/ 1/ / / 0/ ∨/ …/ ∨/ / i/ 成立/ ./ 4.3/ 递归函数/ 前后/ 形状/ 图/ 的/ 推断/ 对于/ 非/ 递归函数/ ,/ 可以/ 从/ 函数/ 前/ 形状/ 图/ 自动/ 推断/ 函数/ 后/ 形状/ 图/ ./ 但/ 该/ 方法/ 难以/ 用到/ 有/ 指针/ 型形/ 参且/ 返回值/ 是/ 指针/ 的/ 递归函数/ ,/ 因为/ 推断/ 递归函数/ 前后/ 形状/ 图时/ 要/ 用到/ 该/ 函数/ 的/ 前后/ 形状/ 图/ ./ 若仅/ 有/ 指针/ 型/ 的/ 形参/ ,/ 或仅/ 有/ 指针/ 型/ 的/ 返回值/ ,/ 根据/ 形状/ 系统对/ 函数调用/ 点/ 和/ 返回/ 点/ 的/ 形状/ 约束/ ,/ 函数/ 的/ 递归性/ 并/ 没有/ 给/ 形状/ 分析/ 带来/ 困难/ ./ 倘若/ 形参/ 和/ 返回值/ 都/ 是/ 指针/ 型/ ,/ 则/ 虽/ 有/ 形状/ 系统/ 的/ 约束/ ,/ 在/ 函数/ 返回/ 点/ 也/ 不能/ 确定/ 实参/ 指针/ 和/ 返回/ 指针/ 之间/ 的/ 关系/ ,/ 因而/ 不能/ 确定/ 函数/ 后/ 形状/ 图/ ./ 关注/ 实参/ 指针/ 是因为/ 它/ 的/ 值/ 在/ 被/ 调用函数/ 中/ 虽/ 不变/ ,/ 但/ 其/ 指向/ 的/ 节点/ 在/ 数据结构/ 中/ 的/ 位置/ 可能/ 会变/ ./ 为此/ ,/ 函数/ 的/ 前/ 形状/ 图/ 增设/ 虚拟/ 变量/ 来/ 表示/ 实参/ 指针/ ,/ 它/ 与/ 形参/ 指针/ 指向/ 同一个/ 节点/ ,/ 并/ 据此/ 来/ 推断/ 函数/ 后/ 形状/ 图/ ./ 可以/ 像/ 推断/ 循环/ 不变/ 形状/ 图/ 那样/ 迭代/ 推断/ 函数/ 后/ 形状/ 图/ ./ 因为/ 计算/ 会/ 终止/ 的/ 递归函数/ 总有/ 非/ 递归/ 的/ 出口/ ,/ 可以/ 先/ 通过/ 非/ 递归/ 路径/ 得到/ 函数/ 后/ 形状/ 图/ 的/ 初值/ ,/ 然后/ 再/ 在/ 递归/ 路径/ 上/ 迭代/ 求解/ ./ 对于/ 直接/ 递归函数/ ,/ 若/ 函数/ 体中/ 的/ 循环/ 语句/ 里面/ 没有/ 递归/ 调用/ (/ 通常/ 如此/ )/ ,/ 则/ 函数/ 前后/ 形状/ 图/ 的/ 推断/ 方法/ 概述/ 如下/ :/ (/ 1/ )/ 通过/ 程序/ 分析/ ,/ 确定/ 函数/ 体/ 中非/ 递归/ 执行/ 路径/ 和/ 递归/ 执行/ 路径/ 的/ 语句/ 序列/ ./ 这里/ 所说/ 的/ 执行/ 路径/ 把/ 无/ 递归/ 调用/ 的/ 循环/ 语句/ 看成/ 一个/ 语句/ ,/ 把/ 两个/ 分支/ 都/ 有/ (/ 或/ 都/ 无/ )/ 递归/ 调用/ 的/ 条件/ 语句/ 也/ 看成/ 一个/ 语句/ ,/ 以/ 减少/ 要/ 考虑/ 的/ 路径/ 数/ ./ 为/ 叙述/ 方便/ ,/ 假定/ 非/ 递归/ 和/ 递归/ 的/ 执行/ 路径/ 各/ 一条/ ,/ 语句/ 序列/ 分别/ 是/ Snon/ 和/ Srec/ ./ (/ 2/ )/ 从/ 函数/ 前/ 形状/ 图/ / entry/ 和/ Snon/ 通过/ 形状/ 图/ 逻辑/ 的/ 规则/ 得到/ / 0/ ,/ 使得/ {/ / entry/ }/ Snon/ {/ / 0/ }/ ./ 令/ i/ =/ 0/ ./ (/ 3/ )/ 根据/ 形状/ 图/ 逻辑/ 的/ 规则/ 计算/ / i/ +/ 1/ ,/ 使得/ {/ / entry/ }/ Srec/ {/ / i/ +/ 1/ }/ ./ 其中/ / entry/ 和/ / i/ 作为/ Srec/ 中/ 出现/ 的/ 递归函数/ 调用/ 的/ 前后/ 形状/ 图/ ./ (/ 4/ )/ 应用/ 抽象/ 规则/ 计算/ / i/ +/ 1/ ,/ 使得/ / i/ +/ 1/ / / i/ +/ 1/ ./ (/ 5/ )/ 若/ / i/ +/ 1/ / / 0/ ∨/ …/ ∨/ / i/ ,/ 则/ / 0/ ∨/ …/ ∨/ / i/ 是/ 函数/ 后/ 形状/ 图/ ;/ 否则/ ,/ i/ =/ i/ +/ 1/ ,/ 转/ (/ 3/ )/ ./ 除了/ 推断/ 递归函数/ 的/ 函数/ 前后/ 条件/ 需先/ 分析/ 函数/ 的/ 非/ 递归/ 和/ 递归/ 的/ 执行/ 路径/ 外/ ,/ 本/ 算法/ 与/ 图/ 13/ 算法/ 没有/ 本质/ 上/ 的/ 区别/ ,/ 把/ 本/ 算法/ 的/ 第/ (/ 2/ )/ 到/ (/ 5/ )/ 步/ 与/ 图/ 13/ 算法/ 的/ 第/ (/ 1/ )/ 到/ (/ 4/ )/ 步/ 比较/ 就/ 可以/ 看出/ 这/ 一点/ ./ 5/ 形状/ 图/ 理论/ 和/ 整数/ 理论/ 组合/ 的/ 判定/ 方法/ 在/ 程序验证/ 器/ 原型/ 中/ ,/ 验证/ 条件/ 生成器/ 所/ 产生/ 的/ 验证/ 条件/ 的/ 一般/ 形式/ 是/ :/ (/ G1/ ,/ 1/ ∧/ Q1/ ,/ 1/ )/ ∨/ …/ ∨/ (/ G1/ ,/ m/ ∧/ Q1/ ,/ m/ )/ / (/ G2/ ,/ 1/ ∧/ Q2/ ,/ 1/ )/ ∨/ …/ ∨/ (/ G2/ ,/ n/ ∧/ Q2/ ,/ n/ )/ 其中/ Q/ 代表/ 符号/ 断言/ 的/ 合取/ ,/ 并且/ 其中/ 没有/ 指针/ 相等/ 性/ 断言/ 和/ 有效性/ 断言/ ./ 验证/ 条件/ 的/ 证明/ 是/ 形状/ 图/ 理论/ 和/ 整数/ 线性/ 算术/ 理论/ 的/ 组合/ 的/ 判定/ 问题/ ./ 首先/ ,/ 形状/ 图/ 之间/ 蕴涵/ 的/ 证明/ 要/ 根据/ 形状/ 图/ 理论/ ./ 其次/ ,/ Q/ 中像/ p/ →/ d/ </ q/ →/ nxt/ →/ d/ 这样/ 的/ 断言/ ,/ 需要/ 根据/ 形状/ 图来/ 判断/ p/ →/ d/ 和/ q/ →/ nxt/ →/ d/ 分别/ 是/ 属于/ 哪个/ 节点/ 的/ 数据/ ./ 注意/ ,/ 在/ 形状/ 图中/ ,/ 浓缩/ 节点/ 和/ 谓词/ 节点/ 可能/ 附带/ e/ 和/ a/ ./ 这/ 表明/ 形状/ 图/ 理论/ 内部/ 涉及/ 线性/ 整数/ 算术/ 理论/ ./ 它/ 与/ 本节/ 讨论/ 的/ 理论/ 组合/ 的/ 判定/ 问题/ 没有/ 联系/ ,/ 因为/ 系统/ 原型/ 限定/ e/ 和/ a/ 只/ 依赖/ 整型/ 声明/ 变量/ ,/ 不/ 依赖于/ 节点/ 的/ 数据/ ./ 因为/ e/ 和/ a/ 是/ 决定/ 该/ 浓缩/ 节点/ 或/ 谓词/ 节点/ 所/ 代表/ 的/ 链表/ (/ 段/ )/ 的/ 长度/ 、/ 或者/ 所/ 代表/ 的/ 二叉树/ 片段/ 的/ 高度/ 的/ 表达式/ 和/ 断言/ ,/ 通常/ 在/ 实际/ 编程/ 中/ 不会/ 把/ 决定/ 某种/ 数据结构/ 的/ 长度/ 或/ 高度/ 的/ 信息/ 存放/ 在/ 该/ 数据结构/ 节点/ 的/ 域/ 中/ ./ 本节/ 讨论/ 组合/ 理论/ 的/ 两种/ 证明/ 方式/ ./ 5.1/ 易变/ 数据结构/ 上/ 被/ 关注/ 性质/ 的/ 描述/ 通常/ 关注/ 易变/ 数据结构/ 3/ 个/ 层次/ 的/ 性质/ :/ (/ 1/ )/ 各个/ 节点/ 是否/ 连接成/ 预定/ 的/ 形状/ 该/ 性质/ 的/ 验证/ 在/ 形状/ 分析阶段/ 完成/ ,/ 程序员/ 只要/ 像/ 声明/ 类型/ 那样/ 声明/ 形状/ 即可/ ./ 这仅/ 是/ 形状/ 图/ 理论/ 上/ 的/ 问题/ ./ Page13/ (/ 2/ )/ 与/ 形状/ 有关/ 的/ 性质/ 例如/ 链表/ 的/ 长度/ 、/ 树/ 的/ 高度/ 、/ 二叉树/ 的/ 两边/ 是否/ 平衡/ 和/ 节点/ 之间/ 的/ 可达性/ 等/ ./ 这些/ 性质/ 很/ 容易/ 归纳定义/ ,/ 虽然/ 循环/ 链表/ 的/ 长度/ 的/ 归纳定义/ 会/ 略显/ 复杂/ ./ (/ 3/ )/ 与/ 各/ 节点/ 上/ 数据/ 排列/ 有关/ 的/ 性质/ 当/ 数据/ 需/ 按序/ 排列/ 时/ ,/ 一个/ 数据/ 存放/ 到/ 哪个/ 节点/ 依赖于/ 对/ 数据结构/ 上/ 节点/ 的/ 定序/ ./ 线性/ 链表/ 上/ 节点/ 之间/ 的/ 定序/ 比较简单/ ,/ 二叉树/ 上/ 节点/ 之间/ 有/ 多种/ 定序/ 方式/ ./ 这样/ ,/ 数据/ 是否/ 有序/ 的/ 比较/ 必定/ 涉及/ 数据/ 所属/ 节点/ 在/ 数据结构/ 上/ 的/ 位置/ ./ 在/ 定义/ 上述/ 性质/ 时/ ,/ 比较简单/ 的/ 方式/ 是/ 用以/ 指针/ 为/ 参数/ (/ 可能/ 还有/ 其他/ 参数/ )/ 的/ 归纳/ 谓词/ ./ 另/ 一种/ 方式/ 是/ 先/ 定义/ 节点/ 之间/ 的/ 可达/ 关系/ ,/ 然后/ 基于/ 此/ 再/ 使用/ 量词/ 来/ 定义/ 所/ 需/ 的/ 性质/ ./ 用/ 这/ 两种/ 方式/ 描述/ 性质/ 都/ 比较/ 有利于/ 对/ 操作/ 易变/ 数据结构/ 的/ 递归/ 程序/ 的/ 验证/ ./ 本文/ 的/ 系统/ 原型/ 针对/ 形状/ 图上/ 浓缩/ 节点/ 的/ 特点/ ,/ 还/ 提供/ 使用/ 量词/ 来/ 概括/ 数据/ 性质/ 的/ 方式/ ,/ 以/ 方便/ 操作/ 易变/ 数据结构/ 的/ 循环/ 程序/ 的/ 验证/ ./ 例如/ 有序/ 单链/ 表/ 可定义/ 为/ SortedList/ (/ Node/ / p/ )/ / / m/ :/ / / / ./ (/ p/ (/ →/ nxt/ )/ m/ =/ =/ NULL/ ∧/ / i/ :/ 1/ ../ m/ -/ 1/ ./ p/ (/ →/ nxt/ )/ i/ -/ 1/ →/ d/ </ =/ p/ (/ →/ nxt/ )/ i/ →/ d/ )/ 其中/ Node/ 类型/ 由/ typedefstructnode/ {/ intd/ ;/ structnode/ / nxt/ }/ Node/ 给出/ ,/ 其中/ p/ (/ →/ nxt/ )/ i/ 代表/ p/ →/ nxt/ …/ →/ nxt/ ,/ 共/ i/ 个/ “/ →/ nxt/ ”/ ./ 在/ 该/ 定义/ 中/ ,/ 量词/ 的/ 约束/ 变元/ 出现/ 在/ 访问/ 路径/ 的/ 上/ 角标/ 中/ ./ 这种/ 直接/ 基于/ 编程语言/ 中/ 访问/ 路径/ 语法/ 的/ 定义/ 显得/ 比较/ 直观/ ./ 5.2/ 符号/ 断言/ 语言/ 语言/ 的/ 抽象/ 语法/ 描述/ 在/ 图/ 16/ ./ 几点/ 说明/ 如下/ :/ 为/ 便于/ 下面/ 的/ 讨论/ ,/ 将/ 系统/ 原型/ 所/ 使用/ 的/ 断言/ id/ ∈/ Identifier/ (/ 程序/ 中/ 的/ 标识符/ 集/ )/ tn/ ∈/ Sidentifier/ (/ 程序/ 中/ 结构/ 体/ 类型/ 的/ 名字/ 集/ )/ predicatedefinitionpd/ ∷/ =/ predicateid/ (/ pp1/ ,/ …/ ,/ ppk/ )/ =/ apredicateparameterpp/ ∷/ =/ tidparametertypet/ ∷/ =/ int/ |/ tn/ / propertytheorempt/ ∷/ =/ theorema1/ / a2/ |/ theorema1/ / a2assertion/ (/ boolexp/ 是/ 布尔/ 表达式/ ,/ 其/ 产生/ 式/ 略去/ )/ a/ ∷/ =/ boolexp/ |/ / id/ :/ d/ ./ a/ |/ / id/ :/ d/ ./ a/ |/ (/ a/ )/ domain/ (/ intexp/ 是/ 整型/ 表达式/ ,/ 其/ 产生/ 式/ 略去/ )/ d/ ∷/ =/ / |/ / |/ / l/ -/ valuelv/ ∷/ =/ …/ |/ lv/ (/ →/ id/ )/ intexp/ (/ 1/ )/ 图/ 16/ 前/ 一部分/ 是/ 自定义/ 谓词/ 以及/ 这些/ 谓词/ 之间/ 性质/ 定理/ 的/ 语法/ ,/ 后/ 一部分/ 是/ 断言/ 的/ 语法/ ./ 谓词/ 应用/ 可/ 出现/ 在/ 布尔/ 表达式/ 中/ ,/ 因而/ 可/ 出现/ 在/ 断言/ 中/ ./ (/ 2/ )/ 程序员/ 用图/ 16/ 的/ 文法/ 编写/ 的/ 断言/ 中/ 出现/ 的/ 变量/ ,/ 若/ 不是/ 程序/ 变量/ ,/ 则/ 称之为/ 逻辑/ 变量/ ./ (/ 3/ )/ 量词/ 约束/ 变元/ 的/ 论域/ 只能/ 是/ 整数/ 域/ 或/ 它/ 的/ 某个/ 区间/ ,/ 因而/ 禁止/ 使用/ 指针/ 型/ 约束/ 变元/ ./ 在/ 需要/ 由/ 存在/ 量词/ 来/ 约束/ 指针/ 型/ 变元/ 的/ 地方/ ,/ 可以/ 用/ 指针/ 型/ 逻辑/ 变量/ 来/ 代替/ ./ 下面/ 用/ 有序/ 单链/ 表来/ 解释/ 为什么/ 需要/ 提供/ 性质/ 定理/ ./ 有序/ 单链/ 表/ 的/ 归纳定义/ 如下/ :/ SortedList/ (/ Node/ / p/ )/ / p/ =/ =/ NULL/ ∨/ p/ →/ nxt/ =/ =/ NULL/ ∨/ p/ →/ d/ </ =/ p/ →/ nxt/ →/ d/ ∧/ SortedList/ (/ p/ →/ nxt/ )/ 在/ 一个/ 子句/ 中/ ,/ 若/ 出现/ 以/ p/ 为/ 前缀/ 的/ 访问/ 路径/ ,/ 则/ 默认/ 有/ 断言/ p/ !/ =/ NULL/ ./ SortedList/ 的/ 定义/ 从表尾/ 向/ 表头/ 方向/ 归纳/ ./ 但是/ ,/ 在/ 遍历/ 有序/ 单链/ 表时/ ,/ 例如/ 图/ 17/ 单链/ 表/ 插入/ 函数/ 中/ 的/ 循环/ 代码/ (/ 暂且/ 不/ 关心/ 图/ 17/ 中/ 的/ 断言/ )/ ,/ 其/ 遍历/ 方向/ 是从/ 表头/ 向表尾/ ,/ 因此/ 还/ 需要/ 用/ 下述/ 表段/ 谓词/ 和/ 性质/ 定理/ ./ SortedListSeg/ (/ Node/ / p/ ,/ Node/ / q/ )/ / p/ =/ =/ q/ ∧/ q/ !/ =/ NULL/ ∨/ p/ →/ d/ </ =/ p/ →/ nxt/ →/ d/ ∧/ SortedListSeg/ (/ p/ →/ nxt/ ,/ q/ )/ 和/ SortedListSeg/ (/ p/ ,/ q/ )/ ∧/ q/ →/ d/ </ =/ q/ →/ nxt/ →/ d/ / SortedListSeg/ (/ p/ ,/ q/ →/ nxt/ )/ 这个/ 性质/ 定理/ 保证/ 已/ 扫描/ 过/ 的/ 表段/ 再/ 加入/ 下/ 一个/ 被/ 扫描/ 的/ 节点/ ,/ 结果/ 仍然/ 是/ 表段/ ./ 如下/ 性质/ 定理/ 也/ 是/ 验证/ 时/ 不可/ 缺/ 的/ :/ SortedList/ 和/ SortedListSeg/ 两个/ 谓词/ 之间/ 的/ SortedListSeg/ (/ p/ ,/ q/ )/ ∧/ SortedList/ (/ q/ )/ / SortedList/ (/ p/ )/ 上述/ 2/ 个/ 性质/ 定理/ 都/ 需要/ 程序员/ 提供/ ,/ 因为/ 它们/ 的/ 证明/ 需要/ 基于/ 表段/ 的/ 长度/ 进行/ 归纳/ ,/ 基于/ 演绎推理/ 的/ 自动/ 定理/ 证明/ 器/ 难以/ 发现/ 这样/ 的/ 性质/ ./ SortedList/ 谓词/ 出现/ 在/ 函数/ 的/ 前后/ 断言/ 中/ ,/ 而/ SortedListSeg/ 谓词/ 出现/ 在/ 循环/ 不变式/ 中/ ./ 后者/ 的/ 定义/ 只要/ 能/ 支持/ 函数/ 前后/ 条件/ 的/ 证明/ 就/ 足矣/ ,/ 没有/ 必要/ 选择/ 最/ 一般/ 的/ 定义/ ,/ 即/ 把/ 被/ 验证/ 函数/ 中/ 不会/ 出现/ 的/ 情况/ 也/ 囊括/ 在内/ ,/ 以免/ 给/ 验证/ 增添/ 不必要/ 的/ 麻烦/ ./ 在/ 断言/ 文法/ 及其/ 类型/ 系统/ 的/ 基础/ 上/ ,/ 还要/ 限制/ 断言/ 中/ 的/ 整型/ 表达式/ 必须/ 是/ 线性/ 表达式/ ./ Page14typedefstructnode/ {/ structnode/ / nxt/ ;/ intd/ ;/ }/ Node/ ;/ // / singly/ -/ linkedlist/ / // // / @/ assertionm/ =/ =/ length/ (/ head/ ,/ nxt/ )/ ∧/ oldhead/ =/ =/ head/ ∧/ i/ :/ 1/ ../ m/ -/ 1/ ./ (/ head/ (/ →/ nxt/ )/ i/ -/ 1/ →/ d/ </ =/ head/ (/ →/ nxt/ )/ i/ →/ d/ )/ oldhead/ 是/ 为/ 记住/ 实参/ 指针/ 的/ 值/ 而/ 引入/ 的/ 逻辑/ 变量/ / // Node/ / insert/ (/ Node/ / head/ ,/ intdata/ )/ {/ Node/ / ptr/ ;/ Node/ / ptr1/ ;/ Node/ / p/ ;/ intj/ ;/ p/ =/ malloc/ (/ Node/ / )/ ;/ p/ →/ d/ =/ data/ ;/ p/ →/ nxt/ =/ NULL/ ;/ if/ (/ head/ =/ =/ NULL/ )/ {/ head/ =/ p/ ;/ }/ elseif/ (/ p/ →/ d/ </ =/ head/ →/ d/ )/ {/ p/ →/ nxt/ =/ head/ ;/ head/ =/ p/ ;/ }/ else/ {/ ptr1/ =/ head/ ;/ ptr/ =/ head/ →/ nxt/ ;/ j/ =/ 1/ ;/ // / @/ loop/ _/ invariantptr/ !/ =/ NULL/ ∧/ / i/ :/ 1/ ../ j/ -/ 1/ ./ (/ head/ (/ →/ nxt/ )/ i/ -/ 1/ →/ d/ </ =/ head/ (/ →/ nxt/ )/ i/ →/ d/ )/ ∧/ ptr1/ →/ d/ </ =/ ptr/ →/ d/ ∧/ ptr1/ →/ d/ </ p/ →/ d/ ∧/ j/ >/ =/ 1/ ∧/ oldhead/ =/ =/ head/ ∧/ / i/ :/ 1/ ../ m/ -/ j/ -/ 1/ ./ (/ ptr/ (/ →/ nxt/ )/ i/ -/ 1/ →/ d/ </ =/ ptr/ (/ →/ nxt/ )/ i/ →/ d/ )/ ∨/ ptr/ =/ =/ NULL/ ∧/ / i/ :/ 1/ ../ j/ -/ 1/ ./ (/ head/ (/ →/ nxt/ )/ i/ -/ 1/ →/ d/ </ =/ head/ (/ →/ nxt/ )/ i/ →/ d/ )/ ∧/ ptr1/ →/ d/ </ p/ →/ d/ ∧/ j/ >/ =/ 1/ ∧/ oldhead/ =/ =/ head/ / // while/ (/ (/ ptr/ !/ =/ NULL/ )/ &&/ (/ ptr/ →/ d/ </ p/ →/ d/ )/ )/ {/ ptr1/ =/ ptr/ ;/ ptr/ =/ ptr/ →/ nxt/ ;/ j/ =/ j/ +/ 1/ ;/ }/ p/ →/ nxt/ =/ ptr1/ →/ nxt/ ;/ ptr1/ →/ nxt/ =/ p/ ;/ }/ returnhead/ ;/ }/ // / @/ assertionlength/ (/ head/ ,/ nxt/ )/ =/ =/ m/ +/ 1/ ∧/ / i/ :/ 1/ ../ m/ ./ (/ head/ (/ →/ nxt/ )/ i/ -/ 1/ →/ d/ </ =/ head/ (/ →/ nxt/ )/ i/ →/ d/ )/ ∧/ oldhead/ =/ =/ NULL/ ∨/ head/ →/ d/ </ =/ oldhead/ →/ nxt/ →/ d/ ∧/ oldhead/ =/ =/ head/ →/ nxt/ ∧/ length/ (/ oldhead/ ,/ nxt/ )/ =/ =/ m/ ∧/ / i/ :/ 1/ ../ m/ -/ 1/ ./ (/ oldhead/ (/ →/ nxt/ )/ i/ -/ 1/ →/ d/ </ =/ oldhead/ (/ →/ nxt/ )/ i/ →/ d/ )/ ∨/ length/ (/ head/ ,/ nxt/ )/ =/ =/ m/ +/ 1/ ∧/ / i/ :/ 1/ ../ m/ ./ (/ head/ (/ →/ nxt/ )/ i/ -/ 1/ →/ d/ </ =/ head/ (/ →/ nxt/ )/ i/ →/ d/ )/ ∧/ oldhead/ =/ =/ head/ / // 图/ 17/ 单链/ 表/ 的/ 插入/ 函数/ 5.3/ 验证/ 条件/ 的/ 证明/ 方法/ 对于/ 验证/ 条件/ (/ G1/ ,/ 1/ ∧/ Q1/ ,/ 1/ )/ ∨/ …/ ∨/ (/ G1/ ,/ m/ ∧/ Q1/ ,/ m/ )/ / (/ G2/ ,/ 1/ ∧/ Q2/ ,/ 1/ )/ ∨/ …/ ∨/ (/ G2/ ,/ n/ ∧/ Q2/ ,/ n/ )/ ,/ 在/ 形状/ 分析阶段/ 已经/ 证明/ 了/ 即/ 对/ 每个/ G1/ ,/ i/ (/ 1/ / i/ / m/ )/ ,/ 存在/ G2/ ,/ j/ (/ 1/ / j/ / n/ )/ ,/ 使得/ G1/ ,/ i/ / G2/ ,/ j/ ./ 现在/ 仅/ 需要/ 证明/ :/ 对/ 每个/ G1/ ,/ i/ ∧/ Q1/ ,/ i/ ,/ 存在/ G2/ ,/ j/ ∧/ Q2/ ,/ j/ (/ 其中/ G1/ ,/ i/ / G2/ ,/ j/ 已经/ 证明/ )/ ,/ 使得/ G1/ ,/ i/ ∧/ Q1/ ,/ i/ / Q2/ ,/ j/ ./ 可/ 把/ G1/ ,/ i/ 看成/ Q1/ ,/ i/ / Q2/ ,/ j/ 的/ 证明/ 环境/ ,/ 写成/ G1/ ,/ i/ / Q1/ ,/ i/ / Q2/ ,/ j/ ./ 实际证明/ 时/ ,/ 还有/ 程序员/ 提供/ 的/ 谓词/ 定义/ 和/ 性质/ 定理/ 可用/ ,/ 用/ 字母/ T/ 表示/ ,/ 因此/ 下面/ 仅/ 关注/ G/ ,/ T/ / Q/ / Q/ 的/ 证明/ 方法/ ./ G/ ,/ T/ / Q/ / Q/ 的/ 证明/ 有/ 两种/ 方式/ :/ 第/ 1/ 种/ 是/ 常规/ 的/ 方式/ ,/ 把/ 形状/ 图/ 理论/ 和/ 整数/ 理论/ 组合/ 的/ 判定/ 转换/ 为/ 整数/ 理论/ 上/ 的/ 判定/ ./ 它/ 通过/ 引入/ 一些/ 未解释/ 函数/ ,/ 把/ G/ 转换成/ 符号/ 断言/ P/ ,/ 然后/ 把/ / (/ P/ ∧/ T/ ∧/ Q/ / Q/ )/ 交给/ Z3/ ./ 具体/ 把/ 形状/ 图/ 转换/ 为/ 符号/ 断言/ 的/ 方法/ 见/ 文献/ [/ 14/ ]/ ./ 这种/ 方式/ 的/ 缺点/ 是/ ,/ 在/ 推理/ Q/ 中/ 涉及/ 节点/ 数据/ 的/ 断言/ 时/ ,/ 指针/ 符号/ 断言/ P/ 不能/ 像/ 形状/ 图/ G/ 那样/ 提供/ 对/ 形状/ 的/ 全局/ 把握/ ,/ 从而/ 某些/ 验证/ 条件/ 用/ Z3/ 证不出/ ./ 举例说明/ 如下/ :/ 例/ 1/ ./ 单链/ 表/ 的/ 插入/ 函数/ ,/ 代码/ 和/ 断言/ 见图/ 17/ ./ 该例/ 的/ 循环/ 不变/ 形状/ 图是/ 根据/ 4.1/ 节/ 的/ 算法/ 自动/ 推断/ 的/ ./ 为/ 可读/ 起见/ ,/ 断言/ 都/ 出现/ 在/ 注释/ 中/ ./ 图/ 18/ 是/ return/ 语句/ 之前/ 程序/ 点/ 形状/ 图/ G1/ ,/ 1/ ∨/ G1/ ,/ 2/ ∨/ G1/ ,/ 3/ ∨/ G1/ ,/ 4/ (/ 分别/ 对应/ 只有/ 新/ 插入/ 节点/ 、/ 插/ 在/ 表头/ 、/ 插/ 在/ 表中/ 和/ 插/ 在/ 表尾/ 4/ 种/ 情况/ )/ 中/ 的/ G1/ ,/ 3/ ,/ 其中/ head/ 是/ 为/ 表示/ 实参/ 指针/ 而/ 增设/ 的/ 虚拟/ 变量/ ,/ 对应/ 的/ Q1/ ,/ 3/ 是/ 下述/ 符号/ 断言/ ,/ 其中/ 有序性/ 用/ 全称/ 量化/ 断言/ 表示/ :/ / i/ :/ 1/ ../ j/ -/ 1/ ./ (/ head/ (/ →/ nxt/ )/ i/ -/ 1/ →/ d/ </ =/ head/ (/ →/ nxt/ )/ i/ →/ d/ )/ ∧/ ptr1/ →/ d/ </ p/ →/ d/ ∧/ p/ →/ d/ </ =/ ptr/ →/ d/ ∧/ j/ >/ =/ 1/ ∧/ / i/ :/ 1/ ../ m/ -/ j/ -/ 1/ ./ (/ ptr/ (/ →/ nxt/ )/ i/ -/ 1/ →/ d/ </ =/ ptr/ (/ →/ nxt/ )/ i/ →/ d/ )/ G1/ ,/ 3/ 转换成/ 的/ 符号/ 断言/ 如下/ :/ head/ =/ =/ head/ ∧/ ptr1/ =/ =/ head/ (/ →/ nxt/ )/ j/ -/ 1/ ∧/ p/ =/ =/ ptr1/ →/ nxt/ ∧/ ptr/ =/ =/ p/ →/ nxt/ ∧/ ptr/ (/ →/ nxt/ )/ m/ -/ j/ =/ =/ NULL/ ∧/ length/ (/ head/ ,/ nxt/ )/ =/ =/ j/ -/ 1/ +/ 2/ +/ m/ -/ j/ 由/ G1/ ,/ 3/ 转换/ 得到/ 的/ 断言/ 是/ 一些/ 有关/ 有效/ 指针/ 相等/ 、/ 指针/ 等于/ NULL/ 和/ 链表/ 长度/ 的/ 断言/ ,/ 它们/ 是/ 形状/ 图所/ 包含/ 信息/ 的/ 符号/ 表示/ ./ 其他/ 信息/ ,/ 例如/ p/ =/ =/ head/ (/ →/ nxt/ )/ j/ 可以/ 从/ 这些/ 断言/ 推导/ ./ 显然/ ,/ 这些/ 断言/ 和/ Q1/ ,/ 3/ 的/ 合取/ 能/ 蕴涵/ 函数/ 后/ 条件/ 中/ 的/ 第/ 3/ 种/ 情况/ (/ 即图/ 17/ 中/ 的/ 最后/ 一行/ ,/ 记为/ Q2/ ,/ 3/ )/ ./ 把/ 这些/ 符号/ 断言/ 转换成/ Z3/ 能/ 接受/ 的/ 形式/ 的/ 转换方法/ 见/ 文献/ [/ 14/ ]/ ./ Page15/ 用/ Z3/ 证明/ 不了/ 这样/ 的/ 蕴涵/ ./ 原因/ 是/ 在/ 符号/ 断言/ 中/ ,/ Z3/ 难以/ 发现/ Q1/ ,/ 3/ 中/ 4/ 个/ 断言/ 的/ 前后/ 衔接/ 次序/ ./ 若/ 有/ 图/ 18/ 的/ 形状/ 图/ ,/ 通过/ 把/ 这/ 4/ 个/ 断言/ 分别/ 标注/ 到/ 相关/ 节点/ 上/ ,/ 则/ 很/ 容易/ 发现/ 它们/ 合并/ 后/ 就是/ Q2/ ,/ 3/ 中/ 的/ 全称/ 断言/ ./ 采用/ 第/ 1/ 种/ 方式/ 的/ 另/ 一个/ 问题/ 是/ ,/ 若/ 与/ 某个/ 归纳/ 谓词/ 定义/ 相对/ 应/ 的/ 某条/ 展开/ 规则/ 对/ 验证/ 来说/ 是/ 需要/ 的/ ,/ 则/ 容易/ 引起/ Z3/ 不停/ 地用/ 该/ 展开/ 规则/ 去/ 展开/ 断言/ 中/ 出现/ 的/ 谓词/ 应用/ ,/ 导致/ 证明/ 不/ 终止/ ./ 第/ 2/ 种/ 证明/ 方式/ 是/ 把/ 形状/ 图/ 直接/ 用于/ G/ ,/ T/ / Q/ / Q/ 的/ 证明/ ./ 参照/ Nelson/ -/ Oppen/ 框架/ [/ 10/ ]/ ,/ 本文/ 提出/ 的/ G/ ,/ T/ / Q/ / Q/ 的/ 证明/ 方法/ 概述/ 为/ 如下/ 3/ 步/ :/ (/ 1/ )/ 将/ Q/ (/ 形式/ 为/ Q1/ ∧/ …/ ∧/ Qm/ )/ 中/ 所有/ 与/ 节点/ 相关/ 的/ Qj/ (/ 1/ / j/ / m/ )/ 都/ 标注/ 在/ G/ 中/ 相关/ 的/ 节点/ 上/ ./ ①/ 相关/ 的/ 节点/ 是/ 指/ 断言/ 中/ 的/ 指针/ 型/ 访问/ 路径/ (/ 包括/ 整型/ 访问/ 路径/ 的/ 最长/ 指针/ 型/ 前缀/ )/ 所/ 到达/ 的/ 节点/ ./ 例如/ ,/ 例/ 1/ 中/ Q1/ ,/ 3/ 的/ 断言/ ptr1/ →/ d/ </ =/ p/ →/ d/ 标注/ 在/ 图/ 18/ 中/ ptr1/ 和/ p/ 指向/ 的/ 节点/ 上/ ,/ 断言/ p/ →/ d/ </ ptr/ →/ d/ 标注/ 在/ 图/ 18/ 中/ p/ 和/ ptr/ 指向/ 的/ 节点/ 上/ ./ ②/ 全称/ 断言/ 经常/ 标注/ 在/ 某个/ 浓缩/ 节点/ 上/ ./ 若/ 在/ 一个/ 全称/ 断言/ 中/ ,/ 约束/ 变元/ 的/ 取值/ 集合/ 使得/ 该/ 断言/ 与/ 多个/ 节点/ 相关/ ,/ 则/ 把/ 该/ 断言/ 同时/ 标注/ 在/ 这些/ 节点/ 上/ ./ 例/ 1/ 中/ Q1/ ,/ 3/ 的/ 全称/ 断言/ / i/ :/ 1/ ../ m/ -/ j/ -/ 1/ ./ (/ ptr/ (/ →/ nxt/ )/ i/ -/ 1/ →/ d/ </ =/ ptr/ (/ →/ nxt/ )/ i/ →/ d/ )/ 标注/ 在/ 图/ 18/ 中/ ptr/ 指向/ 的/ 节点/ 上/ ,/ 断言/ / i/ :/ 1/ ../ j/ -/ 1/ ./ (/ head/ (/ →/ nxt/ )/ i/ -/ 1/ →/ d/ </ =/ head/ (/ →/ nxt/ )/ i/ →/ d/ )/ 标注/ 在/ 图/ 18/ 中/ head/ 和/ ptr1/ 指向/ 的/ 两个/ 节点/ 上/ ./ 对于/ 有/ 两个/ 指针/ 变元/ 的/ 谓词/ 应用/ ,/ 情况/ 与/ 全称/ 断言/ 的/ 类似/ ./ (/ 2/ )/ 把/ 能/ 推导/ 出/ 的/ 性质/ 继续/ 标注/ 在/ G/ 的/ 相关/ 节点/ 上/ ,/ 一直/ 到/ G/ 的/ 节点/ 都/ 不会/ 再/ 增加/ 新/ 的/ 性质/ 为止/ ./ ①/ 新/ 性质/ 的/ 相关/ 节点/ 若/ 都/ 不/ 在/ G/ 中/ ,/ 则/ 无须/ 标注/ 这类/ 新/ 性质/ ,/ 这/ 有利于/ 保证/ 推导/ 过程/ 的/ 终止/ ./ ②/ 对于/ 标注/ 有/ 全称/ 断言/ 的/ 浓缩/ 节点/ ,/ 注意/ 它/ 与/ 相邻/ 节点/ 之间/ 是否/ 可以/ 利用/ (/ (/ / i/ :/ m/ ../ n/ -/ 1/ ./ P/ (/ i/ )/ )/ ∧/ P/ (/ n/ )/ )/ / / i/ :/ m/ ../ n/ ./ P/ (/ i/ )/ 等/ 等价/ 性来/ 使得/ 全称/ 断言/ 的/ 约束/ 变元/ 的/ 取值/ 范围/ 扩大/ ./ (/ 3/ )/ 对/ Q/ (/ 形式/ 为/ Q1/ ∧/ …/ ∧/ Qk/ )/ 中/ 的/ 每个/ Qj/ (/ 1/ / j/ / k/ )/ ,/ 检查/ Q/ / Qj/ 是否/ 成立/ ./ ①/ 若/ Qj/ 是/ 节点/ 相关/ 的/ 断言/ ./ 不论是/ 谓词/ 应用/ 、/ 全称/ 断言/ 还是/ 整数/ 断言/ ,/ 若/ Qj/ 从/ 相关/ 节点/ 的/ 断言/ 以及/ Q/ 中/ 与/ 节点/ 无关/ 的/ 断言/ 可/ 推导/ ,/ 则/ Q/ / Qj/ 成立/ ,/ 否则/ 不/ 成立/ ./ 节点/ 数据/ 之间/ 的/ 关系/ 可能/ 通过/ 与/ 节点/ 无关/ 的/ 断言/ 来/ 传递/ ,/ 因此/ 这里/ 强调/ 包括/ Q/ 中/ 与/ 节点/ 无关/ 的/ 断言/ ./ 例如/ ,/ 若/ p/ →/ d/ =/ =/ m/ 且/ p/ →/ nxt/ →/ d/ =/ =/ n/ 且/ m/ </ n/ ,/ 则/ p/ →/ d/ </ p/ →/ nxt/ →/ d/ ./ ②/ 若/ Qj/ 是/ 节点/ 无关/ 的/ 断言/ ./ 若/ Q/ 不能/ 从/ Q/ 推导/ ,/ 则/ Q/ / Qj/ 不/ 成立/ ./ 若/ 对/ 每个/ Qj/ (/ 1/ / j/ / k/ )/ ,/ Q/ / Qj/ 都/ 可证/ ,/ 则/ G/ ,/ T/ / Q/ / Q/ 得证/ ./ 可以/ 证明/ ,/ 若/ 整数/ 域/ 上/ 断言/ 的/ 证明/ 都/ 可/ 终止/ ,/ 则/ 该/ 证明/ 过程/ 终止/ 并且/ 可靠/ ./ 这个/ 方法/ 专用/ 于/ 面向/ 操作/ 易变/ 数据结构/ 的/ 程序/ 的/ 验证/ ./ 与/ Nelson/ -/ Oppen/ 框架/ 不同/ 的/ 是/ ,/ 这里/ 没有/ 交错/ 使用/ 两个/ 理论/ 不断/ 推出/ 新/ 性质/ 并/ 进行/ 传播/ 的/ 过程/ ,/ 而是/ 在/ 形状/ 分析阶段/ 先/ 用/ 形状/ 图/ 理论/ 完成/ 形状/ 图/ 蕴涵/ 关系/ 的/ 证明/ ./ 这里/ 只是/ 利用/ 形状/ 图来/ 把/ 符号/ 断言/ 分组/ ,/ 一方面/ 便于/ 推导/ 更/ 多/ 对/ 验证/ 有用/ 的/ 性质/ ,/ 另一方面/ 防止出现/ 无止尽/ 地/ 推导/ ./ 另/ 一个/ 不同/ 是/ ,/ Nelson/ -/ Oppen/ 框架/ 限定/ 被/ 组合/ 的/ 理论/ 为/ 无/ 量词/ 的/ 一阶理论/ ,/ 而/ 这里/ 允许/ 量词/ 断言/ 出现/ 在/ 操作/ 易变/ 数据结构/ 的/ 程序/ 的/ 规范/ 中/ ./ 6/ 实例/ 分析/ 基于/ 形状/ 图/ 逻辑/ 所/ 实现/ 的/ 程序验证/ 器/ 原型/ (/ 可/ 从/ http/ :/ // // kyhcs/ ./ ustcsz/ ./ edu/ ./ cn/ // SGL/ 下载/ )/ [/ 14/ ]/ 的/ 流程/ 分成/ 下面/ 3/ 个/ 阶段/ ./ (/ 1/ )/ 预处理/ 阶段/ ./ 该/ 阶段/ 为/ 源代码/ 生成/ 抽象/ 语法/ 树/ 并/ 像/ 编译器/ 那样/ 完成/ 通常/ 的/ 静态/ 检查/ ;/ (/ 2/ )/ 形状/ 分析阶段/ ./ 生成/ 各/ 程序/ 点/ 的/ 形状/ 图/ ,/ 包括/ 推断/ 循环/ 不变/ 形状/ 图/ 和/ 递归函数/ 的/ 前后/ 形状/ 图/ ;/ (/ 3/ )/ 程序验证/ 阶段/ ./ 该/ 阶段/ 通过/ 正向/ 演算/ 生成/ 验证/ 条件/ ,/ 并用/ Z3/ 证明/ 它们/ ./ 程序员/ 在/ 编程/ 时/ ,/ 需要/ 提供/ 有关/ 节点/ 数据/ 的/ 函数/ 前后/ 条件/ 和/ 循环/ 不变式/ ./ 程序员/ 可以/ 定义/ 一些/ 归纳/ 谓词/ ,/ 用以/ 描述/ 递归/ 数据结构/ 的/ 数据/ 特点/ ,/ 以/ 方便/ 写/ 函数/ 前后/ 条件/ 和/ 循环/ 不变式/ ./ 程序员/ 需要/ 提供/ 这些/ 谓词/ 之间/ 的/ 、/ 与/ 程序/ 有关/ 的/ 归纳/ 性质/ ,/ 供/ 自动/ 定理/ 证明/ 器/ 使用/ ./ 因为/ 基于/ 演绎推理/ 的/ 证明/ 器/ 推导/ 不出/ 这类/ 性质/ ./ 该/ 原型/ 可以/ 验证/ 易变/ 数据结构/ 上/ 较为/ 复杂/ 的/ 程序/ ,/ 如/ 有序/ 循环/ 双向/ 链表/ 、/ 二叉/ 排序/ 树/ 、/ 伸展/ 树/ 、/ 树堆/ (/ treap/ )/ 、/ 二叉/ 平衡/ 树/ 和/ AA/ 树/ 的/ 插入/ 和/ 删除/ 函数/ ./ 有关/ 这些/ 例子/ 的/ 统计数据/ 见表/ 1/ ./ 其中/ 的/ 验证/ 时间/ 是/ 在/ Windows7PC/ ,/ IntelCorei5/ -/ 24003.1/ GHzCPU/ 和/ 4GB/ 内存/ 的/ 机器/ 上/ 实测/ 获得/ ./ 这些/ 程序/ 大/ Page16/ 多/ 包括/ 插入/ 和/ 删除/ 函数/ ,/ 以及/ 被/ 它们/ 调用/ 的/ 函数/ ./ 操作/ 二叉/ 平衡/ 树/ 的/ 程序/ 的/ 函数/ 最/ 多/ ,/ 因为/ 除了/ 插入/ 和表/ 1/ 有关/ 形状/ 图/ 和/ 验证/ 条件/ 的/ 统计数据/ 有序/ 单链/ 表/ :/ 插入/ 、/ 倒置/ 、/ 合并/ 二叉/ 排序/ 树/ :/ 递归/ 和/ 非/ 递归/ 插入/ 、/ 删除/ 00021330/ 表/ 1/ 各例/ 的/ 循环/ 不变/ 形状/ 图/ 都/ 是/ 用/ 本文/ 方法/ 自动/ 推断/ 的/ ./ 其中/ 有序/ 双向/ 链表/ 的/ 倒置/ 函数/ 虽/ 只有/ 两个/ 循环/ ,/ 但/ 验证/ 时间/ 明显/ 高于/ 其他/ 链表/ 程序/ ./ 这/ 是因为/ 在/ 用/ 循环/ 代码/ 倒置/ 双向/ 链表/ 过程/ 中/ ,/ 链表/ 被/ 分成/ 正向/ 和/ 逆向/ 两/ 部分/ ,/ 需要/ 多次/ 迭代/ 才能/ 得到/ 循环/ 不变/ 形状/ 图/ ,/ 并且/ 循环/ 不变/ 形状/ 图是/ 8/ 种/ 情况/ 的/ 析取/ ./ 表/ 1/ 各例/ 的/ 递归函数/ 的/ 前后/ 形状/ 图/ 也/ 都/ 是/ 用/ 本文/ 方法/ 自动/ 推断/ 的/ ./ 二叉/ 排序/ 树/ 插入/ 函数/ 的/ 前后/ 形状/ 图/ 分别/ 在/ 图/ 19/ 的/ (/ 1/ )/ 和/ (/ 2/ )/ 中/ ,/ 其中/ 函数/ 后/ 形状/ 图/ 分成/ 插入/ 前/ 实参/ 指向/ 非空表/ 和/ 空表/ 两种/ 情况/ ./ 从此/ 例/ 可以/ 看出/ 形状/ 图上/ 出现/ 对应/ 形参/ 指针/ p/ 的/ 实参/ 指针/ p/ 的/ 必要性/ ./ 其他/ 二叉树/ 的/ 插入/ 函数/ 的/ 后/ 形状/ 图/ 也/ 都/ 这样/ ./ 表/ 1/ 中/ 二叉/ 排序/ 树/ 的/ 验证/ 时间/ 远/ 低于/ 列/ 在/ 其后/ 的/ 4/ 种/ 二叉树/ ,/ 这/ 是因为/ 二叉/ 排序/ 树仅/ 需要/ 验证/ 有序性/ ,/ 而/ 其他/ 几种/ 二叉树/ 还/ 需要/ 验证/ 平衡性/ 或/ 类似/ 平衡性/ 的/ 性质/ ./ 伸展/ 树/ 的/ 代码/ 没有/ 递归/ ,/ 函数/ 个数/ 和/ 验证/ 条件/ 也/ 不算/ 多/ ,/ 但/ 验证/ 时间/ 远高于/ 其他/ 二叉树/ ./ 这/ 是因为/ 其/ splay/ 函数/ 的/ 循环/ 不变/ 形状/ 图是/ 20/ 多种/ 情况/ 的/ 析取/ ,/ 形状/ 分析阶段/ 和/ 程序验证/ 阶段/ 的/ 耗时/ 都/ 大大增加/ ./ 下面/ 再/ 介绍/ 1/ 个/ 规模/ 不大/ 但/ 能/ 帮助/ 理解/ 本文/ 的/ 删除/ 函数/ 外/ ,/ 还有/ 左旋/ 、/ 右旋/ 、/ 左/ 平衡/ 和/ 右/ 平衡/ 等/ 函数/ ./ 例子/ ./ 例/ 2/ ./ 二叉/ 排序/ 树/ 的/ 递归/ 插入/ 函数/ ,/ 代码/ 和/ 断言/ 见图/ 20/ ,/ 程序/ 断言/ 中/ 的/ y/ 和/ z/ 是/ 整型/ 逻辑/ 变量/ ./ 本例/ 引入/ 的/ 谓词/ 定义/ 如下/ :/ (/ 1/ )/ sorted/ (/ Node/ / p/ )/ / p/ =/ =/ NULL/ ∨/ (/ 2/ )/ gt/ (/ intm/ ,/ Node/ / p/ )/ / p/ =/ =/ NULL/ ∨/ (/ 3/ )/ lt/ (/ intm/ ,/ Note/ / p/ )/ / p/ =/ =/ NULL/ ∨/ 其中/ Node/ 的/ 定义/ 见图/ 20/ ./ 在/ 函数/ 前后/ 条件/ 中/ 分别/ 有/ y/ >/ data/ ∧/ gt/ (/ y/ ,/ p/ )/ 和/ gt/ (/ y/ ,/ p/ )/ ,/ 它们/ 是/ 说/ :/ 若/ y/ 大于/ 被/ 插入/ 的/ 数据/ 并/ 大于/ 参数/ 树上/ 的/ 所有/ 数据/ ,/ 则/ y/ 大于/ 结果/ 树上/ 的/ 所有/ 数据/ ./ z/ 的/ 含义/ 与/ y/ 类似/ ./ typedefstructnode/ {/ structnode/ / l/ ;/ structnode/ / r/ ;/ intd/ ;/ }/ Node/ ;/ // / @/ assertionsorted/ (/ p/ )/ ∧/ y/ >/ data/ ∧/ gt/ (/ y/ ,/ p/ )/ ∧/ z/ </ data/ ∧/ lt/ (/ z/ ,/ p/ )/ / // Node/ / insert/ (/ Node/ / p/ ,/ intdata/ )/ {/ if/ (/ p/ =/ =/ NULL/ )/ {/ p/ =/ malloc/ (/ Node/ )/ ;/ p/ →/ l/ =/ NULL/ ;/ p/ →/ r/ =/ NULL/ ;/ p/ →/ d/ =/ data/ ;/ }/ elseif/ (/ p/ →/ d/ >/ data/ )/ {/ p/ →/ l/ =/ insert/ (/ p/ →/ l/ ,/ data/ )/ ;/ }/ elseif/ (/ p/ →/ d/ </ data/ )/ {/ p/ →/ r/ =/ insert/ (/ p/ →/ r/ ,/ data/ )/ ;/ }/ returnp/ ;/ }/ // / @/ assertionsorted/ (/ p/ )/ ∧/ gt/ (/ y/ ,/ p/ )/ ∧/ lt/ (/ z/ ,/ p/ )/ / // 引入/ 的/ 性质/ 定理/ 有/ :/ (/ 1/ )/ x/ </ y/ ∧/ lt/ (/ y/ ,/ p/ )/ / lt/ (/ x/ ,/ p/ )/ (/ 2/ )/ x/ >/ y/ ∧/ gt/ (/ y/ ,/ p/ )/ / gt/ (/ x/ ,/ p/ )/ 在/ 函数/ 出口/ 点/ 产生/ 的/ 验证/ 条件/ 包括/ 下述/ 蕴涵/ 式/ ,/ 它/ 表示/ 图/ 20/ 中/ 第/ 1/ 个/ 递归/ 调用/ 后/ 的/ 断言/ 蕴涵/ 函数/ 后/ 条件/ :/ sorted/ (/ p/ →/ r/ )/ ∧/ lt/ (/ p/ →/ d/ ,/ p/ →/ r/ )/ ∧/ y/ >/ p/ →/ d/ ∧/ gt/ (/ y/ ,/ p/ →/ r/ )/ ∧/ z/ </ p/ →/ d/ ∧/ lt/ (/ z/ ,/ p/ →/ r/ )/ ∧/ Page17y/ >/ data/ ∧/ z/ </ data/ ∧/ p/ →/ d/ >/ data/ ∧/ sorted/ (/ p/ →/ l/ )/ ∧/ gt/ (/ y/ ,/ p/ →/ l/ )/ ∧/ lt/ (/ z/ ,/ p/ →/ l/ )/ ∧/ gt/ (/ p/ →/ d/ ,/ p/ →/ l/ )/ / sorted/ (/ p/ )/ ∧/ gt/ (/ y/ ,/ p/ )/ ∧/ lt/ (/ z/ ,/ p/ )/ 其中/ 蕴含/ 式/ 的/ 前件/ 中/ 的/ 前/ 三行/ 断言/ 是从/ 调用/ 点前/ 延续/ 到/ 调用/ 点后/ ,/ 后/ 两行/ 断言/ 是从/ 函数/ 后/ 条件/ 得到/ ./ 在/ 递归/ 调用/ 结束/ 后/ ,/ 能/ 得到/ 第/ 5/ 行/ gt/ (/ p/ →/ d/ ,/ p/ →/ l/ )/ 的/ 原因/ 是/ :/ 在/ 递归/ 调用/ 点前/ ,/ 有/ p/ →/ d/ >/ data/ 与/ gt/ (/ p/ →/ d/ ,/ p/ →/ l/ )/ ,/ 因此/ p/ →/ d/ 可/ 与/ 被/ 调用/ 的/ 递归函数/ 的/ 前/ 、/ 后/ 条件/ 中/ 的/ 逻辑/ 变量/ y/ 匹配/ ./ 图/ 19/ (/ 2/ )/ 两种/ 情况/ 分别/ 都/ 属于/ 该/ 蕴涵/ 式/ 的/ 证明/ 环境/ ./ 按照/ 第/ 5/ 节所/ 提出/ 的/ 直接/ 把/ 形状/ 图/ 用于/ 证明/ G/ ,/ T/ / Q/ / Q/ 的/ 方法/ ,/ 把/ 该/ 蕴涵/ 式/ 前件/ 的/ 断言/ 分别/ 对图/ 19/ (/ 2/ )/ 两种/ 情况/ 的/ 形状/ 图/ 标注/ 如下/ :/ (/ 1/ )/ 根/ 节点/ :/ gt/ (/ p/ →/ d/ ,/ p/ →/ l/ )/ ,/ lt/ (/ p/ →/ d/ ,/ p/ →/ r/ )/ ,/ (/ 2/ )/ 左子/ 节点/ :/ sorted/ (/ p/ →/ l/ )/ ,/ gt/ (/ p/ →/ d/ ,/ p/ →/ l/ )/ ,/ (/ 3/ )/ 右子/ 节点/ :/ sorted/ (/ p/ →/ r/ )/ ,/ lt/ (/ p/ →/ d/ ,/ p/ →/ r/ )/ ,/ 再/ 把/ 利用/ 谓词/ 定义/ 和/ 性质/ 定理/ 能/ 推导/ 出/ 的/ 断言/ 增加/ 到/ 这些/ 节点/ 上/ :/ (/ 1/ )/ 根/ 节点/ :/ sorted/ (/ p/ )/ ,/ gt/ (/ y/ ,/ p/ )/ ,/ lt/ (/ z/ ,/ p/ )/ ;/ (/ 2/ )/ 左子/ 节点/ :/ 无/ 增加/ ;/ (/ 3/ )/ 右子/ 节点/ :/ 无/ 增加/ ./ 该/ 蕴涵/ 式/ 在/ 这/ 两种/ 情况/ 下/ 都/ 得证/ ,/ 因为/ 其后/ 件/ 的/ 断言/ 都/ 已经/ 标注/ 在/ 根/ 节点/ 上/ 了/ ./ Z3/ 在/ 未能/ 得出/ 待证/ 断言/ 有效/ 或/ 不可/ 满足/ 时/ ,/ 总/ 试图/ 继续/ 推导/ 出/ 更/ 多/ 的/ 性质/ ./ 一种/ 情况/ 是/ 它/ 不断/ 地/ 把/ 归纳/ 谓词/ 展开/ ,/ 导致/ 证明/ 过程/ 不/ 终止/ ./ 针对/ 操作/ 易变/ 数据结构/ 的/ 程序/ 的/ 验证/ ,/ 直接/ 把/ 形状/ 图/ 用于/ 验证/ 条件/ 的/ 证明/ 可以/ 有效/ 地/ 阻止/ 这种/ 不/ 终止/ ./ 从例/ 2/ 可以/ 看出/ ,/ 在/ 生成/ 验证/ 条件/ 的/ 演算/ 过程/ 中/ ,/ 符号/ 断言/ 中/ 的/ 谓词/ 断言/ 的/ 展开/ 和/ 形状/ 图上/ 谓词/ 节点/ 的/ 展开/ 本质/ 上/ 是/ 同步/ 的/ ./ 从例/ 1/ 也/ 可以/ 看出/ ,/ 全称/ 断言/ 的/ 展开/ (/ 指从/ / x/ :/ m/ ../ n/ ./ φ/ (/ x/ )/ (/ m/ </ =/ n/ )/ 变换/ 成/ φ/ (/ m/ )/ ∧/ / x/ :/ m/ +/ 1/ ../ n/ ./ φ/ (/ x/ )/ (/ m/ </ =/ n/ )/ 等/ 情况/ )/ 和/ 形状/ 图上/ 浓缩/ 节点/ 的/ 展开/ 也/ 是/ 同步/ 的/ ./ 由此可知/ ,/ 在/ 证明/ 验证/ 条件/ 时/ ,/ 在/ 把/ 断言/ 按/ 节点/ 分组/ 和/ 推导/ 新/ 性质/ 的/ 过程/ 中/ ,/ 若/ 谓词/ 展开式/ 中/ 与/ 节点/ 有关/ 的/ 断言/ 在/ 形状/ 图上/ 没有/ 可/ 挂靠/ 的/ 节点/ ,/ 则/ 该/ 谓词/ 展开/ 也/ 不会/ 给/ 证明/ 带来/ 什么/ 帮助/ ,/ 因而/ 不必/ 展开/ ./ 本文/ 并/ 没有/ 把/ 第/ 5/ 节所/ 提出/ 的/ 形状/ 图/ 理论/ 和/ 整数/ 理论/ 组合/ 的/ 证明/ 方法/ 实现/ 到/ Z3/ 中/ ,/ 而是/ 在/ 验证/ 器/ 原型/ 中/ 根据/ 该/ 方法/ 的/ 思想/ 对/ 验证/ 条件/ 进行/ 预处理/ 后/ 再/ 交给/ Z3/ ,/ 扩大/ 了/ 可证/ 的/ 范围/ ,/ 并/ 减少/ 了/ Z3/ 不/ 终止/ 的/ 情况/ ./ 7/ 相关/ 工作/ 比较/ 分离/ 逻辑/ 是/ 验证/ 堆/ 操作程序/ (/ 操作/ 易变/ 数据结构/ 的/ 指针/ 操作程序/ 是/ 其/ 重要/ 部分/ )/ 的/ 最/ 流行/ 的/ 手工/ 或/ 半自动/ 推理/ 的/ 程序逻辑/ [/ 15/ ]/ ./ 除了/ 分离/ 逻辑/ 外/ ,/ 还/ 存在/ 一些/ 其它/ 逻辑/ ,/ 如/ 匹配/ 逻辑/ [/ 16/ ]/ ,/ 也/ 是/ 用于/ 手工/ 或/ 半自动/ 的/ 推理/ ./ 分离/ 逻辑/ 引入/ 一种/ 专用/ 的/ 分离/ 符号/ (/ / )/ ,/ 用/ 它/ 把/ 不能/ 混淆/ 到/ 一起/ 推理/ 并且/ 不能/ 被/ 忽略/ 的/ 断言/ 分离/ 开来/ ./ 分离/ 逻辑/ 的/ 优点/ 和/ 缺点/ 都/ 源自/ 其/ 引入/ 的/ 分离/ 概念/ ./ 分离/ 的/ 好处/ 之一/ 是/ 避免/ 了/ 访问/ 路径/ 别名/ 给/ 程序验证/ 带来/ 的/ 困难/ ;/ 其/ 缺点/ 是/ 分离/ 切断/ 了/ 不同/ 堆块/ 之间/ 的/ 信息/ 联系/ ,/ 给/ 需要/ 全局/ 信息/ 才能/ 推断/ 的/ 程序/ 性质/ 的/ 验证/ 带来/ 困难/ ./ 例如/ ,/ 分离/ 逻辑/ 难以/ 发现/ 对/ 某堆/ 块/ 的/ 一个/ 指针/ 域/ 的/ 赋值/ 引起/ 另/ 一个/ 堆块/ 的/ 泄漏/ ./ 对于/ 堆/ 操作程序/ 的/ 验证/ ,/ 通常/ 允许/ 用户/ 定义/ 的/ 归纳/ 谓词/ ./ 在/ 分离/ 逻辑/ 的/ 环境/ 下/ ,/ 必须/ 另行/ 设计/ 归纳/ 谓词/ 的/ 展开/ 或/ 折叠/ 策略/ ,/ 否则/ 因/ 归纳/ 谓词/ 的/ 展开/ 没有/ 控制/ 而/ 导致/ 验证/ 条件/ 的/ 证明/ 可能/ 不/ 终止/ ./ 因此/ ,/ 分离/ 逻辑/ 的/ 证明/ 辅助工具/ 经常/ 是/ 启发式/ 且/ 不/ 完备/ 的/ [/ 17/ ]/ ./ 最近/ 也/ 出现/ 了/ 一些/ 小/ 的/ 判定/ 片断/ [/ 18/ -/ 21/ ]/ ./ 其中/ 文献/ [/ 20/ ]/ 提出/ 了/ 一种/ 有效/ 、/ 可靠/ 和/ 完备/ 的/ 自动/ 定理/ 证明/ 器/ ,/ 用于/ 检查/ 带表段/ 谓词/ 的/ 分离/ 逻辑/ 公式/ 之间/ 蕴涵/ 的/ 有效性/ ,/ 但/ 它/ 只能/ 用于/ 操作/ 单链/ 表/ 的/ 程序/ ./ 文献/ [/ 21/ ]/ 提出/ 分离/ 逻辑/ 一个/ 较/ 小/ 的/ 可/ 判定/ 片段/ 与/ 其他/ 可/ 判定/ 的/ 一阶理论/ 的/ 组合/ 理论/ 的/ 判定/ 方法/ ./ 形状/ 图/ 逻辑/ 的/ 最大/ 特点/ 是/ ,/ 形状/ 图/ 既/ 是/ 机器/ 状态/ 中/ 有关/ 堆/ 部分/ 的/ 抽象/ 表示/ ,/ 又/ 是/ 指针/ 相等/ 性/ 断言/ 和/ 有效性/ 断言/ 等/ 的/ 图形/ 表示/ ,/ 它/ 总揽/ 了/ 分离性/ 和/ 整体性/ [/ 10/ ]/ ,/ 至少/ 带来/ 下面/ 的/ 好处/ :/ (/ 1/ )/ 形状/ 图/ 逻辑/ 无须/ 使用/ 分离/ 合取/ 算符/ ,/ 避免/ 了/ 引入/ 分离/ 合取/ 算符/ 给/ 定理/ 证明/ 带来/ 的/ 复杂性/ ./ 在/ 形状/ 图上/ ,/ 关联/ 到/ 不同/ 节点/ 的/ 断言/ ,/ 就是/ 分离/ 逻辑/ 中/ 用/ 分离/ 合取/ 算符/ 隔开/ 的/ 断言/ ./ (/ 2/ )/ 形状/ 图/ 提供/ 了/ 全局/ 信息/ ./ ①/ 用/ 形状/ 图/ 逻辑/ 很/ 容易/ 发现/ 对/ 某堆/ 块/ 的/ 一个/ 指针/ 域/ 的/ 赋值/ 引起/ 另/ 一个/ 堆块/ 的/ 泄漏/ ./ ②/ 形状/ 图/ 可用/ 来/ 指导/ 验证/ 条件/ 证明/ 过程/ 中/ 与/ 易变/ 数据结构/ 有关/ 的/ 归纳/ 性质/ 的/ 展开/ ,/ 以/ 避免/ 证明/ 过程/ 的/ 不/ 终止/ ./ Page18/ 分离/ 逻辑/ 优于/ 形状/ 图/ 逻辑/ 的/ 重要/ 一点/ 是/ 它/ 适用/ 于/ 汇编语言/ 级/ 的/ 程序/ 推理/ [/ 22/ ]/ ./ 使用/ 分离/ 逻辑/ ,/ 但/ 验证/ 条件/ 的/ 证明/ 策略/ 类似/ 本文/ 方法/ 的/ 是/ Chin/ 等/ 人/ 的/ 论文/ [/ 23/ ]/ ./ 他们/ 设计/ 了/ 一个/ 蕴涵/ 检查/ 过程/ ,/ 该/ 过程/ 使用/ 展开/ 和/ 折叠/ 推理/ ,/ 能够/ 处理/ 可能/ 是/ 归纳定义/ 的/ 良基/ 谓词/ ./ 其中/ 的/ 创新/ 点/ 是/ 他们/ 找到/ 了/ 一种/ 在/ 有/ 用户/ 定义/ 归纳/ 谓词/ 情况/ 下/ ,/ 保证/ 过程/ 可靠/ 和/ 终止/ 的/ 充分条件/ ./ 该/ 过程/ 把/ 验证/ 条件/ 简化/ 到/ 标准/ 的/ 逻辑/ 理论/ ./ 该/ 过程/ 能够/ 处理/ 的/ 易变/ 数据结构/ 超越/ 了/ 树/ ./ 用/ 符号/ 堆/ 也/ 是/ 把握/ 程序/ 状态/ 中/ 的/ 指针/ 信息/ 以/ 避免/ 使用/ 分离/ 逻辑/ ,/ 从而/ 可/ 自动/ 推理/ 的/ 办法/ ./ Madhusudan/ 等/ 人/ [/ 24/ ]/ 使用/ 节点/ 集合/ 和/ 声明/ 变量/ 集合/ ,/ 还有/ 代表/ 有/ 向/ 边集/ 、/ 节点/ 到值/ 的/ 映射/ 和/ 声明/ 变量/ 到值/ 的/ 映射/ 的/ 若干/ 函数/ 来/ 描述/ 程序/ 状态/ ./ 该文/ 的/ 内存/ 印迹/ (/ footprint/ )/ 由/ 符号/ 堆/ 和/ DRYAD/ 公式/ 组成/ ,/ 它们/ 分别/ 对应/ 到/ 本文/ 的/ 形状/ 图/ G/ 和/ 数据结构/ 所/ 需/ 满足/ 的/ 除了/ 形状/ 以外/ 的/ 性质/ Q/ ./ DRYAD/ 是/ 分离/ 逻辑/ 的/ 一种/ 方言/ ,/ 本质/ 上/ 是/ 堆/ 上/ 无/ 量词/ 一阶/ 逻辑/ ,/ 并用/ 多个/ 类型/ 的/ 归纳定义/ 来/ 增强/ ,/ 这些/ 类型/ 是/ 为/ 其/ 下/ 有/ 树结构/ 的/ 存储单元/ 定义/ 的/ ./ 它用/ 一个/ 可靠/ 且/ 终止/ 的/ 过程/ ,/ 来/ 证明/ 用/ 命令式/ 语言/ 编写/ 的/ 树结构/ 上/ 很多/ 递归/ 算法/ 的/ 功能/ 完全/ 正确性/ ./ Qiu/ 等/ 人/ [/ 25/ ]/ 使用/ 集合论/ ,/ 把/ DRYAD/ 翻译成/ 带/ 递归/ 的/ 经典/ 逻辑/ ,/ 并/ 提出/ 一种/ 自然/ 证明/ 技术/ 来/ 证明/ 验证/ 条件/ ./ 这种/ 技术/ 提供/ 在/ 手工/ 证明/ 中/ 常用/ 的/ 证明/ 策略/ 来/ 帮助/ 验证/ ,/ 并/ 把/ 这些/ 策略/ 自动/ 部署/ 到/ 代码/ 中/ ./ Pek/ 等/ 人/ [/ 26/ ]/ 为/ 利用/ VCC/ 框架/ [/ 27/ ]/ ,/ 把/ 自然/ 证明/ 策略/ 翻译成/ 嵌/ 在/ VCC/ 标注/ 中/ 的/ 幽灵/ 代码/ ,/ 促成/ VCC/ 获得/ 采用/ 可/ 判定/ 理论/ 的/ 自然/ 证明/ ./ 经过/ 这些/ 努力/ ,/ 他们/ 的/ 工具/ 能够/ 验证/ 多种/ 常见/ 的/ 、/ 包括/ 用/ 递归/ 或/ 迭代/ 方式/ 实现/ 的/ 、/ 操作/ 易变/ 数据结构/ 的/ 程序/ ./ 本文/ 与/ Qiu/ 和/ Edgar/ 等/ 方法/ 的/ 主要/ 区别/ 有/ 3/ 点/ ./ 首先/ ,/ 有关/ 易变/ 数据结构/ 的/ 形状/ 的/ 验证/ ,/ 本文/ 是/ 基于/ 形状/ 图/ 蕴涵/ 理论/ ,/ 直接/ 在/ 形状/ 图上/ 而/ 不是/ 在/ 符号/ 断言/ 上/ 验证/ ./ 其次/ ,/ 有关/ 归纳/ 谓词/ 的/ 展开/ 策略/ ,/ 他们/ 采用/ 由/ 程序员/ 提供/ 证明/ 策略/ 的/ 方式/ ,/ 而/ 本文/ 所/ 设计/ 的/ 方法/ 是/ 利用/ 已经/ 建立/ 的/ 形状/ 图来/ 指导/ 归纳/ 谓词/ 的/ 展开/ 和/ 折迭/ ./ 最后/ ,/ 他们/ 的/ 方法/ 必须/ 由/ 程序员/ 提供/ 完整/ 的/ 循环/ 不变式/ ,/ 而/ 我们/ 的/ 方法/ 自动/ 推断/ 有关/ 形状/ 部分/ 的/ 循环/ 不变式/ ./ 研究/ 全自动/ 推理/ 的/ 逻辑/ 的/ 目标/ 是/ 研发/ 快速/ 、/ 可靠/ 和/ 完备/ 的/ 判定/ 过程/ ./ 为/ 达到/ 该/ 目标/ ,/ 这些/ 逻辑/ 的/ 表达力/ 通常/ 受到/ 严重/ 的/ 限制/ ./ 对于/ 堆/ 操作程序/ 的/ 验证/ 逻辑/ 来说/ ,/ 使用/ 可达性/ 谓词/ 是/ 一种/ 避开/ 分离/ 逻辑/ 的/ 常用/ 简便/ 方式/ ,/ 但/ 表达能力/ 上/ 受到/ 较大/ 限制/ ./ 具体/ 例子/ 有/ 在/ 一阶/ 逻辑/ 上/ 扩展/ 可达性/ 的/ 若干/ 逻辑/ 、/ LISBQ/ [/ 28/ ]/ 、/ CSL/ [/ 29/ ]/ 及/ 组合/ 树/ 逻辑/ 和/ 整数/ 逻辑/ 的/ STRANDdecLISBQ/ 逻辑/ 提供/ 一种/ 带/ 受限/ 的/ 可达性/ 谓词/ 和/ 量化/ 的/ 推理/ ./ 这种/ 逻辑/ 有/ 完全/ 自动/ 、/ 可靠/ 、/ 完备/ 和/ 终止/ 的/ 判定/ 过程/ ./ 虽然/ 这是/ 一个/ 高效/ 的/ 判定/ 过程/ ,/ 但是/ 在/ 描述/ 归纳/ 数据结构/ 性质/ 时/ 表达力/ 上/ 非常/ 有限/ ./ STRANDdec/ 也/ 是/ 一种/ 这样/ 的/ 逻辑/ ,/ 它/ 能够/ 应对/ 某些/ 数据结构/ 的/ 性质/ ,/ 并且/ 通过/ 组合/ 可/ 判定/ 的/ 树/ 理论/ 和/ 算术/ 理论/ ,/ 容许/ 可/ 判定/ 的/ 片断/ ./ 然而/ 它/ 在/ 表达力/ 上/ 极其/ 有限/ ./ 这些/ 逻辑/ 都/ 不足以/ 描述/ 诸如/ 平衡/ 二叉树/ 的/ 平衡性/ 和/ 堆/ 中/ 的/ 一组/ 键值/ 在/ 通过/ 一段/ 程序/ 后/ 没有/ 改变/ 等/ 复杂/ 性质/ ./ 在/ 有关/ 指针/ 性质/ 的/ 循环/ 不变式/ 推断/ 上/ ,/ Magill/ 等/ 人/ [/ 31/ ]/ 提出/ 了/ 一种/ 用/ 分离/ 逻辑/ 推断/ 单链/ 表/ 操作程序/ 的/ 循环/ 不变式/ 的/ 方法/ ./ 他们/ 使用/ 符号执行/ 机制/ ,/ 并且/ 给出/ 一组/ 重写/ 规则/ 来/ 交互/ 地/ 计算/ 不动点/ ./ 所/ 实现/ 的/ 原型/ 仅/ 完成/ 了/ 计算/ 表长/ 、/ 求/ 各/ 节点/ 数据/ 的/ 和/ 、/ 以及/ 链表/ 的/ 删除/ 、/ 倒置/ 、/ 合并/ 和/ 拆分/ 这/ 几种/ 简单/ 的/ 单链/ 表/ 操作/ 函数/ 的/ 循环/ 不变式/ 的/ 推断/ ./ Distefano/ 等/ 人/ [/ 32/ ]/ 提出/ 了/ 一种/ 类似/ 的/ 基于/ 分离/ 逻辑/ 的/ 形状/ 分析方法/ ./ 和/ 文献/ [/ 31/ ]/ 一样/ ,/ 它/ 使用/ 了/ 专为/ 单链/ 表/ 的/ 展开/ 和/ 折叠/ 而/ 设计/ 的/ 单链/ 表/ 谓词/ ,/ 也/ 需要/ 关于/ 易变/ 数据结构/ 形状/ 的/ 先验/ 知识/ ,/ 并且/ 也/ 使用/ 符号执行/ 机制/ ./ 但是/ 它/ 的/ 单链/ 表/ 谓词/ 和/ 文献/ [/ 31/ ]/ 的/ 不同/ ,/ 与/ 文献/ [/ 28/ ]/ 相比/ ,/ 它/ 还/ 能/ 计算/ 循环/ 单链/ 表/ 操作/ 函数/ 的/ 循环/ 不变式/ ,/ 例如/ 循环/ 单链/ 表/ 的/ 删除/ 函数/ 和/ 过滤器/ 函数/ ./ Guo/ 等/ 人/ [/ 33/ ]/ 提出/ 了/ 一种/ 基于/ 分离/ 逻辑/ 的/ 过程/ 间/ 形状/ 分析/ ,/ 它/ 执行/ 归纳/ 的/ 递归/ 综合/ ,/ 以/ 自动/ 推断/ 有/ 类似/ 树/ 骨架/ 的/ 任意/ 递归/ 形状/ 不变式/ ./ 其/ 主要/ 特点/ 是从/ 循环体/ 的/ 固定/ 迭代/ 次数/ 的/ 符号执行/ 中/ 抽取/ 循环/ 不变式/ ,/ 但是/ 只能/ 用于/ 树/ 骨架/ 的/ 形状/ ./ 对于/ 单链/ 表/ 、/ 循环/ 单链/ 表/ 和/ 二叉树/ ,/ Qin/ 等/ 人/ [/ 34/ ]/ 不仅/ 能/ 推断/ 有关/ 形状/ 的/ 循环/ 不变式/ ,/ 而且/ 能/ 推断/ 有关/ 相邻/ 节点/ 数值数据/ 的/ 循环/ 不变式/ ,/ 推进/ 了/ 他们/ 先前/ 的/ 工作/ [/ 23/ ]/ ,/ 也/ 使得/ 他们/ 的/ 结果/ 优于/ 其他人/ 的/ 结果/ ./ 他们/ 也/ 采用/ 符号执行/ 机制/ ,/ 对/ 循环体/ 进行/ 迭代/ 计算/ ,/ 其/ 特点/ 是/ 使用/ 专门/ 设计/ 的/ 最小/ 上/ 界/ 算子/ 和/ 加宽/ 算子/ 来/ 保证/ 收敛/ 到/ 不动点/ ./ 本文/ 和/ 文献/ [/ 34/ ]/ 相比/ ,/ 两者/ 循环/ 不变式/ 的/ 推断/ 算法/ 都/ 是/ 基于/ 文献/ [/ 11/ ]/ ./ 我们/ 的/ 特点/ 是/ 采用/ 本文/ 的/ 形状/ 图/ 蕴涵/ 理论/ ,/ 在/ 形状/ 图上/ 直接/ 推断/ 循环/ 不变/ 形状/ 图/ ,/ 文献/ [/ 34/ ]/ 的/ 特点/ 是/ 还/ 能/ 推断/ 有关/ 相邻/ 节点/ 数值数据/ 的/ 循环/ 不变式/ ./ 在/ 保证/ 收敛/ 到/ 不动点/ 上/ ,/ 我们/ Page19/ 采用/ 形状/ 图上/ 的/ 蕴涵/ 规则/ [/ 10/ ]/ ,/ 并且/ 用/ 该文/ 的/ 形状/ 系统/ 来/ 保证/ 算法/ 的/ 终止/ ./ 就/ 推断/ 有关/ 形状/ 的/ 循环/ 不变式/ 而言/ ,/ 文献/ [/ 34/ ]/ 能/ 推断/ 操作/ 单链/ 表/ 、/ 循环/ 单链/ 表/ 和/ 二叉/ 查找/ 树/ 的/ 代码/ 的/ 循环/ 不变式/ ,/ 而/ 我们/ 还/ 能/ 推断/ 操作/ 双向/ 链表/ 、/ 循环/ 双向/ 链表/ 和/ 伸展/ 树/ 的/ 代码/ 的/ 循环/ 不变/ 形状/ 图/ ./ 从/ 第/ 6/ 节及表/ 1/ 可知/ ,/ 本文/ 推断/ 循环/ 不变/ 形状/ 图/ 的/ 能力/ 远胜/ 于/ 上面/ 几项/ 工作/ ./ 这是/ 由于/ 本文/ 的/ 推断/ 得到/ 形状/ 系统/ 的/ 支持/ ./ 也/ 正是/ 由于/ 形状/ 系统/ 的/ 支持/ ,/ 本文/ 还/ 能/ 推断/ 递归函数/ 的/ 前后/ 形状/ 图/ ./ 据/ 我们/ 所知/ ,/ 尚未/ 有/ 这方面/ 论文/ 的/ 发表/ ./ 图/ 逻辑/ 或/ 形状/ 逻辑/ 一般/ 是/ 指/ 推导/ 图/ (/ 或/ 有向图/ 、/ 形状/ 图/ )/ 性质/ 的/ 空间/ 逻辑/ [/ 35/ -/ 36/ ]/ ./ 其中/ 图是/ 用/ 符号/ 公式/ 来/ 描述/ 而/ 符号/ 公式/ 的/ 语法/ 由/ 简单/ 文法/ 来/ 定义/ ,/ 要/ 推导/ 的/ 图/ 上/ 的/ 性质/ 也/ 用/ 符号/ 公式/ 来/ 表示/ ,/ 推导/ 规则/ 也/ 还是/ 基于/ 符号/ 公式/ 的/ ./ 超边/ 替换/ 文法/ (/ hyperedgereplacementgrammar/ )/ [/ 37/ ]/ 是/ 一个/ 实例/ ./ 它用/ 超图/ 为/ 堆/ 状态/ 建模/ ,/ 把/ 双向/ 的/ 图/ 规则/ 用于/ 超图/ 的/ 变换/ ./ 但是/ 该/ 文法/ 只是/ 作为/ 动态/ 数据结构/ 建模/ 的/ 一种/ 直观/ 的/ 形式/ 方法/ ,/ 超图/ 和/ 规则/ 等/ 还是/ 用/ 符号/ 公式/ 来/ 表示/ 的/ ./ 本文/ 所用/ 的/ 形状/ 图/ 逻辑/ 与/ 它们/ 有/ 根本/ 的/ 区别/ :/ 形状/ 图/ 直接/ 作为/ 逻辑/ 公式/ ,/ 出现/ 在/ 程序逻辑/ 的/ 推理/ 规则/ 中/ ,/ 并且/ 还/ 可以/ 和/ 符号/ 公式/ 一起/ 演算/ ./ 从/ 规范/ 语言/ 的/ 综述/ [/ 38/ ]/ 和/ 工业界/ 的/ 使用/ [/ 8/ ]/ 看/ ,/ 迄今为止/ 尚无/ 像/ 本文/ 这样/ 采用/ 形状/ 图/ 或/ 采用/ 其他/ 非/ 符号/ 方式/ 来/ 表达/ 程序/ 的/ 部分/ 性质/ ,/ 并/ 与/ 表达/ 程序/ 其余/ 性质/ 的/ 符号/ 断言/ 一起/ 作为/ 程序/ 的/ 规范/ 并/ 一起/ 演算/ 的/ ./ 8/ 总结/ 随着/ 面临/ 越来越/ 复杂/ 系统/ 的/ 定理/ 证明/ ,/ 逻辑系统/ 也/ 面临/ 逻辑/ 公式/ 复杂/ 、/ 推理/ 规则/ 复杂/ 和/ 自动/ 定理/ 证明/ 困难/ 等/ 问题/ ./ 为/ 降低/ 难度/ ,/ 从/ 本文/ 的/ 经验/ 看/ ,/ 把/ 其中/ 适合/ 于用/ 图形/ 表示/ 的/ 领域/ 专用/ 逻辑/ 图形化/ ,/ 形成/ 符号逻辑/ 和/ 图形/ 逻辑/ 的/ 组合/ ,/ 是/ 一条/ 可以/ 尝试/ 的/ 途径/ ./ 下/ 一步/ 将/ 考虑/ 怎样/ 在/ 目前/ 基础/ 上/ 设计/ 实用性/ 大大提高/ 的/ 形状/ 图/ 逻辑/ 和/ 形状/ 系统/ ./ 首先/ ,/ 充实/ 基本/ 形状/ 集/ ,/ 并/ 分成/ 单态/ 基本/ 形状/ 和/ 多态/ 基本/ 形状/ ./ 单态/ 基本/ 形状/ 的/ 特点/ 是/ ,/ 易变/ 数据结构/ 中/ 各/ 节点/ 的/ 类型/ 相同/ ,/ 各/ 节点/ 所/ 含/ 指针/ 数/ 相同/ 并且/ 它们/ 指向/ 的/ 类型/ 都/ 是/ 节点/ 本身/ 的/ 类型/ ./ 本文/ 谈及/ 的/ 单链/ 表等/ 5/ 种/ 形状/ 都/ 属于/ 单态/ 基本/ 形状/ ./ 多态/ 基本/ 形状/ 的/ 特点/ 是/ ,/ 易变/ 数据结构/ 中/ 各/ 节点/ 的/ 类型/ 相同/ ,/ 各/ 节点/ 所/ 含/ 指针/ 数/ 可以/ 不同/ 但/ 它们/ 指向/ 的/ 类型/ 都/ 是/ 节点/ 本身/ 的/ 类型/ ./ 节点/ 的/ 多态性/ 依靠/ 节点/ 类型/ 中/ 的/ 共用/ 体域/ 来/ 体现/ ./ 例如/ 编译器/ 中/ 常用/ 的/ 抽象/ 语法/ 树/ 就/ 可以/ 设计/ 成/ 多态/ 基本/ 形状/ ./ 其次/ ,/ 规定/ 复杂/ 形状/ 的/ 构造/ 方式/ ,/ 并/ 相应/ 地/ 修改/ 形状/ 系统/ 中/ 的/ 形状/ 推断/ 规则/ 和/ 形状/ 检查/ 规则/ ./ 复杂/ 形状/ 至少/ 有/ 嵌套/ 形状/ 、/ 含/ 内部/ 附加/ 指针/ 的/ 形状/ 和/ 含/ 外来/ 附加/ 指针/ 的/ 形状/ 这样/ 三类/ ,/ 它们/ 在/ 构造/ 方式/ 上/ 的/ 特点/ 分别/ 是/ :/ 各/ 节点/ 都/ 有/ 指向/ 同种/ 内嵌/ 形状/ 的/ 指针/ (/ 例如/ 双向/ 链表/ 的/ 节点/ 都/ 有/ 指针/ 指向/ 各自/ 的/ 单链/ 表/ )/ 、/ 各/ 节点/ 都/ 有/ 指向/ 本/ 形状/ 节点/ 的/ 附加/ 指针/ (/ 例如/ 带父/ 节点/ 指针/ 的/ 二叉树/ )/ 、/ 来自/ 形状/ 外部/ 的/ 附加/ 指针/ (/ 例如/ 队列/ 可以/ 看成/ 带/ 一个/ 这种/ 附加/ 指针/ 的/ 单链/ 表/ ,/ 附加/ 指针/ 指向/ 链表/ 的/ 最后/ 一个/ 节点/ )/ ./ 用/ 基本/ 形状/ 集/ 加上/ 复杂/ 形状/ 的/ 几种/ 构造/ 方式/ ,/ 可以/ 控制/ 住/ 易变/ 数据结构/ 的/ 复杂性/ ,/ 并/ 满足/ 大部分/ 应用/ 对/ 易变/ 数据结构/ 的/ 需求/ ,/ 同时/ 也/ 使得/ 扩展/ 形状/ 图/ 逻辑/ 来/ 自动/ 验证/ 操作/ 复杂/ 易变/ 数据结构/ 的/ 程序/ 成为/ 可能/ ./ 致谢/ 感谢/ 刘刚/ 、/ 张志天/ 、/ 宋艳辉/ 、/ 孟建超/ 、/ 韩亚/ 慧/ 和/ 郝/ 韛/ 等/ 研究生/ ,/ 他们/ 为/ 实现/ 系统/ 原型/ 做出/ 了/ 贡献/ !/ 

