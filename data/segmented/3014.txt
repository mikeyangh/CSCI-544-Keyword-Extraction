Page1/ 高性能/ 虚拟/ 网络/ VegaNet/ 陈/ 文龙/ 1/ )/ ,/ 2/ )/ 徐明伟/ 2/ )/ 杨扬/ 1/ )/ 李琦/ 2/ )/ 马东/ 超/ 3/ )/ 1/ )/ (/ 北京科技大学/ 信息/ 工程学院/ 北京/ 100083/ )/ 2/ )/ (/ 清华大学/ 计算机科学/ 与/ 技术/ 系/ 北京/ 100084/ )/ 3/ )/ (/ 北京邮电大学/ 光通信/ 与/ 光电子学/ 研究院/ 北京/ 100876/ )/ 摘要/ 现有/ 网络/ 研究/ 的/ 实验/ 一般/ 在/ 模拟/ 工具/ 或/ 原型/ 系统/ 上/ 完成/ ./ 然而/ ,/ 这些/ 实验/ 环境/ 与/ 真实/ 网络/ 环境/ 总有/ 较大/ 的/ 差别/ ,/ 主要/ 包括/ 没有/ 真实/ 用户/ 流量/ 、/ 缺乏/ 真实/ 网络/ 中/ 的/ 丰富/ 网络/ 事件/ 、/ 没有/ 运行/ 真正/ 的/ 协议/ 栈/ 软硬件/ 平台/ 等/ ./ 另一方面/ ,/ 对于/ 运营/ 网络/ 的/ 研究/ ,/ 研究者/ 经常/ 希望/ 分析/ 网络/ 事件/ 发生/ 前后/ 的/ 网络/ 状况/ ,/ 例如/ 更改/ 拓扑/ 或/ 配置/ ,/ 注入/ 网络故障/ 等/ ,/ 显然/ 这些/ 措施/ 难以/ 在/ 真实/ 运营/ 网络/ 中/ 实施/ ./ 针对/ 上述/ 问题/ 设计/ 了/ 一种/ 为/ 网络/ 研究/ 提供/ 真实/ 实验/ 环境/ 以及/ 对/ 核心/ 网络/ 进行/ 模拟/ 分析/ 的/ 高性能/ 虚拟/ 网络/ VegaNet/ (/ VirtualGigabitNetwork/ )/ ./ 文中/ 详细/ 介绍/ 了/ VegaNet/ 结构/ 模型/ 及/ 设计/ 实现/ ./ 目前/ ,/ 已/ 完成/ VegaNet/ 在/ CERNET2/ 清华/ 校园网/ 的/ 初步/ 部署/ ./ 实验/ 表明/ ,/ VegaNet/ 能/ 提供/ 一个/ 接近/ 于/ 真实/ 网络/ 状况/ 的/ 网络/ 实验/ 环境/ ,/ 并/ 能/ 灵活/ 支持/ 对/ 核心/ 网络/ 的/ 模拟/ 分析/ ./ 关键词/ VegaNet/ ;/ 虚拟/ 路由器/ ;/ 网络/ 实验/ ;/ 虚拟/ 链路/ 状态/ 协议/ 1/ 引言/ 互联网/ 高速/ 发展/ ,/ 关于/ 网络体系结构/ 、/ 路由/ 协议/ 及/ 网络服务/ 的/ 新型/ 研究/ 层出不穷/ ./ 对于/ 研究成果/ 的/ 分析/ 评价/ ,/ 主要/ 通过/ 两种/ 方式/ 完成/ :/ (/ 1/ )/ 在/ 模拟/ 工具/ 中/ 实现/ 研究/ 模型/ 并/ 人为/ 设计/ 网络拓扑/ 进行/ 实验/ ;/ (/ 2/ )/ 在/ 实验室/ 中/ 完成/ 原型/ 系统/ 并/ 搭建/ 简单/ 环境/ 完成/ 实验/ ./ 然而/ ,/ 实验/ 环境/ 与/ 现实状况/ 有着/ 较大/ 的/ 差距/ ,/ 主要/ 包括/ 没有/ 真实/ 用户/ 流量/ ,/ 缺乏/ 真实/ 网络/ 中/ 的/ 丰富/ 网络/ 事件/ ,/ 没有/ 运行/ 真正/ 的/ 协议/ 栈/ 软硬件/ 平台/ 等/ ./ 另一方面/ ,/ 对于/ 运营/ 网络/ 的/ 研究/ ,/ 面对/ 24h/ 不间断/ 的/ 长期/ 稳定/ 的/ 网络服务/ ,/ 无法/ 随意/ 地/ 更改/ 网络拓扑/ 或/ 配置/ ,/ 更/ 不能/ 人为/ 构造/ 网络故障/ ,/ 使得/ 大量/ 优化/ 方案/ 无法/ 验证/ 其/ 效能/ ./ 总之/ ,/ 网络/ 研究者/ 的/ 新/ 思想/ 或/ 新/ 模型/ 难有/ 理想/ 的/ 实验/ 环境/ ,/ 也/ 难以/ 获取/ 有/ 价值/ 的/ 评价/ 依据/ ./ 研究者/ 希望/ 有/ 一种/ 虚拟/ 网络/ 架构/ ,/ 它/ 既/ 能/ 提供/ 几尽/ 真实/ 的/ 网络/ 环境/ 又/ 不/ 影响/ 任何/ 实际/ 网络/ 正常/ 运营/ ,/ 继而/ 还/ 能/ 透明/ 地/ 对/ 运营/ 网络/ 进行/ 模拟/ 分析/ ./ Overlay/ 虚拟/ 网络/ 架构/ 是/ 一个/ 极佳/ 的/ 选择/ ./ Overlay/ 网络/ 是/ 一种/ 部署/ 于/ 现存/ 网络/ 上/ 独立/ 的/ 虚拟/ 网络/ ,/ 就/ 像/ 在/ 原有/ 网络/ 上/ 叠加/ 了/ 一层/ 新/ 的/ 网络/ ./ 典型/ 的/ Overlay/ 网络/ 包括/ 进行/ 快速/ 路由/ 检测/ 和/ 恢复/ 的/ RON/ [/ 1/ ]/ 、/ 在/ 现有/ Internet/ 上/ 提供/ 端到/ 端/ 服务质量/ 保证/ 的/ SON/ [/ 2/ ]/ 以及/ 在/ SON/ 基础/ 上/ 为了/ 要/ 减少/ 性能/ 限制/ 提出/ 的/ SOI/ 架构/ [/ 3/ ]/ ./ 继而/ ,/ VINI/ (/ AVirtualNetworkInfrastruc/ -/ ture/ )/ [/ 4/ ]/ 被/ 提出/ ,/ 它/ 为/ 网络/ 研究者/ 提供/ 了/ 一个/ 可控/ 的/ 、/ 能够/ 面对/ 真实/ 环境/ 的/ 底层/ 网络/ 架构/ ./ VINI/ 允许/ 研究者/ 将/ 新型/ 思想/ 在/ 具有/ 真实/ 路由/ 软件/ 、/ 真实/ 流量/ 负载/ 及/ 真实/ 网络/ 事件/ 的/ 环境/ 下/ 进行/ 实施/ ,/ 并/ 得以/ 评估/ ./ VINI/ 提供/ 的/ 网络/ 实验/ 支撑/ 架构/ 的/ 主要/ 目标/ 包括/ 运行/ 真实/ 路由/ 软件/ ,/ 面对/ 真实/ 网络/ 环境/ ,/ 网络/ 事件/ 可控/ ,/ 实验/ 网络/ 承载/ 真实/ 用户/ 流量/ ./ VINI/ 在/ Planet/ -/ Lab/ [/ 5/ -/ 6/ ]/ 节点/ 上/ 构造/ 基本/ 原型/ 系统/ ./ 原型/ 系统/ 利用/ XORP/ (/ eXtensibleOpenRouterPlatform/ )/ 开源/ 路由/ 协议/ 软件/ [/ 7/ ]/ 实现/ 虚拟/ 系统/ 路由/ 控制/ 层面/ 的/ 处理/ ,/ 利用/ CLICK/ [/ 8/ ]/ 软件/ 完成/ 虚拟/ 数据/ 层面/ 的/ 报文/ 处理/ ./ 节点/ 间/ 的/ 虚拟/ 链路/ 通道/ 是/ 通过/ UDPSOCKET/ 通信/ 完成/ 的/ ./ VINI/ 在/ PlanetLab/ 测试/ 平台/ 上/ 搭建/ 完成/ 了/ 一个/ 实例/ :/ PL/ -/ VINI/ ,/ 基于/ 它/ 的/ 一系列/ 实验/ 证明/ 了/ PL/ -/ VINI/ 的/ 正确性/ 、/ 有效性/ 、/ 可用性/ ,/ 并且/ 能/ 做到/ 对/ 真实/ 网络/ 状况/ 真实/ 反映/ ./ 然而/ ,/ VINI/ 不是/ 基于/ 商业/ 路由/ 软硬件/ 平台/ ,/ 没有/ 实现/ 虚拟/ 网络/ 到/ 真实/ 网络/ 的/ 拓扑/ 映射/ 以及/ 链路/ 故障/ 的/ 状态/ 同步/ ,/ 也/ 未/ 实现/ 虚拟/ 网络/ 与/ 真实/ 路由/ 实体/ 的/ 信息/ 交互/ ./ 我们/ 设计/ 的/ VegaNet/ (/ VirtualGigabitNetwork/ )/ 和/ VINI/ 一样/ ,/ 也/ 是/ 一种/ Overlay/ 结构/ 的/ 虚拟/ 网络/ ,/ 它/ 为/ 网络/ 研究/ 提供/ 真实/ 实验/ 环境/ ./ 此外/ ,/ 它/ 还/ 能/ 透明/ 地/ 对/ 当前/ 运营/ 的/ 核心/ 网络/ 进行/ 模拟/ 分析/ ./ VegaNet/ 以/ 实际/ 运营/ 的/ 某个/ 网络体系/ 作为/ 底层/ 架构/ ,/ 在/ 网络/ 边缘/ 接入/ 若干/ 虚拟/ 路由器/ ,/ 虚拟/ 路由器/ 之间/ 通过/ 虚拟/ 链路/ 连接/ ,/ 构成/ 一个/ 虚拟/ 网络平台/ ./ 该/ 虚拟/ 网络平台/ 既/ 可/ 提供/ 网络/ 实验/ 环境/ ,/ 又/ 可/ 对/ 底层/ 核心/ 网络/ 进行/ 模拟/ 分析/ ./ VegaNet/ 主要/ 特性/ 包括/ 引入/ 真实/ 的/ 用户/ 流量/ ,/ 支持/ 节点/ 及/ 链路/ 故障/ 的/ 注入/ ,/ 同步/ 底层/ 网络故障/ ,/ 虚拟/ 路由器/ 基于/ 真正/ 的/ 商业/ 路由/ 平台/ 实现/ ,/ 支持/ 高带宽/ 的/ 虚拟/ 网络流量/ ,/ 虚拟/ 网络协议/ 族/ 独立/ 于/ 底层/ 网络/ ,/ 虚拟/ 网络/ 相对/ 底层/ 网络/ 透明/ 等/ ./ 其中/ ,/ 在/ 报文/ 处理/ 性能/ 、/ 虚拟/ 网络/ 与/ 底层/ 网络故障/ 同步/ 、/ 虚拟/ 链路/ 状态/ 管理/ 等/ 方面/ ,/ 相对/ VINI/ 有/ 了/ 显著/ 的/ 提高/ ./ 目前/ ,/ VegaNet/ 已/ 完成/ 初步/ 实施/ 及/ 实验/ ./ 实验/ 结果表明/ ,/ VegaNet/ 能/ 提供/ 一个/ 如同/ 真实/ 物理/ 网络/ 一样/ 的/ 网络/ 实验/ 环境/ ,/ 也/ 能/ 对/ 底层/ 网络/ 实现/ 模拟/ 分析/ 和/ 性能/ 评价/ ./ 本文/ 第/ 2/ 节/ 给出/ 了/ VegaNet/ 的/ 设计/ 思想/ 及/ 结构/ 模型/ ;/ 第/ 3/ 节/ 给出/ 了/ 以/ CERNET2/ 为/ 底层/ 支撑/ 网络/ 的/ VegaNet/ 实例/ 设计/ ;/ 第/ 4/ 节/ 介绍/ 了/ VegaNet/ 核心/ 设备/ 虚拟/ 路由器/ 的/ 软/ 、/ 硬件/ 体系结构/ 设计/ 以及/ 虚/ 链路/ 状态/ 协议/ 的/ 设计/ ;/ 第/ 5/ 节/ 描述/ 了/ VegaNet/ 在/ CERNET2/ 清华/ 校园网/ 的/ 初步/ 部署/ 情况/ 以及/ 基于/ 它/ 的/ 实验/ 及/ 实验/ 分析/ ;/ 第/ 6/ 节对/ 全文/ 进行/ 了/ 总结/ ,/ 并/ 介绍/ 了/ 项目/ 下/ 一步/ 的/ 工作/ 方向/ ./ 2VegaNet/ 模型/ VegaNet/ 总体目标/ 包括/ 两个/ 方面/ :/ (/ 1/ )/ 为/ 新型/ 网络协议/ 或/ 服务/ 提供/ 尽量/ 真实/ 的/ 实验/ 环境/ ,/ 保证/ 实验/ 能/ 不断改进/ 、/ 反复/ 进行/ ;/ (/ 2/ )/ 通过/ VegaNet/ 对/ 特定/ 网络体系/ 进行/ 模拟/ ,/ 反映/ 实际/ 网络/ 运行状况/ ,/ 并/ 对/ 该/ 网络体系结构/ 进行/ 分析/ ./ VegaNet/ 模型/ 设计/ 有/ 以下/ 基本/ 原则/ :/ (/ 1/ )/ 它/ 总是/ 基于/ 某个/ 底层/ 网络/ 进行/ 构建/ ,/ 并且/ 对/ 底层/ 网络/ 透明/ ,/ 即/ 底层/ 网络/ 不/ 关心/ VegaNet/ 上/ 的/ 网络/ 行为/ ;/ (/ 2/ )/ 能/ 实现/ VegaNet/ 中/ 虚拟/ 链路/ 与其/ 对应/ 的/ 真实/ 物理/ 链路/ 的/ 故障/ 同步/ ;/ (/ 3/ )/ VegaNet/ 有/ 真实/ 用户/ 并/ 可/ 承载/ 真实/ 网络/ 一样/ 的/ 网络/ 行为/ ;/ (/ 4/ )/ VegaNet/ 网络拓扑/ 可/ 重构/ 并/ 具有/ 较/ 高/ 的/ 可控/ Page3/ 性/ ,/ 管理员/ 根据/ 实验/ 需要/ 只/ 需/ 简单/ 配置/ 便/ 可/ 改变/ 虚拟/ 网络拓扑/ ,/ 还/ 可/ 方便/ 地/ 获取/ VegaNet/ 网络/ 事件/ 信息/ ./ 本文/ 关于/ VegaNet/ 的/ 描述/ 有表/ 1/ 所述/ 的/ 符号/ 定义/ ,/ 图/ 1/ 是/ VegaNet/ 的/ 网络体系结构/ 模型/ ./ VegaNet/ 是/ 在/ SUN/ 网络/ 核心/ 节点/ 下面/ 部署/ 若干/ 台/ 虚拟/ 路由器/ VR/ ,/ VR/ 像/ 普通/ 端系统/ 一样/ 接入/ SUN/ ,/ VR/ 之间/ 通过/ 虚/ 链路/ Vlink/ 连接/ ./ 图/ 1/ 中/ VegaNet/ 是/ 所有/ VR/ 的/ Full/ -/ mesh/ 连接/ ,/ 实际/ 部署/ 时/ 可/ 根据/ 不同/ 需求/ 构建/ 不同/ 拓扑/ ./ VegaNet/ 就是/ 由/ 若干/ VR/ 和/ Vlink/ 构成/ 的/ 虚拟/ 网络/ ,/ 每台/ VR/ 通过/ DCI/ 接口/ 下/ 连/ 局域网/ ./ VegaNet/ 对于/ 底层/ 网络/ 来说/ 是/ 透明/ 运行/ 的/ ,/ 并且/ VegaNet/ 的/ 网络协议/ 族/ 与/ SUN/ 网络/ 的/ 协议/ 族/ 是/ 相互/ 独立/ 的/ ./ 假设/ SUN/ 网络协议/ 族/ 为/ FS/ ,/ 报文/ 头/ 格式/ 为/ Header/ (/ FS/ )/ ;/ VegaNet/ 网络协议/ 族/ 为/ FV/ ,/ 报文/ 头/ 格式/ 为/ Header/ (/ FV/ )/ ,/ 那么/ ,/ VegaNet/ 的/ 网络/ 报文/ 在/ SUN/ 网络/ 传输/ 时/ 采取/ 如图/ 2/ 所示/ 直接/ 封装/ 的/ 格式/ ./ VegaNet/ 中/ 无论/ 数据/ 转发/ 报文/ 或是/ 协议/ 控制/ 报文/ ,/ 只要/ 通过/ VR/ 中虚/ 链路/ 收发/ 就/ 采用/ 图/ 2/ 的/ 报文/ 封装/ 符号/ SUNSubstrateNetwork/ ,/ VegaNet/ 的/ 底层/ 支撑/ 网络/ VRVirtualRouter/ ,/ 虚拟/ 路由器/ ,/ 作为/ 端系统/ 接入/ SUN/ 网/ UCIUp/ -/ ConnectingInterface/ ,/ VR/ 上/ 连/ SUN/ 网络/ 的/ 接口/ ,/ DCIDown/ -/ ConnectingInterface/ ,/ VR/ 下/ 连/ VegaNet/ 局域/ VlinkVirtualLink/ ,/ 虚/ 链路/ ,/ 利用/ 封装/ 解/ 封装/ 技术/ 、/ 穿越/ SUNVIVirtualInterface/ ,/ VR/ 上/ 收发/ 封装/ 报文/ 的/ 虚拟/ 接口/ ,/ 总图/ 3VR/ 报文/ 处理/ 模型/ VegaNet/ 的/ 一个/ 重要/ 目标/ 是/ 对/ SUN/ 核心/ 网络/ 进行/ 模拟/ ,/ 通过/ VegaNet/ 运行/ 情况/ 反映/ SUN/ 网络/ 的/ 实际/ 运行状况/ ,/ 并/ 对/ VegaNet/ 网络结构/ 及/ 网络协议/ 进行/ 改进/ 实验/ ,/ 给/ SUN/ 网络/ 的/ 发展/ 提供/ 建设性/ 的/ 建议/ ./ VegaNet/ 部署/ 时/ ,/ SUN/ 网络/ 每台/ 核心/ 路由器/ 下/ 连/ 一台/ VR/ ,/ 该/ VR/ 用来/ 模拟/ 其上/ 连/ 的/ 核心/ 路由器/ ./ 对照/ SUN/ 网络/ 真实/ 链路/ ,/ VegaNet/ 配置/ 相应/ 格式/ ./ 当然/ ,/ 对于/ 边缘/ 局域网/ 内部/ 的/ 报文/ 交互/ ,/ 仍然/ 采用/ VegaNet/ 协议/ 族/ 原始/ 报文格式/ ./ 对于/ VegaNet/ 中/ 穿越/ SUN/ 网络/ 的/ 一次/ 端到/ 端/ 通信/ ,/ 包含/ 3/ 种/ VR/ 角色/ :/ 源/ 端系统/ 所属/ 的/ 虚拟/ 路由器/ 称为/ VRsend/ ,/ 它/ 从/ DCI/ 接收/ 协议/ 族/ FV/ 报文/ 进行/ 封装/ ,/ 并/ 按照/ 协议/ 族/ FS/ 的/ 寻径/ 方式/ 从/ UCI/ 发送/ 报文/ ./ 目的/ 端系统/ 所属/ 的/ 虚拟/ 路由器/ 称为/ VRrcv/ ,/ 它/ 从/ UCI/ 接收/ 到达/ 本地/ 的/ 协议/ 族/ FS/ 报文/ 进行/ 解/ 封装/ ,/ 并/ 按照/ 协议/ 族/ FV/ 的/ 寻径/ 方式/ 从/ DCI/ 发送/ 报文/ ./ 从/ VRsend/ 到/ VRrcv/ 可能/ 经过/ 的/ 若干个/ 转发/ 点/ 称为/ VRfwd/ ,/ 它/ 对/ 协议/ 族/ FS/ 的/ 封装/ 报文/ 进行/ 重新/ 封装/ 并/ 向/ VRrcv/ 方向/ 发送/ ./ 图/ 3/ 是/ VR/ 的/ 报文/ 处理/ 模型/ ,/ 它/ 集成/ 了/ 上述/ 3/ 种/ VR/ 角色/ 的/ 报文/ 处理/ 功能/ ./ 的/ 虚/ 链路/ ,/ 一条/ Vlink/ 对应/ SUN/ 核心网/ 中/ 的/ 一条/ 真实/ 链路/ ./ 我们/ 希望/ VegaNet/ 能/ 做到/ 虚拟/ 网络/ 与/ 底层/ 网络/ 的/ 链路/ 故障/ 同步/ ,/ 而/ 其/ 实施/ 的/ 关键/ 是/ 如何/ 分析/ 底层/ 网络/ 真实/ 链路/ 是否/ 发生/ 故障/ ./ 因为/ 对于/ 一条/ 虚/ 链路/ 两端/ 的/ VR/ ,/ SUN/ 网络/ 中/ 可能/ 有/ 多条/ 可/ 达/ 路径/ ,/ 而/ 实验者/ 只/ 希望/ 虚/ 链路/ 与其/ 模拟/ 的/ 那条/ 真实/ 链路/ 保/ Page4/ 持/ 状态/ 一致/ ./ 令/ 集合/ S/ (/ R/ ,/ L/ )/ 表示/ SUN/ 网络/ 核心/ 设备/ 连接/ 拓扑/ ,/ 其中/ ,/ R/ =/ {/ r1/ ,/ r2/ ,/ r3/ ,/ …/ ,/ rn/ }/ 是/ 路由器/ 集合/ ,/ L/ =/ {/ lij/ |/ ri/ ∈/ R/ ,/ rj/ ∈/ R/ ,/ i/ ≠/ j/ ,/ 0/ </ i/ ,/ j/ / n/ }/ 是/ 物理/ 链路/ 集合/ ,/ 且/ 对于/ R/ 中/ 任意/ 两个/ 不同/ 的/ 节点/ 最/ 多/ 只有/ 一条/ 物理/ 链路/ ./ VegaNet/ 网络/ 对/ SUN/ 进行/ 模拟/ 时/ ,/ SUN/ 核心网/ 中/ 每/ 一台/ 路由器/ 和/ 每/ 一条/ 物理/ 链路/ 都/ 在/ VegaNet/ 中有/ 一台/ VR/ 和/ 一条/ Vlink/ 与/ 之/ 对应/ ./ 集合/ V/ (/ R/ ,/ L/ )/ 表示/ VegaNet/ 连接/ 拓扑/ ,/ 它/ 是/ 集合/ S/ 的/ 等价/ 类/ ,/ 其中/ R/ =/ {/ r1/ ,/ r2/ ,/ r3/ ,/ …/ ,/ rn/ }/ 是/ VR/ 集合/ ,/ L/ =/ {/ lij/ |/ ri/ ∈/ R/ ,/ rj/ ∈/ R/ ,/ i/ ≠/ j/ ,/ 0/ </ i/ ,/ j/ / n/ }/ 是/ Vlink/ 集合/ ,/ 同样/ 对于/ R/ 中任/ 两个/ 不同/ 的/ 虚/ 节点/ 最多/ 有/ 一条/ 虚拟/ 链路/ ./ 另外/ ,/ VegaNet/ 部署/ 于/ SUN/ 网络/ 时/ ,/ 每台/ VR/ 通过/ 一条/ 物理/ 链路/ 连接/ 其/ 对应/ 的/ 核心/ 路由器/ ,/ 称其为/ VR/ 接入/ 链路/ ,/ 该类/ 链路/ 的/ 数量/ 与/ VR/ 数量/ 相等/ ./ 我们/ 将/ VR/ 接入/ 链路/ 集合/ 定义/ 为/ K/ =/ {/ ki/ |/ 0/ </ i/ / n/ }/ ,/ 链路/ ki/ 的/ 两个/ 端/ 节点/ 为/ ri/ 和/ ri/ ,/ 它们/ 分别/ 来自/ 集合/ R/ 和/ R/ ./ 在/ VR/ 接入/ 链路/ 集合/ K/ 无故障/ 且/ SUN/ 网络/ 路由/ 总是/ 优先选择/ 最短/ 路径/ 的/ 情况/ 下/ ,/ 有/ 定理/ 1/ ./ 本文/ 不/ 考虑/ 链路/ 权值/ 等/ 评价/ 参数/ ,/ 跳数/ 最少/ 即/ 为/ 最/ 短/ 路径/ ./ 定理/ 1/ ./ 物理/ lij/ 链路/ 正常/ 当且/ 仅/ 当/ 虚拟/ 路径/ Path/ (/ lij/ )/ 的/ 跳/ 数为/ 3/ ./ 证明/ ./ VegaNet/ 模拟/ 环境/ 中/ ,/ 虚/ 链路/ 总是/ 针对/ 某条/ 真实/ 物理/ 链路/ 而/ 建立/ 的/ ./ 所以/ 在/ lij/ 链路/ 正常/ 时/ ,/ 其/ 对应/ 的/ 虚/ 链路/ lij/ (/ 即/ 虚拟/ 路由器/ ri/ 和/ rj/ 之间/ 的/ 虚/ 链路/ )/ 所/ 对应/ 的/ 最/ 短/ 实际/ 路径/ 为/ Path/ (/ lij/ )/ =/ {/ ki/ ,/ lij/ ,/ kj/ }/ ,/ 路径/ 跳数/ 为/ 3/ ,/ 其/ 经过/ 的/ 节点/ 序列/ 为/ {/ ri/ ,/ ri/ ,/ rj/ ,/ rj/ }/ ./ 当/ lij/ 链路/ 发生/ 故障/ 时/ ,/ 假设/ 虚/ 链路/ lij/ 仍然/ 可/ 达/ ,/ 则/ 说明/ 核心/ 路由器/ ri/ 和/ rj/ 间/ 存在/ 通信/ 路径/ ./ 由于/ ri/ 和/ rj/ 间/ 只有/ 一条/ 直连/ 链路/ lij/ 且/ 已/ 发生/ 故障/ ,/ 所以/ Path/ (/ lij/ )/ 的/ 路径/ 跳数/ 必定/ 大于/ 等于/ 2/ ;/ 加上/ 链路/ ki/ 和/ kj/ ,/ Path/ (/ lij/ )/ 的/ 路径/ 跳数/ 必定/ 大于/ 等于/ 4/ ./ 定理/ 1/ 成立/ ./ 基于/ 定理/ 1/ ,/ 在/ VegaNet/ 对/ 特定/ SUN/ 网络/ 进行/ 模拟/ 时/ ,/ 只要/ SUN/ 网络/ 采取/ 最短/ 路径/ 路由/ 算法/ ,/ 我们/ 可以/ 通过/ 分析/ 虚/ 链路/ 的/ 两端/ 通信/ 的/ 实际/ 转发/ 跳数/ 是否/ 为/ 3/ 来/ 判断/ 其/ 模拟/ 的/ 真实/ 物理/ 链路/ 是否/ 正常/ ,/ 从而/ 决定/ 虚/ 链路/ 的/ 状态/ ,/ 最终/ 实现/ Vlink/ 与其/ 模拟/ 的/ 真实/ 链路/ 的/ 状态/ 一致性/ ./ 3VegaNet/ 设计/ VegaNet/ 设计/ 的/ 主要/ 思想/ 就是/ 部署/ 若干/ VR/ 通过/ SUN/ 网络/ 核心/ 节点/ 接入/ ,/ VR/ 之间/ 通过/ 虚/ 链路/ Vlink/ 进行/ 连接/ ./ VegaNet/ 数据/ 通过/ 虚/ 链路/ 传输/ 时/ ,/ 需要/ 用/ SUN/ 网络协议/ 族/ 的/ IP/ 头部/ 进行/ 封装/ 发送/ ./ 本文/ 实现/ 了/ 一个/ VegaNet/ 实例/ 设计/ ,/ 实例/ 中/ Vega/ -/ Net/ 运行/ IPv4/ 协议/ 族/ ,/ CERNET2/ 为/ 其/ SUN/ 网络/ ./ VegaNet/ 虚/ 链路/ 的/ IPv4/ 数据传输/ 通过/ IPv6/ 封装/ 技术/ 实现/ ,/ 该/ 传输/ 对/ CERNET2/ 网络/ 完全/ 透明/ ./ Vega/ -/ Net/ 中/ 地址/ 及/ 路由/ 配置/ 细节/ 如下/ :/ (/ 1/ )/ IPv6Address/ ./ VR/ 如同/ 普通/ 终端/ 有且/ 只有/ 一个/ 全局/ IPv6/ 地址/ ,/ 配置/ 在/ UCI/ 上/ ;/ (/ 2/ )/ IPv4Address/ ./ VR/ 除了/ UCI/ 以外/ 的/ 其它/ 接口/ 都/ 可/ 配置/ VegaNet/ 中/ 唯一/ 的/ IPv4/ 地址/ ;/ (/ 3/ )/ Vlink/ ./ 两个/ VR/ 之间/ 要/ 建立/ 一条/ 虚/ 链路/ 时/ ,/ 需要/ 双方/ 配置/ Vlink/ ;/ Vlink/ 配置/ 主要/ 就是/ 指定/ 对端/ VR/ 的/ IPv6/ 全局/ 地址/ ;/ (/ 4/ )/ IPv4Routing/ ./ VR/ 通过/ DCI/ 把/ 所属/ 的/ IPv4/ 网络/ 连入/ VegaNet/ ,/ VR/ 可/ 在/ DCI/ 连接/ 的/ 真实/ 链路/ 及/ Vlink/ 上/ 运行/ IPv4/ 路由/ 协议/ ,/ 实现/ 整个/ VegaNet/ 的/ 路由/ 信息/ 交互/ ;/ (/ 5/ )/ IPv6Routing/ ./ 由于/ VR/ 单点/ 接入/ CER/ -/ NET2/ ,/ VR/ 只/ 需/ 一条/ IPv6/ 默认/ 路由/ 实现/ IPv6/ 报文/ 发送/ ./ 另外/ ,/ VegaNet/ 支持/ 人为/ 对/ 其/ 网络/ 节点/ 及/ 链路/ 注入/ 故障/ 及/ 故障/ 恢复/ 事件/ ./ 在/ VR/ 或/ Vlink/ 运行/ 正常/ 的/ 情况/ 下/ ,/ 有时/ 因为/ 实验/ 需要/ 希望/ VR/ 或/ Vlink/ 发生/ 故障/ ./ 此时/ ,/ 管理员/ 可以/ 远程/ 通过/ 私有/ 协议/ 通告/ VR/ 进行/ 某种/ 行为/ 约束/ ,/ 达到/ 网络故障/ 发生/ 的/ 效果/ ./ 当然/ ,/ 管理员/ 还/ 可/ 通告/ 取消/ 人为/ 故障/ 使/ 网络/ 恢复正常/ ./ 网络/ 中/ 各种/ 故障/ 都/ 有/ 其/ 对应/ 的/ 表现形式/ ,/ Vega/ -/ Net/ 正是/ 以此/ 为据/ 实现/ 对/ 网络故障/ 的/ 控制/ ,/ 包括/ 以下/ 处理/ :/ (/ 1/ )/ VIDown/ ./ VI/ 的/ 接口/ 状态/ 为/ Down/ ,/ 其/ 后续/ 行为/ 和/ 真实/ 接口/ Down/ 所/ 导致/ 的/ 行为/ 一样/ ,/ 不再/ 发送/ 或/ 接收/ 任何/ 报文/ ;/ (/ 2/ )/ VRDown/ ./ VR/ 上/ 所有/ 虚/ 接口/ 状态/ 都/ 为/ (/ 3/ )/ VlinkDown/ ./ 虚/ 链路/ 两端/ 对应/ VI/ 的/ 接口/ 状/ 相对/ 于/ 其它/ 虚拟/ 网络/ 模型/ ,/ 本文/ 的/ VegaNet/ 设/ (/ 1/ )/ 实现/ 了/ 真实/ 网络故障/ 在/ 虚拟/ 网络/ 中/ 的/ 实时/ 体现/ ./ VegaNet/ 希望/ 网络/ 研究/ 及/ 实验/ 基于/ 尽量/ 真实/ 的/ 网络/ 环境/ 完成/ ,/ 真实/ 环境/ 的/ 考验/ 是/ 对/ 网络协议/ 及/ 网络体系结构/ 各/ 方面/ 特性/ 评估/ 最/ 有力/ 的/ 论据/ ./ Veg/ -/ aNet/ 通过/ VLSP/ 协议/ ,/ 分析/ 虚/ 链路/ 跳数/ 或/ 传输/ 路径/ ,/ 实现/ 了/ 虚拟/ 网络/ 与/ 所/ 模拟/ 的/ 真实/ 网络/ 的/ 链路/ 故障/ 同步/ ./ Down/ ,/ 都/ 不/ 进行/ 报文/ 收发/ ;/ 态/ 都/ 为/ Down/ ;/ 计/ 主要/ 有/ 以下/ 特点/ :/ Page5/ (/ 2/ )/ 监控/ 体系/ 可以/ 实现/ 深度/ 分析/ 并/ 注入/ 故障/ ./ 除了/ 让/ 虚拟/ 网络/ 同步/ 真实/ 网络/ 的/ 链路/ 故障/ 及/ 恢复/ ,/ VegaNet/ 还/ 支持/ 人为/ 控制/ 虚拟/ 网络/ 中/ 的/ 故障/ 产生/ 和/ 故障/ 取消/ 事件/ ./ 监控/ 平台/ 通过/ 私有/ 协议/ (/ 一种/ 基于/ IPv6TCP/ 的/ 私有/ 协议/ ,/ 本文/ 不/ 做/ 详细描述/ )/ 对/ 虚拟/ 路由器/ 发送/ 控制/ 消息/ ,/ 从而/ 操作/ 故障/ 状态/ ./ 另外/ ,/ 监控/ 平台/ 还/ 利用/ 私有/ 协议/ 从/ 虚拟/ 路由器/ 中/ 采集/ 各种/ 网络/ 事件/ ,/ 并/ 在/ 后台/ 研究/ 分析/ ./ (/ 3/ )/ VR/ 直接/ 基于/ 商业/ 路由/ 系统/ 平台/ 进行/ 开发/ ./ VegaNet/ 中/ 的/ 虚拟/ 路由器/ 是/ 一台/ 真正/ 的/ 路由/ 设备/ ,/ 它/ 基于/ 清华大学/ 自行/ 研制/ 的/ BWOS/ 路由/ 平台/ 改进/ 而成/ (/ 详见/ 本文/ “/ 虚拟/ 路由器/ 设计/ ”/ 部分/ )/ ./ 该/ 架构/ 中/ ,/ 虚拟/ 路由器/ 可以/ 面对/ 和/ 真实/ 路由器/ 一样/ 的/ 系统/ 平台/ 问题/ ,/ 如高/ 负载/ 任务/ 对/ 处理器/ 的/ 长期/ 占用/ 、/ 路由/ 设备/ 中/ 数据/ 消息/ 与/ 控制/ 消息/ 的/ 冲突/ 、/ 分布式/ 体系结构/ 中/ 消息/ 同步/ 等/ 问题/ ./ 所以/ ,/ 基于/ VegaNet/ 的/ 网络/ 实验/ 及/ 研究/ 与/ 实际/ 状况/ 更/ 贴近/ ./ (/ 4/ )/ 支持/ Gibit/ 用户/ 流量/ ./ 网络/ 实验/ 中/ ,/ 是否/ 有/ 真实/ 的/ 高带宽/ 用户/ 流量/ 是/ 非常/ 关键/ 的/ 影响/ 因素/ ./ 商业/ 路由/ 设备/ 中/ ,/ 报文/ 处理/ 主要/ 包括/ 高速数据/ 转发/ 和/ 协议/ 报文/ 收发/ ,/ 这/ 两者/ 共享/ 外部/ 网络接口/ 并/ 产生/ 竞争/ 关系/ ./ 所以/ ,/ 支持/ 高速/ 用户/ 转发/ 流量/ 将/ 使/ 网络协议/ 实验/ 分析/ 更具/ 参考价值/ ./ (/ 5/ )/ 虚/ 链路/ 状态/ 协议/ (/ VLSP/ )/ 为/ 模拟/ 真实/ 网络/ 及/ 链路/ 控制/ 提供/ 灵活/ 支持/ ./ VegaNet/ 中/ ,/ 虚拟/ 链路/ 像/ 物理/ 链路/ 一样/ 具有/ 一些/ 链路/ 属性/ 参数/ ,/ 如/ MTU/ ,/ 我们/ 希望/ 虚/ 链路/ 两端/ 链路/ 参数/ 协商一致/ ./ 另外/ ,/ 虚/ 链路/ 通常/ 跨越/ 多/ 跳/ 物理/ 链路/ ,/ 它/ 的/ 可达性/ 难以/ 检测/ ./ VLSP/ 协议/ 就是/ 为/ 解决/ 上述/ 问题/ 而/ 设计/ 的/ ,/ 它/ 是/ 虚拟/ 网络平台/ 中/ 重要/ 的/ 设计/ 之一/ ./ VLSP/ 的/ 功能/ 包括/ 维护/ 虚拟/ 邻居/ 状态/ 、/ 实现/ 虚拟/ 链路/ 两端/ 的/ 参数/ 协商/ 、/ 虚拟/ 链路/ 双向/ 可达性/ 检测/ 、/ 虚拟/ 链路/ 所用/ 真实/ 路径/ 监控/ 等/ ./ 图/ 4/ 是/ VegaNet/ 对/ CERNET2/ ①/ 的/ 模拟/ 的/ 拓扑/ 子图/ ,/ 我们/ 假设/ 所有/ VR/ 接入/ 链路/ 总是/ 正常/ ,/ 因为/ 任一/ 接入/ 链路/ 发生/ 故障/ ,/ 整个/ 网络/ 模拟/ 就/ 无效/ ./ 对于/ 虚拟/ 路由器/ JN/ 到/ HF/ 的/ 虚/ 链路/ Vlink/ (/ JN/ ,/ HF/ )/ ,/ 有/ 两条/ 可/ 达/ 路径/ :/ Path1/ 经过/ 节点/ 序列/ {/ JN/ ,/ JN/ ,/ HF/ ,/ HF/ }/ ,/ Path2/ 经过/ 节点/ 序列/ {/ JN/ ,/ JN/ ,/ TJ/ ,/ BJ/ ,/ WH/ ,/ NJ/ ,/ HF/ ,/ HF/ }/ ./ CERNET2/ 核心网/ 为/ 一个/ 自治/ 域/ ,/ 域/ 内/ 运行/ OSPF/ 协议/ 选择/ 最短/ 路径/ ./ 基于/ 定理/ 1/ ,/ 若/ Vlink/ (/ JN/ ,/ HF/ )/ 的/ 物理/ 跳数/ 为/ 3/ 表明/ JN/ 到/ HF/ 的/ 物理/ 链路/ 正常/ ,/ 否则/ 发生/ 链路/ 故障/ ./ VegaNet/ 中/ 由/ VLSP/ 协议/ 通过/ 监测/ Vlink/ 的/ 实际/ 物理/ 跳数/ 是否/ 为/ 3/ ,/ 来/ 判断/ 其/ 模拟/ 的/ 物理/ 链路/ 是否/ 发生/ 故障/ ,/ 从而/ 决定/ Vlink/ 的/ 链路/ 状态/ ./ 3.1/ 虚拟/ 网络/ 数据/ 转发/ 图/ 5/ 是/ 由/ 5/ 台/ VR/ 通过/ 虚/ 链路/ 组成/ 的/ 一个/ 虚拟/ 网络/ ,/ 我们/ 以此/ 拓扑/ 详细描述/ VegaNet/ 中路/ 由/ 学习/ 及/ 数据/ 转发/ 细节/ ./ 图/ 5/ 中/ 每台/ VR/ 有/ 两个/ 邻居/ ,/ VR/ 之间/ 的/ Vlink/ 全部/ 运行/ OSPFv2/ 协议/ ,/ 各虚/ 链路/ 权值/ 全/ 设置/ 为/ 1/ ,/ VR/ 将/ 所属/ 的/ IPv4/ 局域网/ 路由/ 引入/ OSPF/ ./ 这样/ ,/ VegaNet/ 只是/ 通过/ 常规/ 的/ 路由/ 配置/ ,/ 就/ 实现/ 了/ 虚拟/ 网全/ 网路/ 由/ 的/ 学习/ ./ 下面/ 以/ 主机/ A/ 与/ 主机/ C/ 通信/ 为/ 例来/ 分析/ VR/ 下/ 连/ 端系统/ 通过/ 虚拟/ 网络/ 的/ 通信/ 过程/ ./ 主机/ A/ 到/ 主机/ C/ 必经/ VR1/ 、/ VR3/ ,/ 而/ VR1/ 到/ VR3/ 有/ 两条/ 可/ 达/ 路径/ VR1/ —/ VR2/ —/ VR3/ 以及/ VR1/ —/ VR5/ —/ VR4/ —/ VR3/ ,/ VR1/ 进行/ SPF/ 计算/ 得出/ 路径/ 开销/ 分别/ 为/ 2/ 和/ 3/ ,/ 将/ 选取/ 第/ 1/ 条路/ 作为/ 去往/ VR3/ 的/ 转发/ 路径/ ./ 同样/ ,/ VR3/ 也/ 会/ 选取/ 该/ 路径/ 的/ 反向/ 路径/ 作为/ 去往/ VR1/ 的/ 数据/ 转发/ 路径/ ./ 从/ 主机/ A/ 通过/ 虚拟/ 网络/ 发送/ IPv4/ 报文/ 给/ 主机/ C/ ,/ 共有/ 如表/ 2/ 所列/ 步骤/ ./ 上述/ 报文/ 变换/ 过程/ 如图/ 6/ 所示/ ,/ 需要/ 重点/ 说明/ 的/ 是/ VR2/ 接收/ 和/ 转发/ 的/ IPv6/ 封装/ 报文/ 是/ 更换/ 了/ 封装/ 头部/ 的/ ,/ 也就是说/ VR2/ 进行/ 了/ 重新/ 封装/ ./ 由/ 主机/ C/ 发往/ A/ 的/ 转发/ 过程/ 与/ 上述/ 步骤/ 类似/ ./ 整个/ 转发/ 过程/ 中/ 的/ 关键点/ 是/ VR/ 对/ 报文/ 的/ 封装/ 及解/ 封装/ ./ 报文/ 从源/ IPv4/ 网络/ 进入/ IPv6/ 网络/ 时/ ,/ 由源端/ 所在/ VR/ 进行/ IPv6/ 封装/ ;/ 报文/ 离开/ IPv6/ 网络/ 进入/ 目的/ IPv4/ ①/ http/ :/ // // www/ ./ cernet2/ ./ edu/ ./ cn/ // ,/ http/ :/ // // nms/ -/ v6/ ./ cernet2/ ./ Page6/ 网络/ 时/ ,/ 由/ 目的/ 端/ 所在/ VR/ 进行/ 解/ 封装/ ;/ 而/ 中间/ 经过/ 的/ VR/ 要/ 对/ 封装/ 报文/ 进行/ 解/ 封装/ 后/ 重新/ 封装/ 发往/ 另表/ 2/ 图/ 5/ 环境/ 下/ 主机/ A/ 发送/ IPv4/ 报文/ 至/ 主机/ C/ 所经/ 步骤/ 步骤/ 角色/ 1/ 主机/ A/ 发出/ 原始/ IPv4/ 报文/ Dst/ (/ 30.0/ ./ 0.2/ )/ 、/ Src/ (/ 10.0/ ./ 0.2/ )/ 、/ Nexthop/ (/ 10.0/ ./ 0.1/ )/ 2VR1/ 接收/ 并/ 转发/ IPv4/ 报文/ 查找/ IPv4/ 转/ 发表/ ,/ 出/ 接口/ 为/ 连接/ VR2/ 的/ 虚/ 接口/ 3VR1VI/ 发送/ IPv4/ 报文/ IPv6/ 封装/ 后/ 发出/ ,/ 封装/ 头中/ Dst/ (/ 2000/ ∷/ 1/ )/ 、/ Src/ (/ 1000/ ∷/ 1/ )/ 4VR2VI/ 接收/ 封装/ 报文/ 接收/ 封装/ 报文/ 进行/ 解/ 封装/ 操作/ ,/ 得到/ 原始/ IPv4/ 报文/ 5VR2VI/ 发送/ IPv4/ 报文/ 查/ IPv4/ 转/ 发表/ 出/ 接口/ 为/ VI/ ,/ IPv6/ 封装/ 后/ 发出/ ,/ 封装/ 头中/ Dst/ (/ 3000/ ∷/ 1/ )/ 、/ Src/ (/ 2000/ ∷/ 1/ )/ 6VR3VI/ 接收/ 封装/ 报文/ 接收/ 封装/ 报文/ 进行/ 解/ 封装/ 操作/ ,/ 得到/ 原始/ IPv4/ 报文/ 7VR3DIC/ 发送/ IPv4/ 报文/ 查/ IPv4/ 转/ 发表/ 出/ 接口/ 为/ DIC/ ,/ 发送/ 原始/ IPv4/ 报文/ 8/ 主机/ C/ 接收/ 原始/ IPv4/ 报文/ 接收/ 到/ 主机/ A/ 发出/ 的/ 原始/ IPv4/ 报文/ 图/ 6VegaNet/ 报文/ 变化/ 过程/ 4/ 虚拟/ 路由器/ 设计/ 4.1/ 虚拟/ 路由器/ 体系结构/ 虚拟/ 路由器/ 系统/ 基于/ BWOS/ 平台/ [/ 9/ ]/ 改造/ 完成/ ./ 可/ 扩展/ 路由器/ 操作系统/ BWOS/ 支持/ IPv6/ 和/ IPv4/ 双/ 协议/ 栈/ ,/ 实现/ 了/ 多种/ 网络接口/ 下/ 的/ 高速/ 分组/ 转发/ 功能/ ,/ 并/ 通过/ 硬件/ 冗余/ 和/ 软件/ 状态/ 备份/ 技术/ 实现/ 了/ 路由器/ 系统/ 的/ 高可用性/ ./ 虚拟/ 路由器/ 系统/ 相对/ BWOS/ 平台/ ,/ 主要/ 是/ 在/ 控制/ 层面/ 增加/ 了/ 虚/ 接口/ 管理/ ,/ 并/ 屏蔽/ 虚/ 接口/ 对/ 其它/ 模块/ 的/ 影响/ ./ 用户/ 配置/ 虚/ 接口/ 后/ ,/ 系统/ 在/ 接口/ 管理/ 模块/ 增加/ 虚/ 接口/ 处理/ ./ 接口/ 管理/ 向/ 其它/ 协议/ 模块/ 通告/ 接口/ 状态/ 信息/ 时/ 与/ 其它/ 物理/ 接口/ 完全一致/ ,/ 协议/ 模块/ 不/ 关心/ 虚/ 接口/ 报文/ 收发/ 具体/ 细节/ ./ 数据/ 层面/ ,/ 虚拟/ 路由器/ 将/ 常规/ 报文/ 转发/ 与/ 封装/ // 解/ 封装/ 结合/ 起来/ ,/ 保证/ VegaNet/ 报文/ 的/ 快速/ 处理/ ./ 虚拟/ 路由器/ 主要/ 功能模块/ 结构/ 如图/ 7/ 所示/ ./ 各/ 模块/ 描述/ 如下/ :/ (/ 1/ )/ 网络接口/ 控制/ (/ NICTL/ )/ ./ 网络接口/ 管理/ 模/ 一个/ VR/ ./ 虚拟/ 网络/ 中/ 的/ IPv4/ 通信/ 对于/ 承载/ 它/ 的/ IPv6/ 网络/ 来说/ 是/ 完全/ 透明/ 的/ ./ 块/ 中/ 增加/ 虚/ 接口/ 管理/ ./ 虚/ 接口/ 和/ 其它/ 物理/ 接口/ 一样/ 具有/ 各种/ 接口/ 状态/ 信息/ :/ 管理/ 状态/ 、/ 链路/ 协议/ 状态/ 、/ MTU/ 等等/ ,/ NICTL/ 模块/ 会/ 将/ 虚/ 接口/ 状态/ 信息/ 通告/ 系统/ 中/ 关心/ 接口/ 状态/ 的/ 模块/ ./ 另外/ ,/ 该/ 模块/ 还/ 与/ 数据/ 层面/ 有/ 消息/ 交互/ ,/ 主要/ 是/ 将/ 虚/ 接口/ 的/ 对/ 端/ IPv6/ 地址/ 信息/ 下/ 发给/ 数据/ 层/ 的/ SRAM/ 模块/ ,/ 用作/ 封装/ 头中/ 的/ 目的/ 地址/ ./ (/ 2/ )/ 配置管理/ (/ CFM/ )/ ./ 用户/ 通过/ 命令行/ 配置/ 创建/ 或/ 取消/ 虚/ 接口/ ,/ 针对/ 每个/ 生成/ 的/ 虚/ 接口/ 用户/ 还/ 需/ 配置/ 虚/ 链路/ 对/ 端的/ IPv6/ 地址/ ./ 由于/ VegaNet/ 中/ VR/ 只有/ 一个/ 连入/ CERNET2/ 的/ IPv6/ 接口/ :/ UCI/ ,/ 所以/ 虚/ 链路/ 关心/ 的/ 对/ 端/ 地址/ 就是/ UCI/ 上/ 的/ IPv6/ 全局/ 地址/ ./ (/ 3/ )/ VLSP/ ./ 在/ 虚拟/ 链路/ 上/ 收发/ VLSP/ 协议/ 报文/ ,/ 按/ 4.2/ 节/ 所述/ 实现/ 虚/ 接口/ 的/ 可达性/ 检测/ 、/ 跳数/ 测量/ 、/ 参数/ 协商/ 等/ 功能/ ./ (/ 4/ )/ 路由/ 协议/ 模块/ (/ RoutingProtocol/ )/ ./ 路由/ 协议/ 模块/ 不/ 关心/ 虚/ 接口/ 行为/ ,/ 按/ 传统/ 方式/ 运行/ ./ 各/ 协议/ 模块/ 可以/ 从/ 虚/ 接口/ 收发报/ 文/ ,/ 操作/ 方式/ 和/ 物理/ 接口/ 完全/ 一样/ ./ 虚/ 接口/ 报文/ 收发/ 涉及/ 的/ 封装/ 和解/ 封装/ 都/ 由/ 数据/ 层/ 完成/ ,/ 对/ 上层/ 模块/ 是/ 透明/ 的/ ./ (/ 5/ )/ 路由/ 管理/ (/ RoutingManage/ )/ ./ 路由/ 协议/ 可以/ 通过/ 虚/ 接口/ 收发/ 协议/ 报文/ ,/ 会/ 生成/ 以虚/ 接口/ 为/ 出/ 接口/ 的/ 路由/ 项/ ./ 路由/ 管理/ 模块/ 将/ 核心/ 路由表/ 项/ 通告/ 给/ 数据/ 层/ ,/ 前缀/ 信息/ 通知/ 给/ TCAM/ 模块/ ,/ 匹配/ 处理/ 信息/ 通知/ 给/ SRAM/ 存储/ ./ (/ 6/ )/ 转/ 发表/ 存储/ 及/ 数据/ 转发/ (/ FIB/ &/ PacketFor/ -/ warding/ )/ ./ 三元/ 内容/ 可/ 寻址/ 存储器/ (/ TCAM/ )/ 是/ 一种/ 特定/ 类型/ 的/ 完全/ 相联/ 存储器/ ,/ 允许/ 完全/ 并行/ 的/ 查找/ 转/ 发表/ 或/ 分类器/ 数据库/ ./ 静态/ 随机/ 存储器/ (/ SRAM/ )/ 是/ 一种/ 广泛应用/ 的/ 高性能/ 存储器/ ,/ 在/ 路由器/ 查找/ 系/ Page7/ 统中/ ,/ 可以/ 配合/ TCAM/ 用于/ 存储/ 匹配/ 表项/ 信息/ ./ 简而言之/ ,/ TCAM/ 模块/ 实现/ 快速/ 的/ 路由/ 前缀/ 最长/ 匹配/ ,/ SRAM/ 中/ 存储/ 了/ TCAM/ 查询/ 结果/ 对应/ 的/ 处理/ 信息/ ./ 为了/ 提高/ 硬件/ 处理速度/ ,/ VR/ 通过/ 一次/ 查表/ 获取/ 封装/ 及/ 转发/ 相关/ 所有/ 信息/ ./ 而且/ 因为/ VR/ 只/ 通过/ UCI/ 连入/ CERNET2/ ,/ 封装/ 后/ 的/ IPv6/ 报文/ 转发/ 无需/ 路由/ 查询/ ,/ 固定/ IPv6/ 下/ 一/ 跳/ 发送/ ./ 所以/ ,/ 数据/ 层面/ 只/ 需要/ IPv4/ 转/ 发表/ ./ 对于/ 需要/ 封装/ 处理/ 的/ 报文/ ,/ 它/ 所/ 匹配/ 的/ 路由/ 前缀/ 在/ 对应/ SRAM/ 的/ 存储/ 中/ 会/ 增加/ 用于/ 封装/ 的/ 地址/ 信息/ ./ 概括/ 起来/ ,/ 虚拟/ 路由器/ 中/ 数据/ 层面/ 主要/ 有/ 3/ 种/ 报文/ 处理/ 行为/ :/ ①/ 接收/ IPv4/ 报文/ ,/ 路由/ 匹配/ 结果/ 是/ 进行/ 常规/ IPv4/ 转发/ ./ ②/ 接收/ IPv4/ 报文/ ,/ 路由/ 匹配/ 结果/ 是/ IPv6/ 封装/ 发送/ ,/ 则/ 从/ SRAM/ 存储/ 中/ 获取/ 封装/ 地址/ ,/ 封装/ 成/ IPv6/ 报文/ 后/ 无需/ 查表/ ,/ 固定/ 下/ 一/ 跳/ 发送/ ./ ③/ 接收/ IPv6/ 封装/ 报文/ ,/ 先解/ 封装/ ,/ 然后/ 进行/ IPv4/ 转发/ 处理/ ./ (/ 7/ )/ 封装/ // 解/ 封装/ (/ Encapsulation/ &/ Decapsula/ -/ tion/ )/ ./ 将/ IPv4/ 报文/ 加上/ IPv6/ 头/ 封装/ 成/ IPv6/ 报文/ ,/ 或者/ 将/ IPv6/ 封装/ 报/ 文解/ 封装/ 成/ IPv4/ 报文/ ./ 4.2/ 虚/ 链路管理/ 基于/ VegaNet/ 的/ 网络/ 实验/ 可能/ 需要/ 获取/ 与/ 虚/ 链路/ 相关/ 的/ 数据/ ,/ 如虚/ 链路/ 两端/ 往返/ 时间/ 等/ ./ 另外/ ,/ 对于/ 虚/ 链路/ 实际/ 转发/ 路径/ 或/ 转发/ 跳数/ 的/ 测量/ 有助于/ 实现/ VegaNet/ 与/ CERNET2/ 的/ 网络故障/ 同步/ ./ VegaNet/ 通过/ 在/ VR/ 上/ 部署/ VLSP/ 协议/ 来/ 实现/ 以上/ 目标/ ,/ 具体/ 包括/ 以下/ 子/ 功能/ :/ (/ 1/ )/ 双向通信/ 可达性/ 检测/ ./ 对于/ 虚/ 链路/ ,/ 传统/ 设图/ 8VLSP/ 协议/ 报文格式/ 5/ 部署/ 及/ 实验/ 虚拟/ 路由器/ 系统/ 现已/ 完成/ V1/ ./ 0/ 版本/ 的/ 研发/ ./ 实现/ 的/ 功能/ 包括/ 虚/ 接口/ 的/ 配置管理/ 、/ VLSP/ 协议/ 、/ 基于/ 虚/ 链路/ 的/ OSPF/ 协议/ 及/ BGP/ 协议/ 、/ 硬件/ 实现/ VegaNet/ 报文/ 的/ 快速/ 转发/ 、/ 远程/ 对/ VegaNet/ 网络/ 的/ 故障注入/ 及/ 故障/ 消除/ ./ 而且/ ,/ 我们/ 在/ CERNET2/ 清计/ 中/ 通过/ 路由/ 可达性/ 确定/ 链路/ 通信/ 的/ 有效性/ ,/ 而且/ 多为/ 单向/ 检测/ ./ VegaNet/ 中/ ,/ VLSP/ 协议/ 通过/ 发送/ 请求/ 报文/ 并/ 接收/ 应答/ 报文/ ,/ 达到/ 双向通信/ 可达性/ 检测/ 的/ 目的/ ./ (/ 2/ )/ 往返/ 时间/ 测量/ ./ 仍然/ 利用/ VLSP/ 协议/ 的/ 请求/ 、/ 响应/ 报文/ 完成/ ,/ 每/ 一个/ 响应/ 报文/ 总是/ 和/ 一个/ 请求/ 报文/ 对应/ ,/ 它们/ 的/ SeqNum/ 相等/ ./ 发送/ 请求/ 报文/ 时/ VR/ 记下/ 发送/ 时间/ ,/ 所以/ 收到/ 应答/ 报文/ 的/ 一端/ 通过/ 计算/ 请求/ 报文/ 发送/ 时间/ 与/ 应答/ 报文/ 的/ 到达/ 时间/ 的/ 差值/ 就/ 能/ 得到/ 虚/ 链路/ 的/ 往返/ 时间/ ./ (/ 3/ )/ 虚/ 链路/ 实际/ 转发/ 跳数/ 测量/ ./ 强制/ VLSP/ 协议/ 请求/ 报文/ 的/ 初始/ 跳数/ 总为/ 一/ 固定值/ (/ 如/ 64/ )/ ,/ 虚/ 链路/ 两端/ 可/ 根据/ 接收/ 的/ 协议/ 请求/ 报文/ 的/ 到达/ 跳数/ ,/ 获得/ 虚/ 链路/ 到达/ 方向/ 的/ 实际/ 转发/ 跳数/ ./ (/ 4/ )/ 精确/ 路径/ 跟踪/ ./ 在/ VLSP/ 功能模块/ 中/ 集成/ IPv6Traceroute/ 机制/ ./ (/ 5/ )/ 参数/ 协商/ ./ 同/ 一条/ 虚/ 链路/ 两端/ 的/ 虚/ 接口/ 可以/ 协商/ 接口/ MTU/ 、/ Bandwidth/ 以及/ 进行/ 地址/ 冲突/ 及/ 同一/ 网段/ 的/ 检测/ ./ 另外/ ,/ 虚/ 链路/ 加密传输/ 时/ 还/ 可/ 协商/ 密钥/ 和/ 加密算法/ ./ VLSP/ 协议/ 报文/ 交互/ 机制/ 非常简单/ :/ VR/ 定时/ 向/ 虚/ 链路/ 对端/ 发送/ VLSP/ 请求/ 报文/ ;/ 若/ VR/ 从/ 某个/ 虚/ 接口/ 收到/ VLSP/ 请求/ 报文/ ,/ 则/ 按/ 上述/ 机制/ 回送/ 应答/ 报文/ ,/ 每/ 一个/ 应答/ 报文/ 唯一/ 对应/ 一个/ 请求/ 报文/ ./ VLSP/ 报文格式/ 如图/ 8/ 所示/ ./ VLSP/ 协议/ 作为/ VegaNet/ 中/ 虚拟/ 链路/ 的/ 链路层/ 协议/ ,/ 服务/ 的/ 对象/ 是/ Ipv4/ 虚拟/ 网络/ ,/ 但/ 其/ 协议/ 数据/ 直接/ 紧跟/ Ipv6/ 包头/ ./ VLSP/ 协议/ 现有/ 设计/ 已能/ 完成/ 上述/ 前/ 4/ 项/ 功能/ ./ 当然/ ,/ 最后/ 一项/ 功能/ 利用/ 保留字/ 段/ 并/ 对/ 协议/ 进行/ 简单/ 扩展/ 后/ 也/ 能/ 完成/ ./ 华/ 大学/ 校园网/ 部署/ 了/ 3/ 台/ 虚拟/ 路由器/ 进行/ 实验/ ./ CERNET2/ 是/ 一个/ 纯/ IPv6/ 网络/ ,/ 2004/ 年/ 开通/ ,/ 现已/ 在/ 清华大学/ 校园/ 实现/ 了/ 全面/ 覆盖/ ,/ 并且/ 日常/ 有/ 大量/ 实验/ 或/ 应用/ 流量/ 出入/ ./ 图/ 9/ 左边/ 部分/ 是/ 虚拟/ 路由器/ 部署/ 的/ 物理/ 连接/ 拓扑/ ,/ VR1/ 直连/ 清华大学/ 第/ 2/ 边界/ 路由器/ ,/ VR2/ 通过/ 3/ 跳/ 连接/ 清华大学/ 第/ 1/ 边界/ 路由器/ ,/ VR3/ 通过/ 3/ 跳/ 连接/ 清华大学/ 核心/ 路由器/ ,/ VR/ 接入/ CERNET2/ 全是/ 通过/ 100Mb/ // s/ 以太网/ 链路/ 进行/ Page8IPv6/ 连接/ ./ 在/ 每个/ VR/ 下面/ 通过/ 100Mb/ // s/ 以太网/ 链路/ 连接/ 一台/ 实验/ PC机/ ,/ 为/ IPv4/ 连接/ ./ 图/ 9/ 右边/ 部分/ 就是/ 以/ 左边/ 网络连接/ 为/ 基础/ 生成/ 的/ 虚拟/ 网络拓扑/ ,/ 它/ 是/ 一个/ 品/ 字形/ 的/ IPv4/ 连接/ 拓扑/ ./ 可知/ ,/ Vlink1/ 、/ Vlink2/ 和/ Vlink3/ 分别/ 对应/ 着/ 5/ 跳/ 、/ 5/ 跳/ 、/ 7/ 跳/ 物理/ 链路/ ./ 由于/ 条件/ 有限/ ,/ 初步/ 实验/ 中/ VR/ 只能/ 图/ 9VegaNet/ 清华/ 校园网/ 网络拓扑/ 图/ 10VegaNet/ 实验室/ 网络拓扑/ 实验/ 1/ ./ 我们/ 通过/ Iperf/ 工具/ 进行/ 虚拟/ 网络/ 上/ 的/ 端系统/ 之间/ 的/ UDP/ 带宽/ 和/ Jitter/ 值/ 测试/ ./ PC1/ 、/ PC2/ 分别/ 充当/ Iperf/ 服务器端/ 和/ Iperf/ 客服/ 端/ ./ 首先/ ,/ 只/ 在/ VR1/ 与/ VR2/ 之间/ 运行/ OSPF/ 协议/ ,/ 测量/ 单跳/ 虚/ 链路/ 通信/ 相关/ 数据/ ,/ 对应/ 的/ Iperf/ 实验/ 路径/ 为/ 接着/ ,/ 只/ 在/ VR1/ 与/ VR3/ 以及/ VR2/ 与/ VR3/ 之间/ 运行/ OSPF/ 协议/ ,/ 测量/ 多/ 跳/ 虚/ 链路/ 通信/ 的/ 测量/ 值/ ,/ 对应/ 的/ Iperf/ 实验/ 路径/ 为/ PC1/ </ -/ >/ VR1/ </ -/ >/ VR3/ </ -/ >/ VR2/ </ -/ >/ PC2/ ./ 测试/ 中/ Iperf/ 配置/ 带宽/ 依次/ 增加/ 实验/ 流量/ ./ 图/ 11/ 是/ CERNET2/ 环境/ 下/ 的/ 测试/ 结果/ ./ 当/ 流量/ 配置/ 超过/ 90Mbps/ ,/ 发现/ iperf/ 显示/ 有效/ 测试/ 流量/ 急剧下降/ ./ 所以/ ,/ 90Mbps/ 流量/ 是/ 实验/ 中/ 端系统/ 所/ 能/ 发出/ 的/ 流量/ 上限/ ./ 而且/ ,/ 虚拟/ 网络/ 可以/ 为/ 百兆/ 链路/ 下/ 连/ 的/ 端系统/ 百兆/ 接入/ CERNET2/ ,/ 3/ 台/ PC/ 的/ 硬件/ 配置/ 均/ 为/ Pentium1/ ./ 5GHz/ 处理器/ 、/ 512MB/ 内存/ ,/ 安装/ WindowsXP/ 系统/ ./ 为了/ 对照/ ,/ 我们/ 在/ 实验室/ 也/ 搭建/ 了/ 对应/ 的/ 简化/ VegaNet/ 网络拓扑/ 进行/ 完全/ 一样/ 的/ 实验/ ,/ 如图/ 10/ 所示/ ./ 实验室/ 网络/ 环境/ 中/ ,/ PC机/ 到/ 虚拟/ 路由器/ 是/ 百兆/ 连接/ ,/ 其它/ 都/ 是/ 千兆/ 连接/ ./ 提供/ 线速/ UDP/ 带宽/ ,/ 且/ 无论/ 单跳/ 虚/ 链路/ 或/ 多/ 跳/ 虚/ 链路/ ,/ UDP/ 带宽/ 测试/ 结果/ 基本一致/ ./ CERNET2/ 环境/ 下端/ 到/ 端/ UDP/ 通信/ 中/ 平均/ Jitter/ 值/ 测量/ 结果/ 都/ 在/ 3.2/ ms/ 以内/ 变化/ ./ 图/ 12/ 是/ 实验室/ 环境/ 下/ 的/ 测试/ 结果/ ,/ UDP/ 带宽/ 测试/ 结果/ 与/ CERNET2/ 环境/ 类似/ ,/ 但/ Jitter/ 值/ 变化/ 范围/ 缩小/ 在/ 0/ ~/ 1.7/ ms/ ,/ 说明/ VegaNet/ 实际/ 网络/ 部署/ 时所/ 面对/ 的/ 网络/ 环境/ 流量/ 更为/ 复杂/ ./ 实验/ 2/ ./ 我们/ 分析/ OSPF/ 协议/ 在/ 虚拟/ 网络/ 上/ 的/ 运行状况/ 以及/ 运行状况/ 变化/ 对端/ 到/ 端/ 流量/ 的/ 影响/ ./ 首先/ ,/ 在/ 各/ 虚拟/ 路由器/ 的/ 所有/ 接口/ 上/ 都/ 使/ 能/ OS/ -/ PF/ 协议/ ,/ VR/ 之间/ 相互/ 学习/ 路由/ ./ 实验/ 中/ ,/ 利用/ iperf/ 测试/ PC1/ 到/ PC2/ 之间/ 的/ TCP/ 吞吐量/ ;/ 同时/ ,/ 利用/ hrPING/ 工具/ 测试/ PC1/ 到/ PC2/ 的/ RTT/ 值/ ,/ hrPING/ 是/ 一个/ 高精度/ 的/ PING/ 工具/ ./ OSPF/ 稳定/ 后/ 开始/ 测试数据/ ,/ 在/ 第/ 50s/ 向/ 虚拟/ 网络/ 注入/ Vlink1/ 链路/ 故障/ Page9/ 事件/ ,/ 并/ 在/ 第/ 100s/ 注入/ Vlink1/ 链路/ 恢复正常/ 事件/ ,/ 实验/ 2/ 总/ 测试/ 持续时间/ 为/ 200s/ ./ 图/ 13/ 显示/ 了/ 实验/ 结果/ ,/ 对于/ iperf/ 端到/ 端/ RTT/ 值/ ,/ 可以/ 看出/ 前/ 50/ 多/ 秒/ RTT/ 都/ 保持/ 在/ 0.7/ ms/ 左右/ ,/ Vlink1/ 断连后/ RTT/ 在/ 1ms/ 左右/ ,/ 当/ Vlink1/ 恢复正常/ 后/ RTT/ 又/ 回落/ 到/ 0.7/ ms/ ./ 同样/ ,/ TCP/ 吞吐量/ 刚/ 开始/ 能/ 达到/ 90Mbps/ ,/ 随着/ 虚/ 链路/ 故障/ 发生/ 而/ 略有/ 降低/ ,/ 故障/ 恢复正常/ 后/ TCP/ 吞吐量/ 也/ 回到/ 90Mbps/ 以上/ ./ 初始/ 情况/ 中/ ,/ OSPF/ 协议/ 为/ VR1/ 与/ VR2/ 选择/ 的/ 最/ 短/ 路径/ 为/ 1/ 跳虚/ 链路/ 路径/ :/ Vlink1/ ;/ 当/ Vlink1/ 故障/ 发生/ ,/ OSPF/ 收敛/ 后/ 为/ VR1/ 与/ VR2/ 选择/ 的/ 最/ 短/ 路径/ 为/ 2/ 跳虚/ 链路/ 图/ 11/ 基于/ CERNET2/ 的/ VegaNet/ 中/ 带宽/ 和/ Jitter/ 值/ 测量/ 图/ 12/ 实验室/ 环境/ 中/ VegaNet/ 带宽/ 和/ Jitter/ 值/ 测量/ 图/ 13/ 基于/ CERNET2/ 的/ VegaNet/ 中/ RTT/ 和/ TCP/ 带宽/ 测量/ 路径/ :/ Vlink2/ —/ Vlink3/ ;/ 当/ 故障/ 恢复正常/ ,/ 该/ 通信/ 又/ 回到/ 1/ 跳虚/ 链路/ 路径/ ./ 此/ 过程/ 中/ ,/ 虽然/ 虚拟/ 链路/ 跳数/ 只有/ 增/ 、/ 减/ 1/ 跳/ 的/ 变化/ ,/ 但/ 结合/ 图/ 9/ 可知/ 其/ 对应/ 的/ 物理/ 链路/ 跳数/ 变化/ 为/ 7/ 跳/ ./ 所以/ ,/ 无论是/ 端到/ 端/ RTT/ 值/ ,/ 或是/ TCP/ 吞吐量/ ,/ 都/ 随着/ 故障/ 变化/ 而/ 有着/ 较为/ 明显/ 的/ 变化/ ./ 另外/ ,/ 两个/ 子/ 实验/ 数据/ 都/ 显示/ :/ 当/ 在/ 50s/ 时刻/ 注入/ 链路/ 故障/ 后/ ,/ 端到/ 端/ 通信/ 在/ 几秒/ 之内/ 就/ 立刻/ 受到/ 影响/ ,/ 而/ 在/ 100s/ 时刻/ 恢复正常/ 后/ ,/ 大约/ 在/ 几十秒/ 后端/ 到/ 端/ 通信/ 才/ 恢复/ 到/ 故障/ 前/ 的/ 状态/ ./ 这/ 是因为/ ,/ 链路/ 故障/ 发生/ 后/ OSPF/ 可以/ 立刻/ 选择/ 备用/ 路径/ 通知/ 数据/ 层面/ ,/ 而/ 链路/ 正常/ 后/ OSPF/ 要/ 经过/ 邻/ Page10/ 图/ 14/ 实验室/ 环境/ VegaNet/ 中/ RTT/ 和/ TCP/ 带宽/ 测量/ 居建/ 连/ 并/ 互发/ UPDATE/ 报文/ 才能/ 学到/ 新/ 的/ 路由/ ,/ 该/ 过程/ 耗时/ 较长/ ./ 这/ 与/ 真实/ 网络/ 中/ OSPF/ 运行/ 情况/ 完全一致/ ./ 同样/ 的/ 实验/ 也/ 在/ 图/ 10/ 所示/ 的/ 实验室/ 环境/ 下/ 完成/ ,/ 图/ 14/ 是/ 测试/ 结果/ ,/ RTT/ 测量/ 结果/ 明显/ 低于/ CERNET2/ 环境/ ,/ 而且/ RTT/ 值/ 和/ TCP/ 带宽/ 在/ OSPF/ 链路/ 故障/ 收敛/ 过程/ 的/ 变化/ 不/ 明显/ ./ 另外/ ,/ 我们/ 在/ 图/ 10/ 环境/ 中/ 测试/ 了/ 虚拟/ 路由器/ 的/ 极限/ 转发/ 能力/ ./ IXIA/ 测试仪/ 的/ 两个/ 千兆/ 接口/ 分别/ 连接/ VR1/ 和/ VR2/ 的/ 千兆/ 接口/ ,/ 形成/ 一个/ 全/ 千兆/ 连接/ 的/ 测试环境/ ./ 我们/ 测试环境/ 下/ VR1/ 到/ VR2/ 的/ IPv4/ 数据/ 转发/ 能力/ ./ 测试/ 结果/ 如表/ 3/ 所示/ ,/ 平均/ 能/ 达到/ 近/ 800Mbps/ 的/ IPv4/ 报文/ 转发/ 性能/ ./ 由于/ VegaNet/ 中/ 报文/ 转发/ 过程/ ,/ 需要/ IPv6/ 头部/ 封装/ ,/ 不可避免/ 会/ 有/ 相应/ 带宽/ 的/ 损耗/ ./ 所以/ ,/ VegaNet/ 基本/ 达到/ 线速/ 转发/ 能力/ ./ 64/ ~/ 1478/ (/ 随机/ )/ 最后/ ,/ 我们/ 还/ 利用/ 图/ 9/ 环境/ 中/ 的/ 端系统/ ,/ 进行/ 了/ 视频/ 播放/ 、/ FTP/ 等/ 常规/ 应用/ 实验/ ,/ 都/ 能/ 正常/ 完成/ ./ 综合/ 所有/ 实验/ ,/ 我们/ 可以/ 得出/ 以下/ 结论/ :/ (/ 1/ )/ VegaNet/ 网络/ 能够/ 为/ 用户/ 提供/ 真实/ 、/ 高速/ (/ 2/ )/ VegaNet/ 网络/ 中路/ 由/ 协议/ 运行/ 情况/ 及其/ 对/ (/ 3/ )/ 部署/ 于/ 实际/ 网络/ 的/ VegaNet/ ,/ 能够/ 让/ 网络/ 的/ 端/ 到/ 端/ 流量/ 转发/ ./ 转发/ 流量/ 的/ 影响/ 与/ 实际/ 网络/ 基本相同/ ./ 实验/ 面/ 对象/ 实际/ 网络/ 一样/ 的/ 复杂/ 环境/ ./ (/ 4/ )/ VegaNet/ 支持/ 人为/ 注入/ 链路/ 故障/ 事件/ 及/ 故障/ 恢复/ 事件/ ./ 6/ 总结/ 及下/ 一步/ 工作/ 本文/ 所/ 提出/ VegaNet/ 的/ 设计/ 目标/ 是/ 为/ 新型/ 网络协议/ 实验/ 提供/ 一个/ 架构/ 平台/ 以及/ 对/ 运营/ 网络/ 进行/ 模拟/ 仿真/ 并/ 展开/ 网络/ 性能/ 研究/ 和/ 分析/ ./ 本文/ 首先/ 提出/ 了/ 通用/ 的/ VegaNet/ 模型/ ,/ 并且/ 分析/ 了/ VageNet/ 虚/ 链路/ 的/ 属性/ ./ VageNet/ 通过/ 分析/ 虚/ 链路/ 的/ 实际/ 转发/ 跳数/ 来/ 决定/ 的/ 链路/ 状态/ ,/ VegaNet/ 与/ CERNET2/ 的/ 故障/ 同步/ 就是/ 以此/ 为据/ 设计/ 的/ ./ 此外/ ,/ 介绍/ 了/ 一种/ 以/ CERNET2/ 为/ 底层/ 物理/ 网络/ 的/ VegaNet/ 设计/ 实例/ 及/ 部署/ 方案/ ,/ 包括/ 具体/ 的/ 地址/ 配置/ 、/ 路由/ 交互/ 、/ 报文/ 封装/ 及/ 数据/ 转发/ 过程/ ./ VegaNet/ 的/ 核心/ 设备/ :/ 虚拟/ 路由器/ ,/ 是/ 以/ BWOS/ 平台/ 为/ 基础/ 而/ 开发/ 的/ ,/ 本文/ 给出/ 了/ 优化/ 后/ 的/ 系统/ 体系结构/ 及/ 重要/ 模块/ 的/ 设计/ 细节/ ./ 本文/ 还/ 设计/ 了/ VLSP/ 协议/ ,/ 实现/ 虚拟/ 链路/ 两端/ 的/ 参数/ 协商/ 、/ 可达性/ 检测/ 、/ 路径/ 跟踪/ 等/ 功能/ ./ 目前/ ,/ 虚拟/ 路由器/ 已/ 完成/ V1/ ./ 0/ 版本/ 的/ 研发/ ./ 实现/ 功能/ 包括/ 虚/ 接口/ 的/ 配置管理/ 、/ VLSP/ 协议/ 、/ 基于/ 虚/ 链路/ 的/ OSPF/ 协议/ 及/ BGP/ 协议/ 、/ 硬件/ 实现/ VegaNet/ 报文/ 的/ 快速/ 转发/ 、/ 远程/ 对/ VegaNet/ 网络/ 的/ 故障注入/ 及/ 故障/ 恢复/ ./ 此外/ ,/ 我们/ 已/ 在/ CERNET2/ 清华大学/ 校园网/ 内部/ 部署/ 了/ 3/ 台/ 虚拟/ 路由器/ 进行/ 实验/ ./ 它/ 运行/ 在/ 真正/ 的/ 商用/ 路由/ 平台/ 上/ ,/ 承载/ 着/ 真实/ 、/ 高速/ 的/ 用户/ 流量/ ,/ 面对/ 着/ 如/ 真实/ 网络/ 一样/ 的/ 复杂/ 情况/ ;/ 而且/ 还/ 支持/ 人为/ 向/ VegaNet/ 注入/ 链路/ 故障/ 事件/ 及/ 故障/ 恢复/ 事件/ ./ 实验/ 结果/ 说明/ VegaNet/ 网络/ 可以/ 为/ 用户/ 提供/ 几尽/ 真实/ 的/ 网络/ 实验/ 及/ 模拟/ 分析/ 环境/ ./ VegaNet/ 下/ 一步/ 工作/ 将/ 在/ 以下/ 几个/ 方面/ 进行/ :/ (/ 1/ )/ 大/ 范围/ 部署/ ,/ 设计/ 激励机制/ 引入/ 更/ 多/ 真实/ 流量/ ;/ (/ 2/ )/ 新型/ 路由/ 协议/ 的/ 实施/ ,/ 课题组/ 提出/ 的/ 自愈/ 路由/ 协议/ 将/ 以/ VegaNet/ 为/ 实验/ 网络/ 环境/ 验证/ 其/ 改进/ 特性/ ;/ (/ 3/ )/ 对/ CERNET2/ 进行/ 深度/ 监控/ 及/ 分析/ ,/ 设计/ 实验/ 方/ Page11/ 案/ 、/ 收集/ 实验/ 数据/ ,/ 并/ 对/ CERNET2/ 网络体系结构/ 、/ 协议/ 运行/ 、/ 运营/ 流量/ 进行/ 研究/ 分析/ ,/ 并/ 提出/ 改进/ 建议/ ;/ (/ 4/ )/ 改善/ 虚拟/ 网络/ 及/ 虚拟/ 设备设计/ ./ 改进/ 虚拟/ 路由器/ 报文/ 转发/ 能力/ ,/ 从而/ 提高/ 整个/ 虚拟/ 网络/ 的/ 带宽/ ;/ Vega/ -/ Net/ 及/ VR/ 将/ 支持/ 更/ 丰富/ 的/ 管理员/ 注入/ 事件/ ./ 致谢/ 本/ 论文/ 工作/ 在/ 清华大学/ 完成/ ,/ 感谢/ 清华大学/ 计算机网络/ 研究所/ 提供/ 的/ 研究/ 项目/ 支持/ !/ 

