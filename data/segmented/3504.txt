Page1P2P/ 环境/ 下面/ 向/ 不/ 确定/ 数据/ 的/ Top/ -/ 犽/ 查询/ 孙永佼/ 袁野/ 王国/ 仁/ (/ 医学影像/ 计算/ 教育部/ 重点/ 实验室/ (/ 东北大学/ )/ 沈阳/ 110819/ )/ (/ 东北大学/ 信息科学/ 与/ 工程学院/ 沈阳/ 110819/ )/ 摘要/ 分布式/ 环境/ 中/ 的/ top/ -/ k/ 查询/ 已经/ 有/ 了/ 广泛/ 的/ 研究/ ./ 由于/ 仪器/ 不/ 精确/ 和/ 网络延时/ 等/ 原因/ ,/ 大多数/ 分布式/ 数据/ 都/ 存在/ 不确定性/ ./ 文中/ 基于/ 水平/ 分布/ 在/ P2P/ 网络/ 中/ 的/ 不/ 确定/ 数据/ 提出/ 了/ 一个/ 有效/ 的/ top/ -/ k/ 查询处理/ 方法/ ./ 首先/ 利用/ Quad/ -/ tree/ 构建/ 一个/ 分布式/ 的/ 不/ 确定/ 数据/ 的/ 索引/ ,/ 并/ 基于/ 索引/ 提出/ 了/ 一个/ 空间/ 剪枝/ 算法/ ./ 然后/ ,/ 根据/ 局部/ top/ -/ k/ 概率/ 与/ 全局/ top/ -/ k/ 概率/ 之间/ 的/ 关系/ 提出/ 不/ 确定/ 数据/ 成为/ top/ -/ k/ 概率/ 的/ 上界/ ,/ 根据/ top/ -/ k/ 概率/ 与/ skyline/ 概率/ 之间/ 的/ 关系/ 提出/ 不/ 确定/ 数据/ 成为/ top/ -/ k/ 概率/ 的/ 下界/ ,/ 通过/ 两种/ 概率/ 剪枝/ 算法/ 来/ 减少/ top/ -/ k/ 查询/ 在/ 网络/ 中/ 的/ 传输/ 和/ 计算/ 代价/ ,/ 并且/ 进一步/ 减少/ 候选/ 集/ 大小/ ./ 最后/ 文中/ 采用/ 采样/ 的/ 方法/ 来/ 计算/ 候选/ 集/ 的/ top/ -/ k/ 概率/ 以/ 确定/ 最终/ 的/ top/ -/ k/ 查询/ 结果/ ./ 大量/ 的/ 实验/ 验证/ 了/ 算法/ 的/ 有效性/ ./ 关键词/ top/ -/ k/ 查询/ ;/ skyline/ 概率/ ;/ P2P/ ;/ Quad/ -/ tree/ ;/ 不/ 确定/ 数据/ 1/ 引言/ P2P/ 技术/ 致力于/ 高效/ 合理/ 地/ 组织/ 和/ 利用/ Internet/ 边缘/ 大量/ 分布/ 的/ 计算/ 、/ 存储/ 、/ 通信/ 以及/ 信息/ 等/ 资源/ ,/ 已经/ 成为/ 有效/ 实现/ 分布式/ 网络/ 环境/ 下/ 信息/ 资源共享/ 和/ 数据交换/ ,/ 实现/ 资源整合/ 利用/ 的/ 重要/ 手段/ ./ P2P/ 网络/ 已/ 成为/ 当前/ 网络/ 中/ 资源共享/ 的/ 重要/ 应用/ 之一/ [/ 1/ -/ 4/ ]/ ./ 在/ 数据共享/ 和/ 通信/ 的/ 过程/ 中/ ,/ P2P/ 网络/ 中/ 数据/ 的/ 传输/ 代价/ 通常/ 是/ 非常/ 重要/ 的/ ./ 但是/ ,/ 在/ 许多/ 应用/ 中/ ,/ 查询/ 往往/ 不/ 需要/ 传输/ 每个/ 网络/ 节点/ 的/ 所有/ 数据/ ,/ 而是/ 传输/ 和/ 用户/ 需要/ 最/ 匹配/ 的/ 一小部分/ 数据/ 就/ 可以/ 了/ ,/ 比如/ top/ -/ k/ 查询/ 通过/ 用户/ 指定/ 的/ 打分/ 函数/ 返回/ 和/ 用户/ 需要/ 最/ 匹配/ 的/ k/ 个/ 数据/ 对象/ ./ 在/ P2P/ 环境/ 中/ 的/ top/ -/ k/ 查询/ 已经/ 有/ 了/ 广泛/ 的/ 研究/ ./ 但是/ 随着/ 计算机网络/ 和/ 计算机/ 应用/ 技术/ 的/ 迅猛发展/ ,/ 特别/ 是/ Web/ 服务/ 、/ 传感器/ 网络/ 、/ RFID/ 以及/ 基于/ 位置/ 的/ 服务/ 等/ 技术/ 的/ 广泛应用/ ,/ 使得/ 不/ 确定/ 数据/ 无处不在/ ,/ 并/ 大量/ 存在/ 于/ 这些/ 先进/ 的/ 应用/ 系统/ 中/ ./ 因此/ 在/ P2P/ 环境/ 中/ 不/ 确定/ 数据/ 的/ top/ -/ k/ 查询/ 问题/ 仍旧/ 很具/ 挑战性/ ./ 不/ 确定/ 数据/ 的/ 表现形式/ 多种多样/ ,/ 根据/ 应用/ 特点/ 和/ 数据/ 形式/ 差异/ ,/ 研究者/ 已经/ 提出/ 了/ 多种/ 针对/ 不/ 确定/ 数据/ 的/ 数据模型/ ./ 这些/ 不/ 确定/ 数据模型/ 的/ 核心/ 都/ 来自/ 于/ 可能/ 世界/ 模型/ [/ 5/ -/ 6/ ]/ ./ 可能/ 世界/ 模型/ 从/ 一个/ 或/ 多个/ 不/ 确定/ 的/ 数据源/ 演化出/ 诸多/ 确定/ 的/ 数据库/ 实例/ ,/ 称为/ 可能/ 世界/ 实例/ ,/ 并且/ 所有/ 实例/ 的/ 概率/ 之/ 和/ 为/ 1/ ./ 虽然/ 可以/ 首先/ 分别/ 为/ 各个/ 实例/ 计算/ 查询/ 结果/ ,/ 然后/ 合并/ 中间/ 结果/ 以/ 生成/ 最终/ 的/ 查询/ 结果/ ,/ 但是/ 由于/ 可能/ 世界/ 实例/ 的/ 数量/ 远大于/ 不/ 确定/ 数据/ 的/ 规模/ ,/ 这种/ 方法/ 是/ 不/ 可行/ 的/ ./ 在/ P2P/ 环境/ 中/ ,/ 获得/ 所有/ 的/ 可能/ 世界/ 实例/ 需要/ 昂贵/ 的/ 网络/ 代价/ ,/ 即使/ 获得/ 了/ 所有/ 的/ 实例/ ,/ 计算/ 也/ 是/ 不/ 现实/ 的/ ./ 因此/ 在/ P2P/ 环境/ 下/ 对/ 不/ 确定/ 数据/ 进行/ top/ -/ k/ 查询处理/ 更是/ 一个/ 具有/ 挑战/ 的/ 问题/ ./ 为了/ 解决/ 这个/ 问题/ ,/ 本文/ 对/ P2P/ 环境/ 中/ 返回/ 不/ 确定/ 数据/ 的/ top/ -/ k/ 查询/ 提出/ 了/ 有效/ 的/ 处理/ 方法/ ./ 本文/ 假设/ 数据/ 是/ 水平/ 分布/ 在/ 超级/ 节点/ 构建/ 的/ P2P/ 网络/ 中/ 的/ ,/ 并且/ 用户/ 指定/ 的/ 打分/ 函数/ 是/ 单调/ 的/ ./ 在/ 本文/ 提出/ 的/ 方法/ 中/ ,/ 第/ 1/ 步/ ,/ 采用/ Quad/ -/ tree/ 在/ P2P/ 网络/ 中/ 对/ 不/ 确定/ 数据/ 建立/ 全局/ 索引/ ,/ 然后/ 基于/ 不/ 确定/ 数据/ 的/ 得分/ 范围/ 提出/ 了/ top/ -/ k/ 结果/ 在/ 空间/ 中/ 的/ 上界/ 与/ 下界/ ,/ 提出/ 了/ 空间/ 剪枝/ 算法/ 和/ 基本/ 的/ top/ -/ k/ 计算方法/ ./ 第/ 2/ 步/ ,/ 本文/ 通过/ 有力/ 的/ 证明/ 得出/ 本地/ top/ -/ k/ 概率/ 和/ 全局/ top/ -/ k/ 概率/ 之间/ 的/ 关系/ ,/ 提出/ 了/ top/ -/ k/ 概率/ 的/ 上界/ ./ 更/ 重要/ 的/ 是/ 通过/ 不/ 确定/ 数据/ 之间/ 的/ 支配/ 关系/ ,/ 证明/ 出/ skyline/ 概率/ 和/ top/ -/ k/ 概率/ 存在/ 一定/ 关系/ ,/ 提出/ 了/ top/ -/ k/ 概率/ 的/ 紧凑/ 下界/ ./ 通过/ 这/ 两步/ 过滤/ ,/ 可以/ 大大减少/ 候选/ 集/ 的/ 大小/ ,/ 进而/ 减少/ 了/ 处理/ top/ -/ k/ 查询/ 时/ 的/ 网络/ 传输/ 代价/ ./ 最后/ 通过/ 分布式/ 采样/ 算法/ 来/ 计算/ 候选/ 集/ 的/ top/ -/ k/ 概率/ 以/ 确定/ 最终/ 的/ top/ -/ k/ 查询/ 结果/ ./ 询做/ 了/ 形式化/ 的/ 定义/ ./ 本文/ 贡献/ :/ (/ 1/ )/ 本文/ 对/ P2P/ 环境/ 下/ 不/ 确定/ 数据/ 的/ top/ -/ k/ 查/ (/ 2/ )/ 本文/ 基于/ Quad/ -/ tree/ 提出/ 了/ 一个/ 对/ P2P/ 网/ (/ 3/ )/ 本文/ 提出/ 了/ 有效/ 的/ 空间/ 剪枝/ 方法/ 和/ 概率/ 剪/ (/ 4/ )/ 本文/ 采用/ 蒙特卡洛/ 采样/ 方法/ 在/ P2P/ 环境/ 中络/ 中/ 不/ 确定/ 数据/ 的/ 全局/ 索引/ ./ 枝/ 方法/ 来/ 减少/ top/ -/ k/ 查询/ 时/ 网络/ 的/ 传输/ 代价/ ./ 采样/ 计算/ 最终/ 的/ top/ -/ k/ 结果/ ./ 2/ 问题/ 定义/ 在/ 这节/ 中/ ,/ 首先/ 介绍/ 不/ 确定/ 数据/ 的/ 模型/ ,/ 然后/ 定义/ P2P/ 环境/ 中/ 不/ 确定/ 数据/ 的/ top/ -/ k/ 查询/ ./ 不/ 确定/ 数据模型/ :/ 设/ D/ 是/ 一个/ 不/ 确定/ 数据/ 集/ ,/ 并且/ D/ 由/ N/ 个/ 多维/ 元组/ ti/ 组成/ ,/ ti/ ∈/ D/ (/ 1/ / i/ / N/ )/ ./ 每/ 一个/ 元组/ ti/ 都/ 由/ 一组/ 不/ 确定/ 的/ 实例/ ai/ (/ ai1/ ,/ ai2/ ,/ …/ ,/ ain/ )/ 组成/ ./ 每/ 一个/ 实例/ 都/ 有/ 一个/ 存在/ 概率/ Pr/ (/ a/ )/ ,/ 并且/ Pr/ (/ a1/ )/ +/ Pr/ (/ a2/ )/ +/ ,/ …/ ,/ +/ Pr/ (/ an/ )/ =/ 1/ ./ 表/ 1/ 描述/ 的/ 是/ 不/ 确定/ 数据模型/ ./ 元组/ 实例/ t1a11/ ,/ a12Pr/ (/ a11/ )/ =/ 0.2/ ,/ Pr/ (/ a12/ )/ =/ 0.8/ t2a21/ ,/ a22Pr/ (/ a21/ )/ =/ 0.3/ ,/ Pr/ (/ a22/ )/ =/ 0.7/ t3a31/ ,/ a32/ ,/ a33Pr/ (/ a31/ )/ =/ 0.1/ ,/ Pr/ (/ a32/ )/ =/ 0.5/ ,/ Pr/ (/ a33/ )/ =/ 0.4/ t4a41Pr/ (/ a41/ )/ =/ 1/ 给定/ 一个/ 含有/ n/ 个/ 数据/ 的/ 数据/ 集/ D/ ,/ ti/ ∈/ D/ (/ 1/ / i/ / n/ )/ ,/ 对于/ 传统/ 的/ top/ -/ k/ 查询/ ,/ 通常/ 用户/ 可以/ 指定/ 一个/ 单调/ 的/ 打分/ 函数/ s/ (/ ti/ )/ =/ ∑/ d/ 其中/ sj/ (/ ti/ )/ 表示/ ti/ 的/ d/ 维/ 特征/ ,/ wj/ 是/ 数据/ 在/ 第/ j/ 维上/ 的/ 权重/ ./ s/ (/ ti/ )/ 是/ 用户/ 针对/ 数据/ 的/ 喜好/ 程度/ 的/ 得分/ ./ s/ (/ ti/ )/ 最终/ 将/ 数据/ 对象/ 在/ 各个/ 维上/ 的/ 特征值/ 聚合/ 成/ 一个/ 值/ ,/ 通过/ 每个/ 数据/ 的/ 得分/ 情况/ ,/ 返回/ 给/ 用户/ 最/ 满意/ 的/ k/ 个/ 结果/ ./ 在/ 本文/ 中/ ,/ 假设/ 分值/ 越小/ ,/ 排位/ 越靠/ 前/ ./ 在/ 不/ 确定/ 数据/ 的/ 背景/ 下/ ,/ top/ -/ k/ 查询/ 的/ 定义/ 则/ 大不相同/ ./ 不再/ 是/ 通过/ 判断/ s/ (/ ti/ )/ 的/ 大小/ 来/ 决定/ 数据/ Page3/ 对象/ 是否是/ top/ -/ k/ 的/ 最终/ 结果/ ,/ 而是/ 通过/ 判断/ 一个/ 元组/ ti/ 能够/ 成为/ top/ -/ k/ 的/ 概率/ Prtop/ (/ ti/ )/ ./ 定义/ 1/ ./ 不/ 确定/ 数据/ 的/ top/ -/ k/ 查询/ ./ 假设/ 有/ 一个/ 不/ 确定/ 数据库/ D/ (/ t1/ ,/ t2/ ,/ t3/ ,/ …/ ,/ tN/ )/ ,/ 一个/ 用户/ 指定/ 的/ 打分/ 函数/ s/ 和/ 一个/ 整数/ k/ ./ 那么/ ,/ 对/ 不/ 确定/ 数据/ ti/ 排在/ 第/ m/ 位/ 的/ 概率/ Prm/ (/ ti/ )/ 定义/ 如下/ :/ Prm/ (/ ti/ )/ =/ ∑/ sn/ 在/ 这里/ ,/ sn/ 是/ 不/ 确定/ 数据/ ti/ 的/ 每个/ 实例/ 的/ 得分/ ./ 在/ k/ 个/ 不/ 确定/ 数据/ (/ t1/ ,/ t2/ ,/ …/ ,/ tm/ ,/ …/ ,/ tk/ )/ ∈/ D/ 中/ ,/ 通过/ 计算/ 它们/ 的/ Prm/ (/ ti/ )/ ,/ 会/ 得到/ 每个/ 数据/ 排在/ 第/ m/ 位/ 的/ 概率/ ,/ 而/ top/ -/ k/ 查询/ 返回/ 每个/ 位置/ 上/ 概率/ 最大/ 的/ 数据/ ./ 根据/ 定义/ 1/ ,/ 在/ P2P/ 环境/ 中有/ 下面/ 定义/ 2/ ./ 定义/ 2/ ./ P2P/ 环境/ 中/ 不/ 确定/ 数据/ 的/ top/ -/ k/ 查询/ ./ 假设/ P2P/ 网络/ 中/ 的/ 不/ 确定/ 数据库/ 为/ D/ =/ {/ D1/ ,/ D2/ ,/ …/ ,/ Dn/ }/ ,/ Di/ 为/ 第/ i/ 个/ 网络/ 节点/ 上/ 的/ 不/ 确定/ 数据/ 集合/ ./ 对于/ D/ 中/ 的/ 任意/ 一个/ 数据/ 对象/ t/ ∈/ D/ 来说/ ,/ 排/ 在/ 位置/ m/ 上/ 概率/ 表示/ 为/ Prm/ (/ t/ )/ ,/ Prm/ (/ t/ )/ ∈/ [/ 0/ ,/ 1/ ]/ ./ 最大/ 的/ 概率/ 表示/ 为/ MPm/ =/ max/ {/ Prm/ (/ t1/ )/ ,/ …/ ,/ Prm/ (/ tN/ )/ }/ ,/ 其中/ N/ 为/ D/ 中/ 数据/ 对象/ 的/ 个数/ ./ 在/ P2P/ 网络/ 中/ 不/ 确定/ 数据/ 的/ top/ -/ k/ 查询/ 返回/ 的/ 结果/ 集合/ t/ / 定义/ 为/ 每个/ 位置/ 上/ 概率/ 最大/ 的/ 数据/ 对象/ 集合/ ,/ 即/ t/ / =/ {/ argMP1/ ,/ argMP2/ ,/ …/ ,/ argMPk/ }/ ,/ 定义/ 3/ ./ 概率/ 阈值/ 的/ top/ -/ k/ 查询/ ./ 给定/ 一个/ 概率/ 阈值/ p/ (/ 0/ </ p/ / 1/ )/ ,/ PT/ -/ top/ -/ k/ 找到/ 一组/ 数据/ 对象/ 满足/ {/ t/ |/ t/ ∈/ T/ ,/ Ptop/ -/ k/ (/ t/ )/ / p/ }/ ./ 3Top/ -/ 犽/ 查询处理/ 框架/ 给定/ 一组/ P2P/ 环境/ 下/ 的/ 不/ 确定/ 数据库/ ,/ 那么/ 在/ P2P/ 环境/ 中/ 的/ 不/ 确定/ 数据/ 的/ top/ -/ k/ 查询/ 可以/ 由/ 以下/ 几个/ 步骤/ 完成/ :/ (/ 1/ )/ 空间/ 剪枝/ ./ 基于/ Quad/ -/ tree/ ,/ 在/ 网络/ 中/ 每/ 一个/ 节点/ 上/ 构建/ 一个/ 索引/ ./ 超级/ 节点/ 的/ 索引/ 结构/ 与/ 普通/ 节点/ 的/ 索引/ 结构/ 相似/ ,/ 但是/ 超级/ 节点/ 的/ 索引/ 是/ 通过/ 搜集/ 它/ 所在/ 的/ 子/ 网络/ 中/ 普通/ 结点/ 的/ 一些/ 概要/ 信息/ 而/ 建立/ 的/ ./ 在/ 超级/ 结点/ 之间/ 通过/ 广播/ 这些/ 概要/ 信息/ 建立/ 一个/ 全局/ 的/ 索引/ ./ 基于/ 全局/ 索引/ ,/ 每个/ 超级/ 节点/ 都/ 拥有/ P2P/ 网络/ 中/ 不/ 确定/ 数据/ 的/ 概要/ 信息/ ,/ 因此/ 可以/ 在/ top/ -/ k/ 查询/ 到达/ 时/ 在/ 超级/ 节点/ 上/ 对/ 全局/ 数据/ 进行/ 空间/ 剪枝/ ./ (/ 2/ )/ Top/ -/ k/ 概率/ 计算/ ./ 这个/ 部分/ 介绍/ 了/ top/ -/ k/ 概率/ 计算/ 的/ 整个/ 过程/ ,/ 其中/ 主要/ 分为/ 三个/ 方面/ ./ 首先/ 根据/ 局部/ top/ -/ k/ 概率/ 与/ 全局/ top/ -/ k/ 概率/ 之间/ 的/ 关系/ 给出/ 不/ 确定/ 数据/ 成为/ top/ -/ k/ 概率/ 的/ 上界/ ,/ 然后/ 根据/ top/ -/ k/ 概率/ 与/ skyline/ 概率/ 之间/ 的/ 关系/ 给出/ 不/ 确定/ 数据/ 成为/ top/ -/ k/ 概率/ 的/ 下界/ ,/ 最后/ 给出/ 了/ 分布式/ Skyline/ 概率/ 的/ 计算方法/ ./ (/ 3/ )/ 采样/ 计算/ ./ 在/ 最终/ 候选/ 集中/ 采用/ 蒙特卡洛/ 采样/ 方法/ 对/ 分布式/ 不/ 确定/ 数据/ 进行/ 采样/ 计算/ 来/ 获得/ 最终/ 结果/ ./ 4/ 基本/ 方法/ 不/ 确定/ 数据模型/ 在/ 空间/ 中/ 的/ 表现形式/ 如图/ 1/ ,/ 每个/ 不/ 确定/ 元组/ 都/ 是/ 以/ 离散/ 的/ 形式/ 分布/ 在/ 一定/ 范围/ 的/ 最小/ 边界/ 矩形/ 中/ 的/ ./ 显而易见/ ,/ 每个/ 不/ 确定/ 的/ 元组/ 都/ 有/ 一个/ 得分/ 的/ 最大值/ sU/ (/ t/ )/ 和/ 最小值/ sL/ (/ t/ )/ ./ 因此/ ,/ 有/ 下面/ 定理/ ./ 定理/ 1/ ./ 分值/ 剪枝/ ./ 给定/ 一个/ 不/ 确定/ 数据库/ D/ 和/ 一个/ 用户/ 指定/ 的/ 打分/ 函数/ s/ ,/ t1/ ,/ t2/ ,/ …/ ,/ tN/ 是/ D/ 中/ 的/ 不/ 确定/ 数据/ ./ 如果/ sL/ (/ ti/ )/ / sU/ (/ tj/ )/ ,/ 则/ s/ (/ ti/ )/ / s/ (/ tj/ )/ ,/ 其中/ 1/ / i/ / N/ ,/ 1/ / j/ / N/ ./ 那么/ ,/ ti/ 排在/ tj/ 之前/ ./ 反之/ 亦/ 成立/ ./ 证明/ ./ 因为/ sL/ (/ ti/ )/ / sU/ (/ tj/ )/ ∪/ sU/ (/ tj/ )/ / s/ (/ tj/ )/ / sL/ (/ ti/ )/ / s/ (/ tj/ )/ ,/ 所以/ s/ (/ ti/ )/ / sL/ (/ ti/ )/ ∪/ sL/ (/ ti/ )/ / s/ (/ tj/ )/ / s/ (/ ti/ )/ / s/ (/ tj/ )/ ./ 推论/ 1/ ./ 空间/ 剪枝/ ./ 给定/ 一个/ 不/ 确定/ 数据库/ D/ ,/ 一个/ 用户/ 指定/ 的/ 打分/ 函数/ s/ 和/ 一个/ 整数/ k/ ,/ T/ 是/ D/ 中/ 的/ 任意/ 一个/ 集合/ ,/ o/ 是/ 空间/ 中/ 的/ 任意/ 一点/ ./ 如果/ s/ (/ o/ )/ / sU/ (/ T/ )/ ∩/ |/ T/ |/ / k/ ,/ 那么/ ,/ T/ 一定/ 是/ top/ -/ k/ 中/ 的/ Page4/ 结果/ ;/ 如果/ s/ (/ o/ )/ / sU/ (/ T/ )/ ∩/ |/ T/ |/ / k/ ∩/ s/ (/ o/ )/ / sL/ (/ {/ D/ -/ T/ }/ )/ ,/ 那么/ ,/ {/ D/ -/ T/ }/ 一定/ 不是/ top/ -/ k/ 中/ 的/ 结果/ ./ 通过/ 以上/ 结论/ ,/ 可以/ 排除/ 掉/ 一部分/ 不/ 属于/ 结果/ 集中/ 的/ 数据/ 并且/ 可以/ 返回/ 一部分/ 结果/ 集中/ 的/ 数据/ ./ 在下文/ 中/ 主要/ 处理/ 的/ 是/ 不能/ 被/ 确定/ 是否是/ 结果/ 集中/ 的/ 数据/ ./ 因此/ 首先/ 利用/ Quad/ -/ tree/ 在/ P2P/ 网络/ 上/ 建立/ 全局/ 索引/ ,/ 然后/ 根据/ 空间/ 剪枝/ 方法/ 找出/ 不/ 能够/ 被/ 确定/ 是否是/ 结果/ 集中/ 的/ 数据/ ,/ 最后/ 在/ 分布式/ 环境/ 中/ 利用/ 式/ (/ 1/ )/ 计算/ 出/ 最终/ 结果/ [/ 7/ ]/ ./ 5Top/ -/ 犽/ 概率/ 计算/ 策略/ 进行/ 过滤/ ./ 和/ 下界/ (/ 定理/ 3/ 和/ 定理/ 5/ )/ ./ 首先/ 介绍/ 一下/ top/ -/ k/ 概率/ 计算/ 的/ 整个/ 过程/ :/ (/ 1/ )/ 构建/ 全局/ 索引/ ./ (/ 2/ )/ 在/ 全局/ 索引/ 上/ 利用/ 基本/ 方法/ 中/ 的/ 空间/ 剪枝/ (/ 3/ )/ 计算/ 剩余/ 不/ 确定/ 数据/ 的/ top/ -/ k/ 概率/ 的/ 上界/ (/ 4/ )/ 执行/ 概率/ 剪枝/ (/ 定理/ 2/ )/ ./ 根据/ 定义/ 1/ ,/ 可以/ 在/ 本地/ 计算/ 出/ 任意/ 一个/ 不/ 确定/ 数据/ 排在/ 第/ m/ 位置/ 的/ 概率/ ,/ 从而/ 得到/ 每个/ 位置/ 概率/ 最大/ 的/ 数据/ 作为/ 本地/ 数据/ 的/ top/ -/ k/ ./ 但是/ 定义/ 1/ 的/ 计算/ 代价/ 比较/ 大/ ,/ 并且/ 在/ 分布式计算/ 时/ 还/ 需要/ 多次/ 这样/ 的/ 计算/ ,/ 所以/ 这种/ 方法/ 效率/ 不高/ ./ 如果/ 能够/ 找出/ 一个/ 概率/ 区间/ [/ PrL/ (/ t/ )/ ,/ PrU/ (/ t/ )/ ]/ 约束/ Prm/ (/ t/ )/ ,/ 并/ 利用/ 定义/ 3/ 的/ 阈值/ 进一步/ 缩小/ 候选/ 集/ 的/ 范围/ ,/ 那么/ 就/ 会/ 提高/ 查询/ 效率/ ./ 定理/ 2/ ./ 概率/ 剪枝/ ./ 给定/ 一个/ 不/ 确定/ 数据库/ D/ ,/ 一个/ 用户/ 指定/ 的/ 打分/ 函数/ s/ ,/ 一个/ 整数/ k/ 和/ 一个/ 阈值/ p/ ./ t/ 是/ D/ 中/ 的/ 一个/ 不/ 确定/ 元组/ ,/ Prm/ (/ t/ )/ 是/ 在/ 第/ m/ 位置/ 的/ 最大/ 概率/ 并且/ PrmL/ (/ t/ )/ / Prm/ (/ t/ )/ / PrmU/ (/ t/ )/ ./ 如果/ PrmU/ (/ t/ )/ / p/ ,/ 那么/ Prm/ (/ t/ )/ 被/ 剪枝/ 掉/ ;/ 如果/ PrmL/ (/ t/ )/ / p/ ,/ 那么/ Prm/ (/ t/ )/ 则/ 是/ top/ -/ k/ 中/ 的/ 结果/ ./ 证明/ ./ 因为/ PrmU/ (/ t/ )/ / p/ ∪/ Prm/ (/ t/ )/ / PrmU/ (/ t/ )/ / Prm/ (/ t/ )/ / p/ ,/ 所以/ 根据/ 定义/ 3/ ,/ Prm/ (/ t/ )/ 被/ 剪枝/ 掉/ ./ 同理/ ,/ 因为/ PrmL/ (/ t/ )/ / p/ ∪/ PrmL/ (/ t/ )/ / Prm/ (/ t/ )/ / Prm/ (/ t/ )/ / p/ ,/ 所以/ 根据/ 定义/ 3/ ,/ Prm/ (/ t/ )/ 则/ 是/ top/ -/ k/ 中/ 的/ 结果/ ./ 根据/ 定理/ 2/ ,/ 可以/ 估计/ Prm/ (/ t/ )/ 的/ 上界/ 与/ 下界/ ,/ 然后/ 对/ 候选/ 集/ 进行/ 筛选/ ,/ 得到/ 最/ 精炼/ 的/ 候选/ 集/ ,/ 减少/ 最终/ 的/ 计算/ 代价/ 和/ 网络/ 传输/ 代价/ ./ 5.1/ 概率/ 上界/ 的/ 估计/ 假设/ Di/ 是/ P2P/ 网络/ 中/ 某/ 一/ 节点/ 的/ 不/ 确定/ 数据库/ Di/ ∈/ D/ ,/ t1/ ,/ t2/ ,/ …/ ,/ tk/ 是/ 排/ 在/ 前/ k/ 个/ 的/ 不/ 确定/ 数据/ ,/ Pr1/ (/ t1/ )/ ,/ Pr2/ (/ t2/ )/ ,/ …/ ,/ Prk/ (/ tk/ )/ 分别/ 是/ 其排/ 在/ 第/ m/ 位置/ 的/ 概率/ ,/ 其中/ s/ (/ t1/ )/ / s/ (/ t2/ )/ / ,/ …/ ,/ / s/ (/ tk/ )/ ./ 如果/ t1/ ,/ t2/ ,/ …/ ,/ tk/ ∈/ Di/ ,/ 则/ 称/ Pr1/ (/ t1/ )/ ,/ Pr2/ (/ t2/ )/ ,/ …/ ,/ Prk/ (/ tk/ )/ 为/ 本地/ top/ -/ k/ 概率/ PrLtop/ -/ k/ (/ t/ )/ ;/ 如果/ t1/ ,/ t2/ ,/ …/ ,/ tk/ ∈/ D/ ,/ 则/ 称/ Pr1/ (/ t1/ )/ ,/ Pr2/ (/ t2/ )/ ,/ …/ ,/ Prk/ (/ tk/ )/ 为/ 全局/ top/ -/ k/ 概率/ PrGtop/ -/ k/ (/ t/ )/ ./ 定理/ 3/ ./ 概率/ 上界/ ./ 给定/ 一个/ 不/ 确定/ 元组/ t/ ,/ t/ ∈/ Ti/ ,/ 有/ 证明/ ./ 假设/ tnew/ 是/ 新/ 到/ Ti/ 中/ 的/ 一个/ 元组/ ./ 如果/ tnew/ 的/ 得分/ 排在/ t/ 的/ 后面/ ,/ 那么/ tnew/ 对/ 整个/ top/ -/ k/ 结果/ 没有/ 影响/ ./ 如果/ tnew/ 的/ 得分/ 排在/ t/ 的/ 前面/ ,/ 那么/ t/ 的/ top/ -/ k/ 概率/ 为/ 其中/ ,/ ai/ 为/ 元组/ tnew/ 的/ 实例/ ./ 因为/ ,/ Prtop/ -/ (/ k/ -/ 1/ )/ (/ t/ )/ / Prtop/ -/ k/ (/ t/ )/ ,/ 所以/ Prtop/ -/ k/ (/ t/ )/ / Prtop/ -/ k/ (/ t/ )/ ./ 证毕/ ./ 通过/ 定理/ 2/ 和/ 定理/ 3/ ,/ 可以/ 计算/ 出/ 任意/ 一个/ 不/ 确定/ 数据/ 在/ 本地/ 的/ top/ -/ k/ 概率/ PrLtop/ -/ k/ (/ t/ )/ ,/ 然后/ 判断/ PrLtop/ -/ k/ (/ t/ )/ 与/ 阈值/ p/ 的/ 大小/ ./ 如果/ PrLtop/ -/ k/ (/ t/ )/ / p/ ,/ 那么/ PrGtop/ -/ k/ (/ t/ )/ / p/ ./ 因此/ 可以/ 在/ 本地/ 剪枝/ 掉/ 不/ 属于/ 结果/ 集中/ 的/ 数据/ ,/ 并且/ 不/ 需要/ 在/ 网络/ 中/ 传输数据/ ,/ 大大减少/ 了/ 网络/ 传输/ 代价/ ./ 虽然/ 概率/ 上/ 界/ 能够/ 有效/ 地/ 剪枝/ 不/ 属于/ 结果/ 集中/ 的/ 数据/ ,/ 并且/ 不/ 需要/ 网络/ 传输/ 代价/ ,/ 但是/ 利用/ 概率/ 上/ 界/ 剪枝/ 是/ 在/ 用户/ 发送/ 查询/ 之后/ 才能/ 进行/ 的/ ./ 本地/ top/ -/ k/ 概率/ 计算/ 时间/ 仍然/ 包括/ 在/ 用户/ 查询/ 的/ 响应/ 时间/ 内/ 的/ ./ 如果/ 能够/ 找到/ 一种/ 方法/ ,/ 在/ 查询/ 到来/ 时/ 就/ 能/ 立即/ 判断/ 出该/ 不/ 确定/ 数据/ 是否/ 属于/ top/ -/ k/ 查询/ 的/ 结果/ 集中/ ,/ 那么/ 会/ 大幅度/ 地/ 减少/ 查询/ 响应/ 时间/ ./ 5.2/ 概率/ 下界/ 的/ 估计/ 定理/ 4/ ./ 支配/ 剪枝/ ./ 给定/ 一个/ 不/ 确定/ 数据库/ D/ ,/ 不/ 确定/ 数据/ (/ t1/ ,/ …/ ,/ ti/ ,/ …/ ,/ tj/ ,/ …/ ,/ tN/ )/ ∈/ D/ ,/ 1/ / i/ / N/ ,/ “/ / ”/ 为/ 支配/ 关系/ ./ 假设/ 用户/ 指定/ 的/ 打分/ 函数/ 是/ 单调/ 的/ ,/ 那么/ 有/ 如果/ ti/ / tj/ ,/ 那么/ ,/ s/ (/ ti/ )/ / s/ (/ tj/ )/ ./ 证明/ ./ 假设/ t/ 是/ d/ 维/ 数据/ ,/ s/ (/ t/ )/ 的/ 大小/ 是/ t/ 在/ 各维/ 得分/ 的/ 和/ ./ 因为/ ti/ / tj/ ,/ 所以/ s/ (/ ti/ )/ 在/ 各维/ 的/ 得分/ 的/ 和/ 小于/ s/ (/ tj/ )/ 在/ 各维/ 的/ 得分/ 的/ 和/ ,/ 因此/ s/ (/ ti/ )/ / s/ (/ tj/ )/ ./ 给定/ D/ 是/ 一个/ 不/ 确定/ 数据库/ ,/ t/ 是/ D/ 中/ 的/ 不确/ Page5/ 定/ 数据/ ,/ ti/ ∈/ D/ ,/ 整数/ k/ 代表/ top/ -/ k/ 查询/ 的/ 结果/ 个数/ ,/ 整数/ k1/ 代表/ skyline/ 上/ 数据/ 的/ 个数/ ./ 那么/ ,/ 有/ 以下/ 定理/ ./ 定理/ 5/ ./ 概率/ 下界/ ./ 给定/ 一个/ 不/ 确定/ 元组/ t/ ,/ t/ ∈/ T/ ,/ 当/ k/ / k1/ 时有/ 证明/ ./ 假设/ D/ 是/ 一个/ 不/ 确定/ 数据库/ ,/ t/ =/ {/ t1/ ,/ t2/ ,/ t3/ ,/ …/ ,/ tN/ }/ 是/ D/ 中/ 的/ 不/ 确定/ 数据/ ,/ ti/ ∈/ D/ ,/ 1/ / i/ / N/ ./ 如果/ 不/ 确定/ 数据/ ti/ 能够/ 成为/ top/ -/ k/ ,/ ti/ 的/ 得分/ s/ (/ ti/ )/ 大于/ 剩余/ N/ -/ k/ 个/ 数据/ 得分/ 的/ 事件/ 的/ 可能性/ 用/ “/ / ”/ 表示/ ,/ 那么/ ,/ 可以/ 给出/ 不/ 确定/ 数据/ t/ 的/ top/ -/ k/ 概率/ 的/ 表示/ 形式/ :/ Prtop/ -/ k/ (/ t/ )/ =/ ∑/ 类似/ 的/ ,/ 假设/ k1/ 为/ skyline/ 上/ 数据/ 的/ 个数/ ./ 如果/ ti/ 能够/ 成为/ skyline/ 中/ 的/ 点/ ,/ ti/ 支配/ 剩余/ N/ -/ k1/ 个/ 数据/ 的/ 事件/ 的/ 可能性/ 用/ “/ / ”/ 表示/ ,/ 那么/ ,/ 可以/ 给出/ 不/ 确定/ 数据/ t/ 的/ skyline/ 概率/ 的/ 表示/ 形式/ :/ Prsky/ (/ t/ )/ =/ ∑/ 根据/ 定理/ 4/ ,/ 因为/ ti/ / tj/ / s/ (/ ti/ )/ / s/ (/ tj/ )/ ,/ 所以/ 事件/ s/ (/ ti/ )/ / s/ (/ tj/ )/ 包含/ 事件/ ti/ / tj/ ./ 因此/ ,/ 根据/ 式/ (/ 3/ )/ 和/ (/ 4/ )/ ,/ 可以/ 得到/ ,/ 当/ k/ / k1/ 时/ ,/ Prsky/ (/ t/ )/ / Prtop/ -/ k/ (/ t/ )/ ./ 通过/ 定理/ 5/ ,/ 得到/ 了/ top/ -/ k/ 概率/ 的/ 下界/ ./ Prsky/ (/ t/ )/ / p/ 时/ ,/ 可以/ 判断/ 哪些/ 数据/ 是/ top/ -/ k/ 中/ 的/ 数据/ ./ 但是/ ,/ 需要/ 在/ P2P/ 网络/ 中/ 预先/ 计算/ 出/ Prsky/ (/ t/ )/ ./ 下面/ 就/ 介绍/ 如何/ 在/ P2P/ 网络/ 中/ 计算/ skyline/ 概率/ ./ 5.3/ 分布式/ skyline/ 概率/ 计算/ 定义/ 4/ ./ 不/ 确定/ 数据/ 的/ 分布式/ skyline/ ./ 给定/ h/ 个/ 网络/ 节点/ C/ =/ {/ c1/ ,/ c2/ ,/ …/ ,/ ch/ }/ ,/ 每/ 一个/ 节点/ 都/ 拥有/ 一个/ 不/ 确定/ 数据库/ DI/ (/ 1/ / I/ / h/ )/ ./ t/ =/ {/ t1/ ,/ t2/ ,/ t3/ ,/ …/ ,/ tN/ }/ 是/ D/ 中/ 的/ 不/ 确定/ 数据/ ,/ ti/ ∈/ D/ (/ 1/ / i/ / N/ )/ ,/ a/ =/ {/ a1/ ,/ a2/ ,/ …/ ,/ an/ }/ 是/ 元组/ t/ 的/ 实例/ ./ 那么/ 元组/ t/ 的/ 全局/ skyline/ 概率/ PrGsky/ (/ t/ )/ 为/ PrGsky/ (/ t/ )/ =/ Pr/ (/ t/ )/ ×/ ∏/ t/ ∈/ D1/ ,/ aj/ / aj/ ∑/ n/ 如果/ 将/ 所有/ 分布式/ 的/ 数据库/ 统一/ 到/ 一个/ 数据库/ D/ 中/ ,/ 那么/ 式/ (/ 5/ )/ 可以/ 被/ 改写/ 成/ PrGsky/ (/ t/ )/ =/ Pr/ (/ t/ )/ ×/ ∏/ t/ ∈/ D/ ,/ aj/ / aj/ ∑/ n/ 根据/ 定义/ ,/ 可以/ 计算/ 出/ 不/ 确定/ 数据/ 在/ 分布式/ 中/ 的/ skyline/ 概率/ ./ 但是/ 这个/ 计算/ 复杂度/ 仍然/ 是/ 指数/ 级/ 的/ ./ 因此/ ,/ 给出/ 以下/ 几个/ 过滤/ 方法/ 减少/ 计算/ 代价/ ./ 假设/ 不/ 确定/ 元组/ ti/ 是/ DI/ 中/ 的/ 元组/ ,/ 那么/ ti/ 在/ DJ/ 中/ 的/ skyline/ 概率/ 为/ 引理/ 1/ ./ 给定/ h/ 个/ 网络/ 节点/ C/ =/ {/ c1/ ,/ c2/ ,/ …/ ,/ ch/ }/ ,/ 每/ 一个/ 节点/ 都/ 拥有/ 一个/ 不/ 确定/ 数据库/ DI/ (/ 1/ / I/ / h/ )/ ./ ti/ 在/ DI/ 中/ 的/ 全局/ skyline/ 概率/ 为/ 证明/ ./ PrGsky/ (/ t/ )/ =/ Pr/ (/ t/ )/ ×/ ∏/ t/ ∈/ D1/ ,/ aj/ / aj/ ∑/ n/ 根据/ 引理/ 1/ ,/ 有/ 以下/ 推论/ ./ 推论/ 2/ ./ skyline/ 概率/ 上界/ ./ Skyline/ 概率/ 是/ 可以/ 在/ 查询/ 到来/ 之前/ 计算/ 完成/ 的/ ,/ 为了/ 能够/ 在线/ 计算/ 的/ 时候/ 更加/ 有效/ ,/ 根据/ 定理/ 4/ 可得/ 引理/ 2/ ./ 引理/ 2/ ./ 给定/ 一个/ 不/ 确定/ 数据/ t/ ,/ t/ 的/ skyline/ 概率/ 为/ Prsky/ ,/ 有/ 证明/ ./ 因为/ top/ -/ 1/ 一定/ 在/ skyline/ 上/ ,/ 所以/ 当/ t/ 是/ top/ -/ 1/ 时/ ,/ t/ 一定/ 是/ skyline/ 上/ 的/ 点/ ;/ 反之/ 当/ t/ 是/ skyline/ 上/ 的/ 点/ 时/ ,/ t/ 不/ 一定/ 是/ top/ -/ 1/ ,/ 所以/ ,/ Prsky/ (/ t/ )/ / Page6Prtop/ -/ 1/ (/ t/ )/ ./ 通过/ 以上/ 结论/ 和/ 定义/ 4/ ,/ 可以/ 计算/ 出/ 任意/ 不/ 确定/ 元组/ t/ 的/ 全局/ skyline/ 概率/ ./ 因此/ ,/ 可以/ 满足/ 定理/ 5/ 的/ 计算/ 条件/ ./ 6/ 采样/ 计算/ 通过/ 剪枝/ 之后/ ,/ 剩余/ 的/ 数据/ 采用/ 采样/ 计算/ 的/ 方式/ 计算/ 出/ 最后/ 的/ 结果/ ./ 从/ 问题/ 定义/ 中/ 可以/ 看出/ ,/ 根据/ 定义/ 2/ 处理/ top/ -/ k/ 查询/ 的/ 计算/ 代价/ 很大/ ./ 因此/ 本/ 节/ 给出/ 一个/ 简单/ 而/ 有效/ 的/ 抽样/ 方法/ 近似计算/ Prtop/ -/ k/ ./ 设/ Xi/ 是/ 一个/ 随机变量/ ,/ 表示/ 对/ 元组/ t/ 中/ 实例/ 的/ 一次/ 采样/ ./ 如果/ 成功/ 采样/ ,/ Xi/ =/ 1/ ,/ 否则/ ,/ Xi/ =/ 0/ ./ 那么/ 对/ 整个/ 数据库/ 的/ 采样/ 就/ 构成/ 随机/ 向量/ 犡/ =/ (/ X1/ ,/ X2/ ,/ …/ ,/ XN/ )/ ./ 犡/ 表示/ 对/ 整个/ 数据库/ 的/ 采样/ ./ / (/ 犡/ )/ =/ 1/ ,/ 如果/ 元组/ t/ 在/ X/ 中是/ top/ -/ k/ 结果/ 定义/ / (/ 犡/ )/ 为/ 给出/ 了/ 近似/ 求解/ E/ (/ / (/ 犡/ )/ )/ 的/ 步骤/ ./ 根据/ 定义/ 2/ ,/ 可得/ Prtop/ -/ k/ 的/ 值/ 是/ E/ (/ / (/ 犡/ )/ )/ ,/ 算法/ 1/ 算法/ 1/ ./ LocalApproxCompute/ (/ )/ ./ 输入/ :/ 不/ 确定/ 数据/ 1/ ./ L/ =/ 0/ ;/ 2/ ./ Repeat/ ;/ 3/ ./ 对/ 元组/ 实例/ 的/ 概率/ Pr/ (/ Xi/ =/ a/ )/ 的/ 采样/ ;/ 4/ ./ if/ (/ / (/ 犡/ )/ =/ =/ 1/ )/ 5/ ./ L/ =/ L/ +/ 1/ ;/ 6/ ./ UntilNtimes/ ;/ 7/ ./ ReturnL/ // N/ ./ 当/ N/ 的/ 值/ 足够/ 大/ ,/ Chernoff/ -/ Hoeffding/ 界/ 给出/ 引理/ 3/ ./ 对/ 任意/ 的/ δ/ (/ 0/ </ δ/ </ 1/ )/ 和/ τ/ (/ τ/ >/ 0/ )/ ,/ 如/ 近似/ 解/ 的/ 精确/ 保证/ [/ 8/ ]/ ./ 果/ N/ / 3ln2/ (/ )/ δ/ τ/ 2/ ,/ 则/ Pr/ |/ L/ // N/ -/ E/ (/ / (/ 犡/ )/ )/ >/ τ/ E/ (/ / (/ 犡/ )/ )/ |/ / δ/ ./ 引理/ 3/ 保证/ 随机/ 算法/ 1/ 的/ 近似/ 解有/ 很/ 高/ 的/ 精度/ ./ 算法/ 1/ 的/ 第/ 3/ 步骤/ 需要/ 在/ P2P/ 网络/ 的/ 各个/ 节点/ 上/ 进行/ 采样/ ./ 而/ 在/ P2P/ 网络/ 的/ 各个/ 节点/ 上/ 采样/ 的/ 关键/ 是/ 如何/ 能够/ 减少/ 网络/ 代价/ ./ 如果/ 能够/ 在/ 尽量少/ 的/ 节点/ 上/ 进行/ 采样/ 并且/ 使/ 样本/ 能够/ 尽量/ 覆盖/ 整个/ 数据/ 空间/ ,/ 那么/ 在/ 采样/ 的/ 过程/ 中/ 需要/ 对/ 网路/ 节点/ 进行/ 有效/ 的/ 选择/ ./ 因为/ 通过/ 全局/ 索引/ ,/ 超级/ 节点/ 已经/ 对/ 整个/ 网络/ 数据/ 的/ 分布/ 情况/ 有/ 了/ 大致/ 的/ 了解/ ,/ 并且/ 全局/ 索引/ 中/ 的/ 每个/ 结点/ 都/ 记录/ 了/ 数据/ 来自/ 于/ 那些/ 网络/ 节点/ ./ 因此/ 可以/ 在/ 超级/ 节点/ 上/ 找出/ 最少/ 的/ 节点/ 并且/ 这些/ 节点/ 的/ 数据/ 能够/ 尽量/ 覆盖/ 整个/ 数据/ 空间/ ./ 选择网络/ 节点/ 主要/ 分为/ 两个/ 步骤/ :/ 第/ 1/ 步是/ 在/ 全局/ 索引/ 中/ 找出/ 只/ 含有/ 一个/ 网络/ 节点/ 的/ 结点/ ,/ 如果/ 这些/ 网络/ 节点/ 也/ 包含/ 于/ 其他/ 的/ 索引/ 结点/ 中/ ,/ 那么/ 就/ 不/ 考虑/ 这些/ 索引/ 结点/ 中/ 的/ 网络/ 节点/ ./ 第/ 2/ 步是/ 在/ 全局/ 索引/ 中/ 找出/ 包含/ 两个/ 直到/ N/ (/ 索引/ 结点/ 中/ 包含/ 的/ 最大/ 的/ 网络/ 节点/ 个数/ )/ 个/ 网络/ 节点/ 的/ 结点/ ,/ 最终/ 找出/ 能够/ 覆盖/ 整个/ 数据/ 空间/ 的/ 网络/ 节点/ ./ 算法/ 2/ 给出/ 了/ 在/ P2P/ 环境/ 中/ 近似/ 求解/ E/ (/ / (/ 犡/ )/ )/ 的/ 步骤/ ./ 算法/ 2/ ./ ApproxCompute/ (/ )/ ./ 输入/ :/ Quad/ -/ tree/ 索引/ QT/ 输出/ :/ 覆盖/ 所有/ 结点/ 的/ 网络/ 节点/ 集合/ S/ ;/ 1/ ./ For/ (/ inti/ =/ 1/ ;/ i/ </ N/ +/ 1/ ;/ i/ ++/ )/ 2/ ./ For/ (/ eachnodeninQT/ )/ (/ n/ 为/ 当前/ 结点/ )/ 3/ ./ R/ =/ P/ (/ n/ )/ ;/ (/ 得到/ 当前/ 结点/ 里/ 的/ 网络/ 节点/ 集合/ )/ 4/ ./ If/ (/ |/ R/ |/ !/ =/ i/ )/ 5/ ./ Break/ ;/ 6/ ./ If/ (/ S/ ∩/ R/ =/ / )/ 7/ ./ S/ =/ S/ ∪/ R/ ;/ 8/ ./ RetrunS9/ ./ LocalApproxCompute/ (/ )/ ./ 7/ 性能/ 分析/ 本/ 节/ 采用/ 合成/ 的/ 不/ 确定/ 数据/ 验证/ 本文/ 的/ 算法/ ,/ 算法/ 代码/ 用/ Visual/ C++/ 6.0/ 编写/ ,/ 运行/ 环境/ 是/ AMDAthlon/ 双核/ 2.6/ GHzCPU/ ,/ 2GB/ 内存/ 和/ 320GB/ 硬盘/ ./ 对/ 本文/ 给出/ 的/ 算法/ ,/ BPT/ 表示/ “/ 基本/ 算法/ ”/ ,/ IPT/ 表示/ 带有/ 概率/ 剪枝/ 和/ 分布式/ 采样/ 的/ top/ -/ k/ 查询/ 算法/ ./ 在/ 一个/ d/ 维/ 数据/ 空间/ S/ =/ [/ 0/ ,/ 1/ ]/ d/ 上/ 生成/ 2/ ~/ 5/ 维/ 数据/ ./ 首先/ 在/ 每个/ 网络/ 节点/ 上/ 随机/ 生成/ 确定/ 数据/ ,/ 然后/ 以/ 确定/ 数据/ 为/ 中心/ r/ 为/ 半径/ 的/ 区域/ 内/ 随机/ 生成/ β/ =/ [/ 0/ ,/ 3/ ]/ 个/ 实例/ ,/ 其中/ r/ 是/ 一个/ 尽可能/ 小/ 的/ 值/ ./ 数据/ 集/ 的/ 大小/ 是/ 1.2/ MB/ ~/ 2MB/ ./ P2P/ 网络/ 是/ 由/ 超级/ 节点/ 连接起来/ 的/ ,/ 超级/ 节点/ 之间/ 可以/ 用/ 任意/ 的/ 拓扑/ 结构/ 相连接/ ./ 实验/ 中/ ,/ 网络/ 规模/ 的/ 大小/ 由/ 普通/ 节点/ 中/ 的/ 数量/ (/ Np/ )/ 来/ 衡量/ ,/ Np/ 的/ 范围/ 是/ 40/ ~/ 120/ ,/ 其中/ 网络/ 超级/ 节点/ 的/ 个数/ Nsp/ 是/ 普通/ 节点/ 个数/ Np/ 的/ 10/ %/ ./ 每次/ 实验/ 时/ ,/ 随机/ 产生/ 20/ 个/ 查询/ ,/ 记录/ 网络/ 平均/ 传输/ 代价/ ./ 本文/ 同时/ 也/ 对/ 采样/ 计算/ 时/ 本地/ 计算精度/ 和/ 整个/ 网络/ 的/ 计算精度/ 进行/ 了/ 比较/ ./ 表/ 2/ 给出/ 具体/ 的/ 实验/ 参数/ ,/ 黑体/ 为/ 默认值/ ./ Page7Np/ :/ 普通/ 节点/ 个数/ 40/ ,/ 60/ ,/ 80/ ,/ 100/ ,/ 120R/ :/ 数据/ 集/ 大小/ 1.2/ MB/ ,/ 1.4/ MB/ ,/ 1.6/ MB/ ,/ 1.8/ MB/ ,/ 2MBp/ :/ 阈值/ k/ :/ 返回/ 结果/ 个数/ 100/ ,/ 300/ ,/ 500/ ,/ 700/ ,/ 900/ 首先/ 检验/ 当/ 普通/ 节点/ 个数/ Np/ 变化/ 时/ BPT/ 和/ IPT/ 算法/ 的/ 网络/ 传输/ 代价/ ./ 图/ 2/ 给出/ 实验/ 结果/ ,/ 其中/ 横坐标/ 是/ 普通/ 节点/ 个数/ ,/ 纵坐标/ 是/ 网络/ 中/ 传递/ 元组/ 的/ 个数/ ./ 从/ 结果/ 看出/ ,/ 网络/ 传输/ 代价/ 在/ 两种/ 算法/ 中/ 都/ 随着/ Np/ 的/ 增加/ 而/ 增加/ ./ 这个/ 结果/ 跟/ 预期/ 的/ 一样/ ,/ 因为/ 当/ 网络/ 中/ 节点/ 数量/ 增加/ 时/ ,/ 待/ 采样/ 的/ 数据/ 并/ 没有/ 发生/ 改变/ ,/ 采样/ 过程/ 增加/ 了/ 网络通信/ ,/ 因此/ 网络/ 传输/ 代价/ 随之/ 增加/ ./ 从图/ 2/ 中/ 可以/ 明显/ 地/ 看出/ ,/ IPT/ 算法/ 所/ 造成/ 的/ 网络/ 代价/ 很/ 低/ ,/ 大量/ 的/ 数据/ 在/ 概率/ 剪枝/ 过程/ 中/ 被/ 剪掉/ 了/ ,/ 减少/ 了/ 最终/ 采样/ 计算/ 时/ 的/ 数据量/ ./ 比较/ 这/ 两种/ 算法/ ,/ IPT/ 算法/ 比/ BPT/ 算法/ 平均/ 多/ 减掉/ 90/ %/ 以上/ 的/ 网络/ 代价/ ./ 其次/ 测试/ 当/ 数据/ 集/ 大小/ R/ 变化/ 时/ BPT/ 和/ IPT/ 算法/ 的/ 网络/ 传输/ 代价/ ./ 图/ 3/ 给出/ 了/ 实验/ 结果/ ,/ 其中/ 横坐标/ 是/ R/ ,/ 纵坐标/ 是/ 网络/ 中/ 传递/ 元组/ 的/ 个数/ ./ 从/ 实验/ 结果/ 可以/ 看出/ ,/ 网络/ 传输/ 代价/ 在/ BPT/ 和/ IPT/ 算法/ 中/ 随着/ R/ 的/ 增加/ 而/ 增加/ ./ 而且/ 通过观察/ 可以/ 发现/ ,/ 柱状图/ 的/ 变化趋势/ 并不大/ ./ 这/ 说明/ 了/ 当/ 数据/ 集/ 变化/ 时/ ,/ 最终/ 进行/ 采样/ 计算/ 的/ 数据/ 个数/ 变化/ 不大/ ./ 因为/ 概率/ 剪枝/ 不会/ 因为/ 数据量/ 的/ 增加/ 而/ 降低/ 剪枝/ 效力/ ./ 从图/ 3/ 中/ 可以/ 明显/ 地/ 看出/ ,/ IPT/ 算法/ 所/ 造成/ 的/ 网络/ 代价/ 仍然/ 很/ 低/ ,/ 大量/ 的/ 数据/ 在/ 概率/ 剪枝/ 过程/ 中/ 被/ 剪掉/ 了/ ,/ 减少/ 了/ 最终/ 采样/ 计算/ 时/ 的/ 数据量/ ./ 比较/ 这/ 两种/ 算法/ ,/ IPT/ 算法/ 比/ BPT/ 算法/ 平均/ 多/ 减掉/ 94/ %/ 以上/ 的/ 网络/ 代价/ ./ 然后/ 测试/ 当/ 阈值/ p/ 变化/ 时/ BPT/ 和/ IPT/ 算法/ 的/ 网络/ 传输/ 代价/ ./ 图/ 4/ 给出/ 了/ 实验/ 结果/ ,/ 其中/ 横坐标/ 是/ 阈值/ p/ ,/ 纵坐标/ 是/ 网络/ 中/ 传递/ 元组/ 的/ 个数/ ./ 从/ 实验/ 结果/ 可以/ 看出/ ,/ 当/ 阈值/ p/ 变化/ 时/ BPT/ 算法/ 的/ 网络/ 传输/ 代价/ 没有/ 发生/ 改变/ ,/ 因为/ BPT/ 算法/ 没有/ 进行/ 概率/ 剪枝/ ./ IPT/ 算法/ 当/ p/ 为/ 0.1/ 和/ 0.7/ 时/ 网络/ 传输/ 代价/ 很小/ ,/ 而/ 当/ p/ 为/ 0.3/ 和/ 0.5/ 时/ 网络/ 代价/ 要/ 比/ 0.1/ 和/ 0.7/ 时大/ 很多/ ./ 这/ 说明/ 本文/ 采用/ 的/ 两种/ 概率/ 剪枝/ 的/ 方法/ 都/ 很/ 有效/ ,/ 在/ 阈值/ 很小/ 的/ 时候/ 概率/ 下界/ 保证/ 了/ 剪枝/ 效率/ ,/ 而/ 当/ 阈值/ 很大/ 时/ 概率/ 上/ 界/ 保证/ 了/ 剪枝/ 效率/ ./ 当/ p/ 为/ 0.5/ 时/ ,/ IPT/ 算法/ 仍然/ 比/ BPT/ 算法/ 平均/ 多/ 减掉/ 85/ %/ 以上/ 的/ 网络/ 代价/ ./ 接下来/ 测试/ 当/ 返回/ 结果/ 个数/ k/ 变化/ 时/ BPT/ 和/ IPT/ 算法/ 的/ 网络/ 传输/ 代价/ ./ 图/ 5/ 给出/ 了/ 实验/ 结果/ ,/ 其中/ 横坐标/ 是/ 返回/ 结果/ 个数/ k/ ,/ 纵坐标/ 是/ 网络/ 中/ 传递/ 元组/ 的/ 个数/ ./ 从/ 实验/ 结果/ 可以/ 看出/ ,/ 当/ 返回/ 结果/ 个数/ k/ 变化/ 时/ BPT/ 算法/ 的/ 网络/ 传输/ 代价/ 并/ 不/ 稳定/ ,/ 因为/ 空间/ 剪枝/ 的/ 效率/ 是/ 随着/ 数据分布/ 的/ 变化/ 而/ 变化/ 的/ ./ 而/ 网络/ 传输/ 代价/ 在/ IPT/ 算法/ 中/ 随着/ k/ 的/ 增加/ 而/ 减少/ ./ 因为/ 概率/ 下界/ 的/ 前提/ 是/ k/ / k1/ ,/ 所以/ ,/ 当/ k/ 值越/ 大/ 能够/ 被/ 定理/ 5/ 确认/ 的/ 结果/ 的/ 可能性/ 就/ 越/ 大/ ,/ 而/ 概率/ 上界/ 并/ 不/ 因为/ k/ 值/ 的/ 变化/ 而/ 变化/ ,/ 因此/ IPT/ 算法/ 的/ 网络/ 传输/ 代价/ 呈/ 减少/ 趋势/ ./ 当/ k/ 为/ 100/ 时/ ,/ IPT/ 算/ Page8/ 法比/ BPT/ 算法/ 平均/ 多/ 减掉/ 88/ %/ 以上/ 的/ 网络/ 代价/ ./ 然后/ 测试/ 当/ 阈值/ p/ 变化/ 时/ 概率/ 上/ 界/ 、/ 概率/ 下界/ 和/ 空间/ 剪枝/ 这/ 3/ 种/ 剪枝/ 方法/ 的/ 剪枝/ 效率/ ./ 图/ 6/ 给出/ 了/ 实验/ 结果/ ,/ 其中/ 横坐标/ 是/ 阈值/ p/ ,/ 纵坐标/ 是/ 剪枝/ 掉/ 数据/ 的/ 比例/ ./ 3/ 种/ 剪枝/ 方法/ 分别/ 在/ 同一个/ 数据/ 集中/ 进行/ 测试/ ./ 从/ 实验/ 结果/ 可以/ 看出/ ,/ 当/ 阈值/ p/ 变化/ 时/ 空间/ 剪枝/ 算法/ 所/ 剪掉/ 的/ 数据/ 基本/ 没有/ 发生/ 改变/ ,/ 因为/ 空间/ 剪枝/ 算法/ 与/ 阈值/ 之间/ 没有/ 相关/ 联系/ ./ 概率/ 上界/ 的/ 剪枝/ 效率/ 会/ 随着/ p/ 的/ 变大而/ 提高/ ,/ 因为/ 根据/ 定理/ 3/ ,/ p/ 值越/ 大/ 概率/ 上界/ 越/ 有效/ ./ 相反/ 的/ ,/ 概率/ 下界/ 的/ 剪枝/ 效率/ 会/ 随着/ p/ 的/ 变大而/ 减小/ ,/ 因为/ 根据/ 定理/ 5/ ,/ p/ 值越/ 大/ 概率/ 下界/ 越/ 有效/ ./ 最后/ 测试/ IPT/ 算法/ 在/ P2P/ 网络/ 中/ 采样/ 计算/ 的/ 质量/ ./ 图/ 7/ 给出/ 了/ 实验/ 结果/ ,/ 其中/ 横坐标/ 是/ 采样/ 数量/ ,/ top/ -/ k/ 结果/ 的/ 精度/ ./ 两条/ 曲线/ 分别/ 代表/ 了/ P2P/ 网络/ 中/ 的/ 采样/ 计算精度/ 和/ 将/ 所有/ 数据/ 集中化/ 后/ 的/ 采样/ 计算精度/ ./ 集中化/ 的/ 数据/ 采样/ 计算精度/ 在/ 97/ %/ 以上/ ,/ 这/ 说明/ 了/ 引理/ 3/ 能够/ 保证/ 采样/ 计算/ 的/ 精度/ ./ P2P/ 数据/ 采样/ 计算/ 的/ 精度/ 在/ 88/ %/ 以上/ ,/ 虽然/ 精度/ 略/ 比/ 集中化/ 的/ 数据/ 低/ ,/ 但是/ 前面/ 的/ 几个/ 实验/ 有力/ 地/ 证明/ 了/ IPT/ 算法/ 避免/ 了/ 大量/ 的/ 网络/ 传输/ 代价/ ,/ 在/ 网络/ 中/ IPT/ 算法/ 能够/ 较/ 好/ 地/ 处理/ 不/ 确定/ 数据/ 的/ top/ -/ k/ 查询/ ./ 为了/ 考察/ 算法/ 在/ 真实/ 网络/ 中/ 的/ 效力/ ,/ 以下/ 实验/ 在/ 1000/ 个/ 普通/ 节点/ 的/ 情况/ 下/ 分别/ 比较/ R/ 值/ 和/ k/ 值/ 变化/ 时/ 网络/ 传输/ 代价/ ./ 从图/ 8/ 和/ 图/ 9/ 中/ 可以/ 看出/ ,/ 当/ 增大/ 网络/ 规模/ 时/ ,/ BPT/ 算法/ 的/ 效果/ 基本/ 保持/ 不变/ ./ 因为/ 全局/ 索引/ 保证/ 了/ 空间/ 剪枝/ 的/ 效率/ 不随/ 网络/ 变化/ 而/ 变化/ ./ 而/ IPT/ 算法/ 在/ 大规模/ 网络/ 中/ 增加/ 了/ 网络/ 中/ 传递/ 元组/ 的/ 个数/ ./ 这/ 是因为/ 数据/ 比较/ 分散/ ,/ 在/ 采样/ 计算/ 的/ 过程/ 中/ 增加/ 了/ 网络/ 传输/ 代价/ ./ 这/ 两个/ 实验/ 说明/ ,/ 采样/ 计算/ 决定/ 了/ 网络/ 变化/ 时/ 数据/ 在/ 网络/ 中/ 的/ 传输/ 代价/ ./ 8/ 相关/ 工作/ Top/ -/ k/ 查询/ 只/ 返回/ 最/ 满足用户要求/ 的/ k/ 个/ 结果/ ,/ 从而/ 避免/ 产生/ 大量/ 的/ 无用/ 结果/ ,/ 因而/ 受到/ 广泛/ 的/ 重视/ ,/ 在/ 多媒体/ 检索/ 、/ 数字/ 图书馆/ 、/ Web/ 搜索/ 和/ 电子商务/ 等/ 领域/ 具有/ 广泛/ 的/ 应用/ ./ 然而/ 分布式/ 环境/ 下/ 的/ top/ -/ k/ 查询处理/ 比较复杂/ ./ TA/ 算法/ 在/ 集中式/ 网络/ 环境/ 中/ 应用/ 最为/ 广泛/ ./ TA/ 算法/ 的/ 执行/ 步骤/ 是/ 不/ 固定/ 的/ ,/ 它/ 采用/ 的/ 是/ 随机/ 查找/ 策略/ ,/ 这种/ 查找/ 方法/ 使/ TA/ 算法/ 的/ 查找/ 代价/ 较大/ ./ 基于/ TA/ 算法/ ,/ 许多/ 有效/ 的/ 方法/ 已经/ 被/ 应用/ 到/ 分布式/ top/ -/ k/ 查询/ 中/ ./ TPUT/ [/ 9/ ]/ 算法/ 的/ 目的/ 是/ 剪掉/ 不/ 需要/ 的/ 数据/ 对象/ 并且/ 是/ 一定/ 终止/ 在/ 3/ 个/ 步骤/ 之内/ ./ KLEE/ [/ 10/ ]/ 算法/ 得到/ 的/ top/ -/ k/ 结果/ 是/ 近似/ 结果/ ,/ KLEE/ 算法/ 的/ 执行/ 步骤/ 是/ 固定/ 的/ ,/ 为/ 3/ 步/ 或/ 4/ 步/ ,/ 4/ 步中/ 多出/ 的/ 一步/ 为/ 优化/ 候选/ 集合/ ./ KLEE/ 的/ 效率/ 和/ 结果/ 质量/ 成反比/ ,/ 带宽/ 的/ 节省/ 量/ 和/ 通信/ 的/ 步骤/ 成反比/ ./ 已有/ 很多/ 面向/ 集中式/ 环境/ 中/ 的/ 不/ 确定/ 数据/ Page9top/ -/ k/ 查询/ 的/ 工作/ ./ U/ -/ Topk/ [/ 11/ ]/ 查询/ 返回/ 一个/ 长度/ 为/ k/ 的/ 元组/ 矢量/ ,/ 其/ 在/ 所有/ 可能/ 世界/ 中/ 的/ 发生/ 概率/ 最大/ ;/ U/ -/ kRanks/ [/ 11/ ]/ 返回/ 在/ 各个/ 级别/ 中/ 出现/ 频率/ 最大/ 的/ 元组/ ;/ PT/ -/ k/ [/ 12/ ]/ 首先/ 定义/ 一个/ 阈值/ ,/ 返回/ 所有/ 发生/ 概率/ 超过/ 阈值/ 的/ 元组/ ;/ Pk/ -/ topk/ 和/ Global/ -/ topk/ [/ 13/ ]/ 则/ 返回/ 发生/ 概率/ 最大/ 的/ k/ 个/ 元组/ ./ Expectedranktop/ -/ k/ 返回/ 期望/ 排序/ 最低/ 的/ k/ 个/ 元组/ ./ Soliman/ 等/ 人/ 提出/ 了/ 基于/ 搜索/ 空间/ 的/ 方法/ 来/ 处理/ U/ -/ Topk/ 查询/ 与/ U/ -/ kRanks/ 查询/ ./ 各/ 元组/ 首先/ 按照/ 其/ Rank/ 从大到/ 小/ 进行/ 排序/ ./ 然后/ 不断/ 地/ 构造/ 搜索/ 空间/ ,/ 缩小/ 空间/ 的/ 范围/ ,/ 最终/ 获得/ 查询/ 结果/ ./ Hua/ 等/ 人/ 提出/ 了/ 针对/ PT/ -/ k/ 查询/ 的/ 解决/ 方法/ ./ Cheng/ 等/ 人/ 针对/ U/ -/ Topk/ 查询/ 提出/ 了/ 一种/ 动态/ 维护/ 的/ 结构/ ,/ 支持/ 元组/ 的/ 插入/ 与/ 删除/ ./ 他们/ 提出/ 了/ 构造/ Dominant/ 集合/ 的/ 方法/ 进行/ 求解/ ./ 在/ 其/ 后续/ 工作/ 中/ ,/ 也/ 提出/ 了/ 近似/ 解决方案/ [/ 12/ ]/ ./ 文献/ [/ 14/ ]/ 主要/ 研究/ 的/ 是/ 排序/ 查询/ ,/ 不/ 确定/ 数据/ 假设/ 分布/ 在/ 一定/ 区域/ 中/ ./ 文献/ [/ 15/ ]/ 是/ 在/ 不/ 确定/ 数据流/ 上/ 研究/ 的/ top/ -/ k/ 查询/ ./ 文献/ [/ 16/ ]/ 提出/ 了/ 有效/ 的/ 方法/ 来/ 回答/ U/ -/ top/ -/ k/ 和/ U/ -/ kRanks/ 查询/ ./ 其中/ 对于/ U/ -/ kRanks/ 查询/ 利用/ 的/ 是/ 泊松/ 二项式/ 递推/ [/ 17/ ]/ 的/ 方法/ ./ 文献/ [/ 18/ ]/ 考虑/ 的/ 是/ 任意/ SQL/ 查询/ 并且/ 排序/ 是/ 根据/ 一个/ 元组/ 满足/ 查询/ 的/ 概率/ 而/ 不是/ 利用/ 一个/ 排序/ 函数/ ./ 文献/ [/ 19/ ]/ 提出/ 了/ 两种/ 排序/ 理论/ 可以/ 满足/ 离散/ 和/ 连续/ 分布/ 的/ 不/ 确定/ 数据/ ./ 面向/ 分布式/ 不/ 确定/ 数据/ 的/ top/ -/ k/ 查询/ 的/ 研究/ 并/ 不是/ 很多/ ./ 文献/ [/ 20/ ]/ 提出/ 了/ 在/ 通信/ 和/ 计算/ 方面/ 都/ 比较/ 高效/ 的/ 算法/ 来/ 计算/ 分布式/ 环境/ 下/ 的/ Expectedranktop/ -/ k/ ./ 文献/ [/ 21/ ]/ 是/ 在/ 传感器/ 网络/ 中/ 进行/ top/ -/ k/ 查询/ ,/ 它/ 返回/ 的/ 是/ 在/ 每个/ 传感器/ 的/ 值/ 在/ 任何时刻/ 的/ 排序/ 之后/ 概率/ 最大/ 的/ 前/ k/ 个/ 传感器/ ./ 9/ 结束语/ 本文/ 所述/ 的/ 是/ 一个/ 面向/ P2P/ 网络/ 的/ 不/ 确定/ 数据/ 的/ top/ -/ k/ 查询/ ./ 采用/ 离散/ 的/ 可能/ 世界/ 模型/ 定义/ 不/ 确定/ 数据/ ./ 在/ 指出/ 可能/ 世界/ 实例/ 的/ 数量/ 远大于/ 不/ 确定/ 数据/ 的/ 规模/ 之后/ ,/ 本文/ 首先/ 采用/ Quad/ -/ tree/ 索引/ 不/ 确定/ 数据/ 并/ 利用/ 索引/ 结构/ 以及/ 数据/ 之间/ 的/ 支配/ 关系/ 对/ 不/ 确定/ 数据/ 进行/ 空间/ 剪枝/ ,/ 然后/ 提出/ 了/ 一个/ 在/ P2P/ 环境/ 中/ 的/ top/ -/ k/ 查询/ 的/ 基本/ 方法/ ./ 在/ 分析/ 了/ 基本/ 方法/ 的/ 不足/ 之后/ ,/ 采用/ 了/ 概率/ 剪枝/ 和/ 分布式/ 采样/ 计算/ 改进/ 基本/ 方法/ ./ 其中/ ,/ 局部/ top/ -/ k/ 概率/ 和/ 全局/ skyline/ 概率/ 分别/ 是/ 全局/ top/ -/ k/ 概率/ 的/ 上界/ 和/ 下界/ ./ 通过/ 概率/ 剪枝/ 和/ 采样/ 计算/ 可以/ 大大减少/ 网络/ 中/ 数据/ 的/ 传输/ 量/ 和/ 本地/ 的/ 计算/ 代价/ ./ 实验/ 结果/ 验证/ 了/ 本文/ 的/ 设计/ ./ 今后/ 将/ 研究/ 在/ P2P/ 环境/ 中/ 基于/ 不/ 确定/ 数据/ 的/ 多种/ 查询/ ./ 

