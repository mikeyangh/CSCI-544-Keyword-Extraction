Page1/ 下一代/ 光/ 核心/ 负载/ 均衡/ 分组/ 交换机/ 研究/ 夏羽/ 1/ )/ ,/ 2/ )/ 曾华遷/ 1/ )/ 高志/ 江/ 1/ )/ 申/ 志军/ 1/ )/ 1/ )/ (/ 西南/ 交通/ 大学/ 信息科学/ 与/ 技术/ 学院/ 成都/ 610031/ )/ 2/ )/ (/ 纽约大学/ 理工学院/ 电子/ 与/ 计算机/ 工程系/ 美国纽约/ )/ 摘要/ 着重/ 研究/ 了/ 在/ 第五代/ 交换机/ 体系结构/ 中/ 极具/ 竞争力/ 的/ 以/ 阵列/ 波导/ 光栅/ 路由器/ 件/ 为/ 核心/ 的/ 负载/ 均衡/ 交换/ 结构/ (/ AWGR/ -/ LB/ )/ ./ 负载/ 均衡/ 结构/ 通常/ 使用/ 严格/ 的/ 时分复用/ 方式/ ,/ 调度/ 简单/ 但/ 性能/ 不够/ 理想/ ;/ AWGR/ 的/ 使用/ 能够/ 大大提高/ 交换机/ 整体/ 容量/ ,/ 但/ 由于/ 其/ 波长/ 速率/ 仅为/ 端口/ 速率/ 的/ 1/ // N/ (/ 其中/ N/ 为/ 端口数/ )/ ,/ 其时/ 延/ 性能/ 与/ 传统/ 交换/ 矩阵/ 相比/ 仍/ 有/ 较大/ 差距/ ,/ 因而/ 不能/ 提供/ 良好/ 的/ 服务质量/ 保证/ ./ 文中/ 提出/ 了/ 一种/ 适应性/ 时分复用/ 调度/ 算法/ ,/ 能够/ 在/ 保持/ 100/ %/ 吞吐/ 率/ 优势/ 的/ 同时/ ,/ 极大/ 地/ 改善/ 负载/ 均衡/ 结构/ 的/ 时延/ 性能/ ;/ 同时/ 文中/ 提出/ 的/ 双/ 波导/ 光栅/ 路由器/ 方案/ ,/ 使光/ 交换/ 矩阵/ 能/ 模拟/ 传统/ 交叉开关/ 的/ 工作/ 模式/ ,/ 从而/ 达到/ 以/ 端口/ 线/ 速率/ 交换/ 的/ 效果/ ,/ 与/ 适应性/ 时分复用/ 调度/ 算法/ 相结合/ ,/ 可/ 进一步提高/ AWGR/ -/ LB/ 的/ 性能/ ./ 关键词/ 分组/ 交换/ ;/ 负载/ 均衡/ 交换机/ ;/ Byte/ -/ Focal/ 交换机/ ;/ 时延/ 性能/ ;/ 吞吐/ 率/ 1/ 引言/ 随着/ 以/ DWDM/ (/ DenseWavelengthDivisionMultiplexing/ )/ 为/ 代表/ 的/ 光/ 传输技术/ 的/ 飞速发展/ ,/ 光纤/ 中单/ 波长/ 的/ 传输速率/ 已经/ 超过/ 100Gbps/ ,/ 甚至/ 还/ 高于/ 现阶段/ 骨干网/ 的/ 传输速率/ ./ 另一方面/ ,/ 由于/ 受/ 商用/ 存储器/ 访问/ 速率/ 的/ 限制/ ,/ 分组/ 交换机/ (/ packetswitch/ )/ // 路由器/ (/ router/ )/ 的/ 发展/ 已经/ 远远/ 落后/ 于/ 传输技术/ ./ 事实上/ ,/ 分组/ 交换机/ // 路由器/ 已经/ 成为/ 现代/ 网络/ 性能/ 的/ 瓶颈/ ./ 能够/ 适应/ 未来/ 高速/ 数据传输/ 的/ 高性能/ 分组/ 交换机/ 的/ 设计/ 与/ 实现/ 是/ 下一代/ 网络/ 研究/ 的/ 关键问题/ 之一/ ./ 商用/ 交换机/ 一共/ 经历/ 了/ 四代/ ./ 第一代/ 交换机/ 使用/ 和/ 普通/ 计算机/ 相同/ 的/ 架构/ :/ 用/ 集中式/ 的/ 处理器/ 和/ 存储器/ 来/ 进行/ IP/ 查表/ 、/ 校验/ 和/ (/ checksum/ )/ 计算/ 以及/ 交换/ 等/ 操作/ ./ 随着/ 计算机网络/ 的/ 广泛应用/ ,/ 集中式/ 的/ 处理器/ 逐渐/ 不能/ 匹配/ 日益/ 提高/ 的/ 传输速率/ ./ 因此/ 第二代/ 交换机/ 在/ 每/ 一块/ 线卡/ (/ 网卡/ )/ 上/ 使用/ 独立/ 的/ 处理器/ 来/ 进行/ 查表/ 、/ 校验/ 和/ 计算/ 等/ 操作/ ,/ 但/ 仍然/ 使用/ 集中式/ 的/ 处理器/ 和/ 存储器/ 来/ 进行/ 交换/ 操作/ ./ 第一/ 、/ 二代/ 交换机/ 均/ 使用/ 集中式/ 的/ 存储器/ 来/ 存储/ 分组/ ,/ 属于/ 共享/ 存储/ (/ Shared/ -/ Memory/ ,/ SM/ )/ 结构/ ./ 随着/ 网络/ 传输速率/ 的/ 持续/ 提高/ 和/ 对/ 服务质量/ 的/ 更/ 高/ 要求/ ,/ 共享/ 存储/ 结构/ 已经/ 不能/ 满足/ 高速/ 网络/ 对/ 交换机/ 容量/ 的/ 需求/ ./ 第三代/ 交换机/ 引入/ 了/ 交换/ 矩阵/ (/ switchfabric/ )/ ,/ 并/ 在线/ 卡上/ 设置/ 独立/ 的/ 缓存/ 以/ 存储/ 暂时/ 不能/ 被/ 转发/ 的/ 分组/ ./ 最初/ 的/ 第三代/ 交换机/ 使用/ 输出/ 排队/ (/ Output/ -/ Queued/ ,/ OQ/ )/ 方式/ :/ 分组/ 到达/ 后/ 立刻/ 通过/ 交换/ 矩阵/ 到达/ 对应/ 的/ 输出/ 端口/ ,/ 并/ 进入/ 相应/ 队列/ 中/ 排队/ 等待/ 输出/ ./ 但是/ 由于/ 交换/ 矩阵/ 和/ 存储器/ 都/ 需要/ 以/ N/ 倍/ (/ N/ 为/ 交换机/ 的/ 端口数/ )/ 于/ 线卡/ 的/ 速率/ 工作/ ,/ 随着/ 端口/ 速率/ 的/ 提高/ 以及/ 交换/ 规模/ 的/ 扩大/ ,/ 这种/ 交换/ 结构/ 开始/ 变得/ 不/ 现实/ ./ 而/ 如果/ 分组/ 在/ 到达/ 输入/ 端口/ 时/ ,/ 先/ 在/ 输入/ 端的/ 线卡/ 中/ 排队/ 等待/ ,/ 并且/ 一个/ 时/ 槽内/ 该/ 线卡/ 只/ 通过/ 交换/ 矩阵/ 传输/ 一个/ 分组/ ,/ 则/ 交换/ 矩阵/ 和/ 存储器/ 仅/ 需要/ 以/ 和/ 线卡/ 相同/ 的/ 速率/ 工作/ ,/ 这种/ 交换/ 方式/ 被/ 称为/ 输入/ 排队/ (/ Input/ -/ Queued/ ,/ IQ/ )/ 方式/ ./ 由于/ 输入/ 排队/ 可以/ 适应/ 更大/ 的/ 交换/ 容量/ ,/ 因而/ 被/ 广泛/ 使用/ ./ 但是/ IQ/ 结构/ 由于/ 受到/ 队首/ 阻塞/ (/ Head/ -/ of/ -/ LineBlocking/ ,/ HoLblocking/ )/ 问题/ 的/ 限制/ ,/ 其/ 吞吐/ 率仅/ 达到/ 58/ %/ 左右/ [/ 1/ ]/ ./ 虚拟/ 输出/ 队列/ (/ VirtualOutputQueue/ ,/ VOQ/ )/ [/ 2/ ]/ 作为/ 解决/ 队首/ 阻塞/ 问题/ 的/ 有效/ 方案/ ,/ 被/ 广泛/ 地/ 应用/ 于/ 商用/ 交换机/ 中/ ./ 但是/ VOQ/ 的/ 引入/ 加剧/ 了/ 输出/ 竞争/ ,/ 需要/ 使用/ 额外/ 的/ 匹配/ 调度/ 算法/ ./ 典型/ 的/ 调度/ 算法/ 有/ 并行/ 迭代/ 匹配/ 算法/ PIM/ (/ ParallelIterativeMatching/ )/ [/ 3/ ]/ 、/ 带/ 滑动/ 指针/ 的/ 轮询/ 算法/ iSLIP/ (/ iterativeRound/ -/ RobinwithSLIP/ )/ [/ 4/ ]/ 以及/ 双轮/ 询/ 匹配/ 算法/ DRRM/ (/ DualRound/ -/ RobinMatching/ )/ [/ 5/ ]/ 等/ ./ 实用/ 的/ IQ/ 调度/ 算法/ 大多/ 需要/ 迭代/ 多次/ 才能/ 达到/ 较为理想/ 的/ 时延/ ,/ 且/ 在/ 非/ 均匀/ 流量/ 下/ 吞吐/ 率/ 性能/ 不佳/ ./ 但/ 随着/ 网络/ 传输速率/ 的/ 持续/ 提高/ 以及/ 交换机/ 规模/ 的/ 持续/ 扩大/ ,/ 留给/ 这些/ 调度/ 算法/ 运行/ 的/ 时间/ 已经/ 越来越/ 紧迫/ ,/ IQ/ 交换/ 结构/ 最终/ 将/ 不能/ 适应/ 未来/ 的/ 高速/ 网络/ ./ 第四代/ 交换机/ 以多/ 机柜/ 架构/ 的/ 出现/ 为/ 标志/ :/ 由于/ 交换机/ 的/ 规模/ 不断扩大/ ,/ 多级/ 多/ 平面/ 交换机/ 开始/ 出现/ ,/ 使用/ 单一/ 的/ 机柜/ 已经/ 不能/ 满足/ 交换机/ 在/ 体积/ 、/ 功耗/ 及/ 散热/ 等/ 方面/ 的/ 要求/ ./ 现代/ 交换机/ 多/ 将/ 交换/ 背板/ 放置/ 于/ 一/ 独立/ 的/ 机柜/ 中/ ,/ 而/ 将/ 线卡/ 分别/ 放置/ 于/ 其它/ 的/ 机柜/ 中/ ,/ 这些/ 线卡/ 和/ 背板/ 之间/ 使用/ 光纤/ 连接/ ,/ 如图/ 1/ 所示/ ./ 多/ 机柜/ 架构/ 交换机/ 的/ 典型/ 代表/ 有/ :/ Alcatel7670RSP/ 、/ JuniperTX/ 、/ AviciTSR/ 和/ CiscoCRS/ -/ 1/ 等/ ./ 本文/ 的/ 主要/ 研究/ 对象/ 是/ 面向未来/ 高速/ 网络/ 的/ 第五代/ 交换机/ ,/ 第五代/ 交换机/ 以光/ 交换/ 核心/ 的/ 使用/ 为/ 标志/ ./ 典型/ 代表/ 是/ 斯坦福大学/ 项目/ [/ 6/ ]/ ,/ 该/ 项目/ 首先/ 提出/ 了/ 使用/ 阵列/ 波导/ 光栅/ 路由器/ (/ ArrayedWaveguideGratingRouter/ ,/ AWGR/ )/ 作为/ 核心/ 交换/ 矩阵/ ,/ 结合/ 负载/ 均衡/ (/ Load/ -/ Balanced/ ,/ LB/ )/ 的/ 交换/ 架构/ [/ 7/ ]/ ,/ 可以/ 构建/ 容量/ 高达/ 100Tbps/ 的/ 交换机/ ,/ 但是/ ,/ 由于/ 使用/ 的/ 调度/ 算法/ 性能/ 不够/ 理想/ ,/ 导致/ 其时/ 延/ 性能/ 非常/ 差/ ./ 香港大学/ 项目/ [/ 8/ ]/ 也/ 采用/ AWGR/ 扩展/ LB/ 交换机/ ,/ 正像/ 文献/ [/ 8/ ]/ 所说/ ,/ 由于/ 工艺/ 原因/ ,/ AWGR/ 中/ 每个/ 信道/ 速率/ 仅为/ 传统/ 交换/ 矩阵/ 的/ 1/ 换/ 矩阵/ 中/ N/ 倍/ 的/ 时间/ 来/ 传送/ 一个/ 分组/ ,/ 这/ 也/ 将/ 导致/ 时延/ 性能/ 非常/ 差/ ./ 针对/ 以上/ 两个/ 问题/ ,/ 本文/ 中/ ,/ 我们/ 首先/ 提出/ 了/ 适应/ Page3/ 性/ 时分复用/ (/ AdaptiveTime/ -/ DivisionMultiplexing/ ,/ ATDM/ )/ 的/ 调度/ 方式/ ,/ 从而/ 较大/ 地/ 改善/ 了/ LB/ 结构/ 时延/ 性能/ ,/ 同时/ 可以/ 证明/ ATDM/ 方式/ 能够/ 保持/ LB/ 交换机/ 100/ %/ 吞吐/ 率/ 的/ 优势/ ./ 此外/ ,/ 为了/ 配合/ ATDM/ ,/ 我们/ 提出/ 了/ 一种/ 使用/ 双/ AWGR/ 串联/ 方式/ 来/ 模拟/ 传统/ 交叉开关/ 的/ 可行/ 方案/ ,/ 我们/ 将/ 其/ 称为/ 通过/ 双/ AWGR/ 模拟/ 的/ 交叉开关/ (/ DualAWGREmulatedCrossbar/ ,/ DAWGREC/ )/ 模块/ ./ DAWGREC/ 的/ 主要/ 优势/ 是/ 可以/ 以/ 端口/ 速率/ 传输/ 分组/ ,/ 从而/ 避免/ N/ 倍/ 传输/ 时间/ 的/ 问题/ ,/ 而/ 这/ 也/ 将/ 进一步/ 改善/ AWGR/ -/ LB/ 交换机/ 的/ 时延/ 性能/ ./ 仿真/ 实验/ 表明/ 新/ 的/ LB/ 交换机/ 在/ 各种/ 流量/ 下均/ 有/ 良好/ 的/ 时延/ 性能/ ./ 本文/ 第/ 2/ 节/ 主要/ 讨论/ LB/ 交换机/ 的/ 研究/ 现状/ ;/ 第/ 3/ 节/ 介绍/ ATDM/ 调度/ 方式/ 以及/ 采用/ ATDM/ 调度/ 的/ 交换机/ 体系结构/ ;/ 第/ 4/ 节/ 证明/ 使用/ ATDM/ 的/ 负载/ 均衡/ 交换机/ 可以/ 在/ 任意/ 许可/ 流量/ 下/ 达到/ 100/ %/ 的/ 吞吐/ 率/ ;/ 第/ 5/ 节/ 介绍/ 如何/ 扩大/ AWGR/ 交换机/ 容量/ ;/ 第/ 6/ 节用/ 仿真/ 实验/ 说明/ 新/ LB/ 交换机/ 在/ 各种/ 流量/ 下均/ 有/ 很/ 好/ 的/ 性能/ ;/ 第/ 7/ 节/ 总结/ 全文/ ./ 2/ 负载/ 均衡/ 的/ 分组/ 交换机/ 研究/ 现状/ 由于/ LB/ 交换机/ 调度/ 简单/ ,/ 可以/ 适应/ 高速/ 网络/ ,/ 近/ 10/ 年来/ ,/ 它/ 一直/ 是/ 交换机/ 研究/ 的/ 热点/ ./ LB/ 交换/ 结构/ 是/ 一种/ 特殊/ 的/ 两级/ 交换/ 结构/ ,/ 最/ 简单/ 的/ LB/ 结构/ 如图/ 2/ 所示/ ./ 它/ 由/ 两个/ N/ ×/ N/ 的/ 交叉开关/ 组成/ ,/ 之间/ 设置/ N/ 个/ 缓存/ 用于/ 暂存/ 从/ 第一级/ 交叉开关/ 转发/ 过来/ 的/ 信元/ (/ cell/ ,/ 即定/ 长/ 分组/ ,/ 若/ 分组/ 为/ 变长/ ,/ 则/ 在/ 进入/ 到/ 交换机/ 之前/ 将/ 其/ 切分/ )/ ,/ 这些/ 缓存/ 被/ 组织/ 成为/ VOQ/ 的/ 形式/ ,/ 每/ 一组/ VOQ/ 连接/ 一个/ 第一级/ 交叉开关/ 的/ 输出/ 端口/ 和/ 一个/ 第二级/ 交叉开关/ 的/ 输入/ 端口/ ,/ 因此/ 共有/ N2/ 个/ VOQ/ ./ 和/ IQ/ 交换/ 结构/ 不同/ ,/ LB/ 交换/ 结构/ 中/ 的/ 交叉开关/ 不/ 需要/ 使用/ 调度/ 算法/ 来/ 配置/ ,/ 而是/ 周期性地/ ,/ 在/ 预定/ 的/ N/ 种/ 连接/ 模式/ 之间/ 顺序/ 切换/ ./ 通过/ 选择/ 恰当/ 的/ 连接/ 序列/ ,/ N/ 个/ 时/ 槽内/ ,/ 交叉开关/ 的/ 各/ 输入/ 端/ 和/ 输出/ 端/ 将/ 各/ 连接/ 一次/ ./ 如果/ 用/ i/ 表示/ 交叉开关/ 的/ 输入/ 端/ ,/ j/ 表示/ 交叉开关/ 的/ 输出/ 端/ ,/ 而用/ t/ 表示/ 当前/ 时槽/ ,/ 则/ 一种/ 可行/ 的/ 连接/ 模式/ 为/ j/ =/ (/ i/ +/ t/ )/ modN/ ./ 这种/ 连接/ 模式/ 称为/ 时分复用/ (/ Time/ -/ DivisionMulti/ -/ plexing/ ,/ TDM/ )/ 方式/ ,/ 而/ 使用/ TDM/ 方式/ 的/ 交换机/ 在/ 文献/ [/ 7/ ]/ 中/ 被/ 称为/ BvN/ (/ Birkhoff/ -/ vonNeumann/ )/ 交换机/ ./ 在/ LB/ 交换/ 结构/ 中/ ,/ 第一级/ 交换/ 矩阵/ 作为/ 一个/ 负载/ 均衡器/ ,/ 将/ 到达/ 的/ 信元/ 均匀/ 地/ 发送到/ 各个/ 中间级/ ,/ 而/ 第二级/ 交换/ 矩阵/ 才/ 真正/ 将/ 信元/ 转发/ 到/ 正确/ 的/ 端口/ ./ 由于/ 第一级/ 负载/ 均衡器/ 的/ 作用/ ,/ 第二级/ BvN/ 交换机/ 仅/ 需要/ 处理/ 均匀/ 业务/ 流/ ,/ 而/ BvN/ 交换机/ 可以/ 均匀/ 地/ 服务/ 各个/ 端口/ ./ 文献/ [/ 7/ ]/ 证明/ 了/ LB/ 交换/ 结构/ 可以/ 在/ 弱/ 混合/ 流量/ 下/ 达到/ 100/ %/ 的/ 吞吐/ 率/ ./ 虽然/ LB/ 结构/ 有/ 以上/ 优势/ ,/ 但是/ 它/ 存在/ 两个/ 严重/ 的/ 缺陷/ :/ (/ 1/ )/ 如果/ 将/ “/ 流/ (/ flow/ )/ ”/ 定义/ 为/ 从/ 同一/ 端口/ 进入/ ,/ 而/ 指向/ 同一/ 输出/ 端口/ 的/ 分组/ 序列/ ,/ 则/ 在/ LB/ 结构/ 中/ ,/ 属于/ 同一个/ 流/ 的/ 分组/ 离开/ 的/ 顺序/ 会/ 和/ 其/ 到达/ 顺序/ 不同/ ,/ 这/ 被/ 称为/ 分组/ 失序/ 问题/ ;/ (/ 2/ )/ 其时/ 延/ 性能/ 和/ 传统/ 交换机/ 相比/ 有/ 较大/ 差距/ ./ 文献/ 中有/ 多种/ 方法/ 解决/ LB/ 结构/ 的/ 分组/ 失序/ 问题/ ,/ 这些/ 方法/ 主要/ 可以/ 分为/ 3/ 类/ :/ (/ 1/ )/ 在/ 分组/ 到达/ 输出/ 端口/ 之前/ 就/ 阻止/ 分组/ 失序/ ,/ 代表/ 算法/ 及/ 结构/ 有/ :/ UFS/ (/ UniformFrameSpreading/ )/ 算法/ [/ 9/ ]/ 、/ 满帧/ 填充/ PF/ (/ PaddedFrame/ )/ 算法/ [/ 10/ ]/ 、/ Mailbox/ 结构/ [/ 11/ ]/ 和/ 基于/ 反馈/ 的/ (/ Feedback/ -/ Based/ )/ 结构/ [/ 12/ ]/ ;/ (/ 2/ )/ 在/ 分组/ 到达/ 输出/ 端口/ 时/ 将/ 失序/ 度/ 控制/ 在/ 一定/ 范围/ 内/ ,/ 然后/ 再/ 在/ 输出/ 端/ 设置/ 一定/ 大小/ 的/ 维序/ 缓存/ (/ resequencingbuffer/ )/ 将/ 失序/ 的/ 分组/ 重新/ 排序/ 输出/ ./ 其/ 代表/ 有/ FOFF/ (/ FirstOrderedFullFrameFirst/ )/ [/ 6/ ]/ 算法/ 及/ Byte/ -/ Focal/ 结构/ [/ 13/ ]/ ;/ (/ 3/ )/ 组合/ 方法/ ,/ 即将/ 几种/ 方法/ 组合/ 使用/ ,/ 典型/ 的/ 代表/ 是/ CR/ (/ ContentionandReservation/ )/ 交换机/ [/ 14/ ]/ ,/ 它/ 结合/ 了/ Mailbox/ 和/ UFS/ 两种/ 方法/ ./ 分组/ 失序/ 的/ 根本原因/ 是/ 属于/ 同一个/ 流/ 的/ 不同/ 分组/ 在/ 经过/ 不同/ 的/ 中间级/ 时所/ 经历/ 的/ 时延/ 不同/ ./ 第/ 1/ 类/ 算法/ 保证/ 分组/ 通过/ 不同/ 的/ 中间级/ 时能/ 经历/ 相同/ 的/ 时延/ ./ UFS/ 算法/ 使用/ 逐帧/ (/ frame/ -/ by/ -/ frame/ )/ 转发/ 的/ 概念/ ,/ 一个/ 帧/ 由/ N/ 个/ 连续/ 的/ 属于/ 同一个/ 流/ 的/ 信元/ 组成/ ./ 如果/ 每个/ 输入/ 端口/ 的/ 信元/ 都/ 按/ 帧/ 的/ 方式/ ,/ 在/ N/ 个/ 连续/ 的/ 时/ 槽内/ 被/ 顺序/ 转发/ 到/ 各个/ 对应/ 的/ VOQ/ 中/ ,/ 则/ 每个/ 中间级/ 对应/ 的/ VOQ/ 的/ 队长/ 都/ 相等/ ,/ 从而/ 同一个/ 帧/ 的/ 分组/ 在/ 中间级/ 所/ 经历/ 的/ 时延/ 也/ 相同/ ./ 但是/ 在/ 中/ 低/ 负载/ 下/ ,/ 一个/ VOQ/ 可能/ 需要/ 等待/ 较长时间/ 才能/ 构成/ 一个/ 帧/ ,/ 因此/ UFS/ 算法/ 的/ 时延/ 性能/ 较差/ ./ 满帧/ 填充/ (/ PF/ )/ 算法/ 在/ VOQ/ 没有/ 满帧/ 时/ ,/ 通过/ Page4/ 填充/ “/ 空/ 分组/ ”/ 凑成/ 满帧/ ,/ 这样/ 虽然/ 可以/ 减少/ 等待/ 成帧/ 的/ 时间/ ,/ 但是/ 其/ 代价/ 是/ 使用/ 过多/ 的/ 带宽/ 来/ 转发/ 空/ 分组/ ,/ 从而/ 造成/ 带宽/ 浪费/ ,/ 时延/ 性能/ 虽较/ UFS/ 有所提高/ ,/ 但是/ 改进/ 仍然/ 不/ 明显/ ./ Mailbox/ 交换/ 结构/ 使用/ 竞争/ 中间级/ 队列/ 的/ 方式/ ,/ 并/ 采用/ 了/ 对称/ 式/ TDM/ 连接/ 模式/ 巧妙/ 地/ 提供/ 了/ 竞争/ 成功/ 与否/ 的/ 反馈/ 路径/ ,/ 使得/ 在/ 低/ 负载/ 下/ 时延/ 性能/ 得到/ 较大/ 改善/ ./ 但/ 竞争/ 失败/ 的/ 信元/ 将/ 被/ 阻塞/ ,/ 因此/ 不能/ 达到/ 100/ %/ 的/ 吞吐/ 率/ ./ 当/ δ/ =/ 0/ 时/ ,/ 该/ 交换/ 结构/ 只能/ 达到/ 58/ %/ 左右/ 的/ 吞吐/ 率/ [/ 11/ ]/ ./ 基于/ 反馈/ 的/ (/ feedback/ -/ based/ )/ 交换/ 结构/ 类似/ 于/ Mailbox/ ,/ 它/ 提供/ 了/ 同时/ 具有/ staggeredsymmetry/ 和/ in/ -/ orderpacketdelivery/ 两种/ 属性/ 的/ 连接/ 模式/ 来/ 交换/ 中间级/ 队列/ 的/ 占用/ 信息/ 和/ 解决/ 分组/ 失序/ 的/ 问题/ ./ FB/ 是/ 目前/ 时延/ 性能/ 最好/ 的/ LB/ 交换机/ ,/ 但/ 由于/ 其/ 每个/ 中间级/ VOQ/ 仅/ 缓存/ 一个/ 分组/ ,/ 因此/ 各个/ 输入/ 端/ 存在/ 竞争/ 冲突/ ,/ 从而/ 不能/ 达到/ 100/ %/ 的/ 吞吐/ 率/ ,/ 事实上/ ,/ 它/ 被/ 证明/ 在/ 2/ 倍/ 加速/ 比下/ 才能/ 达到/ 100/ %/ 的/ 吞吐/ 率/ [/ 12/ ]/ ./ FOFF/ 算法/ 允许/ 非满/ 帧/ VOQ/ 发送/ 非满/ 帧/ 分组/ ./ 虽然/ 可以/ 在/ 很大/ 程度/ 上/ 改进/ UFS/ 算法/ 的/ 性能/ ,/ 但是/ 在/ 中/ 低/ 负载/ 下/ ,/ 发送/ 的/ 分组/ 大部分/ 属于/ 非满/ 帧/ 分组/ ,/ 失序/ 仍然/ 可能/ 发生/ ,/ 因此/ 在/ 输出/ 端/ 需要/ 维序/ 队列/ 来/ 重组/ 失序/ 的/ 分组/ ,/ 维序/ 不但/ 需要/ 额外/ 的/ 通信量/ ,/ 而且/ 也/ 造成/ FOFF/ 的/ 时延/ 性能/ 依旧/ 较差/ ./ CR/ 交换机/ 巧妙/ 地/ 结合/ 了/ Mailbox/ 和/ UFS/ 两种/ 方法/ ,/ 在/ 低/ 负载/ 下/ 使用/ Contention/ 模式/ (/ 即/ Mailbox/ 结构/ )/ 来/ 获得/ 较/ 好/ 的/ 时延/ 性能/ ,/ 而/ 在/ 高/ 负载/ 下时/ 使用/ Reservation/ 模式/ (/ 即/ UFS/ 算法/ )/ 来/ 保证/ 100/ %/ 的/ 吞吐/ 率/ ./ CR/ 交换机/ 在/ 中/ 高/ 负载/ 下/ ,/ 时延/ 性能/ 仍然/ 非常/ 差/ ./ 在/ 所有/ 解决方案/ 当中/ ,/ Byte/ -/ Focal/ 是/ 唯一/ 一种/ 不/ 需要/ 在/ 端口/ 和/ 中间级/ 之间/ 交换/ 任何/ 信息/ ,/ 且/ 时延/ 性能/ 较/ 好/ ,/ 同时/ 也/ 能/ 保持/ 100/ %/ 吞吐/ 率/ 的/ 结构/ ./ 它/ 使用/ 逐/ 分组/ (/ packet/ -/ by/ -/ packet/ )/ 的/ 方式/ 来/ 解决/ 失序/ 问题/ ./ Byte/ -/ Focal/ 结构/ 在/ 第一级/ 和/ 中间级/ 均/ 使用/ VOQ/ ,/ 而/ 在/ 输出/ 端/ 采用/ 虚拟/ 输入/ 队列/ (/ VirtualInputQueue/ ,/ VIQ/ )/ 集合/ 的/ 结构/ ,/ 并/ 加入/ 流首/ (/ Head/ -/ of/ -/ Flow/ )/ 指针/ ,/ 巧妙/ 地/ 利用/ 了/ 分组/ 经过/ 中间级/ 的/ 顺序/ ,/ 解决/ 了/ 分组/ 失序/ 问题/ ./ 有关/ Byte/ -/ Focal/ 的/ 详细描述/ 可以/ 参考文献/ [/ 13/ ]/ ./ 3/ 使用/ 轮询/ 调度/ 加强/ 的/ 负载/ 均衡/ 结构/ 以上/ 这些/ 方案/ 虽然/ 都/ 解决/ 了/ LB/ 交换/ 结构/ 分组/ 失序/ 的/ 问题/ ,/ 且/ 时延/ 性能/ 都/ 有所提高/ ,/ 但/ 并/ 没有/ 做出/ 根本性/ 的/ 改善/ ./ 我们/ 深入分析/ 后/ 发现/ ,/ LB/ 结构/ 时延/ 性能/ 低下/ 的/ 主要/ 原因/ 是/ TDM/ 调度/ 存在/ 严重/ 的/ “/ 连接/ 浪费/ ”/ 问题/ ./ 所谓/ “/ 连接/ 浪费/ ”/ 是/ 指/ 由于/ TDM/ 完全/ 按照/ 预定/ 的/ 连接/ 模式/ 建立/ 连接/ ,/ 当某/ 端口/ 对/ 之间/ 建立/ 连接/ 之后/ ,/ 可能/ 并/ 没有/ 信元/ 传输/ ./ 从而/ 在/ 其它/ 队列/ 均/ 为/ 空/ 的/ 情况/ 下/ ,/ 一个/ 等待/ 传输/ 的/ 信元/ ,/ 最坏/ 情况/ 下/ 将/ 被/ 延迟/ N/ -/ 1/ 个/ 时/ 槽/ ./ 若/ 两级/ BvN/ 都/ 存在/ 连接/ 浪费/ ,/ 情况/ 将/ 更糟/ ./ 基于/ 以上/ 分析/ ,/ 我们/ 认为/ 完全/ 抛弃/ 匹配/ 算法/ 的/ 方式/ 虽然/ 调度/ 简单/ 但会/ 导致/ 极差/ 的/ 性能/ ,/ 并/ 不/ 可取/ ,/ 因此/ 我们/ 提出/ 了/ 适应性/ 的/ TDM/ (/ ATDM/ )/ 调度/ ./ ATDM/ 在/ 传统/ TDM/ 的/ 基础/ 上/ 使用/ 复杂度/ 仅为/ O/ (/ 1/ )/ 的/ 带/ 滑动/ 指针/ 的/ 轮询/ (/ Round/ -/ Robin/ )/ 调度/ 来/ 消除/ BvN/ 结构/ 的/ “/ 连接/ 浪费/ ”/ ,/ 改进/ 后/ 的/ BvN/ 结构/ 称为/ 使用/ 轮询/ 调度/ 加强/ 的/ BvN/ (/ Round/ -/ RobinEn/ -/ hancedBvN/ ,/ RRE/ -/ BvN/ )/ 结构/ ./ RRE/ -/ BvN/ 结构/ 的/ 工作/ 过程/ 如下/ :/ 时槽/ 开始/ 时/ ,/ 各/ 输入/ 、/ 输出/ 端口/ 先/ 根据/ TDM/ 方式/ 结合实际/ 的/ 队列/ 情况/ 建立/ 匹配/ ,/ 对应/ 队/ 列为/ 空/ 的/ 端口/ 不/ 匹配/ ,/ 随后/ 进行/ 经典/ 的/ 1/ -/ SLIP/ 三步/ 调度/ [/ 4/ ]/ ,/ 即/ (/ 1/ )/ 请求/ 阶段/ ./ 所有/ 未/ 匹配/ 的/ 输入/ 端口/ ,/ 向/ 所有/ 不为/ 空/ 的/ VOQ/ 所/ 对应/ 的/ 输出/ 端/ 发送/ 请求/ ./ (/ 2/ )/ 授权/ 阶段/ ./ 所有/ 未/ 匹配/ 的/ 输出/ 端口/ ,/ 收到/ 请求/ 后/ ,/ 从中/ 选择/ 一个/ 在/ 顺时针/ 方向/ 离/ 授权/ 指针/ 最近/ 的/ 输入/ 端口/ 的/ 请求/ 进行/ 授权/ ./ 如果/ 该/ 授权/ 在/ 下/ 一步/ 被/ 接受/ ,/ 则/ 授权/ 指针/ 指向/ 被/ 授权/ 的/ 输入/ 端口/ 的/ 下/ 一个/ 端口/ ;/ 否则/ 授权/ 指针/ 不/ 移动/ ./ (/ 3/ )/ 接受/ 阶段/ ./ 输入/ 端/ 收到/ 授权/ 之后/ ,/ 从中/ 选择/ 一个/ 在/ 顺时针/ 方向/ 离/ 接受/ 指针/ 最近/ 的/ 输出/ 端口/ 接受/ 其/ 授权/ ./ 然后/ 将/ 接受/ 指针/ 移动/ 到/ 该/ 输出/ 端口/ 的/ 下/ 一个/ 端口/ ./ 我们/ 将/ 用/ RRE/ -/ BvN/ 替换/ 传统/ 的/ BvN/ 后/ 所/ 建立/ 的/ 新/ LB/ 结构/ 称为/ 使用/ 轮询/ 调度/ 加强/ 的/ 负载/ 均衡/ (/ Round/ -/ RobinEnhancedLB/ ,/ RRE/ -/ LB/ )/ 交换/ 结构/ ,/ 如图/ 3/ 所示/ ./ 一方面/ ,/ TDM/ 方式/ 使得/ 在/ 调度/ 开始/ 就/ 存在/ 一些/ 匹配/ ,/ 从而/ 无需/ 迭代/ 即可/ 建立/ 比/ 1/ -/ SLIP/ 更/ 多/ 的/ 匹配/ ;/ 另一方面/ ,/ 轮询/ 调度/ 所/ 建立/ 的/ 匹配/ 可以/ 有效/ 消除/ BvN/ 结构/ 的/ “/ 连接/ 浪费/ ”/ ./ 且/ 轮询/ 算法/ 的/ 复杂度/ 仅为/ O/ (/ 1/ )/ 且/ 实现/ 简单/ [/ 15/ ]/ ./ 除/ 替换/ BvN/ 结构/ 以外/ ,/ RRE/ -/ LB/ 和/ Byte/ -/ Focal/ 类似/ ,/ 在/ 中间级/ 队列/ 采用/ VOQ/ ,/ 而/ 在/ 输出/ 端/ 使用/ VIQ/ 集合/ 结构/ 来/ 保证/ 分组/ 以/ 正确/ 顺序/ 离开/ ./ VIQ/ 集合/ 结构/ 如图/ 4/ 所示/ ,/ 其/ 工作/ 方式/ 是/ 将/ 属于/ 同一个/ 流/ Page5/ 图/ 3/ 轮询/ 调度/ 加强/ 的/ 负载/ 均衡/ 结构/ (/ 即/ 从/ 相同/ 输入/ 端口/ 到达/ 且/ 指向/ 同一个/ 输出/ 端口/ )/ 但是/ 经过/ 不同/ 中间级/ 的/ 分组/ 入队/ 到/ 不同/ 的/ VIQ/ 中/ ,/ 然后/ 为/ 每/ 一个/ 流/ 维护/ 一个/ 流首/ 指针/ (/ 每个/ 端口/ 各/ N/ 个/ )/ ,/ 该/ 指针/ 从/ 第一个/ VIQ/ 开始/ ,/ 每次/ VIQ/ 中/ 属于/ 该流/ 的/ 分组/ 离开/ 后/ ,/ 对应/ 指针/ 移/ 向下/ 一个/ VIQ/ ./ VIQ/ 集合/ 的/ 细节/ 可以/ 参看/ 文献/ [/ 13/ ]/ ./ 为了/ 配合/ ATDM/ 调度/ 方式/ ,/ 同时/ 也/ 降低/ 调度/ 复杂度/ ,/ 我们/ 抛弃/ 了/ Byte/ -/ Focal/ 的/ 第一级/ 需要/ 复杂/ 调度/ 的/ VOQ/ 结构/ [/ 13/ ]/ ,/ 而/ 在/ RRE/ -/ LB/ 第一级/ 使用/ 虚拟/ 中间级/ 队列/ (/ VirtualCentralQueue/ ,/ VCQ/ )/ ./ VCQ/ 结构/ 如图/ 5/ 所示/ ,/ 其/ 工作/ 方式/ 如下/ :/ 从/ 输入/ 端口/ i/ 中/ 到达/ 而/ 指向/ 输出/ 端口/ j/ 的/ 流/ 的/ 信元/ 被/ 以/ VCQi/ ,/ 0/ ,/ VCQi/ ,/ 1/ ,/ …/ ,/ VCQi/ ,/ N/ -/ 1/ ,/ VCQi/ ,/ 0/ ,/ …/ 的/ 顺序/ 均匀/ 地/ 分配/ 到/ N/ 个/ VCQ/ 中/ ,/ 而/ 在/ VCQi/ ,/ m/ 中/ 的/ 分组/ 一定/ 被/ 转发/ 到/ 交换/ 矩阵/ 的/ 第/ m/ 个/ 出口/ ./ 性质/ 1/ ./ 在/ RRE/ -/ LB/ 结构/ 中/ ,/ 属于/ 同一个/ 流/ 的/ 分组/ 离开/ 的/ 顺序/ 和/ 到达/ 顺序/ 一致/ ./ 证明/ ./ 根据/ VCQ/ 的/ 工作/ 原理/ ,/ 属于/ 同一个/ 流/ 的/ 分组/ 被/ 分配/ 到/ 中间级/ 的/ 顺序/ 一定/ 满足/ :/ m/ =/ 0/ ,/ 1/ ,/ 2/ ,/ …/ ,/ N/ -/ 1/ ,/ 0/ ,/ 1/ ,/ 2/ ,/ …/ ,/ N/ -/ 1/ ,/ …/ ./ 虽然/ 这些/ 分组/ 通过/ 中间级/ 的/ 排队/ 时延/ 可能/ 不同/ ,/ 但是/ 在/ 输出/ 端/ ,/ 由于/ 有/ VIQ/ 集合/ 及/ 流首/ 指针/ 的/ 限制/ ,/ 同一个/ 流中/ 离开/ 的/ 分组/ 所/ 经过/ 的/ 中间级/ 顺序/ 如下/ :/ 0/ ,/ 1/ ,/ 2/ ,/ …/ ,/ N/ -/ 1/ ,/ 0/ ,/ 1/ ,/ 2/ ,/ …/ ,/ N/ -/ 1/ ,/ …/ ./ 因此/ ,/ 属于/ 同一个/ 流/ 的/ 分组/ 离开/ RRE/ -/ LB/ 结构/ 的/ 顺序/ 一定/ 与其/ 到达/ 顺序/ 相同/ ./ 证毕/ ./ 4/ 稳定性/ 分析/ 定义/ 1/ (/ 稳定性/ ,/ stability/ )/ ./ 对于/ 一个/ 排队/ 系统/ ,/ 如果/ 其中/ 的/ 队列/ 的/ 平均/ 长度/ 均/ 有/ 上界/ (/ </ )/ ,/ 则/ 称/ 该/ 排队/ 系统/ 稳定/ ./ 而/ 一个/ 稳定/ 的/ 交换/ 系统/ 可以/ 达到/ 100/ %/ 的/ 吞吐/ 率/ ,/ 即/ 所有/ 进入/ 该/ 系统/ 的/ 分组/ 都/ 可以/ 在/ 有限/ 时间/ 内/ 被/ 转发/ 离开/ ./ 定义/ 2/ (/ 许可/ 流量/ ,/ admissibletraffic/ )/ ./ 一个/ N/ ×/ N/ 的/ 交换机/ 中/ ,/ 若用/ λ/ i/ ,/ j/ 表示/ 从/ 输入/ 端口/ i/ 到达/ 而/ 指向/ 输出/ 端口/ j/ 的/ 流/ 的/ 平均/ 到达/ 速率/ ,/ 如果/ 该/ 流量/ 满足/ 如下/ 两/ 式/ :/ 则/ 该/ 流量/ 称为/ 许可/ 流量/ ./ 引理/ 1/ ./ 使用/ VOQ/ 的/ RRE/ -/ BvN/ 交换/ 结构/ 可以/ 对/ 任意/ λ/ i/ ,/ j/ / 1/ // N/ 的/ 流量/ 提供/ 100/ %/ 的/ 吞吐/ 率/ ./ 证明/ (/ 反证法/ )/ ./ 对/ RRE/ -/ BvN/ 中/ 任意/ 一个/ VOQi/ ,/ j/ ,/ 假设/ 其/ 不/ 稳定/ ,/ 则/ 其/ 队长/ 会/ 无限/ 增长/ ./ 但是/ 由/ RRE/ -/ BvN/ 结构/ 的/ 特点/ ,/ 一个/ 队列/ 不为/ 空时/ ,/ TDM/ 调度/ 在/ N/ 个/ 时/ 槽/ 的/ 周期/ 内/ 一定/ 服务/ 该/ 队列/ 一次/ ;/ 而/ 1/ -/ SLIP/ 调度/ 在/ 其它/ 队/ 列为/ 空/ 的/ 情况/ 下/ 还/ 可能/ 服务/ 该/ 队列/ 一次/ 或/ 以上/ ,/ 则/ 在/ t/ 个/ 时/ 槽内/ ,/ 该/ 队列/ 会/ 被/ 服务/ 至少/ t/ // N/ 次/ ,/ 则/ 从/ 长时间/ 来看/ ,/ 服务/ 速率/ 由/ 排队/ 论/ 可知/ 到达/ 速率/ 小于/ 服务/ 速率/ 的/ 队列/ 应该/ 稳定/ ,/ 这/ 与/ 假设/ 矛盾/ ./ 第一级/ 可以/ 达到/ 100/ %/ 的/ 吞吐/ 率/ ./ 引理/ 2/ ./ 在/ 许可/ 流量/ 下/ ,/ RRE/ -/ LB/ 交换/ 结构/ 的/ 证明/ ./ 如图/ 6/ 所示/ ,/ 将/ 从/ 输入/ 端口/ i/ 进入/ 而/ 指/ Page6/ 向/ 输出/ 端口/ j/ 的/ 流/ 的/ 平均/ 到达/ 速率/ 用/ λ/ i/ ,/ j/ 来/ 表示/ ,/ 而/ 实际/ 进入/ 队列/ VCQi/ ,/ m/ 的/ 流/ 的/ 平均/ 速率/ 用/ λ/ i/ ,/ m/ 来/ 表示/ ./ 根据/ VCQ/ 的/ 工作/ 原理/ 有/ λ/ i/ ,/ m/ =/ 1/ 根据/ 许可/ 流量/ 定义/ 2/ 有/ λ/ i/ ,/ m/ / 1100/ %/ 的/ 吞吐/ 率/ ./ 构/ 的/ 第二级/ 可以/ 达到/ 100/ %/ 的/ 吞吐/ 率/ ./ 由/ 引理/ 1/ 可知/ ,/ RRE/ -/ LB/ 的/ 第一级/ 可以/ 达到/ 引理/ 3/ ./ 在/ 任意/ 许可/ 流量/ 下/ ,/ RRE/ -/ LB/ 交换/ 结/ 证明/ ./ 根据/ 引理/ 2/ 可知/ ,/ 所有/ 到达/ 的/ 流量/ 都/ 会/ 被/ 完全/ 转发/ 到/ 第二级/ ./ 我们/ 将/ 进入/ 中间级/ VOQm/ ,/ j/ 的/ 流量/ 的/ 平均/ 到达/ 速率/ 用/ λ/ m/ ,/ j/ 表示/ ./ 如图/ 7/ 所示/ ,/ 由于/ 从/ 输入/ 端口/ i/ 到达/ 而/ 指向/ 输出/ 端口/ j/ 的/ 流量/ 在/ 第一级/ 被/ 均匀/ 地/ 分配/ 到/ N/ 个/ VCQ/ 中/ ,/ 因此/ 到达/ 第二级/ 输入/ 端口/ m/ ,/ 而/ 指向/ 输出/ 端口/ j/ 的/ 流量/ 的/ 平均/ 到达/ 率为/ 1N/ λ/ i/ ,/ j/ ./ 又/ 由于/ 每个/ 输入/ 端口/ 都/ 有/ 指向/ 某/ 输出/ 端口/ j/ 的/ 流量/ ,/ 因此/ 总体/ VOQm/ ,/ j/ 的/ 平均/ 到达/ 速率/ :/ 由/ 许可/ 流量/ 的/ 定义/ 2/ 有/ λ/ m/ ,/ j/ / 1/ // N/ ./ 由/ 引理/ 1/ 可知/ ,/ RRE/ -/ LB/ 的/ 第二级/ 可以/ 达到/ 100/ %/ 的/ 吞吐/ 率/ ./ 定理/ 1/ ./ RRE/ -/ LB/ 可以/ 在/ 任意/ 许可/ 流量/ 下/ 达到/ 100/ %/ 的/ 吞吐/ 率/ ./ 证明/ ./ 由/ 引理/ 2/ 和/ 引理/ 3/ 可知/ RRE/ -/ LB/ 结构/ 的/ 第一级/ 和/ 第二级/ 均/ 可/ 达到/ 100/ %/ 的/ 吞吐/ 率/ ,/ 因此/ 最终/ RRE/ -/ LB/ 可以/ 在/ 任意/ 许可/ 流量/ 下/ 达到/ 100/ %/ 的/ 吞吐/ 率/ ./ 值得注意/ 的/ 是/ ,/ 在/ 文献/ [/ 7/ ]/ 中/ ,/ 为了/ 证明/ 100/ %/ 的/ 吞吐/ 率/ ,/ 作者/ 假设/ 流量/ 符合/ 弱/ 混合/ (/ weakmixing/ )/ 特性/ ;/ 而/ 在/ 我们/ 的/ 证明/ 过程/ 中/ ,/ 对/ 流量/ 的/ 唯一/ 要求/ 仅仅/ 是/ 符合/ 许可/ 流量/ ,/ 而/ 这/ 正是/ 所有/ 稳定/ 的/ 交换/ 结构/ 对/ 流量/ 的/ 必要/ 约束/ ./ 因此/ RRE/ -/ LB/ 解除/ 了/ 传统/ LB/ 结构/ 对/ 流量/ 弱/ 混合/ 的/ 要求/ ./ 5/ 使用/ AWGR/ 扩展/ RRE/ -/ LB/ 结构/ 5.1/ AWGR/ 概述/ 阵列/ 波导/ 光栅/ 路由器/ (/ Arrayed/ -/ WaveguideGratingRouter/ ,/ AWGR/ )/ [/ 16/ ]/ 是/ 一种/ 被动/ 光/ 交换/ 器件/ ./ 如图/ 8/ 所示/ ,/ 一个/ 输入/ 端的/ 光/ 信号/ 如果/ 通过/ 不同/ 的/ 波长/ 传播/ ,/ 则/ 会/ 被/ 转发/ 到/ AWGR/ 的/ 不同/ 输出/ 端口/ ./ 具体来说/ ,/ 对于/ 一个/ N/ ×/ N/ 的/ AWGR/ ,/ 输入/ 端口/ i/ 传输/ N/ 种/ 波长/ 的/ 光/ 信号/ ,/ 分别/ 用/ λ/ i0/ ,/ λ/ i1/ ,/ …/ ,/ λ/ iN/ -/ 1/ 表示/ ,/ 则/ 输入/ 端口/ i/ 通过/ 波长/ λ/ i/ 转发/ 到/ 输出/ 端口/ (/ i/ +/ j/ )/ modN/ ./ 简单/ 来说/ ,/ N/ ×/ N/ 的/ AWGR/ ,/ 每个/ 端口/ 使用/ N/ 种/ 波长/ ,/ 可以/ 提供/ 输入/ 端/ 和/ 输出/ 端/ 之间/ 的/ 全/ 连接/ ,/ 共/ N2/ 条/ 信道/ ./ AWGR/ 有/ 如下/ 优势/ :/ (/ 1/ )/ 造价/ 低/ ;/ (/ 2/ )/ 零/ 功耗/ ;/ (/ 3/ )/ 端口/ 间/ 的/ 全/ 连接/ ;/ (/ 4/ )/ 无需/ 配置/ ./ 但是/ 它/ 也/ 存在/ 如下/ 缺点/ :/ (/ 1/ )/ 每个/ 信道/ 传输速率/ 仅为/ 1/ 交叉开关/ 的/ 信道/ 速率/ 为/ R/ ,/ 因此/ AWGR/ 需要/ 用/ 原来/ N/ 倍/ 的/ 时间/ 来/ 传输/ 一个/ 信元/ ;/ (/ 2/ )/ 由于/ AWGR/ 本身/ 的/ 特点/ ,/ 其/ 规模/ 不能/ 过大/ ,/ 一般来说/ ,/ 超过/ 一百个/ 端口/ 的/ AWGR/ 是/ 非常/ 少见/ 的/ [/ 16/ ]/ ./ 5.2/ 提高/ 交换/ 速率/ 虽然/ AWGR/ 可以/ 提供/ 输入/ 端口/ 和/ 输出/ 端口/ 之间/ 的/ 全/ 连接/ ,/ 但是/ 由于/ 技术/ 和/ 工艺/ 原因/ ,/ 目前/ 实验室/ 内部/ 也/ 只/ 实现/ 了/ 最高/ 40Gbps/ 的/ AWGR/ ,/ 市场/ 上/ 可以/ 使用/ 的/ AWGR/ 速率/ 将/ 更/ 低/ ./ 对于/ 100Gbps/ 以上/ 的/ 网络/ ,/ 如果/ 使用/ 高速/ AWGR/ ,/ 肯定/ 会/ 造价/ 过高/ ,/ 但/ 如果/ 每/ 一个/ 信道/ 只能/ 以/ 1Page7/ 又/ 会/ 造成/ N/ 倍/ 传输/ 时延/ ./ 本/ 小节/ 我们/ 提出/ 一种/ 使用/ 两个/ 低速/ AWGR/ 串联/ ,/ 能够/ 以线/ 速率/ R/ 模拟/ 任意/ 交叉开关/ 连接/ 模式/ 的/ 交换/ 矩阵/ ,/ 我们/ 将/ 其/ 称为/ 通过/ 双/ AWGR/ 模拟/ 的/ 交叉开关/ (/ DAWGREC/ )/ 模块/ ,/ 以/ 低廉/ 的/ 实现/ 成本/ 达到/ 高性能/ ./ 如图/ 9/ 所示/ ,/ DAWGREC/ 由/ 两个/ AWGR/ 串联/ 而成/ ,/ 两个/ AWGR/ 之间/ 用/ 可/ 变换/ 波长/ 的/ 激光/ 发射器/ 件/ (/ Tunable/ -/ WavelengthLaserTransmitter/ ,/ TWLT/ )/ 连接/ ./ 当/ 长度/ 为/ L/ 的/ 信元/ 到达/ 输入/ 端口/ 时/ ,/ 将/ 被/ 平均/ 分为/ N/ 个/ 长度/ 为/ L/ // N/ 的/ 分片/ (/ segment/ )/ ,/ 这些/ 分片/ 被/ 均匀/ 地/ 发送到/ 每/ 一个/ 中间级/ ,/ 而/ 通过/ 配置/ TWLT/ ,/ 即可/ 在/ 这些/ 分片/ 到达/ 第二个/ AWGR/ 的/ 入口/ 时/ 变换/ 为/ 正确/ 的/ 波长/ ,/ 从而/ 被/ 转发/ 到/ 正确/ 的/ 目的地/ ,/ 并/ 在/ 第二个/ AWGR/ 的/ 出口/ 被/ 重新组合/ 成信元/ ./ 这样/ 转发/ 一个/ 信元/ 的/ 时间/ 仍然/ 为/ 一个/ 时槽/ ./ 值得注意/ 的/ 是/ ,/ 由于/ 从/ 同一个/ 输入/ 端口/ 被/ 均匀/ 发送到/ 各个/ TWLT/ 的/ 分组/ 最终/ 的/ 目的/ 端口/ 都/ 一样/ ,/ 因此/ 其/ 波长/ 映射/ 都/ 一样/ ,/ 从而/ 需要/ 的/ 波长/ 映射/ 实际上/ 只有/ N/ 种/ 而/ 不是/ N2/ 种/ ./ 为了/ 便于/ 理解/ DAWGREC/ 的/ 原理/ ,/ 我们/ 在/ 图/ 10/ 中/ 显示/ 了/ 两组/ 通过/ DAWGREC/ 模拟/ 4/ ×/ 4/ 的/ 交叉开关/ 连接/ 的/ 示例/ ./ 5.3/ 扩大/ 交换/ 规模/ 由于/ AWGR/ 要/ 达到/ 一百个/ 以上/ 的/ 端口/ 非常/ 困难/ ,/ 因此/ 通过/ DAWGREC/ 来/ 实现/ 的/ RRE/ -/ BvN/ 也/ 不/ 可能/ 支持/ 过大/ 的/ 交换/ 规模/ ./ 本节/ 我们/ 使用/ 多个/ 较/ 小规模/ 的/ DAWGREC/ 模块/ 互联/ 从而/ 扩展/ 为/ 较大/ 的/ 规模/ ./ 具体来说/ ,/ 我们/ 使用/ 4/ 个/ N/ // 2/ ×/ N/ // 2/ 的/ DAWGREC/ 模块/ 构造/ 一个/ N/ ×/ N/ 的/ DAWGREC/ 模块/ ./ 将要/ 到达/ N/ 个/ 输出/ 端口/ 的/ 信元/ 分为/ 两/ 部分/ ,/ 一部分/ 指向/ 前/ N/ // 2/ 个/ 输出/ 端口/ ,/ 另/ 一部分/ 指向/ 后/ N/ // 2/ 个/ 输出/ 端口/ ./ 这/ 4/ 个/ DAWGREC/ 模块/ 通过/ 图/ 11/ 的/ 方式/ 连接/ ./ 通过/ 配置/ 这/ 4/ 个/ DAWGREC/ 模块/ 中/ 的/ TWLT/ ,/ 即/ 可以/ 模拟/ N/ ×/ N/ 的/ 交叉开关/ 的/ 任意/ 连接/ 模式/ ./ 一般/ 的/ ,/ 可以/ 使用/ k2/ 个/ n/ ×/ n/ 的/ DAWGREC/ 矩阵/ 扩展/ 成为/ 一个/ kn/ ×/ kn/ 的/ DAWGREC/ 模块/ ./ 而/ 又/ 可以/ 将/ 合成/ 的/ DAWGREC/ 模块/ 作为/ 基础/ 模块/ 再次/ 进行/ 扩展/ ./ 因此/ ,/ 如果/ 需要/ 更大/ 的/ 交换/ 规模/ ,/ 则/ 可以/ 使用/ 扩展/ 的/ DAWGREC/ 模块/ 再次/ 通过/ 上面/ 的/ 方法/ 组合/ ./ 通过/ 多次/ 扩展/ ,/ 理论/ 上/ 可以/ 支持/ 任意/ 规模/ ,/ 以/ 适应/ 下一代/ 网络/ 对/ 更/ 大/ 交换/ 规模/ 的/ 需求/ ./ 6/ 仿真/ 实验/ 吞吐/ 率/ 和/ 时延/ 是/ 评价/ 交换机/ 好坏/ 的/ 两个/ 重要/ 指标/ ,/ 前面/ 我们/ 已经/ 证明/ 了/ RRE/ -/ LB/ 交换机/ 可以/ 保证/ 100/ %/ 的/ 吞吐/ 率/ ./ 本节/ 我们/ 在/ 为/ NS/ -/ 3/ (/ NetworkSimulator3/ )/ 设计/ 的/ 交换机/ 仿真/ 平台/ [/ 1/ ]/ 上/ 对/ RRE/ -/ LB/ 交换机/ 进行/ 仿真/ ,/ 并/ 对比/ 其它/ 负载/ 均衡/ 方案/ 的/ 时延/ 性能/ ./ 在/ 仿真/ 中/ ,/ 我们/ 设置/ 端口数/ 为/ 32/ ,/ 对于/ 其它/ 端口数/ ,/ 也/ 有/ 类似/ 结果/ ,/ 限于/ 篇幅/ ,/ 我们/ 不再/ 一一列举/ ./ 为了/ 便于/ 对比/ RRE/ -/ LB/ 交换机/ 的/ 时延/ 性能/ ,/ 我们/ 在/ 仿真/ 结果/ 中/ 加入/ 了/ 如下/ 交换机/ 和/ 调度/ 算法/ :/ (/ 1/ )/ 输出/ 排队/ (/ OQ/ )/ ./ 交换机/ 时延/ 性能/ 的/ 最优/ (/ 2/ )/ 5/ -/ SLIP/ ./ iSLIP/ 算法/ ,/ 32/ 端口/ 交换机/ ,/ 文界/ ,/ 在/ 高速/ 网络/ 中/ 无法/ 实际/ 实现/ ./ Page8/ 献/ [/ 4/ ]/ 推荐/ 5/ 次/ 迭代/ ,/ 由于/ 迭代/ 次数/ 较/ 多/ 从而/ 无法/ 用于/ 高速/ 或/ 大规模/ 交换/ ./ (/ 3/ )/ 1/ -/ SLIP/ ./ 仅/ 一次/ 迭代/ 的/ iSLIP/ 算法/ ,/ 复杂度/ 仅为/ O/ (/ 1/ )/ ,/ 和/ RRE/ -/ LB/ 具有/ 类似/ 的/ 复杂度/ ./ (/ 4/ )/ CR/ 交换机/ ./ 100/ %/ 吞吐/ 率/ 的/ LB/ 交换机/ ,/ 作为/ 时延/ 性能/ 参考/ ./ (/ 5/ )/ 基于/ 反馈/ 的/ LB/ 交换机/ (/ FB/ )/ ./ 使用/ 2/ 倍/ 加速/ 比/ 才能/ 达到/ 100/ %/ 的/ 吞吐/ 率/ ,/ 但/ 具有/ 较/ 好/ 的/ 时延/ ./ (/ 6/ )/ Byte/ -/ Focal/ 交换机/ (/ BF/ )/ ./ 目前/ 最/ 实际/ 的/ LB/ 交换机/ ,/ 可以/ 达到/ 100/ %/ 的/ 吞吐/ 率/ ,/ 其中/ 性能/ 最好/ 的/ LQF/ 调度/ 算法/ 的/ 时间/ 复杂度/ 为/ O/ (/ logN/ )/ ./ 在/ 第一组/ 仿真/ 中/ ,/ 我们/ 比较/ 各种/ 交换机/ 在/ Bernoulli/ 和/ 突发/ 均匀/ 流量/ 下/ 的/ 时延/ 性能/ ./ 突发/ 流量/ 中/ 停留/ 在/ ON/ 和/ OFF/ 状态/ 的/ 时/ 槽/ 数均/ 服从/ 几何/ 分布/ ./ 在/ ON/ 状态/ 下/ ,/ 每个/ 时槽/ 均/ 产生/ 一个/ 分组/ ./ 而/ 停留/ 在/ ON/ 状态/ 的/ 时/ 槽/ 数/ 称为/ 突发/ 长度/ (/ burstlength/ )/ ,/ 用/ b/ 表示/ ./ 同一个/ 突发/ 内/ 的/ 分组/ 的/ 目的/ 端口/ 相同/ ,/ 而/ 不同/ 突发/ 之间/ 的/ 指向/ 从/ N/ 个/ 输出/ 端口/ 中/ 均匀/ 地/ 随机/ 选择/ ./ 仿真/ 结果/ 如图/ 12/ 所示/ ./ 可见/ ,/ 随着/ 突发/ 长度/ 的/ 增大/ ,/ 各种/ 算法/ 之间/ 的/ 性能/ 渐渐/ 接近/ ./ RRE/ -/ LB/ 由于/ 有/ 第一级/ 负载/ 均衡器/ 的/ 作用/ ,/ 其/ 在/ 高/ 负载/ 下/ 的/ 时延/ 性能/ 远远/ 好于/ 1/ -/ SLIP/ 算法/ ./ 而/ CR/ 交换机/ 虽然/ 在/ 低/ 负载/ 下/ 时延/ 稍/ 小/ ,/ 但是/ 仍然/ 高于/ RRE/ -/ LB/ ./ Feedback/ -/ Based/ 交换机/ 在/ 低/ 负载/ 下/ 与/ Byte/ -/ Focal/ 性能/ 相当/ ,/ 而/ 在/ 高/ 负载/ 下/ ,/ 性能/ 较/ 好/ ./ 总体/ 来说/ RRE/ -/ LB/ 无论/ 在/ 高/ 负载/ 还是/ 低/ 负载/ 下/ ,/ 都/ 能/ 达到/ 很/ 好/ 的/ 性能/ ./ 在/ 下/ 一组/ 仿真/ 中/ ,/ 我们/ 主要/ 考察/ 各种/ 交换/ 结构/ 在/ Bernoulli/ 非/ 均匀/ 流量/ 下/ 的/ 时延/ 性能/ ./ 我们/ 使用/ 了/ 4/ 种/ 在/ 交换机/ 仿真/ 中/ 广泛/ 使用/ 的/ 非/ 均匀/ 模型/ :/ 非对称/ (/ asymmetric/ )/ 、/ 对角/ (/ diagonal/ )/ 、/ 热点/ (/ hotspot/ )/ 以及/ 非/ 平衡/ (/ unblance/ )/ ./ 假设/ 输入/ 端口/ i/ 的/ 流量/ 平均/ 到达/ 率为/ λ/ i/ ,/ 而用/ λ/ Ai/ ,/ j/ 、/ λ/ Di/ ,/ j/ 、/ λ/ Hi/ ,/ j/ 和/ λ/ Ui/ ,/ j/ 分别/ 表示/ 从/ 输入/ 端口/ i/ 到达/ 而/ 指向/ 输出/ 端口/ j/ 的/ 流量/ 分别/ 在/ 非对称/ 、/ 对角/ 、/ 热点/ 以及/ 非/ 平衡/ 模型/ 中/ 的/ 速率/ ,/ 则/ 有/ 如下/ 关系/ 成立/ :/ 其中/ ,/ ak/ =/ λ/ Di/ ,/ j/ =/ λ/ Hi/ ,/ j/ =/ λ/ Ui/ ,/ j/ =/ 其中/ f/ ∈/ (/ 1/ ,/ +/ ]/ 称为/ 非对称/ 系数/ ,/ d/ ∈/ [/ 0/ ,/ 0.5/ ]/ 称为/ 对角/ 系数/ ,/ h/ ∈/ [/ 0/ ,/ 1/ ]/ 称为/ 热点/ 系数/ 而/ w/ ∈/ [/ 0/ ,/ 1/ ]/ 称为/ 非/ 平衡/ 系数/ ./ 在/ 仿真/ 中/ 我们/ 取/ 文献/ 中/ 的/ 典型值/ f/ =/ 1013/ 、/ d/ =/ 0.3/ 、/ h/ =/ 0.6/ 以及/ w/ =/ 0.6/ ./ 仿真/ 结果/ 如图/ 13/ 所示/ ./ 可见/ ,/ 由于/ 第一级/ 负载/ 均衡器/ 的/ 作用/ ,/ RRE/ -/ LB/ 无论/ 在/ 高/ 负载/ 还是/ 低/ 负载/ 下/ 都/ 稳定/ ,/ 且/ 时延/ 性能/ 良好/ ,/ 而/ 具有/ 相同/ 调度/ 复杂度/ 的/ 1/ -/ SLIP/ 算法/ 在/ 高/ 负载/ 下/ 不/ 稳定/ ./ 和/ 其它/ LB/ 结构/ 相比/ ,/ RRE/ -/ LB/ 的/ 时延/ 性能/ 在/ 非/ 均匀/ 流量/ 下/ 具有/ 较大/ 优势/ ./ 文献/ [/ 18/ ]/ 及其/ 相应/ 的/ 后续/ 研究/ 指出/ 网络/ 中/ 的/ 流量/ 大多/ 为/ 突发/ 流量/ ./ 为了/ 更/ 接近/ 实际/ 流量/ ,/ 我们/ 结合/ 突发/ 和/ 非/ 均匀/ 两种/ 流量/ 模型/ ,/ 在/ 下/ 一组/ 仿真/ 中/ 用/ 突发/ 长度/ 为/ 10/ 的/ 非/ 均匀/ 流量/ 评估/ 各种/ 交换机/ 的/ 时延/ 性能/ ./ 其中/ 突发/ 流量/ 的/ 设置/ 和/ 第一组/ 仿真/ 相同/ ,/ 而/ 非/ 均匀/ 流量/ 的/ 配置/ 和/ 第二组/ 仿真/ 相同/ ./ 仿真/ 结果/ 如图/ 14/ 所示/ ./ 在/ 各种/ LB/ 结构/ 中/ ,/ RRE/ -/ LB/ 的/ 时延/ 性能/ 仍然/ 有/ 较大/ 优势/ ./ Page97/ 总结/ 本文/ 提出/ 了/ 一种/ 时分复用/ (/ TDM/ )/ 和/ 简单/ 轮询/ 调度/ 结合/ 的/ 适应性/ TDM/ (/ ATDM/ )/ 调度/ 以/ 替换/ 传统/ 负载/ 均衡/ (/ LB/ )/ 交换机/ 中/ 的/ TDM/ 调度/ ./ 新/ 的/ LB/ 交换机/ 称为/ 轮询/ 加强/ 的/ 负载/ 均衡/ (/ RRE/ -/ LB/ )/ 交换机/ ,/ 该/ 交换机/ 有效/ 地/ 改善/ 传统/ LB/ 交换机/ 由于/ BvN/ 结构/ 使用/ 严格/ 的/ TDM/ 调度/ 而/ 导致/ 的/ “/ 连接/ 浪费/ ”/ 问题/ ,/ 从根本上/ 解决/ 困扰/ LB/ 交换机/ 的/ 时延/ 性能/ 问题/ ./ 其次/ ,/ 为了/ 适应/ 下一代/ 网络/ 对/ 高速/ 交换/ 的/ 需要/ ,/ 我们/ 在/ 文中/ 通过/ 结合/ 两个/ 阵列/ 波导/ 光栅/ 路由器/ (/ AWGR/ )/ 的/ 方式/ ,/ 使得/ 核心/ 交换/ 器件/ 可以/ 以线/ 速率/ 模拟/ 传统/ 交叉开关/ 的/ 运行/ 模式/ ,/ 这种/ 器件/ 称为/ 通过/ 双/ AWGR/ 模拟/ 的/ 交叉开关/ (/ DAWGREC/ )/ 模块/ ./ 通过/ 使用/ 这种/ 模块/ ,/ 可以/ 进一步提高/ 光/ 核心/ 交换机/ 的/ 交换/ 效率/ ,/ 改善/ 时延/ 性能/ ./ 最后/ ,/ 由于/ AWGR/ 器件/ 的/ 规模/ 不能/ 过大/ ,/ 而/ 为了/ 适应/ 下一代/ 网络/ 对/ 大规模/ 交换/ 的/ 需要/ ,/ 我们/ 提出/ 了/ 通过/ 多个/ DAWGREC/ 模块/ 互联/ 的/ 方式/ 模拟/ 更/ 大规模/ 的/ 交叉开关/ 的/ 方案/ ./ 理论/ 上/ ,/ 通过/ 多次/ 扩展/ ,/ DAWGREC/ 模块/ 可以/ 模拟/ 任意/ 规模/ 的/ 交叉开关/ ./ 我们/ 相信/ ,/ 不管/ 未来/ 使用/ 何种/ 网络体系结构/ ,/ 分组/ 交换/ 技术/ 仍然/ 是/ 计算机网络/ 的/ 基础/ ./ 而/ 能够/ 保持/ 100/ %/ 吞吐/ 率/ ,/ 同时/ 解决/ 了/ 时延/ 性能/ 以及/ 交换/ 规模/ 问题/ 的/ 新/ LB/ 结构/ 一定/ 可以/ 为/ 未来/ 网络/ 提供/ 更好/ 的/ 服务质量/ 保证/ ./ 

