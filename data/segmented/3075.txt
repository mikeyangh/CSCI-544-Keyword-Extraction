Page1/ 基于/ shell/ 命令/ 和/ 多重/ 行为/ 模式/ 挖掘/ 的/ 用户/ 伪装/ 攻击/ 检测/ 田新广段/ / 毅程/ 学旗/ (/ 中国科学院计算技术研究所/ 网络/ 科学/ 与/ 技术/ 重点/ 实验室/ 北京/ 100190/ )/ 摘要/ 伪装/ 攻击/ 是/ 指非/ 授权/ 用户/ 通过/ 伪装成/ 合法/ 用户/ 来/ 获得/ 访问/ 关键/ 数据/ 或/ 更/ 高层/ 访问/ 权限/ 的/ 行为/ ./ 近年来/ ,/ 伪装/ 攻击/ 检测/ 在/ 保障/ 网络/ 信息安全/ 中/ 发挥/ 着/ 越来越/ 大/ 的/ 作用/ ./ 文中/ 提出/ 一种/ 新/ 的/ 用户/ 伪装/ 攻击/ 检测/ 方法/ ./ 同/ 现有/ 的/ 典型/ 检测/ 方法/ 相比/ ,/ 该/ 方法/ 在/ 训练/ 阶段/ 改进/ 了/ 对/ 用户/ 行为/ 模式/ 的/ 表示/ 方式/ ,/ 通过/ 合理/ 选择/ 用户/ 行为/ 特征/ 并/ 基于/ 阶梯式/ 的/ 序列/ 模式/ 支持/ 度来/ 建立/ 合法/ 用户/ 的/ 正常/ 行为/ 轮廓/ ,/ 提高/ 了/ 用户/ 行为/ 描述/ 的/ 准确性/ 和/ 对/ 不同/ 类型/ 用户/ 的/ 适应性/ ;/ 在/ 充分考虑/ shell/ 命令/ 审计/ 数据/ 时序/ 特征/ 的/ 基础/ 上/ ,/ 针对/ 伪装/ 攻击行为/ 复杂多变/ 的/ 特点/ ,/ 提出/ 基于/ 多重/ 行为/ 模式/ 并行/ 挖掘/ 和/ 多/ 门限/ 联合/ 判决/ 的/ 检测/ 模型/ ,/ 并/ 通过/ 交叉/ 验证/ 和/ 等量/ 迭代/ 逼近/ 方法/ 确定/ 最佳/ 门限/ 参数/ ,/ 克服/ 了/ 单一/ 序列/ 模式/ 检测/ 模型/ 在/ 性能/ 稳定性/ 和/ 容错/ 能力/ 方面/ 的/ 不足/ ,/ 在/ 不/ 明显增加/ 计算成本/ 的/ 条件/ 下/ 大幅度提高/ 了/ 检测/ 准确度/ ./ 文中/ 提出/ 的/ 方法/ 已/ 应用/ 于/ 实际/ 检测/ 系统/ ,/ 并/ 表现/ 出/ 良好/ 的/ 检测/ 性能/ ./ 关键词/ 网络安全/ ;/ 伪装/ 攻击/ ;/ 入侵/ 检测/ ;/ shell/ 命令/ ;/ 异常/ 检测/ 1/ 引言/ 入侵者/ 假冒/ 或/ 伪装成/ 合法/ 用户/ 进入/ 信息系统/ 的/ 入侵/ 行为/ 称为/ 伪装/ (/ masquerade/ )/ [/ 1/ -/ 3/ ]/ ./ 近年来/ ,/ 伪装/ 攻击/ 在/ 网络/ 信息安全/ 事件/ 中/ 的/ 比例/ 不断/ 增长/ [/ 3/ -/ 5/ ]/ ,/ 成为/ 对系统/ 破坏/ 最为/ 严重/ 的/ 攻击方式/ 之一/ ./ 伪装/ 攻击/ 检测/ 是/ 当前/ 网络安全/ 领域/ 关注/ 的/ 热点/ ./ 由于/ 合法/ 用户/ 的/ 行为/ 本身/ 是/ 变化/ 的/ ,/ 且/ 伪装/ 用户/ 的/ 行为/ 可能/ 看起来/ 是/ 正常/ 的/ ,/ 这种/ 不确定性/ 使得/ 伪装/ 攻击/ 检测/ 比/ 传统/ 的/ 网络/ 入侵/ 检测/ 更为/ 困难/ [/ 4/ ]/ ./ 目前/ 的/ 伪装/ 攻击/ 检测/ 系统/ 大多/ 采用/ 异常/ 检测/ 技术/ ,/ 这种/ 技术/ 对/ 合法/ 用户/ 的/ 正常/ 行为/ 进行/ 建模/ ,/ 通过/ 被/ 监测/ 用户/ 的/ 实际/ 行为/ 与/ 合法/ 用户/ 正常/ 行为/ 之间/ 的/ 比较/ 或/ 匹配/ 来/ 检测/ 入侵/ (/ 攻击/ )/ ;/ 其/ 优点/ 是/ 不/ 需要/ 过多/ 有关/ 入侵/ 行为/ 的/ 先验/ 知识/ ,/ 且/ 能够/ 检测/ 出/ 未知/ 的/ 攻击/ 类型/ [/ 5/ ]/ ./ 近年来/ ,/ 国内外/ 已经/ 开展/ 了/ 数据挖掘/ 、/ 机器/ 学习/ 、/ 支撑/ 向量/ 机/ 、/ 神经网络/ 等/ 技术/ 在/ 用户/ 伪装/ 攻击/ 检测/ 中/ 的/ 应用/ 研究/ [/ 2/ -/ 9/ ]/ ,/ 研究/ 目标/ 主要/ 是/ 提高/ 检测/ 的/ 准确性/ 、/ 实时性/ 、/ 高效性/ 以及/ 自适应性/ ,/ 其中/ 一些/ 研究成果/ 已经/ 接近/ 或/ 达到/ 了/ 实用化/ 水平/ ./ Schonlau/ 等/ 人/ 研究/ 了/ 基于/ 统计/ 理论/ 的/ 伪装/ 攻击/ 检测/ 方法/ [/ 7/ ]/ ,/ 并/ 利用/ AT&T/ Shannon/ 实验室/ 的/ shell/ 命令/ 数据/ 对/ 不同/ 类型/ 的/ 统计/ 方法/ 进行/ 了/ 实验/ 和/ 综合/ 对比/ ./ Maxion/ 等/ 人/ 对/ Schonlau/ 的/ 检测/ 方法/ 进行/ 了/ 改进/ [/ 8/ ]/ ,/ 引入/ 了/ 贝叶斯/ 分类/ 算法/ ,/ 较大/ 程度/ 地/ 提高/ 了/ 检测/ 准确度/ ./ Lane/ 等/ 人/ 开展/ 了/ 基于/ 机器/ 学习/ 的/ 伪装/ 攻击/ 检测/ 研究/ [/ 9/ ]/ ,/ 利用/ 特定/ 的/ 相似/ 度/ 函数/ 计算/ 行为/ 模式/ 之间/ 的/ 相似/ 度/ ,/ 并/ 将/ 加窗/ 平滑/ 后/ 的/ 相似/ 度/ 曲线/ 作为/ 检测/ 用户/ 异常/ 行为/ 的/ 依据/ ./ Tian/ 等/ 人/ 在/ Lane/ 的/ 基础/ 上/ 改进/ 了/ 相似/ 度/ 赋值/ 方式/ [/ 10/ ]/ ,/ 并/ 采用/ 可变/ 窗/ 长度/ 进行/ 相似/ 度/ 平滑/ 滤噪/ ,/ 进一步/ 改善/ 了/ 检测/ 性能/ ./ 连/ 一峰/ 等/ 人/ 提出/ 一种/ 基于/ 模式/ 挖掘/ 的/ 用户/ 行为/ 异常/ 检测/ 方法/ [/ 11/ ]/ ,/ 该/ 方法/ 利用/ 数据挖掘/ 中/ 的/ 关联/ 分析/ 和/ 序列/ 挖掘/ 技术/ 对/ 用户/ 行为/ 进行/ 模式/ 挖掘/ ,/ 并/ 采用/ 了/ 基于/ 相关/ 函数/ 的/ 模式/ 比较/ 算法/ ./ 此外/ ,/ Kim/ 等/ 人/ 研究/ 了/ 基于/ 支撑/ 向量/ 机/ 的/ 伪装/ 攻击/ 检测/ 方法/ [/ 4/ ]/ ,/ Szymanski/ 等/ 人/ 提出/ 了/ 基于/ 递归/ 数据挖掘/ 的/ 检测/ 方法/ [/ 5/ ]/ ,/ 这/ 两种/ 方法/ 均/ 具有/ 较/ 高/ 的/ 检测/ 效率/ ,/ 但/ 对/ 用户/ 行为/ 变化/ 的/ 适应性/ 不/ 强/ [/ 2/ ]/ ,/ 仅/ 适用/ 于/ 训练/ 数据/ 较为/ 充分/ 的/ 场合/ ./ 在/ 以上/ 工作/ 的/ 基础/ 上/ ,/ 本文/ 提出/ 一种/ 新/ 的/ 用户/ 伪装/ 攻击/ 检测/ 方法/ ./ 该/ 方法/ 利用/ shell/ 会话/ 中/ 用户/ 执行/ 的/ shell/ 命令/ 作为/ 原始/ 审计/ 数据/ ,/ 基于/ 实际/ 检测/ 系统/ [/ 12/ ]/ 的/ 实例/ 分析/ 和/ 已有/ 研究/ 结论/ [/ 2/ -/ 9/ ]/ ,/ 改进/ 了/ 对/ 用户/ 行为/ 模式/ 的/ 表示/ 方式/ ,/ 通过/ 合理/ 选择/ 用户/ 行为/ 特征/ 并/ 基于/ 阶梯式/ 的/ 序列/ 模式/ 支持/ 度来/ 建立/ 合法/ 用户/ 的/ 正常/ 行为/ 轮廓/ ,/ 提高/ 了/ 用户/ 行为/ 描述/ 的/ 准确性/ 和/ 对/ 不同/ 类型/ 用户/ 的/ 适应性/ ;/ 在/ 检测/ 阶段/ ,/ 充分考虑/ 了/ shell/ 命令/ 审计/ 数据/ 的/ 时序/ 特征/ 以及/ 伪装/ 攻击行为/ 复杂多变/ 的/ 特点/ ,/ 通过/ 多重/ 行为/ 模式/ 并行/ 挖掘/ 来/ 得到/ 多个/ 参考/ 判决/ 值/ ,/ 采用/ 多/ 门限/ 联合/ 判决/ 的/ 方式/ 对/ 被/ 监测/ 用户/ 当前/ 行为/ 的/ 异常/ 程度/ 进行/ 分析/ ,/ 并/ 通过/ 交叉/ 验证/ 和/ 等量/ 迭代/ 逼近/ 方法/ 确定/ 最佳/ 门限/ 参数/ ,/ 克服/ 了/ 基于/ 单一/ 序列/ 模式/ 的/ 检测/ 模型/ [/ 5/ ,/ 7/ -/ 9/ ]/ 在/ 检测/ 性能/ 稳定性/ 和/ 容错/ 能力/ 方面/ 的/ 不足/ ./ 实验/ 表明/ ,/ 同/ 现有/ 的/ 典型/ 检测/ 方法/ 相比/ ,/ 本文/ 的/ 方法/ 在/ 不/ 明显增加/ 计算成本/ 的/ 条件/ 下/ 大幅度提高/ 了/ 检测/ 准确度/ ,/ 具有/ 很强/ 的/ 实用性/ ./ 该/ 方法/ 已/ 应用/ 于/ 文献/ [/ 12/ ]/ 所述/ 发明专利/ 的/ 检测/ 系统/ ,/ 并/ 表现/ 出/ 良好/ 的/ 检测/ 性能/ ./ 2/ 审计/ 数据/ 的/ 分析/ 及/ 预处理/ 目前/ ,/ 基于/ 主机/ 数据/ 的/ 入侵/ 检测/ 研究/ 有/ 两个/ 主要/ 的/ 分支/ [/ 3/ -/ 5/ ,/ 13/ ]/ ,/ 分别/ 是/ 以/ 系统/ 调用/ 为/ 审计/ 数据/ 的/ 程序/ 行为/ 异常/ 检测/ 和/ 以/ shell/ 命令/ 为/ 审计/ 数据/ 的/ 用户/ 行为/ 异常/ 检测/ ./ 相对/ 用户/ 行为/ 而言/ ,/ 程序/ 行为/ 比较/ 单一/ ,/ 利用/ 系统/ 调用/ 可以/ 对/ 程序/ 行为/ 特别/ 是/ 特权/ 程序/ 的/ 行为/ 建立/ 较为/ 稳定/ 简洁/ 的/ 模型/ [/ 14/ ]/ ,/ 但是/ ,/ 系统/ 调用/ 来自/ 系统/ 的/ 核心层/ ,/ 获取/ 过程/ 比较复杂/ ,/ 耗用/ 的/ 系统资源/ 较/ 多/ ,/ 而且/ ,/ 基于/ 系统/ 调用/ 的/ 程序/ 行为/ 异常/ 检测/ 不能/ 直接/ 检测/ 出/ 用户/ 帐号/ 假冒/ 等/ 系统/ 内部/ 的/ 攻击行为/ [/ 13/ ]/ ./ 由于/ 用户/ 行为/ 复杂多变/ ,/ 使得/ 用户/ 正常/ 行为/ 模型/ 的/ 建立/ 变得/ 较为/ 困难/ ;/ 国内外/ 大都/ 倾向/ 于/ 使用/ 比较/ 完整/ 的/ 审计/ 事件/ 来/ 对/ 用户/ 行为/ 进行/ 建模/ ./ 在/ Unix/ 系统/ 环境/ 下/ ,/ shell/ 是/ 终端用户/ 与/ 操作系统/ 之间/ 最/ 主要/ 的/ 界面/ ,/ 很大/ 比例/ 的/ 用户/ 活动/ 都/ 是/ 利用/ shell/ 完成/ 的/ ;/ shell/ 命令/ 在/ 系统/ 用户/ 层/ 比较/ 容易/ 获取/ ,/ 而且/ 能够/ 直接/ 反映/ 出/ 用户/ 的/ 行为/ 模式/ ./ 因此/ ,/ 基于/ shell/ 命令/ 的/ 用户/ 伪装/ 攻击/ 检测/ 在/ 近些年/ 得到/ 了/ 较/ 多/ 的/ 研究/ [/ 2/ ,/ 4/ -/ 5/ ,/ 7/ -/ 9/ ]/ ./ 与/ 文献/ [/ 4/ -/ 5/ ,/ 7/ -/ 9/ ]/ 中/ 的/ 伪装/ 攻击/ 检测/ 方法/ 相同/ ,/ 本文/ 的/ 检测/ 方法/ 采用/ Unix/ 平台/ 上/ 的/ shell/ 命令/ 作为/ 审计/ 数据/ ./ 在/ 训练/ 和/ 检测/ 阶段/ ,/ 需要/ 对/ 用户/ 的/ 原始/ shell/ 命令/ 数据/ 进行/ 预处理/ ./ 预处理/ 的/ 方式/ 主要/ 有/ 两种/ ,/ 第/ 1/ 种/ 方式/ 如/ 文献/ [/ 7/ -/ 8/ ]/ 所述/ ,/ 预处理/ 时/ 只/ 保留/ shell/ 命令/ 的/ 名称/ ,/ 滤除/ 命令/ 参数/ 和/ 时间/ 等/ 信息/ ./ 第/ 2/ 种/ 方式/ 如/ 文献/ [/ 2/ ,/ 9/ ]/ 所述/ ,/ 预处理/ 时/ 滤除/ shell/ 命令/ 中/ 的/ 主机名/ 、/ 网址/ 等/ 信息/ ,/ 保留/ shell/ 命令/ 的/ 名称/ 及/ Page3/ 参数/ ;/ 各/ 命令/ 符号/ 按照/ 在/ shell/ 会话/ 中/ 的/ 出现/ 次序/ 进行/ 排列/ ,/ 不同/ 的/ shell/ 会话/ 按照/ 时间/ 顺序/ 进行/ 连接/ ,/ 每个/ 会话/ 开始/ 和/ 结束/ 的/ 时间/ 点上/ 插入/ 了/ 标识符/ 号/ ./ 例如/ ,/ 某/ 用户/ 的/ 一个/ shell/ 会话/ 数据/ :/ >/ cd/ ~/ // private/ // docs/ >/ ls/ -/ laF/ |/ more/ >/ catfoo/ ./ txtbar/ ./ txtzlg/ ./ txt/ >/ ~/ // tian/ // zly/ >/ mailxtianxg/ @/ sina/ ./ com/ >/ exit/ 经/ 预处理/ 后/ 成为/ 如下/ shell/ 命令/ 序列/ :/ (/ / SOF/ / ,/ cd/ ,/ 〈/ 1/ 〉/ ,/ ls/ ,/ -/ laF/ ,/ |/ ,/ more/ ,/ cat/ ,/ 〈/ 3/ 〉/ ,/ >/ ,/ 〈/ 1/ 〉/ ,/ mailx/ ,/ 〈/ 1/ 〉/ ,/ exit/ ,/ / EOF/ / )/ ,/ 其中/ / SOF/ / 和/ / EOF/ / 分别/ 是/ 会/ 话/ 开始/ 和/ 结束/ 的/ 标识符/ 号/ ,/ 〈/ 1/ 〉/ 、/ 〈/ 3/ 〉/ 为/ 目录名/ (/ 地址/ )/ 符号/ ./ 经过/ 以上/ 两种/ 方式/ 预处理/ 后/ 的/ 原始/ shell/ 命令/ 数据/ 在/ 形式/ 上均/ 表现/ 为/ shell/ 命令/ 序列/ (/ 按/ 时序/ 排列/ 的/ 若干个/ shell/ 命令/ 符号/ )/ ./ 相对/ 于/ 第/ 1/ 种/ 方式/ ,/ 第/ 2/ 种/ 方式/ 预处理/ 后/ 的/ 数据/ 中/ 互不/ 相同/ 的/ shell/ 命令/ 符号/ 明显/ 增多/ ,/ 但/ 能够/ 更加/ 精确/ 地/ 反映/ 用户/ 行为/ ./ 3/ 训练/ 用户/ 伪装/ 攻击/ 检测/ 的/ 具体/ 实现/ 过程/ 可/ 分为/ 训练/ 和/ 检测/ 两个/ 阶段/ [/ 4/ -/ 5/ ]/ ./ 训练/ 阶段/ 的/ 主要/ 工作/ 是/ 根据/ 训练/ 数据/ 对/ 我们/ 所/ 关心/ 的/ 合法/ 用户/ 的/ 正常/ 行为/ 进行/ 建模/ ./ 同/ 程序/ 行为/ 相比/ ,/ 用户/ 行为/ 具有/ 一些/ 不同/ 的/ 特点/ ,/ 尤其/ 是/ 在/ 行为/ 的/ 稳定性/ 方面/ ./ 因此/ ,/ 在/ 程序/ 行为/ 异常/ 检测/ 中/ 具有/ 良好/ 性能/ 的/ 训练/ 和/ 检测/ 模型/ 并不一定/ 适用/ 于/ 用户/ 行为/ 异常/ 检测/ [/ 15/ ]/ ./ 在/ 用户/ 行为/ 异常/ 检测/ 中/ ,/ 由于/ 用户/ 行为/ 的/ 多变性/ ,/ 我们/ 得到/ 的/ 训练/ 数据/ 往往/ 不够/ 充分/ ,/ 这/ 就/ 要求/ 训练/ 和/ 检测/ 模型/ 应当/ 具有/ 一定/ 的/ 容错性/ 、/ 泛化/ 能力/ 以及/ 对/ 用户/ 行为/ 变化/ 的/ 适应性/ [/ 2/ ]/ ./ 如何/ 利用/ 相对/ 不够/ 充分/ 的/ 训练/ 数据/ 来/ 尽可能/ 精确/ 地/ 描述/ 用户/ 的/ 正常/ 行为/ 轮廓/ ,/ 以及/ 如何/ 利用/ 该/ 正常/ 行为/ 轮廓/ 进行/ 异常/ 检测/ 是/ 我们/ 研究/ 的/ 重点/ ./ 在/ 现有/ 的/ 基于/ 机器/ 学习/ 和/ 基于/ 数据挖掘/ 的/ 检测/ 方法/ 中/ [/ 5/ ,/ 9/ ,/ 11/ ]/ ,/ 一般/ 都/ 采用/ 单一/ 长度/ 的/ shell/ 命令/ 短/ 序列/ 来/ 表示/ 用户/ 的/ 行为/ 模式/ (/ 行为/ 模式/ 是/ 指/ 用户/ 操作过程/ 中/ 体现/ 出/ 的/ 某种/ 规律性/ )/ ./ 但/ 实际/ 中/ ,/ 不同/ 用户/ 所/ 具有/ 的/ 行为/ 模式/ 存在/ 差异/ ,/ 同一/ 用户/ 在/ 完成/ 不同/ 行为/ 模式/ 时所/ 执行/ 的/ shell/ 命令/ 个数/ 也/ 不尽相同/ ,/ 因而/ ,/ 采用/ 单一/ 长度/ 的/ shell/ 命令/ 序列/ 往往/ 难以/ 全面/ 准确/ 地/ 反映/ 用户/ 的/ 行为/ 轮廓/ ,/ 而且/ ,/ 这种/ 方法/ 在/ 实际/ 应用/ 中/ 也/ 不/ 容易/ 估算/ 针对/ 具体/ 用户/ 的/ 最佳/ 序列/ 长度/ [/ 7/ ,/ 9/ ]/ ;/ 例如/ ,/ 文献/ [/ 9/ ]/ 主要/ 采用/ 实验/ 方法/ 来/ 确定/ 最佳/ 序列/ 长度/ ,/ 所/ 需/ 的/ 计算/ 量/ 很大/ ,/ 而且/ 其/ 性能/ 缺乏/ 稳定性/ ./ 我们/ 针对/ 以上/ 不足/ 进行/ 了/ 改进/ 和/ 修正/ ,/ 采用/ 多种/ 长度/ 不同/ 的/ shell/ 命令/ 短/ 序列/ 来/ 表示/ 用户/ 行为/ 模式/ ,/ 通过/ 合理/ 选择/ 用户/ 行为/ 特征/ 并/ 基于/ 序列/ 模式/ 的/ 支持/ 度来/ 建立/ 合法/ 用户/ 的/ 正常/ 行为/ 轮廓/ ,/ 提高/ 了/ 用户/ 行为/ 描述/ 的/ 准确性/ 和/ 对/ 不同/ 类型/ 用户/ 的/ 适应性/ ./ 训练/ 阶段/ 的/ 工作/ 主要/ 有/ 以下/ 几/ 部分/ :/ (/ 1/ )/ 获取/ 合法/ 用户/ 的/ 正常/ 行为/ 训练/ 数据/ ./ 设/ 正常/ 行为/ 训练/ 数据/ 为/ R/ =/ (/ s1/ ,/ s2/ ,/ …/ ,/ sr/ )/ ,/ 它/ 是/ 对/ 该/ 合法/ 用户/ 在历史上/ 正常/ 操作/ 时所/ 执行/ 的/ 原始/ shell/ 命令/ 数据/ 进行/ 预处理/ 所/ 得到/ 的/ shell/ 命令/ 序列/ (/ 其/ 长度/ 为/ r/ )/ ,/ 其中/ sj/ 表示/ 按/ 时间/ 顺序排列/ 的/ 第/ j/ 个/ shell/ 命令/ 符号/ ./ (/ 2/ )/ 定义/ W/ 种/ 长度/ 不同/ 的/ shell/ 命令/ 短/ 序列/ ,/ 用于/ 表示/ 该/ 合法/ 用户/ 的/ 各种/ 行为/ 模式/ ./ 设/ 定义/ 的/ 短/ 序列/ 长度/ 的/ 集合/ 为/ C/ =/ {/ l/ (/ 1/ )/ ,/ l/ (/ 2/ )/ ,/ …/ ,/ l/ (/ W/ )/ }/ ,/ 其中/ l/ (/ i/ )/ 表示/ 第/ i/ 种/ shell/ 命令/ 短/ 序列/ 的/ 长度/ ,/ 且/ l/ (/ 1/ )/ </ l/ (/ 2/ )/ </ …/ </ l/ (/ W/ )/ ./ 在/ W/ 确定/ 的/ 情况/ 下/ ,/ C/ 可有/ 不同/ 的/ 选择/ ./ 例如/ W/ =/ 3/ 时/ ,/ C/ 可以/ 为/ {/ 1/ ,/ 2/ ,/ 3/ }/ (/ 即/ 3/ 种/ 序列/ 的/ 长度/ 分别/ 为/ 1/ ,/ 2/ ,/ 3/ )/ ,/ 也/ 可以/ 为/ {/ 3/ ,/ 6/ ,/ 9/ }/ 或/ 其它/ 组合/ ./ W/ 和/ C/ 对/ 检测/ 性能/ 有/ 直接/ 影响/ ,/ 在/ 选择/ 它们/ 时/ ,/ 除了/ 要/ 充分考虑/ 合法/ 用户/ 的/ 行为/ 特征/ 之外/ ,/ 还/ 需/ 考虑/ 检测/ 系统/ 的/ 复杂度/ 及/ 检测/ 效率/ (/ W/ 和/ l/ (/ i/ )/ 越大/ ,/ 检测/ 系统/ 的/ 存储量/ 和/ 工作/ 中/ 的/ 运算量/ 也/ 会/ 越/ 大/ )/ ./ (/ 3/ )/ 由/ 训练/ 数据/ R/ 生成/ W/ 个/ 短/ 序列/ 长度/ 分别/ 为/ l/ (/ 1/ )/ ,/ l/ (/ 2/ )/ ,/ …/ ,/ l/ (/ W/ )/ 的/ shell/ 命令/ 短/ 序列/ 流/ ./ 这里/ ,/ 分别/ 用/ S1/ ,/ S2/ ,/ …/ ,/ SW/ 表示/ 由/ R/ 生成/ 的/ 短/ 序列/ 长度/ 分别/ 为/ l/ (/ 1/ )/ ,/ l/ (/ 2/ )/ ,/ …/ ,/ l/ (/ W/ )/ 的/ W/ 个/ shell/ 命令/ 短/ 序列/ 流/ ,/ 其中/ Si/ 是/ 短/ 序列/ 长度/ 为/ l/ (/ i/ )/ (/ 1/ / i/ / W/ )/ 的/ shell/ 命令/ 短/ 序列/ 流/ ,/ 它/ 包含/ r/ -/ l/ (/ i/ )/ +/ 1/ 个/ shell/ 命令/ 短/ 序列/ ;/ Si/ =/ (/ Sij/ =/ (/ sj/ ,/ sj/ +/ 1/ ,/ …/ ,/ sj/ +/ l/ (/ i/ )/ -/ 1/ )/ ,/ SiSi/ 点/ 的/ 长度/ 为/ l/ (/ i/ )/ 的/ 短/ 序列/ (/ 1/ / j/ / r/ -/ l/ (/ i/ )/ +/ 1/ )/ ./ (/ 4/ )/ 对于/ 1/ / i/ / W/ ,/ 计算/ Si/ 中/ 每个/ shell/ 命令/ 短/ 序列/ 在/ Si/ 中/ 的/ 支持/ 度/ ./ 定义/ 1/ ./ 一个/ 长度/ 为/ l/ (/ i/ )/ 的/ shell/ 命令/ 短/ 序列/ +/ 在/ shell/ 命令/ 短/ 序列/ 流/ Si/ 中/ 的/ 支持/ 度/ 等于/ 该/ 序列/ Si/ 在/ Si/ 中/ 的/ 出现/ 次数/ 除以/ Si/ 中/ 的/ 序列/ 总数/ (/ 1/ / i/ / W/ )/ ,/ 即/ support/ (/ Si/ 式/ 中/ number/ (/ Si/ 个/ shell/ 命令/ 短/ 序列/ 中/ 的/ 出现/ 次数/ ,/ support/ (/ SiPage4/ 示短/ 序列/ Si/ 了/ 短/ 序列/ Si/ (/ 5/ )/ 设置/ W/ 个/ 最小/ 支持/ 度/ minsup/ (/ 1/ )/ ,/ minsup/ (/ 2/ )/ ,/ …/ ,/ minsup/ (/ W/ )/ ,/ 其中/ minsup/ (/ i/ )/ 是/ 针对/ shell/ 命令/ 短/ 序列/ 流/ Si/ 中/ 长度/ 为/ l/ (/ i/ )/ 的/ 短/ 序列/ 而/ 设置/ 的/ (/ 1/ / i/ / W/ )/ ./ 考虑/ 到长/ 序列/ 模式/ 对/ 短/ 序列/ 模式/ 的/ 相容性/ ,/ 我们/ 采用/ 了/ 阶梯式/ 支持/ 度/ ,/ 要求/ minsup/ (/ 1/ )/ / minsup/ (/ 2/ )/ / …/ / minsup/ (/ W/ )/ ./ (/ 6/ )/ 从/ W/ 个/ shell/ 命令/ 短/ 序列/ 流中/ ,/ 分别/ 按照/ 序列/ 的/ 支持/ 度/ 提取/ 正常/ 行为/ 模式/ 序列/ ./ 对于/ 1/ / i/ / W/ ,/ 将/ Si/ 中/ 支持/ 度/ 大于/ 或/ 等于/ minsup/ (/ i/ )/ 的/ 短/ 序列/ 提取/ 出来/ ,/ 构成/ 满足/ 支持/ 度/ 要求/ 的/ 序列/ 库/ L/ (/ i/ )/ ./ 设/ Si/ 中/ 支持/ 度/ 大于/ 或/ 等于/ minsup/ (/ i/ )/ 的/ 短/ 序列/ 共有/ K/ (/ i/ )/ 个/ ,/ 分别/ 记为/ SiK/ (/ i/ )/ +/ (/ 这里/ K/ (/ i/ )/ / r/ -/ l/ (/ i/ )/ +/ 1/ )/ ,/ 则/ 满足/ 支持/ 度/ 要求/ Si/ 的/ 序列/ 库/ L/ (/ i/ )/ =/ {/ Si/ (/ 7/ )/ 建立/ W/ 个/ 序列/ 库来/ 描述/ 该/ 合法/ 用户/ 的/ 正常/ 行为/ 轮廓/ ./ 将/ W/ 个/ 满足/ 支持/ 度/ 要求/ 的/ 序列/ 库/ L/ (/ 1/ )/ ,/ L/ (/ 2/ )/ ,/ …/ ,/ L/ (/ W/ )/ 存储/ 起来/ ,/ 建立/ 用于/ 异常/ 检测/ 的/ 正常/ 序列/ 库/ L/ ./ 这里/ ,/ L/ =/ {/ L/ (/ 1/ )/ ,/ L/ (/ 2/ )/ ,/ …/ ,/ L/ (/ W/ )/ }/ ,/ 它/ 用于/ 描述/ 该/ 用户/ 历史/ 上/ 的/ 正常/ 行为/ 轮廓/ ./ 4/ 检测/ 检测/ 阶段/ 的/ 工作/ 是/ 根据/ 训练/ 阶段/ 所/ 建立/ 的/ 合法/ 用户/ 正常/ 行为/ 轮廓/ ,/ 利用/ 特定/ 的/ 检测/ 模型/ 来/ 识别/ 被/ 监测/ 用户/ 当前/ 行为/ 中/ 的/ 异常/ (/ 伪装/ 或/ 假冒/ 行为/ )/ ./ 在/ 检测/ 阶段/ ,/ 我们/ 充分考虑/ 了/ shell/ 命令/ 审计/ 数据/ 的/ 时序/ 特征/ 和/ 短时/ 相关性/ ,/ 针对/ 伪装/ 攻击行为/ 复杂多变/ 的/ 特点/ ,/ 提出/ 了/ 基于/ 多重/ 行为/ 模式/ 并行/ 挖掘/ 和/ 多/ 门限/ 联合/ 判决/ 的/ 检测/ 模型/ ,/ 并/ 通过/ 交叉/ 验证/ 和/ 等量/ 迭代/ 逼近/ 方法/ 确定/ 最佳/ 门限/ 参数/ ,/ 与/ 文献/ [/ 4/ -/ 5/ ,/ 9/ ]/ 中/ 的/ 检测/ 模型/ 相比/ ,/ 在/ 不/ 明显增加/ 计算成本/ 的/ 条件/ 下/ 大幅度提高/ 了/ 检测/ 准确度/ ,/ 并且/ 增强/ 了/ 检测/ 性能/ 的/ 稳定性/ 和/ 容错/ 能力/ ./ 检测/ 阶段/ 的/ 工作/ 包括/ 以下/ 几/ 部分/ :/ (/ 1/ )/ 获取/ 用于/ 检测/ 的/ 审计/ 数据/ ./ 获取/ 该/ 用户/ 在/ 被/ 监测/ 的/ 时间/ 内/ 执行/ 的/ 原始/ shell/ 命令/ 审计/ 数据/ ,/ 并/ 将/ 其/ 预处理/ 成/ shell/ 命令/ 序列/ 的/ 形式/ ./ 设/ 预处理/ 后/ 得到/ 的/ shell/ 命令/ 序列/ 为/ 珚/ R/ =/ (/ s/ -/ 1/ ,/ s/ -/ 2/ ,/ …/ ,/ s/ -/ r/ -/ )/ ,/ 其中/ s/ -/ j/ 表示/ 按/ 时间/ 顺序排列/ 的/ 第/ j/ 个/ shell/ 命令/ 符号/ ,/ r/ -/ 为/ 该/ 命令/ 序列/ 的/ 长度/ ./ 在/ 实时/ 检测/ (/ 在线/ 检测/ )/ 的/ 情况/ 下/ ,/ 珚/ R/ 中/ 的/ 各个/ shell/ 命令/ 是/ 按照/ 时间/ 顺序/ 依次/ 得到/ 的/ ./ (/ 2/ )/ 由/ 审计/ 数据/ 珚/ R/ 生成/ W/ 个/ 短/ 序列/ 长度/ 分别/ 为/ l/ (/ 1/ )/ ,/ l/ (/ 2/ )/ ,/ …/ ,/ l/ (/ W/ )/ 的/ shell/ 命令/ 短/ 序列/ 流/ ./ 分别/ 用/ 珚/ S1/ ,/ 珚/ S2/ ,/ …/ ,/ 珚/ SW/ 表示/ 由/ 珚/ R/ 生成/ 的/ 短/ 序列/ 长度/ 分别/ 为/ l/ (/ 1/ )/ ,/ l/ (/ 2/ )/ ,/ …/ ,/ l/ (/ W/ )/ 的/ W/ 个/ shell/ 命令/ 短/ 序列/ 流/ ,/ 其中/ 珚/ Si/ 是/ 短/ 序列/ 长度/ 为/ l/ (/ i/ )/ (/ 1/ / i/ / W/ )/ 的/ shell/ 命令/ 短/ 序列/ 流/ ;/ 珚/ Si/ =/ (/ 珚/ Si/ 其中/ 珚/ Si/ 命令/ s/ -/ j/ 为/ 终点/ 、/ 长度/ 为/ l/ (/ i/ )/ 的/ 短/ 序列/ (/ l/ (/ i/ )/ / j/ / r/ -/ )/ ./ 珚/ Si/ 中共/ 有/ r/ -/ -/ l/ (/ i/ )/ +/ 1/ 个/ shell/ 命令/ 短/ 序列/ ./ 需要/ 指出/ ,/ 在/ 训练/ 阶段/ 利用/ 训练/ 数据/ 生成/ shell/ 命令/ 短/ 序列/ 流/ 时/ ,/ 采用/ 了/ 滑动/ 窗前/ 向/ 截取/ 短/ 序列/ 的/ 方式/ ;/ 而/ 在/ 检测/ 阶段/ 利用/ 审计/ 数据/ 生成/ shell/ 命令/ 短/ 序列/ 流/ 时/ ,/ 采用/ 了/ 滑动/ 窗后/ 向/ 截取/ 短/ 序列/ 的/ 方式/ ,/ 这样/ 便于/ 实时/ 检测/ ./ (/ 3/ )/ 对/ W/ 个/ shell/ 命令/ 短/ 序列/ 流/ 进行/ 多重/ 行为/ 模式匹配/ 与/ 挖掘/ ./ 对于/ 1/ / i/ / W/ ,/ 将/ shell/ 命令/ 短/ 序列/ 流/ 珚/ Si/ =/ l/ (/ i/ )/ ,/ 珚/ Si/ (/ 珚/ Si/ (/ s/ -/ j/ -/ l/ (/ i/ )/ +/ 1/ ,/ s/ -/ j/ -/ l/ (/ i/ )/ +/ 2/ ,/ …/ ,/ s/ -/ j/ )/ 同/ 相应/ 的/ 序列/ 库/ L/ (/ i/ )/ =/ {/ Si1/ +/ ,/ Si/ 列/ 珚/ Sij/ 与/ 序列/ 库/ L/ (/ i/ )/ 中/ 的/ 某个/ 短/ 序列/ 相同/ (/ 即/ 珚/ SiL/ (/ i/ )/ )/ ,/ 则/ 将/ 短/ 序列/ 珚/ Siclass/ (/ 珚/ Si/ 短/ 序列/ 都/ 不/ 相同/ (/ 即/ 珚/ Si/ 为/ 异常/ 行为/ 模式/ 序列/ ,/ 并记/ class/ (/ 珚/ Si/ 序列/ 匹配/ ,/ 对于/ 每/ 一个/ shell/ 命令/ 短/ 序列/ 流/ 珚/ Si/ =/ (/ 珚/ Sil/ (/ i/ )/ ,/ 珚/ Siclass/ (/ 珚/ Si/ (/ 4/ )/ 计算/ 判决/ 值/ ./ 根据/ 国内外/ 现有/ 的/ 研究/ 结论/ ,/ 进行/ 伪装/ 攻击/ 的/ 用户/ 在/ 短时间/ 内/ 的/ 行为/ 可能/ 与/ 合法/ 用户/ 的/ 正常/ 行为/ 没有/ 太/ 大/ 差别/ ,/ 但/ 在/ 较长时间/ 段/ 内/ 表现/ 出/ 的/ 行为/ 特征/ 通常/ 会/ 较大/ 程度/ 地/ 偏离/ 合法/ 用户/ 的/ 正常/ 行为/ 轮廓/ ./ 考虑/ 到/ 用户/ 伪装/ 攻击/ 的/ 以上/ 特点/ ,/ 我们/ 并/ 不/ 直接/ 利用/ class/ (/ 珚/ Si/ 参考/ 判决/ 值/ ,/ 进而/ 对/ 被/ 监测/ 用户/ 的/ 行为/ 作出/ 判决/ ./ 在/ 对/ 每个/ shell/ 命令/ 短/ 序列/ 流/ 珔/ Si/ 进行/ 模式匹配/ 与/ 挖掘/ 之后/ ,/ 可/ 对/ 相应/ 的/ 序列/ (/ class/ (/ 珚/ Siclass/ (/ 珚/ Si/ 式/ 中/ ,/ e/ 为/ 窗/ 长度/ ,/ Di/ (/ j/ )/ 表示/ shell/ 命令/ 短/ 序列/ 珚/ Si/ 应/ 的/ 判决/ 值/ ,/ 且/ e/ +/ l/ (/ i/ )/ -/ 1/ / j/ / r/ -/ ./ Di/ (/ j/ )/ 反映/ 了/ 以/ Page5j/ 为/ 终点/ 的/ e/ 个/ shell/ 命令/ 短/ 序列/ 中/ 正常/ 行为/ 模式/ 序列/ 的/ 比例/ ./ shell/ 命令/ 短/ 序列/ 流/ 珚/ Si/ =/ (/ 珚/ Si/ 珚/ Sir/ -/ )/ 中/ 第/ e/ +/ l/ (/ i/ )/ -/ 1/ 个/ 短/ 序列/ 及其/ 后面/ 的/ 每个/ 短/ 序列/ 都/ 分别/ 对应/ 一个/ 判决/ 值/ ./ 对于/ W/ 个/ shell/ 命令/ 短/ 序列/ 流/ 珚/ S1/ ,/ 珚/ S2/ ,/ …/ ,/ 珚/ SW/ ,/ 我们/ 可以/ 并行计算/ 出/ 判决/ 值/ D1/ (/ j/ )/ ,/ D2/ (/ j/ )/ ,/ …/ ,/ DW/ (/ j/ )/ ,/ 其中/ j/ 的/ 增长/ 步长/ 为/ 1/ ./ (/ 5/ )/ 利用/ 判决/ 值/ 对/ 被/ 监测/ 用户/ 的/ 当前/ 行为/ 进行/ 判决/ ./ 在/ 利用/ 上述/ 判决/ 值/ 对/ 被/ 监测/ 用户/ 的/ 行为/ 进行/ 判决/ 时/ ,/ 有/ 以下/ 两种/ 方案/ 可/ 供选择/ :/ 第/ 1/ 种/ 判决/ 方案/ ./ 根据/ 合法/ 用户/ 的/ 行为/ 特点/ ,/ 在/ 判决/ 值/ D1/ (/ j/ )/ ,/ D2/ (/ j/ )/ ,/ …/ ,/ DW/ (/ j/ )/ 中/ 选取/ 一个/ Dk/ (/ j/ )/ 作为/ 最终/ 判决/ 值/ (/ 这里/ 1/ / k/ / W/ )/ ./ 对于/ 一次/ 以/ 珚/ R/ =/ (/ s/ -/ 1/ ,/ s/ -/ 2/ ,/ …/ ,/ s/ -/ r/ -/ )/ 为/ 审计/ 数据/ 的/ 检测/ 过程/ ,/ 当/ Dk/ (/ j/ )/ 中/ 的/ j/ 变化/ (/ 增大/ )/ 时/ ,/ k/ 是/ 固定/ 不变/ 的/ ./ 在/ 利用/ Dk/ (/ j/ )/ 进行/ 判决/ 时/ ,/ 首先/ 设定/ 一个/ 判决/ 门限/ a/ ./ 如果/ Dk/ (/ j/ )/ >/ a/ ,/ 将/ 被/ 监测/ 用户/ 的/ 当前/ 行为/ 判/ 为/ 正常/ 行为/ ;/ 如果/ Dk/ (/ j/ )/ / a/ ,/ 将/ 被/ 监测/ 用户/ 的/ 当前/ 行为/ 判/ 为/ 异常/ 行为/ (/ 这里/ ,/ 被/ 监测/ 用户/ 的/ “/ 当前/ 行为/ ”/ 是/ 相对/ 于/ 珚/ R/ =/ (/ s/ -/ 1/ ,/ s/ -/ 2/ ,/ …/ ,/ s/ -/ r/ -/ )/ 中/ shell/ 命令/ s/ -/ j/ 对应/ 的/ 时间/ 点/ 而言/ 的/ ,/ 它/ 是/ 指以/ s/ -/ j/ 为/ 终点/ 的/ e/ +/ l/ (/ k/ )/ -/ 1/ 个/ shell/ 命令/ 所/ 对应/ 的/ 行为/ ,/ 即/ s/ -/ j/ -/ e/ -/ l/ (/ k/ )/ +/ 2/ ,/ s/ -/ j/ -/ e/ -/ l/ (/ k/ )/ +/ 3/ ,/ …/ ,/ s/ -/ j/ 所/ 对应/ 的/ 行为/ )/ ./ 在/ 该/ 方案/ 中/ ,/ j/ / e/ +/ l/ (/ k/ )/ -/ 1/ ;/ 也就是说/ ,/ 被/ 监测/ 用户/ 执行/ 完第/ e/ +/ l/ (/ k/ )/ -/ 1/ 个/ shell/ 命令/ 后/ 才能/ 对/ 其/ 行为/ 做/ 第一次/ 判决/ ./ 第/ 2/ 种/ 判决/ 方案/ ./ 设定/ W/ 个/ 判决/ 门限/ a1/ ,/ a2/ ,/ …/ ,/ aW/ ,/ 在/ 并行计算/ 出/ 判决/ 值/ D1/ (/ j/ )/ ,/ D2/ (/ j/ )/ ,/ …/ ,/ DW/ (/ j/ )/ 之后/ ,/ 按照/ 以下/ 步骤/ 对/ 被/ 监测/ 用户/ 的/ 当前/ 行为/ 进行/ 判决/ ./ 1/ ./ 设定/ k/ ·/ ·/ =/ 1.2/ ./ 如果/ Dk/ (/ j/ )/ / ak/ ,/ 则/ 将/ 被/ 监测/ 用户/ 的/ 当前/ 行为/ 判/ 为/ 异常/ 行为/ ,/ 并/ 不再/ 执行/ 以下/ 步骤/ ./ 3/ ./ 如果/ k/ </ W/ ,/ 则/ k/ ·/ ·/ =/ k/ +/ 1/ (/ k/ 的/ 值/ 增加/ 1/ )/ ,/ 并/ 返回/ 执行/ 步/ 2/ ./ 如果/ k/ =/ W/ ,/ 则/ 执行/ 步/ 4.4/ ./ 如果/ Dk/ (/ j/ )/ / ak/ ,/ 则/ 将/ 被/ 监测/ 用户/ 的/ 当前/ 行为/ 判/ 为/ 异常/ 行为/ ;/ 否则/ ,/ 将/ 被/ 监测/ 用户/ 的/ 当前/ 行为/ 判/ 为/ 正常/ 行为/ ./ 在/ 第/ 2/ 种/ 判决/ 方案/ 中/ ,/ 如果/ 对于/ 1/ / k/ / W/ ,/ 存在/ 一个/ Dk/ (/ j/ )/ 小于/ 或/ 等于/ ak/ ,/ 则/ 将/ 被/ 监测/ 用户/ 的/ 当前/ 行为/ 判/ 为/ 异常/ 行为/ ;/ 如果/ 对于/ 1/ / k/ / W/ ,/ 所有/ 的/ Dk/ (/ j/ )/ 均/ 大于/ ak/ ,/ 则/ 将/ 监测/ 用户/ 的/ 当前/ 行为/ 判/ 为/ 正常/ 行为/ (/ 被/ 监测/ 用户/ 的/ “/ 当前/ 行为/ ”/ 是/ 相对/ 于/ 珚/ R/ =/ (/ s/ -/ 1/ ,/ s/ -/ 2/ ,/ …/ ,/ s/ -/ r/ -/ )/ 中/ shell/ 命令/ s/ -/ j/ 对应/ 的/ 时间/ 点/ 而言/ 的/ ,/ 它/ 是/ 指以/ s/ -/ j/ 为/ 终点/ 的/ 若干个/ shell/ 命令/ 所/ 对应/ 的/ 行为/ )/ ./ 在/ 该/ 方案/ 中/ ,/ j/ / e/ +/ l/ (/ W/ )/ -/ 1/ ./ j/ 的/ 值/ 每/ 增加/ 1/ ,/ 都/ 要/ 执行/ 以上/ 步骤/ 来/ 对/ 被/ 监测/ 用户/ 的/ 当前/ 行为/ 做/ 一次/ 判决/ ./ 对于/ 第/ 1/ 种/ 判决/ 方案/ ,/ 在/ 窗/ 长度/ 确定/ 的/ 情况/ 下/ ,/ 虚警/ 概率/ 和/ 检测/ 概率/ 不仅/ 受/ 判决/ 门限/ 的/ 影响/ ,/ 而且/ 还/ 取决于/ 最终/ 判决/ 值/ Dk/ (/ j/ )/ ,/ 如何/ 从/ W/ 个/ 参考/ 判决/ 值/ D1/ (/ j/ )/ ,/ D2/ (/ j/ )/ ,/ …/ ,/ DW/ (/ j/ )/ 中/ 选取/ 最佳/ 的/ 最终/ 判决/ 值/ Dk/ (/ j/ )/ 是/ 第/ 1/ 种/ 判决/ 方案/ 的/ 关键/ ./ 根据/ 现有/ 的/ 研究成果/ 和/ 我们/ 的/ 检测/ 实例/ 分析/ ,/ 对于/ 不同/ 的/ 合法/ 用户/ ,/ 由于/ 行为/ 特点/ 不尽相同/ ,/ 最佳/ 的/ 判决/ 值/ Dk/ (/ j/ )/ 往往/ 是/ 不同/ 的/ ,/ 而且/ ,/ 对于/ 同一/ 合法/ 用户/ ,/ 针对/ 不同/ 伪装/ 用户/ 异常/ 行为/ 的/ 最佳/ 判决/ 值/ Dk/ (/ j/ )/ 也/ 是/ 不同/ 的/ ,/ 所以/ ,/ 在/ 实际/ 应用/ 中不太/ 容易/ 确定/ 最佳/ 的/ Dk/ (/ j/ )/ ,/ 特别/ 是/ 在/ 对/ 伪装/ (/ 异常/ )/ 行为/ 先验/ 知识/ 缺少/ 了解/ 的/ 情况/ 下/ ./ 相比之下/ ,/ 第/ 2/ 种/ 判决/ 方案/ 对/ 不同/ 合法/ 用户/ 和/ 不同/ 伪装/ (/ 异常/ )/ 行为/ 具有/ 较强/ 的/ 适应性/ ,/ 多/ 模式/ 并行/ 挖掘/ 和/ 多/ 门限/ 联合/ 判决/ 保证/ 了/ 在/ 用户/ 行为/ 复杂多变/ 的/ 情况/ 下/ 也/ 能够/ 获得/ 很/ 高/ 的/ 检测/ 准确率/ ,/ 其/ 代价/ 是/ 一定/ 程度/ 上/ 增加/ 了/ 检测/ 阶段/ 的/ 计算成本/ ./ 5/ 参数/ 确定/ 与/ 特点/ 分析/ 对于/ 检测/ 阶段/ 的/ 两种/ 判决/ 方案/ ,/ 如何/ 选择/ 判决/ 门限/ 是/ 实际/ 应用/ 中/ 的/ 关键问题/ ./ 我们/ 可/ 参照/ 文献/ [/ 7/ ]/ 中/ 交叉/ 验证/ 的/ 方法/ 来/ 确定/ 第/ 1/ 种/ 判决/ 方案/ 中/ 的/ 判决/ 门限/ a/ ,/ 将/ 获得/ 的/ 正常/ 行为/ 训练/ 数据/ 反复/ 交叉/ 地/ 按/ 固定/ 比例/ 分成/ 两/ 部分/ ,/ 一部分/ 用于/ 训练/ ,/ 另/ 一部分/ 用于/ 测试/ 虚警/ 概率/ 和/ 判决/ 门限/ ,/ 在/ 测试/ 中/ 通过/ 调整/ 判决/ 门限/ 来/ 得到/ 不同/ 虚警/ 概率/ 与/ 不同/ 判决/ 门限/ 的/ 对应/ 关系/ ,/ 并/ 将/ 期望/ 虚警/ 概率/ 所/ 对应/ 的/ 判决/ 门限/ 作为/ 实际/ 检测/ 时/ 的/ 门限/ ./ 第/ 2/ 种/ 判决/ 方案/ 中/ 的/ 各个/ 判决/ 门限/ a1/ ,/ a2/ ,/ …/ ,/ aW/ 的/ 选择/ 相对/ 复杂/ ,/ 可/ 基于/ 第/ 1/ 种/ 判决/ 方案/ 中/ 交叉/ 验证/ 的/ 方法/ 并/ 通过/ 等量/ 迭代/ 逼近/ 的/ 方式/ 确定/ ./ 具体步骤/ 如下/ :/ 4/ ./ 设定/ i/ ·/ ·/ =/ 1/ ./ 对于/ 1/ / k/ / W/ ,/ 令/ ak/ (/ i/ )/ =/ p/ (/ k/ )/ ./ 5/ ./ 设定/ 判决/ 门限/ 的/ 增量/ b/ ./ 6/ ./ i/ ·/ ·/ =/ i/ +/ 1/ ./ 对于/ 1/ / k/ / W/ ,/ 令/ ak/ (/ i/ )/ =/ p/ (/ k/ )/ +/ b/ ./ 1/ ./ 设定/ k/ ·/ ·/ =/ 1/ ,/ 并/ 设定/ 期望/ 虚警/ 概率/ 的/ 上限/ q/ ./ 2/ ./ 使用/ Dk/ (/ j/ )/ 作为/ 第/ 1/ 种/ 判决/ 方案/ 的/ 最终/ 判决/ 值/ ,/ 并令/ q/ (/ k/ )/ =/ q/ // W/ (/ 这里/ q/ (/ k/ )/ 表示/ Dk/ (/ j/ )/ 作为/ 最终/ 判决/ 值时/ 此种/ 判决/ 方案/ 所/ 容忍/ 的/ 最大/ 虚警/ 概率/ )/ ,/ 然后/ 利用/ 获得/ 的/ 训练/ 数据/ 通过/ 交叉/ 验证/ 的/ 方法/ 来/ 得到/ 第/ 1/ 种/ 判决/ 方案/ 下/ 期望/ 虚警/ 概率/ q/ (/ k/ )/ 所/ 对应/ 的/ 判决/ 门限/ p/ (/ k/ )/ ./ 3/ ./ k/ ·/ ·/ =/ k/ +/ 1/ (/ k/ 的/ 值/ 增加/ 1/ )/ ./ 如果/ k/ / W/ ,/ 返回/ 执行/ 步/ 2/ ./ 如果/ k/ >/ W/ ,/ 执行/ 步/ 4/ ./ Page67/ ./ 将/ a1/ (/ i/ )/ ,/ a2/ (/ i/ )/ ,/ …/ ,/ aW/ (/ i/ )/ 作为/ 第/ 2/ 种/ 判决/ 方案/ 中/ 的/ W/ 个/ 判决/ 门限/ (/ 其中/ ak/ (/ i/ )/ 与/ Dk/ (/ j/ )/ 相对/ 应/ )/ ,/ 然后/ 利用/ 训练/ 数据/ 通过/ 交叉/ 验证/ 的/ 方法/ 测试/ 第/ 2/ 种/ 判决/ 方案/ 的/ 虚警/ 概率/ u/ (/ i/ )/ ./ 8/ ./ 如果/ u/ (/ i/ )/ >/ q/ ,/ 则/ 对于/ 1/ / k/ / W/ ,/ 令/ ak/ =/ ak/ (/ i/ -/ 1/ )/ ./ 如果/ u/ (/ i/ )/ =/ q/ ,/ 则/ 对于/ 1/ / k/ / W/ ,/ 令/ ak/ =/ ak/ (/ i/ )/ ./ 如果/ u/ (/ i/ )/ </ q/ ,/ 则/ 返回/ 执行/ 步/ 6/ ./ 基于/ 以上/ 方法/ 确定/ 两种/ 判决/ 方案/ 的/ 判决/ 门限/ ,/ 我们/ 可以/ 对虚警/ 概率/ 进行/ 控制/ (/ 训练/ 数据/ 越/ 充分/ ,/ 对虚警/ 概率/ 的/ 控制/ 就/ 越/ 精确/ )/ ,/ 而/ 实际/ 检测/ 中/ 对/ 伪装/ (/ 异常/ )/ 行为/ 的/ 检测/ 概率/ 则/ 受/ 多种/ 因素/ 影响/ ./ 此外/ ,/ 窗/ 长度/ e/ 也/ 是/ 一个/ 重要/ 参数/ ,/ e/ 越大/ ,/ 检测/ 准确率/ 往往/ 越高/ ,/ 但/ 判决/ 延迟/ 也/ 越/ 大/ ;/ 根据/ 实例/ 分析/ 和/ 同类/ 检测/ 方法/ 的/ 实验/ 结论/ ,/ 一般/ 将/ e/ 控制/ 在/ 50/ ~/ 150/ 之间/ 为宜/ ./ 需要/ 指出/ ,/ 在/ 实时/ 检测/ (/ 在线/ 检测/ )/ 的/ 情况/ 下/ ,/ 检测/ 阶段/ 中/ 被/ 监测/ 用户/ 所/ 执行/ 的/ shell/ 命令/ 的/ 获取/ 和/ 预处理/ 、/ shell/ 命令/ 短/ 序列/ 流/ 的/ 生成/ 、/ 行为/ 模式匹配/ 与/ 挖掘/ 、/ 判决/ 值/ 的/ 计算/ 以及/ 对/ 用户/ 行为/ 的/ 判决/ 都/ 是/ 同步进行/ 的/ ./ 当/ 获得/ 审计/ 数据/ 珚/ R/ =/ (/ s/ -/ 1/ ,/ s/ -/ 2/ ,/ …/ ,/ s/ -/ r/ -/ )/ 中/ 的/ 第/ j/ 个/ shell/ 命令/ s/ -/ j/ 之后/ ,/ 就/ 可以/ 生成/ 以/ s/ -/ j/ 为/ 终点/ 的/ 长度/ 分别/ 为/ l/ (/ 1/ )/ ,/ l/ (/ 2/ )/ ,/ …/ ,/ l/ (/ W/ )/ 的/ W/ 个/ shell/ 命令/ 短/ 序列/ 珚/ S1/ 配/ ,/ 计算/ 出/ 判决/ 值/ D1/ (/ j/ )/ ,/ D2/ (/ j/ )/ ,/ …/ ,/ DW/ (/ j/ )/ ,/ 进而/ 对/ 被/ 监测/ 用户/ 的/ 当前/ 行为/ 做/ 一次/ 判决/ ./ 6/ 实验设计/ 与/ 结果/ 分析/ 作者/ 利用/ 普度/ 大学/ 和/ AT&T/ Shannon/ 实验室/ 的/ 两组/ shell/ 命令/ 实验/ 数据/ 分别/ 对/ 以上/ 方法/ 的/ 性能/ 进行/ 了/ 实验/ ./ 普度/ 大学/ 的/ 数据/ 包含/ 8/ 个/ Unix/ 用户/ 在/ 两年/ 时间/ 内/ 的/ 活动/ 记录/ (/ 实验/ 数据/ 的/ 详细/ 说明/ 见/ 文献/ [/ 9/ ]/ 或/ 文献/ [/ 2/ ]/ )/ ./ 实验/ 中/ 采用/ 了/ 其中/ 的/ 4/ 个/ 用户/ user1/ 、/ user2/ 、/ user3/ 、/ user4/ 的/ 数据/ ,/ 并且/ 将/ user1/ 、/ user2/ 、/ user3/ 设为/ 伪装/ 用户/ ,/ 将/ user4/ 设为/ 合法/ 用户/ ./ 每个/ 用户/ 的/ shell/ 命令/ 流中/ 各有/ 15000/ 个/ 命令/ ,/ user4/ 的/ 前/ 10000/ 个/ 命令/ 作为/ 训练/ 数据/ 用于/ 正常/ 行为/ 建模/ ,/ 而/ 每个/ 用户/ 的/ 后/ 5000/ 个/ 命令/ 作为/ 测试数据/ 用于/ 性能/ 测试/ ./ 实验/ 的/ 参数设置/ 为/ W/ =/ 3/ ,/ C/ =/ {/ 1/ ,/ 2/ ,/ 3/ }/ ,/ minsup/ (/ 1/ )/ =/ minsup/ (/ 2/ )/ =/ minsup/ (/ 3/ )/ =/ 0.0002/ ,/ 窗/ 长度/ e/ =/ 151/ ./ 在/ 采用/ 第/ 1/ 种/ 判决/ 方案/ 时/ ,/ 使用/ D3/ (/ j/ )/ 作为/ 最终/ 判决/ 值/ ,/ 判决/ 门限/ a/ =/ 0.5/ ./ 在/ 采用/ 第/ 2/ 种/ 判决/ 方案/ 时/ ,/ 3/ 个/ 判决/ 门限/ 分别/ 为/ a1/ =/ 0.86/ ,/ a2/ =/ 0.64/ ,/ a3/ =/ 0.48/ ./ 为了/ 方便/ 与/ 同类/ 方法/ 进行/ 检测/ 准确度/ 的/ 比较/ ,/ 实验/ 中将/ 上述/ 两种/ 判决/ 方案/ 的/ 期望/ 虚警/ 概率/ 分别/ 设定/ 为/ 0.06/ %/ 和/ 0/ %/ ,/ 在/ 此基础/ 上/ 确定/ 相应/ 的/ 判决/ 门限/ ,/ 然后/ 根据/ 判决/ 值/ 分别/ 计算/ 两种/ 判决/ 方案/ 的/ 检测/ 概率/ ./ 在/ AT&T/ Shannon/ 实验室/ 的/ shell/ 命令/ 实验/ 数据/ 中/ (/ 该/ 数据/ 的/ 详细/ 说明/ 见/ 文献/ [/ 5/ ]/ 或/ 文献/ [/ 7/ ]/ )/ ,/ 我们/ 选择/ 前/ 4/ 个/ 用户/ user1/ 、/ user2/ 、/ user3/ 、/ user4/ 的/ 数据/ 进行/ 实验/ ,/ 每个/ 用户/ 有/ 5000/ 个/ shell/ 命令/ ,/ 实验/ 时/ 将/ 其中/ user4/ 设为/ 合法/ 用户/ ,/ 该/ 用户/ 的/ 前/ 4000/ 个/ 命令/ 作为/ 训练/ 数据/ 用于/ 正常/ 行为/ 建模/ ,/ 后/ 1000/ 个/ 命令/ 作为/ 测试数据/ 用于/ 测试/ 虚警/ 概率/ ;/ 其他/ 3/ 个/ 用户/ 设/ 为/ 伪装/ 用户/ ,/ 其中/ 每个/ 用户/ 的/ 5000/ 个/ shell/ 命令/ 均/ 作为/ 测试数据/ 用于/ 测试/ 检测/ 概率/ ./ 实验/ 的/ 参数设置/ 为/ W/ =/ 3/ ,/ C/ =/ {/ 1/ ,/ 2/ ,/ 3/ }/ ,/ minsup/ (/ 1/ )/ =/ minsup/ (/ 2/ )/ =/ minsup/ (/ 3/ )/ =/ 0.0005/ ,/ 窗/ 长度/ e/ =/ 100/ ./ 在/ 采用/ 第/ 1/ 种/ 判决/ 方案/ 时/ ,/ 使用/ D3/ (/ j/ )/ 作为/ 最终/ 判决/ 值/ ,/ 判决/ 门限/ a/ =/ 0.35/ ./ 在/ 采用/ 第/ 2/ 种/ 判决/ 方案/ 时/ ,/ 3/ 个/ 判决/ 门限/ 分别/ 为/ a1/ =/ 0.62/ ,/ a2/ =/ 0.37/ ,/ a3/ =/ 0.34/ ./ 图/ 1/ 给出/ 了/ 采用/ 普度/ 大学/ 数据/ 进行/ 实验/ 时/ 判决/ 值/ D3/ (/ j/ )/ 的/ 曲线/ ,/ 图中/ 上方/ 的/ 细/ 实线/ 为/ 合法/ 用户/ user4/ 对应/ 的/ 曲线/ ,/ 下方/ 的/ 两条/ 虚线/ 和/ 粗/ 实线/ 分别/ 是/ 伪装/ 用户/ user1/ 、/ user2/ 、/ user3/ 对应/ 的/ 曲线/ ./ 图/ 2/ 给出/ 了/ 采用/ AT&T/ Shannon/ 实验室/ 数据/ 进行/ 实验/ 时/ 判决/ 值/ D3/ (/ j/ )/ 的/ 曲线/ ./ 可以/ 看出/ ,/ 两个/ 图中/ 合法/ 用户/ 对应/ 的/ 判决/ 值/ 曲线/ 同/ 伪装/ 用户/ 对应/ 的/ 判决/ 值/ 曲线/ 具有/ 良好/ 的/ 可分性/ ./ 在/ 图/ 1/ 中/ ,/ 合法/ 用户/ user4/ 对应/ 的/ 判决/ 值/ 全部/ 大于/ 0.48/ ,/ 而/ 伪装/ 用户/ user3/ 对应/ 的/ 判决/ 值/ 全部/ 小于/ 0.57/ ,/ 只有/ user1/ 、/ user2/ 对应/ 的/ 少量/ 判决/ 值/ 在/ 0.57/ 之上/ ./ 在/ 图/ 2/ 中/ ,/ 合法/ 用户/ user4/ 的/ 判决/ 值/ 曲线/ 能够/ 同/ 伪装/ 用户/ user2/ 、/ user3/ 的/ 判决/ 值/ 曲线/ 很/ 好/ 地区/ 分开/ 来/ (/ 仅/ 有/ 很/ 少量/ 的/ 判决/ 值/ 出现/ 交叠/ )/ ,/ 但同/ user1/ 判决/ 值/ 曲线/ 的/ 可分性/ 稍差/ 一些/ ,/ 说明/ 两者/ 的/ 某些/ 行为/ 具有/ 较/ 高/ 的/ 相似/ 度/ ./ Page7/ 图/ 2/ AT&T/ Shannon/ 实验室/ 数据/ 对应/ 的/ 判决/ 值/ 曲线/ 同时/ ,/ 作者/ 还/ 利用/ 以上/ 两组/ shell/ 命令/ 实验/ 数据/ 分别/ 对/ 文献/ [/ 4/ ]/ 中/ 基于/ 支撑/ 向量/ 机/ 的/ 检测/ 方法/ 、/ 文献/ [/ 9/ ]/ 中/ 基于/ 机器/ 学习/ 的/ 检测/ 方法/ 以及/ 文献/ [/ 2/ ]/ 中/ 基于/ 齐次/ Markov/ 链/ 模型/ 的/ 检测/ 方法/ 进行/ 了/ 实验/ ,/ 并/ 同/ 本文/ 的/ 方法/ 在/ 检测/ 准确率/ 和/ 计算成本/ 两个/ 方面/ 进行/ 了/ 对比/ ./ 表/ 1/ 给出/ 了/ 利用/ 普度/ 大学/ shell/ 命令/ 数据/ 所/ 做/ 实验/ 的/ 结果/ ./ 本文/ 第/ 1/ 种/ 判决/ 方案/ 的/ 实验/ 结果/ 0.0680/ ./ 53587/ 本文/ 第/ 2/ 种/ 判决/ 方案/ 的/ 实验/ 结果/ 083.02711/ 文献/ [/ 4/ ]/ 中/ 检测/ 方法/ 的/ 实验/ 结果/ 0.1674/ ./ 08510/ 文献/ [/ 9/ ]/ 中/ 检测/ 方法/ 的/ 实验/ 结果/ 0.5275/ ./ 813146/ 文献/ [/ 2/ ]/ 中/ 检测/ 方法/ 的/ 实验/ 结果/ 0.3375/ ./ 93465/ 表/ 2/ 给出/ 了/ 利用/ AT&T/ Shannon/ 实验室/ shell/ 命令/ 数据/ 所/ 做/ 实验/ 的/ 结果/ ./ 表/ 2ATTShannon/ 实验室/ 数据/ 对应/ 的/ 实验/ 结果/ 本文/ 第/ 1/ 种/ 判决/ 方案/ 的/ 实验/ 结果/ 0.0485/ ./ 26135/ 本文/ 第/ 2/ 种/ 判决/ 方案/ 的/ 实验/ 结果/ 084.91173/ 文献/ [/ 4/ ]/ 中/ 检测/ 方法/ 的/ 实验/ 结果/ 0.3280/ ./ 87120/ 文献/ [/ 9/ ]/ 中/ 检测/ 方法/ 的/ 实验/ 结果/ 083.60934/ 文献/ [/ 2/ ]/ 中/ 检测/ 方法/ 的/ 实验/ 结果/ 0.1981/ ./ 92108/ 根据/ 表/ 1/ 和表/ 2/ 的/ 实验/ 结果/ ,/ 本文/ 所/ 提出/ 方法/ 的/ 检测/ 准确率/ 明显/ 高于/ 文献/ [/ 2/ ,/ 4/ ,/ 9/ ]/ 中/ 的/ 检测/ 方法/ ,/ 而/ 第/ 2/ 种/ 判决/ 方案/ 的/ 检测/ 结果/ 又/ 优于/ 第/ 1/ 种/ 判决/ 方案/ ./ 表中/ 的/ 实验/ 时间/ 是/ 指/ 实验/ 中/ 进行/ 训练/ (/ 正常/ 行为/ 建模/ )/ 和/ 检测/ 所/ 需要/ 的/ 时间/ ,/ 该/ 指标/ 与/ 检测/ 方法/ 的/ 计算成本/ 成正比/ ,/ 并/ 在/ 一定/ 程度/ 上/ 反映/ 了/ 检测/ 的/ 实时性/ ./ 由/ 实验/ 结果/ 可见/ ,/ 采用/ 第/ 2/ 种/ 判决/ 方案/ 时/ 本文/ 方法/ 的/ 计算成本/ 略高于/ 文献/ [/ 2/ ,/ 4/ ]/ 中/ 的/ 检测/ 方法/ ,/ 但远/ 低于/ 文献/ [/ 9/ ]/ 中/ 的/ 检测/ 方法/ ./ 可见/ ,/ 本文/ 中/ 检测/ 方法/ 的/ 综合性/ 能/ 优于/ 文献/ [/ 2/ ,/ 4/ ,/ 9/ ]/ 中/ 的/ 检测/ 方法/ ./ 此外/ ,/ 我们/ 还/ 利用/ 普度/ 大学/ 和/ AT&T/ Shannon/ 实验室/ 两组/ 数据/ 中/ 不同/ 用户/ 的/ shell/ 命令/ 数据/ 进行/ 了/ 反复/ 交叉/ 实验/ ,/ 实验/ 结果表明/ ,/ 当/ 采用/ 第/ 1/ 种/ 判决/ 方案/ 时/ ,/ 最佳/ 的/ 判决/ 值/ Dk/ (/ j/ )/ 是/ 与/ 具体/ 用户/ 相关/ 的/ ,/ 因此/ 实际/ 检测/ 中/ 用于/ 行为/ 判决/ 的/ 最佳/ Dk/ (/ j/ )/ 主要/ 基于/ 已有/ 的/ 训练/ 数据/ 并/ 通过/ 预先/ 实验/ 来/ 确定/ ;/ 而/ 第/ 2/ 种/ 判决/ 方案/ 对/ 不同/ 用户/ 具有/ 更好/ 的/ 适应性/ ,/ 总体/ 上/ 也/ 有/ 更/ 高/ 的/ 检测/ 性能/ ./ 为了/ 进一步/ 验证/ 第/ 2/ 种/ 判决/ 方案/ 的/ 检测/ 准确率/ ,/ 我们/ 在/ 上述/ 实验/ 的/ 基础/ 上/ 对/ 判决/ 门限/ 进行/ 了/ 调整/ ,/ 得到/ 不同/ 虚警/ 概率/ 条件/ 下/ 的/ 检测/ 概率/ ./ 图/ 3/ 给出/ 了/ 采用/ 普度/ 大学/ 数据/ 进行/ 实验/ 时/ 反映/ 虚警/ 概率/ 与/ 检测/ 概率/ 对应/ 关系/ 的/ ROC/ 曲线/ ,/ 图/ 4/ 给出/ 了/ 采用/ AT&T/ Shannon/ 实验室/ 数据/ 进行/ 实验/ 时/ 的/ ROC/ 曲线/ ./ 从/ 两组/ 实验/ 数据/ 对应/ 的/ ROC/ 曲线/ 可以/ 看出/ ,/ 相对/ 于/ 文献/ [/ 2/ ,/ 4/ ,/ 9/ ]/ 中/ 的/ 检测/ 方法/ ,/ 本文/ 方法/ 中/ 第/ 2/ 种/ 判决/ 方案/ 的/ 检测/ 准确率/ 具有/ 明显/ 的/ 优势/ ./ 图/ 4/ AT&T/ Shannon/ 实验室/ 数据/ 对应/ 的/ ROC/ 曲线/ 7/ 结束语/ 目前/ 的/ 伪装/ 攻击/ 检测/ 方法/ 存在/ 的/ 主要/ 问题/ 是/ 对/ 用户/ 行为/ 变化/ 缺乏/ 适应性/ ,/ 检测/ 性能/ 的/ 稳定性/ 和容/ Page8/ 错/ 能力/ 不够/ 强/ ,/ 检测/ 准确度/ 也/ 有待/ 提高/ ./ 本文/ 提出/ 一种/ 新/ 的/ 基于/ shell/ 命令/ 和/ 多重/ 行为/ 模式/ 挖掘/ 的/ 伪装/ 攻击/ 检测/ 方法/ ,/ 该/ 方法/ 基于/ 实际/ 检测/ 系统/ 的/ 实例/ 分析/ 和/ 已有/ 研究成果/ ,/ 充分考虑/ 了/ 审计/ 数据/ 和/ 用户/ 行为/ 的/ 特点/ ,/ 改进/ 了/ 用户/ 行为/ 模式/ 和/ 行为/ 轮廓/ 的/ 表示/ 方式/ ,/ 提出/ 了/ 基于/ 多重/ 行为/ 模式/ 并行/ 挖掘/ 和/ 多/ 门限/ 联合/ 判决/ 的/ 检测/ 模型/ ,/ 在/ 不/ 明显增加/ 计算成本/ 的/ 条件/ 下/ 大幅度提高/ 了/ 检测/ 准确度/ ,/ 并且/ 增强/ 了/ 检测/ 性能/ 的/ 稳定性/ 和/ 对/ 用户/ 行为/ 变化/ 的/ 适应性/ ./ 需要/ 指出/ ,/ 在/ 该/ 方法/ 的/ 实际/ 应用/ 中/ ,/ 通过/ 优化/ 行为/ 模式/ 序列/ 的/ 表示/ 及/ 存储/ 方式/ ,/ 还/ 可以/ 进一步提高/ 其/ 检测/ 效率/ ./ 

