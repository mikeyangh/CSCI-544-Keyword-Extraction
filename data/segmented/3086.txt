Page1/ 乐观/ 策略/ 下/ 并行/ 离散/ 事件/ 仿真/ 动态/ 负载/ 划分/ 优化/ 算法/ 张颖星/ 姚益平/ (/ 国防科学技术大学/ 计算机/ 学院/ 长沙/ 410073/ )/ 摘要/ 动态/ 负载/ 划分/ 是/ 提高/ 并行/ 离散/ 事件/ 仿真/ 运行/ 性能/ 的/ 有效途径/ 之一/ ./ 现有/ 研究/ 往往/ 孤立/ 地/ 考虑/ 计算/ 负载平衡/ 和/ 通信/ 负载/ 优化/ ,/ 使得/ 复杂/ 应用/ 背景/ 下/ 整体/ 性能/ 低下/ ./ 论文/ 综合/ 考虑/ 仿真/ 模型/ 计算/ 负载/ 和/ 交互/ 模式/ ,/ 提出/ 了/ 一个/ 基于/ 带/ 权重/ 无向/ 图/ 有限/ 容量/ k/ 划分/ 问题/ 的/ 并行/ 离散/ 事件/ 仿真/ 负载/ 划分/ 模型/ ,/ 并/ 配合/ 一套/ 通用/ 的/ 仿真/ 运行/ 性能/ 度量/ 方法/ ,/ 提出/ 了/ 一个/ 基于/ 顶点/ 交换/ 的/ 启发式/ 局部/ 搜索/ 近似/ 划分算法/ ,/ 实现/ 了/ 在/ 计算/ 负载平衡/ 的/ 前提/ 下/ 系统/ 通信/ 负载/ 最优化/ ,/ 其/ 近似/ 解与/ 全局/ 最优/ 解/ 比值/ 不/ 小于/ (/ 1/ -/ 1/ // |/ N/ |/ )/ (/ 1/ -/ ε/ )/ ./ 实验/ 证明/ 了/ 该/ 动态/ 负载/ 划分算法/ 的/ 有效性/ 和/ 实用性/ ./ 关键词/ 负载/ 划分/ ;/ 局部/ 搜索算法/ ;/ 并行/ 离散/ 事件/ 仿真/ ;/ 乐观/ 同步/ 策略/ 1/ 引言/ 负载/ 划分/ (/ partitioning/ )/ 和/ 时间/ 同步/ (/ synchro/ -/ nization/ )/ 是/ 决定/ 并行/ 离散/ 事件/ 仿真/ (/ PDES/ )/ 性能/ 的/ 最/ 重要/ 的/ 两个/ 因素/ [/ 1/ ]/ ./ 由于/ 早期/ 仿真/ 应用/ 规模/ 有限/ ,/ 运行/ 状态/ 相对/ 稳定/ ,/ 动态/ 划分/ 对/ 性能/ 的/ 提升/ 并/ 不/ 明显/ ,/ 此外/ ,/ 由于/ 很多/ 仿真/ 平台/ 对/ 迁移/ 机制/ 支持/ 不足/ ,/ 动态/ 划分/ 的/ 额外/ 开销/ 较大/ ,/ 使得/ 对/ 并行/ 离散/ 事件/ 仿真/ 负载/ 划分/ 的/ 研究/ 长期/ 局限于/ 基于/ 模型/ 行为/ 预测/ 的/ Page2/ 静态/ 负载/ 划分/ [/ 2/ -/ 4/ ]/ ./ 然而/ ,/ 随着/ 仿真/ 模型/ 越来越/ 复杂/ ,/ 特别/ 是/ 一些/ 研究者/ 提出/ 将/ 并行/ 离散/ 事件/ 仿真/ 支撑/ 技术/ 与/ Agent/ 建模/ 技术相结合/ 以/ 支持/ 复杂/ 系统/ 的/ 研究/ [/ 5/ -/ 6/ ]/ ,/ 系统/ 负载/ 往往/ 具有/ 显著/ 的/ 动态性/ ,/ 传统/ 的/ 静态/ 划分/ 技术/ 已/ 难以/ 保证/ 仿真/ 的/ 整体/ 运行/ 效率/ ;/ 同时/ 大量/ 支持/ 高效/ 迁移/ 机制/ 的/ 并行/ 离散/ 事件/ 仿真/ 平台/ 的/ 出现/ 也/ 为/ 动态/ 负载/ 划分/ 提供/ 了/ 底层/ 支持/ [/ 7/ -/ 9/ ]/ ,/ 因此/ ,/ 动态/ 负载/ 划分/ 近年来/ 越来越/ 受到/ 并行/ 离散/ 事件/ 仿真/ 研究者/ 的/ 关注/ ./ 动态/ 负载/ 划分/ 的/ 关键问题/ 是/ 仿真/ 运行/ 性能/ 度量/ 和/ 负载/ 迁移/ 策略/ ./ 早期/ 的/ 动态/ 负载/ 划分算法/ 主要/ 考虑/ 计算/ 负载平衡/ 因素/ 以/ 减少/ 各/ 计算/ 节点/ 间/ 本地/ 仿真/ 时间/ 推进/ 的/ 差异/ ,/ 但/ 随着/ 高性价比/ 的/ 集群/ 系统/ 已/ 逐渐/ 成为/ 大规模/ 并行/ 离散/ 事件/ 仿真/ 的/ 主流/ 硬件平台/ ,/ 通信/ 负载/ 对/ 性能/ 的/ 影响/ 越来越/ 显著/ ,/ 如何/ 在/ 计算/ 负载平衡/ 的/ 前提/ 下/ 根据/ 模型/ 交互/ 模式/ 优化/ 通信/ 负载/ 已/ 成为/ 目前/ 动态/ 负载/ 划分/ 研究/ 的/ 热点/ ./ 本文/ 综合/ 考虑/ 仿真/ 模型/ 计算/ 和/ 通信/ 负载/ ,/ 将/ 并行/ 离散/ 事件/ 仿真/ 的/ 动态/ 负载/ 划分/ 归结为/ 一个/ 带/ 权重/ 无向/ 图/ 的/ 有限/ 容量/ k/ 划分/ 问题/ ,/ 首先/ 通过/ 模型/ 计算/ 负载/ 和/ 节点/ 计算能力/ 确定/ 各个/ 划分/ 集合/ 的/ 容量/ ,/ 然后/ 采用/ 基于/ 顶点/ 交换/ 启发式/ 的/ 局部/ 搜索/ 近似/ 划分算法/ ,/ 根据/ 模型/ 交互/ 模式/ 对/ 负载/ 划分/ 进行/ 优化/ ,/ 使得/ 在/ 计算/ 负载平衡/ 的/ 前提/ 下/ 通信/ 负载/ 最优化/ ./ 本文/ 第/ 2/ 节/ 介绍/ 并行/ 离散/ 事件/ 仿真/ 领域/ 近期/ 动态/ 负载/ 划分/ 的/ 相关/ 研究/ ;/ 第/ 3/ 节/ 给出/ 动态/ 负载/ 划分/ 的/ 形式化/ 描述/ ;/ 第/ 4/ 节/ 详述/ 本文/ 的/ 负载/ 划分/ 优化/ 算法/ ;/ 第/ 5/ 节/ 给出/ 测试方法/ 和/ 实验/ 结果/ ;/ 最后/ 总结/ 全文/ ./ 2/ 相关/ 研究/ 早期/ 的/ 并行/ 离散/ 事件/ 动态/ 划分算法/ 往往/ 只/ 考虑/ 计算/ 负载平衡/ ./ Reiher/ 和/ Jefferson/ [/ 10/ ]/ 提出/ 的/ 方法/ 是/ 以/ 处理器/ 利用率/ 来/ 评估/ 仿真/ 运行/ 状态/ ,/ 周期性/ 查找/ 过载/ 和/ 欠载/ 的/ 计算/ 节点/ ,/ 若/ 两者/ 间/ 计算/ 负载/ 差距/ 大于/ 规定/ 的/ 阈值/ ,/ 则/ 通过/ 迁移/ 进行/ 负载平衡/ ;/ Glazer/ 和/ Tropper/ [/ 11/ ]/ 提出/ 的/ 算法/ 思想/ 与/ 前者/ 类似/ ,/ 但/ 进一步/ 提出/ simuationadvancerate/ 的/ 概念/ 来/ 评估/ 运行/ 状态/ ,/ 同时/ 采用/ heuristicbinpackingalgorithm/ 进行/ 负载/ 划分/ ,/ 获得/ 了/ 更好/ 的/ 效果/ ;/ Carothers/ 和/ Fujimoto/ [/ 12/ ]/ 也/ 提出/ 一种/ 基于/ 平台/ 信息/ 的/ 动态/ 划分算法/ ,/ 获得/ 了/ 不错/ 的/ 性能/ 提升/ ./ 这些/ 算法/ 的/ 主要/ 问题/ 在于/ 没有/ 考虑/ 仿真/ 模型/ 通信/ 负载/ ,/ 在/ 仿真/ 模型/ 计算/ 负载/ 较为/ 稳定/ 而/ 交互/ 关系/ 动态性/ 较强/ 的/ 仿真/ 应用/ 中/ 加速/ 效果/ 较差/ ;/ 同时/ ,/ 部分/ 算法/ 对/ 仿真/ 运行/ 性能/ 评估/ 需要/ 底层/ 操作系统/ 或/ 特定/ 仿真/ 平台/ 的/ 支持/ ,/ 限制/ 了/ 其/ 应用/ 范围/ ./ Wilson/ 和/ Shen/ 在/ 文献/ [/ 13/ ]/ 中/ 提出/ 一种/ 分段/ 动态/ 划分算法/ ,/ 首先/ 由/ 一个/ 中央/ 节点/ 收集/ 系统/ 运行/ 信息/ 并/ 确定/ 各/ 计算/ 节点/ 的/ 迁移/ 量/ ,/ 然后/ 各/ 节点/ 根据/ 不同/ 的/ 策略/ 来/ 决定/ 具体/ 迁移/ 哪个/ 逻辑/ 进程/ ,/ 而/ 通信/ 负载/ 优化/ 策略/ 是/ 其中/ 的/ 一个/ 选项/ ./ 该/ 算法/ 引入/ 了/ 通信/ 负载/ 优化/ 的/ 思想/ ,/ 但/ 由于/ 在/ 不同/ 策略/ 中/ 分别/ 孤立/ 地/ 考虑/ 计算/ 负载平衡/ 或/ 通信/ 负载/ 优化/ ,/ 使得/ 在/ 复杂/ 应用/ 背景/ 下/ 两者/ 相互影响/ ,/ 产生/ 大量/ 额外/ 开销/ ,/ 整体/ 性能/ 下降/ ./ Slavik/ 等/ 人/ [/ 14/ ]/ 提出/ 的/ 动态/ 划分算法/ 也/ 存在/ 类似/ 的/ 问题/ ,/ 该/ 算法/ 提出/ 了/ 通过/ 带/ 权重/ 的/ 无/ 向/ 图/ 对/ 通信/ 负载/ 进行/ 优化/ 的/ 思想/ ,/ 但/ 没有/ 考虑/ 计算/ 负载平衡/ 的/ 影响/ ,/ 同时/ 该/ 算法/ 提出/ 的/ 仿真/ 运行/ 性能/ 度量/ 方法/ 也/ 难以/ 应用/ 于/ 实际/ 系统/ ./ Low/ 在/ 文献/ [/ 15/ ]/ 中/ 提出/ 了/ 一个/ 综合/ 考虑/ 计算/ 负载平衡/ 和/ 交互/ 模式/ 优化/ 的/ 模型/ ,/ 获得/ 了/ 不错/ 的/ 效果/ ,/ 但/ 该/ 算法/ 主要/ 针对/ BSP/ -/ TW/ 乐观/ 同步/ 协议/ ,/ 限制/ 了/ 其/ 应用/ 范围/ ./ Peschlow/ 等/ 人/ 在/ 文献/ [/ 16/ ]/ 中/ 提出/ 一种/ 柔性/ 的/ 动态/ 负载/ 划分算法/ ,/ 该/ 算法/ 综合/ 考虑/ 了/ 计算/ 负载平衡/ 和/ 通信/ 负载/ 优化/ 问题/ ,/ 设计/ 了/ 一套/ 通用/ 的/ 并行/ 离散/ 事件/ 仿真/ 运行/ 性能/ 度量/ 方法/ ,/ 但/ 由于/ 采用/ 的/ 迁移/ 算法/ 无法/ 保证/ 收敛/ ,/ 在/ 部分/ 情况/ 下会/ 产生/ 迁移/ 振荡/ ./ 综上所述/ ,/ 尽管/ 近年来/ 对/ 基于/ 模型/ 间/ 交互/ 模式/ 的/ 动态/ 负载/ 划分/ 技术/ 研究/ 发展/ 较/ 快/ ,/ 但/ 目前/ 还/ 没有/ 一个/ 完善/ 的/ 适用/ 于/ 多种/ 乐观/ 同步/ 协议/ 且/ 综合/ 考虑/ 负载平衡/ 和/ 通信/ 模式/ 的/ 并行/ 离散/ 事件/ 仿真/ 动态/ 负载/ 划分算法/ ./ 3/ 问题/ 模型/ 我们/ 的/ 问题/ 模型/ 描述/ 是/ 基于/ 通用/ 的/ 并行/ 离散/ 事件/ 仿真/ “/ 消息/ -/ 事件/ ”/ 范型/ :/ 系统/ 由/ 一组/ 逻辑/ 进程/ LogicProcess/ (/ LP/ )/ 组成/ ,/ LP/ 之间/ 通过/ 相互/ 调度/ 事件/ 进行/ 交互/ ,/ 每个/ LP/ 通过/ 处理/ 一系列/ 事件/ 来/ 推进/ 仿真/ 时间/ ,/ 在/ 仿真/ 过程/ 中/ 事件/ 的/ 处理/ 会/ 改变/ LP/ 的/ 内部/ 状态/ ,/ 同时/ 输出/ 新/ 的/ 事件/ [/ 1/ ]/ ./ LP/ 是/ 负载/ 划分/ 的/ 基本/ 单位/ ,/ 可以/ 自由/ 地/ 分配/ 到/ 各个/ 计算/ 节点/ 上/ 运行/ ./ 每个/ 计算/ 节点/ 通过/ 一个/ 节点/ 控制器/ (/ hostcontrol/ -/ ler/ )/ 来/ 管理/ 在/ 该/ 节点/ 上/ 运行/ 的/ LP/ ,/ 共用/ 一个/ 事件/ 调度/ 队列/ ,/ 按/ 事件/ 时/ 戳/ 的/ 非/ 递减/ 顺序/ 执行/ ,/ 以/ 保证/ 全局/ 因果/ 序/ 约束/ (/ globalcausalityconstraint/ )/ ./ 负载/ 划分/ 的/ 基本/ 任务/ 即将/ LP/ 合理/ 地/ 分配/ 到/ 各个/ 计算/ 节点/ 上以/ 获得/ 最高/ 的/ 系统/ 运行/ 效率/ ,/ 为/ 达到/ 该/ 目的/ 需要/ 综合/ 考虑/ 系统/ 计算/ 负载平衡/ 和/ 通信/ 负载/ Page3/ 优化/ 两/ 方面/ 的/ 因素/ :/ 计算/ 负载平衡/ 的/ 主要/ 任务/ 是/ 保证/ LP/ 划分/ 集/ 的/ 事件处理/ 计算/ 负载/ 与/ 对应/ 计算/ 节点/ 计算/ 容量/ 相匹配/ ,/ 以/ 减少/ 由/ 各/ 计算/ 节点/ 局部/ 仿真/ 时间/ (/ LVT/ )/ 推进/ 的/ 差异/ 而/ 引起/ 的/ 同步/ 等待/ 和/ 回滚/ 开销/ [/ 1/ ]/ ;/ 通信/ 负载/ 优化/ 的/ 主要/ 任务/ 是/ 根据/ LP/ 事件/ 调度/ 依赖/ 关系/ 将/ 交互/ 频繁/ 的/ LP/ 分配/ 到/ 同一/ 计算/ 节点/ 上/ ,/ 以/ 减少/ 由/ 远程/ 事件/ 调度/ 而/ 引起/ 的/ 回滚/ 开销/ [/ 14/ ,/ 16/ ]/ ./ 基于/ 上述/ “/ 消息/ -/ 事件/ ”/ 范型/ ,/ 并行/ 离散/ 时间/ 仿真/ 负载/ 划分/ 模型/ 形式化/ 描述/ 如下/ :/ 设/ L/ 表示/ 逻辑/ 进程/ 集合/ ,/ E/ 表示/ 逻辑/ 进程/ 间/ 事件/ 调度/ 关系/ ,/ 首先/ 以/ 仿真/ 系统/ 中/ 所有/ LP/ 为/ 顶点/ ,/ 构造/ 一个/ 全/ 连通/ 的/ 无/ 向/ 图/ G/ (/ L/ ,/ E/ )/ ./ 定义/ 边/ 权重/ w/ :/ L/ ×/ L/ →/ R/ 表示/ 单位/ 仿真/ 时间/ 内/ 任意/ 两个/ LP/ 间/ 相互/ 调度/ 事件/ 数/ ;/ 边/ 权重/ w/ (/ l1/ ,/ l2/ )/ =/ 0/ 表示/ l1/ 和/ l2/ 之间/ 没有/ 交互/ ./ 定义/ 点/ 权重/ c/ :/ L/ →/ R/ 表示/ 一个/ 逻辑/ 进程/ 的/ 计算/ 负载/ ./ 设/ N/ 表示/ 硬件平台/ 计算/ 节点/ 的/ 集合/ ,/ U/ :/ N/ →/ R/ 表示/ 计算/ 节点/ 的/ 计算/ 容量/ ,/ 则/ 负载/ 划分/ 问题/ 可以/ 表示/ 为/ :/ 从/ 无/ 向/ 图/ 中/ 选出/ 一个/ 边/ 集合/ S/ / E/ ,/ 使得/ G/ (/ L/ ,/ E/ -/ S/ )/ 分成/ |/ N/ |/ 个/ 互不/ 联通/ 的/ 子/ 图/ (/ 记/ 为/ {/ G1/ ,/ G2/ ,/ …/ ,/ G/ |/ N/ |/ }/ )/ ,/ 且/ 存在/ 一个/ 映射/ δ/ :/ Gn/ →/ N/ 满足/ / δ/ (/ Gn/ )/ ∈/ N/ :/ ∑/ l/ ∈/ Gnc/ (/ l/ )/ / U/ (/ δ/ (/ Gn/ )/ )/ ;/ 负载/ 划分/ 优化/ 问题/ 即/ 找到/ 满足/ Min/ ∑/ e/ ∈/ Sc/ (/ e/ )/ 的/ 边/ 集合/ S/ ,/ 对应/ 映射/ δ/ :/ Gn/ →/ N/ 即/ 负载/ 划分/ 结果/ ./ 该/ 问题/ 是/ 一个/ NP/ 问题/ [/ 17/ ]/ ,/ 本文/ 假设/ 系统/ 中/ 逻辑/ 进程/ 计算/ 负载/ 符合/ 泊松/ 分布/ ,/ 则/ 我们/ 首先/ 根据/ 各个/ 计算/ 节点/ 的/ 容量/ 和/ 各个/ LP/ 的/ 计算/ 负载/ ,/ 在/ 满足/ 系统/ 计算/ 负载/ 均衡/ 的/ 条件/ 下/ 确定/ 划分/ 集合/ 容量/ ,/ 然后/ 给出/ 一个/ 基于/ 顶点/ 交换/ 的/ 启发式/ 局部/ 搜索/ 近似/ 划分算法/ ,/ 其/ 近似/ 解与/ 全局/ 最优/ 解/ 的/ 比值/ 不/ 超过/ (/ 1/ -/ 1/ // |/ N/ |/ )/ (/ 1/ -/ ε/ )/ ./ 4/ 动态/ 划分算法/ 根据上述/ 基本/ 问题/ 模型/ 描述/ ,/ 我们/ 的/ 算法/ 主要/ 包含/ 以下/ 几个/ 部分/ :/ (/ 1/ )/ 初始化/ 仿真/ 系统/ ,/ 根据/ 系统/ 基本/ 信息/ 将/ LP/ 划分/ 到/ 各个/ 计算/ 节点/ 上/ ;/ (/ 2/ )/ 通过/ 各/ 计算/ 节点/ 上/ 的/ 仿真/ 控制器/ 对/ 运行/ 信息/ 进行/ 采样/ ;/ (/ 3/ )/ 设置/ 一个/ 独立/ 的/ 控制/ 节点/ 周期性/ 收集/ 系统/ 的/ 运行/ 信息/ ,/ 从/ 计算/ 负载/ 和/ 通信/ 负载/ 两/ 方面/ 评估/ 系统/ 运行/ 状态/ ,/ 在/ 必要/ 的/ 情况/ 下/ 发出/ 迁移/ 指令/ ,/ 调整/ 各/ 计算/ 节点/ 上/ LP/ 分布/ ./ 基本/ 算法/ 框架/ 如下/ ./ Initialpartitioning/ ;/ whileGVT/ </ SimEndTimedo/ {/ Collectperformanceinformationfromhost/ ;/ CalculatecomputationworkloadimbalanceWB/ ;/ CalculatecommunicationworkloadimbalanceCB/ ;/ if/ (/ WB/ >/ MaxLoadDiff/ )/ callbalance/ _/ computation/ (/ )/ else/ {/ if/ (/ MoveIndicatorisnotempty/ )/ StartLPmovements/ ;/ SetTheNextMeasurementTime/ ;/ }/ 4.1/ 初始化/ 负载/ 划分/ 初始化/ 工作/ 的/ 主要/ 目标/ 是/ 通过/ 静态/ 负载平衡/ 的/ 方法/ 获得/ 一个/ 可行/ 的/ LP/ 初始/ 分布/ ,/ 该/ 分布/ 是/ 后续/ 动态/ 划分算法/ 的/ 基础/ :/ 一个/ 良好/ 的/ 初始/ 分布/ 能/ 有效/ 减少/ 动态/ 迁移/ 所/ 带来/ 的/ 开销/ ./ 由于/ 仿真/ 系统/ 的/ 事件/ 调度/ 依赖/ 关系/ 在/ 运行/ 前/ 一般/ 难以/ 完全/ 确定/ ,/ 所以/ 负载/ 划分/ 的/ 初始化/ 工作/ 主要/ 考虑/ LP/ 计算/ 负载/ 与/ 计算/ 节点/ 容量/ 的/ 匹配/ ./ 计算/ 节点/ 的/ 计算/ 容量/ 可以/ 通过/ 参考/ 处理器/ 时钟/ 频率/ 、/ 内存大小/ 等/ 因素/ 直接/ 设置/ 权重/ 得到/ ,/ 也/ 可以/ 通过/ 运行/ 测试程序/ 来/ 获得/ 更/ 精确/ 的/ 初始/ 计算/ 容量/ 参数/ Icap/ (/ i/ )/ :/ N/ →/ R/ ;/ 得到/ 所有/ 计算/ 节点/ 基本参数/ 后/ ,/ 计算/ dIcap/ (/ i/ )/ =/ Icap/ (/ i/ )/ 初始/ 计算/ 容量/ ,/ 其中/ ∑/ i/ ∈/ N/ 根据/ LP/ 的/ 计算/ 负载/ 设置/ 不同/ 的/ 初始/ 权重/ ILoad/ (/ l/ )/ :/ L/ →/ R/ ,/ 默认/ 权重/ 为/ 1/ ,/ 然后/ 同样/ 计算/ dILoad/ (/ l/ )/ =/ ILoad/ (/ l/ )/ ILoad/ (/ l/ )/ 规范/ 表示/ 某个/ LP/ 计算/ 负载/ ,/ 其中/ ∑/ l/ ∈/ L/ ∑/ l/ ∈/ LdILoad/ (/ l/ )/ =/ 1/ ./ 最后/ 根据/ dIcap/ (/ i/ )/ 和/ dILoad/ (/ l/ )/ 进行/ 初始/ 负载/ 划分/ :/ InitialPatitioningInput/ :/ theLPcollectionL/ ;/ thenodecollectionN/ ;/ theLPworkloaddILoad/ (/ l/ )/ ;/ thecapacityofnodedIcap/ (/ i/ )/ ;/ Output/ :/ InitialPartition/ (/ i/ )/ :/ N/ →/ L/ ,/ L/ / Lfor/ (/ i/ ∈/ N/ )/ {/ letPartitionSet/ (/ i/ )/ betheLPcollectionwhichdistributedtonodeiletSumLoad/ (/ i/ )/ =/ ∑/ l/ ∈/ PartitionSet/ (/ i/ )/ While/ (/ SumLoad/ (/ i/ )/ </ dIcap/ (/ i/ )/ )/ {/ findl/ ∈/ LsatisfiedSumLoad/ (/ i/ )/ +/ dILoad/ (/ l/ )/ </ =/ Page4if/ (/ exitsuchLPl/ )/ {/ PartitionSet/ (/ i/ )/ ·/ ·/ =/ PartitionSet/ (/ i/ )/ ∪/ lSumLoad/ (/ i/ )/ =/ SumLoad/ (/ i/ )/ +/ dILoad/ (/ l/ )/ RemovelfromL/ }/ elsebreak/ ;/ }/ }/ if/ (/ L/ ≠/ / )/ assigntherestLPtotheNequallyInitialPartition/ (/ i/ )/ =/ PartitionSet/ (/ i/ )/ 4.2/ 运行/ 信息/ 采样/ 与/ 评估/ 跟踪/ 系统/ 运行/ 信息/ 并/ 对系统/ 状态/ 进行/ 评估/ 是/ 动态/ 划分算法/ 的/ 基础/ ,/ 为了/ 准确/ 地/ 了解/ 整体/ 系统/ 的/ 运行/ 状态/ ,/ 需要/ 对/ 以下/ 3/ 个/ 因素/ 进行/ 采样/ 和/ 评估/ :/ 计算/ 节点/ 的/ 计算/ 容量/ cap/ (/ i/ )/ 、/ LP/ 计算/ 负载/ LPload/ (/ l/ )/ 和/ LP/ 的/ 通信/ 负载/ LPcomm/ (/ l/ )/ ./ 计算/ 容量/ 表示/ 计算/ 节点/ 在/ 运行/ 仿真/ 时能/ 提供/ 的/ 处理/ 能力/ ,/ 容量/ 越大/ 的/ 计算/ 节点/ 能/ 在/ 单位/ 时间/ 内/ 进行/ 的/ 计算/ 越多/ ./ 计算/ 节点/ 的/ 基本/ 容量/ 由该/ 节点/ 的/ 处理器/ 、/ 内存/ 等/ 硬件/ 配置/ 决定/ ,/ 但/ 在/ 仿真/ 运行/ 过程/ 中/ ,/ 节点/ 的/ 计算/ 容量/ 会/ 因为/ 背景/ 负载/ 而/ 改变/ ,/ 因此/ 需要/ 在/ 运行/ 时/ 对/ 节点/ 计算/ 容量/ 进行/ 采样/ 和/ 评估/ ./ 计算/ 节点/ 在/ 采样/ 时段/ 内/ 处理/ 并/ 提交/ 的/ 事件/ 总数/ 是/ 衡量/ 节点/ 计算/ 容量/ 的/ 一个/ 重要/ 指标/ [/ 10/ -/ 11/ ]/ ,/ 但/ 在/ 乐观/ 策略/ 下回/ 滚会/ 导致/ 部分/ 实际/ 处理/ 了/ 的/ 事件/ 无法/ 被/ 统计/ ,/ 此外/ ,/ 在/ 一些/ 受限/ 乐观/ 同步/ 算法/ 中/ (/ 如/ BTB/ 、/ BSP/ )/ ,/ 计算/ 节点/ 也/ 会/ 由于/ 全局/ 同步/ 而/ 产生/ 空转/ 等待/ ,/ 因此/ ,/ 单纯/ 对/ 处理/ 并/ 提交/ 事件/ 总数/ 进行/ 采用/ 和/ 评估/ 无法/ 准确/ 地/ 反映/ 节点/ 计算/ 容量/ ,/ 需要/ 考虑/ 回滚/ 和/ 空转/ 因素/ 的/ 影响/ ./ 与/ 文献/ [/ 16/ ,/ 19/ ]/ 的/ 思想/ 类似/ ,/ 我们/ 设/ 处理事件/ 总数/ NodeEvent/ (/ i/ )/ :/ N/ →/ R/ 表示/ 在/ 采样/ 时段/ 内/ 提交/ 事件/ 和/ 回滚/ 事件/ 之/ 和/ ,/ 实际/ 处理/ 时间/ NodeWorkTime/ (/ i/ )/ :/ N/ →/ walltime/ 表示/ 采样/ 区间/ 时/ 长/ 减去/ 空转/ 等待时间/ ,/ 则/ 定义/ 节点/ i/ 的/ 动态/ 计算/ 容量/ 为/ 并行/ 离散/ 事件/ 仿真/ 中/ ,/ 单个/ LP/ 的/ 计算/ 负载/ 是/ 通过/ 处理/ 该/ LP/ 上/ 的/ 事件/ 而/ 产生/ 的/ ,/ 因此/ 计算/ 在/ 采样/ 时段/ 内该/ LP/ 上/ 处理/ 的/ 事件/ 数是/ 衡量/ 计算/ 负载/ 的/ 重要/ 指标/ ./ 考虑/ 到/ 采样/ 时段/ 内该/ LP/ 上/ 处理/ 的/ 事件/ 数/ 实际/ 会受/ 节点/ 计算能力/ 的/ 影响/ ,/ 分布/ 到/ 计算能力/ 强/ 的/ 节点/ 上/ 的/ LP/ 可能/ 处理/ 更/ 多/ 的/ 事件/ ,/ 所以/ 对/ LP/ 计算/ 负载/ 的/ 评估/ 必须/ 去除/ 节点/ 计算能力/ 的/ 影响/ ./ 我们/ 采用/ 计算/ LP/ 推进/ 单位/ 虚拟/ 时钟/ 所/ 产生/ 的/ 事件/ 数来/ 表示/ LP/ 的/ 计算/ 负载/ ,/ 设/ LPEvent/ (/ l/ )/ :/ L/ →/ R/ 表示/ 在/ 采样/ 时段/ 内/ 逻辑/ 进程/ l/ 上/ 处理/ 的/ 事件/ 数/ ,/ LVTAdvance/ :/ N/ →/ virtualtime/ 表示/ 在/ 采样/ 时段/ 内/ 逻辑/ 进程/ l/ 所在/ 计算/ 节点/ 推进/ 的/ 局部/ 仿真/ 时钟/ ,/ 则/ 定义/ 逻辑/ 进程/ l/ 的/ 计算/ 负载/ 为/ 在/ 乐观/ 策略/ 下/ ,/ LPEvent/ (/ l/ )/ 和/ LVTAdvance/ 的/ 采样/ 都/ 会/ 受到/ 回滚/ 的/ 影响/ ,/ 为/ 解决/ 该/ 问题/ ,/ 我们/ 借鉴/ 了/ Schlagenhaft/ 等/ 在/ 文献/ [/ 20/ ]/ 中/ 提出/ 的/ 方法/ ,/ 对/ 采样/ 时段/ 内/ 的/ l/ 上/ 处理/ 的/ 所有/ 事件/ 记数/ ,/ 并/ 在/ 计算/ 虚拟/ 时钟/ 推进/ 时/ 对/ 回滚/ 部分/ 进行/ 补偿/ ./ 单个/ LP/ 的/ 通信/ 负载/ 表示/ 该/ LP/ 调度/ 其他/ LP/ 上/ 事件/ 的/ 情况/ ,/ 对/ LP/ 通信/ 负载/ 的/ 评估/ 同样/ 要/ 去除/ 节点/ 计算能力/ 的/ 影响/ ,/ 设/ LPCommEvent/ (/ l1/ ,/ l2/ )/ :/ L/ ×/ L/ →/ R/ 表示/ 逻辑/ 进程/ l1/ 在/ 采样/ 时段/ 内/ 调度/ 逻辑/ 进程/ 上/ l2/ 的/ 事件/ 数/ ,/ LVTAdvance/ :/ N/ →/ virtualtime/ 表示/ 在/ 采样/ 时段/ 内/ 逻辑/ 进程/ l1/ 所在/ 计算/ 节点/ 推进/ 的/ 局部/ 仿真/ 时钟/ ,/ 则/ 定义/ 逻辑/ 进程/ l1/ 的/ 对/ 逻辑/ 进程/ l2/ 的/ 通信/ 负载/ 为/ LPcomm/ (/ l1/ ,/ l2/ )/ =/ LPCommEvent/ (/ l1/ ,/ l2/ )/ 仿真/ 平台/ 中/ 各/ 节点/ 上/ 仿真/ 控制器/ 负责/ 该/ 节点/ 上/ LP/ 的/ 事件/ 调度/ 处理/ 和/ 消息/ 转发/ ,/ 因此/ ,/ 以上/ 运行/ 信息/ 可/ 方便/ 地/ 由/ 各个/ 计算/ 节点/ 上/ 仿真/ 控制器/ 进行/ 采样/ ./ 获取/ 相关/ 数据/ 后/ ,/ 动态/ 负载平衡/ 算法/ 则/ 对/ 整体/ 运行状况/ 进行/ 评估/ ./ 计算/ dcap/ (/ i/ )/ =/ cap/ (/ i/ )/ 的/ 计算/ 容量/ ,/ 其中/ ∑/ i/ ∈/ NLPLoad/ (/ l/ )/ LPLoad/ (/ l/ )/ 规范/ 表示/ 某个/ LP/ 计算/ 负载/ ,/ 其中/ ∑/ l/ ∈/ L/ ∑/ l/ ∈/ LdLPLoad/ (/ l/ )/ =/ 1/ ;/ 设/ PartitionSet/ (/ i/ )/ :/ N/ →/ L/ 表示/ 划分/ 到/ 节点/ i/ 上/ 的/ LP/ 集合/ ,/ 计算/ NodeLoad/ (/ i/ )/ =/ ∑/ l/ ∈/ PartitionSet/ (/ i/ )/ dLPLoad/ (/ l/ )/ 表示/ 计算/ 节点/ i/ 上/ 的/ 计算/ 负载/ ,/ 则/ 计算/ 负载/ 均衡/ 评估/ 函数/ WB/ 可以/ 表示/ 为/ WB/ =/ MAX/ (/ |/ NodeLoad/ (/ i/ )/ -/ dcap/ (/ i/ )/ |/ )/ ,/ / i/ ∈/ N/ ,/ 如果/ WB/ >/ MaxLoadDiff/ 则/ 表示/ 当前/ LP/ 分布/ 产生/ 计算/ 负载/ 不/ 平衡/ ,/ 需要/ 进行/ 计算/ 负载平衡/ ./ 当/ l1/ ∈/ PartitionSet/ (/ i/ )/ ∧/ l2/ ∈/ PartitionSet/ (/ i/ )/ 时/ 表示/ l1/ ,/ l2/ 分布/ 在/ 同一/ 计算/ 节点/ 上时/ ,/ LPcomm/ (/ l1/ ,/ l2/ )/ 表示/ 本地/ 事件/ 调度/ 通信/ 负载/ ;/ 否则/ ,/ LPcomm/ (/ l1/ ,/ l2/ )/ Page5/ 表示/ 远程/ 事件/ 调度/ 通信/ 负载/ ./ 计算/ NodeLocalComm/ (/ i/ )/ =/ PartitionSet/ (/ j/ )/ j/ =/ i/ +/ 1/ 表示/ 节点/ i/ 上/ LP/ 本地/ 通信/ 负载/ 之/ 和/ ,/ 则/ 可/ 得到/ 系统/ 本地/ 通信/ 负载/ 之/ 和/ Wl/ =/ ∑/ N/ 计算/ NodeComm/ (/ i/ ,/ j/ )/ =/ ∑/ l1/ ∈/ PartitionSet/ (/ i/ )/ ∧/ l2/ ∈/ 表示/ 计算/ 节点/ i/ 和/ j/ 间/ 的/ LP/ 通信/ 负载/ 总量/ ,/ 则/ 进一步/ 可以/ 得到/ 系统/ 远程/ 通信/ 负载/ 之/ 和/ Wr/ =/ ∑/ Ni/ =/ 1/ ∑/ N/ 可以/ 表示/ 为/ CB/ =/ Wr/ 则/ 当前/ LP/ 分布/ 产生/ 通信/ 负载/ 不/ 平衡/ ,/ 需要/ 进行/ 通信/ 负载平衡/ ./ 4.3/ 计算/ 负载平衡/ 算法/ 计算/ 负载平衡/ 的/ 基本/ 目标/ 是/ 计算/ 节点/ 容量/ 与/ 分布/ 到/ 该/ 节点/ 上/ 的/ LP/ 计算/ 负载/ 的/ 匹配/ 以/ 减少/ 由/ 各/ 计算/ 节点/ 局部/ 仿真/ 时间/ (/ LVT/ )/ 推进/ 的/ 差异/ 而/ 引起/ 的/ 额外/ 开销/ ,/ 一个/ 计算/ 负载平衡/ 的/ LP/ 划分/ 是/ 进行/ 后续/ 通信/ 负载/ 优化/ 算法/ 的/ 基础/ ./ 算法/ 的/ 基本/ 思想/ 是/ 在/ 计算/ 负载/ 出现/ 不/ 平衡/ 时/ ,/ 首先/ 找到/ 系统/ 中/ 计算/ 负载/ 最重/ 的/ 节点/ 和/ 计算/ 负载/ 最轻/ 的/ 节点/ :/ 设/ Pmax/ 表示/ 计算/ 负载/ 最重/ 的/ 节点/ ,/ 则/ Pmax/ 满足条件/ :/ / i/ ∈/ N/ ,/ NodeLoad/ (/ Pmax/ )/ -/ dcap/ (/ Pmax/ )/ / 设/ Pmin/ 表示/ 计算/ 负载/ 最轻/ 的/ 节点/ ,/ 则/ Pmin/ / i/ ∈/ N/ ,/ NodeLoad/ (/ Pmin/ )/ -/ dcap/ (/ Pmin/ )/ / 将/ Pmax/ 上/ 的/ 部分/ LP/ 迁移/ 到/ Pmin/ 上/ ,/ 更新/ 节点/ 负载/ 信息/ 后/ 重新/ 评估/ 计算/ 负载/ 是否/ 平衡/ ;/ 如/ 仍然/ 存在/ 计算/ 负载/ 不/ 平衡/ ,/ 则/ 重复/ 上述/ 步骤/ 直到/ 计算/ 负载平衡/ ;/ 最后/ 将/ 整体/ 迁移/ 的/ 最终/ 结果/ 存入/ 迁移/ 列表/ ./ 则/ 优先选择/ 计算/ 负载/ 较大/ 的/ LP/ ,/ 具体/ 算法/ 如下/ :/ 在/ 选择/ 迁移/ 的/ LP/ 时/ ,/ 为/ 减少/ LP/ 的/ 迁移/ 数量/ ,/ 满足条件/ :/ balance/ _/ computationInput/ :/ LPcollectionwhichdistributedtonodeitheLPworkloaddLPLoad/ (/ l/ )/ thecapacityofnodedcap/ (/ i/ )/ Output/ :/ migratingLPcollectionMoveIndicatorwhile/ (/ WB/ >/ MaxLoadDiff/ )/ do/ {/ letPmaxbethenodewiththemaxcomputationletPminbethenodewiththemincomputationSumMoveLoad/ =/ 0/ ;/ if/ (/ TempMoveLPSet/ ∩/ MoveIndicator/ ≠/ / )/ STOP/ ;/ }/ 4.4/ 通信/ 负载/ 优化/ 算法/ 在/ 完成/ 计算/ 负载平衡/ 迁移/ 后/ ,/ 我们/ 得到/ 一个/ 原始/ 的/ LP/ 划分/ ,/ 如该/ 划分/ 产生/ 通信/ 负载/ 不/ 平衡/ ,/ 则/ 根据/ 系统/ 事件/ 调度/ 依赖/ 关系/ 对/ 负载/ 划分/ 进行/ 优化/ ,/ 减少/ 由/ 远程/ 事件/ 调度/ 而/ 引起/ 的/ 回滚/ 和/ 空转/ 开销/ ./ 根据/ 第/ 3/ 节/ 所述/ 的/ 基本/ 问题/ 模型/ ,/ 构造/ 一个/ 全/ 连通/ 的/ 无/ 向/ 图/ G/ (/ L/ ,/ E/ )/ ;/ 采用/ 4.2/ 节/ 所述/ 的/ 运行/ 信息/ 采样/ 信息/ 为/ 无/ 向/ 图/ 中边/ 赋/ 权重/ w/ :/ L/ ×/ L/ →/ R/ :/ / l1/ ,/ l2/ ∈/ L/ :/ w/ (/ l1/ ,/ l2/ )/ =/ LPcomm/ (/ l1/ ,/ l2/ )/ +/ LPcomm/ (/ l2/ ,/ l1/ )/ ,/ 记该/ 赋权/ 图为/ Gw/ (/ L/ ,/ E/ )/ ;/ 则/ 通信/ 负载/ 优化/ 的/ 目标/ 即/ 找到/ Gw/ (/ L/ ,/ E/ )/ 的/ 一个/ 图/ 划分/ ,/ 在/ 保证/ 各子/ 图/ 顶点/ 个数/ 符合/ 计算/ 负载平衡/ 迁移/ 结果/ 的/ 前提/ 下/ ,/ 使得/ 各子/ 图间/ 的/ 边/ 权重/ 和/ 最小/ ./ 设/ Cw/ =/ ∑/ w/ (/ l1/ ,/ l2/ )/ 表示/ 图/ Gw/ (/ L/ ,/ E/ )/ 中/ 所有/ 边/ 权重/ 的/ 总和/ ,/ 对/ 任意/ 一次/ 通信/ 负载/ 优化/ ,/ 该值/ 是/ 一个/ 常量/ ./ 构造/ 新/ 的/ 赋权/ 图/ Gw/ (/ L/ ,/ E/ )/ ,/ 其中/ 对边/ 赋/ 权重/ 珡/ w/ :/ L/ ×/ L/ →/ R/ :/ / l1/ ,/ l2/ ∈/ L/ :/ 珡/ w/ (/ l1/ ,/ l2/ )/ =/ Cw/ -/ w/ (/ l1/ ,/ l2/ )/ ,/ 则/ 上述/ 通信/ 负载/ 优化/ 问题/ 等价/ 于/ 找/ Gw/ (/ L/ ,/ E/ )/ 的/ 一个/ 图/ 划分/ ,/ 在/ 保证/ 各子/ 图/ 顶点/ 个数/ 符合/ 计算/ 负载平衡/ 迁移/ 结果/ 的/ 前提/ 下/ ,/ 使得/ 各子/ 图间/ 的/ 边/ 权重/ 和/ 最/ Page6/ 设/ 珡/ w/ (/ l1/ ,/ Ni/ )/ =/ ∑/ l2/ ∈/ Ni/ 逻辑/ 进程/ l1/ 对/ 节点/ Ni/ 上/ 所有/ 逻辑/ 进程/ 的/ 边/ 权重/ 和/ ,/ |/ Ni/ |/ 表示/ 分布/ 到/ 节点/ i/ 上/ LP/ 的/ 个数/ ,/ 则/ 具体/ 通信/ 负载平衡/ 算法/ 如下/ :/ 大/ ./ 该/ 问题/ 可/ 基于/ Gaur/ 等/ 人/ 在/ 文献/ [/ 21/ ]/ 中/ 提出/ 的/ 图/ 最大/ k/ 划分算法/ 获得/ 近似/ 解/ ./ balance/ _/ communicationInput/ :/ LPcollectionwhichdistributedtonodeiPartitionSet/ (/ i/ )/ edgeweight/ 珡/ w/ (/ l1/ ,/ l2/ )/ ofinteractiongraphGw/ (/ L/ ,/ E/ )/ Accuracy/ ε/ >/ 0Output/ :/ migratingLPcollectionMoveIndicatorleti/ =/ 0/ ;/ While/ (/ True/ )/ {/ letWir/ =/ ∑/ 珡/ w/ (/ l1/ ,/ l2/ )/ whilel1/ ,/ l2don/ ’/ tassigntothesamenodeqi/ =/ Wir/ ε/ do/ {/ seti/ =/ i/ +/ 1/ ;/ Wir/ =/ Wnew/ }/ 性质/ 1/ ./ 算法/ 收敛/ 且/ 最终/ 分布/ 与/ 全局/ 最优/ 解/ 比值/ 不/ 小于/ 1/ -/ 1/ 则/ 系统/ LP/ 最终/ 分布/ 满足/ 证明/ ./ 根据/ 通信/ 负载平衡/ 算法/ 迁移/ 判断/ 条件/ ,/ / l1/ ∈/ Ni/ ,/ l2/ ∈/ Nk/ |/ Ni/ |/ 珡/ w/ (/ l1/ ,/ Ni/ )/ +/ |/ Nk/ |/ 珡/ w/ (/ l2/ ,/ Nk/ )/ / (/ |/ Ni/ |/ 珡/ w/ (/ l1/ ,/ Nk/ )/ +/ |/ Nk/ |/ 珡/ w/ (/ l2/ ,/ Ni/ )/ )/ (/ 1/ )/ 则/ 对/ 所有/ l1/ ∈/ Ni/ 和/ l2/ ∈/ Nk/ 将/ 上述/ 不等式/ 相加/ 可以/ 得到/ |/ Nk/ |/ |/ Ni/ |/ ∑/ l1/ ∈/ Ni/ |/ Nk/ |/ |/ Ni/ |/ ∑/ l1/ ∈/ Ni/ 设/ 2/ 珡/ w/ (/ Ni/ )/ =/ ∑/ l1/ ∈/ Ni/ 则/ 不等式/ (/ 2/ )/ 可/ 变化/ 为/ 对系统/ 中/ 所有/ 节点/ 进行/ 求和/ 计算/ 可以/ 得到/ (/ |/ N/ |/ -/ 1/ )/ ∑/ N/ ∑/ Ni/ =/ 1/ ∑/ N/ 设/ Wl/ =/ ∑/ N/ 权重/ 和/ ,/ Wr/ =/ ∑/ N/ 子/ 图间/ 边/ 权重/ 和/ ,/ 则/ 可/ 得到/ k/ =/ 1/ ,/ k/ ≠/ i/ 设/ W/ 和/ q/ 表示/ 算法/ 中/ 外层/ 循环/ 运行/ Wir/ 和/ qi/ 的/ 最终/ 值/ ,/ 可得/ Wr/ / W/ // 2/ ,/ 则/ Wr/ =/ ∑/ N/ 即/ Wr/ / |/ N/ |/ (/ )/ -/ 1/ ε/ +/ 1/ 根据/ 不等式/ (/ 3/ )/ 可以/ 得到/ (/ |/ N/ |/ -/ 1/ )/ Wl/ / Wr/ / (/ |/ N/ |/ -/ 1/ )/ ε/ +/ 1/ 则/ Wl/ / Wl/ / ε/ (/ |/ N/ |/ -/ 1/ )/ +/ 1/ 全局/ 最优/ 解/ 表示/ 图/ Gw/ (/ L/ ,/ E/ )/ 划分/ 后子/ 图间/ 边/ 权重/ 和/ 的/ 最大值/ ,/ 设为/ Woptr/ ,/ 则/ Page7Woptr/ / Wr/ +/ Wl/ / Wr/ +/ ε/ (/ |/ N/ |/ -/ 1/ )/ +/ 1/ 所以/ WrWoptl/ 性质/ 2/ ./ 算法/ 具有/ 多项式/ 时间/ 复杂度/ ,/ 且/ 时间/ 复杂度/ 不/ 超过/ O/ (/ n4/ ε/ -/ 1logn/ )/ ./ 证明/ ./ 设/ n/ =/ |/ L/ |/ ,/ 因为/ 对边/ 权重/ 进行/ 了/ 取整/ 缩放/ 珡/ w/ (/ l/ ,/ N/ )/ =/ |/ 珡/ w/ (/ l/ ,/ N/ )/ // q/ |/ q/ ,/ 所以/ 内层/ while/ 循环/ 执行/ 时间/ 复杂度/ 是/ O/ (/ n/ (/ 1/ +/ ε/ )/ // ε/ )/ =/ O/ (/ n/ // ε/ )/ ./ 为/ 证明/ 外层/ while/ 循环/ 时间/ 复杂性/ ,/ 需要/ 首先/ 引入/ Radzik/ 等/ 人/ 在/ 文献/ [/ 22/ ]/ 中/ 证明/ 的/ 定理/ ./ 引理/ ./ 设/ 犱/ =/ (/ d1/ ,/ …/ ,/ dn/ )/ 表示/ 一个/ 向量/ ,/ 狔/ 1/ ,/ …/ ,/ 狔/ n/ 表示/ 一组/ {/ 0/ ,/ 1/ }/ n/ 向量/ ,/ 如果/ 对/ 所有/ i/ =/ 1/ ,/ …/ ,/ p/ -/ 1/ ,/ 都/ 满足/ 0/ / dyi/ +/ 1/ / 1/ // 2dyi/ ,/ 则/ p/ =/ O/ (/ nlogn/ )/ ./ 由于/ 每次/ 外层/ 循环/ Wi/ +/ 1r/ / 1/ 作是/ 所有/ 边/ 权重/ 与/ {/ 0/ ,/ 1/ }/ n/ 向量/ 的/ 内积/ ,/ 其中/ 远程/ 调度/ 边/ 对应/ 1/ ,/ 本地/ 调度/ 边/ 对应/ 0/ ,/ 所以/ 根据/ 引理/ 外层/ while/ 循环/ 时间/ 复杂性/ 不会/ 超过/ O/ (/ nlogn/ )/ ./ 又/ 因为/ 每次/ 搜索/ 符合条件/ 的/ 点/ 不/ 超过/ O/ (/ n/ (/ n/ -/ 1/ )/ // 2/ )/ =/ O/ (/ n2/ )/ ,/ 所以/ 算法/ 的/ 时间/ 复杂性/ 不/ 超过/ O/ (/ n4/ ε/ -/ 1logn/ )/ ./ 5/ 实验/ 分析/ 5.1/ 实验/ 环境/ 本文/ 实验/ 基于/ 并行/ 离散/ 事件/ 仿真/ 领域/ 经典/ 的/ PHOLD/ 测试/ 模型/ [/ 23/ ]/ ,/ 同时/ 修改/ 其/ 事件/ 调度/ 方式/ 以/ 表示/ 更/ 复杂/ 的/ 模型/ 交互/ 模式/ :/ 实验/ 仿真/ 系统/ 由/ 一系列/ 实体/ 构成/ ,/ 每个/ 实体/ 映射/ 到/ 相应/ LP/ 上/ ,/ 负责/ 处理/ 相关/ 事件/ ,/ 每个/ 事件/ 随机/ 做/ 若干次/ 加法/ 以/ 表示/ 不同/ 计算/ 负载/ ;/ 当/ 某个/ 实体/ 处理事件/ 时/ ,/ 该/ 实体/ 随机/ 调度/ 其他/ 实体/ 上/ 的/ 事件/ ,/ 设/ 被/ 处理事件/ 的/ 逻辑/ 时/ 戳/ 为/ t/ ,/ 则/ 随机/ 选取/ 区间/ [/ t/ +/ 1/ ,/ t/ +/ dmax/ ]/ 中/ 任意/ 时刻/ 作为/ 新/ 调度/ 事件/ 的/ 时/ 戳/ ;/ 同时/ ,/ 仿真/ 系统/ 中/ 所有/ 实体/ 分成/ 若干/ 不/ 相交/ 的/ 子集/ ,/ 某个/ 实体/ 调度/ 同组/ 实体/ 上/ 事件/ 的/ 概率/ 为/ Pgroup/ ,/ 调度/ 不同/ 组/ 实体/ 上/ 事件/ 的/ 概率/ 为/ 1/ -/ Pgroup/ ./ 实际/ 测试/ 过程/ 中/ ,/ 实体/ 总数/ 设为/ 1000/ 个/ ,/ 每个/ 实体/ 初始/ 事件/ 数为/ 2/ ,/ dmax/ =/ 10/ ,/ Pgroup/ =/ 0.8/ ,/ 整个/ 仿真/ 运行/ 的/ 逻辑/ 时间/ 为/ 20000/ ./ 实验/ 仿真/ 软件平台/ 为/ 国防科学技术大学/ 计算机/ 学院/ 研制/ 的/ YH/ -/ SUPE/ 并行/ 仿真/ 开发/ 及/ 运行/ 支撑/ 环境/ [/ 24/ ]/ ./ 实验/ 硬件/ 环境/ 配置/ 为/ 8/ 计算/ 节点/ 的/ 集群/ 系统/ ,/ 每个/ 计算/ 节点/ CPU/ 主频/ 3.0/ GHz/ ,/ 主存/ 1GB/ ,/ 操作系统/ 为/ 红帽/ Linux/ ./ 5.2/ 实验/ 结果/ 实验/ 主要/ 关注/ 两个/ 方面/ 的/ :/ 整体/ 仿真/ 性能/ 加速/ 比/ 和/ LP/ 迁移/ 收敛/ 情况/ ,/ 主要/ 对比/ 测试/ 对象/ 为/ 德国/ 波恩大学/ Peschlow/ 于/ 2007/ 年/ 发表/ 的/ DynPart/ 算法/ [/ 16/ ]/ ./ 基于/ 以上/ 改进/ 的/ PHOLD/ 测试/ 模型/ ,/ 本次/ 实验/ 中/ 我们/ 采用/ 3/ 种/ 交互/ 配置/ ,/ 分别/ 将/ 所有/ 实体/ 分为/ 50/ 组/ 、/ 25/ 组和/ 1/ 组/ ./ 由图/ 1/ 测试/ 结果/ 可以/ 看到/ DynPart/ 算法/ 在/ 模型/ 交互/ 模式/ 没有/ 明显/ 特征/ 的/ 情况/ 下/ (/ group1/ )/ 其/ 迁移/ 较为/ 盲目/ ,/ 一直/ 保持/ 较/ 高/ 的/ 额外/ 的/ 开销/ ;/ 而/ 在/ 交互/ 模式/ 特征/ 较为/ 明显/ 的/ 情况/ 下/ (/ 25/ 组/ ,/ 50/ 组/ )/ 算法/ 迁移/ 情况/ 收敛/ 较快/ ./ 本文/ ALSPart/ 算法/ 则/ 一直/ 保持/ 较/ 低/ 的/ 迁移开销/ ./ 图/ 2/ ~/ 图/ 4/ 分别/ 显示/ 了/ 在/ 时间/ 弯曲/ (/ TimeWarp/ )/ 、/ 呼吸/ 时间/ 桶/ (/ BreathingTimeBucket/ )/ 和/ 呼吸/ 时间/ 弯曲/ (/ BreathingTimeWarp/ )/ 3/ 种/ 乐观/ 同步/ 协议/ 下/ 仿真/ 运行/ 时间/ ;/ 图/ 5/ ~/ 图/ 7/ 分别/ 显示/ 了/ 相应/ 同步/ 协议/ 下/ 仿真/ 回滚/ 次数/ ./ 由/ 测试/ 结果/ 可以/ 看到/ 采用/ 本文/ ALSPart/ 算法/ 平均/ 减少/ 38.11/ %/ 的/ 回滚/ 次数/ ,/ 而且/ 整体/ 性能/ 较为/ 稳定/ ,/ 通过/ 优化/ 通信/ 负载/ 对/ 3/ 种/ 交互/ 配置/ 分别/ 可以/ 降低/ 13.64/ %/ 、/ 49.63/ %/ 和/ 51.05/ %/ 的/ 回滚/ 次数/ ,/ 同时/ 对/ 3/ 种/ 不同/ 的/ 同步/ 协议/ 则/ 分别/ 可以/ 减少/ 44.09/ %/ 、/ 29.65/ %/ 和/ 40.59/ %/ 的/ 回滚/ 次数/ ;/ 而/ DynPart/ 算法/ 性能/ 对/ 交互/ 配置/ 较为/ 敏感/ ,/ 特别/ 是/ 在/ 交互/ 配置/ 1/ 组/ 的/ 情况/ 下会/ 由于/ 不/ 适当/ 的/ 划分/ 而/ 产生/ 大量/ 额外/ 的/ 回滚/ ,/ 同时/ DynPart/ 在/ 呼吸/ 时间/ 桶/ 同步/ 协议/ 下/ 整体/ 性能/ 较差/ ,/ 此外/ ,/ 在/ 实际/ 测试/ 中/ ,/ DynPart/ 的/ 整体/ 性能/ 非常/ 依赖/ 对/ 其/ 运行/ 参数/ 的/ 配置/ ,/ 不/ 适合/ 的/ 参数/ 配置/ 将/ 导致/ 其/ 性能/ 进一步/ 下降/ ./ DynPart/ 的/ 优势/ 在于/ 在/ 模型/ 交互/ 模式/ 特征/ 较为/ 明显/ 的/ 情况/ 下/ (/ 25/ 组/ ,/ 50/ 组/ )/ 其/ 性能/ 较/ 好/ ./ 需要/ 说明/ 的/ 是/ 本次/ 实验/ 中/ 动态/ 负载/ 划分算法/ 对/ 运行/ 时间/ 的/ 加速/ 比/ Page8/ 图/ 4/ 呼吸/ 时间/ 弯曲/ 同步/ 协议/ 下/ 仿真/ 运行/ 时间/ 图/ 7/ 呼吸/ 时间/ 弯曲/ 同步/ 协议/ 下/ 时间/ 回滚/ 次数/ 没有/ 对/ 回滚/ 次数/ 的/ 加速/ 比/ 明显/ ,/ 这/ 主要/ 是/ 由于/ 本次/ PHOLD/ 测试程序/ 中/ 每个/ 事件/ 的/ 计算/ 负载/ 较/ 轻/ ,/ 使得/ 回滚/ 的/ 开销/ 不/ 大/ ,/ 因此/ 整体/ 运行/ 时间/ 差别/ 不/ 明显/ ;/ 而/ 在/ 实际/ 应用/ 中回/ 滚/ 将/ 极大/ 地/ 影响/ 仿真/ 运行/ 性能/ ./ 6/ 结论/ 负载/ 划分/ 是/ 决定/ 并行/ 离散/ 事件/ 仿真/ 性能/ 的/ 重要/ 因素/ ,/ 如何/ 度量/ 和/ 根据/ 模型/ 交互/ 模式/ 优化/ 通信/ 负载/ 是/ 目前/ 动态/ 负载/ 划分/ 研究/ 的/ 热点/ ./ 本文/ 将/ 并行/ 离散/ 事件/ 仿真/ 负载/ 划分/ 归结为/ 一个/ 带/ 权重/ 无向/ 图/ 有限/ 容量/ k/ 划分/ 问题/ ,/ 提出/ 了/ 一个/ 多项式/ 时间/ 复杂度/ 的/ 基于/ 顶点/ 交换/ 的/ 启发式/ 局部/ 搜索/ 近似/ 划分算法/ ,/ 旨在/ 使/ 计算/ 负载平衡/ 的/ 前提/ 下/ 通信/ 负载/ 最优化/ ./ 理论/ 证明/ 该/ 算法/ 近似/ 解与/ 全局/ 最优/ 解/ 比值/ 不/ 小于/ (/ 1/ -/ 1/ // |/ N/ |/ )/ (/ 1/ -/ ε/ )/ ,/ 时间/ 复杂度/ 不/ 超过/ O/ (/ n4/ ε/ -/ 1logn/ )/ ./ 测试/ 结果表明/ 该/ 算法/ 平均/ 减少/ 38.11/ %/ 的/ 回滚/ 开销/ ,/ 能/ 有效/ 地/ 提高/ 大规模/ 并行/ 离散/ 事件/ 仿真/ 的/ 运行/ 性能/ ./ 在/ 下/ 一步/ 工作/ 中/ ,/ 我们/ 将/ 结合/ multiwaycut/ 问题/ 模型/ 对/ 现有/ 的/ 划分/ 模型/ 进行/ 扩展/ ,/ 引入/ 对/ 特定/ LP/ 节点/ 的/ 优化/ 处理/ ,/ 以/ 解决/ 现有/ 算法/ 在/ 特殊/ 计算/ 负载/ 分布/ 下/ 效率/ 较/ 低/ 的/ 问题/ ,/ 进一步/ 提升/ 仿真/ 运行/ 性能/ ./ 

