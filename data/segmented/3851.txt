Page1/ 多核/ 结构/ 片上/ 网络/ 性能/ -/ 能耗/ 分析/ 及/ 优化/ 方法/ 张帅/ 1/ )/ ,/ 2/ )/ 宋风龙/ 1/ )/ 王栋/ 3/ )/ 刘志勇/ 1/ )/ 范东/ 睿/ 1/ )/ 1/ )/ (/ 中国科学院计算技术研究所/ 计算机/ 体系结构/ 国家/ 重点/ 实验室/ 北京/ 100190/ )/ 2/ )/ (/ 中国科学院/ 大学/ 北京/ 100039/ )/ 3/ )/ (/ 国网/ 信息/ 通信/ 有限公司/ 信息/ 通信/ 运维/ 中心/ 北京/ 100761/ )/ 摘要/ 文中/ 探讨/ 了/ 片/ 上/ 网络/ 在/ 执行/ 真实/ 并行程序/ 时/ 的/ 能耗/ 和/ 性能/ 关系/ ,/ 并/ 提出/ 了/ 一种/ 能耗/ // 性能/ 优化/ 方法/ ./ 首先/ ,/ 文中/ 提出/ 了/ 一种/ 精确/ 的/ 性能/ -/ 能耗/ 模型/ ,/ 在/ 性能/ 和/ 能耗/ 模型/ 中/ 同时/ 划分/ 出/ 与/ 频率/ 相关/ 和/ 与/ 频率/ 无关/ 的/ 因素/ ,/ 并/ 分析/ 其/ 对/ 性能/ 和/ 能耗/ 的/ 影响/ ;/ 其次/ ,/ 在/ 性能/ -/ 能耗/ 模型/ 中/ 建立/ 并行/ 开销/ 、/ 片/ 外访/ 存/ 开销/ 与/ 片/ 上/ 网络/ 规模/ (/ 节点/ 数/ )/ 、/ 频率/ 之间/ 的/ 关系/ ,/ 同时/ 引入/ 了/ 并行度/ 、/ 通信模型/ 等/ 与/ 应用/ 相关/ 的/ 因素/ ,/ 使该/ 模型/ 能够/ 同时/ 表达/ 软硬件/ 特性/ ;/ 第三/ ,/ 文中/ 提出/ 了/ 一种/ 基于/ 该/ 性能/ -/ 能耗/ 模型/ 的/ 性能/ -/ 能耗/ 优化/ 方法/ ,/ 通过/ 采集/ 程序/ 的/ 通信模型/ 、/ 访存/ 消息/ 数量/ 等/ 数据/ 选择/ 适当/ 的/ 频率/ 和/ 网络/ 节点/ 数来/ 获得/ 片上/ 网络/ 能耗/ 最低值/ 或/ 处理器/ 性能/ 最大值/ ./ 最后/ ,/ 文中/ 采用/ 8/ 个/ PARSEC/ 并行程序/ 验证/ 前述/ 模型/ 的/ 准确性/ 并/ 评价/ 性能/ -/ 能耗/ 优化/ 方法/ ,/ 结果显示/ 文中/ 性能/ -/ 能耗/ 模型/ 相比/ 传统/ 模型/ 更加/ 精确/ 吻合/ 实验/ 测量/ 结果/ ,/ 性能/ -/ 能耗/ 优化/ 方法/ 也/ 有效/ 适用/ 于/ 不同/ 种类/ 的/ 并行程序/ ./ 关键词/ 多核/ ;/ 片上/ 网络/ ;/ 高/ 能效/ ;/ 能耗/ 优化/ 1/ 引言/ 芯片/ 能耗/ 管理/ 已经/ 成为/ 当前/ 的/ 重要/ 课题/ ,/ 一方面/ 高性能/ 计算/ 需求/ 需要/ 消耗/ 大量/ 的/ 电能/ [/ 1/ ]/ ,/ 另一方面/ ,/ 对于/ 有/ 电池/ 限制/ 的/ 设备/ (/ 如/ 移动电话/ 和/ PDA/ 等/ )/ ,/ 能耗/ 的/ 增加/ 意味着/ 使用/ 时间/ 的/ 减少/ [/ 2/ -/ 3/ ]/ ./ 随着/ 半导体/ 工艺/ 进入/ 深亚/ 微米/ 时代/ ,/ 低/ 阈值电压/ 导致/ 亚/ 阈值/ 漏电/ 功耗/ 呈/ 指数/ 级/ 增长/ ,/ 漏电/ 功耗/ 已经/ 成为/ 芯片/ 功耗/ 的/ 重要/ 组成部分/ ,/ 已经/ 达到/ 多核/ 芯片/ 总/ 功耗/ 的/ 30/ %/ ~/ 40/ %/ [/ 4/ ]/ ./ 为了/ 节省/ 能耗/ ,/ 众多/ 研究/ 使用/ 动态/ 电压/ 频率/ 缩放/ 技术/ 来/ (/ DVFS/ )/ 降低/ 芯片/ 电压/ // 频率/ 级别/ 来/ 降低/ 动态/ 功耗/ [/ 5/ -/ 7/ ]/ ,/ 也/ 会/ 使用/ 动态/ 功耗/ 管理/ 技术/ (/ DPM/ )/ 使/ 空闲/ 的/ 片/ 上/ 设备/ 和/ 处理器/ 核/ 关闭/ 或/ 进入/ 休眠状态/ 来/ 同时/ 降低/ 芯片/ 的/ 动态/ 和/ 静态/ 功耗/ [/ 8/ -/ 9/ ]/ ./ 而/ 降低/ 电压/ 带来/ 低能耗/ 的/ 同时/ ,/ 必须/ 首先/ 降低/ 芯片/ 的/ 频率/ [/ 10/ ]/ ,/ 由此/ 也/ 会/ 带来/ 性能/ 随/ 频率/ 的/ 降低/ 而/ 下降/ ./ 因此/ 为了/ 权衡/ 能耗/ 和/ 性能/ 必须/ 选择/ 合适/ 的/ 电压/ // 频率/ 等级/ [/ 11/ ]/ ,/ 频率/ 调节/ 成为/ 能耗/ -/ 性能/ 管理/ 的/ 重要/ 调节/ 手段/ ./ 除了/ 时钟/ 频率/ 对/ 能耗/ 和/ 性能/ 有着/ 双重/ 影响/ 之外/ ,/ 程序/ 的/ 并行性/ 、/ 同步/ 、/ 通信/ 及/ 访存/ 开销/ 、/ 线程/ 数及/ 核数/ 也/ 会/ 影响/ 性能/ 和/ 能耗/ 的/ 变化/ [/ 12/ ]/ ,/ 而/ 降低/ 性能/ 导致/ 的/ 执行/ 时间/ 增加/ 成为/ 能耗/ 增加/ 的/ 重要/ 因素/ ./ 更进一步/ 的/ 分析/ 可以/ 得出/ ,/ 频率/ 、/ 并行性/ 、/ 通信/ 访存/ 开销/ 及/ 核数/ 这/ 几个/ 因素/ 之间/ 也/ 存在/ 着/ 种种/ 依赖/ 关系/ ./ 例如/ ,/ 增加/ 核数/ 可以/ 导致/ 通信/ 访存/ 开销/ 的/ 增大/ ,/ 同时/ 使得/ 程序/ 并行性/ 增加/ ,/ 既/ 可能/ 提高/ 也/ 可能/ 降低/ 处理器/ 性能/ ,/ 此外/ 因为/ 静态/ 功耗/ 不随/ 频率/ 变化/ ,/ 即使/ 在/ 不/ 影响/ 性能/ 的/ 前提/ 下/ 增加/ 处理器/ 核数/ 并/ 降低/ 频率/ 也/ 不能/ 保证/ 带来/ 更/ 低/ 的/ 能耗/ 收益/ ./ 因此/ 众多/ 的/ 不/ 确定/ 因素/ 使得/ 针对/ 某/ 一个/ 应用程序/ 选择/ 合适/ 的/ 电压/ 频率/ 及/ 核数/ 变得/ 并/ 不/ 显而易见/ ,/ 这/ 需要/ 对/ 应用程序/ 性能/ 及/ 处理器/ 能耗/ 建立/ 更/ 精确/ 的/ 模型/ 并/ 能/ 清晰/ 呈现/ 上述/ 各/ 因素/ 之间/ 的/ 依赖/ 关系/ ./ 然而/ ,/ 随着/ 越来越/ 多/ 的/ 核/ 被/ 放到/ 片上/ ,/ 片上/ 网络/ (/ NoC/ )/ 严重/ 制约/ 着/ 同步/ 、/ 通信/ 及/ 访存/ 等/ 开销/ ,/ 并且/ NoC/ 消耗/ 了/ 大量/ 的/ 芯片/ 面积/ 及/ 能量/ ,/ 文献/ [/ 13/ ]/ 提到/ 以/ 8/ 核/ 处理器/ 为例/ ,/ NoC/ 的/ 功耗/ 相当于/ 其中/ 一个/ 核/ ,/ 而且/ 其/ 漏电/ 功耗/ 随/ 工艺/ 大幅提高/ ,/ 文献/ [/ 14/ ]/ 给出/ 了/ NoC/ 的/ 漏电/ 功耗/ 占/ 其/ 总/ 功耗/ 的/ 比重/ 从/ 180nm/ 工艺/ 时/ 的/ 2.5/ %/ 增长/ 到/ 70nm/ 工艺/ 时/ 的/ 27/ %/ ,/ 期间/ 频率/ 还/ 提高/ 了/ 一倍/ ./ 可见/ ,/ 漏电/ 功耗/ 在/ NoC/ 总/ 功耗/ 中/ 占有/ 重要/ 地位/ ,/ 也/ 推动/ 很多/ 研究/ NoC/ 功耗/ 的/ 建模/ [/ 15/ ]/ 和/ 优化/ [/ 2/ ,/ 9/ ]/ ./ NoC/ 规模/ (/ 节点/ 数/ )/ 的/ 改变/ 也/ 同/ 核数/ 的/ 改变/ 一样/ 对/ 性能/ 和/ 能耗/ 有/ 至关重要/ 的/ 影响/ ./ 因此/ ,/ NoC/ 的/ 频率/ 和/ 规模/ 对/ 程序/ 性能/ 和/ 自身/ 能耗/ 的/ 影响/ 同/ 前面/ 所述/ 的/ 多/ 核/ 性能/ -/ 能耗/ 分析/ 有着/ 类似/ 的/ 关系/ ./ 然而/ 到/ 目前为止/ ,/ 还/ 没有/ 这样/ 的/ 模型/ 可以/ 阐述/ 片上/ 网络/ 规模/ 、/ 频率/ 、/ 并行/ 通信/ 及/ 访存/ 开销/ 、/ 片上/ 网络/ 能耗/ 、/ 程序/ 并行度/ 以及/ 并行程序/ 性能/ 之间/ 的/ 关系/ ./ 因此/ 本文/ 提出/ 了/ 一个/ 针对/ 常见/ 的/ 二维/ Mesh/ 结构/ 的/ NoC/ 能耗/ -/ 性能/ 的/ 模型/ ,/ 并/ 基于/ 该/ 模型/ 提出/ 了/ 一种/ 分别/ 针对性/ 能/ 和/ 能耗/ 的/ 离线/ 优化/ 方法/ ,/ 对于/ 不同/ 的/ 并行程序/ 可以/ 通过/ 较/ 小/ 的/ 代价/ 取得/ NoC/ 的/ 频率/ 及/ 节点/ 数/ 配置/ ,/ 从而/ 获得/ 接近/ 最优性/ 能/ 或/ 能耗/ 的/ 收益/ ./ 本文/ 具体/ 有/ 以下几点/ 贡献/ :/ (/ 1/ )/ 建立/ 精确/ 的/ NoC/ 性能/ -/ 能耗/ 模型/ ,/ 在/ 能耗/ 模型/ 中/ 引入/ 了/ 与/ NoC/ 频率/ 无关/ 功耗/ 的/ 同时/ 在/ 性能/ 模型/ 中/ 引入/ 并行/ 开销/ (/ 包括/ 与/ NoC/ 频率/ 相关/ 的/ 通信/ 开销/ 和/ 与/ NoC/ 频率/ 无关/ 的/ 访存/ 开销/ )/ ;/ (/ 2/ )/ 通过/ 分析/ 采样/ 并行程序/ 特征/ ,/ 使用/ NoC/ 性能/ -/ 能耗/ 模型/ 分别/ 在/ 以/ 性能/ 和/ 能耗/ 为/ 约束条件/ 的/ 前提/ 下/ 优化/ 能耗/ 和/ 性能/ ,/ 预测/ 取得/ 最优/ 能耗/ 或/ 性能/ 时/ 的/ 频率/ 与/ 节点/ 数/ ./ 并/ 基于/ 这个/ 流程/ 提出/ 一种/ 可以/ 根据/ 不同/ 并行程序/ 特征/ 调整/ 优化/ 问题/ 的/ 性能/ 和/ 能耗/ 优化/ 方法/ ;/ (/ 3/ )/ 通过/ 实验/ 分析/ 8/ 个/ 不同/ 类型/ 的/ PARSEC/ 程序/ 在/ 16/ 节点/ 二维/ MeshNoC/ 上/ 的/ 运行/ 情况/ ,/ 得到/ 新/ 的/ 性能/ -/ 能耗/ 模型/ 相比/ 传统/ 建模/ 方法/ 更好/ 的/ 拟合/ NoC/ 能耗/ 和/ 性能/ 随/ 频率/ 、/ 节点/ 数/ 变化/ 的/ 趋势/ ,/ 并且/ 通过/ 使用/ (/ 2/ )/ 中/ 优化/ 方法/ 预测/ 最优/ 能耗/ 和/ 性能/ 并/ 得到/ 相应/ 的/ NoC/ 配置/ (/ 频率/ 和/ 节点/ 数/ )/ ,/ 实验/ 证明/ 使用/ 该/ NoC/ 配置/ 得到/ 的/ 结果/ 非常/ 接近/ 最优/ 能耗/ 和/ 性能/ ./ 本文/ 第/ 2/ 节/ 说明/ 研究/ 关注/ 此/ 问题/ 的/ 动机/ ;/ 第/ 3/ 节/ 介绍/ 相关/ 的/ 研究/ 工作/ ;/ 第/ 4/ 节/ 详细/ 介绍/ NoC/ 能耗/ 模型/ ;/ 第/ 5/ 节/ 详细/ 介绍/ NoC/ 性能/ 模型/ ;/ 第/ 6/ 节/ 具体/ 介绍/ NoC/ 性能/ -/ 能耗/ 分析/ 及/ 离线/ 优化/ 方法/ ;/ 第/ 7/ 节/ Page3/ 介绍/ 本文/ 的/ 实验/ 平台/ 和/ 测试程序/ ;/ 第/ 8/ 节/ 对比/ 分析/ 实验/ 结果/ ;/ 第/ 9/ 节/ 总结/ 全文/ ./ 2/ 研究/ 动机/ 目前/ 在/ CMOS/ 功耗/ 模型/ 中/ 可以/ 看到/ ,/ 与/ 频率/ 无关/ 的/ 静态/ 功耗/ 是/ 漏电/ 功耗/ 的/ 组成部分/ ,/ 但是/ 面向/ 处理器/ 的/ 简化/ 能耗/ 模型/ 通常/ 不能/ 正确/ 表述/ 漏电/ 功耗/ 与/ 频率/ 的/ 关系/ ./ 例如/ :/ (/ 1/ )/ 文献/ [/ 8/ ]/ 假设/ 漏电/ 功耗/ 与/ 总/ 功耗/ 成/ 固定/ 比例/ ./ (/ 2/ )/ 文献/ [/ 9/ ]/ 将/ 漏电/ 功耗/ 写成/ 与/ 频率/ 成正比/ ./ 基于/ 这/ 两种/ 假设/ 的/ 功耗/ 模型/ 其/ 功耗/ 随/ 频率/ 变化/ 的/ 曲线/ 是从/ 原点/ 出发/ 的/ 曲线/ ,/ 而/ 实际/ 情况/ 中/ ,/ 当/ 芯片/ 时钟/ 关闭/ 时/ 仍/ 有/ 漏/ 电流/ 及/ 基础/ 电路/ 消耗/ 的/ 一部分/ 功耗/ ,/ 因此/ 功率/ -/ 频率/ 曲线/ 应当/ 如图/ 1/ 所示/ ,/ 上述/ 两种/ 假设/ 并/ 不能/ 准确/ 表述/ 应用/ DVFS/ 技术/ 芯片/ 功耗/ ./ (/ 3/ )/ 文献/ [/ 2/ ]/ 提出/ 了/ 功耗/ -/ 电压/ 的/ 准确/ 模型/ ,/ 但/ 没有/ 引入/ 电压/ 频率/ 之间/ 的/ 非线性/ 关系/ (/ 公式/ )/ ./ (/ 4/ )/ 文献/ [/ 16/ -/ 17/ ]/ 虽然/ 也/ 引入/ 了/ 与/ 频率/ 无关/ 的/ 静态/ 功耗/ ,/ 但/ 也/ 假设/ 了/ 电压/ -/ 频率/ 成/ 线性关系/ ./ 虽然/ (/ 3/ )/ (/ 4/ )/ 两种/ 建模/ 方法/ 比/ (/ 1/ )/ 、/ (/ 2/ )/ 更/ 接近/ 图/ 1/ 曲线/ ,/ 但/ 只能/ 应用/ 于/ 漏电/ 功耗/ 随/ 频率/ 变化/ 不大/ 的/ 情况/ ./ 我们/ 在/ ORION2/ ./ 0/ 上/ 模拟/ 了/ 一个/ 带有/ 5/ 个/ 双方/ 向/ 链路/ 的/ 简化/ 路由器/ ./ 表/ 1/ 列出/ 了/ 得到/ 的/ 结果/ :/ (/ 1/ )/ NoC/ 漏电/ 功耗/ 占/ 总/ 功耗/ 比例/ 高于/ 整个/ 芯片/ 的/ 漏电/ 功耗/ 比例/ ,/ 在/ 低/ 频率/ 时/ 占/ 主要/ 比例/ ,/ 并且/ 随/ 频率/ 提高/ 其/ 比例/ 大幅/ 降低/ ;/ (/ 2/ )/ 与/ 频率/ 无关/ 功耗/ 不/ 等效于/ 漏电/ 功耗/ ,/ 其/ 占/ 漏电/ 功耗/ 比例/ 随/ 频率/ 提高/ 大幅/ 降低/ ./ 并且/ 这/ 两者/ 比例/ 并/ 不是/ 随/ 频率/ 线性/ 变化/ ./ 如果/ NoC/ 功耗/ 模型/ 不能/ 体现/ 这/ 两个/ 特征/ 将/ 无法/ 对/ 应用/ DVFS/ 技术/ 的/ NoC/ 能耗/ 进行/ 准确/ 评估/ ./ 本文/ 将/ 针对/ 使用/ DVFS/ 技术/ 的/ NoC/ 性能/ 重新/ 建模/ ,/ 并/ 评估/ 新/ 模型/ 相对/ 传统/ 能耗/ 模型/ 能够/ 更好/ 地/ 符合/ 模拟实验/ 中/ 能耗/ 随/ 频率/ 、/ 节点/ 数/ 的/ 变化规律/ ./ 频率/ // MHz/ (/ Pind/ // Pleak/ )/ // %/ (/ Pind/ // P/ )/ // %/ (/ Pleak/ // P/ )/ // %/ 50084.6100073/ ./ 4200057.9300047/ ./ 8400040.7/ 在/ 并行程序/ 的/ 性能/ 模型/ 中/ ,/ 并行/ 开销/ (/ 包括/ 同步/ 、/ 线程/ 通信/ 、/ 访存/ 引起/ 的/ NoC/ 上/ 通信/ 开销/ 和/ 片外/ 的/ 访存/ 延迟/ 开销/ )/ 成为/ 影响/ 并行/ 性能/ 下降/ 的/ 主要/ 因素/ ./ 文献/ [/ 16/ ]/ 同时/ 在/ 性能/ 模型/ 中/ 引入/ 了/ 频率/ 、/ 节点/ 数/ 和/ 并行/ 开销/ ,/ 但是/ 并/ 没有/ 表达/ 并行/ 开销/ 随/ 节点/ 数/ 和/ 频率/ 同时/ 改变/ 的/ 规律/ ./ 例如/ ,/ 在/ 不/ 改变/ 性能/ 的/ 前提/ 下/ 增加/ 节点/ 数/ 同时/ 降低/ 频率/ ,/ 程序/ 的/ 并行/ 开销/ 增大/ ,/ NoC/ 漏电/ 功耗/ (/ 包括/ 与/ 频率/ 无关/ 功耗/ )/ 的/ 影响/ 增大/ ,/ 因此/ 不/ 一定/ 取得/ 比低/ 节点/ 数/ 、/ 高频率/ 更/ 低/ 的/ 能耗/ ./ 上述/ 这些/ 问题/ 正是/ 本文/ 所/ 关注/ 的/ ,/ 本文/ 将/ 建立/ 一个/ 性能/ -/ 能耗/ 模型/ ,/ 充分/ 描述/ 了/ 漏电/ 功耗/ 、/ 并行/ 开销/ 随/ 频率/ 、/ 节点/ 数/ 变化/ 的/ 特性/ 及其/ 作用/ ,/ 同时/ 也/ 说明/ 漏电/ 功耗/ 、/ 并行/ 开销/ 中/ 与/ 频率/ 无关/ 部分/ 的/ 组成/ 和/ 对/ 性能/ -/ 能耗/ 的/ 影响/ ,/ 相比/ 以往/ 的/ 模型/ 更为/ 准确/ ./ 并/ 应用/ 新/ 的/ 模型/ 提出/ 一种/ 新/ 的/ 能耗/ -/ 性能/ 优化/ 方法/ ,/ 在/ 不/ 改变/ NoC/ 硬件/ 结构/ 的/ 前提/ 下/ ,/ 相对/ 文献/ [/ 2/ ,/ 16/ ]/ 中/ 的/ 方法/ ,/ 本文/ 方法/ 可以/ 适应/ 不同/ 类型/ 的/ 并行程序/ ,/ 相比/ 文献/ [/ 17/ ]/ 中/ 提到/ 的/ 爬山/ 法/ 搜索/ 最优/ 频率/ 与/ 节点/ 数/ 更加/ 简单/ 有效/ ./ 此外/ ,/ 与/ 以往/ 的/ 研究/ 针对/ 多核/ 总/ 能耗/ 相比/ ,/ 本文/ 侧重/ 评价/ NoC/ 的/ 能耗/ ,/ 并/ 分析/ NoC/ 能耗/ 与/ 处理器/ 能耗/ 的/ 不同/ 构成/ 并/ 强调/ NoC/ 通信/ 开销/ 对/ 程序/ 性能/ 的/ 影响/ ./ 3/ 相关/ 研究/ 已经/ 有/ 很多/ 关于/ 多核/ 性能/ -/ 能耗/ 方面/ 的/ 研究/ ./ 文献/ [/ 18/ ]/ 首次/ 在/ 将/ 处理器/ 能耗/ 考虑/ 扩展/ 到/ Amdahl/ 定律/ ,/ 但是/ 他们/ 旨在/ 研究/ 异构/ 多核/ 相比/ 同构/ 多核/ 如何/ 具有/ 更高/ 能效/ ,/ 没有/ 考虑/ 处理器/ 核/ 的/ 频率/ 缩放/ 带来/ 的/ 性能/ 和/ 能耗/ 改变/ ./ 在/ 文献/ [/ 19/ ]/ 中/ 通过/ 频率/ 调节/ 对/ 并行程序/ 能耗/ 进行/ 优化/ ,/ 然后/ 文中/ 所述/ 模型/ 没有/ 涉及/ 可以/ 改变/ 片上/ 网络/ 规模/ 或/ 可以/ 关闭/ 单独/ 处理器/ 核/ ,/ 单独/ 使用/ DVFS/ 技术/ 调节/ 频率/ 而/ 不/ 运用/ DPM/ 技术/ 关闭/ 空闲/ 的/ 处理器/ 核在/ 静态/ 功耗/ 不可/ 忽略/ 的/ 实际/ 情况/ 中/ 不能/ 取得/ 最优/ 能耗/ ./ 大量/ 关于/ 能耗/ -/ 性能/ 模型/ 的/ 研究/ 都/ 是/ 简化/ 不/ 精确/ Page4/ 的/ ,/ 例如/ 文献/ [/ 5/ ,/ 9/ ,/ 15/ ,/ 18/ ,/ 20/ ]/ 都/ 没有/ 考虑/ 与/ 频率/ 无关/ 的/ 功耗/ 和/ 并行/ 开销/ ,/ 他们/ 使用/ 的/ 基于/ 次/ 线性/ 开销/ 的/ 性能/ 模型/ 并/ 不适/ 用于/ 广泛/ 的/ 多线程/ 程序/ ./ 文献/ [/ 2/ ,/ 8/ ]/ 在/ 分析模型/ 中/ 引入/ 了/ 漏电/ 功耗/ (/ 已/ 包括/ 与/ 频率/ 无关/ 功耗/ )/ 却/ 没有/ 在/ 性能/ 模型/ 中/ 加入/ 并行/ 开销/ 的/ 分析/ ./ 文献/ [/ 21/ -/ 22/ ]/ 同样/ 只/ 引入/ 了/ 与/ 频率/ 无关/ 功耗/ 没有/ 考虑/ 并行/ 开销/ 的/ 影响/ ./ 正好/ 相反/ 的/ 是/ ,/ 文献/ [/ 12/ ,/ 16/ -/ 17/ ,/ 23/ -/ 24/ ]/ 中/ 模型/ 引入/ 了/ 并行/ 开销/ 却/ 没有/ 考虑/ 与/ 频率/ 无关/ 的/ 功耗/ ./ 上述/ 这些/ 研究/ 没有/ 同时/ 讨论/ 并行/ 开销/ 和/ 与/ 频率/ 无关/ 功耗/ 的/ 影响/ ,/ 并/ 将/ 其/ 应用/ 于/ 真实/ 的/ 并行程序/ 性能/ 能耗/ 优化/ 中/ ./ 最近/ 几年/ 的/ 研究/ 中/ ,/ 文献/ [/ 16/ ]/ 研究/ 了/ Power/ -/ awareSpeedup/ ,/ 建立/ 了/ 充分考虑/ 与/ 频率/ 无关/ 功耗/ 和/ 并行/ 开销/ 的/ 性能/ -/ 能耗/ 模型/ ./ 其/ 性能/ 模型/ 的/ 分析/ 基于/ 将/ workload/ 划分/ 成片/ 上和片/ 下/ 两个/ 部分/ ,/ 其/ 目的/ 在于/ 推导/ 出/ 一个/ 适用/ 于/ 不同/ 程序/ 并/ 可/ 应用/ DVFS/ 技术/ 的/ 精确/ 性能/ 模型/ ./ 文章/ 没有/ 给出/ 面向/ 不同/ 应用程序/ 的/ 具体/ 优化/ 方案/ ,/ 使得/ 负载/ 划分/ 本身/ 成为/ 了/ 技术/ 难点/ ./ 文献/ [/ 2/ ]/ 基于/ 给定/ 的/ 程序/ 并行/ 效率/ 和/ 处理器/ 核数/ ,/ 提出/ 了/ 一个/ 功耗/ -/ 性能/ 的/ 分析模型/ ./ 然而/ ,/ 这个/ 模型/ 没有/ 考虑/ 程序/ 的/ 串/ 并行/ 划分/ 以及/ 片外/ 部件/ 对/ 性能/ 的/ 影响/ ,/ 只是/ 将/ 性能/ 曲线/ 抽象/ 成/ “/ 并行/ 效率/ ”/ ,/ 没有/ 分解/ 其中/ 各/ 部分/ 的/ 开销/ 作用/ ./ 在/ 他们/ 后续/ 的/ 工作/ [/ 17/ ]/ 中/ ,/ 继续/ 考虑/ 了/ 一种/ 启发式/ DVFS/ 和/ 休眠/ 控制/ ,/ 研究/ 的/ 目标程序/ 需要/ 达到/ 稳定/ 状态/ (/ 例如/ 多媒体/ 应用/ )/ ,/ 并/ 提出/ 了/ 一种/ 用于/ 寻找/ 最小/ 能耗/ 的/ 搜索算法/ ./ 文献/ [/ 25/ ]/ 提出/ 了/ 通过/ 划分/ 程序/ 串行/ 与/ 并行/ 部分/ ,/ 分别/ 采用/ 不同/ 频率/ 取得/ 能耗/ 最低/ 的/ 效果/ ./ 其/ 方法/ 还/ 使用/ 了/ 可以/ 关闭/ 处理器/ 核/ 的/ DPM/ 技术/ ./ 然而/ ,/ 文章/ 假设/ 静态/ 功耗/ 与/ 动态/ 功耗/ 成/ 固定/ 比例/ ,/ 间接/ 忽略/ 了/ 与/ 频率/ 无关/ 功耗/ 的/ 作用/ ./ 目前/ 仍/ 没有/ 研究/ 将/ 与/ 频率/ 无关/ 功耗/ 和/ 影响/ 性能/ 的/ 并行/ 开销/ 、/ 访存/ 开销/ 放在/ 一起/ 建立/ 可/ 同时/ 使用/ DVFS/ (/ 电压/ 频率/ 缩放/ )/ 和/ DPM/ (/ 节点/ 独立/ 关闭/ )/ 技术/ 的/ 性能/ -/ 能耗/ 模型/ ./ 这/ 需要/ 建立/ 并行/ 开销/ 、/ 访存/ 开销/ 与/ 频率/ 、/ 节点/ 数/ 之间/ 的/ 关联/ ./ 4/ 能耗/ 模型/ 分析/ 4.1/ 片上/ 能耗/ 模型/ 计算机系统/ 的/ 功耗/ 主要/ 由/ 处理器/ 、/ 存储系统/ 、/ I/ // O/ 接口/ 和/ 基础/ 电路/ 消耗/ ,/ 从而/ 把/ 整个/ 系统/ 的/ 功耗/ 分成/ 两个/ 部分/ :/ 与/ 频率/ 相关/ 功耗/ 和/ 与/ 频率/ 无关/ 功耗/ [/ 26/ -/ 27/ ]/ :/ 由此/ 可/ 得到/ 能耗/ 为/ 其中/ 与/ 频率/ 相关/ 功耗/ Pdep/ (/ f/ )/ 由/ 共享/ 时钟/ 频率/ 的/ 片/ 上/ 部件/ 消耗/ ,/ 例如/ 处理器/ 核/ 、/ NoC/ 和/ 多级/ Cache/ 等/ ,/ 而/ 与/ 频率/ 无关/ 功耗/ Pind/ 主要/ 有片/ 外/ 设备/ 如/ 内存/ 、/ 磁盘/ 、/ I/ // O/ 设备/ 消耗/ ./ 基于/ 与/ 频率/ 无关/ 功耗/ 的/ 研究/ [/ 26/ -/ 29/ ]/ 主要/ 着眼于/ 片外/ 存储/ 部件/ ./ 然而/ ,/ 通过/ 对片/ 上/ 功耗/ 的/ 分析/ 发现/ ,/ 片上/ 功耗/ 也/ 可以/ 写成/ 公式/ (/ 1/ )/ 的/ 形式/ ,/ 但其与/ 频率/ 是否/ 相关/ 并/ 不是/ 按照/ 片上/ 部件/ 划分/ ,/ 而是/ 由/ 动态/ 功耗/ (/ 频率/ 相关/ )/ 和/ 静态/ 功耗/ (/ 频率/ 无关/ )/ 组成/ 的/ ./ 静态/ 功耗/ 通常/ 被/ 认为/ 由/ 漏电/ 功耗/ 组成/ ./ 但/ 在/ 这个/ 小节/ ,/ 我们/ 通过/ 分析/ 得出/ 静态/ 功耗/ 只是/ 漏电/ 功耗/ 的/ 一部分/ ./ 通常/ 片上/ 部件/ 功耗/ 可以/ 写成/ [/ 12/ ,/ 30/ ]/ :/ 其中/ A/ 是/ 动态/ 因子/ ,/ C/ 是/ 有效/ 电容/ ,/ V/ 是/ 供电/ 电压/ ,/ f/ 是/ 工作频率/ ,/ Ileak/ 是/ 漏/ 电流/ ./ 而漏/ 电流/ 又/ 是/ 由亚/ 阈值/ (/ sub/ -/ threshold/ )/ 漏/ 电流/ 和/ 栅/ 氧化/ 层/ (/ gate/ -/ oxide/ )/ 漏/ 电流/ 构成/ [/ 2/ ,/ 12/ ,/ 14/ ]/ :/ Ileak/ =/ Isub/ +/ Iox/ 其中/ K1/ ,/ K2/ ,/ n/ 和/ / 是/ 经验/ 常数/ ,/ Tox/ 是/ 氧化/ 层/ 厚度/ ,/ W/ 是/ 栅极/ 宽度/ ,/ Vth/ 是/ 阈值电压/ ./ 指数/ 中/ 的/ V/ θ/ 是/ thermal/ 电压/ ,/ 在/ 室温/ 情况/ 下为/ 25mV/ [/ 12/ ]/ 并且/ 跟随/ 温度/ 线性/ 增长/ ./ 因此/ 我们/ 可以/ 得出/ 漏/ 电流/ 会/ 跟随/ 温度/ 和/ 供电/ 电压/ 指数/ 增加/ ./ 为了/ 找出/ 与/ 频率/ 无关/ 的/ 功耗/ 形式/ ,/ 我们/ 引用/ 了/ 精确/ 的/ 频率/ -/ 电压/ 关系式/ [/ 21/ -/ 22/ ]/ :/ 其中/ fmax/ 表示/ 在/ 电压/ V/ 下/ 可以/ 达到/ 最高/ 频率/ ,/ 指数/ α/ 是/ 1/ 到/ 2/ 的/ 经验/ 常数/ ,/ η/ 是/ 常数/ ./ 在/ 式/ (/ 3/ )/ 中/ ,/ 与/ 频率/ 无关/ 功耗/ 可以/ 在/ f/ →/ 0/ 时/ 取得/ ,/ 此时/ 电压/ V/ →/ Vth/ ./ 于是/ 我们/ 得到/ 与/ 频率/ 无关/ 功耗/ 为/ Pind/ =/ VthK1We/ 在/ 第/ 2/ 、/ 3/ 小节/ 中/ 我们/ 提到/ 的/ 在/ 评估/ 频率/ 多核/ 功耗/ 和/ DVFS/ 技术/ 应用/ 中/ 广泛/ 使用/ 的/ 电压/ -/ 频率/ 关系/ 是/ 不同于/ 式/ (/ 6/ )/ 的/ 线性关系/ :/ 其中/ β/ 3/ =/ Vmax/ // fmax/ ,/ 将式/ (/ 7/ )/ 代入/ 式/ (/ 3/ )/ 中/ 并/ 使/ f/ →/ 0/ ,/ Page5/ 此时/ 得到/ 与/ 频率/ 无关/ 功耗/ 是/ Pind/ =/ P/ =/ 0/ ,/ 显然/ 是/ 不/ 符合实际/ 电路/ 特性/ 的/ ./ 但是/ 使用/ 式/ (/ 5/ )/ 非线性/ 关系/ 会/ 给/ 我们/ 带来/ 极大/ 不便/ ./ 因此/ 我们/ 找到/ 一种/ 方法/ 将式/ (/ 5/ )/ 近似/ 表达/ 成/ 线性关系/ ,/ 通过/ 这种/ 线性关系/ 也/ 可以/ 推导/ 出/ 正确/ 的/ 与/ 频率/ 无关/ 功耗/ ./ 我们/ 假设/ 电压/ -/ 频率/ 有/ 如下/ 关系/ [/ 21/ ,/ 31/ ]/ :/ 其中/ β/ 1/ =/ Vmin/ ,/ β/ 2/ =/ (/ Vmax/ -/ Vmin/ )/ // fmax/ ./ 将式/ (/ 8/ )/ 代入/ 式/ (/ 3/ )/ 并/ 使/ f/ →/ 0/ ,/ 我们/ 可以/ 得到/ 与/ 式/ (/ 6/ )/ 相同/ 的/ 与/ 频率/ 无关/ 功耗/ 的/ 形式/ ./ 此外/ ,/ 我们/ 发现/ 当/ 电压/ 在/ 远高于/ 阈值电压/ 的/ 范围/ 内/ 变化/ 时/ ,/ 使用/ 电压/ -/ 频率/ 关系式/ (/ 7/ )/ 和/ (/ 8/ )/ 可以/ 得到/ 相近/ 的/ 功耗/ 表达式/ ./ 为了/ 比较/ 这/ 两种/ 电压/ -/ 频率/ 关系式/ (/ 7/ )/ 、/ (/ 8/ )/ 与/ 关系式/ (/ 5/ )/ 对/ 功耗/ 影响/ 的/ 区别/ ,/ 我们/ 列出/ 了/ 以下/ 模型/ :/ ModelA/ :/ 使用/ 关系式/ (/ 5/ )/ ,/ 其/ 经验/ 常数/ α/ 设为/ ModelB/ :/ 使用/ 关系式/ (/ 5/ )/ ,/ 其/ 经验/ 常数/ α/ 设为/ ModelC/ :/ 使用/ 关系式/ (/ 8/ )/ ,/ 电压/ -/ 频率/ 关系/ 在/ 电压/ 大于/ 阈值电压/ 时/ 近似/ 为/ 线性/ ,/ 与/ 频率/ 无关/ 功耗/ 与/ ModelA/ 与/ B/ 是/ 相同/ 的/ ./ ModelD/ :/ 使用/ 关系式/ (/ 7/ )/ ,/ 电压/ -/ 频率/ 成正比/ 关系/ ,/ 广泛应用/ 于/ DVFS/ 技术/ ,/ 与/ 频率/ 无关/ 功耗/ 被/ 忽略/ ./ 本文/ 使用/ NoC/ 功耗/ 模拟器/ ORION2/ ./ 0/ [/ 32/ ]/ 来/ 评价/ 这些/ 模型/ ./ 本文/ 选择/ 65nm/ 工艺/ ,/ 电压/ 和/ 频率/ 同时/ 调节/ ./ 频率/ 调节/ 范围/ 设置/ 为/ 0/ ~/ 4GHz/ ,/ 电压/ 调节/ 范围/ 为/ 从/ 阈值电压/ 到/ 1.2/ V/ ./ 简化/ 起/ 见/ ,/ 我们/ 假设/ 了/ 1/ 个/ 路由器/ 和/ 4/ 个/ 相邻/ 节点/ 、/ 1/ 个/ 处理器/ 核/ 链接/ ,/ 通信/ 负载/ 设置/ 为/ 常数/ (/ 0.02/ flits/ // cycle/ // port/ )/ ./ 图/ 2/ 显示/ 了/ 能耗/ 模拟/ 的/ 结果/ ,/ ModelC/ 的/ 曲线/ 始终/ 介于/ ModelA/ 和/ B/ 之间/ ,/ 而/ ModelD/ 偏离/ 了/ ModelA/ 和/ B/ ,/ 最小值/ 1/ ./ 最大值/ 2/ ./ 特别/ 是/ 在/ 低/ 频率/ 时/ ./ 图/ 2/ 说明/ 了/ ModelC/ 无论/ 在/ 低/ 频率/ 还是/ 高频率/ 时/ 都/ 能/ 较/ 好/ 地/ 接近/ 真实/ 能耗/ 趋势/ ./ 第/ 6/ 小节/ 中/ 性能/ -/ 能耗/ 模型/ 评价/ 中/ 仍然/ 对/ 这/ 4/ 种/ 模型/ 进行/ 比较/ ./ 4.2/ 片上/ 网络/ 能耗/ 模型/ 一般/ 情况/ 下/ ,/ 二维/ MeshNoC/ 的/ 功耗/ 会/ 随着/ 网络/ 规模/ 扩大/ 呈超/ 线性/ 增长/ 的/ 趋势/ ./ 这/ 是因为/ 一方面/ 控制线/ 和/ 排队/ 锁/ 存器/ (/ queuinglatches/ )/ 的/ 数量/ 都/ 是/ 至少/ 线性/ 增加/ 的/ ./ 为了/ 简化/ 和/ 考虑/ 扩展性/ ,/ 本文/ 中/ 路由器/ 缓存/ 数量/ 不随/ 节点/ 数/ 变化/ ,/ 因此/ NoC/ 的/ 总/ 功耗/ 随/ 节点/ 数/ 的/ 增加/ 也/ 是/ 线性/ 的/ ./ 因为/ NoC/ 中/ 节点/ 间/ 连线/ 相比/ 节点/ 内/ 路由器/ 来说/ 几乎/ 不/ 消耗/ 漏电/ 功耗/ ,/ 所以/ 节点/ 和/ 连线/ 的/ 漏电/ 功耗/ 比例/ 大不相同/ ./ 我们/ 假设/ 了/ 一种/ 二维/ Mesh/ 结构/ 的/ NoC/ 只/ 由/ 路由器/ 和/ 链路/ 组成/ ,/ 不/ 考虑/ 与/ 处理器/ 核/ 的/ 接口/ 部分/ (/ 该/ 部分/ 功耗/ 可/ 算作/ 处理器/ 核/ 功耗/ )/ ,/ 那么/ NoC/ 的/ 功耗/ 可以/ 表示/ 成/ 路由器/ 和/ 链路/ 两个/ 组成部分/ :/ i/ (/ σ/ (/ r/ )/ P/ (/ r/ )/ j/ (/ σ/ (/ l/ )/ P/ (/ l/ )/ i/ ,/ f/ )/ =/ A/ (/ σ/ (/ r/ )/ j/ ,/ f/ )/ =/ A/ (/ σ/ (/ l/ )/ i/ ,/ C/ (/ r/ )/ ,/ I/ (/ r/ )/ 其中/ σ/ (/ r/ )/ 载/ 、/ 有效/ 电容/ 、/ 漏/ 电流/ ./ σ/ (/ l/ )/ 条/ 链路/ 的/ 通信/ 负载/ 、/ 有效/ 电容/ 、/ 漏/ 电流/ ./ 通信/ 负载/ 是/ 路由器/ 或/ 链路/ 各个/ 端口/ 每秒钟/ 到达/ flit/ 的/ 平均/ 数量/ ,/ 用来/ 衡量/ 路由器/ 或/ 链路/ 的/ 活动/ 率/ ./ 端口/ 到达/ 率/ 直接/ 影响/ 节点/ 内部/ 电路/ 器件/ 的/ 开关/ 活动/ ,/ 因此/ 通信/ 负载/ 与/ 功耗/ 公式/ 中/ 的/ 动态/ 因子/ 呈/ 线性关系/ ,/ 通过/ 拟合/ ORION2/ ./ 0/ 中/ 动态/ 功耗/ 与/ 通信/ 负载/ 的/ 关系/ 曲线/ 可以/ 得到/ 当/ NoC/ 节点/ 数/ 增加/ 时/ ,/ 网络/ 传递/ 消息/ 的/ 平均/ 距离/ 也/ 会/ 增加/ ,/ 因此/ 通信/ 负载/ 也/ 应/ 随之/ 增加/ ./ 而/ 另一方面/ ,/ 节点/ 数/ 增加/ 带来/ 共享/ Cache/ 容量/ 的/ 增大/ 减少/ 了/ 因/ Cache/ 缺失/ 带来/ 的/ 通信/ 开销/ ./ 通过/ 对/ 并行程序/ 运行/ 时/ 的/ 采样/ 观察/ 得到/ :/ (/ 1/ )/ 通信/ 负载/ 随/ 节点/ 数/ 增加/ 而/ 增加/ 的/ 趋势/ 非常/ 缓慢/ ;/ (/ 2/ )/ 节点/ 通信/ 负载/ 不仅/ 与/ 本地/ 处理器/ 核/ 注入/ 率/ 相关/ ,/ 而且/ 与/ 由片/ 外访/ 存/ 、/ 访问/ 相邻/ 节点/ 的/ 共享/ Cache/ 及/ 访问/ 本地/ 共享/ Cache/ 的/ 消息/ 到达/ 率/ 密切相关/ ./ 其中/ (/ 2/ )/ 是/ NoC/ 上/ 消息传递/ 的/ 主要/ 因素/ ,/ 因此/ 网络通信/ 负载/ 受/ 处理器/ 核/ 负载/ 影响/ 远/ 不及/ 受/ 节点/ 在/ 网络拓扑/ 结构/ 中/ 位置/ 的/ 影响/ 大/ ./ 因此/ 本文/ 对/ 每/ 一个/ 并行程序/ 执行/ 过程/ 中/ 的/ 通信/ 负载/ 取/ Page6/ 平均值/ ,/ 并/ 对/ 所有/ 节点/ 的/ 平均/ 通信/ 负载/ 取/ 平均值/ ,/ 作为/ 该/ 程序/ 在/ 能耗/ 模型/ 中/ 所有/ 节点/ 使用/ 的/ 通信/ 负载/ 数值/ ,/ 从而/ 获得/ 与/ 采集/ 各/ 节点/ 各自/ 通信/ 负载/ 接近/ 的/ 能耗/ 评价/ 结果/ ./ 整个/ NoC/ 的/ 功耗/ 应该/ 由/ 上述/ 式/ (/ 9/ )/ 、/ (/ 10/ )/ 表示/ 的/ 路由器/ 和/ 链路/ 功耗/ 乘以/ 各自/ 的/ 数量/ 取得/ ./ 二维/ MeshNoC/ 中/ 链路/ 数量/ 可以/ 写成/ 2n/ -/ 槡/ n/ [/ 31/ ,/ 33/ ]/ ,/ 如果/ 每条/ 链路/ 都/ 是/ 双向/ 的/ ,/ 那么/ NoC/ 总/ 功耗/ 可以/ 表示/ 成/ P/ (/ 珋/ σ/ ,/ f/ ,/ n/ )/ =/ ∑/ n5/ 性能/ 模型/ 分析/ 在/ 这/ 一/ 小节/ 中/ ,/ 我们/ 将/ 通过/ 尽可能/ 简单/ 的/ 公式/ 描述/ 并行/ 开销/ 约束/ 下/ 的/ 多线程/ 程序/ 性能/ ./ 在/ 计算机系统/ 中/ ,/ 处理器/ 核/ 、/ NoC/ 、/ 多级/ Cache/ 、/ 片上/ IO/ 控制器/ 和/ 片/ 上/ 内存/ 控制器/ 会以/ 同样/ 的/ 频率/ 运行/ ./ DVFS/ 等/ 频率/ 缩放/ 技术/ 将会/ 在/ 整个/ 芯片/ 上/ 应用/ ./ 本文/ 假设/ 一种/ 同构/ 的/ 多/ 核/ 结构/ ,/ 其/ NoC/ 节点/ 也/ 是/ 同构/ 的/ ./ 每/ 一个/ 节点/ 连接/ 一个/ 处理器/ 核/ 和/ 4/ 个/ 相邻/ 的/ 节点/ ,/ 不/ 包含/ 可/ 配置/ 的/ 部件/ 如/ 动态/ 缓存/ 等/ ,/ 但是/ 可以/ 调节/ NoC/ 节点/ 数目/ ./ 因为/ NoC/ 的/ 能耗/ 不仅/ 与/ NoC/ 功耗/ 模型/ 有关/ ,/ 还/ 与/ 程序执行/ 时间/ 有关/ ,/ 所以/ 性能/ 模型/ 必须/ 考虑/ 除/ NoC/ 外/ 的/ 所有/ 相关/ 部件/ ./ 性能/ 模型/ 的/ 形式/ 基于/ Amdahl/ 定律/ ,/ 假设/ p/ 是/ 程序/ 的/ 并行/ 部分/ ,/ Ts/ 是/ 程序/ 在/ 单核/ 上/ 运行/ 的/ 总/ 时间/ ,/ 则/ 该/ 程序运行/ 在/ n/ 个/ 核上/ 最大/ 能/ 获得/ 的/ 加速/ 比是/ 许多/ 研究/ 考虑/ 了/ “/ 非核/ ”/ 部件/ ,/ 比如/ NoC/ 和/ LLC/ (/ Last/ -/ LevelCache/ )/ ,/ 引入/ 了/ 访问共享/ Cache/ 、/ 线程/ 同步/ 、/ 通信/ 的/ 开销/ [/ 34/ ]/ ,/ 因此/ 上述/ 公式/ 可以/ 改写/ 成/ S/ =/ 其中/ Tcom/ 是/ 片/ 上/ 网络通信/ 时间/ ,/ Tllc/ 是/ 共享/ LLC/ 访问/ 时间/ (/ 包括/ 线程/ 同步/ 和/ 访问共享/ Cache/ 争用/ 产生/ 的/ 时间/ )/ ,/ Tmem/ 是/ 片/ 外访/ 存/ 时间/ ./ Tcom/ 对/ 节点/ 数/ n/ 的/ 依赖/ 关系/ 随着/ 不同/ 程序/ 类型/ 和/ 网络拓扑/ 而/ 改变/ ./ 文献/ [/ 34/ -/ 36/ ]/ 指出/ Tcom/ 随着/ n/ 的/ 增加/ 而/ 增加/ ,/ 并且/ 在/ 单/ 节点/ 处有/ Tcom/ 与/ 程序/ 的/ 问题/ 规模/ 并/ 不是/ 高度/ 相关/ 的/ ,/ 而是/ 与/ NoC/ 拓扑/ 结构/ 密切/ 关联/ ./ 例如/ ,/ Hennessy/ 等/ 人/ 在/ 文献/ [/ 37/ ]/ 中/ 给出/ 了/ 4/ 个/ 著名/ 应用/ 的/ 并行/ 开销/ 随/ n/ 的/ 变化/ 特征/ :/ LUKernel/ 、/ Barnes/ 和/ Ocean/ 具有/ Ο/ (/ 槡/ n/ )/ 复杂度/ ,/ FFT/ 具有/ Ο/ (/ n/ )/ 的/ 复杂度/ ./ 文献/ [/ 38/ ]/ 提到/ 对于/ quicksort/ 算法/ ,/ Tcom/ 随/ n/ 以/ Ο/ (/ nlogn/ )/ 的/ 规律/ 改变/ ./ 对于/ 不同/ 的/ 拓扑/ 结构/ ,/ hypercube/ 网络/ 中/ 的/ Tcom/ 有着/ Ο/ (/ logn/ )/ 的/ 复杂度/ [/ 34/ ]/ ,/ 而/ 二维/ Mesh/ 结构/ 的/ 网络/ 则/ 根据/ 不同/ 的/ 通信模型/ 分成/ 3/ 种/ 情况/ [/ 39/ ]/ :/ One/ -/ to/ -/ allBroadcast/ ,/ All/ -/ to/ -/ allBroadcast/ 和/ All/ -/ to/ -/ allScatter/ 三者/ 并行/ 开销/ 复杂度/ 下界/ 分别/ 是/ logn/ ,/ n/ 和/ n2/ ./ 本文/ 中/ 我们/ 考虑/ 一种/ 二维/ Mesh/ 结构/ ,/ 考虑/ 到/ 程序/ 的/ 多样性/ ,/ 其/ 并行/ 开销/ 也/ 分为/ 3/ 种/ 基本/ 模型/ :/ 次/ 线性/ logn/ ,/ 线性/ n/ 和/ 超/ 线性/ n2/ ./ 对于/ Tllc/ ,/ 文献/ [/ 33/ ]/ 提出/ 了/ 一种/ 评估/ LLC/ 开销/ 的/ 模型/ ,/ 指出/ LLC/ 的/ 访问/ 需求/ 是/ 随/ 节点/ 数/ n/ 增加/ 呈次/ 线性/ 增加/ 的/ 关系/ ./ LLC/ 的/ 访问/ 开销/ 主要/ 由/ 访存/ 消息/ 在/ NoC/ 上/ 的/ 传递/ 时间/ 决定/ ,/ 访存/ 消息/ 的/ 传递/ 与/ 线程/ 通信/ 的/ 传播/ 在/ 网络/ 行为/ 上/ 并/ 无/ 不同/ ,/ 因此/ 可以/ 将/ LLC/ 开销/ Tllc/ 与/ 通信/ 开销/ Tcom/ 合并/ 为/ 并行/ 开销/ TPO/ =/ Tcom/ +/ Tllc/ ,/ 并/ 归纳/ 为/ 3/ 个/ 基本/ 类型/ :/ TPO/ ~/ {/ logn/ ,/ n/ ,/ n2/ }/ ./ 片/ 外访/ 存/ 开销/ Tmem/ 可以/ 分成/ 两个/ 部分/ 之/ 和/ :/ 访存/ 消息/ 片上/ 传递/ 时间/ 和/ 片外/ 传递/ 时间/ ./ 前者/ 可/ 计算/ 在/ 并行/ 开销/ 当中/ ./ 因为/ 单一/ 访存/ 消息/ 在/ 片外/ 传递/ 时间/ 与/ 节点/ 数/ n/ 无关/ ,/ 因此/ 程序/ 的/ 片/ 外访/ 存/ 时间/ 只/ 与/ LLCmiss/ 后/ 发出/ 的/ 片/ 外访/ 存/ 消息/ 数量/ 成正比/ ./ 根据/ 文献/ [/ 40/ ]/ 提出/ 的/ “/ 30/ %/ 定律/ ”/ (/ Cache/ 容量/ 扩大/ 一倍/ ,/ Page7/ 失配/ 率/ 下降/ 30/ %/ )/ ,/ 文献/ [/ 41/ ]/ 推导/ 出/ 了/ Cache/ 容量/ 与/ 失配/ 率/ 之间/ 的/ 关系/ 为/ miss/ _/ rate/ =/ β/ C/ α/ ,/ 其中/ 常数/ β/ 是/ 正数/ ,/ 常数/ α/ 是/ 负数/ ,/ C/ 表示/ cache/ 容量/ ./ 本文/ 只/ 考虑/ 每个/ 节点/ 连接/ 的/ 共享/ LLC/ 的/ 容量/ 为/ C/ ,/ 则/ 片/ 外访/ 存/ 开销/ 可以/ 写成/ 其中/ λ/ =/ β/ C/ α/ 为/ 大于/ 0/ 的/ 常数/ ,/ α/ 是/ 负数/ ./ 对于/ 问题/ 规模/ 确定/ 的/ 应用/ ,/ 在/ 单核/ 上/ 执行/ 的/ 总/ 时间/ Ts/ 是/ 一个/ 常数/ ./ 因此/ 对式/ (/ 13/ )/ 可以/ 重写/ 为/ S/ =/ 11/ -/ p/ +/ p/ // n/ +/ wPO/ +/ wmem1/ -/ p/ +/ p/ // n/ +/ c/ {/ logn/ ,/ n/ -/ 1/ ,/ n2/ -/ 1/ }/ +/ λ/ n/ α/ (/ 16/ )/ =/ 其中/ wPO/ 是/ 并行/ 开销/ 部分/ ,/ c/ 为/ 并行/ 开销/ 系数/ ,/ wmem/ 是/ 片/ 外访/ 存/ 开销/ 部分/ ./ 文献/ [/ 24/ ]/ 指出/ 无论/ 并行/ 开销/ 采用/ 线性/ 还是/ 非线性/ 模型/ ,/ 加速/ 比/ 都/ 会/ 先/ 随/ 节点/ 数/ 增加/ 而/ 增加/ ,/ 当/ 达到/ 某一/ 节点/ 数量/ 后/ ,/ 加速/ 比会/ 随之/ 增加/ 而/ 降低/ ./ 图/ 4/ 显示/ 了/ 这/ 一/ 规律/ ,/ 式/ (/ 16/ )/ 中/ 并行/ 开销/ 系数/ c/ 因/ 程序/ 的/ 不同/ 有所/ 改变/ ,/ 并行/ 开销/ 部分/ 写成/ wPO/ =/ c/ {/ logn/ ,/ n/ -/ 1/ ,/ n2/ -/ 1/ }/ 是/ 为了/ 满足/ 式/ (/ 14/ )/ ./ 加速/ 比式/ (/ 16/ )/ 可以/ 分成/ 与/ 频率/ 相关/ 和/ 与/ 频率/ 不/ 相关/ 两个/ 部分/ ,/ 这/ 两/ 部分/ 的/ 划分/ 是/ 根据/ 影响/ 部件/ 的/ 位置/ 确定/ 的/ ./ 其中/ 片上/ 部件/ NoC/ 和/ LLC/ 均/ 受片/ 上/ 时钟/ 控制/ ,/ 同/ 处理器/ 核/ 共享/ 同一/ 频率/ ,/ 而片/ 外/ 存储/ 则/ 与/ 片/ 上/ 时钟/ 频率/ 无关/ ./ 因此/ 应用/ DVFS/ 频率/ 缩放/ 技术/ 的/ 多/ 核/ 处理器/ 加速/ 比/ 公式/ 应该/ 改写/ 为/ 如下/ 形式/ :/ S/ (/ f/ ,/ n/ )/ =/ 其中/ F/ 是/ 参考/ 频率/ ,/ 本文/ 设/ 为/ 最大/ 频率/ ./ 为了/ 能够/ 预测/ 每/ 一个/ 程序/ 的/ 加速/ 比/ 曲线/ ,/ 有/ 必要/ 研究/ 如何/ 为/ 程序/ 选择/ 一个/ 合适/ 并行/ 开销/ 模型/ 和/ 片/ 外访/ 存/ 模型/ ./ 本文/ 采用/ 在/ 不/ 使用/ 频率/ 缩放/ 技术/ 的/ 情况/ 下/ 对/ 加速/ 比和片/ 外访/ 存/ 消息/ 数量/ 进行/ 采样/ ./ 确定/ 片/ 外访/ 存/ 开销/ 和/ 并行/ 开销/ 的/ 过程/ 如下/ :/ (/ 1/ )/ 首先/ 通过/ 拟合/ 片/ 外访/ 存/ 消息/ 数量/ 和/ LLC/ 容量/ 的/ 采样/ 曲线/ 获得/ 式/ (/ 15/ )/ 中/ 的/ α/ 值/ ./ (/ 2/ )/ 利用/ 可决/ 系数/ 来/ 从/ 3/ 种/ 模型/ {/ logn/ ,/ n/ -/ 1/ ,/ n2/ -/ 1/ }/ 中/ 选择/ 最合适/ 的/ 并行/ 开销/ 模型/ :/ 这里/ Si/ 是/ 第/ i/ 个/ 采样/ 值/ ,/ ^/ Si/ 是/ 有/ 当前/ 模型/ 计算/ 出/ 的/ 第/ i/ 个/ 数值/ ,/ 珚/ S/ 是/ 采样/ 的/ 平均值/ ./ 计算/ 3/ 种/ 模型/ 的/ 可决/ 系数/ R2/ ,/ 应该/ 落/ 在/ 区间/ [/ 0/ ,/ 1/ ]/ ,/ 然后/ 选择/ 可决/ 系数/ 最大/ 的/ (/ 最/ 接近/ 1/ )/ 的/ 模型/ 作为/ 并行/ 开销/ 模型/ ./ 6/ 片上/ 网络/ 性能/ -/ 能耗/ 分析/ 和/ 优化/ 6.1/ NoC/ 性能/ -/ 能耗/ 模型/ 假设/ tn/ 为/ 并行程序/ 在/ n/ 个/ 节点/ 上/ 执行/ 完毕/ 所/ 需/ 的/ 总/ 时间/ ./ 那么/ 执行/ 该/ 程序/ 所/ 需/ 的/ NoC/ 能耗/ 可以/ 写成/ 这里/ 功耗/ 来自/ 于/ 公式/ (/ 12/ )/ ,/ tn/ 包括/ 程序/ 串行/ 部分/ 和/ 并行/ 部分/ 的/ 执行/ 时间/ ./ 因为/ 分布式/ 的/ 共享/ Cache/ 被/ 广泛/ 使用/ 在/ 多/ 核/ 结构/ 中/ ,/ 所以/ 程序/ 的/ 串行/ 部分/ 只/ 运行/ 在/ 单核/ 上/ 也/ 会/ 导致/ 整片/ NoC/ 所有/ 可用/ 节点/ 都/ 处于/ 工作/ 状态/ ,/ 因此/ 本文/ 不/ 特别/ 区分/ 串行/ 部分/ 和/ 并行/ 部分/ 的/ 能耗/ ,/ 认为/ 所有/ 可用/ 节点均/ 在/ 程序运行/ 过程/ 中/ 工作/ 并/ 消耗/ 能量/ ./ 从式/ (/ 17/ )/ 中/ 可以/ 得到/ 与/ 性能/ 关联/ 的/ 频率/ 表达式/ :/ S/ ·/ F/ ·/ 1/ -/ p/ +/ pf/ =/ S/ ·/ F/ ·/ 1/ -/ p/ +/ p/ =/ 这/ 里面/ 并行/ 开销/ 和/ 片/ 外访/ 存/ 开销/ 的/ 类型/ 选择/ 与/ 参数/ 都/ 需要/ 由/ 所/ 执行/ 的/ 程序/ 决定/ ,/ 因此/ 不同/ 程序/ 也/ 是/ 影响/ 频率/ -/ 性能/ 关系/ 的/ 因素/ ./ 于是/ ,/ 频率/ 可以/ 写成/ 一个/ 加速/ 比/ 、/ 节点/ 数/ 和/ 程序/ 特性/ 决定/ 的/ 函数/ :/ 假设/ T/ 是/ 程序/ 以/ 最高/ 频率/ F/ 在/ 单核/ 上/ 的/ 执行/ 时间/ ,/ 则/ 该/ 程序/ 在/ n/ 个/ 核上/ 的/ 执行/ 时间/ 是/ tn/ =/ T/ // S/ ,/ 于是/ NoC/ 的/ 总/ 能耗/ 可以/ 表示/ 为/ Page8/ 其中/ 平均/ 通信/ 负载/ 珋/ σ/ 由/ 程序/ 特性/ 决定/ ,/ T/ 也/ 是/ 由/ 所/ 执行程序/ 确定/ 的/ 常数/ ./ 6.2/ NoC/ 性能/ -/ 能耗/ 优化/ 在/ 本文/ 的/ 研究/ 中/ ,/ 我们/ 只/ 关注/ 在/ 多/ 核/ 处理器/ 上/ 执行/ 单一/ 程序/ 的/ 情况/ (/ 单任务/ )/ ./ 针对/ 与/ 执行/ 某一/ 程序/ 的/ 多/ 核/ 处理器/ ,/ 其/ NoC/ 能耗/ 的/ 优化/ 问题/ 可以/ 定义/ 为/ :/ 在/ 不/ 低于/ 当前/ 性能/ 或/ 目标/ 性能/ 的/ 前提/ 下/ ,/ 获得/ NoC/ 最低/ 能耗/ 所/ 需要/ 的/ 节点/ 数及/ 相对/ 应/ 的/ 操作/ 频率/ ./ 形式化/ 表示/ 为/ 问题/ I/ :/ MinE/ (/ S/ ,/ n/ )/ s/ ./ t/ ./ f/ =/ 其中/ Starget/ 是/ 目标/ 性能/ ,/ 可以/ 解/ 出/ 最低/ 能耗/ 时/ 的/ 节点/ 数/ nE/ 管理/ 方案/ ./ opt/ 和/ 相应/ 的/ 频率/ fE/ 以/ NoC/ 能耗/ 为/ 约束/ 的/ 处理器/ 性能/ 优化/ 问题/ 可以/ 定义/ 为/ :/ 在/ 不/ 高于/ 当前/ NoC/ 能耗/ 或/ 目标/ NoC/ 能耗/ 前提/ 下/ ,/ 获得/ 处理器/ 最大/ 性能/ 所/ 需要/ 的/ 节点/ 数/ 和/ 操作/ 频率/ ./ 其/ 形式化/ 表示/ 为/ 问题/ II/ :/ MaxS/ (/ f/ ,/ n/ )/ =/ s/ ./ t/ ./ f/ =/ E/ (/ S/ ,/ n/ ,/ apps/ )/ </ Etarget/ 其中/ Etarget/ 是/ 目标/ NoC/ 能耗/ ,/ 解该/ 问题/ 可/ 得到/ 最大/ 性能/ 时/ 的/ 节点/ 数/ nS/ 上/ 的/ 最大/ 性能/ 管理/ 方案/ ./ 图/ 5/ 显示/ 了/ 不/ 改变/ 性能/ 前提/ 下/ NoC/ 能耗/ 随/ 节点/ 数/ 变化/ 的/ 规律/ ./ 可以/ 看到/ ,/ 考虑/ 了/ 并行/ 开销/ 和/ 与/ 频率/ 无关/ 功耗/ 的/ ModelC/ +/ PO/ 具有/ 最快/ 的/ 能耗/ 增加/ ,/ 并且/ 在/ 节点/ 数/ 可调/ 范围/ 内/ 存在/ 最低/ 能耗/ 值/ ./ 而/ 没有/ 考虑/ 并行/ 开销/ 和/ 频率/ 无关/ 功耗/ 的/ ModelD/ 在/ 这/ 一/ 范围/ 内/ 不/ 存在/ 最低/ 能耗/ ,/ ModelC/ +/ PO/ 有着/ 截然不同/ 的/ 趋势/ ,/ 因此/ 必须/ 选择/ 准确/ 的/ 建模/ 方式/ 才能/ 得到/ 优化/ 问题/ 的/ 最优/ 解/ ./ 图/ 6/ 显示/ 了/ 不/ 改变/ NoC/ 能耗/ 的/ 前提/ 下/ 处理器/ 性能/ 随/ 节点/ 数/ 变化/ 的/ 规律/ ./ 可以/ 看到/ ,/ 考虑/ 了/ 并行/ 开销/ 和/ 片/ 外访/ 存/ 开销/ 的/ 加速/ 比/ 存在/ 一个/ 最大值/ ./ 甚至/ 使用/ 了/ ModelC/ +/ PO/ 能耗/ 模型/ 的/ 加速/ 比/ 曲线/ 出现/ 了/ N/ =/ 2/ 和/ N/ =/ 4/ 两个/ 接近/ 的/ 最大值/ ./ 我们/ 知道/ 这是/ 非线性/ 优化/ 的/ 结果/ ,/ 这种/ 情况/ 下/ 可以/ 选择/ 较少/ 的/ 节点/ 数/ 取得/ 最优/ 解/ ,/ 大幅/ 节省/ 了/ 片/ 上/ 资源/ ./ 图/ 5/ 性能/ 约束/ 为/ S/ =/ 1/ 时/ 的/ NoC/ 能耗/ (/ 程序/ 为/ streamcluster/ )/ 图/ 6/ 能耗/ 约束/ 下/ 的/ 处理器/ 性能/ (/ 目标/ 能耗/ 为单/ 节点/ 6.3/ 片上/ 网络/ 性能/ -/ 能耗/ 优化/ 方法/ 针对/ 上/ 一/ 小节/ 提出/ 的/ 两个/ 优化/ 问题/ ,/ 本/ 小节/ 提出/ 了/ 一种/ 可/ 操作/ 的/ 优化/ 方法/ ./ 通过/ 尽可能少/ 的/ 对/ 并行程序/ 和/ NoC/ 运行/ 时/ 进行/ 采样/ ,/ 获得/ 上/ 小节/ 中/ 性能/ -/ 能耗/ 模型/ 的/ 基本参数/ 用来/ 准确/ 描述/ 性能/ -/ 能耗/ 变化趋势/ ./ 下面/ 详细/ 列出/ 针对实际/ 并行程序/ 的/ 性能/ -/ 能耗/ 优化/ 方法/ 实施/ 步骤/ ,/ 具体/ 流程/ 可/ 参照/ 图/ 7.1/ ./ 对/ 某/ 一/ 并行程序/ 进行/ 以/ 性能/ // 能耗/ 为/ 约束/ 的/ 能耗/ // 性能/ 优化/ 首先/ 需要/ 采样/ 确立/ 性能/ -/ 能耗/ 模型/ 的/ 具体/ 表达式/ ,/ 因此/ 需要/ 在/ 多/ 核/ 处理器/ 上以/ 不同/ 节点/ 数在/ 最高/ 频率/ 下/ 执行/ 至少/ 3/ 次/ (/ 除片/ 外访/ 存/ 开销/ 指数/ 可/ 单独/ 拟合/ 外/ ,/ 有/ 3/ 个/ 未知/ 参数/ p/ ,/ c/ ,/ λ/ )/ ./ 记录/ 至少/ 3/ 次/ 执行/ 的/ 加速/ 比/ 、/ 平均/ 通信/ 负载/ 珋/ σ/ 、/ 片/ 外访/ 存/ 消息/ 数/ ./ 2/ ./ 利用/ n/ α/ 拟合/ 步/ 1/ 中/ 记录/ 的/ 不同/ 节点/ 数/ 的/ 片/ 外访/ 存/ 消息/ 数/ ,/ 获得/ 负/ 指数/ α/ ,/ 访存/ 系数/ λ/ 待定/ ./ 3/ ./ 传递/ 参数/ α/ 到/ 3/ 个/ 并行/ 开销/ 模型/ 中/ ,/ 分别/ 使用/ 这/ 3/ 种/ 模型/ 利用/ 步/ 1/ 中/ 得到/ 的/ 3/ 种/ 不同/ 节点/ 数下/ 加速/ 比解出/ 参数/ p/ ,/ c/ ,/ λ/ ./ 4/ ./ 通过/ 比较/ 3/ 个/ 模型/ 的/ 可决/ 系数/ 确定/ 性能/ 表达式/ ./ 同时/ 通过/ 步/ 1/ 获得/ 的/ 平均/ 通信/ 开销/ 与/ 性能/ 表达式/ 联合/ 确定/ NoC/ 能耗/ 方程/ (/ 式/ (/ 17/ )/ )/ ./ 5/ ./ 如果/ 优化/ 问题/ 为/ 问题/ I/ ,/ 输入/ 目标/ 性能/ ,/ 解/ 非线性/ 优/ Page9/ 化/ 问题/ ,/ 得到/ n/ E化/ 问题/ ,/ 得到/ nS6/ ./ 如果/ 优化/ 问题/ 为/ 问题/ II/ ,/ 输入/ 目标/ 性能/ ,/ 解/ 非线性/ 优图/ 7/ 片上/ 网络/ 性能/ 、/ 能耗/ 优化/ 流程/ 7/ 实验/ 平台/ 为了/ 验证/ 上/ 一节/ 中/ 的/ 分析模型/ 和/ 优化/ 方法/ ,/ 我们/ 引入/ 了/ 一套/ 可变/ 节点/ 数/ 的/ 多线程/ 程序/ 模拟/ 平台/ ./ 在/ 这/ 一节/ 中/ ,/ 将/ 介绍/ 这个/ 平台/ 的/ 结构/ 及/ 所/ 使用/ 的/ 应用程序/ 集/ ./ 7.1/ 模拟/ 平台/ 结构/ 我们/ 假设/ 了/ 一个/ 同构/ 的/ 16/ 核/ 处理器/ ,/ 每/ 一个/ 核/ 都/ 是/ 模拟/ 一个/ Sparc/ -/ III/ -/ plus/ 处理器/ ,/ 其片/ 上/ 网络/ 也/ 是/ 由/ 16/ 个/ 节点/ 连接成/ 的/ 二维/ Mesh/ 结构/ ,/ 其中/ 每/ 一个/ 节点/ 连接/ 一个/ 处理器/ 核/ ./ 图/ 3/ 显示/ 了/ 这个/ 片上/ 网络/ 的/ 具体/ 构成/ ,/ 而表/ 2/ 列举/ 了/ 所/ 模拟/ 处理器/ 的/ 工艺/ 参数/ 和/ 结构/ 参数/ ./ 其/ 工艺/ 参数/ 来自/ 于/ ITRS/ ①/ 并且/ 通过/ ORION2/ ./ 0/ 评估/ 其/ NoC/ 规模/ 应该/ 覆盖/ 250mm2/ 的/ 芯片/ 面积/ ./ 所有/ 核/ 共享/ 4GB/ 的/ 片外/ 存储/ 和/ 4MB/ 的/ 片/ 上/ 分布式/ 共享/ L2Cache/ ,/ 其中/ 共享/ L2Cache/ 采用/ 一种/ MESI/ 一致性/ 协议/ ./ 此外/ ,/ 每/ 一个/ 核/ 通过/ 一块/ 私有/ L1Cache/ (/ 包括/ 指令和数据/ L1Cache/ )/ 相连/ ,/ L1Cache/ 又/ 与/ 本地/ 的/ 共享/ L2Cache/ 相连/ ,/ 本地/ 的/ 7/ ./ 将步/ 5/ 或/ 6/ 中/ 所得/ (/ nE/ 次/ 执行/ 该/ 程序/ 的/ 节点/ 数/ 和/ 相应/ 的/ 频率/ ,/ 即可/ 获得/ 性能/ 或/ 能耗/ 的/ 最优/ 值/ ./ 共享/ L2Cache/ 又/ 与/ 本地/ 处理器/ 核/ 公用/ 一个/ 连接/ 网络/ 节点/ 路由器/ 的/ 接口/ ,/ 用来/ 与/ 其它/ 处理器/ 核/ 、/ 共享/ Cache/ 和/ 片外/ 存储/ 进行/ 通信/ ./ 片外/ 存储/ 的/ 访问/ 必须/ 通过/ 位于/ 四周/ 的/ 8/ 个/ 内存/ 控制器/ 进行/ 访问/ ./ 技术参数/ 工艺/ 频率/ 调节/ 范围/ 电压/ 调节/ 范围/ 供电/ 电压/ 阈值电压/ 结构/ 参数/ 节点/ 数/ 调节/ 范围/ L1CacheL2CacheMemory/ 片上/ 网络/ 的/ 规模/ 可以/ 从/ 1/ 到/ 16/ 个/ 核/ 进行/ 调整/ ,/ 因为/ 每条/ 边上/ 都/ 有/ 两个/ 内存/ 控制器/ ,/ 为了/ 使/ 不同/ 节/ ①/ ITRS/ :/ http/ :/ // // www/ ./ itrs/ ./ net/ // Page10/ 点数/ 的/ 子/ 网络/ 分配/ 相同/ 比例/ 的/ 内存/ 控制器/ ,/ 图/ 3/ 中/ 显示/ 了/ 调整/ 网络/ 规模/ 的/ 方法/ :/ 每/ 一种/ 节点/ 数/ 的/ 配置/ 都/ 采用/ 16/ 节点/ 网络/ 中/ 的/ 子/ 网络/ ,/ 这样/ 可以/ 保证/ 在/ 使用/ 少于/ 16/ 个/ 节点/ 的/ 子/ 网络/ 时/ 其它/ 处于/ 节能/ 关闭/ 状态/ 的/ 节点/ 不会/ 影响/ 其它/ 工作/ 节点/ 的/ 消息传递/ ,/ 也/ 不/ 需要/ 修改/ 当前/ 的/ 路由/ 策略/ ./ 本文/ 的/ 节点/ 数/ 调节/ 并/ 不是/ 连续/ 的/ ,/ 我们/ 采用/ 1/ 、/ 2/ 、/ 4/ 、/ 8/ 、/ 12/ 、/ 16/ 个/ 节点/ 数/ 作为/ 性能/ -/ 能耗/ 优化/ 的/ 可选/ 配置/ ./ 当/ 程序/ 需要/ 执行/ 在/ 少于/ 16/ 个/ 节点/ 的/ 子/ 网络/ 时/ ,/ 其它/ 不/ 工作/ 的/ 节点/ 包括/ 与其/ 相连/ 的/ 核/ 和/ Cache/ 都/ 将/ 关闭/ 以/ 节省/ 能耗/ ,/ 这个/ 策略/ 在/ 多任务/ 的/ 情况/ 下/ 可以/ 调整/ 为/ 划分/ 给/ 其它/ 任务/ 使用/ ,/ 在/ 本文/ 中暂/ 不/ 对/ 多任务/ 的/ 性能/ -/ 能耗/ 优化/ 做/ 进一步/ 的/ 探讨/ 和/ 实验/ 分析/ ./ 简单/ 起/ 见/ ,/ 我们/ 假设/ 整片/ 的/ 电压/ 频率/ 是/ 同时/ 调节/ 的/ ./ 频率/ 的/ 调节/ 从/ 0/ 到/ 4GHz/ ,/ 而/ 供电/ 电压/ 的/ 调节/ 范围/ 是从/ 阈值电压/ 0.195/ V/ 到/ 1.2/ V/ ,/ 这/ 两个/ 范围/ 均是由/ ORION2/ ./ 0/ 中/ 65nm/ 工艺/ LVT/ 设置/ 下/ 取得/ 的/ 参数/ ./ 7.2/ 测试程序/ 集/ 简介/ 在/ 本文/ 的/ 实验/ 采用/ 8/ 个/ 来自/ PARSEC2/ ./ 1/ [/ 53/ ]/ 程序/ 集/ 的/ 并行程序/ ,/ 分别/ 是/ blackscholes/ ,/ bodytrack/ ,/ ferret/ ,/ fluidanimate/ ,/ streamcluster/ ,/ swaptions/ ,/ x264/ 和/ vips/ ./ 每/ 一个/ 程序/ 在/ 执行/ 时/ 都/ 跳/ 过/ 了/ 初始化/ 阶段/ ,/ 只/ 保留/ 了/ 很少/ 一部分/ 串行/ 代码/ 和/ 整个/ 并行/ 代码/ 部分/ ./ 本文/ 选择/ 中等/ 规模/ 的/ 问题/ 作为/ 输入/ (/ medium/ 表/ 3/ 测试程序/ 集/ 应用程序/ 领域/ 数据共享/ 度/ 通信/ 度/ 并行/ 开销/ 模型/ 并行/ 部分/ 比例/ 并行/ 开销/ 系数/ cWPO/ (/ N/ =/ 4/ )/ WPO/ (/ N/ =/ 16/ )/ 平均/ 通信/ 负载/ blackscholes/ 金融/ 分析/ 低低/ n2bodytrack/ 计算机/ 视觉/ 高中/ n2ferret/ 相似性/ 搜索/ 高高/ n0/ ./ 9400.0120/ ./ 0480.1920/ ./ 07fluidanimate/ 动画/ 低中/ Logn0/ ./ 9400.0240/ ./ 0480.0960/ ./ 03streamcluster/ 数据挖掘/ 低中/ n2swaptions/ 金融/ 分析/ 低低/ n2vips/ 多媒体/ 低中/ n2X264/ 多媒体/ 高高/ Logn0/ ./ 9300.050/ ./ 10.28/ 实验/ 结果/ 分析/ 在/ 本节/ 中/ ,/ 实验/ 分为/ 两个/ 部分/ :/ (/ 1/ )/ 验证/ 性能/ -/ 能耗/ 模型/ 的/ 准确性/ ./ (/ 2/ )/ 验证/ 6.3/ 小节/ 中/ 提出/ 的/ 优化/ 方法/ 的/ 有效性/ ./ 针对/ (/ 1/ )/ 验证/ 性能/ -/ 能耗/ 模型/ 的/ 准确性/ ,/ 我们/ 使用/ 6.3/ 小节/ 中/ 的/ 采样/ 部分/ 获得/ 能耗/ 模型/ 中/ 的/ 通信/ 负载/ 和/ 性能/ 模型/ 中/ 的/ 并行/ 开销/ 模型/ 、/ 并行/ 开销/ 系数/ 、/ 并行/ 部分/ 比例/ 、/ 片/ 外访/ 存/ 开销/ 指数/ 和/ 系数/ ,/ 这些/ 参数/ 已经/ 在/ 表/ 3/ 中/ 列出/ ./ 将/ 这些/ 参数/ 代入/ 性能/ -/ 能耗/ 模型/ ,/ 分别/ 以/ 目标/ 性能/ 和/ 目标/ 能耗/ 为/ 约束/ 预测/ 各个/ 节点/ 数目/ 下/ 能耗/ 和/ 性能/ 的/ 数值/ ,/ 并/ 与/ 模拟/ 的/ 结果/ 进行/ 比较/ ./ 针对/ (/ 2/ )/ 则/ 按照/ 6.3/ 小节/ 中/ 优化/ 方法/ packages/ )/ 来/ 保证/ 每/ 一个/ 程序/ 有/ 足够/ 长/ 的/ 模拟/ 时间/ 用以/ 采样/ 数据/ ./ 在/ 实验/ 过程/ 中/ ,/ 改变/ 节点/ 数/ 和/ 频率/ 的/ 同时/ 不会/ 改变/ 问题/ 的/ 输入/ 规模/ ,/ 这样/ 使/ 同一/ 程序/ 在/ 不同/ 频率/ 、/ 节点/ 数下/ 取得/ 的/ 数据/ 具有/ 实际意义/ ./ 表/ 3/ 中/ 列举/ 了/ 8/ 个/ 应用程序/ 及/ 它们/ 的/ 特征/ ./ 表/ 3/ 中/ 的/ 并行/ 开销/ 系数/ 、/ 并行/ 开销/ 模型/ 、/ 并行/ 部分/ 比例/ 和/ 平均/ 通信/ 负载/ 都/ 由/ 下/ 一节/ 中/ 的/ 实验/ 采样/ 得到/ ./ 从表/ 3/ 中/ 观察/ 到/ ,/ 并行/ 开销/ 系数/ 指示/ 了/ 并行/ 开销/ 在/ 节点/ 数较/ 少时/ 的/ 基本/ 比重/ ,/ 随着/ 节点/ 数/ 的/ 增加/ ,/ 并行/ 开销/ 按照/ 其/ 模型/ 规律/ 增加/ ./ 因此/ ,/ 对于/ 并行/ 开销/ 系数/ 较大/ 而/ 开销/ 模型/ 为次/ 线性/ 或/ 线性/ 的/ 程序/ ,/ 其/ 并行/ 开销/ 在/ 低/ 节点/ 数时/ 高于/ 其它/ 程序/ ,/ 而/ 在/ 高/ 节点/ 数时/ 可能/ 会/ 落后/ 于/ 并行/ 开销/ 系数/ 却/ 具有/ 超/ 线性/ 增长/ 的/ 程序/ ./ 文本/ 采样/ 并/ 计算/ 了/ 每个/ 程序/ 在/ N/ =/ 4/ (/ 低/ 节点/ 数/ )/ 和/ N/ =/ 16/ (/ 高/ 节点/ 数/ )/ 时/ 的/ 并行/ 开销/ ,/ 得到/ 程序/ ferret/ ,/ fluid/ -/ animate/ 和/ x264/ 在/ 低/ 节点/ 数和高/ 节点/ 数处/ 均/ 有/ 较大/ 的/ 并行/ 开销/ ,/ 因为/ 它们/ 具有/ 足够/ 大/ 的/ 系数/ c/ ./ 而/ streamcluster/ 和/ vips/ 在/ 低/ 节点/ 数处/ 是/ 小/ 开销/ 而/ 在/ 高/ 节点/ 数处/ 是/ 大/ 开销/ ,/ 因为/ 它们/ 具有/ 超/ 线性/ 增长/ 的/ 开销/ 模型/ ./ 其它/ 程序/ blackscholes/ ,/ bodytrack/ ,/ swap/ -/ tions/ 在/ 低/ 节点/ 数和高/ 节点/ 数处/ 均/ 是/ 小/ 开销/ ,/ 而/ 这些/ 程序/ 的/ 开销/ 模型/ 都/ 是/ 超/ 线性/ 的/ ,/ 本文/ 的/ 节点/ 数/ 扩展性/ 有限/ ,/ 当/ 节点/ 数/ 足够/ 大时/ (/ 远大于/ 16/ )/ ,/ 具有/ 超/ 线性/ 增长/ 的/ 并行/ 开销/ 将会/ 超越/ 其它/ 程序/ ./ 的/ 流程/ 取得/ 优化/ 的/ 节点/ 数/ 和/ 频率/ 配置/ ,/ 然后/ 在/ 模拟器/ 上/ 执行/ 优化/ 配置/ 得到/ 最优/ 能耗/ 或/ 性能/ ,/ 与/ 模拟器/ 搜索/ (/ 节点/ 数/ ,/ 频率/ )/ 空间/ 得到/ 的/ 最优/ 值/ 进行/ 分析/ 比较/ ./ 8.1/ NoC/ 能耗/ 优化/ 结果/ 在/ 本/ 实验/ 中/ ,/ 通过/ 采样/ 得到/ 性能/ -/ 能耗/ 模型/ 中/ 的/ 各个/ 参数/ ,/ 如表/ 3/ 中所/ 列出/ ,/ 确立/ 了/ 针对/ 每个/ 程序/ 的/ 性能/ -/ 能耗/ 模型/ 的/ 具体/ 形式/ ./ 在/ 本/ 小节/ 的/ 实验/ 中/ 进行/ 以下/ 两个/ 实验/ :/ (/ 1/ )/ 以/ 目标/ 性能/ 作为/ 约束条件/ ,/ 通过/ 能耗/ 模型/ 计算/ 程序/ 在/ 每个/ 节点/ 数下/ 的/ 能耗/ 值/ ,/ 与/ 传统/ 建模/ 方法/ 计算/ 的/ 能耗/ 值/ 做出/ 比较/ 分析/ ./ 同时/ 与/ 模拟器/ 得到/ 的/ 接近/ 真实/ 系统/ 的/ 能耗/ 做/ 比较/ 分析/ ;/ (/ 2/ )/ 利用/ 6.3/ 小节/ 中/ 的/ 优化/ 方法/ 解/ 出/ 问题/ I/ 的/ 优化/ 配置/ (/ nEPage11/ 和/ 频率/ 配置/ ,/ 在/ 模拟器/ 上/ 得到/ 执行/ 后/ 的/ 能耗/ ./ 与/ 模拟器/ 全速/ 执行/ 在/ 16/ 核/ 、/ 单核/ 和/ 经/ 搜索/ 得到/ 的/ 实际/ 最低/ 能耗/ 做出/ 对比/ 分析/ ./ 在/ 这节/ 实验/ 中/ ,/ 作为/ 目标/ 性能/ 我们/ 选取/ 了/ 3/ 个/ 不同/ 的/ 等级/ :/ (/ 1/ )/ “/ 低/ ”/ 目标/ 性能/ ,/ 等效于/ 程序/ 在/ 单核/ 上/ 执行/ 时/ 最高/ 性能/ 的/ 1/ // 2/ ./ (/ 2/ )/ “/ 中/ ”/ 目标/ 性能/ ,/ 等效于/ 程序/ 在/ 单核/ 上/ 执行/ 的/ 最高/ 性能/ ./ (/ 3/ )/ “/ 高/ ”/ 目标/ 性能/ ,/ 等效于/ 程序/ 在/ 2/ 个/ 核/ 执行/ 的/ 最高/ 性能/ ./ 这种/ 设置/ 的/ 目的/ 在于/ 了解/ 不同/ 目标/ 性能/ 对/ 能耗/ 最小值/ 及其/ 配置/ 参数/ 的/ 影响/ ./ 图/ 7/ 展示/ 了/ 在/ 这/ 3/ 种/ 不同/ 目标/ 性能/ 约束/ 下/ ,/ 本文/ 性能/ -/ 能耗/ 模型/ ModelC/ +/ PO/ (/ 同时/ 引入/ 了/ 与/ 频率/ 无关/ 功耗/ 、/ 并行/ 开销/ 、/ 片/ 外访/ 存/ 开销/ )/ ,/ 与/ 传统/ 模型/ 和/ 模拟器/ 能耗/ 的/ 对比/ ./ 在/ (/ 1/ )/ 、/ (/ 2/ )/ 中/ 所有/ 能耗/ 向/ 模拟器/ 单核/ 执行/ 时/ 的/ 能耗/ 做/ 归一化/ 处理/ ,/ (/ 3/ )/ 中/ 所有/ 能耗/ 向/ 模拟器/ 2/ 个/ 核/ 执行/ 时/ 的/ 能耗/ 做/ 归一化/ 处理/ ./ 首先/ ,/ 在/ 实验/ (/ 1/ )/ 中/ ,/ 各个/ 性能/ -/ 能耗/ 模型/ 在/ 各/ 节点/ 数下/ 的/ 能耗/ 可以/ 由/ 公式/ 直接/ 计算/ 得出/ ,/ 其/ 频率/ 可以/ 由式/ (/ 19/ )/ 计算/ 得出/ ./ 模拟器/ 功耗/ 和/ 性能/ 在/ 本文/ 中/ 认为/ 是/ 最/ 接近/ 真实情况/ 的/ ,/ 其它/ 模型/ 的/ 评价/ 均/ 以/ 模拟器/ 的/ 运行/ 情况/ 作为/ 参考/ ./ 在/ 某/ 一节/ 点数/ ,/ 模拟器/ 频率/ 从/ 100MHz/ 到/ 4GHz/ 以/ 100MHz/ 为/ 步长/ 调节/ ,/ 每/ 调节/ 一次/ 将/ 程序/ 重新/ 执行/ 一次/ ,/ 直到/ 在/ 该/ 节点/ 数满图/ 8/ 各/ 模型/ 以/ 模拟器/ 单/ 节点/ 性能/ 为/ 目标/ 性能/ 得到/ 的/ 预测/ 能耗/ 足/ 目标/ 性能/ ,/ 记录/ 该/ 频率/ 和/ 能耗/ ,/ 然后/ 节点/ 数加/ 1/ 重新/ 开始/ 搜索/ ,/ 这种/ 方法/ 称为/ ExhaustiveAttemptSimulation/ (/ 简写/ 为/ Simulation/ 或/ 搜索/ 执行/ )/ ,/ 可以/ 找到/ 所有/ 节点/ 数目/ 下/ 刚好/ 满足/ 目标/ 性能/ 的/ 频率/ 和/ 能耗/ 值/ ,/ 其所测/ 能耗/ 在/ 本文/ 中/ 认为/ 是/ 理想/ 准确/ 的/ ./ 搜索/ 执行/ 所得/ 的/ 最低/ 能耗/ 值/ 就是/ 模拟器/ 实测/ 最优/ 值/ ./ 图/ 8/ 显示/ ,/ 无论/ 在/ 哪/ 一级/ 目标/ 性能/ 约束/ 下/ ,/ 本文/ 提出/ 的/ ModelC/ +/ PO/ 都/ 能/ 很/ 好/ 地/ 符合/ 模拟器/ 测得/ 的/ 结果/ ./ 不/ 引入/ 并行/ 开销/ 的/ ModelC/ 对于/ 低到/ 中级/ 通信量/ 的/ 程序/ 也/ 能/ 很/ 好/ 地/ 符合/ 模拟器/ 结果/ ,/ 例如/ blackscholes/ ,/ bodytrack/ 和/ swaptions/ ./ 但是/ 对于/ ferret/ ,/ fluidanimate/ ,/ x264/ ,/ vips/ ,/ streamcluster/ 等/ 中/ 高/ 通信量/ 的/ 程序/ 不能/ 很/ 好/ 地/ 符合实际/ 能耗/ 趋势/ ./ 并且/ 对于/ 这些/ 通信/ 密集型/ 的/ 应用/ ,/ ModelCw/ // oPO/ 模型/ 随着/ 节点/ 数/ 的/ 增多/ 而/ 偏离/ 模拟器/ 实测值/ 越/ 多/ ,/ 这/ 是因为/ 并行/ 开销/ 对/ 性能/ -/ 能耗/ 模型/ 的/ 影响/ 也/ 随着/ 节点/ 数/ 增加/ 而/ 增加/ ./ ModelD/ +/ PO/ 模型/ 基本上/ 不能/ 准确/ 跟随/ 实测值/ 的/ 变化趋势/ ./ 因此/ 传统/ 功耗/ 模型/ 对/ 能耗/ 预测/ 的/ 偏离/ 是/ 巨大/ 的/ ./ 需要/ 指出/ 的/ 是/ ,/ 模型/ ModelDw/ // oPO/ 因为/ 偏差/ 巨大/ 不/ 具有/ 比较/ 的/ 意义/ ,/ 因此/ 不/ 在/ 实验/ 中/ 列出/ ./ 上述/ 所有/ 模型/ 均/ 含有/ 片/ 外访/ 存/ 开销/ ,/ 因为/ 这部分/ 开销/ 与/ 频率/ 无关/ ,/ 对/ 使用/ DVFS/ 性/ Page12/ 能/ -/ 能耗/ 模型/ 影响/ 不/ 大/ ,/ 所以/ 不/ 单独/ 列出/ 进行/ 比较/ ./ 从图/ 8/ 还/ 可以/ 观察/ 到/ ,/ 对于/ “/ 低/ ”/ 目标/ 性能/ ,/ 达到/ 能耗/ 最低值/ 所用/ 节点/ 数量/ 较/ 小/ ,/ 随着/ 目标/ 性能/ 的/ 增大/ ,/ 达到/ 最低/ 能耗/ 的/ 所有/ 节点/ 数量/ 也/ 会/ 随之/ 增大/ ./ 这个/ 趋势/ 在/ 表/ 4/ 中/ 得到/ 体现/ ./ 表/ 4/ 水平/ 栏/ 列出/ 每/ 一个/ 程序/ 在/ 相同/ 目标/ 性能/ 下/ 不同/ 模型/ 和/ 模拟器/ 取得/ 最低/ 能耗/ 时/ 的/ 节点/ 数量/ ./ 垂直/ 栏/ 显示/ 了/ 同一个/ 模型/ 或/ 模拟器/ 在/ 不同/ 目标/ 性能/ 下/ 取得/ 最低/ 能耗/ 时/ 的/ 节点/ 数量/ ./ 阴影/ 部分/ 表示/ 该/ 程序/ 在/ 该/ 目标/ 性能/ 下/ 模型/ 预测/ 的/ 最小/ 能耗/ 节点/ 数/ 和/ 模拟器/ 搜索/ 执行/ 得到/ 最小/ 能耗/ 节点/ 数/ 相吻合/ 的/ 情况/ ./ 只有/ 预测/ 的/ 最小/ 能耗/ 节点/ 数/ 与/ 模拟/ 结果/ 吻合/ ,/ 使用/ 该/ 模型/ 的/ 预测/ 结果/ 才/ 有/ 可能/ 与/ 模拟器/ 实测/ 能耗/ 接近/ (/ 还/ 需要/ 计算/ 此时/ 的/ 频率/ ,/ 不/ 一定/ 与/ 模拟器/ 频率/ 吻合/ )/ ./ 从表/ 4/ 的/ 阴影/ 可以/ 看出/ ,/ ModelC/ +/ PO/ 预测/ 与/ 模拟器/ 搜索/ 执行/ 的/ 结果/ 吻合/ 最多/ ./ 其它/ 两种/ 模型/ 的/ 预测/ 在/ 大部分/ 情况/ 下/ 都/ 不够/ 图/ 9/ 以/ 各/ 模型/ 优化/ 所得/ 的/ 频率/ 、/ 节点/ 数为/ 操作数/ 进行/ 能耗/ 测量/ 准确/ ./ 此外/ ,/ ModelC/ +/ PO/ 存在/ 两个/ 偏离/ :/ “/ 低/ ”/ 目标/ 性能/ 的/ ferret/ 和/ “/ 中/ ”/ 目标/ 性能/ 的/ X264/ ./ 其/ 原因/ 是/ ModelC/ 虽然/ 非常/ 近似/ ModelA/ 和/ B/ 的/ 实际/ 模型/ ,/ 但/ 所/ 描述/ 的/ 电压/ 频率/ 关系/ 仍然/ 不是/ 非线性/ 关系/ 的/ ,/ 因此/ 在/ 某些/ 情况/ 下/ (/ 如/ 节点/ 数较/ 低/ )/ 会/ 出现/ 偏差/ ,/ 对于/ 一种/ 简化/ 的/ 近似/ 方法/ 是/ 可以/ 接受/ 的/ ./ 其次/ ,/ 实验/ (/ 2/ )/ 中/ ,/ 利用/ 6.3/ 小节/ 中/ 的/ 优化/ 方法/ 得到/ 每个/ 模型/ 的/ (/ nE/ 序/ 的/ 下/ 一次/ 执行/ ,/ 在/ 模拟器/ 上/ 取得/ 实测/ 结果/ 如图/ 9/ 所示/ ./ 此外/ ,/ 图/ 9/ 中/ 加入/ 了/ 全速/ 执行/ 16/ 个/ 线程/ 和/ 1/ 个/ 线程/ 这/ 两种/ 边界/ 情况/ ./ 观察/ 得到/ ,/ 无论/ 采用/ 哪/ 种/ 目标/ 性能/ 和/ 性能/ -/ 能耗/ 模型/ ,/ 相比/ 全速/ 执行/ 情况/ 都/ 可以/ 节省/ 一定/ 能耗/ ./ 其中/ 使用/ ModelC/ +/ PO/ 模型/ 得到/ 的/ (/ nE/ 的/ 最低/ 能耗/ ./ 图/ 9/ 中/ 各/ 模型/ 性能/ 模拟器/ 在/ 最低/ 能耗/ 时/ 所用/ 节点/ 数同表/ 4/ 中/ 所述/ ./ opt/ ,/ fEPage13/ 应用程序/ blackscholesbodytrackferretfluidanimateX264vipsstreamclusterswaptions/ 注/ :/ L/ 、/ M/ 、/ T/ 分别/ 表示/ “/ 低/ ”/ 、/ “/ 中/ ”/ 、/ “/ 高/ ”/ 目标/ 性能/ ./ 阴影/ 表示/ 该/ 模型/ 得到/ 与/ 模拟器/ 相同/ 的/ 优化/ 结果/ ./ 因此/ ,/ 从/ 上述/ 实验/ 可以/ 得出/ ,/ 本文/ 提出/ 的/ 性能/ -/ 能耗/ 模型/ 和/ 能耗/ 优化/ 方法/ 可以/ 很/ 好/ 地/ 吻合/ 模拟器/ 实际/ 执行/ 情况/ ,/ 并且/ 能/ 有效/ 求解/ 出/ 优化/ 操作/ 参数/ (/ nEopt/ ,/ fE/ 能耗/ ./ 8.2/ 性能/ 优化/ 结果/ 与/ 上/ 小节/ 相似/ ,/ 本/ 小节/ 将/ 进行/ 两个/ 方面/ 的/ 实验/ :/ (/ 1/ )/ 以/ NoC/ 目标/ 能耗/ 作为/ 约束条件/ ,/ 通过/ 性能/ 模型/ 计算/ 程序/ 在/ 每个/ 节点/ 数下/ 的/ 加速/ 比/ ,/ 与/ 传统/ 建模/ 方法/ 计算/ 的/ 加速/ 比/ 做出/ 比较/ 分析/ ./ 同时/ 与/ 模拟器/ 得到/ 的/ 接近/ 真实/ 系统/ 的/ 性能/ 做/ 比较/ 分析/ ./ (/ 2/ )/ 利用/ 6.3/ 小节/ 中/ 优化/ 方法/ 解/ 出/ 问题/ II/ 的/ 优化/ 配置/ (/ nS/ 图/ 10/ 各/ 模型/ 以/ 模拟器/ 单/ 节点/ 能耗/ 为/ 目标/ 能耗/ 所/ 得到/ 的/ 预测/ 性能/ 其/ 作为/ 下次/ 一/ 执行程序/ 的/ 节点/ 数/ 和/ 频率/ 配置/ ,/ 在/ 模拟器/ 上/ 得到/ 执行/ 后/ 的/ 性能/ ./ 与/ 模拟器/ 全速/ 执行/ 在/ 16/ 核/ 、/ 单核/ 和/ 经/ 搜索/ 得到/ 的/ 实际/ 最大/ 性能/ 做出/ 对比/ 分析/ ./ 对于/ 每/ 一个/ 节点/ 数/ ,/ 模拟器/ 依然/ 采用/ “/ 搜索/ 执行/ ”/ 的/ 方法/ 寻找/ 合适/ 的/ 频率/ 值/ :/ 模拟器/ 频率/ 从/ 100MHz/ 到/ 4GHz/ 以/ 100MHz/ 为/ 步长/ 调节/ ,/ 每/ 调节/ 一次/ 将/ 程序/ 重新/ 执行/ 一次/ ,/ 直到/ 在/ 该/ 节点/ 数/ 满足/ NoC/ 目标/ 能耗/ ,/ 记录/ 此时/ 的/ 频率/ 和/ 性能/ ,/ 然后/ 节点/ 数加/ 1/ 重新/ 开始/ 搜索/ ./ 搜索/ 执行/ 可以/ 找到/ 所有/ 节点/ 数目/ 下/ 刚好/ 满足/ NoC/ 目标/ 能耗/ 的/ 频率/ 值/ 和/ 性能/ ./ 搜索/ 执行/ 所/ 得到/ 的/ 最大/ 加速/ 比/ 就是/ 模拟器/ 实测/ 的/ 最优性/ 能/ ./ 图/ 10/ 显示/ 了/ 在/ ModelC/ +/ PO/ 性能/ -/ 能耗/ 模型/ 在/ 性能/ 预测/ 中/ 仍然/ 十分/ 符合/ 模拟器/ 实测/ 的/ 数值/ ./ 其中/ ferret/ ,/ fluidanimate/ ,/ x264/ ,/ vips/ ,/ streamcluster/ 等/ 通信/ 密度/ 为/ 中高级/ 的/ 程序/ 只/ 由/ ModelC/ +/ PO/ 与/ 模拟器/ 实测/ 的/ 结果/ 保持一致/ ./ 这/ 是因为/ 高密度/ 通信/ 带来/ 的/ 通信/ 开销/ 是/ ModelCw/ // oPO/ 不能/ 准确/ 描述/ 加速/ 比/ ./ 表/ 5/ 显示/ 了/ ModelC/ +/ PO/ 准确/ 预测/ 了/ 所有/ 程序/ 的/ 最低/ 能耗/ 所用/ 节点/ 数/ ./ 在/ 图/ 11/ 中/ 显示/ ModelC/ +/ PO/ 优化/ 结果/ 比较/ 接近/ 搜索/ 执行/ 的/ 最优/ 解/ ,/ 但/ 相比/ 其它/ 模型/ 甚至/ 获得/ 了/ 更/ 低/ 的/ 加速/ 比/ ./ 在/ 加速/ 比/ 差别/ 不大时/ ,/ 从表/ 5/ 可以/ 看到/ ,/ ModelC/ +/ PO/ 在/ 大多数/ 程序/ 里/ 比/ 其它/ 模型/ 占用/ 更少/ 的/ 节点/ 数/ ./ 应用程序/ blackscholes16161616bodytrack88812ferret44168fluidanimate44168X26444124vips44168streamcluster44164swaptions16161616/ 注/ :/ 阴影/ 表示/ 该/ 模型/ 得到/ 与/ 模拟器/ 相同/ 的/ 优化/ 结果/ ./ Page14/ 图/ 11/ 以/ 各/ 模型/ 优化/ 所得/ 的/ 频率/ 、/ 节点/ 数为/ 操作数/ 进行/ 性能/ 测量/ 的/ 结果/ 总结/ 上述/ 两个/ 小节/ 的/ 实验/ 结果/ ,/ 我们/ 可以/ 得到/ 下面/ 的/ 结论/ :/ (/ 1/ )/ ModelC/ +/ PO/ 预测/ 的/ 能耗/ 、/ 性能/ 值/ 都/ 十分/ 接近/ 模拟器/ 搜索/ 执行/ 的/ 结果/ ,/ 而/ 其它/ 传统/ 模型/ 偏离/ 较大/ ./ (/ 2/ )/ 使用/ 同样/ 的/ 优化/ 方法/ (/ 6.3/ 小节/ 中/ )/ ,/ 模型/ ModelC/ +/ PO/ 的/ 能耗/ 优化/ 结果/ 十分/ 接近/ 模拟器/ 搜索/ 执行/ 的/ 结果/ ,/ 明显/ 优于/ 传统/ 建模/ 方法/ 的/ 优化/ 结果/ ,/ 并且/ 占用/ 节点/ 数/ 少于/ 传统/ 模型/ ./ (/ 3/ )/ 使用/ 同样/ 的/ 优化/ 方法/ (/ 6.3/ 小节/ 中/ )/ ,/ 所有/ 模型/ 的/ 性能/ 优化/ 结果/ 都/ 十分/ 接近/ 模拟器/ 搜索/ 执行/ 的/ 性能/ 结果/ ,/ 但/ ModelC/ +/ PO/ 明显/ 占用/ 更少/ 的/ 节点/ 数/ ,/ 其/ 数量/ 与/ 模拟器/ 占用/ 数量/ 相同/ ,/ 如果/ 将/ 关闭/ 的/ 片/ 上/ Cache/ 及/ 处理器/ 核/ 统计/ 在内/ 将/ 大幅/ 节省/ 了/ 片/ 上/ 资源/ ./ 9/ 结论/ 本文/ 探讨/ 片上/ 网络/ 性能/ -/ 能耗/ 建模/ 及/ 优化/ 方法/ ./ 首先/ ,/ 本文/ 提出/ 了/ 一种/ 精确/ 的/ 性能/ -/ 能耗/ 模型/ ,/ 在/ 性能/ 和/ 能耗/ 模型/ 中/ 同时/ 划分/ 出/ 与/ 频率/ 相关/ 和/ 与/ 频率/ 无关/ 的/ 因素/ :/ 在/ 性能/ 模型/ 中/ 引入/ 与/ 频率/ 相关/ 的/ 并行/ 开销/ 、/ 与/ 频率/ 无关/ 的/ 片/ 外访/ 存/ 开销/ ;/ 能耗/ 模型/ 中/ 划分/ 为/ 与/ 频率/ 相关/ 功耗/ 和/ 与/ 频率/ 无关/ 功耗/ ./ 并且/ 建立/ 了/ 并行/ 开销/ 、/ 片/ 外访/ 存/ 开销/ 与/ 片/ 上/ 网络/ 规模/ (/ 节点/ 数/ )/ 、/ 频率/ 之间/ 的/ 依赖/ 关系/ ,/ 使/ DVFS/ (/ 电压/ 频率/ 缩放/ )/ 和/ DPM/ (/ 节点/ 独立/ 关闭/ )/ 技术/ 可以/ 同时/ 在/ 片/ 上/ 网络/ 的/ 性能/ -/ 能耗/ 优化/ 中/ 使用/ ./ 此外/ ,/ 本文/ 将/ 并行度/ 、/ 通信模型/ 等/ 与/ 应用/ 相关/ 的/ 因素/ 引入/ 性能/ -/ 能耗/ 模型/ 中/ ,/ 使该/ 模型/ 能够/ 同时/ 表达/ 程序/ 和/ 硬件/ 特性/ ./ 接下来/ 本文/ 提出/ 了/ 一种/ 基于/ 该/ 性能/ -/ 能耗/ 模型/ 的/ 性能/ -/ 能耗/ 优化/ 方法/ ,/ 通过/ 采集/ 程序/ 的/ 通信/ 负载/ 、/ 访存/ 消息/ 数量/ 、/ 加速/ 比/ 等/ 数据/ 来/ 确定/ 性能/ -/ 能耗/ 模型/ 的/ 具体/ 形式/ ./ 再/ 通过/ 解决/ 非线性/ 优化/ 问题/ 获得/ 片上/ 网络/ 能耗/ 最低值/ (/ 或/ 处理器/ 性能/ 最大值/ )/ 时/ 的/ 频率/ 和/ 节点/ 数/ 配置/ ./ 最后/ ,/ 本文/ 使用/ PARSEC/ 并行程序/ 验证/ 了/ 该/ 性能/ -/ 能耗/ 模型/ 的/ 准确性/ ,/ 并/ 通过/ 实验/ 证明/ 了/ 本文/ 提出/ 的/ 优化/ 方法/ 的/ 有效性/ ,/ 同时/ 大幅/ 减少/ 了/ 传统/ 模型/ 优化/ 后/ 导致/ 的/ 片/ 上/ 资源/ 浪费/ ./ 

