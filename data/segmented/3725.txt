Page1TSS/ -/ BQS/ 系统/ 的/ GracefulDegradation/ 机制/ 王文韬/ 1/ )/ ,/ 2/ )/ 林/ 瞡/ 锵/ 1/ )/ 荆/ 继武/ 1/ )/ 罗勃/ 3/ )/ 1/ )/ (/ 中国科学院/ 信息工程/ 研究所/ 信息安全/ 国家/ 重点/ 实验室/ 北京/ 100195/ )/ 3/ )/ (/ 堪萨斯/ 大学/ 电子/ 工程/ 与/ 计算机科学/ 系/ 堪萨斯州/ KS66045/ 美国/ )/ 2/ )/ (/ 中国科学院/ 研究生院/ 北京/ 100049/ )/ 摘要/ 将/ 门限/ 签名/ 方案/ 分别/ 应用/ 于/ 两种/ 类型/ 的/ BQS/ 系统/ (/ MaskingBQS/ 系统/ 和/ DisseminationBQS/ 系统/ )/ ,/ 可以/ 得到/ 两种/ TSS/ -/ BQS/ 系统/ (/ 文中/ 称为/ TSS/ -/ mBQS/ 系统/ 和/ TSS/ -/ dBQS/ 系统/ )/ ./ TSS/ -/ mBQS/ 系统/ 的/ 性能/ 优于/ TSS/ -/ dBQS/ 系统/ ./ 由此/ ,/ 作者/ 提出/ 了/ TSS/ -/ BQS/ 系统/ 的/ GracefulDegradation/ 机制/ :/ 系统/ 由/ n/ =/ 3fd/ +/ 1/ 台/ 服务器/ 组成/ ,/ 在/ 初始/ 阶段/ 以/ TSS/ -/ mBQS/ 状态/ 运行/ ,/ 容忍/ fm/ =/ fd2/ 台/ Byzantine/ 失效/ 服务器/ ;/ 随着/ 系统/ 运行/ ,/ 可能/ 失效/ 的/ 服务器/ 数量/ 增大/ ,/ 则/ 以/ 降低/ 性能/ 为/ 代价/ ,/ 切换/ 到/ TSS/ -/ dBQS/ 状态/ ,/ 容忍/ fd/ 台/ Byzantine/ 失效/ 服务器/ ./ 在/ 不/ 影响/ 容错/ 能力/ 的/ 前提/ 下/ ,/ GracefulDegradation/ 机制/ 提高/ 了/ 已有/ TSS/ -/ BQS/ 系统/ 的/ 平均/ 性能/ ./ 文中/ 完成/ 的/ GracefulDegradation/ 机制/ 能够/ 在/ 不/ 中断/ 存储/ 服务/ 、/ 不/ 影响/ 客户端/ 的/ 前提/ 下/ 完成/ 状态/ 切换/ ,/ 客户端/ 也/ 不/ 需要/ 知道/ 系统/ 的/ 运行/ 状态/ (/ 处于/ TSS/ -/ mBQS/ 或/ TSS/ -/ dBQS/ 状态/ )/ ./ 关键词/ 拜占庭/ 容错/ 技术/ ;/ 拜占庭/ 选举/ 系统/ ;/ 优雅/ 降级/ ;/ 门限/ 签名/ 方案/ 1/ 引言/ ByzantineQuorumSystem/ (/ 简称/ BQS/ 系统/ )/ [/ 1/ ]/ 是/ 指/ 利用/ 冗余/ 复制技术/ 、/ 容忍/ 服务器/ Byzantine/ 失效/ [/ 2/ ]/ (/ 即/ 任意/ 失效/ )/ 、/ 运行/ 于/ 异步/ 网络/ 环境/ 的/ 存储系统/ ./ BQS/ 系统/ 由/ n/ 台/ 独立/ 服务器/ 组成/ ,/ 每次/ 读/ // 写/ 操作/ 都/ 在/ 一定/ 数量/ 的/ 服务器上进行/ ./ 写/ 操作/ 时/ ,/ 将/ 数据/ 写入/ qw/ 台/ 服务器/ ;/ 读/ 操作/ 时/ ,/ 从/ 任意/ qr/ 台/ 服务器/ 读出/ 数据/ ,/ 再/ 从中/ 选出/ 正确/ 结果/ ./ 在/ BQS/ 系统/ 中/ ,/ 通过/ 设定/ 合适/ 的/ n/ 、/ qw/ 和/ qr/ ,/ 使读/ // 写/ 操作/ 的/ 服务器/ 群有/ 足够/ 大/ 的/ 交集/ ,/ 从而/ 排除/ 失效/ 服务器/ 的/ 影响/ ,/ 保证/ 读出/ 结果/ 为/ 最近/ 一次/ 写入/ 的/ 数据/ ./ 当/ 存储/ 不同/ 类型/ 数据/ 时/ ,/ BQS/ 系统/ 由/ 数量/ 不/ 等/ 的/ 服务器/ 组成/ [/ 1/ ]/ :/ 为了/ 容忍/ f/ 台/ Byzantine/ 失效/ 服务器/ ,/ 存储/ 普通/ 数据/ GenericData/ 的/ MaskingBQS/ 系统/ 需要/ 4f/ +/ 1/ 台/ 服务器/ ,/ 存储/ 自/ 验证/ 数据/ Self/ -/ VerifyingData/ (/ 如/ 带有/ 数字签名/ 的/ 证书/ [/ 3/ ]/ )/ 的/ DisseminationBQS/ 系统/ 需要/ 3f/ +/ 1/ 台/ 服务器/ ./ 所以/ ,/ 当/ 使用/ n/ 台/ 服务器时/ ,/ MaskingBQS/ 系统/ 只能/ 容忍/ n/ -/ 1/ 能/ 容忍/ n/ -/ 1/ 额外/ 操作/ 把/ 普通/ 数据/ 转为/ 自/ 验证/ 数据/ 后/ 再/ 写入/ 服务器/ ,/ 其/ 性能/ 不如/ MaskingBQS/ 系统/ ./ 基于/ 上述/ 分析/ ,/ 我们/ 设计/ 了/ 相应/ 的/ GracefulDegradation/ 机制/ ./ GracefulDegradation/ 是/ 指/ [/ 4/ ]/ :/ 当/ 运行/ 环境/ 恶化/ 、/ 超出/ 预先/ 估计/ 时/ ,/ 调整/ 系统/ 状态/ 或/ 参数/ ,/ 保证/ 提供/ 服务/ 、/ 但是/ 服务质量/ 有所/ 降低/ ./ 在/ 本文/ 中/ ,/ BQS/ 系统/ 的/ GracefulDegradation/ 机制/ 表现/ 为/ :/ 在/ 初始/ 阶段/ ,/ 系统/ 以/ MaskingBQS/ 状态/ 运行/ ;/ 当/ 运行/ 了/ 一定/ 时间/ 、/ 怀疑/ 或/ 检测/ 到/ 失效/ 服务器/ 已/ 达到/ 一定/ 数量/ 时/ ,/ 切换/ 到/ DisseminationBQS/ 状态/ ./ 也/ 就是/ ,/ 当/ 失效/ 服务器/ 数量/ 可能/ 将要/ 超出/ 预先/ 估计/ 、/ 使/ 系统/ 无法/ 再/ 提供/ 正常/ 的/ 存储/ 服务/ 时/ ,/ 以/ 降低/ 性能/ 为/ 代价/ 、/ 继续/ 提供/ 存储/ 服务/ ./ 在/ 我们/ 的/ 设计/ 和/ 实现/ 中/ ,/ 借鉴/ 了/ TSS/ -/ BQS/ 系统/ [/ 3/ ,/ 5/ -/ 7/ ]/ (/ 基于/ 门限/ 签名/ 方案/ ThresholdSignatureScheme/ 的/ BQS/ 系统/ )/ 的/ 思想/ ,/ 利用/ 门限/ 签名/ 方案/ [/ 8/ -/ 9/ ]/ 来/ 设计协议/ ,/ 使得/ 客户端/ 不/ 需要/ 知道/ 系统/ 的/ 运行/ 状态/ ,/ 同时/ 还/ 保留/ 了/ TSS/ -/ BQS/ 系统/ 的/ 优点/ ./ 综合/ 以上/ ,/ 本文/ 完成/ 的/ 容错/ 存储/ 服务/ 具备/ 如下/ 特点/ :/ (/ 1/ )/ 系统/ 由/ n/ =/ 3fd/ +/ 1/ 台/ 服务器/ 组成/ ,/ 可/ 作为/ MaskingBQS/ 系统/ 运行/ (/ 本文/ 称为/ TSS/ -/ mBQS/ 状态/ )/ 或者/ DisseminationBQS/ 系统/ 运行/ (/ 本文/ 称为/ TSS/ -/ dBQS/ 状态/ )/ ;/ TSS/ -/ mBQS/ 状态/ 的/ 性能/ 优于/ TSS/ -/ dBQS/ 状态/ ./ (/ 2/ )/ 在/ 初始/ 阶段/ ,/ 系统/ 处于/ TSS/ -/ mBQS/ 状态/ ,/ 容忍/ fm/ =/ fd2/ 台/ 失效/ 服务器/ (/ 注意/ :/ 并/ 不是/ fm/ =/ 3fd4/ 、/ 不同于/ 普通/ 的/ MaskingBQS/ 系统/ ,/ 详见/ 4.3/ 节/ 的/ 参数/ 分析/ )/ ./ 当/ 估计/ 失效/ 服务器/ 数量/ 可能/ 将要/ 超过/ fm/ 时/ ,/ 切换/ 到/ TSS/ -/ dBQS/ 状态/ ,/ 降低/ 性能/ 、/ 容忍/ fd/ 台/ 失效/ 服务器/ ,/ 继续/ 提供/ 容错/ 服务/ ./ (/ 3/ )/ 系统/ 能/ 在/ 不/ 影响/ 客户端/ 的/ 情况/ 下/ 执行/ GracefulDegradation/ ./ 不论/ 系统/ 处于/ 哪/ 一种/ 运行/ 状态/ ,/ 客户端/ 都/ 使用/ 完全相同/ 的/ 协议/ 来/ 进行/ 读/ // 写/ 操作/ ./ (/ 4/ )/ 系统/ 同时/ 保留/ 了/ TSS/ -/ BQS/ 系统/ 支持/ Pro/ -/ activeRecovery/ [/ 3/ ,/ 10/ -/ 11/ ]/ 、/ 简化/ 客户端/ 密钥/ 管理/ 和/ 客户端/ 通信/ 的/ 特点/ ./ 本文/ 第/ 2/ 节先/ 简要/ 介绍/ 背景/ 知识/ ;/ 第/ 3/ 节/ 描述/ TSS/ -/ BQS/ 系统/ 的/ 工作/ 协议/ ;/ 第/ 4/ 节/ 给出/ TSS/ -/ BQS/ 系统/ 的/ GracefulDegradation/ 机制/ 以及/ 性能/ 分析/ 和/ 实验/ 结果/ ;/ 第/ 5/ 节是/ 相关/ 问题/ 讨论/ ;/ 第/ 6/ 节/ 介绍/ 相关/ 研究/ 工作/ ;/ 最后/ 是/ 全文/ 总结/ ./ 2/ 背景/ 2.1/ BQS/ 系统/ BQS/ 系统/ [/ 1/ ]/ 由/ n/ 台/ 独立/ 的/ 服务器/ 组成/ ,/ 每台/ 服务器/ 可能/ 是/ 正确/ 的/ 或/ Byzantine/ 失效/ ./ 系统/ 存储/ 的/ 每个/ 数据/ 可记/ 为/ [/ x/ ,/ v/ ,/ t/ ]/ ./ 其中/ ,/ x/ 是/ 变量名/ ,/ v/ 和/ t/ 分别/ 是/ 变量/ 的/ 值/ 和/ 时/ 戳/ ./ 时/ 戳/ 集合/ 是/ 满足/ 全序/ (/ TotalOrder/ )/ 性质/ 的/ 集合/ ,/ 例如/ 递增/ 序列号/ ;/ 时/ 戳/ 用来/ 区分值/ 的/ 新旧/ 版本/ ,/ 新/ 版本/ 的/ 值/ 具有/ 更大/ 的/ 时/ 戳/ ./ 执行/ 读/ // 写/ 操作/ 的/ 服务器/ 集合/ (/ 称为/ 读/ Quorum/ 和/ 写/ Quorum/ )/ ,/ 分别/ 包含/ qr/ 和/ qw/ 台/ 服务器/ ./ 考虑/ 到/ 失效/ 服务器/ 的/ 影响/ ,/ 各/ 服务器/ Si/ 存储/ 的/ [/ x/ ,/ vi/ ,/ ti/ ]/ 有/ 可能/ 会/ 不同/ ./ 为了/ 容忍/ f/ 台/ 失效/ 服务器/ ,/ BQS/ 系统/ 的/ 可用性/ 要求/ [/ 1/ ]/ :/ 任何/ 情况/ 下/ ,/ 都/ 能/ 找到/ 由/ 正确/ 服务器/ 组成/ 的/ 读/ // 写/ Quorum/ 来/ 完成/ 操作/ ;/ 有/ qr/ / n/ -/ f/ 和/ qw/ / n/ -/ f/ ./ BQS/ 系统/ 的/ 一致性/ 要求/ [/ 1/ ]/ :/ 从读/ Quorum/ 中/ 获得/ 的/ 结果/ 是/ 最近/ 一次/ 被/ 写入/ 的/ 值/ 和/ 时/ 戳/ ./ 对于/ 存储/ 普通/ 数据/ 的/ MaskingBQS/ 系统/ ,/ 失效/ 服务器/ 会/ 任意/ 篡改/ 数据/ ,/ 为了/ 排除/ 失效/ 服务器/ 的/ 影响/ ,/ 正确/ 结果/ Page3/ 在读/ Quorum/ 中应/ 出现/ 至少/ f/ +/ 1/ 次/ ,/ 任意/ 读/ // 写/ Quorum/ 的/ 交集/ 不/ 小于/ 2f/ +/ 1/ 台/ ,/ 所以/ 需要/ 有/ qr/ +/ qw/ -/ n/ / 2f/ +/ 1/ ;/ 在/ 读出/ 的/ qr/ 个/ 结果/ 中/ ,/ 去掉/ 出现/ 次数/ 少于/ f/ +/ 1/ 的/ 结果/ ,/ 剩余/ 结果/ 中时/ 戳/ 最大/ 的/ 就是/ 正确/ 结果/ ./ 对于/ 存储/ 自/ 验证/ 数据/ 的/ DisseminationBQS/ 系统/ ,/ 失效/ 服务器/ 无法/ 篡改/ 数据/ ,/ 只能/ 回复/ 旧版本/ 数据/ ,/ 只/ 需/ 保证/ 正确/ 结果/ 在读/ Quorum/ 中/ 出现/ 1/ 次/ ,/ 任意/ 读/ // 写/ Quorum/ 的/ 交集/ 不/ 小于/ f/ +/ 1/ 台/ ,/ 所以/ 需要/ 有/ qr/ +/ qw/ -/ n/ / f/ +/ 1/ ;/ 在/ 读出/ 的/ qr/ 个/ 结果/ 中/ ,/ 去掉/ 验证/ 无效/ 的/ 结果/ ,/ 剩余/ 结果/ 中时/ 戳/ 最大/ 的/ 就是/ 正确/ 结果/ ./ 2.2/ TSS/ -/ BQS/ 系统/ TSS/ -/ BQS/ 系统/ [/ 3/ ,/ 5/ -/ 7/ ]/ 基于/ 门限/ 签名/ 方案/ 来/ 实现/ BQS/ 系统/ :/ 系统/ 有/ 一对/ 公私/ 密钥/ 对/ (/ 称为/ ServiceKey/ )/ ,/ 其/ 私钥/ 由/ n/ 台/ 服务器/ 拆分/ 、/ 任意/ f/ +/ 1/ 台/ 服务器/ 能/ 合作/ 利用/ ServiceKey/ 私钥/ 来/ 计算/ 数字签名/ ./ 每次/ 读/ // 写/ 操作/ ,/ 客户端/ 只/ 需/ 收到/ 带有/ ServiceKey/ 数字签名/ 的/ 响应/ 消息/ ,/ 即/ 保证/ 完成/ 操作/ [/ 3/ ,/ 7/ ]/ :/ 因为/ ServiceKey/ 门限/ 签名/ 和/ TSS/ -/ BQS/ 系统/ 的/ 服务器/ 协议/ 保证/ 了/ 读/ // 写/ 操作/ 已/ 在/ qr/ // qw/ 台/ 服务器/ 上/ 执行/ 、/ 且/ 返回/ 正确/ 结果/ ./ 相比/ 普通/ 的/ BQS/ 系统/ ,/ TSS/ -/ BQS/ 系统/ 的/ 重要/ 优点/ 是/ 支持/ ProactiveRecovery/ [/ 3/ ,/ 10/ -/ 11/ ]/ ./ 考虑/ 到/ MobileAdversary/ 的/ 影响/ ,/ 各/ 服务器/ 应该/ 周期性地/ 恢复/ 到/ 正确/ 状态/ ;/ 否则/ ,/ 攻击者/ 可以/ 逐一/ 地/ 攻占/ 服务器/ ,/ 直至/ 失效/ 服务器/ 数量/ 超过/ f/ 、/ 破坏/ 存储/ 服务/ [/ 10/ ]/ ./ TSS/ -/ BQS/ 系统/ 的/ 客户端/ 只/ 配置/ ServiceKey/ 公钥/ ,/ 而/ ServiceKey/ 在/ ProactiveRecovery/ 过程/ 中/ 不会/ 发生变化/ 、/ 只是/ 重新/ 拆分/ ,/ 所以/ ProactiveRecovery/ 不/ 影响/ 客户端/ ./ 此外/ ,/ TSS/ -/ BQS/ 系统/ 还/ 具有/ 简化/ 客户端/ 密钥/ 管理/ 和/ 客户端/ 通信/ 的/ 特点/ [/ 3/ ]/ ./ 3TSS/ -/ BQS/ 系统/ 模型/ 和/ 工作/ 协议/ 下面/ 我们/ 先/ 给出/ TSS/ -/ BQS/ 系统/ 模型/ 和/ 协议/ ,/ 这是/ GracefulDegradation/ 机制/ 的/ 运行/ 基础/ ./ 下文/ 描述/ 的/ 系统/ 模型/ 和/ 协议/ ,/ 与/ 已有/ 的/ TSS/ -/ BQS/ 系统/ [/ 3/ ,/ 5/ -/ 7/ ]/ 基本相同/ ,/ 不同之处/ 在于/ 我们/ 将/ 其/ 从/ DisseminationBQS/ 系统/ 推广/ 到/ MaskingBQS/ 系统/ ./ 限于/ 篇幅/ ,/ 我们/ 只是/ 简要/ 说明/ 了/ 两种/ 状态/ 的/ 服务器/ 协议/ ;/ 关于/ TSS/ -/ BQS/ 系统/ 服务器/ 协议/ 的/ 详细/ 安全性/ 分析/ ,/ 请/ 参考文献/ [/ 3/ ,/ 5/ -/ 7/ ]/ ./ 此外/ ,/ 因为/ 系统/ 可能/ 处于/ 不同/ 的/ 运行/ 状态/ (/ TSS/ -/ mBQS/ 或者/ TSS/ -/ dBQS/ 状态/ )/ ,/ 每/ 一台/ 服务器/ 还/ 需要/ 有/ 独立/ 的/ state/ 变量/ ,/ 记录/ 自己/ 的/ 当前/ 运行/ 状态/ ./ 3.1/ 系统/ 模型/ 系统/ 由/ n/ =/ 3fd/ +/ 1/ 台/ 服务器/ (/ 记为/ Si/ ,/ n/ / i/ / 1/ )/ 组成/ ;/ 最多/ 有/ fd/ 台/ Byzantine/ 失效/ 服务器/ ,/ 失效/ 服务器/ 可以/ 合谋/ 攻击/ ./ 系统/ 向/ 不定/ 数量/ 的/ 客户端/ 提供/ 存储/ 服务/ ./ 服务器/ 和/ 客户端/ 通过/ 异步/ FairLink/ 信道/ [/ 3/ ,/ 5/ ]/ 通信/ :/ 信道/ 可能/ 丢失/ 消息/ ,/ 攻击者/ 可以/ 篡改/ 、/ 延迟/ 、/ 截获/ 或/ 删除/ 消息/ ;/ 但/ 当/ 发送者/ 无限/ 地/ 发送/ 消息/ 时/ ,/ 接收者/ 能/ 收到/ 消息/ ;/ 信道/ 是/ 异步/ 的/ ,/ 没有/ 最大/ 延迟/ 假设/ ./ 系统/ 有/ 一对/ ServiceKey/ 密钥/ 对/ ,/ 其/ 私钥/ 由/ n/ 台/ 服务器/ 拆分/ 、/ 任意/ fd/ +/ 1/ 台能/ 合作/ 利用/ ServiceKey/ 私钥/ 来/ 进行/ 门限/ 签名/ ./ 所有/ 服务器/ 和/ 客户端/ 都/ 知道/ ServiceKey/ 公钥/ ,/ 客户端/ 只/ 接受/ 带有/ ServiceKey/ 数字签名/ 的/ 响应/ 消息/ ./ 此外/ ,/ 各/ 服务器/ 有/ 自己/ 的/ 公私/ 密钥/ 对/ (/ 不同于/ ServiceKey/ )/ ,/ 称为/ ServerKey/ ,/ 专用/ 于/ 服务器之间/ 的/ 安全/ 通信/ ./ 各/ 服务器/ 知道/ 其它/ 服务器/ 的/ ServerKey/ 公钥/ ,/ 但是/ 客户端/ 不/ 需要/ 知道/ ServerKey/ 的/ 任何/ 信息/ ./ 每次/ 读/ // 写/ 操作/ ,/ 客户端/ c/ 周期性地/ 向/ 任意/ fd/ +/ 1/ 台/ 服务器发送/ 请求/ 消息/ ,/ 直至/ 收到/ 带有/ ServiceKey/ 数字签名/ 的/ 响应/ 消息/ ./ 由于/ 最多/ fd/ 台/ 服务器/ 失效/ ,/ 所以/ 至少/ 1/ 台/ 服务器/ (/ 称为/ 此次/ 读/ // 写/ 操作/ 的/ Delegate/ ,/ 记为/ Sd/ )/ 会/ 正确/ 地/ 处理/ 客户端/ 的/ 请求/ ,/ 与/ 其它/ 服务器/ 合作/ 执行/ 服务器/ 协议/ ,/ 然后/ 将/ 正确/ 的/ 响应/ 消息/ 发送给/ 客户端/ ./ 服务器/ 协议/ 的/ 功能/ 是/ [/ 3/ ,/ 7/ ]/ :/ 在/ qr/ // qw/ 台/ 服务器/ 上/ 读取/ // 写入/ 数据/ ,/ 生成/ 响应/ 消息/ ,/ 联合/ 其它/ 服务器/ 对/ 响应/ 消息/ 进行/ ServiceKey/ 门限/ 签名/ ./ 需要/ 指出/ ,/ Delegate/ 不是/ 额外/ 的/ 专门/ 服务器/ ,/ 每台/ 服务器/ 都/ 同时/ 具有/ Delegate/ 功能/ :/ 当/ 正确/ 服务器/ 从/ 客户端/ 收到/ 读/ // 写/ 请求/ 消息/ 时/ ,/ 就/ 自动/ 转为/ Delegate/ 、/ 发起/ 服务器/ 协议/ ./ 变量/ 的/ 时/ 戳/ t/ 按/ 如下/ 规则/ 产生/ [/ 3/ ]/ :/ 时/ 戳/ 由/ 两/ 部分/ 组成/ ,/ 高位/ 是/ 连续/ 递增/ 的/ 整数/ 序号/ ,/ 记为/ seq/ (/ t/ )/ ,/ 低位/ 由/ 相应/ 的/ 客户端/ 写/ 请求/ 消息/ ReqW/ 确定/ ,/ 有/ t/ =/ seq/ (/ t/ )/ |/ Hash/ (/ ReqW/ )/ ./ 其中/ ,/ Hash/ (/ )/ 是/ 单向/ 散列/ 函数/ ./ 容易/ 验证/ ,/ 上述/ 方式/ 产生/ 的/ 时/ 戳/ 集合/ 满足/ 全序/ 性质/ ./ 在下文/ 的/ 协议/ 描述/ 中/ ,/ 我们/ 使用/ 了/ 如下/ 记号/ :/ [/ ·/ ]/ SK/ :/ 带有/ ServiceKey/ 数字签名/ 的/ 消息/ ;/ [/ ·/ ]/ c/ :/ 由/ 客户端/ c/ 进行/ 数字签名/ 后/ 的/ 消息/ ;/ [/ ·/ ]/ d/ 或/ [/ ·/ ]/ i/ :/ 由/ 服务器/ Sd/ 或/ Si/ 使用/ ServerKeyPSi/ (/ ·/ )/ :/ 服务器/ Si/ 计算/ 的/ 部分/ 签名/ ,/ fd/ +/ 1/ 台/ 进行/ 数字签名/ 后/ 的/ 消息/ ;/ Page4READA/ ./ 客户端/ c/ 发送/ 读/ 请求/ 消息/ ReqR/ =/ [/ ReqRead/ ,/ c/ ,/ x/ ,/ p/ ]/ c/ 给/ 任意/ fd/ +/ 1/ 台/ 服务器/ ;/ 其中/ ,/ c/ 是/ 客户端/ 的/ 唯一/ 标识/ ,/ x/ 是/ 变量/ 的/ 唯一/ 标识/ ,/ p/ 是/ 防重/ 放/ 攻击/ 的/ 一次性/ 随机数/ 、/ 防止/ 攻击者/ 重/ 放/ 以前/ 的/ 响应/ 消息/ ./ B/ ./ 客户端/ c/ 周期性地/ 发送/ ReqR/ 给/ fd/ +/ 1/ 台/ 服务器/ ,/ 直至/ 收到/ 读/ 响应/ 消息/ RespR/ =/ [/ RespRead/ ,/ c/ ,/ x/ ,/ vR/ ,/ tR/ ,/ p/ ]/ SK/ ;/ 其中/ vR/ 和/ tR/ 是/ 读出/ 的/ 值/ 和/ 时/ 戳/ ./ WRITEA/ ./ 客户端/ c/ 首先/ 执行/ 1/ 次/ READ/ 操作/ ,/ 得到/ RespR/ ,/ 其中/ 包含/ 变量/ x/ 的/ 当前/ 时/ 戳/ tR/ ./ B/ ./ 客户端/ c/ 发送/ 写/ 请求/ 消息/ ReqW/ =/ [/ ReqWrite/ ,/ c/ ,/ x/ ,/ vW/ ,/ p/ ,/ RespR/ ]/ c/ 给/ 任意/ fd/ +/ 1/ 台/ 服务器/ ;/ 其中/ vW/ 是/ 待/ 写入/ 的/ 值/ ./ C/ ./ 客户端/ c/ 周期性地/ 发送/ ReqW/ 给/ fd/ +/ 1/ 台/ 服务器/ ,/ 直至/ 收到/ 写/ 响应/ 消息/ RespW/ =/ [/ RespWrite/ ,/ c/ ,/ x/ ,/ vW/ ,/ tW/ ,/ p/ ]/ SK/ ;/ 其中/ tW/ =/ (/ seq/ (/ tR/ )/ +/ 1/ )/ |/ Hash/ (/ ReqW/ )/ ./ 3.3/ TSS/ -/ dBQS/ 状态/ 的/ 服务器/ 协议/ TSS/ -/ dBQS/ 状态/ 能/ 容忍/ fd/ 台/ 失效/ 服务器/ ,/ 读/ // 写/ Quorum/ 包含/ 的/ 服务器/ 数量/ 分别/ 记为/ qdr/ 和/ qdw/ ./ 当/ Sd/ 的/ state/ 变量/ 表明/ 当前/ 是/ TSS/ -/ dBQS/ 状态/ 时/ ,/ 使用/ 如下/ 协议/ ./ 在/ 协议/ 描述/ 中/ ,/ 我们/ 先/ 假定/ 各/ 服务器/ 的/ state/ 变量/ 相同/ ;/ 然后/ ,/ 在/ 4.2/ 节/ 讨论/ 了/ 当/ 各/ 服务器/ state/ 变量/ 不同/ 的/ 处理/ 方法/ ./ 不同/ 服务器/ 产生/ 的/ 部分/ 签名/ 可/ 合成/ 有效/ 的/ ServiceKey/ 数字签名/ ./ 3.2/ 客户端/ 协议/ 客户端/ c/ 使用/ 如下/ 协议/ 来读/ // 写/ 变量/ x/ ./ 注意/ :/ 不论/ 系统/ 处于/ TSS/ -/ mBQS/ 或者/ TSS/ -/ dBQS/ 状态/ ,/ 都/ 使用/ 相同/ 的/ 客户端/ 协议/ ./ READA/ ./ 当/ Sd/ 收到/ ReqR/ =/ [/ ReqRead/ ,/ c/ ,/ x/ ,/ p/ ]/ c/ 时/ ,/ 验证/ 有效/ 后/ ,/ 发送/ [/ Read/ ,/ state/ ,/ d/ ,/ ReqR/ ]/ d/ 给/ 所有/ 服务器/ ./ 其中/ ,/ state/ 是/ Sd/ 的/ 当前/ 运行/ 状态/ ,/ 设定/ 为/ TSS/ -/ dBQS/ ;/ d/ 是/ Sd/ 的/ 唯一/ 标识/ ./ B/ ./ 当/ Si/ 从/ Sd/ 收到/ Read/ 消息/ 时/ ,/ 验证/ 其中/ 的/ ReqR/ 有效/ 后/ ,/ 回复/ [/ Replica/ ,/ state/ ,/ i/ ,/ [/ xi/ ]/ ,/ ReqR/ ]/ i/ ./ 其中/ ,/ i/ 是/ Si/ 的/ 唯一/ 标识/ ;/ [/ xi/ ]/ 是/ Si/ 存储/ 的/ 数据/ ,/ 可能/ 是/ 自/ 验证/ 数据/ 形式/ [/ x/ ,/ vi/ ,/ ti/ ]/ SK/ 或者/ 是/ 普通/ 数据/ 形式/ [/ x/ ,/ vi/ ,/ ti/ ]/ ./ 如果/ 系统/ 在/ 切换/ 到/ TSS/ -/ dBQS/ 状态/ 之后/ ,/ 还/ 尚未/ 执行/ 过写/ 操作/ ,/ 则/ Si/ 存储/ [/ x/ ,/ vi/ ,/ ti/ ]/ ;/ 否则/ 就/ 存储/ [/ x/ ,/ vi/ ,/ ti/ ]/ SK/ ./ C/ ./ Sd/ 周期性地/ 重复/ 执行/ 步骤/ A/ ,/ 直至/ 收到/ qdr/ 台/ 服务器/ (/ 包括/ Sd/ )/ 的/ Replica/ 消息/ ./ 然后/ Sd/ 从中/ 选出/ 正确/ 结果/ ,/ 记/ 为/ [/ x/ ,/ vR/ ,/ tR/ ]/ ./ 选出/ 正确/ 结果/ 的/ 方法/ ,/ 详见/ 4.3/ 节/ 的/ 说明/ ./ D/ ./ Sd/ 向/ 所有/ 服务器发送/ 门限/ 签名/ 请求/ [/ Sign/ -/ Read/ ,/ state/ ,/ d/ ,/ MR/ ,/ Σ/ R/ ,/ ReqR/ ]/ d/ ,/ 其中/ ,/ MR/ =/ [/ RespRead/ ,/ c/ ,/ x/ ,/ vR/ ,/ tR/ ,/ p/ ]/ ,/ Σ/ R/ 是/ 在/ 步骤/ C/ 从/ qdr/ 台/ 服务器/ 收到/ 的/ Replica/ 消息/ ./ E/ ./ 当/ Si/ 从/ Sd/ 收到/ SignRead/ 消息/ 时/ ,/ 检查/ :/ (/ a/ )/ Σ/ R/ 是否是/ qdr/ 台/ 服务器/ 针对/ ReqR/ 的/ Replica/ 消息/ ;/ (/ b/ )/ MR/ 是否/ 包含/ Σ/ R/ 中/ 的/ 正确/ 结果/ ./ 检查/ 通过/ 后/ ,/ Si/ 计算/ 部分/ 签名/ PSi/ (/ MR/ )/ ,/ 回复/ [/ PSRead/ ,/ state/ ,/ i/ ,/ PSi/ (/ MR/ )/ ,/ ReqR/ ]/ i/ ./ F/ ./ Sd/ 周期性地/ 重复/ 执行/ 步骤/ D/ ,/ 直至/ 收到/ fd/ +/ 1/ 台/ 服务器/ (/ 包括/ Sd/ )/ 的/ PSRead/ 消息/ ./ 然后/ Sd/ 将/ fd/ +/ 1/ 个/ 部分/ 签名/ 合成/ 为/ [/ RespRead/ ,/ c/ ,/ x/ ,/ vR/ ,/ tR/ ,/ p/ ]/ SK/ ,/ 发送给/ 客户端/ c/ ./ WRITEA/ ./ 当/ Sd/ 收到/ ReqW/ =/ [/ ReqWrite/ ,/ c/ ,/ x/ ,/ vW/ ,/ p/ ,/ RespR/ ]/ c/ 时/ ,/ 验证/ 有效/ 后/ 、/ 发送/ [/ SignReplica/ ,/ state/ ,/ d/ ,/ ReqW/ ]/ d/ 给/ 所有/ 服务器/ ./ B/ ./ 当/ Si/ 从/ Sd/ 收到/ SignReplica/ 消息/ 时/ ,/ 验证/ 其中/ 的/ ReqW/ 有效/ 后/ ,/ 计算/ 部分/ 签名/ PSi/ (/ x/ ,/ vW/ ,/ tW/ )/ ,/ 回复/ [/ PSReplica/ ,/ state/ ,/ i/ ,/ PSi/ (/ x/ ,/ vW/ ,/ tW/ )/ ,/ ReqW/ ]/ i/ ./ 其中/ ,/ tW/ =/ (/ seq/ (/ tR/ )/ +/ 1/ )/ |/ Hash/ (/ ReqW/ )/ ,/ tR/ 是/ 包含/ 在/ RespR/ 中/ 的/ 原有/ 时/ 戳/ ./ C/ ./ Sd/ 周期性地/ 重复/ 执行/ 步骤/ A/ ,/ 直至/ 收到/ fd/ +/ 1/ 台/ 服务器/ (/ 包括/ Sd/ )/ 的/ PSReplica/ 消息/ ./ 然后/ Sd/ 将/ fd/ +/ 1/ 个/ 部分/ 签名/ 合成/ 为/ [/ x/ ,/ vW/ ,/ tW/ ]/ SK/ ./ D/ ./ Sd/ 发送/ [/ Write/ ,/ state/ ,/ d/ ,/ [/ x/ ,/ vW/ ,/ tW/ ]/ SK/ ,/ ReqW/ ]/ d/ 给/ 所有/ 服务器/ ./ E/ ./ 当/ Si/ 从/ Sd/ 收到/ Write/ 消息/ 时/ ,/ 验证/ [/ x/ ,/ vW/ ,/ tW/ ]/ SK/ 是/ 有效/ 的/ 自/ 验证/ 数据/ 后/ ,/ 回复/ [/ Ack/ ,/ state/ ,/ i/ ,/ [/ x/ ,/ vW/ ,/ tW/ ]/ SK/ ,/ ReqW/ ]/ i/ ./ 然后/ Si/ 比较/ [/ x/ ,/ vW/ ,/ tW/ ]/ SK/ 和/ 自己/ 存储/ 的/ [/ x/ ,/ vi/ ,/ ti/ ]/ SK/ 或/ [/ x/ ,/ vi/ ,/ ti/ ]/ ,/ 如果/ tW/ >/ ti/ ,/ 就/ 更新/ 自己/ 的/ 数据/ ./ F/ ./ Sd/ 周期性地/ 重复/ 执行/ 步骤/ D/ ,/ 直至/ 收到/ qdw/ 台/ 服务器/ (/ 包括/ Sd/ )/ 的/ Ack/ 消息/ ./ G/ ./ Sd/ 向/ 所有/ 服务器发送/ 门限/ 签名/ 请求/ [/ Sign/ -/ Write/ ,/ state/ ,/ d/ ,/ MW/ ,/ Σ/ W/ ,/ ReqW/ ]/ d/ ,/ 其中/ ,/ MW/ =/ [/ RespWrite/ ,/ c/ ,/ x/ ,/ vW/ ,/ tW/ ,/ p/ ]/ ;/ Σ/ W/ 是/ 在/ 步骤/ F/ 从/ qdw/ 台/ 服务器/ 收到/ 的/ Ack/ 消息/ ./ H/ ./ 当/ Si/ 从/ Sd/ 收到/ SignWrite/ 消息/ 时/ ,/ 检查/ :/ (/ a/ )/ Σ/ W/ 是否是/ qdw/ 台/ 服务器/ 针对/ ReqW/ 的/ Ack/ 消息/ ;/ (/ b/ )/ MW/ 是否是/ ReqW/ 对应/ 的/ 写/ 响应/ 消息/ ./ 检查/ 通过/ Page5/ 后/ ,/ Si/ 计算/ 部分/ 签名/ PSi/ (/ MW/ )/ ,/ 回复/ [/ PSWrite/ ,/ state/ ,/ i/ ,/ PSi/ (/ MW/ )/ ,/ ReqW/ ]/ i/ ./ I/ ./ Sd/ 周期性地/ 重复/ 执行/ 步骤/ G/ ,/ 直至/ 收到/ fd/ +/ 1/ 台/ 服务器/ (/ 包括/ Sd/ )/ 的/ PSWrite/ 消息/ ./ 然后/ Sd/ 将/ fd/ +/ 1/ 个/ 部分/ 签名/ 合成/ [/ RespWrite/ ,/ c/ ,/ x/ ,/ vW/ ,/ tW/ ,/ p/ ]/ SK/ ,/ 发送给/ 客户端/ c/ ./ 3.4/ TSS/ -/ mBQS/ 状态/ 的/ 服务器/ 协议/ TSS/ -/ mBQS/ 状态/ 能/ 容忍/ fm/ 台/ 失效/ 服务器/ ,/ 读/ // 写/ Quorum/ 包含/ 的/ 服务器/ 数量/ 分别/ 记为/ qmr/ 和/ qmw/ ./ 当/ Sd/ 的/ state/ 变量/ 表明/ 当前/ 是/ TSS/ -/ mBQS/ 状态/ 时/ ,/ 使用/ 如下/ 服务器/ 协议/ ./ 相比/ TSS/ -/ dBQS/ 状态/ ,/ TSS/ -/ mBQS/ 状态/ 的/ 服务器/ 协议/ 有/ 如下/ 变化/ :/ (/ 1/ )/ 各/ 消息/ 中/ 的/ state/ 设定/ 为/ TSS/ -/ mBQS/ ;/ 相应/ 地/ ,/ 读/ // 写/ Quorum/ 的/ 服务器/ 数量/ 变为/ qmr/ 和/ qmw/ ./ (/ 2/ )/ 因为/ TSS/ -/ mBQS/ 状态/ 存储/ 普通/ 数据/ ,/ WRITE/ 操作/ 不/ 需要/ 步骤/ B/ 、/ C/ 和/ D/ 对/ 数据/ 进行/ 门限/ 签名/ ./ 在/ 步骤/ A/ ,/ Sd/ 直接/ 发送/ [/ Write/ ,/ state/ ,/ d/ ,/ [/ x/ ,/ vW/ ,/ tW/ ]/ ,/ ReqW/ ]/ d/ 给/ 所有/ 服务器/ ./ 所以/ ,/ 在/ 步骤/ E/ ,/ 当/ Si/ 从/ Sd/ 收到/ Write/ 消息/ 时/ ,/ 验证/ 其中/ 的/ ReqW/ 有效/ 、/ [/ x/ ,/ vW/ ,/ tW/ ]/ 是/ 对应/ 的/ 普通/ 数据/ 后/ ,/ 回复/ Ack/ 消息/ ./ 4TSS/ -/ BQS/ 系统/ 的/ GracefulDegradation/ 机制/ 3.3/ 节/ 和/ 3.4/ 节/ 描述/ 了/ 系统/ 的/ 两种/ 运行/ 状态/ ./ TSS/ -/ mBQS/ 状态/ 容忍/ 的/ 失效/ 服务器/ 数量/ 小于/ TSS/ -/ dBQS/ 状态/ (/ 见/ 4.3/ 节/ 的/ 分析/ )/ ,/ 但是/ 读/ // 写/ 操作/ 性能/ 更高/ (/ 见/ 4.6/ 节/ 的/ 详细/ 性能/ 分析/ 和/ 实验/ 结果/ )/ ./ 基于/ 上述/ 观察/ 和/ 分析/ ,/ 我们/ 设计/ 了/ TSS/ -/ BQS/ 系统/ 的/ GracefulDegradation/ 机制/ :/ 在/ 初始/ 阶段/ ,/ 系统/ 以/ TSS/ -/ mBQS/ 状态/ 运行/ ,/ 容忍/ fm/ =/ fd2/ 台/ 失效/ 服务器/ ;/ 当/ 运行/ 一定/ 时间/ 或者/ 出现/ 安全事件/ 后/ (/ 关于/ 状态/ 切换/ 的/ 发起/ ,/ 详见/ 5.2/ 节/ 讨论/ )/ ,/ 切换/ 到/ TSS/ -/ dBQS/ 状态/ ,/ 降低/ 性能/ 、/ 容忍/ fd/ 台/ 失效/ 服务器/ ./ 需要/ 指出/ ,/ 在/ 状态/ 切换/ 期间/ ,/ 最/ 多/ 只能/ 有/ fm/ 台/ 失效/ 服务器/ ;/ 只有/ 状态/ 切换/ 完成/ 后/ ,/ TSS/ -/ BQS/ 系统/ 才能/ 容忍/ fd/ 台/ 失效/ 服务器/ ./ 相比/ 现有/ 的/ TSS/ -/ BQS/ 系统/ [/ 3/ ,/ 5/ -/ 7/ ]/ (/ 由/ 3fd/ +/ 1/ 台/ 服务器/ 组成/ 、/ 容忍/ fd/ 台/ 失效/ 服务器/ )/ ,/ 在/ 不/ 影响/ 容错/ 能力/ 、/ 容忍/ fd/ 台/ 失效/ 服务器/ 的/ 前提/ 下/ ,/ 我们/ 的/ 系统/ 在/ 部分/ 时间/ 里/ 运行/ 在/ 性能/ 更/ 高/ 的/ TSS/ -/ mBQS/ 状态/ ,/ 所以/ GracefulDegradation/ 机制/ 能/ 带来/ 更/ 高/ 的/ 平均/ 性能/ ./ 在/ 我们/ 的/ 系统/ 中/ ,/ GracefulDegradation/ 机制/ 表现/ 为/ 由/ 服务器/ 合作/ 执行/ 的/ 状态/ 切换/ 协议/ ,/ 状态/ 切换/ 协议/ 使/ 各/ 服务器/ 的/ state/ 变量/ 从/ TSS/ -/ mBQS/ 变为/ TSS/ -/ dBQS/ ./ 下面/ ,/ 我们/ 先/ 列出/ 切换/ 协议/ 应/ 满足/ 的/ 条件/ :/ (/ 1/ )/ 容错性/ ./ 状态/ 切换/ 应由/ 多台/ 服务器/ 共同/ 发起/ 或者/ 经过/ 多台/ 服务器/ 同意/ 才能/ 完成/ ;/ 否则/ ,/ 失效/ 服务器/ 就/ 可以/ 在/ 不必要/ 的/ 时候/ (/ 例如/ ,/ 系统/ 刚/ 开始运行/ 时/ )/ ,/ 恶意/ 地/ 切换/ 到/ TSS/ -/ dBQS/ 状态/ ,/ 就/ 相当于/ 系统/ 始终/ 运行/ 在/ TSS/ -/ dBQS/ 状态/ ,/ 不能/ 提高/ 性能/ ./ (/ 2/ )/ 完整性/ ./ 在/ fm/ 台/ 失效/ 服务器/ 的/ 情况/ 下/ ,/ 切换/ 协议/ 能够/ 顺利/ 地/ 执行/ ./ 而且/ ,/ 在/ 状态/ 切换/ 协议/ 结束/ 之后/ ,/ 所有/ 读/ // 写/ 操作/ 都/ 必须/ 在/ TSS/ -/ dBQS/ 状态/ 下/ 进行/ ,/ 不/ 可能/ 再/ 执行/ TSS/ -/ mBQS/ 状态/ 的/ 读/ // 写/ 操作/ ./ (/ 3/ )/ 兼容性/ ./ 切换/ 协议/ 能/ 与/ 读/ // 写/ 操作/ 协议/ 并行执行/ ,/ 可/ 在/ 不/ 中断/ 存储/ 服务/ 、/ 不/ 影响/ 客户端/ 的/ 情况/ 下/ 完成/ ./ (/ 4/ )/ 一致性/ ./ 切换/ 协议/ 与/ 客户端/ // 服务器/ 的/ 读/ // 写/ 操作/ 协议/ 使用/ 一致/ 的/ 系统/ 模型/ ./ (/ 5/ )/ 高效性/ ./ 切换/ 协议/ 应/ 能够/ 快速/ 地/ 执行/ ;/ 否则/ ,/ 如果/ 切换/ 协议/ 耗时/ 太/ 长/ ,/ 甚至/ 不如/ 恢复/ 失效/ 服务器/ 的/ 速度/ ,/ 状态/ 切换/ 就/ 没有/ 意义/ ./ 4.1/ 状态/ 切换/ 协议/ 在/ 下面/ 的/ 状态/ 切换/ 协议/ 描述/ 中/ ,/ 我们/ 先/ 假定/ 至少/ 会/ 有/ 1/ 台/ 正确/ 服务器/ 来/ 发起/ 切换/ 协议/ (/ 也/ 称为/ Delegate/ 、/ 记为/ Sd/ )/ ./ 在/ 5.2/ 节/ 的/ 讨论/ 中/ ,/ 我们/ 将/ 说明/ 如何/ 保证/ 有/ 正确/ 服务器/ 作为/ Delegate/ 发起/ 切换/ 协议/ ./ 此外/ ,/ 需要/ 指出/ ,/ 状态/ 切换/ 操作/ 、/ 读/ // 写/ 操作/ 的/ Delegate/ 相互之间/ 没有/ 联系/ ,/ 任意/ 服务器/ 都/ 可以/ 作为/ Delegate/ 、/ 各/ 操作/ 的/ Delegate/ 可以/ 不同/ ./ A/ ./ Sd/ 发送/ [/ SignTicket/ ,/ d/ ,/ MG/ ,/ reason/ ]/ d/ 给/ 所有/ 服务器/ ./ 其中/ ,/ MG/ =/ [/ Ticket/ ,/ Ig/ ]/ ,/ reason/ 是/ 发起/ 本次/ 切换/ 协议/ 的/ 原因/ (/ 详见/ 5.2/ 节/ 的/ 说明/ )/ ,/ Ig/ =/ Hash/ (/ reason/ )/ 是/ 本次/ 状态/ 切换/ 的/ 唯一/ 标识/ ./ B/ ./ 当/ Si/ 收到/ SignTicket/ 消息/ 时/ ,/ 验证/ 其中/ 的/ reason/ 有效/ 后/ ,/ 计算/ 部分/ 签名/ PSi/ (/ MG/ )/ ,/ 回复/ [/ PSTicket/ ,/ i/ ,/ PSi/ (/ MG/ )/ ,/ Ig/ ]/ i/ ./ C/ ./ Sd/ 周期性地/ 重复/ 执行/ 步骤/ A/ ,/ 直至/ 收到/ fd/ +/ 1/ 台/ 服务器/ (/ 包括/ Sd/ )/ 的/ PSTicket/ 消息/ ./ 然后/ Sd/ 将/ fd/ +/ 1/ 个/ 部分/ 签名/ 合成/ 为/ [/ Ticket/ ,/ Ig/ ]/ SK/ ./ D/ ./ Sd/ 发送/ [/ Degrade/ ,/ d/ ,/ [/ Ticket/ ,/ Ig/ ]/ SK/ ]/ d/ 给/ 所有/ 服务器/ ./ E/ ./ 当/ Si/ 收到/ Degrade/ 消息/ 时/ ,/ 验证/ 其中/ 的/ [/ Ticket/ ,/ Ig/ ]/ SK/ 的/ Servicekey/ 数字签名/ 有效/ 后/ ,/ 存储/ Page6/ [/ Ticket/ ,/ Ig/ ]/ SK/ 、/ 将/ 自己/ 的/ state/ 变量/ 设定/ 为/ TSS/ -/ dBQS/ ,/ 回复/ [/ Echo/ ,/ i/ ,/ Ig/ ]/ i/ ./ F/ ./ Sd/ 周期性地/ 重复/ 执行/ 步骤/ D/ ,/ 直至/ 收到/ n/ -/ fm/ 台/ 服务器/ (/ 包括/ Sd/ )/ 的/ Echo/ 消息/ ./ 4.2/ 并发/ 执行/ 情况/ 的/ 处理/ 在/ 切换/ 协议/ 执行/ 过程/ 中/ ,/ 如果/ 同时/ 有/ 并发/ 执行/ 的/ 读/ // 写/ 操作/ ,/ 则/ 参加/ 读/ // 写/ 操作/ 的/ 服务器/ 的/ state/ 变量/ 可能/ 不同/ :/ 因为/ 在/ 异步/ 网络/ 环境/ 中/ ,/ 有些/ 服务器/ 已经/ 切换/ 到/ TSS/ -/ dBQS/ 状态/ 、/ 有些/ 仍然/ 处于/ TSS/ -/ mBQS/ 状态/ ./ 我们/ 采取/ 如下/ 方式/ 处理/ :/ (/ 1/ )/ Si/ 只/ 处理/ 与/ 自己/ state/ 变量/ 相同/ 的/ 读/ // 写/ 操作/ 消息/ ./ 当/ Si/ 处于/ TSS/ -/ mBQS/ 状态/ ,/ 只/ 处理/ state/ 是/ TSS/ -/ mBQS/ 的/ 消息/ ;/ 当/ Si/ 处于/ TSS/ -/ dBQS/ 状态/ ,/ 只/ 处理/ state/ 是/ TSS/ -/ dBQS/ 的/ 消息/ ./ (/ 2/ )/ 当/ Si/ 处于/ TSS/ -/ dBQS/ 状态/ ,/ 如果/ 收到/ TSS/ -/ mBQS/ 状态/ 的/ 读/ // 写/ 操作/ 消息/ ,/ 则/ 直接/ 回复/ 自己/ 存储/ 的/ [/ Ticket/ ,/ Ig/ ]/ SK/ ,/ 要求/ Sd/ 切换/ 到/ TSS/ -/ dBQS/ 状态/ ,/ 然后/ 重新/ 执行/ 读/ // 写/ 操作/ 的/ 服务器/ 协议/ ./ 因为/ Ticket/ 消息/ 带有/ ServiceKey/ 数字签名/ ,/ 任何/ 服务器/ 都/ 可以/ 验证/ ./ (/ 3/ )/ 当/ Si/ 处于/ TSS/ -/ mBQS/ 状态/ ,/ 如果/ 收到/ TSS/ -/ dBQS/ 状态/ 的/ 读/ // 写/ 操作/ 消息/ ,/ 则/ Si/ 请求/ Sd/ 先/ 发送/ [/ Ticket/ ,/ Ig/ ]/ SK/ ./ 在/ Si/ 验证/ [/ Ticket/ ,/ Ig/ ]/ SK/ 有效/ 、/ 切换/ 到/ TSS/ -/ mBQS/ 状态/ 后/ ,/ 继续执行/ 读/ // 写/ 操作/ 的/ 服务器/ 协议/ ./ (/ 4/ )/ 当读/ // 写/ 操作/ 的/ Sd/ 处于/ TSS/ -/ dBQS/ 状态/ ,/ 如果/ 收到/ 其它/ 服务器/ 的/ 请求/ ,/ 则/ 回复/ [/ Ticket/ ,/ Ig/ ]/ SK/ ./ (/ 5/ )/ 当读/ // 写/ 操作/ 的/ Sd/ 处于/ TSS/ -/ mBQS/ 状态/ ,/ 如果/ 收到/ 有效/ 的/ [/ Ticket/ ,/ Ig/ ]/ SK/ (/ 无论是/ 在/ 切换/ 协议/ 的/ Degrade/ 消息/ 中/ 、/ 或者/ 是/ 读/ // 写/ 操作/ 的/ 服务器/ Si/ 回复/ 消息/ 中/ )/ ,/ 就/ 先/ 切换/ 到/ TSS/ -/ dBQS/ 状态/ ,/ 然后/ 重新/ 开始/ 执行/ 读/ // 写/ 操作/ ./ 4.3/ 参数/ 分析/ 首先/ ,/ 系统/ 参数/ 需要/ 满足/ BQS/ 系统/ [/ 1/ ]/ 要求/ ,/ 才/ 能够/ 保证/ 读/ // 写/ 操作/ 的/ 服务器/ 协议/ 的/ 顺利/ 执行/ 和/ 正确性/ :/ (/ 1/ )/ DisseminationBQS/ 系统/ 要求/ ,/ qdr/ / n/ -/ fd/ ,/ qdw/ / n/ -/ fd/ ,/ qdr/ +/ qdw/ -/ n/ / fd/ +/ 1/ ./ 当/ n/ =/ 3fd/ +/ 1/ 时/ ,/ 有/ qdr/ =/ qdw/ =/ 2fd/ +/ 1/ ./ (/ 2/ )/ MaskingBQS/ 系统/ 要求/ ,/ qmr/ / n/ -/ fm/ ,/ qmw/ / n/ -/ fm/ ,/ qmr/ +/ qmw/ -/ n/ / 2fm/ +/ 1/ ./ 其次/ ,/ 因为/ 引入/ 了/ 状态/ 切换/ ,/ 我们/ 还/ 需要/ 考虑/ 状态/ 切换/ 时/ 的/ 特殊/ 情况/ ./ 在/ 切换/ 到/ TSS/ -/ dBQS/ 状态/ 之后/ ,/ 如果/ 尚未/ 执行/ 过/ TSS/ -/ dBQS/ 状态/ 的/ 写/ 操作/ ,/ 则/ 各/ 服务器/ 仍/ 存储/ 普通/ 数据/ [/ x/ ,/ vi/ ,/ ti/ ]/ ./ 所以/ ,/ 此时/ 执行/ TSS/ -/ dBQS/ 状态/ 的/ 读/ 操作/ ,/ 不但/ 要/ 考虑/ 自/ 验证/ 数据/ ,/ 还/ 需要/ 考虑/ 普通/ 数据/ 的/ 情况/ :/ (/ 1/ )/ 因为/ 状态/ 切换/ 已/ 完成/ 、/ 系统/ 处于/ TSS/ -/ dBQS/ 状态/ ,/ 可能/ 已有/ fd/ 台/ 失效/ 服务器/ ./ 所以/ ,/ 在/ 最差/ 情况/ 下/ ,/ 会/ 有/ fd/ +/ n/ -/ qmw/ 台/ 服务器/ 向/ Sd/ 回复/ 错误/ 的/ 普通/ 数据/ (/ 其中/ ,/ 有/ fd/ 台/ 失效/ 服务器/ ,/ 又/ 有/ n/ -/ qmw/ 台/ 没有/ 参加/ 上/ 一次/ TSS/ -/ mBQS/ 状态/ 的/ 写/ 操作/ )/ ./ 所以/ ,/ 只要/ Sd/ 得到/ fd/ +/ n/ -/ qmw/ +/ 1/ 个/ 相同/ 数据/ ,/ 就/ 可以/ 确定/ 是/ 正确/ 结果/ ./ (/ 2/ )/ 为了/ 保证/ 在/ 各种/ 失效/ 情况/ 下/ ,/ Sd/ 都/ 能够/ 得到/ :/ fd/ +/ n/ -/ qmw/ +/ 1/ 个/ 相同/ 数据/ ,/ 则/ TSS/ -/ mBQS/ 状态/ 的/ 写/ 操作/ 至少/ 写入/ fd/ +/ (/ fd/ +/ n/ -/ qmw/ +/ 1/ )/ 台/ 服务器/ ,/ 才能/ 容忍/ fd/ 台/ 服务器/ 在/ 写入/ 数据/ 后/ 失效/ ,/ 不/ 参加/ TSS/ -/ dBQS/ 状态/ 的/ 读/ 操作/ ;/ 所以/ ,/ 有/ qmw/ / fd/ +/ fd/ +/ n/ -/ qmw/ +/ 1/ / qmw/ / (/ n/ +/ 2fd/ +/ 1/ )/ // 2/ ./ (/ 3/ )/ MaskingBQS/ 系统/ 要求/ qmw/ / n/ -/ fm/ ,/ 可/ 得到/ :/ n/ -/ fm/ / (/ n/ +/ 2fd/ +/ 1/ )/ // 2/ / fm/ / fd/ // 2/ ./ 仅/ 在/ qmw/ =/ n/ -/ fm/ 时/ ,/ 不等式/ 中/ 的/ 等/ 号/ 才/ 成立/ ,/ 此时/ fm/ 取/ 最大值/ fd2/ ,/ 使/ 系统/ 尽可能/ 长时间/ 处于/ TSS/ -/ mBQS/ 状态/ 以/ 提高/ 平均/ 性能/ ./ (/ 4/ )/ 由/ qmw/ =/ n/ -/ fm/ ,/ 容易/ 推导/ 得到/ :/ 当/ n/ -/ fm/ / qmr/ / 3fm/ +/ 1/ 时/ ,/ 满足/ MaskingBQS/ 系统/ 的/ 可用性/ 和/ 一致性/ 要求/ ./ 基于/ 上述/ 分析/ ,/ 在/ TSS/ -/ dBQS/ 状态/ ,/ 从/ qdr/ =/ 2fd/ +/ 1/ 个/ 数据/ 中/ 选出/ 正确/ 结果/ 的/ 方法/ :/ 先/ 尝试/ 寻找/ 出现/ 次数/ 不少/ 于/ fd/ +/ fm/ +/ 1/ 的/ 结果/ ,/ 作为/ 正确/ 结果/ ;/ 否则/ ,/ 将/ 验证/ 有效/ 的/ 、/ 时/ 戳/ 最大/ 的/ 自/ 验证/ 数据/ 作为/ 正确/ 结果/ ./ 在/ TSS/ -/ mBQS/ 状态/ ,/ 从/ qmr/ =/ 3fm/ +/ 1/ 个/ 数据/ 中/ 选出/ 正确/ 结果/ 的/ 方法/ :/ 去掉/ 出现/ 次数/ 少于/ fm/ +/ 1/ 的/ 结果/ ,/ 剩余/ 结果/ 中时/ 戳/ 最大/ 的/ 就是/ 正确/ 结果/ ./ 注意/ :/ 在/ TSS/ -/ dBQS/ 状态/ ,/ 应该/ 优先/ 尝试/ 寻找/ 出现/ 次数/ 不少/ 于/ fd/ +/ fm/ +/ 1/ 的/ 结果/ ,/ 以/ 避免/ 失效/ 服务器/ 回复/ 上/ 一个/ ProactiveRecovery/ 周期/ 的/ 、/ 旧/ 的/ 自/ 验证/ 数据/ ./ 4.4/ 安全性/ 分析/ 出/ 的/ 各项/ 要求/ :/ 下面/ ,/ 我们/ 分析/ 状态/ 切换/ 协议/ 是否/ 满足/ 上文提/ (/ 1/ )/ 容错性/ ./ Ticket/ 消息/ 需要/ fd/ +/ 1/ 台/ 服务器/ 合作/ 进行/ ServiceKey/ 门限/ 签名/ ,/ 其中/ 必定/ 有/ 正确/ 服务器/ 参加/ ./ 所以/ ,/ 即使/ fd/ 台/ 失效/ 服务器/ 合谋/ ,/ 也/ 不能/ 在/ 不必要/ 的/ 时候/ 切换/ 状态/ ./ Page7/ (/ 2/ )/ 完整性/ ./ 首先/ ,/ 状态/ 切换/ 协议/ 需要/ fd/ +/ 1/ 台/ 服务器进行/ Ticket/ 消息/ 的/ ServiceKey/ 门限/ 签名/ 、/ n/ -/ fm/ 台/ 服务器/ 回复/ Echo/ 消息/ ,/ 因为/ 在/ 状态/ 切换/ 过程/ 中/ 最/ 多/ 有/ fm/ 台/ 失效/ 服务器/ ,/ 所以/ 肯定/ 能/ 顺利/ 执行/ 结束/ ./ 其次/ ,/ 在/ 状态/ 切换/ 完成/ 后/ ,/ 至少/ 有/ n/ -/ fm/ 台/ 服务器/ 已/ 收到/ Ticket/ 消息/ (/ 其中/ 可能/ 包含/ 有/ fd/ 台/ 失效/ 服务器/ )/ ./ 在此之后/ ,/ 如果/ 要/ 成功/ 执行/ TSS/ -/ mBQS/ 状态/ 的/ 写/ 操作/ ,/ 则/ 至少/ 要/ 有/ qmw/ 台/ 服务器/ 参加/ ,/ 易/ 验证/ 有/ qmw/ +/ (/ n/ -/ fm/ )/ -/ n/ >/ fd/ 成立/ ;/ 也就是说/ ,/ 在/ TSS/ -/ mBQS/ 状态/ 的/ 写/ 操作过程/ 中/ ,/ 必然/ 有/ 已/ 收到/ Ticket/ 消息/ 、/ 处于/ TSS/ -/ dBQS/ 状态/ 的/ 正确/ 服务器/ 参加/ ,/ 该/ 服务器/ 会/ 使/ Sd/ 切换/ 到/ TSS/ -/ dBQS/ 状态/ ./ 最后/ ,/ 对于/ TSS/ -/ mBQS/ 状态/ 的/ 读/ 操作/ ,/ 则/ 略有不同/ ./ 根据/ 上/ 一节/ 分析/ ,/ 要求/ n/ -/ fm/ / qmr/ / 3fm/ +/ 1/ ,/ 同时/ 还要/ 满足/ qmr/ +/ (/ n/ -/ fm/ )/ -/ n/ >/ fd/ ,/ 才/ 会/ 使得/ 在此之后/ 的/ TSS/ -/ mBQS/ 状态/ 的/ 读/ 操作/ 不能/ 执行/ 结束/ ,/ 保证/ 有/ 正确/ 服务器/ 会/ 使/ Sd/ 切换/ 到/ TSS/ -/ dBQS/ 状态/ ,/ 并/ 重新/ 进行/ TSS/ -/ dBQS/ 状态/ 的/ 读/ 操作/ ./ 容易/ 计算/ ,/ 满足/ 上述/ 条件/ 的/ qmr/ 最小值/ 是/ fm/ +/ fd/ +/ 1/ ,/ 使得/ 在/ 切换/ 协议/ 结束/ 之后/ ,/ 所有/ 读/ // 写/ 操作/ 都/ 在/ TSS/ -/ dBQS/ 状态/ 下/ 进行/ ./ 综合/ 以上/ 分析/ ,/ 表/ 1/ 列出/ 了/ 各/ 系统/ 参数/ 的/ 表达式/ ./ 签名/ 门限/ fm/ =/ fdfd2317564341107954521391175621611148/ (/ 3/ )/ 兼容性/ ./ 首先/ ,/ 客户端/ 发出/ 的/ 读/ // 写/ 请求/ 消息/ 中/ 不/ 包含/ 系统/ 的/ 状态/ 信息/ ,/ 在/ TSS/ -/ mBQS/ 状态/ 或者/ TSS/ -/ dBQS/ 状态/ 下/ ,/ 读/ // 写/ 操作/ 的/ Sd/ 都/ 可以/ 用来/ 发起/ 服务器/ 协议/ ./ 其次/ ,/ 根据/ 4.2/ 节/ 的/ 并行执行/ 情况/ 处理/ ,/ 在/ 状态/ 切换/ 过程/ 中/ 开始/ 的/ 读/ // 写/ 操作/ ,/ 也/ 会/ 转为/ TSS/ -/ dBQS/ 状态/ 的/ 读/ // 写/ 操作/ 并/ 顺利/ 执行/ ./ 因为/ 切换/ 协议/ 中/ 使用/ 了/ 带有/ ServiceKey/ 数字签名/ 的/ Ticket/ 消息/ ,/ 各/ 服务器/ 都/ 可以/ 独立/ 地/ 验证/ 是否/ 有效/ 、/ 分别/ 切换/ 状态/ ,/ 所以/ Sd/ 可以/ 直接/ 要求/ 其它/ 服务器/ 切换/ 状态/ ,/ 配合/ 执行/ 服务器/ 协议/ ./ 第三/ ,/ 根据/ 4.3/ 节/ 的/ 参数/ 分析/ ,/ 在/ 切换/ 到/ TSS/ -/ dBQS/ 状态/ 后/ ,/ 虽然/ 各/ 服务器/ 存储/ 普通/ 数据/ ,/ 读/ 操作/ 仍/ 可以/ 顺利/ 执行/ 并/ 得到/ 正确/ 结果/ ;/ 状态/ 切换/ 后/ TSS/ -/ dBQS/ 状态/ 的/ 写/ 操作/ ,/ 也/ 可以/ 顺利/ 执行/ ./ (/ 4/ )/ 一致性/ ./ 上述/ 的/ 安全性/ 分析/ ,/ 使用/ 了/ 与/ 客户端/ // 服务器/ 协议/ 完全一致/ 的/ 系统/ 模型/ ./ 4.5/ 性能/ 分析/ 和/ 实验/ 结果/ 本节/ 先/ 从/ 通信量/ 和/ 计算/ 量分析/ 了/ 两种/ 状态/ 下/ 的/ 读/ // 写/ 操作/ 、/ 状态/ 切换/ 的/ 性能/ ;/ 然后/ 给出/ 了/ 原型/ 系统/ 的/ 实验/ 结果/ ./ 理论/ 分析/ 和/ 实验/ 结果/ 都/ 表明/ :/ TSS/ -/ mBQS/ 状态/ 的/ 性能/ 优于/ TSS/ -/ dBQS/ 状态/ ,/ 状态/ 切换/ 的/ 资源/ 消耗/ 与/ 1/ 次读/ // 写/ 操作/ 相当/ 、/ 能够/ 快速/ 完成/ ./ 4.5/ ./ 1/ 性能/ 分析/ 图/ 1/ 给出/ 了/ 两种/ 状态/ 下/ 的/ 读/ // 写/ 操作/ 、/ 状态/ 切换/ 的/ 通信/ 和/ 计算/ 情况/ ./ 其中/ ,/ 在/ 分析/ 写/ 操作/ 的/ 性能/ 时/ ,/ 不/ 包括/ 发送/ 写/ 请求/ 消息/ ReqW/ 之前/ 的/ 读/ 操作/ (/ 用来/ 获得/ 当前/ 时/ 戳/ )/ ;/ 对于/ TSS/ -/ dBQS/ 状态/ 的/ 读/ 操作/ ,/ 只/ 考虑/ 自/ 验证/ 数据/ 的/ 情况/ ,/ 因为/ 在/ 大部分/ 情况/ 下/ ,/ TSS/ -/ dBQS/ 状态/ 的/ 读/ 操作/ 都/ 是/ 得到/ 自/ 验证/ 数据/ ./ 在/ 图/ 1/ 中/ ,/ 箭头/ 表示/ 通信/ 过程/ 、/ 方框/ 表示/ 计算/ 过程/ ./ 并行执行/ 的/ 通信/ 过程/ ,/ 在/ 图/ 中/ 表示/ 为/ 1/ 次/ 通信/ ./ 例如/ ,/ Sd/ 同时/ 向/ 多台/ 服务器发送/ Read/ 消息/ 、/ 多台/ 服务器/ 向/ Sd/ 同时/ 回复/ Replica/ 消息/ ,/ 所/ 需/ 通信/ 时间/ 与/ 服务器/ 数量/ 基本/ 无关/ 、/ 取决于/ 其中/ 耗时/ 最长/ 的/ 某/ 一次/ 通信/ ./ 可以/ 看出/ ,/ TSS/ -/ mBQS/ 状态/ 的/ 读/ // 写/ 操作/ 需要/ 3/ 轮/ 通信/ ;/ TSS/ -/ dBQS/ 状态/ 的/ 读/ 操作/ 需要/ 3/ 轮/ 通信/ 、/ 写/ 操作/ 需要/ 4/ 次/ 通信/ ;/ 状态/ 切换/ 需要/ 2/ 轮/ 通信/ ./ COCA/ [/ 3/ ]/ 和/ CODEX/ [/ 5/ ]/ 的/ 实验/ 测试/ 结果表明/ :/ 在/ TSS/ -/ BQS/ 系统/ 中/ ,/ 主要/ 计算/ 消耗/ 是/ 公钥/ 密码/ 计算/ (/ ServiceKey/ 门限/ 签名/ 和/ 验证/ 、/ ServerKey/ 签名/ 和/ 验证/ )/ ,/ 其它/ 的/ 计算/ (/ 如/ Hash/ 计算/ 等/ )/ 可/ 忽略不计/ ./ 图/ 1/ 中/ ,/ Ts/ 和/ Tp/ 分别/ 表示/ 计算/ 1/ 次/ ServerKey/ 数字签名/ 和/ 1/ 次/ ServiceKey/ 部分/ 签名/ 的/ 时间/ ,/ Tv/ 表示/ 1/ 次/ 数字签名/ 验证/ 的/ 时间/ ,/ Tc/ 表示/ 合成/ ServiceKey/ 签名/ 的/ 时间/ ./ 同样/ 地/ ,/ 不同/ 服务器/ 并行执行/ 的/ 计算/ 过程/ ,/ 计为/ 1/ 次/ 计算/ ;/ 例如/ ,/ 多台/ 服务器/ 同时/ 执行/ ServiceKey/ 门限/ 签名/ 、/ 多台/ 服务器/ 分别/ 用/ 自己/ 的/ ServerKey/ 签名/ 消息/ ,/ 所/ 需/ 计算/ 时间/ 与/ 服务器/ 数量/ 基本/ 无关/ 、/ 取决于/ 其中/ 计算/ 最慢/ 的/ 某/ 1/ 台/ 服务器/ ./ 但是/ ,/ 由/ 同一/ 台/ 服务器/ 执行/ 的/ 连续/ 多次/ 计算/ ,/ 则/ 计为/ 多次/ ;/ 例如/ ,/ Sd/ 验证/ qmr/ 个/ Replica/ 消息/ 上/ 的/ ServerKey/ 数字签名/ ./ 表/ 2/ 列出/ 了/ 各/ 操作/ 的/ 计算/ 时间/ 公式/ 以及/ 当/ fd/ =/ 2/ 时/ 的/ 值/ (/ 在/ 原型/ 系统/ 中/ ,/ fd/ =/ 2/ )/ ./ 4.5/ ./ 2/ 原型/ 系统/ 和/ 实验/ 结果/ 按照/ 上文/ 描述/ 的/ 协议/ ,/ 我们/ 使用/ C语言/ 实现/ 了/ 原型/ 系统/ ./ 在/ 原型/ 系统/ 中/ ,/ fd/ =/ 2/ 、/ 签名/ 门限/ fd/ +/ 1/ =/ 3/ ,/ 其它/ 参数/ 按照/ 表/ 1/ 来/ 设定/ ./ ServiceKey/ 和/ ServerKey/ 都/ 是/ 1024/ -/ bitRSA/ 密钥/ 对/ ,/ 使用/ Shoup/ 门限/ 签名/ 方案/ [/ 9/ ]/ 来/ 拆分/ ServiceKey/ 私钥/ ./ 每/ 一个/ 变量/ 有/ Page8/ 图/ 1TSS/ -/ BQS/ 系统/ 的/ 通信量/ 和/ 计算/ 量表/ 2TSS/ -/ BQS/ 系统/ 的/ 计算/ 量/ 状态/ 切换/ 操作/ 32/ -/ bit/ 唯一/ 标识/ 和/ 512/ -/ bit/ 值/ ,/ 时/ 戳/ 是/ 192/ -/ bit/ (/ 包括/ 32/ -/ bit/ 的/ 整数/ 序号/ 和/ 160/ -/ bit/ 的/ SHA/ -/ 1/ 散列值/ )/ ./ 系统/ 由/ 7/ 台/ 服务器/ 和/ 1/ 台/ 客户端/ 组成/ ,/ 它们/ 之间/ 用/ 100M/ 以太网/ 连接/ 、/ UDP/ 通信/ ,/ 配置/ 都/ 是/ IntelPentium4/ (/ 2.4/ GHz/ )/ CPU/ 、/ 256MRAM/ 、/ Windows2000Server/ (/ SP2/ )/ 操作系统/ ./ 表/ 3/ 列出/ 了/ 原型/ 系统/ 的/ 实验/ 结果/ ./ 其中/ ,/ 读/ 操作/ 的/ 测量/ 时间/ 是从/ 客户端/ 生成/ ReqR/ 到/ 验证/ RespR/ ,/ 写/ 操作/ 的/ 测量/ 时间/ 是从/ 客户端/ 生成/ ReqW/ 到/ 验证/ RespW/ 、/ 不/ 包括/ 发送/ ReqW/ 之前/ 的/ 读/ 操作/ ,/ 协议/ 切换/ 操作/ 的/ 测量/ 时间/ 是从/ Sd/ 生成/ SignTicket/ 消息/ 到/ 验证/ qmw/ 个/ Echo/ 消息/ ./ 读/ 操作/ 写/ 操作/ 协议/ 切换/ 操作/ 5/ 讨论/ 5.1/ 与/ ProactiveRecovery/ 的/ 结合/ TSS/ -/ BQS/ 系统/ 的/ 重要/ 优点/ 是/ 支持/ ProactiveRecovery/ ./ 对于/ TSS/ -/ BQS/ 系统/ 的/ 存储/ 服务/ ,/ 每/ 一次/ 的/ ProactiveRecovery/ 都/ 需要/ 如下/ 处理/ [/ 3/ ,/ 12/ -/ 13/ ]/ :/ (/ 1/ )/ 每/ 一台/ 服务器/ 从/ 可信/ 的/ 只读/ 介质/ 重新/ 启/ Page9/ 动/ ,/ 恢复/ 到/ 运行/ 代码/ 无/ 错误/ 的/ 状态/ ./ (/ 2/ )/ 对于/ 每/ 一个/ 变量/ ,/ 每/ 一台/ 服务器/ 要/ 重新/ 获取/ 正确/ 的/ 值/ 和/ 时/ 戳/ ,/ 恢复/ 到/ 数据/ 无/ 错误/ 的/ 状态/ ./ (/ 3/ )/ 每/ 一台/ 服务器/ 更新/ ServerKey/ 并/ 向/ 其它/ 服务器/ 分发/ ServerKey/ 公钥/ 、/ 重新/ 拆分/ ServiceKey/ 私钥/ ,/ 保证/ 攻击者/ 不能/ 获得/ 超过/ f/ 台/ 服务器/ 的/ ServerKey/ 私钥/ 或者/ 恢复/ 出/ ServiceKey/ 私钥/ ./ 完成/ 上述/ ProactiveRecovery/ 需要/ 消耗/ 大量/ 的/ 服务器资源/ ;/ 尤其/ 当/ 存储/ 大量/ 数据/ 时/ ,/ 需要/ 繁重/ 的/ 通信/ 过程/ 才能/ 保证/ 恢复/ 到/ 数据/ 无/ 错误/ 的/ 状态/ ./ 所以/ ,/ 在/ TSS/ -/ BQS/ 系统/ 中/ ,/ 应/ 尽量减少/ ProactiveRecovery/ 次数/ ./ 另一方面/ ,/ 对于/ 给定/ 的/ 容错/ 系统/ 和/ 运行/ 环境/ ,/ 执行/ ProactiveRecovery/ 的/ 周期/ 与/ 系统/ 容忍/ 的/ 失效/ 服务器/ 数量/ 成正比/ :/ 容忍/ 的/ 失效/ 服务器/ 数量/ 越/ 少/ ,/ 需要/ 越/ 频繁/ 地/ 定期/ 执行/ ProactiveRecovery/ [/ 10/ ]/ ./ 结合/ 本文/ 设计/ 的/ GracefulDegradation/ 机制/ ,/ TSS/ -/ BQS/ 系统/ 能以/ 如下/ 方式/ 来/ 执行/ ProactiveRecovery/ :/ (/ 1/ )/ 在/ 系统/ 初始/ 启动/ 或者/ 每/ 一次/ ProactiveRecovery/ 之后/ ,/ 各/ 服务器/ 以/ TSS/ -/ mBQS/ 状态/ 运行/ ./ (/ 2/ )/ 以/ TSS/ -/ mBQS/ 状态/ 运行/ fm/ 到/ TSS/ -/ dBQS/ 状态/ ./ 其中/ ,/ TPR/ 是/ 根据/ 运行/ 环境/ 的/ 特性/ ,/ 估计/ 不/ 超过/ fd/ 台/ 服务器/ 失效/ 的/ 最长/ 时间/ ;/ 也/ 就是/ ,/ 已有/ TSS/ -/ BQS/ 系统/ [/ 3/ ,/ 5/ -/ 7/ ]/ 的/ ProactiveRecovery/ 周期/ ./ (/ 3/ )/ 以/ TSS/ -/ dBQS/ 状态/ 运行/ 1/ -/ fm/ 执行/ ProactiveRecovery/ ./ 下/ 比较/ 优势/ 和/ 灵活性/ :/ 本文/ 设计/ 的/ GracefulDegradation/ 机制/ ,/ 具有/ 如/ (/ 1/ )/ 如果/ n/ 台/ 服务器/ 组成/ 纯粹/ 的/ TSS/ -/ mBQS/ 系统/ (/ 始终/ 以/ TSS/ -/ mBQS/ 状态/ 运行/ )/ ,/ 只能/ 容忍/ n/ -/ 14/ 台/ 失效/ 服务器/ ./ 相比而言/ ,/ 我们/ 的/ 系统/ 能/ 容忍/ fd/ =/ n/ -/ 1/ 延长/ 了/ 约/ 1/ // 3/ ,/ 减少/ 了/ ProactiveRecovery/ 次数/ ;/ 代价/ 则/ 是/ 只有/ 约/ 一半/ 时间/ 具备/ TSS/ -/ mBQS/ 系统/ 的/ 性能/ 、/ 其余/ 时间/ 的/ 性能/ 只/ 相当于/ TSS/ -/ dBQS/ 系统/ ./ (/ 2/ )/ 相比/ 纯粹/ 的/ TSS/ -/ dBQS/ 系统/ ,/ 我们/ 的/ Pro/ -/ activeRecovery/ 周期/ 相同/ ,/ 但是/ 有/ 约/ 一半/ 时间/ 以/ TSS/ -/ mBQS/ 状态/ 运行/ 、/ 性能/ 更高/ ,/ 提高/ 了/ 系统/ 的/ 平均/ 性能/ ./ 5.2/ 状态/ 切换/ 协议/ 的/ 发起/ 状态/ 切换/ 协议/ 可以/ 在/ 如下/ 情况/ 下/ 发起/ :/ (/ 1/ )/ 结合/ ProactiveRecovery/ ,/ 在/ 预定/ 时间/ 定期/ 发起/ ./ 任何/ 正确/ 服务器/ ,/ 在/ 预定/ 时间/ 到达/ 时/ ,/ 自动/ 转为/ Delegate/ ,/ 发起/ 切换/ 协议/ ;/ 或者/ ,/ 也/ 可以/ 采取/ PBFT/ [/ 12/ ]/ 所/ 使用/ 的/ 轮换/ 方式/ :/ 各/ 服务器/ 按/ 顺序/ 轮流/ 担任/ Delegate/ ,/ 如果/ 发现/ 当前/ Delegate/ 未/ 完成/ 状态/ 切换/ 协议/ ,/ 则/ 认为/ 该/ Delegate/ 已/ 失效/ ;/ 由/ 其余/ 服务器/ 合作/ 确定/ 下/ 一台/ 服务器/ 来/ 担任/ Delegate/ ./ 切换/ 协议/ 中/ 的/ reason/ =/ [/ Schedule/ ,/ time/ ]/ ,/ 其中/ Schedule/ 表示/ 是/ 按/ 预定/ 时间/ 执行/ ,/ time/ 则/ 是/ 预定/ 的/ 时间/ ./ Si/ 验证/ reason/ 是否/ 有效/ :/ time/ 是否/ 与/ Si/ 设定/ 的/ 时间/ 一致/ 、/ time/ 与/ Si/ 本地/ 时钟/ 的/ 误差/ 在/ 允许/ 范围/ 内/ ./ (/ 2/ )/ 发生/ 某些/ 预料/ 之外/ 的/ 重大/ 安全事件/ ,/ 对/ 运行/ 环境/ 的/ 原有/ 估计不足/ ,/ 则/ 需要/ 在/ 预定/ 时间/ 之前/ 就/ 发起/ 切换/ 协议/ ./ 例如/ ,/ 爆发/ 全新/ 的/ 严重/ 病毒/ 和/ 木马/ 、/ 可能/ 会/ 影响/ 服务器/ 状态/ ,/ 或者/ 发现/ 了/ 服务器/ 的/ 系统漏洞/ ,/ 但/ 相应/ 补丁/ 尚未/ 发布/ 等/ ./ 此时/ ,/ 发现/ 安全事件/ 的/ 正确/ 服务器/ 会/ 转为/ Delegate/ ,/ 发起/ 切换/ 协议/ ,/ 相应/ 的/ reason/ =/ [/ Event/ ,/ description/ ]/ ,/ 其中/ Event/ 表示/ 是因为/ 安全事件/ 而/ 切换/ 状态/ ,/ description/ 给出/ 安全事件/ 的/ 描述/ (/ 例如/ ,/ 发布/ 病毒/ 、/ 木马/ 或/ 系统漏洞/ 的/ 可信/ 网站/ 链接/ )/ ./ Si/ 验证/ reason/ 需要/ 人工干预/ ,/ 由/ 管理员/ 阅读/ description/ ,/ 判断/ 是否/ 有/ 必要/ 进行/ 状态/ 切换/ ./ 6/ 相关/ 研究/ 文献/ [/ 4/ ]/ 最早/ 提出/ 了/ GracefulDegradation/ 的/ 概念/ :/ 运行/ 环境/ 恶化/ 、/ 超出/ 预先/ 估计/ 时/ ,/ 系统/ 调整/ 运行/ 状态/ ,/ 继续/ 提供/ 服务/ 但是/ 服务质量/ 有所/ 降低/ ./ 此后/ 的/ 研究/ 工作/ 将/ GracefulDegradation/ 概念/ 应用/ 于/ 集群/ 服务/ [/ 14/ ]/ 、/ 存储阵列/ [/ 15/ ]/ 等/ 领域/ ,/ 设计/ 了/ 以/ 降低/ 性能/ [/ 14/ ,/ 16/ ]/ 、/ 减少/ 可/ 访问/ 文件/ 数量/ [/ 15/ ]/ 、/ 降低/ 响应/ 结果/ 全面性/ [/ 16/ ]/ 和/ 准确性/ [/ 17/ ]/ 等/ 为/ 代价/ 的/ GracefulDegradation/ 机制/ ,/ 保证/ 失效/ 情况/ 下/ 的/ 服务/ 可用性/ ./ 针对/ 状态机/ 复制/ StateMachineReplication/ 系统/ ,/ 文献/ [/ 18/ -/ 19/ ]/ 分别/ 讨论/ 了/ 当/ 失效/ 服务器/ 数量/ 超过/ 预先/ 估计/ 时/ ,/ 通过/ 限制/ 失效/ 服务器/ 的/ 恶意/ 操作/ [/ 18/ ]/ 和/ 支持/ 部分/ 操作命令/ [/ 19/ ]/ 来/ 实现/ GracefulDegradation/ ./ 但是/ ,/ 上述/ 研究/ 的/ GracefulDegradation/ 机制/ 都/ 不是/ 针对/ BQS/ 系统/ 的/ 也/ 无法/ 直接/ 应用/ 于/ BQS/ 系统/ ./ COCA/ [/ 3/ ]/ 首次/ 结合/ 了/ 门限/ 签名/ 方案/ 和/ Dissemi/ -/ nationBQS/ 系统/ ,/ 完成/ 了/ TSS/ -/ BQS/ 系统/ (/ 也/ 相当于/ 本文/ 的/ TSS/ -/ dBQS/ 状态/ )/ ./ 使用/ 与/ COCA/ 相同/ 的/ 服务器/ 协议/ ,/ CODEX/ [/ 5/ ]/ 实现/ 了/ 容错/ 的/ 机密性/ 数据/ 存储/ Page10/ 服务/ ./ SP/ -/ II/ 设计/ 了/ 一种/ 新/ 的/ TSS/ -/ BQS/ 系统/ 服务器/ 协议/ [/ 6/ ]/ ./ 文献/ [/ 7/ ]/ 证明/ :/ TSS/ -/ BQS/ 系统/ 只/ 存在/ 两类/ 有效/ 的/ 服务器/ 协议/ ,/ 且/ 两类/ 协议/ 的/ 代表/ 分别/ 就是/ COCA/ [/ 3/ ]/ 和/ SP/ -/ II/ [/ 6/ ]/ ./ 类似/ 地/ ,/ PBFT/ -/ BC/ [/ 20/ ]/ 利用/ 门限/ 签名/ 方案/ 来/ 扩展/ 了/ BFT/ -/ BC/ 协议/ [/ 21/ ]/ ,/ 完成/ 了/ 容忍/ 失效/ 客户端/ 的/ BQS/ 系统/ ,/ 同时/ 支持/ ProactiveRecovery/ ./ 在/ 设计/ 思想/ 上/ ,/ TSS/ -/ BQS/ 系统/ 的/ ProactiveRecovery/ [/ 3/ ,/ 10/ -/ 11/ ]/ 和/ DynamicBQS/ 系统/ [/ 22/ ]/ ,/ 与/ 本文/ 的/ GracefulDegradation/ 机制/ 有/ 一定/ 的/ 相似之处/ :/ 在/ 失效/ 服务器/ 数量/ 有/ 可能/ 要/ 超过/ 预先/ 估计/ 时/ ,/ 提前/ 采取措施/ ,/ 使/ 系统/ 能/ 继续/ 提供/ 容错/ 服务/ ./ ProactiveRecovery/ 是/ 定期/ 性地/ 将/ 所有/ 服务器/ 恢复/ 到/ 初始/ 的/ 正确/ 状态/ ,/ 避免/ 失效/ 服务器/ 数量/ 超过/ 预先/ 估计/ ;/ 而/ 本文/ GracefulDegradation/ 机制/ 是/ 改变/ 存储/ 数据/ 的/ 类型/ (/ 也/ 就是/ 改变/ BQS/ 系统/ 的/ 类型/ )/ ,/ 使得/ 能够/ 容忍/ 更/ 多/ 的/ 失效/ 服务器/ ./ 此外/ ,/ 需要/ 注意/ ,/ 本文/ 提出/ 的/ GracefulDegradation/ 机制/ 完全/ 可以/ 和/ ProactiveRecovery/ 同时/ 结合/ 使用/ ./ DynamicBQS/ 系统/ [/ 22/ ]/ 是/ 由/ 4f/ +/ 1/ 台/ 服务器/ 组成/ 的/ MaskingBQS/ 系统/ ,/ 最多能/ 容忍/ f/ (/ f/ >/ 1/ )/ 台/ 失效/ 服务器/ :/ 在/ 初始/ 阶段/ ,/ 设定/ 适当/ 的/ qr/ // qw/ ,/ 只/ 容忍/ 1/ 台/ 失效/ 服务器/ ;/ 随着/ 系统/ 运行/ ,/ 不断/ 地/ 动态/ 改变/ qr/ // qw/ ,/ 降低/ 性能/ 、/ 容忍/ 2/ 、/ 3/ 、/ …/ 、/ f/ 台/ 失效/ 服务器/ ./ 本文/ 的/ GracefulDegradation/ 机制/ 与/ DynamicBQS/ 系统/ 的/ 区别/ 主要/ 在于/ :/ (/ 1/ )/ DynamicBQS/ 系统/ 的/ 容错/ 参数/ 变化/ 针对/ 同一/ 类型/ 的/ BQS/ 系统/ ,/ 而/ GracefulDegradation/ 机制/ 是/ 在/ 两种/ 不同/ 类型/ 的/ BQS/ 系统/ 之间/ 切换/ ;/ (/ 2/ )/ DynamicBQS/ 系统/ 只是/ 变化/ 了/ 每次/ 读/ // 写/ 操作/ 的/ 服务器/ 数量/ ,/ 通信/ 轮数/ 和/ 计算/ 时间/ 没有/ 明显/ 变化/ ,/ 性能/ 提高/ 有限/ ,/ 而/ 我们/ 的/ 状态/ 切换/ 改变/ 了/ 通信/ 轮数/ 和/ 计算/ 时间/ ,/ 性能/ 提高/ 更为/ 明显/ ;/ (/ 3/ )/ DynamicBQS/ 系统/ 的/ 客户端/ 需要/ 自己/ 处理/ 容错/ 参数/ ,/ 而/ 我们/ 的/ 机制/ 基于/ TSS/ -/ BQS/ 系统/ ,/ 客户端/ 不/ 需要/ 知道/ 系统/ 的/ 运行/ 状态/ ./ 7/ 总结/ 本文/ 设计/ 了/ 用于/ TSS/ -/ BQS/ 系统/ 的/ GracefulDegradation/ 机制/ :/ 系统/ 由/ n/ =/ 3fd/ +/ 1/ 台/ 服务器/ 组成/ ,/ 在/ 初始/ 阶段/ 以/ TSS/ -/ mBQS/ 状态/ 运行/ ,/ 能/ 容忍/ fm/ =/ fd2/ 台/ Byzantine/ 失效/ 服务器/ ;/ 随着/ 系统/ 运行/ ,/ 失效/ 的/ 服务器/ 数量/ 增大/ 、/ 有/ 可能/ 将要/ 超过/ fm/ ,/ 以/ 降低/ 性能/ 为/ 代价/ ,/ 切换/ 到/ TSS/ -/ dBQS/ 状态/ ,/ 能/ 容忍/ fd/ 台/ Byzantine/ 失效/ 服务器/ ./ 在/ 我们/ 的/ GracefulDeg/ -/ radation/ 机制/ 中/ ,/ 客户端/ 并不需要/ 知道/ 系统/ 的/ 运行/ 状态/ (/ TSS/ -/ mBQS/ 或/ TSS/ -/ dBQS/ 状态/ )/ ,/ 系统/ 可以/ 在/ 不/ 影响/ 客户端/ 、/ 不/ 中断/ 存储/ 服务/ 的/ 前提/ 下/ 完成/ 状态/ 切换/ ./ 本文/ 设计/ 的/ 状态/ 切换/ 协议/ ,/ 使得/ 相比/ 纯粹/ 的/ TSS/ -/ dBQS/ 系统/ [/ 3/ ,/ 5/ -/ 7/ ]/ (/ 由/ n/ =/ 3fd/ +/ 1/ 台/ 服务器/ 组成/ 、/ 容忍/ fd/ 台/ Byzantine/ 失效/ 服务器/ )/ ,/ 能以/ 更/ 高/ 的/ 平均/ 性能/ 运行/ ;/ 在/ 失效/ 服务器/ 数量/ 达到/ fm/ 、/ 丧失/ 容错/ 能力/ 时/ ,/ 通过/ 快速/ 的/ 状态/ 切换/ ,/ 继续/ 提供/ 容错/ 的/ 存储/ 服务/ ,/ 相比/ 纯粹/ 的/ TSS/ -/ mBQS/ 系统/ ,/ 减少/ 了/ ProactiveRecovery/ 次数/ ./ 在/ 不/ 影响/ TSS/ -/ BQS/ 系统/ 容错/ 效果/ 的/ 前提/ 下/ ,/ GracefulDegradation/ 机制/ 带来/ 了/ 更/ 高/ 的/ 平均/ 性能/ ,/ 是/ 已有/ TSS/ -/ BQS/ 系统/ ProactiveRecovery/ 的/ 重要/ 补充/ ./ 

