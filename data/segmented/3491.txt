Page1PCPF/ :/ 一种/ 面向/ 多媒体数据库/ 中/ 高维/ 向量/ 匹配/ 的/ 并行/ 索引/ 结构/ 陈慧中/ 1/ )/ ,/ 2/ )/ 陈/ 永光/ 3/ )/ 景宁/ 1/ )/ 陈荦/ 1/ )/ 1/ )/ (/ 国防科学技术大学/ 电子/ 科学/ 与/ 工程学院/ 长沙/ 410073/ )/ 2/ )/ (/ 西南/ 电子/ 电信技术/ 研究所/ 上海/ 分/ 所/ 上海/ 200434/ )/ 3/ )/ (/ 军械/ 工程学院/ 石家庄/ 050003/ )/ 摘要/ 提高/ 特征向量/ 的/ 匹配/ 效率/ 是/ 将/ 高维/ 局部/ 特征/ 运用/ 于/ 多媒体/ 数据检索/ 的/ 关键/ ./ 面向/ 多核/ 处理器/ 架构/ ,/ 提出/ 一种/ 新/ 的/ PCPF/ 索引/ 以及/ PCPF/ 并行/ 构建/ 与/ 并行/ 查询/ 匹配/ 算法/ ./ PCPF/ 并行/ 构建/ 算法/ 通过/ 量化/ 特征向量/ 构建/ 近似/ 向量/ 空间/ 上/ 的/ 高维索引/ 结构/ ,/ 并/ 进行/ 空间/ 划分/ 并行/ 构建/ 多个/ 子/ 索引/ 分支/ ;/ PCPF/ 并行/ 查询/ 匹配/ 算法/ 利用/ 优先/ 队列/ 在/ 邻近/ 子/ 分支/ 上/ 并行/ 过滤/ 得到/ 近似/ 近邻/ 候选/ 集/ ,/ 精确/ 计算/ 候选/ 实际/ 特征向量/ 得到/ 最终/ 近邻/ ./ 实验/ 及/ 分析表明/ ,/ 与/ 经典/ 的/ BBF/ 算法/ 相/ 比较/ ,/ PCPF/ 通过/ 降低/ 了/ 磁盘/ I/ // O/ 和/ 浮点运算/ 次数/ 以及/ 并行/ 优化/ ,/ 显著/ 提升/ 了/ 查询/ 匹配/ 效率/ ,/ 总体/ 匹配/ 精度/ 也/ 有所提高/ ./ 关键词/ 特征向量/ 匹配/ ;/ 多媒体/ 检索/ ;/ BBF/ ;/ 高维/ kNN/ 查询/ 1/ 引言/ 多媒体数据库/ 由于/ 存储/ 对象/ (/ 如/ 图片/ 、/ 音频/ 、/ 视频/ 等/ )/ 内容/ 丰富/ ,/ 信息量/ 大/ ,/ 通过/ 传统/ 的/ 元/ 数据检索/ 方式/ 获取/ 对象/ 不能/ 完全/ 满足/ 需求/ ./ 基于/ 内容/ 的/ 检索/ 技术/ 能/ 根据/ 视觉/ 等/ 内容/ 特性/ 将/ 与/ 用户/ 感兴趣/ 的/ 多媒体/ 对象/ 从/ 大容量/ 的/ 数据库/ 中/ 检索/ 出来/ ,/ 以/ 实现/ 更为/ 高效/ 而/ 广泛/ 的/ 应用/ ./ 近来/ ,/ 随着/ 基于/ 内容/ 的/ 多媒体/ 检索/ 技术/ 的/ 不断/ 发展/ ,/ 局部/ 特征/ 由于/ 其/ 稳定性/ 高/ 、/ 独特性/ 好/ 、/ 信息量/ 丰富/ 等/ 优点/ 已经/ 成为/ 多媒体/ 对象/ 特征描述/ 的/ 研究/ 热点/ [/ 1/ ]/ ./ 然而/ ,/ 在/ 实际/ 检索/ 过程/ 中/ ,/ 由于/ 局部/ 特征/ 数量/ 大/ ,/ 描述/ 向量/ 维数/ 高/ ,/ 使得/ 在/ 大规模/ 多媒体数据库/ 中/ 进行/ 向量/ 匹配/ 计算/ 量/ 大/ ,/ 效率/ 低下/ ./ 因此/ ,/ 如何/ 高效/ 地/ 匹配/ 检索/ 样例/ 与/ 多媒体数据库/ 对象/ 间/ 的/ 大量/ 高维/ 特征向量/ 成为/ 提高/ 检索/ 效率/ 的/ 关键所在/ ./ 建立/ 高维索引/ 是/ 解决问题/ 的/ 有效途径/ [/ 2/ ]/ ,/ 相关/ 的/ 研究/ 结果/ 包括/ :/ va/ -/ file/ [/ 3/ ]/ 向量/ 近似/ 的/ 思想/ ,/ 是/ 使用/ 二进制/ 串/ 近似/ 实际/ 向量/ ,/ 通过/ 过滤/ 与/ 精确/ 查找/ 两个/ 步骤/ 使/ 高维/ 情况/ 下/ 的/ 查询/ 效率/ 仍然/ 优于/ 顺序/ 查找/ ./ va/ +/ -/ file/ [/ 4/ ]/ 是/ 通过/ 将/ 数据/ 集/ 转换/ 到/ KLT/ 域/ 并/ 实施/ 均匀/ 的/ 量化/ 划分/ ,/ 提高/ 了/ va/ -/ file/ 的/ 过滤/ 效率/ ./ iDis/ -/ tance/ [/ 5/ ]/ 是/ 将/ 高维/ 数据/ 空间/ 进行/ 划分/ ,/ 并/ 为/ 每个/ 划分/ 建立/ 一个/ 参考点/ ,/ 使用/ B/ +/ -/ 树结构/ 组织/ 参考点/ ,/ 在/ 此基础/ 上/ 实现/ kNN/ 近邻/ 查询/ ./ LSH/ [/ 6/ ]/ 通过/ 一组/ Hash/ 函数/ 将/ 邻近/ 的/ 高维/ 点集/ 映射/ 到/ Hash/ 表/ 的/ 同一个/ 桶/ 中/ ,/ 以此/ 得到/ 对/ 近邻/ 的/ 快速/ 查询/ ./ LSB/ -/ tree/ [/ 7/ ]/ 使用/ B/ -/ tree/ 取代/ Hash/ 结构/ ,/ 从而/ 以较/ 小/ 的/ 代价/ 得到/ 了/ 相似/ 的/ 查询/ 效率/ 优化/ ./ 基于/ 聚类/ 分解/ 的/ B/ +/ -/ tree/ [/ 8/ ]/ 采用/ 类/ B/ +/ -/ tree/ 的/ 索引/ 结构/ ,/ 通过/ 聚类/ 分解/ ,/ 对/ 数据/ 进行/ 更/ 细致/ 的/ 划分/ 来/ 减少/ 查询/ 的/ 数据/ 访问/ ./ MS/ -/ tree/ [/ 9/ ]/ 通过/ 一种/ 最大/ 间隙/ 空间/ 映射/ 策略/ ,/ 设计/ 了/ 索引/ 的/ 构建/ 与/ 范围/ 查询处理/ 算法/ ./ MRSVQH/ [/ 10/ ]/ 根据/ 随机/ 选择/ 的/ 若干/ 子/ 向量/ 的/ L2/ 范数/ 对/ 特征向量/ 进行/ 量化/ 和/ 散列/ ,/ 搜索/ 时仅/ 考虑/ 与/ 查询/ 向量/ 有/ 相同/ Hash/ 值/ 的/ 特征向量/ 集合/ ,/ 缩减/ 了/ 搜索/ 范围/ ./ 上述/ 研究/ 大多/ 是/ 针对/ 通用/ k/ -/ NN/ 查询/ 做出/ 优化/ ,/ 其中/ 一些/ 对于/ 高维/ 向量/ 的/ 查询/ 匹配/ 效率/ 并/ 不/ 理想/ ,/ 还有/ 一些/ 存在/ 索引/ 结构/ 理想化/ 复杂化/ 等/ 问题/ ,/ 因而/ 在/ 多媒体数据库/ 高维/ 特征向量/ 的/ 实际/ 匹配/ 中/ 应用/ 较少/ ./ Lowe/ [/ 2/ ]/ 为/ 其/ 著名/ 的/ SIFT/ 局部/ 特征/ 推荐/ 了/ 一种/ Best/ -/ Bin/ -/ First/ (/ BBF/ )/ 近似/ 查询/ 匹配/ 算法/ [/ 11/ ]/ ,/ BBF/ 算法/ 基于/ k/ -/ D/ 树/ 索引/ ,/ 查找/ 最近/ 邻时/ ,/ 首先/ 遍历/ 到/ 查询/ 点/ 所在/ 的/ 桶/ ,/ 遍历/ 过程中将/ 每/ 一个/ 节点/ 通过/ 计算/ 比较/ 到/ 查询/ 点/ 的/ 距离/ 压入/ 一个/ 优先/ 队列/ 堆栈/ 中/ ./ 然后/ 从/ 该/ 桶/ 包含/ 的/ 点/ 开始/ 向上/ 回溯/ ,/ 计算/ 比较/ 当前/ 近邻/ ,/ 当/ 搜索/ 到/ 叶/ 节点/ 时/ ,/ 下/ 一/ 搜索/ 节点/ 通过/ 优先/ 队列/ 顶部/ 出栈/ 获得/ ,/ 以/ 继续/ 搜索/ ,/ 直至/ 达到/ 最大/ 搜索/ 次数/ 时/ 终止/ ./ BBF/ 算法/ 是/ 针对/ 高维/ 特征向量/ 的/ 匹配/ 问题/ 设计/ ,/ 采用/ 优先/ 队列/ 和/ 限制/ 查询/ 回溯/ 次数/ 等/ 方法/ 提高/ 了/ 查询/ 效率/ ,/ 成为/ 目前/ 使用/ 最为/ 广泛/ 的/ 高维/ 特征向量/ 匹配/ 方法/ ./ 此外/ ,/ 当前/ 多核/ 处理器/ 得到/ 了/ 广泛/ 的/ 应用/ ,/ 在/ 单机/ 多核/ 的/ 架构/ 下/ ,/ 由于/ 单个/ 线程/ 在/ 某/ 一/ 时刻/ 仅能/ 被/ 一个/ 处理器/ 核/ 执行/ ,/ 传统/ 的/ 单线程/ 串行/ 算法/ 不能/ 充分/ 有效/ 地/ 利用/ 多核/ 处理器/ 的/ 计算资源/ ./ 由此/ ,/ 本文/ 从/ 多媒体/ 数据检索/ 实际/ 应用/ 需求/ 出发/ ,/ 以/ 提高/ 高维/ 向量/ 查询/ 匹配/ 效率/ 为/ 目的/ ,/ 针对/ BBF/ 算法/ 遍历/ 及/ 回溯/ 阶段/ 磁盘/ I/ // O/ 较大/ 的/ 缺陷/ ,/ 基于/ 单机/ 多核/ 架构/ 下/ 的/ 多线程/ 并行/ 模式/ ,/ 提出/ 一种/ 新/ 的/ 并行/ 压缩/ 优先/ 过滤/ 索引/ (/ ParallelCompressedPriorityFilter/ ,/ PCPF/ )/ ./ 本文/ 的/ 主要/ 贡献/ 包括/ :/ (/ 1/ )/ 在/ BBF/ 算法/ 的/ 基础/ 上/ ,/ 引入/ 向量/ 近似/ 的/ 思想/ ,/ 考虑/ 多核/ 处理器/ 条件/ 下/ 的/ 并行/ 优化/ ,/ 提出/ 一种/ 新颖/ 的/ 高维/ 向量/ 匹配/ 并行/ 索引/ 结构/ PCPF/ ,/ 给出/ 了/ 索引/ 构建/ 与/ 查询/ 匹配/ 算法/ ./ (/ 2/ )/ 对/ 提出/ 的/ PCPF/ 并行/ 构建/ 与/ 查询/ 匹配/ 算法/ 进行/ 了/ 详细/ 的/ 算法/ 时间/ 复杂度/ 分析/ ./ (/ 3/ )/ 在/ Benchmark/ 图片库/ 和/ 实际/ 多媒体数据库/ 基础/ 上/ ,/ 对/ PCPF/ 索引/ 进行/ 了/ 大量/ 的/ 测试/ 实验/ ,/ 结果表明/ :/ PCPF/ 算法/ 在/ 多媒体数据库/ 高维/ 向量/ 查询/ 匹配/ 效率/ 上/ 较/ BBF/ 算法/ 有/ 大幅提高/ ,/ 同时/ 取得/ 了/ 较/ 好/ 的/ 匹配/ 效果/ ./ 2/ 问题/ 描述/ 基于/ 内容/ 检索/ 多媒体数据库/ 时/ ,/ 首先/ 通过/ 对/ 检索/ 样例/ 提取/ 多个/ 局部/ 特征/ ,/ 产生/ 高维/ 特征描述/ 向量/ 集合/ ./ 然后/ 将样/ 例/ 的/ 特征向量/ 与/ 存储/ 于/ 数据库/ 中/ 单个/ 多媒体/ 对象/ 的/ 特征向量/ 集合/ 逐一/ 匹配/ ,/ 计算/ 得到/ 匹配/ 度/ ,/ 匹配/ 度越/ 高则/ 相关度/ 越高/ ./ 这里/ ,/ 特征向量/ 的/ 匹配/ 与/ 匹配/ 度/ 的/ 定义/ 如下/ ./ 定义/ 1/ (/ 特征向量/ 的/ 匹配/ )/ ./ 令/ 狇/ 为/ 检索/ 样例/ S/ 的/ 一个/ 特征向量/ ,/ 犞/ 为/ 数据库/ 中/ 一个/ 多媒体/ 对象/ G/ 的/ 特征向量/ 集合/ ./ 狅/ 1/ ,/ 狅/ 2/ 分别/ 为/ 狇/ 在/ 犞/ 中/ 的/ 最近/ 邻/ 与/ 次/ 近邻/ ./ δ/ 为/ 匹配/ 门限/ ,/ 0/ </ δ/ / 1/ ./ 若则/ 称/ 狇/ 在/ 犞/ 中/ 与/ 狅/ 1/ 成功/ 匹配/ ;/ 反之/ ,/ 狇/ 无/ 匹配/ 结果/ ./ 其中/ ,/ 匹配/ 门限/ δ/ 对于/ 不同/ 的/ 实际/ 数据/ 集可/ 通过/ 实验/ 取得/ ,/ 一般/ 情况/ 下/ ,/ 在/ 文献/ [/ 2/ ]/ 中/ 推荐/ 取/ 0.6/ ,/ 在/ 文献/ [/ 12/ ]/ 中/ 推荐/ 取/ 0.7/ ./ 定义/ 2/ (/ 特征向量/ 的/ 匹配/ 度/ )/ ./ 令/ 犙/ 为/ 检索/ 样/ Page3/ 例/ S/ 的/ 特征向量/ 集合/ ,/ 犞/ 为/ 数据库/ 中/ 一个/ 多媒体/ 对象/ G/ 的/ 特征向量/ 集合/ ./ 定义/ 匹配/ 度/ :/ match/ (/ S/ ,/ G/ )/ =/ ‖/ {/ 狇/ }/ ‖/ 根据上述/ 定义/ ,/ 检索/ 样例/ 与/ 数据库/ 中/ 一个/ 多媒体/ 对象/ 的/ 匹配/ 度/ 由/ 两者/ 特征向量/ 的/ 匹配/ 个数/ 计算/ 得到/ ,/ 特征/ 点/ 匹配/ 的/ 过程/ 实际上/ 就是/ 一个/ 特征向量/ 空间/ 中/ 最近/ 邻/ 与/ 次/ 近邻/ 的/ 查询/ 过程/ ./ 因此/ ,/ 高维/ 向量/ 空间/ 中/ 的/ 2/ -/ NN/ 查询/ 是/ 实现/ 快速/ 匹配/ 的/ 实际/ 关键问题/ ,/ 定义/ 如下/ ./ 定义/ 3/ (/ 2/ -/ NN/ 查询/ )/ ./ 令/ 狇/ =/ (/ q1/ ,/ q2/ ,/ …/ ,/ qD/ )/ 为/ 一个/ 待/ 匹配/ 高维/ 向量/ ,/ 犞/ =/ {/ 狏/ }/ =/ {/ (/ v1/ ,/ v2/ ,/ …/ ,/ vD/ )/ }/ 为/ 检索/ 库中/ 一个/ 多媒体/ 对象/ 的/ 特征向量/ 集合/ ./ 求取/ 狅/ 1/ =/ {/ o11/ ,/ o12/ ,/ …/ ,/ o1D/ }/ ,/ 狅/ 2/ =/ {/ o21/ ,/ o22/ ,/ …/ ,/ o2D/ }/ ,/ 使得/ (/ 1/ )/ / 狏/ =/ (/ v1/ ,/ v2/ ,/ …/ ,/ vD/ )/ ∈/ 犞/ 且/ 狏/ ≠/ 狅/ 1/ 图/ 1PCPF/ 总体/ 框图/ 示意/ 对/ 特征向量/ 狇/ 进行/ 查询/ 匹配/ 时/ ,/ 首先/ 对/ 狇/ 进行/ KL/ 变换/ 并/ 量化/ 压缩/ ;/ 量化/ 后/ 的/ 近似/ 查询/ 向量/ 运用/ PCPF/ 查询/ 匹配/ 算法/ 通过/ 索引/ 文件/ 过滤/ 得到/ 候选/ 的/ 近似/ 特征向量/ 集合/ ;/ 然后/ 在/ 此/ 候选/ 集中/ 进行/ 精确/ 计算/ 与/ 排序/ ,/ 得到/ 最近/ 邻/ 与/ 次/ 近邻/ ,/ 以此/ 计算/ 是否/ 匹配/ 成功/ (/ 步骤/ 如图/ 1/ 中/ 浅色/ 箭头/ 所示/ )/ ./ 3.1/ 数据压缩/ 预处理/ 在/ 构建/ 索引/ 及/ 查询/ 之前/ ,/ 为了/ 消除/ 数据/ 各维间/ 的/ 相关性/ 、/ 得到/ 更为/ 平均/ 的/ 量化/ 划分/ ,/ 从而/ 提高/ 查询/ 效率/ ./ 依据/ 文献/ [/ 4/ ]/ 中/ 的/ 方法/ 对/ 数据/ 集/ 进行/ 压缩/ 预处理/ :/ KL/ 变换/ ,/ 位/ 分配/ 及/ 量化/ ./ KL/ 变换/ 将/ 数据/ 集/ 转换/ 到/ KLT/ 域/ ,/ 以此/ 消除/ 各维/ 之间/ 的/ 互相/ 关/ ,/ 使/ 各维/ 的/ 数据/ 间/ 相互/ 正交/ ./ 位/ 分配/ 算法/ 根据/ 数据/ 的/ 分布/ 情况/ 为/ 各维/ 分配/ 量化/ 位数/ ,/ 令/ 第/ i/ 维上/ 的/ 数据/ 方差/ 为/ σ/ i/ ,/ 总共/ 的/ 可/ 分配/ 位数/ 为/ b/ ,/ 分配/ 给/ 第/ i/ 维的位/ (/ bit/ )/ 数为/ bi/ ,/ 则/ 有/ b/ =/ ∑/ bi/ ./ 位/ 分配/ 主要/ 步骤/ 如下/ :/ 1/ ./ 令/ k/ =/ 0/ ./ 对于/ 第/ i/ 维/ ,/ 令/ si/ =/ σ/ i/ ,/ bi/ =/ 0/ ./ (/ 2/ )/ / 狏/ =/ (/ v1/ ,/ v2/ ,/ …/ ,/ vD/ )/ ∈/ 犞/ 且/ 狏/ ≠/ 狅/ 1/ ,/ 狅/ 2/ 这里/ ,/ 使用/ 常用/ 的/ 欧式/ 距离/ (/ EuclideanMetric/ )/ 作为/ 特征向量/ 间/ 的/ 距离/ 度量/ ,/ 实际/ 计算/ 时/ ,/ 为了/ 节省/ 计算/ 开销/ ,/ 有时/ 不/ 进行/ 开方/ 操作/ ./ 3/ 并行/ 压缩/ 优先/ 过滤/ 索引/ PCPFPCPF/ 是/ 一种/ 面向/ 多媒体数据库/ 中/ 高维/ 向量/ 的/ 快速/ 匹配/ 设计/ 的/ 静态/ 索引/ ,/ 其/ 主体/ 流程/ 包括/ 索引/ 的/ 构建/ 以及/ 查询/ 匹配/ 两/ 大部分/ ./ 构建/ PCPF/ 索引/ 时/ ,/ 首先/ 对/ 原始数据/ 集/ 进行/ KL/ 变换/ 、/ 量化/ 压缩/ 等/ 数据压缩/ 预处理/ 步骤/ ,/ 然后/ 根据/ PCPF/ 索引/ 结构/ 对/ 预处理/ 后/ 的/ 近似/ 向量/ 集合/ 构建/ 高维/ 向量/ 近邻/ PCPF/ 索引/ ,/ 同时/ 保留/ KL/ 变换/ 后/ 的/ 数据/ 集/ 作为/ 实际/ 向量/ 集合/ (/ 步骤/ 如图/ 1/ 中/ 深色/ 箭头/ 所示/ )/ ./ 2/ ./ 求/ j/ =/ max/ -/ 1si/ ,/ 则/ 3/ ./ k/ ←/ k/ +/ 1/ ./ 若/ k/ >/ b/ ,/ 则/ 终止/ ;/ 反之/ ,/ 重复/ 步/ 2/ ./ 图/ 2/ 给出/ 了/ 一个二维/ 实际/ 数据/ 集/ 的/ KL/ 变换/ 和/ 量化/ 位数/ 分配/ 示例/ ./ 量化/ 根据/ 位/ 分配/ 算法/ 得到/ 的/ 可/ 分配/ 位数/ 划分/ 各维/ ,/ 在/ 向量/ 空间/ 形成/ 多个/ 胞腔/ (/ cell/ )/ ,/ 以/ 二进制/ 串/ 唯一/ 地/ 表示/ 单个/ 胞腔/ ,/ 并/ 作为/ 胞腔/ 内/ 原始/ 特征向量/ 的/ 近似/ 表示/ ,/ 图/ 3/ 给出/ 了/ 一组/ 量化/ 后/ 的/ 二维/ 向量/ 示例/ ./ 量化/ 可以/ 通过/ 均匀/ 地/ 将/ 原始/ 向量/ 分配/ 给/ 不同/ 的/ ps/ 个/ 线程/ 并行/ 完成/ ./ Page43/ ./ 2PCPF/ 索引/ 结构/ PCPF/ 索引/ 结构/ 使用/ 一/ 种类/ k/ -/ D/ 树/ 森林/ 的/ 结构/ 来/ 组织/ 量化/ 压缩/ 后/ 的/ 近似/ 特征向量/ ./ PCPF/ 结构/ 不/ 具有/ 一般/ 树形/ 结构/ 唯一/ 的/ 根/ 节点/ ,/ 它/ 的/ 第一层/ 是/ 一个/ 链表/ 结构/ ,/ 由/ KL/ 变换/ 后/ 的/ 第一/ 维/ 按/ 数据/ 均匀/ 划分/ 而成/ ./ 每/ 一个/ 链表/ 的/ 元素/ 可以/ 看作/ 一棵/ 子树/ 的/ “/ 根/ 节点/ ”/ ,/ 称为/ “/ 首层/ 节点/ ”/ ,/ 每个/ 首层/ 节点/ 下/ 采用/ k/ -/ D/ 树结构/ 形成/ 一棵/ 子树/ 分支/ ./ 所有/ 节点均/ 包含/ 一个/ 指针/ 序列/ ,/ 序列/ 内/ 元素/ 指向/ 相同/ 近似/ 向量/ 对应/ 的/ 一个/ 或/ 多个/ 原始/ 特征向量/ 在/ 磁盘/ 文件/ 中/ 的/ 位置/ ./ 图/ 5/ 索引/ 结构/ 示意/ 3.3/ PCPF/ 构建/ 算法/ 基于/ PCPF/ 的/ 索引/ 结构/ ,/ 提出/ 一种/ 可/ 并行/ 的/ PCPF/ 构建/ 算法/ ,/ 共/ 分为/ 3/ 个/ 步骤/ :/ 压缩/ 预处理/ 、/ 数据/ 子集/ 划分/ 和/ 并行/ 索引/ 构建/ ./ 先对/ 预处理/ 后/ 的/ 数据/ 集/ 进行/ 一定/ 的/ 划分/ ,/ 在/ 此基础/ 上/ 再/ 并行/ 地/ 对/ 划分/ 后/ 的/ 数据/ 集/ 进行/ 索引/ 的/ 构建/ ./ 数据/ 子集/ 划分/ 时/ ,/ 对于/ 预处理/ 后/ k/ 维/ 近似/ 向量/ 空间/ 中/ 的/ 数据/ 集/ 犃/ ,/ ‖/ 犃/ ‖/ =/ N/ ,/ 将/ 第一/ 维/ 均匀/ 划分/ 为/ s/ 个/ 区间/ ,/ 形成/ 大小/ 分别/ 为/ N1/ ,/ N2/ ,/ …/ ,/ Ns/ 的/ s/ 个/ 子集/ :/ 犃/ 1/ ,/ 犃/ 2/ ,/ …/ ,/ 犃/ s/ ./ 这里/ ,/ 由于/ 经过/ KL/ 变换/ ,/ 预处理/ 后/ 的/ 近似/ 向量/ 空间/ 在/ 第一/ 维上/ 包含/ 了/ 最大/ 的/ 能量/ ,/ 方差/ 为/ 最大/ (/ 见图/ 2/ (/ b/ )/ 示意/ )/ ,/ 同时/ 近似/ 向量/ 点/ 具有/ 相对/ 均匀/ 的/ 分布/ ,/ 因此/ 本文/ 选择/ 第一/ 维/ 作为/ 划分/ 的/ 依据/ ./ 划分/ 的/ 区间/ 个数/ s/ 代表/ 了/ 可/ 并行/ 的/ 程度/ ,/ 作为/ 并行执行/ 时/ 划分/ 线程/ 的/ 数目/ ,/ 一般/ 与/ 处理器/ 核数/ 相匹配/ ./ 并行/ 索引/ 构建/ 时/ ,/ 对于/ 每个/ 子集/ ,/ 并行/ 构建/ 一个/ 类/ k/ -/ D/ 树结构/ :/ 在/ 方差/ 最大/ 的/ 第/ i/ 维上/ 进行/ 分割/ ,/ 分割/ 点为/ 该维/ 数据/ 的/ 中间/ 数/ m/ ,/ 则/ 两侧/ 各有/ 相同/ 数量/ 的/ 点/ ,/ 生成/ 一个/ 节点/ 以/ 存储/ i/ 与/ m/ ./ 小于/ m/ 的/ 点/ 划分/ PCPF/ 的/ 节点/ 可以/ 分为/ 三类/ :/ 首层/ 节点/ top/ _/ node/ 、/ 中间/ 节点/ mid/ _/ node/ 和/ 叶/ 结点/ leaf/ _/ node/ ,/ 节点/ 的/ 定义/ 和/ 主要/ 包含/ 元素/ 如图/ 4/ 所示/ ./ top/ _/ nodesplitbrotherim/ 犪/ 狏/ LChildRChildplstmid/ _/ nodeim/ 犪/ 狏/ LChildRChildplstDistleaf/ _/ node/ 犪/ 狏/ plstDist/ 其中/ ,/ split/ 为首/ 层/ 节点/ 的/ 分割/ 点/ ,/ brother/ 为/ 指向/ 下/ 一个/ 首层/ 节点/ 的/ 指针/ ,/ i/ 为子/ 树/ 当前/ 分割/ 的/ 维数/ ,/ m/ 为子/ 树/ 当前/ 分割/ 点/ ,/ 犪/ 狏/ 为/ 当前/ 节点/ 对应/ 的/ 近似/ 向量/ ,/ LChild/ 为/ 左子/ 树/ 指针/ ,/ RChild/ 为/ 右子/ 树/ 指针/ ,/ plst/ 为/ 指向/ 实际/ 向量/ 的/ 指针/ 序列/ ,/ Dist/ 记录/ 了/ 查询/ 遍/ 历时/ 节点/ 至/ 查询/ 点/ 的/ 距离/ ./ 图/ 5/ 给出/ 了/ 二维/ 的/ 图/ 3/ 数据/ PCPF/ 索引/ 结构/ 示意/ ./ 为/ 左子/ 树/ ,/ 否则/ 划分/ 为/ 右子/ 树/ ,/ 在/ 两棵/ 子/ 树上/ 递归/ 进行/ 上述/ 划分/ 步骤/ ,/ 直至/ 子树仅/ 包含/ 一个点/ ./ 子集/ 上/ 的/ 第一个/ 分割/ 点/ 作为/ 该子/ 树/ 的/ 根/ 节点/ ,/ 即/ 首层/ 节点/ ./ 无子/ 树/ 的/ 点/ 作为/ 叶/ 结点/ ,/ 其它/ 作为/ 中间/ 节点/ ./ 在/ 每个/ 子集/ 犃/ j/ 上/ 构建/ 完成/ 一棵/ 深度/ 为/ log2Nj/ 的/ 二叉/ 平衡/ 树后/ ,/ 将/ 首层/ 节点/ 以/ 链表/ 形式/ 按/ 子集/ 划分/ 区间/ 的/ 顺序/ 连接起来/ ,/ 从而/ 完成/ PCPF/ 索引/ 构建/ ./ PCPF/ 构建/ 算法/ 的/ 详细/ 步骤/ 描述/ 如下/ ,/ 其中/ ,/ 步/ 1/ 预处理/ 原始数据/ 集/ ;/ 步/ 2/ ~/ 4/ 划分/ 数据/ 子集/ ;/ 步/ 5/ ~/ 9/ 构建/ 索引/ ./ 算法/ 1/ ./ PCPF/ _/ Construct/ ./ Input/ :/ 犞/ :/ SetofRealVectors/ ,/ s/ :/ NumberofSubsets/ ;/ Output/ :/ rootLst/ :/ ListofTop/ -/ LevelNodes/ ;/ 1/ ./ 犃/ ←/ Preprocess/ (/ 犞/ )/ ;/ 2/ ./ letdimensionrangeDR/ ←/ FirstDR/ (/ 犃/ )/ ;/ 3/ ./ splitj/ ←/ (/ DR/ ×/ j/ )/ // s/ ,/ j/ =/ 1/ ,/ 2/ ,/ …/ ,/ s/ ,/ splitj/ ∈/ {/ split/ }/ ;/ 4/ ./ 犃/ 1/ ,/ 犃/ 2/ ,/ …/ ,/ 犃/ s/ ←/ Divide/ (/ 犃/ ,/ {/ split/ }/ )/ 5/ ./ foreach/ 犃/ jdo6/ ./ rootj/ ←/ BuildTree/ (/ 犃/ j/ )/ ;/ 7/ ./ rootj/ ./ split/ ←/ splitj/ ;/ 8/ ./ rootLst/ ./ Insert/ (/ rootj/ )/ ;/ Page59/ ./ endfor/ ;/ 10/ ./ returnrootLst/ ;/ FunctionBuildTree/ (/ setofvectors/ 犃/ )/ 1/ ./ i/ ←/ Max/ -/ 1/ (/ Variance/ (/ d/ )/ )/ ,/ d/ =/ 1/ ,/ 2/ ,/ …/ ,/ D/ ;/ 2/ ./ Node/ ./ 犪/ 狏/ ←/ Median/ _/ i/ (/ 犃/ )/ ;/ 3/ ./ Node/ ./ m/ ←/ Node/ ./ 犪/ 狏/ i/ ;/ 4/ ./ Node/ ./ i/ ←/ i/ ;/ 5/ ./ 犃/ 犔/ ←/ / ,/ 犃/ 犚/ ←/ / ;/ 6/ ./ foreach/ 犪/ =/ (/ a1/ ,/ a2/ ,/ …/ ,/ aD/ )/ ∈/ 犃/ do7/ ./ ifai/ </ Node/ ./ mthen/ 犃/ 犔/ ←/ 犃/ 犔/ ∪/ 犪/ ;/ 8/ ./ else/ 犃/ 犚/ ←/ 犃/ 犚/ ∪/ 犪/ ;/ endif/ ;/ 9/ ./ endfor/ ;/ 10/ ./ Node/ ./ LChild/ ←/ BuildTree/ (/ 犃/ 犔/ )/ ;/ 11/ ./ Node/ ./ RChild/ ←/ BuildTree/ (/ 犃/ 犚/ )/ ;/ 12/ ./ Node/ ./ plst/ ←/ RealAddrs/ (/ Node/ ./ 犪/ 狏/ )/ ;/ 13/ ./ returnNode/ ;/ 3.4/ PCPF/ 查询/ 匹配/ 算法/ 进一步/ 提出/ 并行/ 压缩/ 优先/ 过滤/ (/ PCPF/ )/ 查询/ 匹配/ 算法/ ./ 根据/ 索引/ 结构/ ,/ 查询/ 匹配/ 通过/ 查询/ 向量/ 集在/ 各子/ 树上/ 并行/ 查询/ 完成/ ./ 对于/ 一个/ 查询/ 向量/ ,/ 其/ 匹配/ 过程/ 分为/ 3/ 个/ 阶段/ :/ 预处理/ 、/ 量化/ 过滤/ 与/ 精确/ 查找/ 阶段/ ./ 预处理/ 根据/ 构建/ 索引/ 时/ 的/ 参数/ 进行/ KL/ 变换/ 与/ 量化/ 近似/ 操作/ ,/ 得到/ 量化/ 的/ 近似/ 查询/ 向量/ ,/ 并/ 根据/ 划分/ 的/ 犃/ 1/ ,/ 犃/ 2/ ,/ …/ ,/ 犃/ s/ 子集/ 将/ 查询/ 向量/ 分配/ 到/ 距/ 第一/ 维/ 分量/ 最近/ 的/ 分割/ 点/ 相邻/ 的/ 二棵/ 查询/ 子/ 树/ 犃/ j/ ,/ 犃/ j/ +/ 1/ 上/ ;/ 在/ 量化/ 过滤/ 阶段/ ,/ 采用/ 基于/ BBF/ 算法/ 思想/ 的/ 优先/ 队列/ 递归/ 分别/ 在/ 犃/ j/ ,/ 犃/ j/ +/ 1/ 上/ 并行/ 查找/ 获得/ 量化/ 查询/ 向量/ 的/ 近似/ 近邻/ 候选/ 集/ ,/ 候选/ 集/ 大小/ 设定/ 为/ C/ ,/ C/ / 2/ ,/ 最大/ 搜索/ 次数/ 分别/ 为/ Tj/ 和/ Tj/ +/ 1/ ,/ 满足/ Tj/ ×/ Nj/ +/ 1/ =/ Tj/ +/ 1/ ×/ Nj/ 且/ Tj/ +/ Tj/ +/ 1/ =/ T/ ./ 在/ 精确/ 查找/ 阶段/ ,/ 读取/ 候选/ 集/ 对应/ 的/ 实际/ 向量/ 并/ 分别/ 计算/ 到/ 查询/ 向量/ 的/ 精确/ 距离/ ,/ 排序/ 得到/ 距离/ 最小/ 的/ 最近/ 邻/ 与/ 次/ 近邻/ ,/ 根据/ 式/ (/ 1/ )/ 计算/ 是否/ 匹配/ ./ 对/ 所有/ 查询/ 点/ 匹配/ 完毕/ 之后/ ,/ 根据/ 式/ (/ 2/ )/ 计算/ 匹配/ 度/ ./ PCPF/ 查询/ 匹配/ 的/ 并行/ 分为/ 两个/ 层面/ :/ 第/ 1/ 层面/ 是/ 单个/ 向量/ 查询/ 匹配/ 时/ ,/ 在/ 两棵/ 相邻/ 子/ 树上/ 并行/ 查找/ 近似/ 候选/ 集/ ;/ 第/ 2/ 层面/ 是/ 对于/ 查询/ 样例/ 的/ 多个/ 特征向量/ ,/ 同时/ 在/ s/ 棵子/ 树上/ 执行/ 第一/ 层面/ 的/ 操作/ ./ PCPF/ 查询/ 算法/ 使用/ 曼哈顿/ 距离/ 定义/ 近似/ 向量/ 空间/ 上/ 的/ 距离/ 关系/ :/ 令/ 犪/ 狇/ =/ (/ aq1/ ,/ aq2/ ,/ …/ ,/ aqD/ )/ 为/ 查询/ 向量/ 狇/ 的/ 近似/ 向量/ ,/ 犪/ =/ (/ a1/ ,/ a2/ ,/ …/ ,/ aD/ )/ 为/ 一个/ 索引/ 数据/ 集/ 的/ 近似/ 向量/ ,/ 则/ 距离/ :/ PCPF/ 查询/ 匹配/ 算法/ 的/ 详细/ 步骤/ 描述/ 如下/ ,/ 其中/ ,/ 步/ 1/ ~/ 9/ 预处理/ 查询/ 向量/ 集/ ;/ 步/ 11/ ~/ 25/ 量化/ 过滤/ 候选/ 近邻/ ;/ 步/ 26/ ~/ 32/ 精确/ 查找/ 匹配/ ./ 算法/ 2/ ./ PCPF/ _/ Match/ ./ Input/ :/ 犙/ :/ SetofQueryVectors/ ,/ rootLst/ :/ Top/ -/ LevelNodesOutput/ :/ match/ :/ MatchedRatio/ ;/ 1/ ./ 犃/ 犙/ ←/ Preprocess/ (/ 犙/ )/ ;/ 2/ ./ letmatchednumbermn/ ←/ 0/ ;/ 3/ ./ letsearchtreesLst/ ←/ / ;/ 4/ ./ foreach/ 犪/ 狇/ =/ (/ aq1/ ,/ aq2/ ,/ …/ ,/ aqD/ )/ ∈/ 犃/ 犙/ do5/ ./ foreachrootj/ ∈/ rootLstdo6/ ./ ifIsMin/ (/ |/ aq1/ -/ rootj/ ./ split/ |/ )/ then7/ ./ sLst/ ./ Insert/ (/ rootj/ ,/ rootj/ +/ 1/ )/ ;/ 8/ ./ endif/ ;/ 9/ ./ endfor/ ;/ 10/ ./ letsetofcandidates/ 犆犃犖犇/ ←/ / ;/ 11/ ./ foreachrootj/ ∈/ sLstdo12/ ./ letcurrentnodeNode/ ←/ rootj/ ;/ 13/ ./ letpriorityqueue/ 犘/ 犙/ ←/ / ;/ 14/ ./ whileNodeisnotleaf/ _/ nodedo15/ ./ 犘/ 犙/ ./ Push/ (/ Node/ )/ ;/ 16/ ./ if/ 犪/ 狇/ [/ Node/ ./ i/ ]/ </ Node/ ./ 犪/ 狏/ [/ Node/ ./ i/ ]/ then17/ ./ Node/ ←/ Node/ ./ Lchild/ ;/ 18/ ./ else19/ ./ Node/ ←/ Node/ ./ Rchild/ ;/ 20/ ./ endif/ ;/ 21/ ./ endwhile/ ;/ 22/ ./ letCthnearestdistanceDistc/ ←/ ;/ 23/ ./ letcurrentsearchtimet/ ←/ 0/ ;/ 24/ ./ CPF/ _/ Search/ (/ Node/ )/ ;/ 25/ ./ endfor/ ;/ 26/ ./ foreachpt/ ∈/ 犆犃犖犇/ [/ c/ ]/ ./ plst/ ,/ c/ =/ 1/ …/ Cdo27/ ./ min1/ ←/ min/ ‖/ (/ / pt/ )/ -/ 狇/ ‖/ ;/ 28/ ./ min2/ ←/ second/ _/ min/ ‖/ (/ / pt/ )/ -/ 狇/ ‖/ ;/ 29/ ./ endfor/ ;/ 30/ ./ ifmin1/ // min2/ </ δ/ then31/ ./ mn/ ←/ mn/ +/ 1/ ;/ 32/ ./ endif/ ;/ 33/ ./ endfor/ ;/ 34/ ./ match/ ←/ mn/ // ‖/ 犙/ ‖/ ;/ 35/ ./ returnmatch/ ;/ FunctionCPF/ _/ Search/ (/ currentnodeNode/ )/ 1/ ./ whilet/ / Tjdo2/ ./ ifDIST/ (/ Node/ ./ 犪/ 狏/ ,/ 犪/ 狇/ )/ / Distcthen3/ ./ 犆犃犖犇/ ./ Insert/ (/ Node/ )/ ;/ 4/ ./ if/ 犆犃犖犇/ ./ size/ / Cthen5/ ./ Distc/ ←/ DIST/ (/ 犆犃犖犇/ [/ C/ -/ 1/ ]/ ./ 犪/ 狏/ ,/ 犪/ 狇/ )/ ;/ 6/ ./ 犆犃犖犇/ ./ Delete/ (/ 犆犃犖犇/ [/ C/ ]/ )/ ;/ 7/ ./ endif/ ;/ 8/ ./ endif/ ;/ 9/ ./ t/ ←/ t/ +/ 1/ ;/ 10/ ./ ifNodeisleaf/ _/ nodethen11/ ./ Node/ ←/ 犘/ 犙/ ./ Pop/ (/ )/ ;/ Page612/ ./ CPF/ _/ Query/ (/ Node/ )/ ;/ 13/ ./ endif/ ;/ 14/ ./ endwhile/ ;/ 4/ 算法/ 复杂度/ 分析/ 本节/ 对/ 提出/ 的/ PCPF/ 构建/ 算法/ 与/ 查询/ 匹配/ 算法/ 的/ 时间/ 复杂度/ 进行/ 理论/ 分析/ ./ 这里/ ,/ 定义/ 一个/ D/ 维/ 向量/ 在/ 一个/ 维度/ 上/ 的/ 基本/ 运算/ 为/ 一次/ 基本/ 运算/ ,/ 则/ 一个/ D/ 维/ 向量/ 上/ 的/ 相应/ 运算/ 的/ 运算量/ 为/ D/ ./ 4.1/ 构建/ 算法/ 时间/ 复杂度/ 在/ 构建/ PCPF/ 索引/ 前/ ,/ 首先/ 需/ 进行/ 预处理/ 操作/ ,/ 其中/ KL/ 变换/ 复杂度/ 为/ O/ (/ DN3/ )/ ;/ 量化/ 位数/ 分配/ 的/ 复杂度/ 为/ O/ (/ D2N/ )/ ;/ 量化/ 复杂度/ 为/ O/ (/ DN/ )/ ,/ 量化/ 操作/ 可以/ 完全/ 均匀/ 地/ 划分/ 给/ ps/ 个/ 线程/ 执行/ ,/ 因此/ 其/ 理论/ 复杂度/ 可/ 由/ 其中/ 一个/ 线程/ 上/ 的/ 复杂度/ 代替/ ,/ 为/ O/ (/ DN/ // ps/ )/ ./ 故/ 总/ 的/ 量化/ 预处理/ 复杂度/ 为/ O/ (/ DN3/ )/ +/ O/ (/ D2N/ )/ +/ O/ (/ DN/ // ps/ )/ ./ 构建/ PCPF/ 索引/ 时/ ,/ 划分/ 数据/ 子集/ 的/ 复杂度/ 为/ O/ (/ N/ )/ ./ 然后/ 在/ 每个/ 数据/ 子集/ 上/ 建立/ 索引/ 分支/ ,/ 每个/ 字/ 分支/ 根据/ k/ -/ D/ 树/ 的/ 构建/ 复杂度/ 为/ O/ (/ log2/ (/ DNj/ )/ )/ ./ 并行/ 子/ 索引/ 构建/ 复杂度/ 其实/ 为/ 最大/ 子集合/ 上/ 的/ 构建/ 复杂度/ ,/ 即/ O/ (/ log2/ (/ DMax/ (/ Nj/ )/ )/ )/ ,/ 当/ 子集/ 完全/ 划分/ 时/ ,/ 取得/ 最佳值/ ,/ 为/ O/ (/ log2/ (/ D/ (/ N/ // s/ )/ )/ )/ ,/ 最差/ 情况/ 下/ ,/ 数据/ 划分/ 极度/ 不/ 均匀/ ,/ 可/ 视作/ 所有/ 向量/ 集中/ 于/ 一个/ 子集/ 的/ 极端/ 情况/ ,/ 等同于/ s/ =/ 1/ 时/ ,/ 为/ O/ (/ log2/ (/ DN/ )/ )/ ./ 则/ 构建/ PCPF/ 索引/ 复杂度/ 为/ O/ (/ N/ )/ +/ O/ (/ log2/ (/ DMax/ (/ Nj/ )/ )/ )/ ,/ 最优/ 划分/ 情况/ 下为/ O/ (/ N/ )/ +/ O/ (/ log2/ (/ D/ (/ N/ // s/ )/ )/ )/ ,/ 最差/ 划分/ 情况/ 下为/ O/ (/ N/ )/ +/ O/ (/ log2/ (/ DN/ )/ )/ ./ 总体/ 的/ 构建/ 时间/ 为/ 数据/ 预处理/ 和/ 索引/ 构建/ 两/ 部分/ 之/ 和/ ,/ 依据/ 上面/ 的/ 分析/ 结果/ 消减/ 低次/ 项及/ 系数/ ,/ 为/ O/ (/ DN3/ )/ +/ O/ (/ D2N/ )/ ./ 4.2/ 查询/ 匹配/ 算法/ 时间/ 复杂度/ 查询/ 匹配/ 单个/ 向量/ 时/ ,/ 首先/ 进行/ 预处理/ ,/ 此时/ 预处理/ 参数/ 已/ 确定/ ,/ 不需/ 重新/ 计算/ ,/ 因此/ 单个/ D/ 维/ 向量/ 的/ KL/ 变换/ 计算/ 复杂度/ 为/ O/ (/ D/ )/ ,/ 量化/ 复杂度/ 为/ O/ (/ D/ )/ ,/ 因此/ ,/ 总体/ 预处理/ 复杂度/ 为/ O/ (/ D/ )/ ./ 查询/ 匹配/ 分别/ 在/ 相邻/ 的/ 两个/ 子树/ 分支/ 上/ 进行/ ,/ 对于/ 每/ 棵子/ 树/ 而言/ ,/ 遍历/ 阶段/ 复杂度/ 为/ O/ (/ log/ (/ DNj/ )/ )/ ,/ 回溯/ 阶段/ 复杂度/ 为/ O/ (/ DTj/ )/ ./ 并行/ 查询/ 匹配/ 复杂度/ 为/ 最深/ 的/ 一棵/ 子/ 树上/ 的/ 查询/ 匹配/ 复杂度/ ,/ 当/ 子集/ 完全/ 均匀/ 划分/ 时/ ,/ 子树/ 分支/ 深度/ 一致/ ,/ 取得/ 最佳值/ ,/ 为/ O/ (/ log/ (/ D/ (/ N/ // s/ )/ )/ )/ +/ O/ (/ D/ (/ T/ // 2/ )/ )/ ,/ 最差/ 情况/ 下/ ,/ 数据/ 划分/ 极度/ 不/ 均匀/ ,/ 可/ 视作/ 仅/ 构建/ 了/ 一棵/ 索引/ 子树/ ,/ 即/ s/ =/ 1/ ,/ 此时/ 复杂度/ 为/ O/ (/ log/ (/ DN/ )/ )/ +/ O/ (/ DT/ )/ ./ 总体/ 的/ 单个/ 向量/ 查询/ 匹配/ 时间/ 为/ 预处理/ 和/ 索引/ 构建/ 两/ 部分/ 之/ 和/ ,/ 依据/ 上面/ 的/ 分析/ 结果/ 消减/ 低次/ 项及/ 系数/ ,/ 为/ O/ (/ log/ (/ DN/ )/ )/ +/ O/ (/ DT/ )/ ./ 对/ M/ 个/ 向量/ 进行/ 查询/ 匹配/ 时/ ,/ 可/ 分配/ 到/ 不同/ 子树/ 并行执行/ ,/ 最佳/ 情况/ 下/ ,/ 子集/ 完全/ 均匀/ 划分/ 且/ M/ 个/ 查询/ 向量/ 也/ 完全/ 均匀分布/ ,/ 此时/ 复杂度/ 为/ O/ (/ log/ (/ D/ (/ M/ // s/ )/ (/ N/ // s/ )/ )/ )/ +/ O/ (/ D/ (/ MT/ // s/ )/ )/ ,/ 最差/ 情况/ 下/ ,/ 等同于/ s/ =/ 1/ ,/ 为/ O/ (/ log/ (/ DMN/ )/ )/ +/ O/ (/ DMT/ )/ ./ 消除/ 低次/ 项/ 和/ 系数/ 后/ ,/ M/ 个/ 向量/ 并行/ 查询/ 匹配/ 的/ 时间/ 复杂度/ 为/ O/ (/ log/ (/ DMN/ )/ )/ +/ O/ (/ DMT/ )/ )/ ./ 5/ 实验/ 及/ 结果/ 分析/ 为了/ 验证/ PCPF/ 索引/ 性能/ ,/ 本文/ 基于/ 多媒体数据库/ 进行/ 了/ 并行/ 效率/ 实验/ 、/ 索引/ 构建/ 效率/ 实验/ 、/ 查询/ 匹配/ 效率/ 实验/ 和/ 查询/ 匹配/ 效果/ 实验/ ./ 实验/ 中/ ,/ 主要/ 比较/ 了/ PCPF/ 与/ 经典/ 的/ BBF/ 算法/ ,/ 同时/ 为了/ 更好/ 地/ 分析/ 实验/ 结果/ ,/ 本文/ 也/ 对/ 单线程/ 串行/ 执行/ 的/ PCPF/ 算法/ 进行/ 了/ 实验/ ,/ 作为/ 参考/ 对比/ ./ 本文/ 采用/ 2/ 个/ 图像/ 数据库/ 作为/ 实验/ 数据/ 来源/ ,/ 一个/ 包含/ 从/ benchmark/ 图片库/ COREL/ 中/ 精选/ 的/ 10/ 个/ 主题/ 共/ 1000/ 张/ 图像/ ;/ 另/ 一个/ 为/ 实际/ 工作/ 中/ 使用/ 的/ 月球/ 空间数据/ 影像/ 库/ ,/ 共/ 包含/ 3227/ 张/ 月球/ 表面/ 图像/ ./ 图像/ 高维/ 特征向量/ 采用/ SURF/ [/ 12/ ]/ 特征/ ,/ 图像/ 平均/ 特征/ 点/ 数目/ 为/ 10933/ ,/ 90/ %/ 的/ 图像/ 特征/ 点/ 数目/ 分布/ 在/ 5000/ ~/ 15000/ 之间/ ./ 实验/ 硬件/ 环境/ :/ IntelCorei32/ ./ 93GHz4/ 核/ CPU/ ,/ 2.0/ GBRAM/ ,/ 采用/ MicrosoftWindowsXPProfessional/ 操作系统/ ./ 实验/ 软件开发/ 环境/ :/ VC2008/ +/ OpenCV2/ ./ 0/ ./ 实验/ 相关/ 参数/ 如下/ :/ 特征向量/ 默认/ 维数/ 为/ 128/ ,/ 总量/ 化/ 位数/ 为/ 210/ ,/ PCPF/ 与/ BBF/ 算法/ 搜索/ 次数/ T/ 按/ 文献/ [/ 2/ ]/ 推荐/ 设置/ 为/ 200/ ,/ 默认/ 候选/ 集/ 大小/ C/ 为/ 2/ ,/ 默认/ 匹配/ 门限/ δ/ 为/ 0.7/ ,/ 预处理/ 线程/ 数目/ ps/ =/ s/ ./ 5.1/ 并行/ 效率/ 实验/ PCPF/ 索引/ 面向/ 单机/ 多核/ 架构/ 采用/ 多线程/ 框架/ 完成/ 并行/ 索引/ 构建/ 与/ 查询/ 匹配/ ./ 并行/ 效率/ 实验/ 旨在/ 测试/ 线程/ 数目/ 对于/ 效率/ 的/ 影响/ ,/ 这里/ ,/ 使用/ 并行/ 加速/ 比/ 和/ 并行/ 效率/ 衡量/ ,/ 定义/ 如下/ :/ 图/ 6/ 给出/ 了/ 实验/ 结果/ ,/ (/ a/ )/ 为/ 构建/ PCPF/ 索引/ 时/ 不同/ 线程/ 并行执行/ 下/ 的/ 加速/ 比/ 与/ 效率/ ,/ 是/ 选自/ COREL/ 和/ 月球/ 库/ 的/ 10/ 组/ 平均/ 大小/ 为/ 10000/ 的/ 向量/ 集合/ 的/ 构建/ 平均值/ ,/ 横坐标/ 指示/ 了/ 线程/ 数目/ s/ =/ 2/ ,/ 3/ ,/ …/ ,/ 10/ ./ (/ b/ )/ 为/ 查询/ 匹配/ 的/ 结果/ ,/ 查询/ 向量/ 集合/ 大小/ 为/ 500/ ~/ 1000/ ./ Page7/ 从图/ 6/ 可以/ 看出/ ,/ 在/ 实验/ 采用/ 的/ 四核/ 处理器/ 环境/ 下/ ,/ 在/ 不同/ 线程/ 下/ ,/ 构建/ 加速/ 比为/ 1.57/ ~/ 2.89/ ,/ 并行/ 效率/ 为/ 0.45/ ~/ 0.79/ ;/ 查询/ 匹配/ 的/ 加速/ 比为/ 1.12/ ~/ 1.71/ ,/ 并行/ 效率/ 为/ 0.28/ ~/ 0.73/ ./ 并行/ 加速/ 比/ 在/ s/ =/ 4/ ,/ 即/ 与/ 处理器/ 核数/ 相匹配/ 时/ 取得/ 最大值/ ,/ 线程/ 数/ 小于/ 处理器/ 核数/ 时/ 递增/ ,/ 超过/ 时/ 递减/ ./ 并行/ 效率/ 随着/ 线程/ 数目/ 增加/ 而/ 递减/ ./ 根据/ 实验/ 结果/ 可以/ 得出/ ,/ 并行/ 线程/ 数目/ s/ 等于/ 处理器/ 核数/ core/ 时/ ,/ 可以/ 得到/ 最优/ 的/ 性能/ 提升/ ;/ s/ </ core/ 时/ ,/ 由于/ 没有/ 充分利用/ 每个/ 处理器/ 的/ 计算资源/ ,/ 加速/ 比较/ 小/ ,/ 但/ 此时/ 一方面/ 由于/ 实际/ 利用/ 核数/ (/ 即式/ (/ 7/ )/ 中/ 的/ 分母/ )/ 也/ 较/ 少/ ,/ 另一方面/ 存在/ 空闲/ 处理器/ 可以/ 处理/ 操作系统/ 等/ 的/ 计算/ 请求/ ,/ 故/ 并行/ 效率/ 较/ 高/ ;/ s/ >/ core/ 时/ 随着/ 线程/ 数目/ 的/ 增加/ ,/ 维护/ 多个/ 线程/ 本身/ 的/ 开销/ 增大/ ,/ 并行/ 加速/ 比/ 与/ 效率/ 均/ 有所/ 下降/ ./ 此外/ ,/ 构建/ 算法/ 的/ 性能/ 提升/ 优于/ 查询/ 匹配/ 算法/ ,/ 这是/ 由于/ 对/ 向量/ 集合/ 构建/ 索引/ 前/ 经过/ 了/ 一系列/ 预处理/ ,/ 使得/ 数据/ 集/ 分布/ 较为/ 均匀/ ,/ 因此/ 各/ 线程/ 负载/ 较为/ 均衡/ ;/ 而/ 查询/ 向量/ 合集/ 本身/ 并非/ 均匀分布/ ,/ 而/ 其/ 预处理/ 采用/ 的/ KL/ 变换/ 基/ 以及/ 量化/ 维/ 数等/ 参数均/ 是/ 根据/ 数据库/ 中/ 多媒体/ 对象/ 的/ 向量/ 集合/ 的/ 数据分布/ 计算/ 到/ ,/ 并不一定/ 能/ 很/ 好/ 地/ 划分/ 查询/ 数据/ 集而/ 使/ 各/ 线程/ 负载/ 十分/ 均衡/ ,/ 因此/ ,/ 数据分布/ 的/ 差异/ 使/ 并行/ 性能/ 提升/ 也/ 有所不同/ ./ 由此/ ,/ PCPF/ 通过/ 多处理器/ 架构/ 下/ 的/ 多线程/ 并行执行/ 得到/ 了/ 明显/ 的/ 性能/ 优化/ ,/ 并行/ 线程/ 数目/ 等于/ 处理器/ 核数/ 时/ 为/ 最优/ ,/ 因此/ ,/ 在/ 后续/ 实验/ 中/ ,/ 取/ s/ =/ 4.5/ ./ 2/ 索引/ 构建/ 效率/ 实验/ 索引/ 构建/ 效率/ 实验/ 旨在/ 评估/ PCPF/ 对/ 特征向量/ 数据/ 集/ 构建/ 索引/ 的/ 时间/ 消耗/ ./ 事实上/ ,/ 索引/ 的/ 构建/ 在/ 查询/ 匹配/ 之前/ 完成/ 并/ 与/ 多媒体/ 对象/ 一起/ 存储/ 于/ 数据库/ 中/ ,/ 其/ 时间/ 消耗/ 并/ 不/ 影响/ 检索/ 效率/ ./ 但/ 由于/ PCPF/ 为/ 静态/ 索引/ ,/ 即当/ 一个/ 多媒体/ 对象/ 特征向量/ 集合/ 改变/ 时/ ,/ 将/ 重新/ 建立/ 索引/ ,/ 故/ 我们/ 也/ 对此/ 进行/ 评估/ ./ 图/ 7/ 给出/ 了/ 实验/ 结果/ ,/ 图/ (/ a/ )/ 比较/ 了/ 从/ 5k/ ~/ 15k/ 的/ 不同/ 规模/ 的/ 向量/ 集合/ 上/ 构建/ PCPF/ 索引/ 和/ BBF/ 索引/ 时/ 的/ 时间/ 消耗/ ,/ 每个/ 构建/ 时间/ 均/ 为/ 10/ 个/ 向量/ 集合/ 的/ 构建/ 平均值/ ,/ 来源/ 为/ 月球/ 图像/ 库/ ;/ 图/ (/ b/ )/ 比较/ 了/ 不同/ 维数/ (/ D/ =/ 20/ ,/ 50/ ,/ 80/ ,/ 120/ )/ 的/ 向量/ 集合/ 上/ 构建/ PCPF/ 索引/ 和/ BBF/ 索引/ 时/ 的/ 时间/ 消耗/ ,/ 同样/ 为/ 10/ 个/ 向量/ 集合/ 的/ 构建/ 平均/ ,/ 来源/ 为/ COREL/ 图片库/ ./ 从图/ 中/ 可以/ 看出/ ,/ 采用/ 串行/ (/ s/ =/ 1/ )/ 的/ 方法/ 构建/ PCPF/ 索引/ 耗时/ 大于/ BBF/ 索引/ 构建/ ,/ 其/ 时间/ 增长/ 随/ 数据/ 集/ 增大/ 和/ 维数/ 增加/ 而/ 增加/ ./ 并行/ PCPF/ 构建/ 与/ BBF/ 构建/ 耗时/ 十分/ 接近/ ./ 串行/ PCPF/ 耗时/ 较/ 多/ 的/ 主要/ 原因/ 是/ 为了/ 提升/ 查询/ 性能/ 进行/ 了/ KL/ 变换/ 、/ 位/ 分配/ 及/ 量化/ 等/ 压缩/ 预处理/ 步骤/ ,/ 这些/ 操作/ 的/ 计算/ 复杂度/ 较/ 高/ (/ 见/ 4.1/ 节/ 分析/ )/ 从而/ 引起/ 额外/ 耗时/ ,/ 并且/ 计算/ 量/ 随/ 数据/ 集/ 增大/ 和/ 维数/ 增加/ 均/ 有/ 增加/ ,/ 这/ 与/ BBF/ 索引/ 直接/ 构建/ 于/ 原始数据/ 集上/ 有所不同/ ./ 而/ 并行/ PCPF/ 由于/ 采用/ 多线程/ 方式/ 执行/ ,/ 大大降低/ 了/ 构建/ 时间/ ,/ 虽然/ 有些/ 情况/ 下/ 略高于/ BBF/ ,/ 但/ 总体/ 来说/ ,/ 差别/ 不大/ ./ 由此/ ,/ PCPF/ 索引/ 通过/ 并行/ 构建/ 降低/ 了/ 索引/ 结构/ 优化/ 引起/ 的/ 构建/ 时间/ 增加/ ,/ 其/ 构建/ 时间/ 在/ 不同/ 数据/ 集/ 大小/ 和/ 维/ 数下/ 与/ BBF/ 相/ 接近/ ./ 5.3/ 查询/ 匹配/ 效率/ 实验/ 查询/ 匹配/ 效率/ 实验/ 比较/ 了/ PCPF/ 算法/ 对/ 匹配/ 查询/ 向量/ 集合/ 的/ 磁盘/ I/ // O/ 与/ 时间/ 消耗/ ./ 图/ 8/ 和/ 图/ 9/ 分别/ 给出/ 了/ 查询/ 匹配/ 的/ 磁盘/ I/ // O/ 总/ 字节数/ 和/ 平均/ 单个/ 向量/ 查询/ 匹配/ 耗时/ 比较/ 试验/ 结果/ ,/ 取/ 10/ 个/ 大小/ 为/ 500/ ~/ 1000/ 的/ 查询/ 向量/ 集合/ 匹配/ 时/ 的/ 平均值/ ./ 图/ (/ a/ )/ 比较/ 了/ 在/ 5k/ ~/ 15k/ 的/ 不同/ 规模/ 的/ 向量/ 集合/ 上/ 匹配/ 查询/ 向量/ 集合/ 的/ I/ // O/ 与/ 时间/ ,/ 实验/ 影像/ 库为/ 月球/ 图像/ 库/ ,/ 图/ (/ b/ )/ 为/ 不同/ 维数/ 向量/ 集下/ 的/ 结果/ ,/ 采用/ COREL/ 图片库/ ./ 从图/ 8/ 中/ 可以/ 看出/ ,/ 随着/ 索引/ 向量/ 集/ 规模/ N/ 的/ 增加/ 和/ 维数/ D/ 的/ 增大/ ,/ BBF/ 算法/ 的/ I/ // O/ 急剧/ 增加/ ,/ 而/ Page8PCPF/ 算法/ 增量/ 平缓/ ./ N/ =/ 10000/ 时/ ,/ 串行/ 执行/ 的/ PCPF/ 算法/ 比/ BBF/ 算法/ I/ // O/ 减少/ 50/ %/ 以上/ ;/ N/ =/ 15000/ 时/ ,/ 可/ 减少/ 60/ %/ 以上/ ;/ D/ =/ 50/ 时/ 串行/ PCPF/ 磁盘/ 访问量/ 为/ BBF/ 的/ 60/ %/ 不到/ ,/ D/ =/ 120/ 时仅/ 为/ 30/ %/ 不到/ ./ 这是/ 由于/ N/ 和/ D/ 增加/ 时/ ,/ 通过/ BBF/ 算法/ 匹配/ 的/ 实际/ 向量/ 访问/ 增长/ 较/ 快/ ,/ 而/ PCPF/ 算法/ 仅/ 需多/ 读取/ 少量/ 的/ 近似/ 向量/ ,/ 需/ 访问/ 的/ 实际/ 向量/ 大小/ 仍/ 由/ 候选/ 集/ 大小/ 决定/ ,/ 数目/ 很少/ ,/ 因而/ 增量/ 不大/ ./ 并行/ PCPF/ 的/ 匹配/ 总/ I/ // O/ 字节数/ 与/ 串行/ 执行/ 的/ 相差不多/ ,/ 总体/ 略偏/ 少/ 一些/ ,/ 其/ 原因/ 在于/ ,/ 一个/ 向量/ 在/ 查询/ 匹配/ 时/ 并行算法/ 只/ 遍历/ 两棵/ 邻近/ 搜索/ 子树/ ,/ 而/ 非/ 全部/ 近似/ 向量/ ./ 图/ 9/ 显示/ ,/ N/ =/ 10000/ 时/ ,/ 串行/ 的/ PCPF/ 查询/ 匹配/ 耗时/ 仅/ 不到/ BBF/ 的/ 50/ %/ ;/ N/ =/ 15000/ 时/ ,/ 为/ 40/ %/ 左右/ ;/ 对于/ 不同/ 维数/ ,/ D/ =/ 50/ 时/ 耗时/ 为/ 40/ %/ 左右/ ,/ D/ =/ 120/ 时为/ 35/ %/ 左右/ ./ 这是/ 由于/ PCPF/ 查询/ 匹配/ 时/ 通过/ 访问/ 近似/ 向量/ 减少/ 了/ 磁盘/ I/ // O/ ,/ 且/ 使用/ 二进制/ 运算/ 求取/ 近邻/ 矢量/ 减少/ 了/ 浮点运算/ 次数/ ,/ 因此/ 即使/ 串行/ 执行/ 也/ 明显/ 优于/ BBF/ 算法/ ./ PCPF/ 经过/ 多线程/ 并行执行/ ,/ 进一步提高/ 了/ 查询/ 匹配/ 效率/ ,/ 平均/ 单个/ 向量/ 的/ 匹配/ 耗时/ 与/ BBF/ 相比/ 仅/ 为/ 其/ 15/ %/ ~/ 50/ %/ ./ 由此/ ,/ PCPF/ 查询/ 匹配/ 时/ 磁盘/ I/ // O/ 少于/ BBF/ 算法/ ,/ 查询/ 匹配/ 耗时/ 大幅/ 减少/ ,/ 效率/ 明显/ 优于/ BBF/ 算法/ ./ 5.4/ 查询/ 匹配/ 效果/ 实验/ 查询/ 匹配/ 效果/ 实验/ 用于/ 检验/ PCPF/ 算法/ 效率/ 的/ 提高/ 对/ 匹配/ 效果/ 的/ 影响/ ./ 实验/ 使用/ 10/ 幅/ 包含/ 光度/ 变化/ 、/ 噪声污染/ 、/ 角度/ 变换/ 和/ 尺度/ 变换/ 的/ 样例/ 图片/ 与/ 实验/ 库中/ 图像/ 相匹配/ 取/ 平均值/ ,/ 采用/ 查全率/ (/ Recall/ )/ -/ 查错/ 率/ (/ 1/ -/ Precision/ )/ 曲线/ ,/ 衡量/ 不同/ 算法/ 的/ 匹配/ 效果/ ,/ 理想/ 状态/ 的/ 查全率/ -/ 查错/ 率/ 曲线/ 应/ 收缩/ 于/ (/ 0/ ,/ 1/ )/ 点/ ,/ 即/ 查错/ 率为/ 0/ ,/ 查全率/ 为/ 1/ ./ 其中/ ,/ 查全率/ (/ Recall/ )/ 和/ 查错/ 率/ (/ 1/ -/ Precision/ )/ 定义/ 如下/ ,/ 在/ 实验/ 中/ 通过/ 调整/ δ/ 的/ 设置/ 计算/ 取得/ ./ 从图/ 10/ 中/ 可以/ 看到/ ,/ 通过/ 串行/ 执行/ 的/ PCPF/ 、/ PCPF/ 和/ BBF/ 算法/ 得到/ 的/ 匹配/ 效果/ 十分/ 接近/ ,/ 其中/ 最好/ 的/ 是/ 串行/ 执行/ 的/ PCPF/ 查询/ 匹配/ 算法/ ,/ 其较/ 好/ 的/ 效果/ 一方面/ 是/ 由于/ 其/ 与/ BBF/ 均/ 为/ 近似/ 查找/ 算法/ ;/ 另一方面/ 有/ 可能/ 是/ 由于/ 通过/ 近似/ 向量/ 来/ 过滤/ 匹配/ 的/ 方法/ 一定/ 程度/ 上/ 降低/ 了/ 第二/ 近邻/ 的/ 查找/ 准确率/ ,/ 因此/ 增加/ 了/ 匹配/ 成功率/ ,/ 从而/ 提升/ 了/ 查全率/ ,/ 降低/ 了/ 查错/ 率/ (/ 参见/ 式/ (/ 1/ )/ )/ ./ 并行/ PCPF/ 查询/ 匹配/ 算法/ 由于/ 在/ 查询/ 过程/ 中/ 没有/ 完全/ 遍历/ 所有/ 的/ 子树/ 以求/ 取/ 第一/ 近邻/ ,/ 所以/ 其/ 匹配/ 效果/ 较/ 串行/ 情况/ 较差/ ,/ 有时/ 接近/ 于/ BBF/ 算法/ ,/ 但/ 总体/ 匹配/ 效果/ 仍略/ 好/ 于/ BBF/ ./ 由此/ ,/ PCPF/ 算法/ 效率/ 的/ 提升/ 非但/ 没有/ 导致/ 匹配/ 精度/ 的/ 下降/ ,/ 反而/ 能比/ BBF/ 算法/ 取得/ 更好/ 的/ 匹配/ 效果/ ./ 6/ 总结/ 与/ 展望/ 本文/ 针对/ 多媒体数据库/ 对象/ 检索/ 中/ 的/ 高维/ 特征向量/ 匹配/ 问题/ ,/ 基于/ 多核/ 处理器/ 架构/ ,/ 提出/ 一种/ 新/ 的/ 并行/ 压缩/ 优先/ 过滤/ 索引/ (/ PCPF/ )/ ./ PCPF/ 采用/ 并行/ 构建/ 算法/ 量化/ 特征向量/ 并/ 构建/ 多个/ 索引/ 子/ 分支/ ,/ 并/ 利用/ 优先/ 队列/ 并行/ 过滤/ 多个/ 子/ 分支/ 得到/ 近似/ 近邻/ 候选/ 集来/ 提高/ 查询/ 匹配/ 效率/ ./ 实验/ 证明/ ,/ PCPF/ 并行/ 构建/ 与/ 查询/ 匹配/ 算法/ 在/ 多/ 核/ 处理器/ 架构/ 下/ 取得/ 了/ 良好/ 的/ 并行/ 效果/ ,/ 较/ 经典/ 的/ BBF/ 算法/ 在/ 查询/ 匹配/ 性能/ 上/ 有/ 大幅/ 提升/ ,/ 同时/ 提高/ 了/ 匹配/ 效果/ ,/ 并且/ 没有/ 明显/ 地/ 增加/ 构建/ 时间/ ./ 在/ 实际/ 多媒体/ 检索/ 应用/ 中/ ,/ 特征向量/ 分布/ 具有/ 一定/ 的/ 规律/ ,/ 合理/ 的/ 聚类/ 十分/ 重要/ ,/ 不但/ 能/ 有效/ 提升/ 检索/ 效率/ ,/ 更能/ 增加/ 检索/ 结果/ 的/ 准确性/ ./ PCPF/ 索引/ 构建/ 时仅/ 考虑/ 数据/ 集/ 的/ 均匀/ 划分/ ,/ 而/ 没有/ 加入/ 聚类/ 的/ 考虑/ ./ 对此/ ,/ 后续/ 工作/ 将/ 通过/ 分析/ 向量/ 集合/ 的/ 分布/ 特性/ ,/ 研究/ 合理/ 的/ 聚类/ 对于/ 索引/ 性能/ 与/ 效率/ 的/ 影响/ ./ 致谢/ 感谢/ 中国科学院/ 国家/ 天文台/ 提供/ 了/ 嫦娥/ 二号/ 月球/ 遥感/ 影像/ 数据/ 作为/ 本文/ 的/ 实验/ 数据/ 来源/ 之一/ (/ 月球/ 空间数据/ 影像/ 库/ )/ !/ Page9/ 

