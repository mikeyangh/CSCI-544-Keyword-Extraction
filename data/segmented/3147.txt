Page1/ 一种/ 支持/ 对象/ 代理/ 数据库/ 高效/ 查询处理/ 的/ 索引/ 结构/ 黄泽谦/ 1/ )/ 彭智勇/ 2/ )/ 李越/ 2/ )/ 彭煜玮/ 2/ )/ 1/ )/ (/ 武汉大学/ 软件工程/ 国家/ 重点/ 实验室/ 武汉/ 430072/ )/ 2/ )/ (/ 武汉大学/ 计算机/ 学院/ 武汉/ 430072/ )/ 摘要/ 文中/ 为/ 对象/ 代理/ 数据库/ 提出/ 了/ 一种/ 新/ 的/ 索引/ 结构/ —/ —/ —/ 路径/ 导航/ 索引/ (/ PathNavigationIndex/ ,/ PNI/ )/ ,/ 能够/ 克服/ 路径/ 表达式/ 计算/ 开销/ 大/ 的/ 缺点/ ,/ 使/ 对象/ 代理/ 数据库/ 跨类/ 查询/ 与/ 代理/ 对象/ 查询/ 具备/ 高效/ 的/ 查询/ 性能/ ./ PNI/ 索引/ 建立/ 在/ 代理/ 层次/ 的/ 路径/ 实例/ 之上/ ,/ 包括/ Path/ -/ Instance/ -/ Table/ ,/ Identity/ -/ Index/ 和/ Attribute/ -/ Index3/ 个/ 组成部分/ ./ Path/ -/ Instance/ -/ Table/ 能够/ 物化/ 存储/ 路径/ 实例/ ,/ 避免/ 查询处理/ 过程/ 中/ 冗余/ 的/ 对象/ 导航/ 遍历/ ./ Identity/ -/ Index/ 与/ Attrib/ -/ ute/ -/ Index/ 用于/ 对/ 路径/ 实例/ 进行/ 关联/ 检索/ ,/ 能够/ 避免/ 对象/ 导航/ 过程/ 中/ 的/ 条件/ 判断/ ./ 通过/ 实验/ 分析/ 了/ 影响/ 路径/ 表达式/ 计算/ 的/ 不同/ 因素/ ,/ 实验/ 结果表明/ ,/ 利用/ PNI/ 索引/ 计算/ 路径/ 表达式/ 的/ 方法/ 在/ 多数/ 情况/ 下/ 性能/ 要/ 优于/ 现有/ 计算方法/ ,/ 尤其/ 适用/ 于/ 带/ 谓词/ 的/ 路径/ 表达式/ 计算/ ./ 关键词/ 对象/ 代理/ 数据库/ ;/ 路径/ 导航/ 索引/ ;/ 路径/ 表达式/ ;/ 查询处理/ 1/ 引言/ 面向对象/ (/ OO/ )/ 数据模型/ 解决/ 了/ 传统/ 关系/ 模型/ Page2/ 性/ 使得/ 对象/ 不/ 具有/ 关系/ 模型/ 中/ 关系/ 的/ 柔软性/ ,/ 因为/ 对象/ 难以/ 分割/ 和/ 重组/ ;/ 此外/ ,/ OO/ 模型/ 缺乏/ 对/ 现实/ 世界/ 实体/ 多/ 角色/ 特性/ 与/ 动态/ 特性/ 的/ 建模/ 能力/ ./ 对象/ 代理/ (/ ObjectDeputy/ ,/ OD/ )/ 模型/ [/ 1/ -/ 2/ ]/ 是/ 在/ 传统/ OO/ 模型/ 基础/ 上/ 提出/ 的/ 一种/ 新/ 的/ 数据模型/ ,/ 它/ 利用/ 代理/ 对象/ (/ deputyobject/ )/ 的/ 概念/ 增强/ 了/ OO/ 模型/ 的/ 柔软性/ 和/ 建模/ 能力/ ./ 近年来/ ,/ OD/ 模型/ 被/ 广泛应用/ 于/ 数据仓库/ [/ 3/ ]/ 、/ 工作/ 流/ 视图/ [/ 4/ ]/ 、/ 科学/ 工作/ 流/ [/ 5/ ]/ 、/ 生物/ 数据管理/ [/ 6/ ]/ 以及/ 地理信息系统/ [/ 7/ ]/ 等/ 领域/ ./ OD/ 模型/ 与/ 数据库/ 相结合/ 产生/ 了/ 对象/ 代理/ 数据库/ (/ ObjectDeputyDatabase/ ,/ ODDB/ )/ ./ ODDB/ 继承/ 了/ 诸多/ 面向对象/ 数据库/ (/ OODB/ )/ 的/ 优点/ ,/ 如/ 直接/ 建模/ 复杂/ 对象/ 、/ 把/ 类/ 组织/ 成/ 代理/ 层次/ 等/ ./ ODDB/ 允许/ 定义/ 灵活/ 的/ 对象/ 视图/ 、/ 支持/ 对象/ 动态/ 分类/ ,/ 并且/ 提供/ 特殊/ 的/ 跨类/ 查询/ 等/ 新机制/ ./ ODDB/ 使用/ 代理/ 对象/ 增强/ 了/ 对象/ 的/ 柔软性/ ,/ 允许/ 对/ 已有/ 对象/ 进行/ 分解/ 、/ 组合/ 和/ 扩充/ ,/ 比/ OODB/ 具有/ 更加/ 柔软/ 的/ 建模/ 能力/ ./ 实践/ 表明/ ,/ ODDB/ 管理/ 复杂/ 数据/ 的/ 能力/ 强/ ,/ 特别/ 是/ 在/ 生物/ 数据库/ 、/ 空间/ 数据库/ 、/ 多媒体数据库/ 等/ 应用/ 方面/ ,/ 比/ OODB/ 更/ 高效/ ./ 文献/ [/ 8/ ]/ 为/ ODDB/ 提出/ 了/ 一种/ 声明/ 式/ 查询语言/ —/ —/ —/ 对象/ 代理/ 查询语言/ ./ 该/ 语言/ 使用方便/ ,/ 具有/ 许多/ 新/ 特性/ ,/ 如/ 代理/ 对象/ 查询/ 、/ 跨类/ 查询/ 等/ ./ 众所周知/ ,/ 查询处理/ 的/ 效率/ 严重/ 影响/ 着/ 数据库系统/ 的/ 性能/ ,/ 代理/ 对象/ 查询/ 与/ 跨类/ 查询/ 是/ ODDB/ 两种/ 重要/ 的/ 查询/ 机制/ ,/ 减少/ 这/ 两类/ 查询/ 的/ 开销/ ,/ 有助于/ 提高/ 数据库系统/ 的/ 整体/ 性能/ ./ 在/ ODDB/ 中/ ,/ 代理/ 对象/ 的/ 模式定义/ 为/ 代理/ 类/ ,/ 其中/ 继承/ 定义/ 的/ 属性/ 称为/ 虚/ 属性/ ,/ 不/ 占有/ 实际/ 的/ 物理/ 存储/ ;/ 扩展/ 定义/ 的/ 属性/ 称为/ 实/ 属性/ ,/ 它们/ 占有/ 真正/ 的/ 物理/ 存储/ ./ 代理/ 对象/ 查询/ 的/ 特殊/ 之/ 处/ 在于/ 虚/ 属性/ 计算/ ./ 每个/ 虚/ 属性/ 定义/ 包含/ 一个/ 读/ 切换/ 表达式/ 定义/ ,/ 声明/ 了/ 如何/ 由/ 被/ 继承/ 的/ 源/ 对象/ 属性/ 计算/ 得到/ 该/ 虚/ 属性/ 的/ 值/ ./ 一个/ 读/ 切换/ 表达式/ 可以/ 转换/ 为/ 一个/ 表达式/ 计算/ 树/ ,/ 树/ 的/ 非/ 叶子/ 结点/ 为/ 计算/ 操作符/ ,/ 树/ 的/ 叶子/ 结点/ 为/ 数值/ 常量/ 或/ 路径/ 表达式/ ,/ 其中/ 的/ 路径/ 表达式/ 声明/ 了/ 从/ 该/ 虚/ 属性/ 到达/ 一个/ 源/ 对象/ 属性/ 的/ 路径/ ./ 虚/ 属性/ 查询处理/ 的/ 关键/ 是/ 路径/ 表达式/ 计算/ ./ 此外/ ,/ 对象/ 代理/ 查询语言/ 使用/ 路径/ 表达式/ 表达/ 跨类/ 查询/ ./ ODDB/ 中/ 代理/ 对象/ 与源/ 对象/ 间/ 存在/ 双向/ 指针/ 链接/ ./ 跨类/ 查询/ 是/ 指/ 基于/ 对象/ 间/ 的/ 双向/ 指针/ 链接/ ,/ 从/ 某个/ 类/ (/ 代理/ 类/ )/ 的/ 对象/ (/ 代理/ 对象/ )/ 出发/ ,/ 沿着/ 类/ 路径/ 到达/ 一个/ 与其/ 存在/ 直接/ 或/ 间接/ 代理/ 关系/ 的/ 类/ (/ 代理/ 类/ )/ ,/ 并/ 对/ 该类/ 上/ 相关联/ 的/ 对象/ (/ 代理/ 对象/ )/ 进行/ 查询/ ./ 跨类/ 查询/ 的/ 核心/ 是/ 路径/ 表达式/ 计算/ ./ 可以/ 看到/ ,/ 路径/ 表达式/ 是/ 对象/ 代理/ 查询语言/ 的/ 重要/ 查询/ 设施/ ,/ 提高/ 路径/ 表达式/ 的/ 计算/ 效率/ 是/ ODDB/ 高效/ 查询处理/ 的/ 关键/ ./ 路径/ 表达式/ 的/ 概念/ 并/ 不是/ ODDB/ 所/ 特有/ ,/ 早/ 在/ OODB/ 查询语言/ [/ 9/ -/ 10/ ]/ 中/ 就/ 已经/ 存在/ ,/ 用于/ 表达/ 嵌套/ 对象/ 的/ 导航/ 遍历/ ./ 目前/ ,/ 在/ OODB/ 中/ 针对/ 路径/ 表达式/ 计算/ 的/ 基本/ 方法/ 有/ 3/ 种/ :/ 正向/ 指针/ 跟踪/ 算法/ 、/ 反向/ 指针/ 跟踪/ 算法/ 和/ 显式/ 连接/ 算法/ ./ 正向/ 指针/ 跟踪/ 算法/ 利用/ 对象/ 引用/ 指针/ ,/ 从/ 路径/ 起始/ 类/ 的/ 对象/ 出发/ ,/ 沿着/ 嵌套/ 关系/ 路径/ 进行/ 对象/ 遍历/ ./ 反向/ 指针/ 跟踪/ 算法/ 的/ 思想/ 与/ 正向/ 指针/ 跟踪/ 算法/ 的/ 思想/ 类似/ ,/ 不过/ 是从/ 路径/ 末/ 结点/ 类/ 的/ 对象/ 出发/ 进行/ 对象/ 遍历/ ,/ 如果/ OODB/ 中/ 被/ 引用/ 对象/ 存在/ 指向/ 引用/ 对象/ 的/ 反向/ 指针/ ,/ 则/ 对象/ 遍历/ 的/ 执行/ 过程/ 与/ 正向/ 指针/ 跟踪/ 算法/ 对象/ 遍历/ 的/ 执行/ 过程/ 一样/ ;/ 如果/ OODB/ 中/ 被/ 引用/ 对象/ 不/ 存在/ 反向/ 指针/ 指向/ 引用/ 对象/ ,/ 则/ 反向/ 指针/ 跟踪/ 算法/ 实际上/ 是/ 一个/ 隐式/ 连接/ 算法/ ,/ 需要/ 将/ 路径/ 后/ 一层/ 对象/ 的/ 标识符/ 与/ 前/ 一层/ 对象/ 的/ 引用/ 指针/ 进行/ 相等/ 比较/ ./ 显式/ 连接/ 算法/ 利用/ 传统/ 数据库/ 的/ 连接/ 操作/ ,/ 将/ 路径/ 表达式/ 转换成/ 一个/ 显式/ 连接/ 表达式/ 进行/ 计算/ ./ 文献/ [/ 11/ ]/ 提出/ 了/ 一个/ 代价/ 模型/ 用于/ 评估/ 不同/ 方法/ 的/ 计算/ 代价/ ,/ 并/ 使用/ 启发式/ 规则/ 选取/ 由/ 不同/ 计算方法/ 组成/ 的/ 高效/ 组合/ 计算/ 策略/ ./ 相对/ 于/ 上述/ 3/ 种/ 集中式/ 的/ 计算方法/ ,/ 文献/ [/ 12/ ]/ 提出/ 了/ 路径/ 表达式/ 的/ 并行算法/ ,/ 通过/ 将/ 一个/ 路径/ 表达式/ 转换/ 为/ 一个/ 级联/ 式/ 半/ 连接/ 表达式/ 实现/ 并行计算/ ./ ODDB/ 路径/ 表达式/ 与/ OODB/ 路径/ 表达式/ 的/ 区别/ 在于/ :/ ODDB/ 路径/ 表达式/ 不是/ 用于/ 表达/ 嵌套/ 对象/ 的/ 导航/ 遍历/ ,/ 而是/ 用于/ 表达/ 代理/ 层次/ 中/ 的/ 对象/ 导航/ 遍历/ ,/ 两者/ 的/ 计算方法/ 并不相同/ ./ 支持/ OODB/ 嵌套/ 对象/ 查询/ 、/ 优化/ OODB/ 路径/ 表达式/ 计算/ 的/ 技术/ 主要/ 是/ 索引/ 技术/ ./ 文献/ [/ 13/ ]/ 提出/ 在/ 类/ 的/ 聚集/ 层次/ 中/ 任意/ 两个/ 具有/ 引用/ 关系/ 的/ 类/ 之间/ 建立/ MultipleIndex/ ,/ 将/ 被/ 引用/ 对象/ 映射/ 到/ 引用/ 对象/ ./ 文献/ [/ 14/ ]/ 提出/ 的/ JoinIndex/ 与/ MultipleIndex/ 相/ 类似/ ,/ 只不过/ 在/ 两个/ 具有/ 引用/ 关系/ 的/ 类/ 之间/ 建立/ 两个/ 映射/ 关系/ ,/ 一个/ 是从/ 被/ 引用/ 对象/ 映射/ 到/ 引用/ 对象/ ,/ 另/ 一个/ 是从/ 引用/ 对象/ 映射/ 到/ 被/ 引用/ 对象/ ./ 为/ 支持/ 嵌套/ 谓词/ 计算/ ,/ 文献/ [/ 15/ ]/ 提出/ 了/ NestedIndex/ ,/ 可以/ 由/ 一个/ 嵌套/ 属性/ 值/ 直接/ 映射/ 到/ 嵌套/ 层次/ 的/ 根/ 对象/ 本身/ ./ Path/ -/ Index/ [/ 16/ ]/ 在/ 索引/ 结构/ 上/ 比/ NestedIndex/ 复杂/ ,/ 索引/ 记录/ 不仅/ 保存/ 嵌套/ 层次/ 的/ 根/ 对象/ ,/ 而且/ 还/ 将/ 嵌套/ 路径/ 上/ 的/ 各个/ 对象/ 都/ 保存起来/ ./ PathDictionary/ [/ 17/ ]/ 提出/ 了/ 一种/ 基于/ 路径/ 词典/ 的/ 索引/ 机制/ ,/ 用于/ 支持/ 对象/ 遍历/ 和/ 关联/ 检索/ ./ 文献/ [/ 18/ ]/ 提出/ 的/ AccessSupportRelation/ 采用/ 独立/ 的/ 结构/ 物化/ 对象/ 间/ 的/ 引用/ ,/ 实际上/ 是/ 一种/ 一般化/ 的/ JoinIndex/ ./ 上述/ 各种/ 应用/ 于/ OODB/ 路径/ 表达式/ 的/ 索引/ 技术/ 并/ 不/ 完全/ 适用/ 于/ Page3ODDB/ 路径/ 表达式/ ,/ 而且/ 到/ 目前为止/ ,/ 还/ 没有/ 针对/ ODDB/ 路径/ 表达式/ 计算/ 的/ 索引/ 技术/ 研究/ ./ 本文/ 针对/ ODDB/ 路径/ 表达式/ 计算/ 问题/ ,/ 提出/ 了/ 一种/ 新/ 的/ 索引/ 结构/ —/ —/ —/ 路径/ 导航/ 索引/ (/ PathNavi/ -/ gationIndex/ ,/ PNI/ )/ ,/ 并/ 基于/ PNI/ 设计/ 实现/ 了/ 计算/ 路径/ 表达式/ 的/ 方法/ ./ PNI/ 索引/ 建立/ 在/ 任意/ 长度/ 的/ 路径/ 上/ ,/ 核心思想/ 是/ 物化/ 路径/ 实例/ ,/ 允许/ 在/ 路径/ 谓词/ 的/ 谓词/ 属性/ 上/ 建立/ 属性/ 索引/ ,/ 以/ 根据/ 谓词/ 属性/ 值/ 快速/ 定位/ 路径/ 实例/ ./ 基于/ PNI/ 的/ 路径/ 表达式/ 计算方法/ ,/ 有效/ 避免/ 了/ 路径/ 表达式/ 计算/ 过程/ 中/ 的/ 对象/ 遍历/ 操作/ ,/ 能/ 快速/ 过滤/ 不/ 满足/ 谓词/ 的/ 路径/ 实例/ ,/ 减少/ 路径/ 谓词/ 计算/ 的/ 开销/ ./ 本文/ 通过/ 实验/ 验证/ 了/ PNI/ 索引/ 能/ 有效/ 支持/ 路径/ 表达式/ 计算/ ,/ 所/ 提出/ 的/ 基于/ PNI/ 的/ 计算方法/ 能/ 实现/ 高效/ 的/ 路径/ 表达式/ 计算/ ,/ 从而/ 达到/ 在/ ODDB/ 中/ 高效/ 处理/ 涉及/ 路径/ 表达式/ 的/ 代理/ 对象/ 查询/ 和/ 跨类/ 查询/ 的/ 目的/ ./ 本文/ 第/ 2/ 节对/ 对象/ 代理/ 数据库/ 进行/ 介绍/ ;/ 第/ 3/ 节/ 介绍/ 路径/ 导航/ 索引/ PNI/ ,/ 并/ 提出/ 使用/ PNI/ 计算/ 路径/ 表达式/ 的/ 方法/ ;/ 第/ 4/ 节/ 通过/ 实验/ 验证/ 所/ 提出/ 的/ 基于/ PNI/ 计算/ 路径/ 表达式/ 方法/ 的/ 有效性/ ,/ 并/ 将/ 该/ 方法/ 与/ 其它/ 几种/ 方法/ 进行/ 分析/ 比较/ ;/ 第/ 5/ 节对/ 本文/ 工作/ 进行/ 总结/ ./ 2/ 对象/ 代理/ 数据库/ 2.1/ 基本概念/ 对象/ 代理/ 数据库/ 的/ 核心/ 概念/ 包含/ 对象/ 、/ 代理/ 对象/ 、/ 类/ 和/ 代理/ 类/ 等/ ,/ 本/ 节/ 首先/ 对/ 这些/ 概念/ 进行/ 简单/ 描述/ ,/ 其/ 详细/ 定义/ 参见/ 文献/ [/ 1/ ]/ ./ 另外/ ,/ 为/ 方便/ 文章/ 的/ 讨论/ ,/ 本节/ 还/ 将/ 给出/ 路径/ 表达式/ 等/ 相关/ 概念/ 的/ 定义/ ./ 对象/ 用于/ 表示/ 现实/ 世界/ 的/ 实体/ ,/ 包括/ 属性/ 集/ 和/ 方法/ 集/ ./ 对象/ 的/ 属性/ 值/ 表示/ 实体/ 的/ 状态/ ,/ 而/ 对象/ 的/ 方法/ 则/ 用于/ 表示/ 实体/ 的/ 行为/ ./ 代理/ 对象/ 基于/ 对象/ 或/ 其它/ 代理/ 对象/ 定义/ ,/ 同样/ 具有/ 自身/ 的/ 属性/ 集/ 和/ 方法/ 集/ ./ 一个/ (/ 代理/ )/ 对象/ 可以/ 有/ 多个/ 代理/ 对象/ ,/ 前者/ 称为/ 后者/ 的/ 源/ 对象/ ;/ 多个/ 源/ 对象/ 可/ 共享/ 一个/ 代理/ 对象/ ./ 代理/ 对象/ 与/ 对象/ 间/ 的/ 代理/ 关系/ 有别于/ 传统/ 的/ 对象/ 继承/ 关系/ ,/ 即/ 代理/ 对象/ 可以/ 选择性/ 继承/ 源/ 对象/ 的/ 部分/ 或/ 全部/ 属性/ 、/ 方法/ ,/ 也/ 可以/ 根据/ 需要/ 增加/ 扩展/ 属性/ 和/ 扩展/ 方法/ 的/ 定义/ ./ 每个/ 对象/ 和/ 代理/ 对象/ 都/ 具有/ 唯一/ 的/ 标识符/ ./ 具有/ 相同/ 属性/ 和/ 方法/ 的/ 对象/ 用类/ 来/ 定义/ 其/ 模式/ ./ 作为/ 对象/ 模式/ ,/ 类/ 包括/ 类名/ 、/ 外延/ 和/ 类型/ ./ 外延/ 是/ 属于/ 该类/ 的/ 对象/ 集/ ,/ 类型/ 是/ 对象/ 的/ 属性/ 和/ 方法/ 的/ 定义/ ./ 代理/ 类/ 定义/ 代理/ 对象/ 的/ 模式/ ,/ 同样/ 包括/ 代理/ 类名/ 、/ 外延/ 和/ 类型/ ./ 代理/ 类/ 可由源/ 对象/ 所属/ 类/ 导出/ ,/ 后者/ 称为/ 前者/ 的/ 源类/ ./ 代理/ 类/ 定义/ 中/ ,/ 继承/ 的/ 属性/ 称为/ 虚/ 属性/ ,/ 并/ 不/ 占有/ 实际/ 物理/ 存储/ ./ 每个/ 虚/ 属性/ 定义/ 有/ 两个/ 基本/ 切换/ 操作/ ,/ 使得/ 对/ 虚/ 属性/ 的/ 读/ 操作/ 将/ 切换/ 至/ 对/ 继承/ 属性/ 的/ 读/ ,/ 对/ 虚/ 属性/ 的/ 写/ 操作/ 也/ 将/ 切换/ 到/ 对/ 继承/ 属性/ 进行/ 更新/ ./ 代理/ 类/ 定义/ 中/ 扩展/ 定义/ 的/ 属性/ 与/ 类/ 定义/ 中/ 的/ 属性/ 一起/ 统称/ 为实/ 属性/ ./ 实/ 属性数据/ 占有/ 实际/ 物理/ 存储空间/ ,/ 支持/ 直接/ 的/ 数据/ 读写操作/ ./ 与/ 属性/ 相/ 类似/ ,/ 类/ 定义/ 中/ 的/ 方法/ 与/ 代理/ 类中/ 扩展/ 定义/ 的/ 方法/ 支持/ 直接/ 方法/ 调用/ ,/ 而/ 代理/ 类中/ 继承/ 定义/ 的/ 方法/ 上/ 定义/ 有/ 切换/ 操作/ ,/ 对/ 其/ 调用/ 会/ 切换/ 至/ 对/ 继承/ 方法/ 的/ 调用/ ./ ODDB/ 中/ 可以/ 定义/ 4/ 种/ 类型/ 的/ 代理/ 类/ ,/ 分别/ 是/ Select/ 、/ Join/ 、/ Group/ 和/ Union/ ./ Select/ 代理/ 类/ 只/ 从/ 一个/ 类/ (/ 代理/ 类/ )/ 选择/ 源/ 对象/ 以/ 派生/ 代理/ 对象/ ;/ Join/ 代理/ 类/ 在/ 几个/ 类/ (/ 代理/ 类/ )/ 的/ 连接/ 结果/ 中/ 选择/ 派生/ 代理/ 对象/ ;/ Group/ 代理/ 类/ 对/ 一个/ 类/ (/ 代理/ 类/ )/ 的/ 对象/ (/ 代理/ 对象/ )/ 进行/ 分组/ ,/ 进而/ 派生/ 代理/ 对象/ ,/ 一个/ 代理/ 对象/ 代理/ 一组/ 源/ 对象/ ;/ Union/ 代理/ 类/ 从/ 若干个/ 源类/ 选择/ Select/ 代理/ 派生/ 的/ 代理/ 对象/ ,/ 再/ 并/ 在/ 一个/ 代理/ 类中/ ./ 图/ 1/ 给出/ 了/ 一个/ 音乐/ 数据库/ 的/ 模式/ ,/ 它/ 包含/ 5/ 个类/ :/ Artist/ (/ 歌手/ )/ 、/ Music/ (/ 音乐/ )/ 、/ MTV/ (/ 音乐/ 录影带/ )/ 、/ Lyrics/ (/ 歌词/ )/ 和/ Picture/ (/ 专辑/ 图片/ )/ ;/ 还/ 定义/ 有/ 5/ 个/ 代理/ 类/ :/ 包括/ 有/ 1/ 个/ Select/ 代理/ 类/ Personal/ (/ 个性化/ 音乐/ )/ ,/ 3/ 个/ Join/ 代理/ 类/ Music/ _/ Lyr/ 、/ Music/ _/ MTV/ 与/ Album/ _/ Pic/ 以及/ 1/ 个/ Group/ 代理/ 类/ Album/ (/ 专辑/ )/ ./ 图中/ 不带/ 下划线/ 标识/ 的/ 属性/ 为实/ 属性/ ,/ 而/ 带/ 下划线/ 标识/ 的/ 属性/ 为/ 虚/ 属性/ ./ 以/ 代理/ 类/ Album/ 为例/ ,/ 歌手名/ artist/ 和/ 专辑/ 名/ album/ 是/ 由/ Music/ _/ Lyr/ 继承/ 的/ 虚/ 属性/ ,/ 而/ 专辑/ 发布/ 日期/ pubdate/ 和/ 专辑/ 介绍/ intro/ 则/ 是/ 扩展/ 定义/ 的/ 实/ 属性/ ./ 为/ 便于/ 后续/ 讨论/ ,/ 下面/ 给出/ ODDB/ 中/ 与/ 路径/ 表达式/ 相关/ 的/ 概念/ 定义/ ./ 定义/ 1/ (/ 代理/ 层次/ )/ ./ 由类/ (/ 代理/ 类/ )/ 以及/ 类/ (/ 代理/ 类/ )/ 之间/ 的/ 代理/ 关系/ 所/ 形成/ 的/ 有向图/ 称为/ 代理/ 层次/ ./ 代理/ 层次/ 中/ 的/ 结点/ 表示/ 类/ (/ 代理/ 类/ )/ ,/ 而/ 有/ 向/ 边/ 则/ 表示/ 任意/ 两个/ 结点/ 之间/ 的/ 直接/ 代理/ 关系/ ./ 令/ DH/ 为/ 一个/ 代理/ 层次/ ,/ Class/ (/ DH/ )/ =/ {/ C/ |/ C/ 是/ DH/ 中/ 的/ 类/ 或者/ 代理/ 类/ }/ ,/ 表示/ 代理/ 层次/ 中/ 所有/ 类/ 与/ 代理/ 类/ 的/ 集合/ ./ 定义/ 2/ (/ 路径/ 和/ 逆/ 路径/ )/ ./ 给定/ 代理/ 层次/ DH/ ,/ 称/ P/ =/ C1/ →/ C2/ →/ …/ →/ Cn/ (/ n/ / 2/ )/ 为/ 代理/ 层次/ DH/ 的/ 一条/ 路径/ ,/ 当且/ 仅/ 当/ 满足/ 以下/ 2/ 个/ 条件/ :/ (/ 1/ )/ Ci/ ∈/ Class/ (/ DH/ )/ ,/ 1/ / i/ / n/ ;/ (/ 2/ )/ Ci/ 与/ Ci/ +/ 1/ 之间/ 存在/ 直接/ 代理/ 关系/ ,/ 即/ Ci/ 是/ Ci/ +/ 1/ 的/ 代理/ 类/ 或者/ Ci/ +/ 1/ 是/ Ci/ 的/ 代理/ Page4/ 图/ 1/ 音乐/ 数据库/ 模式/ 类/ ,/ 1/ / i/ </ n/ ./ len/ (/ P/ )/ =/ n/ -/ 1/ 表示/ 路径/ P/ 的/ 长度/ ./ class/ (/ P/ )/ =/ {/ Ci/ |/ 1/ / i/ / n/ }/ 表示/ 路径/ P/ 所/ 包含/ 的/ 类/ 与/ 代理/ 类/ 的/ 集合/ ./ 对于/ 给定/ 的/ 路径/ P1/ =/ C1/ →/ C2/ →/ …/ →/ Cn/ ,/ 称/ 路径/ P2/ =/ Cn/ →/ Cn/ -/ 1/ →/ …/ →/ C1/ 为/ 路径/ P1/ 的/ 逆/ 路径/ ,/ 反之/ 也/ 成立/ ./ 定义/ 3/ (/ 路径/ 实例/ )/ ./ 给定/ 路径/ P/ =/ C1/ →/ C2/ →/ …/ →/ Cn/ ,/ 由/ n/ 个/ 对象/ (/ 代理/ 对象/ )/ 组成/ 的/ 对象/ 序列/ PI/ =/ o1/ →/ o2/ →/ …/ →/ on/ 称为/ P/ 的/ 一个/ 实例/ ,/ 当且/ 仅/ 当/ :/ (/ 1/ )/ oi/ 是/ Ci/ 的/ 一个/ 实例/ ,/ 1/ / i/ / n/ ;/ (/ 2/ )/ oi/ 与/ oi/ +/ 1/ 之间/ 存在/ 直接/ 代理/ 关系/ ,/ 即/ oi/ 是/ oi/ +/ 1/ 的/ 代理/ 对象/ 或者/ oi/ +/ 1/ 是/ oi/ 的/ 代理/ 对象/ ,/ 1/ / i/ </ n/ ./ 定义/ 4/ (/ 路径/ 表达式/ )/ ./ 给定/ 代理/ 层次/ DH/ ,/ 称/ PE/ =/ (/ C1/ {/ p1/ }/ →/ C2/ {/ p2/ }/ →/ …/ →/ Cn/ {/ pn/ }/ )/ ./ expr/ (/ n/ / 2/ )/ 是/ 在/ 路径/ P/ =/ C1/ →/ C2/ →/ …/ →/ Cn/ 上/ 定义/ 的/ 路径/ 表达式/ ,/ 当且/ 仅/ 当/ :/ (/ 1/ )/ P/ 是/ DH/ 的/ 一条/ 路径/ ;/ (/ 2/ )/ pi/ 是/ 定义/ 在/ Ci/ 属性/ 上/ 的/ 谓词/ (/ pi/ 可以/ 为空/ ,/ 1/ / i/ / n/ )/ ;/ (/ 3/ )/ expr/ 是/ 由/ Cn/ 的/ 属性/ 与/ 常量/ 通过/ 算术/ 或/ 逻辑/ 运算符/ 组成/ 的/ 合法/ 表达式/ ./ 其中/ ,/ C1/ {/ p1/ }/ →/ C2/ {/ p2/ }/ →/ …/ →/ Cn/ {/ pn/ }/ 称为/ PE/ 的/ 导航/ 路径/ ,/ expr/ 称为/ PE/ 的/ 目标/ 表达式/ ./ 图/ 1/ 的/ 数据库/ 模式/ 是/ 一个/ 代理/ 层次/ ,/ P/ =/ Music/ →/ Music/ _/ Lyr/ →/ Album/ 是/ 该/ 代理/ 层次/ 的/ 一条/ 路径/ ,/ (/ Music/ {/ artist/ =/ ‘/ U2/ ’/ }/ →/ Music/ _/ Lyr/ →/ Album/ )/ ./ intro/ 是/ 定义/ 在/ 路径/ P/ 上/ 的/ 一个/ 路径/ 表达式/ ./ 2.2/ 对象/ 代理/ 查询语言/ 对象/ 代理/ 查询语言/ 是/ 对象/ 代理/ 数据库/ 的/ 查询语言/ ,/ 它/ 在/ 语法/ 上/ 与/ SQL92/ // 99/ 类似/ ,/ 是/ 一种/ 声明/ 式/ 查询语言/ ,/ 一个/ 查询/ 命令/ 的/ 基本/ 格式/ 与/ SQL/ 查询/ 命令/ 的/ 基本/ 格式/ 一样/ ,/ 由/ SELECT/ 子句/ 、/ FROM/ 子句/ 和/ WHERE/ 子句/ 构成/ ./ 下面/ 根据/ 图/ 1/ 的/ 数据库/ 模式/ 分别/ 举例说明/ ./ 例/ 1/ ./ 针对/ Music/ _/ MTV/ 查询/ :/ “/ 歌曲/ foo/ 的/ 音乐/ 链接/ 与/ 音乐/ 录影带/ 链接/ ”/ ,/ 该/ 查询/ 采用/ 对象/ 代理/ 查询语言/ 表示/ 如下/ :/ SELECTmusic/ _/ url/ ,/ mtv/ _/ urlFROMMusic/ _/ MTVWHEREtitle/ =/ ‘/ foo/ ’/ ;/ 这个/ 例子/ 涉及/ 代理/ 对象/ 查询/ ,/ 因为/ Music/ _/ MTV/ 是/ 一个/ 代理/ 类/ ,/ 其/ 所有/ 实例/ 都/ 是/ 代理/ 对象/ ,/ 每个/ 代理/ 对象/ 的/ 属性/ 都/ 是/ 虚/ 属性/ 且/ 不/ 存储/ 这些/ 属性/ 的/ 值/ ./ 在/ 查询语言/ 的/ 表达/ 上/ ,/ 查询/ 语句/ 可以/ 用于/ 查询/ 类/ 和/ 代理/ 类中/ 的/ 对象/ ./ 如果/ 在/ 一个/ 查询/ 语句/ 的/ SELECT/ 子句/ 或/ WHERE/ 子句/ 中/ 存在/ 虚/ 属性/ ,/ 查询处理/ 需/ 调用/ 虚/ 属性/ 的/ 读/ 切换/ 操作/ 来/ 计算/ 它们/ 的/ 值/ ./ 例如/ 在/ 代理/ 类/ Music/ _/ MTV/ 的/ 定义/ 中/ ,/ 虚/ 属性/ music/ _/ url/ 由类/ Music/ 的/ 实/ 属性/ music/ _/ url/ 直接/ 继承/ ,/ 该/ 属性/ 上/ 定义/ 的/ 读/ 切换/ 操作/ 由读/ 切换/ 表达式/ (/ Music/ _/ MTV/ →/ Music/ )/ ./ music/ _/ url/ 表示/ ;/ 同理/ ,/ 虚/ 属性/ mtv/ _/ url/ 所/ 定义/ 的/ 读/ 切换/ 操作/ 由/ (/ Music/ _/ MTV/ →/ MTV/ )/ ./ mtv/ _/ url/ 表示/ ,/ 虚/ 属性/ title/ 的/ 读/ 切换/ 操作/ 由/ (/ Music/ _/ MTV/ →/ Music/ )/ ./ title/ 表示/ ./ 例/ 1/ 的/ 查询/ 最终/ 会/ 被/ 转化/ 为/ SELECT/ (/ Music/ _/ MTV/ →/ Music/ )/ ./ music/ _/ url/ ,/ FROMMusic/ _/ MTVWHERE/ (/ Music/ _/ MTV/ →/ Music/ )/ ./ title/ =/ ‘/ foo/ ’/ ;/ 该/ 查询/ 涉及/ 3/ 个/ 路径/ 表达式/ 的/ 计算/ ./ 除了/ 查询/ 虚/ 属性/ 时/ ,/ 由于/ 查询处理/ 模块/ 自动/ 将/ 虚/ 属性/ 替换/ 为/ 其读/ 切换/ 表达式/ ,/ 导致/ 在/ 查询/ 语句/ 中隐式/ 引入/ 路径/ 表达式/ 外/ ,/ 对象/ 代理/ 查询语言/ 允许/ 在/ 查询/ 语句/ 中显式/ 使用/ 路径/ 表达式/ ./ 如果/ 路径/ 表达式/ 出现/ 在/ SELECT/ 子句/ 中/ ,/ 表示/ 根据/ 路径/ 实例/ 上/ 的/ 对象/ 双向/ 指针/ 链/ ,/ 在/ 一个/ 代理/ 层次/ 范围/ 内/ 跨类/ 查询/ 相关联/ 的/ 对象/ (/ 代理/ 对象/ )/ ./ Page5/ 或者/ SELECT/ (/ Music/ {/ title/ =/ ‘/ foo/ ’/ }/ →/ FROMMusic/ ;/ 查询/ 可以/ 表示/ 如下/ :/ 例/ 2/ ./ 针对/ Music/ 查询/ :/ “/ 歌曲/ foo/ 的/ 歌词/ ”/ ,/ 该/ SELECT/ (/ Music/ →/ Music/ _/ Lyr/ →/ Lyrics/ )/ ./ lyricsFROMMusicWHEREtitle/ =/ ‘/ foo/ ’/ ;/ 以上/ 查询/ 所/ 依赖/ 的/ 路径/ 是/ Music/ →/ Music/ _/ Lyr/ →/ Lyrics/ ,/ 即/ 从/ Music/ 中/ 的/ 对象/ 出发/ ,/ 沿着/ 路径/ 实例/ 上/ 的/ 对象/ 双向/ 指针/ 链/ ,/ 跨类/ 查询/ Lyrics/ 对象/ 的/ 歌词/ 信息/ ./ 以上/ 两个/ 不同/ 的/ 路径/ 表达式/ 表达/ 同一/ 查询/ 目的/ ./ 路径/ 表达式/ 如果/ 出现/ 在/ WHERE/ 子句/ 中/ ,/ 表示/ 检索/ 对象/ (/ 代理/ 对象/ )/ 时/ ,/ 需要/ 依赖/ 同一个/ 代理/ 层次/ 中/ 相关联/ 的/ 其它/ 对象/ (/ 代理/ 对象/ )/ ./ 所有/ 专辑名称/ ”/ ,/ 该/ 查询/ 可以/ 表示/ 如下/ :/ 例/ 3/ ./ 针对/ Music/ 查询/ :/ “/ 排名/ 前十/ 的/ 歌手/ 的/ SELECTalbumFROMMusicWHERE/ (/ Music/ →/ Music/ _/ Lyr/ →/ Artist/ )/ ./ rank/ </ =/ 10/ ;/ 虽然/ 查询/ 的/ 目标/ 是/ Music/ 中/ 的/ album/ 属性/ ,/ 但是/ 却/ 需要/ 依赖/ Artist/ 中/ 的/ rank/ 进行/ 谓词/ 判断/ ./ 此外/ ,/ 路径/ 表达式/ 也/ 可以/ 同时/ 在/ SELECT/ 子句/ 与/ WHERE/ 子句/ 中/ 存在/ ./ 2.3/ 路径/ 表达式/ 计算/ 路径/ 表达式/ 计算/ 是/ ODDB/ 查询处理/ 的/ 关键/ ,/ 因为/ 涉及/ 虚/ 属性/ 的/ 代理/ 对象/ 查询/ 以及/ 跨类/ 查询/ 的/ 核心/ 都/ 在于/ 路径/ 表达式/ 计算/ ./ 路径/ 表达式/ 的/ 计算/ 需/ 依赖/ 对象/ 间/ 的/ 双向/ 指针/ 链接/ ./ 对象/ 间/ 的/ 双向/ 指针/ 链接/ 是/ 指/ 每个/ 代理/ 对象/ 记录/ 有/ 指向/ 其源/ 对象/ 的/ 指针/ ,/ 每个/ 对象/ (/ 代理/ 对象/ )/ 也/ 存在/ 指向/ 其/ 代理/ 对象/ 的/ 指针/ ,/ 其实质/ 是/ 对象/ 间/ 的/ 代理/ 关系/ 映射/ ,/ 方便/ 由/ 一个/ 对象/ (/ 代理/ 对象/ )/ 找到/ 其源/ 对象/ 及/ 代理/ 对象/ ./ 目前/ ,/ ODDB/ 采用/ 标识符/ (/ OID/ )/ 映射/ 表来/ 记录/ 对象/ 间/ 的/ 代理/ 关系/ 映射/ ,/ 对象/ 间/ 的/ 双向/ 指针/ 链接/ 由/ 系统/ 自动/ 维护/ ,/ 并/ 保存/ 在/ 该/ 标识符/ 映射/ 表中/ ./ 标识符/ 映射/ 表/ 的/ 模式/ 为/ 一个/ 二元关系/ :/ [/ SourceObject/ :/ OID/ ,/ DeputyObject/ :/ OID/ ]/ ,/ 其中/ SourceObject/ 为源/ 对象/ 的/ 对象/ 标识符/ ,/ Depu/ -/ tyObject/ 为/ 代理/ 对象/ 的/ 对象/ 标识符/ ./ 实现/ ODDB/ 路径/ 表达式/ 计算/ 的/ 主要/ 步骤/ 是/ :/ 首先/ 根据/ 路径/ 表达式/ 所/ 依赖/ 的/ 路径/ ,/ 检索/ 满足/ 路径/ 各层/ 所/ 定义/ 谓词/ 的/ 路径/ 实例/ ,/ 再/ 由/ 结果/ 路径/ 实例/ 得到/ 路径/ 上/ 最后/ 一个/ 类/ (/ 代理/ 类/ )/ 的/ 对象/ (/ 代理/ 对象/ )/ ,/ 最后/ 根据/ 路径/ 表达式/ 的/ 目标/ 表达式/ 进行/ 投影/ 计算/ ./ 计算/ 路径/ 表达式/ 的/ 算法/ 主要/ 有/ 两种/ :/ 指针/ 跟踪/ 算法/ 与/ 显式/ 连接/ 算法/ ./ 在/ 指针/ 跟踪/ 算法/ 中/ ,/ 路径/ 第/ 1/ 个类/ (/ 代理/ 类/ )/ C1/ 的/ 一个/ 对象/ (/ 代理/ 对象/ )/ 首先/ 被/ 存取/ ,/ 并/ 检查/ 是否/ 满足/ 该类/ (/ 代理/ 类/ )/ 的/ 谓词/ p1/ ./ 对于/ 匹配/ 的/ 对象/ (/ 代理/ 对象/ )/ O/ ,/ 通过/ 对象/ 间/ 的/ 双向/ 指针/ 链接/ 检索/ 可能/ 的/ 路径/ 实例/ 上/ 的/ 下/ 一个/ 对象/ ,/ 即/ 利用/ 标识符/ 映射/ 表/ 检索/ 路径/ 下/ 一层/ 结点/ 的/ 实例/ ,/ 再/ 判断/ 是否/ 满足/ 相应/ 的/ 谓词/ ./ 这种/ 指针/ 跟踪/ 一直/ 进行/ 到/ 发现/ 已/ 遍历/ 的/ 对象/ 并/ 不/ 属于/ 一个/ 路径/ 实例/ (/ 即/ 路径/ 上/ 某层/ 不/ 存在/ 与/ 上/ 一层/ 实例/ 有/ 代理/ 关系/ 的/ 实例/ )/ 、/ 或/ 在/ 路径/ 实例/ 上/ 有/ 某个/ 谓词/ 为/ 假/ 、/ 或/ 路径/ 实例/ 上/ 最后/ 一个/ 对象/ (/ 代理/ 对象/ )/ 被/ 碰到/ ./ 如果/ 路径/ 实例/ 上/ 最后/ 一个/ 对象/ (/ 代理/ 对象/ )/ 被/ 找到/ ,/ 则/ 通过/ 投影/ 计算/ 得到/ 目标/ 表达式/ 的/ 值/ ,/ 从而/ 完成/ 一次/ 计算/ 流程/ ./ 然后/ 取/ C1/ 中下/ 一个/ 对象/ (/ 代理/ 对象/ )/ 继续/ 上述/ 处理/ 流程/ ,/ 直到/ C1/ 中/ 所有/ 对象/ (/ 代理/ 对象/ )/ 被/ 扫描/ 处理完毕/ 为止/ ./ 指针/ 跟踪/ 算法/ 是/ 一种/ 面向/ 记录/ 的/ 算法/ ./ 在/ 根据/ 双向/ 指针/ 链接/ 进行/ 对象/ 遍历/ 的/ 过程/ 中/ 如果/ 不/ 需要/ 进行/ 谓词/ 判断/ ,/ 则/ 只/ 需/ 检索/ 标识符/ 映射/ 表/ ,/ 否则/ 需要/ 存取/ 对象/ 实例/ 进行/ 谓词/ 计算/ ./ 如果/ 谓词/ 条件/ 包含/ 有/ 虚/ 属性/ ,/ 需/ 通过/ 虚/ 属性/ 的/ 读/ 切换/ 表达式/ 计算/ 其值/ ,/ 这/ 又/ 涉及/ 到/ 嵌套/ 计算/ 其它/ 路径/ 表达式/ ./ 显式/ 连接/ 算法/ 是/ 把/ 路径/ 转换/ 为/ 一个/ 显式/ 连接/ 表达式/ ,/ 通过/ 该/ 表达式/ 计算/ 得到/ 满足/ 所有/ 谓词/ 的/ 路径/ 实例/ ,/ 最后/ 投影/ 计算/ 目标/ 表达式/ ./ 在/ 转换/ 后/ 的/ 显式/ 连接/ 表达式/ 中/ ,/ 如果/ 路径/ 上/ 不/ 存在/ 谓词/ ,/ 那么/ 只/ 需要/ 将/ 路径/ 第一个/ 和/ 最后/ 一个/ 类/ (/ 代理/ 类/ )/ 以及/ 标识符/ 映射/ 表/ 进行/ 连接/ ;/ 如果/ 路径/ 某/ 一层/ 存在/ 谓词/ ,/ 则/ 需/ 将/ 该/ 层/ 所/ 对应/ 的/ 类/ (/ 代理/ 类/ )/ 也/ 加入/ 到/ 连接/ 表达式/ 中/ ./ 对于/ 长度/ 为/ n/ 的/ 路径/ ,/ 标识符/ 映射/ 表需/ 自/ 连接/ n/ 次/ ./ 相对/ 于/ 指针/ 跟踪/ 算法/ ,/ 显式/ 连接/ 算法/ 是/ 面向/ 集合/ 的/ 算法/ ./ 3/ 路径/ 导航/ 索引/ PNI/ 本节/ 介绍/ 一种/ 支持/ 路径/ 表达式/ 高效/ 计算/ 的/ 索引/ 结构/ —/ —/ —/ 路径/ 导航/ 索引/ (/ PathNavigationIndex/ ,/ PNI/ )/ ./ PNI/ 建立/ 在/ 代理/ 层次/ 的/ 路径/ 之上/ ,/ 主要/ 由/ 3/ 部分/ 组成/ :/ Path/ -/ Instance/ -/ Table/ 、/ Identity/ -/ Index/ 和/ Attribute/ -/ Index/ ./ Path/ -/ Instance/ -/ Table/ 用于/ 存储/ 路径/ 实例/ ,/ Identity/ -/ Index/ 与/ Attribute/ -/ Index/ 建立/ 在/ Path/ -/ Instance/ -/ Table/ 之上/ ,/ 用于/ 支持/ 快速/ 的/ 路径/ 实例/ 检索/ ./ PNI/ 减少/ 了/ 路径/ 表达式/ 计算/ 过程/ 中/ 对象/ 遍历/ 以及/ 谓词/ 判断/ 的/ 开销/ ./ 3.1/ PNI/ 索引/ 结构/ Path/ -/ Instance/ -/ Table/ 是/ 一个/ 路径/ 实例/ 表/ ,/ 物化/ 存储/ 了/ 给定/ 路径/ 的/ 所有/ 实例/ ,/ 表/ 的/ 每个/ 元组/ 对应/ 一/ Page6/ 个/ 路径/ 实例/ ./ 简单/ 来说/ ,/ ODDB/ 通过/ 标识符/ 映射/ 表/ 维护/ 对象/ 间/ 的/ 代理/ 关系/ ,/ 在/ 一个/ 代理/ 层次/ 中/ ,/ 给定/ 一个/ 路径/ ,/ 利用/ 对象/ 间/ 的/ 代理/ 关系/ 可以/ 确定/ 其/ 所有/ 的/ 路径/ 实例/ ./ 对于/ 频繁/ 查询/ 的/ 路径/ ,/ 其/ 路径/ 实例/ 可以/ 存储/ 在/ Path/ -/ Instance/ -/ Table/ 中/ ,/ 避免/ 每次/ 计算/ 路径/ 表达式/ 时/ 都/ 需要/ 通过/ 对象/ 遍/ 历来/ 检索/ 路径/ 实例/ ,/ 减少/ 数据库/ 存取/ 开销/ ./ Path/ -/ Instance/ -/ Table/ 不/ 存储/ 完整/ 的/ 对象/ 实例/ ,/ 只/ 保存/ 组成/ 路径/ 实例/ 的/ 所有/ 对象/ (/ 代理/ 对象/ )/ 的/ OID/ ./ 如图/ 3/ 所示/ ,/ 给定/ 一条/ 路径/ P/ =/ C1/ →/ C2/ →/ …/ →/ Cn/ ,/ 其/ 对应/ 的/ Path/ -/ Instance/ -/ Table/ 的/ 模式/ 为/ [/ S1/ :/ OID/ ,/ S2/ :/ OID/ ,/ …/ ,/ Sn/ :/ OID/ ]/ ,/ 即/ 长度/ 为/ n/ -/ 1/ 的/ 路径/ 所/ 对应/ 的/ Path/ -/ Instance/ -/ Table/ 一共/ 有/ n/ 列/ ,/ 每列/ Si/ 的/ 数据类型/ 为/ OID/ ,/ 其/ 取值/ 范围/ 为/ Ci/ 所有/ 实例/ 的/ OID/ 集合/ ,/ 1/ / i/ / n/ ,/ Path/ -/ Instance/ -/ Table/ 的/ 每/ 一行/ 对应/ P/ 的/ 一个/ 路径/ 实例/ ./ Path/ -/ Instance/ -/ Table/ 在/ 设计/ 时/ 主要/ 考虑/ 如下/ :/ (/ 1/ )/ 互为/ 逆/ 路径/ 的/ 两条/ 路径/ ,/ 只/ 存储/ 一个/ Path/ -/ Instance/ -/ Table/ ,/ 以/ 节省/ 存储/ 开销/ ./ 对于/ 任意/ 路径/ P/ 及其/ 逆/ 路径/ P/ ,/ 将/ 组成/ P/ 的/ 每/ 一个/ 路径/ 实例/ 的/ 对象/ 序列/ 进行/ 顺序/ 置换/ ,/ 可以/ 得到/ P/ 的/ 路径/ 实例/ ,/ 反之亦然/ ,/ 因此/ 可以/ 通过/ 将/ P/ 的/ Path/ -/ Instance/ -/ Table/ 进行/ 列/ 置换/ 得到/ P/ 的/ Path/ -/ Instance/ -/ Table/ ./ (/ 2/ )/ Path/ -/ Instance/ -/ Table/ 存储/ 完整/ 的/ 路径/ 实例/ ./ 在/ 计算/ 路径/ 表达式/ 时/ ,/ 需要/ 找到/ 路径/ 实例/ 上/ 最后/ 一个/ 对象/ 实例/ ,/ 并/ 进行/ 投影/ 计算/ ,/ 因此/ Path/ -/ Instance/ -/ Table/ 另/ 一种/ 可能/ 的/ 设计/ 是/ 只/ 存储/ 路径/ 实例/ 上/ 的/ 第一个/ 和/ 最后/ 一个/ 实例/ ./ 但是/ 由于/ 在/ 路径/ 的/ 每/ 一层/ 都/ 可能/ 存在/ 谓词/ ,/ 如果/ 要/ 判断/ 路径/ 实例/ 是否/ 满足/ 谓词/ ,/ 还/ 需要/ 进行/ 一次/ 对象/ 遍历/ 以/ 存取/ 路径/ 实例/ 上/ 相应/ 的/ 对象/ 实例/ ,/ 只/ 存储/ 第一个/ 和/ 最后/ 一个/ 实例/ 的/ Path/ -/ Instance/ -/ Table/ 无法/ 直接/ 支持/ 这样/ 的/ 操作/ ./ 出于/ 此/ 目的/ ,/ Path/ -/ Instance/ -/ Table/ 存储/ 完整/ 的/ 路径/ 实例/ ./ (/ 3/ )/ 支持/ 对象/ 的/ 双向/ 遍历/ ./ 因为/ 对象/ 间/ 的/ 指针/ 链接/ 是/ 双向/ 的/ ,/ 因此/ 对象/ 的/ 遍历/ 也/ 可以/ 是/ 双向/ 的/ ./ 根据/ (/ 1/ )/ 和/ (/ 2/ )/ ,/ 显然/ 可以/ 有效/ 地/ 支持/ 对象/ 间/ 的/ 双向/ 遍历/ ./ Path/ -/ Instance/ -/ Table/ 在/ 实现/ 时/ 是/ 通过/ 一个/ 表来/ 实现/ 的/ ,/ 对于/ 表/ 的/ 每/ 一行/ 而言/ ,/ 其/ 每/ 一/ 属性/ 列所/ 记录/ 的/ OID/ 按照/ 列/ 的/ 顺序/ 组成/ 的/ 一个/ 对象/ 序列/ ,/ 构成/ Path/ -/ Instance/ -/ Table/ 所/ 对应/ 路径/ 的/ 一个/ 路径/ 实例/ ,/ 如图/ 4/ 所示/ ,/ 对于/ 路径/ Music/ →/ Music/ _/ MTV/ →/ MTV/ ,/ 存在/ 一个/ 路径/ 实例/ oMusic/ →/ oMusic/ _/ MTV/ →/ oMTV/ ,/ 该/ 路径/ 在/ Path/ -/ Instance/ -/ Table/ 中有/ 相应/ 的/ 一条/ 记录/ [/ oMusic/ ,/ oMusic/ _/ MTV/ ,/ oMTV/ ]/ ./ Path/ -/ Instance/ -/ Table/ 利用/ OID/ 来/ 记录/ 路径/ 实例/ ,/ 因此/ 常常/ 需要/ 根据/ 一个/ 给定/ 的/ OID/ 来/ 检索/ 相关联/ 的/ 路径/ 实例/ ,/ 为此/ ,/ 在/ Path/ -/ Instance/ -/ Table/ 上/ 建立/ Identity/ -/ Index/ ,/ 以/ 支持/ 快速/ 的/ 路径/ 实例/ 检索/ ./ Identity/ -/ Index/ 具体/ 通过/ 在/ Path/ -/ Instance/ -/ Table/ 的/ 每/ 一列/ 上/ 建立/ 一个/ B/ +/ 树/ 索引/ 来/ 实现/ ,/ 即/ Identity/ -/ Index/ 是/ 一个/ 索引/ 集合/ ,/ 每/ 一个/ 索引/ 是/ Path/ -/ Instance/ -/ Table/ 的/ 一个/ 列/ 索引/ ,/ 以/ OID/ 作为/ 键值/ ./ Identity/ -/ Index/ 索引/ 的/ 叶子/ 结点/ 如图/ 5/ (/ a/ )/ 所示/ ,/ 其中/ addr1/ 与/ addrn/ 是/ 包含/ 有/ 键值/ OID/ 的/ 路径/ 实例/ 在/ Path/ -/ Instance/ -/ Table/ 表中/ 对应/ 元组/ 的/ 物理地址/ ./ 索/ Page7/ 引/ 的/ 非/ 叶子/ 结点/ 如图/ 5/ (/ b/ )/ 所示/ ,/ 其中/ PagePointer/ 是/ 指向/ 索引/ 树中下/ 一层/ 结点/ 的/ 指针/ ./ 虽然/ Path/ -/ Instance/ -/ Table/ 通过/ 物化/ 存储/ 路径/ 实例/ ,/ 支持/ 快速/ 的/ 对象/ 遍历/ ,/ 但/ Path/ -/ Instance/ -/ Table/ 本身/ 无法/ 直接/ 支持/ 谓词/ 判断/ ./ 计算/ 路径/ 表达式/ 时/ ,/ 需要/ 根据/ 路径/ 上/ 声明/ 的/ 谓词/ 过滤/ 不/ 满足条件/ 的/ 路径/ 实例/ ./ 路径/ 上/ 每/ 一层/ 的/ 谓词/ 都/ 是/ 定义/ 在/ 该层/ 对象/ 的/ 属性/ 值上/ 的/ ,/ 为/ 计算/ 路径/ 上/ 某/ 一层/ 的/ 谓词/ ,/ 需要/ 在/ 对象/ 遍历/ 的/ 过程/ 中/ 存取/ 路径/ 实例/ 上/ 该/ 层/ 的/ 对象/ ,/ 从而/ 利用/ 对象/ 的/ 属性/ 值/ 进行/ 条件/ 计算/ ./ 如果/ 在/ 过滤/ 路径/ 实例/ 的/ 过程/ 中/ 总是/ 需要/ 存取/ 路径/ 实例/ 的/ 中间/ 对象/ ,/ 会/ 增大/ 路径/ 表达式/ 计算/ 的/ 开销/ ./ Attribute/ -/ Index/ 就是/ 针对/ 路径/ 实例/ 的/ 条件/ 过滤/ 而/ 设计/ 的/ 属性/ 索引/ ./ 不同于/ 一般/ 类上/ 的/ 属性/ 索引/ 将/ 属性/ 值/ 直接/ 映射/ 到/ 对象/ 本图/ 6Attribute/ -/ Index/ 索引/ 树结构/ 给定/ 一条/ 路径/ P/ ,/ 为/ 其/ 创建/ 的/ Path/ -/ Instance/ -/ Table/ 只有/ 一个/ ./ 而/ 根据/ 路径/ P/ 定义/ 的/ 路径/ 表达式/ 可以/ 有/ 许多/ 个/ ,/ 每个/ 路径/ 表达式/ 在/ 路径/ 上/ 每/ 一层/ 都/ 可能/ 声明/ 各种/ 谓词/ ./ 根据/ 实际/ 路径/ 表达式/ 计算/ 的/ 需要/ ,/ 可以/ 在/ Path/ -/ Instance/ -/ Table/ 上/ 建立/ 不同/ 的/ Attribute/ -/ Index/ 索引/ ,/ 一个/ Attribute/ -/ Index/ 索引/ 可以/ 被/ 一条/ 路径/ 上/ 不同/ 的/ 路径/ 表达式/ 计算/ 时/ 使用/ ./ 3.2/ PNI/ 索引/ 的/ 使用/ 本/ 小节/ 介绍/ 如何/ 使用/ PNI/ 索引/ 进行/ 路径/ 表达式/ 计算/ ./ 在/ 讨论/ 之前/ ,/ 我们/ 假设/ 路径/ 表达式/ 所/ 依赖/ 的/ 路径/ 上/ 建有/ PNI/ 索引/ ./ 由于/ 路径/ 表达式/ 在/ 导航/ 路径/ 的/ 不同/ 的/ 层次/ 上/ 可能/ 定义/ 有/ 谓词/ ,/ 为/ 简化/ 讨论/ ,/ 我们/ 假设/ 每个/ 谓词/ 只有/ 一个/ 谓词/ 属性/ ./ 在/ 路径/ 表达式/ 的/ 各个/ 谓词/ 属性/ 上/ ,/ 可能/ 建有/ Attribute/ -/ Index/ 索引/ ,/ 也/ 可能/ 没有/ ./ 下面/ 我们/ 基于/ 图/ 1/ 给出/ 的/ 代理/ 层次分/ 情况/ 进行/ 讨论/ ./ (/ 1/ )/ 导航/ 路径/ 上不带/ 谓词/ 的/ 路径/ 表达式/ 计算/ 在/ 这种/ 情况/ 下/ ,/ 路径/ 表达式/ 的/ 导航/ 路径/ 不/ 存在/ 任何/ 谓词/ ./ 例如/ 路径/ 表达式/ (/ Music/ →/ Music/ _/ Lyr/ →/ Lyrics/ )/ ./ lyrics/ ,/ 用于/ 从/ Music/ 类/ 的/ 对象/ 出发/ ,/ 查询/ Lyrics/ 类中/ 相关联/ 对象/ 的/ lyrics/ 属性/ 的/ 值/ ,/ 路径/ Music/ →/ Music/ _/ Lyr/ →/ Lyrics/ 不/ 含有/ 任何/ 谓词/ ./ 令/ 路径/ MML/ =/ Music/ →/ Music/ _/ Lyr/ →/ Lyrics/ 上/ 定义/ 的/ PNI/ 索引/ 所/ 包含/ 的/ Path/ -/ Instance/ -/ Table/ 表为/ PITMML/ [/ OIDMusic/ ,/ OIDMusic/ _/ Lyr/ ,/ OIDLyrics/ ]/ ,/ 则/ 计算/ 路身/ ,/ Attribute/ -/ Index/ 是/ 将/ 路径/ 上/ 某个/ 类/ (/ 代理/ 类/ )/ 的/ 对象/ (/ 代理/ 对象/ )/ 的/ 属性/ 值/ 映射/ 到/ 包含/ 该/ 对象/ (/ 代理/ 对象/ )/ 的/ 路径/ 实例/ 信息/ 上/ ./ 具体/ 而言/ ,/ Attribute/ -/ In/ -/ dex/ 索引/ 建立/ 在/ Path/ -/ Instance/ -/ Table/ 之上/ ,/ 采用/ B/ +/ 树结构/ 实现/ ,/ 索引/ 的/ 键值/ 是/ Path/ -/ Instance/ -/ Table/ 对应/ 路径/ 上/ 某个/ 类/ 的/ 属性/ 值/ ,/ Attribute/ -/ Index/ 索引/ 将/ 该类/ 上/ 对象/ 的/ 属性/ 值/ 映射/ 到/ 包含/ 该/ 对象/ 的/ 路径/ 实例/ 所/ 对应/ Path/ -/ Instance/ -/ Table/ 元组/ 的/ 地址/ ./ 图/ 6/ (/ a/ )/ 给出/ 了/ Attribute/ -/ Index/ 索引/ 的/ 叶子/ 结点/ ,/ 其中/ Key/ -/ length/ 是/ 索引/ 属性/ 的/ 长度/ ,/ Key/ -/ value/ 为/ 索引/ 键值/ ,/ addr1/ 与/ addrn/ 是/ 属性/ 值/ 等于/ 索引/ 键值/ 的/ 对象/ 所/ 对应/ Path/ -/ Instance/ -/ Table/ 元组/ 的/ 地址/ ./ Attrib/ -/ ute/ -/ Index/ 索引/ 的/ 非/ 叶子/ 结点/ 如图/ 6/ (/ b/ )/ 所示/ ,/ 其中/ PagePointer/ 是/ 指向/ 索引/ 树中下/ 一层/ 结点/ 的/ 指针/ ./ 径/ 表达式/ (/ Music/ →/ Music/ _/ Lyr/ →/ Lyrics/ )/ ./ lyrics/ 的/ 过程/ 是/ :/ 由/ PITMML/ 投影/ 得到/ MML/ 路径/ 实例/ 中/ 所有/ Lyrics/ 对象/ 的/ OID/ 集合/ ,/ 进一步/ 可以/ 获取/ 对应/ 的/ Lyrics/ 的/ 对象/ 集合/ ,/ 再/ 对/ 该/ 集合/ 中/ 的/ 每个/ Lyrics/ 对象/ 投影/ 计算/ lyrics/ 属性/ 的/ 值/ ./ (/ 2/ )/ 导航/ 路径/ 上/ 只有/ 一个/ 谓词/ 的/ 路径/ 表达式/ 计算/ 在/ 这种/ 情况/ 下/ ,/ 计算/ 路径/ 表达式/ 的/ 过程/ 需要/ 过滤/ 不/ 满足条件/ 的/ 路径/ 实例/ ./ 如果/ 在/ 谓词/ 属性/ 上/ 建有/ Attribute/ -/ Index/ 索引/ ,/ 那么/ 可以/ 直接/ 利用/ 索引/ 扫描/ 获取/ 满足/ 谓词/ 的/ 路径/ 实例/ ;/ 否则/ ,/ 需要/ 获取/ 路径/ 实例/ 上/ 的/ 中间/ 对象/ 以/ 判断/ 谓词/ ./ 例如/ 路径/ 表达式/ (/ Music/ {/ title/ =/ ‘/ foo/ ’/ }/ →/ Music/ _/ Lyr/ →/ Lyrics/ )/ ./ lyrics/ ,/ 其/ PNI/ 索引/ 的/ Path/ -/ Instance/ -/ Table/ 与/ 情况/ (/ 1/ )/ 中/ 定义/ 相同/ ./ 假设/ 在/ Music/ ./ title/ 上/ 建有/ Attribute/ -/ Index/ 索引/ ,/ 那么/ 计算/ 该/ 路径/ 表达式/ 时/ ,/ 首先/ 根据/ Music/ ./ title/ 上/ 的/ Attribute/ -/ Index/ 索引/ 检索/ PITMML/ 中/ 所有/ 满足/ 谓词/ “/ title/ =/ ‘/ foo/ ’/ ”/ 的/ 元组/ 集合/ S1/ ,/ 再/ 根据/ Lyrics/ 对象/ 的/ OID/ 将/ Lyrics/ 与/ S1/ 进行/ 等值/ 连接/ 操作/ ,/ 得到/ 所需/ Lyrics/ 对象/ 的/ 集合/ S2/ ,/ 最后/ 再/ 对/ S2/ 中/ 的/ 每个/ 对象/ 投影/ 计算/ lyrics/ 属性/ 的/ 值/ ./ 如果/ 在/ Music/ ./ title/ 上/ 不/ 存在/ Attribute/ -/ Index/ 索引/ ,/ 则/ 需要/ 通过/ 扫描/ Music/ 类/ 找到/ 所有/ title/ 属性/ 值为/ “/ foo/ ”/ 的/ 对象/ 集合/ S0/ ,/ 再/ 根据/ OID/ 将/ S0/ 与/ PITMML/ 进行/ 等值/ 连接/ 操作/ ,/ 得到/ PITMML/ 的/ 元组/ 集合/ S1/ ,/ 后续/ 操作/ 与/ 上/ 一种/ 情况/ 一样/ ./ Page8/ (/ 3/ )/ 导航/ 路径/ 上/ 有/ 多个/ 谓词/ 的/ 路径/ 表达式/ 计算/ 在/ 这种/ 情况/ 下/ ,/ 计算/ 路径/ 表达式/ 时/ 需要/ 多次/ 进行/ 谓词/ 计算/ ,/ 以/ 过滤/ 不/ 满足条件/ 的/ 路径/ 实例/ ./ 对于/ 路径/ 表达式/ PE/ =/ (/ C1/ {/ p1/ }/ →/ C2/ {/ p2/ }/ →/ …/ →/ Cn/ {/ pn/ }/ )/ ./ expr/ ,/ 假设/ 在/ 路径/ C1/ →/ C2/ →/ …/ →/ Cn/ 上/ 建有/ PNI/ 索引/ ,/ 且/ PNI/ 索引/ 包含/ 在/ 部分/ 谓词/ 的/ 谓词/ 属性/ 上/ 创建/ 的/ Attribute/ -/ Index/ 索引/ ,/ 那么/ 对于/ 每个/ 谓词/ 属性/ 上/ 建有/ Attribute/ -/ Index/ 索引/ 的/ 谓词/ ,/ 可以/ 利用/ Attrib/ -/ ute/ -/ Index/ 索引/ 扫描/ 得到/ 的/ 一个/ 满足/ 该/ 谓词/ 的/ Path/ -/ Instance/ -/ Table/ 结果/ 集合/ ,/ 而/ 对于/ 每个/ 不能/ 利用/ Attribute/ -/ Index/ 索引/ 的/ 谓词/ ,/ 则/ 需要/ 通过/ 扫描/ 谓词/ 所在/ 类/ 的/ 实例/ ,/ 再/ 与/ Path/ -/ Instance/ -/ Table/ 进行/ 连接/ 操作/ 得到/ 一个/ 满足/ 该/ 谓词/ 的/ Path/ -/ Instance/ -/ Table/ 结果/ 集合/ ./ 最后/ 通过/ 将/ 这些/ Path/ -/ Instance/ -/ Table/ 结果/ 集合/ 求/ 交集/ ,/ 得到/ 满足/ 所有/ 条件/ 的/ 路径/ 实例/ ./ 例如/ 路径/ 表达式/ (/ Music/ {/ title/ =/ ‘/ foo/ ’/ }/ →/ Music/ _/ Lyr/ →/ Lyrics/ {/ lyrics/ =/ ‘/ loo/ ’/ }/ )/ ./ artist/ ,/ 其/ PNI/ 索引/ 的/ Path/ -/ Instance/ -/ Table/ 与/ (/ 1/ )/ 中/ 定义/ 相同/ ,/ 假设/ 在/ Music/ ./ title/ 上/ 建有/ Attribute/ -/ Index/ 索引/ ,/ 而/ 在/ Lyrics/ ./ lyrics/ 上/ 并/ 没有/ Attribute/ -/ Index/ 索引/ ,/ 那么/ 计算/ 该/ 路径/ 表达式/ 的/ 过程/ 为/ :/ 首先/ 根据/ Music/ ./ title/ 上/ 的/ Attribute/ -/ Index/ 索引/ 检索/ PITMML/ ,/ 得到/ 所有/ 满足/ 谓词/ “/ title/ =/ ‘/ foo/ ’/ ”/ 的/ 结果/ 集合/ S0/ ;/ 其次/ 通过/ 扫描/ Lyrics/ 类/ 找到/ 所有/ lyrics/ 属性/ 值为/ “/ loo/ ”/ 的/ 对象/ 集合/ S1/ ,/ 再/ 根据/ OID/ 将/ S1/ 与/ PITMML/ 进行/ 等值/ 连接/ 操作/ ,/ 得到/ PITMML/ 的/ 结果/ 集合/ S2/ ;/ 再求/ S0/ 与/ S2/ 的/ 交集/ 得到/ 集合/ S3/ ;/ 再/ 根据/ Lyrics/ 对象/ 的/ OID/ 将/ Lyrics/ 与/ S3/ 进行/ 等值/ 连接/ 操作/ ,/ 得到/ 所需/ Lyrics/ 对象/ 的/ 集合/ S4/ ,/ 最后/ 再/ 对/ S4/ 中/ 的/ 每个/ 对象/ 投影/ 计算/ lyrics/ 属性/ 的/ 值/ ./ 3.3/ PNI/ 索引/ 的/ 维护/ 数据库/ 的/ 各种/ 变化/ 会/ 影响/ 到/ PNI/ 索引/ ,/ 本/ 节/ 主要/ 讨论/ PNI/ 索引/ 的/ 维护/ 问题/ ./ 在/ 数据库/ 中/ ,/ 类/ 与/ 代理/ 类/ 的/ 创建/ 和/ 删除/ ,/ 会/ 导致/ 代理/ 层次/ 发生变化/ ,/ 尤其/ 是/ 删除/ 类/ 或/ 代理/ 类时/ ,/ 会/ 导致/ 路径/ 失效/ ./ 如果/ 一个/ 路径/ 上/ 某个/ 类/ 或/ 代理/ 类/ 被/ 删除/ ,/ 那么/ 在/ 该/ 路径/ 上/ 所/ 创建/ 的/ PNI/ 索引/ 需要/ 被/ 删除/ ./ 另外/ ,/ 由于/ 对象/ 与/ 代理/ 对象/ 的/ 新增/ 、/ 删除/ 和/ 更新/ 等/ 操作/ ,/ 会/ 导致/ 路径/ 实例/ 发生变化/ 进而/ 影响/ PNI/ 索引/ ./ 下面/ 以/ 数据/ 更新/ 操作/ (/ UPDATE/ )/ 为例/ ,/ 讨论/ PNI/ 索引/ 的/ 维护/ ./ 在/ 对象/ 代理/ 数据库/ 中/ ,/ 数据/ 更新/ 操作/ 分为/ 两大/ 步骤/ :/ 一是/ 更新/ 数据/ 属性/ 值/ ,/ 二是/ 对象/ 更新/ 迁移/ ./ 在/ 对象/ 更新/ 迁移/ 过程/ 中/ ,/ 可能/ 导致/ 新/ 代理/ 对象/ 的/ 派生/ 或/ 已有/ 代理/ 对象/ 的/ 删除/ ,/ 其本质/ 是/ 新增/ 或/ 删除/ 对象/ (/ 代理/ 对象/ )/ 间/ 的/ 代理/ 关系/ ./ 数据/ 更新/ 操作/ 导致/ PNI/ 索引/ 的/ 更新/ 主要/ 分/ 以下/ 两种/ 情况/ 考虑/ :/ (/ 1/ )/ 只有/ 数据/ 属性/ 值/ 发生变化/ ;/ (/ 2/ )/ 数据/ 属性/ 值/ 发生变化/ ,/ 而且/ 引起/ 对象/ 更新/ 迁移/ ./ (/ 1/ )/ 只有/ 数据/ 属性/ 值/ 发生变化/ 的/ 情况/ 在/ 这种/ 情况/ 下/ ,/ 由于/ 没有/ 发生/ 对象/ 更新/ 迁移/ ,/ 对象/ (/ 代理/ 对象/ )/ 间/ 的/ 所有/ 代理/ 关系/ 并/ 没有/ 发生变化/ ,/ 路径/ 实例/ 所/ 赖以/ 存在/ 的/ 对象/ 间/ 双向/ 指针/ 链接/ 并/ 没有/ 失效/ ,/ 因此/ 数据/ 更新/ 操作/ 不/ 影响/ 路径/ 实例/ ,/ PNI/ 索引/ 的/ Path/ -/ Instance/ -/ Table/ 和/ Identity/ -/ Index/ 都/ 不/ 需要/ 进行/ 更新/ ,/ 可能/ 被/ 影响/ 的/ 只有/ Attribute/ -/ Index/ 索引/ ./ 如果/ PNI/ 索引/ 的/ 任一/ Attribute/ -/ Index/ 不是/ 建立/ 在/ 被/ 更新/ 属性/ 上/ ,/ 那么/ 数据/ 更新/ 操作/ 并/ 不/ 影响/ PNI/ 索引/ ./ 否则/ ,/ 相应/ 的/ Attribute/ -/ Index/ 索引/ 需要/ 被/ 更新/ ./ 假设/ 在/ 路径/ P/ =/ C1/ →/ C2/ …/ →/ Cn/ 上/ 建有/ PNI/ 索引/ ,/ 而且/ 对于/ 路径/ 上/ 的/ 类/ (/ 代理/ 类/ )/ Ci/ (/ 1/ / i/ / n/ )/ 的/ 属性/ w/ 建有/ Attribute/ -/ Index/ 索引/ ./ 当/ 更新/ Ci/ 的/ 一个/ 对象/ (/ 代理/ 对象/ )/ q/ 的/ 属性/ w/ 时/ ,/ 令/ 包含/ q/ 的/ 路径/ 实例/ 所/ 对应/ 的/ Path/ -/ Instance/ -/ Table/ 表/ 元组/ 的/ 物理地址/ 为/ addr/ ,/ 对/ Attribute/ -/ Index/ 索引/ 的/ 更新/ 包括/ 两个/ 步骤/ :/ 首先/ 扫描/ Attribute/ -/ Index/ 索引/ ,/ 从/ 对应/ w/ 的/ 旧/ 属性/ 值/ 的/ 叶子/ 结点/ 中/ 删除/ addr/ ;/ 再次/ 扫描/ Attribute/ -/ Index/ 索引/ ,/ 将/ addr/ 插入/ 到/ w/ 的/ 新/ 属性/ 值/ 所/ 对应/ 的/ 叶子/ 结点/ 中/ ./ (/ 2/ )/ 数据/ 属性/ 值/ 发生变化/ 并/ 引起/ 对象/ 更新/ 迁移/ 的/ 情况/ 对于/ 这种/ 情况/ ,/ 除了/ 数据/ 的/ 属性/ 值/ 被/ 更新/ ,/ 还/ 发生/ 了/ 对象/ 更新/ 迁移/ ./ PNI/ 索引/ 的/ 更新/ 主要/ 分为/ 两个/ 过程/ ,/ 一是/ 伴随/ 数据/ 属性/ 值/ 更新过程/ 的/ PNI/ 索引/ 更新/ ,/ 一是/ 伴随/ 对象/ 更新/ 迁移/ 过程/ 的/ PNI/ 索引/ 更新/ ./ 对于/ 伴随/ 数据/ 属性/ 值/ 更新过程/ 的/ PNI/ 索引/ 更新/ 与/ 情况/ (/ 1/ )/ 相同/ ,/ 下面/ 主要/ 考虑/ 对象/ 更新/ 迁移/ 过程/ 的/ PNI/ 索引/ 更新/ ./ 对象/ 更新/ 迁移/ 过程/ 涉及/ 到/ 新增/ 代理/ 对象/ 或/ 删除/ 已有/ 代理/ 对象/ ,/ 从而/ 导致/ 新增/ 或/ 删除/ 对象/ (/ 代理/ 对象/ )/ 间/ 的/ 代理/ 关系/ ,/ 进一步/ 引起/ 新增/ 路径/ 实例/ 或/ 已有/ 路径/ 实例/ 失效/ ,/ 其/ 对/ PNI/ 索引/ 的/ 影响/ 主要/ 是/ 由于/ 路径/ 实例/ 的/ 变更/ 所/ 造成/ 的/ ,/ 因此/ 我们/ 只/ 需/ 考虑/ 对象/ 更新/ 迁移/ 过程/ 中/ 造成/ 路径/ 实例/ 变更/ 的/ 两个/ 基本操作/ :/ ins/ _/ bipointer/ (/ os/ ,/ od/ )/ 与/ del/ _/ bipointer/ (/ os/ ,/ od/ )/ ./ 令/ os/ 是/ 类/ (/ 代理/ 类/ )/ Cs/ 的/ 实例/ ,/ od/ 是/ 代理/ 类/ Cd/ 的/ 实例/ ,/ Cd/ 是/ Cs/ 的/ 一个/ 代理/ 类/ ,/ 且/ od/ 是/ os/ 的/ 一个/ 代理/ 对象/ ,/ ins/ _/ bipointer/ (/ os/ ,/ od/ )/ 表示/ 新增/ os/ 与/ od/ 间/ 的/ 直接/ 代理/ 关系/ ,/ 即/ 新增/ 两/ 对象/ 间/ 的/ 双向/ 指针/ 链接/ ;/ del/ _/ bipointer/ (/ os/ ,/ od/ )/ 表示/ 删除/ os/ 与/ od/ 间/ 的/ 直接/ 代理/ Page9/ 关系/ ,/ 即/ 删除/ 两/ 对象/ 间/ 的/ 双向/ 指针/ 链接/ ./ 不失/ 一般性/ ,/ 考虑/ 路径/ P/ =/ C1/ →/ …/ →/ Ci/ →/ Ci/ +/ 1/ →/ …/ →/ Cn/ ,/ 假设/ Ci/ +/ 1/ 是/ Ci/ 的/ 代理/ 类/ ,/ oi/ 是/ 类/ (/ 代理/ 类/ )/ Ci/ 的/ 实例/ ,/ oi/ +/ 1/ 是/ 代理/ 类/ Ci/ +/ 1/ 的/ 实例/ ./ ins/ _/ bipointer/ (/ oi/ ,/ oi/ +/ 1/ )/ 操作/ 引起/ 的/ PNI/ 索引/ 更新/ 的/ 过程/ 为/ :/ (/ 1/ )/ 从/ oi/ 出发/ ,/ 根据/ 路径/ P1/ =/ C1/ →/ C2/ →/ …/ →/ Ci/ 逆向/ 遍历/ 对象/ 双向/ 指针/ 链/ ,/ 确定/ 含有/ oi/ 的/ P1/ 的/ 路径/ 实例/ 集合/ PPI/ ./ new/ ;/ (/ 2/ )/ 从/ oi/ +/ 1/ 出发/ ,/ 根据/ 路径/ P2/ =/ Ci/ +/ 1/ →/ …/ →/ Cn/ 前向/ 遍历/ 对象/ 双向/ 指针/ 链/ ,/ 确定/ 含有/ oi/ +/ 1/ 的/ P2/ 的/ 路径/ 实例/ 集合/ SPI/ ./ new/ ;/ (/ 3/ )/ 逐一/ 取出/ PPI/ ./ new/ 中/ 的/ 每/ 一个/ 路径/ 实例/ ppi/ ,/ 将/ 其/ 与/ SPI/ ./ new/ 中/ 任一/ 路径/ 实例/ spi/ 进行/ 连接/ ,/ 即/ ppi/ →/ spi/ ,/ 构成/ 路径/ P/ 的/ 新/ 的/ 路径/ 实例/ 集合/ PI/ ./ new/ ;/ (/ 4/ )/ 逐一/ 取出/ PI/ ./ new/ 的/ 每/ 一个/ 路径/ 实例/ pi/ ,/ 构造/ 相应/ 的/ 一条/ 元组/ 添加/ 到/ Path/ -/ Instance/ -/ Table/ ,/ 同时/ 更新/ Identity/ -/ Index/ 与/ Attribute/ -/ Index/ ./ 令/ 新增/ 的/ 每/ 一个/ 路径/ 实例/ pi/ 所/ 对应/ 的/ Path/ -/ Instance/ -/ Table/ 元组/ 的/ 物理地址/ 为/ newaddr/ ./ 对/ Identity/ -/ Index/ 的/ 更新/ 主要/ 是/ 根据/ Path/ -/ Instance/ -/ Table/ 元组/ 对应/ 列/ 的/ OID/ 值/ ,/ 扫描/ 该/ Identity/ -/ Index/ ,/ 将/ newaddr/ 添加/ 到/ 与/ 该/ OID/ 相对/ 应/ 的/ 叶子/ 结点/ 中/ ./ 对于/ PNI/ 中/ 建立/ 在/ Ck/ (/ 1/ / k/ / n/ )/ 的/ 属性/ w/ 上/ 的/ Attribute/ -/ Index/ 索引/ ,/ 找到/ pi/ 中/ 属于/ Ck/ 的/ 对象/ 实例/ ,/ 进一步/ 获取/ 属性/ w/ 的/ 值/ ,/ 再/ 通过/ 扫描/ Attribute/ -/ Index/ 索引/ ,/ 将/ newaddr/ 添加/ 到/ 与/ 属性/ w/ 的/ 值/ 相对/ 应/ 的/ 叶子/ 结点/ 中/ ./ del/ _/ bipointer/ (/ oi/ ,/ oi/ +/ 1/ )/ 操作/ 所/ 引起/ 的/ PNI/ 索引/ 更新过程/ 为/ :/ (/ 1/ )/ 根据/ oi/ 扫描/ 相应/ 的/ Identity/ -/ Index/ ,/ 得到/ Path/ -/ Instance/ -/ Table/ 的/ 一个/ 元组/ 集合/ PI1/ ;/ (/ 2/ )/ 根据/ oi/ +/ 1/ 扫描/ 相应/ 的/ Identity/ -/ Index/ ,/ 得到/ 一个/ 表/ 1/ 测试数据/ 集/ 数据/ 集/ DS150050005000500010001000500050001000DS210001000010000100002000200010000100002000DS320002000020000200004000400020000200004000DS430003000030000300006000600030000300006000DS550005000050000500001000010000500005000010000DS680008000080000800001600016000800008000016000/ 目前/ 对象/ 代理/ 数据库系统/ TOTEM/ 中/ ,/ 路径/ 表达式/ 计算/ 采用/ 的/ 是/ 2.3/ 节/ 所述/ 的/ 指针/ 跟踪/ (/ PT/ )/ 方法/ ./ 实验/ 将/ 对/ PNI/ 索引/ 方法/ 与/ PT/ 方法/ 进行/ 性能/ 比较/ ./ 另外/ ,/ OODB/ 领域/ 提出/ 了/ 多种/ 索引/ 结构/ ,/ 如/ MultipleJoin/ ,/ NestedIndex/ 和/ PathIndex/ 等/ ,/ 用于/ 支持/ 高效/ 的/ 对象/ 遍历/ ,/ 提高/ OODB/ 中/ 路径/ 表达式/ 计算/ 的/ 效率/ ./ 虽然/ 这些/ 方法/ 不能/ 直接/ 应用/ 于/ ODDB/ 路径/ 表达式/ 计算/ ,/ 但/ 这些/ 索引/ 的/ 设计/ 思想/ 值得/ 借鉴/ ./ 因/ Path/ -/ Instance/ -/ Table/ 的/ 元组/ 集合/ PI2/ ;/ (/ 3/ )/ 求/ PI1/ 与/ PI2/ 的/ 交集/ PI/ ;/ (/ 4/ )/ 从/ Path/ -/ Instance/ -/ Table/ 中/ 逐一/ 删除/ PI/ 的/ 每/ 一个/ 元组/ pit/ ,/ 同时/ 更新/ Identity/ -/ Index/ 与/ Attribute/ -/ Index/ ./ 令所/ 删除/ 的/ 每/ 一个/ 元组/ pit/ 的/ 物理地址/ 为/ oldaddr/ ./ 对/ Identity/ -/ Index/ 的/ 更新/ 主要/ 是/ 根据/ pit/ 对应/ 列/ 的/ OID/ 值/ ,/ 扫描/ 该/ Identity/ -/ Index/ ,/ 将/ oldaddr/ 从/ 与/ 该/ OID/ 相对/ 应/ 的/ 叶子/ 结点/ 中/ 删除/ ./ 对于/ PNI/ 中/ 建立/ 在/ Ck/ (/ 1/ / k/ / n/ )/ 的/ 属性/ w/ 上/ 的/ Attribute/ -/ Index/ 索引/ ,/ 找到/ pit/ 中/ 在/ 相应/ 列所/ 记录/ 的/ Ck/ 实例/ 的/ OID/ ,/ 根据/ 该/ OID/ 得到/ 具体/ 的/ Ck/ 实例/ ,/ 进一步/ 获取/ 属性/ w/ 的/ 值/ ,/ 再/ 通过/ 扫描/ Attrib/ -/ ute/ -/ Index/ 索引/ ,/ 将/ oldaddr/ 从/ 与/ 属性/ w/ 的/ 值/ 相对/ 应/ 的/ 叶子/ 结点/ 中/ 删除/ ./ 4/ 实验/ 本文/ 提出/ 的/ PNI/ 索引/ 已/ 在/ 对象/ 代理/ 数据库/ 中/ 实现/ ./ 我们/ 通过/ 实验/ 来/ 分析/ 各种/ 影响/ 路径/ 表达式/ 计算/ 的/ 因素/ ,/ 验证/ PNI/ 索引/ 方法/ 的/ 有效性/ ,/ 并/ 将/ 该/ 方法/ 与/ 多种不同/ 方法/ 进行/ 性能/ 比较/ ./ 所有/ 实验/ 都/ 是/ 在/ 对象/ 代理/ 数据库系统/ TOTEM/ 中/ 完成/ ./ 4.1/ 实验/ 环境/ 实验/ 使用/ 的/ 测试环境/ 是/ 一台/ PC机/ ,/ 其/ 配置/ 如下/ :/ IntelCeleron2/ ./ 0GHzCPU/ ,/ 2GB/ 内存容量/ ,/ 200GB/ 硬盘/ ,/ Ubuntu9/ ./ 10/ 操作系统/ ,/ TOTEM2/ ./ 0/ 数据库系统/ ./ 实验/ 采用/ 的/ 测试/ 数据库/ 是/ 一个/ 音乐/ 数据库/ ,/ 数据库/ 模式/ 如图/ 1/ 所示/ ./ 实验/ 使用/ 不同/ 规模/ 的/ 测试数据/ 集/ ,/ 每个/ 数据/ 集中/ 各个/ 类/ (/ 代理/ 类/ )/ 所/ 包含/ 的/ 对象/ (/ 代理/ 对象/ )/ 数量/ 如表/ 1/ 所示/ ./ 类/ (/ 代理/ 类/ )/ 此/ 我们/ 根据/ MultipleJoin/ ,/ NestedIndex/ 与/ PathIndex/ 等/ 3/ 种/ 索引/ 的/ 核心思想/ ,/ 设计/ 了/ 另外/ 3/ 种/ 可以/ 用于/ 支持/ ODDB/ 路径/ 表达式/ 计算/ 的/ 辅助/ 结构/ ,/ 分别/ 是/ MJ/ -/ Index/ 、/ N/ -/ Index/ 以及/ P/ -/ Index/ ,/ 用于/ 减少/ 路径/ 表达式/ 计算/ 过程/ 中/ 对象/ 遍历/ 的/ 开销/ ./ MJ/ -/ Index/ 为/ 路径/ 的/ 每/ 条边/ 建立/ 一个/ 辅助/ 表/ ,/ 存储/ 路径/ 实例/ 上/ 前后/ 两个/ 对象/ 实例/ 间/ 的/ 代理/ 联系/ ./ N/ -/ Index/ 是/ 一个/ 只/ 存储/ 路径/ 实例/ 上/ 第一个/ 和/ 最后/ 一个/ 对象/ 实例/ 间/ 映射/ 关/ Page10/ 系/ 的/ 辅助/ 表/ ./ P/ -/ Index/ 是/ 一个/ 物化/ 存储/ 完整/ 路径/ 实例/ 的/ 辅助/ 表/ ,/ 其/ 结构/ 与/ Path/ -/ Instance/ -/ Table/ 相同/ ./ 以上/ 3/ 种/ 辅助/ 结构/ 都/ 只/ 记录/ 对象/ 实例/ 的/ OID/ ,/ 并/ 不/ 存储/ 实际/ 完整/ 的/ 对象/ 实例/ ./ 利用/ MJ/ -/ Index/ 、/ N/ -/ Index/ 与/ P/ -/ Index/ ,/ 我们/ 实现/ 了/ 3/ 种/ 计算/ 路径/ 表达式/ 的/ 方法/ ./ 其中/ ,/ N/ -/ Index/ 方法/ 只/ 适用/ 于/ 不带/ 谓词/ 的/ 路径/ 表达式/ 计算/ ./ MJ/ -/ Index/ 与/ P/ -/ Index/ 可/ 用于/ 各种/ 情况/ 的/ 路径/ 表达式/ 计算/ ,/ 不过/ 这/ 两个/ 方法/ 在/ 计算/ 带/ 谓词/ 的/ 路径/ 表达式/ 时/ ,/ 需要/ 获取/ 路径/ 实例/ 的/ 中间/ 对象/ 实例/ 进行/ 谓词/ 计算/ ,/ 以/ 过滤/ 不/ 满足条件/ 的/ 路径/ 实例/ ./ 采用/ N/ -/ Index/ 计算/ 不带/ 谓词/ 的/ 路径/ 表达式/ 时/ ,/ 只/ 需/ 扫描/ N/ -/ Index/ 一次/ 就/ 能/ 获得/ 路径/ 实例/ 上/ 最后/ 一个/ 对象/ 实例/ ,/ 进一步/ 投影/ 计算/ 目标/ 表达式/ 的/ 值/ ./ MJ/ -/ Index/ 方法/ 计算/ 不带/ 谓词/ 的/ 路径/ 表达式/ 时/ ,/ 需要/ 将/ 路径/ 上/ 每/ 条边/ 的/ MJ/ -/ Index/ 进行/ 连接/ ,/ 从而/ 得到/ 完整/ 的/ 路径/ 实例/ ,/ 再/ 由/ 路径/ 实例/ 上/ 最后/ 一个/ 对象/ 实例/ 投影/ 计算/ 目标/ 表达式/ ./ MJ/ -/ Index/ 方法/ 计算/ 带/ 谓词/ 的/ 路径/ 表达式/ ,/ 需要/ 首先/ 扫描/ 定义/ 有/ 谓词/ 的/ 类/ (/ 代理/ 类/ )/ ,/ 得到/ 满足条件/ 的/ 该类/ (/ 代理/ 类/ )/ 的/ 实例/ 集合/ ,/ 再/ 将/ 该/ 实例/ 集合/ 与/ 路径/ 上/ 每/ 条边/ 的/ MJ/ -/ Index/ 进行/ 连接/ ,/ 从而/ 得到/ 满足条件/ 的/ 路径/ 实例/ ,/ 进一步/ 再/ 由/ 实例/ 上/ 最后/ 一个/ 对象/ 实例/ 投影/ 计算/ 目标/ 表达式/ ./ P/ -/ Index/ 方法/ 计算/ 不带/ 谓词/ 的/ 路径/ 表达式/ 时/ ,/ 通过/ 扫描/ P/ -/ Index/ 可/ 获取/ 路径/ 实例/ 上/ 最后/ 一个/ 对象/ 实例/ ,/ 从而/ 计算/ 目标/ 表达式/ 的/ 值/ ./ 当/ 计算/ 带/ 谓词/ 的/ 路径/ 表达式/ 时/ ,/ 与/ MJ/ -/ Index/ 方法/ 相似/ ,/ 同样/ 需要/ 先/ 扫描/ 定义/ 有/ 谓词/ 的/ 类/ (/ 代理/ 类/ )/ ,/ 得到/ 满足条件/ 的/ 该类/ (/ 代理/ 类/ )/ 的/ 实例/ 集合/ ,/ 再/ 将/ 该/ 实例/ 集合/ 与/ P/ -/ Index/ 进行/ 连接/ ,/ 从而/ 得到/ 满足条件/ 的/ 路径/ 实例/ ,/ 再/ 由/ 路径/ 实例/ 上/ 最后/ 一个/ 对象/ 实例/ 投影/ 计算/ 目标/ 表达式/ ./ 图/ 7/ 路径/ 长度/ 对/ 路径/ 表达式/ 计算/ 的/ 影响/ 4.2/ ./ 2/ 虚/ 属性/ 对/ 路径/ 表达式/ 计算/ 的/ 影响/ 在/ 不/ 考虑/ 带/ 谓词/ 条件/ 的/ 情况/ 下/ ,/ 第/ 2/ 组/ 实验/ 研究/ 虚/ 属性/ 对/ 路径/ 表达式/ 计算/ 的/ 影响/ ./ 虚/ 属性/ 可能/ 作在/ 上述/ 工作/ 基础/ 上/ ,/ 根据/ 以下/ 实验/ 将/ PNI/ 方法/ 与/ PT/ 、/ MJ/ -/ Index/ 、/ N/ -/ Index/ 和/ P/ -/ Index/ 等/ 方法/ 进行/ 比较/ 分析/ ./ 4.2/ 实验/ 结果/ 与/ 分析/ 4.2/ ./ 1/ 路径/ 长度/ 对/ 路径/ 表达式/ 计算/ 的/ 影响/ 第/ 1/ 组/ 实验/ 研究/ 路径/ 长度/ 对/ 不同/ 路径/ 表达式/ 计算方法/ 的/ 影响/ ,/ 在/ 不/ 考虑/ 带/ 谓词/ 条件/ 与/ 虚/ 属性/ 的/ 情况/ 下/ ,/ 分别/ 以/ 路径/ 长度/ 为/ 3/ 和/ 6/ 的/ 路径/ 表达式/ 作为/ 测试/ 例子/ ,/ 提交/ 到/ 不同/ 数据/ 集中/ 进行/ 计算/ ,/ 得到/ 不同/ 数据/ 规模/ 下/ 各个/ 方法/ 的/ 执行/ 时间/ ./ 从图/ 7/ 可以/ 看出/ ,/ 在/ 路径/ 长度/ 一定/ 的/ 情况/ 下/ ,/ 每种/ 方法/ 计算/ 路径/ 表达式/ 的/ 时间/ 随着/ 数据/ 规模/ 的/ 增长/ 而/ 增加/ ./ 对比/ 图/ 7/ (/ a/ )/ 与/ 图/ 7/ (/ b/ )/ ,/ 在/ 相同/ 数据/ 规模/ 的/ 数据/ 集中/ ,/ 每种/ 方法/ 针对/ 路径/ 较长/ 的/ 路径/ 表达式/ 的/ 计算/ 时间/ ,/ 都/ 比/ 路径/ 较/ 短/ 的/ 路径/ 表达式/ 计算/ 的/ 时间/ 要长/ ,/ 即/ 路径/ 表达式/ 计算/ 的/ 时间/ 随着/ 路径/ 长度/ 的/ 增加/ 而/ 增加/ ./ 从/ 实验/ 的/ 结果/ 可以/ 看到/ ,/ 在/ 不/ 考虑/ 带/ 谓词/ 条件/ 的/ 情况/ 下/ ,/ 在/ 各种/ 数据/ 规模/ 的/ 数据/ 集中/ ,/ 不论是/ 短/ 路径/ 或长/ 路径/ 的/ 路径/ 表达式/ ,/ PT/ 方法/ 的/ 计算/ 效率/ 是/ 最差/ 的/ ,/ 这/ 是因为/ PT/ 方法/ 以/ 一种/ 面向/ 记录/ 的/ 方式/ ,/ 每次/ 计算/ 一个/ 结果/ ,/ 在/ 计算/ 过程/ 中/ 需要/ 不断/ 地/ 进行/ 对象/ 遍历/ ,/ 大量/ 的/ 对象/ 遍历/ 操作/ 导致/ 总/ 的/ 计算/ 代价/ 较大/ ./ MJ/ -/ Index/ 方法/ 对于/ 短/ 路径/ 的/ 路径/ 表达式/ 计算/ 较/ 有效/ ,/ 而/ 对于/ 长/ 路径/ 的/ 路径/ 表达式/ 计算/ ,/ 其/ 性能/ 较差/ ,/ 其/ 原因/ 是/ MJ/ -/ Index/ 方法/ 需要/ 将/ 多个/ MJ/ -/ Index/ 辅助/ 表/ 进行/ 连接/ ,/ 路径/ 越长/ ,/ 所/ 需/ 连接/ 操作/ 越/ 多/ ,/ 代价/ 越大/ ./ PNI/ 方法/ 与/ P/ -/ Index/ 方法/ 性能/ 相当/ ,/ 这/ 是因为/ 两种/ 方法/ 都/ 将/ 路径/ 实例/ 进行/ 了/ 物化/ 存储/ ./ 这/ 两种/ 方法/ 比/ N/ -/ Index/ 方法/ 效率/ 差/ ,/ 这/ 是因为/ N/ -/ Index/ 只/ 存储/ 路径/ 实例/ 上/ 首尾/ 两个/ 对象/ 实例/ ,/ 扫描/ 辅助/ 设施/ 的/ 代价/ 最小/ ,/ 因此/ 效率/ 在/ 大多数/ 情况/ 下较/ 高/ ./ 为/ 谓词/ 属性/ 在/ 路径/ 表达式/ 中/ 出现/ ,/ 也/ 可能/ 是/ 路径/ 表达式/ 的/ 目标/ 表达式/ 中/ 的/ 属性/ ./ 本组/ 实验/ 以/ 目标/ 表达式/ 是/ 虚/ 属性/ 的/ 情况/ 为例/ ,/ 分别/ 以/ 长度/ 为/ 3/ 和/ 6/ 的/ 路/ Page11/ 径/ 表达式/ 作为/ 测试/ 例子/ ,/ 在/ 不同/ 数据/ 集中/ 提交/ 给/ 不同/ 的/ 方法/ 进行/ 计算/ ./ 本组/ 实验/ 的/ 测试/ 例子/ ,/ 与/ 第/ 1/ 组/ 实验/ 的/ 用例/ 在/ 路径/ 表达式/ 的/ 导航/ 路径/ 部分/ 完全/ 一样/ ,/ 区别/ 只/ 在于/ 第/ 1/ 组/ 实验/ 用例/ 的/ 目标/ 表达式/ 是/ 实/ 属性/ ,/ 而/ 本组/ 实验/ 用例/ 的/ 目标/ 表达式/ 是/ 虚/ 属性/ ./ 从图/ 8/ (/ a/ )/ 与/ (/ b/ )/ 可以/ 得出/ ,/ 对于/ 含有/ 虚/ 属性/ 的/ 路径/ 表达式/ ,/ 第/ 1/ 组/ 实验/ 得出/ 的/ 各个/ 结论/ 依然/ 成立/ ./ 图/ 8/ (/ c/ )/ 与/ (/ d/ )/ 由图/ 7/ (/ a/ )/ 、/ (/ b/ )/ 与/ 图/ 8/ (/ a/ )/ 、/ (/ b/ )/ 的/ 测试/ 结果/ 得到/ ,/ 图/ 8/ (/ c/ )/ 显示/ 了/ 在/ 路径/ 长度/ 为/ 3/ 的/ 情况/ 图/ 8/ 虚/ 属性/ 对/ 路径/ 表达式/ 计算/ 的/ 影响/ 由/ 第/ 1/ 组和/ 第/ 2/ 组/ 实验/ 的/ 结果/ 可以/ 得出/ 以下/ 结论/ :/ 在/ 不/ 考虑/ 带/ 谓词/ 条件/ 的/ 情况/ 下/ ,/ PT/ 方法/ 的/ 效率/ 是/ 最差/ 的/ ;/ MJ/ -/ Index/ 方法/ 较/ 适用/ 于/ 短/ 路径/ 的/ 路径/ 表达式/ 计算/ ,/ 在/ 长/ 路径/ 的/ 路径/ 表达式/ 计算/ 时/ ,/ 相对/ 于/ PNI/ 方法/ 、/ N/ -/ Index/ 方法/ 和/ P/ -/ Index/ 方法/ 没有/ 优势/ ./ N/ -/ Index/ 方法/ 表现/ 较/ 好/ ,/ 而/ PNI/ 方法/ 与/ P/ -/ Index/ 方法/ 次之/ ,/ 后/ 两者/ 的/ 性能/ 相当/ ./ 4.2/ ./ 3/ 谓词/ 条件/ 对/ 路径/ 表达式/ 计算/ 的/ 影响/ 第/ 3/ 组/ 实验/ 研究/ 谓词/ 条件/ 对/ 路径/ 表达式/ 计算/ 的/ 影响/ ./ 由于/ N/ -/ Index/ 不/ 支持/ 带/ 谓词/ 的/ 路径/ 表达式/ 计算/ ,/ 因此/ 本组/ 实验/ 只/ 针对/ 其它/ 4/ 种/ 方法/ 进行/ 比较/ 分析/ ./ 实验/ 在/ 路径/ 一致/ 、/ 目标/ 表达式/ 一致/ 的/ 情况/ 下/ ,/ 以/ 不同/ 谓词/ 组合/ 的/ 路径/ 表达式/ 作为/ 测试用例/ ,/ 分别/ 测试/ 了/ 带/ 一个/ 实/ 属性/ 谓词/ 、/ 带/ 一个/ 虚/ 属性/ 谓词/ 以及/ 带/ 下/ ,/ 各种/ 方法/ 在/ 计算/ 具有/ 相同/ 导航/ 路径/ 的/ 路径/ 表达式/ 时/ ,/ 由于/ 将/ 目标/ 表达式/ 由实/ 属性/ 转换/ 为/ 虚/ 属性/ 所/ 带来/ 的/ 计算/ 开销/ 增长/ ./ 图/ 8/ (/ d/ )/ 则/ 对应/ 于/ 路径/ 长度/ 为/ 6/ 的/ 情况/ ./ 由/ 这/ 两个/ 图可得/ ,/ 虚/ 属性/ 增加/ 了/ 各种/ 方法/ 计算/ 路径/ 表达式/ 的/ 开销/ ./ 这/ 是因为/ 在/ 计算/ 涉及/ 虚/ 属性/ 的/ 某个/ 路径/ 表达式/ 时/ ,/ 由于/ 虚/ 属性/ 的/ 原因/ ,/ 需要/ 嵌套/ 计算/ 在/ 虚/ 属性/ 切换/ 表达式/ 定义/ 中/ 所/ 使用/ 的/ 其它/ 路径/ 表达式/ ,/ 计算/ 代价/ 由此/ 随之/ 上升/ ./ 两个/ 虚/ 属性/ 谓词/ 的/ 路径/ 表达式/ ./ 涉及/ PNI/ 方法/ 的/ 测试/ ,/ 都/ 在/ PNI/ 索引/ 中为/ 谓词/ 属性/ 创建/ 了/ 相应/ 的/ Attribute/ -/ Index/ 索引/ ./ 从/ 实验/ 结果/ 来看/ ,/ PNI/ 方法/ 受虚/ 属性/ 谓词/ 和/ 实/ 属性/ 谓词/ 的/ 影响/ 最少/ ,/ 对于/ 带/ 谓词/ 条件/ 的/ 路径/ 表达式/ 计算/ ,/ 其/ 性能/ 是/ 4/ 种/ 方法/ 中/ 最好/ 的/ ,/ 这/ 主要/ 受益/ 于/ PNI/ 索引/ 中/ 的/ Attribute/ -/ Index/ 索引/ ,/ 可以/ 避免/ 不必要/ 的/ 谓词/ 计算/ ,/ 快速/ 过滤/ 不/ 满足条件/ 的/ 路径/ 实例/ ./ PNI/ 方法/ 相对/ 于/ 其它/ 方法/ 的/ 的/ 优势/ ,/ 在/ 涉及/ 虚/ 属性/ 谓词/ 的/ 路径/ 表达式/ 计算/ 时/ 体现/ 得/ 更加/ 明显/ ./ 在/ 带/ 谓词/ 条件/ 的/ 情况/ 下/ ,/ PT/ 方法/ 的/ 效率/ 不/ 一定/ 是/ 最差/ 的/ ,/ 如图/ 9/ 所示/ ,/ 虽然/ 在/ 带/ 一个/ 虚/ 属性/ 谓词/ 的/ 情况/ 下/ ,/ PT/ 方法/ 的/ 性能/ 是/ 最差/ 的/ ,/ 但是/ 在/ 带/ 两个/ 虚/ 属性/ 谓词/ 的/ 情况/ 下/ ,/ 其/ 性能/ 仅次于/ PNI/ 方法/ ./ 这/ 是因为/ PTPage12/ 方法/ 是/ 面向/ 记录/ 的/ 方法/ ,/ 在/ 对象/ 遍历/ 的/ 过程/ 中/ ,/ 一旦/ 发现/ 谓词/ 条件/ 不/ 满足/ ,/ 就/ 及时/ 中止/ 该趟/ 计算/ 流程/ ./ 谓词/ 条件/ 判断/ 得/ 越/ 早/ ,/ PT/ 方法/ 就/ 能/ 避免/ 越/ 多/ 不必要/ 的/ 对象/ 遍历/ 开销/ ./ 之所以/ PT/ 方法/ 在/ 两个/ 虚/ 属性/ 谓词/ 的/ 情况/ 下/ 性能/ 反而/ 比/ 一个/ 虚/ 属性/ 的/ 情况/ 下/ 的/ 性能/ 要/ 好/ ,/ 这/ 主要/ 是/ 由于/ 测试/ 路径/ 的/ 选择/ ,/ 使得/ PT/ 方法/ 能/ 在/ 前/ 一种/ 情况/ 下/ 及时/ 中止/ 对象/ 遍历/ ./ 对于/ MJ/ -/ Index/ 方法/ 与/ P/ -/ Index/ 方法/ 来说/ ,/ 由于/ 两种/ 方法/ 在/ 进行/ 谓词/ 条件/ 判断/ 时/ 都/ 需要/ 获取/ 中间/ 对象/ 实例/ ,/ 因此/ 谓词/ 数量/ 越/ 多/ ,/ 两种/ 方法/ 在/ 谓词/ 计算/ 方面/ 的/ 开图/ 9/ 谓词/ 条件/ 对/ 路径/ 表达式/ 的/ 影响/ 综合/ 以上/ 3/ 组/ 实验/ 的/ 结果/ 可以/ 得出结论/ :/ PNI/ 索引/ 能够/ 提高/ 路径/ 表达式/ 计算/ 的/ 效率/ ,/ PNI/ 方法/ 在/ 不/ 考虑/ 谓词/ 条件/ 的/ 情况/ 下/ ,/ 性能/ 表现/ 良好/ ;/ 对于/ 存在/ 谓词/ 条件/ 的/ 路径/ 表达式/ 计算/ ,/ PNI/ 方法/ 的/ 性能/ 最优/ ,/ 相较/ 于/ 其它/ 方法/ 具有/ 明显/ 的/ 优势/ ./ 4.2/ ./ 4PNI/ 索引/ 存储/ 开销/ 本次/ 实验/ 主要/ 研究/ PNI/ 索引/ 的/ 存储/ 开销/ ./ 实验/ 以图/ 1/ 所示/ 音乐/ 数据库/ 为/ 背景/ ,/ 为/ 路径/ P/ =/ Picture/ →/ Album/ _/ pic/ →/ Album/ →/ Music/ _/ Lyr/ →/ Music/ →/ Music/ _/ MTV/ 创建/ PNI/ 索引/ ,/ 该/ PNI/ 索引/ 包含/ 一个/ Path/ -/ Instance/ -/ Table/ 表/ ,/ 各/ Identity/ -/ Index/ 索引/ 以及/ 为类/ Music/ 的/ “/ title/ ”/ 属性/ 所/ 创建/ 的/ 一销/ 就/ 越/ 大/ ,/ 从而/ 影响/ 了/ 总/ 的/ 计算/ 开销/ ,/ 这/ 可以/ 通过/ 比较/ 图/ 9/ (/ b/ )/ 与/ (/ c/ )/ 的/ 结果/ 得出/ ./ 至于/ 出现/ 如图/ 9/ (/ a/ )/ 与/ (/ b/ )/ 所示/ 结果/ ,/ MJ/ -/ Index/ 方法/ 与/ P/ -/ Index/ 方法/ 在/ 实/ 属性/ 谓词/ 情况/ 下比虚/ 属性/ 谓词/ 情况/ 下/ 计算/ 开销/ 的/ 增加/ ,/ 这/ 完全/ 是/ 由于/ 路径/ 谓词/ 的/ 选择/ 所/ 造成/ 的/ ./ 虚/ 属性/ 谓词/ 情况/ 下/ ,/ 过滤/ 得到/ 满足条件/ 的/ 路径/ 实例/ 较/ 少/ ,/ 使/ 路径/ 表达式/ 的/ 后续/ 计算/ 开销/ 较/ 小/ ;/ 而实/ 属性/ 谓词/ 的/ 情况/ 下/ ,/ 过滤/ 得到/ 满足条件/ 的/ 路径/ 实例/ 较/ 多/ ,/ 所以/ 后续/ 计算/ 的/ 开销/ 较大/ ./ 个/ Attribute/ -/ Index/ 索引/ ./ 实验/ 分别/ 测试/ 了/ 在/ 不同/ 数据/ 规模/ 下/ 的/ PNI/ 索引/ 的/ 存储/ 代价/ ,/ 其/ 结果/ 如图/ 10/ 所示/ ./ 从/ 实验/ 的/ 结果/ 分析/ ,/ 对于/ 一个/ 路径/ 的/ PNI/ 索引/ ,/ 随着/ 数据/ 规模/ 的/ 增大/ ,/ 索引/ 所/ 占/ 存储空间/ 也/ 随之/ 增加/ ./ 这/ 是因为/ :/ 数据量/ 的/ 增大/ ,/ 必然/ 增加/ 了/ 路径/ 实例/ 的/ 数量/ ,/ Path/ -/ Instance/ -/ Table/ 表/ 需要/ 存储/ 更/ 多/ 的/ 路径/ 实例/ ./ Path/ -/ Instance/ -/ Table/ 表/ 的/ 数据量/ 一/ 增大/ ,/ Identity/ -/ Index/ 索引/ 规模/ 也/ 随之/ 增加/ ./ 一旦/ PNI/ 索引/ 建有/ Attribute/ -/ Index/ 索引/ ,/ 随着/ Attribute/ -/ Index/ 索引/ 属性/ 所在/ 类/ 的/ 数据/ 规模/ 的/ 增大/ ,/ Attribute/ -/ Index/ 索引/ 的/ 规模/ 也/ 会/ 随之/ 增加/ ./ Page135/ 总结/ 在/ 代理/ 层次/ 中/ 进行/ 对象/ 导航/ 遍历/ 是/ 对象/ 代理/ 数据库/ 的/ 一个/ 重要/ 特点/ ,/ 对象/ 代理/ 查询语言/ 的/ 路径/ 表达式/ 可以/ 有效/ 满足/ 对象/ 遍历/ 的/ 表达/ 需求/ ,/ 是/ 支持/ 诸如/ 跨类/ 查询/ 、/ 代理/ 对象/ 查询/ 等/ 查询/ 功能/ 的/ 重要/ 设施/ ./ 对象/ 代理/ 数据库/ 需要/ 研究/ 有效/ 的/ 存取方法/ 以/ 支持/ 在/ 代理/ 层次/ 中/ 进行/ 高效/ 的/ 对象/ 导航/ 遍历/ ,/ 本文/ 正是/ 在/ 这/ 一/ 背景/ 下/ ,/ 提出/ 了/ 一种/ 新/ 的/ 索引/ 结构/ —/ —/ —/ 路径/ 导航/ 索引/ PNI/ 来/ 计算/ 代理/ 层次/ 中/ 的/ 路径/ 表达式/ ./ PNI/ 索引/ 物化/ 了/ 路径/ 实例/ ,/ 并/ 利用/ 属性/ 索引/ 技术支持/ 对/ 路径/ 实例/ 进行/ 关联/ 检索/ ./ 通过/ 物化/ 路径/ 实例/ ,/ 在/ 计算/ 路径/ 表达式/ 的/ 过程/ 中/ 可以/ 尽量减少/ 对象/ 遍历/ 的/ 开销/ ;/ 对/ 路径/ 实例/ 关联/ 检索/ 的/ 支持/ 可/ 避免/ 谓词/ 计算/ 给/ 路径/ 表达式/ 计算所/ 带来/ 的/ 开销/ ./ 正是/ 从/ 对象/ 遍历/ 与/ 谓词/ 计算/ 两个/ 侧面/ 进行/ 改进/ ,/ PNI/ 索引/ 提高/ 了/ 路径/ 表达式/ 的/ 计算/ 效率/ ./ 本文/ 的/ 实验/ 对/ 各种/ 可能/ 影响/ 路径/ 表达式/ 计算/ 的/ 因素/ 进行/ 了/ 研究/ ,/ 分析/ 了/ 路径/ 长度/ 、/ 虚/ 属性/ 与/ 谓词/ 条件/ 等/ 因素/ 对/ 路径/ 表达式/ 计算/ 效率/ 的/ 影响/ ./ 实验/ 验证/ 了/ PNI/ 索引/ 对/ 路径/ 表达式/ 计算/ 的/ 有效性/ ,/ 尤其/ 是/ 针对/ 具有/ 谓词/ 的/ 路径/ 表达式/ ,/ PNI/ 索引/ 能/ 实现/ 高效/ 计算/ ./ 同时/ 我们/ 也/ 必须/ 认识/ 到/ ,/ 利用/ PNI/ 索引/ 进行/ 路径/ 表达式/ 计算/ 的/ 方法/ 不能/ 完全/ 取代/ 现有/ 对象/ 代理/ 数据库/ 中/ 指针/ 跟踪/ 的/ 计算方法/ ,/ 因为/ PNI/ 索引/ 并/ 不是/ 在/ 所有/ 情况/ 下/ 性能/ 表现/ 都/ 是/ 最优/ 的/ ./ 而且/ PNI/ 索引/ 在/ 提高/ 路径/ 表达式/ 计算/ 效率/ 的/ 同时/ ,/ 也/ 会/ 增加/ 系统/ 的/ 存储/ 开销/ ./ 本文/ 的/ 建议/ 是/ ,/ 对于/ 频繁/ 查询/ 且/ 效率/ 低下/ 的/ 路径/ 表达式/ ,/ 可以/ 合理/ 选择/ PNI/ 索引/ 来/ 提高/ 路径/ 表达式/ 计算/ 的/ 效率/ ./ 

