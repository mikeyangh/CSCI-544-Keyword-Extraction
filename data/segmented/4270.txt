Page1/ 基于/ 证据/ 推理/ 网络/ 的/ 实时/ 网络/ 入侵/ 取证/ 方法/ 田志宏余翔湛/ 张宏莉/ 方滨兴/ (/ 哈尔滨工业大学/ 计算机科学/ 与/ 技术/ 学院/ 哈尔滨/ 150001/ )/ 摘要/ 在/ 分析/ 现有/ 网络/ 入侵/ 取证/ 系统/ 所/ 存在/ 问题/ 的/ 基础/ 上/ ,/ 提出/ 了/ 一种/ 基于/ 证据/ 推理/ 网络/ 的/ 实时/ 网络/ 入侵/ 取证/ 方法/ NetForensic/ ,/ 将/ 弱点/ 关联性/ 的/ 概念/ 引入/ 网络/ 入侵/ 取证/ 领域/ ,/ 根据/ 网络系统/ 的/ 弱点/ 知识/ 和/ 环境/ 信息/ 构建/ 了/ 证据/ 推理/ 网络/ ,/ 利用/ 证据/ 推理/ 网络/ 所/ 提供/ 的/ 多/ 阶段/ 攻击/ 推理/ 能力/ ,/ NetForensic/ 实现/ 了/ 高效/ 实时/ 攻击/ 流程/ 重构/ ./ 实验/ 数据/ 表明/ ,/ NetForensic/ 给出/ 的/ 证据/ 链/ 完整/ 可信/ ,/ 且/ 具备/ 实时/ 推理/ 的/ 能力/ ,/ 为/ 快速/ 有效/ 的/ 调查取证/ 提供/ 了/ 有力/ 保证/ ./ 关键词/ 入侵/ 取证/ ;/ 证据/ 推理/ 网络/ ;/ 弱点/ ;/ 证据/ 链/ ;/ 信息安全/ ;/ 网络安全/ 1/ 引言/ 随着/ 全球/ 信息化/ 的/ 到来/ ,/ 计算机网络/ 已/ 深入/ 到/ 各个领域/ 成为/ 重要/ 基础设施/ ./ 网络结构/ 日趋/ 复杂/ 、/ 规模/ 日渐/ 庞大/ 的/ 同时/ ,/ 入侵/ 过程/ 也/ 向/ 复杂性/ 、/ 多样性/ 和/ 分布/ 性/ 的/ 趋势/ 发展/ ./ 传统/ 的/ 安全措施/ ,/ 如/ 防火墙/ 和/ 加密技术/ 等/ ,/ 已/ 难于/ 应付/ 大量/ 复杂/ 多样/ 的/ 攻击/ 手段/ ,/ 网络安全/ 问题/ 面临/ 着/ 前所未有/ 的/ 威胁/ ./ 据/ 2006/ 年/ ConsumerReports/ 的/ 最新/ 调查报告/ 显示/ ,/ 美国/ 计算/ Page2/ 机用户/ 在/ 过去/ 两年/ 中因/ 病毒/ 、/ 间谍/ 软件/ 和/ 网络/ 欺诈/ 等/ 电脑/ 犯罪/ 带来/ 的/ 损失/ 就/ 超过/ 了/ 80/ 亿美元/ ./ 网络/ 犯罪/ 已经/ 从/ 技术/ 问题/ 发展/ 为/ 全球性/ 重大/ 社会/ 问题/ ,/ 各国/ 政府/ 都/ 在/ 考虑/ 如何/ 借助于/ 法律手段/ 来/ 维护/ 合法/ 使用者/ 权益/ ,/ 并/ 对/ 网络/ 入侵者/ 进行/ 法律制裁/ ,/ 网络/ 入侵/ 取证/ (/ networkintrusionforensics/ )/ 技术/ 的/ 研究/ 变得/ 越来越/ 迫切/ [/ 1/ ]/ ./ 与/ 主机/ 取证/ [/ 2/ ]/ 一样/ ,/ 网络/ 取证/ 同样/ 需要/ 获取/ 与/ 鉴别/ 潜在/ 的/ 、/ 有/ 法律效力/ 的/ 电子/ 证据/ ./ 然而/ 计算机/ 的/ 互联/ 使得/ 网络系统/ 取证/ 与/ 主机/ 系统/ 取证/ 有/ 很大/ 不同/ ,/ 网络/ 取证/ 通过/ 对/ 网络/ 上/ 动态/ 传输/ 的/ 通信/ 数据/ 进行/ 提取/ 和/ 分析/ ,/ 提供/ 攻击者/ 定位/ 、/ 攻击/ 流程/ 重构/ 等/ 有效/ 电子/ 证据/ [/ 3/ ]/ ,/ 并/ 将/ 这些/ 证据/ 作为/ 法庭/ 裁决/ 的/ 依据/ ./ 现实/ 中/ 的/ 网络攻击/ 绝大多数/ 不是/ 孤立/ 的/ 行为/ ,/ 而是/ 由/ 数个/ 具有/ 某种/ 逻辑联系/ 、/ 时间/ 和/ 空间/ 却/ 有/ 一定/ 跨度/ 的/ 攻击/ 单元/ 组合而成/ 的/ 多/ 阶段/ 攻击/ (/ multi/ -/ stageattack/ )/ [/ 4/ ]/ ./ 从/ 证据学/ 的/ 角度看/ ,/ 检测/ 到/ 的/ 攻击/ 单元/ 作为/ 直接/ 证据/ 虽/ 具有/ 可/ 采性/ ,/ 但/ 由于/ 无法/ 体现/ 多/ 阶段/ 攻击/ 的/ 全貌/ 而/ 缺乏/ 证明/ 力/ ./ 因此/ ,/ 如何/ 将/ 多个/ 单独/ 的/ 证据/ 通过/ 合理/ 的/ 逻辑关系/ 联系/ 成/ 一个/ 较为/ 可信/ 的/ 证据/ 体系/ ,/ 成为/ 网络/ 入侵/ 取证/ 研究所/ 面临/ 的/ 核心/ 问题/ ./ 由此/ ,/ 本文/ 通过/ 将/ 弱点/ 关联性/ 的/ 概念/ 引入/ 到/ 网络/ 入侵/ 取证/ 领域/ ,/ 根据/ 网络系统/ 的/ 弱点/ 知识/ 和/ 环境/ 信息/ 构建/ 证据/ 推理/ 网络/ ,/ 提出/ 一种/ 基于/ 证据/ 推理/ 网络/ 的/ 实时/ 网络/ 入侵/ 取证/ 方法/ —/ —/ —/ NetForensic/ ,/ 利用/ 证据/ 推理/ 网络/ 所/ 提供/ 的/ 多/ 阶段/ 攻击/ 推理/ 能力/ ,/ NetForensic/ 能够/ 高效/ 实时/ 地/ 重构/ 攻击/ 流程/ ,/ 给出/ 完整/ 可信/ 的/ 证据/ 体系/ ./ 2/ 相关/ 工作/ 由于/ 实现/ 原理/ 与/ 工作/ 机制/ 的/ 原因/ ,/ 主机/ 取证/ 技术/ 存在/ 很多/ 不足之处/ ./ 首先/ ,/ 主机/ 取证/ 方法/ 的/ 实现/ 机制/ 与/ 操作系统/ 内核/ 联系/ 紧密/ ,/ 这/ 无疑/ 会/ 影响/ 正在/ 运行/ 的/ 业务/ 系统/ 的/ 性能/ ;/ 其次/ ,/ 主机/ 取证/ 方法/ 需要/ 事先/ 在/ 目标/ 主机/ 上/ 进行/ 部署/ ,/ 因而/ 难以/ 适应/ 大规模/ 的/ 取证/ 需求/ ,/ 未/ 部署/ 的/ 目标/ 主机/ 将/ 成为/ 取证/ 盲点/ ;/ 第三/ ,/ 电子/ 证据/ 的/ 可信性/ 、/ 可靠性/ 取决于/ 取证/ 服务/ 自身/ 的/ 安全性/ ,/ 而/ 主机/ 取证/ 进程/ 的/ 安全/ 保护/ 问题/ 至今/ 依然/ 是/ 一大/ 难点/ ./ 以/ 网络/ 数据/ 为/ 数据源/ 的/ 网络/ 取证/ 技术/ 的/ 提出/ 很/ 好地解决/ 了/ 上述/ 问题/ ,/ 补充/ 和/ 完善/ 了/ 计算机/ 取证/ 领域/ 的/ 研究/ 工作/ [/ 5/ ]/ ./ 基于/ 人工智能/ 技术/ 的/ 攻击/ 事件/ 检测/ 方法/ 属于/ 最/ 初步/ 的/ 网络/ 取证/ ,/ 利用/ 专家系统/ [/ 6/ ]/ 、/ 模糊/ 决策树/ [/ 7/ ]/ 、/ 人工神经网络/ 和/ 支持/ 向量/ 机/ [/ 8/ ]/ 等/ 技术/ 的/ 强大/ 学习/ 能力/ 及其/ 分析/ 结果/ 的/ 易/ 理解/ 性/ 将/ 捕获/ 到/ 的/ 网络/ 海量/ 数据/ 标记/ 为/ 正常/ 和/ 异常/ ./ 此类/ 方法/ 不/ 能够/ 揭示/ 出/ 相关/ 安全事件/ 之间/ 的/ 因果/ 联系/ ,/ 无法/ 对/ 攻击/ 全貌/ 给出/ 清晰/ 的/ 解释/ ,/ 无法/ 完全/ 满足/ 取证/ 分析/ 的/ 需要/ ./ 在/ 证据/ 表示/ 方面/ ,/ 文献/ [/ 9/ ]/ 根据/ 源/ 和/ 目的/ 地址/ 等/ 地理/ 属性/ 对/ 数据包/ 进行/ 链路/ 分析/ ,/ 并/ 依照/ 时序/ 进行/ 信息/ 可视化/ 处理/ ,/ 设计/ 并/ 实现/ 了/ 一个/ 支持/ 实时/ 取证/ 分析/ 的/ 数据包/ 级/ 的/ 可视化/ 工具/ ,/ 方便/ 调查/ 人员/ 了解/ 某个/ 时间段/ 内/ 全网/ 范围/ 的/ 流量/ 情况/ 和/ 数据/ 走向/ ./ 文献/ [/ 10/ ]/ 将/ 主机/ 分为/ {/ Attacker/ ,/ Victims/ ,/ SteppingStones/ ,/ BackgroundAttacker/ }/ 四类/ ,/ 并/ 基于/ IF/ -/ THEN/ 规则/ 的/ 模糊/ 认知/ 图/ 对/ 由/ 入侵/ 检测/ 系统/ 产生/ 的/ 二次/ 证据/ 进行/ 归纳/ 和/ 推理/ ,/ 利用/ 固定/ 模式/ 的/ 推理/ 逻辑/ 对/ 证据/ 进行/ 关联/ ,/ 生成/ 的/ 图形化/ 结果/ 能够/ 清晰/ 地/ 显示/ 攻击/ 次序/ 和/ 各/ 主机/ 所/ 充当/ 的/ 角色/ ./ 文献/ [/ 11/ ]/ 提出/ 一种/ 基于/ 层次化/ 入侵/ 场景/ 重构/ 的/ 自动/ 入侵/ 证据/ 分析方法/ ./ 首先/ ,/ 利用/ 报警/ 关联/ 技术/ 重构/ 出/ 入侵者/ 的/ 抽象/ 攻击/ 步骤/ 及/ 步骤/ 间/ 关系/ ;/ 然后/ ,/ 基于/ 攻击/ 特征/ 和/ 依赖/ 追踪/ 技术/ 重构/ 出/ 各/ 步骤/ 的/ 行为/ 细节/ ;/ 最后/ ,/ 通过/ 两层/ 重构/ 结果/ 的/ 彼此/ 映射/ ,/ 调整/ 获得/ 完整/ 的/ 入侵/ 行为/ 图/ ./ 实际上/ 此类/ 算法/ 大都/ 是/ 基于/ 融合/ 技术/ 产生/ 超/ 报警/ 的/ 关联/ 图/ ,/ 但/ 对/ 关联/ 图/ 的/ 可信度/ 却/ 未作/ 深入研究/ ./ 在/ 网络/ 取证/ 技术/ 系统/ 框架/ 的/ 研究/ 方面/ ,/ Kulesh/ 等/ 人/ [/ 12/ ]/ 提出/ 和/ 设计/ 了/ 一种/ 分布式/ 网络/ 实时/ 取证/ 系统/ ForNet/ ,/ 由/ 网络/ 取证/ 控制中心/ ForensicServer/ 和/ 事件/ 收集/ 代理/ SynApp/ 两个/ 组件/ 组成/ ,/ 全面/ 讨论/ 了/ 符合/ 大规模/ 网络/ 取证/ 需求/ 的/ 系统/ 架构/ 、/ 事件/ 的/ 存储/ 查询/ 以及/ 系统/ 安全性/ 等/ 问题/ ./ 基于/ 可信计算/ 平台/ 的/ TIF/ [/ 13/ ]/ 主要/ 研究/ 了/ 网络/ 数据/ 的/ 获取/ 与/ 存储/ ,/ 并/ 采用/ 认证/ 和/ 加密/ 的/ 方式/ 保证数据/ 的/ 完整性/ ./ 针对/ 大规模/ 蠕虫/ 爆发/ 和/ 分布式/ 拒绝服务/ 攻击/ 的/ 取证/ 问题/ ,/ CANINE/ [/ 14/ ]/ 以/ CISCO/ 路由器/ 的/ NetFlow/ 记录/ 为/ 数据源/ 进行/ 多源/ 数据/ 融合/ ,/ 而/ NFA/ [/ 15/ ]/ 则/ 采用/ 多/ 自治/ 域/ 相结合/ 的/ 信息/ 共享/ 机制/ 来/ 获得/ 全局/ 调查/ 能力/ ,/ 从而/ 能够/ 及时/ 准确/ 地/ 发现/ 传播/ 路径/ 和/ 攻击/ 源/ ./ 现有/ 的/ 网络/ 入侵/ 取证/ 分析/ 技术/ 还/ 存在/ 着/ 如下/ 一些/ 问题/ :/ 首先/ ,/ 由于/ 对/ 多/ 阶段/ 攻击/ 认识/ 上/ 的/ 不足/ ,/ 大量/ 研究/ 工作/ 仅/ 关注/ 于/ 如何/ 对/ 攻击/ 证据/ 进行/ 准确/ 有效/ 地/ 标识/ ,/ 但/ 对/ 证据/ 关联性/ 少有/ 分析/ ;/ 其次/ ,/ 根据/ 固定/ 的/ 模式/ 对/ 证据/ 进行/ 关联/ 的/ 方法/ 虽然/ 可以/ 重构/ 攻击/ 流程/ ,/ 但/ 未/ 对/ 目标/ 系统/ 以及/ 攻击者/ 状态/ 进行/ 有效/ 追踪/ ,/ Page3/ 缺乏/ 客观性/ 和/ 可信性/ ;/ 第三/ ,/ 实用性/ 不/ 强/ ,/ 庞大/ 而/ 复杂/ 的/ 网络/ 数据/ 为/ 取证/ 分析/ 带来/ 了/ 巨大/ 的/ 挑战/ ,/ 但/ 大量/ 研究/ 工作/ 仅/ 从/ 体系结构/ 和/ 取证/ 节点/ 部署/ 来/ 进行/ 相关/ 研究/ ,/ 对/ 如何/ 提高/ 系统/ 性能/ 、/ 降低/ 算法/ 复杂度/ 未有/ 涉及/ ./ 综合/ 考虑/ 上述/ 不足/ ,/ NetForensic/ 具有/ 以上/ 方法/ 所/ 不/ 具备/ 的/ 优点/ :/ (/ 1/ )/ 取证/ 过程/ 对/ 业务/ 透明/ ,/ 不会/ 对系统/ 应用/ 性能/ 产生/ 任何/ 影响/ ;/ (/ 2/ )/ 以/ 网络/ 数据/ 为/ 证据/ 数据源/ ,/ 无需/ 事先/ 在/ 目标/ 主机/ 部署/ 取证/ 设施/ ,/ 避免/ 了/ 主机/ 取证/ 方法/ 中/ 取证/ 服务/ 的/ 安全性/ 问题/ ;/ (/ 3/ )/ 充分考虑/ 了/ 目标/ 网络系统/ 的/ 弱点/ 知识/ 和/ 环境/ 信息/ ,/ 所获/ 证据/ 更具/ 准确性/ ;/ (/ 4/ )/ 引入/ 弱点/ 关联性/ 概念/ ,/ 依靠/ 证据/ 推理/ 网络/ 所/ 提供/ 的/ 多/ 阶段/ 攻击/ 推理/ 能力/ ,/ 实现/ 了/ 高性能/ 证据/ 链/ 推理/ ,/ 并/ 细化/ 了/ 取证/ 粒度/ ./ 3/ 基于/ 证据/ 推理/ 网络/ 的/ 网络/ 入侵/ 取证/ 3.1/ 网络攻击/ 模型/ 由于/ 隐蔽性/ 强/ 、/ 成功率高/ ,/ 多/ 阶段/ 攻击/ 已/ 成为/ 网络/ 入侵/ 的/ 主要/ 形式/ [/ 16/ ]/ ./ 以/ Welchia/ ./ B/ ./ Worm/ 病毒/ 为例/ ,/ 整个/ 攻击/ 过程/ 分为/ 3/ 个/ 阶段/ ,/ 分别/ 是/ 系统/ 信息/ 收集/ 、/ 弱点/ 服务/ 发现/ 和/ 特权/ 提升/ ,/ 每/ 阶段/ 有/ 多种/ 方式/ 可/ 供选择/ ,/ 分别/ 为/ δ/ ,/ ε/ 1/ ,/ ε/ 2/ ,/ ε/ 3/ ,/ γ/ 1/ ,/ γ/ 2/ ,/ γ/ 3/ ,/ γ/ 4/ ./ 如图/ 1/ 所示/ ,/ 几种/ 攻击/ 可以/ 组合/ 出/ 多种/ 攻击方式/ ,/ 每种/ 方式/ 均/ 可/ 实现/ 攻击/ 目的/ ./ 证据学/ 认为/ ,/ 证据/ 对于/ 案件/ 事实/ 有无/ 证明/ 力/ ,/ 以及/ 证明/ 力/ 之/ 大小/ ,/ 取决于/ 证据/ 与/ 案件/ 事实/ 有无/ 联系/ ,/ 以及/ 联系/ 的/ 紧密/ 、/ 强弱/ 程度/ ./ 为了/ 提高/ 证据/ 的/ 证明/ 力/ ,/ NetForensic/ 引入/ 了/ 证据/ 链/ 的/ 概念/ [/ 17/ ]/ ./ 定义/ 1/ ./ 证据/ 链/ ./ 是/ 指/ 由/ 两个/ 及/ 以上/ 不同/ 的/ 电子/ 证据/ 所/ 组成/ ,/ 各/ 证据/ 并/ 不/ 孤立/ 存在/ ,/ 而是/ 由/ 客观/ 联系/ 相互/ 联结/ ,/ 内容/ 相互/ 印证/ 并/ 体现/ 或/ 提高/ 证明/ 力/ ,/ 用以/ 证明/ 案件/ 事实性/ 的/ 证据/ 体系/ ./ 多/ 阶段/ 攻击/ 的/ 每个/ 攻击/ 步骤/ 均/ 看作/ 一个/ 电子/ 证据/ (/ 下文/ 简称/ 为/ 证据/ )/ ,/ 而/ 网络/ 入侵/ 取证/ 研究所/ 面临/ 的/ 主要/ 问题/ 则/ 转化/ 为/ 如何/ 将/ 多个/ 离散/ 证据/ 通过/ 合理/ 的/ 逻辑关系/ 连接/ 为/ 可信/ 的/ 证据/ 链/ ,/ 这/ 也/ 是/ NetForensic/ 追求/ 的/ 最终目标/ ./ 3.2/ 弱点/ 和/ 弱点/ 的/ 关联性/ 弱点/ 概念/ 表示/ 的/ 是/ 计算机系统/ 在/ 其/ 安全策略/ 保证/ 下/ 存在/ 的/ 缺陷/ ,/ 即/ 破坏/ 所/ 声称/ 安全/ 的/ 漏洞/ ,/ 弱点/ 的/ 存在/ 是/ 导致/ 安全事件/ 发生/ 的/ 内因/ ./ 弱点/ 及/ 弱点/ 关联性/ 的/ 定义/ 如下/ [/ 18/ ]/ :/ 定义/ 2/ ./ 弱点/ ./ 是/ 软件系统/ 或/ 软件/ 组件/ 中/ 存在/ 的/ 缺陷/ ,/ 此/ 缺陷/ 若/ 被/ 发掘/ 利用/ 则/ 会/ 违反/ 安全策略/ ,/ 并/ 对系统/ 的/ 机密性/ 、/ 可/ 鉴别/ 性/ 和/ 可用性/ 造成/ 不良影响/ ,/ 弱点/ 可记/ 为/ v/ ./ 定义/ 3/ ./ 弱点/ 关联性/ ./ 设/ 一个/ 具有/ n/ 个/ 弱点/ V/ [/ S/ ]/ =/ {/ v1/ ,/ v2/ ,/ …/ ,/ vn/ }/ 的/ 软件系统/ S/ ,/ 若/ / vli/ (/ i/ =/ 1/ ,/ …/ ,/ k/ ∧/ k/ / n/ )/ ∈/ V/ [/ S/ ]/ ,/ 使/ 攻击者/ 能够/ 利用/ vl1/ ,/ …/ ,/ vlk/ 完成/ 一次/ 多/ 阶段/ 攻击/ ,/ 则/ 称/ 弱点/ vl1/ ,/ …/ ,/ vlk/ 是/ 相关/ 的/ ,/ vl1/ ,/ …/ ,/ vlk/ 之间/ 具有/ 关联性/ ./ 弱点/ 关联性/ 可由/ 如图/ 2/ 所示/ 的/ AND/ 和/ OR/ 结构/ 表示/ ./ AND/ 结构/ 表示/ 在/ 多/ 阶段/ 攻击/ 中/ ,/ 成功/ 利用/ 弱点/ v/ 的/ 前提/ 是/ 弱点/ vli/ (/ i/ =/ 1/ ,/ …/ ,/ n/ ∧/ n/ / 2/ )/ 均/ 被/ 成功/ 利用/ ;/ 而/ OR/ 结构/ 则/ 表示/ 只/ 需/ 成功/ 利用/ 弱点/ vli/ (/ i/ =/ 1/ ~/ n/ ∧/ n/ / 1/ )/ 中/ 任一/ 弱点/ ,/ 攻击者/ 就/ 可以/ 试图/ 继续/ 利用/ 弱点/ v/ 攻击/ 目标/ 系统/ ./ 由/ 定义/ 不难看出/ ,/ 攻击行为/ 的/ 本质/ 是/ 攻击者/ 对/ 相应/ 弱点/ 的/ 利用/ ,/ 攻击/ 和/ 弱点/ 之间/ 存在/ 着/ 潜在/ 的/ 必然联系/ ./ 因此/ 只要/ 将/ 攻击/ 特征/ 空间/ 映射/ 至/ 弱点/ 空间/ ,/ 即可/ 利用/ 弱点/ 关联性/ 来/ 描述/ 攻击行为/ 之间/ 的/ 逻辑联系/ ./ 基于/ 上述/ 分析/ ,/ NetForensic/ 以/ 弱点/ 关联性/ 为/ 基础/ ,/ 构建/ 证据/ 推理/ 网络/ 对/ 离散/ 的/ 攻击/ 证据/ 进行/ 关联/ 和/ 推理/ ,/ 最终/ 实现/ 形成/ 可信/ 证据/ 链/ 的/ 目的/ ./ 3.3/ 证据/ 推理/ 网络/ 在/ 网络/ 信息系统/ 中/ ,/ 功能/ 各异/ 的/ 计算机/ 由/ 电缆/ 互联/ ,/ 这种/ 互联互通/ 的/ 特性/ 和/ 弱点/ 之间/ 存在/ 的/ 关联性/ 使/ 计算机/ 之间/ 形成/ 了/ 众多/ 特殊/ 的/ 访问/ 逻辑关系/ ./ 我们/ 把/ 一个/ 能够/ 表述/ 网络/ 信息系统/ 连接/ 特性/ 和/ 弱点/ 之间/ 关联性/ 的/ 逻辑关系/ 图/ 称为/ 证据/ 推理/ 网络/ ./ 定义/ 4/ ./ 证据/ 推理/ 网络/ ./ 证据/ 推理/ 网络/ ERNPage4/ 是/ 一个/ 有向图/ ,/ 表示/ 为/ 五元/ 组/ ERN/ =/ {/ N/ ,/ E/ ,/ L/ ,/ W/ ,/ D/ }/ ,/ 定义/ 如下/ :/ (/ 1/ )/ N/ 是/ 带有/ 弱点/ 信息/ 的/ 网络/ 节点/ 的/ 顶点/ 集合/ ,/ N/ =/ {/ h/ ,/ v/ }/ ./ 其中/ ,/ h/ 表示/ 网络/ 节点/ ,/ v/ 是/ h/ 上/ 的/ 一个/ 弱点/ ./ (/ 2/ )/ E/ 表示/ 有/ 向/ 边/ 的/ 集合/ ,/ 由/ 顶点/ 的/ 有序/ 对/ 唯一/ 确定/ ,/ 如/ ei/ =/ (/ ni/ ,/ nj/ )/ ,/ 其中/ ni/ =/ (/ hi/ ,/ vi/ )/ ,/ nj/ =/ (/ hj/ ,/ vj/ )/ ,/ 表示/ 网络/ 节点/ hi/ 和/ hj/ 互联/ ,/ 且/ 弱点/ vi/ 和/ vj/ 具有/ 关联性/ ./ 有/ 向/ 边/ 的/ 起点/ 称为/ 父/ 节点/ ,/ 终点/ 称为/ 子/ 节点/ ./ 对于/ / ni/ ∈/ N/ ,/ 定义/ IN/ (/ ni/ )/ =/ {/ e/ |/ e/ =/ (/ nh/ ,/ ni/ )/ ,/ e/ ∈/ E/ ,/ nh/ ∈/ N/ }/ 为/ 指向/ 顶点/ ni/ 的/ 有/ 向/ 边/ 的/ 集合/ ,/ 定义/ OUT/ (/ ni/ )/ =/ {/ e/ |/ e/ =/ (/ ni/ ,/ nh/ )/ ,/ e/ ∈/ E/ ,/ nh/ ∈/ N/ }/ 为/ 由/ 顶点/ ni/ 发出/ 的/ 有/ 向/ 边/ 的/ 集合/ ./ 此外/ ,/ 为/ 方便/ 描述/ ,/ 将/ 有/ 向/ 边/ ei/ 记为/ ni/ →/ nj/ ./ (/ 3/ )/ L/ 定义/ 为/ 逻辑/ 表达式/ 的/ 集合/ ,/ 由/ 括号/ 、/ 与/ 、/ 或/ 运算符/ 组成/ ./ L/ 与/ 顶点/ 集合/ N/ 中/ 的/ 元素/ 一一对应/ ,/ 表示/ 指向/ 同一/ 顶点/ 的/ 各/ 有/ 向/ 边/ 之间/ 的/ 关系/ ./ 对/ / ni/ ,/ 若有/ IN/ (/ ni/ )/ =/ {/ e1/ ,/ e2/ ,/ e3/ |/ e1/ =/ (/ (/ h/ ,/ v1/ )/ ,/ (/ h/ ,/ vi/ )/ )/ ,/ e2/ =/ (/ (/ h/ ,/ v2/ )/ ,/ (/ h/ ,/ vi/ )/ )/ ,/ e3/ =/ (/ (/ h/ ,/ v3/ )/ ,/ (/ h/ ,/ vi/ )/ )/ }/ 并且/ li/ =/ {/ (/ e1/ ∧/ e2/ )/ ∨/ e3/ }/ ,/ 则/ 表示/ 弱点/ v1/ ,/ v2/ 与/ vi/ 之间/ 是/ AND/ 结构/ ,/ 而/ 弱点/ v3/ 与/ vi/ 之间/ 是/ OR/ 结构/ ./ (/ 4/ )/ 集合/ W/ 定义/ 为/ 每个/ 顶点/ 的/ 风险/ 权重/ ,/ 与/ 顶点/ 集合/ N/ 中/ 的/ 元素/ 一一对应/ ,/ 对/ / ni/ =/ (/ hi/ ,/ vi/ )/ ∈/ N/ ,/ 有/ wi/ =/ (/ fi/ +/ pi/ +/ ri/ )/ // 3/ ,/ 其中/ ,/ fi/ ∈/ [/ 0/ ,/ 1/ ]/ 表示/ 网络/ 节点/ hi/ 在/ 功能/ 上/ 的/ 价值/ ,/ 包括/ 信息/ 服务器/ 、/ 数据库/ 、/ 个人/ 主机/ 等/ ;/ pi/ ∈/ [/ 0/ ,/ 1/ ]/ 是/ 弱点/ vi/ 被/ 成功/ 攻击/ 的/ 概率/ ;/ ri/ ∈/ [/ 0/ ,/ 1/ ]/ 是/ 弱点/ 的/ 安全/ 影响/ ./ W/ 的/ 设定/ 为/ ERN/ 生成/ 证据/ 链/ 提供/ 了/ 证明/ 力/ 评判/ 标准/ ./ (/ 5/ )/ D/ =/ {/ qn/ ,/ pptr/ }/ 为/ 一组/ 数据结构/ 的/ 集合/ ,/ 与/ 顶点/ 集合/ N/ 中/ 的/ 元素/ 一一对应/ ,/ qn/ 为/ 长度/ k/ 的/ 环形/ 队列/ ,/ 用来/ 存放/ 证据/ ./ 每个/ 队列/ 元素/ 可/ 表示/ 为/ qn/ =/ {/ ts/ ,/ cptr/ ,/ s/ ,/ wt/ }/ ,/ 其中/ ts/ 为/ 时间/ 戳/ ;/ cptr/ 存放/ 指向/ 子/ 节点/ 的/ 指针/ ,/ 用来/ 重构/ 攻击/ 流程/ ;/ s/ 是/ 状态/ 位/ ,/ 可/ 取值/ 为/ 0/ ,/ 1/ ,/ 2/ ,/ 3/ ,/ 分别/ 表示/ 该证据/ 为/ 初始/ 节点/ 、/ 既/ 是/ 初始/ 节点/ 又/ 是/ 虚拟/ 节点/ 、/ 中间/ 节点/ 、/ 虚拟/ 节点/ ;/ wt/ 存放/ 风险/ 权重/ ./ pptr/ 存放/ 指向/ 相应/ 顶点/ 的/ 父/ 节点/ 的/ 指针/ 集合/ ,/ 利用/ 逆向/ 指针/ 来/ 提高/ 证据/ 推理/ 速度/ ./ 为/ 方便/ 描述/ ,/ 用/ 符号/ ./ 索引/ D/ 中/ 各/ 元素/ ./ 例如/ di/ ./ pptr/ 或/ di/ ./ qni/ ./ ts/ ./ 生成/ ERN/ 的/ 一般/ 步骤/ 为/ :/ (/ 1/ )/ 由待/ 取证/ 目标/ 网络/ 的/ 管理员/ 或/ 节点/ 主机/ 等/ 设备/ 使用者/ 报告/ 目标/ 网络/ 的/ 拓扑/ 情况/ ;/ (/ 2/ )/ 使用/ Nmap/ 、/ Nessus/ 等/ 已有/ 的/ 弱点/ 扫描/ 工具/ 在/ 管理/ 域/ 内/ 、/ 外/ 的/ 不同/ 地点/ 对/ 网络/ 进行/ 探测/ ;/ (/ 3/ )/ 构建/ 顶点/ 集合/ N/ ;/ (/ 4/ )/ 遍历/ N/ 中/ 各/ 元素/ ,/ 根据/ 节点/ 连通性/ 及/ 弱点/ 关联性/ 递归/ 生成/ 有/ 向/ 边/ 集合/ E/ 与/ 逻辑/ 表达式/ 的/ 集合/ L/ ;/ (/ 5/ )/ 根据/ 预设/ 的/ 风险/ 权重/ 计算/ 集合/ W/ 并/ 初始化/ 数据结构/ 集合/ D/ ./ 显然/ ,/ 上述/ 步骤/ (/ 1/ )/ 与/ (/ 2/ )/ 的/ 执行/ 速度/ 依赖于/ 网络拓扑/ 特点/ 及/ 规模/ ,/ 而/ 取证/ 效率/ 和/ 实时性/ 可/ 通过/ 事先/ 生成/ 各/ 目标/ 网络/ ERN/ 的/ 策略/ 加以解决/ ./ 以图/ 3/ 的/ 网络/ 信息系统/ 为例/ ,/ ABCDE/ 为/ 五台/ Linux/ 服务器/ ,/ A/ 存在/ 危及/ 管理员/ root/ 的/ 弱点/ v1/ 和/ 危及/ 用户/ user/ 的/ 弱点/ v2/ ;/ B/ 开启/ rshd/ 服务/ ,/ 允许/ A/ 和/ D/ 的/ root/ 用户/ 以/ root/ 身份/ 执行/ 远程/ shell/ 命令/ ;/ C/ 开启/ telnetd/ 和/ rshd/ 服务/ ,/ rshd/ 服务/ 仅/ 允许/ D/ 的/ root/ 用户/ 以/ root/ 身份/ 执行/ 远程/ shell/ 命令/ ,/ 且/ C/ 具有/ 危及/ root/ 的/ 弱点/ v4/ 和/ 危及/ 用户/ user/ 的/ 弱点/ v5/ ;/ D/ 开启/ sshd/ 服务/ ,/ 具有/ 危及/ root/ 的/ 弱点/ v3/ ;/ E/ 具有/ 危及/ root/ 的/ 弱点/ v6/ ,/ A/ 的/ 用户/ user/ 和/ C/ 的/ 用户/ root/ 能够/ 以/ root/ 身份/ 通过/ ssh/ 访问/ D/ ;/ B/ 和/ E/ 的/ root/ 用户/ 能够/ 以/ root/ 身份/ 通过/ telnet/ 访问/ C/ ./ 建模/ 上述/ 网络系统/ ,/ 可/ 抽象/ 为/ 图/ 4/ 所示/ 的/ ERN/ ,/ 该/ 网络/ 共/ 10/ 个/ 网络/ 节点/ ,/ 11/ 条有/ 向/ 边/ ./ 3.4/ 证据/ 链/ 推理/ ERN/ 为/ 攻击/ 流程/ 重构/ 和/ 证据/ 链/ 推理/ 提供/ 了/ 框架/ ,/ 任何/ 证据/ 链/ 都/ 可以/ 用/ ERN/ 的/ 子/ 图来/ 表示/ ,/ 而/ ERN/ 的/ 状态/ 转换/ 是/ 以/ 带有/ 弱点/ 信息/ 的/ 网络/ 节点/ 的/ 形式/ 完成/ 的/ ,/ 因此/ 证据/ 预处理/ 的/ 主要/ 功能/ 是/ 将/ 证据/ 从/ 攻击行为/ 特征/ 映射/ 为/ ERN/ 的/ 图/ 顶点/ ,/ 该/ 过程/ 用/ Page5/ 函数/ map/ (/ )/ 来/ 表示/ ./ 证据/ 链/ 推理/ 算法/ 要/ 解决/ 的/ 问题/ 可/ 抽象/ 为/ :/ 设/ e1/ ,/ e2/ ,/ …/ ,/ en/ 为/ 按/ 时序/ 排列/ 的/ 证据/ 流/ ,/ 对/ / ei/ ,/ i/ =/ 1/ ,/ 2/ ,/ …/ ,/ n/ ,/ 在/ e1/ ,/ e2/ ,/ …/ ,/ ei/ -/ 1/ 中/ 查找/ 集合/ {/ eh/ |/ h/ =/ 1/ ,/ …/ ,/ i/ -/ 1/ }/ ,/ 使/ ERN/ 图中/ 存在/ 一条/ 由/ map/ (/ eh/ )/ 指向/ map/ (/ ei/ )/ 的/ 有/ 向/ 边/ ,/ 即/ map/ (/ eh/ )/ →/ map/ (/ ei/ )/ ./ 设有/ 3/ 个/ 对应/ 相同/ ERN/ 图/ 顶点/ 的/ 证据/ ei/ ,/ ej/ ,/ ek/ ,/ 即/ 三者/ 的/ map/ (/ )/ 有/ 相同/ 取值/ ./ 另有/ 证据/ em/ ,/ 若/ 存在/ 有/ 向/ 边/ map/ (/ ek/ )/ →/ map/ (/ em/ )/ ,/ 则/ 一定/ 存在/ 有/ 向/ 边/ map/ (/ ej/ )/ →/ map/ (/ em/ )/ 和/ map/ (/ ei/ )/ →/ map/ (/ em/ )/ ./ 这种/ 关联/ 关系/ 的/ 传递性/ 为/ 证据/ 链/ 的/ 推理/ 提供/ 了/ 有利条件/ ,/ 提高/ 了/ 推理/ 效率/ ./ 证据/ 链/ 推理/ 处理/ 流程/ 主要/ 包括/ 以下/ 3/ 个/ 步骤/ :/ 1/ ./ 初始化/ ./ 按/ 时序/ 取出/ 下/ 一个/ 证据/ ei/ 并/ 转换/ 为/ ERN2/ ./ 关联/ 分析/ ./ 分析方法/ 根据/ ERN/ 图/ 顶点/ ni/ 的/ 不/ 同情/ 图/ 顶点/ ,/ 设/ map/ (/ ei/ )/ =/ ni/ ;/ 赋值/ di/ ./ qni/ ./ ts/ 为/ ei/ 的/ 时间/ 戳/ ti/ ./ 况而/ 不同/ ./ A/ ./ IN/ (/ ni/ )/ =/ 0/ ,/ 表示/ 该证据/ ei/ 是/ 起始/ 节点/ ,/ 赋值/ di/ ./ qni/ ./ s/ =/ 0/ ,/ di/ ./ qni/ ./ wt/ =/ wi/ ./ B/ ./ IN/ (/ ni/ )/ >/ 0/ ,/ 根据/ 逆向/ 指针/ di/ ./ pptr/ 索引/ 顶点/ ni/ 的/ 所有/ 父/ 节点/ ,/ 若父/ 节点/ nj/ 对应/ 的/ dj/ ./ qn/ 非空/ ,/ 则/ 称/ 有/ 向/ 边/ (/ nj/ ,/ ni/ )/ 为/ 顶点/ ni/ 的/ 真值/ 边/ ,/ 若/ 将/ ni/ 的/ 所有/ 真值/ 边/ 代入/ li/ 并/ 使/ li/ 为/ 真/ ,/ 则/ 表示/ 该证据/ ei/ 是/ 中间/ 节点/ ,/ 记录/ 所有/ 使/ li/ 为/ 真的/ 各父/ 节点/ 的/ 数据结构/ 集/ D/ 中/ 的/ 相应/ 元素/ cptr/ 为/ di/ ./ qni/ ,/ 并/ 赋值/ di/ ./ qni/ ./ s/ =/ 2/ ,/ di/ ./ qni/ ./ wt/ =/ wi/ ./ C/ ./ IN/ (/ ni/ )/ >/ 0/ ,/ 且/ 将/ ni/ 的/ 所有/ 真值/ 边/ 代入/ li/ 并/ 使/ li/ 为/ 假/ ,/ 则/ 表示/ 该证据/ ei/ 与/ 其他/ 证据/ 没有/ 关联性/ ,/ 重新/ 将/ ei/ 看作/ 起始/ 节点/ ,/ 赋值/ di/ ./ qni/ ./ s/ =/ 0/ ,/ di/ ./ qni/ ./ wt/ =/ wi/ ./ 3/ ./ 证据/ 链/ 生成/ ./ 从/ 入度/ 为/ 零/ 的/ ERN/ 图/ 顶点/ 开始/ 进行/ 广度/ 优先/ 搜索/ BFS/ (/ )/ ,/ 根据/ 遍历/ 到/ 的/ 各/ 顶点/ 的/ cptr/ 域/ 生成/ 证据/ 链/ ./ 以图/ 4/ 描述/ 的/ ERN/ 为例/ ,/ 数据结构/ 集/ D/ 中/ 的/ 相应/ 元素/ 随着/ 证据/ 的/ 变化/ 情况/ 如图/ 5/ 所示/ ./ 况而/ 不同/ ./ A/ ./ IN/ (/ ni/ )/ =/ 0/ ,/ 表示/ 该证据/ ei/ 是/ 起始/ 节点/ ,/ 赋值/ di/ ./ qni/ ./ s/ =/ 0/ ,/ di/ ./ qni/ ./ wt/ =/ wi/ ./ 3.5/ 时序/ 无关/ 的/ 证据/ 链/ 推理/ 证据/ 链/ 推理/ 算法/ 能否/ 得出/ 正确/ 的/ 结果/ 完全/ 依赖于/ 证据/ 的/ 时序/ 性/ ./ 为/ 克服/ 证据/ 的/ 时间/ 戳/ 不/ 同步/ 问题/ ,/ 本/ 节/ 提出/ 一个/ 时序/ 无关/ 的/ 证据/ 链/ 推理/ 算法/ ,/ 处理/ 流程/ 如下/ :/ 1/ ./ 初始化/ ./ 按/ 时序/ 取出/ 下/ 一个/ 证据/ ei/ 并/ 转换/ 为/ ERN/ 图/ 顶点/ ,/ 设/ map/ (/ ei/ )/ =/ ni/ ,/ 且/ ei/ 的/ 时间/ 戳/ 为/ ti/ ./ 2/ ./ 节点/ 判断/ ./ 若/ di/ ./ qni/ ./ s/ =/ 1/ 或/ di/ ./ qni/ ./ s/ =/ 3/ ,/ 则/ 执行/ (/ di/ ./ qni/ ./ s/ )/ -/ -/ ,/ di/ ./ qni/ ./ wt/ =/ wi/ ,/ di/ ./ qni/ ./ ts/ =/ ti/ ,/ 并/ 转步/ 1/ ;/ 否则/ 转步/ 3.3/ ./ 关联/ 分析/ ./ 分析方法/ 根据/ ERN/ 图/ 顶点/ ni/ 的/ 不/ 同情/ B/ ./ IN/ (/ ni/ )/ >/ 0/ 且/ 将/ ni/ 的/ 所有/ 真值/ 边/ 代入/ li/ 并/ 使/ li/ 为/ 真/ ,/ 则/ 表示/ 该证据/ ei/ 是/ 中间/ 节点/ ,/ 记录/ 所有/ 使/ li/ 为/ 真的/ 各父/ 节点/ 的/ 数据结构/ 集/ D/ 中/ 的/ 相应/ 元素/ cptr/ 为/ di/ ./ qni/ ,/ 并/ 赋值/ di/ ./ qni/ ./ s/ =/ 2/ ,/ di/ ./ qni/ ./ wt/ =/ wi/ ./ C/ ./ IN/ (/ ni/ )/ >/ 0/ 且/ 将/ ni/ 的/ 所有/ 真值/ 边/ 代入/ li/ 并/ 使/ li/ 为/ 假/ ,/ 则/ 遍历/ ni/ 的/ 父/ 节点/ ,/ 并/ 查找/ 增加/ 虚拟/ 记录/ 后能/ 使/ li/ 为/ 真的/ 父/ 节点/ nj/ ./ 执行/ 步/ 3/ 对/ nj/ 进行/ 关联/ 分析/ ,/ 若转/ 分支/ A/ ,/ 则/ 分别/ 赋值/ dj/ ./ qnj/ ./ s/ =/ 1/ ,/ dj/ ./ qnj/ ./ cptr/ =/ di/ ./ qni/ ,/ di/ ./ qni/ ./ s/ =/ 2/ ,/ di/ ./ qni/ ./ wt/ =/ wi/ ;/ 若转/ 分支/ B/ ,/ 则/ 分别/ 赋值/ dj/ ./ qnj/ ./ s/ =/ 3/ ,/ dj/ ./ qnj/ ./ cptr/ =/ di/ ./ qni/ ,/ di/ ./ qni/ ./ s/ =/ 2/ ,/ di/ ./ qni/ ./ wt/ =/ wi/ ;/ 若转/ 分支/ C/ ,/ 表示/ 该证据/ ei/ 与/ 其他/ 证据/ 没有/ 关联性/ ,/ 重新/ 将/ ei/ 看作/ 起始/ 节点/ ,/ 赋值/ di/ ./ qni/ ./ s/ =/ 0/ ,/ di/ ./ qni/ ./ wt/ =/ wi/ ./ 注/ :/ 由于/ 节点/ 为/ 虚拟/ 记录/ ,/ 因此/ 未计/ 风险/ 权重/ ,/ 待/ 该/ 节点/ 实际/ 出现/ ,/ 会/ 在/ 步/ 2/ 中补计/ ./ 4/ ./ 证据/ 链/ 生成/ ./ 从/ 入度/ 为/ 零/ 的/ ERN/ 图/ 顶点/ 开始/ 进行/ 广度/ 优先/ 搜索/ BFS/ (/ )/ ,/ 根据/ 遍历/ 到/ 的/ 各/ 顶点/ 的/ cptr/ 域/ 生成/ 证据/ 链/ ./ 如图/ 6/ 给出/ 了/ 近似/ 推理/ 的/ 过程/ 演示/ ,/ 其中/ 顶点/ 3/ 为/ 虚拟/ 记录/ ./ Page63/ ./ 6/ 时间/ 复杂度/ 分析/ 设/ ERN/ 的/ 顶点/ 数和边/ 数/ 分别/ 为/ |/ N/ |/ 和/ |/ E/ |/ ./ 证据/ 链/ 推理/ 算法/ 的/ 步骤/ 1/ 可/ 在/ 常数/ 时间/ 内/ 完成/ ,/ 步骤/ 2/ 的/ 平均/ 复杂度/ 为/ Ο/ (/ |/ E/ |/ // |/ N/ |/ )/ ,/ 步骤/ 3/ 中图/ 的/ 广度/ 优先/ 搜索/ 的/ 时间/ 复杂度/ 为/ Ο/ (/ |/ N/ |/ +/ |/ E/ |/ )/ ,/ 因此/ 证据/ 链/ 推理/ 算法/ 的/ 时间/ 复杂度/ 为/ Ο/ (/ |/ N/ |/ +/ |/ E/ |/ )/ ./ 对于/ 时序/ 无关/ 的/ 证据/ 链/ 推理/ 算法/ 中/ 的/ 步骤/ 1/ 和/ 步骤/ 2/ 为/ 常数/ 时间/ 复杂度/ ,/ 由于/ 需要/ 判断/ 虚拟/ 节点/ 的/ 父/ 节点/ 状态/ ,/ 因此/ 步/ 3/ 的/ 平均/ 复杂度/ 为/ Ο/ (/ (/ |/ E/ |/ // |/ N/ |/ )/ 2/ )/ ,/ 广度/ 优先/ 搜索/ 的/ 时间/ 复杂度/ 为/ Ο/ (/ |/ N/ |/ +/ |/ E/ |/ )/ ./ 在/ 完全/ 有向图/ 时/ |/ E/ |/ 取/ 最大值/ 为/ |/ N/ |/ 2/ -/ |/ N/ |/ ,/ 因此/ |/ N/ |/ +/ |/ E/ |/ / (/ |/ E/ |/ // |/ N/ |/ )/ 2/ ,/ 时序/ 无关/ 的/ 证据/ 链/ 推理/ 算法/ 的/ 时间/ 复杂度/ 为/ Ο/ (/ |/ N/ |/ +/ |/ E/ |/ )/ ./ 3.7/ 证据/ 链/ 的/ 证明/ 力/ 电子/ 证据/ 的/ 证明/ 力是/ 指/ 证据/ 在/ 证明/ 案情/ 事实/ 方面/ 的/ 说服力/ ,/ 存在/ 证明/ 力/ 大小/ 之分/ ./ ERN/ 的/ 元素/ W/ 定义/ 了/ 每个/ 顶点/ 的/ 风险/ 权重/ ,/ 因此/ NetForensic/ 将/ 证据/ 链上/ 的/ 每个/ 证据/ 所/ 对应/ 的/ 风险/ 权重/ 累加/ 和/ 作为/ 证据/ 链/ 的/ 证明/ 力/ 评判/ 标准/ ./ 推理/ 过程/ 中/ 产生/ 的/ 虚拟/ 记录/ 表示/ 该证据/ 未/ 被/ NetForensic/ 获取/ ,/ 因此/ 不计/ 风险/ 权重/ ,/ 设/ 证据/ 链上/ 所有/ 证据/ 的/ 风险/ 权重/ 累加/ 和/ 为/ w/ ,/ 虚拟/ 记录/ 所/ 对应/ 的/ 风险/ 权重/ 累加/ 和/ 为/ w/ ,/ 式/ (/ 1/ )/ 给出/ 了/ 证据/ 链/ 的/ 证明/ 力/ confidence/ 的/ 计算方法/ ,/ confidence/ 值越/ 大/ ,/ 所得/ 证据/ 链/ 的/ 证明/ 力越/ 大/ ,/ 反之/ ,/ 证明/ 力越/ 小/ ./ 4/ 实验/ 过程/ 及/ 结果/ 分析/ 为/ 进一步/ 检验所/ 提出/ 方法/ 的/ 有效性/ ,/ 我们/ 在/ LinuxRedHat7/ ./ 3/ 上用/ C语言/ 开发/ 了/ NetForensic/ 原型/ 系统/ ,/ 采用/ 著名/ 的/ 开源/ 网络/ 入侵/ 检测/ 系统/ Snort2/ ./ 4.3/ 作为/ 攻击/ 检测/ 组件/ ,/ 并/ 利用/ Graphviz/ 对/ 证据/ 链/ 进行/ 可视化/ ,/ 选用/ 曙光/ 服务器/ (/ CPU2/ ./ 4GHz/ ,/ MEM8GB/ )/ 为/ 测试环境/ ,/ 分别/ 进行/ 了/ 2/ 组/ 相关/ 实验/ ./ 4.1/ 参数设置/ 为了/ 评判/ 证据/ 链/ 的/ 证明/ 力/ ,/ 需要/ 设定/ ERN/ 的/ 风险/ 权重/ ./ 由于/ 每个/ 弱点/ 利用/ 的/ 难易/ 程度/ 不同/ ,/ 所以/ 概率/ 也/ 不同/ ,/ 为/ 突出/ 实验/ 效果/ ,/ 我们/ 不妨/ 假定/ 所有/ 弱点/ 的/ 概率/ 相等/ 、/ 且/ 网络/ 节点/ 的/ 功能/ 价值/ 属性/ 也/ 相等/ ,/ 至于/ 弱点/ 的/ 安全/ 影响/ ,/ 我们/ 将/ 弱点/ 按照/ 影响/ 范围/ 分为/ 9/ 类/ ,/ 并/ 赋予/ 一定/ 的/ 权值/ ,/ 如表/ 1/ 所示/ ./ 由此/ 设定/ ,/ 可用/ 权值/ 作为/ ERN/ 的/ 风险/ 权重/ ./ 弱点/ 类别/ 1/ 系统管理员/ ,/ 管理系统/ 设备/ 、/ 系统文件/ 和/ 系统/ 进/ 2/ 系统管理员/ 部分/ 权限/ ./ 3/ 任意/ 多个/ 系统/ 普通用户/ ,/ 有/ 更/ 多/ 独立/ 私有/ 的/ 资源/ ./ 0.64/ 任意/ 一个/ 系统/ 普通用户/ 的/ 权限/ 和/ 任意/ 一个/ 或/ 多/ 5/ 任意/ 一个/ 系统/ 普通用户/ ,/ 由/ 系统/ 初始化/ 产生/ 或/ 7/ 任意/ 一个/ 系统/ 普通用户/ 的/ 部分/ 权限/ ./ 89/ 在/ 物理层/ 和/ 目标/ 系统/ 连通/ 的/ 远程/ 访问者/ ,/ 通常/ 4.2/ Lincoln/ 数据/ 集/ 的/ 推理/ 结果/ 实验/ 1/ 采用/ MITLincoln/ 实验室/ 的/ LLDOS1/ ./ 0/ 和/ LLDOS2/ ./ 0.2/ 数据/ 集/ ./ 产生/ 此/ 数据/ 集/ 的/ 试验/ 床/ 包括/ 由/ 14/ 台/ 主机/ 模拟/ 的/ 外部/ Internet/ 环境/ ,/ 39/ 台/ 主机/ 组成/ 的/ 内部/ 网络/ 和/ 6/ 台/ 主机/ 组成/ 的/ DMZ/ 区域/ ,/ 涵盖/ 了/ 包括/ Windows/ 、/ LinuxRedHat5/ ./ 0/ 、/ SunOS4/ ./ 1.4/ 和/ Solaris2/ ./ 7/ 等/ 在内/ 的/ 多种/ 通用/ 操作系统/ ./ 该/ 数据/ 集/ 具有/ 很强/ 的/ 代表性/ ,/ 利用/ 攻击/ 检测/ 组件/ 检测/ 大小/ 为/ 179MB/ 的/ 内网/ 数据/ 集/ ,/ 生成/ 的/ 证据/ 种类/ 和/ 数量/ 如图/ 7/ 所示/ ./ 运行/ NetForensic/ 对/ LLDOS1/ ./ 0/ 数据/ 集/ 的/ 证据/ 进行/ 自动/ 推理/ ,/ 得到/ 图/ 8/ 所示/ 证据/ 链/ ./ 此/ 证据/ 链/ 清晰/ 直观/ 地/ 给出/ 了/ 攻击者/ 的/ 5/ 个/ 攻击/ 阶段/ :/ 攻击者/ 首先/ 从/ 主机/ 202.77/ ./ 162.213/ 扫描/ 整个/ 网络/ 选定/ 目标/ 主机/ 的/ IP地址/ 范围/ ;/ 然后/ 执行/ 选中/ ping/ 选项/ 的/ Sadmind/ 溢出/ 程序验证/ Sadmind/ 服务/ 是否/ 运行/ ,/ 从而/ 决定/ 最终/ 的/ 目标/ 主机/ 172.16/ ./ 115.20/ ;/ 接下来/ ,/ 利用/ Solaris/ 操作系统/ 的/ Sadmind/ 漏洞/ 实施/ 缓冲区/ 溢出/ 攻击/ ;/ 在/ 获得/ root/ 权限/ 之后/ ,/ 攻击者/ 通过/ telnet/ 和/ rpc/ 安装/ Mstream/ 后门/ 程序/ ;/ 最后/ ,/ 利用/ 该/ 受控/ 主机/ ,/ 向/ 主机/ 172.16/ ./ 115.20/ // 172.16/ ./ 112.10/ // 131.84/ ./ 1.131/ 发动/ DDoS/ 攻击/ ./ 这/ 与/ MITLincoln/ 实验室/ 给出/ 的/ 攻击/ 过程/ 描述/ 文档/ 全部/ 吻合/ ,/ NetForensic/ 的/ 有效性/ 得到/ 了/ 验证/ ./ 由于/ 不/ 存在/ 虚拟/ 记录/ ,/ 此/ 证据/ 链/ 的/ confidence/ =/ 100/ %/ ./ 推理/ LLDOS2/ ./ 0.2/ 数据/ 集/ 得到/ 的/ 证据/ 链/ 结果/ 如图/ 9/ 所示/ ./ 显然/ ,/ 该证据/ 链/ 也/ 包含/ 了/ 一个/ 完整/ 的/ 攻击/ 序列/ ,/ 依旧/ 采用/ 跳板/ 攻击方式/ ./ 与/ LLDOS1/ ./ 0/ 相同/ ,/ 攻击者/ 也/ 是/ 在/ 主机/ 202.77/ ./ 162.213/ 实施/ 了/ 攻击/ ,/ 并/ 利用/ Solaris/ 操作系统/ 的/ Sadmind/ 漏洞/ 成功/ 地/ 陆续/ 获得/ 了/ 主机/ 172.16/ ./ 115.20/ 和/ 172.16/ ./ 112.50/ 的/ root/ 权限/ ./ 但/ 相比/ 前者/ ,/ LLDOS2/ ./ 0.2/ 攻击/ 过程/ Page7/ 图/ 7LLDOS/ 数据/ 集/ 的/ 证据/ 种类/ 与/ 数量/ 图/ 8LLDOS1/ ./ 0/ 数据/ 集/ 的/ 证据/ 链/ 更为/ 复杂/ 和/ 隐蔽/ ,/ 例如/ ,/ 攻击者/ 没有/ 选用/ 极易/ 被/ 屏蔽/ 的/ “/ ICMPechoreply/ ”/ 对/ 目标/ 主机/ 进行/ 探测/ ,/ 而是/ 利用/ 合法/ 的/ “/ DNSHINFO/ ”/ 查询/ 获得/ 目标/ 主机/ (/ 一台/ DNS/ 服务器/ )/ 的/ 详细信息/ ./ 需要/ 注意/ 的/ 是/ ,/ 证据/ 链中/ 的/ 阴影/ 节点/ “/ FTPupload/ ”/ 表示/ 攻击者/ 利用/ ftp/ 上传/ Mstream/ 后门/ 程序/ 和/ 攻击/ 脚本/ 的/ 证据/ ,/ 但/ 由于/ 攻击/ 检测/ 组件/ 漏报/ 了/ 此/ 事件/ ,/ 为/ 保证/ 证据/ 完整性/ ,/ NetForensic/ 产生/ 了/ 虚拟/ 记录/ ./ 依据/ 表/ 1/ 设定/ 的/ 权值/ 计算/ 可/ 得/ 该证据/ 链/ 的/ confidence/ =/ 86/ %/ ./ 4.3/ 原始/ 证据/ 的/ 分析/ 工具/ 及/ 结果/ 除了/ 证据/ 之外/ ,/ NetForensic/ 还/ 保存/ 了/ 相应/ 的/ IP/ 数据包/ 作为/ 原始/ 证据/ ,/ 为/ 协助/ 取证/ 调查/ 人员/ 方便快捷/ 地/ 使用/ 原始/ 证据/ ,/ NetForensic/ 为此/ 专门/ 提供/ 了/ 2/ 个/ 辅助工具/ —/ —/ —/ 链路/ 分析/ Link/ _/ Analysis/ 和/ 关联/ 分析/ Association/ _/ Analysis/ ./ Link/ _/ Analysis/ 以/ 取证/ 人员/ 指定/ 的/ 原始/ 证据/ 的/ 属性/ 为/ 输入/ ,/ 例如/ IP地址/ ,/ 通过/ 遍历/ 原始/ 证据/ ,/ 对/ 该/ 属性/ 进行/ 计数/ 统计/ ,/ 并/ 将/ 结果/ 以图/ 的/ 方式/ 展现/ ,/ 图/ 的/ 顶点/ 为/ 属性/ 值/ ,/ 边则/ 表示/ 各/ 属性/ 之间/ 的/ 连接/ 关系/ ./ 图/ 10/ 给出/ 了/ 以源/ IP地址/ 作为/ 属性/ 输入/ 的/ LLDOS1/ ./ 0/ 数据/ 集/ 的/ 链路/ 分析/ 结果/ ,/ 顶点/ 的/ 大小/ 表明/ 该/ 属性/ 在/ 原始/ 证据/ 中/ 出现/ 的/ 次数/ ,/ 这样/ 的/ 结果/ 能够/ 使/ 调查取证/ 人员/ 对/ 原始/ 证据/ 的/ 各/ 属性/ 分布/ 有/ 一个/ 清晰/ 直观/ 的/ 宏观/ 认识/ ./ Page8/ 图/ 10LLDOS1/ ./ 0/ 数据/ 集/ 的/ 链路/ 分析/ 结果/ Association/ _/ Analysis/ 的/ 功能/ 是/ 挖掘/ 原始/ 证据/ 中/ 的/ 关联/ 规则/ 和/ 序列/ 模式/ ,/ 图/ 11/ 为/ 关联/ 规则/ 实例/ ,/ 这/ 条/ 规则/ 表明/ 如果/ 攻击者/ 的/ 源/ IP/ 为/ 192.168/ ./ 1.30/ ,/ 目的/ IP/ 是/ 172.16/ ./ 112.5/ 并且/ 目的/ 端口/ 为/ 161/ ,/ 则/ 攻击/ 类型/ 有/ 98.6/ %/ 的/ 可能/ 是/ “/ SNMPrequestudp/ ”/ ,/ 这样/ 的/ 原始/ 证据/ 在/ 整个/ 证据/ 集合/ 中/ 占/ 90.2/ %/ ./ IPsrc/ =/ 192.168/ ./ 1.30/ ,/ IPdst/ =/ 172.16/ ./ 112.5/ ,/ Port/ =/ 161/ / Signature/ =/ “/ SNMPrequestudp/ ”/ (/ 90.2/ %/ ,/ 98.6/ %/ )/ 图/ 11/ 关联/ 规则/ 实例/ IPsrc/ =/ 192.168/ ./ 1.2/ ,/ IPdst/ =/ 192.168/ ./ 1.1/ ,/ Signature/ =/ “/ ICMPPING/ ”/ / IPsrc/ =/ 192.168/ ./ 1.1/ ,/ IPdst/ =/ 192.168/ ./ 1.2/ ,/ Signature/ =/ “/ ICMPEchoReply/ ”/ 图/ 12/ 序列/ 模式/ 实例/ 4.4/ TreasureHunt/ 数据/ 集/ 的/ 推理/ 结果/ 实验/ 2/ 采用/ 美国加利福尼亚大学/ 圣塔/ 芭芭拉/ 分校/ 在/ 指导/ 学生/ 进行/ 网络/ 攻防/ 课程设计/ 时/ 收集/ 的/ TreasureHunt/ 数据/ 集/ ,/ 其/ 网络拓扑/ 按照/ 学生/ 的/ 分组/ 方式/ 划分/ 为/ Alpha/ 、/ Omega/ 和/ DMZ3/ 个子/ 网/ ,/ 共/ 包括/ MySQL/ 服务器/ 、/ 事务处理/ 服务器/ 、/ 文件/ 服务器/ 和/ WEB/ 服务器/ 等/ 八台/ 目标/ 主机/ ,/ 虽然/ 网络/ 情况/ 并/ 不/ 复杂/ ,/ 但/ 学生/ 们/ 采用/ 的/ 种类/ 繁多/ 时/ 攻击方式/ ,/ 较为/ 适合/ NetForensic/ 的/ 功能测试/ ./ 图/ 13/ 和/ 图/ 14/ 分别/ 给出/ 了/ 相应/ 的/ 证据/ 链/ ,/ confidence/ 值/ 分别/ 为/ 91.7/ %/ 和/ 33.3/ %/ ./ 表/ 2NetForensic/ 的/ 实时处理/ 性能/ MIT/ // LL2000TreasureHunt/ 在/ 资源/ 占用率/ 方面/ ,/ 图/ 15/ 给出/ 了/ NetForensic/ 的/ CPU/ 和/ 内存/ 占用率/ 的/ 曲线图/ ,/ 二者/ 的/ 占用/ 情况/ 均/ 处于/ 较/ 低/ 的/ 水平/ ./ 图/ 12/ 的/ 序列/ 模式/ 实例/ 表明/ 如果/ 在/ 源/ IP192/ ./ 168.1/ ./ 2/ 和/ 目的/ IP192/ ./ 168.1/ ./ 1/ 之间/ 发生/ 类型/ 为/ “/ ICMPPING/ ”/ 的/ 攻击/ ,/ 那么/ 在/ 1/ 秒钟/ 之内/ ,/ 会/ 有/ 20.1/ %/ 的/ 概率/ 会/ 继续/ 产生/ 源/ IP/ 为/ 192.168/ ./ 1.1/ 和/ 目的/ IP/ 为/ 192.168/ ./ 1.2/ 且/ 类型/ 为/ “/ ICMPEchoReply/ ”/ 的/ 攻击/ ./ 4.5/ 性能/ 分析/ 由于/ 目前/ 针对/ 网络/ 入侵/ 取证/ 的/ 相关/ 研究/ 和/ 文献/ 中均/ 未/ 给出/ 取证/ 的/ 性能/ 测试数据/ ,/ 也/ 没有/ 相应/ 的/ 开源/ 软件/ 供/ 我们/ 进行/ 横向/ 比较/ ./ 因此/ 表/ 2/ 仅/ 给出/ 了/ NetForensic/ 在/ 处理/ 上述/ 数据/ 集时/ 的/ 时间/ 开销/ ,/ 可以/ 看出/ ,/ NetForensic/ 每秒/ 处理/ 的/ 证据/ 数量/ 在/ 100/ 个/ 左右/ ,/ 按/ 文献/ [/ 19/ ]/ 的/ 观点/ ,/ “/ 依据/ 入侵/ 检测/ 系统/ 的/ 使用/ 经验/ ,/ 每个/ 检测点/ 平均/ 每天/ 检测/ 出/ 的/ 安全事件/ 数量/ 大约/ 为/ 10/ ~/ 20000/ 个/ ”/ ,/ NetForensic/ 的/ 处理/ 性能/ 将/ 远超/ 实际/ 处理/ 需求/ ,/ 具备/ 实时/ 推理/ 证据/ 链/ 的/ 条件/ ./ 入侵/ 事件/ // 个/ 处理/ 时间/ // s/ 平均/ 处理速度/ // (/ 个/ // s/ )/ 2498905112562473230775/ 结束语/ 如何/ 将/ 多个/ 单独/ 的/ 证据/ 通过/ 合理/ 的/ 逻辑关系/ 联/ Page9/ 图/ 13Alpha/ 子网/ 数据/ 产生/ 的/ 证据/ 链系成/ 一个/ 较为/ 可信/ 的/ 证据/ 体系/ ,/ 成为/ 网络/ 入侵/ 取证/ 研究所/ 面临/ 的/ 核心/ 问题/ ./ NetForensic/ 将/ 弱点/ 关联性/ 的/ 概念/ 引入/ 到/ 网络/ 入侵/ 取证/ 领域/ ,/ 根据/ 网络系统/ 的/ 弱点/ 知识/ 和/ 环境/ 信息/ 构建/ 了/ 证据/ 推理/ 网络/ ,/ 依靠/ 证据/ 推理/ 网络/ 所/ 提供/ 的/ 多/ 阶段/ 攻击/ 推理/ 能力/ ,/ 实现/ 了/ 高性能/ 证据/ 链/ 推理/ 并/ 细化/ 了/ 取证/ 粒度/ ,/ 实验/ 数据/ 表明/ ,/ NetForensic/ 给出/ 的/ 证据/ 链/ 完整/ 可信/ ,/ 且/ 具备/ 实时/ 推理/ 的/ 条件/ ,/ 为/ 快速/ 有效/ 地/ 调查取证/ 提供/ 了/ 有力/ 保证/ ./ 在/ 后续/ 研究/ 工作/ 中/ ,/ 我们/ 将会/ 进一步/ 开展/ 快速/ 生成/ 算法/ 等/ 研究/ 工作/ ,/ 并/ 将/ 所/ 做/ 科研工作/ 应用/ 到/ 实际/ 网络/ 环境/ 中/ 加以/ 检验/ ./ 致谢/ 审稿/ 专家/ 们/ 提出/ 了/ 宝贵/ 的/ 意见/ ,/ 促使/ 论文/ 质量/ 得到/ 进一步/ 提升/ ,/ 在/ 此/ 表示感谢/ !/ 

