Page1/ 不/ 依赖于/ 量化/ 参数/ 的/ 视频/ 编码/ 控制/ 优化/ 技术/ 袁武/ 1/ )/ 牛振东/ 1/ )/ 林守勋/ 2/ )/ 林子/ 涵/ 1/ )/ 谢辉/ 3/ )/ 罗海/ 勇/ 2/ )/ 1/ )/ (/ 北京理工大学/ 计算机/ 学院/ 北京/ 100081/ )/ 2/ )/ (/ 中国科学院计算技术研究所/ 北京/ 100190/ )/ 3/ )/ (/ 中国/ 石油/ 长城/ 钻探/ 工程/ 有限公司/ 北京/ 100101/ )/ 摘要/ 目前/ ,/ 混合式/ 视频/ 编码/ 技术/ 普遍/ 采用/ 基于/ 量化/ 参数/ 的/ Lagrange/ 乘子/ 优化/ 算法/ (/ QP/ -/ L/ )/ 实现/ 预测/ 编码/ 的/ 率/ 失真/ 优化/ 计算/ ./ 文中/ 则/ 提出/ 一种/ 新/ 的/ 率/ 失真/ 优化/ 算法/ Adapt/ -/ L/ ,/ 可以/ 根据/ 视频信号/ 的/ 率/ 失真/ 统计/ 特性/ ,/ 自/ 适应/ 地/ 调整/ Lagrange/ 乘子/ 的/ 计算/ ./ 实验/ 及/ 数据分析/ 表明/ ,/ 在/ QP/ -/ L/ 算法/ 的/ Lagrange/ 乘子/ 和/ 视频信号/ 的/ 率/ 失真/ 统计/ 信息/ 之间/ 存在/ 线性关系/ ;/ 由此/ ,/ 提出/ 一个/ 启发式/ 的/ Lagrange/ 乘子/ 计算/ 模型/ ,/ 并/ 对/ 该/ 数学模型/ 的/ 合理性/ 进行/ 理论/ 验证/ ./ 大量/ 实验/ 证明/ ,/ Adapt/ -/ L/ 的/ 编码/ 效率/ 优于/ 基于/ 量化/ 参数/ 的/ 优化/ 算法/ (/ QP/ -/ L/ )/ ./ 虽然/ Adapt/ -/ L/ 相对/ 稍为/ 复杂/ ,/ 但/ 其/ 计算/ 不/ 依赖于/ 量化/ 参数/ ,/ 有利于/ 实现/ 高效/ 的/ 码率/ 控制/ ./ 关键词/ 率/ 失真/ 优化/ ;/ 视频/ 编码/ 控制/ ;/ Lagrange/ 优化/ 技术/ 1/ 引言/ 目前/ ,/ 常见/ 的/ 视频压缩/ 系统/ 基本上/ 都/ 采用/ 了/ 有损压缩/ 的/ 混合式/ (/ Hybrid/ )/ 编码/ 架构/ ./ 在/ 该/ 架构/ 下/ ,/ 视频/ 编码器/ 可以/ 针对/ 各种/ 具有/ 复杂/ 统计/ 特征/ 的/ 视频信号/ ,/ 使用/ 不同/ 的/ 编码/ 工具/ (/ 及/ 组合/ )/ 消除/ 各种/ 冗余/ 信息/ ,/ 从而/ 压缩/ 视频/ 数据/ ./ 其/ 基本/ 处理过程/ 包括/ 预测/ 编码/ 、/ 预测/ 残差/ DCT/ 系/ 数量化/ 及/ 熵/ 编码/ 等/ 环节/ ./ 在/ 预测/ 编码/ 环节/ ,/ 通过/ 模式/ 选择/ 和/ 预测/ 补偿/ ,/ 消除/ 视频信号/ 的/ 时/ -/ 空域/ 相关性/ ;/ 在/ 码率/ 控制/ 环节/ ,/ 通过/ DCT/ 系/ 数量化/ 控制/ 预测/ 残差/ 的/ 码率/ 及/ 失真/ ./ 视频/ 编码/ 控制技术/ 就是/ 研究/ 相关/ 参数/ (/ 包括/ 编码/ 模式/ MD/ 、/ 运动/ 矢量/ MV/ 和/ 量化/ 参数/ QP/ )/ 的/ 计算/ 问题/ ,/ 以期/ 用/ 尽可能少/ 的/ 比特/ 获得/ 高质量/ 的/ 重建/ 图像/ ./ 据/ 信息论/ ,/ 视频压缩/ 的/ 码率/ 和/ 失真/ 满足/ 下凸/ 非/ 递减/ 关系/ ./ 一般/ 地/ ,/ 码率/ 越低/ 则/ 失真/ 越大/ ,/ 反之亦然/ ,/ 码率/ 极低/ 和/ 失真/ 极小/ 二者/ 不可/ 兼得/ [/ 1/ ]/ ./ 因此/ ,/ 只有/ 在/ 失真/ 与/ 码率/ 之间/ 实现/ 恰当/ 的/ 折衷/ ,/ 才能/ 实现/ 编码/ 控制/ 的/ 优化/ 计算/ ,/ 获得/ 较/ 高/ 的/ 编码/ 效率/ ./ 考虑/ 到/ 信道/ 带宽/ 对/ 多媒体通信/ 的/ 客观/ 限制/ ,/ 该/ 问题/ 实质/ 上/ 是/ 一个/ 有/ 约束/ 极值/ 求解/ ,/ 其/ 数学/ 表达形式/ 如下/ :/ minMD/ ∈/ / / ,/ MV/ ∈/ / / ,/ QP/ ∈/ / / s/ ./ t/ ./ R/ (/ MD/ ,/ MV/ ,/ QP/ )/ / Rc/ 其中/ ,/ / / 、/ / / 、/ 和/ / / 分别/ 表示/ 编码/ 模式/ 、/ 运动/ 矢量/ 和/ 量化/ 参数/ 的/ 取值/ 范围/ ,/ D/ (/ MD/ ,/ MV/ ,/ QP/ )/ 表示/ 图像/ 失真/ ,/ R/ (/ MD/ ,/ MV/ ,/ QP/ )/ 表示/ 码率/ ,/ 而/ Rc/ 表示/ 信道/ 带宽/ ./ 对/ 凸函数/ 有/ 约束/ 极值/ 问题/ 的/ 求解/ ,/ 采用/ Lagrange/ 乘子法/ ,/ 可以/ 转换/ 为/ 对/ 等价/ 的/ 无约束/ 极值/ 问题/ 进行/ 求解/ ,/ 如式/ (/ 2/ )/ 所示/ :/ minMD/ ∈/ / / ,/ MV/ ∈/ / / ,/ QP/ ∈/ / / 其中/ ,/ λ/ 表示/ Lagrange/ 乘子/ ./ 根据/ 式/ (/ 2/ )/ 的/ 最小值/ 选择/ 编码/ 工具/ (/ 及/ 组合/ )/ ,/ 在/ 码率/ 和/ 失真/ 之间/ 实现/ 折衷/ ,/ 很/ 显然/ ,/ 该式/ 能否/ 实现/ 高效/ 的/ 编码/ 效率/ ,/ 关键在于/ λ/ 值/ 的/ 选取/ ./ 围绕/ 上述/ 问题/ ,/ 学术界/ 开展/ 了/ 大量/ 的/ 研究/ 工作/ ./ 文献/ [/ 2/ ]/ 指出/ ,/ 在/ Rc/ 已知/ 的/ 条件/ 下/ ,/ 可以/ 根据/ 码率/ -/ 失/ 真的/ 单调/ 性/ ,/ 利用/ 二分法/ 通过/ 多次/ 编码/ 逐渐/ 逼近/ λ/ 的/ 最佳值/ ,/ 缺点/ 是/ 计算/ 复杂度/ 高/ ,/ 编码/ 延迟/ 大/ ./ 文献/ [/ 3/ -/ 4/ ]/ 根据/ 率/ 失真/ 理论/ 建立/ 了/ λ/ 关于/ 量化/ 参数/ 的/ 数学模型/ λ/ QP/ =/ cQ2/ (/ QP/ -/ L/ 模型/ )/ ,/ 其中/ Q/ 为/ QP/ 对应/ 的/ 量化/ 步长/ ,/ c/ 为/ 某个/ 常数/ ./ 在/ 计算/ 编码/ 模式/ 和/ 运动/ 矢量/ 时/ ,/ 可/ 根据/ 代价/ 函数/ J/ =/ D/ +/ λ/ QPR/ 的/ 最小值/ 来/ 选择/ ./ QP/ -/ L/ 算法/ 有效/ 地/ 提高/ 了/ 视频压缩/ 的/ 编码/ 效率/ ,/ 在/ H/ ./ 26L/ 及/ H/ ./ 264/ // AVC/ 等/ 标准/ 中/ 得到/ 应用/ [/ 5/ -/ 6/ ]/ ./ 但是/ ,/ 由于/ 视频信号/ 的/ 率/ 失真/ 统计/ 特征/ 关联/ 诸元/ 在/ QP/ -/ L/ 模型/ 中/ 的/ 缺位/ ,/ 其/ 计算结果/ 不/ 可能/ 对/ 任意/ 视频/ 序列/ 都/ 为/ 最优/ [/ 7/ ]/ ./ 此外/ ,/ QP/ -/ L/ 模型/ 对/ 量化/ 参数/ 存在/ 依赖性/ ,/ 不利于/ 实现/ 高效/ 的/ 视频/ 编码/ 控制/ :/ 一般/ 地/ ,/ 量化/ 参数/ 主要/ 用于/ 控制/ 预测/ 残差/ 的/ 码率/ 及/ 失真/ ,/ 其值/ 在/ 预测/ 编码/ 后/ 才能/ 有效/ 计算/ ,/ 而/ QP/ -/ L/ 在/ 预测/ 编码/ 计算/ 时/ 就/ 需要/ 预先/ 知道/ 量化/ 参数/ ,/ 二者/ 内在/ 相互/ 抵触/ ,/ 属于/ “/ 鸡/ 与/ 蛋/ ”/ 逻辑/ 悖论/ [/ 8/ -/ 9/ ]/ ./ 文献/ [/ 10/ ]/ 对/ QP/ -/ L/ 算法/ 进行/ 改进/ ,/ 在/ 运动/ 补偿/ 环节/ ,/ 根据/ 上层/ 或/ 相邻/ 图像/ 块/ 的/ 率/ 失真/ 统计/ 信息/ 修正/ 代价/ 函数/ ./ 该/ 算法/ 对/ 编码/ 效率/ 的/ 提高/ 较为/ 有限/ ,/ 仅/ 在/ 低/ 复杂度/ 模式/ 启用/ (/ RDOptimization/ =/ 0/ ,/ 也/ 即/ 关闭/ 率/ 失真/ 优化/ 模式/ )/ 的/ 情况/ 下/ 较为/ 明显/ ,/ 而/ 对于/ 高/ 复杂度/ 模式/ 基本/ 无用/ ./ 文献/ [/ 11/ ]/ 提出/ 一种/ 基于/ Laplace/ 分布/ 假设/ 的/ 率/ 失真/ 优化/ 模型/ ,/ 数学/ 表达形式/ 较为/ 复杂/ ./ 该/ 算法/ 根据/ 量化/ 参数/ 及/ 视频信号/ 的/ 率/ 失真/ 统计/ 特征/ ,/ 以/ 图像/ 帧/ 为/ 单位/ ,/ 计算/ 代价/ 函数/ 的/ Lagrange/ 乘子/ λ/ 值/ ,/ 对/ 不/ 符合/ Laplace/ 分布/ 假设/ 的/ 情况/ ,/ 则/ 修正/ 为/ QP/ -/ L/ 模型/ ./ 该/ 模型/ 能够/ 有效/ 地/ 改进/ 图像/ 运动/ 平缓/ 的/ 视频/ 序列/ 的/ 编码/ 效率/ ;/ 对于/ 图像/ 运动/ 剧烈/ 的/ 视频/ 序列/ ,/ 编码/ 效率/ 和/ QP/ -/ L/ 模型/ 相近/ ./ 本文/ 目标/ 在于/ 建立/ 一个/ 不/ 依赖于/ 量化/ 参数/ ,/ 能够/ 根据/ 视频信号/ 的/ 率/ 失真/ 统计/ 特征/ 自/ 适应/ 调整/ 的/ 率/ 失真/ 优化/ 模型/ ./ 本文/ 作者/ 在/ 大量/ 实验/ 的/ 基础/ 上/ ,/ 发现/ λ/ QP/ 与/ 视频信号/ 率/ 失真/ 统计/ 特征/ 诸元/ 的/ 一定/ 数学/ 形式/ 满足/ 线性关系/ ,/ 由此/ 建立/ λ/ 关于/ 视频信号/ 的/ 率/ 失真/ 统计/ 特征/ 的/ 函数/ 模型/ (/ Adapt/ -/ L/ )/ ;/ 并/ 进一步/ 提出/ 一种/ 新/ 的/ 率/ 失真/ 优化/ 算法/ ,/ 可以/ 在/ 图像/ 宏块级/ ,/ 根据/ 视频压缩/ 的/ 实际/ 情况/ 自/ 适应/ 地/ 调整/ 模型/ 参数/ ./ 大量/ 的/ 实验/ 表明/ ,/ Adapt/ -/ L/ 算法/ 的/ 编码/ 性能/ 优于/ QP/ -/ L/ 算法/ ./ 虽然/ Adapt/ -/ L/ 相对/ QP/ -/ L/ 稍为/ 复杂/ ,/ 但/ 其/ 计算/ 过程/ 不/ 引入/ 量化/ 参数/ ,/ 避免/ 了/ “/ 鸡/ 与/ 蛋/ ”/ 悖论/ 问题/ ,/ 有利于/ 实现/ 高效/ 的/ 视频/ 编码/ 控制/ ./ 本文/ 在/ 第/ 2/ 节/ 介绍/ 经典/ 的/ QP/ -/ L/ 算法/ ;/ 在/ 第/ 3/ 节/ ,/ 通过/ 实验/ 与/ 数据分析/ ,/ 表明/ λ/ QP/ 与/ 视频信号/ 的/ 率/ 失真/ 统计/ 特征/ 符合/ 线性关系/ ;/ 在/ 第/ 4/ 节/ ,/ 建立/ λ/ 关于/ 视频信号/ 的/ 率/ 失真/ 统计/ 特征/ 的/ 函数/ 模型/ ,/ 并/ 在/ 理论/ 上/ 验证/ 该/ 模型/ 的/ 合理性/ ;/ 在/ 第/ 5/ 节/ ,/ 介绍/ QP/ -/ L/ 算法/ 的/ 具体/ 实现/ ,/ 在/ 第/ 6/ 节/ 介绍/ 对比/ 测试/ 实验/ 和/ 结果/ 分析/ ;/ 最后/ 是/ 总结/ ./ Page32QP/ -/ L/ 算法/ 一般/ 地/ ,/ 视频信号/ 经过/ 预测/ 编码/ 以及/ DCT/ 变换/ 之后/ ,/ 预测/ 残差/ DCT/ 分量/ 之间/ 的/ 相关性/ 很小/ (/ 可以/ 认为/ 它们/ “/ 近似/ ”/ 不/ 相关/ )/ ,/ 且/ 满足/ Laplace/ 分布/ 规律/ ./ 根据/ 文献/ [/ 1/ ]/ ,/ 如果/ 使用/ 重建/ 图像/ 与/ 原始/ 图像/ 像素/ 值/ 之间/ 的/ 平均/ 绝对值/ 误差/ (/ MAD/ )/ 表示/ 图像/ 失真/ ,/ 也/ 即/ 是/ D/ (/ x/ ,/ x/ -/ )/ =/ |/ x/ -/ x/ -/ |/ ,/ 那么/ 在/ 预测/ 残差/ 的/ 码率/ 与/ 失真/ 之间/ 存在/ 如下/ 函数/ 关系/ :/ 不妨/ 假设/ 码率/ -/ 失真/ 是/ 可微/ 函数/ 关系/ ,/ 把/ 式/ (/ 3/ )/ 代入/ 到式/ (/ 2/ )/ 中/ ,/ 对式/ (/ 2/ )/ 求/ 关于/ R/ 的/ 导数/ ,/ 并置/ 为/ 0/ ./ 经过/ 推导/ ,/ 可得/ 下式/ :/ 假设/ 图像/ 失真/ 符合/ 均匀分布/ ,/ 可以/ 导出/ 失真/ 关于/ 量化/ 步长/ Q/ 的/ 函数/ 关系/ ,/ 如下/ 所示/ :/ 把/ 式/ (/ 5/ )/ 代入/ 到式/ (/ 4/ )/ 中/ ,/ 可得/ QP/ -/ L/ 模型/ :/ 其中/ ,/ c/ 为/ 一个/ 常数/ ,/ 可用/ 实验/ 方法/ 确定/ 其值/ (/ 一般/ 用/ 0.85/ 的/ 经验值/ )/ ./ 在/ QP/ -/ L/ 算法/ 中/ ,/ 根据/ 式/ (/ 7/ )/ 最小值/ 来/ 选择/ 编码/ 模式/ ;/ 对于/ 运动/ 补偿/ ,/ 则/ 按照/ 式/ (/ 8/ )/ 最小值/ 来/ 选择/ 运动/ 矢量/ ./ J/ (/ s/ ,/ c/ ,/ mode/ |/ QP/ ,/ λ/ mode/ )/ =/ SSD/ (/ s/ ,/ c/ ,/ mode/ |/ QP/ )/ +/ λ/ QPmode/ ·/ R/ (/ s/ ,/ c/ ,/ mode/ |/ QP/ )/ J/ (/ 犿/ ,/ λ/ motion/ )/ =/ 其中/ ,/ SSD/ (/ s/ ,/ c/ ,/ mode/ |/ QP/ )/ 是/ 原始/ 像素/ 和/ 重建/ 像素/ 之间/ 的/ 误差/ 平方和/ ,/ SA/ (/ T/ )/ D/ (/ s/ ,/ c/ (/ 犿/ )/ )/ 是/ 预测/ 残差/ 分量/ 的/ 绝对值/ 和/ ./ 在/ 式/ (/ 8/ )/ 中/ ,/ λ/ QP/ 我们/ 知道/ ,/ 视频压缩/ 码流/ 包括/ 预测/ 残差/ 的/ 编码/ 信息/ 和/ 宏块/ 编码/ 副/ 信息/ 两/ 部分/ ./ 对于/ 低码率/ 应用/ 场景/ ,/ 宏块/ 编码/ 副/ 信息/ 所/ 占/ 码流/ 比例/ 可达/ 20/ %/ ~/ 30/ %/ ,/ 对/ 视频压缩/ 编码/ 性能/ 的/ 作用/ 不可/ 忽视/ [/ 7/ ]/ ./ QP/ -/ L/ 算法/ 在/ 副/ 信息/ 和/ 预测/ 残差/ 之间/ 优化/ 比特/ 分配/ ,/ 显著/ 地/ 提高/ 了/ 视频/ 编码/ 性能/ ;/ 加之/ 计算/ 形式/ 也/ 比较简单/ ,/ 在/ H/ ./ 263/ 和/ H/ ./ 264/ // AVC/ 中/ 得到/ 了/ 广泛/ 的/ 应用/ ./ 但是/ ,/ 也/ 正/ 由于/ 模型/ 的/ 过于/ 简单/ ,/ QP/ -/ L/ 算法/ 存在/ 以下/ 缺陷/ :/ (/ 2/ )/ 不/ 具备/ 自适应性/ ./ 视频信号/ 统计/ 特征/ 非常复杂/ ./ 在/ 不同/ 的/ 视频/ 序列/ 之间/ ,/ 统计/ 特征/ 差异/ 较大/ (/ 在/ 第/ 7/ 节/ 可以/ 看到/ ,/ 不同/ 的/ 视频/ 序列/ 具有/ 不同/ 的/ 码率/ -/ 失真/ 曲线/ )/ ./ QP/ -/ L/ 模型/ 缺乏/ 表征/ 视频信号/ 统计/ 特性/ 的/ 关联/ 量/ ,/ 只要/ 量化/ 参数/ 相等/ ,/ 即使/ 信号/ 特征/ 迥异/ ,/ QP/ -/ L/ 算法/ 对/ 所有/ 的/ 视频/ 序列/ 都/ 使用/ 相同/ 值/ 的/ λ/ ,/ 其/ 优化/ 结果/ 不/ 可能/ 对/ 任何/ 视频/ 序列/ 都/ 是/ 最优/ 的/ [/ 7/ ,/ 10/ -/ 11/ ]/ ,/ 在/ 编码/ 效率/ 上/ 存在/ 提升/ 空间/ ./ 3/ λ/ QPmode/ 与/ 率/ 失真/ 统计/ 信息/ 之间/ 的/ 函数/ 关系/ 在/ QP/ -/ L/ 模型/ 中/ ,/ λ/ QP/ (/ 1/ )/ 视频/ 编码/ 控制/ 过程/ 复杂化/ ./ 在/ QP/ -/ L/ 模型/ 中/ ,/ QP/ 是/ 唯一/ 参变量/ ,/ 该/ 模型/ 的/ 编码/ 性能/ 取决于/ 量化/ 参数/ 的/ 合理/ 取值/ ./ 在/ Hybrid/ 编码/ 结构/ 中/ ,/ 量化/ 参数/ 主要/ 用于/ 控制/ 预测/ 残差/ 的/ 码率/ 及失/ 真的/ 大小/ ./ 为了/ 有效/ 地/ 控制/ 视频压缩/ 码流/ 大小/ ,/ 需要/ 根据/ 预测/ 残差/ 的/ 率/ 失真/ 统计/ 信息/ 计算/ 量化/ 参数/ ,/ 但是/ ,/ 相关/ 统计/ 信息/ 无法/ 先于/ 预测/ 编码/ 得到/ ./ 为此/ ,/ 可以/ 通过/ 多次/ 编码/ 处理/ 逐渐/ 逼近/ ,/ 或者/ 采用/ 预测/ 技术/ 估计/ ./ 对于/ 前者/ ,/ 计算/ 复杂度/ 非常/ 高/ ,/ 不适/ 用于/ 实时/ 应用/ 场景/ ;/ 而/ 对于/ 后者/ ,/ 预测/ 的/ 准确性/ 是/ 关键因素/ ./ 而/ 视频信号/ 属于/ 非/ 平稳/ 信号/ ,/ 统计/ 特征/ 非常复杂/ ,/ 难于/ 用/ 简单/ 方式/ 有效/ 地/ 预测/ ./ 关/ ./ 而据/ 文献/ [/ 4/ ]/ ,/ λ/ 在/ 物理/ 意义/ 上/ 对应/ 着/ 码率/ -/ 失真/ 曲线/ 的/ 负/ 斜率/ ./ 因此/ ,/ λ/ 的/ 最佳/ 取值/ 应/ 取决于/ 视频信号/ 的/ 率/ 失真/ 特性/ ./ 如果/ 把/ 式/ (/ 3/ )/ 直接/ 代入/ 式/ (/ 4/ )/ ,/ 可以/ 发现/ λ/ 又/ 是/ 关于/ 失/ 真的/ 函数/ 关系/ ./ 由此/ ,/ 有/ 足够/ 的/ 理由/ 相信/ ,/ λ/ QP/ 种/ 形式/ 的/ 函数/ 关系/ ./ 顾名思义/ ,/ 率/ 失真/ 优化/ 是/ 在/ 失真/ 和/ 码率/ 两个/ 不同/ 的/ 量纲/ 上/ 进行/ 折衷/ 的/ 技术/ ./ 我们/ 知道/ ,/ 失真/ 和/ 码率/ 是/ 无法/ 进行/ 直接/ 比较/ 的/ ,/ 但是/ 如果/ 把/ 它们/ 转化/ 为/ 相同/ 量纲/ ,/ 不是/ 就/ 可以/ 比较/ 了/ 吗/ ?/ 从/ 考虑/ 当前/ 宏块/ 对/ 视频/ 序列/ 总体/ 率/ 失真/ 性能/ 的/ 综合/ 影响/ 最小/ 的/ 角度/ 出发/ ,/ 设计/ 了/ 第/ 1/ 个/ 实验/ ./ 实验/ 1/ ./ 假设/ 存在/ 预测/ 编码/ 的/ 其它/ 判断/ 准则/ ,/ 根据/ 式/ (/ 9/ )/ 的/ 最小值/ 选择/ 当前/ 宏块/ 的/ 编码/ 模式/ :/ J/ (/ mode/ )/ =/ SSDn/ (/ mode/ )/ +/ λ/ (/ 1/ )/ SSDtotaln/ -/ 1Rtotaln/ -/ 1Rn/ (/ mode/ )/ 其中/ ,/ n/ 表示/ 在/ 当前/ 帧/ 内/ 当前/ 宏块/ 序号/ ,/ λ/ (/ 1/ )/ 表示/ 该/ Page4/ 判断/ 准则/ 的/ Lagrange/ 乘子/ ,/ SSDtotaln/ -/ 1/ =/ ∑/ n/ -/ 1/ 当前/ 总/ 失真/ ,/ Rtotaln/ -/ 1/ =/ ∑/ n/ -/ 1/ 实验/ 以/ QP/ -/ L/ 算法/ 优化/ 结果/ {/ SSDQP/ -/ RDOn/ ,/ RQP/ -/ RDOn/ }/ 作为/ 测试/ 基准/ ,/ 如果/ 新/ 判断/ 准则/ 要/ 取得/ 和/ QP/ -/ L/ 算法/ 相近/ 的/ 编码/ 性能/ ,/ 那么/ 对/ 任意/ 优化/ 结果/ {/ Dn/ ,/ Rn/ }/ ,/ λ/ (/ 1/ )/ 应该/ 满足/ 以下/ 条件/ :/ SSDQP/ -/ RDOn/ +/ λ/ (/ 1/ )/ SSDtotaln/ -/ 1Rtotaln/ -/ 1RQP/ -/ RDOn/ / SSDn/ +/ λ/ (/ 1/ )/ SSDtotaln/ -/ 1Rtotaln/ -/ 1Rn/ 等价/ 于/ 下式/ :/ 图/ 1/ λ/ (/ 1/ )/ 可行/ 值/ 分布/ λ/ (/ 1/ )/ / SSDn/ -/ SSDQP/ -/ RDOnSSDtotaln/ -/ 1/ 烄/ 烅/ λ/ (/ 1/ )/ / SSDn/ -/ SSDQP/ -/ RDOnSSDtotaln/ -/ 1/ 烆/ 为了/ 确定/ λ/ (/ 1/ )/ 取值/ 范围/ ,/ 对/ 大量/ 视频/ 序列/ 进行/ Intra/ 模式/ 编码/ 处理/ ,/ 所用/ 的/ 量化/ 参数/ 分别/ 为/ 8/ ,/ 10/ ,/ 12/ ,/ …/ ,/ 50/ ./ 针对/ 每个/ 视频/ 序列/ ,/ 分别/ 统计/ 取值/ 范围/ 的/ 上/ 确界/ (/ Upperbound/ )/ 以及/ 下/ 确界/ (/ Lowerbound/ )/ ./ 实验/ 数据/ 表明/ ,/ 在/ Lowerbound/ 、/ Upperbound/ 之间/ 存在/ 较为/ 明显/ 的/ 分界/ 区域/ ,/ 如图/ 1/ 所示/ ./ 注意/ :/ 实验/ 数/ Page5/ 据/ 绝大多数/ 都/ 满足/ Lowerbound/ </ Upperbound/ ,/ 但是/ ,/ 也/ 会/ 出现/ 少数/ Upperbound/ </ Lowerbound/ 的/ 情况/ ./ 后者/ 意味着/ 无法/ 找到/ 一个/ λ/ (/ 1/ )/ 能够/ 满足/ 式/ (/ 11/ )/ ,/ 也就是说/ 其/ 计算结果/ 不/ 可能/ 与/ QP/ -/ L/ 算法/ 相同/ ,/ 但/ 该/ 情况/ 出现/ 的/ 概率/ 很/ 低/ ,/ 对/ 分析/ 结论/ 的/ 影响/ 可以/ 忽略/ ./ 不妨/ 假设/ 可以/ 用/ 一个/ 函数/ f/ 表示/ Lowerbound/ 、/ Upperbound/ 的/ 分界/ (/ 根据/ 实验/ 结果/ ,/ 实际上/ 可以/ 用/ 线性/ 函数/ 甚或/ 一个/ 常数/ 作为/ f/ 的/ 表达式/ )/ ./ 由此/ 表明/ λ/ QPmode/ 与/ 视频信号/ 统计/ 特性/ 之间/ 可能/ 存在/ 一定/ 形式/ 的/ 简单/ 数学/ 关系/ ./ 上述/ 结论/ 并/ 不适/ 用于/ Inter/ 编码/ 模式/ ./ Inter/ 编码/ 模式/ 拥有/ 更/ 多/ 、/ 更/ 复杂/ 的/ 编码/ 选项/ ,/ 不同/ 选项/ 之间/ 的/ 码率/ -/ 失真/ 特性/ 差异/ 较大/ ,/ 而/ 优化/ 结果/ 仅仅/ 反映/ 单个/ 选项/ 的/ 编码/ 情况/ ./ 因此/ ,/ 无法/ 简单/ 地/ 利用/ 个体/ 的/ 率/ 失真/ 信息/ {/ SSDlagrange/ ,/ Rlagrange/ }/ 有效/ 地/ 表征/ 视频信号/ 的/ 统计/ 特征/ ./ 实验/ 2/ ./ 在/ 图像/ 宏块/ 编码/ 时/ ,/ 针对/ 编码/ 模式/ 及/ 实验/ 1/ 和/ 实验/ 2/ 都/ 表明/ λ/ QPmode/ 与/ 视频信号/ 统计/ 特性/ 之间/ 存在/ 一定/ 形式/ 的/ 简单/ 数学/ 关系/ ./ 由此/ ,/ 我们/ 可以/ 得到/ λ/ 关于/ 视频信号/ 统计/ 特性/ 的/ 一个/ 启发性/ 函数/ 模型/ :/ 下面/ ,/ 我们/ 利用率/ 失真/ 理论/ 验证/ 上述/ 公式/ 的/ 合理性/ ./ 4/ 理论/ 验证/ 对式/ (/ 3/ )/ 采用/ 泰勒/ 级数/ 展开/ ,/ 舍弃/ 高阶/ 项/ ,/ 可以/ 得到/ MPEG/ -/ 4Q2/ 码率/ 模型/ [/ 14/ ]/ :/ 运动/ 估计/ 的/ 所有/ 可能/ 选项/ 及其/ 组合/ ,/ 计算/ 图像/ 失真/ 及/ 码率/ 均值/ :/ SSDaveragen/ =/ ∑/ / / ,/ / / ∑/ / / ,/ / / R/ / / ,/ / / / / ,/ / / 动/ 估计/ 不同/ 组合/ 的/ 基数/ ./ 实验/ 的/ 目的/ 在于/ 针对/ 不同/ 的/ 量化/ 参数/ ,/ 分析/ λ/ QPmode/ 与/ f/ (/ SSDtotaln/ ,/ Rtotaln/ )/ 之间/ 的/ 函数/ 关系/ ,/ 其中/ SSDtotaln/ =/ ∑/ nf/ 表示/ 关于/ SSDtotaln/ 和/ Rtotaln/ 的/ 二元/ 函数/ 关系/ ./ f/ 可能/ 存在/ 多种不同/ 的/ 数学/ 形式/ ,/ 经过/ 多次/ 实验/ ,/ 发现/ λ/ QPmode/ 与/ f/ =/ SSDtotalnRtotaln/ 图/ 2/ 显示/ 了/ 部分/ 实验/ 数据/ ,/ 这些/ 数据/ 都/ 是/ 关于/ 同一个/ 宏块/ (/ 位于/ 第一个/ P/ 帧/ 第/ 5/ 行/ 5/ 列/ )/ 的/ ./ 可以/ 看到/ 在/ λ/ QPmode/ 与/ SSDtotalnRtotaln/ 的/ 函数/ 关系/ 其中/ ,/ X2/ 和/ X1/ 是/ 模型/ 参数/ ,/ 其值/ 可以/ 用/ 线性/ 回归/ 技术/ 加以/ 确定/ ./ 把/ 式/ (/ 13/ )/ 代入/ 式/ (/ 2/ )/ ,/ 则/ 视频/ 编码/ 控制/ 的/ 率/ 失真/ 优化/ 问题/ 可以/ 如下/ 表述/ :/ 得到/ 利用/ Lagrange/ 乘子/ 技术/ ,/ 经过/ 数学/ 推导/ ,/ 可以/ λ/ =/ 2SSD/ 式/ (/ 15/ )/ 与/ 式/ (/ 12/ )/ 在/ 数学/ 表达形式/ 具有/ 一致性/ ./ 在/ 式/ (/ 15/ )/ 中/ ,/ X2/ 是/ 唯一/ 的/ 未/ 定量/ ./ 下面/ ,/ 我们/ 将/ 通过/ 实验/ 和/ 数据分析/ 建立/ X2/ 关于/ 预测/ 残差/ 分量/ 平方和/ (/ SumofSquaresError/ // SSE/ )/ 的/ 数学模型/ ./ Page65/ 犡/ 2/ 数学/ 建模/ 文献/ [/ 11/ ]/ 指出/ ,/ 可以/ 使用/ 线性/ 回归/ 技术/ 计算/ MPEG/ -/ 4Q2/ 码率/ 模型/ 的/ 参数/ X2/ 和/ X1/ ./ 我们/ 在/ 实验/ 中/ 发现/ ,/ 模型/ 参数/ (/ X2/ 和/ X1/ )/ 与/ 预测/ 残差/ SSE/ 之间/ 存在/ 一定/ 的/ 相关性/ ./ 为了/ 对/ 这种/ 关系/ 进行/ 量化/ 分析/ ,/ 设计/ 如下/ 的/ 实验/ :/ 在/ 宏块/ 编码/ 时/ ,/ 记录/ 所有/ 的/ 关于/ 图像/ 失真/ 、/ 预测/ 图/ 3X2/ 关于/ 预测/ 残差/ SSE/ 的/ 函数/ 关系/ 3.94/ E/ +/ 09/ 烄/ 0.00313/ ,/ SSE/ >/ 3038X2/ =/ 烅/ 1E/ -/ 07/ ×/ SSE2/ -/ 0.0002/ ×/ SSE/ +/ 0.041/ ,/ 其它/ 烆/ SSE/ 优化/ 算法/ 具体/ 实现/ 如下/ 所述/ :/ 首先/ ,/ 分配/ 缓冲区/ ,/ 用于/ 保存/ 当前/ 帧/ 以及/ 前/ 一帧/ 每个/ 宏块/ 的/ 平均/ 失真/ 、/ 预测/ 残差/ 平均码率/ 及/ 平均/ SSE/ ./ 针对/ 第一个/ I/ 帧/ ,/ 采用/ QP/ -/ L/ 方法/ 进行/ 优化/ 计算/ ,/ 记录/ 每次/ 编码/ 处理/ 的/ 失真/ 、/ 预测/ 残差/ 码率/ 和/ SSE/ ,/ 并/ 把/ 相关/ 均值/ 保存/ 在/ 缓冲区/ 中/ ;/ 对于/ P/ 帧/ 宏块/ ,/ 在/ 当前/ 帧/ 及/ 前/ 一帧/ 搜索/ 与/ 当前/ 宏块/ 相邻/ (/ |/ Δ/ x/ +/ Δ/ y/ |/ / Radius/ _/ Threshold/ )/ 的/ 已/ 编码/ 宏块/ ,/ 计算/ 各/ 统计/ 信息/ 均值/ ;/ 把/ 所/ 得到/ 的/ 平均/ 失真/ 、/ 平均码率/ 以及/ 平均/ SSE/ 代入/ 到式/ (/ 17/ )/ 中/ ,/ 计算/ 出/ λ/ ;/ 为了/ 避免/ λ/ 变化/ 太/ 大/ ,/ 可以/ 根据/ 历史/ 平均值/ λ/ frameaverage/ 对/ λ/ 进行/ 限制/ ./ 获得/ 的/ λ/ 直接/ 用于/ 模式/ 选择/ ,/ 残差/ 码率/ ;/ 然后/ 根据/ 预测/ 残差/ SSE/ 及/ 量化/ 参数/ ,/ 对/ 这些/ 数据/ 进行/ 分类/ 统计/ ,/ 计算/ 其/ 平均值/ ;/ 然后/ 针对/ 不同/ 的/ 预测/ 残差/ SSE/ ,/ 利用/ 线性/ 回归/ 技术/ 计算/ X2/ ;/ 最后/ ,/ 建立/ X2/ 与/ 预测/ 残差/ SSE/ 之间/ 的/ 函数/ 关系/ ./ 按照/ 上述/ 步骤/ ,/ 进行/ 了/ 大规模/ 的/ 编码/ 实验/ 和/ 数据分析/ ./ 最终/ 得到/ X2/ 与/ 预测/ 残差/ SSE/ 之间/ 的/ 函数/ 关系/ ,/ 如图/ 3/ 所示/ ./ 采用/ 分段/ 拟合/ 函数/ ,/ 得到/ X2/ 与/ 预测/ 残余/ 方差/ 的/ 数学/ 表达式/ :/ 根据/ 以上/ 理论/ 及/ 实验/ 分析/ ,/ 可以/ 获得/ 预测/ 编码/ 控制/ 代价/ 函数/ 乘子/ 的/ 一个/ 新/ 计算公式/ ,/ 如下/ 所示/ :/ )/ -/ 0.00313/ ×/ SSE/ 对于/ 运动/ 补偿/ ,/ 采用/ 槡/ λ/ ./ 在/ 优化/ 计算/ 时/ ,/ 需要/ 记录/ 每次/ 编码/ 处理/ 的/ 失真/ 、/ 预测/ 残余/ 码率/ 和/ SSE/ ,/ 并/ 把/ 相关/ 均值/ 保存/ 在/ 缓冲区/ 中/ ./ 7/ 实验/ 与/ 结果/ 分析/ 在/ H/ ./ 264/ // AVC/ 参考/ 软件/ JM10/ ./ 0/ [/ 12/ ]/ 的/ 基础/ 上/ ,/ 按照/ 编码/ 预测/ 控制/ 优化/ 新/ 算法/ 的/ 要求/ ,/ 改写/ 了/ 部分/ 程序/ ./ 在/ 算法/ 的/ 具体/ 实现/ 中/ ,/ 宏块/ 搜索/ 半径/ Radius/ _/ Threshold/ 设为/ 2/ ;/ 在/ 每个/ 图像/ 帧/ 编码/ 结束/ 时/ ,/ 更新/ 历史/ 平均值/ λ/ frameaverage/ ;/ 在/ 计算/ 宏块/ λ/ 时/ ,/ 按照/ 如下/ 策略/ 对/ 其/ 进行/ 修正/ :/ Page7if/ (/ λ/ >/ λ/ frameaverage/ ×/ 1.25/ )/ ,/ λ/ =/ λ/ frameaverage/ ×/ 1.25/ elseif/ (/ λ/ </ λ/ frameaverage/ ×/ 0.75/ )/ ,/ λ/ =/ λ/ frameaverage/ ×/ 0.75/ 为了/ 客观/ 而/ 全面/ 地/ 评价/ 新/ 优化/ 方法/ 的/ 编码/ 性能/ ,/ 本文/ 对/ Adapt/ -/ L/ 方法/ 和/ QP/ -/ L/ 方法/ 进行/ 了/ 大量/ 的/ 对比/ 编码/ 实验/ ,/ 涵盖/ 了/ 常见/ 的/ QCIF/ 及/ CIF/ 格式/ 的/ 视频/ 测试/ 序列/ ./ 限于/ 文章/ 篇幅/ ,/ 本文/ 只/ 列出/ 部分/ 测试/ 序列/ 的/ 实验/ 结果/ ./ QCIF/ 格式/ 的/ 视频/ 序列/ 包括/ Coastguard/ 、/ Foreman/ 、/ Grandma/ 、/ HallObjects/ 、/ News/ 和/ Salesman/ ,/ 其中/ Coastguard/ 帧/ 率/ 为/ 30/ 帧/ // s/ ,/ Fore/ -/ man/ 和/ Salesman/ 帧/ 率/ 为/ 10/ 帧/ // s/ ,/ Grandma/ 和/ HallObject/ 帧/ 率/ 为/ 15/ 帧/ // s/ ,/ News/ 帧/ 率/ 为/ 3.33/ 帧/ // s/ ./ CIF/ 格式/ 的/ 视频/ 序列/ 包括/ Kettle/ 、/ Mother/ 、/ Paris/ 、/ News/ 图/ 4QP/ -/ L/ 和/ Adapt/ -/ L/ 编码/ 效率/ 比较/ 和/ Silent/ ,/ 其中/ 除/ Paris/ 帧/ 率/ 为/ 7.5/ 帧/ // s/ ,/ 其它/ 均/ 为/ 30/ 帧/ // s/ ./ 测试/ 序列/ GOP/ 结构/ 均/ 按照/ IPPP/ 方式/ 组织/ ,/ 编码/ 总帧/ 数为/ 50/ ./ 视频/ 编码/ 实验/ 采用/ 固定/ 的/ 量化/ 参数/ 进行/ ,/ 量化/ 参数/ 分别/ 设置/ 为/ 28/ ,/ 32/ ,/ 36/ 和/ 40/ ./ 其它/ 的/ 编码/ 参数设置/ 情况/ 为/ :/ 运动/ 估计/ 为/ 1/ // 4/ 像素/ 精度/ ,/ 参考/ 帧/ 数为/ 5/ ,/ Hadamard/ 变换/ 开关/ 打开/ ,/ 熵/ 编码/ 模式/ 设为/ CABAC/ ,/ 运动/ 估计/ 搜索/ 范围/ 设/ 为/ ±/ 32/ ,/ IntraPeriod/ 为/ 0/ ,/ RestrictSearchRange/ 为/ 2/ ./ 图/ 4/ 对/ Adapt/ -/ L/ 方法/ 和/ QP/ -/ L/ 方法/ 的/ 编码/ 效率/ 进行/ 了/ 比较/ (/ 相关/ 实验/ 数据/ 列于/ 表/ 1/ ~/ 2/ 中/ )/ ./ 可见/ ,/ Adapt/ -/ L/ 方法/ 的/ 编码/ 效率/ 优于/ QP/ -/ L/ 方法/ ,/ 为了/ 客观/ 地/ 评价/ 改善/ 程度/ ,/ 进一步/ 采用/ AVSNR/ [/ 13/ ]/ 软件/ 计算/ Page8/ 编码/ 效率/ 增益/ ./ 对于/ QCIF/ 格式/ 的/ 视频/ 序列/ ,/ 据/ 计算/ ,/ Coastguard/ 平均/ 增加/ 0.030/ dB/ ,/ Foreman/ 平均/ 增加/ 0.006/ dB/ ,/ Grandma/ 平均/ 增加/ 0.218/ dB/ ,/ HallOb/ -/ jects/ 平均/ 增加/ 0.214/ dB/ ,/ News/ 平均/ 增加/ 0.084/ dB/ ,/ Salesman/ 平均/ 增加/ 0.208/ dB/ ;/ 对于/ CIF/ 格式/ 的/ 视频/ 序列/ ,/ 据/ 计算/ ,/ Kettle/ 平均/ 增加/ 0.118/ dB/ ,/ Mother/ 平均/ 增加/ 0.201/ dB/ ,/ Paris/ 平均/ 增加/ 0.053/ dB/ ,/ News/ 平均/ 增加/ 0.116/ dB/ ,/ Silent/ 平均/ 增加/ 0.157/ dB/ ./ 测试/ 序列/ 优化/ 方法/ CoastguardForemanGrandmaHall/ _/ ObjectNewsSalesman/ 测试/ 序列/ 优化/ 方法/ KettleMotherParisNewsSilent8/ 结束语/ 本文/ 另辟蹊径/ ,/ 利用率/ 失真/ 理论/ 建立/ λ/ 关于/ 视频信号/ 的/ 率/ 失真/ 统计/ 特征/ 的/ 函数/ 关系/ ,/ 提出/ 了/ 一种/ 新颖/ 的/ 预测/ 编码/ 控制/ 优化/ 方法/ ,/ 能够/ 根据/ 视频信号/ 的/ 率/ 失真/ 统计/ 特征/ ,/ 自/ 适应/ 地/ 调整/ 模型/ 参数/ ./ 经过/ 大量/ 的/ 实验/ 证明/ ,/ Adapt/ -/ L/ 方法/ 的/ 编码/ 效率/ 优于/ QP/ -/ L/ 方法/ ./ 虽然/ Adapt/ -/ L/ 方法/ 的/ 计算/ 相对/ 复杂/ ,/ 由于/ 它/ 不/ 需要/ 引入/ 量化/ 参数/ ,/ 反而/ 为/ 实现/ 高效/ 的/ 、/ 精确/ 的/ 码率/ 控制/ 创造/ 了/ 可能性/ ./ 

