Page1/ 一种/ 关联/ 网络/ 和/ 主机/ 行为/ 的/ 延迟/ 僵尸/ 检测/ 方法/ 何毓锟/ 李强/ 嵇跃德/ 郭东/ (/ 吉林大学/ 计算机科学/ 与/ 技术/ 学院/ 长春/ 130012/ )/ (/ 符号计算/ 与/ 知识/ 工程/ 教育部/ 重点/ 实验室/ (/ 吉林大学/ )/ 长春/ 130012/ )/ 摘要/ 僵尸/ 网络/ 对/ 现有/ 计算机/ 网络安全/ 构成/ 了/ 巨大/ 的/ 威胁/ ./ 新型/ 僵尸/ 经常/ 采用/ 隐蔽/ 技术/ 躲避/ 安全/ 系统/ 的/ 检测/ ./ 采用/ 延迟/ 响应/ 手段/ 的/ 僵尸/ 在/ 网络/ 活动/ 和/ 主机/ 行为/ 之间/ 插入/ 随机/ 时间/ 的/ 延迟/ ,/ 迷惑/ 现有/ 使用/ 关联/ 的/ 检测/ 方法/ ./ 针对/ 延迟/ 僵尸/ 的/ 网络/ 活动/ 和/ 主机/ 行为/ ,/ 提出/ 了/ 一个/ 新/ 的/ 关联/ 检测/ 方法/ ./ 针对/ 延迟/ 僵尸/ 的/ 网络/ 活动/ 和/ 主机/ 行为/ 可能/ 分散/ 在/ 不同/ 时间/ 窗口/ 的/ 问题/ ,/ 使用/ 滑动/ 时间/ 窗口/ 迭代/ 算法/ ,/ 提高/ 了/ 检测/ 准确率/ ./ 针对/ 单纯/ 主机/ 检测/ 方法/ 需要/ 全局/ 部署/ 问题/ ,/ 使用/ 推荐/ 算法/ 关联/ 网络/ 和/ 主机/ 行为/ ,/ 提高/ 了/ 检测/ 的/ 健壮性/ 和/ 准确率/ ./ 分析/ 了/ 滑动/ 时间/ 窗口/ 大小/ 和/ 主机/ 检测工具/ 部署/ 率/ 对/ 检测/ 准确率/ 的/ 影响/ ./ 实验/ 结果表明/ ,/ 方法/ 能/ 有效/ 检测/ 延迟/ 僵尸/ ,/ 当/ 网络/ 中/ 主机/ 检测工具/ 的/ 部署/ 率/ 达到/ 80/ %/ 时/ ,/ 包括/ 未/ 部署/ 检测工具/ 的/ 主机/ 在内/ ,/ 准确率/ 约/ 为/ 88/ %/ ./ 关键词/ 僵尸/ 检测/ ;/ 延迟/ 僵尸/ ;/ 滑动/ 时间/ 窗口/ ;/ 关联/ 引擎/ ;/ 僵尸/ 网络/ 1/ 引言/ 攻击者/ 为了/ 达到/ 恶意/ 目的/ ,/ 利用/ 各种/ 手段/ 在/ 大量/ 计算机/ 中/ 注入/ 特定/ 的/ 恶意代码/ ,/ 通过/ 命令/ 与/ 控制/ 信道/ (/ CommandandControl/ ,/ C/ &/ C/ )/ 远程/ 控制/ 这些/ 计算机/ ,/ 这些/ 计算机/ 组成/ 的/ 可/ 通信/ 可/ 控制/ 的/ 网络/ 称为/ 僵尸/ 网络/ (/ botnet/ )/ ./ 控制/ 这些/ 计算机/ 的/ 组织/ 或/ 个人/ 称为/ 僵尸/ 控制者/ (/ botmaster/ )/ ./ 秘密/ 运行/ 在/ 受控/ 主机/ 上/ ,/ 可以/ 接受/ 预定/ 义/ 的/ 命令/ 和/ 执行/ 预定/ 义/ 的/ 功能/ 的/ 恶意代码/ 称为/ 僵尸/ (/ Bot/ )/ ./ 僵尸/ 网络/ 常/ 被/ 用于/ 分布式/ 拒绝服务/ 攻击/ (/ DDoS/ )/ 、/ 发送/ 垃圾邮件/ (/ Spam/ )/ 、/ 网络/ 钓鱼/ (/ Phishing/ )/ 、/ 窃取/ 机密信息/ (/ Informationtheft/ )/ 、/ 传播/ 其它/ 恶意软件/ 等/ ./ 在/ 僵尸/ 网络/ 发展/ 过程/ 中/ ,/ 有/ 一类/ 通过/ 在/ 网络/ 活动/ 和/ 主机/ 行为/ 之间/ 插入/ 随机/ 时间/ 的/ 僵尸/ ,/ 可/ 称为/ 延迟/ 响应/ 僵尸/ ./ CERT/ 的/ 报告/ ①/ 曾/ 分析/ 了/ 一种/ 基于/ Web/ 的/ 僵尸/ ,/ 该/ 僵尸/ 获取/ 命令/ 后/ 等待/ 一段时间/ 再/ 进行/ 相应/ 操作/ ./ SECUREWORKS/ 的/ 报告/ 中/ 也/ 发现/ 了/ Vecebot/ 有/ 延迟/ 响应/ 时间/ 的/ 参数/ DelayTime/ ./ botmaster/ 通过/ C/ &/ C/ 通信/ 信道/ 对/ Bot/ 发布命令/ ,/ Bot/ 接收/ 到/ 命令/ 后/ 并/ 不是/ 立即/ 产生/ 恶意/ 行为/ ,/ 可能/ 有/ 一定/ 的/ 响应/ 延迟/ ./ 在/ 不同/ 的/ 受/ 感染/ 主机/ 上/ ,/ 响应/ 延迟/ 的/ 时间/ 也/ 可能/ 不同/ ,/ 延迟/ 响应/ 僵尸/ 的/ 网络/ 活动/ 和/ 主机/ 行为/ 可能/ 并/ 不/ 在/ 同一个/ 时间段/ 内/ ,/ 这样/ 单纯/ 按照/ 预定/ 的/ 时间/ 窗口/ 对/ 网络/ 活动/ 和/ 主机/ 行为/ 进行/ 关联/ 的/ 方法/ 就/ 可能/ 无效/ ./ 图/ 1/ 是/ 僵尸/ 程序/ 网络/ 活动/ 和/ 主机/ 行为/ 的/ 一个/ 时间/ 顺序/ 图/ ,/ 横轴/ 是/ 时间/ 窗口/ 的/ 变化/ ,/ 灰色/ 的/ 区域/ 表示/ 僵尸/ 正在/ 进行/ 网络/ 活动/ ,/ 黑色/ 区域/ 表示/ 僵尸/ 正在/ 进行/ 主机/ 行为/ ./ b1/ 和/ b2/ 是/ 实时/ 响应/ 僵尸/ ,/ 他们/ 的/ 网络/ 活动/ 和/ 主机/ 行为/ 都/ 在/ 同一个/ 时间/ 窗口/ 内/ ,/ b3/ 和/ b4/ 是/ 延迟/ 响应/ 僵尸/ ,/ 他们/ 的/ 网络/ 活动/ 和/ 主机/ 行为/ 可能/ 分散/ 在/ 不同/ 的/ 时间/ 窗口/ 中/ ./ 近年来/ ,/ 研究者/ 对/ 僵尸/ 网络/ 的/ 检测/ 和/ 防御/ 做/ 了/ 大量/ 的/ 工作/ ,/ 从/ 检测/ 位置/ 上/ 看/ 主要/ 分为/ 两大类/ :/ (/ 1/ )/ 主机/ 检测/ ,/ 主要/ 利用/ 僵尸/ 程序/ 在/ 主机/ 上/ 运行/ 时/ ,/ 网络通信/ 、/ 文件/ 资源/ 使用/ 、/ CPU/ 占用/ 、/ 内存/ 占用/ 、/ 注册表/ 信息/ 修改/ 、/ 系统/ API/ 调用/ 等/ 多个/ 方面/ 的/ 信息/ 与/ 正常/ 程序/ 不同/ 的/ 特性/ ,/ 来/ 检测/ 可能/ 已/ 感染/ 僵尸/ 程序/ 的/ 主机/ ./ 如/ Park/ 等/ 人/ [/ 1/ ]/ 提出/ 的/ BotTee/ 方法/ ,/ Stinson/ 等/ 人/ [/ 2/ ]/ 提出/ 的/ BotSwat/ 方法/ ,/ Liu/ 等/ 人/ [/ 3/ ]/ 提出/ 的/ BotTracer/ 方法/ ;/ (/ 2/ )/ 网络/ 检测/ ,/ 抓取/ 网络/ 中/ 主机/ 间通信/ 的/ 流量/ 信息/ ,/ 过滤/ 后/ 进行/ 特征提取/ ,/ 然后/ 使用/ 一些/ 算法/ 区分/ 正常/ 通信/ 的/ 主机/ 和/ 已/ 感染/ 僵尸/ 程序/ 的/ 主机/ ./ 如/ Coskun/ 等/ 人/ [/ 4/ ]/ 提出/ 的/ 利用/ “/ 敌人/ 的/ 朋友/ ”/ 的/ 方法/ ,/ Nagaraja/ [/ 5/ ]/ 等/ 人/ 提出/ 了/ 结构图/ 分析法/ BotGrep/ ,/ Collins/ 和/ Reiter/ 提出/ 的/ 分析/ 流量/ 协议/ 图/ 的/ 异常/ 变化/ 的/ 方法/ [/ 6/ ]/ ./ 然而/ 单纯/ 主机/ 层面/ 的/ 检测/ 或/ 网络/ 层面/ 的/ 检测/ ,/ 在/ 检测/ 的/ 准确性/ 、/ 误报率/ 、/ 漏报/ 率/ 、/ 性能/ 、/ 用户/ 隐私/ 、/ 健壮性/ 、/ 是否/ 需要/ 全局/ 部署/ 等/ 问题/ 上/ 存在/ 一定/ 的/ 不足/ ./ Zeng/ 等/ 人/ [/ 7/ ]/ 提出/ 了/ 首个/ 主机/ 和/ 网络/ 结合/ 的/ 僵尸/ 网络/ 检测/ 方法/ ,/ 使用/ 网络/ 触发/ 的/ 方式/ ,/ 按照/ 预定/ 的/ 时间/ 窗口/ ,/ 关联/ 引擎/ 结合/ 主机/ 检测/ 的/ 结果/ 和/ 网络流量/ 聚类分析/ 后/ 的/ 结果/ ,/ 得到/ 最终/ 的/ 检测/ 结果/ ./ Zeng/ 等/ 人/ 的/ 方法/ 能/ 有效/ 地/ 检测/ 使用/ IRC/ 、/ HTTP/ 、/ P2P/ 通信协议/ 的/ 僵尸/ 网络/ ,/ 有/ 较/ 高/ 的/ 准确性/ ,/ 但/ 在/ 主机/ 检测/ 部分/ 仍/ 需要/ 全局/ 部署/ ,/ 即/ 网络/ 中/ 的/ 主机/ 都/ 需要/ 部署/ 主机/ 检测工具/ 才能/ 有效/ ,/ 检测/ 方法/ 的/ 健壮性/ 仍然/ 不足/ ./ 同时/ 在/ 面对/ 延迟/ 通信/ 僵尸/ 时/ ,/ 由于/ 僵尸/ 程序/ 的/ 主机/ 行为/ 和/ 网络/ 活动/ 可能/ 并/ 不是/ 同时/ 进行/ 的/ ,/ 可能/ 分布/ 在/ 不同/ 的/ 时间/ 窗口/ ,/ 因此/ 单纯/ 按照/ 时间/ 窗口/ 获取/ 主机/ 行为/ 和/ 网络/ 活动/ 的/ 方法/ 可能/ 无效/ ./ Shin/ 等/ 人/ [/ 8/ ]/ 的/ EFFORT/ 方法/ ,/ 也/ 使用/ 了/ 关联/ 的/ 方法/ ,/ 对/ 主机/ 进程/ 的/ 多个/ 模块/ 检测/ 结果/ 关联/ ,/ 产生/ 最终/ 结果/ 以/ 判断/ 主机/ 是否/ 感染/ 僵尸/ 程序/ ./ 针对/ 僵尸/ 检测/ 过程/ 中/ ,/ 检测工具/ 健壮性/ 不足/ 、/ 需要/ 全局/ 部署/ 、/ 不能/ 有效/ 检测/ 通信/ 延迟/ 僵尸/ 等/ 问题/ ,/ 在/ 保证/ 准确率/ 和/ 性能/ 的/ 情况/ 下/ ,/ 我们/ 提出/ 了/ 在/ 滑动/ 的/ 时间/ 窗口/ 内/ ,/ 对/ 网络流量/ 和/ 主机/ 检测/ 结果/ 使用/ 关联/ 算法/ 分析/ ,/ 以/ 检测/ 网络/ 中/ 感染/ 延迟/ 响应/ 僵尸/ 的/ 主机/ ./ 包括/ 3/ 个/ 部分/ :/ (/ 1/ )/ 按照/ 预定/ 的/ 时间/ 窗口/ ,/ 获取/ 主机/ ①/ IanelliN/ ,/ HackworthA/ ./ BotnetsasavehicleforonlinePage3/ 流量/ 相似/ 度/ 和/ 主机/ 检测/ 可疑/ 度/ ;/ (/ 2/ )/ 在/ 滑动/ 时间/ 窗口/ 内/ ,/ 对/ 网络/ 活动/ 和/ 主机/ 行为/ 进行/ 迭代/ 计算/ ;/ (/ 3/ )/ 对/ 网络/ 和/ 主机/ 的/ 分析/ 结果/ 使用/ 关联/ 算法/ ,/ 最终/ 得到/ 网络/ 中/ 部署/ 或/ 未/ 部署/ 僵尸/ 主机/ 检测工具/ 的/ 所有/ 主机/ 的/ 检测/ 结果/ ./ 本文/ 主要/ 贡献/ :/ (/ 1/ )/ 针对/ 延迟/ 响应/ 僵尸/ ,/ 使用/ 了/ 滑动/ 时间/ 窗口/ 对/ 主机/ 和/ 网络/ 数据/ 进行/ 迭代/ 分析/ ,/ 在/ 一定/ 程度/ 上/ 提高/ 了/ 僵尸/ 检测/ 准确率/ ,/ 降低/ 了/ 漏报/ 率/ ;/ (/ 2/ )/ 在/ 滑动/ 时间/ 窗口/ 内/ ,/ 使用/ 推荐/ 算法/ 关联/ 获取/ 的/ 网络流量/ 相似/ 度/ 和/ 主机/ 可疑/ 度/ ,/ 提高/ 了/ 僵尸/ 检测/ 方法/ 的/ 健壮性/ ./ 同时/ 检测工具/ 不/ 需要/ 全局/ 部署/ ,/ 整个/ 网络/ 中/ 的/ 主机/ 不/ 需要/ 全部/ 部署/ 检测工具/ ,/ 只要/ 部署/ 数量/ 达到/ 一定/ 的/ 规模/ ,/ 可以/ 通过/ 现有/ 主机/ 检测/ 结果/ 和/ 网络流量/ 分析/ 结果/ ,/ 对/ 未/ 部署/ 主机/ 产生/ 可靠/ 的/ 检测/ 结果/ ;/ (/ 3/ )/ 实现/ 了/ 一个/ 基于/ 滑动/ 时间/ 窗口/ 关联/ 网络/ 活动/ 和/ 主机/ 行为/ 的/ 僵尸/ 检测/ 模型/ ./ 在/ 滑动/ 时间/ 窗口/ 大小/ 和/ 主机/ 检测工具/ 部署/ 率/ 两个/ 指标/ 上/ ,/ 对/ 检测/ 方法/ 的/ 有效性/ ,/ 进行/ 实验/ 分析/ ./ 滑动/ 时间/ 窗口/ 在/ 一定/ 程度/ 上/ 解决/ 了/ 延迟/ 响应/ 僵尸/ 的/ 网络/ 活动/ 和/ 主机/ 行为/ 分布/ 在/ 不同/ 时间/ 窗口/ 的/ 问题/ ,/ 关联/ 主机/ 和/ 网络/ 行为/ 的/ 推荐/ 方法/ 能/ 提高/ 检测/ 的/ 健壮性/ 和/ 准确率/ ./ 本文/ 第/ 2/ 节/ 介绍/ 相关/ 工作/ ;/ 第/ 3/ 节/ 给出/ 问题/ 描述/ 、/ 假设/ 和/ 方法/ ;/ 第/ 4/ 节/ 实现/ 网络流量/ 分析/ 并/ 获取/ 主机/ 检测/ 可疑/ 度/ ,/ 分析/ 滑动/ 时间/ 窗口/ 内/ 网络/ 活动/ 和/ 主机/ 行为/ ,/ 并/ 使用/ 推荐/ 算法/ 进行/ 关联/ ;/ 第/ 5/ 节/ 建立/ 实验/ 环境/ 并/ 分析/ 实验/ 结果/ ;/ 第/ 6/ 节/ 与/ 同类/ 工作/ 进行/ 对比/ ;/ 第/ 7/ 节/ 给出/ 总结/ 和/ 讨论/ ./ 2/ 相关/ 工作/ 主机/ 检测/ 主要/ 包括/ 主机/ 通信/ 域名/ 信誉/ 值/ 分析/ 、/ API/ 调用/ 序列/ 分析/ 、/ 系统资源/ 使用/ 分析/ 、/ 主机/ 网络通信/ 行为/ 分析/ ./ (/ 1/ )/ Park/ 等/ 人/ [/ 1/ ]/ 提出/ 了/ BotTee/ 方法/ ,/ 通过/ 提取/ 出/ 主机/ 上/ 可疑/ 的/ 系统/ 调用/ 序列/ ,/ 与/ 僵尸/ 命令/ 模板/ 进行/ 匹配/ ,/ 检测/ 主机/ 是否/ 感染/ 僵尸/ 程序/ ;/ (/ 2/ )/ Rieck/ 等/ 人/ [/ 9/ ]/ 提出/ 的/ 方法/ ,/ 使用/ 机器/ 学习/ 自动/ 分析/ 恶意软件/ 的/ 行为/ ;/ (/ 3/ )/ Karbalaie/ 等/ 人/ [/ 10/ ]/ 提出/ 的/ 方法/ ,/ 使用/ 数据挖掘/ 进行/ 语义/ 分析/ 检测/ 主机/ 上/ 的/ 恶意软件/ ;/ (/ 4/ )/ Stinson/ 等/ 人/ [/ 2/ ]/ 的/ 方法/ BotSwat/ ,/ 通过/ 判断/ 主机/ 执行/ 的/ 命令/ 是否/ 使用/ 来自/ 网络/ 上/ 的/ 数据/ ,/ 将/ 僵尸/ 行为/ 与/ 正常/ 程序/ 区分/ 开来/ ;/ (/ 5/ )/ Liu/ 等/ 人/ [/ 3/ ]/ 的/ 方法/ BotTracer/ 根据/ 僵尸/ 攻击/ 的/ 3/ 个/ 不可/ 缺少/ 的/ 阶段/ 判断/ 是否/ 感染/ 僵尸/ ;/ (/ 6/ )/ Kolbitsch/ 等/ 人/ [/ 11/ ]/ 将/ 拦截/ 到/ 的/ 系统/ 调用/ 序列/ 与/ 恶意/ 行为/ 图/ 进行/ 匹配/ ,/ 根据/ 匹配/ 结果/ 判断/ 是否是/ 恶意/ 行为/ ;/ (/ 7/ )/ Al/ -/ Hammadi/ 等/ 人/ [/ 12/ ]/ 使用/ 人工/ 免疫学/ [/ 13/ ]/ 的/ 知识/ ,/ 利用/ 树突/ 状/ 细胞/ 算法/ (/ DendriticCellAlgorithm/ ,/ DCA/ )/ [/ 14/ ]/ 进行/ 主机/ 端的/ 僵尸/ 检测/ ;/ (/ 8/ )/ Xu/ 等/ 人/ [/ 15/ ]/ 的/ 方法/ PeerPress/ 将/ 主机/ 行为/ 与/ 网络/ 活动/ 结合/ 进行/ 主动/ 检测/ ,/ 在/ 主机/ 端/ 动态/ 地/ 对/ 恶意软件/ 分析/ ,/ 自动/ 提取/ 出/ P2P/ 恶意软件/ 的/ MalwareControlBirthmarks/ (/ MCB/ )/ ,/ 然后/ 使用/ 网络/ 中/ 的/ 扫描器/ 检测/ 网络/ 中/ 的/ 主机/ 是否/ 被/ P2P/ 恶意软件/ 感染/ ./ 网络/ 检测/ 方法/ 主要/ 包括/ 流量/ 图/ 分析/ 、/ 流量/ 特征/ 聚类分析/ 或/ 机器/ 学习/ 处理/ 分析/ 、/ 流量/ 网络/ 行为/ 分析/ ./ 如/ Tegeler/ 等/ 人/ [/ 16/ ]/ 提出/ 的/ BotFinder/ 方法/ ,/ 使用/ 了/ 机器/ 学习/ 的/ 方法/ ,/ 将/ 抓取/ 的/ 网络流量/ 通过/ 学习/ 的/ 方式/ 分为/ 正常/ 和/ 恶意/ 两种/ 模型/ ,/ 最后/ 通过/ 生成/ 的/ 模型/ 检测/ 主机/ 产生/ 的/ 流量/ 是否/ 为/ 恶意/ ;/ Bilge/ 等/ 人/ [/ 17/ ]/ 提出/ 的/ DISCLOSURE/ 方法/ ,/ 使用/ 大规模/ NetFlow/ 数据/ ,/ 提取/ 流量/ 特征/ 并/ 分析/ 后/ ,/ 检测/ 僵尸/ 网络/ 中/ 的/ C/ &/ C/ 服务器/ ;/ Francois/ 等/ 人/ [/ 18/ ]/ 提出/ 的/ Bottrack/ 方法/ ,/ 通过/ NetFlow/ 数据分析/ 和/ PageRank/ 算法/ 分析/ 僵尸/ 通信/ 行为/ 模式/ ./ 使用/ 关联/ 的/ 方法/ 主要/ 包括/ 主机/ 检测/ 中/ 不同/ 模块/ 之间/ 的/ 关联/ 、/ 网络分析/ 中/ 不同/ 模块/ 之间/ 的/ 关联/ 、/ 主机/ 和/ 网络/ 结果/ 关联/ ./ Shin/ 等/ 人/ [/ 8/ ]/ 提出/ 的/ EFFORT/ 方法/ ,/ 关联/ 主机/ 中/ 多个/ 模块/ 的/ 检测/ 信息/ ,/ 得到/ 最终/ 的/ 主机/ 检测/ 结果/ ./ Gu/ 等/ 人/ [/ 19/ ]/ 提出/ 的/ BotMiner/ 方法/ ,/ 关联/ 不同/ 层次/ 流量/ 聚类分析/ 的/ 结果/ ./ Gu/ 等/ 人/ [/ 20/ ]/ 提出/ 的/ BotSniffer/ 方法/ ,/ 关联/ 网络/ 活动/ 分析/ 结果/ 和/ 通信/ 内容分析/ 结果/ ,/ 产生/ 最终/ 的/ 检测/ 报告/ ./ Zeng/ 等/ 人/ [/ 7/ ]/ 提出/ 的/ 关联/ 方法/ ,/ 关联/ 主机/ 检测/ 结果/ 和/ 网络流量/ 聚类/ 信息/ ,/ 最终/ 产生/ 部署/ 检测工具/ 的/ 主机/ 的/ 检测/ 结果/ ./ 在/ 使用/ 基于/ 主机/ 的/ 检测/ 方法/ 时/ ,/ 当/ 主机/ 上/ 的/ 检测工具/ 损坏/ 或/ 被/ 恶意/ 僵尸/ 程序/ 破坏/ ,/ 检测/ 方法/ 将/ 完全/ 失效/ 并且/ 网络/ 中/ 的/ 所有/ 主机/ 都/ 必须/ 部署/ 检测工具/ ,/ 没有/ 部署/ 的/ 主机/ 将/ 无法/ 检测/ ./ 使用/ 网络流量/ 的/ 检测/ 方法/ 中/ ,/ 由于/ 未/ 结合/ 主机/ 检测/ 信息/ ,/ 单纯/ 依靠/ 网络通信/ 流量/ 判断/ 是否/ 为/ 僵尸/ 主机/ ,/ 存在/ 较大/ 误差/ ./ 使用/ 主机/ 和/ 网络/ 结合/ 的/ 方法/ 能/ 有效/ 弥补/ 单纯/ 方法/ 的/ 不足/ ,/ 提高/ 检测/ 的/ 效率/ ./ 对于/ 延迟/ 类/ 僵尸/ 的/ 检测/ ,/ 按照/ 时间/ 窗口/ 获取数据/ 的/ 检测/ 方法/ ,/ 准确率/ 将会/ 受到/ 延迟时间/ 长短/ 和/ 获取数据/ 的/ 时间/ 窗口/ 大小/ 的/ 影响/ ,/ 如/ BotSniffer/ 方法/ [/ 20/ ]/ 在/ 获取/ 僵尸/ 程序/ 的/ 命令/ 与/ 反馈/ 信息/ 时/ ,/ 如果/ 僵尸/ 命令/ 延迟/ 响应/ 时间/ 较长/ 或/ 获取信息/ 的/ 时间/ 窗口/ 较/ 短/ ,/ 一些/ 僵尸/ 活动/ 信息/ 将/ 无法/ 获取/ ,/ 导致/ 准确率/ 降低/ ./ Page43/ 方法/ 设计/ 3.1/ 问题/ 描述/ 及/ 假设/ 主机/ 上/ 的/ 僵尸/ 程序/ 在/ 接收/ 到/ 命令/ 后/ 会/ 表现/ 出/ 恶意/ 行为/ ,/ 如/ 文件/ 资源分配/ 、/ 注册表/ 产生/ 、/ 主机/ 上/ 的/ 网络通信/ 、/ CPU/ 占用/ 、/ 内存/ 占用/ 等/ ./ 这些/ 都/ 可以/ 在/ 主机/ 上/ 获取/ 到/ ,/ 而且/ 这些/ 特征/ 都/ 是/ 僵尸/ 程序/ 后台/ 自动/ 产生/ 的/ ,/ 而/ 非人/ 为/ 操作/ ,/ 因此/ 可以/ 在/ 主机/ 上/ 监控/ 这些/ 信息/ ,/ 进而/ 分析/ 得到/ 主机/ 感染/ 僵尸/ 程序/ 的/ 可疑/ 度/ ./ 僵尸/ 控制者/ 和/ 受控/ 的/ 僵尸/ 主机/ 通信/ 的/ 过程/ 中/ ,/ 在/ 通信/ 流量/ 上/ 有/ 很大/ 的/ 相似性/ ./ 在/ 集中式/ 的/ 结构/ 中/ 僵尸/ 主机/ 几乎/ 同时/ 接收/ 来自/ 集中式/ 服务器/ 的/ 命令/ ,/ 并且/ 通信/ 的/ 流量/ 在/ 数据包/ 的/ 多少/ 、/ 数据包/ 的/ 大小/ 、/ 通信/ 的/ 时间/ 、/ 使用/ 的/ 端口数/ 等/ 特征/ 上/ 有/ 极大/ 的/ 相似性/ ./ 在/ 分布式/ 结构/ 中/ ,/ 僵尸/ 控制者/ 发布/ 的/ 命令/ 也/ 需要/ 在/ 主机/ 间/ 传播/ ,/ 他们/ 之间/ 的/ 流量/ 也/ 表现/ 出/ 极大/ 的/ 相似性/ ./ 对于/ 延迟/ 僵尸/ 的/ 网络/ 活动/ 和/ 主机/ 行为/ ,/ 考虑/ 僵尸/ 活动/ 在/ 实际/ 应用/ 中/ 的/ 需要/ ,/ 假设/ 网络/ 活动/ 和/ 主机/ 行为/ 延迟/ 响应/ 的/ 时间/ 间隔/ 会/ 在/ 一个/ 固定/ 大小/ 的/ 时间段/ 内/ ./ 这样/ 利用/ 主机/ 上/ 已有/ 检测/ 结果/ 和/ 网络分析/ 后/ 得到/ 的/ 主机/ 间/ 流量/ 相似/ 度/ ,/ 通过/ 关联/ 算法/ 可/ 在/ 一定/ 程度/ 上/ 检测/ 网络/ 中未/ 部署/ 检测工具/ 或/ 检测工具/ 失效/ 的/ 主机/ 是否/ 感染/ 延迟/ 僵尸/ 程序/ ./ 根据/ 以上/ 假设/ ,/ 针对/ 延迟/ 响应/ 僵尸/ ,/ 采用/ 滑动/ 时间/ 窗口/ 策略/ ,/ 设计/ 结合/ 不同/ 主机/ 流量/ 相似/ 度/ 和/ 主机/ 感染/ 僵尸/ 程序/ 可疑/ 度/ 的/ 关联/ 方法/ ./ 产生/ 网络/ 中/ 所有/ 主机/ 的/ 检测/ 报告/ ./ 方法/ 主要/ 针对/ 一个/ 大型/ 局域网/ 中/ 延迟/ 响应/ 僵尸/ ,/ 当/ 主机/ 检测工具/ 部署/ 率/ 达到/ 一定/ 程度/ 时/ ,/ 能/ 有效/ 检测/ 使用/ IRC/ 、/ HTTP/ 、/ P2P/ 作为/ C/ &/ C/ 通信/ 信道/ 的/ 延迟/ 响应/ 僵尸/ ,/ 对于/ 未知/ 或/ 现有/ 僵尸/ 程序/ 的/ 变种/ 的/ 检测/ 效果/ 主要/ 取决于/ 主机/ 检测工具/ 的/ 准确率/ ./ 3.2/ 方法/ 结构图/ 2/ 是/ 方法/ 的/ 结构图/ ./ 主要/ 分为/ 4/ 个/ 部分/ ,/ 包括/ 主机/ 可疑/ 度/ 获取/ 、/ 网络流量/ 分析/ 、/ 滑动/ 时间/ 窗口/ 信息/ 的/ 迭代/ 和/ 关联/ 引擎/ ./ 获取/ 主机/ 感染/ 僵尸/ 程序/ 的/ 可疑/ 度时/ ,/ 利用/ 已有/ 主机/ 检测工具/ 获取/ ./ 部署/ 在/ 网络/ 中/ 的/ 主机/ 检测工具/ 可以/ 是/ 同一/ 结构/ 、/ 同一/ 原理/ 、/ 同一/ 级别/ 的/ 僵尸/ 检测/ 软件/ ,/ 也/ 可以/ 是/ 不同/ 的/ ./ 当/ 主机/ 检测工具/ 发现/ 僵尸/ 活动/ 后/ ,/ 立即/ 分析/ 活动/ 的/ 特征/ ,/ 产生/ 感染/ 僵尸/ 的/ 可疑/ 度/ ,/ 并/ 将/ 产生/ 的/ 可疑/ 度/ 发送到/ 滑动/ 时间/ 窗口/ 主机/ 信息/ 处理器/ ./ 网络流量/ 分析/ 时/ ,/ 按照/ 预定/ 的/ 时间/ 窗口/ 抓取/ 整个/ 网络/ 中/ 主机/ 通信/ 流量/ ,/ 对/ 获取/ 的/ 流量/ 进行/ 白名单/ 过滤/ 、/ 特征提取/ 、/ 聚类分析/ 和/ 相似/ 度/ 计算/ ./ 在/ 每个/ 时间/ 窗口/ 结束/ 时/ ,/ 将/ 最终/ 分析/ 的/ 主机/ 流量/ 相似/ 度/ 结果/ 发送到/ 滑动/ 时间/ 窗口/ 网络/ 信息/ 处理器/ ./ 滑动/ 时间/ 窗口/ 信息/ 处理器/ ,/ 接收/ 主机/ 检测/ 可疑/ 度/ 和/ 网络流量/ 相似/ 度/ 分析/ 结果/ ,/ 并/ 按照/ 预定/ 大小/ 时间/ 窗口/ 对/ 接收/ 的/ 信息/ 存储/ ,/ 分析/ 在/ 一个/ 滑动/ 时间/ 窗口/ 网络/ 内/ ,/ 主机/ 可疑/ 度/ 迭代/ 结果/ 和/ 主机/ 流量/ 相似/ 度/ 迭代/ 结果/ ./ 最后/ 将/ 主机/ 可疑/ 度/ 和/ 主机/ 流量/ 相似/ 度/ 在/ 滑动/ 时间/ 窗口/ 内/ 的/ 迭代/ 结果/ 发送到/ 关联/ 引擎/ ./ 关联/ 引擎/ ,/ 对/ 接收/ 到/ 的/ 网络/ 活动/ 和/ 主机/ 行为/ 分析/ 结果/ ,/ 使用/ 推荐/ 算法/ 进行/ 关联/ 分析/ ,/ 最终/ 确定/ 网络/ 中/ 已经/ 感染/ 延迟/ 僵尸/ 的/ 主机/ ./ 4/ 方法/ 实现/ 信息/ 获取/ 包括/ 网络/ 中/ 所有/ 主机/ 的/ 流量/ 信息/ 的/ 获/ 基于/ 在/ 滑动/ 时间/ 窗口/ 内/ 关联/ 网络/ 活动/ 和/ 主机/ 行为/ 结构/ ,/ 我们/ 实现/ 了/ 一个/ 延迟/ 响应/ 僵尸/ 检测/ 系统/ 模型/ ./ 主要/ 由/ 3/ 部分/ 构成/ ,/ (/ 1/ )/ 信息/ 的/ 获取/ ,/ 包括/ 网络流量/ 信息/ 和/ 主机/ 检测/ 结果/ ;/ (/ 2/ )/ 滑动/ 时间/ 窗口/ 内/ 信息/ 的/ 迭代/ ,/ 包括/ 网络流量/ 相似/ 度/ 的/ 迭代/ 和/ 主机/ 可疑/ 度/ 的/ 迭代/ ;/ (/ 3/ )/ 关联/ 引擎/ ,/ 使用/ 推荐/ 算法/ 关联/ 主机/ 可疑/ 度/ 和/ 网络流量/ 相似/ 度/ ./ 4.1/ 信息/ 获取/ 取/ 和/ 主机/ 可疑/ 度/ 的/ 获取/ ./ 4.1/ ./ 1/ 网络流量/ 信息/ 为了/ 获取/ 网络/ 中/ 主机/ 通信/ 流量/ 的/ 相似/ 度/ ,/ 首先/ 需要/ 按/ 预定/ 的/ 时间/ 窗口/ 抓取/ 整个/ 网络/ 的/ 通信/ 流量/ ,/ 然后/ 进行/ 过滤/ 、/ 特征提取/ 、/ 聚类分析/ 和/ 流量/ 特征/ 的/ 相似/ 度/ 计算/ ./ 流量/ 过滤/ 主要/ 为了/ 减小/ 数据处理/ 复杂度/ ./ 对于/ 已/ 获取/ 的/ 流量/ 数据/ ,/ 通过/ IP地址/ 白名单/ 进行/ 过滤/ ,/ 我们/ 认为/ 用户/ 主机/ 和/ 白名单/ 中/ 主机/ 的/ 通信/ 是/ 安全/ Page5/ 的/ ,/ 如/ www/ ./ google/ ./ com/ 、/ www/ ./ microsoft/ ./ com/ 等/ 对应/ 的/ IP/ 所/ 产生/ 的/ 流量/ 都/ 被/ 过滤/ 掉/ ,/ 这样/ 在/ 网络流量/ 分析阶段/ 可以/ 很大/ 程度/ 上/ 减少/ 数据量/ ,/ 进而/ 减小/ 计算/ 开销/ ./ 而/ 对于/ 局域网络/ 内部/ 主机/ 间/ 的/ 流量/ 不/ 进行/ 过滤/ ,/ 因为/ 在/ 使用/ P2P/ 作为/ C/ &/ C/ 通信/ 信道/ 的/ 僵尸/ 网络/ 中/ ,/ 内部/ 网络/ 主机/ 间/ 也/ 会/ 产生/ 通信/ ,/ 而且/ 他们/ 的/ 通信/ 流量/ 是/ 相似/ 的/ ,/ 可/ 用于/ 关联/ 分析/ 以/ 检测/ 是否/ 感染/ 僵尸/ 程序/ ./ 对/ 获取/ 的/ 整个/ 网络/ 的/ 主机/ 通信/ 流量/ 过滤/ 后/ ,/ 从/ 过滤/ 后/ 的/ 数据/ 中/ 提取/ 主机/ 通信/ 的/ 基本/ 信息/ ./ 一个/ 数据流/ 包含/ 的/ 基本/ 信息/ 有/ :/ dpkts/ 是/ 发送/ 数据包/ 的/ 数量/ 、/ doctets/ 是/ 发送/ 的/ 字节数/ 、/ first/ 是/ 连接/ 建立/ 的/ 时间/ 戳/ 、/ last/ 是/ 连接/ 结束/ 的/ 时间/ 戳/ 、/ srcaddr/ 是/ 产生/ 流/ 的/ 源/ IP地址/ 、/ dstaddr/ 是/ 产生/ 流/ 的/ 目的/ IP地址/ 、/ srcport/ 是/ 流/ 的/ 源/ 发送/ 端口/ 、/ dstport/ 是/ 流/ 的/ 目的/ 端口/ 、/ prot/ 是/ 产生/ 流所/ 使用/ 的/ 协议/ ./ 根据/ 通信/ 主机/ 的/ IP地址/ 提取/ 流/ 的/ 特征/ ,/ 考虑/ 到/ 储存/ 在/ 主机/ 上/ 的/ 僵尸/ 程序/ 通常/ 产生/ 较少/ 的/ 流量/ ,/ 如果/ 单纯/ 收集/ 某一/ 主机/ 和/ 其它/ 主机/ 通信/ 产生/ 流量/ ,/ 僵尸/ 程序/ 通过/ C/ &/ C/ 控制/ 信道/ 和/ 僵尸/ 控制者/ 通信/ 产生/ 的/ 流量/ 很/ 可能/ 被/ 其它/ 流量/ 掩盖/ ,/ 导致/ 僵尸/ 产生/ 的/ 流量/ 特征/ 不/ 明显/ ,/ 不利于/ 获取/ 不同/ 主机/ 在/ 同一时间/ 窗口/ 内/ 产生/ 的/ 流量/ 相似/ 度/ ./ 因此/ ,/ 我们/ 不/ 考虑/ 流/ 的/ 方向/ ,/ 即/ 不/ 区分/ 流量/ 的/ 源/ 主机/ IP/ 和/ 目标/ 主机/ IP/ ,/ 统计/ 一个/ 预定/ 时间/ 窗口/ 内/ 两/ 主机/ 的/ 所有/ 通信/ 流量/ ,/ 产生/ 一个/ 由/ 14/ 个/ 流量/ 统计/ 特征/ 组成/ 的/ 向量/ ./ 如表/ 1/ 所示/ ,/ 其中/ 1/ ~/ 8/ 是/ 通过/ 直接/ 统计/ 时间/ 窗口/ 内/ 流量/ 信息/ 获取/ ,/ 9/ ~/ 14/ 是/ 通过/ 对流/ 的/ 持续时间/ 、/ 数据包/ 的/ 多少/ 和/ 字节/ 的/ 数量/ 再次/ 进行/ 统计/ 计算/ 得到/ 的/ 特征/ ./ 特征/ 序号/ 1/ 两/ 主机/ 通信/ 产生/ 流/ 的/ 总数/ 2/ 两/ 主机/ 通信/ 发送/ 数据包/ 的/ 总数/ 3/ 两/ 主机/ 通信/ 发送/ 消息/ 的/ 字节数/ 4/ 两/ 主机/ 通信/ 总/ 的/ 持续时间/ 5/ 两/ 主机/ 通信/ 使用/ 的/ 端口/ 总数/ 6/ 两/ 主机/ 通信/ 时/ 使用/ TCP/ 协议/ 的/ 流/ 的/ 数量/ 7/ 两/ 主机/ 通信/ 时/ 使用/ UDP/ 协议/ 的/ 流/ 的/ 数量/ 8/ 两/ 主机/ 通信/ 时/ 使用/ SMTP/ 协议/ 的/ 流/ 的/ 数量/ 9/ 两/ 主机/ 通信/ 产生/ 的/ 所有/ 流中/ ,/ 数据包/ 数量/ 的/ 方差/ 10/ 两/ 主机/ 通信/ 产生/ 的/ 所有/ 流中/ ,/ 字节数/ 的/ 方差/ 11/ 两/ 主机/ 通信/ 产生/ 的/ 所有/ 流中/ ,/ 持续时间/ 的/ 方差/ 12/ 两/ 主机/ 通信/ 产生/ 的/ 所有/ 流中/ ,/ 平均/ 每流/ 包含/ 数据包/ 13/ 两/ 主机/ 通信/ 产生/ 的/ 所有/ 流中/ ,/ 平均/ 每流/ 包含/ 的/ 字节数/ 14/ 两/ 主机/ 通信/ 产生/ 的/ 所有/ 流中/ ,/ 平均/ 每流/ 的/ 持续时间/ 提取/ 流量/ 特征/ 后/ ,/ 通过/ 聚类/ 处理/ 将/ 特征/ 相似/ 的/ 流量/ 划分/ 到/ 同一个/ 聚类/ 中/ ./ 由于/ 在/ 僵尸/ 程序/ 和/ 僵尸/ 控制者/ 通信/ 的/ 过程/ 中/ ,/ 它们/ 之间/ 的/ 通信/ 流量/ 都/ 是/ 程序/ 自动/ 产生/ 的/ ,/ 没有/ 人为因素/ 的/ 影响/ ,/ 因此/ 同/ 一种/ 僵尸/ 程序/ 在/ 不同/ 主机/ 上/ 产生/ 的/ 流量/ 具有/ 极大/ 的/ 相似性/ ./ 不同/ 主机/ 上/ 的/ 正常/ 程序/ 也/ 可能/ 访问/ 同一/ 主机/ ,/ 但/ 受/ 人为/ 操作/ 的/ 影响/ ,/ 在/ 流量/ 特征/ 上/ 会/ 产生/ 很大/ 的/ 差别/ ,/ 如/ 流量/ 包/ 的/ 多少/ 、/ 数据量/ 的/ 多少/ 、/ 持续时间/ 等/ ./ 为了/ 获取/ 流量/ 相似/ 主机/ 的/ 信息/ ,/ 我们/ 对/ 时间/ 窗口/ 内/ 获取/ 的/ 流量/ ,/ 根据/ 提取/ 的/ 流/ 的/ 统计/ 特征/ ,/ 对/ 数据/ 矩阵/ 进行/ 标准化/ 处理/ 后/ ,/ 使用/ 层次/ 聚类/ 的/ 方法/ 进行/ 聚类/ ,/ 在/ 聚类/ 时/ 两点/ 的/ 距离/ 采用/ 欧氏/ 距离/ ,/ 聚类/ 时/ 集合/ 之间/ 的/ 距离/ 使用/ 最/ 短距离/ 法/ ,/ 最终/ 将/ 特征/ 相似/ 的/ 流/ 划分/ 到/ 同一/ 聚类/ 中/ ./ 假设/ 有/ N/ 个/ 数据/ 样本/ ,/ 每次/ 合并/ 都/ 需要/ 计算/ 两个/ 点/ 之间/ 的/ 距离/ ,/ 时间/ 复杂度/ 是/ O/ (/ N2/ )/ ,/ 聚类/ 完成/ 时/ 最终/ 的/ 复杂度/ 是/ O/ (/ N3/ )/ ./ 如图/ 3/ 是/ 16/ 台/ 主机/ 上/ 提取/ 的/ 流量/ 特征/ ,/ 进行/ 层次/ 聚类/ 产生/ 的/ 谱系/ 图/ ./ 其中/ 编号/ 为/ 1/ ~/ 4/ 的/ 主机/ 是/ 感染/ 同/ 一种/ 僵尸/ 程序/ 而/ 产生/ 的/ 流量/ ,/ 编号/ 为/ 9/ 、/ 10/ 、/ 13/ 是/ 不同/ 主机/ 上同/ 一种/ 应用/ 产生/ 的/ 流量/ ,/ 11/ 、/ 14/ 、/ 15/ 也/ 是/ 同/ 一种/ 应用/ 产生/ 的/ 流量/ ./ 纵轴/ 的/ 高度/ 表示/ 当前/ 聚类/ 中/ ,/ 子/ 叶子/ 节点/ 之间/ 的/ 距离/ ,/ 距离/ 越小/ 他们/ 之间/ 的/ 相似/ 度越/ 高/ ,/ 可以/ 看出/ 同/ 一种/ 僵尸/ 程序/ 产生/ 流量/ ,/ 在/ 谱系/ 图中/ 具有/ 很/ 低/ 的/ 高度/ ,/ 即/ 有/ 很/ 高/ 的/ 相似/ 度/ ./ 对/ 特征/ 流量/ 聚类/ 处理/ 后/ ,/ 需要/ 计算/ 在/ 同一时间/ 窗口/ 、/ 同一/ 聚类/ 中/ 主机/ 间通信/ 产生/ 流/ 的/ 相似/ 度/ ./ 假设/ j/ 和/ k/ 是/ 在/ 同一/ 聚类/ 中/ 两个/ 不同/ 流量/ 特征/ ,/ 他们/ 分别/ 包含/ 了/ 产生/ 流/ 的/ IP地址/ 和/ 14/ 个/ 流量/ 的/ 统计/ 特征/ ,/ 则/ j/ 和/ k/ 的/ 相似/ 度/ 可以/ 通过/ 计算/ 他们/ 的/ 距离/ 来/ 确定/ ./ 用/ S/ 表示/ 流量/ 特征/ 的/ 相似/ 度/ ,/ 则/ Sjk/ =/ Page6/ 其中/ ,/ xij/ 是/ j/ 的/ 第/ i/ 个/ 特征/ ,/ xik/ 是/ k/ 的/ 第/ i/ 个/ 特征/ ,/ 14/ ∑/ 14j/ =/ 1x/ -/ 间/ ,/ 值越/ 大/ 表示/ 相似/ 度越/ 高/ ./ 用/ HS/ 表示/ 主机/ 在/ 流量/ 指标/ 上/ 的/ 相似/ 度/ ,/ 假设/ A/ 和/ B/ 分别/ 产生/ 流量/ 特征/ j/ 和/ k/ ,/ 则/ A/ 和/ B/ 的/ 相似/ 度/ HSAB/ =/ Sjk/ ./ 4.1/ ./ 2/ 主机/ 可疑/ 度/ 基于/ 主机/ 的/ 检测/ 主要/ 是/ 分析/ 主机/ 的/ 异常/ 行为/ ,/ 已有/ 大量/ 的/ 检测/ 方法/ 能/ 解决/ 主机/ 上/ 检测/ 僵尸/ 程序/ 问题/ [/ 3/ ,/ 6/ ,/ 8/ ,/ 12/ ,/ 21/ -/ 24/ ]/ ./ 我们/ 更/ 关注/ 网络流量/ 分析/ 以及/ 如何/ 将/ 主机/ 检测/ 结果/ 和/ 网络分析/ 结果/ 更好/ 的/ 关联/ ,/ 实验/ 中/ 使用/ 传统/ 的/ 反病毒/ 工具/ 获取/ 主机/ 上/ 的/ 检测/ 结果/ ./ 4.2/ 滑动/ 时间/ 窗口/ 对于/ 延迟/ 响应/ 僵尸/ ,/ 它们/ 接收/ 来自/ Botmaster/ 命令/ 后/ 可能/ 并/ 不是/ 立即/ 执行/ ,/ 网络/ 活动/ 和/ 主机/ 行为/ 可能/ 并/ 不/ 在/ 一个/ 固定/ 的/ 时间/ 窗口/ 内/ ./ 如图/ 4/ ,/ 它们/ 可能/ 分布/ 在/ 相邻/ 的/ 时间/ 窗口/ ,/ 也/ 可能/ 间隔/ 几个/ 时间/ 窗口/ ./ 由于/ 僵尸/ 活动/ 在/ 实际/ 应用/ 中/ 的/ 需要/ ,/ 延迟/ 响应/ 的/ 时间/ 不能/ 太/ 长/ ,/ 我们/ 假设/ 网络/ 活动/ 和/ 主机/ 行为/ 产生/ 的/ 时间/ 间隔/ 不会/ 超过/ m/ 个/ 时间/ 窗口/ ./ 当/ 一个/ 时间/ 窗口/ 结束/ 时/ ,/ 分析/ 相邻/ m/ 个/ 时间/ 窗口/ 的/ 信息/ ,/ 作为/ 当前/ 滑动/ 时间/ 窗口/ 的/ 结果/ ./ 如图/ 4/ ,/ b1/ 和/ b2/ 是/ 实时/ 响应/ 僵尸/ ,/ b3/ 和/ b4/ 是/ 延迟/ 僵尸/ ,/ 获取信息/ 的/ 时间/ 窗口/ 的/ 大小/ 为/ 10min/ ,/ 当/ 延迟/ 响应/ 的/ 时间/ 最大/ 为/ 50min/ 时/ ,/ 设定/ 滑动/ 时间/ 窗口/ 大小/ 为/ 60min/ ,/ 就/ 可以/ 有效/ 地/ 关联/ 延迟/ 僵尸/ 的/ 网络/ 活动/ 和/ 主机/ 行为/ ./ 考虑/ 不同/ 的/ 信息/ 来源/ ,/ 网络流量/ 相似/ 度/ 和/ 主机/ 可疑/ 度/ 有/ 各自/ 的/ 特点/ ,/ 滑动/ 时间/ 窗口/ 内/ 信息/ 迭代/ 分为/ 两种/ 情况/ :/ (/ 1/ )/ 相似/ 度/ 的/ 迭代/ ,/ 用/ TS/ 表示/ 滑动/ 时间/ 窗口/ 相似/ 度/ 的/ 迭代/ 结果/ ,/ ts/ 表示/ 一个/ 时间/ 窗口/ 结束/ 时/ 相似/ 度/ 数据/ 集/ ,/ 则/ 当/ 第/ n/ 个/ 时间/ 窗口/ 结束/ 时/ ,/ 当前/ 滑动/ 时间/ 窗口/ 内/ 相似/ 度/ 总/ 的/ 数据/ 集/ TSn/ =/ ∑/ n/ 度/ 的/ 迭代/ ,/ 用/ TH/ 表示/ 滑动/ 时间/ 窗口/ 可疑/ 度/ 的/ 迭代/ 结果/ ,/ th/ 表示/ 一个/ 时间/ 窗口/ 结束/ 时/ 可疑/ 度/ 检测/ 结果/ ,/ 则/ 当/ 第/ n/ 个/ 时间/ 窗口/ 结束/ 时/ ,/ 当前/ 滑动/ 时间/ 窗口/ 内/ 可疑/ 度/ THn/ =/ max/ (/ thn/ ,/ thn/ -/ 1/ ,/ …/ ,/ thn/ -/ m/ )/ ./ 当/ 一个/ 滑动/ 时间/ 窗口/ 结束/ 时/ ,/ 网络/ 中/ 主机/ 在/ 流量/ 指标/ 上/ 的/ 相似/ 度/ 和/ 主机/ 检测/ 可疑/ 度/ 将/ 被/ 发送到/ 关联/ 引擎/ ./ 滑动/ 时间/ 窗口/ 的/ 选取/ 与/ 获取信息/ 的/ 时间/ 窗口/ 大小/ 和/ 僵尸/ 命令/ 可能/ 的/ 延迟时间/ 密切相关/ ./ 假设/ 记录/ 信息/ 的/ 时间/ 窗口/ 的/ 大小/ 为/ t/ ,/ 滑动/ 时间/ 窗口/ 大小/ 为/ T/ ,/ 僵尸/ 命令/ 延迟/ 的/ 随机/ 时间/ 最大值/ 为/ R/ ./ 为了/ 便于/ 说明/ ,/ 我们/ 取/ T/ 和/ R/ 与/ t/ 成/ 倍数/ 关系/ ,/ 时间/ 单位/ 为/ 分钟/ ./ 例如/ 当/ R/ >/ T/ 时/ ,/ 取/ t/ =/ 10/ ,/ T/ =/ 40/ ,/ R/ =/ 60/ ,/ 此时/ t0/ 时刻/ 主机/ 接收/ 僵尸/ 命令/ ,/ 然后/ 在/ t0/ +/ 50/ 时刻/ 才/ 执行/ 响应/ 的/ 操作/ 进行/ 恶意/ 行为/ ,/ 这样/ 主机/ 恶意/ 行为/ 和/ 流量/ 信息/ 就/ 可能/ 不/ 在/ 同一个/ 滑动/ 时间/ 窗口/ 内/ ;/ 当/ T/ -/ t/ </ R/ / T/ ,/ 取/ t/ =/ 10/ ,/ T/ =/ 60/ ,/ R/ =/ 60/ ,/ 此时/ 第/ 1/ 个/ 滑动/ 时间/ 窗口/ 在/ t0/ 至/ t0/ +/ 60/ 之间/ ,/ 第/ 2/ 个/ 滑动/ 时间/ 窗口/ 在/ t0/ +/ 10/ 至/ t0/ +/ 70/ 之间/ ,/ 僵尸/ 命令/ 在/ t0/ +/ 3/ 时刻/ 接收/ ,/ 在/ t0/ +/ 61/ 时刻/ 执行/ ,/ 显然/ 主机/ 的/ 恶意/ 行为/ 和/ 流量/ 信息/ 也/ 不/ 在/ 同一个/ 时间/ 窗口/ 内/ ;/ 当/ R/ / T/ -/ t/ ,/ 取/ t/ =/ 10/ ,/ T/ =/ 70/ ,/ R/ =/ 60/ ,/ 此时/ 主机/ 的/ 恶意/ 行为/ 和/ 流量/ 信息/ 总能/ 在/ 同一个/ 滑动/ 时间/ 窗口/ 内/ ./ 我们/ 分析/ 更/ 通用/ 的/ 情况/ ,/ 滑动/ 时间/ 窗口/ 大小/ 和/ 僵尸/ 命令/ 延迟时间/ 长短/ 在/ 变化/ 时/ ,/ 主机/ 的/ 恶意/ 行为/ 和/ 流量/ 信息/ 会落/ 在/ 同一个/ 滑动/ 时间/ 窗口/ 中/ 的/ 概率/ P/ ./ 当/ R/ >/ T/ 时/ ,/ 僵尸/ 命令/ 的/ 一次/ 执行/ 过程/ 中/ 可能/ 包含/ (/ R/ -/ T/ )/ // t/ +/ 1/ 个/ 滑动/ 时间/ 窗口/ ,/ 在/ 最大/ 延迟时间/ 内/ 可能/ 有/ C2/ 不同/ 的/ 执行/ 过程/ (/ C/ 是/ 组合/ 数/ )/ ,/ 在/ 一个/ 滑动/ 时间/ 窗口/ 内/ 可能/ 有/ C2/ 个/ 滑动/ 时间/ 窗口/ 的/ 概率/ P/ =/ [/ (/ (/ R/ -/ t/ )/ // t/ +/ 1/ )/ ×/ (/ C2T/ +/ T/ )/ ]/ // (/ C2/ 续/ 的/ 滑动/ 时间/ 窗口/ 内/ ,/ 僵尸/ 命令/ 随机/ 时间/ 可能/ 有/ t/ ×/ C2R/ +/ C2/ 能/ 有/ 2/ ×/ (/ C2P/ =/ t/ ×/ C22/ ×/ (/ C2/ 僵尸/ 命令/ 的/ 执行/ 过程/ 总能/ 在/ 同一个/ 滑动/ 时间/ 窗口/ 内/ ,/ 因此/ P/ =/ 1.4/ ./ 3/ 关联/ 引擎/ 这/ 一部分/ 主要/ 对/ 来自/ 滑动/ 时间/ 窗口/ 信息/ 迭代/ 的/ 结果/ 进行/ 关联/ ,/ 使用/ 推荐/ 算法/ 结合/ 主机/ 流量/ 的/ 相似/ 度/ 和/ 主机/ 检测/ 结果/ ,/ 对/ 网络/ 中/ 部署/ 或/ 未/ 部署/ 主机/ 检测工具/ 的/ 所有/ 主机/ ,/ 产生/ 是否/ 感染/ 延迟/ 僵尸/ 的/ 检测/ 报告/ ./ Page74/ ./ 3.1/ 推荐/ 算法/ 推荐/ 算法/ 常用/ 于/ 社交/ 网络/ 中为/ 用户/ 推荐/ 好友/ 、/ 在线商城/ 中为/ 用户/ 推荐/ 新/ 的/ 物品/ ,/ 也/ 被/ 广告/ 服务商/ 用于/ 精准/ 投放/ 广告/ ./ 如图/ 5/ ,/ 是/ 一个/ 典型/ 的/ 在线商城/ 的/ 物品/ 推荐/ 模型/ ./ 其中/ A/ 、/ B/ 、/ C/ 、/ D/ 、/ E/ 、/ F/ 是/ 商城/ 中/ 的/ 6/ 件物品/ ,/ 根据/ 用户/ 购买/ A/ 、/ B/ 、/ C3/ 件物品/ 的/ 记录/ 和/ 评价/ ,/ 可以/ 得出/ 用户/ 对/ 这/ 3/ 件物品/ 的/ 喜好/ 程度/ ,/ 记作/ LA/ 、/ LB/ 、/ LC/ ./ 对/ 商城/ 中/ 的/ 所有/ 物品/ 进行/ 特征分析/ ,/ 可以/ 得出/ 物品/ 间/ 的/ 相似/ 度/ S/ ,/ 图中/ 物品/ A/ 和/ E/ 之间/ 的/ 相似/ 度为/ SAE/ ./ 此时/ ,/ 通过/ 用户/ 对/ 已知/ 物品/ 的/ 喜好/ 程度/ 和/ 不同/ 物品/ 之间/ 的/ 相似/ 程度/ ,/ 通过/ 关联/ 分析/ 就/ 可以/ 推算出/ 用户/ 对/ 未知/ 物品/ 的/ 喜好/ 程度/ ./ 利用/ 图中/ 信息/ 就/ 可以/ 简单/ 推算出/ 用户/ 对/ 物品/ E/ 的/ 喜好/ 程度/ :/ LE/ =/ (/ LA/ ×/ SAE/ +/ LB/ ×/ SBE/ +/ LC/ ×/ SCE/ )/ // 4.3/ ./ 2/ 网络/ 活动/ 和/ 主机/ 行为/ 的/ 关联/ 推荐/ 算法/ 也/ 可/ 用于/ 关联/ 网络/ 活动/ 和/ 主机/ 行为/ ,/ 如果/ 把/ 检测工具/ 对/ 主机/ 产生/ 的/ 可疑/ 度/ 类比/ 为/ 用户/ 对/ 商品/ 的/ 喜好/ ,/ 而/ 主机/ 流量/ 之间/ 的/ 相似/ 度/ 类比/ 为/ 物品/ 间/ 的/ 相似/ 度/ ,/ 这样/ 很/ 容易/ 借鉴/ 物品/ 推荐/ 所/ 使用/ 的/ 算法/ ./ 通过/ 关联/ 分析/ 主机/ 可疑/ 度/ 和/ 网络流量/ 相似/ 度/ ,/ 对/ 未/ 部署/ 主机/ 检测工具/ 或者/ 检测工具/ 失效/ 而/ 未/ 产生/ 可疑/ 度/ 的/ 主机/ ,/ 产生/ 较/ 可靠/ 的/ 检测/ 结果/ ./ 根据/ 主机/ 检测/ 结果/ 和/ 流量/ 相似/ 度/ 分析/ 结果/ ,/ 关联/ 引擎/ 可以/ 计算/ 网络/ 中未/ 报告/ 检测/ 结果/ 的/ 主机/ 的/ 可疑/ 度/ ./ 假设/ 有/ 6/ 台/ 主机/ A/ 、/ B/ 、/ C/ 、/ D/ 、/ E/ 、/ F/ ,/ 其中/ A/ 、/ B/ 、/ C3/ 台/ 主机/ 反馈/ 的/ 检测/ 结果/ 分别/ 为/ HA/ 、/ HB/ 、/ HC/ ,/ 其它/ 主机/ 未/ 反馈/ 检测/ 结果/ ,/ 主机/ 流量/ 的/ 相似/ 度/ 信息/ 包括/ SAE/ 、/ SBE/ 、/ SCE/ 、/ SAD/ 、/ SCF/ ./ 对于/ 未/ 报告/ 检测/ 结果/ 的/ 主机/ E/ ,/ 由于/ 和/ 主机/ A/ 、/ B/ 、/ C/ 在/ 同一个/ 时间段/ 内有/ 相似/ 的/ 通信/ 流量/ ,/ 而/ A/ 、/ B/ 和/ C/ 上/ 的/ 主机/ 检测工具/ 均/ 报告/ 检测/ 到/ 可疑/ 的/ 僵尸/ 程序/ ,/ 最终/ E/ 主机/ 感染/ 僵尸/ 程序/ 的/ 检测/ 结果/ 为/ FE/ =/ (/ FA/ ×/ SAE/ +/ FB/ ×/ SBE/ +/ FC/ ×/ SCE/ )/ // 从而/ 可以/ 在/ 一定/ 程度/ 上/ 对/ 未/ 部署/ 检测工具/ 或者/ 检测工具/ 失效/ 的/ 主机/ 产生/ 一个/ 较/ 可靠/ 的/ 检测/ ./ 如果/ 主机/ E/ 已经/ 报告/ 检测/ 结果/ HE/ ,/ 发现/ E/ 主机/ 可能/ 已经/ 感染/ 僵尸/ 程序/ ,/ 但是/ 可疑/ 度/ 的/ 值/ 并/ 不是/ 很/ 高/ ,/ 我们/ 不能/ 准确/ 判断/ 主机/ 是否/ 真的/ 是/ 感染/ 僵尸/ 程序/ ,/ 还是/ 一些/ 正常/ 软件/ 的/ 一些/ 操作/ 导致/ 主机/ 上/ 的/ 检测工具/ 产生/ 不/ 准确/ 的/ 报告/ ./ 通过/ 关联/ 引擎/ 结合/ 网络/ 上/ 其它/ 主机/ 的/ 流量/ 信息/ ,/ 我们/ 可以/ 更/ 准确/ 地/ 计算/ 出/ E/ 主机/ 的/ 最终/ 检测/ 结果/ 为/ FE/ =/ (/ HE/ +/ (/ HA/ ×/ SAE/ +/ HB/ ×/ SBE/ +/ HC/ ×/ SCE/ )/ // 此时/ 如果/ 网络/ 中有/ 大量/ 主机/ 和/ E/ 主机/ 有/ 相似/ 的/ 流量/ ,/ 而且/ 他们/ 都/ 发出/ 了/ 检测/ 报告/ ,/ 通过/ 关联/ 引擎/ 则/ 进一步提高/ 了/ E/ 主机/ 的/ 可疑/ 度/ ,/ 使/ 检测/ 结果/ 更/ 准确/ ,/ 如果/ 和/ 主机/ E/ 流量/ 相似/ 的/ 主机/ 几乎/ 没有/ ,/ 这/ 在/ 很大/ 程度/ 上/ 可能/ 是/ 主机/ 上/ 检测/ 程序/ 的/ 误报/ ./ 对于/ 更/ 普通/ 的/ 情况/ ,/ 如/ 算法/ 1/ 所示/ ,/ X/ 表示/ 网络/ 中/ 的/ 任意/ 主机/ ,/ N/ (/ X/ )/ 表示/ 和/ 主机/ X/ 在/ 同一个/ 聚类/ 中/ ,/ 并且/ 在/ 相同/ 时间段/ 内/ 和/ 满足/ 主机/ X/ 流量/ 相似/ 度/ 的/ 大小/ 条件/ 的/ 主机/ 集合/ ,/ HX/ 表示/ 主机/ X/ 产生/ 的/ 检测/ 结果/ ,/ SKX/ 表示/ 主机/ K/ 和/ 主机/ X/ 的/ 相似/ 度/ 计算结果/ ,/ FX/ 是/ 通过/ 关联/ 引擎/ ,/ 使用/ 关联/ 算法/ 得到/ 的/ 最后/ 检测/ 结果/ ./ FX/ =/ ∑/ K/ ∈/ N/ (/ X/ )/ HK/ ×/ SKX/ ∑/ K/ ∈/ N/ (/ X/ )/ SKX/ ,/ HX/ =/ 0/ 其中/ 主机/ 检测/ 结果/ HX/ 范围/ 在/ 0/ ~/ 1/ 之间/ ,/ 值越/ 大/ 表示/ 主机/ 感染/ 僵尸/ 程序/ 的/ 可疑/ 度越/ 大/ ,/ 主机/ 流量/ 相似/ 度/ SKX/ 范围/ 也/ 在/ 0/ ~/ 1/ 之间/ ,/ 值越/ 大/ 表示/ 两个/ 主机/ 的/ 流量/ 越/ 相似/ ,/ 分析/ 以上/ 关联/ 算法/ ,/ 很/ 容易/ 得到/ 最终/ 的/ 检测/ 结果/ FX/ 的/ 范围/ 也/ 在/ 0/ ~/ 1/ 之间/ ,/ 值越/ 大/ 表示/ 主机/ 感染/ 僵尸/ 程序/ 的/ 概率/ 越大/ ./ 对于/ 特殊/ 情况/ :/ 当/ 网络/ 中/ 只有/ 一台/ 主机/ 被/ 检测/ 出/ 感染/ 僵尸/ 程序/ ,/ 并且/ 与/ 其它/ 主机/ 没有/ 相似/ 流量/ ,/ 此时/ 主机/ 上/ 的/ 检测/ 结果/ 和/ 通过/ 关联/ 分析/ 得到/ 的/ 最终/ 结果/ 是/ 一样/ 的/ ,/ 即/ FX/ =/ HX/ ./ 烄/ 烅/ 烆/ 算法/ 1/ ./ 关联/ 网络/ 和/ 主机/ 信息/ 的/ 推荐/ 算法/ ./ Page8/ 输入/ :/ H/ :/ 主机/ 检测/ 可疑/ 度/ C/ :/ 主机/ 流量/ 聚类/ 信息/ S/ :/ 在/ 同一/ 聚类/ 中/ 主机/ 在/ 流量/ 指标/ 上/ 的/ 相似/ 度/ 结果/ hosts/ :/ 网络/ 中/ 所有/ 主机/ 的/ IP地址/ 集合/ 输出/ :/ R/ :/ 网络/ 中/ 主机/ 的/ 最终/ 检测/ 结果/ 1/ ./ FORXinhosts2/ ./ u/ =/ v/ =/ 0/ // // 用于/ 计算/ 最终/ 检测/ 结果/ 的/ 临时/ 变量/ 3/ ./ FORKinC/ [/ X/ ]/ 4/ ./ u/ +/ =/ H/ [/ K/ ]/ ×/ S/ [/ X/ ]/ [/ K/ ]/ 5/ ./ v/ +/ =/ S/ [/ X/ ]/ [/ K/ ]/ 6/ ./ ENDFOR7/ ./ IFH/ [/ X/ ]/ =/ 0THENR/ [/ X/ ]/ =/ u/ // v8/ ./ ELSER/ [/ X/ ]/ =/ (/ H/ [/ X/ ]/ +/ u/ // v/ )/ // 29/ ./ ENDFOR10/ ./ RETURNR/ 推荐/ 算法/ 结合/ 主机/ 检测/ 可疑/ 度/ 和/ 网络/ 中/ 主机/ 流量/ 相似/ 度/ ,/ 产生/ 所有/ 主机/ 的/ 最终/ 检测/ 结果/ ./ 假设/ 滑动/ 时间/ 窗口/ 最/ 多/ 包含/ k/ 个/ 聚类/ ,/ 一个/ 聚类/ 中/ 最/ 多/ 包含/ n/ 个/ 相似/ 度/ 信息/ ,/ 网络/ 中/ 一共/ 有/ m/ 个/ 主机/ ,/ 在/ 给/ m/ 个/ 主机/ 通过/ 关联/ 引擎/ 计算/ 最终/ 检测/ 结果/ 时/ ,/ 最/ 多/ 需要/ 关联/ n/ 个/ 在/ 同一/ 聚类/ 中/ 已/ 报告/ 检测/ 结果/ 的/ 主机/ 信息/ ,/ 则/ 计算/ 最终/ 关联/ 算法/ 的/ 复杂度/ 为/ O/ (/ mn/ )/ ./ 5/ 实验/ 5.1/ 实验/ 环境/ 和/ 评价/ 方法/ 根据/ 提出/ 的/ 方法/ ,/ 我们/ 设计/ 并/ 实现/ 了/ 实验/ 原型/ ,/ 分析/ 了/ 滑动/ 时间/ 窗口/ 大小/ 和/ 检测/ 软件/ 部署/ 率/ 对/ 检测/ 结果/ 的/ 影响/ ./ 主机/ 检测/ 部分/ 我们/ 使用/ 多个/ 现有/ 检测工具/ 得到/ 一个/ 平均值/ ,/ 其中/ 包括/ 微软/ 提供/ 的/ MicrosoftSecurityEssentials/ ①/ 、/ kaspersky/ ②/ 安全/ 工具/ 、/ bitdefender/ ③/ 检测/ 软件/ ,/ 作为/ 主机/ 感染/ 僵尸/ 程序/ 的/ 可疑/ 度/ ./ 网络分析/ 部分/ 利用/ fprobe/ ④/ 和/ flow/ -/ tools/ ⑤/ 抓取/ 整个/ 网络/ 中/ 的/ 流量/ ,/ 借助/ google/ 提供/ 的/ safe/ -/ browing/ ⑥/ 和/ alexa/ 提供/ top1000000/ 网址/ ⑦/ 对/ 抓取/ 的/ 主机/ 流量/ ,/ 根据/ IP地址/ 进行/ 过滤/ ,/ 使用/ hclust/ ⑧/ 工具包/ 和/ Python/ 语言/ 编写程序/ ,/ 对/ 流量/ 数据/ 进行/ 处理/ 分析/ ,/ 实现/ 了/ 滑动/ 时间/ 窗口/ 数据/ 迭代/ 器/ 和/ 关联/ 引擎/ ./ 通过/ 关联/ 引擎/ 得到/ 最终/ 的/ 检测/ 结果/ ,/ 当/ 主机/ 的/ 最终/ 检测/ 结果/ 超过/ 阈值/ 时/ ,/ 确定/ 该/ 主机/ 已/ 感染/ 僵尸/ 程序/ ./ 实验/ 中/ ,/ 我们/ 建立/ 一个/ 可控/ 的/ 局域网/ 环境/ ./ 用户/ 主机/ 部署/ 在/ 装有/ WindowsXPProfessional/ 系统/ 的/ VMware/ 虚拟机/ 中/ ,/ 滑动/ 时间/ 窗口/ 信息/ 迭代/ 器/ 和/ 关联/ 引擎/ 部署/ 在/ 装有/ WindowsXPProfessional/ 系统/ 、/ 2.40/ GHzCPU/ 、/ 2GRAM/ 、/ 四核/ 主机/ 上/ ,/ 网络流量/ 收集/ 和/ 分析器/ 部署/ 在/ 装有/ Ubuntu10/ ./ 10/ 系统/ 、/ 2.40/ GHzCPU/ 、/ 2GRAM/ 、/ 四核/ 主机/ 上/ ,/ 同时/ 用/ 这台/ Linux/ 内核/ 主机/ 作为/ 整个/ 局域网/ 的/ 网关/ ./ 为了/ 验证/ 方法/ 在/ 检测/ 僵尸/ 主机/ 上/ 的/ 有效性/ ,/ 我们/ 在/ 部分/ 用户/ 主/ 机上安装/ 僵尸/ 程序/ ,/ 并/ 把/ 僵尸/ 控制/ 端/ 安装/ 在/ 公网/ 的/ 一台/ 主机/ 上/ ./ 由于/ P2P/ 僵尸/ 网络/ 的/ 不/ 可控性/ ,/ 我们/ 只/ 使用/ HTTP/ 和/ IRC/ 作为/ C/ &/ C/ 通信/ 信道/ 的/ 僵尸/ 样例/ ,/ 包括/ SdBot/ ,/ AgoBot/ ,/ RBot/ ,/ Nugache/ ./ 为了/ 更好/ 的/ 模拟/ 用户/ 主机/ 的/ 真实/ 环境/ ,/ 在/ 用户/ 主/ 机上安装/ 并/ 运行/ mIRC/ 、/ pcAnywhere/ 、/ xunlei/ 、/ QQ/ 、/ uTorrent/ 等/ 软件/ ,/ 并/ 使用/ 他们/ 正常/ 地/ 访问/ 网络/ ./ 在/ BotSniffer/ 方法/ [/ 20/ ]/ 中/ ,/ Gu/ 总结/ 了/ 延迟/ 僵尸/ 的/ 一些/ 特征/ ,/ 并/ 根据/ 已有/ 关于/ 延迟/ 僵尸/ 的/ 描述/ [/ 25/ ]/ ,/ CERT/ 和/ SECUREWORKS/ 报告/ 实现/ 了/ 4/ 个/ 基于/ HTTP/ 的/ 僵尸/ 程序/ ./ 由于/ 没有/ 可控/ 的/ 延迟/ 响应/ 僵尸/ ,/ 根据/ 延迟/ 响应/ 僵尸/ 的/ 功能/ 特征/ ,/ 我们/ 修改/ 了/ 已有/ 的/ Sdbot/ 源码/ ,/ 使/ 其/ 在/ 接收/ 到/ 控制/ 端的/ 命令/ 后/ ,/ 并/ 不会/ 立即/ 响应/ ,/ 会/ 随机/ 延迟/ 一个/ 可控/ 的/ 随机/ 时间/ ,/ 我们/ 将/ 修改/ 后/ 的/ Sdbot/ 称为/ fixedSdbot/ ./ 在/ 网络流量/ 分析/ 处/ ,/ 采用/ CERNET/ 某/ 骨干/ 节点/ 一天/ 的/ 网络流量/ 数据/ ,/ 作为/ 网络分析/ 的/ 背景/ 数据/ ./ 在/ 10min/ 的/ 时间/ 窗口/ 内约/ 含有/ 735421/ 条/ 流量/ 记录/ ,/ 经过/ 过滤/ 处理/ 后/ 含有/ 64538/ 台/ 主机/ 信息/ ,/ 将/ 过滤/ 后/ 的/ 特征/ 信息/ 混合/ 到/ 局域网/ 抓取/ 的/ 特征/ 流量/ 中/ ,/ 这样/ 更/ 有利于/ 验证/ 聚类分析/ 在/ 区分/ 僵尸/ 流量/ 上/ 的/ 有效性/ ./ 5.2/ 结果/ 分析/ 实验/ 中/ 使用/ 了/ 40/ 个/ VMware/ 虚拟主机/ 作为/ 用户/ 主机/ ,/ 他们/ 被/ 配置/ 在/ 192.168/ ./ 1.1/ ~/ 192.168/ ./ 1.40/ // 24/ 同一个/ 局域网/ 环境/ 中/ ./ 保证/ 在/ 感染/ 僵尸/ 程序/ 的/ 主机/ 上/ 部署/ 主机/ 检测工具/ 的/ 部署/ 率/ 达到/ 80/ %/ ,/ 主机/ 上/ 的/ 常规/ 软件/ 正常/ 进行/ 网络/ 活动/ ,/ 僵尸/ 控制/ 端/ 和/ 受控/ 僵尸/ 主机/ 进行/ 正常/ C/ &/ C/ 通信/ ,/ 使用/ 的/ 僵尸/ 命令/ 包括/ download/ 、/ dns/ 、/ open/ 、/ redirect/ 等/ ./ 在/ 网络流量/ 收集/ 分析器/ 上以/ 10min/ 为/ 一个/ 时间/ 窗口/ ,/ 对/ 流量/ 进行/ 过滤/ 和/ 特征提取/ 处理/ ,/ 再/ 混合/ 背景/ 流量/ 进行/ 聚类分析/ ①/ ②/ ③/ ④/ ⑤/ ⑥/ ⑦/ ⑧/ Page9/ 和/ 相似/ 度/ 计算/ ./ 按照/ 60min/ 作为/ 滑动/ 时间/ 窗口/ 的/ 大小/ ,/ 对/ 各/ 独立/ 时间/ 窗口/ 信息/ 迭代/ ./ 最终/ 通过/ 关联/ 引擎/ 得到/ 整个/ 网络/ 中/ 主机/ 的/ 检测/ 结果/ ./ 如表/ 2/ ,/ 是/ 24h/ 分别/ 使用/ 5/ 种/ 僵尸/ 实例/ ,/ 多次/ 试验/ 后/ 的/ 平均/ 检测/ 结果/ ./ 对于/ 使用/ 的/ 5/ 种/ 实例/ ,/ 主机/ 检测工具/ 都/ 能/ 有效/ 报告/ 恶意/ 活动/ ./ 对于/ 传统/ 未/ 采用/ 延迟/ 技术/ 的/ 僵尸/ ,/ 受/ 不同/ 僵尸/ 在/ 网络流量/ 相似/ 度/ 的/ 影响/ 和/ 部分/ 主机/ 检测工具/ 失效/ (/ 网络/ 中/ 检测工具/ 的/ 有效/ 部署/ 率/ )/ 的/ 影响/ ,/ 最终/ 关联/ 的/ 结果/ 不能/ 保证/ 准确率/ 达到/ 100/ %/ ./ 对于/ fixedSdbot/ ,/ 由于/ 在/ C/ &/ C/ 过程/ 中/ ,/ 僵尸/ 程序/ 接收/ 命令/ 和/ 实际/ 进行/ 恶意/ 活动/ 有/ 随机/ 的/ 时间延迟/ ,/ 当/ 延迟时间/ 比/ 滑动/ 时间/ 窗口/ 长时/ ,/ 不能/ 有效/ 检测/ 所有/ 僵尸/ 活动/ ,/ 对于/ 实验/ 中/ 采用/ 的/ 数据/ 其/ 准确率/ 较/ 普通/ 僵尸/ 程序/ 低/ ./ 僵尸/ 类型/ FPFNTPTNDuration/ // hfixedSdbot089210024SdBot049810024AgoBot0010010024RBot0010010024Nugache049610024/ 时间/ 窗口/ 大小/ 对/ 最终/ 检测/ 的/ 准确率/ 和/ 方法/ 的/ 性能/ 都/ 有/ 直接/ 的/ 影响/ ,/ 包括/ 获取/ 网络流量/ 和/ 主机/ 可疑/ 度/ 的/ 时间/ 窗口/ 大小/ 和/ 迭代/ 多个/ 连续/ 时间/ 窗口/ 的/ 滑动/ 时间/ 窗口/ 的/ 大小/ ./ 当/ 收集/ 信息/ 的/ 时间/ 窗口/ 过/ 小时/ ,/ 时间/ 窗口/ 内/ 收集/ 的/ 信息量/ 不够/ 大/ ,/ 产生/ 的/ 相似/ 度/ 信息/ 不够/ 多/ ,/ 最终/ 导致/ 在/ 关联/ 计算/ 时/ 由于/ 没有/ 足够/ 的/ 相似/ 度/ 信息/ ,/ 严重/ 影响/ 检测/ 的/ 准确率/ ;/ 当/ 收集/ 信息/ 的/ 时间/ 窗口/ 过大时/ ,/ 收集/ 的/ 流量/ 信息/ 过多/ ,/ 通过/ 滑动/ 时间/ 窗口/ 迭代/ 后/ ,/ 数据量/ 会/ 更/ 大/ ,/ 在/ 对/ 流量/ 聚类分析/ 和/ 相似/ 度/ 计算/ 时/ 需要/ 消耗/ 大量/ 的/ 计算/ 和/ 存储资源/ ./ 滑动/ 时间/ 窗口/ 大小/ ,/ 是/ 延迟/ 响应/ 僵尸/ 检测/ 准确性/ 的/ 一个/ 重要/ 影响/ 因素/ ,/ 当/ 滑动/ 时间/ 窗口/ 过/ 小时/ ,/ 延迟/ 响应/ 僵尸/ 的/ 网络/ 活动/ 和/ 主机/ 行为/ 的/ 时间/ 间隔/ ,/ 可能/ 跨越/ 整个/ 滑动/ 时间/ 窗口/ ,/ 此时/ 滑动/ 时间/ 窗口/ 将/ 不/ 在/ 起/ 作用/ ,/ 仍然/ 无法/ 有效/ 检测/ 主机/ 上/ 的/ 僵尸/ 程序/ ;/ 当/ 滑动/ 时间/ 窗口/ 过大时/ ,/ 一方面/ 流量/ 信息/ 过大/ ,/ 最终/ 会/ 给/ 关联/ 引擎/ 产生/ 性能/ 上/ 巨大/ 的/ 压力/ ,/ 另一方面/ 每/ 两个/ 相邻/ 时间/ 窗口/ 之间/ ,/ 都/ 有/ 大量/ 重复/ 的/ 流量/ 信息/ ,/ 每次/ 都/ 会/ 有/ 大量/ 主机/ 进行/ 重复/ 检测/ ,/ 造成/ 计算资源/ 的/ 浪费/ ./ 如图/ 6/ 是/ 使用/ fixedSdbot/ ,/ 僵尸/ 程序/ 的/ 随机/ 延迟时间/ 上限/ 为/ 70min/ ,/ 收集/ 信息/ 的/ 时间/ 窗口/ 大小/ 分为/ 5min/ 、/ 10min/ 、/ 20min3/ 个/ 层次/ ,/ 滑动/ 时间/ 窗口/ 大小/ 分为/ 20min/ 、/ 40min/ 、/ 60min/ 、/ 80min4/ 个/ 层次/ ./ 分析/ 收集/ 信息/ 时间/ 窗口/ 和/ 滑动/ 时间/ 窗口/ 对/ 准确率/ 的/ 影响/ ./ 当/ 滑动/ 时间/ 窗口/ 小于/ 延迟时间/ 时/ 准确率/ 较/ 低/ ,/ 且/ 获取信息/ 时间/ 窗口/ 越大/ 反而/ 对/ 导致/ 准确率/ 下降/ ,/ 这/ 是因为/ 获取信息/ 的/ 时间/ 窗口/ 越大/ ,/ 在/ 连续/ 的/ 滑动/ 时间/ 窗口/ 上/ 就/ 会/ 跳/ 过/ 更长/ 的/ 时间段/ ,/ 进而/ 使/ 僵尸/ 执行/ 过程/ 不/ 在/ 同一个/ 活动/ 时间/ 窗口/ 的/ 可能性/ 增大/ ./ 在/ 正常/ 用户/ 主机/ 上/ 固定/ 的/ 滑动/ 时间/ 窗口/ 内/ ,/ 不断/ 调整/ 感染/ 僵尸/ 程序/ 的/ 主机/ 的/ 数量/ 、/ 正常/ 主机/ 的/ 数量/ 和/ 安装/ 主机/ 检测工具/ 的/ 主机/ 的/ 数量/ ,/ 使用/ IRC/ 和/ HTTP/ 僵尸/ 网络/ 中/ 的/ 多种/ 僵尸/ 实例/ 进行/ 实验/ 分析/ ./ 如图/ 7/ ,/ 是/ 主机/ 检测工具/ 的/ 部署/ 率/ 对/ 整体/ 检测/ 结果/ 的/ 影响/ ,/ 部署/ 率/ 超过/ 50/ %/ 时/ ,/ 整个/ 网络/ 检测/ 结果/ 的/ 准确率/ 有/ 明显提高/ ;/ 部署/ 率/ 超过/ 80/ %/ 时/ ,/ 未/ 部署/ 检测工具/ 主机/ 的/ 检测/ 准确率/ 超过/ 88/ %/ ./ 6/ 与/ 同类/ 工作/ 的/ 对比/ Zeng/ 等/ 人/ [/ 7/ ]/ 首次/ 提出/ 的/ 结合/ 主机/ 行为/ 和/ 网络/ 活动/ 的/ 检测/ 方法/ ,/ 主机/ 行为/ 是/ 通过/ 对/ 注册表/ 、/ 文件系统/ 、/ 网络/ 堆栈/ 的/ 行为/ 进行/ 监视/ ,/ 获取/ 一个/ 特征向量/ ;/ Page10/ 网络/ 信息/ 是/ 在/ 网络/ 的/ 边缘/ 处/ 抓取/ 整个/ 网络通信/ 的/ NetFlow/ 流量/ 数据/ ,/ 对/ 流量/ 进行/ 过滤/ ,/ 提取/ 特征/ 后/ 进行/ 聚类分析/ ;/ 最后/ 通过/ 关联/ 算法/ 将/ 主机/ 行为/ 与/ 网络/ 活动/ 结合/ ,/ 判断/ 产生/ 检测/ 结果/ 的/ 主机/ 是否/ 感染/ 僵尸/ ./ 文献/ [/ 7/ ]/ 的/ 方法/ 在/ 一定/ 程度/ 上/ 提高/ 了/ 主机/ 检测/ 的/ 准确率/ ,/ 但/ 仍/ 不能/ 解决/ 检测工具/ 健壮性/ 低/ 的/ 问题/ ,/ 仍/ 需要/ 在/ 网络/ 中/ 全局/ 部署/ 检测工具/ ,/ 同时/ 在/ 检测/ 延迟/ 响应/ 僵尸/ 时/ ,/ 关联/ 的/ 方法/ 也/ 几乎/ 无效/ ./ 健壮性/ 低/ 主要/ 表现/ 在/ ,/ 当/ 网络/ 中/ 主机/ 上/ 的/ 检测工具/ 由于/ 一些/ 原因/ 失效/ ,/ 不会/ 向/ 关联/ 引擎/ 反馈/ 检测/ 结果/ 或者/ 反馈/ 误差/ 较大/ 的/ 检测/ 结果/ ,/ 此时/ 整个/ 检测/ 系统/ 无法/ 对/ 该/ 主机/ 产生/ 可靠/ 的/ 检测/ 结果/ ;/ 需要/ 全局/ 部署/ 表现/ 在/ ,/ 当/ 网络/ 中/ 的/ 主机/ 没有/ 安装/ 主机/ 检测工具/ 时/ ,/ 检测/ 系统/ 就/ 无法/ 对/ 该/ 主机/ 进行/ 僵尸/ 感染/ 判断/ ;/ 对/ 延迟/ 响应/ 僵尸/ 检测/ ,/ 关联/ 引擎/ 失效/ ,/ 表现/ 在/ 当/ 延迟/ 响应/ 僵尸/ 的/ 网络/ 活动/ 和/ 主机/ 行为/ 分散/ 在/ 不同/ 的/ 时间/ 窗口/ 时/ ,/ 关联/ 引擎/ 没有/ 结合/ 多个/ 时间/ 窗口/ 的/ 信息/ ,/ 无法/ 进行/ 关联/ ./ 对比/ 文献/ [/ 7/ ]/ 的/ 方法/ ,/ 本文/ 使用/ 了/ 滑动/ 时间/ 窗口/ 对/ 收集/ 的/ 信息/ 迭代/ 处理/ ,/ 当/ 延迟/ 僵尸/ 的/ 网络/ 活动/ 和/ 主机/ 行为/ 分散/ 在/ 不同/ 的/ 时间/ 窗口/ 时/ ,/ 仍然/ 可以/ 通过/ 关联/ 引擎/ 进行/ 检测/ ;/ 本文/ 在/ 关联/ 引擎/ 处/ 使用/ 了/ 推荐/ 算法/ ,/ 当/ 主机/ 上/ 的/ 检测工具/ 失效/ 时/ ,/ 仍能/ 对/ 该/ 主机/ 产生/ 可靠/ 的/ 检测/ 报告/ ,/ 同时/ 网络/ 中/ 的/ 主机/ 也/ 不/ 需要/ 全部/ 部署/ 主机/ 检测工具/ ,/ 当/ 检测工具/ 在/ 网络/ 中/ 的/ 部署/ 率/ 达到/ 一定/ 阈值/ 后/ ,/ 整个/ 检测/ 系统对/ 网络/ 中/ 所有主/ 机会/ 有/ 较/ 高/ 的/ 准确率/ ./ 7/ 总结/ 和/ 讨论/ 僵尸/ 网络/ 的/ 不断/ 演化/ ,/ 网络/ 中/ 大量/ 计算机/ 仍/ 遭受/ 僵尸/ 程序/ 的/ 危害/ ./ 本文/ 中/ ,/ 针对/ 延迟/ 响应/ 僵尸/ ,/ 我们/ 提出/ 的/ 在/ 滑动/ 时间/ 窗口/ 内/ ,/ 使用/ 推荐/ 算法/ 关联/ 网络/ 活动/ 和/ 主机/ 行为/ 的/ 方法/ ,/ 在/ 局域网/ 的/ 主机/ 检测工具/ 部署/ 率/ 达到/ 一定/ 程度/ 时/ ,/ 能/ 有效/ 的/ 对/ 整个/ 网络/ 的/ 主机/ 是否/ 感染/ 僵尸/ 程序/ ./ 从/ 收集/ 的/ 流量/ 中/ 提取/ 了/ 14/ 个/ 特征/ ,/ 以/ 区分/ 正常/ 程序/ 通信/ 的/ 流量/ 和/ 僵尸/ 程序/ C/ &/ C/ 通信/ 过程/ 中/ 产生/ 的/ 流量/ ,/ 计算/ 出/ 主机/ 通信/ 流量/ 的/ 相似/ 度/ ./ 通过/ 滑动/ 时间/ 窗口/ 信息/ 迭代/ 器/ 对/ 网络/ 活动/ 和/ 主机/ 行为/ 进一步/ 分析/ 处理/ ./ 最终/ 通过/ 推荐/ 算法/ ,/ 结合/ 主机/ 检测/ 结果/ 和/ 网络流量/ 分析/ 结果/ ,/ 得到/ 网络/ 中/ 所有/ 主机/ 的/ 检测/ 报告/ ,/ 其中/ 不仅/ 包括/ 部署/ 检测工具/ 的/ 主机/ ,/ 也/ 包括/ 未/ 部署/ 检测工具/ 的/ 主机/ ./ 对于/ 提出/ 的/ 方法/ ,/ 我们/ 进行/ 实验室/ 模拟实验/ ,/ 并/ 在/ 多个/ 指标/ 上/ 进行/ 了/ 分析/ ./ 同时/ 本文/ 中/ 提到/ 的/ 方法/ 也/ 存在/ 一些/ 问题/ ,/ 使用/ 滑动/ 时间/ 窗/ 迭代/ 网络/ 活动/ 和/ 主机/ 行为/ ,/ 来/ 应对/ 延迟/ 响应/ 僵尸/ ,/ 会/ 大大增加/ 需要/ 处理/ 的/ 网络流量/ ,/ 需要/ 消耗/ 更/ 多/ 的/ 计算/ 和/ 存储资源/ ./ 由于/ 实验/ 环境/ 的/ 限制/ ,/ 本文/ 中/ 的/ 方法/ 只/ 通过/ 实验室/ 小规模/ 模拟实验/ 验证/ ,/ 对于/ 真实/ 复杂/ 网络/ 环境/ 的/ 适用/ 情况/ 还有/ 待/ 验证/ ./ 方法/ 最终/ 通过/ 关联/ 引擎/ 得到/ 的/ 结果/ 在/ 很大/ 程度/ 上/ 依赖于/ 主机/ 检测工具/ 的/ 结果/ ,/ 单纯/ 网络分析/ 不能/ 直接/ 给出/ 网络/ 主机/ 的/ 可疑/ 度/ ,/ 对于/ 未知/ 僵尸/ 网络/ 的/ 检测/ 也/ 主要/ 取决于/ 主机/ 检测工具/ 的/ 有效性/ ./ 为了/ 减小/ 主机/ 检测/ 结果/ 对/ 关联/ 结果/ 的/ 影响/ ,/ 一个/ 可能/ 的/ 方法/ 是/ 在/ 网络/ 中/ 部署/ 多种/ 检测工具/ ,/ 提出/ 更/ 高效/ 的/ 主机/ 检测/ 方法/ ,/ 同时/ 在/ 网络/ 边缘/ 处/ ,/ 利用/ 流量/ 信息/ ,/ 通过/ 机器/ 学习/ 或/ 其它/ 算法/ 得出/ 网络/ 的/ 检测/ 结果/ ./ 

