Page1/ 云/ 计算/ 系统/ 中/ 基于/ 伴随/ 状态/ 追踪/ 的/ 故障/ 检测/ 机制/ 饶翔/ 1/ )/ 王怀民/ 1/ )/ 陈振邦/ 1/ )/ 周/ 扬帆/ 2/ )/ 蔡华/ 3/ )/ 周琦/ 3/ )/ 孙廷/ 韬/ 3/ )/ 1/ )/ (/ 国防科学技术大学/ 并行/ 与/ 分布/ 处理/ 国家/ 重点/ 实验室/ 长沙/ 410073/ )/ 2/ )/ (/ 香港中文大学/ 深圳/ 研究院/ 深圳/ )/ 3/ )/ (/ 阿里巴巴/ 云/ 计算/ 公司/ 计算/ 平台/ 部/ 杭州/ 310011/ )/ 摘要/ 在/ 运行/ 时/ 检测/ 分布式系统/ 内所/ 产生/ 的/ 故障/ 需要/ 事先/ 获得/ 故障/ 特征/ 模型/ ./ 构造/ 故障/ 特征/ 模型/ 的/ 常见/ 做法/ 为/ 将/ 故障注入/ 系统/ 并/ 根据/ 随后/ 系统/ 内所/ 产生/ 的/ 特征/ 症状/ (/ 如/ 异常/ 事件/ 日志/ )/ 建模/ ./ 已有/ 建模/ 方法/ 通常/ 使用/ 从/ 故障/ 发生/ 到/ 给定/ 时间/ 窗口/ 之内/ 的/ 特征/ 症状/ ./ 然而/ ,/ 根据/ 真实/ 系统/ 观察/ ,/ 不同/ 故障/ 的/ 传播/ 影响/ 时间/ 相差/ 很大/ ,/ 且/ 故障/ 特征/ 会/ 在/ 故障/ 传播/ 过程/ 中/ 发生/ 改变/ ./ 因此/ ,/ 已有/ 方法/ 对/ 检测时间/ 窗口/ 之后/ 发/ 的/ 故障/ 特征/ 症状/ 不能/ 识别/ 或会/ 产生/ 大量/ 错误/ 报警/ ./ 为了/ 解决/ 此/ 问题/ ,/ 文中/ 提出/ 一种/ 基于/ 故障注入/ 测试/ 的/ 故障/ 特征提取/ 方法/ ,/ 该/ 方法/ 主要/ 由/ 3/ 步/ 组成/ :/ (/ 1/ )/ 过滤/ 噪声/ 日志/ ;/ (/ 2/ )/ 构造/ 1/ 个/ 故障/ 识别器/ 识别/ 不同/ 故障/ 的/ 早期/ 特征/ ;/ (/ 3/ )/ 为/ 每类/ 故障/ 构造/ 限/ 状态/ 追踪/ 器/ 追踪/ 该/ 故障/ 的/ 后期/ 传播/ 状态/ ,/ 从而/ 在/ 故障/ 被/ 识别/ 出来/ 后/ 持续/ 跟踪/ 故障/ 传播/ 状态/ ./ 通过/ 在/ 企业级/ 云/ 计算/ 系统/ 中/ 进行/ 实验/ 验证/ ,/ 与/ 已有/ 方法/ 相比/ 该文/ 方法/ 具备/ 更/ 高/ 的/ 故障/ 检测/ 精确度/ ./ 关键词/ 事件/ 日志/ ;/ 故障/ 检测/ ;/ 故障注入/ ;/ 故障/ 特征提取/ ;/ 云/ 计算/ 系统/ 1/ 引言/ 企业级/ 分布式系统/ 往往/ 需要/ 同时/ 处理/ 数以百万计/ 的/ 用户/ 请求/ ,/ 其/ 承载/ 的/ 巨大/ 业务量/ 以及/ 复杂/ 的/ 系统/ 运行/ 环境/ 导致/ 在/ 日常/ 运营/ 中/ 会/ 遇到/ 大量/ 故障/ ./ 如/ 根据/ 为期/ 1/ 年/ 的/ 观察/ 统计/ ,/ 即使/ 在/ 阿里巴巴/ 云/ 计算/ 公司/ 的/ 一个/ 内部/ 小/ 集群/ 中/ ,/ 平均/ 每天/ 也/ 会/ 遇到/ 近/ 100/ 条/ 各类/ 故障/ 报警/ ./ 为了/ 保证/ 应用/ 系统/ 7/ ×/ 24/ 的/ 可用性/ ,/ 企业级/ 分布式系统/ 在/ 设计/ 之初/ 都/ 会/ 考虑/ 一些/ 可信/ 保障机制/ 以/ 容忍/ 系统/ 运行/ 时/ 遇到/ 的/ 故障/ ,/ ECA/ (/ Event/ -/ Condition/ -/ Action/ )/ 是/ 该类/ 机制/ 的/ 常用/ 模式/ :/ 通过/ 持续/ 监视系统/ 的/ 异常/ 行为/ ,/ 并/ 在/ 运行/ 时/ 定位/ 导致系统/ 异常/ 的/ 故障/ 原因/ ,/ 然后/ 执行/ 所/ 对应/ 容错/ 、/ 调度/ 操作/ ./ 如/ ,/ 一旦/ 检测/ 出/ 系统/ 当前/ 大量/ 错误/ 日志/ 由/ 某/ 进程/ 实例/ 崩溃/ 造成/ ,/ 则/ 重启/ 该/ 进程/ 实例/ 并/ 恢复/ 状态/ ;/ 当/ 进一步/ 发现/ 该/ 进程/ 实例/ 持续/ 崩溃/ ,/ 次数/ 过多/ 以至于/ 超过/ 了/ 设定/ 阈值/ ,/ 则/ 将/ 所有/ 与/ 该/ 进程/ 实例/ 相关/ 的/ 所有/ 其它/ 进程/ 实例/ 全部/ 重启/ ,/ 甚至/ 重启/ 相关/ 主机/ [/ 1/ ]/ ./ 由于/ 故障/ 定位/ 结果/ 为/ 系统/ 执行/ 上述/ 策略/ 的/ 输入/ 或者/ 直接/ 触发/ 条件/ ,/ 所以/ 故障/ 定位/ 方法/ 的/ 准确性/ 非常/ 重要/ ./ 准确/ 的/ 故障/ 定位/ 结果/ 除了/ 能够/ 方便/ 系统/ 运维/ 人员/ 准确/ 地/ 了解/ 系统/ 行为/ ,/ 对系统/ 进行/ 管理/ 之外/ ,/ 更/ 重要/ 的/ 是/ 能/ 避免/ 由于/ 错误/ 触发/ 相关/ 容错/ 、/ 调度/ 机制/ 给/ 系统/ 带来/ 的/ 扰动/ ,/ 并/ 造成/ 系统/ 可用性/ 、/ 可靠性/ 的/ 影响/ ./ 系统日志/ 信息/ 为/ 分析/ 系统/ 行为/ 的/ 天然/ 数据源/ ,/ 与/ 专用/ 的/ 监视/ 机制/ 相比/ ,/ 日志/ 信息/ 往往/ 为/ 各类/ 系统/ 的/ 标准配置/ ,/ 基于/ 日志/ 信息/ 的/ 研究/ 方法/ 往往/ 具备/ 通用性/ ,/ 因此/ 大量/ 相关/ 工作/ 以/ 日志/ 信息/ 作为/ 研究/ 对象/ ,/ 尝试/ 从中/ 直接/ 提取/ 故障/ 特征/ 或者/ 分析/ 故障/ 原因/ [/ 2/ -/ 5/ ]/ ./ 其中/ ,/ 一种/ 典型/ 提取/ 故障/ 特征/ 的/ 方法/ 为/ 故障注入/ 法/ ,/ 通过/ 将/ 故障注入/ 系统/ ,/ 并且/ 观察/ 随后/ 产生/ 的/ 日志/ 序列/ ,/ 从中/ 提取/ 故障/ 特征/ ./ 如/ ,/ 通过/ 人为/ 使/ 某/ 进程/ 实例/ 崩溃/ ,/ 将/ 之后/ 出现/ 的/ 特殊/ 类型/ 日志/ 作为/ 该/ 进程/ 实例/ 崩溃/ 故障/ 的/ 特征/ ,/ 则/ 在/ 运行/ 时/ 一旦/ 观察/ 到/ 这/ 几类/ 日志/ 出现/ ,/ 则/ 可以/ 认为/ 该/ 进程/ 实例/ 崩溃/ 发生/ ,/ 从而/ 触发/ 相应/ 的/ 操作/ ,/ 如/ 重启/ 该/ 进程/ ./ 为了/ 提取/ 故障/ 特征/ 模型/ ,/ 相关/ 工作/ 往往/ 基于/ 故障/ 特征/ 时间/ 窗口/ 的/ 方法/ ./ 该类/ 方法/ 假设/ 故障/ 特征/ 会/ 在/ 某/ 设定/ 的/ 时间/ 窗口/ 内/ 出现/ ,/ 只/ 需要/ 分析/ 该/ 时间/ 窗口/ 内/ 的/ 信息/ 即/ 可以/ 提取/ 相关/ 特征/ ./ 该/ 特征/ 时间/ 窗口/ 往往/ 取自/ 故障注入/ 起始/ 时间/ 至/ 某个/ 给定/ 时间/ 点/ ,/ 而此/ 检测时间/ 窗口/ 之后/ 的/ 故障/ 特征/ 信息/ 往往/ 被/ 忽略/ ./ 然而/ ,/ 基于/ 在/ 阿里巴巴/ 云/ 计算/ 公司/ 的/ 生产/ 系统管理/ 实践/ 中/ 发现/ ,/ 不同/ 故障/ 其/ 传播/ 影响/ 时间/ 非常/ 不同/ ,/ 其/ 产生/ 故障/ 特征/ 的/ 时间/ 窗口/ 差异/ 也/ 很大/ ./ 如/ ,/ 在/ 目标/ 系统/ 中/ ,/ 不同/ 故障/ 特征/ 的/ 差异/ 从/ 30s/ 到/ 600s/ 不/ 等/ ./ 随着/ 规模/ 和/ 复杂性/ 的/ 日益增长/ ,/ 现代/ 大规模/ 系统/ 中/ 不同/ 类型/ 故障/ 存在/ 较大/ 差异/ 的/ 现象/ 非常/ 普遍/ ./ 如果/ 简单/ 将/ 时间/ 窗口/ 设定/ 为/ 最大/ 故障/ 特征/ 的/ 时间/ 窗口/ ,/ 则/ 很/ 可能/ 会/ 遗漏/ 在/ 最大/ 特征/ 时间/ 窗口/ 内/ 发生/ 的/ 其它/ 类型/ 故障/ ,/ 而/ 选取/ 最小/ 特征/ 时间/ 窗口/ 则/ 会/ 错误/ 地/ 识别/ 在/ 特征/ 窗口/ 之外/ 的/ 残余/ 特征/ ./ 相关/ 工作/ 往往/ 通过/ 选取/ 对/ 所有/ 故障/ 特征/ 识别率/ 最高/ 的/ 时间/ 窗口/ 作为/ 最终/ 的/ 检测/ 窗口/ ,/ 该/ 窗口/ 大小/ 介于/ 最大/ 特征/ 窗口/ 与/ 最小/ 特征/ 窗口/ 之间/ ./ 因此/ ,/ 使用/ 传统/ 检测/ 窗口/ 故障/ 建模/ 方法/ 的/ 直接/ 结果/ 为/ :/ 对于/ 一类/ 故障/ 所/ 产生/ 的/ 故障/ 特征/ 信息/ 只能/ 确定/ 其/ 早期/ 的/ 故障/ 特征/ ,/ 而/ 之后/ 的/ 特征/ 将/ 可能/ 会/ 被/ 错误/ 识别/ ,/ 造成/ 误报/ 或者/ 被/ 忽略/ 造成/ 漏报/ ,/ 直接/ 影响/ 系统/ 的/ 故障/ 管理机制/ ,/ 造成/ 系统/ 可用性/ 不必要/ 的/ 抖动/ ./ 如/ ,/ 当某/ 服务/ 进程/ 实例/ 崩溃/ ,/ 但是/ 除了/ 第/ 1/ 个/ 特征/ 检测/ 窗口/ 正确/ 识别/ 之外/ ,/ 其/ 残余/ 特征/ 影响/ 了/ 之后/ 的/ 检测/ 结果/ ,/ 并/ 被/ 错误/ 地/ 识别/ 为/ 其它/ 类型/ 的/ 故障/ ,/ 系统管理员/ 观察/ 到/ 某台/ 主机/ 上/ 多个/ 不同/ 类型/ 的/ 进程/ 发生/ 崩溃/ ,/ 很/ 可能/ 错误/ 地/ 将/ 该/ 机器/ 重启/ ,/ 严重/ 影响/ 系统/ 的/ 可用性/ ./ 针对/ 不同/ 类型/ 故障/ 特征/ 持续时间/ 不同/ 的/ 问题/ ,/ 并/ 针对/ 基于/ 固定/ 检测时间/ 窗口/ 故障/ 特征/ 建模/ 机制/ 的/ 不足/ ,/ 本文/ 提出/ 基于/ 伴随/ 状态/ 追踪/ 的/ 故障/ 定位/ 机制/ ,/ 记为/ CST/ (/ CompanionStateTracer/ )/ ./ 该/ 方法/ 可以/ 识别/ 当前/ 时间/ 窗口/ 内/ 的/ 日志/ 项/ 特征/ 是/ 由/ 新/ 的/ 故障/ 所/ 引起/ 还是/ 之前/ 发生/ 的/ 故障/ 引起/ ,/ 从而/ 消除/ 故障/ 定位/ 结果/ 的/ 误报/ 、/ 漏报/ ./ 通过/ 将/ CST/ 部署/ 于/ 阿里巴巴/ 云/ 计算/ 公司/ 的/ 测试/ 集群/ 中/ ,/ 我们/ 对/ CST/ 的/ 有效性/ 进行/ 了/ 验证/ ./ 实验/ 结果表明/ ,/ 与/ 传统/ 固定/ 故障/ 特征/ 窗口/ 方法/ 相比/ ,/ CST/ 能够/ 以/ 更/ 细粒度/ 的/ 方式/ 追踪/ 故障/ 特征/ 的/ 状态/ 变化/ 从而/ 降低/ 系统/ 报警/ 的/ 误报率/ 和/ 漏报/ 率/ ./ 本文/ 第/ 2/ 节对/ 基于/ 伴随/ 状态/ 的/ 故障/ 追踪/ 问题/ 进行/ 描述/ ,/ 包括/ 相关/ 定义/ 、/ 实际/ 系统/ 的/ 观察/ 以及/ 故障/ 特征提取/ 问题/ 的/ 前提/ 假设/ ;/ 第/ 3/ 节/ 介绍/ 基于/ 决策树/ 模型/ 的/ 主/ 特征/ 建模/ 方法/ ;/ 第/ 4/ 节/ 详细/ 介绍/ 伴随/ 状态/ 追踪/ 器/ 的/ 构造/ 方式/ ;/ 第/ 5/ 节/ 给出/ 基于/ 伴随/ 状态/ 追踪/ 的/ 故障/ 定位/ 方法/ 整体/ 框架/ ;/ 第/ 6/ 节为/ 实验/ 与/ 分析/ ;/ 第/ 7/ 节为/ 相关/ 研究/ 工作/ ;/ 最后/ ,/ 第/ 8/ 节/ 总结/ 本节/ 的/ 工作/ 及/ 主要/ 贡献/ ./ Page32/ 问题/ 描述/ 2.1/ 基本/ 观察/ 为了/ 建模/ 系统/ 内/ 的/ 故障/ 特征/ ,/ 我们/ 手动/ 向/ 系统/ 中/ 重复/ 多次/ 注入/ 故障/ ,/ 并/ 使用/ [/ ts/ ,/ ts/ +/ Tw/ ]/ 时间/ 窗口/ 内/ 的/ 日志/ 信息/ 对/ 故障/ 特征/ 进行/ 建模/ [/ 4/ ,/ 6/ ]/ ,/ 具体/ 过程/ 如下/ :/ (/ 1/ )/ 手动/ 将/ 故障/ f/ 于/ 时刻/ ts/ 注入/ 系统/ ,/ 之后/ 可能/ 观察/ 到/ 请求/ 失效/ 的/ 情况/ ./ (/ 2/ )/ 在/ 请求/ 失效/ 后/ 第/ 1/ 个/ 成功/ 请求/ 发生/ 时刻/ 将/ 被/ 记为/ 故障/ 恢复/ 时刻/ ,/ 记为/ te/ ./ (/ 3/ )/ Ei/ ,/ 1/ =/ 〈/ e1/ ,/ e2/ ,/ …/ ,/ em/ 〉/ 为/ 在/ 第/ i/ 轮/ 测试/ 中/ 故障/ 特征/ 窗口/ [/ ts/ ,/ ts/ +/ Tw/ ]/ 内/ 收集/ 的/ 日志/ 类型/ 特征向量/ 信息/ ,/ 并/ 假设/ 这些/ 日志/ 信息/ 与/ 故障/ f/ 相关/ ,/ 因此/ 将/ Ei/ ,/ 1/ 的/ 故障/ 特征/ 类型/ 标识/ 为/ f/ ./ 其中/ ej/ 代表/ 日志/ 类型/ j/ 在/ 故障/ 特征/ 窗口/ [/ ts/ ,/ ts/ +/ Tw/ ]/ 内/ 的/ 出现/ 情况/ ,/ 1/ 代表/ 出现/ 而/ 0/ 代表/ 不/ 出现/ ./ (/ 4/ )/ 对/ 有/ 被/ 标识/ 故障/ 特征/ 类型/ 的/ 日志/ 类型/ 特征向量/ 使用/ C4/ ./ 5/ 决策树/ 模型/ [/ 4/ ]/ 构建/ 方法/ ,/ 从而/ 得到/ 一个/ 基于/ 规则/ 的/ 故障/ 分类器/ ./ 图/ 1/ 不同/ 时间/ 窗口/ 下/ 的/ F/ -/ Measure/ 值/ 现象/ 1/ ./ 最优/ 检测时间/ 窗口/ 出现/ 在/ 故障/ 传播/ 初期/ ./ 为了/ 更/ 清晰/ 地/ 了解/ 最优/ 故障/ 特征/ 时间/ 窗口/ 的/ 选取/ 情况/ ,/ 我们/ 将/ 图/ 1/ (/ a/ )/ 的/ 前/ 部分/ 进行/ 放大/ 得到/ 图/ 1/ (/ b/ )/ ./ 可以/ 观察/ ,/ 最大/ wFmeasure/ 所/ 对应/ 的/ Tw/ 为/ 6s/ (/ 对应/ 时间/ 戳/ 为/ 2/ )/ ,/ 这/ 也/ 意味着/ 故障/ 的/ 早期/ 特征/ 的确/ 能/ 有效/ 区分/ 不同/ 故障/ ./ 现象/ 2/ ./ 随着/ 故障/ 特征/ 窗口/ 逐渐/ 增大/ ,/ 故障/ 模型/ 的/ 准确率/ 收敛/ 非常/ 快/ ./ 从图/ 1/ (/ a/ )/ 可以/ 看出/ ,/ 在/ 36s/ (/ 对应/ 时间/ 戳/ 为/ 12/ )/ 之后/ ,/ 故障/ 特征/ 的/ 有效性/ 基本/ 不再/ 改变/ ./ 现象/ 3/ ./ 只有/ 早期/ 的/ 故障/ 特征/ 能够/ 被/ 识别/ 出来/ ,/ 而/ 故障/ 特征/ 会/ 随着/ 故障/ 传播/ 的/ 阶段/ 而/ 发生变化/ ./ 为了/ 解释/ 上述/ 现象/ ,/ 我们/ 尝试/ 分析/ 文件系统/ 以/ 进程/ 崩溃/ 故障/ 为例/ ,/ 图/ 3/ 展示/ 了/ 设定/ 不同/ 时间/ 窗口/ Tw/ 所/ 得到/ 的/ 故障/ 模型/ 有效性/ ./ 基于/ 10/ 折/ 交叉/ 验证/ 方法/ ,/ 我们/ 衡量/ 了/ 所有/ 类型/ 进程/ 崩溃/ 故障/ 的/ 精确/ 率/ (/ 正确/ 检测/ 与/ 所有/ 检测/ 出/ 结果/ 的/ 比例/ )/ 和/ 召回/ 率/ (/ 正确/ 检测/ 与/ 所有/ 注入/ 故障/ 的/ 比例/ )/ 以及/ 精确/ 率/ 和/ 召回/ 率/ 的/ 调和/ 平均值/ F/ -/ Measure/ ./ 如式/ (/ 1/ )/ 所示/ ,/ tp/ 、/ fp/ 和/ fn/ 分别/ 代表/ 真正/ (/ truepositive/ )/ 、/ 假正/ (/ falsepositive/ )/ 和/ 假负/ (/ falsenegative/ )/ ./ 而/ 所有/ 故障/ 特征/ F/ -/ Measure/ 的/ 平均值/ 记为/ wFmeasure/ ,/ 我们/ 最终/ 使用/ wFmeasure/ 来/ 衡量/ 故障/ 特征/ 的/ 整体/ 有效性/ ./ 为了/ 找到/ 能/ 获得/ 最大/ wFmeasure/ 值/ 的/ 最优/ 检测/ 窗口/ Tw/ ,/ 我们/ 使用/ 了/ 常用/ 的/ 迭代法/ [/ 6/ -/ 7/ ]/ :/ 首先/ 将/ Tw/ 值/ 设定/ 为/ 很小/ 的/ 值/ ,/ 然后/ 逐步/ 增大/ (/ 如/ 每次/ 增加/ 3s/ )/ ,/ 以/ 最长/ 故障/ 传播/ 时间/ 为/ 最大/ 时间/ 窗口/ 限制/ ./ 如图/ 1/ (/ a/ )/ 所示/ ,/ x/ 轴为/ 代表/ 故障注入/ 后/ 的/ 最初/ Tw/ 秒/ (/ 即/ 检测/ 窗口/ )/ ./ 我们/ 使用/ 测试用例/ 中/ 最长/ 的/ 故障/ 传播/ 时间/ 作为/ Tw/ 的/ 最大值/ ,/ 即/ FSmr/ 将近/ 600s/ 的/ 故障/ 特征/ 持续时间/ ./ 由于/ 空间/ 限制/ ,/ 图/ 1/ (/ a/ )/ 只/ 显示/ 了/ 前/ 50/ 个/ 时间/ 戳/ (/ 以/ 3s/ 为/ 间隔/ )/ ./ 对于/ 故障/ 传播/ 时间/ 小于/ Tw/ 的/ 故障/ ,/ 则/ 直接/ 使用/ 其/ 整个/ 故障/ 传播/ 周期/ [/ ts/ ,/ te/ ]/ 内/ 的/ 数据/ ./ master/ 进程/ (/ FSmr/ )/ 崩溃/ 的/ 故障/ 特征/ ./ FSmr/ 失效/ 后/ 的/ 自动/ 恢复/ 时间/ 为/ 大约/ 600s/ ,/ 其/ 影响/ 在/ 日志/ 信息/ 中/ 展现/ 的/ 模式/ 如图/ 2/ 所示/ ./ 图/ 2/ 中/ ,/ x/ 轴为/ 以/ 3s/ 为/ 单位/ 所/ 记录/ 的/ 时间/ 戳/ ,/ 开始/ 时间/ 为/ FSmr/ 进程/ 实例/ 崩溃/ 的/ 时间/ ,/ 结束/ 时间/ 为/ 该/ 服务/ 正常/ 响应/ 请求/ 的/ 时间/ ;/ y/ 轴为/ 在/ 每个/ 采样/ 时间/ 窗口/ 内/ 出现/ 的/ 日志/ 类型/ 数量/ ,/ 其中/ 不同/ 类型/ 的/ 日志/ 信息/ 使用/ 了/ 不同/ 的/ 颜色/ 进行/ 标识/ ./ precision/ =/ tprecall/ =/ tpPage4/ 由图/ 2/ 可以/ 观察/ ,/ 在/ 故障/ 特征/ 的/ 不同/ 阶段/ ,/ 日志/ 类型/ 的/ 出现/ 有/ 明显/ 的/ 变化规律/ ./ 故障/ 早期/ 有/ 几类/ 特殊/ 的/ 日志/ 出现/ ,/ 但是/ 出现/ 的/ 总/ 类型/ 数量/ 不/ 多/ ,/ 而且/ 出现/ 规律/ 比较/ 杂乱/ ;/ 在/ 故障/ 中期/ ,/ 虽然/ 出现/ 的/ 日志/ 类型/ 较/ 多/ ,/ 但是/ 与/ 初期/ 的/ 日志/ 类型/ 有/ 较大/ 差异/ ,/ 且/ 规律/ 比较稳定/ ;/ 在/ 故障/ 后期/ ,/ 出现/ 日志/ 类型/ 明显/ 减少/ ,/ 规律/ 也/ 比较稳定/ ./ 图/ 2FSmr/ 崩溃/ 故障/ 的/ 日志/ 类型/ 特征向量/ 变化/ 模式/ 示例/ 为了/ 验证/ 使用/ 固定/ 故障/ 特征/ 窗口/ 所/ 构建/ 故障/ 特征/ 的/ 有效性/ ,/ 我们/ 将/ 不同/ 故障/ 特征/ 窗口/ 所/ 创建/ 的/ 故障/ 特征/ 识别/ 规则/ 应用/ 于/ FSmr/ 故障/ 持续/ 的/ 整个/ 周期/ ,/ 并/ 衡量/ 了/ 识别/ 结构/ 的/ 误报率/ (/ falsepositiverate/ )/ ,/ 结果/ 如图所示/ ./ 在/ 图/ 3/ 中/ ,/ x/ 轴为/ 间隔/ 为/ 3s/ 的/ 故障/ 特征/ 窗口/ Tw/ 值/ ,/ y/ 轴/ 误报率/ ./ 可以/ 观察/ :/ 对于/ 所有/ 故障/ 特征/ 窗口/ 取值/ ,/ 由于/ 仅仅/ 只有/ 第/ 1/ 个/ 故障/ 特征/ 窗口/ (/ 即/ [/ ts/ ,/ ts/ +/ Tw/ ]/ )/ 中/ 的/ 日志/ 信息/ 被/ 正确/ 识别/ 为/ FSmr/ ,/ 而/ 其它/ 检测/ 窗口/ 则/ 被/ 错误/ 识别/ 为/ 其它/ 故障/ 类型/ ./ 虽然/ 误报率/ 度会/ 随着/ Tw/ 的/ 增大/ 而/ 降低/ ,/ 但是/ 这种/ 增长/ 是/ 由/ 分母/ (/ 故障/ 传播/ 周期/ 内/ 的/ 采样/ 数量/ )/ 变小/ 造成/ 的/ ,/ 与/ 模型/ 的/ 好坏/ 无关/ ./ 综合/ 以上/ 观察/ ,/ 我们/ 发现/ :/ 虽然/ 每/ 类/ 故障/ 特征/ 的/ 规律/ 可能/ 不/ 一样/ ,/ 但是/ 结合/ 图/ 3/ 以及/ 图/ 1/ (/ a/ )/ 我们/ 不难看出/ ,/ 故障/ 特征/ 的/ 快速/ 收敛性/ 意味着/ 后期/ 的/ 故障/ 特征/ 相对/ 初期/ 故障/ 特征/ 显著性/ 较底/ ./ 由于/ 后期/ 故障/ 图/ 3/ 最优/ 故障/ 特征/ 模型/ 应用/ 于/ FSmr/ 故障/ 持续/ 周期/ 的/ 识别率/ 特征/ 往往/ 由/ 故障/ 恢复/ 、/ 状态/ 同步/ 等/ 行为/ 展现/ ,/ 而/ 并非/ 单纯/ 故障/ 本身/ 的/ 影响/ ,/ 因此/ 可能/ 与/ 其它/ 故障/ 的/ 后期/ 行为/ 区别/ 较/ 小/ ,/ 其/ 行为/ 也/ 与/ 故障/ 早期/ 的/ 行为/ 差别/ 很大/ ./ 所以/ ,/ 一方面/ ,/ 使用/ 早期/ 故障/ 模型/ 不足以/ 识别/ 后期/ 故障/ 模型/ ,/ 另一方面/ ,/ 后期/ 故障/ 特征/ 对/ 故障/ 特征/ 显著性/ 的/ 提升/ 作用/ 较/ 小/ ./ 这种/ 现象/ 最终/ 造成/ 的/ 影响/ 为/ :/ 故障/ 特征/ 窗口/ 方法/ 不足以/ 识别/ 故障/ 特征/ 窗口/ 之外/ 的/ 故障/ 特征/ ./ 如果/ 不/ 解决/ 此/ 问题/ ,/ 则/ 会/ 造成/ 故障/ 定位/ 结果/ 存在/ 大量/ 错报/ 或/ 误报/ ,/ 很难/ 将/ 基于/ 故障/ 特征/ 的/ 故障/ 定位/ 方法/ 运用/ 于/ 系统/ 在线/ 故障/ 管理/ 之中/ ./ 2.2/ 相关/ 定义/ 对/ 故障/ 特征/ 进行/ “/ 持续/ 建模/ ”/ 的/ 关键/ 为/ 从/ 原始/ 日志/ 信息/ 中/ 提取/ 故障/ 传播/ 的/ 状态/ 变化规律/ ./ 通常/ 基于/ 事件/ 日志/ 信息提取/ 状态/ 变化规律/ 会/ 从/ 日志/ 信息/ 的/ 事件/ 特性/ 入手/ ,/ 从/ 日志/ 序列/ 中/ 提取/ 事件/ 日志/ 的/ 因果/ 规律/ ./ 如/ 相关/ 工作/ 通过/ 日志/ 分析/ 函数调用/ 序列/ [/ 3/ ,/ 8/ -/ 9/ ]/ ,/ 从而/ 构造/ 事件/ 序列/ 模型/ 用于/ 异常/ 检测/ 和/ 故障/ 定位/ ./ 然而/ ,/ 由于/ 分布式系统/ 中/ 不同/ 主机/ 的/ CPU/ 时钟/ 并/ 不/ 同步/ ,/ 导致/ 很难/ 直接/ 推导/ 出/ 日志/ 事件/ 粒度/ 的/ 因果关系/ 模型/ ./ 虽然/ 在/ 目标/ 系统/ 通过/ 网络/ 时间/ 同步/ 协议/ 使得/ 时间误差/ 在/ 秒/ 级/ 以内/ ,/ 但是/ 对于/ 使用/ 微秒/ 粒度/ 记录/ 的/ 日志/ 来说/ 仍然/ 存在/ 较大/ 误差/ ./ 我们/ 通过/ 将/ 系统/ 状态/ 变化/ 模型/ 抽象/ 为/ 以/ 特定/ 采样/ 窗口/ 为/ 粒度/ 的/ 日志/ 类型/ 特征向量/ 变化/ 序列/ 模型/ ,/ 来/ 降低/ 事件/ 序列/ 分析/ 问题/ 的/ 维度/ ,/ 进而/ 在/ 相对/ 粗粒度/ 的/ 情况/ 下/ 构建/ 较为/ 准确/ 的/ 故障/ 特征/ 变化/ 模型/ ./ 在/ 整个/ 方法/ 中/ ,/ 我们/ 将/ 日志/ 类型/ 特征向量/ 作为/ 故障/ 行为/ 特征/ 抽象/ 的/ 基本/ 单元/ ,/ 定义/ 如下/ ./ 定义/ 1/ (/ 日志/ 类型/ 特征向量/ )/ ./ 给定/ 故障/ 类型/ f/ ,/ 日志/ 类型/ 标识/ 集合/ T/ =/ {/ 1/ ,/ 2/ ,/ …/ ,/ m/ }/ ,/ 日志/ 监视/ 时间/ 窗口/ Tw/ ,/ 故障/ f/ 第/ i/ 轮/ 测试/ 第/ j/ 个/ 检测/ 窗口/ 内/ 的/ 日志/ 类型/ 特征向量/ 犈/ i/ ,/ j/ =/ 〈/ e1/ ,/ e2/ ,/ …/ ,/ em/ 〉/ ./ 其中/ et/ ∈/ {/ 1/ ,/ 0/ }/ ,/ t/ ∈/ T/ 表示/ 日志/ 类型/ t/ 的/ 出现/ 情况/ :/ 1/ 代表/ 出现/ ,/ 0/ 代表/ 未/ 出现/ ./ 定义/ 2/ (/ 主要/ 特征/ )/ ./ 给定/ 故障/ 类型/ f/ ,/ 日志/ 监视/ 时间/ 窗口/ Tw/ ,/ 故障注入/ 的/ 起始/ 时间/ ts/ ,/ 故障/ 恢复/ 时间/ te/ ,/ 主要/ 特征/ 为/ 从/ [/ ts/ ,/ ts/ +/ Tw/ ]/ 中/ 出现/ 的/ 日志/ 项中/ 提取/ 的/ 故障/ 特征/ ./ 定义/ 3/ (/ 伴随/ 特征/ )/ ./ 给定/ 故障/ 类型/ f/ ,/ 日志/ 监视/ 时间/ 窗口/ Tw/ ,/ 故障注入/ 的/ 起始/ 时间/ ts/ ,/ 故障/ 恢复/ 时间/ te/ ,/ 伴随/ 特征/ 即/ 从/ (/ ts/ +/ Tw/ ,/ te/ ]/ 中/ 出现/ 的/ 日志/ 项中/ 提取/ 的/ 故障/ 特征/ ./ 我们/ 通过/ 对/ 所有/ 故障/ 的/ 主要/ 特征/ 进行/ 统一/ 建/ Page5/ 模/ ,/ 然后/ 再/ 对/ 每类/ 故障/ 伴随/ 特征/ 进行/ 独立/ 建模/ ,/ 从而/ 在/ 初始/ 定位/ 某类/ 故障/ 后/ 使用/ 伴随/ 特征/ 对/ 该类/ 故障/ 的/ 状态/ 进行/ 持续/ 追踪/ ./ 具体/ 本文/ 所/ 使用/ 的/ 相关/ 符号/ 与/ 定义/ 见表/ 1/ 所述/ ./ fRmT/ =/ {/ 1/ ,/ 2/ ,/ …/ ,/ m/ }/ 日志/ 类型/ 集合/ ,/ 其中/ 所有/ 日志/ 类型/ 进行/ 排/ ts/ ,/ teTwTfthSet/ 犈/ i/ ,/ j/ =/ 〈/ e1/ ,/ e2/ ,/ …/ ,/ em/ 〉/ 故障/ f/ 第/ i/ 轮/ 测试/ 第/ j/ 个/ 检测/ 窗口/ 内/ 的/ Pi/ ,/ j/ =/ 〈/ t1/ ,/ t2/ ,/ …/ ,/ tk/ 〉/ Pi/ ,/ j/ _/ ex/ =/ 〈/ Pi/ ,/ j/ ,/ round/ _/ id/ _/ list/ 〉/ Sf/ ,/ i/ =/ 〈/ Ei/ ,/ 1/ ,/ Ei/ ,/ 2/ ,/ …/ ,/ Ei/ ,/ k/ 〉/ 故障/ f/ 第/ i/ 轮/ 测试/ 的/ 伴随/ 状态/ 序列/ SSf/ =/ Sf/ ,/ 1/ +/ Sf/ ,/ 2/ +/ …/ +/ Sf/ ,/ NStfTf/ ,/ i2/ ./ 3/ 问题/ 描述/ 为了/ 解决/ 传统/ 基于/ 故障/ 特征/ 窗口/ 的/ 建模/ 方法/ 对/ 故障/ 特征/ 窗口/ 之外/ 的/ 故障/ 行为/ 不能/ 正确/ 识别/ 的/ 问题/ ,/ 本文/ 通过/ 将/ 故障/ 特征/ 窗口/ 建模/ 方法/ 扩展/ 为/ 以/ 基本/ 监视/ 窗口/ 为/ 粒度/ 的/ 故障/ 日志/ 类型/ 特征向量/ 特征/ 序列/ 追踪/ 方法/ ,/ 从而/ 实现/ 对/ 故障/ 特征/ 的/ 持续/ 监视/ ,/ 有效/ 降低/ 了/ 传统/ 故障/ 定位/ 方法/ 的/ 误报/ 与/ 漏报/ ./ 本节/ 将/ 在/ 如下/ 假设/ 中/ 进行/ 故障/ 定位/ :/ (/ A1/ )/ 系统/ 在/ 故障注入/ 测试阶段/ 存在/ 持续/ 的/ 请/ (/ A2/ )/ 所有/ 的/ 日志/ 已经/ 分类/ ;/ (/ A3/ )/ 只/ 研究/ 都/ 能/ 在/ 日志/ 中/ 留下/ 特征/ 的/ 故障/ ;/ (/ A4/ )/ 在/ 故障/ 特征提取/ 阶段/ ,/ 一个/ 故障/ 的/ 影响/ 周期/ 内/ 不会/ 发生/ 另/ 一个/ 故障/ ./ 对于/ (/ A1/ )/ ,/ 在/ 面向/ 互联网/ 应用/ 的/ 7/ 天/ ×/ 24/ 小时/ 系统/ 应用/ 背景/ 下/ ,/ 系统/ 几乎/ 持续/ 处于/ 请求/ 响应/ 状态/ 为/ 该类/ 应用/ 的/ 基本/ 假设/ ./ 通过/ 使用/ 日志/ 属性/ LogPath/ 和/ SourceProcess/ 作为/ 分类/ 依据/ 可以/ 保证/ (/ A2/ )/ ,/ 同时/ 由于/ 我们/ 研究/ 的/ 基本/ 对象/ 为/ 具有/ 类型/ 标求/ 调用/ ;/ 识/ 的/ 日志/ 信息/ ,/ 所以/ 本文/ 的/ 方法/ 可以/ 很/ 方便/ 地/ 扩展/ 到/ 其它/ 已有/ 的/ 日志/ 分类/ 方法/ 中/ ./ 对于/ (/ A3/ )/ ,/ 虽然/ 可能/ 存在/ 某些/ 故障/ 不会/ 在/ 错误/ 日志/ 中/ 留下/ 踪迹/ ,/ 但是/ 这种/ 情况/ 实际/ 非常/ 少见/ ,/ 与/ 我们/ 基于/ 日志/ 提取/ 故障/ 特征/ 的/ 目标/ 不/ 相符/ ./ (/ A4/ )/ 为/ 故障/ 独立性/ 假设/ ,/ 不失/ 一般/ ,/ 基于/ 故障注入/ 的/ 故障/ 特征提取/ 相关/ 研究/ 工作/ 通常/ 都/ 做/ 故障/ 独立性/ 假设/ ./ 3/ 基于/ 决策树/ 模型/ 的/ 主/ 特征/ 建模/ 方法/ 给定/ 故障/ 类型/ f/ 、/ 日志/ 监视/ 时间/ 窗口/ Tw/ 、/ 故障注入/ 的/ 起始/ 时间/ ts/ 、/ 故障/ 恢复/ 时间/ te/ 、/ 为了/ 识别/ 整个/ 故障/ 传播/ 过程/ 中/ 所/ 出现/ 的/ 所有/ 特征/ ,/ 我们/ 首先/ 将/ 事件/ 日志/ 分为/ 两组/ ,/ 一组/ 为/ 主要/ 特征/ 日志/ ,/ 即/ [/ ts/ ,/ ts/ +/ Tw/ ]/ 中/ 出现/ 的/ 日志/ ,/ 另一组/ 为/ 伴随/ 特征/ 日志/ ,/ 即/ (/ ts/ +/ Tw/ ,/ te/ ]/ 内/ 出现/ 的/ 日志/ ./ 基于/ 此/ 划分/ ,/ 完整/ 的/ 故障/ 特征提取/ 方法/ 由/ 3/ 步/ 组成/ :/ 构造/ 一个/ 基于/ 规则/ 的/ 故障/ 分类器/ ./ (/ 1/ )/ 过滤/ [/ ts/ ,/ te/ ]/ 阶段/ 出现/ 的/ 噪声/ 日志/ ./ (/ 2/ )/ 对于/ 主要/ 特征/ 日志/ ,/ 使用/ C4/ ./ 5/ 决策树/ 模型/ (/ 3/ )/ 对于/ 伴随/ 特征/ 日志/ ,/ 基于/ 日志/ 项/ 建模/ 其/ 变化/ 模式/ ./ 对于/ 步骤/ (/ 1/ )/ ,/ 由于/ 我们/ 采用/ 基于/ 故障注入/ 方式/ 对/ 日志/ 特征/ 进行/ 建模/ ,/ 因此/ 首先/ 需要/ 确定/ 使用/ 与/ 注入/ 故障/ 最为/ 相关/ 的/ 日志/ 信息/ 作为/ 特征提取/ 对象/ ./ 本文/ 使用/ 两个/ 启发式/ 方法/ 来/ 过滤/ 不/ 相关/ 的/ 日志/ 信息/ :/ ①/ 在/ [/ ts/ ,/ te/ ]/ 阶段/ 新/ 产生/ 的/ 日志/ 类型/ 将/ 被/ 保留/ ,/ ②/ 对于/ 在/ 故障注入/ 阶段/ 之前/ 已经/ 产生/ 的/ 日志/ 类型/ ,/ 那些/ 不/ 符合/ 其/ 出现/ 规律/ 的/ 日志/ 将/ 被/ 删除/ ./ 从/ 因果关系/ 分析/ 的/ 角度/ ,/ 那些/ 只有/ 在/ 注入/ 故障/ 之后/ 才/ 出现/ 的/ 日志/ 类型/ 最/ 可能/ 与/ 所/ 注入/ 故障/ 相关/ ;/ 如果/ 注入/ 故障/ 能够/ 影响/ 某些/ 日志/ 类型/ 出现/ 的/ 规律/ ,/ 则/ 这些/ 日志/ 也/ 可能/ 与/ 注入/ 故障/ 相关/ ./ 因为/ 最/ 可能/ 与/ 注入/ 故障/ 相关/ ;/ 为了/ 过滤/ 这些/ 噪音/ 日志/ ,/ 我们/ 设计/ 了/ 一种/ 基于/ 时间/ 序列/ 相似/ 度/ 的/ 日志/ 预处理/ 方法/ SBF/ ./ SBF/ 独立/ 对/ 每类/ 日志/ 按照/ 其/ 在/ 给定/ 采样/ 间隔/ 内/ 出现/ 的/ 数量/ 将/ 其/ 建模/ 为/ 时间/ 序列/ ./ 通过/ 在/ ts/ 之前/ 设定/ 一个/ 噪音/ 采样/ 窗口/ Tf/ ,/ SBF/ 对比/ 了/ [/ ts/ -/ Tf/ ,/ ts/ ]/ 阶段/ 所/ 收集/ 噪音/ 模板/ 与/ [/ ts/ ,/ te/ ]/ 中/ 相同/ 日志/ 类型/ 的/ 时间/ 序列/ 的/ 相似/ 度/ ,/ 将/ 与/ 噪声/ 采样/ 模板/ 相似/ 的/ 日志/ 当作/ 噪音/ 进行/ 过滤/ ./ 对于/ 第/ 2/ 步/ ,/ 对/ 主要/ 特征/ 日志/ 进行/ 建模/ ,/ 构造/ 主/ 特征/ 识别器/ ./ 主/ 特征/ 识别器/ 为/ 一个/ 分类器/ ,/ 通过/ 一个/ Page6/ 目标/ 函数/ (/ targetfunction/ )/ 将/ 日志/ 类/ 属性/ 映射/ 为/ 预先/ 设定/ 的/ 故障/ 类型/ 标识/ ./ 常用/ 的/ 分类器/ 包括/ 决策树/ 分类法/ 、/ 基于/ 规则/ 的/ 分类法/ 、/ 神经网络/ 、/ 支持/ 向量/ 机和/ 朴素/ 贝叶斯/ 分类法/ ./ 其/ 往往/ 需要/ 使用/ 一种/ 学习/ 算法/ 确定/ 分类/ 模型/ ,/ 从而/ 拟合/ 学习/ 样本/ 数据/ 中/ 类型/ 标识/ 与/ 属性/ 集/ 之间/ 的/ 映射/ 关系/ ,/ 并/ 进一步/ 基于/ 此/ 分类/ 模型/ 正确/ 地/ 预测/ 未知/ 样本/ 的/ 类/ 标号/ [/ 10/ ]/ ./ 构造/ 分类器/ 的/ 一般/ 学习/ 算法/ 需要/ 将/ 数据/ 划分/ 为/ 训练/ 集/ 和/ 检验/ 集/ ./ 训练/ 集由/ 已经/ 标识/ 了/ 类型/ 的/ 数据/ 记录/ 组成/ ,/ 用于/ 建立/ 分类/ 模型/ ;/ 检验/ 集由/ 类型/ 标识/ 未知/ 的/ 记录/ 组成/ ,/ 用于/ 检验/ 分类器/ 的/ 有效性/ ./ 有效性/ 的/ 衡量/ 方式/ 可以/ 使用/ 精确/ 率/ 和/ 召回/ 率/ ,/ 具体/ 可以/ 参考/ 式/ (/ 1/ )/ ,/ 这里/ 不再/ 重复/ 叙述/ ./ 3.1/ 决策树/ 模型/ 决策树/ 是/ 一种/ 简单/ 有效/ 而/ 被/ 广泛/ 使用/ 的/ 分类/ 技术/ ,/ 常用/ 于/ 解决/ 多/ 属性数据/ 的/ 分类/ 问题/ ./ 决策树/ 是/ 一种/ 由/ 结点/ 和/ 有/ 向/ 边/ 组成/ 的/ 层次结构/ ,/ 具体/ 包含/ 3/ 种/ 节点/ [/ 10/ ]/ :/ (/ 1/ )/ 根/ 节点/ ./ 没有/ 入边/ ,/ 但是/ 有/ 零条/ 或/ 多条/ 出边/ ;/ (/ 2/ )/ 内部/ 节点/ ./ 有/ 一条/ 入边/ 和/ 两条/ 或/ 多条/ 出边/ ;/ (/ 3/ )/ 叶/ 节点/ ./ 只有/ 一条/ 入边/ ,/ 没有/ 出边/ ./ 根/ 节点/ 与/ 内部/ 节点/ 都/ 用来/ 表示/ 属性/ 测试/ 条件/ ,/ 用于/ 区分/ 不同/ 特性/ 的/ 记录/ ,/ 而叶/ 节点/ 用来/ 表示/ 类型/ 标识/ ./ 当/ 基于/ 训练/ 集/ 数据/ 构造/ 完/ 分类器/ 之后/ ,/ 从树/ 的/ 根/ 节点/ 开始/ 将/ 其/ 应用/ 于/ 检验/ 集/ ,/ 根据/ 条件/ 判断/ 结果/ 选择/ 不同/ 的/ 分支/ ,/ 最终/ 到达/ 叶/ 节点/ ,/ 则/ 叶/ 节点/ 对应/ 的/ 类型/ 标识/ 即/ 为/ 该/ 检验/ 记录/ 的/ 类型/ 标识/ ,/ 从根/ 节点/ 到/ 该/ 叶/ 节点/ 所/ 经历/ 的/ 路径/ 即/ 决策/ 过程/ ./ 决策树/ 仅/ 有/ 单一/ 输出/ ,/ 若/ 欲/ 有/ 复数/ 输出/ ,/ 可以/ 建立/ 独立/ 的/ 决策树/ 以/ 处理/ 不同/ 输出/ ./ 在/ 没有/ 任何/ 剪枝/ 的/ 情况/ 下/ ,/ 决策树/ 模型/ 的/ 规模/ 往往/ 可以/ 达到/ 指数/ 级/ ,/ 因此/ 其/ 构造/ 时间/ 不/ 可控/ ,/ 为了/ 能/ 在/ 合理/ 的/ 时间/ 内/ 构造/ 一个/ 可用/ 的/ 决策树/ 模型/ ,/ 很多/ 经典/ 启发式/ 算法/ (/ 如/ 贪心/ 算法/ )/ ,/ 往往/ 通过/ 使用/ 一系列/ 局部/ 最优/ 策略/ 构造/ 决策树/ ./ 经典/ 的/ 决策树/ 构造/ 算法/ 采用/ 递归/ 的/ 方式/ ,/ 每个/ 决策树/ 可以/ 依靠/ 对源/ 数据库/ 的/ 分割/ 进行/ 数据测试/ ./ 因此/ ,/ 决策树/ 归纳/ 算法/ 设计/ 主要/ 考虑/ 如何/ 分裂/ 训练/ 集/ ,/ 以及/ 如何/ 停止/ 分裂/ 过程/ ./ 因为/ 决策树/ 生成/ 过程/ 中/ 的/ 每/ 一步/ 都/ 需要/ 选择/ 一个/ 属性/ 判断/ 条件/ ,/ 从而/ 将/ 训练/ 集/ 分裂/ 为/ 较/ 小子/ 集/ ./ 算法/ 必须/ 提供/ 对/ 不同/ 类型/ 属性/ 的/ 判断/ 方法/ ,/ 并/ 提供/ 每种/ 判断/ 条件/ 的/ 度量/ 方式/ ./ 而/ 整个/ 决策树/ 过程/ 必须/ 有/ 结束/ 条件/ ,/ 保证/ 递归/ 构造/ 过程/ 的/ 收敛性/ ./ 获取/ 最佳/ 分裂/ 的/ 策略/ 往往/ 根据/ 划分/ 后/ 子女/ 节点/ 不纯性/ 的/ 程度/ 而/ 来/ ,/ 不纯/ 的/ 程度/ 越低/ ,/ 类/ 分布/ 就/ 越/ 倾斜/ ,/ 也/ 越/ 方便/ 进行/ 划分/ ./ 常用/ 不纯性/ 度量/ 方法/ 包括/ 信息熵/ (/ entropy/ )/ 、/ 基尼系数/ (/ ginicoefficience/ )/ 以及/ 分类/ 错误/ (/ classificationerror/ )/ ./ 经典/ 的/ 决策树/ 算法/ 为/ Hunt/ 算法/ ,/ 给定/ 与/ 节点/ n/ 相关/ 的/ 训练/ 数据/ 集合/ Rn/ ,/ 其/ 决策树/ 生成/ 过程/ 递归/ 步骤/ 如下/ :/ 1/ ./ 如果/ Rn/ 中/ 的/ 任一/ 元素/ e/ 同属/ 一类/ ,/ 则/ 创建/ 一个/ 叶子/ 节点/ n/ 并/ 终止/ 递归/ ;/ 2/ ./ 否则/ 节点/ n/ 为/ 属性/ 条件/ 判断/ 阶段/ 节点/ ,/ 依据/ 分裂/ 启发式/ 选择/ 一个/ 属性/ 作为/ 分裂/ 标准/ ,/ 并/ 创建/ 属性/ 分裂/ 判断/ 条件/ ./ 基于/ 此/ 分类/ 条件/ ,/ 将/ Rn/ 划分/ 为/ 互不/ 相交/ 的/ m/ 个/ 集合/ {/ Rn/ ,/ 1/ ,/ Rn/ ,/ 2/ ,/ …/ ,/ Rn/ ,/ m/ }/ ;/ 离散/ 变量/ ;/ 3/ ./ 对于/ Rn/ ,/ i/ (/ i/ ∈/ m/ )/ 递归/ 执行/ 步/ 1/ ,/ 2/ ./ ID3/ 算法/ 通过/ 随机/ 选择/ Rn/ 的/ 一个/ 子集/ W/ ,/ 使用/ Hint/ 生成/ 分类/ 树/ Ttemp/ ,/ 通过/ 顺序/ 扫描/ Rn/ 收集/ Ttemp/ 中/ 无法/ 确定/ 的/ 训练样本/ 集合/ Exp/ ,/ 然后/ W/ 与/ Exp/ 合并/ 形成/ 新/ W/ 重新/ 验证/ ,/ 直到/ 不再/ 出现异常/ 训练样本/ ./ 为了/ 保证/ 生成/ 的/ 决策树/ 最小/ ,/ ID3/ 算法/ 使用/ 的/ 分裂/ 策略/ 选取/ 使/ 生成/ 字数/ 的/ 熵/ 最小/ 的/ 特征/ 进行/ 分裂/ ./ ID3/ 算法/ 虽然/ 对/ 生成/ 树/ 的/ 规模/ 进行/ 了/ 有效/ 的/ 控制/ ,/ 但是/ 在/ 实际/ 使用/ 时/ 却/ 有/ 很多/ 局限/ :/ (/ 1/ )/ ID3/ 算法/ 要求/ 目标/ 数据/ 的/ 所有/ 属性/ 必须/ 为/ (/ 2/ )/ 训练/ 集/ 数据/ 中/ 的/ 所有/ 属性/ 信息/ 必须/ 都/ 被/ (/ 3/ )/ 每个/ 训练样本/ 必须/ 进行/ 确定/ 标识/ ./ 为了/ 解决/ ID3/ 算法/ 在/ 实际/ 应用/ 中/ 存在/ 的/ 上述/ 问题/ ,/ Quilan/ 提出/ 了/ C4/ ./ 5/ 算法/ ./ C4/ ./ 5/ 算法/ 继承/ 了/ ID3/ 算法/ 的/ 优点/ ,/ 并/ 在/ 以下/ 几/ 方面/ 对/ ID3/ 算法/ 进行/ 了/ 改进/ :/ (/ 1/ )/ 对/ 熵/ 的/ 计算/ 加上/ 了/ 子树/ 信息/ ,/ 用/ 信息/ 增益/ 率来/ 选择/ 属性/ ,/ 克服/ 了/ 选择/ 属性/ 时/ 偏向/ 选择/ 取值/ 多/ 的/ 属性/ 的/ 不足/ ;/ 赋值/ ;/ 过程/ 中/ 进行/ 剪枝/ ;/ (/ 2/ )/ 聚类/ 和/ 剪枝/ 两个/ 步骤/ 合二为一/ ,/ 在/ 树/ 构造/ (/ 3/ )/ 能够/ 完成/ 对/ 连续/ 属性/ 的/ 离散/ 化/ 处理/ ;/ (/ 4/ )/ 能够/ 对/ 不/ 完整/ 数据/ 进行/ 处理/ ,/ 训练/ 集中/ 的/ 记录/ 不/ 需要/ 所有/ 属性/ 值/ 都/ 被/ 赋值/ ,/ 但是/ 类型/ 标识/ 必须/ 确定/ ;/ (/ 5/ )/ C4/ ./ 5/ 算法/ 的/ 优点/ 比较/ 明显/ :/ 产生/ 的/ 分类/ 规则/ 易于/ 理解/ ,/ 准确率/ 较/ 高/ ./ 其/ 缺点/ 是/ :/ 在/ 构造/ 树/ 的/ 过程/ 中/ ,/ 需要/ 对/ 数据/ 集/ 进行/ 多次/ 的/ 顺序/ 扫描/ 和/ 排序/ ,/ 因而/ 导致/ 算法/ 低效/ ./ 此外/ ,/ C4/ ./ 5/ 只/ 适合/ 于/ 能够/ 驻留/ 于/ Page7/ 内存/ 的/ 数据/ 集/ ,/ 当/ 训练/ 集太大/ 无法/ 在/ 内存/ 容纳/ 时/ 程序/ 将/ 无法/ 运行/ ./ 3.2/ 基于/ C4/ ./ 5/ 决策树/ 模型/ 的/ 主/ 特征/ 建模/ 方法/ 为了/ 提取/ 主/ 故障/ 特征/ ,/ 我们/ 使用/ 主/ 特征/ 时间/ 窗口/ 内/ 出现/ 的/ 日志/ 类型/ 特征向量/ 作为/ 基本/ 分析/ 单元/ ./ 故障/ f/ 第/ i/ 轮/ 测试/ 第/ j/ 个/ 检测/ 窗口/ 内/ 的/ 日志/ 类型/ 特征向量/ 犈/ i/ ,/ j/ =/ 〈/ e1/ ,/ e2/ ,/ …/ ,/ em/ 〉/ ,/ 其中/ et/ ∈/ {/ 1/ ,/ 0/ }/ ,/ 则/ 主/ 故障/ 特征/ 日志/ 类型/ 特征向量/ 为/ j/ =/ 1/ 时/ 的/ 日志/ 类型/ 特征向量/ ,/ 即/ Ei/ ,/ 1/ ./ 通过/ 将主/ 特征/ 检测时间/ 窗口/ 内/ 的/ 所有/ 日志/ 信息/ 抽象/ 为/ 1/ 条/ 记录/ (/ 日志/ 类型/ 特征向量/ )/ ,/ 可以/ 有效/ 降低/ 问题/ 分析/ 的/ 维度/ ./ 通过/ 对/ 所有/ 故障注入/ 测试/ 时/ 收集/ 到/ 日志/ 数据/ 的/ 主/ 特征/ 项/ 进行/ 人为/ 标识/ ,/ 我们/ 可以/ 得到/ 基于/ 日志/ 类型/ 特征向量/ 的/ 主/ 特征/ 训练/ 集/ ./ 假设/ 系统/ 内/ 总共/ 存在/ m/ 类/ 日志/ ,/ 则/ 代表/ 一个/ 主/ 故障/ 特征/ 有/ m/ 维/ 属性/ ,/ 每/ 一个/ 维度/ 属性/ 的/ 取值/ 都/ 为/ 离散/ 值/ ,/ 即/ {/ 0/ ,/ 1/ }/ 或者/ {/ NO/ ,/ YES/ }/ ,/ 代表/ 该/ 类型/ 日志/ 的/ 出现/ 与/ 故障/ 发生/ 的/ 关联性/ ./ 我们/ 选用/ 了/ C4/ ./ 5/ 决策树/ 的/ 著名/ 实现/ Weka/ 的/ J48/ 决策树/ 模块/ 作为/ 我们/ 提取/ 主/ 故障/ 特征/ 的/ 工具/ ./ Weka/ [/ 11/ ]/ 的/ 全名是/ 怀卡托/ 智能/ 分析/ 环境/ (/ WaikatoEnvironmentforKnowledgeAnalysis/ )/ ,/ 由/ 新西兰/ 怀卡托/ 大学/ 的/ 研究/ 小组/ 基于/ Java/ 环境/ 编写/ 的/ 开源/ 机器/ 学习/ 及/ 数据挖掘/ 工具/ ./ 虽然/ 工具/ 本身/ 受限于/ Java/ 实现/ ,/ 其/ 计算/ 效率/ 受到/ 一定/ 制约/ ,/ 但是/ 由于/ 其/ 功能/ 全面/ ,/ 使用方便/ ,/ 最/ 重要/ 的/ 是/ 完全/ 开源/ ,/ 所以/ 一经/ 发布/ 即/ 广泛/ 受到/ 学术界/ 的/ 热/ 捧/ ,/ 近年来/ 大量/ 与/ 数据挖掘/ 相关/ 的/ 研究/ 工作/ 均/ 选用/ Weka/ 作为/ 基本平台/ ./ 在/ Weka/ 中/ 使用/ C4/ ./ 5/ 的/ 相关/ 配置/ 参数/ 如表/ 2/ 所示/ ./ 图/ 4/ 故障/ 主/ 特征/ 决策树/ 示例/ binarySplits/ 是否/ 使用/ 二叉/ 方法/ 分裂/ 名词/ 性/ 属性/ FalseconfidenceFactor/ 用于/ 剪枝/ 的/ 置信/ 因子/ (/ 小于/ 该值/ minNumObj/ 每个/ 叶/ 节点/ 所/ 支持/ 的/ 最小/ 实例/ 数/ numFoldsreducedErrorPruning/ 是否/ 使用/ ”/ 减少/ -/ 误差/ ”/ 方式/ 剪枝/ ,/ seedunpruned/ 是否/ 需要/ 对/ 结果/ 树/ 进行/ 剪枝/ False/ 由于/ 我们/ 使用/ C4/ ./ 5/ 的/ 剪枝/ 算法/ ,/ 所以/ numFolds/ 、/ reducedErrorPruning/ 、/ seed/ 均/ 不/ 需要/ 设置/ ,/ 原始数据/ 所有/ 属性/ 已经/ 为/ 2/ 维/ ,/ 所以/ 不再/ 需要/ 进行/ 2/ 进制/ 转换/ ,/ 因此/ binarySplits/ 也/ 不/ 需要/ 设置/ ./ C4/ ./ 5/ 算法/ 会/ 在/ 运行/ 过程/ 中/ 自动/ 剪枝/ ,/ 所以/ unpruned/ 的/ 设置/ 实际上/ 不会/ 起/ 作用/ ./ 因此/ ,/ 比较/ 重要/ 的/ 参数/ 为/ confidenceFactor/ 及/ minNumObj/ ,/ 其/ 具体/ 含义/ 见表/ 2/ 所示/ ./ 由于/ 我们/ 最终/ 的/ 研究/ 目标/ 为/ 对/ 故障/ 特征/ 的/ 状态/ 进行/ 跟踪/ ,/ 所以/ 在/ 本节/ 中/ 没有/ 仔细/ 讨论/ 不同/ 参数设置/ 对主/ 特征/ 模型/ 精确/ 率/ 的/ 影响/ ,/ 在/ 整个/ 实验/ 过程/ 中/ ,/ 均/ 使用/ Weka/ 的/ 默认/ 推荐/ 参数/ ,/ 并/ 由/ 实验/ 验证/ 其/ 有效性/ ./ 图/ 4/ 为主/ 故障/ 特征/ 决策树/ 在/ 10/ 次/ 测试数据/ 中/ 所得/ 结果/ 示例/ (/ Tw/ =/ 6s/ )/ ,/ 其中/ 为了/ 方便/ 阅读/ ,/ 我们/ 将/ 日志/ 属性/ 取值/ {/ 0/ ,/ 1/ }/ 映射/ 为/ {/ NO/ ,/ YES/ }/ ,/ 代表/ 该/ 日志/ 是否/ 出现/ ./ 实验/ 过程/ 中/ 总共/ 出现/ 的/ 日志/ 类型/ 为/ 164/ 类/ ,/ 最后/ 提取/ 为主/ 故障/ 特征/ 模型/ 的/ 日志/ 类型/ 只有/ 19/ 类/ ./ 这/ 也/ 从/ 另/ 一个/ 角度/ 说明/ ,/ 在/ 主/ 故障/ 特征/ 窗口/ 之外/ 的确/ 还有/ 很多/ 故障/ 特征/ 待/ 挖掘/ ,/ 而且/ Page8/ 使用/ 主/ 故障/ 特征/ 很难/ 直接/ 识别/ 主/ 故障/ 特征/ 窗口/ 之外/ 的/ 日志/ 特征/ ./ 4/ 基于/ 伴随/ 特征/ 追踪/ 的/ 故障/ 定位/ 方法/ 为了/ 识别/ 整个/ 故障/ 传播/ 过程/ 中/ 所/ 出现/ 的/ 所有/ 特征/ ,/ 在/ 上/ 一节/ 我们/ 详细/ 介绍/ 了/ 主要/ 特征/ 日志/ ,/ 即/ [/ ts/ ,/ ts/ +/ Tw/ ]/ 中/ 出现/ 的/ 日志/ 中/ 如何/ 提取/ 故障/ 特征/ 的/ 方法/ ./ 本节/ 将/ 介绍/ 如何/ 从/ 伴随/ 特征/ 日志/ ,/ 即/ (/ ts/ +/ Tw/ ,/ te/ ]/ 内/ 出现/ 的/ 日志/ 提取/ 故障/ 特征/ 的/ 方法/ ./ 4.1/ 伴随/ 状态/ 追踪/ 器/ 总体/ 框架/ 在/ 模型/ 训练/ 阶段/ ,/ 经过/ 预处理/ 之后/ 的/ 事件/ 日志/ 按照/ 检测时间/ 窗口/ Tw/ 分成/ 两/ 部分/ :/ 第/ 1/ 部分/ [/ ts/ ,/ ts/ +/ Tw/ ]/ 被/ 用来/ 构造/ 主要/ 特征/ ;/ 第/ 2/ 部分/ [/ ts/ +/ Tw/ ,/ te/ ]/ 被/ 用来/ 构造/ 伴随/ 状态/ 特征/ ,/ 如图/ 5/ 所示/ ,/ 主要/ 包含/ 3/ 个/ 过程/ :/ 态/ 识别器/ ;/ 1/ ./ 图/ 5/ 中/ 第/ 1/ ~/ 3/ 步/ :/ 提取/ 伴随/ 状态/ 集合/ 并/ 构造/ 伴随/ 状/ (/ a/ )/ 在/ 第/ i/ 轮/ 测试/ 中/ ,/ 从/ 伴随/ 日志/ 窗口/ (/ ts/ +/ Tw/ ,/ te/ ]/ 中以/ Tw/ 为/ 采样/ 间隔/ 提取/ 日志/ 类型/ 项/ ,/ 并/ 形成/ 日志/ 类型/ 项/ 序列/ Sf/ ,/ i/ ,/ 然后/ 将/ 所有/ Sf/ ,/ i/ 的/ 项/ 聚集/ 在/ 一起/ ,/ 形成/ 故障/ f/ 的/ 日志/ 项/ 序列/ 集合/ SSf/ =/ Sf/ ,/ 1/ +/ Sf/ ,/ 2/ +/ …/ +/ Sf/ ,/ m/ ./ (/ b/ )/ 为/ 每/ 一类/ 故障/ f/ ,/ 基于/ 最小/ 支持/ 度/ 阈值/ min/ _/ support/ =/ thS/ ×/ N/ (/ 其中/ thS/ ∈/ [/ 0/ ,/ 1/ ]/ ,/ N/ 为/ 总/ 测试/ 轮数/ )/ ,/ 提取/ 候选/ 伴随/ 状态/ 集合/ ,/ 并/ 为/ 每个/ 伴随/ 状态/ 赋予/ 唯一/ 标识/ ./ (/ c/ )/ 基于/ C4/ ./ 5/ 决策树/ 构造/ 一个/ 伴随/ 状态/ 识别器/ Stf/ ,/ 用于/ 识别/ 当前/ 所/ 观察/ 到/ 的/ 日志/ 处于/ 故障/ f/ 特征/ 的/ 什么/ 伴随/ 状态/ 下/ ./ 2/ ./ 图/ 5/ 中/ 第/ 4/ ~/ 6/ 步/ :/ 基于/ 伴随/ 状态/ 序列/ 构造/ 伴随/ 状态/ (/ a/ )/ 重新/ 将/ Sf/ ,/ i/ 中/ 的/ 每/ 一个/ 日志/ 类型/ 特征向量/ 犲/ m/ 映射/ 为/ Stf/ 中/ 的/ 一个/ 状态/ ,/ 从而/ 获得/ 了/ 一个/ Sf/ ,/ i/ 的/ 状态/ 序列/ Tf/ ,/ i/ ./ (/ b/ )/ 基于/ 所有/ 收集/ 到/ 的/ 状态/ 序列/ 集合/ {/ Tf/ ,/ 1/ ,/ Tf/ ,/ 2/ ,/ …/ ,/ Tf/ ,/ N/ }/ 构造/ 一个/ 有限/ 状态/ 自动机/ FSMf/ 作为/ 故障/ f/ 的/ 伴随/ 状态/ 验证/ 器/ ./ 验证/ 器/ ;/ 3/ ./ 图/ 5/ 中/ 第/ 7/ ~/ 9/ 步/ :/ 运行/ 时/ 伴随/ 状态/ 追踪/ ;/ (/ a/ )/ 在/ 运行/ 时刻/ ,/ 将/ 当前/ 时间/ 窗口/ Tw/ 内/ 收集/ 到/ 的/ 日志/ 项/ 序列/ 使用/ Stf/ 进行/ 分类/ ,/ 获得/ 相应/ 的/ 伴随/ 状态/ 标识/ Ci/ ./ 态/ 是否/ 仍然/ 符合/ 故障/ f/ 的/ 伴随/ 特征/ ./ (/ b/ )/ 将/ 伴随/ 状态/ 标识/ Ci/ 输入/ FSMf/ 以/ 检验/ 当前/ 伴随/ 状/ 从/ 以上/ 步骤/ 可以/ 看出/ ,/ 伴随/ 状态/ 追踪/ 器/ 的/ 主要/ 挑战/ 在于/ 如何/ 提取/ 伴随/ 状态/ 集合/ 以及/ 构造/ 伴随/ 状态/ 转换/ 模型/ ./ 以下/ 将/ 着重/ 阐述/ 这/ 2/ 个/ 问题/ 的/ 解决/ 方法/ ./ 4.2/ 基于/ prefixSpan/ 的/ 伴随/ 状态/ 集合/ 提取/ 为了/ 寻找/ 针对/ 特定/ 故障/ f/ 相应/ 的/ 特征向量/ 全集/ ,/ 一种/ 比较/ 直接/ 的/ 方式/ 为/ 使用/ 频繁/ 项/ 挖掘/ 方法/ 找到/ 故障/ f/ 传播/ 影响/ 过程/ 中/ 出现/ 的/ 频繁/ 日志/ 类型/ 特征向量/ 组合/ ,/ 将/ 其/ 确定/ 为/ 候选/ 伴随/ 状态/ 集合/ ./ 的/ 数量/ 会/ 呈/ 指数/ 增长/ ;/ 加后/ 都/ 需要/ 重新/ 扫描/ 全/ 数据库/ ;/ 于/ 频繁/ 模式/ 挖掘/ ,/ 但是/ 在/ 使用/ 中/ 存在/ 一些/ 缺陷/ :/ (/ 1/ )/ prefixSpan/ 算法/ Apriori/ 作为/ 模式/ 挖掘/ 的/ 经典/ 算法/ 被/ 广泛/ 使用/ ①/ 容易/ 产生/ 大量/ 的/ 候选/ 模式/ ;/ ②/ 需要/ 多次/ 扫描/ 数据库/ ,/ 候选/ 模式/ 长度/ 每次/ 增/ ③/ 不易/ 发现/ 长/ 模式/ ,/ 因为/ 长度/ 增加/ ,/ 候选/ 序列/ ④/ 计算/ 中间/ 过程/ 会/ 产生/ 很大/ 的/ 数据/ 开销/ ./ 相比之下/ ,/ prefixSpan/ [/ 12/ ]/ 算法/ 采用/ 分而治之/ 的/ 思想/ ,/ 先/ 将/ 数据/ 集/ 分割/ 为/ 互不/ 相交/ 的/ 数据/ 子集/ ,/ 然后/ 再/ 在/ 数据/ 子集/ 上/ 进行/ 序列/ 挖掘/ ,/ 只/ 检测/ 前缀/ 序列/ 并/ 构造/ 后缀/ 序列/ 的/ 投影/ 数据库/ ./ 而/ 在/ 每个/ 投影/ 数据库/ 中/ ,/ 也/ 只/ 检测/ 局部/ 频繁/ 模式/ ,/ 避免/ 了/ 生成/ 候选/ 序列/ 的/ 开销/ ./ 具体/ 算法/ 描述/ 如下/ ./ 算法/ ./ prefixSpan/ (/ a/ ,/ l/ ,/ D/ |/ a/ )/ [/ 12/ ]/ ./ 输入/ :/ 数据/ 集/ D/ ,/ 最小/ 支持/ 度/ 阈值/ min/ _/ support/ ,/ a/ 为长/ 输出/ :/ D/ 中/ 的/ 所有/ 频繁/ 序列/ 模式/ 1/ ./ 扫描/ D/ |/ a/ 一次/ ,/ 找出/ 一个/ 频繁/ 项/ b/ ,/ 使得/ b/ 可以/ 添加/ 到/ a/ 的/ 最后/ 一个/ 元素/ 中/ ,/ 或者/ 〈/ b/ 〉/ 可以/ 附加/ 到/ a/ 的/ 最后/ 一个/ 元素/ 之后/ ;/ 2/ ./ 由/ b/ 形成/ 长度/ 为/ l/ +/ 1/ 的/ 序列/ 模式/ a/ ;/ 3/ ./ 构造/ a/ 的/ 投影/ 数据库/ D/ |/ a/ ;/ 4/ ./ 递归/ 调用/ prefixSpan/ (/ a/ ,/ l/ +/ 1/ ,/ D/ |/ a/ )/ ./ 需要/ 指出/ 的/ 是/ ,/ prefixSpan/ 算法/ 本身/ 适用/ 于/ 序列/ 挖掘/ 的/ 场景/ ,/ 本节/ 将/ 其/ 应用/ 于/ 频繁/ 项/ 挖掘/ 场景/ ,/ 需要/ 对/ 输入/ 日志/ 类型/ 特征向量/ 做/ 如下/ 修改/ ./ 定义/ 4/ (/ 日志/ 类型/ 项/ )/ ./ Pi/ ,/ j/ =/ 〈/ t1/ ,/ t2/ ,/ …/ ,/ tk/ 〉/ 为/ 故障/ f/ 第/ i/ 轮/ 测试/ 第/ j/ 个/ 检测/ 窗口/ 内/ 的/ 日志/ 类型/ 特征向量/ ,/ 其中/ k/ 代表/ 第/ j/ 个/ 检测/ 窗口/ 内/ 出现/ 的/ 日志/ 类型/ 总/ 数量/ ,/ ti/ ∈/ T/ ,/ 且/ ti/ 按照/ 日志/ 类型/ 标识/ 按/ 升序/ 排序/ ./ 与/ Ei/ ,/ j/ 相比/ ,/ Pi/ ,/ j/ 的/ 长度/ 不再/ 固定/ ,/ 而且/ 其中/ 组/ Page9/ 成/ 元组/ 为/ 日志/ 类型/ 标识/ ,/ 而/ 不再/ 是/ {/ 0/ ,/ 1/ }/ ./ Pi/ ,/ j/ 中/ 的/ 每/ 一个/ 元组/ 相当于/ prefixSpan/ 算法/ 中/ 长度/ 为/ 1/ 的/ 项/ ./ 日志/ 类型/ 项/ Pi/ ,/ j/ 为/ 已经/ 为/ 组成/ 元组/ 进行/ 排序/ 且/ 不会/ 有/ 重复/ 日志/ 类型/ 标识/ 的/ 项/ ,/ 所以/ 也/ 不会/ 由于/ 元组/ 相对/ 顺序/ 问题/ 影响/ 模式/ 挖掘/ 效果/ ./ 基于/ 日志/ 类型/ 项/ ,/ 我们/ 可以/ 进一步/ 构造/ 日志/ 类型/ 项/ 序列/ Sf/ ,/ i/ (/ 如图/ 6/ 所示/ )/ ./ 通过/ 将/ 所有/ Sf/ ,/ i/ 聚集/ 在/ 一起/ 可以/ 形成/ 故障/ f/ 的/ 日志/ 项/ 集合/ SSf/ =/ Sf/ ,/ 1/ +/ Sf/ ,/ 2/ +/ …/ +/ Sf/ ,/ m/ ./ 最终/ prefixSpan/ 算法/ 的/ 输入/ 序列/ 集合/ 为/ SSf/ ./ (/ 2/ )/ 2/ 维/ prefixSpan/ 算法/ 基本/ 的/ 频繁/ 项/ 挖掘/ 过程/ 并/ 不足以/ 构造/ 一个/ 有效/ 的/ 状态/ 集合/ ,/ 因为/ 直接/ 使用/ prefixSpan/ 对/ SSf/ 进行/ 模式/ 提取/ 所/ 得到/ 的/ 结果/ 中/ 存在/ 大量/ 冗余/ 状态/ ./ 与/ 整个/ 故障/ 影响/ 周期时间/ 相比/ ,/ 采样/ 窗口/ Tw/ 可能/ 非常/ 小/ ,/ 某些/ 干扰/ 模式/ 可能/ 仅仅/ 在/ 某/ 几轮/ 测试/ 中以/ 高频率/ 的/ 方式/ 出现/ ,/ 导致/ 非常容易/ 超越/ min/ _/ support/ 阈值/ 并/ 被/ 识别/ 为/ 频繁/ 项/ ,/ 而/ 我们/ 的/ 目标/ 是/ 将/ 那些/ 出现/ 次数/ 较/ 多/ ,/ 而且/ 在/ 很多/ 轮/ 测试/ 中/ 都/ 出现/ 过/ 的/ 模式/ 挖掘/ 出来/ ./ 为了/ 实现/ 这个/ 目标/ ,/ 我们/ 首先/ 扩展/ 了/ 经典/ 的/ 频繁/ 项/ 挖掘/ 算法/ prefixSpan/ ,/ 使/ 其/ 支持/ 2/ 维空间/ 中/ 的/ 频繁/ 项/ 搜索/ ./ 即/ ,/ 只有/ 同时/ 在/ 两个/ 维度/ 上/ 都/ 频繁/ 才/ 是/ 满足要求/ 的/ 候选/ 频繁/ 项/ ./ 首先/ ,/ 将/ 每个/ 日志/ 类型/ 项/ Pi/ ,/ j/ ∈/ Sf/ ,/ i/ 转换/ 为/ 2/ 维项/ Pi/ ,/ j/ _/ ex/ =/ 〈/ Pi/ ,/ j/ ,/ round/ _/ id/ _/ list/ 〉/ ,/ 其中/ round/ _/ id/ _/ list/ 为此/ Pi/ ,/ j/ 出现/ 过/ 的/ 测试/ 轮数/ id/ 列表/ ,/ 每/ 一个/ 日志/ 类型/ 项/ 的/ 初始/ round/ _/ id/ _/ list/ 为/ 其/ 初始/ 出现/ 的/ 测试/ 轮数/ id/ ./ 如/ ,/ 日志/ 类型/ 项/ (/ A/ ,/ B/ ,/ C/ )/ 在/ 故障/ f/ 的/ 注入/ 测试/ 的/ 第/ 1/ ,/ 3/ ,/ 5/ 轮测/ 中/ 出现/ ,/ 则/ (/ A/ ,/ B/ ,/ C/ )/ 的/ 初始/ 2/ 维项/ 为/ 〈/ (/ A/ ,/ B/ ,/ C/ )/ ,/ {/ 1/ }/ 〉/ 〈/ (/ A/ ,/ B/ ,/ C/ )/ ,/ {/ 3/ }/ 〉/ 〈/ (/ A/ ,/ B/ ,/ C/ )/ ,/ {/ 5/ }/ 〉/ ./ 经过/ 频繁/ 项集/ 挖掘/ 过程/ 中/ 得到/ 的/ 中间/ 结果/ 为/ 〈/ (/ A/ ,/ B/ ,/ C/ )/ ,/ {/ 1/ ,/ 3/ ,/ 5/ }/ 〉/ ,/ 假设/ min/ _/ support/ 阈值/ 为/ 2/ ,/ 即/ (/ A/ ,/ B/ ,/ C/ )/ 至少/ 要/ 在/ 2/ 轮/ 测试/ 中/ 出现/ ,/ 而/ |/ {/ 13/ ,/ 5/ }/ |/ =/ 3/ >/ 2/ ,/ 所以/ 此时/ (/ A/ ,/ B/ ,/ C/ )/ 才/ 会/ 被/ 最终/ 识别/ 为/ 频繁/ 项/ ./ 简言之/ 2/ 维/ prefixSpan/ 的/ 具体/ 修改/ 方法/ 为/ ①/ 对于/ 故障/ f/ 的/ 第/ i/ 轮/ 测试/ 所/ 观察/ 到/ 的/ 某/ 一/ 日志/ 类型/ 项/ Pi/ ,/ j/ _/ ex/ 而言/ ,/ 如果/ 其/ 被/ 观察/ 到/ 出现/ ,/ 则/ 对于/ Pi/ ,/ j/ _/ ex/ 的/ 支持/ 度/ (/ support/ )/ 加/ 1/ ,/ 且/ 如果/ i/ 不/ 在/ round/ _/ id/ _/ list/ 列表/ 中/ ,/ 则/ 追加/ i/ ./ ②/ Pi/ ,/ j/ _/ ex/ 只有/ 在/ 其/ 出现/ 次数/ 的/ 支持/ 度/ 和/ round/ _/ id/ _/ list/ 列表/ 长度/ 都/ 大于/ min/ _/ support/ 阈值/ 时才/ 会/ 被/ 加入/ 投影/ 数据库/ ./ (/ 3/ )/ 语义/ 冗余/ 状态/ 过滤/ 仅/ 使用/ 2/ 维/ 频繁/ 项/ 挖掘/ 方法/ 得到/ 的/ 频繁/ 项/ 状态/ 集合/ 并/ 不足以/ 构造/ 一个/ 有效/ 的/ 状态/ 集合/ ,/ 因为/ 其中/ 还/ 包含/ 了/ 过/ 多/ 的/ 语义/ 冗余/ 状态/ 信息/ ./ 由于/ Apriori/ 特性/ 的/ 存在/ ,/ 如果/ 日志/ 类型/ 项/ (/ A/ ,/ B/ ,/ C/ )/ 为/ 频繁/ 项/ ,/ 则/ 其/ 所有/ 的/ 子项/ 都/ 会/ 被/ 识别/ 为/ 频繁/ 项/ 并/ 出现/ 在/ 频繁/ 项集/ 挖掘/ 的/ 结果/ 中/ ./ 如果/ A/ ,/ B/ ,/ C/ 三类/ 日志/ 总是/ 同时/ 出现/ ,/ 则/ (/ A/ ,/ B/ ,/ C/ )/ 所有/ 子项/ 都/ 是/ 冗余/ 的/ :/ 包括/ (/ A/ )/ ,/ (/ B/ )/ ,/ (/ C/ )/ ,/ (/ A/ ,/ B/ )/ ,/ (/ A/ ,/ C/ )/ 和/ (/ B/ ,/ C/ )/ ./ 为了/ 在/ 状态/ 字典/ 中/ 去除/ 冗余/ 项/ ,/ 我们/ 通过/ 分析/ 日志/ 类型/ 之间/ 的/ 关联/ 规则/ [/ 13/ ]/ 来/ 确定/ 状态/ 集合/ 中/ 的/ 语义/ 冗余/ ./ 本文/ 使用/ 了/ 基于/ 置信度/ 的/ 评估/ 方法/ 来/ 评估/ 事件/ 日志/ 之间/ 的/ 因果关系/ ./ 置信度/ (/ 式/ (/ 2/ )/ )/ 评估/ 了/ 两类/ 事件/ 在/ 所有/ 事务/ 中/ 同时/ 出现/ 的/ 概率/ :/ 假设/ SSf/ 中/ 总共/ 有/ n/ 个/ 日志/ 项/ ,/ 其中/ m/ 个/ 日志/ 项中/ 包含/ 事件/ A/ ,/ k/ 个/ 日志/ 项中/ 同时/ 包含/ A/ 和/ B/ ,/ 则/ P/ (/ A/ )/ =/ m/ // n/ ,/ P/ (/ AB/ )/ =/ k/ // n/ ./ 置信度/ 的/ 计算方法/ 如式/ (/ 2/ )/ 所示/ ./ 另/ 一个/ 常用/ 的/ 评估/ 函数/ 支持/ 度/ (/ 式/ (/ 3/ )/ )/ 评估/ 了/ A/ ,/ B/ 同时/ 出现/ 的/ 概率/ 与/ A/ ,/ B/ 相互/ 独立/ 的/ 期望值/ 之间/ 的/ 比例/ ./ 通常/ 置信度/ 和/ 支持/ 度越/ 高/ ,/ 则/ 规则/ A/ →/ B/ 越/ 可能/ 成立/ ./ 在/ 目标/ 场景/ 中/ ,/ 我们/ 仅仅/ 使用/ 置信度/ 度量/ ./ 因为/ 如果/ A/ →/ B/ 的/ 置信度/ 超过/ 特定/ 阈值/ ,/ 则/ 意味着/ 项/ (/ A/ )/ 通常/ 不会/ 独立/ 出现/ ,/ 而是/ 随着/ 项/ (/ B/ )/ 一起/ 出现/ ,/ 所以/ 项/ (/ A/ )/ 会/ 被/ 认为/ 是/ 冗余/ 项/ 被/ 删除/ ./ 即使/ 此时/ (/ A/ ,/ B/ )/ 的/ 支持/ 度/ 很/ 低/ ,/ 即/ 事件/ B/ 的/ 出现/ 数量/ 远高于/ A/ 的/ 数量/ ,/ 同样/ 不会/ 影响/ 我们/ 判断/ (/ A/ )/ 为/ 冗余/ 状态/ 的/ 结果/ ./ 常用/ 场景/ 中/ ,/ 使用/ 支持/ 度/ 的/ 目的/ 为/ 判断/ A/ 与/ B/ 的/ 关联性/ 假设/ 是否/ 成立/ :/ 如/ ,/ 若/ (/ A/ ,/ B/ )/ 的/ 置信度/ 高于/ 某一/ 阈值/ ,/ 则/ 认为/ A/ 与/ B/ 是/ 相互/ 关联/ 的/ ,/ 而/ 如果/ 该/ 假设/ 成立/ ,/ 则/ 可以/ 将/ 事件/ A/ 与/ B/ 在/ 一起/ 过滤/ 或作/ 等同/ 处理/ ./ 由于/ 我们/ 判断/ A/ 与/ B/ 是否/ 需要/ 同时/ 过滤/ 的/ 结论/ 同样/ 可以/ 由/ A/ / B/ 得出/ ,/ 即/ A/ →/ B/ 且/ B/ →/ A/ ./ 所以/ ,/ 本文/ 仅/ 使用/ 置信度/ 这/ 一种/ 关联/ 分析/ 度量/ 方式/ Page10/ 具体/ 而言/ ,/ 本文/ 基于/ 置信度/ 关联/ 规则/ 分析方法/ ,/ 即可/ ./ 采用/ 如下/ 2/ 个/ 启发式/ 对/ 状态/ 进行/ 消减/ :/ ①/ 将/ 所有/ 由/ / 关系/ 所/ 确定/ 的/ 单/ 日志/ 类型/ 项/ 聚集/ 在/ 一起/ ,/ 形成/ ”/ 语义/ 族/ ”/ ,/ 而/ 属于/ ”/ 语义/ 族/ ”/ 中/ 的/ 所有/ 子/ 日志/ 类型/ 项/ 将/ 被/ 识别/ 为/ 冗余/ 状态/ 而/ 被/ 删除/ ./ 例如/ ,/ 如果/ A/ / B/ 且/ B/ / C/ ,/ 则/ (/ A/ ,/ B/ ,/ C/ )/ 为/ 一个/ ”/ 语义/ 族/ ”/ ,/ 则/ 日志/ 类型/ 项/ {/ A/ ,/ B/ ,/ C/ ,/ (/ A/ ,/ B/ )/ ,/ (/ B/ ,/ C/ )/ ,/ (/ A/ ,/ C/ )/ }/ 将/ 被/ 认为/ 是/ 冗余/ 状态/ 项/ 而/ 被/ 删除/ ./ ②/ (/ A/ ,/ (/ B/ ,/ C/ )/ )/ 为/ ”/ 半/ 语义/ 族/ ”/ A/ →/ (/ B/ ,/ C/ )/ ,/ 当且/ 仅/ 当/ 如下/ 2/ 个/ 条件/ 之一/ 成立/ :/ (/ a/ )/ 如果/ A/ →/ B/ 且/ B/ →/ C/ ./ (/ b/ )/ 如果/ A/ →/ B/ 且/ A/ →/ C/ ,/ 则/ 半/ 语义/ 族/ 中/ 所有/ 为/ (/ A/ ,/ x/ )/ 模式/ 的/ 项/ 都/ 需要/ 被/ 删除/ (/ x/ 为/ B/ 和/ C/ 的/ 组合/ ,/ 如/ (/ A/ )/ ,/ (/ A/ ,/ B/ )/ ,/ (/ A/ ,/ C/ )/ )/ ./ 如果/ 符合/ 以上/ 两个/ 启发式/ 中/ 的/ 任意/ 一个/ ,/ 则/ 最终/ 只有/ 项/ (/ A/ ,/ B/ ,/ C/ )/ 留在/ 伴随/ 状态/ 集合/ 中/ ,/ 符合/ ”/ 语义/ 族/ ”/ 及/ ”/ 半/ 语义/ 族/ ”/ 的/ 所有/ 项/ 将/ 被/ 删除/ ./ 有/ 了/ 伴随/ 状态/ 集合/ ,/ 将/ 每个/ 伴随/ 状态/ 标识/ 为/ 独立/ 一类/ ,/ 基于/ C4/ ./ 5/ 分类器/ 我们/ 可以/ 得到/ 伴随/ 状态/ 识别器/ Stf/ ,/ 通过/ 将/ 其/ 应用/ 于/ 原始/ 日志/ 类型/ 项/ 序列/ ,/ 我们/ 最终/ 可以/ 得到/ 一个/ 伴随/ 状态/ 序列/ ./ 如图/ 6/ 所示/ ,/ 图下方/ 的/ 序列/ ./ 〈/ S1/ ,/ S2/ ,/ S2/ ,/ S3/ ,/ S3/ ,/ S2/ ,/ S2/ ,/ S4/ 〉/ 为/ FSwr/ 故障/ 崩溃/ 后/ 最终/ 提取/ 的/ 伴随/ 状态/ 序列/ ./ 基于/ C4/ ./ 5/ 分类器/ 提取/ 随/ 状态/ 识别器/ Stf/ 的/ 构造/ 过程/ 与/ 第/ 3.2/ 节/ 介绍/ 的/ 过程/ 完全相同/ ,/ 这里/ 不再/ 赘述/ ./ 4.3/ 伴随/ 状态/ 验证/ 器/ 为了/ 根据/ 伴随/ 状态/ 变化/ 序列/ 构建/ 模/ 伴随/ 状态/ 变化/ 模型/ ,/ 本文/ 采用/ 概率/ 正则/ 文法/ [/ 14/ ]/ (/ StochasticRegularGrammar/ ,/ SRG/ )/ 为/ 每类/ 故障/ f/ 构建/ 一个/ 概率/ 状态/ 迁移/ 模型/ ./ 概率/ 正则/ 文法/ 为/ 统计/ 自然语言/ 处理/ 领域/ 中/ 的/ 一种/ 常见/ 方法/ ./ SRG/ 基于/ 训练/ 集中/ 不同/ 状态/ 迁移/ 的/ 出现/ 频率/ 为/ 每类/ 状态/ 迁移/ 设定/ 一个/ 概率/ 值/ ,/ 该/ 方法/ 可以/ 被/ 用来/ 提取/ 软件/ 行为/ 模式/ 以及/ 识别/ 函数调用/ 结构图/ 7FSwr/ 崩溃/ 故障/ 伴随/ 状态/ 变化/ 概率/ 自动机/ 示例/ 异常/ ,/ 相关/ 工作/ 如/ Magpie/ [/ 9/ ]/ 、/ Pinpoint/ [/ 8/ ]/ 均/ 使用/ 类似/ 文法/ 从/ 程序/ 调用/ 序列/ 中/ 提取/ 系统/ 行为/ 模型/ ./ 使用/ SRG/ 的/ 优点/ 在于/ 可以/ 提高/ 系统对/ 不同/ 伴随/ 状态/ 序列/ 的/ 容忍/ 程度/ ,/ 提高/ 模型/ 的/ 鲁棒性/ ./ 一个/ 概率/ 正则/ 文法/ 由/ 四元组/ (/ V/ ,/ T/ ,/ P/ ,/ S/ )/ 组成/ ,/ 其中/ V/ 为/ 字符集/ ,/ T/ 为/ 状态/ 集合/ ,/ P/ 为/ 包含/ 概率/ 信息/ 的/ 产生/ 式/ 集合/ ,/ S/ 为/ 特殊/ 的/ 开始/ 标记/ ./ 在/ 本文/ 中/ ,/ 字符集/ 对应/ 于/ 伴随/ 状态/ id/ ,/ 产生/ 式/ 则/ 代表/ 状态/ 之间/ 的/ 转换/ 概率/ 矩阵/ ./ 由于/ 我们/ 需要/ 判断/ 状态/ 转换/ 是否/ 正常/ 的/ 基本/ 假设/ 是/ ”/ 存在/ 即/ 合理/ ”/ ,/ 即/ 只要/ 在/ 状态机/ 中/ 出现/ 转换/ 路径/ 都/ 为/ 正常/ 情况/ ,/ 因此/ 在/ 使用/ 时/ 我们/ 并/ 没有/ 使用/ 概率/ 正则/ 文法/ 产生/ 的/ 状态/ 转换/ 概率/ 信息/ ,/ 仅仅/ 使用/ 其/ 状态/ 转换/ 模型/ ./ 在/ 具体/ 应用/ 过程/ 中/ ,/ 本文/ 使用/ 了/ SRG/ 经典/ 的/ 构造/ 算法/ Algeria/ [/ 14/ ]/ ./ 通过/ 将/ 故障/ f/ 所/ 对应/ 训练/ 集/ 的/ 所有/ 状态/ 序列/ 构造/ 为/ 前缀/ 树/ ,/ Algeria/ 以/ 递归/ 的/ 方式/ 将/ 前缀/ 树中/ 所有/ 可以/ 合并/ 的/ 状态/ 节点/ 进行/ 合并/ ,/ 最后/ 生成/ 最终/ 的/ 产生/ 式/ 集合/ ./ Algeria/ 用于/ 判断/ 两个/ 子/ 状态/ 序列/ 是否/ 能/ 合并/ 的/ 方法/ 如式/ (/ 4/ )/ 所示/ ./ 其中/ n1/ 与/ n2/ 分别/ 代表/ 后缀/ 树中/ 包含/ 给定/ 节点/ Q1/ 和/ Q2/ 的/ 所有/ 序列/ 数量/ ,/ f1/ 与/ f2/ 代表/ 终止/ 于/ Q1/ 和/ Q2/ 的/ 状态字/ 个数/ 或者/ 能/ 从/ Q1/ 和/ Q2/ 状态/ 执行/ 某个/ 迁移/ 的/ 接收/ 字/ 个数/ ./ α/ 为/ [/ 0/ ,/ 1/ ]/ 之间/ 的/ 参数/ ./ 如果/ 式/ (/ 4/ )/ 返回/ 的/ 为/ 真/ ,/ 则/ 代表/ 状态/ 节点/ Q1/ 和/ Q2/ 的/ 差异/ 不/ 大/ ,/ 可以/ 合并/ ,/ 否则/ 不/ 可以/ 合并/ ./ 图/ 7/ 为/ FSwr/ 失效/ 时/ 的/ 一个/ 伴随/ 状态/ 变化/ 序列/ 以及/ 其/ 相应/ 的/ SRG/ 模型/ 示例/ ./ f1n1/ -/ f2n2/ / 15/ 故障/ 持续/ 追踪/ 整体/ 框架/ 由/ 3/ 步/ 组成/ :/ CST/ 整体/ 框架/ 如图/ 8/ 所示/ ,/ 整个/ 特征提取/ 方法/ (/ 1/ )/ 过滤/ [/ ts/ ,/ te/ ]/ 阶段/ 出现/ 的/ 噪声/ 日志/ ./ (/ 2/ )/ 对于/ 主要/ 特征/ 日志/ ,/ 使用/ C4/ ./ 5/ 决策树/ 模型/ Page11/ 图/ 8/ 基于/ 伴随/ 状态/ 追踪/ 的/ 故障/ 持续/ 识别/ 整体/ 框架/ 构造/ 一个/ 基于/ 规则/ 的/ 故障/ 分类器/ ./ 化/ 模式/ ./ (/ 3/ )/ 对于/ 伴随/ 特征/ 日志/ ,/ 基于/ 日志/ 项/ 建模/ 其变/ 与/ 此/ 相应/ ,/ 运行/ 时/ 故障/ 识别/ 过程/ 由/ 两步/ 组成/ :/ (/ 1/ )/ 使用/ 主要/ 特征/ 识别器/ 识别/ 故障/ 的/ 主要/ 特征/ ;/ (/ 2/ )/ 基于/ 伴随/ 状态/ 追踪/ 器/ 跟踪/ 故障/ 状态/ ./ 如果/ 故障/ 特征/ 变化/ 与/ 所学/ 特征/ 不/ 相符/ ,/ 则/ 退出/ ./ 6/ 实验/ 本/ 实验/ 在/ 系统/ 运行/ 时/ 人为/ 注入/ 故障/ (/ 进程/ 崩溃/ )/ ,/ 从而/ 根据/ 之后/ 收集/ 的/ 系统日志/ 信息/ 比较/ 不同/ 方法/ 的/ 故障/ 识别/ 效果/ ./ 目标/ 实验/ 平台/ 为/ 阿里巴巴/ 云/ 计算/ 公司/ 一个/ 用于/ 进行/ 小/ 文件/ 处理/ 的/ 大规模/ 分布式/ 平台/ ,/ 由/ 100/ 台/ 主机/ 节点/ 组成/ ./ 该/ 系统/ 是/ 由/ 多层/ Master/ -/ Worker/ 风格/ 构建/ 的/ 大规模/ 分布式/ 软件系统/ ,/ 包括/ DataEngine/ 服务/ 、/ FileSystem/ 服务/ 、/ Schedule/ 服务/ 、/ Naming/ 服务/ 、/ Monitor/ 服务/ 以及/ CommunicationAgent/ ./ 除了/ CommunicationAgent/ 外/ ,/ 每/ 类/ 服务/ 都/ 由/ 一个/ Master/ 进程/ 实例/ 和/ 多个/ Worker/ 进程/ 实例/ 构建/ 而成/ ,/ 除/ Master/ 进程/ 部署/ 在/ 单独/ 节点/ 之外/ ,/ 其余/ 所有/ 节点/ 都/ 同构/ 地/ 部署/ 所有/ 类型/ 的/ Worker/ 进程/ ./ 为了/ 方便/ 标识/ ,/ 本文/ 使用/ DBwr/ 、/ 表/ 4/ 冗余/ 状态/ 过滤/ 情况/ (/ 犜/ 狑/ =/ 3s/ ,/ 狋/ 犺/ 犛/ =/ 0.8/ )/ 测试用例/ oriFreq2dFreqseGpsemiGpratiosgNumseNumsemiNum100/ ./ 9522DBwr1951941260/ ./ 8813DBmr30/ ./ 9912FSwrFSmr64718331341561310/ ./ 992630.73/ SSwr10/ ./ 86SSmr20NLwrMSmr20/ ./ 520CA/ 得到/ 的/ 状态/ 数量/ ,/ seGp/ 为/ 在/ 2/ 维/ prefixSpan/ 所得/ 表/ 4/ 中/ ,/ oriFreq/ 为/ 使用/ 1/ 维/ prefixSpan/ 之后/ 结果/ 基础/ 上/ ,/ 使用/ ”/ 语义/ 族/ ”/ 启发式/ 删除/ 冗余/ 状态/ 后/ 得到/ 的/ 结果/ ,/ 2dFreq/ 为/ 使用/ 2/ 维/ prefixSpan/ 后/ 所/ DBmr/ 、/ FSwr/ 、/ FSmr/ 、/ SSwr/ 、/ SSmr/ 、/ NLwr/ 、/ MSwr/ 、/ MSmr/ 以及/ CA/ 标识/ 各个/ 服务/ ,/ 其中/ wr/ 为/ worker/ 进程/ 的/ 缩写/ ,/ mr/ 为/ master/ 进程/ 的/ 缩写/ ./ 6.1/ 测试用例/ 实验/ 总共/ 运行/ 了/ 30/ 轮/ fail/ -/ over/ 测试/ ,/ 每轮/ 测试/ 包含/ 10/ 个/ 测试用例/ ,/ 收集/ 了/ 2800973/ 条/ 错误/ 日志/ (/ 级别/ 为/ ERROR/ 与/ FATAL/ )/ ./ 1/ 轮/ 测试/ 包括/ 10/ 个/ 进程/ 崩溃/ 故障/ 测试用例/ ,/ 分别/ 模拟/ 了/ 不同/ 系统/ 服务/ 进程/ 崩溃/ 的/ 场景/ ./ 每个/ fail/ -/ over/ 测试/ 过程/ 中/ 分别/ 选择/ 杀掉/ 1/ 个/ 特定/ 服务/ 进程/ (/ 对于/ Worker/ 进程/ 和/ 通信/ Agent/ 进程/ 则/ 随机/ 选取/ 一个/ )/ ./ 具体/ 测试用例/ 如/ 及其/ 平均/ 持续时间/ 如表/ 3/ 所示/ ./ 其中/ DBmr/ 失效/ 测试/ 有/ 2/ 种/ 测试用例/ ./ DBmr1/ 使用/ 应用层/ 请求/ 来/ 判断/ 服务/ 的/ 状态/ ,/ 而/ DBmr2/ 使用/ 内部/ 请求/ (/ Worker/ 进程/ 向/ Master/ 进程/ 更新/ 元/ 信息/ )/ 来/ 判断/ 服务/ 的/ 状态/ ./ MSwr/ 进程/ 负责/ 收集/ 系统/ 信息/ ,/ 相对/ 独立/ ,/ 所以/ 实验/ 没有/ 测试/ MSwr/ 崩溃/ 情况/ ./ 测试用例/ 名称/ 6.2/ 冗余/ 伴随/ 状态/ 过滤/ 有效性/ (/ 1/ )/ 冗余/ 状态/ 过滤/ 各/ 步骤/ 的/ 效果/ 对比/ 我们/ 首先/ 验证/ 了/ 在/ 构造/ 伴随/ 状态/ 特征/ 识别器/ 时/ 对/ 伴随/ 状态/ 特征提取/ 方法/ 的/ 有效性/ ./ 表/ 4/ 为/ 在/ Tw/ =/ 3s/ 和/ thS/ =/ 0.8/ 的/ 情况/ 下/ 每/ 一步/ 处理/ 动作/ 之后/ 所/ 得到/ 的/ 伴随/ 状态/ 数量/ 对比/ ./ Page12/ 得到/ 状态/ 数量/ ;/ semiGp/ 为/ 在/ seGp/ 基础/ 上/ 使用/ ”/ 半/ 语义/ 族/ ”/ 启发式/ 过滤/ 后/ 得到/ 的/ 结果/ ./ 过滤/ 率/ 使用/ 公式/ ratio/ =/ 1/ -/ semiGp/ 效果/ 越好/ ./ 表/ 4/ 中/ 第/ 2/ 列至/ 第/ 6/ 列/ 分别/ 为/ 这/ 几步/ 状态/ 过滤/ 的/ 结果/ ./ 对于/ 测试用例/ FSmr/ 和/ FSwr/ ,/ 整体/ 过滤/ 比例/ 基本上/ 达到/ 0.99/ ./ 原因/ 在于/ 其/ 故障/ 影响/ 模式/ 相对/ 复杂/ ,/ 包含/ 的/ 日志/ 类型/ 较/ 多/ ,/ 直接/ 导致/ 初始/ 的/ 频繁/ 项集/ (/ oriFreq/ )/ 过于/ 庞大/ ,/ 这/ 也/ 同样/ 意味/ FSmr/ 服务/ 和/ FSwr/ 服务/ 在/ 其/ 实现/ 逻辑/ 以及/ 与/ 各/ 构件之间/ 的/ 依赖/ 关系/ 都/ 比较复杂/ ,/ 一旦/ FSmr/ 和/ FSwr/ 失效/ ,/ 则/ 会/ 给/ 系统/ 带来/ 更大/ 的/ 扰动/ ./ 对于/ NLwr/ 和/ CA/ 而言/ ,/ 虽然/ 其/ 伴随/ 状态/ 集/ 本身/ 很小/ ,/ 且/ 整个/ 冗余/ 状态/ 过滤/ 过程/ 对/ 其/ 作用/ 不/ 大/ ,/ 但是/ 这/ 两类/ 服务/ 进程/ 崩溃/ 产生/ 这种/ 现象/ 的/ 原因/ 却/ 完全/ 不同/ :/ NLwr/ 为/ 相对/ 独立/ 的/ 服务/ ,/ 特别/ 是/ 在/ 各/ 服务/ worker/ 进程/ 具备/ 地址/ 缓存/ 功能/ 的/ 前提/ 下/ ,/ NLwr/ 的/ 失效/ 影响/ 非常/ 有限/ ;/ CA/ 服务/ 由于/ 负责/ 整个/ 主机/ 所有/ 进程/ 的/ 远程/ 过程/ 调用/ (/ remoteprocesscall/ )/ ,/ 一旦/ 失效/ 将/ 影响/ 该/ 机器/ 当前/ 正在/ 处理/ 业务/ 的/ 所有/ 进程/ ./ 由于/ 每台/ 主机/ 上/ 的/ 服务/ 进程/ 不同/ 时刻/ 响应/ 的/ 请求/ 可能/ 不同/ ,/ 因此/ CA/ 的/ 失效/ 影响/ 模型/ 相对而言/ 不确定性/ 较大/ ,/ 导致/ CA/ 的/ 故障/ 特征/ 显著性/ 不/ 明显/ ./ 注意/ ,/ 由于/ 使用/ prefixSpan/ 提取/ 的/ 故障/ 特征/ 为/ 相对/ 稳定/ (/ 频繁/ )/ 的/ 故障/ 特征/ ,/ 因此/ 最终/ CA/ 只能/ 捕捉到/ 2/ 个/ 相对/ 稳定/ 的/ 特征/ ,/ 而/ 并/ 不/ 代表/ CA/ 本身/ 的/ 状态/ 很少/ ./ 此/ 现象/ 同样/ 可以/ 在/ 图/ 1/ 中/ 的/ F/ -/ Measure/ 曲线/ 中/ 得到/ 验证/ ,/ 通过/ 图/ 1/ 中/ 可以/ 看出/ CA/ 的/ F/ -/ Measure/ 值较/ 低/ ./ 表/ 4/ 第/ 7/ 列至/ 第/ 9/ 列/ 分别/ 记录/ 了/ 总/ 日志/ 类型/ 数量/ (/ sgNum/ )/ 、/ 语义/ 族/ 数量/ (/ seNum/ )/ 以及/ 半/ 语义/ 族/ 的/ 数量/ (/ semiNum/ )/ ,/ 从中/ 也/ 可以/ 发现/ ,/ 总/ 日志/ 类型/ 数量/ 越/ 多/ ,/ 则/ 可能/ 包含/ 的/ 冗余/ 伴随/ 状态/ 也/ 就/ 越/ 多/ ./ (/ 2/ )/ 监视/ 窗口/ 大小/ 对/ 冗余/ 状态/ 过滤/ 效果/ 的/ 影响/ 不同/ Tw/ 设置/ 下/ 的/ 冗余/ 状态/ 过滤/ 率/ 的/ 结果/ 如图/ 9/ 所示/ ./ 注意/ ,/ 在/ 训练/ 阶段/ ,/ 对于/ 每个/ 测试用例/ 而言/ ,/ 如果/ Tw/ >/ (/ te/ -/ ts/ )/ ,/ 则/ 设定/ Tw/ =/ te/ -/ ts/ ./ 从图/ 9/ 我们/ 可以/ 看出/ ,/ 冗余/ 状态/ 过滤/ 的/ 有效性/ 在/ 不同/ Tw/ 设置/ 下/ 相对/ 比较稳定/ ./ 虽然/ MSmr/ 和/ SSwr/ 的/ 状态/ 过滤/ 率/ 随着/ Tw/ 的/ 增加/ 而/ 增长/ ,/ 但/ 实际/ 是/ 由于/ 初始/ 频繁/ 项集/ 减少/ 所致/ ,/ 最终/ 的/ 状态/ 集合/ 数量/ 并/ 没有/ 改变/ ./ 图/ 9/ 监视/ 窗口/ 大小/ 对/ 冗余/ 状态/ 过滤/ 效果/ 的/ 影响/ 为了/ 评估/ CST/ 方法/ 对/ 最终/ 故障/ 检测/ 的/ 有效性/ ,/ 6.3/ 故障/ 特征/ 有效性/ 评估/ 我们/ 检测/ 了/ 故障/ f/ 所/ 产生/ 的/ 所有/ te/ -/ ts/ 特征向量/ ,/ 并/ 使用/ 10/ 折/ 交叉/ 验证/ 方法/ 来/ 评估/ 模型/ 对/ 每类/ 故障/ 的/ 精确/ 率/ (/ precision/ )/ 、/ 召回/ 率/ (/ recall/ )/ 及其/ 调和/ 平均值/ F/ -/ Measure/ ./ 此外/ ,/ 使用/ F/ -/ Measure/ 的/ 平均值/ wFmeasure/ 作为/ 衡量/ 故障/ 模型/ 整体/ 效果/ 的/ 评估/ 指标/ ./ (/ 1/ )/ 监视/ 时间/ 窗口/ Tw/ 对/ 故障/ 特征/ 整体/ 有效性/ 评估/ 图/ 10/ 为/ 使用/ 传统/ 故障/ 特征/ 窗口/ 构建/ 的/ 模型/ 有效性/ 评估/ 结果/ ./ 对应/ 本节/ 的/ 场景/ ,/ 即/ 使用/ [/ ts/ ,/ ts/ +/ Tw/ ]/ 中/ 出现/ 的/ 主/ 故障/ 特征/ 识别器/ ,/ 应用/ 于/ 所有/ te/ -/ ts/ 志/ 类型/ 特征向量/ ,/ 判断/ 每个/ 日志/ 类型/ 特征向量/ 是否/ 被/ 识别/ 为/ 故障/ f/ ./ 图/ 11/ 为/ 使用/ 伴随/ 故障/ 特征/ 追踪/ CST/ 方法/ 的/ 有效性/ 评估/ ,/ 目标/ 同样/ 是/ 判断/ te/ -/ ts/ 日志/ 类型/ 特征向量/ 是否/ 都/ 能/ 被/ 识别/ 为/ 故障/ f/ ./ 通过/ 对比/ 图/ 10/ 和/ 图/ 11/ 我们/ 可以/ 看出/ 在/ 设定/ α/ =/ 0.8/ ,/ thS/ =/ 0.8/ 的/ 情况/ 下/ CST/ 方法/ 的/ 整体/ 有效性/ (/ wFmeasure/ 值/ )/ 比/ 固定/ 故障/ 特征/ 窗口/ 方法/ 平均/ 提高/ 了/ 50.3/ %/ ./ 当/ Tw/ 增大/ 时/ ,/ 总/ 的/ 日志/ 类型/ 特征/ 图/ 10/ 传统/ 固定/ 故障/ 特征/ 窗口/ 方法/ 在/ 不同/ 值时/ 的/ 有效性/ Page13/ 图/ 11CST/ 方法/ 在/ 不同/ 监视/ 窗口/ 的/ wFmeasure/ 向量/ 数目/ ts/ -/ te/ 数目/ 也/ 会/ 减少/ ,/ 根据/ 实验/ 数据/ 发现/ 这种/ 改变/ 对/ 不同/ 类型/ 的/ 故障/ 带来/ 的/ 影响/ 并不相同/ :/ ①/ 一方面/ ,/ 随着/ 日志/ 类型/ 特征向量/ 数目/ 减少/ ,/ 1/ 次/ 故障/ 识别/ 错误/ 对模型/ 效果/ 评定/ (/ F/ -/ Measure/ )/ 的/ 影响/ 会/ 随之/ 增加/ ,/ 从而/ 会/ 降低/ 模型/ 精度/ ./ 如图/ 11/ 中/ 在/ Tw/ =/ 50/ 时/ DBwr/ 的/ F/ -/ Measure/ 值/ 非常/ 之低/ ./ ②/ 另一方面/ ,/ 随着/ 总/ 日志/ 类型/ 特征向量/ 数目/ 的/ 减少/ ,/ 它/ 也/ 会/ 降低/ 故障/ 识别/ 出错/ 的/ 概率/ ,/ 从而/ 提高/ 模型/ 精度/ ./ 如图/ 11/ 中/ MSmr/ 在/ Tw/ =/ 50/ 时/ 所示/ ./ 特别/ 是/ 当/ Tw/ >/ (/ te/ -/ ts/ )/ 时/ (/ 如/ Tw/ =/ 100/ 及/ Tw/ =/ 200/ )/ ,/ 由于/ 此时/ 对于/ 大多数/ 故障/ 类型/ 只有/ 1/ 个/ 日志/ 类型/ 特征向量/ ,/ 正好/ 用于/ 主/ 特征/ 识别/ 过程/ 而/ 不再/ 需要/ 对/ 故障/ 的/ 伴随/ 状态/ 进行/ 追踪/ ,/ 因此/ 在/ 这种/ 情况/ 下/ 可以/ 观察/ 到/ 图/ 10/ 和/ 图/ 11/ 在/ 对应/ Tw/ 的/ 所/ 计算/ 出/ 的/ F/ -/ Measure/ 值/ 相等/ ./ (/ 2/ )/ 频繁/ 度/ 因子/ 对/ 故障/ 特征/ 有效性/ 的/ 影响/ 此外/ ,/ 我们/ 还/ 评估/ 了/ CST/ 方法/ 在/ 不同/ 频繁/ 度/ 因子/ (/ thS/ )/ 下/ 的/ 模型/ 有效性/ ,/ 仍然/ 使用/ wFmeasure/ 作为/ 评估/ 方式/ ./ 如图/ 12/ 所示/ ,/ 我们/ 总共/ 评估/ 了/ 4/ 组/ 不同/ thS/ 值/ 在/ 不同/ 时间/ 窗口/ 时/ 的/ wFmeasure/ 值/ ./ 通过/ 对比/ 图/ 11/ 可以/ 看出/ ,/ thS/ 对/ 故障/ 模型/ 有效性/ 的/ 整体/ 影响/ 低于/ Tw/ 的/ 影响/ ,/ 但是/ 仍然/ 存在/ 一定/ 波动/ ./ 通过/ 对/ 系统故障/ 模型/ 的/ 深入分析/ ,/ 我们/ 发现/ thS/ 对/ 不同/ 故障/ 的/ 影响/ 仍然/ 与/ 故障/ 自身/ 的/ 特点/ 相关/ :/ ①/ 对于/ 故障/ 特征/ 相对/ 稳定/ 的/ 服务/ ,/ 如/ DBmr/ 、/ FSmr/ 以及/ FSwr/ ,/ 当/ thS/ 增加/ 时/ 对/ 其/ 最终/ 的/ 伴随/ 状态/ 集合/ 影响/ 不/ 大/ ;/ ②/ 对于/ DBwr/ 和/ SSmr/ ,/ 当/ thS/ 增长/ 时其/ 伴随/ 状态/ 集合/ 规模/ 会/ 变小/ ,/ 但是/ 由于/ 其/ 特征/ 的/ 显著性/ 不高/ ,/ 较/ 容易/ 受到/ 噪声/ 日志/ 的/ 影响/ ,/ 所以/ 导致/ 其/ 故障/ 特征/ 有效性/ 会/ 随/ thS/ 增长/ 而/ 降低/ ./ ③/ 对于/ CA/ ,/ 由于/ 本身/ 特征/ 不够/ 显著/ ,/ 所以/ 不同/ thS/ 对模型/ 有效性/ 基本/ 没有/ 什么/ 影响/ ,/ 维持/ 在/ 较/ 低水平/ ./ 7/ 相关/ 研究/ 故障/ 检测/ 对于/ 实现/ 云/ 计算/ 系统/ 中/ 的/ 弹性/ 管理/ 十分/ 重要/ [/ 15/ -/ 16/ ]/ ./ 基于/ 对/ 故障/ 模型/ 假设/ 的/ 不同/ ,/ 已有/ 相关/ 工作/ 提取/ 故障/ 特征/ 的/ 方法/ 可以/ 被/ 划分/ 为/ 2/ 类/ ./ (/ 1/ )/ 不/ 需要/ 故障/ 重演/ 的/ 故障/ 建模/ 方法/ ./ 一些/ 相关/ 工作/ 是/ 用/ 统计分析/ 方法/ 来/ 建模/ 分布式系统/ 的/ 正常/ 行为/ 模型/ [/ 3/ ,/ 5/ ,/ 9/ ,/ 17/ ]/ ./ 有/ 的/ 工作/ 假设/ 可以/ 获得/ 系统/ 的/ 源代码/ [/ 3/ ]/ ,/ coredump/ 信息/ [/ 18/ ]/ ,/ 甚至/ 使用/ 软件/ 注入/ 方法/ [/ 5/ ,/ 9/ ]/ 从而/ 挖掘出/ 事件/ 之间/ 函数调用/ 关系/ 以及/ 模块/ 之间/ 的/ 依赖/ 关系/ 模型/ ./ 虽然/ 基于/ 此类/ 方法/ 能够/ 获得/ 较为/ 细粒度/ 的/ 故障/ 检测/ 结果/ ,/ 但是/ 这/ 类/ 细粒度/ 的/ 依赖/ 关系/ 及/ 因果关系/ 模型/ 并非/ 在/ 所有/ 系统/ 中/ 能够/ 获得/ ,/ 且/ 一些/ 注入/ 操作/ 会/ 对系统/ 带来/ 一定/ 的/ 扰动/ ,/ 这/ 在/ 很多/ 情况/ 下/ ,/ 特别/ 是/ 生产/ 系统/ 中是/ 不/ 允许/ 的/ ./ (/ 2/ )/ 需要/ 故障/ 重演/ 的/ 故障/ 建摸/ 方法/ ./ 可重复性/ 故障/ 时/ 在/ 系统/ 中/ 可能/ 会/ 重复/ 发生/ 的/ 故障/ [/ 6/ -/ 7/ ,/ 19/ ]/ ./ 这类/ 故障/ 往往/ 不/ 能够/ 在/ 系统/ 中/ 很快/ 排除/ ,/ 比如/ 进程/ 崩溃/ 、/ 机器/ 崩溃/ 、/ 网络/ 拥塞/ ./ 在/ 运行/ 时刻/ 对/ 此类/ 故障/ 进行/ 检测/ 能够/ 为/ 系统/ 的/ 自/ 管理/ 及/ 容错/ 机制/ 等等/ 提供/ 输入/ 信息/ [/ 15/ -/ 16/ ]/ ./ 相关/ 工作/ [/ 6/ ,/ 19/ ]/ 往往/ 使用/ 检测/ 窗口/ 内/ 的/ 观察/ 到/ 的/ 症状/ 信息/ 来/ 提取/ 故障/ 特征/ 而/ 忽略/ 检测/ 窗口/ 之外/ 的/ 症状/ 信息/ ./ 其/ 带来/ 的/ 直接/ 影响/ 为/ 在/ 运行/ 时/ 故障/ 检测/ 场景/ 下/ 只有/ 早期/ 故障/ 特征/ 能够/ 被/ 正确/ 识别/ ./ 与/ 已有/ 相关/ 工作/ 相比/ ,/ 本文/ 方法/ 有/ 2/ 个/ 特点/ :/ (/ 1/ )/ 我们/ 使用/ 事件/ 类型/ 项/ 建模/ 故障/ 特征/ ,/ 而/ 不是/ 事件/ 粒度/ 的/ 因果/ 分析/ ;/ (/ 2/ )/ 我们/ 提取/ 了/ 整个/ 故障/ 传播/ 周期/ 的/ 特征/ 信息/ ,/ 而/ 不仅仅/ 是/ 检测/ 窗口/ 内/ 的/ 故障/ 特征/ ./ Page148/ 结束语/ 在/ 面向/ 互联网/ 应用/ 的/ 大规模/ 企业级/ 分布式系统/ 中/ 的/ 运行/ 时/ 维护/ 中/ ,/ 故障/ 定位/ 结果/ 作为/ 弹性/ 管理/ 和/ 容错/ 技术/ 的/ 输入/ 扮演着/ 极其重要/ 的/ 角色/ ,/ 但是/ 传统/ 方法/ 在/ 使用/ 过程/ 中/ 存在/ 如下/ 问题/ :/ 一方面/ ,/ 已有/ 相关/ 工作/ 使用/ 固定/ 故障/ 特征/ 窗口/ 内/ 的/ 特征/ 对/ 故障/ 进行/ 建模/ ,/ 但是/ 建模/ 过程/ 中/ 忽略/ 了/ 故障/ 特征/ 窗口/ 外/ 的/ 故障/ 特征/ 信息/ ,/ 导致/ 将/ 模型/ 应用/ 于/ 在线/ 故障/ 定位/ 时仅/ 有/ 早期/ 故障/ 特征/ 能/ 被/ 识别/ ,/ 后期/ 的/ 特征/ 会/ 造成/ 系统/ 误报/ 、/ 漏报/ ,/ 不能/ 实现/ 持续/ 故障/ 定位/ ,/ 会/ 错误引导/ 系统管理/ 人员/ 或/ 相关/ 管理机制/ 对系统/ 的/ 在线/ 运营/ 维护/ ,/ 并/ 最终/ 影响/ 系统/ 的/ 可用性/ ./ 另一方面/ ,/ 基于/ 日志/ 信息/ 对/ 故障/ 特征/ 进行/ 提取/ 受到/ 分布式系统/ 时间/ 不/ 同步/ 问题/ 的/ 困扰/ ./ 由于/ 分布式系统/ 中/ 存在/ 时间/ 同步/ 问题/ ,/ 很难/ 按照/ 严格/ 的/ 时序/ 关系/ 构造/ 日志/ 事件/ 粒度/ 的/ 因果关系/ 模型/ ./ 为了/ 解决/ 上述/ 问题/ ,/ 本文/ 将/ 故障/ 影响/ 周期/ 内/ 出现/ 的/ 日志/ 信息/ 按照/ 时间/ 窗口/ 分割/ 为主/ 故障/ 特征/ 日志/ 和/ 伴随/ 故障/ 特征/ 日志/ ,/ 并且/ 将/ 给定/ 时间/ 窗口/ 之内/ 观察/ 得到/ 的/ 日志/ 类型/ 特征向量/ 以及/ 日志/ 类型/ 项/ 作为/ 故障/ 特征/ 的/ 两种/ 抽象/ ./ 通过/ 分别/ 对主/ 故障/ 特征/ 使用/ 日志/ 类型/ 特征向量/ 进行/ 建模/ ,/ 伴随/ 故障/ 特征/ 使用/ 日志/ 类型/ 项/ 进行/ 建模/ ,/ 我们/ 提出/ 了/ 一种/ 基于/ 伴随/ 状态/ 追踪/ 的/ 持续/ 故障/ 定位/ 框架/ CST/ ./ CST/ 首先/ 根据/ 主/ 故障/ 特征/ 定位/ 故障/ ,/ 随后/ 切换/ 为/ 对/ 该/ 故障/ 状态/ 变化/ 的/ 追踪/ 器以/ 分析/ 当前/ 系统/ 异常/ 行为/ 是否/ 仍然/ 由/ 之前/ 故障/ 所/ 导致/ ./ 通过/ 在/ 阿里巴巴/ 云/ 计算/ 公司/ 的/ 生产/ 系统/ 进行/ 的/ 实验/ 表明/ ,/ CST/ 方法/ 通过/ 使用/ 混合/ 模型/ 建模/ 方法/ ,/ 成功/ 实现/ 了/ 对/ 故障/ 的/ 持续/ 定位/ ,/ 提高/ 了/ 故障/ 模型/ 的/ 有效性/ ./ 

