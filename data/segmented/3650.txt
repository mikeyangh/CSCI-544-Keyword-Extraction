Page1MFT2/ -/ BGP/ :/ 基于/ 多/ 转发/ 树/ 的/ 无/ 中断/ 域间/ 路由/ 协议/ 胡/ 乔林/ 1/ )/ 彭伟/ 2/ )/ 陈新/ 1/ )/ 苏金树/ 2/ )/ 1/ )/ (/ 空军/ 预警/ 学院/ 五系/ 武汉/ 430019/ )/ 2/ )/ (/ 国防科技大学/ 计算机/ 学院/ 长沙/ 410073/ )/ 摘要/ BGP/ 通过/ 触发/ 全局/ 、/ 反应式/ 收敛/ 应对/ 链路/ 或/ 节点/ 失效/ 引起/ 的/ 拓扑/ 变化/ ,/ 然而/ BGP/ 协议/ 收敛/ 时间/ 长/ 、/ 收敛/ 过程/ 中/ 的/ 瞬时/ 失效/ 严重/ 降低/ 了/ 数据/ 平面/ 转发/ 性能/ ,/ 难以/ 支持/ 关键/ 业务/ 流量/ ./ 该文/ 提出/ 了/ 容忍/ 失效/ 的/ MFT2/ -/ BGP/ ,/ 通过/ 利用/ 路径/ 标识符/ 以较/ 低/ 的/ 消息/ 开销/ 构造/ 符合/ BGP/ 策略/ 的/ 多/ 转发/ 树/ ,/ 使得/ 每个/ AS/ 获得/ 多样性/ 路径/ ,/ 当/ 出现/ 瞬时/ 失效/ 时/ ,/ 在/ 不/ 改变/ 协议/ 动态性/ 的/ 情况/ 下/ ,/ 允许/ 节点/ 动态/ 切换/ 报文/ 转发/ 路径/ 以/ 实现/ 无/ 中断/ 报文/ 转发/ ,/ 通过/ 嵌入/ “/ 失效/ 根源/ 信息/ ”/ 以/ 降低/ 收敛/ 时间/ ,/ 抑制/ 瞬时/ 失效/ 以/ 降低/ 路由/ 系统/ 的/ 扰动/ ./ 通过/ 在/ Internet/ -/ like/ 拓扑/ 上/ 的/ 大量/ 实验/ 表明/ ,/ 在/ 链路/ 失效/ 场景/ 中/ 与/ 其它/ 协议/ 相比/ ,/ MFT2/ -/ BGP/ 能/ 有效/ 改善/ 收敛/ 时间/ ,/ 降低/ 转发/ 中断/ 时间/ ,/ 改善/ 路由/ 系统/ 稳定性/ ./ 关键词/ 域间/ 路由/ ;/ 瞬时/ 失效/ ;/ 多/ 转发/ 树/ ;/ 多路径/ ;/ 快速/ 恢复/ 1/ 引言/ Internet/ 已经/ 发展/ 成为/ 重要/ 的/ 通信/ 基础设施/ ,/ 承载/ 了/ 许多/ 如/ VoIP/ 、/ 在线/ 游戏/ 、/ 远程/ 医疗/ 等/ 对/ 延迟/ 及/ 中断/ 敏感/ 的/ 关键/ 业务/ ,/ 然而/ Internet/ 却/ 容易/ 遭到/ 破坏/ ,/ 例如/ 软硬件/ 故障/ 、/ 误/ 配置/ 、/ 攻击/ 等/ 因素/ 都/ 会/ 造成/ 网络/ 失效/ ./ 通过/ 对/ Sprint/ 骨干网/ 链路/ 故障/ 进行/ 分析/ [/ 1/ ]/ ,/ 人们/ 发现/ 失效/ 几乎/ 每天/ 都/ 会/ 发生/ ,/ 且/ 90/ %/ 属于/ 瞬时性/ 故障/ ./ 理想/ 的/ 路由/ 协议/ 应/ 保证/ 只要/ 底层/ 拓扑/ 连接/ 就/ 能/ 提供/ 持续/ 通信/ ./ 然而/ BGP/ 协议/ [/ 2/ ]/ 缺乏/ 生存性/ 保证/ ,/ 在/ 失效/ 时仅/ 触发/ 全局/ 、/ 反应式/ 收敛/ 应对/ 拓扑/ 变化/ ,/ 相对/ 于/ IGP/ 秒级/ 的/ 收敛/ ,/ BGP/ 由于/ 大量/ “/ 路径/ 探索/ ”/ [/ 3/ ]/ 以及/ MRAI/ 和/ WRATE/ 定时器/ 的/ 限制/ ,/ 导致/ 收敛/ 时间/ 甚至/ 达到/ 30/ 分钟/ [/ 4/ ]/ ,/ 这/ 进一步/ 恶化/ 了/ 转发/ 中断/ ./ Katz/ -/ Bassett/ 等/ 人/ [/ 5/ ]/ 发现/ 即使/ 多/ 宿主/ AS/ 并/ 不/ 总能/ 实现/ 容错/ ,/ BGP/ 导致/ 大量/ 多/ 宿主/ AS/ 经历/ 不可/ 达/ 事件/ ,/ 持续时间/ 甚至/ 长达数/ 小时/ 或天/ ,/ 其/ 数量/ 与/ 持续时间/ 都/ 远超/ 预期/ ,/ 严重/ 降低/ 数据/ 平面/ 的/ 转发/ 性能/ ./ Wang/ [/ 6/ ]/ 通过/ 对/ 顶级/ ISP/ 进行/ 测量/ ,/ 发现/ BGP/ 收敛/ 期间/ 的/ 动态性/ 造成/ 大量/ 路由器/ 经历/ 瞬时/ 路由/ 失效/ 、/ 环路/ ,/ 即使/ 在/ 失效/ 切换/ 和/ 链路/ 恢复/ 时/ 路由/ 黑洞/ 也/ 会/ 造成/ 数十秒/ 的/ 报文/ 丢失/ ./ 可达性/ 是/ 路由/ 协议/ 的/ 顶级/ 目标/ ,/ 研究者/ 通过/ 加速/ 收敛/ 以/ 降低/ 失效/ 对/ 转发/ 中断/ 的/ 影响/ ,/ 包括/ GhostFlushing/ [/ 7/ ]/ 、/ EPIC/ [/ 8/ ]/ 等/ 通过/ 抑制/ 或/ 嵌入/ “/ 失效/ 根源/ ”/ 信息/ 以/ 快速/ 作废/ 非法/ 路径/ ,/ 但/ GhostFlushing/ 、/ EPIC/ 在/ Internet/ -/ like/ 拓扑/ 下/ ,/ 其/ 加速/ 收敛/ 效果/ 并/ 不/ 明显/ ./ 而且/ 由于/ 多数/ 是/ 瞬时/ 失效/ ,/ 过快/ 收敛/ 反而/ 给/ 路由器/ 增加/ 负担/ ,/ 带来/ 路由/ 的/ 不稳定性/ ./ 加速/ 收敛/ 并/ 不能/ 满足/ 关键/ 应用/ 需求/ ,/ 也/ 不能/ 消除/ 收敛/ 过程/ 对/ 转发/ 中断/ 的/ 影响/ ./ 一些/ 研究/ 工作/ 集中/ 于/ 扩展/ BGP/ ,/ 比如/ MIRO/ [/ 9/ ]/ 、/ R/ -/ BGP/ [/ 10/ ]/ 、/ Splicing/ [/ 11/ ]/ 、/ Consensus/ [/ 12/ ]/ 、/ YAMR/ [/ 13/ ]/ 等/ 采用/ 预计/ 算/ 备份/ 路径/ 的/ 方法/ ,/ 不同/ 程度/ 上/ 暴露/ 底层/ 拓扑/ 冗余/ 路径/ ,/ 但/ 这些/ 协议/ AS/ 之间/ 的/ 备份/ 路径/ 缺乏/ 协调/ 可能/ 形成/ 环路/ ,/ 也/ 并/ 不能/ 保证/ 每个/ AS/ 获得/ 多样性/ 路径/ ,/ 且/ 部分/ 协议/ 难以实现/ 完全/ 无/ 中断/ 转发/ ./ 针对/ 抑制/ 瞬时/ 失效/ 、/ 无/ 中断/ 报文/ 转发/ 、/ 低/ 开销/ 的/ 需求/ ,/ 本文/ 提出/ 了/ 通过/ 构造/ 多/ 转发/ 树/ 容忍/ 失效/ 的/ 域间/ 路由/ 协议/ (/ MultipleForwardingTreeandFailureTolerantBGP/ ,/ MFT2/ -/ BGP/ )/ 以/ 实现/ 快速/ 路由/ 恢复/ ,/ 其/ 主要/ 面临/ 如下/ 挑战/ :/ (/ 1/ )/ 在/ 标准/ BGP/ 中/ ,/ AS/ 节点/ 无/ 全局/ 拓扑/ ,/ 使得/ 每个/ AS/ 难以获得/ 、/ 区分/ 多样性/ 路径/ ;/ (/ 2/ )/ 在/ 构造/ 多/ 转发/ 树时/ 要求/ 降低/ 收敛/ 时间/ ,/ 并/ 保证/ 处理/ 开销/ 在/ 合理/ 范围/ 内/ ;/ (/ 3/ )/ 保证/ 报文/ 在/ 多/ 转发/ 树/ 之间/ 切换/ 时/ 不会/ 形成/ 环路/ ./ 为此/ ,/ MFT2/ -/ BGP/ 设计/ 主要/ 包括/ 3/ 个/ 关键/ 部分/ ,/ 即/ 控制/ 平面/ 的/ 多/ 转发/ 树/ 构造/ 、/ 加速/ 收敛/ 与/ 瞬时/ 失效/ 抑制/ 、/ 数据/ 平面/ 无/ 中断/ 报文/ 转发/ 算法/ ./ 该/ 协议/ 的/ 特点/ 在于/ :/ (/ 1/ )/ 充分利用/ 底层/ 冗余/ 拓扑/ ,/ 提供/ 可/ 保证/ 的/ 结构化/ 多样性/ 路径/ ,/ 避免/ 了/ 备份/ 路径/ 之间/ 可能/ 的/ 环路/ ;/ (/ 2/ )/ 抑制/ 瞬时/ 失效/ ,/ 避免/ 失效/ 全局/ 可视化/ ,/ 增强/ 了/ BGP/ 系统/ 的/ 稳定性/ ;/ (/ 3/ )/ 从/ 数据/ 平面/ 保护/ 流量/ ,/ 采取/ 本地/ 先验/ 式/ 的/ 方法/ 处理/ 瞬时/ 失效/ 引起/ 的/ 报文/ 丢失/ ,/ 支持/ 关键/ 业务/ 的/ 应用/ ;/ (/ 4/ )/ 具有/ 可扩展性/ 、/ 兼容性/ ,/ 便于/ 增量/ 部署/ ./ 本文/ 第/ 2/ 节/ 介绍/ 相关/ 工作/ ;/ 第/ 3/ 节/ 描述/ 问题/ 模型/ ;/ 第/ 4/ 节/ 设计/ MFT2/ -/ BGP/ 协议/ 框架/ 以及/ 控制/ 平面/ 的/ 多/ 转发/ 树/ 构造/ 、/ 加速/ 收敛/ 、/ 失效/ 抑制/ 以及/ 报文/ 转发/ 算法/ ;/ 第/ 5/ 节对/ 协议/ 的/ 正确性/ 进行/ 分析/ ;/ 第/ 6/ 节/ 通过/ 模拟/ 验证/ MFT2/ -/ BGP/ 的/ 收敛性/ 以及/ 无/ 中断/ 转发/ 性能/ ;/ 最后/ 对/ 本文/ 工作/ 进行/ 总结/ ./ 2/ 相关/ 工作/ 当前/ 大部分/ 研究/ 工作/ 主要/ 利用/ 冗余/ 路径/ 以/ 应对/ 出现/ 的/ 失效/ ,/ IETFRTGWG/ 工作组/ 致力于/ IGP/ 协议/ 的/ IPFRR/ (/ IP/ 快速/ 重/ 路由/ )/ ,/ 比如/ Deflections/ [/ 14/ ]/ 等/ ,/ 其/ 主要/ 思想/ 是/ 为/ 可能/ 出现/ 的/ 链路/ 、/ 节点/ 失效/ 预计/ 算/ 备份/ 路径/ ./ Medard/ 等/ 人/ [/ 15/ ]/ 最早/ 提出/ 了/ 冗余/ 树/ 的/ 方法/ 以/ 容忍/ 单链/ 路/ 失效/ ,/ Kini/ 等/ 人/ [/ 16/ ]/ 通过/ 构造/ 多/ 冗余/ 树以/ 容忍/ 两条/ 链路/ 失效/ ,/ 然而/ 在/ 图论/ 中/ 计算/ 冗余/ 路径/ 的/ 经典/ 算法/ 都/ 需要/ 获得/ 全局/ 一致性/ 拓扑/ 信息/ ,/ 而域/ 间/ 路由/ 系统/ 中/ 每个/ AS/ 仅能/ 获得/ 局部/ 拓扑/ 信息/ ,/ 无法/ 进行/ 有效/ 集中式/ 计算/ ;/ 其次/ 由于/ Internet/ 的/ AS/ 数量/ 大/ ,/ 集中式/ 计算/ 复杂度/ 非常/ 高/ ,/ 即使/ 是/ 分布式/ 方法/ 也/ 由于/ 协议/ 复杂/ 度过/ 高而/ 难以实现/ ;/ 最后/ 由于/ BGP/ 协议/ 需要/ 保证/ 策略/ 实现/ ,/ 进一步/ 限制/ 了/ 可达性/ ,/ 因此/ 许多/ IGP/ 中/ 的/ 方法/ 难以/ 直接/ 应用/ 于/ BGP/ 中/ ./ 现有/ BGP/ 协议/ 缺乏/ 对/ 多路径/ 的/ 考虑/ ,/ 缺乏/ 发现/ 、/ 使用/ 多路径/ 的/ 能力/ ,/ 大量/ 研究/ 表明/ 多路径/ 可/ 增强/ 网络/ 容量/ 、/ 可靠性/ ./ MIRO/ [/ 9/ ]/ 通过/ 复杂/ 的/ 协商/ 机制/ 获得/ 多路径/ ,/ 依赖于/ 配置/ 通告/ 备份/ 路径/ 的/ 策略/ ,/ 是/ 一种/ 无/ 结构/ 路径/ 的/ 方法/ ,/ MIRO/ 采用/ 隧道/ 机制/ 区分/ 那些/ 需要/ 在/ 备用/ 路径/ 上/ 传输/ 的/ 报文/ ,/ 并且/ 没有/ 考虑/ 快速/ 路由/ 恢复/ ./ R/ -/ BGP/ [/ 10/ ]/ 为/ AS/ 通告/ 一条/ 与/ 最佳/ 路径/ 不/ 相交/ 的/ AS/ 级/ 备份/ 路径/ 以/ 提高/ 可靠性/ ,/ 这/ 依赖于/ 大量/ 手工/ 配置/ 通告/ 备份/ 路径/ 的/ 策略/ ,/ 是/ 一种/ 无/ 结构/ 路径/ 的/ 方法/ ,/ 信令/ 机制/ 较/ 复杂/ ,/ 且/ 并/ 不能/ 完全/ 保证/ 获得/ 多样性/ 路径/ ,/ 且/ 需要/ 特殊/ 报文/ 封装/ 机制/ 进行/ 转发/ ./ Page3Consensus/ [/ 12/ ]/ 路由/ 协议/ 借鉴/ 了/ 分布式系统/ 中/ 快照/ 实现/ 一致性/ 的/ 算法/ ,/ 将/ 路由/ 计算/ 集中/ 于/ 顶级/ AS/ ,/ 这/ 却/ 违反/ 了/ AS/ 自治/ 性/ ,/ 当/ 链路/ 失效/ 造成/ 报文/ 不能/ 正常/ 转发/ 时/ 进入/ 瞬时/ 模式/ ,/ 采用/ 偏转/ (/ Deflection/ )/ 、/ 回退/ (/ Backtracking/ )/ 、/ 备份/ (/ Backup/ )/ 机制/ 发起/ 本地/ 重/ 路由/ ./ Splicing/ [/ 11/ ]/ 利用/ BGP/ 路由器/ 中/ 已有/ 的/ 多条/ 路径/ 构造/ 多路径/ 转发/ ./ YAMR/ [/ 13/ ]/ 为/ 每个/ AS/ 最佳/ 路径/ 的/ 每/ 一/ 跳/ 都/ 获得/ 冗余/ 标签/ 路径/ ,/ 其/ 平均/ RIB/ // FIB/ 存储/ 平均/ 至少/ 增加/ 4.6/ 倍/ ,/ 且/ 部分/ 冗余/ 路径/ 对于/ 快速/ 恢复/ 难以/ 发挥作用/ ./ ACF/ [/ 17/ ]/ 在/ 路由/ 不/ 一致/ 的/ 情况/ 下/ 采用/ 检测/ 并/ 恢复/ 的/ 方法/ ,/ 通过/ 在/ 报文/ 头/ 中/ 添加/ 路径/ 踪迹/ 域/ 、/ 黑名单/ 域/ 等/ 辅助/ 路由/ 决策/ 和/ 转发/ ,/ 较大/ 程度/ 增加/ 了/ 报文/ 头/ 开销/ ,/ 可能/ 形成/ 违反/ AS/ 策略/ 的/ 转发/ 路径/ ./ Add/ -/ Path/ [/ 18/ ]/ 通告/ 多路径/ ,/ 需要/ 全网/ 路由器/ 更新/ ,/ 且/ 增加/ 了/ 路由/ 震荡/ 的/ 风险/ ./ 上述/ 针对/ BGP/ 的/ 多路径/ 协议/ 主要/ 通过/ 修改/ 策略/ 使/ 其/ 在/ 控制/ 平面/ 通告/ 多路径/ ,/ 这/ 需要/ 复杂/ 的/ 信令/ 、/ 决策/ 机制/ 等/ ,/ 是/ 一种/ 无/ 结构/ 的/ 方法/ ,/ 并/ 没有/ 对/ BGP/ 协议/ 进行/ 系统化/ 的/ 设计/ ,/ 对于/ 多/ 链路/ 失效/ 的/ 转发/ 缺乏/ 考虑/ ;/ 且/ 这些/ 协议/ 对于/ 路径/ 多样性/ 暴露/ 程度/ 并/ 没有/ 确定性/ 的/ 保证/ ,/ 且/ 基本上/ 没有/ 考虑/ 抑制/ 瞬时/ 失效/ 的/ 方法/ ,/ 对于/ 多路径/ 协议/ 的/ 收敛/ 期间/ 的/ 动态/ 行为/ 缺乏/ 考虑/ ./ 对于/ 降低/ 协议/ 开销/ 、/ 保证/ 无/ 中断/ 转发/ 、/ 抑制/ 瞬时/ 失效/ 这/ 3/ 个/ 相互影响/ 的/ 问题/ ,/ 已有/ 工作/ 并/ 不能/ 完全/ 解决/ ./ MFT2/ -/ BGP/ 通过/ 为/ 目标/ 前缀/ 构造/ 冗余/ 树/ ,/ 每个/ AS/ 自动/ 获得/ 结构化/ 的/ 多样性/ 路径/ ,/ 而/ 无需/ 大量/ 人工/ 配置/ 复杂/ 策略/ ,/ 可以/ 实现/ 负载/ 均衡/ 、/ 降低/ BGP/ 扰动/ ,/ 面临/ 失效/ 时/ 动态/ 切换/ 路径/ 以/ 实现/ 快速/ 路由/ 恢复/ ,/ 在/ 不/ 影响/ 报文/ 转发/ 的/ 情况/ 下/ 抑制/ 瞬时/ 失效/ ,/ 增强/ BGP/ 路由/ 系统/ 的/ 稳定性/ ./ 3/ 网络/ 模型/ 和/ 问题/ 分析/ 3.1/ 网络/ 模型/ MFT2/ -/ BGP/ 做出/ 如下/ 设定/ (/ 其中/ 设定/ (/ 1/ )/ 是/ 为了/ 简化/ 表述/ ,/ 这是/ 当前/ 研究/ 普遍/ 采用/ 的/ 设置/ ,/ 不/ 影响/ 协议/ 的/ 正确性/ ,/ 而/ (/ 2/ )/ 、/ (/ 3/ )/ 是/ 研究/ BGP/ [/ 2/ ]/ 的/ 基本/ 设置/ )/ :/ (/ 1/ )/ 每个/ ASv/ 仅由单/ 边界/ 网关/ 路由器/ 节点/ 组成/ (/ 不/ 考虑/ iBGP/ )/ ,/ v/ 对/ 每个/ u/ ∈/ Peers/ (/ v/ )/ (/ Peers/ (/ v/ )/ 为/ v/ 的/ 邻居/ 节点/ )/ 的/ 导入/ 、/ 导出/ 路径/ 分别/ 保存/ 在/ rib/ _/ in/ (/ v/ ←/ u/ )/ 、/ rib/ _/ out/ (/ v/ →/ u/ )/ 中/ ,/ loc/ _/ rib/ (/ v/ )/ 保存/ 本地/ 最佳/ 路径/ ;/ (/ 2/ )/ AS/ 的/ 导入/ 导出/ 策略/ 服从/ “/ Gao/ -/ Rexford/ ”/ 原则/ [/ 19/ ]/ ,/ 即仅/ 出现/ “/ valley/ -/ free/ ”/ 的/ 路径/ ;/ (/ 3/ )/ AS/ 间/ 建立/ eBGP/ 会话/ ,/ 路由/ 更新/ 消息/ 服从/ SPVP/ [/ 20/ ]/ 模型/ ./ 3.2/ 问题/ 的/ 提出/ 与/ 分析/ 在/ 给定/ 拓扑/ 下/ 网络/ 容忍/ 失效/ 的/ 性能/ 主要/ 取决于/ 拓扑/ 暴露/ 程度/ 、/ 协议/ 响应/ 性/ 两个/ 因素/ ./ BGP/ 协议/ 在/ 这/ 两个/ 方面/ 却/ 存在/ 不足/ ./ 虽然/ BGP/ 将/ 快速/ 响应/ 性/ 置于/ 一致性/ 之上/ ,/ 但是/ 却/ 带来/ 了/ 大量/ 环路/ 以及/ 路由/ 黑洞/ ,/ 直接/ 影响/ 转发/ 性能/ ;/ 同时/ ,/ 尽管/ Internet/ 底层/ 路径/ 具有/ 充分/ 冗余/ [/ 21/ ]/ ,/ AS/ 无可替代/ 路径/ 的/ 不到/ 5/ %/ [/ 9/ ]/ ,/ BGP/ 协议/ 对于/ 底层/ 路径/ 暴露/ 程度/ 不足/ ,/ 缺乏/ 发现/ 、/ 区分/ 和/ 使用/ 多路径/ 的/ 能力/ ,/ 多/ 宿主/ AS/ 也/ 仅/ 能/ 控制/ 报文/ 出口/ ,/ 而/ 仍然/ 缺乏/ 容错性/ [/ 5/ ]/ ,/ 这/ 主要/ 是/ 由于/ BGP/ 缺乏/ 故障/ 隔离/ 能力/ 、/ 仅/ 通告/ 并/ 使用/ 单/ 路径/ 、/ 协议/ 的/ 动态性/ 造成/ 的/ 瞬时性/ 不可/ 达/ 、/ 环路/ (/ 将/ 其/ 统称/ 为/ 瞬时/ 路由/ 失效/ )/ [/ 22/ ]/ ,/ 从而/ 造成/ 了/ 网络/ 可用性/ 相对/ 较/ 低/ ,/ 而/ 一些/ 多路径/ BGP/ 协议/ 却/ 增加/ 了/ 环路/ 发生/ 的/ 可能性/ [/ 18/ ]/ ,/ 比如/ R/ -/ BGP/ 为/ 当前/ 下/ 一/ 跳/ 通告/ 备份/ 路径/ 时/ ,/ 如图/ 1/ 中/ AS2/ 为/ 下/ 一/ 跳/ AS1/ 通告/ 备份/ 路径/ (/ 2/ -/ 0/ )/ ,/ 当/ AS1/ -/ AS0/ 和/ AS2/ -/ AS0/ 多/ 链路/ 同时/ 失效/ 时/ ,/ 由于/ AS1/ 和/ AS2/ 独立/ 决策/ ,/ 将会/ 在/ 造成/ 备份/ 路径/ 之间/ 形成/ 环路/ ,/ 甚至/ 某些/ 单链/ 路/ 特殊/ 场景/ 下/ 也/ 可能/ 造成/ 环路/ ./ Splicing/ [/ 11/ ]/ 仅/ 利用/ 已有/ 路径/ ,/ 却/ 没有/ 考虑/ 如何/ 获得/ 多样性/ 路径/ ,/ 比如/ AS0/ -/ AS3/ 断开/ 时/ Splicing/ 仍/ 将/ 产生/ 失效/ ./ 合理/ 发现/ 、/ 利用/ 多样性/ 路径/ 是/ 解决/ 这些/ 问题/ 的/ 关键/ ./ 基于/ 以上/ 观察/ ,/ 在/ 设计/ MFT2/ -/ BGP/ 时/ 对/ SPVP/ [/ 20/ ]/ 定义/ 进行/ 扩展/ 以/ 发现/ 、/ 区分/ 多路径/ ;/ 在/ 多路径/ 开销/ 和/ 性能/ 之间/ 折衷/ ,/ 确保/ 协议/ 的/ 收敛性/ 和/ 正确性/ ./ 定义/ 1/ ./ 合法/ 路径/ ./ BGP/ 中/ 合法/ 路径/ 必须/ 服从/ 策略/ 、/ 能够/ 到达/ d/ (/ 即/ 不/ 含/ 失效/ 链路/ // 节点/ )/ ;/ 其次/ 路径/ P/ =/ π/ (/ u/ ,/ d/ )/ 是/ 合法/ 的/ 必须/ 满足/ :/ / i/ ,/ n/ / i/ / 1/ ,/ π/ (/ u/ ,/ d/ )/ =/ π/ (/ u/ ,/ vi/ )/ +/ π/ u/ (/ u/ ∈/ vi/ ,/ d/ )/ =/ π/ (/ u/ ,/ vi/ )/ +/ π/ (/ vi/ ,/ d/ )/ ,/ 即/ π/ u/ (/ u/ ∈/ vi/ ,/ d/ )/ =/ π/ (/ vi/ ,/ d/ )/ ,/ 即/ 合法/ 路径/ 不会/ 造成/ 报文/ 偏转/ ./ 其中/ 路径/ P/ =/ π/ (/ u/ ,/ d/ )/ =/ (/ u/ ,/ v1/ ,/ v2/ ,/ …/ ,/ vn/ ,/ d/ )/ ,/ 表示/ u/ 分配/ 的/ 到达/ d/ 的/ 节点/ 序列/ ,/ π/ u/ (/ u/ ∈/ vi/ ,/ d/ )/ 表示/ 在/ u/ 的/ 路由/ 记录/ 中/ 所/ 看到/ 的/ vi/ 到达/ d/ 的/ 路/ Page4/ 径/ ,/ 而/ π/ (/ vi/ ,/ d/ )/ 表示/ vi/ 实际/ 采用/ 转发/ 路径/ ,/ P/ ·/ Q/ 表示/ 为/ 路径/ P/ 、/ Q/ 拼接/ ./ 设非空/ 合法/ 路径/ P/ 、/ Q/ 完全/ 不/ 相交/ ;/ 或者/ 在/ 某点/ 交叉/ ,/ 即/ / i/ ,/ j/ ,/ 使得/ vi/ =/ wj/ ≠/ d/ ,/ 或者/ P/ 与/ Q/ 仅/ 在/ d/ 汇合/ ,/ 如果/ π/ u/ (/ u/ ∈/ vi/ ,/ d/ )/ =/ π/ z/ (/ z/ ∈/ wj/ ,/ d/ )/ ,/ 那么/ P/ 、/ Q/ 之间/ 是/ 一致/ 的/ ,/ 一致性/ 路径/ 不会/ 造成/ 转发/ 环路/ ./ 定义/ 2/ ./ 隐藏/ 路径/ 与/ 备份/ 路径/ ./ 指/ 底层/ 拓扑/ 存在/ 到达/ d/ 的/ 合法/ 路径/ ,/ 但/ AS/ 却/ 没有/ 获取/ 该/ 路径/ ,/ 其/ 具有/ 相对性/ ,/ 比如/ 图/ 1/ 中/ ,/ AS3/ 可以/ 通过/ (/ 3/ -/ 5/ -/ 6/ -/ 2/ -/ 0/ )/ 或/ (/ 3/ -/ 4/ -/ 6/ -/ 2/ -/ 0/ )/ 合法/ 路径/ 封装/ 报文/ 到达/ 目标/ ,/ 却/ 被/ AS4/ 、/ AS5/ 隐藏/ ./ 备份/ 路径/ 是/ 指/ 可/ 到达/ d/ 且/ 没有/ 被/ 选作/ 最佳/ 路径/ 的/ 合法/ 路径/ ,/ 备份/ 路径/ 也/ 可能/ 被/ 隐藏/ ./ 定义/ 3/ ./ 路径/ 不/ 相交/ 度/ ./ 对于/ 给定/ 路径/ P/ 、/ Q/ ,/ 如果/ P/ 和/ Q/ 具有/ 不同/ 下/ 一/ 跳/ ,/ Disjoint/ (/ P/ ,/ Q/ )/ =/ 1/ -/ |/ P/ ∩/ Q/ |/ // |/ P/ |/ (/ 计算/ |/ P/ ∩/ Q/ |/ 时/ 不/ 包含/ 源/ 、/ 目的/ 节点/ )/ ;/ 否则/ Disjoint/ (/ P/ ,/ Q/ )/ =/ 0/ ,/ 这是/ 由于/ 具有/ 相同/ 下/ 一/ 跳/ 的/ 路径/ 无法/ 用于/ 快速/ 恢复/ ./ 对于/ 节点/ u/ 的/ 合法/ 路径/ P/ 、/ Q/ ,/ 如果/ 满足/ Disjoint/ (/ P/ ,/ Q/ )/ >/ 0/ ,/ 则/ 称/ u/ 具有/ 多样性/ 路径/ ./ 定义/ 4/ ./ 转发/ 树/ ./ 对于/ 给定/ 目标/ 前缀/ d/ ,/ 存在/ 稳定/ 的/ 路径/ 分配/ 使/ BGP/ 收敛/ 后/ ,/ 所有/ 节点/ 最佳/ 路径/ 最终/ 形成/ 以/ d/ 为根/ 节点/ 的/ 转发/ 树/ [/ 20/ ]/ ,/ 转发/ 树中/ 所有/ 节点/ 转发/ 路径/ 具有/ 一致性/ ,/ 即/ 如果/ π/ (/ u/ ,/ d/ )/ =/ (/ u/ ,/ v/ ,/ P/ )/ ,/ 那么/ π/ (/ v/ ,/ d/ )/ =/ (/ v/ ,/ P/ )/ ./ 由于/ BGP/ 的/ 策略/ 限制/ ,/ 其/ 转发/ 树/ 并不一定/ 是/ 最/ 短/ 路径/ 树/ ./ 定义/ 5/ ./ 路径/ 标识/ (/ PathIdentifier/ ,/ PID/ )/ ./ 当/ 存在/ 多条/ 到达/ 目标/ 前缀/ 的/ 路径/ 时/ ,/ 为了/ 区分/ 、/ 处理/ 每条/ 合法/ 路径/ ,/ 节点/ 需要/ 同时/ 根据/ 前缀/ prefix/ 和/ 特定/ 标识符/ ψ/ 区分/ 路径/ ,/ 即/ 利用/ (/ prefix/ ,/ ψ/ )/ 路径/ 标识符/ 唯一/ 标识/ 一条/ 路径/ P/ ./ 定义/ 6/ ./ 秩/ 函数/ λ/ v/ :/ Pv/ →/ N/ ,/ 对于/ P/ ∈/ Pv/ ,/ Pv/ =/ {/ P/ |/ P/ =/ v/ ·/ π/ (/ v/ ,/ d/ )/ ,/ v/ ∈/ Peers/ (/ u/ )/ }/ ,/ Pv/ 表示/ 从/ v/ 到达/ d/ 的/ 合法/ 路径/ 集合/ ,/ 如果/ P1/ 、/ P2/ ∈/ Pv/ ,/ λ/ v/ (/ P1/ )/ >/ λ/ v/ (/ P2/ )/ ,/ 那么/ P1/ 具有/ 更高/ 优先级/ ./ 定义/ 7/ ./ 瞬时/ 失效节点/ ./ 指/ 出现/ 失效/ 后/ ,/ 节点/ v/ 的/ rib/ _/ in/ (/ v/ )/ 中/ 无可/ 到达/ d/ 的/ 合法/ 路径/ ,/ 此时/ 节点/ 可行/ 路径/ 集为/ 空/ 或/ 包含/ 非法/ 路径/ ,/ 此时/ 会/ 造成/ 报文/ 丢失/ 或者/ 环路/ [/ 22/ ]/ ./ 如图/ 1/ 所示/ ,/ 目标/ 前缀/ d/ 位于/ AS0/ ,/ AS/ 旁/ 矩形框/ 为/ 根据/ Valley/ -/ Free/ 得到/ 的/ 路由表/ ,/ 比如/ AS5/ 具有/ 3/ 条/ 到达/ AS0/ 的/ 路径/ ,/ AS5/ 根据/ “/ PreferCustomer/ ”/ 优选/ (/ 5/ -/ 3/ -/ 0/ )/ 作为/ 最佳/ 路径/ ./ 假设/ 链路/ AS0/ -/ AS3/ 断开/ ,/ AS3/ 发送/ 撤销/ 消息/ 到/ AS4/ 和/ AS5/ ,/ AS5/ 将/ 根据/ 其/ 偏好/ 策略/ 优先选择/ (/ 5/ -/ 4/ -/ 3/ -/ 0/ )/ ,/ 而/ AS4/ 将/ 选择/ (/ 4/ -/ 5/ -/ 3/ -/ 0/ )/ 路径/ 作为/ 最佳/ 路由/ ,/ WRATE/ (/ 撤销/ 速率/ 限制/ 定时器/ )/ 使得/ AS2/ 和/ AS3/ 延迟/ 通告/ 新/ 的/ 可用/ 路径/ ,/ 此时/ AS5/ 、/ AS4/ 之间/ 形成/ 环路/ ,/ AS3/ 无/ 到达/ AS0/ 的/ 路径/ ./ 即/ AS3/ 、/ AS4/ 、/ AS5/ 经历/ 瞬时/ 失效/ ./ 定义/ 8/ ./ 转发/ 中断/ ./ 转发/ 路径/ 是/ 指/ 在/ 时刻/ t/ ,/ 报文/ 从/ u/ 发送到/ d/ 所/ 实际/ 经过/ 的/ 节点/ 序列/ ,/ 表示/ 为/ forward/ (/ u/ ,/ d/ )/ ,/ 如果/ / v/ ∈/ forward/ (/ u/ ,/ d/ )/ ,/ v/ 的/ 转发/ 平面/ 中/ 的/ 下/ 一/ 跳/ 为/ 空/ 或/ 陷入/ 环路/ ,/ 则/ 称之为/ 转发/ 中断/ (/ 本文/ 忽略/ 失效/ 检测时间/ ,/ BFD/ 机制/ 可/ 将/ 失效/ 检测时间/ 降至/ 15ms/ 以内/ ,/ Cisco/ 路由器/ 已经/ 普遍/ 实现/ BFD/ )/ ./ 需要/ 注意/ 的/ 是/ ,/ 节点/ 瞬时/ 失效/ 仅/ 是/ 转发/ 中断/ 的/ 必要条件/ ,/ 比如/ 在/ 图/ 1/ 中/ ,/ 如果/ AS2/ -/ AS0/ 链路/ 失效/ ,/ 虽然/ AS6/ 采用/ (/ 6/ -/ 2/ -/ 0/ )/ 不是/ 合法/ 路径/ ,/ 但是/ 由于/ AS2/ 具有/ 冗余/ 路径/ ,/ 在/ 检测/ 到/ 失效/ 以后/ 能够/ 迅速/ 切换/ (/ 2/ -/ 1/ -/ 0/ )/ ,/ 此时/ 并/ 无/ 节点/ 经历/ 转发/ 中断/ ./ 而/ 在/ 一些/ 加速/ 收敛/ 协议/ 中/ ,/ 如/ GhostFlushing/ 将/ 使/ AS2/ 快速/ 撤销/ 路径/ (/ 2/ -/ 0/ )/ ,/ 如果/ AS6/ 无/ 备份/ 路径/ ,/ 将/ 导致/ AS6/ 也/ 经历/ 转发/ 中断/ ,/ 数据/ 平面/ 的/ 转发/ 中断/ 相对/ 于/ BGP/ 收敛/ 时间/ 更/ 准确/ 度量/ 协议/ 性能/ [/ 23/ ]/ ,/ 文献/ [/ 5/ ]/ 也/ 指出/ 控制/ 平面/ 的/ 可达/ 与/ 数据/ 平面/ 的/ 可达/ 并/ 不/ 完全/ 相关/ ,/ 本文/ 也/ 将/ 用/ 瞬时/ 失效率/ 、/ 转发/ 中断/ 作为/ 衡量/ 协议/ 性能/ 的/ 重要/ 指标/ ./ 4MFT2/ -/ BGP/ 协议/ 设计/ 4.1/ MFT2/ -/ BGP/ 基本/ 框架/ BGP/ 路由/ 系统/ 表示/ 为/ S/ =/ 〈/ G/ ,/ Policy/ (/ G/ )/ ,/ s/ 〉/ ,/ 其中/ AS/ 图/ 表示/ 为/ G/ =/ (/ V/ ,/ E/ )/ ,/ V/ =/ {/ 0/ ,/ 1/ ,/ …/ ,/ n/ }/ ,/ Policy/ 为/ 所有/ 节点/ 的/ 策略/ 集合/ ./ BGP/ 系统/ 状态/ 表示/ 为/ 元组/ 〈/ r0/ ,/ r1/ ,/ …/ ,/ rn/ 〉/ ,/ 其中/ ri/ 表示/ ASi/ 的/ 路由表/ 中/ 所/ 包含/ 的/ 到达/ d/ 的/ 路径/ 集合/ ,/ p/ ∈/ ri/ ,/ s0/ 表示/ d/ 发起/ 通告/ 时/ 的/ 初始状态/ ,/ s0/ =/ 〈/ r00/ ,/ r01/ ,/ …/ ,/ r0n/ 〉/ ./ 当/ 处于/ 收敛/ 状态/ sfinal/ 时/ ,/ 所有/ 节点/ 的/ 转发/ 路径/ 将/ 形成/ 以/ d/ 为根/ 的/ 最佳/ 转发/ 树/ Best/ _/ Tree/ (/ d/ ,/ 〈/ rfinaln/ 〉/ )/ =/ G/ (/ V/ ,/ E/ )/ ,/ 且/ 有/ V/ =/ {/ nj/ ∈/ V/ |/ / p/ ∈/ rj/ }/ ,/ rfinalE/ =/ ∪/ nj/ ∈/ V/ {/ (/ u/ ,/ v/ )/ ∈/ E/ / p/ ∈/ rj/ ∧/ p/ =/ v1/ ,/ v2/ ,/ …/ ,/ v/ (/ 当/ 链路/ 失效/ 后/ BGP/ 重新/ 收敛/ 形成/ 新/ 的/ 以/ d/ 为根/ 的/ 转发/ 树/ ./ 如图/ 1/ 中/ ,/ AS0/ -/ AS3/ 断开/ 后/ 收敛/ 最终/ 得到/ 失效/ 后/ 转发/ 树/ ./ 基于/ 以上/ 观察/ ,/ 如果/ 各个/ 节点/ 在/ 失效/ 前/ 能够/ 发现/ 、/ 预计/ 算/ 出/ 备份/ 转发/ 树/ ,/ 就/ 可以/ 保证/ 每个/ AS/ 在/ 面临/ 链路/ // 节点/ 失效/ 的/ 时候/ ,/ 仍然/ 存在/ 合法/ 备份/ 路径/ ,/ 从而/ 将/ 流量/ 切换/ 到/ 备份/ 转发/ 树中/ ,/ 且备/ Page5/ 份/ 转发/ 树/ 路径/ 上/ 具有/ 完全/ 一致性/ ,/ 其/ 结构化/ 性质/ 阻止/ 了/ 环路/ 形成/ ./ 然而/ ,/ 由于/ BGP/ 并/ 不能/ 获得/ 全局/ 拓扑/ 进行/ 有效/ 集中式/ 计算/ 链路/ 或者/ 节点/ 不/ 相交/ 树/ [/ 15/ -/ 16/ ]/ ,/ 而/ 注入/ 失效/ 链路/ 并/ 强制/ 其/ 收敛/ 获得/ 失效/ 后/ 转发/ 树/ ,/ 其/ 收敛/ 时间/ 过长/ 且会/ 中断/ 报文/ 转发/ ./ 为此/ ,/ MFT2/ -/ BGP/ 对/ 协议/ 通告/ 过程/ 进行/ 修改/ ,/ 添加/ 路径/ 标识符/ 以/ 区分/ 、/ 获得/ 结构化/ 的/ 多样性/ 路径/ ./ 节点/ 为了/ 能够/ 利用/ 多条/ 路径/ 进行/ 无环/ 转发/ ,/ 也/ 需要/ 为/ 多路径/ 分配/ 路径/ 标识符/ ,/ 任意/ 节点/ v/ 必须/ 实现/ 如下/ 映射/ :/ 路径/ 标识/ 函数/ PathIDv/ ,/ 即/ 节点/ v/ 需要/ 为/ 每条/ 合法/ 路径/ 从/ 路径/ 标识/ 集合/ PID/ 中/ 选择/ 合适/ 标识符/ ψ/ iv/ ,/ 其中/ ψ/ iv/ 表示/ 节点/ v/ 的/ 第/ i/ 条/ 路径/ 标识符/ ,/ 而/ 转发/ 函数/ Forwardv/ 则/ 根据/ ψ/ (/ / ψ/ ∈/ PID/ )/ 进行/ 报文/ 转发/ ,/ 将/ ψ/ 映射/ 到/ 对应/ 的/ 路径/ P/ =/ (/ v1/ ,/ v2/ ,/ …/ ,/ vn/ )/ ,/ 节点/ vk/ 和/ vk/ -/ 1/ 需/ 正确/ 解释/ ψ/ ,/ 且/ vk/ 能够/ 将/ 报文/ 转发/ 到/ vk/ -/ 1/ ,/ 即/ Forwardvk/ (/ ψ/ ,/ d/ )/ =/ vk/ -/ 1/ ,/ 1/ / i/ / n/ ./ 其中/ 路径/ 标识符/ 可以/ 是/ 全局/ 一致/ 标识/ 或/ 本地/ 分配/ 的/ 标识符/ ,/ 而/ 本地/ 分配/ 标识符/ 更加/ 灵活/ ,/ 但/ vk/ 、/ vk/ -/ 1/ 之间/ 需对/ 本地/ 标识符/ ψ/ jvk/ 以及/ ψ/ ivk/ -/ 1/ 按照/ 式/ (/ 2/ )/ 的/ 条件/ 协商/ 后/ 进行/ 映射/ 转换/ ,/ 即/ 对于/ 标识符/ ψ/ 路径/ P/ 上/ 相邻/ 节点/ ,/ 如图/ 2/ (/ a/ )/ 所示/ ,/ map/ (/ ψ/ jvk/ )/ =/ map/ (/ ψ/ ivk/ -/ 1/ )/ =/ ψ/ 以/ 保证/ 转发/ 一致性/ ,/ 标识符/ 映射/ 可/ 采用/ 与/ Deflection/ [/ 14/ ]/ 类似/ 的/ 方法/ ,/ 为/ 表述/ 方便/ 本文/ 采用/ 全局/ 一致性/ 标识/ ./ 在/ 不/ 影响/ 理解/ 的/ 情况/ 下/ ,/ 本文/ 中将/ 网络/ 节点/ 等同于/ AS/ 节点/ ./ 对于/ 标识符/ ψ/ 和/ 其/ 对应/ 转发/ 树/ ψ/ 也/ 不/ 进行/ 区分/ ,/ 对于/ 转发/ 树/ ψ/ (/ 非/ 最佳/ 转发/ 树/ )/ 中/ 节点/ 对应/ ψ/ 的/ 路径/ ,/ 也/ 称为/ 该/ 节点/ 的/ 备份/ 路径/ ./ 图/ 3MFT2/ -/ BGP/ 更新/ 消息/ 处理过程/ 示例/ 当/ 节点/ 检测/ 到/ 最佳/ 路径/ 的/ 下/ 一/ 跳/ 失效/ 后/ ,/ 如果/ 该/ 节点/ 具有/ 不/ 相交/ 度/ 大于/ 0/ 的/ 备份/ 路径/ ,/ 通过/ 修改/ 报文/ 头以/ 动态/ 切换/ 到/ 具有/ 不同/ 标识符/ 上/ 的/ 转发/ 树/ ,/ 实现/ 无/ 中断/ 转发/ ./ 4.2/ ./ 1/ 前缀/ 通告/ 在/ MFT2/ -/ BGP/ 协议/ 中/ ,/ ASv/ 发起/ 前缀/ 通告/ 时/ ,/ 4.2/ 控制/ 平面/ 多/ 转发/ 树/ 构造/ 与/ 更新/ MFT2/ -/ BGP/ 对/ 路由/ 通告/ 、/ 路由/ 决策/ 进行/ 了/ 相应/ 的/ 修改/ ,/ 如图/ 1/ 中/ ,/ AS0/ 根据/ 本地/ 策略/ 向/ 3/ 个/ 邻居/ 节点/ AS1/ 、/ AS2/ 、/ AS3/ 通告/ 前缀/ 时/ 分别/ 分配/ 标识符/ ψ/ 10/ 、/ ψ/ 30/ (/ 简记/ 为/ ψ/ 1/ 、/ ψ/ 2/ 、/ ψ/ 3/ )/ ./ 各/ 节点/ (/ 不含/ AS7/ 、/ AS8/ )/ ψ/ 2/ 最终/ 获得/ 多路径/ 如图/ 3/ 所示/ ,/ 其中/ 对/ 更新/ 消息/ 处理/ 顺序/ 可能/ 导致/ 中间状态/ 不同/ ,/ 但/ 最终/ 收敛/ 结果/ 一致/ ,/ 形成/ 3/ 个/ 不同/ 转发/ 树/ ,/ 简记/ 为/ ψ/ 1/ _/ Tree/ 、/ ψ/ 2/ _/ Tree/ 、/ ψ/ 3/ _/ Tree/ ./ 其中/ 对于/ AS7/ 仅能/ 通过/ 上行/ 路径/ (/ uphill/ )/ [/ 19/ ]/ 到达/ 目标/ 前缀/ ,/ AS6/ 和/ AS2/ 会/ 导出/ 所有/ 本地/ 合法/ 路径/ 到/ AS7/ ,/ AS7/ 可/ 根据/ 本地/ 策略/ 决定/ 各个/ 路径/ 标识/ 上/ 的/ 最佳/ 路径/ ./ 图/ 3/ 表现/ 了/ 协议/ 运行/ 过程/ ,/ 暂时/ 并/ 没有/ 考虑/ 将/ 具有/ 相同/ 下/ 一/ 跳/ 的/ 路径/ 合并/ 以/ 降低/ 开销/ 以及/ 加速/ 收敛/ 等/ 优化/ 操作/ ./ 其中/ ,/ 图/ 3/ 中/ “/ / ”/ 表示/ 发送/ 更新/ 消息/ ,/ 下划线/ “/ —/ ”/ 表示/ 该/ 节点/ rib/ _/ in/ 发生变化/ ,/ 路由表/ 中/ 斜体/ 部分/ 表示/ 可以/ 合并/ 的/ 路径/ ,/ 设置/ 最佳/ 路径/ 标识符/ “/ Best/ ”/ 是/ 为了/ 与/ 当前/ 协议/ 兼容/ ,/ 并且/ 避免/ 由于/ 标识符/ 数量/ 过少/ 而/ 导致/ 部分/ 节点/ 使用/ 次优/ 路径/ (/ 如果/ 不/ 考虑/ “/ Best/ ”/ ,/ 更/ 容易/ 实现/ ,/ 但是/ 却/ 违反/ 了/ 标准/ BGP/ 语义/ )/ ./ 针对/ 不同/ 的/ 节点/ 对/ 〈/ v/ ,/ u/ 〉/ 为/ 每条/ 路径/ 分配/ 标识符/ ,/ v/ 的/ loc/ _/ rib/ 发生/ 改变/ 并/ 在/ 通过/ 导出/ 策略/ 后/ ,/ 需/ 将/ 对应/ 标识符/ (/ ann/ _/ pid/ )/ 的/ 路径/ 信息/ 发送到/ 邻居/ 节点/ u/ ./ 当/ v/ 的/ 邻居/ 节点/ 数/ 大于/ 可用/ 路径/ 标识符/ 数量/ ,/ 将/ 其余/ 的/ 邻居/ AS/ 路径/ 标识符/ 设置/ 为/ 隐藏/ 标识符/ (/ Hide/ _/ PID/ )/ ,/ 表示/ 该/ 路径/ 仅/ 可能/ 被/ 部分/ AS/ 选作/ 最佳/ 路/ Page6/ 径/ ,/ 但是/ 并/ 不会/ 传播/ 到/ 全网/ ,/ 从而/ 在/ 暴露/ 的/ 路径/ 数量/ 以及/ 开销/ 之间/ 进行/ 折衷/ ./ 如果/ 发起/ 前缀/ 通过/ 的/ AS/ 仅/ 有/ 单条/ 路径/ ,/ 如图/ 2/ (/ b/ )/ 所示/ ,/ 此时/ AS0/ 可以/ 将/ 路径/ 标识符/ 池/ [/ ψ/ 1/ ,/ ψ/ 2/ ,/ ψ/ 3/ ]/ 通告/ 给/ AS1/ ,/ 然后/ AS1/ 从/ 标识符/ 池中/ 取出/ 标识符/ 并/ 通告/ 给/ 不同/ 邻居/ ,/ 或者/ AS1/ 自主/ 对/ 不同/ 邻居/ 分配/ 路径/ 标识符/ ./ 通过/ 分配/ 路径/ 标识符/ 使得/ 路由器/ 能够/ 区分/ 、/ 利用/ 多路径/ ,/ v/ 存储/ 的/ rib/ _/ in/ (/ v/ ←/ u/ )/ 、/ rib/ _/ out/ (/ v/ →/ u/ )/ 、/ loc/ _/ rib/ (/ v/ )/ 以及/ 更新/ 报文/ update/ 数据结构/ 修改/ 为/ 映射/ 类型/ ,/ 比如/ 某个/ 完整/ 的/ 更新/ 报文/ 将/ 包括/ (/ pefix/ ,/ PID/ ,/ AS/ _/ Path/ )/ 三个/ 域/ ,/ 分别/ 表示/ 前缀/ 、/ 标识符/ 以及/ AS/ 路径/ ./ 其/ 通告/ 过程/ 如/ 过程/ 1/ 所示/ ,/ 其中/ 省略/ 了/ MRAI/ 设置/ 等/ 语句/ ./ 过程/ 1/ 中/ 第/ 1/ ~/ 3/ 步/ 表示/ 构造/ 原始/ 的/ 通告/ 路径/ ./ 第/ 4/ ~/ 10/ 步/ 表示/ 依据/ 路由/ 策略/ 从/ 路径/ 标识符/ 池中/ 选取/ 路径/ 标识符/ ,/ 并/ 构造/ 对应/ 标识符/ 的/ 更新/ 消息/ ./ 第/ 11/ ~/ 13/ 步则/ 表示/ 将/ 包含/ 标识符/ 的/ 更新/ 消息/ 发送到/ 邻居/ 节点/ 中/ ./ // / v/ 表示/ 发起/ 通告/ 的/ 路由器/ ,/ prefix/ 为/ 目标/ 前缀/ ,/ Peers/ (/ v/ )/ 表示/ 其/ 邻居/ 列表/ ,/ PID/ _/ Set/ 表示/ 可用/ 路径/ 标识符/ 集合/ ,/ update/ 为/ 路由/ 更新/ 消息/ / // 1/ ./ Porigin/ ·/ ·/ =/ path/ _/ init/ (/ prefix/ )/ // // 构造/ 通告/ 路径/ 2/ ./ v/ ./ origin/ _/ rib/ (/ prefix/ )/ ·/ ·/ =/ Porigin3/ ./ IFv/ ./ Path/ _/ Selection/ (/ prefix/ )/ =/ =/ True/ // // 检测/ loc/ _/ rib/ 是/ 4/ ./ FOREACHw/ ∈/ peers/ (/ v/ )/ DO5/ ./ IFv/ ./ export/ _/ policy/ (/ w/ ,/ prefix/ ,/ origin/ _/ path/ )/ =/ =/ True/ 过程/ 1/ ./ 路由器/ v/ 目标/ 前缀/ 通告/ 过程/ ./ 6/ ./ IFPID/ _/ Set/ =/ =/ / 7/ ./ ann/ _/ pid/ ·/ ·/ =/ Hide/ _/ PID8/ ./ ELSE9/ ./ ann/ _/ pid/ ·/ ·/ =/ PID/ _/ Set/ ./ pop/ (/ )/ // // 获得/ 路径/ 标识符/ 10/ ./ ENDIF11/ ./ update/ =/ v/ ./ loc/ _/ rib/ [/ ann/ _/ pid/ ]/ // // 根据/ 标识符/ 构造/ 更新/ 消息/ 12/ ./ v/ ./ export/ _/ action/ (/ ann/ _/ peer/ ,/ prefix/ ,/ update/ )/ 13/ ./ v/ ./ send/ _/ update/ (/ w/ ,/ ann/ _/ pid/ ,/ update/ )/ // // 发送/ 更新/ 报文/ 到/ w14/ ./ ENDIF15/ ./ ENDFOR16/ ./ ENDIF4/ ./ 2.2/ 路由/ 更新/ 节点/ 接收/ 到/ 路由/ 更新/ 消息/ 后/ ,/ 将/ 启动/ 路由/ 更新/ 发送/ 的/ 过程/ ,/ 其/ 服从/ SPVP/ 模型/ [/ 20/ ]/ ./ 如/ 过程/ 2/ 所示/ ,/ 其中/ 第/ 1/ ~/ 4/ 步/ 表示/ v/ 接收/ 到/ u/ 更新/ 报文/ 以后/ ,/ v/ 根据/ 导入/ 策略/ 对/ 更新/ 报文/ 进行/ 过滤/ ./ 第/ 5/ ~/ 9/ 步中/ ,/ v/ 从/ 更新/ 报文/ 中/ 提取/ 所有/ 路径/ 标识符/ 对应/ 的/ 路径/ 信息/ ,/ v/ 更新/ 所/ 保存/ 的/ rib/ _/ in/ (/ v/ ←/ u/ )/ ./ 第/ 10/ ~/ 13/ 步中/ v/ 调用/ 本地/ 路径/ 选择/ 过程/ ,/ 使用/ 秩/ 函数/ λ/ vbest/ 从/ 所有/ 可行/ 路径/ 中/ 选择/ 最佳/ 路径/ ,/ 然后/ 为/ 每个/ 路径/ 标识符/ 计算/ 新/ 的/ 最佳/ 路径/ ,/ 并/ 最终/ 下载/ 到/ FIB/ 中/ ./ 其中/ 在/ 过程/ 2/ 中/ ,/ v/ 中/ 具有/ 标识符/ ψ/ i/ 的/ 路径/ 集合/ 表示/ 为/ Pv/ β/ ψ/ i/ 表示/ 对应/ 标识符/ 的/ 最佳/ 路径/ ,/ 令/ λ/ v/ 标识符/ 的/ 秩/ 函数/ ,/ 要求/ 选择/ 最大/ 不/ 相交/ 多样性/ 路径/ ./ 过程/ 2/ ./ 路由器/ v/ 路径/ 选择/ 过程/ ./ // // 根据/ 导入/ 策略/ 对/ update/ 报文/ 进行/ 过滤/ 并/ 修改/ 路径/ 属性/ 1/ ./ IFloop/ _/ detection/ (/ update/ )/ =/ =/ True/ // // 环路/ 检测/ 2/ ./ RETURN3/ ./ v/ ./ import/ _/ policy/ (/ u/ ,/ update/ )/ 4/ ./ v/ ./ import/ _/ action/ (/ u/ ,/ update/ )/ 5/ ./ FOREACH/ (/ PID/ ,/ Path/ )/ ∈/ update/ [/ prefix/ ]/ DO/ // // 遍历/ update/ 中/ 所有/ 标识符/ 对应/ 的/ 路径/ 信息/ 6/ ./ IFPath/ =/ =/ / 7/ ./ Delv/ ./ peers/ [/ u/ ]/ ./ rib/ _/ in/ [/ prefix/ ]/ [/ PID/ ]/ 8/ ./ ELSE9/ ./ v/ ./ peers/ [/ u/ ]/ ./ rib/ _/ in/ [/ prefix/ ]/ [/ PID/ ]/ ·/ ·/ =/ Path/ // // v/ 更新/ 对应/ 的/ rib/ _/ in/ (/ v/ ←/ u/ )/ 10/ ./ old/ _/ rib/ =/ Copy/ (/ v/ ./ loc/ _/ rib/ [/ prefix/ ]/ )/ // // 复制/ 原有/ loc/ _/ rib11/ ./ β/ best/ ·/ ·/ =/ max/ (/ λ/ vbest/ (/ ∪/ Pv12/ ./ v/ ./ loc/ _/ rib/ [/ prefix/ ]/ [/ best/ ]/ ·/ ·/ =/ β/ best13/ ./ install/ _/ FIB/ (/ β/ best/ )/ 14/ ./ FOREACH/ ψ/ i/ ∈/ PID/ _/ SetDO15/ ./ β/ ψ/ i/ =/ ·/ ·/ =/ max/ (/ λ/ v16/ ./ v/ ./ loc/ _/ rib/ [/ prefix/ ]/ [/ ψ/ i/ ]/ ·/ ·/ =/ β/ ψ/ i17/ ./ install/ _/ FIB/ (/ β/ ψ/ i/ )/ 18/ ./ IFold/ _/ rib/ ≠/ v/ ./ loc/ _/ rib/ [/ prefix/ ]/ // // 如果/ loc/ _/ rib/ 改变/ ,/ 则/ 19/ ./ RETURNTrue/ ,/ THENsend/ _/ update/ (/ peers/ (/ v/ )/ )/ 20/ ./ ELSE21/ ./ RETURNFalse4/ ./ 3/ 多/ 转发/ 树下/ 的/ 加速/ 收敛/ 与/ 标准/ BGP/ 协议/ 构造/ 单个/ 以/ d/ 为根/ 的/ 转发/ 树/ 相比/ ,/ MFT2/ -/ BGP/ 在/ 构造/ 多/ 转发/ 树时/ ,/ 为了/ 传播/ 隐藏/ 路径/ 也/ 相应/ 增加/ 了/ 一定/ 的/ 开销/ ./ MFT2/ -/ BGP/ 则/ 将/ EPIC/ [/ 8/ ]/ 的/ 思想/ 扩展/ 到/ 多路径/ 场景/ 以/ 加速/ 协议/ 收敛/ (/ 简称/ MFT2/ -/ EPIC/ )/ ./ MFT2/ -/ EPIC/ 主要/ 针对/ 各/ 标识符/ 上/ 的/ 路径/ 之间/ 存在/ 的/ 依赖性/ ,/ 在/ 每条/ 标识符/ 路径/ 上/ 添加/ 不同/ 的/ 序列号/ (/ fesn/ )/ 进行/ 区别/ ,/ 即/ fesn/ =/ (/ 〈/ x/ ,/ y/ 〉/ :/ N/ )/ 表示/ 链路/ 两边/ 节点/ 有序/ 对/ 与/ 序列号/ 的/ 组合/ ./ 即/ 完整/ 的/ 更新/ 消息/ 包含/ [/ pefix/ ,/ PID/ ]/ +/ [/ AS/ _/ Path/ ]/ +/ {/ fesnList/ }/ ,/ fesnList/ 包含/ 对应/ AS/ _/ Path/ 中/ 的/ fesn/ 列表/ ./ 当/ 出现/ 链路/ 失效/ (/ 或/ 更改/ 策略/ )/ 撤销/ [/ pefix/ ,/ ψ/ ]/ 相关/ 路径/ 时/ ,/ u/ 发送/ 的/ 撤销/ 消息/ 中/ 包含/ fesnList1/ 信息/ ,/ 令/ fesnList1/ =/ [/ (/ 〈/ a1/ ,/ b1/ 〉/ ,/ n1/ )/ ,/ (/ 〈/ a2/ ,/ b2/ 〉/ ,/ n2/ )/ ,/ …/ ,/ (/ 〈/ ak/ ,/ bk/ 〉/ ,/ nk/ )/ ]/ ,/ v/ 接收/ 撤销/ 消息/ 后/ ,/ v/ 可/ Page7/ 利用/ 撤销/ 消息/ 中/ 的/ fesnList/ 信息/ 作废/ 其它/ 邻居/ 节点/ 通告/ 的/ 所有/ 标识符/ 上/ 的/ 非法/ 路径/ ,/ 设/ v/ 存储/ 的/ 某条/ 路径/ P/ 对应/ 的/ fesnList2/ =/ [/ 〈/ a1/ ,/ b1/ 〉/ ,/ n1/ )/ ,/ 〈/ a2/ ,/ b2/ 〉/ ,/ n2/ )/ ,/ …/ ,/ 〈/ al/ ,/ bl/ 〉/ ,/ nl/ )/ ]/ ,/ 且/ k/ / l/ ./ 如果/ 存在/ (/ ai/ =/ =/ ai/ )/ ∧/ (/ bi/ =/ =/ bi/ )/ ∧/ (/ ni/ =/ =/ ni/ )/ )/ ,/ / i/ =/ 1/ ,/ 2/ ,/ …/ ,/ k/ ,/ 即/ fesnList2/ 与/ 撤销/ 路径/ fesnList1/ 相关/ ,/ 此时/ 可以/ 快速/ 作废/ 非法/ 路径/ P/ ,/ 从而/ 加速/ 收敛/ 并/ 消除/ 收敛/ 过程/ 中/ 可能/ 的/ 环路/ ./ 4.4/ 瞬时/ 失效/ 抑制/ 在/ 不/ 影响/ 转发/ 连续/ 的/ 情况/ 下/ ,/ 可以/ 利用/ 多路径/ 压制/ 瞬时/ 失效/ 以/ 实现/ 故障/ 隔离/ 能力/ ,/ 避免/ 频繁/ 收敛/ 带来/ 的/ 路由/ 震荡/ ,/ 从而/ 降低/ 控制/ 平面/ 的/ 扰动/ ./ 基本/ 思想/ 是/ 当/ 最佳/ 路径/ 失效/ 后/ ,/ 如果/ 备份/ 路径/ 具有/ 不同/ 的/ 下/ 一/ 跳/ ,/ 则/ 并/ 不/ 发送/ 更新/ 消息/ ,/ 并且/ 设置/ 合理/ 定时器/ (/ 绝大多数/ BGP/ 故障/ 将会/ 在/ 10min/ 内/ 恢复/ [/ 24/ ]/ ,/ 可/ 据此/ 设置/ 默认/ 定时器/ )/ ./ 如果/ 定时器/ 超时/ 则/ 需要/ 发送/ 路由/ 更新/ 消息/ ,/ 触发/ 路由/ 重新/ 收敛/ ./ 比如/ u/ 检测/ 到/ 路径/ 标识符/ ψ/ 对应/ 的/ 路径/ 失效/ ,/ 如果/ u/ 仍然/ 具有/ 其它/ 可行/ 转发/ 树/ 对应/ 的/ 路径/ ,/ 在/ 不/ 影响/ 持续/ 转发/ 的/ 情况/ 下/ ,/ u/ 可/ 对/ 与/ ψ/ 相关/ 的/ 失效/ 消息/ 进行/ 抑制/ ,/ 将/ 该/ 策略/ 称为/ SUP/ (/ SuppressallUPdatemessage/ )/ ./ SUP/ 策略/ 将会/ 使得/ 部分/ 节点/ 在/ 压制/ 失效/ 后/ 可能/ 使用/ 非/ 最佳/ 路径/ ,/ 比如/ 图/ 1/ 中/ 链路/ AS0/ -/ AS3/ 失效/ 后/ ,/ 将/ 导致/ AS3/ 、/ AS4/ 、/ AS5/ 的/ 最佳/ 路径/ 发生变化/ ,/ 如果/ AS3/ 压制/ 失效/ 信息/ ,/ 在/ 消息/ 压制/ 期间/ ,/ 将会/ 使得/ 受到/ 失效/ 影响/ 的/ 节点/ AS3/ 、/ AS4/ 、/ AS5/ 到达/ 目标/ 的/ 跳数/ 增加/ ./ 为此/ ,/ 设置/ 新/ 的/ 路由/ 策略/ SNUM/ (/ SuppressNon/ -/ BestUpdateMessage/ )/ ,/ 即/ u/ 在/ 检测/ 到/ 失效/ 后/ ,/ 如果/ 其/ u/ 的/ 最佳/ 路径/ 改变/ ,/ u/ 在/ 利用/ 备份/ 路径/ 转发/ 的/ 同时/ 也/ 发送/ 更新/ 消息/ ,/ 如图/ 1/ 中/ AS0/ -/ AS3/ 失效/ 后/ ,/ AS3/ 将/ 发送/ 与/ ψ/ 3/ 相关/ 的/ 路由/ 更新/ 消息/ ,/ 但是/ 由于/ ψ/ 3/ 并/ 不/ 改变/ 图/ 1/ 中/ AS1/ 、/ AS2/ 、/ AS6/ 的/ 最佳/ 路径/ ,/ 因此/ ,/ AS5/ 可以/ 安全/ 压制/ 更新/ 路由/ 消息/ ,/ 不再/ 进一步/ 向/ AS6/ 发送/ 消息/ ,/ 并/ 避免/ 持续/ 使用/ 次优/ 路径/ ./ 4.5/ 报文/ 转发/ 过程/ 为了/ 保证/ 转发/ 一致性/ ,/ 需要/ 修改/ 报文/ 头/ 格式/ 并/ 增加/ 路径/ 标识符/ ψ/ ,/ 通常/ 可以/ 在/ IP/ 报文/ 头/ 中/ 添加/ 额外/ 的/ shim/ 报文/ 头/ [/ 14/ ]/ ,/ 或者/ 利用/ 现有/ IP/ 报文/ 头中/ TOS/ 或/ DSCP/ 域/ ,/ 通过/ 报文/ 头/ 中/ 标识符/ ψ/ 指示/ 报文/ 当前/ 所/ 采用/ 的/ 转发/ 树/ ./ 在/ 链路/ 失效/ 时/ ,/ 失效/ 检测/ 节点/ 具有/ 特殊/ 的/ 角色/ ,/ 失效节点/ 在/ 查找/ 备份/ 可用/ 转发/ 树/ 的/ 同时/ ,/ 还/ 需要/ 将/ 报文/ 头中/ 的/ 路径/ 标识符/ 修改/ 为/ 所/ 切换/ 的/ 转发/ 树/ 标识符/ ./ 在/ 单链/ 路/ 失效/ 时/ ,/ 由于/ 转发/ 树中/ 对应/ 的/ 所有/ 节点/ 转发/ 视图/ 具有/ 一致性/ ,/ 在/ 节点/ 间/ 无需/ 协调/ 的/ 情况/ 下/ ,/ 检测/ 失效/ 的/ 节点/ 仅/ 需要/ 发起/ 本地/ 重/ 路由/ 即可/ 保证/ 无环/ 转发/ ./ 当/ 出现/ 节点/ 失效/ 、/ 多/ 链路/ 失效/ 时/ ,/ 以及/ 采用/ 瞬时/ 失效/ 抑制/ ,/ 将会/ 造成/ 各个/ AS/ 节点/ 之间/ 转发/ 视图/ 不/ 一致/ ,/ 单/ 失效/ 下/ 的/ 转发/ 机制/ 并/ 不能/ 充分利用/ 已经/ 获得/ 的/ 冗余/ 路径/ ,/ 而且/ 还/ 可能/ 出现/ 转发/ 环路/ ,/ 因此/ 还/ 需要/ 信令/ 机制/ 以/ 避免/ 环路/ ./ 如图/ 1/ 中/ ,/ 如果/ AS2/ -/ AS0/ 和/ AS1/ -/ AS0/ 同时/ 断开/ ,/ 如果/ AS2/ 检测/ 到/ 失效/ 后/ 采用/ 图/ 3/ 中/ 标识符/ 为/ ψ/ 1/ 的/ 路径/ ,/ 修改/ 报文/ 头/ 标识符/ 为/ ψ/ 1/ ,/ 并/ 将/ 报文/ 转发/ 到/ AS2/ ;/ 同时/ ,/ 由于/ AS2/ 发现/ AS2/ -/ AS0/ 断开/ ,/ 由于/ AS1/ 与/ AS2/ 之间/ 无/ 协调/ ,/ 如果/ AS1/ 选择/ ψ/ 2/ 路径/ ,/ 将/ 导致/ AS1/ 和/ AS2/ 之间/ 形成/ 环路/ ,/ 在/ 这种/ 多/ 失效/ 场景/ 下/ 必须/ 利用/ 辅助/ 信息/ 才能/ 无环/ 转发/ ./ 为了/ 充分利用/ 已/ 获得/ 的/ 多/ 转发/ 树/ ,/ MFT2/ -/ BGP/ 在/ 报文/ 中/ 添加/ “/ 报文/ 经历/ 信息/ ”/ Used/ _/ PID/ ,/ 表示/ 报文/ 已经/ 使用/ 过/ 的/ 转发/ 树/ ./ 如图/ 2/ (/ b/ )/ 中/ 所示/ ,/ 节点/ 在/ 接收/ 到/ 报文/ 后/ ,/ 提取/ 报文/ 头中/ Used/ _/ PID/ 信息/ 以/ 避免/ 重复/ 选择/ 同一/ 转发/ 树/ ,/ 该/ 信息/ 存储/ 实际/ 不/ 超过/ 2bits/ ./ 具体/ 报文/ 转发/ 如/ 过程/ 3/ 所示/ ,/ 其中/ Best/ _/ Tree/ 表示/ 最佳/ 转发/ 树/ 对应/ 的/ 路径/ ,/ 其下/ 一/ 跳/ 表示/ 为/ best/ _/ nhop/ (/ d/ ,/ Best/ _/ Tree/ )/ ,/ 而/ 根据/ 路径/ 标识符/ ψ/ 形成/ 的/ 转发/ 树为/ ψ/ _/ Tree/ ,/ 其下/ 一/ 跳/ 表示/ 为/ best/ _/ nhop/ (/ d/ ,/ ψ/ _/ Tree/ )/ ,/ forward/ _/ packet/ (/ nhop/ ,/ tree/ )/ 表示/ 根据/ 对应/ 转发/ 树/ 转发/ 报文/ ,/ Change/ _/ header/ (/ tree/ ,/ transient/ )/ 表示/ 修改/ 报文/ 头中/ 的/ 路径/ 标识符/ 为/ 特定/ 的/ 转发/ 树/ ,/ 并且/ 设置/ 报文/ 进入/ 失效/ 转发/ 模式/ ./ 过程/ 3/ ./ 报文/ 转发/ 过程/ ./ 1/ ./ nhop/ ·/ ·/ =/ Best/ _/ nhop/ (/ d/ ,/ packet/ ./ current/ _/ PID/ )/ // // 按/ 指定/ 标/ 2/ ./ IFd/ ≠/ nhop3/ ./ IFv/ ./ get/ _/ link/ (/ nhop/ )/ =/ =/ UP4/ ./ forward/ _/ packet/ (/ nhop/ ,/ packet/ ./ current/ _/ PID/ )/ 5/ ./ ELSE6/ ./ FOREACH/ (/ PID/ ,/ AS/ _/ Path/ )/ ∈/ v/ ./ loc/ _/ rib/ [/ prefix/ ]/ DO7/ ./ IFPIDnotinpacket/ ./ Used/ _/ PIDandPID/ ≠/ Best/ _/ Tree8/ ./ IFAS/ _/ Path/ ./ valid/ =/ =/ False/ // // 如果/ PID/ 对应/ 的/ AS/ _/ Path9/ ./ packet/ ./ Add/ _/ Used/ _/ PID/ (/ PID/ )/ 10/ ./ CONTINUE11/ ./ ENDIF12/ ./ (/ newhop/ ,/ new/ _/ tree/ )/ ·/ ·/ =/ find/ _/ Best/ _/ PID/ _/ nhop/ (/ d/ ,/ PID/ )/ 13/ ./ ENDIF14/ ./ IFnewhop/ ≠/ / andv/ ./ get/ _/ link/ (/ newhop/ )/ ≠/ Down15/ ./ Change/ _/ header/ (/ new/ _/ tree/ ,/ transient/ )/ Page816/ ./ packet/ ./ Add/ _/ Used/ _/ PID/ (/ new/ _/ tree/ )/ 17/ ./ forward/ _/ packet/ (/ newhop/ ,/ new/ _/ tree/ )/ 18/ ./ ELSE19/ ./ IFv/ ./ loc/ _/ rib/ [/ prefix/ ]/ [/ Best/ _/ Tree/ ]/ ./ valid/ =/ =/ True/ // // 在/ 无/ 对应/ 路径/ 标识符/ 时/ ,/ 如果/ Best/ _/ Tree20/ ./ nhop/ ·/ ·/ =/ Best/ _/ nhop/ (/ d/ ,/ packet/ ./ current/ _/ PID/ )/ 21/ ./ forward/ _/ packet/ (/ nhop/ ,/ packet/ ./ current/ _/ PID/ )/ 22/ ./ ELSE23/ ./ Droppacket24/ ./ ENDIF25/ ./ ELSE26/ ./ forward/ _/ success/ (/ )/ 27/ ./ ENDIF/ 过程/ 3/ 中/ 的/ 第/ 1/ ~/ 4/ 步/ ,/ 报文/ 依据/ 对应/ 标识符/ 转发/ ./ 第/ 6/ ~/ 12/ 步/ 在/ 未/ 使用/ 过/ 的/ 转发/ 树中/ 选择/ 备份/ 路径/ (/ 瞬时/ 失效/ 中/ 优先选择/ 非/ Best/ _/ Tree/ 以/ 降低/ 协议/ 动态性/ 的/ 影响/ )/ ,/ 需要/ 说明/ 的/ 是/ ,/ 当/ 节点/ 具有/ 多个/ 备份/ 转发/ 树时/ ,/ 节点/ 可以/ 根据/ 策略/ 选择/ 最短/ 路径/ 树/ STF/ (/ 或者/ 固定/ 优先选择/ 某个/ 特定/ 标识/ 的/ 转发/ 树/ SPT/ [/ 16/ ]/ ,/ 并且/ 将/ 已/ 失效/ 转发/ 树/ 标识/ 加入/ 报文/ 中/ 的/ Used/ _/ PID/ 域/ 中/ )/ ./ 第/ 14/ ~/ 17/ 步中/ ,/ 节点/ 将/ 根据/ 修改/ 后/ 的/ 转发/ 树/ 标识/ 进行/ 转发/ ./ 第/ 19/ ~/ 21/ 步中/ ,/ 当/ 节点/ 在/ 无/ 可用/ 转发/ 树时/ ,/ 则/ 尝试/ 使用/ Best/ _/ Tree/ 转发/ ./ 该/ 转发/ 过程/ 可以/ 有效/ 解决/ 多/ 链路/ 失效/ 下/ 的/ 转发/ 环路/ ,/ 比如/ 在/ 图/ 1/ 中/ ,/ 当/ 节点/ 失效/ 引起/ AS2/ -/ AS0/ 以及/ AS1/ -/ AS0/ 断开/ 后/ ,/ 报文/ 到达/ AS2/ 后/ ,/ 其/ Best/ 、/ ψ/ 2/ 皆/ 失效/ ,/ 如果/ AS2/ 选择/ 了/ ψ/ 1/ 将/ 报文/ 转发/ 到/ AS1/ ,/ AS1/ 将/ 通过/ 报文/ 中/ Used/ _/ PID/ 以及/ 当前/ 链路/ 状况/ ,/ 仅能/ 选择/ 标识符/ ψ/ 3/ ,/ 最后/ 通过/ ψ/ 3/ 成功/ 转发/ 报文/ ./ 当/ 路径/ 标识符/ 数量/ 为/ k/ 时/ ,/ 为了/ 表示/ 报文/ 头/ 的/ 状态/ ,/ 其/ 报文/ 头/ 开销/ 的/ 最大/ 长度/ 约/ 为/ 1/ +/ 2lg/ (/ k/ )/ bits/ ./ 5/ 协议/ 属性/ 分析/ 5.1/ 协议/ 收敛/ 属性/ 定理/ 1/ ./ 对于/ 给定/ 的/ SPVP/ 实例/ Z/ ,/ 如果/ 它/ 不/ 含/ DisputeWhee/ [/ 20/ ]/ ,/ 那么/ MFT2/ -/ BGP/ 最终/ 收敛/ ;/ 且/ 在/ 路由/ 收敛/ 期间/ 不会/ 出现/ 瞬时/ 环路/ ./ 证明/ ./ DisputeWheel/ [/ 20/ ]/ 的/ 定义/ 略/ ,/ 本文/ 将/ SPVP/ 扩展/ 到/ 多路径/ 路由/ ./ 与/ 标准/ BGP/ 不同/ ,/ v/ 具有/ 多条/ 到达/ 目标/ AS0/ 的/ 路径/ ,/ v/ 采用/ 路径/ 标识符/ ψ/ 进行/ 区分/ ,/ 路由/ 更新/ 消息/ 中/ 包含/ ψ/ 以及/ AS/ _/ Path/ 路径/ 信息/ ./ v/ 的/ 最佳/ 路径/ 标识符/ β/ best/ 将/ 从/ v/ 的/ 可行/ 路径/ 集合/ Pv/ ,/ 即/ 从/ rib/ _/ in/ (/ v/ ←/ peers/ (/ v/ )/ )/ 中/ 选择/ ,/ 因此/ 在/ 同样/ 的/ 拓扑/ 、/ 策略/ 下/ ,/ 如果/ SPVP/ 在/ 无/ DisputeWheel/ 的/ 情况/ 下/ 收敛/ ,/ 那么/ MFT2/ -/ BGP/ 中/ 最佳/ 路径/ β/ best/ 上/ 也/ 一定/ 收敛/ ./ 其次/ ,/ 对于/ 路径/ 标识符/ ψ/ i/ ,/ v/ 在/ 路由/ 决策/ 过程/ 中/ 计算/ ψ/ i/ (/ 除/ 最佳/ 路径/ β/ best/ )/ 路径/ 时/ 与/ ψ/ j/ (/ i/ ≠/ j/ )/ 的/ 路径/ 隔离/ ,/ 即/ 在/ ψ/ i/ 上/ 其/ 可行/ 路径/ 集合/ 即仅/ 在/ G/ ψ/ i/ / G/ 中/ 选择/ 路径/ ,/ 显然/ ,/ 如果/ SPVP/ 在/ 拓扑/ G/ 中/ 无/ DisputeWheel/ ,/ G/ ψ/ i/ 对/ G/ 删除/ 了/ 部分/ 边/ ,/ G/ ψ/ i/ 也/ 不会/ 含有/ DisputeWheel/ ,/ 那么/ MFT2/ -/ BGP/ 中/ 标识符/ 为/ ψ/ i/ 的/ 路径/ β/ ψ/ i/ 在/ G/ ψ/ i/ 上/ 也/ 一定/ 收敛/ ./ 5.2/ 报文/ 转发/ 属性/ 引理/ 1/ ./ 对于/ 任意/ 节点/ u/ ,/ 如果/ 在/ 链路/ e/ 失效/ 前/ ,/ 其/ 最佳/ 路径/ 上/ 包含/ e/ ,/ 在/ BGP/ 协议/ 中/ 最终/ 收敛/ 能够/ 得到/ 不含/ e/ 的/ 路径/ ,/ 那么/ MFT2/ -/ BGP/ 保证/ u/ 存在/ 某条/ 标识符/ ψ/ 的/ 路径/ 不/ 通过/ e/ ./ 证明/ ./ 首先/ ,/ 显然/ 当/ MFT2/ -/ BGP/ 使用/ 充分/ 数量/ 的/ 路径/ 标识符/ 时/ ,/ 总能/ 获得/ 底层/ 拓扑/ 中/ 服从/ 策略/ 多样性/ 路径/ ,/ 并/ 形成/ 多/ 转发/ 树/ ./ 设/ 最佳/ 转发/ 树/ (/ Best/ _/ Tree/ )/ 中/ 失效/ 链路/ e/ 的/ 失效/ 根/ 节点/ 为/ q/ ,/ 设/ e/ 失效/ 之前/ ,/ π/ Best/ (/ u/ ,/ d/ )/ =/ Pbest/ =/ (/ u/ ,/ v1/ ,/ v2/ ,/ …/ ,/ vn/ )/ ·/ π/ (/ q/ ,/ d/ )/ ,/ 且/ π/ (/ q/ ,/ d/ )/ =/ (/ q/ ,/ w1/ ,/ w2/ ,/ …/ ,/ wm/ ,/ d/ )/ ;/ 在/ e/ 失效/ 之后/ 如果/ BGP/ 协议/ 收敛/ 能够/ 使/ u/ 获得/ 到达/ d/ 的/ 路径/ 为/ Pbackup/ =/ (/ u/ ,/ z1/ ,/ z2/ ,/ …/ ,/ zt/ ,/ d/ )/ ,/ 即/ u/ 在/ 失效/ 前/ 、/ 后/ 的/ 最后/ 一跳/ 分别/ 为/ wm/ 和/ zt/ ./ 下面/ 证明/ MFT2/ -/ BGP/ 能够/ 获得/ 多样性/ 路径/ ./ (/ 1/ )/ 如果/ wm/ ≠/ zt/ ,/ 根据/ 前缀/ 通告/ 过程/ ,/ AS0/ 发起/ 前缀/ 通告/ 时/ 将/ 会/ 针对/ 每个/ 邻居/ 节点/ wm/ 、/ zt/ 分配/ 不同/ 的/ 路径/ 标识符/ ψ/ i/ 、/ ψ/ j/ (/ i/ ≠/ j/ )/ 进行/ 区分/ ;/ 节点/ zt/ 到达/ d/ 的/ 路径/ 必/ 不/ 包含/ 失效/ 链路/ e/ ./ 因此/ ,/ zt/ 需要/ 将/ ψ/ j/ 的/ 路径/ 通告/ 给/ zt/ -/ 1/ ,/ 依次/ 类推/ ,/ 可知/ u/ 将会/ 存在/ ψ/ i/ 、/ ψ/ j/ 上/ 的/ 多样性/ 路径/ ./ 同样/ ,/ 通过/ 归纳法/ 证明/ ,/ u/ 将/ ψ/ j/ 路径/ 通告/ 给/ v1/ ,/ 任意/ vi/ (/ n/ >/ i/ / 1/ )/ 中/ 存在/ 某条/ 标识符/ ψ/ j/ 的/ 路径/ 不/ 通过/ e/ ,/ 且/ 最终/ w/ 也/ 将/ 会/ 获得/ 不/ 包含/ e/ 的/ 路径/ ./ (/ 2/ )/ 如果/ wm/ =/ zt/ ,/ 说明/ Pbest/ 与/ Pbackup/ 路径/ 重叠/ ,/ AS0/ 仅/ 有/ 一个/ 邻居/ 节点/ ./ 如果/ wm/ 为/ 每个/ 邻居/ 节点/ 分配/ 标识符/ ,/ 设/ 失效/ 前/ Pbest/ 路径/ 的/ 标识符/ 为/ ψ/ i/ ,/ zt/ -/ 1/ 到达/ d/ 的/ 路径/ 不/ 包含/ e/ ,/ 其/ 标识符/ 为/ ψ/ j/ ./ 依次/ 类推/ ,/ 可得/ u/ 将会/ 存在/ 不/ 经过/ e/ 的/ 标识符/ 为/ ψ/ j/ 的/ 路径/ ./ 对于/ vi/ (/ n/ >/ i/ / 1/ )/ ,/ 其/ 证明/ 与/ 上面/ 相同/ ./ 证毕/ ./ 引理/ 2/ ./ 在/ 无/ 失效/ 场景/ 下/ ,/ 报文/ 总在/ 最佳/ 路径/ 上/ 转发/ ;/ 当/ 出现/ 单/ 或/ 多/ 链路/ 失效/ 后/ 引起/ 路由/ 收敛/ 期间/ ,/ 如果/ 协议/ 获得/ 的/ 多样性/ 路径/ 中/ 存在/ 可行/ 的/ 转发/ 路径/ ,/ 那么/ 报文/ 不会/ 被/ 丢弃/ ,/ 且/ 不会/ 陷入/ 环路/ ./ 证明/ ./ 分/ 3/ 种/ 情况/ 证明/ ,/ 即/ 无/ 失效/ 、/ 单链/ 路/ 失效/ 、/ 多/ 链路/ 失效/ 场景/ ./ 显然/ ,/ 在/ 无/ 失效/ 场景/ 下/ MFT2/ -/ BGP/ 处于/ 收敛/ 状态/ ,/ v/ 的/ 最佳/ 路径/ 是/ 对/ 所有/ 可/ 行路/ Page9/ 径/ 集合/ Pv/ 计算/ 得到/ 一致性/ 路径/ ,/ 报文/ 在/ 最佳/ 路径/ 上/ 安全/ 转发/ ./ 其次/ ,/ 当/ 出现/ 单链/ 路/ e/ =/ (/ u/ ,/ v1/ )/ 失效/ 以后/ ,/ 设/ 失效/ 检测/ 节点/ u/ 的/ 最佳/ 路径/ 为/ π/ Best/ (/ u/ ,/ d/ )/ =/ (/ u/ ,/ v1/ ,/ v2/ ,/ …/ ,/ vn/ ,/ d/ )/ ,/ 当/ e/ 失效/ 后/ ,/ u/ 切换/ 到/ 路径/ π/ ψ/ i/ (/ u/ ,/ d/ )/ =/ (/ u/ ,/ w1/ ,/ w2/ ,/ …/ ,/ wk/ ,/ d/ )/ ,/ 如果/ Disjoint/ (/ π/ Best/ (/ u/ ,/ d/ )/ ,/ π/ ψ/ i/ (/ u/ ,/ d/ )/ )/ =/ 1/ ,/ 报文/ 将/ 在/ 转发/ 树/ ψ/ i/ _/ Tree/ 中无环/ 转发/ ./ 如果/ 0/ </ Disjoint/ (/ π/ Best/ (/ u/ ,/ d/ )/ ,/ π/ ψ/ i/ (/ u/ ,/ d/ )/ )/ </ 1/ ,/ 即/ π/ Best/ (/ u/ ,/ d/ )/ 与/ π/ ψ/ i/ (/ u/ ,/ d/ )/ 部分/ 重叠/ ,/ 由/ MFT2/ -/ BGP/ 报文/ 转发/ 算法/ 可知/ 必有/ v1/ ≠/ w1/ ,/ 设/ π/ Best/ (/ u/ ,/ d/ )/ 与/ π/ ψ/ i/ (/ u/ ,/ d/ )/ 在/ 某点/ vi/ =/ wj/ 相交/ ,/ 其中/ vi/ ∈/ π/ Best/ (/ u/ ,/ d/ )/ ,/ wj/ ∈/ π/ ψ/ i/ (/ u/ ,/ d/ )/ ,/ 1/ </ i/ / n/ ,/ 1/ </ j/ / k/ ./ 如果/ π/ Best/ (/ vi/ ,/ d/ )/ =/ π/ ψ/ i/ (/ wj/ ,/ d/ )/ ,/ 即/ vi/ 中/ 标识符/ 为/ Best/ 和/ ψ/ i/ 具有/ 同样/ 的/ 路径/ ,/ 由于/ 其/ 任意/ 转发/ 树/ ψ/ 上/ 转发/ 路径/ 具有/ 一致性/ ,/ 即/ 报文/ 不会/ 回退/ 或/ 环路/ ;/ 而/ 当/ π/ Best/ (/ vi/ ,/ d/ )/ ≠/ π/ ψ/ i/ (/ wj/ ,/ d/ )/ ,/ 即/ vi/ 中/ 标识符/ 为/ Best/ 和/ ψ/ i/ 具有/ 不同/ 的/ 路径/ ,/ 报文/ p/ 在/ ψ/ i/ 可无环/ 转发/ ./ 出现/ 多/ 链路/ 失效/ 时/ ,/ 根据/ 报文/ 转发/ 过程/ ,/ 具有/ 如下/ 属性/ :/ (/ 1/ )/ 报文/ p/ 不会/ 2/ 次/ 遇到/ 同一个/ 失效/ 链路/ ,/ 该/ 属性/ 主要/ 是/ 由于/ 检测/ 失效/ 的/ 节点/ 会/ 将/ 其/ 失效/ 转发/ 树/ 的/ 标识符/ ψ/ i/ 加入/ 到/ 报文/ 头/ 中/ ,/ 下行/ 节点/ 选择/ 转发/ 树时/ 将/ 避免/ ψ/ i/ ,/ 这/ 使得/ p/ 不会/ 两次/ 遇到/ 同一个/ 失效/ 链路/ ;/ (/ 2/ )/ 当/ 出现/ 第/ k/ (/ k/ / 2/ )/ 个/ 链路/ 失效/ 后/ ,/ 当前/ 节点/ u/ 将/ 根据/ ψ/ k/ (/ ψ/ k/ ≠/ ψ/ i/ )/ 转发/ 报文/ p/ ,/ 如果/ 在/ ψ/ k/ 不能/ 成功/ 转发/ ,/ 说明/ 出现/ 了/ 新/ 的/ 失效/ 链路/ ,/ u/ 将/ 避免/ 使用/ p/ ./ Used/ _/ PID/ ,/ 并/ 选择/ 新/ 路径/ ,/ 此时/ p/ 要么/ 被/ 成功/ 转发/ ,/ 或/ 由于/ 无/ 可行/ 路径/ 而/ 丢弃/ ./ MFT2/ -/ BGP/ 获得/ 多/ 转发/ 树/ 的/ 同时/ 也/ 一定/ 程度/ 上/ 增加/ 了/ 计算/ 、/ 存储/ 开销/ ,/ 在/ 不/ 采用/ 路径/ 合并/ 的/ 时候/ ,/ 其/ 最大/ 存储/ 开销/ 线性/ 增加/ ./ 根据/ 文献/ [/ 25/ ]/ 的/ 结论/ ,/ 硬件/ 的/ 发展/ 仍然/ 满足/ Moore/ ’/ s/ 定律/ ,/ 其/ 多路径/ 计算/ 、/ 存储/ 带来/ 的/ 开销/ 是/ 在/ 可/ 承受/ 范围/ 之内/ ,/ 且/ 如果/ 将/ 同一/ 前缀/ 的/ 多/ 标识符/ 路径/ 进行/ 合并/ 到/ 单个/ 转/ 发表/ ,/ 其/ 存储/ 开销/ 将会/ 进一步/ 减低/ ./ 由于/ 互联网/ AS/ 拓扑/ 具有/ 幂率/ 特性/ ,/ 其/ 平均/ AS/ 跳数/ 为/ 4/ ,/ 可证/ MFT2/ -/ BGP/ 增加/ 转发/ 路径/ 的/ 长度/ 非常/ 小/ ,/ 在/ 本文/ 后/ 实验/ 中/ 也/ 证明/ 了/ 这/ 一点/ ./ 6/ 性能/ 评价/ 为/ 验证/ MFT2/ -/ BGP/ 性能/ ,/ 本文/ 对/ 轻量级/ Sim/ -/ BGP/ ①/ 进行/ 扩展/ ,/ 实现/ 了/ 所有/ BGP/ 相关/ 的/ 重要/ 特征/ ./ 根据/ CAIDA/ ②/ 的/ 数据分析/ 可知/ 当前/ AS/ 数量/ 为/ 31212/ ,/ 链路/ 数量/ 为/ 60052/ ,/ 多/ 宿主/ AS/ 占/ 总数/ 的/ 53.4/ %/ ,/ 由于/ 其/ 规模/ 过大/ ,/ 采用/ Dimitropoulos/ [/ 26/ ]/ 根据/ CAIDA/ 数据/ 标注/ 推断/ 的/ AS/ 级/ Internet/ -/ like/ 拓扑图/ ,/ 该/ 拓扑/ 具有/ AS/ 之间/ 的/ 商业/ 关系/ 以及/ Internet/ 的/ 复杂/ 结构特征/ ,/ Splicing/ [/ 11/ ]/ 也/ 使用/ 了/ 该/ 拓扑/ ./ 本文/ 采用/ 的/ 800/ 节点/ 的/ 拓扑/ 如图/ 4/ 所示/ ,/ 链路/ 数量/ 为/ 1582/ ,/ 协议/ 模拟/ 参数/ 如表/ 1/ 所示/ ./ 实验/ 对/ MFT2/ -/ BGP/ 在/ 各种/ 场景/ 下/ 的/ 收敛/ 时间/ 、/ 消息/ 数/ 进行/ 比较/ ;/ 为/ 验证/ MFT2/ -/ BGP/ 的/ 无/ 中断/ 转发/ 的/ 性能/ ,/ 还/ 从/ 平均/ AS/ 瞬时/ 失效率/ 、/ 平均/ 转发/ 中断/ 时间/ 、/ 路径/ 伸展/ 度/ 等/ 方面/ 进行/ 比较/ ./ 图/ 4800AS/ 节点/ 拓扑/ 6.1/ 多/ 转发/ 树/ 构造/ 开销/ 该/ 场景/ 中/ 主要/ 针对/ 多/ 宿主/ StubAS/ 发起/ 前缀/ 通告/ ,/ 测试/ 其/ 收敛/ 时间/ 以及/ 消息/ 数量/ ./ 在/ BGP/ 实现/ 中/ MRAI/ 通常/ 设置/ 为/ Peer/ -/ Based/ ./ 由于/ 源/ 节点/ 在/ 发起/ 通告/ 时/ ,/ 所有/ 节点/ 并/ 没有/ 对/ 其/ 邻居/ 设置/ MRAI/ ,/ 为/ 保证/ 模拟/ 的/ 真实性/ ,/ 降低/ Peer/ -/ Based/ 的/ 影响/ ,/ 因此/ 设置/ 发送/ 消息/ 等待时间/ 为/ [/ 0/ ,/ MRAI/ ]/ 随机/ 分布/ ,/ 以此/ 作为/ 背景/ MRAI/ ./ (/ 1/ )/ 当/ 使用/ 路径/ 标识符/ 数量/ 为/ 2/ 时/ ,/ 随机/ 选择/ 150/ 个/ 多/ 宿主/ (/ Provider/ / 2/ )/ 的/ AS/ 共/ 测试/ 648/ 次/ ./ 收敛/ 时间/ 、/ 消息/ 数量/ 累积/ 分布/ 概率/ 如图/ 5/ (/ a/ )/ 、/ 图/ 5/ (/ b/ )/ 所示/ ,/ 与/ BGP/ 相比/ ,/ 收敛/ 时间/ 增加/ 仅约/ 4/ %/ ,/ 总体/ 消息/ 数量/ 增加/ 约/ 20/ %/ ,/ 以/ 合理/ 的/ 开销/ 获得/ 了/ 多样性/ 路径/ ./ MFT2/ -/ BGP/ 在/ 前缀/ 通告/ 时/ 消息/ 数量/ 有所增加/ ,/ 这是/ 由于/ 为了/ 将/ 隐藏/ 合法/ 路径/ 暴露/ 给/ 其它/ AS/ ,/ 而/ 收敛/ 时间/ 与/ BGP/ 相比/ 几乎/ 无/ 增加/ ,/ 这是/ 由于/ 不同/ 标识符/ 上/ 的/ 收敛/ 具有/ 相对/ 隔离/ 性质/ ,/ 而/ BGP/ 收敛/ 时间/ 主要/ 与/ 网络/ 直径/ 、/ MRAI/ 设置/ 等/ 因素/ 相关/ [/ 27/ ]/ ,/ 理论/ 上/ 收敛/ 时间/ 为/ max/ {/ ψ/ 1/ _/ ann/ ,/ ψ/ 2/ _/ ann/ ,/ Best/ }/ ,/ 其中/ ψ/ i/ _/ ann/ 为/ 对应/ 标识符/ 上/ 的/ 收敛/ 时间/ ./ 此外/ MFT2/ -/ BGP/ 中/ MRAI/ 采用/ Peer/ -/ Based/ 设置/ ,/ 由于/ ψ/ 1/ 、/ ψ/ 2/ 会/ 相互影响/ ,/ 也/ 一定/ 程度/ 上/ 会/ 限制/ 更新/ 消息/ 传播速度/ ,/ 稍微/ 增加/ 收敛/ 时间/ ./ ①/ ②/ Page10/ (/ 2/ )/ 当/ 使用/ 路径/ 标识符/ 数量/ 为/ 3/ 时/ ,/ 随机/ 选择/ 71/ 个/ 多/ 宿主/ (/ Provider/ / 3/ )/ 测试/ 214/ 次/ ./ 收敛/ 时间/ 、/ 消息/ 数量/ 累积/ 分布/ 概率/ 如图/ 6/ (/ a/ )/ 、/ 图/ 6/ (/ b/ )/ 所示/ ,/ 其/ 收敛/ 时间/ 仅/ 增加/ 10/ %/ ,/ 总体/ 消息/ 数量/ 增加/ 40/ %/ ,/ 但/ 考虑/ 到/ 每个/ 节点/ 获得/ 的/ 路径/ 数量/ 将会/ 达到/ 3/ ,/ 此/ 开销/ 仍然/ 在/ 合理/ 范围/ 内/ ./ MFT2/ -/ BGP/ 在/ 初始化/ 时/ ,/ 带来/ 了/ 一定/ 的/ 消息/ 开销/ ,/ 但/ 这种/ 开销/ 也/ 仅/ 出现/ 在/ 多/ 转发/ 树/ 的/ 初始/ 构造/ 中/ ./ 6.2/ 单/ 失效/ 下/ 协议/ 性能/ 针对/ 单链/ 路/ 失效/ ,/ 测试/ 了/ 边缘/ 链路/ 、/ 核心/ 链路/ 失效/ 两种/ 场景/ ./ (/ 1/ )/ 在/ 边缘/ 链路/ 失效/ 中/ ,/ 随机/ 选择/ 300/ 个/ 多/ 宿主/ AS/ (/ Provider/ / 2/ )/ ,/ 断开/ 多/ 宿主/ AS/ 与/ 其中/ 的/ 一个/ Provider/ 的/ 链路/ (/ 这/ 是/ 最/ 极端/ 情况/ )/ ,/ 共/ 进行/ 了/ 650/ 次/ 实验/ ,/ 分别/ 测试/ 了/ BGP/ 、/ GhostFlushing/ [/ 7/ ]/ 、/ EPIC/ [/ 8/ ]/ 、/ MFT2/ -/ BGP/ 以及/ 加速/ 收敛/ 的/ MFT2/ -/ EPIC/ ./ 从图/ 7/ (/ a/ )/ 中/ CDF/ 图中/ 可以/ 看出/ ,/ GhostFlush/ -/ ing/ 、/ EPIC/ 协议/ 在/ Internet/ -/ like/ 拓扑/ 中/ Fail/ -/ over/ 收敛/ 时间/ 与/ BGP/ 相比/ 改善/ 效果/ 并/ 不/ 明显/ [/ 27/ ]/ ./ MFT2/ -/ BGP/ 协议/ 收敛/ 时间/ 与/ EPIC/ 、/ BGP/ 相比/ 有所/ 降低/ ,/ 总体/ 上/ MFT2/ -/ BGP/ 比/ BGP/ 收敛/ 时间/ 降低/ 了/ 8/ %/ 以上/ ./ 尤其/ 值得注意/ 的/ 是/ ,/ MFT2/ -/ EPIC/ 收敛/ 时间/ 均/ 优于/ 其它/ 所有/ 协议/ 的/ 收敛/ 时间/ ,/ 与/ BGP/ 相比/ 降低/ 了/ 30/ %/ 以上/ ,/ 且/ 在/ 绝大多数/ 实验/ 中/ ,/ 收敛/ 时间/ 都/ 降低/ 50/ %/ 以上/ ./ 发生/ 这种/ 现象/ 的/ 原因/ 主要/ 是/ BGP/ 、/ GhostFlushing/ 、/ EPIC/ 等/ 协议/ 在/ Fail/ -/ over/ 场景/ 中/ ,/ 要/ 传播/ 撤销/ 消息/ 以及/ 通告/ 新/ 的/ 路径/ ,/ 从而/ 增加/ 了/ 收敛/ 时间/ ,/ 收敛/ 时间/ 主要/ 受到/ 失效/ 位置/ 与/ 失效/ 后/ 的/ 路径/ 到达/ 目标/ 的/ 距离/ 两个/ 因素/ 的/ 影响/ [/ 27/ ]/ ;/ 而/ MFT2/ -/ BGP/ 在/ 前/ Page11/ 缀/ 通告/ 的/ 时候/ 已经/ 比较/ 充分/ 地/ 获得/ 了/ 隐藏/ 路径/ ,/ 当/ 出现/ 链路/ 失效/ 时/ ,/ MFT2/ -/ BGP/ 、/ MFT2/ -/ EPIC/ 主要/ 传播/ 撤销/ 消息/ ,/ 且/ MFT2/ -/ EPIC/ 降低/ 了/ 路径/ 探索/ ,/ 因此/ 收敛/ 时间/ 大为/ 改善/ ./ 此外/ 在/ 实验/ 中/ 也/ 发现/ ,/ 在/ 设置/ WRATE/ 时/ ,/ MFT2/ -/ BGP/ 、/ MFT2/ -/ EPIC/ 收敛/ 时间/ 与/ BGP/ 相比/ 将会/ 进一步/ 降低/ ,/ 其/ 改善/ 效果/ 更加/ 明显/ ./ 从图/ 7/ (/ b/ )/ 中/ CDF/ 图中/ 可以/ 看出/ ,/ GhostFlush/ -/ ing/ 以/ 增加/ 消息/ 数量/ 为/ 代价/ 降低/ 了/ 收敛/ 时间/ ./ MFT2/ -/ BGP/ 和/ MFT2/ -/ EPIC/ 由于/ 需要/ 将/ 特定/ 路径/ 标识符/ 上/ 的/ 撤销/ 消息/ 传播/ 到/ 全网/ ,/ 略微/ 增加/ 了/ 消息/ 数量/ ./ 但是/ MFT2/ -/ EPIC/ 与/ BGP/ 相比/ ,/ 其/ 消息/ 数量/ 的/ 最大值/ 与/ BGP/ 相比/ 反而/ 降低/ 了/ ./ 由于/ MFT2/ -/ BGP/ 具有/ 多条/ 合法/ 路径/ ,/ 仅当/ 失效/ 检测/ 节点/ 存在/ 备份/ 路径/ 时/ 可以/ 抑制/ 瞬时/ 失效/ ./ 如图/ 8/ (/ a/ )/ 、/ 图/ 8/ (/ b/ )/ 所示/ ,/ 当/ 采用/ SUP/ 策略/ 时/ ,/ 其/ 收敛/ 时间/ 和/ 消息/ 数量/ 均/ 降低/ 了/ 一个/ 数量级/ ;/ 而/ 采用/ SNUM/ 策略/ 时/ 也/ 有/ 较大/ 程度/ 的/ 改善/ ./ 在/ 不/ 影响/ 持续/ 转发/ 的/ 同时/ ,/ SUP/ 和/ SNUM/ 策略/ 均/ 极大/ 地/ 降低/ 了/ 网络/ 的/ 抖动/ ./ 当/ 链路/ 断开/ 时/ ,/ 测试/ 各个/ 协议/ 经历/ 路由/ 瞬时/ 失效/ 的/ 节点/ 数目/ (/ 其中/ 对/ 永久/ 失效节点/ 不/ 计入/ 内/ )/ 如图/ 9/ (/ a/ )/ 所示/ ./ 在/ 协议/ 动态/ 收敛/ 过程/ 中/ ,/ MFT2/ -/ BGP/ 、/ MFT2/ -/ EPIC/ 降低/ 平均/ 瞬时/ 失效率/ 至/ 0.11/ %/ 和/ 0.12/ %/ ,/ 经过/ 分析/ 发现/ ,/ MFT2/ -/ BGP/ 中/ 瞬时/ 失效/ 主要/ 是/ 由于/ 部分/ 核心/ 节点/ 采用/ “/ Gao/ -/ Rexford/ ”/ 导入/ 导出/ 原则/ ,/ 使/ 其仅/ 能/ 获得/ 单条/ 路径/ ,/ 当该/ 路径/ 被/ 撤销/ 以后/ ,/ 从而/ 引起/ 其它/ 节点/ 转发/ 中断/ ./ 而/ GhostFlushing/ 、/ EPIC/ 发送/ 过多/ 撤销/ 消息/ 使得/ 大量/ 节点/ 缺乏/ 可用/ 路径/ ,/ 从而/ 增加/ 了/ 瞬时/ 失效节点/ 的/ 数目/ ./ 在/ 收敛/ 过程/ 中/ 通过/ 对/ 每个/ 节点/ 模拟/ 转发/ 报文/ ,/ 计算/ 平均/ 中断/ 转发/ 时间/ 如图/ 9/ (/ b/ )/ 所示/ (/ 其中/ 对/ 永久/ 失效节点/ 不/ 计入/ 内/ )/ ./ MFT2/ -/ BGP/ 、/ MFT2/ -/ EPIC/ 中/ 节点/ 可以/ 动态/ 切换/ 转发/ 路径/ ,/ 从而/ 降低/ 平均/ 转发/ 中断/ Page12/ 时间/ 至/ 0.09/ s/ 和/ 0.13/ s/ ,/ 而/ EPIC/ 和/ GhostFlushing/ 由于/ 快速/ 传播/ 路由/ 撤销/ 消息/ ,/ 部分/ AS/ 节点/ 又/ 缺乏/ 可用/ 的/ 备份/ 路径/ ,/ 从而/ 造成/ 转发/ 中断/ 时间/ 大量/ 增加/ ./ 如图/ 9/ (/ c/ )/ 所示/ ,/ MFT2/ -/ BGP/ 、/ MFT2/ -/ EPIC/ 实际/ 的/ 平均/ 转发/ 路径/ 长度/ 几乎/ 没有/ 增加/ ,/ 与/ 失效/ 后/ 的/ 最佳/ 路径/ 长度/ 相比/ 增加/ 了/ 不到/ 1/ %/ ./ 这/ 主要/ 是因为/ 当/ AS/ 节点/ 检测/ 到/ 失效/ 时/ ,/ 节点/ 动态/ 切换/ 的/ 路径/ 在/ 绝大多数/ 情况/ 下/ 实际/ 就是/ 最终/ 收敛/ 后/ 的/ 最佳/ 路径/ ./ (/ 2/ )/ 在/ 核心/ 链路/ 失效/ 中/ ,/ 模拟/ 中/ 选择/ 43/ 条/ 核心/ 链路/ 断开/ 进行/ 测试/ (/ 不计/ 由于/ 核心/ 链路/ 密集/ 而/ 无/ 失效/ 的/ 场景/ )/ ./ 从图/ 10/ 中/ 可以/ 发现/ ,/ 所有/ 协议/ 的/ 平均/ 瞬时/ 失效节点/ 都/ 有所/ 降低/ ,/ 这/ 是因为/ 在/ BGP/ 协议/ 中/ ,/ 核心/ 节点/ 中/ 通常/ 具有/ 多条/ 可行/ 路径/ ,/ 降低/ 了/ 路径/ 探索/ 时间/ ./ 6.3/ 多/ 失效/ 下/ 协议/ 性能/ 在域/ 间/ 路由/ 发生/ 多/ 并发/ 失效/ 的/ 情况/ 是/ 非常/ 少见/ 的/ ,/ 绝大多数/ 出现/ 在/ 灾难/ 场景/ 中/ ./ 本文/ 主要/ 模拟/ 了/ 双链/ 路/ 失效/ 情景/ ./ (/ 1/ )/ 双链/ 路/ 失效/ 场景/ 1/ ./ 当/ 使用/ 路径/ 标识符/ 数为/ 2/ 时/ ,/ 模拟/ 中/ 采用/ 双链/ 路/ 失效/ 的/ 最/ 极端/ 场景/ ,/ 即/ 断开/ 多/ 宿主/ AS/ 与其/ Provider/ 的/ 一条/ 链路/ ,/ 并/ 随机/ 选择/ 备份/ 路径/ 标识符/ 上/ 的/ 一条/ 链路/ 失效/ (/ 第/ 2/ 条/ 失效/ 链路/ 不能/ 为/ 多/ 宿主/ AS/ 与其/ Provider/ 的/ 链路/ ,/ 否则/ 可能/ 彻底/ 断开/ )/ ,/ 共/ 随机/ 测试/ 248/ 次/ ./ 从图/ 11/ 中/ 可以/ 看出/ ,/ 与/ 单链/ 路/ 失效/ 场景/ 相比/ ,/ 虽然/ MFT2/ -/ BGP/ 、/ MFT2/ -/ EPIC/ 经历/ 瞬时/ 失效/ 的/ 比例/ 有所增加/ ,/ 但是/ 仍然/ 比/ BGP/ 等/ 协议/ 瞬时/ 失效/ 比例/ 大幅/ 降低/ ./ (/ 2/ )/ 双链/ 路/ 失效/ 场景/ 2/ ./ 为了/ 验证/ MFT2/ -/ BGP/ 和/ MFT2/ -/ EPIC/ 的/ 可扩展性/ ,/ 使用/ 3/ 个/ 路径/ 标识符/ 时/ ,/ 随机/ 选取/ 了/ 70/ 个/ 多/ 宿主/ AS/ (/ Provider/ / 3/ )/ 共/ 测试/ 156/ 次/ ,/ 测试/ 场景/ 仍然/ 为/ 最/ 极端/ 的/ 情况/ ,/ 即将/ 目标/ AS/ 与/ Provider/ 连接/ 其中/ 两条/ 链路/ 同时/ 断开/ ./ 从图/ 12/ (/ a/ )/ 中/ CDF/ 图中/ 得知/ ,/ MFT2/ -/ BGP/ 、/ MFT2/ -/ EPIC/ 的/ 收敛/ 时间/ 与/ BGP/ 相比/ 均/ 有所/ 降低/ ,/ 且/ MFT2/ -/ EPIC/ 总体/ 收敛/ 时间/ 降低/ 了/ 19/ %/ ./ 图/ 11/ 双链/ 路/ 失效/ 下/ 平均/ 瞬时/ 失效率/ (/ #/ PID/ =/ 2/ )/ Page13/ 从图/ 12/ (/ b/ )/ 、/ 图/ 12/ (/ c/ )/ 中/ 可知/ ,/ 在/ 这种/ 最为/ 极端/ 的/ 失效/ 情/ 场景/ 下/ ,/ 增加/ 路径/ 标识符/ 数量/ 可以/ 获得/ 更/ 充分/ 的/ 多样性/ 路径/ ,/ 容忍/ 多/ 失效/ 的/ 能力/ 得到/ 了/ 进一步/ 的/ 提高/ 和/ 验证/ ,/ 从图/ 中/ 可知/ MFT2/ -/ BGP/ 、/ MFT2/ -/ EPIC/ 平均/ 失效率/ 仅为/ 0.15/ %/ ,/ 中断/ 时间/ 仅/ 分别/ 为/ 0.11/ s/ 和/ 0.62/ s/ ,/ 出现/ 失效/ 的/ 原因/ 也/ 是/ 由于/ “/ Gao/ -/ Rexford/ ”/ 策略/ 过滤/ 导致/ 部分/ 节点/ 并/ 没有/ 获得/ 多样性/ 路径/ ./ 以上/ 实验/ 表明/ ,/ MFT2/ -/ BGP/ 以/ 相对/ 合理/ 的/ 消息/ 开销/ 构造/ 了/ 结构化/ 的/ 多/ 转发/ 树/ ,/ 且/ 在/ 构造/ 过程/ 中/ 对/ 收敛/ 时间/ 几乎/ 无/ 影响/ ./ 当/ 出现/ 链路/ 失效/ 时/ ,/ MFT2/ -/ BGP/ 、/ MFT2/ -/ EPIC/ 不仅/ 有效/ 降低/ 了/ 收敛/ 时间/ ,/ 而且/ 通过/ 报文/ 在/ 多/ 转发/ 树/ 之间/ 的/ 切换/ ,/ 降低/ 了/ 失效/ 引起/ 的/ 转发/ 中断/ ;/ 且/ 由于/ 构造/ 的/ 多/ 转发/ 树/ 的/ 结构化/ 特性/ ,/ 更/ 易于/ 实现/ 对/ 多/ 失效/ 的/ 处理/ ./ 7/ 结论/ 与/ 未来/ 工作/ 提高/ 域间/ 路由/ 协议/ 的/ 生存性/ 、/ 实现/ 无/ 中断/ 的/ 转发/ 是/ 网络体系结构/ 研究/ 的/ 重点/ 之一/ ,/ 也/ 是/ 网络/ 作为/ 基础设施/ 、/ 新兴/ 应用/ 发展/ 的/ 需求/ ./ 与/ BGP/ 协议/ 以及/ 一些/ 加速/ 收敛/ 的/ 协议/ 相比/ ,/ MFT2/ -/ BGP/ 、/ MFT2/ -/ EPIC/ 以/ 相对/ 较/ 低/ 的/ 消息/ 开销/ 获得/ 了/ 多样性/ 路径/ ,/ 给/ 了/ 用户/ 更大/ 的/ 路径/ 选择/ 权利/ [/ 14/ ]/ 以/ 满足/ QoS/ 需求/ ,/ 可以/ 针对/ 特定/ 标识符/ 的/ 路径/ 实现/ 细粒度/ 的/ 策略/ 控制/ ,/ 避免/ 了/ 由于/ 修改/ 路由/ 策略/ 而/ 造成/ 的/ 环路/ 以及/ 报文/ 丢失/ ./ MFT2/ -/ BGP/ 也/ 具有/ 兼容性/ ,/ 遗留/ 路由器/ 忽略/ 路径/ 标识符/ 即可/ 进行/ 正常/ 的/ 协议/ 收敛/ 和/ 转发/ ./ 当/ 出现/ 链路/ 失效/ 后/ ,/ MFT2/ -/ BGP/ 、/ MFT2/ -/ EPIC/ 利用/ 获得/ 的/ 多路径/ 保证/ 无/ 中断/ 转发/ ,/ 在/ 不/ 限制/ 协议/ 的/ 动态性/ 时/ 进一步/ 降低/ 了/ 收敛/ 时间/ ,/ 当对/ 瞬时/ 失效/ 进行/ 抑制/ 时/ ,/ 网络/ 的/ 稳定性/ 得到/ 增强/ ./ 下/ 一步/ 的/ 工作/ 需要/ 将/ 该/ 模型/ 进行/ 扩展/ ,/ 将/ 多路径/ 的/ 快速/ 恢复/ 协议/ 扩展/ 到/ iBGP/ 协议/ 中/ ,/ 并/ 进一步/ 考虑/ 路由/ 恢复/ 所/ 带来/ 的/ 流量/ 转移/ 可能/ 造成/ 的/ 拥塞/ ,/ 以/ 优化/ 流量/ 负载/ 均衡/ 分布/ ./ 

