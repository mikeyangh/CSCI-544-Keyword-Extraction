Page1VegaNet/ 网络/ 虚拟/ 路由器/ 张媛媛/ 1/ )/ 徐明伟/ 1/ )/ 李琦/ 2/ )/ 1/ )/ (/ 清华大学/ 计算机科学/ 与/ 技术/ 系/ 北京/ 100084/ )/ 2/ )/ (/ 清华大学/ 深圳/ 研究生院/ 广东/ 深圳/ 518055/ )/ 摘要/ 虚拟化/ 技术/ 是/ 推动/ 下一代/ 互联网/ 渐进式/ 发展/ 的/ 关键技术/ ,/ 利用/ 虚拟/ 路由器/ 构建/ 大规模/ 虚拟/ 网络/ 环境/ 对于/ 促进/ 网络/ 创新/ 技术/ 的/ 研究/ 与/ 部署/ 、/ 解决/ 互联网/ 面临/ 的/ 僵化/ 问题/ 具有/ 重要/ 意义/ ./ 该文/ 基于/ 高性能/ 虚拟/ 网络/ VegaNet/ (/ VirtualGigabitNetwork/ )/ ,/ 提出/ 了/ 一种/ 满足/ 保真/ 、/ 高效/ 、/ 可控/ 、/ 隔离/ 和/ 可/ 扩展/ 需求/ 的/ 虚拟/ 路由器/ 方案/ ./ 设计/ 了/ 虚拟/ 链路/ 状态/ 检测/ 机制/ 以/ 保证/ VegaNet/ 网络/ 与/ 物理/ 网络/ 的/ 状态/ 一致性/ ;/ 设计/ 了/ 统一/ 数据/ 转发/ 引擎/ 以/ 提供/ 高效/ 的/ 数据/ 转发/ 服务/ ./ 实验/ 结果表明/ :/ VegaNet/ 网络/ 虚拟/ 路由器/ 的/ 虚拟/ 链路/ 状态/ 检测/ 速度/ 快/ 、/ 统一/ 转发/ 引擎/ 效率高/ ,/ 可以/ 为/ 新型/ 网络体系结构/ 与/ 网络协议/ 提供/ 一个/ 真实/ 高效/ 的/ 实验/ 环境/ ./ 关键词/ 虚拟/ 路由器/ ;/ VegaNet/ ;/ 虚拟/ 链路/ 状态/ 检测/ ;/ 统一/ 数据/ 转发/ 1/ 引言/ 互联网/ 在/ 过去/ 的/ 几十年/ 里/ 取得/ 了/ 巨大/ 的/ 成功/ ./ TCP/ // IP/ 协议/ 栈/ 提供/ 的/ 通用/ 数据/ 转发/ 服务/ 促进/ 了/ 网络/ 技术/ 与/ 应用/ 的/ 迅速/ 发展/ ,/ 使得/ 互联网/ 成为/ 全球/ 信息/ 承载/ 与/ 传递/ 的/ 重要/ 基础设施/ ./ 然而/ 随着/ 互联网/ 规模/ 的/ 增大/ ,/ 网络层/ 协议/ 的/ 封闭性/ 限制/ 了/ 互联网/ 本身/ 的/ 创新/ 进程/ ,/ 许多/ 新型/ 网络体系结构/ 难以/ 无缝/ 地/ 集成/ 到/ 现有/ 的/ 互联网/ 框架/ 中/ ./ 此外/ ,/ 互联网/ 服务提供商/ Page2/ 之间/ 的/ 利益冲突/ 使/ 它们/ 很难/ 在/ 网络/ 创新/ 技术/ 的/ 部署/ 方面/ 达成/ 一致/ ,/ 一些/ 新兴/ 网络/ 技术/ 如/ IPv6/ 、/ IPSEC/ 和/ 组播/ 等/ 因为/ 无法/ 在/ 真实/ 网络/ 上/ 进行/ 大规模/ 的/ 部署/ 验证/ 而/ 难以/ 进一步/ 推广/ ,/ 这/ 使得/ 针对/ 下一代/ 互联网/ 体系结构/ 的/ 研究/ 缺乏/ 具有/ 实际意义/ 的/ 突破性/ 进展/ ,/ 互联网/ 的/ 发展/ 正/ 面临/ 一定/ 程度/ 的/ 僵化/ [/ 1/ ]/ ./ 为了/ 打破/ 互联网/ 发展/ 的/ 僵化/ ,/ 加快/ 下一代/ 互联网/ 体系结构/ 的/ 创新/ 进程/ ,/ 虚拟/ 网络/ 应运而生/ ./ 虚拟/ 网络/ 是/ 利用/ 虚拟化/ 技术/ 对/ 物理/ 网络资源/ 进行/ 抽象/ 和/ 划分/ 后/ ,/ 在/ 公共/ 的/ 网络/ 硬件/ 基础设施/ 之上/ 构建/ 出/ 的/ 多个/ 独立/ 运行/ 的/ 逻辑/ 网络/ ./ 不同/ 的/ 虚拟/ 网络/ 可以/ 采用/ 不同/ 的/ 体系结构/ ,/ 承载/ 不同/ 的/ 网络协议/ ,/ 并/ 为/ 用户/ 提供/ 可/ 定制/ 的/ 服务/ ./ 虚拟/ 路由器/ 是/ 虚拟/ 网络/ 的/ 核心/ 设备/ ,/ 借助/ 主机/ 虚拟化/ 技术/ ,/ 虚拟/ 路由器/ 可以/ 在/ 同一/ 主机/ 系统/ 内/ 构建/ 出/ 多个/ 虚拟/ 路由器/ 实例/ ,/ 每个/ 虚拟/ 实例/ 拥有/ 特定/ 的/ 资源/ ,/ 包括/ CPU/ 、/ 内存/ 、/ 网络设备/ 等/ 物理/ 资源/ ,/ 以及/ 路由表/ 、/ 协议/ 栈/ 、/ 系统配置/ 等/ 逻辑/ 资源/ ./ 各/ 虚拟/ 实例/ 负责/ 为/ 其/ 所属/ 的/ 虚拟/ 网络/ 提供/ 路由/ 转发/ 服务/ ./ 本文/ 基于/ 高性能/ 虚拟/ 网络/ VegaNet/ [/ 2/ ]/ 提出/ 一种/ 虚拟/ 路由器/ 设计方案/ ,/ 旨在/ 为/ 下一代/ 互联网/ 研究/ 提供/ 一个/ 满足/ 保真/ 、/ 高效/ 、/ 可控/ 、/ 隔离/ 和/ 可/ 扩展/ 需求/ 的/ 虚拟/ 网络/ 实验/ 环境/ ,/ 为/ 研究/ 人员/ 提供/ 全方位/ 的/ 创新/ 实验/ 支持/ ./ 本文/ 主要/ 贡献/ 包括/ :/ (/ 1/ )/ 提出/ VegaNet/ 虚拟/ 路由器/ 的/ 结构/ 框架/ ,/ 阐述/ 了/ VegaNet/ 虚拟/ 路由器/ 的/ 应用/ 场景/ ;/ (/ 2/ )/ 设计/ 了/ 虚拟/ 路由器/ 的/ 虚拟/ 链路/ 状态/ 检测/ 机制/ 与/ 统一/ 数据/ 转发/ 引擎/ ,/ 以/ 保证/ VegaNet/ 网络/ 与/ 物理/ 网络/ 的/ 状态/ 一致性/ 以及/ 数据/ 转发/ 的/ 高效性/ ;/ (/ 3/ )/ 实现/ 了/ 虚拟/ 路由器/ 原型/ 系统/ ;/ (/ 4/ )/ 对/ 虚拟/ 路由器/ 的/ 链路/ 状态/ 检测/ 性能/ 和/ 数据/ 转发/ 性能/ 进行/ 了/ 实验/ 评价/ ./ 本文/ 第/ 2/ 节/ 介绍/ VegaNet/ 虚拟/ 网络/ 的/ 背景/ 与/ 虚拟/ 路由器/ 的/ 相关/ 工作/ ;/ 第/ 3/ 节/ 概述/ VegaNet/ 虚拟/ 路由器/ 的/ 结构/ 框架/ 及其/ 应用/ 场景/ ;/ 第/ 4/ 节/ 具体/ 阐释/ 虚拟/ 路由器/ 的/ 轻量级/ 虚拟/ 链路/ 状态/ 检测/ 机制/ 与/ 高效/ 数据/ 统一/ 转发/ 机制/ ;/ 第/ 5/ 节/ 给出/ 虚拟/ 路由器/ 的/ 原型/ 系统/ 实现/ ;/ 第/ 6/ 节对/ 虚拟/ 路由器/ 进行/ 性能/ 评价/ ;/ 第/ 7/ 节/ 总结/ 全文/ 工作/ ,/ 并/ 提出/ 下/ 一步/ 工作/ 计划/ ./ 2/ 背景/ 及/ 相关/ 工作/ 2.1/ VegaNet/ 虚拟/ 网络/ VegaNet/ 虚拟/ 网络/ 是/ 一个/ 采用/ Overlay/ 结构/ 的/ 新型/ 网络/ 实验/ 平台/ ,/ 以/ 互联网/ 作为/ 物理/ 基础设施/ ,/ 其/ 模型/ 如图/ 1/ 所示/ ./ VegaNet/ 网络设备/ 主要/ 包括/ 两/ 部分/ :/ 物理/ 路由器/ 与/ 虚拟/ 路由器/ ./ 物理/ 路由器/ 即/ 物理/ 网络/ 中/ 的/ 路由器/ ,/ 通过/ 物理/ 链路/ 互连/ ,/ 负责/ 虚拟/ 网络/ 的/ 数据传输/ 服务/ ;/ 虚拟/ 路由器/ 通过/ 直连线/ 路/ 连接/ 到/ 物理/ 路由器/ ,/ 与/ 物理/ 路由器/ 形成/ 映射/ 关系/ ./ 虚拟/ 路由器/ 上/ 的/ 虚拟/ 实例/ 通过/ 虚拟/ 链路/ 连接起来/ 构成/ 虚拟/ 网络/ ,/ 利用/ 由/ 物理/ 路由器/ 与/ 物理/ 链路/ 构成/ 的/ 底层/ 物理/ 网络/ 进行/ 通信/ ./ 与/ 物理/ 路由器/ 和/ 物理/ 链路/ 构成/ 的/ 物理/ 网络/ 相对/ 应/ ,/ 虚拟/ 路由器/ 和/ 虚拟/ 链路/ 构成/ 了/ 基本/ 的/ 实验/ 环境/ ./ VegaNet/ 虚拟/ 网络/ 与/ 物理/ 网络/ 的/ 连接/ 关系/ 具有/ 两种/ 视图/ —/ —/ —/ 平面/ 视图/ 与/ 立体/ 视图/ ./ 在/ 平面/ 视图/ 上/ ,/ 虚拟/ 路由器/ 以/ 普通/ 主机/ 的/ 身份/ 通过/ 物理/ 路由器/ 接入/ 到/ 物理/ 网络/ 中/ ,/ 采用/ 隧道/ 技术/ 实现/ 的/ 虚拟/ 链路/ 将/ 多条/ 物理/ 链路/ 整合/ 为/ 一条/ 逻辑/ 上/ 的/ 直连/ 链路/ ,/ 为/ 虚拟/ 路由器/ 上/ 的/ 虚拟/ 实例/ 提供/ 点到点/ 的/ 连接/ ./ 在/ 物理/ 网络/ 看来/ ,/ 虚拟/ 路由器/ 和/ 网络/ 上/ 的/ 任何/ 一台/ 主机/ 一样/ ,/ 是/ 自己/ 提供数据/ 转发/ 服务/ 的/ 对象/ ./ 这样/ 就/ 保证/ 了/ 虚拟/ 网络/ 对/ 物理/ 网络/ 的/ 透明性/ ,/ 使/ 虚拟/ 路由器/ 的/ 接入/ 不会/ 对/ 商业/ 网络/ 路由器/ 的/ 运行/ 造成/ 干扰/ ./ 在/ 立体/ 视图/ 上/ ,/ 虚拟/ 网络/ 是/ 覆盖/ 于/ 物理/ 网络/ 之上/ 的/ 网络/ ,/ 虚拟/ 路由器/ 作为/ 虚拟/ 网络/ 的/ 核心/ 结点/ ,/ 为/ 虚拟/ 网络/ 提供/ 路由/ 计算/ 、/ 数据/ 转发/ 等/ 服务/ ./ 节点/ 虚拟化/ 技术/ 赋予/ 了/ 虚拟/ 路由器/ 可/ 扩展/ 的/ 特性/ ,/ 使得/ 一个/ 虚拟/ 路由器/ 上/ 可以/ 构建/ 出/ 多个/ 虚拟/ 实例/ ./ 采用/ 隧道/ 技术/ 实现/ 的/ 虚拟/ 链路/ 将/ 各/ 虚拟/ 实例/ 分配/ 到/ 不同/ 的/ 虚拟/ 网络拓扑/ 中/ ,/ 从而/ 构建/ 起/ 多个/ 相互/ 隔离/ 且/ 独立/ 运行/ 的/ 虚拟/ 网络/ ./ 这样一来/ ,/ 在/ 同一/ 物理/ 网络/ 之上/ ,/ VegaNet/ 网络/ 对/ 不同/ 的/ 研究者/ 可以/ 同时/ 提供/ 多个/ 相互/ 隔离/ 的/ 虚拟/ 网络/ 实验/ 环境/ ./ 在/ 图/ 1/ 中/ ,/ 不同/ 类型/ 的/ 虚线/ 构成/ 了/ 不同/ 拓扑/ 结构/ 的/ 虚拟/ 网络/ ./ Page3/ 文献/ [/ 2/ ]/ 对/ VegaNet/ 体系结构/ 进行/ 了/ 总体设计/ ,/ 提出/ 借助/ 网络/ 虚拟化/ 技术/ 及/ 虚拟/ 路由器/ 的/ 硬件/ 转发/ 技术/ 为/ 网络/ 研究/ 提供/ 真实/ 实验/ 平台/ 的/ 概念/ ./ 本文/ 在/ 此基础/ 上/ ,/ 进一步/ 提出/ VegaNet/ 网络/ 上/ 虚拟/ 路由器/ 的/ 设计/ 实现/ 方案/ ,/ 并/ 对/ 方案/ 进行/ 了/ 详细/ 的/ 性能/ 分析/ 与/ 评价/ ./ 2.2/ 虚拟/ 路由器/ 文献/ [/ 3/ ]/ 对/ 虚拟/ 路由器/ 技术/ 进行/ 了/ 较为/ 全面/ 的/ 综述/ ,/ 本文/ 根据/ 虚拟/ 路由器/ 实现/ 方式/ 的/ 不同/ ,/ 将/ 其/ 分为/ 基于/ 专用/ 硬件/ 的/ 虚拟/ 路由器/ 与/ 基于/ 通用/ 服务器/ 平台/ 的/ 虚拟/ 路由器/ 两类/ ,/ 进行/ 简要/ 的/ 分析/ 说明/ ./ 在/ 基于/ 专用/ 硬件/ 的/ 路由器/ 虚拟化/ 技术/ 中/ ,/ 虚拟/ 数据/ 平面/ 采用/ 专用/ 硬件/ 实现/ ,/ 以/ 保证/ 虚拟/ 路由器/ 的/ 转发/ 性能/ ./ 例如/ ,/ SwitchBlade/ [/ 4/ ]/ 使用/ FPGA/ 硬件平台/ 构建/ 虚拟/ 数据/ 平面/ ;/ SPP/ (/ SuperchargedPlanetlabPlatform/ )/ [/ 5/ ]/ 路由器/ 节点/ 的/ 控制/ 平面/ 运行/ 在/ 通用/ 服务器/ 平台/ 上/ ,/ 数据/ 平面/ 则/ 运行/ 在/ IXP/ 网络/ 处理器/ 上/ ;/ PEARL/ [/ 6/ ]/ 将/ 多/ 核/ 处理器/ 与/ 内嵌/ TCAM/ 及/ SRAM/ 存储器/ 的/ 专用/ 数据包/ 处理/ 卡/ 相结合/ ,/ 来/ 构建/ 可编程/ 虚拟/ 路由器/ ;/ ServerSwitch/ [/ 7/ ]/ 将/ 服务器/ 与/ Switch/ 芯片/ 相结合/ ,/ 为/ 数据中心/ 网络/ 提供/ 复杂/ 数据包/ 处理/ 能力/ 与/ 可编程/ 性/ ./ 硬件/ 辅助/ 路由器/ 虚拟化/ 的/ 局限性/ 在于/ 固化/ 的/ 硬件/ 芯片/ 技术/ 使/ 用户/ 很难/ 根据/ 业务/ 需求/ 灵活/ 调整/ 报文/ 处理/ 流程/ ,/ 同时/ 有限/ 且/ 高/ 成本/ 的/ 高速/ 硬件资源/ 限制/ 了/ 虚拟/ 路由器/ 的/ 可扩展性/ ./ 近年来/ ,/ XORP/ [/ 8/ ]/ 、/ QUAGGA/ ①/ 等/ 路由/ 管理软件/ 与/ Click/ [/ 9/ ]/ 、/ VALE/ [/ 10/ ]/ 等/ 软件/ 数据交换/ 技术/ 的/ 兴起/ 使得/ 利用/ 通用/ 服务器/ 平台/ 实现/ 高性能/ 虚拟/ 路由器/ 成为/ 可能/ ./ 虚拟/ 路由器/ 的/ 控制/ 平面/ 与/ 数据/ 平面/ 均/ 采用/ 软件技术/ 实现/ ,/ 不/ 需要/ 专用/ 硬件/ 设备/ 的/ 支持/ ./ 文献/ [/ 11/ ]/ 证明/ 了/ 在/ 通用/ 的/ x86/ 硬件平台/ 上/ 实现/ 虚拟/ 路由器/ 的/ 可行性/ ./ 常见/ 的/ 通用/ 平台/ 虚拟/ 路由器/ 系统/ 有/ RouteBricks/ [/ 12/ ]/ 、/ PacketShader/ [/ 13/ ]/ 、/ PlanetLab/ 节点/ [/ 14/ ]/ 等/ ./ 相对/ 于/ 基于/ 专用/ 硬件/ 的/ 虚拟/ 路由器/ ,/ 利用软件/ 实现/ 的/ 虚拟/ 路由器/ 具有/ 更好/ 的/ 灵活性/ 和/ 可扩展性/ ,/ 且/ 成本/ 较/ 低/ ./ 本文/ 提出/ 的/ 虚拟/ 路由器/ 设计方案/ 基于/ 通用/ 服务器/ 平台/ ,/ 通过/ 对/ Click/ 软件/ 路由器/ 进行/ 扩展/ ,/ 设计/ 了/ 虚拟/ 路由器/ 的/ 统一/ 数据/ 转发/ 引擎/ ,/ 使/ 其/ 同时/ 支持/ 多个/ 虚拟/ 路由/ 实例/ 的/ 数据/ 转发/ ,/ 利用/ 虚拟/ 链路/ 状态/ 检测/ 技术/ 为/ 研究/ 人员/ 提供/ 一个/ 具有/ 高保真/ 性/ 的/ 虚拟/ 网络/ 实验/ 环境/ ,/ 并/ 利用/ VegaNet/ 平台/ 提供/ 的/ 对/ 互联网/ 的/ 透明性/ ,/ 保证/ 虚拟/ 路由器/ 可以/ 在/ 现有/ 网络/ 环境/ 中/ 进行/ 全面/ 部署/ ./ 3/ 虚拟/ 路由器/ 设计/ 3.1/ 设计/ 目标/ VegaNet/ 作为/ 一个/ 大规模/ 的/ 虚拟/ 网络/ 实验/ 环境/ ,/ 其/ 核心/ 设备/ 虚拟/ 路由器/ 的/ 设计/ 首先/ 应该/ 满足/ 保/ 真性/ 与/ 可控性/ 这/ 两大/ 基本/ 设计/ 需求/ [/ 15/ ]/ ,/ 在/ 此基础/ 上/ ,/ 还/ 应该/ 尽可能/ 地/ 确保/ 实验/ 平台/ 的/ 高效性/ 、/ 隔离/ 性/ 与/ 可扩展性/ ,/ 为/ 创新/ 技术/ 的/ 实验/ 与/ 评估/ 提供/ 有效/ 的/ 实验/ 环境/ ./ VegaNet/ 虚拟/ 路由器/ 的/ 设计/ 目标/ 如下/ :/ (/ 1/ )/ 保/ 真性/ ./ 首先/ ,/ 虚拟/ 路由器/ 应该/ 具备/ 同步/ 跟踪/ 物理/ 网络/ 状态/ 和/ 行为/ 的/ 能力/ ,/ 能够/ 快速/ 感知/ 物理/ 链路/ 上/ 的/ 故障/ 或/ 故障/ 恢复/ 等/ 事件/ 并/ 将/ 这些/ 事件/ 引入/ 虚拟/ 网络/ ,/ 使/ 虚拟/ 网络/ 具备/ 类似/ 物理/ 网络/ 的/ 动态变化/ 能力/ ;/ 其次/ ,/ 虚拟/ 路由器/ 应该/ 具备/ 物理/ 路由器/ 的/ 功能/ ,/ 承载/ 真实/ 的/ 用户/ 流量/ ,/ 运行/ 真实/ 的/ 网络协议/ ./ (/ 2/ )/ 高效性/ ./ 虚拟/ 路由器/ 需要/ 为/ 多个/ 虚拟/ 网络/ 的/ 分组/ 提供/ 转发/ 服务/ ,/ 必须/ 具备/ 高效/ 的/ 数据/ 转发/ 能力/ ,/ 一方面/ 能以/ 较/ 低/ 的/ 转发/ 开销/ 实现/ 快速/ 数据/ 转发/ ,/ 另一方面/ 要/ 尽量避免/ 大规模/ 数据/ 转发/ 对/ 控制/ 平面/ 上/ 运行/ 的/ 实验/ 协议/ 造成/ 干扰/ ./ (/ 3/ )/ 可控性/ ./ 虚拟/ 路由器/ 应该/ 向/ 用户/ 提供/ 配置/ 接口/ ,/ 允许/ 用户/ 根据/ 实验/ 需求/ 定制/ 虚拟/ 网络拓扑/ ,/ 配置/ 虚拟/ 网络/ 路由/ 协议/ ,/ 控制/ 虚拟/ 网络/ 的/ 流量/ 特性/ ,/ 并/ 允许/ 用户/ 向/ 虚拟/ 网络/ 中/ 注入/ 现实/ 环境/ 中/ 发生/ 概率/ 较/ 小/ 的/ 网络/ 事件/ ./ (/ 4/ )/ 隔离/ 性/ ./ 首先/ ,/ 虚拟/ 路由器/ 应该/ 对/ 物理/ 路由器/ 透明/ ,/ 不/ 干扰/ 物理/ 网络/ 的/ 正常/ 运行/ ;/ 其次/ ,/ 虚拟/ 路由器/ 设备/ 上/ 的/ 多个/ 虚拟/ 实例/ 之间/ 也/ 应该/ 具备/ 良好/ 的/ 隔离/ 性/ ,/ 保证/ 一个/ 实例/ 的/ 运行/ 故障/ 不会/ 对同/ 设备/ 上/ 的/ 其他/ 实例/ 产生/ 影响/ ./ (/ 5/ )/ 可扩展性/ ./ 可扩展性/ 包括/ 两/ 方面/ :/ 一是/ 虚拟/ 路由器/ 在/ 物理/ 网络/ 上/ 的/ 增量/ 部署/ ;/ 二是/ 虚拟/ 实例/ 在/ 虚拟/ 路由器/ 上/ 的/ 增量/ 创建/ ./ 3.2/ 虚拟/ 路由器/ 结构/ VegaNet/ 虚拟/ 路由器/ 主要/ 包括/ 管理/ 模块/ 、/ 虚拟/ 链路/ 状态/ 检测/ 模块/ 、/ 路由/ 模块/ 、/ 转发/ 模块/ 4/ 大/ 功能模块/ ,/ 其/ 结构/ 框架/ 如图/ 2/ 所示/ ./ 管理/ 模块/ 、/ 虚拟/ 链路/ 状态/ 检测/ 模块/ 与/ 转发/ 模块/ 运行/ 于/ 虚拟/ 路由器/ 的/ 底层/ 操作系统/ 平台/ 上/ ,/ 平台/ 利用/ 虚拟化/ 技术/ 创建/ 多个/ 虚拟/ 实例/ ,/ 每个/ 实例/ 代表/ 虚拟/ 网络/ 的/ 一个/ 节点/ ,/ 其上/ 运行/ 各自/ 的/ 路由/ 模块/ ./ 各/ 虚拟/ 实例/ 的/ 虚/ 接口/ 通过/ 虚拟/ 交/ ①/ Quaggasoftwareroutingsuite/ ./ http/ :/ // // www/ ./ quagga/ ./ netPage4/ 换机/ 映射/ 到/ 虚拟/ 路由器/ 的/ 物理/ 接口/ 上/ ,/ 利用/ 物理/ 接口/ 与/ 外部/ 网络/ 进行/ 通信/ ./ 虚拟/ 路由器/ 的/ 管理/ 模块/ 负责/ 虚拟/ 网络/ 的/ 创建/ 与/ 维护/ ./ 通过/ 向/ 研究/ 人员/ 开放/ 一系列/ 的/ 配置/ 接口/ ,/ 管理/ 模块/ 允许/ 研究/ 人员/ 主动/ 维护/ 虚拟/ 网络/ 的/ 属性/ 参数/ ./ 具体来说/ ,/ 在/ 创建/ 一个/ 虚拟/ 网络/ 之前/ ,/ 研究/ 人员/ 需要/ 将/ 虚拟/ 网络/ 的/ 节点/ 规模/ 、/ 拓扑/ 连接/ 、/ 路由/ 协议/ 、/ 服务类型/ 等/ 参数/ 输入/ 管理/ 模块/ ,/ 管理/ 模块/ 根据/ 用户/ 配置/ 指令/ 生成/ 对应/ 的/ 虚拟/ 实例/ ,/ 并/ 在/ 指定/ 的/ 虚拟/ 实例/ 间/ 使用/ 隧道/ 技术/ 建立/ 虚拟/ 链路/ ,/ 为/ 虚拟/ 实例/ 提供/ 点到点/ 的/ 逻辑/ 连接/ ,/ 构成/ 虚拟/ 网络/ 的/ 拓扑/ 结构/ ./ 类似/ 地/ ,/ 在/ 虚拟/ 网络/ 运行/ 过程/ 中/ ,/ 研究/ 人员/ 同样/ 可以/ 通过/ 管理/ 模块/ 实现/ 虚拟/ 网络/ 属性/ 参数/ 的/ 调整/ ./ 实时/ 检测/ 虚拟/ 网络/ 链路/ 的/ 状态/ 变化/ 对于/ 建设/ 一个/ 可用/ 、/ 可靠/ 、/ 可控/ 的/ 虚拟/ 网络/ 具有/ 至关重要/ 的/ 意义/ ,/ 此/ 功能/ 由/ 虚拟/ 链路/ 状态/ 检测/ 模块/ 完成/ ./ 由于/ 虚拟/ 链路/ 是/ 一种/ 逻辑/ 上/ 的/ 链路/ ,/ 由/ 多条/ 物理/ 链路/ 连接/ 而成/ ,/ 因此/ 其/ 状态/ 主要/ 取决于/ 底层/ 物理/ 链路/ 的/ 状态/ ./ 虚拟/ 链路/ 状态/ 检测/ 模块/ 上/ 的/ 链路/ 状态/ 检测/ 协议/ 周期性地/ 与/ 邻居/ 虚拟/ 实例/ 节点/ 交互/ 控制/ 报文/ ,/ 根据/ 报文/ 中/ 携带/ 的/ 控制/ 信息/ 判断/ 当前/ 物理/ 网络/ 的/ 链路/ 状态/ ,/ 并/ 据此/ 确定/ 对应/ 的/ 虚拟/ 链路/ 状态/ ./ 利用/ 此/ 协议/ ,/ 可以/ 实现/ 对/ 虚拟/ 链路/ 双向/ 连通性/ 、/ 分组/ 往返/ 传输/ 时间/ 、/ 跳数/ 、/ MTU/ 等/ 状态参数/ 的/ 快速/ 检测/ 和/ 通告/ ./ 路由/ 模块/ 用于/ 实现/ 各/ 虚拟/ 实例/ 的/ 路由/ 寻址/ 功能/ ,/ 主要/ 负责/ 虚拟/ 网络/ 中路/ 由/ 信息/ 的/ 交互/ ,/ 确保/ 虚拟/ 网络/ 的/ 可达性/ ,/ 并/ 为/ 转发/ 模块/ 提供/ 转发/ 依据/ ./ 路由/ 模块/ 上/ 运行/ 的/ 路由/ 协议/ 是/ 由/ 研究/ 人员/ 来/ 定义/ 和/ 实现/ 的/ ,/ 它/ 可以/ 是/ 广泛/ 使用/ 的/ IP/ 协议/ 或者/ IPv6/ 协议/ ,/ 也/ 可以/ 是/ 研究/ 人员/ 设计/ 的/ 新型/ 协议/ ./ 路由/ 机制/ 与/ 路由/ 协议/ 的/ 研究/ 是/ 网络体系结构/ 研究/ 的/ 重点/ 内容/ ,/ 传统/ 的/ OSPF/ 、/ BGP/ 等/ 协议/ 的/ 改进/ 算法/ 不断涌现/ ,/ NDN/ 、/ 二维/ 路由/ 等/ 采用/ 新型/ 寻址/ 技术/ 的/ 路由/ 机制/ 也/ 纷纷/ 出现/ ,/ 研究/ 人员/ 将/ 路由/ 协议/ 部署/ 在/ 路由/ 模块/ 上/ ,/ 就/ 可以/ 利用/ 虚拟/ 网络/ 环境/ 对/ 路由/ 协议/ 的/ 各种/ 属性/ 进行/ 评测/ ./ 转发/ 模块/ 为/ 虚拟/ 路由器/ 上/ 所有/ 的/ 虚拟/ 实例/ 提供/ 统一/ 的/ 数据/ 转发/ 服务/ ./ 统一/ 转发/ 机制/ 将/ 数据/ 平面/ 从/ 各/ 实例/ 内部/ 转移/ 至/ 虚拟/ 路由器/ 底层/ 内核/ ,/ 各/ 虚拟/ 实例/ 的/ 路由/ 模块/ 定期/ 将/ 更新/ 的/ 路由表/ 信息/ 发布/ 到/ 转发/ 模块/ ,/ 由/ 转发/ 模块/ 生成/ 共享/ 转/ 发表/ ,/ 转发/ 模块/ 根据/ 共享/ 转/ 发表/ 对/ 虚拟/ 网络/ 分组/ 进行/ 路由/ 查找/ ,/ 获得/ 下/ 一/ 跳/ 虚拟/ 结点/ 信息/ ,/ 然后/ 对/ 分组/ 进行/ 封装/ 并/ 将/ 其/ 转发/ 到/ 相应/ 的/ 虚拟/ 链路/ 上/ ./ 由于/ 转发/ 模块/ 提供/ 的/ 是/ 对/ 应用程序/ 透明/ 的/ 数据/ 转发/ 服务/ ,/ 因此/ 应用层/ 程序/ 不会/ 感知/ 虚拟/ 网络/ 的/ 存在/ ,/ 可以/ 直接/ 在/ 虚拟/ 网络/ 中/ 进行/ 部署/ 和/ 测试/ ./ 3.3/ 应用/ 场景/ 图/ 3/ 展示/ 了/ VegaNet/ 虚拟/ 路由器/ 的/ 典型/ 应用/ 场景/ ./ 图中/ ,/ 虚拟/ 路由器/ VR1/ -/ VR4/ 以/ 终端/ 主机/ 的/ 形式/ 接入/ 由/ PR1/ -/ PR6/ 组成/ 的/ 物理/ 网络/ ,/ 用户/ 通过/ 虚拟/ 路由器/ 的/ 管理/ 模块/ 定制/ 了/ 两个/ 虚拟/ 网络/ :/ 虚拟/ 网络/ 1/ 由/ 3/ 个/ 虚拟/ 实例/ (/ 分别/ 位于/ VR1/ 、/ VR2/ 和/ VR3/ 上/ )/ 以及/ 两条/ 虚拟/ 链路/ 组成/ ,/ 运行/ 路由/ 协议/ A/ ;/ 虚拟/ 网络/ 2/ 由/ 3/ 个/ 虚拟/ 实例/ (/ 分别/ 位于/ VR1/ 、/ VR2/ 和/ VR4/ 上/ )/ 以及/ 两条/ 虚拟/ 链路/ 组成/ ,/ 运行/ 路由/ 协议/ B/ ./ 协议/ A/ 和/ 协议/ B/ 的/ 数据/ 分组/ 进入/ VR1/ ,/ 在/ VR1/ 转发/ 模块/ 中/ 完成/ 路由/ 查找/ 及/ IP/ 头/ 封装/ ./ 路由/ 查找/ 确定/ 协议/ A/ 分组/ 的/ 下/ 一/ 跳/ 为/ VR2/ ,/ 协议/ B/ 分组/ 的/ 下/ 一/ 跳/ 为/ VR2/ (/ 或/ VR4/ )/ ,/ 因此/ 协议/ A/ 分组/ 封装/ 后/ 的/ 目的/ 地址/ 为/ VR2/ ,/ 分组/ 经/ PR1/ 、/ PR2/ 的/ 路由/ 到达/ VR2/ ./ 协议/ B/ 分组/ 封装/ 后/ 的/ 目的/ 地址/ 为/ VR2/ (/ 或/ VR4/ )/ ,/ 分组/ 经/ PR1/ 、/ PR2/ 的/ 路由/ 到达/ VR2/ (/ 或经/ PR1/ 、/ PR3/ 、/ PR4/ 、/ PR6/ 的/ 路由/ 到达/ VR4/ )/ ./ 同样/ 地/ ,/ VR2/ 上/ 的/ 协议/ A/ 分组/ 进一步/ 经/ 路由/ 到达/ VR3/ ./ 虽然/ 虚拟/ 网络/ 分组/ 从/ 一个/ 虚拟/ 实例/ 到达/ 另/ 一个/ 相邻/ 的/ 虚拟/ 实例/ 经过/ 了/ 多个/ 物理/ 路由器/ ,/ 但/ 从/ 虚拟/ 网络/ 的/ 视角/ 来看/ 却是/ 一条/ 直/ 连通/ 路/ ,/ 即/ 虚拟/ 链路/ ./ 可以/ 看出/ ,/ VegaNet/ 网络/ 上/ Page5/ 的/ 虚拟/ 实例/ 及/ 虚拟/ 链路/ 通过/ 对/ 物理/ 设备/ 与/ 链路/ 的/ 复用/ 简单/ 高效/ 地/ 实现/ 了/ 不同/ 协议/ 在/ 同一/ 物理/ 网络/ 上/ 相互/ 独立/ 的/ 并行/ 运行/ ./ 此外/ ,/ 虚拟/ 实例/ 上/ 的/ 虚拟/ 链路/ 状态/ 检测/ 模块/ 通过/ 对/ 物理/ 链路/ 状态/ 的/ 实时/ 监测/ ,/ 可以/ 将/ 真实/ 的/ 网络故障/ 事件/ 同步/ 引入/ 虚拟/ 链路/ ,/ 实现/ 对/ 协议/ A/ 、/ B/ 的/ 测试/ ./ 4/ 关键技术/ 4.1/ 虚拟/ 链路/ 状态/ 检测/ 虚拟/ 路由器/ 上/ 的/ 虚拟/ 实例/ 间/ 通过/ 虚拟/ 链路/ 来/ 建立/ 连接/ ./ 如上/ 文/ 所述/ ,/ 虚拟/ 链路/ 是/ 采用/ 隧道/ 技术/ 实现/ 的/ 一种/ 逻辑/ 链路/ ,/ 分组/ 在/ 一条/ 虚拟/ 链路/ 上/ 的/ 实际/ 传输/ 路径/ 由/ 连接/ 隧道/ 起点/ 和/ 终点/ 的/ 物理/ 链路/ 以及/ 中间/ 物理/ 路由器/ 组成/ ./ 虚拟/ 路由器/ 在/ 转发/ 虚拟/ 网络/ 分组/ 时/ ,/ 首先/ 将/ 其/ 封装/ 在/ IP/ 分组/ 中/ ,/ IP/ 报头/ 中/ 指明/ 了/ 虚拟/ 链路/ 的/ 源端/ 与/ 目的/ 端/ ,/ 封装/ 后/ 的/ 分组/ 被/ 发送到/ 与/ 此/ 虚拟/ 路由器/ 处于/ 同一/ 网段/ 的/ 物理/ 路由器/ 上/ ,/ 并/ 被/ 物理/ 网络/ 上/ 的/ 路由器/ 逐跳/ 转发/ ,/ 分组/ 最终/ 到达/ IP/ 报头/ 中/ 指定/ 的/ 目的/ 虚拟/ 路由器/ ,/ 这台/ 虚拟/ 路由器/ 将/ 封装/ 分组/ 解/ 封装/ 即可/ 得到/ 原/ 虚拟/ 网络/ 分组/ ,/ 这样/ 就/ 实现/ 了/ 分组/ 在/ 虚拟/ 网络/ 上/ 的/ 一/ 跳/ 转发/ ./ 虚拟/ 链路/ 是/ 构建/ 在/ 物理/ 链路/ 之上/ 的/ 逻辑/ 连接/ ,/ 当其/ 实际/ 传输/ 路径/ 上/ 的/ 某条/ 物理/ 链路/ 发生/ 故障/ 时/ ,/ 物理/ 网络/ 会/ 迅速/ 进行/ 重/ 路由/ ,/ 为/ 该/ 虚拟/ 链路/ 选择/ 一条/ 新/ 的/ 物理/ 传输/ 路径/ ,/ 因此/ 虚拟/ 实例/ 很难/ 感知/ 到/ 虚拟/ 链路/ 上/ 的/ 故障/ 事件/ ,/ 无法/ 为/ 实例/ 上/ 运行/ 的/ 实验/ 协议/ 提供/ 一个/ 动态/ 的/ 测试环境/ ./ 此外/ ,/ 由于/ 物理/ 网络/ 上/ 通常/ 承载/ 着/ 多种/ 数据传输/ 业务/ ,/ 虚拟/ 链路/ 的/ 流量/ 特性/ 容易/ 受到/ 其他/ 流量/ 负载/ 的/ 影响/ ,/ 因此/ 虚拟/ 链路/ 的/ 传输/ 时延/ 和/ 抖动/ 、/ 链路/ 拥塞/ 状况/ 以及/ 故障/ 频率/ 等/ 状态参数/ 又/ 具有/ 较大/ 的/ 可变性/ ./ 为了/ 保证/ 虚拟/ 实例/ 能/ 实时/ 获取/ 虚拟/ 链路/ 的/ 状态参数/ ,/ 以/ 提供/ 一个/ 尽量/ 真实/ 可靠/ 的/ 实验/ 环境/ ,/ 我们/ 在/ VegaNet/ 虚拟/ 路由器/ 上/ 部署/ 虚拟/ 链路/ 状态/ 检测/ 模块/ ,/ 以较/ 低/ 的/ 控制/ 报文/ 开销/ 对/ 虚拟/ 链路/ 的/ 状态/ 进行/ 快速/ 检测/ ./ 虚拟/ 链路/ 状态/ 检测/ 模块/ 通过/ 在/ 一条/ 虚拟/ 链路/ 的/ 两个/ 虚拟/ 实例/ 端点/ 之间/ 建立/ 会话/ 来/ 对/ 其/ 状态/ 进行/ 检测/ ,/ 包括/ 主动/ 检测/ 与/ 被动/ 检测/ 两种/ 方式/ [/ 16/ ]/ ./ 首先/ ,/ 虚拟/ 实例/ 对/ 之间/ 通过/ 握手/ 协议/ 协商/ 待/ 检测/ 的/ 链路/ 状态参数/ ./ 接着/ ,/ 检测/ 模块/ 为/ 虚拟/ 实例/ 双方/ 建立/ 会话/ 状态机/ ,/ 虚拟/ 实例/ 根据/ 会话/ 状态/ 周期性地/ 发送/ 探测/ 报文/ 并/ 接收/ 对端/ 回复/ 的/ 响应/ 报文/ ,/ 根据/ 报文/ 中/ 携带/ 的/ 信息/ 判断/ 虚拟/ 链路/ 的/ 当前/ 状态/ ./ 当/ 连续/ 多个/ 周期/ 未/ 收到/ 响应/ 报文/ 时/ ,/ 意味着/ 虚拟/ 链路/ 产生/ 故障/ ./ 这种/ 检测/ 方式/ 称为/ 主动/ 检测/ ./ 当/ 虚拟/ 链路/ 上/ 有/ 数据传输/ 时/ ,/ 可以/ 利用/ 数据/ 报文/ 来/ 判断/ 虚拟/ 链路/ 的/ 连通/ 状态/ ./ 在/ 虚拟/ 链路/ 上/ 传输/ 的/ 数据/ 报文/ 是/ 经过/ 封装/ 的/ ,/ 其/ IP/ 头/ 的/ 源地址/ 和/ 目的/ 地址/ 正是/ 虚拟/ 链路/ 两个/ 端点/ 的/ 地址/ ,/ 因此/ 通过/ 检查数据/ 报文/ 头部/ 的/ 源地址/ ,/ 就/ 可以/ 判断/ 数据/ 是否/ 来自/ 虚拟/ 链路/ 对/ 端的/ 实例/ ,/ 从而/ 确定/ 虚拟/ 链路/ 的/ 连通/ 状态/ ./ 这种/ 检测/ 方式/ 称为/ 被动/ 检测/ ./ 与/ 主动/ 检测/ 相比/ ,/ 被动/ 检测/ 降低/ 了/ 探测/ 报文/ 的/ 发送/ 开销/ ,/ 在/ 网络/ 拥塞/ 的/ 情况/ 下/ 可以/ 提高/ 探测/ 准确度/ ./ 通过/ 将/ 这/ 两种/ 机制/ 有机/ 结合/ 在/ 一起/ ,/ 虚拟/ 链路/ 状态/ 检测/ 模块/ 可以/ 达到/ 轻量/ 快速/ 的/ 检测/ 效果/ ./ 4.2/ 统一/ 数据/ 转发/ VegaNet/ 虚拟/ 路由器/ 采用/ 统一/ 的/ 数据/ 转发/ 机制/ 来/ 代替/ 各/ 虚拟/ 实例/ 内部/ 的/ 转发/ 功能/ ./ 其/ 核心思想/ 是/ 对/ 虚拟/ 实例/ 的/ 控制/ 平面/ 与/ 数据/ 平面/ 进行/ 分离/ ,/ 控制/ 平面/ 运行/ 在/ 各/ 实例/ 内部/ ,/ 负责/ 路由/ 计算/ ;/ 数据/ 平面/ 则/ 转移/ 至/ 虚拟/ 路由器/ 内核/ 中/ ./ 各/ 虚拟/ 实例/ 的/ 数据/ 平面/ 在/ 底层/ 构成/ 一个/ 统一/ 的/ 数据/ 转发/ 引擎/ ,/ 负责/ 本/ 虚拟/ 路由器/ 节点/ 上/ 所有/ 实例/ 的/ 数据/ 转发/ ./ 采用/ 统一/ 数据/ 转发/ 机制/ 的/ 虚拟/ 路由器/ 结构/ 如图/ 4/ 所示/ (/ 为/ 突出重点/ ,/ 此图/ 中/ 省略/ 了/ 图/ 2/ 管理/ 模块/ )/ ./ 各/ 虚拟/ 实例/ 的/ 控制/ 平面/ 运行/ 路由/ 协议/ ,/ 生成/ 路由表/ 项/ ,/ 并/ 定期/ 将/ 更新/ 后/ 的/ 转/ 发表/ 信息/ 发布/ 到/ 统一/ 转发/ 引擎/ 中/ ,/ 由/ 统一/ 转发/ 引擎/ 对/ 各/ 实例/ 的/ 转/ 发表/ 进行/ 组织/ 管理/ ./ 当/ 虚拟/ 路由器/ 上/ 的/ 物理/ 网卡/ 接收/ 到/ 发往/ 各/ 实例/ 的/ 虚拟/ 网络/ 分组/ 后/ ,/ 不会/ 将/ 其/ 递交/ 给/ 对应/ 的/ 虚拟/ 实例/ ,/ 而是/ 直接/ 在/ 统一/ 转发/ 引擎/ 中/ 完成/ 路由/ 查找/ ,/ 然后/ 将/ 虚拟/ 网络/ 分组/ 重新/ 通过/ 物理/ 网卡/ 发送到/ 物理/ 网络/ 中/ ./ Page6/ 统一/ 转发/ 引擎/ 中/ 的/ 数据/ 转发/ 流程/ 为/ :/ 首先/ 从/ 物理/ 网卡/ 上/ 获取数据/ 报文/ ,/ 对/ 其/ 进行/ 解/ 封装/ 处理/ 以/ 获得/ 内部/ 的/ 虚拟/ 网络/ 分组/ ,/ 然后/ 对/ 分组/ 进行/ 分类/ 以/ 取得/ 其/ 所属/ 的/ 虚拟/ 实例/ 编号/ ./ 接着/ ,/ 这些/ 虚拟/ 数据/ 分组/ 进入/ 统一/ 转发/ 引擎/ 的/ 路由/ 查找/ 模块/ 内/ ,/ 根据/ 虚拟/ 实例/ 编号/ 取得/ 对应/ 的/ 转/ 发表/ 进行/ 路由/ 查找/ ./ 查找/ 结束/ 后/ ,/ 分/ 组分/ 3/ 类/ 进行/ 处理/ ./ 如果/ 分组/ 的/ 目的/ 地址/ 为/ 各/ 虚拟/ 实例/ (/ 如/ 虚拟/ 实例/ 之间/ 交互/ 的/ 虚拟/ 网络/ 控制/ 报文/ )/ ,/ 需要/ 将/ 其经/ 虚拟/ 交换机/ 向上/ 递交/ 到/ 各/ 虚拟/ 实例/ ;/ 如果/ 分组/ 的/ 目的/ 地址/ 是/ 虚拟/ 路由器/ 的/ 主机/ 地址/ ,/ 则/ 将/ 其/ 递交/ 给/ 主机/ ;/ 对于/ 需要/ 向外/ 转发/ 的/ 虚拟/ 网络/ 分组/ ,/ 则/ 将/ 路由/ 查找/ 确定/ 的/ 下/ 一/ 跳/ 或/ 出/ 接口/ 转换/ 为/ 对应/ 的/ 虚拟/ 链路/ 起点/ 与/ 终点/ 地址/ ,/ 对/ 分组/ 进行/ 封装/ 后/ 将/ 其经/ 物理/ 网卡/ 发送至/ 下/ 一/ 跳/ 虚拟/ 实例/ ./ 统一/ 转发/ 引擎/ 的/ 核心/ 数据结构/ 是/ 各/ 虚拟/ 路由器/ 图/ 5/ 共享/ 转发/ 表示/ 例图/ 算法/ 1/ 为/ 基于/ 共享/ 转/ 发表/ 的/ 路由/ 查找/ 算法/ ./ 该/ 算法/ 以/ 虚拟/ 实例/ 的/ 编号/ id/ 和/ 分组/ 的/ 目的/ 地址/ addr/ 为/ 参数/ ,/ 返回/ 转/ 发表/ 项/ 在/ 该/ 虚拟/ 实例/ 转/ 发表/ 中/ 的/ 位置/ 下标/ key/ ./ 算法/ 从根/ 结点/ 开始/ ,/ 获取/ trie/ 树/ 当前/ 层/ 节点/ 中/ 与/ addr/ 匹配/ 的/ 分支/ branch/ (/ 第/ 5/ 行/ )/ ,/ 然后/ 找到/ 此/ 分支/ 对应/ 的/ 共享/ 索引/ 表/ sh/ _/ index/ (/ 第/ 6/ 行/ )/ ./ 如果/ 索引/ 表中/ 存在/ 对/ 编号/ 为/ id/ 的/ 转/ 发表/ 的/ 索引/ ,/ 则/ 将/ 查找/ 到/ 的/ 转/ 发表/ 项/ 下标/ 存入/ key/ (/ 第/ 8/ 行/ )/ ,/ key/ 中/ 永远/ 保存/ 到/ 当前/ 层/ 为止/ 最/ 匹配/ 的/ 查找/ 结果/ ./ 第/ 9/ 行将/ node/ 更新/ 为/ 其子/ 结点/ 后/ 进入/ 下/ 一轮/ 循环/ ,/ 直至/ 到达/ trie/ 树/ 的/ 叶/ 结点/ 后/ 退出/ 循环/ ,/ 这/ 保证/ 了/ 最长/ 前缀/ 匹配/ 的/ 路由/ 查找/ 原则/ ./ 第/ 10/ 行/ 返回/ 最终/ 查找/ 结果/ ./ 算法/ 1/ ./ 基于/ 共享/ 转/ 发表/ 的/ 路由/ 查找/ 算法/ ./ 输入/ :/ id/ ,/ addr/ 输出/ :/ key1/ ./ lookup/ (/ id/ ,/ addr/ )/ {/ 2/ ./ node/ =/ root3/ ./ key/ =/ -/ 1/ 实例/ 的/ 转/ 发表/ ./ 这些/ 转/ 发表/ 是/ 由/ 各/ 虚拟/ 实例/ 中/ 运行/ 的/ 路由/ 协议/ 动态/ 生成/ 的/ ,/ 转/ 发表/ 的/ 大小/ 、/ 结构/ 取决于/ 其/ 所属/ 虚拟/ 网络/ 的/ 规模/ 以及/ 所/ 采用/ 的/ 网络协议/ ./ 当/ 虚拟/ 路由器/ 上/ 各/ 虚拟/ 实例/ 的/ 转/ 发表/ 属性/ 不/ 同时/ (/ 如/ 同时/ 包含/ IP/ 转/ 发表/ 与/ NDN/ 转/ 发表/ )/ ,/ 各转/ 发表/ 在/ 统一/ 转发/ 引擎/ 中/ 独立/ 存储/ ./ 当/ 各/ 虚拟/ 实例/ 的/ 转/ 发表/ 属性/ 相同/ 时/ ,/ 我们/ 可以/ 将/ 这些/ 转/ 发表/ 组织/ 成/ 一个/ 共享/ 转/ 发表/ ,/ 实现/ 对/ 各转/ 发表/ 的/ 统一/ 索引/ ./ 以/ IP/ 转/ 发表/ 为例/ ,/ 其/ 共享/ 转/ 发表/ 结构/ 由/ 3/ 个/ 部分/ 组成/ ,/ 分别/ 是/ trie/ 树/ 、/ 共享/ 索引/ 表/ 和/ 各/ 虚拟/ 实例/ 的/ 转/ 发表/ (/ 图/ 5/ )/ ./ Trie/ 树/ 用于/ 组织/ 各/ 虚拟/ 实例/ 转/ 发表/ 的/ IP/ 前缀/ ,/ 每个/ 节点/ 包含/ 2n/ 个/ 分支/ (/ 1/ / n/ / 32/ )/ ,/ 可以/ 表示/ IP地址/ 中/ 的/ n/ 比特/ 位/ ./ Trie/ 树/ 结点/ 上/ 的/ 每个/ 分支/ 都/ 指向/ 一个/ 共享/ 索引/ 表/ ./ 共享/ 索引/ 表将/ 各/ 虚拟/ 实例/ 的/ 编号/ 作为/ 关键字/ 来/ 索引/ trie/ 树/ 前缀/ 分支/ 对应/ 在/ 该/ 虚拟/ 实例/ 中/ 的/ 转/ 发表/ 项/ 位置/ ./ 4/ ./ WHILE/ (/ node/ )/ 5/ ./ DObranch/ =/ get/ _/ branch/ (/ node/ )/ 6/ ./ sh/ _/ index/ =/ node/ [/ branch/ ]/ ./ sh7/ ./ IF/ (/ sh/ _/ index/ &&/ sh/ _/ index/ [/ id/ ]/ ./ real/ (/ )/ )/ 8/ ./ THENkey/ =/ sh/ _/ index/ [/ id/ ]/ ./ index9/ ./ node/ =/ node/ [/ branch/ ]/ ./ child10/ ./ RETURNkey11/ ./ }/ 以图/ 5/ 为例/ ,/ 如果/ 要/ 使用/ 虚拟/ 路由器/ VR1/ 对/ 目的/ 地址/ 为/ 255.252/ ./ 0.1/ 的/ 虚拟/ 网络/ 数据/ 分组/ 进行/ 转发/ ,/ 首先/ 自上而下/ 遍历/ trie/ 树/ ,/ 发现/ 与/ 255.252/ ./ 0.1/ 匹配/ 的/ 有/ 索引/ 的/ 最长/ 前缀/ 为/ 255.252/ ./ 0.0/ // 14/ ,/ 即/ trie/ 树/ 第/ 2/ 层/ 编号/ 为/ 254/ 的/ 分支/ ,/ 由此/ 查找/ 对应/ 的/ 共享/ 索引/ 表/ ,/ 得知/ 此/ 前缀/ 在/ 虚拟/ 转/ 发表/ VR1/ 中/ 的/ 下标/ 为/ 1/ ,/ 所以/ 此/ 分组/ 的/ 下/ 一/ 跳/ 为/ 11.3/ ./ 0.1/ ./ 统一/ 转发/ 引擎/ 避免/ 了/ 虚拟/ 网络/ 分组/ 从/ 物理/ 接口/ 定向/ 到/ 虚拟/ 接口/ 以/ 进入/ 虚拟/ 实例/ ,/ 在/ 虚拟/ 实例/ 中/ 完成/ 路由/ 查找/ 后/ 再/ 从/ 虚拟/ 接口/ 定向/ 到/ 物理/ 接口/ 以/ 进入/ 物理/ 网络/ 的/ 过程/ ,/ 降低/ 了/ 转发/ 开销/ ,/ 同时/ 基于/ 共享/ 转/ Page7/ 发表/ 的/ 统一/ 路由/ 查找/ 提高/ 了/ 路由/ 查找/ 效率/ ,/ 节约/ 了/ 转/ 发表/ 的/ 维护/ 成本/ ./ 此外/ ,/ 统一/ 转发/ 减轻/ 了/ 虚拟/ 实例/ 的/ 数据/ 平面/ 维护/ 负担/ ,/ 使/ 其能/ 将/ 资源/ 集中/ 用于/ 控制/ 平面/ 上/ 实验/ 协议/ 的/ 运行/ 与/ 维护/ ./ 5/ 虚拟/ 路由器/ 实现/ 5.1/ 原型/ 系统/ VegaNet/ 虚拟/ 路由器/ 原型/ 系统/ 的/ 系统结构/ 如图/ 6/ 所示/ ./ 原型/ 系统/ 采用/ CentOS/ ①/ 操作系统/ ,/ 使用/ Xen/ [/ 17/ ]/ 半/ 虚拟化/ 技术支持/ 虚拟/ 路由器/ 实例/ 的/ 创建/ 与/ 管理/ ,/ 其中/ ,/ Dom0/ 运行/ 虚拟/ 链路/ 状态/ 检测/ 模块/ 和/ 数据/ 统一/ 转发/ 引擎/ ,/ 各/ DomU/ 作为/ 虚拟/ 实例/ ,/ 主要/ 负责/ 维护/ 控制/ 平面/ ./ 虚拟/ 交换机/ 用于/ 支持/ Dom0/ 与/ DomU/ 之间/ 的/ 通信/ ./ 虚拟/ 路由器/ 上/ 各/ 虚拟/ 实例/ 的/ 控制/ 平面/ 采用/ 开源/ 路由/ 协议/ 套件/ Quagga/ ./ Quagga/ 支持/ RIP/ 、/ OSPF/ 等域/ 内/ 路由/ 协议/ ,/ 以及/ BGP/ 等域/ 间/ 路由/ 协议/ ./ 数据/ 统一/ 转发/ 引擎/ 利用/ 开源/ 的/ 模块化/ 软件/ 路由器/ 组件/ Clickmodularrouter/ [/ 9/ ]/ 构建/ ,/ 负责/ 所有/ 虚拟/ 实例/ 数据/ 报文/ 的/ 转发/ ./ Quagga/ 将/ 各/ 虚拟/ 实例/ 的/ 路由表/ 信息/ 经/ 虚拟/ 交换机/ 发送给/ 统一/ 转发/ 引擎/ ,/ 作为/ 其/ 分组/ 转发/ 的/ 依据/ ./ 虚拟/ 链路/ 状态/ 检测/ 模块/ 运行/ 在/ 虚拟/ 路由器/ Dom0/ 的/ 用户/ 空间/ 内/ ,/ 主要/ 包括/ 5/ 大/ 功能/ 体/ ./ 用户注册/ 模块/ 为/ 节点/ 上/ 的/ 虚拟/ 路由器/ 实例/ 提供/ 注册/ 服务/ ,/ 维护/ 各/ 实例/ 委托/ 检测/ 的/ 虚拟/ 链路/ 信息/ ./ 配置/ 数据库/ 保存/ 各/ 实例/ 对/ 检测/ 算法/ 的/ 配置/ 信息/ ./ 检测/ 状态机/ 是/ 一个/ 有限/ 状态机/ ,/ 用于/ 维护/ 各/ 虚拟/ 链路/ 的/ 会/ 话/ 状态/ ./ 检测/ 引擎/ 运行/ 状态/ 检测/ 算法/ ,/ 控制/ 物理/ 接口/ 上/ 探测/ 报文/ 的/ 收发/ ,/ 并/ 向/ 检测/ 状态机/ 通告/ 当前/ 链路/ 状态/ ./ 直接/ 在/ 物理/ 接口/ 上/ 收发/ 探测/ 报文/ 可以/ 避免/ 探测/ 报文/ 的/ 封装/ 和解/ 封装/ 操作/ ,/ 降低/ 数据/ 平面/ 处理/ 负担/ ,/ 减少/ 探测/ 报文/ 对/ 网络带宽/ 的/ 占用/ ./ 流量/ 监控/ 模块/ 利用/ Click/ 监控/ 各/ 实例/ 的/ 数据/ 流量/ ,/ 并/ 负责/ 按照/ 一定/ 的/ 调度/ 策略/ 对/ 数据/ 流量/ 进行/ 调整/ ,/ 使/ 其/ 满足/ 特定/ 的/ 流量/ 特征/ ./ 此外/ ,/ 流量/ 监控/ 模块/ 还/ 负责/ 将/ 流量/ 信息/ 通告/ 给/ 检测/ 状态机/ ,/ 辅助/ 链路/ 状态/ 的/ 检测/ ./ 5.2/ 网络/ 部署/ 目前/ ,/ 我们/ 在/ 北京/ 、/ 沈阳/ 、/ 上海/ 、/ 深圳/ 、/ 西安/ 、/ 成都/ 、/ 重庆/ 、/ 武汉/ 8/ 个/ 城市/ 的/ 10/ 所/ 高校/ 部署/ 了/ 12/ 台/ VegaNet/ 虚拟/ 路由器/ 节点/ ./ 这些/ 虚拟/ 路由器/ 通过/ 高校/ 驻地网/ 连接/ 到/ CERNET2/ ②/ 的/ 核心/ 路由器/ 上/ ,/ 可以/ 实现/ 对/ CERNET2/ 物理/ 网络/ 行为/ 的/ 模拟/ ./ 用户/ 通过/ 虚拟/ 路由器/ 的/ 配置/ 接口/ 来/ 创建/ 虚拟/ 路由器/ 实例/ ,/ 定制/ 实例/ 间/ 的/ 虚拟/ 链路/ 连通/ 关系/ ,/ 维护/ 虚拟/ 网络/ 的/ 路由/ 运行/ ./ VegaNet/ 虚拟/ 网络/ 规模/ 的/ 扩展/ 包括/ 横向/ 与/ 纵向/ 两个/ 维度/ ./ 横向/ 扩展/ 指/ 虚拟/ 路由器/ 节点/ 设备/ 在/ 物理/ 网络/ 上/ 的/ 增量/ 式/ 部署/ ,/ 纵向/ 扩展/ 是/ 指/ 通过/ 在/ 部署/ 好/ 的/ 虚拟/ 路由器/ 设备/ 上/ 创建/ 多个/ 虚拟/ 路由器/ 实例/ ,/ 来/ 构建/ 在/ 逻辑/ 上/ 完全/ 独立/ 的/ 多个/ 虚拟/ 网络/ 实验/ 环境/ ./ 6/ 实验/ 及/ 性能/ 评价/ 6.1/ 实验/ 环境/ 本章/ 对/ VegaNet/ 虚拟/ 路由器/ 的/ 虚拟/ 链路/ 状态/ 检测/ 模块/ 与/ 统一/ 数据/ 转发/ 模块/ 的/ 性能/ 进行/ 实验/ 评价/ ./ 一个/ 小型/ VegaNet/ 实验/ 环境/ 如图/ 7/ 所示/ ./ 在/ R1/ 、/ R2/ 和/ R3/ 这/ 3/ 台/ 物理/ 路由器/ 设备/ 上/ 分别/ 接入/ VR1/ 、/ VR2/ 和/ VR3/ 这/ 3/ 台/ 虚拟/ 路由器/ 设备/ ,/ 虚拟/ 路由器/ 采用/ IntelXeon/ 四核/ CPU/ 处理器/ ,/ 装配/ 16GB/ 内存/ ,/ 操作系统/ 采用/ CentOS5/ ./ 4/ ./ 在/ 各/ 虚拟/ 路由器/ ①/ ②/ Page8/ 上/ 使用/ xen/ 虚拟化/ 技术/ 安装/ 多个/ 虚拟/ 实例/ (/ 图中/ Dom1/ 、/ Dom2/ )/ ,/ 3/ 个/ Dom1/ 实例/ 与/ 3/ 个/ Dom2/ 实例/ 分别/ 通过/ IP/ -/ in/ -/ IP/ 隧道/ 封装/ 技术/ 构建/ 虚拟/ 链路/ ,/ 形成/ 两个/ 全/ 连接/ 的/ 虚拟/ 网络/ Vnet1/ 、/ Vnet2/ ./ 物理/ 网络/ 和/ 虚拟/ 网络/ 均/ 运行/ OSPF/ 路由/ 协议/ ./ PC1/ 、/ PC2/ 、/ PC3/ 分别/ 为/ 3/ 台/ 用户/ 终端/ ,/ 通过/ 直连/ 的/ 虚拟/ 路由器/ 接入/ 虚拟/ 网络/ ./ 6.2/ 虚拟/ 链路/ 状态/ 检测/ 实验/ 虚拟/ 链路/ 状态/ 检测/ 实验/ 首先/ 在/ CNGI/ -/ CERNET2/ 主干网/ 上/ 采集/ 真实/ 的/ 故障/ 数据/ ./ 我们/ 在/ CERNET2/ 的/ 8/ 个/ 接入点/ 部署/ 了/ 运行/ Traceroute/ 程序/ 的/ 分布式/ 并行/ 故障/ 采集/ 服务器/ ,/ 涵盖/ 了/ CERNET2/ 的/ 25/ 个/ 核心/ 节点/ 以及/ 62/ 条/ 主干/ 链路/ ./ 服务器/ 以/ 50ms/ 的/ 周期/ 并行/ 采集/ 邻近/ 链路/ 故障/ ,/ 采集/ 时间/ 持续/ 6/ 个/ 月/ ,/ 共/ 收集/ 到/ 12715/ 个/ 链路/ 故障/ 数据/ ./ 虚拟/ 链路/ 状态/ 检测/ 实验/ 将/ 这些/ 故障/ 数据/ 在/ 实验/ 平台/ 的/ 物理/ 网络/ 上/ 进行/ 重/ 放/ ,/ 以/ 评价/ 虚拟/ 网络/ 同步/ 跟踪/ 物理/ 网络/ 状态/ 变化/ 的/ 能力/ ,/ 并/ 在/ 此基础/ 上/ 评价/ 虚拟/ 网络/ 的/ 路由/ 收敛/ 效果/ ./ 为了/ 简化/ 实验/ 内容/ ,/ 我们/ 集中/ 在/ 图/ 7/ 的/ R1/ -/ R2/ 物理/ 链路/ 上/ 重现/ 故障/ ,/ 通过/ 禁用/ R1/ -/ R2/ 链路/ 的/ 数据传输/ 来/ 模拟/ 一个/ 故障/ ,/ 禁用/ 时间/ 即/ CERNET2/ 采集/ 到/ 的/ 实际/ 故障/ 持续时间/ ./ VR1/ 、/ VR2/ 上/ 的/ 检测/ 模块/ 对/ VR1/ -/ VR2/ 虚拟/ 链路/ 的/ 连通性/ 进行/ 检测/ ,/ 并/ 记录/ 检测/ 到/ 的/ 故障/ 发生/ 时刻/ 与/ 恢复/ 时刻/ 数据/ ./ 我们/ 使用/ 检测/ 延迟时间/ 变量/ 来/ 刻画/ 虚拟/ 网络/ 同步/ 跟踪/ 物理/ 网络/ 状态/ 变化/ 的/ 能力/ ./ 故障/ 检测/ 延迟时间/ 定义/ 为/ VegaNet/ 虚拟/ 路由器/ 检测/ 到/ 故障/ 发生/ 的/ 时刻/ 与/ 物理/ 链路/ 实际/ 发生/ 故障/ 的/ 时刻/ 的/ 差值/ ,/ 故障/ 恢复/ 检测/ 延迟时间/ 定义/ 为/ VegaNet/ 虚拟/ 路由器/ 检测/ 到/ 故障/ 恢复/ 的/ 时刻/ 与/ 物理/ 链路/ 故障/ 实际/ 的/ 恢复/ 时刻/ 的/ 差值/ ./ 检测/ 参数/ 配置/ 为/ :/ 探测/ 报文/ 的/ 发送/ 和/ 接收/ 周期/ 为/ 50ms/ ,/ 最大/ 允许/ 未/ 收到/ 探测/ 报文/ 的/ 周期/ 数为/ 3/ ./ 故障/ 事件/ 检测/ 延迟/ 的/ 累积/ 分布/ 如图/ 8/ 所示/ ,/ 故障/ 恢复/ 事件/ 检测/ 延迟/ 的/ 累积/ 分布/ 如图/ 9/ 所示/ ./ 从图/ 中/ 可以/ 看出/ ,/ 故障/ 检测/ 延迟时间/ 主要/ 集中/ 在/ [/ 90/ ,/ 135/ ]/ ms/ 区间/ 内/ ,/ 故障/ 恢复/ 检测/ 延迟时间/ 主要/ 集中/ 在/ [/ 45/ ,/ 95/ ]/ ms/ 区间/ 内/ ,/ 二者/ 均/ 呈现/ 均匀/ 的/ 分布/ 态势/ ./ 大约/ 85/ %/ 以上/ 的/ 故障/ 事件/ 可以/ 在/ 120ms/ 内/ 完成/ 检测/ ,/ 97/ %/ 以上/ 的/ 故障/ 恢复/ 事件/ 可以/ 在/ 100ms/ 内/ 完成/ 检测/ ./ 这/ 说明/ 虚拟/ 链路/ 状态/ 检测/ 模块/ 能够/ 在/ 合理/ 的/ 检测/ 参数/ 配置/ 下/ 快速/ 感知/ 物理/ 网络/ 的/ 故障/ 发生/ 与/ 恢复/ 事件/ ./ 当/ 虚拟/ 链路/ 状态/ 检测/ 模块/ 检测/ 到/ 链路/ 故障/ 时/ ,/ 虚拟/ 实例/ 会/ 重新/ 进行/ 路由/ 计算/ ./ 同样/ 地/ ,/ 链路/ 故障/ 也/ 会/ 引发/ 物理/ 路由器/ 重新/ 计算/ 路由/ ./ 出于/ 公平性/ 考虑/ ,/ 我们/ 将/ 链路/ 状态/ 检测/ 算法/ 移植/ 到/ 物理/ 路由器/ 上/ ,/ 然后/ 以/ OSPF/ 路由/ 协议/ 为例/ 对/ 物理/ 网络/ 和/ VegaNet/ 虚拟/ 网络/ 上/ 的/ 路由/ 收敛/ 时间/ 进行/ 对比/ 实验/ ./ 图/ 10/ 的/ 实验/ 结果表明/ 虚拟/ 实例/ 的/ 路由/ 收敛/ 时间/ 和/ 对应/ 物理/ 路由器/ 的/ 收敛/ 时间/ 非常/ 接近/ ./ 由于/ 虚拟/ 链路/ 比/ 物理/ 链路/ 经过/ 了/ 更/ 多/ 的/ 物理/ 交换/ 设备/ ,/ 因此/ 虚拟/ 网络/ 的/ 路由/ 收敛/ 时间/ 整体/ 上/ 比/ 物理/ 网络/ 慢/ 13/ %/ 左右/ ./ 如果/ 虚拟/ 网络/ 没有/ 采用/ 虚拟/ 链路/ 状态/ 检测/ 机制/ ,/ 则/ 底层/ 物理/ 链路/ 的/ 故障/ 会/ 被/ 物理/ 路由器/ 上/ 快速/ 的/ 重/ 路由/ 屏蔽/ ,/ 虚拟/ 网络/ 就/ 无法/ 感知/ 到/ 实际/ 网络/ 状态/ 的/ 改变/ ./ 这/ 充分说明/ 虚拟/ 链路/ 状态/ 检测/ 机制/ 对/ 确保/ VegaNet/ 虚拟/ 路由器/ 的/ 保/ 真性/ 起到/ 了/ 重要/ 作用/ ./ Page9/ 图/ 11/ 展示/ 了/ 在/ 路由/ 收敛/ 期间/ R1/ -/ R2/ 物理/ 链路/ 和/ VR1/ -/ VR2/ 虚拟/ 链路/ 上/ 分组/ 的/ 往返/ 传输/ 时间/ (/ Round/ -/ TripTime/ ,/ RTT/ )/ 变化/ 情况/ ./ 前/ 50s/ 内/ ,/ 两条/ 链路/ 上/ 的/ RTT/ 值/ 稳定/ 地/ 保持/ 在/ 较/ 低/ 水平线上/ ./ 50s/ 时/ R1/ -/ R2/ 链路/ 发生/ 故障/ ,/ 物理/ 网络/ 和/ 虚拟/ 网络/ 均/ 迅速/ 检测/ 到/ 了/ 故障/ 事件/ 并/ 重新/ 计算/ 路由/ ./ 此后/ ,/ R1/ ~/ R2/ 的/ 路由/ 切换/ 为/ R1/ -/ R3/ -/ R2/ ,/ VR1/ ~/ VR2/ 的/ 路由/ 切换/ 为/ VR1/ -/ VR3/ -/ VR2/ ,/ 路径/ 的/ 拉长/ 使/ 两者/ 的/ RTT/ 值/ 增大/ ,/ 且/ 波动/ 更加/ 明显/ ./ 192s/ 以后/ R1/ -/ R2/ 链路/ 故障/ 恢复/ ,/ 虚拟/ 网络/ 和/ 物理/ 网络/ 的/ 路由/ 均/ 恢复/ 到/ 初始状态/ ,/ RTT/ 值/ 也/ 重新/ 恢复/ 到/ 50s/ 前/ 的/ 趋势/ ./ 这/ 说明/ VegaNet/ 虚拟/ 网络/ 具有/ 模拟/ 物理/ 网络故障/ 事件/ 的/ 能力/ ,/ 且/ 二者/ 具有/ 一致/ 的/ 变化规律/ ./ 为了/ 验证/ VegaNet/ 在/ 大规模/ 网络/ 环境/ 下/ 的/ 保/ 真性/ ,/ 我们/ 进一步/ 在/ 仿真/ 平台/ NS2/ 上/ 实现/ 了/ 虚拟/ 链路/ 状态/ 检测/ 机制/ ./ 我们/ 引入/ GEANT/ ①/ 和/ Abilene/ ②/ 网络/ 作为/ 底层/ 物理/ 网络/ ,/ 使用/ 二者/ 的/ 真实/ 拓扑/ 以及/ 真实/ 流量/ 进行/ 模拟实验/ ,/ 实验/ 结果/ 与/ 图/ 8/ 和/ 图/ 9/ 的/ 结果/ 基本/ 吻合/ ./ 这/ 表明/ 在/ 大规模/ 网络/ 环境/ 中/ 虚拟/ 路由器/ 的/ 链路/ 状态/ 检测/ 机制/ 仅/ 引入/ 了/ 较/ 小/ 的/ 故障/ 检测/ 延迟/ 与/ 故障/ 恢复/ 检测/ 延迟/ ,/ 具备/ 实时/ 检测/ 网络/ 状态/ 的/ 能力/ ./ 6.3/ 统一/ 数据/ 转发/ 实验/ 统一/ 数据/ 转发/ 实验/ 采用/ 图/ 7/ 的/ 实验/ 环境/ 来/ 测量/ 虚拟/ 路由器/ 的/ 实际/ 转发/ 性能/ ./ 实验/ 使用/ ping/ 命令/ 在/ VR1/ 和/ VR3/ 上/ 的/ 虚拟/ 路由器/ 实例/ 间/ 进行/ 数据/ 交互/ ,/ 所有/ 的/ 数据/ 流量/ 均/ 通过/ VR2/ 进行/ 转发/ ./ VR2/ 上/ 提供/ 两种/ 数据/ 转发/ 服务/ ,/ 第/ 1/ 种/ 采用/ 本文/ 设计/ 的/ 统一/ 转发/ 引擎/ ,/ 各/ 虚拟/ 网络/ 分组/ 在/ Dom0/ 上/ 统一/ 完成/ 路由/ 查找/ 与/ 转发/ ;/ 第/ 2/ 种即/ 传统/ 的/ 转发/ 方式/ ,/ 到达/ VR2/ 的/ 虚拟/ 网络/ 分组/ 分别/ 进入/ 相应/ 的/ 虚拟/ 实例/ (/ DomU/ )/ 完成/ 转发/ ./ 我们/ 在/ VR1/ 的/ 虚拟/ 实例/ 上/ 获取/ 分组/ 在/ 两种/ 转发/ 机制/ 下/ 的/ RTT/ 时间/ ,/ 通过/ RTT/ 的/ 对比/ 来/ 衡量/ 统一/ 转发/ 引擎/ 的/ 转发/ 性能/ ,/ 并/ 通过/ 扩展/ 实验/ 平台/ 上/ 部署/ 的/ 虚拟/ 实例/ 数量/ ,/ 测试/ 在/ 多个/ 虚拟/ 网络/ 共存/ 的/ 环境/ 下/ 统一/ 转发/ 引擎/ 的/ 转发/ 性能/ ./ 首先/ 测试/ 只有/ 1/ 个/ 虚拟/ 网络/ Vnet1/ 时/ 统一/ 转发/ 引擎/ 的/ 性能/ ./ 我们/ 在/ VR1/ 的/ 虚拟/ 实例/ Dom1/ 上以/ 0.01/ s/ 的/ 发包/ 间隔/ 向/ VR3/ 上/ 的/ 虚拟/ 实例/ Dom1/ 连续/ 发送/ 1000/ 个长/ 为/ 10000Bytes/ 的/ 分组/ ,/ 分别/ 记录/ 下/ 使用/ VR2/ 统一/ 转发/ 引擎/ (/ 统一/ 转发/ )/ 和/ 使用/ VR2/ 上/ 虚拟/ 实例/ Dom1/ 进行/ 转发/ (/ 虚拟/ 实例/ 转发/ )/ 时/ 分组/ 的/ RTT/ 变化/ 情况/ ,/ 如图/ 12/ 所示/ ./ 图/ 12/ 统一/ 转发/ 与/ 虚拟/ 实例/ 转发/ 的/ RTT/ 对比/ 图图/ 12/ 中/ ,/ 使用/ 统一/ 转发/ 引擎/ 时/ ,/ RTT/ 的/ 最小值/ 、/ 平均值/ 、/ 最大值/ 分别/ 为/ 4.719/ ms/ 、/ 5.381/ ms/ 、/ 5.477/ ms/ ,/ 标准差/ 为/ 0.086/ ms/ ,/ 使用/ 虚拟/ 实例/ 转发/ 时/ ,/ RTT/ 的/ 最小值/ 、/ 平均值/ 、/ 最大值/ 分别/ 为/ 6.375/ ms/ 、/ 6.991/ ms/ 、/ 0.166/ ms/ ,/ 标准差/ 为/ 11.243/ ms/ ,/ 这/ 说明/ 统一/ 转发/ 引擎/ 有效/ 地/ 降低/ 了/ 虚拟/ 网络/ 数据包/ 的/ 转发/ 延迟/ ,/ 提高/ 了/ 虚拟/ 路由器/ 的/ 转发/ 性能/ ,/ 平均/ 性能/ 提高/ 约/ 为/ 23/ %/ ./ 图/ 12/ 中/ ,/ 统一/ 转发/ 的/ RTT/ 波动/ 相对/ 虚拟/ 实例/ 转发/ 而言/ 更加/ 平稳/ ,/ 我们/ 猜想/ 这/ 是因为/ 统一/ 转发/ 引擎/ 在/ Dom0/ 中/ 进行/ 数据/ 转发/ ,/ 受到/ 上层/ 虚拟/ 实例/ 系统/ 负载/ 的/ 影响/ 较/ 小/ ,/ 从而/ 保证/ 了/ 更为/ 稳定/ 的/ 数据/ 转发/ ./ 为了/ 验证/ 这一/ 猜想/ ,/ 我们/ 在/ VR2/ 的/ 实例/ Dom1/ 上/ 运行/ 了/ 大量/ 的/ 额外/ 计算/ 任务/ ,/ 在/ 此/ 背景/ 下/ 重复/ 上面/ 的/ 实验/ ,/ 图/ 13/ 展示/ 了/ 在/ 500s/ 内/ 两种/ 转发/ 模式/ 的/ CPU/ 利用率/ 变化/ 情况/ ./ 图中/ 虚拟/ 实例/ 转发/ 方式/ 只/ 在/ 很/ 短/ 的/ 时间/ 范围/ 内/ 抢占/ 到/ CPU/ 资源/ ,/ 其余/ 时间/ CPU/ 利用率/ 均/ 为/ 0/ ,/ 而/ 统一/ 转发/ 方式/ 则/ 在/ 大部分/ 时间/ 里/ 占有/ 了/ CPU/ 资源/ ,/ 且/ CPU/ 利用率/ 稳定/ 维持/ 在/ 20/ %/ 左右/ ./ ①/ ②/ Page10/ 图/ 14/ 展示/ 了/ 当/ VR2/ 上/ 有/ 1/ ~/ 6/ 个/ 携带/ 其他/ 计算/ 任务/ 的/ 虚拟/ 实例/ 进行/ 数据/ 转发/ 时/ ,/ 两种/ 转发/ 模式/ 的/ RTT/ 平均值/ 对比/ 情况/ ./ 可以/ 看出/ ,/ 随着/ 实例/ 个数/ 的/ 增多/ ,/ 统一/ 转发/ 方式/ 下/ RTT/ 时间/ 基本/ 保持/ 平稳/ ,/ 而/ 使用/ 虚拟/ 实例/ 转发/ 时/ RTT/ 时间/ 迅速/ 增大/ 到/ 上百/ 毫秒/ ,/ 严重/ 影响/ 转发/ 性能/ ./ 这/ 说明/ ,/ 相对/ 于/ 在/ 各/ 虚拟/ 实例/ 内/ 转发/ 虚拟/ 网络/ 分组/ 的/ 方式/ ,/ 统一/ 转发/ 引擎/ 能为/ 虚拟/ 网络/ 的/ 数据/ 转发/ 提供/ 更为/ 可靠/ 的/ 服务质量/ 保证/ ./ 7/ 总结/ 本文/ 介绍/ 了/ VegaNet/ 网络/ 虚拟/ 路由器/ 的/ 设计/ 与/ 实现/ 方案/ ./ 本文/ 所/ 提出/ 的/ 虚拟/ 路由器/ 设计/ 满足/ 大规模/ 虚拟/ 网络/ 实验/ 环境/ 的/ 5/ 大/ 需求/ :/ (/ 1/ )/ 保/ 真性/ :/ 虚拟/ 路由器/ 上/ 的/ 虚拟/ 链路/ 状态/ 检测/ 机制/ 能够/ 以较/ 低/ 的/ 报文/ 开销/ 对/ 虚拟/ 链路/ 的/ 状态/ 进行/ 快速/ 检测/ ,/ 保证/ 虚拟/ 网络/ 与/ 物理/ 网络/ 的/ 状态/ 一致性/ ;/ (/ 2/ )/ 高效性/ :/ Vega/ -/ Net/ 虚拟/ 路由器/ 使用/ 统一/ 转发/ 引擎/ 为/ 不同/ 虚拟/ 网络/ 上/ 的/ 数据流/ 提供/ 统一/ 的/ 转发/ 服务/ ,/ 提高/ 了/ 虚拟/ 网络/ 的/ 分组/ 转发/ 效率/ ;/ (/ 3/ )/ 可控性/ :/ 虚拟/ 路由器/ 允许/ 用户/ 根据/ 实验/ 需求/ 定制/ 个性化/ 的/ 虚拟/ 实验/ 环境/ ;/ (/ 4/ )/ 隔离/ 性/ :/ 虚拟/ 路由器/ 作为/ 终端/ 主机/ 接入/ 物理/ 网络/ ,/ 不会/ 干扰/ 物理/ 网络/ 的/ 正常/ 运行/ ,/ 同时/ ,/ 虚拟/ 路由器/ 上/ 的/ 各/ 虚拟/ 实例/ 间/ 彼此/ 隔离/ ,/ 可以/ 独立/ 运行/ 不同/ 的/ 实验/ ;/ (/ 5/ )/ 可扩展性/ :/ 经济/ 的/ 软件/ 路由器/ 技术/ 与/ 基于/ 隧道/ 的/ 虚拟/ 链路/ 构造/ 技术/ 使得/ VegaNet/ 虚拟/ 路由器/ 支持/ 在/ 物理/ 网络/ 上/ 的/ 增量/ 部署/ 与/ 网络拓扑/ 的/ 动态/ 更新/ ./ 采用/ 真实/ 网络/ 数据/ 的/ 实验/ 结果表明/ ,/ VegaNet/ 虚拟/ 路由器/ 具备/ 实时/ 链路/ 状态/ 检测/ 能力/ 与/ 高效/ 数据/ 转发/ 能力/ ,/ 可以/ 为/ 下一代/ 互联网/ 体系结构/ 的/ 研究/ 提供/ 有效/ 的/ 实验/ 平台/ 支持/ ./ VegaNet/ 虚拟/ 路由器/ 的/ 下/ 一步/ 工作/ 主要/ 致力于/ 以下/ 两个/ 方面/ :/ (/ 1/ )/ 提供/ 更/ 方便/ 的/ 用户/ 操作/ 接口/ ,/ 实现/ 各/ 虚拟/ 网络/ 的/ 统一/ 远程/ 配置/ 与/ 管理/ ;/ (/ 2/ )/ 在/ 路由/ 模块/ 上/ 支持/ 更/ 多/ 的/ 创新/ 网络体系结构/ ,/ 如/ ICN/ 和/ OpenFlow/ 等/ ./ 

