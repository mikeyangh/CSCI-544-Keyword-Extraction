Page1/ 一种/ 基于/ DOCSIS/ 上行/ 信道/ 的/ 自/ 适应/ 补偿/ 定时/ 同步/ 算法/ 王沁/ 1/ )/ 郭艳飞/ 1/ )/ 宋丽华/ 1/ )/ ,/ 2/ )/ 杜/ 立国/ 1/ )/ 1/ )/ (/ 北京科技大学/ 信息/ 工程学院/ 北京/ 100083/ )/ 2/ )/ (/ 北方工业大学/ 信息/ 工程学院/ 北京/ 100144/ )/ 摘要/ 基于/ DOCSIS/ 规范/ ,/ 在/ 分析/ CM/ (/ CableModem/ )/ 定时/ 同步/ 机制/ 的/ 基础/ 上/ ,/ 文中/ 首先/ 提出/ 了/ 一种/ 自/ 适应/ 补偿/ 定时/ 同步/ 算法/ ./ 通过/ 准确/ 预测/ 定时/ 误差/ 发生/ 时刻/ 并/ 及时/ 给予/ 误差/ 补偿/ ,/ 该/ 算法/ 能够/ 使/ CM/ 在/ HFC/ 网络/ 上行/ TDMA/ 信道/ 上/ 与/ CMTS/ 建立/ 精确/ 的/ 全局/ 定时/ 同步/ ,/ 为/ CM/ 正确/ 接入/ 信道/ 并/ 实现/ 业务/ 传输/ 提供/ 了/ 保证/ ./ 其次/ ,/ 文中/ 进一步/ 将/ 算法/ 包含/ 的/ 乘除/ 运算/ 优化/ 为/ 加减/ 运算/ ,/ 提高/ 算法/ 的/ 通用性/ ,/ 降低/ 其/ 实现/ 的/ 复杂度/ ./ 该/ 算法/ 目前/ 已经/ 应用/ 在/ 一款/ 自主/ 研发/ 的/ CMSoC/ 芯片/ 中/ ,/ 实际/ 环境/ 测试/ 结果表明/ 该/ 算法/ 的/ 定时/ 精度/ 为/ DOCSIS/ 要求/ 的/ 10.24/ 倍/ ,/ 并/ 表现/ 出/ 优良/ 的/ 可靠性/ ./ 关键词/ 定时/ 同步/ ;/ HDTV/ ;/ DOCSIS/ ;/ CM/ ;/ 混合/ 同轴/ 光纤/ 1/ 引言/ HFC/ (/ HybridFiber/ -/ Coax/ ,/ 混合/ 同轴/ 光纤/ )/ 宽带接入/ 是/ 广电/ 行业/ 发展/ 起来/ 的/ 一种/ 重要/ 宽带接入/ 技术/ ,/ 其/ 充分利用/ HFC/ 网络覆盖/ 范围广/ 、/ 高/ 宽带/ ,/ 能/ 同时/ 传输/ 语音/ 、/ 数据/ 、/ 视频/ 等/ 信息/ 的/ 特点/ ,/ 使/ 其/ 成为/ “/ 三网/ 融合/ ”/ 的/ 最佳/ 解决/ 平台/ 之一/ ./ 利用/ HFC/ 可以/ 方便/ 地/ 开展/ 基于/ IP/ 的/ 各种/ 业务/ ,/ 如/ VOIP/ 、/ VOD/ 、/ I/ -/ HDTV/ (/ 交互式/ 高清晰/ 数字电视/ )/ 、/ ITV/ (/ 普通/ 交互式/ 有线电视/ )/ 、/ 高速/ Web/ 浏览/ 等/ 业务/ ,/ 使/ CATV/ 用户/ 从/ HFC/ 网络/ 的/ 多/ 数据业务/ 中/ 获得/ 真正/ 的/ 多媒体/ 数字/ 高速公路/ ./ 目前/ 负责/ 制定/ HFC/ 技术/ 相关/ 标准/ 的/ 组织/ 主要/ 有/ 3/ 家/ :/ DVB/ // DAVIC/ 、/ IEEE802/ ./ 14/ 小组/ 和/ MCNS/ (/ 多媒体/ 电缆/ 网络系统/ )/ ,/ 其中/ 最有/ 影响力/ 的/ 是/ MCNS/ 制定/ 的/ DOCSIS/ 协议/ 标准/ ,/ 该/ 标准/ 已经/ 被/ 正式/ 纳入/ ITU/ -/ T/ (/ ITU/ -/ TJ/ ./ 112B/ )/ 标准/ ./ 本文/ 以/ HFC/ 网络/ 双向/ 接入/ 核心/ 设备/ CM/ (/ CableModem/ )/ 的/ SoC/ (/ SystemonChip/ )/ 芯片/ 开发/ 为/ 背景/ ,/ 重点/ 研究/ 了/ DOCSIS/ 协议/ MAC/ 层/ 上行/ 信道/ 接入/ 的/ 关键技术/ —/ —/ —/ 定时/ 同步/ 技术/ ,/ 并/ 提出/ 了/ 一种/ 自/ 适应/ 补偿/ 定时/ 同步/ 算法/ (/ AdaptiveCompensationTim/ -/ ingSynchronizationAlgorithm/ ,/ ACTSA/ )/ ,/ 该/ 算法/ 能够/ 高效/ 、/ 精准/ 地/ 实现/ 上行/ 时分复用/ (/ TimeDivisionMultipleAccess/ ,/ TDMA/ )/ 信道/ 全局/ 定时/ ,/ 为/ CM/ 能够/ 精确/ 接入/ 信道/ 并/ 实现/ 数字/ 业务/ 奠定/ 了/ 基础/ ./ 本文/ 第/ 2/ 节/ 简要/ 介绍/ DOCSIS/ 上行/ 信道/ 接入/ 机制/ ;/ 第/ 3/ 节/ 详细/ 阐述/ 自/ 适应/ 补偿/ 定时/ 同步/ 算法/ 及其/ 优化/ ;/ 第/ 4/ 节/ 详细/ 介绍/ 算法/ 的/ 实现/ 、/ 测试/ 及/ 性能/ 分析/ ;/ 最后/ 为/ 全文/ 总结/ ./ 2DOCSIS/ 上行/ 信道/ 接入/ 机制/ 分析/ 2.1/ HFC/ 网络系统/ 拓扑/ 结构/ 双向/ HFC/ 网络系统/ 拓扑/ 结构/ 如图/ 1/ 所示/ ,/ 其/ 主要/ 由/ 3/ 部分/ 组成/ :/ 物理/ 传输/ 介质/ (/ 光纤/ 或/ 同轴/ )/ 、/ 图/ 2/ 上行/ 信道/ 带宽/ 分配/ 模型/ 若干/ CM/ 和/ 一个/ 电缆/ 调制/ 解调/ 终端/ 系统/ (/ CableModemTerminationSystem/ ,/ CMTS/ )/ ./ CMTS/ 是/ HFC/ 网络/ 的/ 中央/ 控制/ 机构/ ./ HFC/ 网络/ 采用/ 频分/ 复用技术/ ,/ 将/ 5/ ~/ 1000MHz/ 的/ 频段/ 分割/ 分为/ 上行/ 和/ 下行/ 信道/ ,/ 5/ ~/ 65MHz/ 为/ 上行/ 信道/ ,/ 87/ ~/ 1000MHz/ 为/ 下行/ 信道/ ./ HFC/ 网络/ 的/ 下行/ 信道/ 是/ 一对/ 多/ 的/ 树型/ 分支/ 结构/ ,/ CMTS/ 是/ 该/ 方向/ 上/ 的/ 唯一/ 发送/ 端/ ,/ 其以/ MPEG/ -/ 2/ 格式/ 将/ 各种/ 数据/ 和/ 管理/ 信息/ 广播/ 给/ 下行/ 信道/ 上/ 的/ CM/ ./ 上行/ 信道/ 是/ 多/ 对/ 一/ 的/ 总线结构/ ,/ 多个/ CM/ 共享/ 同一个/ 上行/ 信道/ ,/ 在/ CMTS/ 的/ 调度/ 下以/ TDMA/ 的/ 方式/ 接入/ 信道/ ./ 2.2/ DOCSIS/ 上行/ 信道/ 带宽/ 分配机制/ 为了/ 解决/ 上行/ 共享/ 信道/ 的/ 资源/ 占用/ 和/ 带宽/ 分配/ 问题/ ,/ DOCSIS/ 规范/ 定义/ 了/ MAC/ 层/ 协议/ 来/ 合理/ 分配/ 上行/ 带宽/ 资源/ ,/ 实现/ CM/ 的/ 随机/ 接入/ ,/ 并/ 解决/ 竞争/ 冲突/ ./ 其/ 采用/ TDMA/ 技术/ 将/ 上行/ 信道/ 模型/ 化为/ 一连串/ 的/ 微/ 时隙/ 流/ ,/ 并/ 采用/ 上行/ 带宽/ 分配/ 表/ MAP/ 管理机制/ ,/ 将/ 未来/ 一段时间/ 内/ 的/ 上行/ 带宽/ 微/ 时隙/ 分配情况/ 描述/ 在/ MAP/ 管理/ 报文/ 中/ ,/ 通过/ 下行/ 信道/ 广播/ 给/ 共享/ 同一/ 上行/ 信道/ 的/ CM/ ./ MAP/ 定义/ 了/ 3/ 类/ 基本/ 微/ 时隙/ ,/ 如图/ 2/ 所示/ ./ 维护/ 时隙/ 用于/ 测距/ ,/ 其中/ 初始/ 维护/ 时隙/ 为/ CM/ 竞争/ 接入/ 网络/ 提供/ 传输/ 机会/ ,/ 站/ 维护/ 时隙/ 为/ CM/ 进行/ 常规/ 网络/ 维护/ 及/ 获取/ 定时/ 偏移/ 提供/ 传输/ 机会/ ./ 数据/ 预留/ 时隙/ 为/ 指定/ CM/ 提供/ 专用/ 上行/ 数据传输/ 机会/ ./ 竞争/ 时隙/ 为/ CM/ 争用/ 上行/ 信道/ 提供/ 传输/ 机会/ ./ 其中/ ,/ 在/ 数据/ 预留/ 时隙/ 和/ 站/ 维护/ 时隙/ CM/ 独占/ 上行/ 信道/ 不会/ 产生/ 传输/ 冲突/ ./ 而/ 在/ 竞争/ 时隙/ 和/ 初时/ 维护/ 时隙/ 多个/ CM/ 争用/ 信道/ 传输/ ,/ 因此/ Page3/ 会/ 引起/ 冲突/ ,/ 由于/ HFC/ 网络/ 上/ 、/ 下行/ 信道/ 在/ 频段/ 上/ 相互/ 隔离/ ,/ 处于/ 分支/ 节点/ 处/ 的/ CM/ 无法/ 监听/ 上行/ 信道/ 的/ 信号/ ,/ 也/ 就/ 不能/ 采用/ 以太网/ 的/ 载波/ 监听/ 多路/ 访问/ // 冲突检测/ (/ CSMA/ // CD/ )/ 机制/ ,/ 而是/ 采用/ 二进制/ 指数/ 退避/ 竞争/ 算法/ 来/ 解决/ 传输/ 冲突/ ./ 2.3/ DOCSIS/ 上行/ 信道/ 定时/ 同步/ 机制/ CM/ 为了/ 识别/ MAP/ 中/ 描述/ 的/ 带宽/ 分配/ 微/ 时隙/ ,/ 并/ 使/ 其/ 上行/ 传输/ 能够/ 在/ 指定/ 的/ 微/ 时隙/ 内/ 到达/ CMTS/ ,/ CM/ 必须/ 在/ 本地/ 与/ CMTS/ 建立/ 精确/ 的/ 定时/ 同步/ ,/ 如此/ CM/ 需要/ 完成/ 如下/ 两步/ 工作/ :/ (/ 1/ )/ 建立/ 全局/ 定时/ 基准/ ./ CMTS/ 周期性地/ 在/ 下行/ 信道/ 广播时间/ 戳/ (/ TimeStamp/ ,/ TS/ )/ 同步/ 报文/ SYNC/ (/ 见图/ 2/ )/ ,/ CM/ 必须/ 将/ 本地/ 实际/ 时间/ 与/ 收到/ 的/ 时间/ 戳/ 相/ 比较/ ,/ 并/ 调整/ 它们/ 各自/ 的/ 定时/ 基准/ ./ (/ 2/ )/ 获得/ 定时/ 偏移/ ./ CM/ 必须/ 在/ 初时/ 维护/ 和/ 站/ 维护/ 时隙/ 进行/ 测距/ ,/ 以/ 获得/ 定时/ 偏移/ Δ/ T/ 解决/ 信道/ 延迟/ 补偿/ ./ 如图/ 2/ 所示/ ,/ 为/ 使/ 测距/ 请求/ (/ RNG/ -/ REQ/ )/ 、/ 数据/ 请求/ (/ DATA/ -/ REQ/ )/ 以及/ 上行/ 数据/ 帧/ (/ DATA/ )/ 能够/ 在/ 指定/ 时隙/ 内/ 到达/ CMTS/ ,/ CM/ 必须/ 在/ 本地/ 定时/ 基准/ t5/ 、/ t8/ 和/ t11/ 时刻/ 提前/ Δ/ T/ 开始/ 其/ 传输/ ./ 关于/ 测距/ 机制/ 详细/ 介绍/ 参见/ 文献/ [/ 1/ ]/ ./ 3/ 全局/ 定时/ 同步/ 算法/ 3.1/ 全局/ 定时/ 误差/ 分析/ 全局/ 定时/ 基准/ 建立/ 过程/ 中/ CMTS/ 的/ TS/ 表示/ 的/ 是/ 这样/ 一瞬间/ 的/ 定时/ 计数/ 状态/ :/ 时间/ 同步/ 报文/ SYNC/ 的/ 第一/ 字节/ 从/ 下行/ 传输/ 汇集/ 层到/ 物理/ 媒介/ 依赖/ 子层/ 时/ ,/ CMTS/ 内以/ 10.24/ MHz/ 时钟/ 为/ 基准/ 的/ 32/ 位/ 计数器/ 的/ 计数/ 状态/ ./ 理想/ 情况/ 下/ ,/ CM/ 同样/ 建立/ 10.24/ MHz/ 的/ 32/ 位/ 定时/ 计数器/ ,/ 并/ 根据/ 收到/ 的/ TS/ 更新/ 该/ 定时器/ 便/ 可/ 建立/ 全局/ 定时/ 基准/ ./ 设/ t/ 为/ 某次/ TS/ 到达/ CM/ 时刻/ ,/ 此时/ CMTS/ 和/ CM/ 全局/ 定时器/ 计/ 数值/ 分别/ Tcmts/ 和/ Tcm/ ,/ 上下行/ 的/ 传输/ 及/ 物理层/ 处理/ 延迟/ 分别/ 为/ Δ/ Tu/ 和/ Δ/ Td/ ,/ 测距/ 获/ 的/ 定时/ 偏移/ Δ/ T/ ,/ 则/ 有/ 因此/ 由式/ (/ 1/ )/ 和/ 式/ (/ 2/ )/ 及图/ 2/ 可知/ ,/ CM/ 通过/ 定时/ 偏移/ Δ/ T/ 便/ 可/ 将/ 其/ 传输/ 与/ 正确/ 的/ 微/ 时隙/ 界限/ 相对/ 齐/ ./ 但/ 问题/ 是/ CM/ 与/ CMTS/ 中/ 同样/ 以/ 10.24/ MHz/ 驱动/ 的/ 两个/ 全局/ 定时器/ 真的/ 能/ 同步/ 计数/ 吗/ ?/ CMTS/ 与/ CM/ 工作/ 在/ 两个/ 完全/ 不同/ 的/ 物理/ 环境/ 中/ ./ 设/ CMTS/ 和/ CM/ 的/ 环境参数/ 集/ 分别/ 为/ Pcmts/ (/ y1/ ,/ y2/ ,/ …/ ,/ ym/ )/ 和/ Pcm/ (/ x1/ ,/ x2/ ,/ …/ ,/ xm/ )/ ,/ 则/ 有/ Pcmts/ (/ y1/ ,/ y2/ ,/ …/ ,/ ym/ )/ ≠/ Pcm/ (/ x1/ ,/ x2/ ,/ …/ ,/ xm/ )/ (/ 3/ )/ 在/ 信道/ 传输/ 中/ ,/ 由晶振/ 精度/ 、/ 电压/ 、/ 温度/ 等/ 寄生/ 参数/ 引起/ 的/ 时钟/ 漂移/ 问题/ 往往/ 是/ 研究/ 的/ 重点/ ./ 因此/ ,/ 由式/ (/ 3/ )/ 需要/ 怀疑/ 式/ (/ 1/ )/ 的/ 可靠性/ ./ 由/ DOCSIS/ 规范/ 知/ 相邻/ 两次/ SYNC/ 到达/ 时间/ 间隔/ Isy/ 最大值/ 为/ 200ms/ ./ 为/ 分析/ 时钟/ 漂移/ 引起/ 的/ CM/ 定时/ 同步/ 问题/ ,/ 本文/ 首先/ 对此/ 间隔/ 建立/ 局部/ 定时/ 误差/ 模型/ (/ PartialTimingErrorModel/ ,/ PTEM/ )/ ,/ 其/ 定义/ 如下/ :/ (/ 1/ )/ 设/ 标准/ 参考/ 时钟/ 频率/ 和/ 周期/ 分别/ 为/ fs/ =/ 10.24/ MHz/ ,/ Ts/ =/ 1/ 漂移/ 为/ clkcmts/ _/ skew/ =/ 0/ ,/ Δ/ Td/ 相对/ 稳定/ ,/ 则/ CM/ 可/ 将/ SYNC/ 中/ 的/ TS/ 作为/ 精确/ 的/ 定时/ 参考/ 基准/ ,/ CM/ 定时/ 误差/ 皆/ 归咎于/ CM/ 时钟/ 漂移/ clkcm/ _/ skew/ ≠/ 0/ 引起/ ./ CMTS/ 与/ CM/ 全局/ 定时器/ 时钟/ 频率/ 分别/ 为/ fcmts/ =/ fs/ 和/ fcm/ =/ (/ fs/ ±/ Δ/ f/ )/ MHz/ ,/ 其中/ Δ/ f/ 为/ 频率/ 偏移量/ ./ (/ 2/ )/ 设/ Pcmts/ 和/ Pcm/ 相对/ 稳定/ ,/ 即/ 有/ fcm/ // fcmts/ =/ C/ ,/ C/ 为/ 常量/ ./ (/ 3/ )/ 设/ 相邻/ 两次/ TS/ 到达/ 时刻/ 分别/ 为/ A1/ 和/ A2/ ,/ 时间/ 间隔/ 为/ Isy/ =/ A2/ -/ A1/ ./ (/ 4/ )/ 设/ s/ (/ t/ )/ 和/ r/ (/ t/ )/ 分别/ 为/ CMTS/ 和/ CM/ 定时器/ 在/ 时刻/ t/ 的/ 计/ 数值/ 函数/ ,/ t/ ∈/ [/ A1/ ,/ A2/ )/ ./ 实际上/ s/ (/ t/ )/ 和/ r/ (/ t/ )/ 只/ 在/ 离散/ 时间/ 序列/ {/ ti/ }/ 上/ 取值/ 有效/ ,/ ti/ ∈/ {/ A1/ ,/ A1/ +/ Ts/ ,/ …/ ,/ A1/ +/ i/ / Ts/ ,/ …/ }/ ,/ i/ =/ 0/ ,/ 1/ ,/ …/ ,/ Isy/ 便/ 分析/ ,/ 本文/ 在/ PTEM/ 中暂/ 将/ s/ (/ t/ )/ 和/ r/ (/ t/ )/ 视作/ 连续函数/ 进行/ 分析/ ./ 由/ 上述/ 模型/ 定义/ 可知/ ,/ 函数/ s/ (/ t/ )/ 和/ r/ (/ t/ )/ 可/ 按/ 如下/ 线性关系/ 描述/ :/ (/ 1/ )/ 当/ t/ =/ A1/ 时/ ,/ TS/ 到达/ 其值/ 为/ ts0/ ,/ 据此/ CM/ (/ 2/ )/ 当/ A1/ </ t/ </ A2/ 时有/ 置/ r/ (/ A1/ )/ =/ ts0/ ./ 其中/ ,/ ε/ (/ t/ )/ 为/ 随机噪声/ 引起/ 的/ 定时/ 偏差/ ,/ 假设/ 此/ 随机噪声/ 为/ 高斯/ 噪声/ ,/ 其/ 数学/ 期望/ E/ [/ ε/ (/ t/ )/ ]/ =/ 0/ ,/ 方差/ Var/ [/ ε/ (/ t/ )/ ]/ =/ σ/ 2/ (/ 3/ )/ 相应/ 的/ ,/ CMTS/ 定时器/ 计/ 数值/ 函数/ s/ (/ t/ )/ 为/ s/ (/ t/ )/ =/ fcmts/ ×/ [/ (/ t/ -/ A1/ )/ +/ Δ/ Td/ ]/ +/ ts0/ ,/ t/ ∈/ [/ A1/ ,/ A2/ )/ 由/ 文献/ [/ 2/ ]/ 知/ 测距/ 通过/ 调整/ CM/ 的/ Δ/ T/ 使/ 其/ 看起来/ 正好/ 位于/ CMTS/ 附近/ ,/ 因此/ PTEM/ 中/ 由/ Δ/ Td/ 引入/ 的/ 固定/ 定时/ 误差/ ,/ 可/ 在/ 测距/ 过程/ 中/ 由/ Δ/ T/ 补偿/ ./ 同时/ 为/ 简化/ 分析/ ,/ 忽略/ 随机噪声/ 对/ 定时/ 的/ 影响/ ./ 因/ Page4/ 此/ ,/ 对式/ (/ 4/ )/ 和/ (/ 5/ )/ 可/ 做/ 如下/ 约舍/ :/ 则/ 式/ (/ 4/ )/ 、/ (/ 5/ )/ 的/ 简化/ 形式/ 为/ (/ a/ )/ 舍去/ Δ/ Td/ ./ (/ b/ )/ 令/ σ/ 2r/ (/ t/ )/ =/ fcm/ ×/ (/ t/ -/ A1/ )/ +/ ts0/ ,/ s/ (/ t/ )/ =/ fcmts/ ×/ (/ t/ -/ A1/ )/ +/ ts0/ ,/ t/ ∈/ [/ A1/ ,/ A2/ )/ (/ 6/ )/ Te/ (/ t/ )/ =/ s/ (/ t/ )/ -/ r/ (/ t/ )/ =/ (/ fcmts/ -/ fcm/ )/ ×/ (/ t/ -/ A1/ )/ 令/ Te/ (/ t/ )/ 为/ t/ 时刻/ CM/ 的/ 定时/ 误差/ ,/ 则/ 有/ 由式/ (/ 7/ )/ 描述/ 的/ CM/ 定时/ 误差/ 如图/ 3/ 所示/ ,/ 根据/ Δ/ f/ >/ 0/ ,/ Δ/ f/ </ 0/ ,/ Δ/ f/ =/ 0/ 分为/ 3/ 种/ 情况/ ./ 为/ 解决/ 网络/ 发送/ 端/ 和/ 接收端/ 的/ 时钟/ 同步/ 问题/ ,/ 文献/ [/ 4/ -/ 5/ ]/ 详细/ 介绍/ 了/ 基于/ TS/ 的/ 各种/ 同步/ 调整/ 算法/ ,/ 如/ LRT/ (/ LinearRegressionAlgorithm/ )/ 、/ DLST/ (/ DiscountedLeast/ -/ SquaresAlgorithm/ )/ 、/ DST/ // AST/ (/ DirectSmoothingAlgorithm/ // AdaptiveSmoothingAlgorithm/ )/ 等等/ ,/ 这些/ 算法/ 将/ 同步/ 问题/ 转化/ 为/ 根据/ 历史/ 定时/ 误差/ 信息/ 对/ 将来/ 估值/ 问题/ ,/ 通过/ 对/ TS/ 进行/ k/ 次/ 采样/ ,/ 并/ 将/ 误差/ 序列/ Te/ (/ t/ )/ 输入/ 环路/ 滤波/ LF/ (/ LoopFilter/ )/ 器/ 计算/ 频率/ 误差/ Δ/ f/ ,/ 以此/ 控制/ 压控/ 振荡器/ (/ VoltageControlledOscillator/ ,/ VCO/ )/ 或/ 数控/ 振荡器/ (/ DigitallyControlledOscillator/ ,/ DCO/ )/ 调整/ 本地/ 频率/ ./ 使用/ 上述/ 算法/ 时钟/ 频率/ 误差/ 的/ 数学/ 期望/ 最终/ 可/ 收敛/ 为/ 0/ ,/ 算法/ 精度高/ ./ 但是/ ,/ 这些/ 算法/ 在/ 解决/ PTEM/ 描述/ 的/ 定时/ 误差/ 上/ 具有/ 如下/ 缺点/ :/ (/ 1/ )/ 算法/ 需/ 连续/ 采样/ k/ 个/ Te/ 以/ 估计/ 未知/ 参数/ bi/ (/ i/ =/ 1/ ,/ 2/ ,/ …/ ,/ n/ )/ ,/ 运算/ 时间/ 代价/ 较大/ ./ (/ 2/ )/ 算法/ 实现/ 涉及/ 相位/ 检测器/ 、/ LF/ 、/ VCO/ // DCO/ ,/ 硬件/ 实现/ 复杂/ ,/ 规模/ 代价/ 高/ ./ (/ 3/ )/ 一次/ 频率/ 同步/ 调整/ 周期/ 为/ k/ 个/ TS/ 周期/ ,/ 调整/ 周期长/ ,/ 收敛/ 速度慢/ ./ (/ 4/ )/ 算法/ 调整/ 的/ 对象/ 是/ 接收端/ 时钟/ 频率/ ,/ 而/ 非/ 其/ 定时器/ 输出/ 值/ ./ 由/ DOCSIS/ 知/ CM/ 定时器/ 在/ 任意/ 时刻/ t/ 都/ 需/ 与/ CMTS/ 精确/ 同步/ ,/ 以此/ 保证/ 其/ 随机/ 接入/ 时同/ 正确/ 的/ 微/ 时隙/ 界限/ 相对/ 齐/ ,/ 不/ 可能/ 允许/ 连续/ k/ 个/ Isy/ 的/ 非/ 精确/ 定时/ ./ 同时/ ,/ 基于/ 硬件/ 实现/ 复杂度/ 和/ 规模/ 考虑/ ,/ 下面/ 章节/ 中/ 本文/ 提出/ 了/ 一种/ 自/ 适应/ 补偿/ 定时/ 同步/ 算法/ ./ 3.2/ 自/ 适应/ 补偿/ 定时/ 同步/ 算法/ 不同于/ 文献/ [/ 4/ -/ 5/ ]/ ,/ 本文/ 将/ 研究/ 的/ 重点/ 定/ 位于/ Isy/ 内/ 并/ 提出/ 新/ 算法/ ACTSA/ ,/ 该/ 算法/ 能/ 预测/ 定时/ 误差/ 将/ 发生/ 时刻/ 并/ 及时/ 给予/ 补偿/ ,/ 以此/ 实现/ 任意/ Isy/ 内/ 任意/ 时刻/ CM/ 同/ CMTS/ 的/ 精确/ 定时/ 同步/ ./ 在/ 上节/ PTEM/ 基础/ 上将/ 定时/ 误差/ 模型/ 扩展/ 为/ 连续/ Isy/ 上/ 的/ 全局/ 定时/ 误差/ 模型/ (/ GlobalTimingErrorModel/ ,/ GTEM/ )/ ,/ 模型/ 扩展/ 定义/ 如下/ :/ (/ 1/ )/ 设/ TS/ 到达/ 时刻/ 序列/ 为/ {/ Tk/ :/ k/ =/ 0/ ,/ 1/ ,/ 2/ ,/ …/ }/ ,/ 其中/ k/ 表示/ 第/ k/ +/ 1/ 个/ 同步/ 报文/ 的/ 到达/ ./ (/ 2/ )/ 设/ {/ T/ (/ m/ )/ 时/ 补偿/ 时刻/ 序列/ ,/ 不妨/ 令/ T/ (/ 0/ )/ (/ 3/ )/ 设/ {/ f/ (/ k/ -/ 1/ )/ 上/ 的/ 定时器/ 时钟/ 频率/ ,/ {/ Δ/ f/ (/ k/ )/ Tk/ )/ 和/ (/ Tk/ ,/ Tk/ +/ 1/ )/ 上/ f/ (/ k/ -/ 1/ )/ cm/ -/ f/ (/ k/ -/ 1/ )/ f/ (/ k/ )/ 并/ 无此/ 频率/ 误差/ 约束/ ./ 令/ f/ (/ -/ 1/ )/ 定时器/ 时钟/ 频率/ ./ 对应/ 的/ 定时/ 补偿/ 值/ ,/ Eval/ (/ t/ )/ 为/ (/ Tk/ ,/ t/ )/ 上/ 所有/ Δ/ comp/ (/ T/ (/ m/ )/ 导/ 过程/ 如下/ :/ 基于/ 上述/ GTEM/ 模型/ 假设/ 的/ ACTSA/ 详细/ 推/ (/ 1/ )/ 对于/ t/ ∈/ {/ Tk/ ,/ k/ =/ 0/ ,/ 1/ ,/ 2/ ,/ …/ }/ 有/ Eval/ (/ t/ )/ =/ 0/ ./ (/ 2/ )/ 在/ GTEM/ 下/ CM/ 定时器/ 计/ 数值/ r/ (/ t/ )/ 表达/ (/ 4/ )/ 设/ Δ/ comp/ (/ T/ (/ m/ )/ 式/ 如下/ :/ r/ (/ t/ )/ =/ (/ 3/ )/ 对于/ t/ ∈/ (/ T0/ ,/ T1/ )/ 由式/ (/ 7/ )/ 可得/ Te/ (/ t/ )/ =/ (/ fcmts/ -/ f/ (/ 0/ )/ 由式/ (/ 6/ )/ 、/ (/ 8/ )/ 可得/ Page5/ 则/ 由式/ (/ 10/ )/ 、/ (/ 11/ )/ 得/ 将/ 式/ (/ 12/ )/ 代入/ 式/ (/ 9/ )/ 得/ 上式/ 表明/ 当/ t/ ∈/ (/ T0/ ,/ T1/ )/ 时/ Te/ (/ t/ )/ 是/ 斜率/ 为/ s/ (/ T1/ )/ -/ r/ (/ T1/ )/ T1/ -/ T0/ (/ 4/ )/ 由/ GTEM/ 假设/ (/ 3/ )/ 可知/ ,/ (/ Tk/ ,/ Tk/ +/ 1/ )/ 上/ 的/ 定时/ 误差/ 可/ 根据/ (/ Tk/ -/ 1/ ,/ Tk/ )/ 上/ 的/ 定时/ 误差/ 预测/ ,/ 因此/ 由式/ (/ 13/ )/ 可/ 估计/ (/ T1/ ,/ T2/ )/ 上/ 的/ 定时/ 误差/ Te/ (/ t/ )/ ./ 在/ 实际/ 中/ CMTS/ 和/ CM/ 的/ 定时器/ 为/ 递增/ 单位/ 为/ 1/ 的/ 离散/ 计数器/ ,/ 因此/ 为/ 使/ CM/ 同/ CMTS/ 定时/ 精确/ 同步/ ,/ 算法/ 期望/ 任意/ 时刻/ t/ 定时/ 误差/ |/ Te/ (/ t/ )/ |/ / 1/ ,/ 这/ 等于/ 将/ 问题/ 转化/ 为/ :/ 令/ |/ Δ/ comp/ (/ T/ (/ m/ )/ 确/ 的/ 定时/ 补偿/ 时刻/ {/ T/ (/ m/ )/ (/ T/ (/ 0/ )/ 1/ ,/ T2/ )/ 时有/ 则/ 待求/ 误差/ 补偿/ 时刻/ T/ (/ 1/ )/ s/ (/ T1/ )/ -/ r/ (/ T1/ )/ T1/ -/ T0/ ×/ (/ T/ (/ 1/ )/ 对于/ Eval/ (/ t/ )/ ,/ 当/ t/ ∈/ (/ T/ (/ 0/ )/ Eval/ (/ T/ (/ 0/ )/ Eval/ (/ T/ (/ 1/ )/ 其中/ ,/ Δ/ comp/ (/ T/ (/ 1/ )/ 符号/ 函数/ ./ (/ 5/ )/ 当/ t/ ∈/ (/ T/ (/ m/ -/ 1/ )/ 式/ (/ 14/ )/ ~/ (/ 16/ )/ 同理/ 可/ 得/ 误差/ 补偿/ 时刻/ T/ (/ m/ )/ 当/ t/ ∈/ (/ T/ (/ m/ -/ 1/ )/ 当/ t/ =/ T/ (/ m/ )/ Eval/ (/ T/ (/ m/ )/ 其中/ (/ 6/ )/ 推广/ 为/ GTEM/ 中/ 一般/ 情况/ ,/ 对于/ t/ ∈/ k/ ,/ Tk/ +/ 1/ )/ ,/ 由式/ (/ 17/ )/ ~/ (/ 19/ )/ 可/ 得/ (/ T/ (/ m/ -/ 1/ )/ 误差/ 补偿/ 时刻/ T/ (/ m/ )/ 当/ t/ ∈/ (/ T/ (/ m/ -/ 1/ )/ 当/ t/ =/ T/ (/ m/ )/ Eval/ (/ T/ (/ m/ )/ 其中/ 定时器/ 输出/ 值/ ,/ 则/ 有/ 设/ tmcm/ (/ t/ )/ 为/ t/ 时刻/ 经上述/ 算法/ 校正/ 后/ 的/ CMtmcm/ (/ t/ )/ =/ R/ (/ t/ )/ +/ Eval/ (/ t/ )/ ,/ t/ ∈/ [/ 0/ ,/ +/ )/ (/ 23/ )/ 推导/ 至此/ ,/ 算法/ 分别/ 给出/ 了/ 定时/ 误差/ 计算/ 方程/ (/ 20/ )/ 、/ 定时/ 补偿/ 时刻/ 计算/ 方程/ (/ 21/ )/ 、/ 定时/ 补偿/ 值/ 累积/ 量计算/ 方程/ (/ 22/ )/ 以及/ 校正/ 定时/ 输出/ 计算/ 方程/ (/ 23/ )/ ./ 由于/ 算法/ 可/ 根据/ (/ Tk/ -/ 1/ ,/ Tk/ )/ 阶段/ 的/ 定时/ 误差/ 自动/ 调节/ 式/ (/ 20/ )/ 的/ 斜率/ 以/ 反映/ f/ (/ k/ -/ 2/ )/ 正确/ 预测/ (/ Tk/ ,/ Tk/ +/ 1/ )/ 阶段/ 的/ 定时/ 误差/ ,/ 因此/ 称该/ 算法/ 具有/ “/ 自适应性/ ”/ ./ 由/ 算法/ 推导/ 过程/ 可知/ ,/ 在/ 任意/ 时刻/ t/ 都/ 有/ |/ s/ (/ t/ )/ -/ tmcm/ (/ t/ )/ |/ / 1/ ,/ t/ ∈/ [/ 0/ ,/ +/ )/ ,/ 即/ 算法/ 保证/ 了/ CM/ 同/ CMTS/ 在/ 全局/ 定时/ 上/ 的/ 精确/ 同步/ ./ 3.3/ 自/ 适应/ 补偿/ 定时/ 同步/ 算法/ 优化/ 上节/ GTEM/ 下/ 给出/ 的/ ACTSA/ 适合/ 连续/ 定义域/ t/ ∈/ [/ 0/ ,/ +/ )/ 上/ 的/ 定时/ 误差/ 补偿/ ,/ 但/ 实际/ 中/ CM/ 的/ 定时器/ 是/ 在/ 周期/ 为/ 1/ 升沿/ )/ 驱动/ 下/ 工作/ ,/ 这样/ 由式/ (/ 21/ )/ 得到/ 的/ 定时/ 补偿/ 时刻/ 不/ 一定/ 恰好/ 与/ 该/ 脉冲/ 的/ 上升/ 沿/ 时刻/ (/ 离散/ 时间/ 点/ )/ 对齐/ ./ 针对/ 该/ 问题/ 本文/ 将/ 把/ GTEM/ 转化/ 为/ 离散/ 定时/ 误差/ 模型/ (/ GlobalDispersionTimingErrorModel/ ,/ GDTEM/ )/ ,/ 并/ 推导/ GDTEM/ 下/ 的/ ACTSA/ 算法/ ./ 该/ GDTEM/ 定义/ 如下/ :/ (/ 1/ )/ n/ 表示/ 系统启动/ 到/ 当前/ 时刻/ 定时器/ 已/ 经历/ 的/ 脉冲数/ ./ (/ 2/ )/ 设/ 定时器/ 在/ 脉冲/ 上升/ 沿/ 检测/ TS/ ,/ 则/ TS/ 到达/ 时所/ 对应/ 的/ n/ 值/ 序列/ 为/ {/ Nk/ :/ k/ =/ 0/ ,/ 1/ ,/ 2/ ,/ …/ }/ ,/ 该/ 序列/ 对应/ 于/ GTEM/ 中/ 的/ {/ Tk/ }/ ,/ 其中/ k/ 表示/ 第/ k/ +/ 1/ 个/ TS/ 的/ 到达/ ./ (/ 3/ )/ 设/ {/ N/ (/ m/ )/ 补偿点/ 的/ n/ 值/ 序列/ ,/ 令/ N/ (/ 0/ )/ (/ 4/ )/ 设/ {/ F/ (/ k/ -/ 1/ )/ 时器/ 时钟/ 频率/ ,/ Δ/ F/ (/ k/ )/ 中/ (/ 3/ )/ 定义/ 的/ 约束/ ./ (/ 5/ )/ 设/ Δ/ COMP/ (/ N/ (/ m/ )/ Page6/ 值/ ,/ EVAL/ (/ n/ )/ 为/ (/ Nk/ ,/ n/ )/ 上/ 所有/ Δ/ COMP/ (/ N/ (/ m/ )/ CM/ 定时器/ 计/ 数值/ ,/ TNe/ (/ n/ )/ 为/ 定时器/ 误差/ ./ 推导/ 过程/ 如下/ :/ (/ 6/ )/ 设/ S/ (/ Nk/ )/ 为/ Nk/ 点/ 对应/ 的/ TS/ 值/ ,/ R/ (/ n/ )/ 为/ 基于/ 上述/ GDTEM/ 离散/ 模型/ 的/ ACTSA/ 算法/ (/ 1/ )/ 对于/ n/ ∈/ {/ Nk/ ,/ k/ =/ 0/ ,/ 1/ ,/ 2/ ,/ …/ }/ 有/ EVAL/ (/ n/ )/ =/ 0/ ./ (/ 2/ )/ GDTEM/ 下/ CM/ 定时器/ 计/ 数值/ R/ (/ n/ )/ 表达式/ 如下/ :/ R/ (/ n/ )/ =/ ./ (/ 3/ )/ 对于/ n/ ∈/ (/ N0/ ,/ N1/ ]/ ,/ 设/ CM/ 定时器/ 第/ n/ 个/ 周期/ 上升/ 沿/ 时刻/ 为/ tn/ ,/ 则/ 由式/ (/ 13/ )/ 可得/ TNe/ (/ n/ )/ =/ Te/ (/ tn/ )/ =/ s/ (/ T1/ )/ -/ r/ (/ T1/ )/ (/ 4/ )/ 对于/ n/ ∈/ (/ N/ (/ 0/ )/ TNe/ (/ n/ )/ =/ S/ (/ N1/ )/ -/ R/ (/ N1/ )/ GDTEM/ 下/ 在/ 求/ (/ N/ (/ m/ -/ 1/ )/ 直接/ 套用/ 式/ (/ 21/ )/ ,/ 因为/ CM/ 发生/ 定时/ 误差/ 等于/ 1/ 的/ 时刻/ 点/ 不/ 一定/ 恰好/ 与/ n/ 对齐/ ./ 本文/ 在/ GDTEM/ 下/ 采用/ 延迟/ 补偿/ 策略/ ,/ 即将/ 补偿点/ 延迟/ 到/ 定时/ 误差/ 等于/ 1/ 的/ 时刻/ 点后/ 最近/ 的/ 一个/ n/ 点/ ,/ 则/ (/ N/ (/ 0/ )/ 的/ 计算/ 方程/ 如下/ :/ 1/ =/ minnn/ :/ S/ (/ N1/ )/ -/ R/ (/ N1/ )/ N/ (/ 1/ )/ 对于/ EVAL/ (/ n/ )/ ,/ 当/ n/ ∈/ (/ N/ (/ 0/ )/ EVAL/ (/ n/ -/ 1/ )/ =/ EVAL/ (/ N/ (/ 0/ )/ EVAL/ (/ N/ (/ 1/ )/ 其中/ ,/ Δ/ COMP/ (/ N/ (/ 1/ )/ (/ 5/ )/ 对于/ n/ ∈/ (/ N/ (/ 1/ )/ 1/ =/ minnn/ :/ S/ (/ N1/ )/ -/ R/ (/ N1/ )/ N/ (/ 2/ )/ sgn/ (/ S/ (/ N1/ )/ -/ R/ (/ N1/ ]/ )/ )/ +/ =/ minnn/ :/ S/ (/ N1/ )/ -/ R/ (/ N1/ )/ sgn/ (/ S/ (/ N1/ )/ -/ R/ (/ N1/ )/ )/ / }/ 1/ 对于/ EVAL/ (/ n/ )/ ,/ 当/ n/ ∈/ (/ N/ (/ 1/ )/ 其中/ S/ (/ N1/ )/ -/ R/ (/ N1/ )/ R/ (/ N1/ )/ )/ 项为/ 由于/ 定时/ 误差/ 补偿点/ 延迟/ 到/ N/ (/ 1/ )/ 成/ 的/ 累积/ 补偿/ 误差/ ./ EVAL/ (/ n/ -/ 1/ )/ =/ EVAL/ (/ N/ (/ 1/ )/ EVAL/ (/ N/ (/ 2/ )/ 其中/ ,/ Δ/ COMP/ (/ N/ (/ 2/ )/ (/ 6/ )/ 由/ 数学/ 归纳法/ 可/ 得/ ,/ 对于/ n/ ∈/ (/ N/ (/ m/ -/ 1/ )/ 1/ =/ minnn/ :/ S/ (/ N1/ )/ -/ R/ (/ N1/ )/ N/ (/ m/ )/ 对于/ EVAL/ (/ n/ )/ ,/ 当/ n/ ∈/ (/ N/ (/ m/ -/ 1/ )/ EVAL/ (/ n/ -/ 1/ )/ =/ EVAL/ (/ N/ (/ m/ -/ 1/ )/ EVAL/ (/ N/ (/ m/ )/ 其中/ Δ/ COMP/ (/ N/ (/ m/ )/ (/ 7/ )/ 推广/ 为/ GDTEM/ 下/ 最/ 一般/ 形式/ ,/ 对于/ n/ ∈/ (/ N/ (/ m/ -/ 1/ )/ k/ ,/ Nk/ +/ 1/ ]/ 有/ TNe/ (/ n/ )/ =/ S/ (/ Nk/ )/ -/ R/ (/ Nk/ )/ k/ =/ min/ {/ nn/ :/ S/ (/ Nk/ )/ -/ R/ (/ Nk/ )/ N/ (/ m/ )/ 对于/ EVAL/ (/ n/ )/ ,/ 当/ n/ ∈/ (/ N/ (/ m/ -/ 1/ )/ EVAL/ (/ n/ -/ 1/ )/ =/ EVAL/ (/ N/ (/ m/ -/ 1/ )/ EVAL/ (/ N/ (/ m/ )/ 其中/ ,/ Δ/ COMP/ (/ N/ (/ m/ )/ 校正/ 后/ 的/ CM/ 定时/ 输出/ 值/ ,/ 则/ 有/ 设/ TMcm/ (/ n/ )/ 为/ n/ 时刻/ 经上述/ GDTEM/ 下/ ACTSATMcm/ (/ n/ )/ =/ R/ (/ n/ )/ +/ EVAL/ (/ n/ )/ ,/ n/ ∈/ [/ 0/ ,/ +/ )/ (/ 34/ )/ 通过/ 上述/ 连续/ 定时/ 误差/ 模型/ 到/ 离散/ 定时/ 误差/ 模型/ 的/ ACTSA/ 推导/ 变换/ ,/ 得到/ 了/ 离散/ 模型/ 下/ 的/ 定时/ 误差/ 计算/ 方程/ (/ 31/ )/ 、/ 定时/ 补偿/ 时刻/ 计算/ 方程/ (/ 32/ )/ 、/ 定时/ 补偿/ 值/ 累积/ 量计算/ 方程/ (/ 33/ )/ 以及/ 校正/ 定时/ 输出/ 计算/ 方程/ (/ 34/ )/ ./ Page7/ 但是/ ,/ 算法/ 实现/ 时/ 式/ (/ 31/ )/ 、/ (/ 32/ )/ 表示/ 的/ 计算/ 方程/ 并/ 不/ 完美/ ,/ 因为/ 它们/ 涉及/ 到/ 硬件/ 以及/ 嵌入式/ 系统/ 实现/ 所/ 不/ 期望/ 的/ 乘法/ 和/ 除法/ 运算/ ./ 为了/ 消除/ ACTSA/ 中/ 的/ 乘除/ 运算/ 使/ 其能/ 更/ 广泛/ 、/ 更/ 便捷/ 地/ 应用/ 到/ 实际/ 系统/ 实现/ 中/ ,/ 本文/ 将/ 对/ 上述/ 计算结果/ 进行/ 优化/ ./ k/ =/ minn/ {/ n/ :/ |/ [/ (/ S/ (/ Nk/ )/ -/ R/ (/ Nk/ )/ )/ ×/ (/ n/ -/ Nk/ )/ ]/ -/ N/ (/ m/ )/ sgn/ (/ S/ (/ Nk/ )/ -/ R/ (/ Nk/ )/ )/ ]/ |/ / (/ Nk/ -/ Nk/ -/ 1/ )/ }/ / :/ 对于/ n/ ∈/ (/ N/ (/ m/ -/ 1/ )/ k/ =/ min/ {/ nn/ :/ ∑/ nN/ (/ m/ )/ / (/ Nk/ -/ Nk/ -/ 1/ )/ }/ 通过/ 优化/ 式/ (/ 32/ )/ 计算所/ 需/ 的/ 乘除/ 运算/ 在/ 式/ (/ 35/ )/ 中/ 消失/ 了/ ,/ 算法/ 得到/ 了/ 更为/ 简便/ 的/ 计算/ 方程/ ./ 由式/ (/ 35/ )/ 可知/ ,/ 计算/ (/ Nk/ ,/ Nk/ +/ 1/ ]/ 上/ 第/ m/ 个/ 定时/ 补偿/ 时刻/ 只/ 需/ 知道/ (/ Nk/ -/ 1/ ,/ Nk/ ]/ 上/ Nk/ 点/ 的/ 定时/ 误差值/ S/ (/ Nk/ )/ -/ 图/ 4ACTSA/ 计算/ 流程图/ 4.1/ 算法/ 级/ 仿真/ 验证/ 本文/ 首先/ 在/ MATLAB/ 中/ 对/ 算法/ 建模/ 仿真/ ,/ 仿真/ 模型/ 结构/ 如图/ 5/ 所示/ ,/ 仿真/ 参数/ 见表/ 1/ ./ 算法/ 仿真/ 结果/ 如图/ 6/ 所示/ ./ 图/ 6/ (/ a/ )/ 、/ (/ b/ )/ 分别/ 描绘/ 了/ Δ/ f/ >/ 0/ ,/ Δ/ f/ </ 0/ 两种/ 情况/ 下/ CM/ 的/ 定时/ 误差/ ./ R/ (/ Nk/ )/ 以及/ 第/ k/ 和/ 第/ k/ +/ 1/ 个/ TS/ 到达/ 对应/ 的/ 定时/ 间隔/ Nk/ -/ Nk/ -/ 1/ 即可/ ./ 设式/ (/ 35/ )/ 中/ 决定/ 补偿/ 时刻/ 点/ k/ 的/ 因子/ 为/ Estep/ (/ N/ (/ m/ )/ N/ (/ m/ )/ 则/ 有/ Estep/ (/ N/ (/ m/ )/ ∑/ m/ -/ 1j/ =/ 0/ 至此/ ,/ ACTSA/ 给出/ 了/ CM/ 进行/ 定时/ 补偿/ 所/ 需/ 的/ 全部/ 计算/ 方程式/ ,/ 这些/ 计算/ 方程式/ 不仅/ 能够/ 使/ CM/ 精确/ 同步/ 于/ CMTS/ ,/ 而且/ 能够/ 方便/ 地/ 适用/ 于/ 硬件/ 及/ 嵌入式/ 系统/ 实现/ ./ 4/ 算法/ 实现/ 、/ 测试/ 及/ 性能/ 分析/ 下面/ 本文/ 将/ 给出/ ACTSA/ 的/ 具体/ 实现/ 步骤/ ,/ 并/ 对/ 其/ 进行/ 测试/ 和/ 性能/ 分析/ ./ 算法/ 计算/ 流程/ 如图/ 4/ 所示/ ./ 样本/ 采样/ 点为/ CM/ 定时器/ 工作/ 脉冲/ 上升/ 沿/ ./ 图中/ N1/ ~/ N5/ 为/ TS/ 到达/ 点/ ,/ 线/ L1/ 和/ 线/ L2/ 分别/ 表示/ 未/ 使用/ 和/ 使用/ ACTSA/ 算法/ 两种/ 情况/ 下/ 的/ 定时/ 误差/ ./ 图中/ L2/ 上/ 出现/ ±/ 1/ “/ 定时/ 误差/ 尖峰/ ”/ 原因/ 为/ Page8/ 表/ 1/ 算法/ 模型/ 仿真/ 参数/ 频率/ 偏差/ 方向/ Δ/ f/ >/ 010.20/ Δ/ f/ </ 010.28/ ±/ 0.0410/ ./ 24/ [/ -/ 5/ ,/ +/ 5/ ]/ ≈/ 1fcm/ +/ F/ (/ k/ )/ (/ 1/ )/ 算法/ 采用/ 误差/ 延迟/ 补偿/ 策略/ ,/ 因而/ 会/ 短暂/ 出现/ 定时/ 误差/ 已为/ 1/ 但/ 没/ 立即/ 补偿/ 现象/ ./ (/ 2/ )/ CM/ 的/ 定时器/ 频率/ 在/ 相邻/ TS/ 到达/ 间隔/ (/ Nk/ -/ 1/ ,/ Nk/ )/ 和/ (/ Nk/ ,/ Nk/ +/ 1/ )/ 上/ 具有/ Δ/ F/ (/ k/ )/ 率/ 偏移/ ,/ 算法/ 根据/ (/ Nk/ -/ 1/ ,/ Nk/ )/ 上/ 已/ 发生/ 的/ 定时/ 误差/ 估计/ (/ Nk/ ,/ Nk/ +/ 1/ )/ 上将/ 发生/ 的/ 定时/ 误差/ ,/ 因此/ 由式/ (/ 35/ )/ 、/ (/ 36/ )/ 计算/ 得到/ 定时/ 误差/ 补偿点/ 与/ 实际/ 发生/ 定时/ 误差/ 等于/ 1/ 的/ 时刻/ 存在/ 微小/ 偏差/ ./ 由图/ 6/ 所示/ 的/ 仿真/ 结果/ 可知/ ,/ 未/ 使用/ ACTSA/ 时/ ,/ 每个/ Isy/ 内/ CM/ 定时/ 误差/ 随/ 时间/ 呈/ 线性/ 趋势/ 增/ 参数/ cm/ // HzIsy/ // ms/ 采样/ 频率/ // MHz/ 每个/ Isy/ 内/ 采样/ 数长/ ,/ 在/ 离散/ 点/ 采样/ 的/ 表现/ 结果/ 呈现/ 为/ 图/ 中/ 所示/ 的/ 阶梯状/ 上升/ ,/ 而/ 采用/ ACTSA/ 时/ ,/ 即使/ 在/ 较大/ Δ/ f/ 偏差/ (/ 本例/ Δ/ f/ =/ ±/ 0.04/ MHz/ )/ 情况/ 下/ ,/ CM/ 的/ 定时/ 误差/ 被/ 限制/ 在/ {/ -/ 1/ ,/ 0/ ,/ 1/ }/ 内/ ./ 上述/ MATLAB/ 算法/ 仿真/ 结果/ 与/ 算法/ 设计/ 期望/ 结果/ 一致/ ,/ 初步/ 验证/ 了/ 本文/ 算法/ 的/ 正确性/ ./ 4.2/ SoC/ 平台/ 算法/ 实现/ 本文/ 的/ 项目/ 背景/ 为/ 交互式/ 有线/ 数字电视/ CMSoC/ 芯片/ 的/ 研制/ 和/ 开发/ ,/ 为/ 该/ 项目/ 开发/ 的/ 具有/ 自主/ 知识产权/ 的/ CMSoC/ 芯片/ (/ SIP/ -/ CM/ )/ 简化/ 系统结构/ 如图/ 7/ (/ a/ )/ 所示/ ./ 其中/ CPU/ 为/ 我国/ 自主/ 研发/ 的/ 龙芯/ ./ Ethernet/ 模块/ 支持/ Ethernet/ // 802.3/ 用户端/ 协议/ 栈/ ,/ 是/ CM/ 与/ CPE/ (/ 用户/ 专用设备/ )/ 之间/ 的/ 通信接口/ ./ Tuner/ 将/ 下行/ 高频/ 信号/ 转换/ 为/ 中频/ 信号/ ,/ 其/ 输出/ 连/ Page9/ 接到/ 下行/ 物理层/ 解调/ 模块/ DownDemodulator/ ./ DocsisPPU/ (/ ProtocolProcessUnit/ )/ 为/ Docsis/ 协议/ 处理器/ ,/ 包括/ 下行/ 同步/ 、/ 数据/ 接收/ 和/ 发送/ 等等/ ,/ UpModulator/ 完成/ 上行/ 信号/ 调制/ 及/ 发射/ ./ 其中/ Timing/ 模块/ 实现/ 了/ 本文/ 所/ 提出/ 的/ ACTSA/ ./ 在/ SIP/ -/ CM/ 开发/ 验证/ 阶段/ ,/ 我们/ 为/ 其/ 设计/ 了/ 基于/ XilinxXC2VP70FPGA/ 的/ 开发/ 验证/ 平台/ (/ SIP/ -/ CM/ -/ XL/ )/ 以/ 验证/ 其/ 功能/ ./ 下面/ 主要/ 介绍/ 基于/ SIP/ -/ CM/ -/ XL/ 的/ ACTSA/ 验证/ 过程/ ./ 为/ 验证/ ACTSA/ 在/ CMTS/ 与/ CM/ 的/ 实际/ 交互/ 环境/ 中/ 的/ 正确性/ 和/ 定时/ 精度/ ,/ 本文/ 搭建/ 了/ 图/ 7/ (/ b/ )/ 所示/ 的/ 测试环境/ ./ 该/ 环境/ 中/ CM/ 与/ CMTS/ 距离/ 约/ 为/ 30m/ ,/ 通过/ Cable/ 线/ 连接/ ,/ CMTS/ 为/ Cisco7114E/ ./ 测试/ 环境温度/ 为/ 30/ 左右/ ./ 电源/ 为/ DH1718E/ -/ 4/ 型/ 双路/ 跟踪/ 稳压/ 稳流/ 电源/ ./ CPE/ 和/ PC/ 均/ 为/ DELLDe/ -/ mension3100/ 微型机/ ./ 此外/ CM/ 和/ CMTS/ 周围/ 均/ 无/ 其它/ 电气设备/ ./ 算法/ 正确性/ 验证/ 1/ ./ 借助/ 与/ CM/ 相连/ 的/ CPE/ 上/ 的/ ping/ 程序/ 产生/ 上行/ 用户/ 数据/ 来/ 检验/ ACTSA/ 在/ 控制/ 接入/ 上行/ TDMA/ 信道/ 的/ 正确性/ ./ 其中/ CM/ 分别/ 采用/ Motorola5100/ 和/ 本文/ 的/ SIP/ -/ CM/ ,/ SIP/ -/ CM/ 的/ Timing/ 使用/ 10.24/ MHz/ 的/ 晶体振荡器/ 作为/ 时钟/ 源/ ,/ 两者/ 的/ 测试/ 结果/ 见表/ 2/ ,/ 结果表明/ SIP/ -/ CM/ 在/ 功能/ 上/ 与/ Motorola5100/ 完全/ 等同/ ,/ 验证/ 了/ 本文/ 算法/ 的/ 正确性/ ./ 表/ 3SIP/ -/ CM/ 平台/ 实际/ 捕获/ 样本/ 样本/ 号/ 123456/ 表/ 2SIP/ -/ CM/ 与/ MotorolaCM/ 的/ Ping/ 程序/ 测试/ 统计数据/ CMMotorola5100SIP/ -/ CM/ 算法/ 定时/ 精度/ 验证/ 2/ ./ 与/ 验证/ 1/ 不同/ ,/ 本/ 测试/ 在/ SIP/ -/ CM/ 中/ 嵌入/ XilinxDCMIPcore/ ,/ 以/ 40.90/ MHz/ 的/ 晶体振荡器/ 作为/ 该/ DCM/ 输入/ 时钟/ 源/ ,/ 并/ 使/ 其/ 产生/ 10.225/ MHz/ 的/ 4/ 分频/ 时钟/ 作为/ Timing/ 模块/ 的/ 输入/ 时钟/ ./ 即/ SIP/ -/ CM/ 定时器/ 的/ 参数/ 为/ fcm/ =/ 10.225/ MHz/ ,/ Δ/ f/ =/ 0.015/ MHz/ ./ 同时/ ,/ 为/ Timing/ 模块/ 编写/ Monitor/ 硬件/ 逻辑/ ,/ 将/ 每个/ TS/ 到达/ 点/ 的/ TS/ 值/ 、/ 测距/ 定时/ 偏移量/ Time/ _/ Offset/ 及经/ 算法/ 调整/ 和/ 未/ 调整/ 的/ 定时器/ 计/ 数值/ Cor/ _/ Tm/ 和/ Err/ _/ Tm/ 输出/ 到/ SDRAM/ ,/ 并/ 由/ 运行/ 在/ 龙芯/ 上/ 的/ 软件程序/ 通过/ 串口/ 输出/ 到/ CPE/ ./ 该/ 实验/ 测试/ 结果/ 见表/ 3/ 和/ 图/ 8/ ./ 其中/ ,/ 表/ 3/ 列出/ 了/ 6/ 组/ 随机/ 采样/ 的/ 样本/ 点/ ,/ 并/ 计算/ 出经/ 算法/ 调整/ 和/ 未/ 调整/ 的/ CM/ 定时/ 误差/ Cor/ _/ TNE/ 和/ Err/ _/ TNE/ ./ 图/ 8/ 绘制/ 了/ 1000/ 个/ 随机样本/ 点/ 对应/ 的/ Cor/ _/ TNE/ 和/ Err/ _/ TNE/ ./ 该/ 测试/ 结果表明/ E/ (/ Cor/ _/ TNE/ )/ =/ 1/ ,/ 出现/ Cor/ _/ TNE/ =/ 2/ 的/ 原因/ 解释/ 为/ :/ 算法/ 未/ 考虑/ CMTS/ 本身/ 时钟/ 频率/ 偏差/ 、/ 信道/ 变化/ 及/ SIP/ -/ CM/ -/ XL/ 上/ 的/ 其它/ 噪声/ 影响/ ./ 参数/ 本/ 节/ 测试/ 证明/ ACTSA/ 在/ 实际/ 环境/ 中/ 具有/ 同/ 仿真/ 同样/ 的/ 正确性/ 和/ 定时/ 精度/ ./ 定时/ 精度/ 为/ 该/ 精度/ 是/ CMTS/ 允许/ 的/ 定时/ 偏移/ 误差/ 1/ μ/ s/ 的/ 10.24/ 倍/ [/ 2/ ]/ ,/ 由此可见/ ,/ 本文/ 所/ 提出/ 的/ ACTSA/ 对于/ 提高/ CM/ 定时/ 精度/ 有/ 显著/ 的/ 效果/ ./ 5/ 结论/ 本文/ 为/ HFC/ 网络/ CM/ 与/ CMTS/ 的/ 全局/ 定时/ 同/ Page10/ 步/ 提出/ 了/ 一种/ 自/ 适应/ 补偿/ 定时/ 同步/ 算法/ ,/ 该/ 算法/ 采用/ 线性/ 延迟/ 补偿/ 策略/ 准确/ 定位/ CM/ 定时/ 误差/ 补偿/ 时刻/ ,/ 使/ CM/ 能够/ 在/ 本地/ 建立/ 准确/ 的/ 定时/ 基准/ ,/ 同步/ 于/ CMTS/ ,/ 为/ CM/ 准确/ 的/ 上行/ 传输/ 提供/ 了/ 保证/ ./ 通过/ 理论/ 推导/ 、/ Matlab/ 算法/ 级/ 仿真/ 以及/ 实际/ 网络/ 环境/ 下/ 的/ 测试/ ,/ 充分/ 验证/ 了/ 本文/ 算法/ 的/ 正确性/ 和/ 定时/ 精度/ ./ 实现/ 有/ 本文/ 算法/ 的/ SIP/ -/ CM/ 已/ 成功/ 应用/ 于/ HDTV/ 双向/ 点播/ 系统/ 、/ VOD/ 、/ VoIP/ 、/ Internet/ 网络通信/ 等/ 应用/ 中/ 并/ 表现/ 出/ 优良/ 的/ 性能/ 和/ 可靠性/ ./ 

