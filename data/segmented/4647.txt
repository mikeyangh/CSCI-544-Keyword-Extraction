Page1/ 一种/ 基于/ 平均/ 场/ 的/ 无线/ 自/ 组织/ 网络/ 时钟/ 同步/ 方法/ / 孙/ 建华/ 高小杰/ 李胆胆/ 左颖/ 洪亮/ (/ 西北工业大学/ 自动化/ 学院/ 西安/ 710072/ )/ 摘要/ 时钟/ 同步/ 是/ 无线/ 自/ 组织/ 网络/ 的/ 一项/ 重要/ 支撑/ 技术/ ,/ 是/ 协议/ 运行/ 、/ 节能/ 管理/ 、/ 数据/ 融合/ 和/ 协同工作/ 的/ 必要/ 前提/ ./ 文中/ 首先/ 给出/ 了/ 无线/ 自/ 组织/ 网络/ 中/ 节点/ 之间/ 时钟/ 偏差/ 的/ 特性/ 分析/ ,/ 并/ 设计/ 了/ 卡尔曼滤波/ 器/ ,/ 用于/ 精确/ 地/ 估计/ 邻居/ 节点/ 之间/ 的/ 时钟/ 偏差/ ./ 然后/ 提出/ 了/ 一种/ 基于/ 平均/ 场/ 的/ 全/ 分布式/ 多/ 跳/ 时钟/ 同步/ 方法/ ./ 该/ 方法/ 不/ 维护/ 特殊/ 节点/ ,/ 基于/ 平均/ 场/ 理论/ ,/ 通过/ 节点/ 之间/ 的/ 共同/ 作用/ 建立/ 虚拟/ 时钟/ 基准/ ;/ 将/ 节点/ 之间/ 的/ 时钟/ 偏差/ 映射/ 为团/ 势能/ ,/ 在/ 此基础/ 上/ 建立/ 了/ 基于/ 伊辛/ 模型/ 能量/ 函数/ 描述/ 的/ 全网/ 时钟/ 同步/ 平均/ 场/ 模型/ ;/ 最后/ ,/ 采用/ 并行/ 能量/ 最小化/ 的/ 方法/ 实现/ 全网/ 时钟/ 分布式/ 同步/ ./ 仿真/ 结果表明/ 所/ 提出/ 的/ 解决方案/ 可以/ 实现/ 高精度/ 的/ 全局/ 时钟/ 同步/ ,/ 并且/ 具有/ 低/ 开销/ 、/ 快速/ 收敛/ 、/ 健壮/ 、/ 可/ 扩展/ 的/ 特点/ ./ 关键词/ 时钟/ 同步/ ;/ 卡尔曼滤波/ 器/ ;/ 平均/ 场/ ;/ 团/ 势能/ ;/ 伊辛/ 模型/ ;/ 能量/ 最小化/ ;/ 物/ 联网/ ;/ 车/ 联网/ 1/ 引言/ 时钟/ 同步/ 是/ 无线/ 自/ 组织/ 网络/ (/ 例如/ 无线/ 传感器/ Page2/ 都/ 需要/ 高精度/ 的/ 同步/ 时钟/ 支持/ 才能/ 正常/ 开展/ [/ 1/ -/ 2/ ]/ ./ 然而/ ,/ 由于/ 无线/ 自/ 组织/ 网络/ 中/ 没有/ 网络/ 基础设施/ ,/ 难以实现/ 时钟/ 基准/ ,/ 并且/ 无线/ 信道/ 中/ 存在/ 不/ 对称/ 时延/ ,/ 网络/ 节点/ 之间/ 的/ 时钟/ 偏差/ 难以/ 准确/ 测量/ ,/ 所以/ 无线/ 自/ 组织/ 网络/ 中/ 的/ 时钟/ 同步/ 一直/ 是/ 一个/ 难题/ ./ 近年来/ ,/ 时钟/ 同步/ 问题/ 正/ 逐渐/ 成为/ 无线/ 自/ 组织/ 网络/ 领域/ 中/ 的/ 一个/ 研究/ 热点/ ./ 国内外/ 学者/ 均/ 提出/ 了/ 不少/ 解决方案/ ./ 总体/ 来讲/ ,/ 现有/ 的/ 时钟/ 同步/ 方案/ 可/ 分为/ 主从/ 同步/ 方式/ 和/ 互/ 同步/ 方式/ 两大类/ ./ 其中/ 在/ 主从/ 同步/ 方式/ 中/ ,/ 将会/ 选定/ 一个/ 特殊/ 的/ 节点/ 作为/ 参考/ 时钟/ ,/ 并/ 以此/ 节点/ 为/ 基准/ 将/ 网络/ 规划/ 成/ 一个/ 生成/ 树/ 或/ 簇/ ./ 网络/ 中/ 的/ 节点/ 通过/ 与/ 其父/ 节点/ 交换/ 时间/ 戳/ ,/ 进行/ 主从/ 同步操作/ ,/ 逐跳/ 达到/ 与/ 基准/ 节点/ 的/ 同步/ ./ 这种/ 时钟/ 同步/ 方法/ 的/ 主要/ 不足/ 在于/ 存在/ 单点/ 失效/ 问题/ ,/ 算法/ 的/ 鲁棒性/ 不高/ ;/ 而且/ 建立/ 和/ 维护/ 生成/ 树/ 或/ 簇/ 的/ 开销/ 比较/ 大/ [/ 3/ ]/ ./ 传感器/ 网络/ 时钟/ 同步/ 协议/ TPSN/ (/ TimeSynchronizationProtocolforSensorNetwork/ )/ [/ 4/ ]/ 和/ 成/ 对/ 广播/ 同步/ PBS/ (/ PairwiseBroadcastSynchronization/ )/ [/ 5/ ]/ 是/ 其中/ 具有/ 代表性/ 的/ 方案/ ./ 而/ 另/ 一种/ 提出/ 较/ 早/ 、/ 影响/ 较广/ 的/ RBS/ (/ ReferenceBroadcastSynchronization/ )/ [/ 6/ ]/ 同步/ 方法/ 则/ 是/ 互/ 同步/ 方式/ 的/ 代表性/ 解决方案/ ./ 与/ 主从/ 同步/ 不同/ ,/ RBS/ 算法/ 虽然/ 也/ 有主/ 节点/ ,/ 但/ 节点/ 不/ 与/ 主/ 节点/ 进行/ 同步/ ./ 主/ 节点/ 的/ 作用/ 是/ 发送/ 参考/ 广播/ ,/ 接收/ 到/ 此/ 参考/ 广播/ 包/ 的/ 节点/ 记录/ 收到/ 广播/ 包/ 的/ 时间/ 戳/ ,/ 并/ 与/ 自己/ 的/ 邻居/ 节点/ 交换/ 时间/ 戳/ ,/ 从而/ 实现/ 邻居/ 节点/ 之间/ 的/ 互/ 同步/ ./ 这种/ 同步/ 方案/ 也/ 被/ 称之为/ “/ 接收者/ -/ 接收者/ ”/ 方法/ ,/ 它/ 消除/ 了/ 发送/ 处理/ 时延/ 、/ 信道/ 接入/ 时延/ 、/ 发射/ 时延/ 和/ 传播/ 时延/ ,/ 有效/ 提高/ 了/ 时钟/ 同步/ 的/ 精度/ ./ 但/ 也/ 存在/ 一些/ 不足/ :/ 首先/ RBS/ 需要/ 参考/ 时钟/ 节点/ 周期性地/ 发送/ 参考/ 广播/ ,/ 这/ 将/ 会/ 产生/ 大量/ 冗余/ 的/ 广播/ 消息/ ;/ 其次/ ,/ 无线网络/ 中/ 节点/ 需要/ 定期/ 在/ 唤醒/ 状态/ 和/ 休眠状态/ 之间/ 切换/ 以/ 节省/ 能量/ ,/ 这/ 明显/ 不能/ 满足/ RBS/ 在/ 广播/ 过程/ 中/ 需要/ 所有/ 节点/ 保持/ 活跃/ 状态/ 的/ 要求/ ;/ 再次/ ,/ 只有/ 一个/ 邻居/ 节点/ 的/ 悬挂/ 节点/ 在/ RBS/ 中/ 无法/ 实现/ 同步/ ./ 无线/ 自/ 组织/ 网络/ 是/ 一种/ 无/ 通信/ 基础设施/ 支持/ 的/ 特殊/ 网络/ ,/ 不/ 存在/ 中心/ 节点/ ,/ 而且/ 具有/ 动态/ 网络拓扑/ 结构/ ./ 因此/ ,/ 不/ 依赖于/ 特殊/ 节点/ 的/ 全/ 分布式/ 时钟/ 同步/ 方案/ 显然/ 更/ 适合/ 于/ 无线/ 自/ 组织/ 网络/ ./ 近年来/ 提出/ 了/ 许多/ 不/ 需要/ 特殊/ 节点/ 的/ 全/ 分布式/ 时钟/ 同步/ 方案/ ./ Simeone/ 等/ 人/ [/ 1/ ]/ 对/ 分布式/ 无线/ 传感器/ 网络/ 时钟/ 同步/ 给出/ 了/ 一个/ 很/ 好/ 的/ 综述/ ./ 在此之后/ ,/ 许多/ 基于/ 平均/ 一致性/ 方法/ 的/ 时钟/ 同步/ 方案/ 被/ 相继/ 提出/ ./ 这些/ 方案/ 可以/ 分为/ 两大类/ ,/ 分别/ 是/ 异步/ 方式/ [/ 7/ -/ 12/ ]/ 和/ 同步/ 方式/ [/ 13/ -/ 15/ ]/ ./ 文献/ [/ 11/ ]/ 给出/ 了/ 异步/ 方式/ 的/ 分布式/ 平均/ 一致性/ 时间/ 同步/ 协议/ DCTS/ (/ DistributedConsensusTimingSynchronization/ )/ 的/ 性能/ 分析/ ,/ 分析/ 结论/ 表明/ DCTS/ 同步/ 性能/ 并/ 不是/ 最优/ 的/ ,/ 当/ 存在/ 不确定性/ 时/ 延时/ ,/ 无法/ 达到/ 平均/ 一致/ ,/ 时钟/ 同步/ 性能/ 将会/ 恶化/ ./ 最近/ ,/ 又/ 提出/ 了/ 一些/ 基于/ 信念/ 传播/ BP/ (/ BeliefPropagation/ )/ 的/ 分布式/ 时钟/ 同步/ 方法/ [/ 3/ ,/ 16/ ]/ ./ 该/ 方法/ 将/ 节点/ 之间/ 的/ 时钟/ 偏差/ 作为/ 边缘/ 分布/ ,/ 以/ 信念/ 传播/ 计算/ 边缘/ 分布/ 的/ 方法/ 求/ 相邻/ 节点/ 之间/ 的/ 时钟/ 偏差/ ,/ 进而/ 实现/ 全网/ 时钟/ 同步/ ./ 仿真/ 结果表明/ 该/ 方案/ 性能/ 优于/ 一致/ 平均/ 算法/ ./ 但/ Leng/ 等/ 人/ [/ 16/ ]/ 假设/ 消息/ 时延/ 是/ 相互/ 独立/ 并且/ 同/ 分布/ 的/ 高斯/ 随机变量/ ,/ 而/ 通过/ 我们/ 的/ 实验/ 测试/ ,/ 这种/ 假设/ 在/ 很多/ 环境/ 下/ 并/ 不/ 成立/ ./ 高斯分布/ 只/ 适合/ “/ 接收者/ -/ 接收者/ ”/ 同步/ 方式/ [/ 6/ ]/ ./ 文献/ [/ 7/ ]/ 提出/ 的/ 异步/ 平均/ 时间/ 同步/ 协议/ ATS/ (/ AverageTimeSynch/ )/ 也/ 存在/ 与/ 此/ 相同/ 的/ 问题/ ./ 文献/ [/ 9/ ]/ 提出/ 一种/ 采用/ 平均/ 一致/ 思路/ 的/ ATSP/ (/ AverageTimeSynchronizationProtocol/ )/ 协议/ ,/ 其/ 采用/ 点到点/ 通讯/ 方式/ ,/ 每次/ 迭代/ 过程/ 中/ 只/ 与/ 一个/ 一跳/ 邻居/ 节点/ 进行/ 一致性/ 运算/ ,/ 同步/ 时间/ 较长/ ./ 而且/ 当/ 出现/ 节点/ 移动/ 或/ 节点/ 损失/ 时/ ,/ 会/ 造成/ 同步/ 过程/ 较大/ 的/ 波动/ ,/ 系统/ 的/ 鲁棒性/ 不强/ ./ 此外/ 该/ 方法/ 采用/ 双向/ 报文交换/ 方式/ ,/ 通过/ 3/ 次/ 握手/ 交换/ 6/ 个/ 时间/ 戳/ 来/ 计算/ 两点/ 之间/ 时延/ ,/ 同步/ 所/ 需/ 迭代/ 次数/ 较/ 多/ ./ 文献/ [/ 13/ ]/ 提出/ 一种/ 同步/ 方式/ 的/ 梯队/ 时间/ 同步/ 协议/ GTSP/ (/ GradientTimeSynchronizationProtocol/ )/ ,/ 其/ 主要/ 思想/ 是/ 本地/ 节点/ 每次/ 广播/ 本地/ 时钟/ ,/ 并/ 将/ 获得/ 的/ 所有/ 邻居/ 时钟/ 值/ 与/ 本地/ 时钟/ 值取/ 平均值/ 作为/ 本地/ 时钟/ 值/ 更新/ ./ 与/ 本文/ 时钟/ 同步/ 方法/ 不同/ 的/ 是/ ,/ 其/ 忽略/ 报文/ 传递/ 过程/ 中/ 的/ 传输/ 延迟/ ,/ 直接/ 利用/ 报文/ 中/ 的/ 邻居/ 时钟/ 值/ ,/ 因此/ 每次/ 迭代/ 时所/ 利用/ 的/ 邻居/ 时钟/ 并/ 不/ 准确/ ./ 除/ 上述/ 解决方案/ 外/ ,/ 一些/ 基于/ 成/ 对/ “/ 接收者/ -/ 接收者/ ”/ 方式/ 的/ 时钟/ 同步/ 方案/ 也/ 被/ 相继/ 提出/ ,/ 如/ 文献/ [/ 17/ ]/ 提出/ 的/ 相对/ 参考/ 接收者/ // 接收者/ 时钟/ 同步/ 协议/ R4Syn/ (/ RelativeReferencelessReceiver/ // ReceiverSynchronization/ )/ 仅仅/ 估计/ 单跳/ 邻居/ 间/ 的/ 时钟/ 差值/ ,/ 并/ 不/ 对/ 节点/ 的/ 时钟/ 进行/ 调整/ ,/ 多/ 跳/ 的/ 同步/ 也/ 只是/ 根据/ 应用/ 需要/ 才/ 执行/ ,/ 因此/ 该/ 方案/ 并/ 没有/ 达到/ 真正/ 意义/ 上/ 的/ 全局/ 时钟/ 同步/ ./ 针对/ 上述/ 无线/ 自/ 组织/ 网络/ 中/ 时钟/ 同步/ 方案/ 存在/ 的/ 不足/ ,/ 本文/ 提出/ 了/ 一种/ 基于/ 平均/ 场/ 理论/ 的/ 分布式/ 时钟/ 同步/ 方案/ MFSP/ (/ MeanFieldbasedSynchroni/ -/ zationProtocol/ )/ ./ 该/ 方案/ 中/ 每个/ 节点/ 只/ 需/ 与其/ 一跳/ Page3/ 邻居/ 通信/ ,/ 并/ 各自/ 独立/ 地/ 进行/ 同步/ 计算/ ./ 采用/ 广播/ 方式/ 实现/ 双向/ 时间/ 戳/ 交换/ ,/ 基于/ 卡尔曼滤波/ 算法/ 对/ 时钟/ 偏差/ 进行/ 精确/ 估计/ ;/ 基于/ 伊辛/ 模型/ 能量/ 函数/ 描述/ 时钟/ 同步/ 模型/ ,/ 基于/ 平均/ 场/ 理论/ 确定/ 全网/ 虚拟/ 时钟/ 基准/ ,/ 采用/ 并行/ 能量/ 最小化/ 的/ 方法/ 实现/ 全网/ 时钟/ 分布式/ 同步/ ./ 本文/ 方案/ 具有/ 低/ 开销/ 、/ 快速/ 收敛/ 、/ 健壮/ 、/ 可/ 扩展/ 的/ 特点/ ./ 本文/ 所/ 采用/ 的/ 平均/ 场/ 方法/ 目前/ 在/ 时钟/ 同步/ 算法/ 中尚/ 没有/ 应用/ ,/ 与/ 之/ 相/ 类似/ 的/ 方法/ 是/ 基于/ 一致性/ 的/ 时钟/ 同步/ 算法/ ./ 基于/ 一致性/ 的/ 时钟/ 同步/ 算法/ 与/ 本文/ 方法/ 相比/ ,/ 具有/ 如下/ 区别/ :/ (/ 1/ )/ 大部分/ 一致性/ 同步/ 算法/ 中/ 没有/ 考虑/ 传输/ 时延/ ,/ 而/ 传输/ 时延/ 的/ 存在/ 将/ 极大/ 地/ 影响/ 一致性/ 同步/ 算法/ 的/ 同步/ 效果/ [/ 11/ ]/ ./ 文献/ [/ 18/ ]/ 虽然/ 考虑/ 了/ 时延/ ,/ 但/ 认为/ 所有/ 时延/ 服从/ 高斯分布/ ,/ 且/ 均值/ 相同/ ,/ 这种/ 方法/ 在/ 时延/ 不/ 均衡/ 的/ 网络/ 中/ 无法/ 适用/ ;/ (/ 2/ )/ 大部分/ 一致性/ 同步/ 算法/ 仅/ 在/ 一对/ 节点/ 之间/ 进行/ 一致性/ 运算/ ,/ 造成/ 收敛/ 速度/ 较慢/ ;/ (/ 3/ )/ 一致性/ 同步/ 算法/ 只是/ 进行/ 平均/ 运算/ ,/ 当/ 具有/ 较大/ 时延/ 的/ 节点/ 加入/ 网络/ 时/ ,/ 会/ 造成/ 较大/ 的/ 时延/ 波动/ ./ 而/ 本文/ 提出/ 的/ 方法/ 在/ 此/ 3/ 个/ 方面/ 有所改善/ ./ 本文/ 第/ 2/ 节对/ 无线网络/ 中/ 的/ 时延/ 特性/ 进行/ 分析/ ,/ 提出/ 一个/ 基于/ 卡尔曼滤波/ 器/ 的/ 时延/ 滤波/ 算法/ ,/ 用于/ 准确/ 估计/ 相邻/ 节点/ 之间/ 的/ 时钟/ 偏差/ ;/ 第/ 3/ 节/ 给出/ 基于/ 平均/ 场/ 的/ 时钟/ 同步/ 问题/ 模型/ ,/ 并/ 提出/ 全/ 分布式/ 时钟/ 同步/ 算法/ ;/ 第/ 4/ 节/ 通过/ 仿真/ 对/ 提出/ 的/ 分布式/ 时钟/ 同步/ 算法/ 的/ 性能/ 进行/ 评估/ 和/ 分析/ ;/ 第/ 5/ 节对/ 全文/ 进行/ 总结/ ./ 2/ 时钟/ 偏差/ 估计/ 2.1/ 时钟/ 同步/ 模型/ 在/ 讨论/ 全/ 分布式/ 全局/ 时钟/ 同步/ 之前/ ,/ 首先/ 我们/ 需要/ 分析/ 一下/ 两个/ 节点/ 之间/ 的/ 时钟/ 关系/ ./ 我们/ 可以/ 给出/ 节点/ i/ 在/ t/ 时刻/ 的/ 本地/ 时钟/ 值/ C/ 为/ 其中/ 参数/ θ/ i/ ,/ fi/ 分别/ 被称作/ 时钟/ 偏差/ 和/ 时钟/ 频偏/ [/ 2/ ]/ ./ 根据/ 式/ (/ 1/ )/ ,/ 网络/ 中/ 的/ 节点/ i/ 和/ j/ 之间/ 的/ 时钟/ 具有/ 如下/ 关系/ :/ 其中/ θ/ i/ ,/ j/ 和/ fi/ ,/ j/ 分别/ 代表/ 节点/ i/ 和/ j/ 之间/ 的/ 相对/ 时钟/ 偏差/ 和/ 时钟/ 相对/ 频偏/ ./ 如果/ 节点/ i/ 和/ j/ 之间/ 的/ 时钟/ 达到/ 了/ 完全/ 同步/ ,/ 则/ θ/ i/ ,/ j/ =/ 0/ ,/ fi/ ,/ j/ =/ 1/ ./ 时钟/ 同步/ 的/ 目标/ 就是/ 精确/ 地/ 估计/ 这/ 两个/ 参数/ ,/ 使得/ 任意/ 两个/ 节点/ 之间/ 的/ 时钟/ 达到/ 完全/ 同步/ ./ 时钟/ 频偏/ 受/ 诸如/ 温度/ 、/ 湿度/ 、/ 电压/ 、/ 设备/ 老化/ 等/ 环境因素/ 影响/ ,/ 因此/ 比较/ 难/ 掌控/ 或/ 调整/ ./ 因此/ 许多/ 现有/ 的/ 同步/ 方案/ 只是/ 估计/ 时钟/ 偏差/ ,/ 通过/ 周期性/ 的/ 双向/ 时间/ 戳/ 交换/ 计算/ 获得/ 时钟/ 偏差/ ,/ 并/ 依此/ 调整/ 本地/ 时钟/ 达到/ 时钟/ 同步/ ,/ 本文/ 也/ 采取/ 这种/ 策略/ ./ 2.2/ 双向/ 时间/ 戳/ 交换/ 双向/ 时间/ 戳/ 交换/ 是/ 估计/ 时钟/ 偏差/ 的/ 经典/ 策略/ ./ 假定/ 节点/ i/ 需要/ 与/ 节点/ j/ 进行/ 同步/ ,/ 双向/ 时间/ 戳/ 交换/ 机制/ 如图/ 1/ 所示/ ./ 图/ 1/ 节点/ i/ 和/ j/ 之间/ 的/ 双向/ 时间/ 戳/ 交换/ 过程/ 在/ 第/ k/ 轮次/ 的/ 双向/ 时间/ 戳/ 交换/ 过程/ 中/ ,/ 节点/ i/ 在/ 真实/ 时刻/ t1/ ,/ k/ 将/ 携带/ 本地/ 时钟/ Ci/ (/ t1/ ,/ k/ )/ 的/ 消息/ 发送给/ 节点/ j/ ./ 节点/ j/ 在/ 真实/ 时刻/ t2/ ,/ k/ 接收/ 到/ 该/ 消息/ ,/ 并/ 标记/ 自己/ 本地/ 时间/ 戳/ Cj/ (/ t2/ ,/ k/ )/ ./ 紧接着/ ,/ 节点/ j/ 在/ 真实/ 时刻/ t3/ ,/ k/ 回复/ 一个/ 携带/ 时间/ 戳/ Cj/ (/ t2/ ,/ k/ )/ 和/ Cj/ (/ t3/ ,/ k/ )/ 的/ 消息/ 给/ 节点/ i/ ./ 最后/ 节点/ i/ 在/ 本地/ 时钟/ Ci/ (/ t4/ ,/ k/ )/ 接收/ 到/ 该/ 回复/ 消息/ ./ 以上/ 过程/ ,/ 可以/ 描述/ 如下/ :/ 其中/ :/ θ/ i/ ,/ j/ 表示/ 节点/ i/ 和/ j/ 之间/ 的/ 相对/ 时钟/ 偏差/ ;/ DelayF/ ,/ k/ 和/ DelayB/ ,/ k/ 分别/ 表示/ 在/ 消息/ 传输/ 时延/ 中/ 从/ 节点/ i/ 到/ j/ 的/ 时延/ (/ 前向/ 时延/ )/ 和/ 从/ 节点/ j/ 到/ i/ 的/ 时延/ (/ 反向/ 时延/ )/ ./ 根据/ 式/ (/ 3/ )/ 、/ (/ 4/ )/ ,/ 如果/ 双向/ 时延/ 是/ 对称/ 的/ ,/ 即/ DelayF/ ,/ k/ 与/ DelayB/ ,/ k/ 相等/ ,/ 那么/ 可以/ 精确/ 地/ 计算/ 出/ θ/ i/ ,/ j/ ./ 但/ 在/ 无线网络/ 中/ ,/ 双向/ 时延/ 是/ 不/ 对称/ 且/ 不/ 稳定/ 的/ ,/ 因此/ 为了/ 提高/ 时钟/ 同步/ 精度/ ,/ 我们/ 需要/ 分析/ 传输/ 时延/ 的/ 组成/ ,/ 并/ 寻找/ 出/ 一种/ 能够/ 减少/ 不/ 对称/ 时延/ 影响/ 的/ 解决方案/ ./ 2.3802/ ./ 11/ 不/ 对称/ 时延/ 分析/ 时钟/ 同步/ 之所以/ 存在/ 同步/ 误差/ ,/ 其/ 根本原因/ 是/ 在/ Page4/ 时间/ 戳/ 交换/ 过程/ 中/ 存在/ 传输/ 时延/ ./ 通常/ 情况/ 下/ 消息传递/ 过程/ 中/ 的/ 时延/ 可以/ 由/ 以下/ 6/ 个/ 部分/ 组成/ [/ 19/ -/ 20/ ]/ :/ (/ 1/ )/ 发送/ 处理/ 时延/ ./ 从/ 应用层/ 产生/ 数据/ 到/ 在/ MAC/ 层/ 封包/ 完成/ 的/ 时间/ ,/ 受/ 操作系统/ 和/ 当前/ 处理器/ 负载/ 的/ 影响/ ./ (/ 2/ )/ 信道/ 接入/ 时延/ ./ MAC/ 协议/ 获取/ 空闲/ 信道/ 的/ 等待时间/ ,/ 受/ 当前/ 网络/ 负载/ 影响/ ,/ 并且/ 根据/ CSMA/ // CA/ 机制/ 特点/ 变化/ ./ (/ 3/ )/ 发射/ 时延/ ./ 在/ 物理层/ 发送数据/ 帧/ 的/ 时间/ ,/ 受/ 数据/ 帧/ 长度/ 和/ 物理层/ 发送/ 速率/ 影响/ ./ (/ 4/ )/ 传播/ 时延/ ./ 数据/ 帧/ 在/ 信道/ 中/ 传输/ 所/ 产生/ 的/ 时延/ ,/ 与/ 通信/ 节点/ 间/ 的/ 距离/ 有关/ ./ 由于/ 无线/ 传感器/ 网络/ 节点/ 之间/ 的/ 距离/ 一般/ 在/ 100m/ 以内/ ,/ 因此/ 传播/ 时延/ 不足/ 1/ μ/ s/ ,/ 通常/ 可以/ 忽略/ ./ 但/ 当/ 节点/ 之间/ 距离/ 较远/ 或/ 同步/ 精度/ 要求/ 非常/ 高时/ ,/ 该/ 部分/ 时延/ 是/ 需要/ 纳入/ 计算/ 的/ ./ (/ 5/ )/ 接收/ 时延/ ./ 在/ 物理层/ 完整/ 接收数据/ 帧/ 所/ 耗费/ 的/ 时间/ ,/ 这部分/ 时延/ 通常/ 与/ 发射/ 时延/ 重叠/ ./ (/ 6/ )/ 接收/ 处理/ 时延/ ./ 节点/ 处理/ 数据/ 帧/ 所/ 花费/ 的/ 时间/ ,/ 包括/ 将/ MAC/ 层/ 的/ 帧/ 依次/ 解/ 封装/ ,/ 提取/ 出/ 应用层/ 数据/ ,/ 并/ 交给/ 相应/ 应用层/ 进程/ 的/ 时延/ ./ 其/ 特性/ 与/ 发送/ 处理/ 时延/ 基本相同/ ./ 这些/ 传输/ 时延/ 根据/ 其/ 统计/ 特性/ 可以/ 分为/ 确定性/ 时延/ 和/ 不确定性/ 时延/ 两大类/ [/ 2/ ]/ ./ 不确定性/ 时延/ 是/ 影响/ 同步/ 精度/ 的/ 主要/ 原因/ ,/ 已经/ 提出/ 了/ 一些/ 统计/ 模型/ 用于/ 描述/ 不确定性/ 时延/ [/ 2/ ]/ ./ 需要/ 指出/ 的/ 是/ 不确定性/ 时延/ 依赖/ 各种/ 变化/ 因素/ ,/ 单一/ 的/ 模型/ 无法/ 对/ 它/ 进行/ 准确/ 的/ 描述/ ./ 目前/ ,/ 802.11/ 系列/ 协议/ 是/ 应用/ 最为/ 广泛/ 的/ 无线网络/ 标准/ ,/ 因此/ 本文/ 仅/ 对/ 802.11/ 系列/ 中/ 的/ 不确定性/ 时延/ 进行/ 分析/ ./ 在/ 802.11/ 中/ 产生/ 不确定性/ 时延/ 的/ 构成/ 因素/ 是/ 由/ DCF/ (/ DistributedCoordina/ -/ tionFunction/ )/ 机制/ 造成/ 的/ 信道/ 接入/ 时延/ ./ 在/ 使用/ DCF/ 的/ 802.11/ 无线/ 传输/ 过程/ 中/ ,/ 有/ 以下/ 两条/ 基本/ 规则/ [/ 21/ ]/ :/ (/ 1/ )/ 如果/ 信道/ 空闲/ ,/ 并且/ 信道/ 空闲/ 时间/ 长度/ 大于/ DIFS/ ,/ 传输/ 将/ 立即/ 进行/ ./ (/ 2/ )/ 如果/ 信道/ 忙碌/ ,/ 发送/ 站点/ 必须/ 监听/ 该/ 信道/ ,/ 直到/ 信道/ 重新/ 恢复/ 空闲/ ,/ 并且/ 空闲/ 时间/ 大于/ DIFS/ ,/ 则/ 发送/ 节点/ 进入/ 二进制/ 指数/ 退避/ 过程/ ./ 节点/ 必须/ 要/ 等待/ 一个/ 被/ 称为/ 竞争/ 窗口/ CW/ (/ ContentionWindow/ )/ 的/ 随机/ 退避/ 时间/ ,/ 这个/ 竞争/ 窗口/ 可以/ 被/ 分解/ 为/ 若干个/ 时隙/ aSlotTime/ ./ 时隙/ 的/ 大小/ 由/ 物理层/ 决定/ ,/ 随机/ 退避/ 时间/ BackoffTime/ 的/ 大小/ 由式/ (/ 5/ )/ 决定/ ./ 其中/ ,/ 随机数/ Random/ 大小/ 限制/ 在/ 0/ ~/ CW/ 范围/ 内/ ,/ 并且/ 被/ 写入/ 退避/ 计数器/ 中/ ./ 当/ 每/ 一个/ 时隙/ 结束/ 时/ ,/ 随机/ 退避/ 计数器/ 减/ 1/ ./ 当/ 计数器/ 减小/ 为/ 0/ 时/ ,/ 所/ 要/ 发送/ 的/ 帧/ 就/ 会/ 在/ 下/ 一个/ 空闲/ 时隙/ 中/ 被/ 发送/ 出去/ ./ 每当/ 出现/ 发送/ 失败/ 时/ (/ 例如/ 存在/ 传输/ 冲突/ )/ ,/ CW/ 以/ 2/ 的/ 指数/ 速度/ 增加/ ,/ 重新/ 进入/ 退避/ 侦听/ 状态/ ,/ 直到/ 发送/ 成功/ 或者/ 超时/ ./ 因此/ 信道/ 接入/ 时延/ 取决于/ 802.11/ 网络/ 中/ 当前/ 的/ 信道/ 状态/ ./ 文献/ [/ 22/ ]/ 对/ 802.11/ 无线/ 自/ 组织/ 网络/ 中/ 的/ 接入/ 时延/ 进行/ 了/ 分析/ ,/ 给出/ 了/ 分析模型/ ./ 时钟/ 同步/ 算法/ 可以/ 在/ OSI/ 参考模型/ 的/ 每个/ 层中/ 实现/ ,/ 越/ 靠近/ 物理层/ ,/ 不确定性/ 时延/ 越小/ ,/ 可/ 获得/ 的/ 时钟/ 同步/ 精度/ 越高/ ./ 如果/ 使用/ 基于/ 硬件/ 时间/ 戳/ 的/ 方式/ ,/ 802.11/ 中/ 的/ 接入/ 时延/ 将/ 可以/ 被/ 忽略/ ,/ 能够/ 获得/ 较/ 高精度/ 的/ 时钟/ 同步/ ./ 文献/ [/ 23/ ]/ 选择/ 了/ TX/ _/ RDY/ 和/ MD/ _/ RDY/ 上升/ 沿/ 作为/ 时间/ 戳/ 的/ 触发/ 源/ ,/ 其/ 延时/ 抖动/ 可以/ 控制/ 到/ 200ns/ 以内/ ./ 但是/ 目前/ 常用/ 的/ 802.11/ 芯片/ 并/ 不/ 支持/ 硬件/ 时间/ 戳/ ,/ 采用/ 硬件/ 时间/ 戳/ 必然/ 会/ 增加/ 网络/ 实施/ 的/ 成本/ ./ 因此/ 我们/ 使用/ 软件/ 时间/ 戳/ 来/ 估计/ 两个/ 相邻/ 节点/ 间/ 的/ 时钟/ 偏差/ ./ 2.4/ 基于/ 卡尔曼滤波/ 的/ 时延/ 滤波/ 算法/ 为了/ 实现/ 全网/ 的/ 时钟/ 同步/ ,/ 我们/ 首先/ 需要/ 准确/ 计算/ 邻居/ 节点/ 间/ 的/ 时钟/ 偏差/ ./ 如前所述/ ,/ 不/ 对称/ 时延/ 是/ 实现/ 高精度/ 时钟/ 同步/ 的/ 主要/ 影响/ 因素/ ./ 因此/ 我们/ 设计/ 了/ 一种/ 卡尔曼滤波/ 器来/ 获取/ 高精度/ 的/ 时钟/ 偏差/ ./ 我们/ 将/ 时钟/ 定义/ 为/ 状态变量/ x/ ,/ 以/ 第/ k/ 次/ 同步/ 过程/ 为例/ ,/ 我们/ 可以/ 根据/ 式/ (/ 3/ )/ 、/ (/ 4/ )/ 定义/ 时钟/ 状态方程/ 如下/ :/ 式/ (/ 6/ )/ 减去/ 式/ (/ 7/ )/ 可以/ 得到/ x/ (/ k/ )/ =/ {/ [/ t2/ (/ k/ )/ -/ t1/ (/ k/ )/ ]/ -/ [/ t4/ (/ k/ )/ -/ t3/ (/ k/ )/ ]/ }/ // 2/ -/ 我们/ 定义/ z/ (/ k/ )/ =/ {/ [/ t2/ (/ k/ )/ -/ t1/ (/ k/ )/ ]/ -/ [/ t4/ (/ k/ )/ -/ t3/ (/ k/ )/ ]/ }/ // 2/ (/ 9/ )/ 于是/ ,/ 我们/ 可以/ 得到/ 卡尔曼滤波/ 器/ 的/ 观测/ 方程/ :/ 其中/ d/ (/ k/ )/ 表示/ 两个/ 邻居/ 节点/ 间/ 的/ 双向/ 时延/ 差值/ 的/ 二分之一/ ./ 显然/ ,/ 前向/ 时延/ 和/ 后/ 向/ 时延/ 是/ 独立/ 同/ 分布/ 的/ 随机变量/ ./ 我们/ 使用/ 相同/ 大小/ 的/ 广播/ 消息/ 来/ 计算/ 时延/ ,/ 并且/ 传输/ 过程/ 中/ 不/ 使用/ RTS/ (/ RequestToSend/ )/ 、/ CTS/ (/ ClearToSend/ )/ 和/ ACK/ (/ Acknowledge/ -/ Page5ment/ )/ 帧/ ./ 在/ 这种/ 情况/ 下/ ,/ 前/ 向/ 和/ 后/ 向/ 的/ 不/ 对称/ 时延/ 主要/ 是/ 由于/ 依赖/ 信道/ 忙碌/ 状态/ 的/ 二进制/ 指数/ 后退/ BEB/ (/ BinaryExponentialBackoff/ )/ 算法/ 造成/ 的/ 接入/ 时延/ ./ 文献/ [/ 24/ ]/ 的/ 仿真/ 与/ 实验/ 结果表明/ ,/ 在/ 网络/ 节点/ 个数/ 和/ 帧/ 长度/ 固定/ 的/ 情况/ 下/ ,/ 信道/ 接入/ 时延/ 的/ 均值/ 和/ 方差/ 是/ 确定/ 的/ ./ 尽管/ 在/ 一次/ 往返/ 通信/ 中/ 信道/ 接入/ 时延/ 是/ 不/ 对称/ 的/ ,/ 但是/ 根据/ 大数/ 定律/ ,/ 在/ 样本/ 数量/ 充分/ 大/ 的/ 条件/ 下/ ,/ 我们/ 可以/ 认为/ 信道/ 接入/ 时延/ 是/ 对称/ 的/ ,/ 因此/ 传输/ 时延/ 也/ 可以/ 认为/ 是/ 对称/ 的/ ,/ 这种/ 情况/ 下/ 可以/ 假设/ d/ (/ k/ )/ 符合/ 高斯分布/ N/ (/ 0/ ,/ σ/ 2delay/ 代表/ 单向/ 时延/ 的/ 方差/ ./ 仿真/ 和/ 实验/ 结果表明/ 这/ σ/ 2/ 种/ 假设/ 是/ 合理/ 的/ ./ 状态变量/ x/ 是/ 时钟/ 偏差/ ,/ 根据/ 时钟/ 偏差/ 的/ 定义/ ,/ x/ (/ k/ )/ 也/ 可以/ 按下式/ 计算/ :/ 由于/ 时钟/ 晶振/ 总会/ 受到/ 环境/ 的/ 影响/ 而/ 发生/ 频率/ 偏移/ ,/ 所以/ 本地/ 时钟/ 会/ 逐渐/ 偏移/ 真实/ 时间/ ./ 频率/ 偏移/ 造成/ 的/ 时钟/ 抖动/ 值/ 通常/ 在/ 每秒/ 1/ ~/ 100/ μ/ s/ 范围/ 内/ ./ 文献/ [/ 25/ ]/ 进行/ 了/ 大量/ 的/ 实验/ ,/ 通过/ 统计分析/ 验证/ 了/ 这种/ 时钟/ 抖动/ 符合/ 均值/ 为/ 0/ 的/ 标准/ 正态分布/ ./ 时钟/ 抖动/ 的/ 原因/ 主要/ 是/ 晶振/ 受到/ 环境/ 和/ 器件/ 老化/ 的/ 影响/ ,/ 其中/ 环境温度/ 是/ 主要/ 原因/ [/ 26/ ]/ ./ 在/ 一般/ 的/ 无线/ 自/ 组织/ 网络/ 中/ ,/ 节点/ 工作/ 在/ 大致相同/ 的/ 环境/ 中/ ,/ 并且/ 具有/ 相同/ 的/ 结构/ ./ 因此/ 在/ 本文/ 中/ ,/ 我们/ 可以/ 合理/ 地/ 假定/ 每个/ 节点均/ 采用/ 相同/ 的/ 时钟/ 晶振/ ,/ 工作/ 在/ 大致相同/ 的/ 环境/ ,/ 所以/ 每个/ 节点/ 的/ 时钟/ 抖动/ 是/ 独立/ 同/ 分布/ 的/ 随机变量/ ./ 因此/ 我们/ 可以/ 得到/ Ci/ (/ k/ +/ 1/ )/ =/ Ci/ (/ k/ )/ +/ T/ +/ ε/ i/ (/ k/ )/ ,/ ε/ i/ (/ k/ )/ ~/ N/ (/ 0/ ,/ σ/ 2/ )/ (/ 13/ )/ Cj/ (/ k/ +/ 1/ )/ =/ Cj/ (/ k/ )/ +/ T/ +/ ε/ j/ (/ k/ )/ ,/ ε/ j/ (/ k/ )/ ~/ N/ (/ 0/ ,/ σ/ 2/ )/ (/ 14/ )/ 式/ 中/ T/ 为/ 采样/ 周期/ ./ 结合/ 式/ (/ 12/ )/ ~/ (/ 14/ )/ ,/ 有式/ 中/ ε/ (/ k/ )/ =/ ε/ j/ (/ k/ )/ -/ ε/ i/ (/ k/ )/ ./ 由于/ ε/ i/ (/ k/ )/ 和/ ε/ j/ (/ k/ )/ 是/ 独立/ 同/ 分布/ 的/ 随机变量/ ,/ 因此/ 至此/ ,/ 我们/ 得到/ 卡尔曼滤波/ 器/ 的/ 状态方程/ 和/ 观测/ 方程/ ,/ 即/ {/ x/ (/ k/ +/ 1/ )/ =/ x/ (/ k/ )/ +/ ε/ (/ k/ )/ ,/ ε/ (/ k/ )/ ~/ N/ (/ 0/ ,/ 2/ σ/ 2/ )/ z/ (/ k/ )/ =/ x/ (/ k/ )/ +/ d/ (/ k/ )/ ,/ d/ (/ k/ )/ ~/ N/ (/ 0/ ,/ σ/ 2/ 对于/ 卡尔曼滤波/ 器/ 的/ 实现/ 过程/ ,/ 已经/ 有/ 许多/ 相关/ 的/ 文献/ 研究/ ,/ 本文/ 不再/ 赘述/ ./ 通过/ 卡尔曼滤波/ 器/ ,/ 我们/ 可以/ 得到/ 邻居/ 节点/ 间/ 较为/ 精确/ 的/ 时钟/ 偏差/ ./ 在/ 此基础/ 上/ ,/ 我们/ 需要/ 寻找/ 一种/ 不/ 依赖于/ 特殊/ 节点/ 的/ 全/ 分布式/ 多/ 跳/ 无线/ 自/ 组织/ 网络/ 的/ 时钟/ 同步/ 解决方案/ ./ 3/ 基于/ 平均/ 场/ 的/ 分布式/ 时钟/ 同步/ 无线/ 自/ 组织/ 网络/ 是/ 一种/ 分布式系统/ ,/ 不/ 需要/ 通信/ 基础设施/ 支持/ ,/ 没有/ 中心/ 节点/ ,/ 因此/ 也/ 不/ 存在/ 时钟/ 基准点/ ,/ 难以/ 建立/ 全网/ 基准/ 时钟/ ./ 现有/ 的/ 解决方案/ 或者/ 选择/ 一个/ 特殊/ 节点/ 作为/ 时钟/ 基准点/ ,/ 或者/ 仅/ 计算/ 邻居/ 节点/ 之间/ 的/ 时钟/ 偏差/ ,/ 同步操作/ 由/ 上层/ 应用/ 决定/ ./ 为了/ 摆脱/ 对/ 参考/ 节点/ 的/ 依赖/ ,/ 本文/ 采用/ 平均/ 场/ 的/ 方法/ ./ 平均/ 场/ 的/ 核心思想/ 是/ ,/ 不去/ 计算/ 局部/ 的/ 、/ 处处/ 不同/ 的/ 节点/ 之间/ 的/ 时钟/ 差/ ,/ 而是/ 将/ 节点/ 之间/ 的/ 时钟/ 差/ 的/ 总体/ 效果/ 等价/ 于/ 一个/ “/ 平均/ 场/ ”/ ./ 在/ 本文/ 中/ ,/ 我们/ 将/ 这种/ “/ 平均/ 场/ ”/ 定义/ 为/ 虚拟/ 时钟/ 基准/ ,/ 该/ 基准/ 是/ 节点/ 与其/ 所有/ 一跳/ 邻居/ 的/ 时钟/ 差/ 进行/ 集体化/ 处理/ ,/ 以/ 平均/ 时钟/ 偏差/ 最小/ 为/ 目标/ 而/ 设置/ ./ 平均/ 场/ 也/ 是/ 一种/ 互/ 同步/ 方法/ ,/ 仅/ 需要/ 与/ 一/ 跳/ 邻居/ 节点/ 进行/ 时钟/ 信息/ 交换/ ,/ 因此/ 本地/ 时钟/ 值仅/ 依赖于/ 其/ 所有/ 一跳/ 邻居/ 的/ 时钟/ ./ 也就是说/ ,/ 本地/ 时钟/ 具有/ 空间/ 马尔可夫/ 性/ ./ 我们/ 将/ 基于/ 空间/ 马尔可夫/ 随/ 机场/ 建立/ 网络/ 的/ 时钟/ 同步/ 模型/ ./ 根据/ 马尔可夫/ 随/ 机场/ 与/ 吉布斯/ 随/ 机场/ 的/ 等价/ 性/ ,/ 通过/ 引入/ 邻居/ 系统/ 和/ 团/ 势能/ ,/ 得到/ 了/ 基于/ 平均/ 场伊辛/ 模型/ 的/ 时钟/ 同步/ 能量/ 函数/ ./ 并/ 在/ 此基础/ 上/ 给出/ 了/ 采用/ 能量/ 最小化/ 寻优/ 的/ 时钟/ 同步/ 算法/ ./ 3.1/ 时钟/ 同步/ 的/ 平均/ 场/ 模型/ 无线/ 自/ 组织/ 网络/ 通常/ 可以/ 用/ 一个/ 图/ G/ =/ (/ V/ ,/ E/ )/ 来/ 表示/ ,/ 其中/ V/ 表示/ 节点/ 的/ 集合/ ,/ E/ 表示/ 节点/ 间/ 链路/ 的/ 集合/ ./ 考虑/ 到/ 时钟/ 的/ 空间/ 马尔可夫/ 性/ ,/ 我们/ 采用/ 邻域/ 系统对/ 无线/ 自/ 组织/ 网络/ 进行/ 建模/ ./ 一个/ 邻域/ 系统/ N/ 可以/ 定义/ 为/ 其中/ Ni/ 是/ 节点/ i/ 的/ 邻居/ 节点/ 集合/ ,/ 其/ 相邻/ 关系/ 具有/ 如下/ 特性/ [/ 27/ ]/ :/ (/ 1/ )/ 任意/ 给定/ 一点/ i/ 与其/ 自身/ 并/ 不/ 构成/ 邻居/ 关系/ :/ i/ / Ni/ ;/ (/ 2/ )/ 相邻/ 关系/ 是/ 相互/ 的/ :/ 我们/ 采用/ 团/ 的/ 概念/ 来/ 对/ 时钟/ 同步/ 中/ 节点/ 之间/ 的/ 相互作用/ 进行/ 建模/ ,/ 相对/ 于/ (/ V/ ,/ E/ )/ ,/ 团/ C/ 是/ 网络/ 中/ 节点/ 集/ 的/ 一个/ 子集/ ,/ 该子/ 集中/ 的/ 任意/ 两个/ 节点/ 存在/ 边/ 连接/ ./ 更进一步/ ,/ 我们/ 定义/ 单/ 节点/ 团/ C1/ 和/ 双/ 邻居/ 节点/ 团/ C2/ :/ 团/ 也/ 可以/ 定义/ 三/ 邻居/ 节点/ 团/ C3/ ,/ 四/ 邻居/ 节点/ 团/ Page6C4/ 等等/ ./ 但/ 本文/ 中/ 只/ 考虑/ C1/ 团/ 和/ C2/ 团/ ./ 更进一步/ ,/ 我们/ 采用/ 标签/ 问题/ [/ 27/ ]/ 对/ 时钟/ 同步进行/ 描述/ ./ 所谓/ 标签/ 就是/ 一个/ 节点/ 可能/ 发生/ 的/ 事件/ ./ 一个/ 标签/ 集合/ 可以/ 是/ 连续/ 的/ ,/ 也/ 可以/ 是/ 离散/ 的/ ./ 在/ 时钟/ 同步/ 中/ ,/ 标签/ 集合/ 是/ 连续/ 的/ 并且/ 与/ 实数/ 域/ R/ 对应/ ./ 标签/ 化是/ 指/ 从/ 一个/ 标签/ 集合/ 中/ 分配/ 一个/ 标签/ 给/ V/ 中/ 的/ 每个/ 节点/ ,/ 在/ 时钟/ 同步/ 中/ 就是/ 设置/ 节点/ 的/ 时钟/ ./ 分配/ 标签/ 在/ 随机/ 领域/ 术语/ 中/ 称作/ 配置/ ./ 在/ 时钟/ 同步/ 中/ ,/ 所有/ 节点/ 具有/ 一个/ 相同/ 的/ 标签/ 集合/ ,/ 配置/ 空间/ 是/ 其中/ m/ 代表/ 网络/ 中/ 节点/ 的/ 个数/ ./ 我们/ 使用/ 符号/ Fi/ =/ fi/ 指示/ 节点/ i/ 获得/ 本地/ 时钟/ 值/ fi/ 这一/ 事件/ ,/ 符号/ (/ F1/ =/ f1/ ,/ F2/ =/ f2/ ,/ …/ ,/ Fm/ =/ fm/ )/ 指示/ 全网/ 时钟/ 状态/ ./ 进一步/ 简化/ ,/ 我们/ 将/ 其/ 缩写成/ F/ =/ f/ ,/ 其中/ f/ 是/ F/ 的/ 一个/ 配置/ ./ f/ 也/ 是/ 一个/ 联合/ 事件/ ,/ 联合/ 事件/ f/ 的/ 概率/ 可以/ 表示/ 为/ P/ (/ f/ )/ ./ 相应/ 的/ ,/ 节点/ i/ 分配/ 一个/ 标签/ fi/ ,/ 也/ 就是/ 节点/ i/ 获得/ 的/ 是/ 时钟/ 值/ fi/ 的/ 概率/ ,/ 可以/ 表示/ 为/ P/ (/ fi/ )/ ./ 对于/ 邻域/ 系统/ N/ ,/ F/ 是/ 在/ G/ 上/ 的/ 马尔可夫/ 随/ 机场/ ,/ 因为/ 它/ 显然/ 满足/ 下面/ 两个/ 条件/ [/ 27/ ]/ :/ P/ (/ fi/ |/ fV/ -/ {/ i/ }/ )/ =/ P/ (/ fi/ |/ fNi/ 当/ 每个/ 节点/ 分配/ 相同/ 的/ 标签/ 时/ :/ 就/ 可以/ 认为/ 达到/ 了/ 时钟/ 同步/ ./ 通过/ 调整/ 网络/ 的/ 配置/ ,/ 我们/ 可以/ 求出/ P/ (/ fi/ =/ f/ )/ 的/ 最大/ 概率/ ./ 时钟/ 同步/ 也/ 就/ 可以/ 被/ 定义/ 为/ 寻找/ 马尔可夫/ 随/ 机场/ 的/ 最大/ 后验/ 概率/ MAP/ (/ MaximumAPosteriori/ )/ 配置/ ./ 就/ 如/ 文献/ [/ 27/ ]/ 中/ 所述/ ,/ 马尔可夫/ 随/ 机场/ 等同于/ 吉布斯/ 随/ 机场/ ./ 因此/ 时钟/ 配置/ 服从/ 吉布斯/ 分布/ ,/ 并且/ 具有/ 下面/ 的/ 形式/ :/ 其中/ 是/ 规格化/ 的/ 参数/ ./ T/ 是/ 一个/ 自由/ 参数/ ,/ 在/ 物理层/ 中/ ,/ 它/ 代表/ 温度/ ./ 在/ 大多数/ 应用/ 中/ 可以/ 假定/ 为/ 1/ ./ U/ (/ f/ )/ 是/ 一个/ 能量/ 函数/ ,/ 定义/ 如下/ :/ 可见/ ,/ U/ (/ f/ )/ 就是/ 在/ 所有/ 可能/ 的/ 团/ C/ 上/ 的/ 团/ 势能/ Vc/ (/ f/ )/ 之/ 和/ [/ 27/ ]/ ./ 它/ 也/ 可以/ 表示/ 为/ U/ (/ f/ )/ =/ ∑/ {/ i/ }/ ∈/ C1/ 如上/ 文/ 提到/ 的/ ,/ 在/ 时钟/ 同步/ 这个/ 场景/ 下/ ,/ 只/ 考虑/ 了/ C1/ 团/ 和/ C2/ 团/ ,/ 因此/ 式/ (/ 28/ )/ 可以/ 重写/ 如下/ :/ U/ (/ f/ )/ =/ ∑/ {/ i/ }/ ∈/ V/ 根据/ 式/ (/ 25/ )/ ,/ 最小化/ 能量/ 函数/ U/ (/ f/ )/ 等同于/ 最大化/ P/ (/ f/ )/ 的/ 概率/ 值/ ./ 考虑/ 平均/ 场/ 理论/ 中/ 的/ 伊辛/ 模型/ ,/ 伊辛/ 模型/ 系统/ 中/ 的/ 总/ 能量/ 为/ [/ 28/ ]/ 式/ 中/ 犑/ ij/ 为/ 耦合/ 矩阵/ ,/ 当其/ 不/ 等于/ 0/ 时/ ,/ 表示/ 格点/ i/ 和/ j/ 之间/ 存在/ 相互作用/ ./ 在/ 无线/ 自/ 组织/ 网络/ 中/ ,/ 耦合/ 矩阵/ 相当于/ 节点/ 之间/ 能够/ 进行/ 时钟/ 同步/ 的/ 邻居/ 关系/ ./ si/ 对应/ 于/ 节点/ i/ 的/ 本地/ 时钟/ ./ 比较/ 式/ (/ 29/ )/ 和/ (/ 30/ )/ ,/ 它们/ 具有/ 相同/ 的/ 表达式/ ./ 伊辛/ 模型/ 的/ 目标/ 就是/ 使/ 系统/ 的/ 总/ 能量/ 达到/ 最小/ ./ 而/ 马尔可夫/ 随/ 机场/ 的/ 最大/ 后验/ 概率/ 问题/ 等价/ 于/ 能量/ 函数/ U/ (/ f/ )/ 最小化/ ./ 因此/ ,/ 无线/ 自/ 组织/ 网络/ 中/ 的/ 时钟/ 同步/ 问题/ 就/ 转化/ 为了/ 一种/ 平均/ 场/ 问题/ ./ 本文/ 的/ 下/ 一/ 小节/ 将/ 定义/ 一个/ 合适/ 的/ 函数/ 来/ 测量/ 全局/ 时钟/ 同步/ ,/ 寻找/ 一种/ 分布式/ 的/ 能量/ 最小化/ 算法/ 来/ 更/ 快/ 更/ 高精度/ 地/ 得到/ 全局/ 时钟/ 同步/ 解决方案/ ./ 3.2/ 能量/ 函数/ 定义/ 能量/ 函数/ 是/ 时钟/ 同步/ 的/ 目标/ 函数/ ,/ 它/ 是/ 可以/ 被/ 最小化/ 的/ ./ 因此/ ,/ 能量/ 函数/ 有/ 两个/ 任务/ :/ 定义/ 时钟/ 同步/ 的/ 最佳/ 解决方案/ ,/ 通过/ 能量/ 最小化/ 寻找/ 最佳/ 同步/ 时钟/ ./ 如式/ (/ 29/ )/ 中/ 描述/ ,/ 能量/ 函数/ 是/ 由团/ 的/ 势能/ 函数/ 构成/ ./ 参考文献/ [/ 27/ ]/ ,/ 双/ 邻居/ 节点/ 团/ C2/ 的/ 势能/ 函数/ 可以/ 定义/ 如下/ :/ 其中/ g/ (/ fi/ -/ fi/ )/ 是/ 节点/ i/ 和/ i/ 之间/ 时钟/ 偏差/ 的/ 惩罚/ 函数/ ,/ 是/ 一个/ 单调/ 减/ 函数/ ./ 二次/ 函数/ 是/ 最/ 常用/ 的/ 惩罚/ 函数/ ,/ 同样/ 也/ 可以/ 用/ 在/ 本文/ 中/ ,/ 于是/ 定义/ 考虑/ 到/ 节点/ 故障/ 后/ 的/ 重启/ 或者/ 一个/ 新/ 的/ 节点/ 加入/ 时/ ,/ 本地/ 时钟/ 与/ 其他/ 节点/ 之间/ 可能/ 也/ 会/ 存在/ 较大/ 的/ 时钟/ 偏差/ ./ 这/ 将/ 会/ 导致/ 在/ 能量/ 最小化/ 时/ 产生/ 一个/ 很大/ 的/ 修复/ 因子/ ./ 并且/ 这个/ 因子/ 将会/ 使/ 时钟/ 同步/ 产生/ 较大/ 波动/ ,/ 难以/ 在/ 较/ 短时间/ 内/ 回复/ 到/ 平衡/ 状态/ ,/ 因此/ 我们/ 将/ 惩罚/ 函数/ 修改/ 为/ 其中/ σ/ 是/ 一个/ 截断/ 变量/ ,/ 代表/ 节点/ 与其/ 邻居/ 节点/ 之间/ 时钟/ 偏差/ 的/ 方差/ ./ 因此/ g/ 的/ 导数/ 也/ 就/ 变成/ 如下/ 形式/ :/ Page7g/ (/ fi/ -/ fi/ )/ =/ 2/ ×/ min/ {/ σ/ ,/ (/ fi/ -/ fi/ )/ }/ (/ 34/ )/ 对单/ 节点/ 团/ C1/ 的/ 势能/ 函数/ ,/ 它/ 依赖/ 节点/ 时钟/ 与/ 参考/ 时钟/ 的/ 偏差/ ,/ 具有/ 二次方程/ 的/ 形式/ ./ 它/ 可以/ 这样/ 被/ 描述/ :/ 其中/ fR/ 是/ 参考/ 时钟/ ./ 但是/ 前面/ 的/ 章节/ 中/ 我们/ 提到/ 过/ ,/ 在/ 全/ 分布式/ 网络/ 中/ ,/ 并不需要/ 维护/ 参考/ 时钟/ ./ 因此/ 引入/ 平均/ 场/ 方法/ 计算/ 虚拟/ 参考/ 时钟/ ./ 平均/ 场/ 理论/ 认为/ 对于/ 给定/ 个体/ ,/ 所有/ 其他/ 个体/ 对/ 其/ 的/ 影响/ 可以/ 由/ 一个/ 平均/ 作用/ 近似/ 获得/ [/ 29/ ]/ ./ 因此/ 我们/ 使用/ 平均/ 场/ 理论/ 近似计算/ 邻域/ 系统/ 的/ 参考/ 时钟/ ./ 节点/ i/ 邻域/ 系统/ 的/ 虚拟/ 参考/ 时钟/ 可以/ 被/ 平均/ 场/ 定义/ 为/ 最终/ 我们/ 得到/ 完整/ 的/ 能量/ 函数/ 如式/ (/ 37/ )/ 所示/ :/ U/ (/ f/ )/ =/ ∑/ {/ i/ }/ ∈/ V/ 根据/ 平均/ 场/ 理论/ 和/ MAP/ 方法/ ,/ 式/ (/ 37/ )/ 的/ 最小值/ 点/ 即/ 为/ 时钟/ 同步/ 的/ 最/ 优点/ ./ 现在/ 需要/ 解决/ 的/ 问题/ 是/ ,/ 如何/ 寻找/ 式/ (/ 37/ )/ 的/ 最小值/ 点/ ./ 因此/ 能量/ 函数/ U/ (/ f/ )/ 被/ 定义/ 为/ 一个/ 全局/ 的/ 变量/ ./ 它/ 需要/ 收集/ 每个/ 节点/ 的/ 团/ 势能/ 来/ 计算/ 能量/ 函数/ ,/ 并/ 找到/ 最小化/ 能量/ 函数/ ./ 在/ 无线/ 自/ 组织/ 网络/ 这种/ 多/ 跳/ 网络/ 中/ ,/ 这种/ 方法/ 显然/ 是/ 不/ 可行/ 的/ ,/ 因为/ 它/ 将/ 产生/ 很大/ 的/ 网络/ 负载/ ,/ 而且/ 接收/ 的/ 时间/ 戳/ 消息/ 经过/ 多/ 跳/ 传输/ 后/ 可能/ 已经/ 过时/ ./ 因此/ 我们/ 应该/ 寻找/ 一种/ 分布式/ 并行/ 运行/ 的/ 能量/ 函数/ 最小化/ 方法/ ./ 3.3/ 能量/ 函数/ 的/ 并行/ 最小化/ 由于/ 存在/ 截断/ 因子/ ,/ 能量/ 函数/ 变成/ 了/ 一个/ 非线性/ 的/ 函数/ ./ 为了/ 简化/ 分析/ ,/ 我们/ 采用/ 式/ (/ 32/ )/ 中/ 描述/ 的/ 双/ 邻居/ 节点/ 团/ 势能/ ,/ 如下/ 式/ :/ 由于/ 最小值/ 处/ 一定/ 是/ 一个/ 驻点/ ,/ U/ (/ f/ )/ 的/ 梯度/ 向量/ 必然/ 等于/ 0/ ./ 也就是说/ 下面/ 的/ 等式/ 必然/ 成立/ :/ / U/ (/ f/ )/ / fi/ 为了/ 求解/ 式/ (/ 39/ )/ ,/ 必须/ 获得/ 网络/ 中/ 每个/ 节点/ 的/ 本地/ 时钟/ ./ 这/ 在/ 无线/ 自/ 组织/ 网络/ 这种/ 多/ 跳/ 网络/ 中/ 很/ 难/ 实现/ ./ 因此/ 我们/ 对式/ (/ 39/ )/ 更新/ 如下/ :/ 我们/ 定义/ 也/ 就是/ 根据/ 式/ (/ 41/ )/ ,/ 通过/ 计算/ 每个/ 节点/ 的/ 最小化/ 能量/ 函数/ ,/ 我们/ 可以/ 获得/ 全局/ 能量/ 函数/ 的/ 最小值/ ./ 因此/ U/ (/ f/ )/ 可以/ 在/ 网络/ 中/ 的/ 每个/ 节点/ 上/ 并行/ 的/ 更新/ ,/ 并且/ 只/ 需要/ 邻居/ 信息/ ./ 也就是说/ ,/ 通过/ 考虑/ 每个/ 节点/ 局部/ 的/ fi/ ,/ 可以/ 计算/ 出/ 全局/ 最小值/ ./ 因此/ 我们/ 得到/ 一个/ 全/ 分布式/ 能量/ 最小化/ 算法/ ./ 还/ 存在/ 一个/ 问题/ ,/ 根据/ 式/ (/ 39/ )/ 确定/ 的/ 最小值/ 点/ 到底/ 是/ 一个/ 局部/ 最小值/ 点/ 还是/ 全局/ 最小值/ 点/ ,/ 由于/ 式/ (/ 39/ )/ 的/ 解决方案/ 只是/ 一个/ 梯度/ 为/ 0/ 的/ 驻点/ ,/ 它/ 可能/ 是/ 局部/ 极值/ 点/ 而/ 不是/ 全局/ 最小值/ 点/ ./ 不过/ ,/ 由于/ 我们/ 定义/ 的/ 能量/ 函数/ 是/ 一个/ 二次/ 函数/ ,/ 它/ 显然/ 是/ 一个/ 严格/ 凸函数/ ./ 凸函数/ 的/ 任何/ 一个/ 本地/ 最小值/ ,/ 也/ 是/ 全局/ 的/ 最小值/ ./ 严格/ 凸函数/ 全局/ 中/ 最/ 多/ 只有/ 一个/ 全局/ 最小值/ [/ 30/ ]/ ./ 因此/ ,/ 根据/ 式/ (/ 39/ )/ 确定/ 的/ 最小值/ 点/ 就是/ 全局/ 最小值/ 点/ ./ 在/ 实际/ 应用/ 中/ ,/ 能量/ 最小化/ 函数/ 的/ 算法/ 采用/ 下面/ 规则/ 进行/ 迭代/ 求解/ :/ k/ +/ 1i/ =/ ff/ 其中/ μ/ 是/ 一个/ 较/ 小/ 的/ 常数/ ./ 由于/ 式/ (/ 43/ )/ 仅/ 涉及/ 简单/ 的/ 算术/ 运算/ 和/ 初等/ 函数/ 运算/ ,/ 因此/ 本文/ 的/ 分布式/ 时钟/ 同步/ 算法/ 复杂度/ 低/ ,/ 适用/ 于/ CPU/ 能力/ 和/ 功率/ 都/ 十分/ 有限/ 的/ 无线/ 自/ 组织/ 网络/ 节点/ ./ 3.4/ 算法/ 描述/ 结合/ 前/ 文/ 所述/ 的/ 时钟/ 偏差/ 估计/ 算法/ 和/ 能量/ 最小化/ 寻优/ 的/ 时钟/ 同步/ 算法/ ,/ 最终/ 形成/ 本文/ 所/ 提出/ 的/ 基于/ 平均/ 场/ 理论/ 的/ 时钟/ 同步/ 协议/ MFSP/ ./ 该/ 协议/ 首先/ 使用/ 卡尔曼滤波/ 器/ 精确/ 估计/ 与/ 邻居/ 节点/ 之间/ 的/ 时钟/ 偏差/ ,/ 然后/ 使用/ 平均/ 场/ 理论/ 进行/ 分布式/ 全网/ 同步/ ./ 在/ 一个/ 包含/ M/ 个/ 节点/ 的/ 无线/ 自/ 组织/ 网络/ 中/ ,/ 基于/ 平均/ Page8/ 场/ 理论/ 的/ 时钟/ 同步/ 算法/ MFSP/ 可/ 描述/ 如下/ ./ 算法/ 1/ ./ MFSP/ 算法/ ./ 1/ ./ 初始化/ 2/ ./ 设置/ 同步/ 计时器/ 的/ 周期/ 3/ ./ 迭代/ 计算/ 直到/ 满足/ 同步/ 精度/ 收敛/ 4/ ./ FOR/ 第/ k/ 次/ 迭代/ 5/ ./ 节点/ i/ ,/ i/ =/ 1/ :/ M/ ,/ INparallel6/ ./ 将/ 本地/ 第/ k/ -/ 1/ 的/ 发送/ 时间/ 戳/ 以及/ 第/ k/ -/ 1/ 次迭/ 7/ ./ 节点/ 广播/ 同步/ 数据包/ 到/ 一/ 跳/ 邻居/ ,/ 并/ 记录/ 发送/ 8/ ./ 接收/ 到/ 一/ 跳/ 邻居/ 的/ 时钟/ 广播/ 报文/ ,/ 并/ 记录/ 接收/ 9/ ./ 通过/ 卡尔曼滤波/ 器/ 计算/ 获得/ 邻居/ 节点/ 的/ 时钟/ 偏差/ 10/ ./ 同步/ 计时器/ 周期/ 到/ ,/ 通过/ 平均/ 场/ 计算/ 虚拟/ 参考/ 时/ 11/ ./ 基于/ 虚拟/ 参考/ 时钟/ 计算/ 能量/ 函数/ ,/ 计算公式/ 如/ U/ (/ f/ )/ =/ ∑/ {/ i/ }/ ∈/ V12/ ./ 计算/ 最小化/ 能量/ 函数/ ,/ 获得/ 节点/ 本地/ 时钟/ 与/ 虚/ 13/ ./ ENDparallel14/ ./ ENDFOR/ 本文/ MFSP/ 同步/ 协议/ 充分利用/ 无线/ 信道/ 的/ 广播/ 特性/ 来/ 减少/ 消息/ 发送/ 数量/ 、/ 缩短/ 同步/ 时间/ ./ 采用/ 一跳/ 范围/ 内/ 的/ 广播/ 方式/ 进行/ 双向/ 时间/ 戳/ 交互/ ./ 在/ 假定/ 由/ M/ 个/ 节点/ 构成/ 的/ 连通/ 网络图/ 中/ ,/ 在/ 连续/ k/ 次/ 的/ 全网/ 时钟/ 同步/ 迭代/ 次数/ 内/ ,/ 采用/ 传统/ 单播/ 双向/ 交换/ 时间/ 戳/ 的/ TPSN/ 协议/ [/ 4/ ]/ 需要/ 发送/ 2/ ×/ k/ ×/ (/ M/ -/ 1/ )/ 条/ 消息/ 量/ ,/ 采用/ 平均/ 一致/ 时钟/ 同步/ 方式/ 的/ ATSP/ 协议/ [/ 9/ ]/ 则/ 需要/ 发送/ 3/ ×/ k/ ×/ M/ 条/ 消息/ 量/ ,/ 而/ 本文/ 时钟/ 同步/ 协议/ MFSP/ 需要/ 发送/ 的/ 消息/ 量/ 仅/ 为/ (/ k/ +/ 1/ )/ ×/ M/ ./ 随着/ 网络/ 规模/ 的/ 增大/ ,/ 这种/ 优势/ 将/ 更加/ 明显/ ./ 因此/ 在/ 完成/ 全网/ 同步/ 的/ 过程/ 中/ ,/ 本文/ 方案/ 能/ 有效/ 减少/ 信息/ 发送量/ ,/ 进而/ 缩短/ 同步/ 时间/ ,/ 降低/ 了/ 能量/ 损耗/ ./ 采用/ 同步/ 方式/ 的/ GTSP/ 协议/ [/ 13/ ]/ 需要/ 发送/ 的/ 消息/ 量/ 是/ k/ ×/ M/ ,/ 与/ 本文/ 的/ MFSP/ 协议/ 在/ 同一/ 数量级/ ./ 在/ 本文/ 的/ 第/ 4/ 节/ ,/ 我们/ 将/ 针对/ GTSP/ 协议/ 进行/ 性能/ 比较/ 和/ 分析/ ./ 本文/ 分布式/ 时钟/ 同步/ 算法/ 仅/ 需要/ 存储/ 一个/ 迭代/ 过程/ 中一/ 跳/ 邻居/ 节点/ 的/ 时间/ 戳/ ,/ 对/ 存储空间/ 需求/ 很小/ ,/ 具有/ 很/ 好/ 的/ 空间/ 复杂度/ ./ 4/ 仿真/ 与/ 分析/ 在/ 本节/ 中/ ,/ 本文/ 时钟/ 同步/ 方案/ 的/ 性能/ 将/ 在/ Matlab/ 和/ QualNet/ 仿真/ 平台/ 得到/ 验证/ ,/ 仿真/ 结果/ 将/ 分别/ 在/ 4.1/ 节/ 和/ 4.2/ 节中/ 进行/ 分析/ ./ 为了/ 分析/ 本文/ 方案/ 的/ 时钟/ 同步/ 精度/ ,/ 我们/ 定义/ 了/ 在/ k/ 次/ 同步操作/ 后/ ,/ 全网/ 中/ 所有/ 一跳/ 邻居/ 节点/ 之间/ 的/ 最大/ 时钟/ 同步/ 误差/ ,/ 也/ 即/ 全网/ 一跳/ 距离/ 时钟/ 误差/ 最大值/ 可如式/ (/ 44/ )/ 所示/ :/ e1/ -/ hop/ (/ k/ )/ =/ max/ 其中/ ,/ Ci/ (/ k/ )/ 是/ 节点/ i/ 在/ k/ 次/ 同步操作/ 后/ 的/ 本地/ 时钟/ ;/ Cj/ (/ k/ )/ 是/ 节点/ i/ 的/ 一/ 跳/ 邻居/ 节点/ j/ 在/ k/ 次/ 同步操作/ 后/ 的/ 本地/ 时钟/ ./ 如果/ e1/ -/ hop/ (/ k/ )/ =/ 0/ ,/ 就/ 意味着/ 每个/ 节点/ 一跳/ 距离/ 内/ 达到/ 了/ 同步/ ./ 我们/ 同时/ 还/ 定义/ 了/ 全网/ 时钟/ 误差/ 最大值/ 作为/ 另/ 一种/ 评判/ 指标/ ,/ 如式/ (/ 45/ )/ 所示/ :/ 其中/ ,/ Ci/ (/ k/ )/ 和/ Cj/ (/ k/ )/ 分别/ 是/ 节点/ i/ 和/ j/ 在/ k/ 次/ 同步操作/ 后/ 的/ 本地/ 时钟/ ./ 显然/ ,/ 如果/ 全网/ 时钟/ 误差/ 最大值/ e/ (/ k/ )/ =/ 0/ ,/ 全网/ 所有/ 时钟/ 必然/ 完全/ 同步/ ./ 由于/ 计算机硬件/ 时钟/ 的/ 精度/ 通常/ 为/ 1/ μ/ s/ ,/ 所以/ 我们/ 以/ e1/ -/ hop/ (/ k/ )/ 或/ e/ (/ k/ )/ 开始/ 持续/ 小于/ 10/ -/ 6s/ ,/ 作为/ 达到/ 全网/ 收敛/ 的/ 指标/ ./ 4.1/ 基于/ Matlab/ 的/ 仿真/ Matlab/ 仿真/ 在/ Matlab2009b/ 环境/ 下/ 进行/ ./ 仿真/ 场景/ 为/ 具有/ 标准/ 2/ -/ D/ 网格/ 10/ ×/ 10/ 拓扑/ 结构/ 的/ 100/ 个/ 节点/ 构成/ ./ 我们/ 假设/ 节点/ 仅/ 与其/ 水平/ 或/ 垂直/ 方向/ 的/ 一/ 跳/ 邻居/ 节点/ 进行/ 交互/ ,/ 即/ 标准/ 的/ 4/ -/ 邻居/ 系统/ ./ 在/ 每/ 一次/ 同步/ 迭代/ 过程/ 中/ ,/ 网络/ 中/ 的/ 每个/ 节点/ 与其/ 邻居/ 节点/ 交换/ 时间/ 戳/ ,/ 并/ 同步/ 更新/ 各自/ 的/ 本地/ 时钟/ ./ 图/ 2/ 所示/ 为/ 10/ ×/ 10/ 个/ 节点/ 在/ 150/ 次/ 同步/ 迭代/ 内/ 的/ 全局/ 时钟/ 值/ 收敛/ 过程/ ./ 其中/ 图/ 2/ (/ a/ )/ 为/ 时钟/ 初始状态/ ,/ 初始/ 时钟/ 偏差/ 在/ [/ 0s/ ,/ 1s/ ]/ 的/ 区间/ 内/ 均匀分布/ ./ 图/ 2/ (/ b/ )/ ~/ 图/ 2/ (/ p/ )/ 显示/ 的/ 是/ 每隔/ 10/ 次/ 迭代/ ,/ 从/ 第/ 10/ 次/ 迭代/ 到/ 第/ 150/ 次/ 迭代/ 的/ 全网/ 时钟/ 的/ 收敛/ 过程/ ./ 我们/ 同时/ 还/ 进行/ 了/ 不同/ 节点/ 情况/ 下/ 全网/ 时钟/ 收敛/ 的/ 仿真/ 实验/ ./ 图/ 3/ 描述/ 了/ 4/ ×/ 4/ 、/ 6/ ×/ 6/ 、/ 8/ ×/ 8/ 、/ 10/ ×/ 10/ 个/ 节点/ 在/ 100/ 次/ 同步/ 迭代/ 内/ 全网/ 一跳/ 距离/ 、/ 全网/ 距离/ 时钟/ 同步/ 的/ 收敛/ 性能/ ./ 其中/ Y/ 轴为/ 对数/ 坐标/ ./ 可以/ 看出/ ,/ 以/ 全网/ 一跳/ 距离/ 时钟/ 误差/ 最大值/ 为/ 对比/ 标准/ 的/ 情况/ 下/ ,/ 4/ ×/ 4/ 个/ 节点/ 的/ 场景/ 同步/ 迭代/ 98/ 次/ 就/ 达到/ 微秒/ 级/ 的/ 同步/ 精度/ ,/ 6/ ×/ 6/ 个/ 节点/ 的/ 场景/ 需要/ Page9/ 图/ 210/ ×/ 10/ 个/ 节点/ 在/ 150/ 次/ 同步/ 迭代/ 内/ 的/ 收敛/ 过程/ 迭代/ 101/ 次/ ,/ 8/ ×/ 8/ 个/ 节点/ 的/ 场景/ 需要/ 迭代/ 97/ 次/ ,/ 10/ ×/ 10/ 个/ 节点/ 的/ 场景/ 需要/ 迭代/ 98/ 次/ ./ 这/ 说明/ 了/ 随着/ 网络/ 规模/ 的/ 增大/ ,/ 全网/ 均/ 能/ 快速/ 实现/ 收敛/ ./ 4.2/ 基于/ QualNet/ 的/ 仿真/ QualNet/ 是/ 一种/ 被/ 广泛应用/ 在/ 对/ 无线网络/ 尤其/ 是/ 无线/ 自/ 组织/ 网络/ 进行/ 性能/ 分析/ 的/ 仿真/ 工具/ ./ 文献/ [/ 31/ ]/ 验证/ 了/ QualNet/ 对/ 现实/ 环境/ 下/ 无线网络/ 仿真/ 能力/ 非常/ 强/ ./ 近年来/ 的/ 分布式/ 时钟/ 同步/ 解决方案/ 主要/ 分为/ 两类/ :/ 其中/ 占/ 主导地位/ 的/ 一类/ 是/ 基于/ 一致性/ 的/ 绝对/ 同步/ 方法/ [/ 7/ -/ 15/ ]/ ,/ 另一类/ 是/ 相对/ 同步/ 方法/ [/ 16/ -/ 17/ ]/ ./ 在/ 相对/ 同步/ 方法/ 中/ ,/ 算法/ 仅/ 计算/ 出/ 每个/ 节点/ 之间/ 的/ 时钟/ 差/ ,/ 并/ 不/ 对/ 节点/ 时钟/ 进行/ 调整/ ./ 此类/ 方案/ 与/ 本文/ 提出/ 的/ 方案/ 做法/ 不同/ ,/ 所以/ 不/ 进行/ 比较/ ./ 在/ 基于/ 一致性/ 的/ 同步/ 方法/ 中/ ,/ 大部分/ 的/ 算法/ 仅/ 在/ 一对/ 节点/ 之间/ 计算/ 均值/ ,/ 造成/ 收敛/ 速度/ 较慢/ ,/ 而/ 采用/ 群组/ 一致性/ 的/ 方法/ 有/ GTSP/ 协议/ 和/ 文献/ [/ 18/ ]/ ./ 在/ 文献/ [/ 18/ ]/ 中/ 认为/ 所有/ 时延/ 服从/ 高斯分布/ 且/ 均值/ 相同/ ./ 这种/ 方法/ 在/ 时延/ 不/ 均衡/ 的/ 网络/ 中/ 无法/ 适用/ ./ GTSP/ 协议/ 是/ 一种/ 采用/ 群组/ 方式/ 的/ 典型/ 平均/ 一致/ 时钟/ 同步/ 方案/ ,/ 本文/ 所/ 提出/ 的/ MFSP/ 亦/ 是/ 一种/ 采用/ 群组/ 同步/ 方式/ 的/ 分布式/ 时钟/ 同步/ 协议/ ./ 因此/ ,/ 本节/ 中/ 我们/ 将/ GTSP/ 协议/ 和/ MFSP/ 协议/ 在/ QualNet/ 环境/ 下/ 进行/ 仿真/ 对比/ ,/ 以/ 验证/ MFSP/ 的/ 性能/ 优势/ ./ 仿真/ 场景/ 的/ 配置/ 参数/ 如表/ 1/ 所示/ ./ 场景/ 大小/ // (/ km/ ×/ km/ )/ 在/ QualNet/ 仿真/ 环境/ 下/ 全网/ 节点/ 时钟/ 的/ 收敛/ 过程/ 与/ 图/ 2/ 相似/ ,/ 不同/ 节点/ 情况/ 下/ 全网/ 时钟/ 收敛/ 对比/ 与/ 图/ 3/ 相似/ ,/ 因此/ 这里/ 均/ 不再/ 展示/ ./ 图/ 4/ 所示/ 为/ MFSP/ 协议/ 和/ GTSP/ 协议/ 在/ 10/ ×/ 10/ 个/ 节点/ 下/ 随着/ 同步/ 迭代/ 次数/ 的/ 增加/ ,/ 全网/ 时钟/ 同步/ 误差/ 和/ 全网/ 一跳/ 距离/ 时钟/ 同步/ 误差/ 的/ 收敛/ 图/ ./ 其中/ Y/ 轴均/ 为/ 对数/ 坐标/ ./ 从/ 全网/ 时钟/ 误差/ 最大值/ 指标/ 上/ 来看/ ,/ 图/ 4/ (/ a/ )/ 中/ MFSP/ 经过/ 103/ 次/ 同步/ 迭代/ 完成/ 了/ 收敛/ ,/ 而/ GTSP/ 则/ 需要/ 529/ 次/ 同步/ 迭代/ ./ 从/ 全网/ 一跳/ 距离/ 时钟/ 误差/ 最大值/ 指标/ 上/ 来看/ ,/ 图/ 4/ (/ b/ )/ 中/ GTSP/ 需要/ 446/ 次/ 同步/ 迭代/ 才/ 完成/ 了/ 收敛/ ,/ 而/ MFSP/ 只/ 需要/ 98/ 次/ ./ 因此/ ,/ 本文/ 所/ 提出/ 的/ MFSP/ 协议/ 比/ GTSP/ 协议/ 收敛/ 速度/ 更快/ ./ 其他/ 相同/ 节点/ 规模/ 下/ 的/ MFSP/ 协议/ 与/ Page10/ 图/ 34/ ×/ 4/ 、/ 6/ ×/ 6/ 、/ 8/ ×/ 8/ 、/ 10/ ×/ 10/ 个/ 节点/ 在/ 100/ 次/ 同步/ 迭代/ 内/ 全网/ 一跳/ 距离/ 和/ 全网/ 距离/ 的/ 时钟/ 误差/ 最大值/ 对比/ 图/ 410/ ×/ 10/ 个/ 节点/ 同步/ 迭代/ 时钟/ 误差/ 性能/ 对比/ GTSP/ 协议/ 的/ 收敛/ 对比/ 图/ ,/ 与/ 10/ ×/ 10/ 个/ 节点/ 情况/ 下/ 相似/ ,/ 因此/ 不再/ 重复/ 说明/ ./ 图/ 5/ 中/ 展示/ 了/ MFSP/ 和/ GTSP/ 协议/ 随着/ 网络/ 节点/ 规模/ 的/ 增大/ ,/ 达到/ 同步/ 所/ 需要/ 的/ 迭代/ 次数/ 变化/ ./ 从图/ 中/ 可见/ ,/ GTSP/ 协议/ 达到/ 同步/ 所/ 需/ 的/ 迭代/ 次数/ 与/ 网络/ 规模/ 成正比/ ,/ 而/ 本文/ 所/ 提出/ 的/ MFSP/ 协议/ 全网/ 收敛/ 时间/ 和/ 全网/ 一跳/ 邻居/ 收敛/ 时间/ 均/ 保持/ 基本/ 稳定/ ,/ 虽然/ 在/ 较/ 小/ 网络/ 规模/ 的/ 情况/ 下/ 并/ 不如/ GTSP/ 协议/ ,/ 但/ 随着/ 网络/ 规模/ 增大/ ,/ MFSP/ 协议/ 的/ 优越性/ 逐渐/ 体现/ ./ 图/ 5/ 不同/ 网络/ 规模/ 达到/ 收敛/ 所/ 需要/ 的/ 迭代/ 次数/ 图/ 6/ 展示/ 了/ 图/ 5/ 中/ MFSP/ 和/ GTSP/ 协议/ 达到/ 同步/ 所/ 需/ 的/ 发送/ 消息/ 量/ 变化/ ./ 考虑/ 到/ 无线/ 环境/ 中/ 存在/ 冲突/ 丢包/ 的/ 现象/ ,/ 本文/ 在/ 仿真/ 中/ 设定/ 节点/ 每/ 广播/ 两次/ 同步/ 数据包/ ,/ 才/ 进行/ 一次/ 本地/ 时钟/ 同步/ 迭代/ 的/ 操作/ ./ 由于/ MFSP/ 协议/ 的/ 收敛/ 速度/ 优于/ GTSP/ 协议/ ,/ 因此/ 图/ 6/ 中/ MFSP/ 协议/ 达到/ 收敛/ 所/ 需要/ 的/ 发送/ 消息/ 量/ 明显/ 低于/ GTSP/ 协议/ ,/ 与/ 3.4/ 节中/ 理论/ 分析/ 一致/ ./ 5/ 总结/ 本文/ 研究/ 了/ 无线/ 自/ 组织/ 网络/ 下/ 的/ 时钟/ 同步/ ,/ 提出/ 了/ 一种/ 基于/ 平均/ 场/ 的/ 全/ 分布/ 时钟/ 同步/ 方案/ ./ 该/ 方案/ 中/ 每个/ 节点/ 只/ 需要/ 分别独立/ 与/ 自身/ 一跳/ 邻居/ 通信/ ./ Page11/ 图/ 6/ 不同/ 网络/ 规模/ 达到/ 收敛/ 所/ 需要/ 的/ 发送/ 消息/ 量/ 此外/ ,/ 本文/ 还/ 提出/ 了/ 一种/ 卡尔曼滤波/ 器来/ 获得/ 邻居/ 节点/ 间/ 高精度/ 的/ 时钟/ 偏差/ ./ 仿真/ 结果表明/ 本文/ 所/ 提出/ 的/ 方案/ 可以/ 达到/ 更好/ 的/ 精度/ 和/ 更/ 快/ 的/ 收敛/ 时间/ ./ 与/ 现有/ 的/ 算法/ 进行/ 对比/ ,/ 本文/ 所/ 提出/ 的/ 解决方案/ 不/ 依赖/ 特定/ 的/ 参考/ 时钟/ 节点/ ,/ 并且/ 只/ 和/ 邻居/ 节点/ 通信/ ,/ 具有/ 低/ 负载/ 、/ 快速/ 收敛/ 、/ 健壮/ 、/ 可靠/ 的/ 优点/ ./ 在/ 本文/ 的/ 后续/ 研究/ 中/ ,/ 我们/ 将/ 考虑/ 建立/ 一个/ 实物/ 测试/ 验证/ 环境/ ,/ 以/ 验证/ 本文/ 所/ 提出/ 的/ 时钟/ 同步/ 方案/ 在/ 实际/ 工作/ 环境/ 下/ 的/ 性能/ ,/ 并/ 对/ 在/ 动态/ 拓扑/ 环境/ 情况/ 下/ 的/ 算法/ 性能/ 进行/ 分析/ 和/ 优化/ 设计/ ./ 

