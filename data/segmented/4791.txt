Page1/ 大规模/ 网络服务/ 系统/ 行为/ 异常/ 的/ 敏捷/ 感知/ 方法/ 章昭辉/ 1/ )/ ,/ 2/ )/ ,/ 3/ )/ 崔君/ 2/ )/ 1/ )/ (/ 东华大学/ 计算机科学/ 与/ 技术/ 学院/ 上海/ 201620/ )/ 2/ )/ (/ 安徽师范大学/ 数学/ 计算机科学/ 学院/ 安徽/ 芜湖/ 241003/ )/ 3/ )/ (/ 同济大学/ 嵌入式/ 系统/ 与/ 服务/ 计算/ 教育部/ 重点/ 实验室/ 上海/ 201804/ )/ 摘要/ 大规模/ 网络服务/ 系统/ 环境/ 中/ ,/ 短时/ 的/ 大规模/ 用户/ 合法/ 行为/ 聚集/ 会/ 造成/ 系统/ 行为/ 异常/ ,/ 使得/ 系统/ 可用性/ 受到/ 极大/ 的/ 损害/ ./ 现有/ 的/ 系统/ 异常/ 检测/ 方法/ 大多/ 适用/ 于/ 用户/ 非法行为/ 造成/ 的/ 系统/ 异常/ ./ 文中/ 针对/ 用户/ 合法/ 行为/ 短时/ 聚集/ 引起/ 的/ 系统/ 异常/ 问题/ ,/ 提出/ 一种/ 大规模/ 网络服务/ 系统/ 行为/ 异常/ 敏捷/ 感知/ 的/ 方法/ ./ 该/ 方法/ 包括/ 系统/ 异常/ 敏捷/ 感知/ 模型/ 和/ 重复/ 行为/ 检测/ 的/ Petri/ 模型/ ./ 基于/ “/ 放大/ 因子/ ”/ 的/ 系统/ 异常/ 敏捷/ 感知/ 模型/ 给出/ 了/ 系统/ 异常/ 的/ 可/ 预知/ 性/ 和/ 异常/ 系统/ 行为/ 的/ 可/ 定位/ 性/ ./ 即/ 如果/ 系统/ 会/ 在/ 未来/ 的/ 某/ 一/ 时刻/ t2/ 发生/ 异常/ ,/ 那么/ t1/ 时刻/ 预期/ 系统/ 负载/ 值要/ 大于/ 系统/ 所/ 能/ 承受/ 的/ 最大/ 负载/ 值/ (/ t2/ >/ t1/ )/ ./ 而且/ ,/ 该/ 模型/ 通过/ 行为/ 阻滞/ 度/ 可/ 确定/ 引起/ 系统/ 异常/ 的/ 系统/ 行为/ ./ 在/ 敏捷/ 感知/ 模型/ 的/ 基础/ 上/ ,/ 针对/ 应用/ 系统/ 的/ 异常/ 检测/ ,/ 提出/ 了/ 基于/ 带/ 优先/ 关系/ 的/ 颜色/ 双/ 变迁/ Petri/ 网/ 的/ 重复/ 行为/ 检测/ 模型/ 及其/ 系统/ 异常/ 敏捷/ 感知/ 算法/ ./ 根据/ 单位/ 时间/ 内/ 用户/ 行为/ 数较/ 小/ 变化/ 、/ 缓慢/ 增长/ 和/ 激增/ 三种/ 情况/ 进行/ 模拟实验/ ,/ 实验/ 结果表明/ 该/ 方法/ 可以/ 有效/ 地/ 在/ 系统/ 异常/ 发生/ 之前/ 提前/ 感知/ ,/ 并/ 能/ 定位/ 引起/ 系统/ 异常/ 的/ 系统/ 行为/ ./ 关键词/ 网络服务/ 系统/ ;/ 行为/ 异常/ ;/ 敏捷/ 感知/ ;/ 异常/ 检测/ ;/ Petri/ 网/ ;/ 云/ 计算/ 1/ 引言/ 随着/ 通信/ 技术/ 、/ 网络/ 技术/ 、/ 分布式计算/ 技术/ 等/ 日新月异/ 地/ 发展/ ,/ 基于/ 网络/ 的/ 服务/ 系统/ 为/ 满足用户/ 需求/ 带来/ 了/ 便捷/ ./ 但是/ ,/ 系统/ 本身/ 的/ 大规模/ 性/ 、/ 全方位/ 性/ 、/ 复杂性/ 等/ 特征/ 越来越/ 突出/ ;/ 同时/ ,/ 系统/ 的/ 用户/ 群体/ 也/ 随之/ 呈现出/ 规模/ 巨大/ 、/ 用户/ 需求/ 多样化/ 的/ 特征/ ./ 大规模/ 网络系统/ 的/ 服务/ 能力/ 和/ 服务质量/ 与/ 大规模/ 用户/ 群体/ 的/ 需求/ 满足/ 之间/ 的/ 矛盾/ 也/ 越来越/ 凸显/ ./ 尤其/ 是/ 当/ 某些/ 扰动/ 事件/ 发生/ 时/ ,/ 系统/ 会/ 吸引/ 大规模/ 的/ 用户/ 群体/ 以及/ 异常/ 行为/ 用户/ (/ 如/ 使用/ 抢票/ 软件/ 、/ “/ 黄牛/ ”/ 囤票/ 软件/ ,/ 其本质/ 上/ 也/ 是/ 聚集/ 大规模/ 用户/ 的/ 一种/ 形式/ ,/ 只是/ 其/ 购票/ 流程/ 实现/ 自动化/ )/ 参与/ 系统/ ,/ 用户/ 群体/ 的/ 刚性/ 需求/ 引起/ 对/ 资源/ 的/ 过度/ 竞争/ 和/ 非法/ 竞争/ ,/ 从而/ 使得/ 系统/ 的/ 可用性/ 急剧下降/ ,/ 系统资源/ 和/ 用户/ 资源/ (/ 时间/ 等/ )/ 极大/ 浪费/ ./ 基于/ 网络/ 的/ 服务/ 系统/ 为了/ 满足用户/ 需求/ ,/ 新一代/ 软件/ 范型/ 不断涌现/ ,/ 如普适/ 计算/ 软件/ 、/ 超大规模/ 软件系统/ 、/ 网构/ 软件/ 等/ [/ 1/ ]/ ./ 与/ 传统/ 计算机/ 软件系统/ 相比/ ,/ 互联网服务/ 系统/ 所/ 表现/ 出/ 的/ 大规模/ 性/ 、/ 开放性/ 、/ 复杂性/ 等/ 特征/ ,/ 使得/ 软件/ 自/ 适应/ 对系统/ 感知/ 提出/ 更/ 高/ 的/ 要求/ [/ 2/ -/ 3/ ]/ ./ 网络系统/ 环境/ 的/ 开放性/ 可能/ 使得/ 大规模/ 网络服务/ 软件系统/ 在/ 开发/ 设计/ 时/ 就/ 存在/ 固有/ 的/ 缺陷/ ,/ 如/ 不可/ 预见/ 的/ 用户/ 行为/ 增长/ 与/ 有限/ 的/ 系统/ 负载/ 之间/ 的/ 不/ 平衡/ ./ 这些/ 潜在/ 缺陷/ 会/ 在/ 软件系统/ 运行/ 时/ 随着/ 用户/ 的/ 增加/ 显现出来/ ,/ 对系统/ 的/ 可用性/ 造成/ 极大/ 的/ 损害/ ./ 12306/ 购票/ 系统/ 曾经/ 在/ 春节/ 前/ 瘫痪/ 就是/ 一个/ 典型/ 例子/ ./ 系统/ 一/ 开始/ 是/ 满足用户/ 需求/ 的/ ,/ 但是/ 随着/ 用户量/ 和/ 用户/ 向/ 系统/ 重复/ 提交/ 请求/ 行为/ 数/ 的/ 激增/ ,/ 系统/ 负载/ 随之/ 激增/ ,/ 导致系统/ 性能/ 急剧下降/ 、/ 甚至/ 崩溃/ ./ 短时/ 用户量/ 激增/ 以及/ 用户/ 施加/ 于/ 系统/ 的/ 重复/ 行为/ 数/ 激增/ 是/ 大规模/ 网络服务/ 系统/ 的/ 可用性/ 造成/ 严重/ 伤害/ 的/ 重要/ 成因/ ./ 因此/ ,/ 要/ 保证系统/ 能够/ 在/ 动态/ 开放/ 环境/ 下/ 持续/ 、/ 高质量/ 地/ 提供/ 服务/ ,/ 系统/ 需要/ 在/ 运行/ 前期/ 或是/ 运行/ 中/ 提前/ 快速/ 感知/ 自身/ 异常/ 并/ 提供/ 相应/ 地/ 异常/ 预防措施/ ./ 然而/ ,/ 现有/ 的/ 系统/ 状态/ 感知/ 或/ 检测/ 研究/ [/ 4/ -/ 5/ ]/ 大多/ 考虑/ 的/ 是/ 基于/ 用户/ 非法行为/ 产生/ 的/ 系统/ 异常/ ,/ 并未/ 考虑/ 用户/ 合法/ 行为/ 短时/ 聚集/ 对系统/ 所/ 造成/ 的/ 异常/ ;/ 或/ 是从/ 系统/ 流量/ 、/ 事件/ 日志/ 表征/ 现象/ 中/ 挖掘出/ 异常/ ,/ 不能/ 及时/ 有效/ 地/ 在/ 异常/ 发生/ 之前/ 感知/ ./ 用户/ 合法/ 行为/ 对系统/ 造成/ 异常/ 的/ 敏捷/ 感知/ 与/ 检测/ 的/ 关键在于/ ,/ 如何/ 在/ 系统/ 异常/ 发生/ 之前/ 就/ 能/ 快速/ 感知/ 系统/ 异常/ 并/ 定位/ 异常/ 的/ 系统/ 行为/ ./ 本文/ 主要/ 有/ 以下/ 贡献/ :/ (/ 1/ )/ 针对/ 用户量/ 和/ 用户/ 向/ 系统/ 重复/ 提交/ 请求/ 行为/ 数/ 的/ 短时/ 激增/ 对系统/ 的/ 影响/ ,/ 建立/ 了/ 系统/ 异常/ 的/ 敏捷/ 感知/ 模型/ ./ 该/ 模型/ 提出/ 了/ “/ 放大/ 因子/ ”/ 的/ 概念/ ,/ 通过/ 建立/ “/ 放大/ 因子/ ”/ 与/ 系统/ 预期/ 负载/ 的/ 关系/ 模型/ 将/ 用户量/ 与/ 用户/ 重复/ 提交/ 的/ 行为/ 数/ 对系统/ 负载/ 的/ 影响/ 放大/ 来/ 考察/ 系统/ 负载/ 的/ 变化趋势/ ./ 在/ t/ 时刻/ ,/ 用户/ 提交/ 的/ 正常/ 行为/ 数在/ “/ 放大/ 因子/ ”/ 的/ 作用/ 下/ 所/ 需/ 的/ 预期/ 系统/ 负载/ 值若/ 超过/ 系统/ 所/ 能/ 承受/ 的/ 最大/ 负载/ 值/ ,/ 说明/ 在/ 未来/ 的/ 某/ 一/ 时刻/ 系统/ 会/ 出现异常/ ,/ 且/ 异常/ 的/ 地方/ 在于/ 该/ 时刻/ 所有/ 系统/ 行为/ 中/ 阻滞/ 度/ 比重/ 最大/ 的/ 系统/ 行为/ ./ (/ 2/ )/ 在/ 敏捷/ 感知/ 模型/ 的/ 基础/ 上/ ,/ 建立/ 了/ 系统/ 重复/ 行为/ 检测/ 方法/ ./ 通过/ 对系统/ 行为/ 进行/ Petri/ 网/ 建模/ ,/ 分析/ 其/ 系统/ Petri/ 网/ 结构/ ,/ 确定/ 关键/ 节点/ ./ 通过/ 对/ 关键/ 节点/ 设置/ 检测/ 机制/ ,/ 即/ 利用/ PCDPN/ (/ 带/ 优先/ 关系/ 的/ 颜色/ 双/ 变迁/ Petri/ 网/ )/ 对系统/ 模型/ 进行/ 行为/ 重构/ ,/ 并/ 将/ 感知/ 模型/ 运用/ 到/ 所/ 建立/ 的/ PCDPN/ 网/ 系统/ 行为/ 模型/ 中/ ,/ 提出/ 相应/ 的/ 检测/ 算法/ ,/ 通过/ 实例/ 及/ 实验/ 验证/ 该/ 方法/ 的/ 有效性/ ./ 本文/ 第/ 2/ 节/ 综述/ 系统/ 异常/ 感知/ 与/ 检测/ 的/ 国内外/ 相关/ 研究/ 工作/ ;/ 第/ 3/ 节/ 阐述/ 系统/ 异常/ 敏捷/ 感知/ 模型/ ,/ 并/ 给出/ 该/ 模型/ 对/ 异常/ 行为/ 的/ 可/ 预知/ 性/ 和/ 可/ 定位/ 性/ 结论/ ;/ 第/ 4/ 节/ 给出/ 对/ 实际/ 系统/ 中/ 重复/ 行为/ 的/ Petri/ 网/ 检测/ 模型/ 及/ 算法/ ;/ 第/ 5/ 节/ 给出/ 模型/ 实例/ 及/ 有效性/ 的/ 实验/ 验证/ ;/ 第/ 6/ 节/ 给出/ 本文/ 工作/ 与/ 其他/ 工作/ 比较/ 的/ 相关/ 讨论/ ;/ 第/ 7/ 节/ 给出/ 本文/ 的/ 工作/ 总结/ 和/ 下/ 一步/ 工作/ ./ 2/ 相关/ 工作/ 为了/ 提高/ 软件/ 的/ 可用性/ 以及/ 系统/ 服务/ 的/ 质量/ ,/ Page3/ 对/ 软件/ 自/ 适应/ 的/ 研究/ 现已/ 成为/ 关注/ 热点/ ./ 软件/ 自/ 适应/ 包括/ 感知/ 、/ 决策/ 、/ 执行/ 3/ 个/ 环节/ [/ 1/ ]/ ./ 目前/ 国内外/ 对/ 感知/ 环节/ 的/ 研究/ 主要/ 从/ 两个/ 方面/ 展开/ :/ 一是/ 基于/ 环境/ 上下文/ 处理/ ,/ 获取/ 和/ 处理软件/ 的/ 环境/ 信息/ [/ 6/ ]/ ./ 软件系统/ 的/ 开放性/ 和/ 动态性/ 导致/ 了/ 软件/ 环境/ 不断/ 的/ 变化/ ,/ 因此/ 对/ 环境/ 上下文/ 的/ 研究/ 也/ 开始/ 更多地/ 强调/ 环境/ 信息/ 的/ 显式化/ ./ 丁博/ 等/ 人/ [/ 7/ ]/ 概述/ 了/ 普适/ 计算/ 中间件/ 技术/ 对/ 上下文/ 信息/ 的/ 获取/ 方式/ ./ 朱/ 可可/ [/ 8/ ]/ 设计/ 了/ 面向/ 环境/ 感知/ 的/ 自/ 适应/ 中间件/ 模型/ ,/ 自/ 适应/ 服务/ 层/ 通过/ 从/ 传感器/ 感知/ 外部环境/ 从而/ 进行/ 自/ 适应/ 选择/ 反馈/ 到/ 应用层/ ./ 张慧/ [/ 9/ ]/ 提出/ 了/ 面向/ 语用/ 网/ 的/ 上下文/ 感知/ 系统/ ,/ 通过/ 设计/ 一个/ 面向/ 语用/ 网/ 的/ 上下文/ 感知/ 系统/ 框架/ ,/ 使/ 之/ 可以/ 动态/ 地/ 知识/ 表达/ 与/ 推理/ ,/ 能够/ 更加/ 准确/ 地/ 理解/ 用户/ 的/ 真实/ 意图/ ./ Chen/ 等/ 人/ [/ 10/ ]/ 将/ 上下文/ 定义/ 为/ 环境/ 状态/ 和/ 场景/ 集合/ ,/ 它们/ 分为/ 可能/ 影响/ 应用/ 行为/ 的/ 上下文/ 、/ 由/ 应用/ 展现/ 且/ 用户/ 对/ 之/ 感兴趣/ 的/ 上下文/ 两类/ ./ Yang/ 等/ 人/ [/ 11/ ]/ 提出/ 利用/ “/ 建模/ -/ 规约/ -/ 检测/ ”/ 的/ 分布/ 异步/ 环境/ 感知/ 框架/ 来/ 检测/ 异步/ 动态/ 属性/ 的/ 普适/ 计算环境/ ./ Cheng/ [/ 12/ ]/ 提出/ 了/ Rainbow/ 模型/ ,/ 进一步/ 将/ 软件/ 自/ 适应/ 拓展/ 到/ 分布/ 环境/ 下/ ,/ 通过/ 在/ 结点/ 之间/ 建立/ 严格/ 的/ 层次/ 控制关系/ 来/ 实现/ 群体/ 自/ 适应/ ./ 二是/ 基于/ 软件/ 的/ 监测/ 系统/ ,/ 获取/ 软件/ 的/ 内部/ 状态/ 信息/ ./ Robinson/ [/ 13/ ]/ 通过/ 用户/ 的/ 需求/ 分析/ 和/ 软件/ 在/ 运行/ 时/ 的/ 监测/ 技术相结合/ ,/ 实现/ 对/ Web/ 服务/ 行为/ 的/ 监控/ ,/ 保证/ 电子商务/ 的/ 可用性/ ./ Garlan/ 等/ 人/ [/ 14/ ]/ 使用/ 探针/ 和/ 量规/ 三层/ 监控/ 机制/ 来/ 实现/ 对/ 软件体系结构/ 的/ 监测/ ,/ 监测/ 系统/ 体系结构/ 的/ 变化/ ./ Mi/ 和/ Wang/ 等/ 人/ [/ 15/ ]/ 针对/ 用户/ 请求/ 的/ 结构/ 提出/ 了/ 一种/ 可以/ 快速/ 诊断/ 导致系统/ 性能/ 下降/ 的/ 原因/ 的/ 检测/ 方法/ ./ 从/ 感知/ 异常/ 行为/ 的/ 角度/ 来看/ ,/ 大多数/ 的/ 检测/ 技术/ 是/ 通过/ 建立/ 系统/ 、/ 用户/ 或/ 程序/ 的/ 正常/ 行为/ 轮廓/ ,/ 比较/ 和/ 匹配/ 被/ 监测/ 对象/ 的/ 实际/ 行为/ 与/ 正常/ 行为/ 轮廓/ 来/ 实现/ 的/ [/ 16/ ]/ ./ 谢逸/ 等/ 人/ [/ 17/ ]/ 提出/ 一种/ 基于/ Web/ 用户/ 访问/ 行为/ 的/ 异常/ 检测/ 方案/ ,/ 用于/ 检测/ 应用层/ 上/ 的/ 分布式/ 拒绝服务/ 攻击/ ,/ 并/ 以/ 具有/ 非/ 稳态/ 流/ 特性/ 的/ 大型/ 活动/ 网站/ 为例/ ,/ 进行/ 应用/ 研究/ ./ 冯震/ [/ 18/ ]/ 提出/ 基于/ 建立/ 正常/ 用户/ 行为/ 流量/ 特征/ 的/ 方法/ ,/ 与/ 之/ 比/ 对/ 来/ 检测/ 可能/ 对/ 网络/ 本身/ 或/ 其/ 承载/ 的/ 数据业务/ 造成危害/ 的/ 异常/ 行为/ ,/ 并/ 根据/ 异常/ 行为/ 的/ 特征/ 来/ 采取相应/ 措施/ ,/ 降低/ 这些/ 异常/ 行为/ 所/ 造成/ 的/ 危害/ ,/ 保证/ 网络/ 的/ 安全/ 运行/ ./ Huang/ 等/ 人/ [/ 19/ ]/ 提出/ 一种/ 级联/ 模式/ 用于/ 分布式/ 网络/ 的/ 在线/ 监测/ 异常/ 事件/ ./ Li/ 等/ 人/ [/ 20/ ]/ 提出/ 异常/ 相关性/ 分析方法/ ,/ 从/ 全网/ 的/ 流量/ 分析/ 异常/ 数据/ ,/ 揭示/ 攻击行为/ 变化/ 的/ 相关性/ ./ 从/ 软件系统/ 的/ 故障/ 检测/ 的/ 角度/ 来看/ ,/ 在/ 大规模/ 网络/ 环境/ 下/ 对/ 分布式/ 软件/ 进行/ 异常/ 检测/ 和/ 故障诊断/ 显得/ 十分困难/ [/ 21/ ]/ ./ 近年来/ 故障/ 检测/ 的/ 研究/ 主要/ 从/ 结点/ 或是/ 结构/ 等/ 方面/ 开展/ ./ Smith/ 等/ 人/ [/ 22/ ]/ 利用/ 贝叶斯/ 方法/ 对/ 结点/ 数据/ 进行/ 降维/ 并/ 通过/ PCA/ 方法/ 解析/ 出/ 影响/ 结点/ 健康状况/ 的/ 主要/ 指标/ ,/ 最后/ 根据/ 结点/ 之间/ 的/ 差异/ 来/ 检测/ 故障/ 结点/ ./ Bertier/ 等/ 人/ [/ 23/ ]/ 提出/ 了/ 一种/ 的/ 分层/ 检测/ 结构/ ,/ 通过/ 将/ 节点/ 分成/ 若干组/ ,/ 在/ 每个/ 组内/ 设置/ 一个/ Leader/ 节点/ ,/ 负责/ 完成/ 对/ 组内/ 节点/ 的/ 故障/ 检测/ ,/ 并且/ 可以/ 根据/ 应用程序/ 需求/ 通过/ 共享/ 服务/ 自/ 适应/ 调整/ 服务质量/ ./ Shi/ 等/ 人/ [/ 24/ ]/ 也/ 提出/ 了/ 一种/ 类似/ 的/ 层次结构/ 故障/ 检测/ 协议/ ,/ 包含/ 了/ 不/ 可靠/ 的/ 故障/ 检测/ 技术/ 服务/ 和/ 微处理器/ 体系结构/ 的/ 一些/ 想法/ ,/ 并/ 重点/ 讨论/ 了/ 这种/ 结构/ 的/ 良好/ 的/ 可伸缩性/ 和/ 灵活性/ ./ Wang/ 等/ 人/ [/ 25/ ]/ 在/ 云/ 计算/ 的/ 环境/ 中/ 提出/ 了/ 一种/ 基于/ 熵/ 的/ 异常/ 测试方法/ 模型/ ./ Basile/ 等/ 人/ [/ 26/ ]/ 提出/ 带/ 标记/ 的/ 时间/ Petri/ 网来/ 动态/ 的/ 评估/ 系统/ 的/ 状态/ 和/ 故障/ 检测/ ./ 综上所述/ ,/ 现有/ 的/ 系统/ 异常/ 感知/ 和/ 检测/ 主要/ 考虑/ 的/ 是/ 用户/ 非法行为/ 对系统/ 所/ 造成/ 的/ 异常/ ,/ 而/ 未/ 考虑/ 用户/ 合法/ 行为/ 对系统/ 的/ 影响/ ./ 通过/ 表征/ 检测/ 异常/ 的/ 方法/ 缺乏/ 考虑/ 实时/ 预知/ 用户/ 合法/ 行为/ 对系统/ 的/ 可用性/ 造成/ 的/ 损害/ ./ 这种/ 影响/ 主要/ 是/ 开放/ 环境/ 下/ 的/ 网络服务/ 系统对/ 用户/ 行为/ 的/ 不/ 可预见性/ 和/ 不/ 可控性/ 所/ 造成/ 的/ ./ 而/ 系统/ 行为/ 对系统/ 本身/ 来说/ 应当/ 是/ 可控性/ 的/ ./ 但/ 这种/ 可控性/ 必须/ 是/ 系统/ 尽早/ 感知/ 潜在/ 异常/ 的/ 发生/ ,/ 即/ 系统/ 异常/ 的/ 可控性/ 是/ 以/ 系统对/ 异常/ 的/ 可预见性/ 为/ 前提/ ./ 本文/ 提出/ 的/ 大规模/ 网络服务/ 系统/ 的/ 异常/ 行为/ 敏捷/ 感知/ 方法/ ,/ 是/ 针对/ 用户/ 合法/ 行为/ 短时/ 聚集/ 对系统/ 行为/ 所/ 造成/ 的/ 异常/ ,/ 通过/ 系统/ 行为/ 流程/ 中/ 微小/ 的/ 负载/ 变化/ ,/ 在/ 系统/ 运行/ 前期/ 或/ 系统/ 运行/ 中/ 提前/ 快速/ 地/ 感知/ 系统/ 异常/ 行为/ ,/ 以/ 达到/ 利用/ 系统/ 行为/ 的/ 可预见性/ 解决/ 用户/ 行为/ 的/ 不/ 可预见性/ ,/ 从而/ 为/ 系统/ 服务/ 调整/ 提供/ 支持/ ./ 3/ 系统/ 异常/ 敏捷/ 感知/ 模型/ 3.1/ 系统/ 异常/ 在/ 大多数/ 系统/ 运行/ 正常/ 情况/ 下/ ,/ 系统/ 是/ 可以/ 满足用户/ 需求/ 的/ ./ 但/ 当/ 某/ 一/ 特定/ 时间/ 或是/ 受/ 事件/ 、/ 其他/ 用户/ 行为/ 、/ 环境/ 等/ 因素/ 影响/ 时/ ,/ 大规模/ 网络服务/ 系统/ 性能/ 及/ 系统/ 行为/ 与/ 用户/ 需求/ 及/ 用户/ 行为/ 容易/ 发生/ 不相/ 适配/ 的/ 状况/ ,/ 即/ 系统/ 异常/ ./ 例如/ ,/ 火车票/ 网上/ 购票/ Page4/ 系统/ 每到/ 节假日/ ,/ 尤其/ 是/ 春节/ ,/ 用户/ 群体/ 规模/ 急剧/ 扩大/ ,/ 系统/ 就/ 呈现出/ 不堪/ 使用/ 的/ 状态/ 甚至/ 瘫痪/ ./ 从/ 用户/ 使用/ 系统/ 的/ 流程/ 看/ ,/ 平时/ 用户/ 完成/ 一次/ 购票/ 过程/ 很/ 顺利/ ./ 但是/ 当/ 系统/ 并发/ 用户量/ 激增/ 时/ ,/ 系统资源/ 会/ 被/ 占用/ ,/ 导致系统/ 的/ 流畅/ 度/ 下降/ ,/ 有些/ 用户/ 会因/ 自身/ 原因/ 在/ 此次/ 流程/ 中/ 的/ 某些/ 环节/ 不断/ 重复/ 操作/ (/ 如/ 不断/ 刷新/ 页面/ 、/ 重复/ 提交/ 等/ )/ ,/ 这/ 使得/ 系统/ 负担/ 加重/ ,/ 系统/ 的/ 可用性/ 极大/ 下降/ ,/ 造成/ 系统/ 异常/ ./ 例如/ ,/ 每年/ 双十/ 一/ 活动/ 时/ ,/ 电商/ 平台/ 聚集/ 了/ 大量/ 的/ 用户/ ,/ 有/ 数据/ 表明/ 双十/ 一/ 这/ 一天/ 用户/ 购买/ 物品/ 的/ 一系列/ 过程/ 会/ 比/ 平常/ 慢/ 很多/ ,/ 尤其/ 是/ 在/ 付款/ 环节/ ,/ 用户/ 付/ 不了/ 款/ 或是/ 要/ 不断/ 重复/ 付款/ 操作/ ,/ 用户/ 对/ 购物/ 过程/ 的/ 体验/ 度/ 也/ 比/ 平时/ 差/ ./ 由此可知/ ,/ 在/ 系统/ 运行/ 中/ ,/ 系统/ 负载/ 增加/ 主要/ 有/ 两个/ 原因/ ,/ 一是/ 用户量/ 的/ 增加/ ,/ 另/ 一个/ 是/ 用户/ 提交/ 的/ 请求/ 行为/ 数/ 增加/ ./ 而/ 用户量/ 和/ 用户/ 提交/ 的/ 请求/ 行为/ 数/ 的/ 增加/ 则/ 是因为/ 系统/ 群体/ 用户/ 行为/ 中有/ 行为/ 噪音/ 的/ 存在/ ./ 这种/ 行为/ 噪音/ 在/ 大规模/ 的/ 网络/ 环境/ 中/ 具体表现/ 为/ 个体/ 用户/ 的/ 行为/ 偏差/ 会/ 影响/ 其他/ 用户/ 的/ 行为/ 序列/ ,/ 并且/ 这种/ 影响/ 会/ 扩大/ 到/ 群体/ 用户/ ,/ 造成/ 群体/ 用户/ 的/ 行为/ 偏差/ ,/ 最终/ 导致系统/ 异常/ ./ 本文/ 主要/ 考虑/ 用户/ 重复/ 提交/ 请求/ 的/ 行为/ 偏差/ ,/ 并/ 将/ 这种/ 具有/ 不/ 可控性/ 的/ 行为/ 偏差/ 定义/ 为/ 放大/ 因子/ ,/ 以此/ 建立/ 系统/ 异常/ 敏捷/ 感知/ 模型/ ./ 3.2/ 系统/ 异常/ 敏捷/ 感知/ 模型/ 定义/ 1/ ./ t/ 时刻/ 系统/ 中/ 用户/ 正常/ 提交/ 的/ 总/ 的/ 行为/ 数/ 等于/ 用户量/ ,/ 即/ Bft/ =/ St/ ./ 其中/ St/ 表示/ t/ 时刻/ 的/ 大规模/ 网络服务/ 系统/ 的/ 用户数/ ./ 定义/ 2/ ./ t/ 时刻/ 系统/ 中/ 用户/ 提交/ 的/ 总/ 的/ 行为/ 数/ Bt/ ,/ 是/ t/ 时刻/ 系统/ 中/ 所有/ 用户/ 正常/ 提交/ 的/ 行为/ 数/ 和/ 重复/ 提交/ 的/ 行为/ 数/ 的/ 总和/ ,/ 即/ Bt/ =/ Bft/ +/ Brt/ ./ 其中/ Bft/ 表示/ t/ 时刻/ 系统/ 中/ 用户/ 正常/ 提交/ 的/ 总/ 的/ 行为/ 数/ ;/ Brt/ 表示/ t/ 时刻/ 系统/ 中/ 用户/ 重复/ 提交/ 的/ 总/ 的/ 行为/ 数/ ./ 定义/ 3/ ./ t/ 时刻/ 系统/ 的/ 实际/ 负载/ Ct/ ,/ 是/ 用户/ 在/ 当前/ 时刻/ t/ 提交/ 的/ 总/ 的/ 行为/ 数/ 对应/ 的/ 一个/ 系统/ 负载/ ,/ 即/ Ct/ =/ Bt/ ×/ a/ ./ 其中/ a/ (/ a/ / 1/ )/ 表示/ 一个/ 用户/ 提交/ 的/ 一个/ 请求/ 行为/ 所/ 需要/ 的/ 系统/ 行为/ 的/ 负载/ ./ 定义/ 4/ ./ 系统/ 重复/ 行为/ 阻滞/ 系数/ β/ 1/ ,/ 是/ t/ 时刻/ 所有/ 用户/ 重复/ 提交/ 的/ 行为/ 数/ Brt/ 占/ 总/ 的/ 系统/ 行为/ 数/ Bt/ 的/ 比重/ ,/ 即/ β/ 1/ =/ Brt/ // Bt/ ./ 定义/ 5/ ./ 系统/ 行为/ 阻滞/ 系数/ β/ 2/ ,/ 是/ t/ 时刻/ 所有/ 用户/ 正常/ 提交/ 的/ 行为/ 数/ Bft/ 占/ 总/ 的/ 系统/ 行为/ 数/ Bt/ 的/ 比重/ ,/ 即/ β/ 2/ =/ Bft/ // Bt/ ./ 定义/ 6/ ./ 放大/ 因子/ (/ NTR/ )/ ,/ 是/ 单位/ 时间/ 内/ 用户量/ 和/ 用户/ 重复/ 提交/ 系统/ 行为/ 数/ 的/ 变化/ 量/ ,/ 即/ NTRt/ =/ β/ 1/ Δ/ Brt/ // Δ/ t/ +/ β/ 2/ Δ/ St/ // Δ/ t/ ./ 其中/ Δ/ Brt/ 表示/ 在/ 趋近/ t/ 时刻/ 的/ 用户/ 重复/ 提交/ 的/ 总/ 的/ 行为/ 数/ 的/ 变化/ 量/ ;/ Δ/ St/ 表示/ 在/ 趋近/ t/ 时刻/ 的/ 用户数/ 的/ 变化/ 量/ ./ 定义/ 7/ ./ t/ 时刻/ 预期/ 的/ 系统/ 负载/ Cbt/ ,/ 是/ 用户/ 在/ 当前/ 时刻/ t/ 正常/ 提交/ 的/ 总行/ 为数/ 在/ 放大/ 因子/ 的/ 作用/ 下/ 所/ 需要/ 的/ 系统/ 负载/ ,/ 即/ Cbt/ =/ NTR/ ×/ Bft/ ×/ a/ ./ 定义/ 8/ ./ 系统/ 行为/ 阻滞/ 度/ wit/ ./ {/ b1/ ,/ b2/ ,/ b3/ ,/ …/ }/ 表示/ 系统/ 的/ 行为/ 序列/ ,/ t/ 时刻/ 系统/ 行为/ bi/ 总数/ 占/ 总/ 的/ 系统/ 行为/ 数/ Bt/ 的/ 比重/ ,/ 即/ wit/ =/ ∑/ bi/ // Bt/ ./ 如果/ t/ 时刻/ 系统/ 行为/ bi/ 的/ 行为/ 阻滞/ 度/ 最大/ ,/ 说明/ 行为/ bi/ 在/ 系统/ 中是/ 不/ 稳定/ 的/ ./ 假设/ 1/ ./ 大规模/ 网络服务/ 系统/ 在/ 设计/ 之初/ 都/ 有/ 一个/ 自身/ 可以/ 承受/ 最大/ 的/ 系统/ 负载/ Cmax/ ./ 假设/ 2/ ./ 在/ t2/ 时刻/ ,/ 系统/ 因/ Δ/ St/ // Δ/ t/ 或/ Δ/ Brt/ // Δ/ t/ 的/ 激增/ 而/ 产生/ 异常/ ,/ 即当/ Ct2/ >/ Cmax/ 时/ ,/ / t/ ,/ t/ </ t2/ ,/ 有/ lim/ Δ/ t/ →/ 0/ Δ/ St/ // Δ/ t/ =/ 或/ lim/ Δ/ t/ →/ 0/ Δ/ Brt/ // Δ/ t/ =/ ./ 定理/ 1/ ./ 可/ 预知/ 性/ ./ 在/ 假设/ 1/ 、/ 2/ 的/ 条件/ 下/ ,/ 如果/ 系统/ 在/ t2/ 时刻/ 系统/ 会/ 发生/ 异常/ ,/ 那么/ 根据/ 定义/ 1/ ~/ 7/ 的/ 模型/ ,/ 在/ t1/ 时刻/ 可/ 预测/ 系统/ 会/ 发生/ 异常/ ,/ 即/ t1/ 时刻/ 系统/ 的/ 预期/ 负载/ 超过/ 系统/ 的/ 最大/ 负载/ ,/ 其中/ t1/ </ t2/ ./ 证明/ ./ 假设/ 在/ 任意/ t/ (/ t/ </ t2/ )/ 时刻/ 不能/ 预测/ 到/ 系统/ 会/ 发生/ 异常/ ,/ 即/ Cbt/ / Cmax/ ./ 其中/ Cbt/ 是/ 系统/ t/ 时刻/ 的/ 预期/ 负载/ ,/ Cmax/ 是/ 系统/ 的/ 最大/ 负载/ ./ 根据/ 定义/ 1/ ~/ 7/ ,/ 则/ 有/ NTR/ ×/ Bft/ ×/ a/ / Cmax/ </ Ct2/ 成立/ ./ 即/ NTR/ ×/ Bft/ ×/ a/ </ Ct2/ =/ Bt2/ ×/ a/ ./ 可知/ BrtBt/ ×/ Δ/ Brt/ 设/ y/ =/ min/ {/ Brt/ ,/ Bft/ }/ ,/ 则/ 有/ Bt/ ×/ Δ/ Brty/ 即/ Δ/ Brt/ +/ Δ/ St/ 最/ 右边/ 是/ 一个/ 定数/ ./ 当/ Δ/ t/ →/ 0/ 时/ ,/ 这/ 与/ 假设/ 2/ 矛盾/ ./ 因此/ ,/ / t1/ ,/ t1/ </ t2/ ,/ 使得/ Cbt1/ >/ Cmax/ ./ 即/ 系统/ 如果/ 发生/ 异常/ 则/ 可/ 提前/ 感知/ ./ 定理/ 2/ ./ 可/ 定位/ 性/ ./ 如果/ 系统/ 异常/ 是/ 因/ Δ/ St/ // Δ/ t/ 或是/ Δ/ Brt/ // Δ/ t/ 的/ 激增/ 引起/ 的/ ,/ 那么/ 可/ 定位/ 到/ 某个/ 系统/ 异常/ 行为/ ./ 证明/ ./ 根据/ 定理/ 1/ 可知/ 在/ t1/ 时刻/ 系统/ 的/ 预期/ 负载/ 大于/ 系统/ 最大/ 负载/ ./ 根据/ 定义/ 3/ ,/ 此时/ 用户/ 行为/ 对应/ 于/ 相应/ 的/ 系统/ 行为/ bi/ ./ 由于/ 该/ 预期/ 负载/ 根据/ t1/ 时刻/ 的/ 用户/ 行为/ 数/ Ct/ =/ Bt/ ×/ a/ 得到/ ./ 根据/ 定义/ 8/ ,/ 可/ 计算/ 出/ 阻滞/ 度/ 最大/ 的/ 系统/ 行为/ bi/ ./ 证毕/ ./ Page53/ ./ 3/ 案例/ 分析/ 以/ 某/ 网购/ 大规模/ 网络服务/ 系统/ 为/ 例来/ 说明/ 系统/ 异常/ 感知/ 敏捷/ 模型/ 的/ 原理/ ,/ 如图/ 1/ 所示/ 是/ 某/ 网购/ 系统/ 流程/ ./ 假设/ 对/ 网购/ 系统/ 流程/ 中/ 的/ 用户/ 登录/ 行为/ 、/ 浏览/ 网页/ 行为/ 、/ 加入/ 购物车/ 行为/ 、/ 支付/ 行为/ 进行/ 关键/ 监测/ ,/ 检测/ 其/ 上述/ 4/ 种/ 关键/ 系统/ 行为/ 总/ 的/ 用户/ 提交/ 正常/ 行为/ 数/ 和/ 重复/ 行为/ 数/ ./ 具体/ 数据/ 假设/ 如表/ 1/ 所示/ ./ t19/ :/ 0012083795320036t29/ :/ 10159371239428331t39/ :/ 20226711756840239t49/ :/ 30337552105254807t59/ :/ 40382722195360225/ 假设/ 该/ 网购/ 系统/ 所/ 能/ 承受/ 的/ 最大/ 系统/ 负载/ Cmax/ 为/ 60000/ ,/ 一个/ 用户/ 提交/ 的/ 一个/ 请求/ 行为/ 所/ 需要/ 的/ 系统/ 负载/ a/ 为/ 1/ ;/ 从表/ 1/ 数据/ 得出/ :/ 当/ t4/ =/ 9/ :/ 30/ ,/ Ct4/ =/ Bt4/ ×/ a/ =/ 54807/ ×/ 1/ β/ 1/ =/ Brt4/ // Bt4/ =/ 21052/ // 54807/ ≈/ 0.38/ ,/ β/ 2/ =/ Bft4/ // Bt4/ =/ 33755/ // 54807/ ≈/ 0.62/ ,/ NTRt4/ =/ β/ 1/ Δ/ Brt4/ // Δ/ t/ +/ β/ 2/ Δ/ St4/ // Δ/ tCbt4/ =/ NTR/ ×/ Bft4/ ×/ a/ 当/ t5/ =/ 9/ :/ 40/ ,/ Ct5/ =/ Bt5/ ×/ a/ =/ 60225/ ×/ 1/ 即当/ Time/ =/ 9/ :/ 30/ 时/ ,/ Cbt4/ >/ Cmax/ >/ Ct4/ ,/ 系统/ 发出/ 预警/ ,/ 且/ t4/ </ t5/ ./ 行为/ 含义/ TimeBftBrtBtb1/ 用户/ 登录/ 行为/ 9/ :/ 307124323210356b2/ 反馈/ 网页/ 行为/ 9/ :/ 306987316710154b3/ 加入/ 购物车/ 行为/ 9/ :/ 307646455112197b4/ 支付/ 行为/ 9/ :/ 3012998910522103b5/ 系统/ 总/ 的/ 行为/ 数/ 9/ :/ 30337552105254807/ 从表/ 2/ 数据/ 得出/ :/ 当/ Time/ =/ 9/ :/ 30/ 时/ ,/ w4t/ =/ ∑/ b4/ // Bt/ =/ 22103/ // 54807/ ≈/ 0.40/ 最大/ ,/ 所以/ 系统/ 异常/ 行为/ 是/ b4/ ,/ 即/ 支付/ 行为/ ./ 4/ 重复/ 行为/ 检测/ 的/ Petri/ 网/ 模型/ 及/ 算法/ 本文/ 第/ 3/ 节所/ 提出/ 的/ 系统/ 异常/ 敏捷/ 感知/ 模型/ 对/ 快速/ 感知/ 用户/ 合法/ 行为/ 短时/ 聚集/ 引起/ 系统/ 异常/ 问题/ 提供/ 了/ 理论/ 支持/ ,/ 本节/ 将/ 阐述/ 如何/ 将/ 敏捷/ 感知/ 模型/ 应用/ 到/ 实际/ 系统/ 的/ 异常/ 行为/ 检测/ 中/ ./ 在/ 实际/ 的/ 应用/ 系统/ 中/ ,/ 敏捷/ 感知/ 模型/ 应用/ 实现/ 的/ 关键/ 是/ 如何/ 检测/ 系统/ 重复/ 行为/ ./ 检测/ 系统/ 重复/ 行为/ 首先/ 要/ 对系统/ 进行/ 建模/ ,/ 再/ 对系统/ 的/ 关键/ 节点/ 设置/ 检测/ 机制/ ./ 系统/ 建模/ 工具/ 有/ 形式语言/ 与/ 自动机/ 、/ Petri/ 网等/ ,/ 同/ 其他/ 系统/ 模型/ 相/ 比较/ ,/ 对系统/ 并发/ 的/ 贴切/ 描述/ 是/ Petri/ 网/ 的/ 独特/ 优势/ ./ 下面/ 讨论/ 通过/ 对系统/ 进行/ Petri/ 网/ 建模/ ,/ 建立/ 可/ 检测/ 重复/ 行为/ 的/ Petri/ 网/ 系统/ 模型/ 及其/ 算法/ ,/ 并/ 将/ 敏捷/ 感知/ 模型/ 应用/ 于/ 该/ 检测/ 算法/ 中/ ./ 4.1/ 带/ 优先/ 关系/ 的/ 颜色/ 双/ 变迁/ Petri/ 网/ 传统/ Petri/ 网是/ 由库/ 所/ 、/ 变迁/ 和/ 流/ 关系/ 3/ 个/ 基本/ Page6/ 个网/ ,/ 当且/ 仅/ 当/ 结构/ 构成/ ,/ 是/ 描述/ 离散/ 事件/ 动态/ 系统/ 的/ 有力/ 工具/ ./ 下面/ 先/ 简述/ Petri/ 网/ 的/ 基本概念/ ,/ 然后/ 给出/ 带/ 优化/ 关系/ 的/ 颜色/ 双/ 变迁/ Petri/ 网/ 模型/ ./ 定义/ 9/ ./ 网/ [/ 27/ ]/ ./ 三元组/ N/ =/ (/ P/ ,/ T/ ,/ F/ )/ 称为/ 一/ (/ 1/ )/ P/ 是/ 一个/ 有限/ 库所集/ ,/ T/ 是/ 一个/ 有限/ 变迁/ 集/ ;/ (/ 2/ )/ P/ ∪/ T/ ≠/ / ,/ P/ ∩/ T/ =/ / ;/ (/ 3/ )/ F/ / (/ P/ ×/ T/ )/ ∪/ (/ T/ ×/ P/ )/ 是/ 一个/ 弧集/ ./ 定义/ 10/ ./ Petri/ 网/ [/ 27/ ]/ ./ PN/ =/ (/ N/ ,/ M/ )/ 称为/ 一个/ (/ 1/ )/ N/ =/ (/ P/ ,/ T/ ,/ F/ )/ 是/ 一个/ 网/ ;/ (/ 2/ )/ M/ :/ P/ →/ {/ 0/ ,/ 1/ ,/ 2/ ,/ …/ }/ 是/ PN/ 的/ 一个/ 标识/ 函数/ ;/ (/ 3/ )/ 引发/ 规则/ :/ ①/ / p/ ∈/ ·/ t/ :/ M/ (/ p/ )/ >/ 0/ ,/ 则/ 称/ 变迁/ t/ 在/ 标识/ M/ 使/ ②/ 若/ 变迁/ t/ 在/ 标识/ M/ 使能/ ,/ 则/ t/ 可以/ 引发/ 且/ 引能/ ,/ 记为/ M/ [/ t/ 〉/ ;/ Petri/ 网/ ,/ 当且/ 仅/ 当/ 发后/ 产生/ 一个/ 后继/ 标识/ M/ ,/ 记作/ M/ [/ t/ 〉/ M/ ,/ 其中/ 定义/ 11/ ./ 冲突/ 关系/ [/ 27/ ]/ ./ 设/ (/ P/ ,/ T/ ;/ F/ ,/ M0/ )/ 为/ 一个/ 基本/ 网/ 系统/ ,/ t1/ ,/ t2/ ∈/ E/ ,/ M/ 是/ ∑/ 的/ 一个/ 情态/ ./ 如果/ 满足/ :/ 则/ 称/ 事件/ t1/ 和/ t2/ 在/ 情态/ M/ 处于/ 冲突/ 关系/ ./ (/ 1/ )/ M/ [/ t1/ 〉/ 且/ M/ [/ t2/ 〉/ ;/ (/ 2/ )/ M/ [/ t1/ 〉/ M/ →/ / M/ [/ t2/ 〉/ ∧/ M/ [/ t2/ 〉/ M/ →/ / M/ [/ t1/ 〉/ 颜色/ 双/ 变迁/ Petri/ 网是/ 传统/ Petri/ 网/ 的/ 基础/ 上/ 扩展/ 了/ 颜色/ 以及/ 变迁/ 得到/ 的/ 高级/ Petri/ 网/ ./ Gao/ 等/ 人/ [/ 28/ ]/ 提出/ 的/ 颜色/ 双/ 变迁/ 的/ Petri/ 网/ ,/ 通过/ 颜色/ 集/ 、/ 变迁/ 集/ 以及/ 弧/ 表达式/ 等/ 增强/ 了/ 控制/ 逻辑/ 表达能力/ ./ 针对/ 变迁/ 的/ 不同/ 优先级/ 的/ 问题/ ,/ Best/ 等/ 人/ [/ 29/ ]/ 提出/ 了/ 带/ 优先/ 关系/ 的/ Petri/ 网/ ./ 本文/ 在/ 此基础/ 上/ ,/ 为/ 解决/ 系统/ 重复/ 行为/ 的/ 检测/ ,/ 提出/ 一种/ 带/ 优先/ 关系/ 的/ 颜色/ 双/ 变迁/ Petri/ 网/ ./ 是/ 一个/ PCDPN/ =/ (/ Σ/ ,/ P/ ,/ T/ ,/ Q/ ;/ F/ ,/ C/ ,/ ρ/ )/ ;/ 其中/ Σ/ ~/ P/ (/ λ/ )/ ;/ 定义/ 12/ ./ 带/ 优先/ 关系/ 的/ 颜色/ 双/ 变迁/ Petri/ 网/ (/ 1/ )/ Σ/ 是/ 有限/ 颜色/ 集合/ ,/ 服从/ 泊松/ 分布/ 函数/ ,/ (/ 2/ )/ P/ 是/ 库/ 所集/ ,/ P/ =/ {/ p1/ ,/ p2/ ,/ …/ ,/ pn/ }/ (/ n/ / 0/ )/ ;/ (/ 3/ )/ T/ 是/ 服务/ 行为/ 变迁/ 集/ ,/ T/ =/ {/ t1/ ,/ t2/ ,/ …/ ,/ tk/ ,/ tk/ +/ 1/ ,/ …/ ,/ tk/ +/ i/ }/ (/ k/ / 0/ ,/ i/ / 0/ )/ ,/ 其中/ t1/ 到/ tk/ 是/ 系统/ 流程/ 本身/ 固有/ 的/ 服务/ 行为/ 变迁/ ,/ tk/ +/ 1/ 到/ tk/ +/ i/ 是/ 用户/ 重复/ 提交/ 系统/ 行为/ 时/ 所/ 需/ 触发/ 的/ 服务/ 行为/ 变迁/ ;/ (/ 4/ )/ Q/ 是/ 控制/ 行为/ 变迁/ 集/ ,/ Q/ =/ {/ q1/ ,/ q2/ ,/ …/ ,/ qm/ }/ (/ m/ / 0/ )/ ;/ (/ 5/ )/ F/ 是/ 有/ 向/ 弧集/ ,/ F/ =/ FC/ ∪/ FD/ ,/ FC/ / (/ P/ ×/ T/ )/ ∪/ (/ T/ ×/ P/ )/ ,/ FD/ / (/ P/ ×/ Q/ )/ ∪/ (/ Q/ ×/ P/ )/ ;/ (/ 6/ )/ C/ 是/ 颜色/ 函数/ ,/ C/ :/ P/ →/ Z/ (/ 非负/ 整数/ 集/ )/ ,/ 库所/ P/ 中/ 的/ 托/ 肯值/ 属于/ 有限/ 颜色/ 集合/ Σ/ ,/ 且/ 用户/ 在/ 时间/ t/ 内/ 到达/ 系统/ 的/ 数量/ 可以/ 服从/ 泊松/ 分布/ [/ 30/ ]/ ;/ (/ 7/ )/ 优先/ 关系/ ρ/ 表示/ 一个/ 变迁/ 的/ 偏序/ 关系/ ,/ 即/ (/ qi/ ,/ ti/ )/ ∈/ ρ/ ,/ 定义/ 控制/ 行为/ 变迁/ qi/ 的/ 优先级/ 高于/ 服务/ 行为/ 变迁/ ti/ 的/ 优先级/ ./ 4.2/ PCDPN/ 模型/ 4.2/ ./ 1Petri/ 网/ 的/ 4/ 种/ 基本/ 结构/ 择/ 、/ 循环/ 这/ 4/ 种/ 基本/ 结构/ 构成/ [/ 31/ ]/ ,/ 如图/ 2/ 所示/ ./ 基于/ Petri/ 网/ 的/ 系统/ 模型/ 主要/ 由/ 顺序/ 、/ 并发/ 、/ 选/ 4.2/ ./ 2PCDPN/ 的/ 4/ 种/ 基本/ 结构/ 的/ 几种/ 基本/ 结构/ 进行/ 建模/ ,/ 如图/ 3/ 所示/ ./ 下面/ 利用/ PCDPN/ 分别/ 对/ 大规模/ 网络系统/ 模型/ 图/ 3/ 中有/ 两种/ 变迁/ ,/ 一种/ 是/ 系统/ 服务/ 行为/ 流程/ 变迁/ t/ ,/ 一种/ 是/ 控制/ 行为/ 变迁/ q/ ./ 当/ 用户/ 提交/ 重复/ 系统/ 行为/ 时/ ,/ 触发/ 代表/ 重复/ 行为/ 的/ 控制/ 行为/ 变迁/ q/ ,/ 此时/ 正常/ 行为/ 流程/ 的/ 服务/ 行为/ 变迁/ t/ 和/ 控制/ 行为/ 变迁/ q/ 属于/ 冲突/ 关系/ ,/ 优先/ 触发/ 控制/ 行为/ 变迁/ q/ ,/ 使/ 用户/ 回到/ 之前/ 的/ 行为/ 流程/ 中/ ,/ 并且/ 重复/ 行为/ 数加/ 1/ ,/ 系统/ Page7/ 行为/ 流程/ 库所中/ 的/ 托/ 肯值/ 减/ 1.4/ ./ 3/ 重复/ 行为/ 检测/ 的/ PCDPN/ 模型/ 4.3/ ./ 1/ 顺序/ 结构/ 对系统/ 行为/ 流程/ 进行/ Petri/ 网/ 建模/ ,/ 如果/ 有/ 关键/ 行为/ 节点/ 属于/ 顺序/ 结构/ ,/ 则/ 对/ 该/ 关键/ 节点/ 进行/ 重构/ ,/ 转变成/ PCDPN/ 模型/ ,/ 以此/ 对/ 该/ 节点/ 进行/ 重复/ 行为/ 检测/ ./ 以图/ 3/ 顺序/ 结构/ 为例/ ,/ p1/ ~/ p5/ 是/ 库/ 所集/ ,/ 表示/ 状态/ ./ 当/ 用户/ 重复/ 提交/ 一个/ 行为/ ,/ 服务/ 行为/ 变迁/ t3/ 触发/ ./ 此时/ 服务/ 行为/ 变迁/ t2/ 和/ 控制/ 行为/ 变迁/ q1/ 在/ 此/ 情态/ 下/ 同时/ 满足/ 触发/ 条件/ ,/ 属于/ 冲突/ 关系/ ,/ 因/ 控制/ 行为/ 变迁/ q1/ 的/ 优先级/ 大于/ 服务/ 行为/ 变迁/ t2/ ,/ 控制/ 行为/ 变迁/ q1/ 优先/ 触发/ ,/ 且/ 重复/ 行为/ 数加/ 1/ ,/ 系统/ 行为/ 流程/ 库所中/ 的/ 托/ 肯值/ 减/ 1.4/ ./ 3.2/ 并发/ 结构/ 对系统/ 行为/ 流程/ 进行/ Petri/ 网/ 建模/ ,/ 如果/ 有/ 关键/ 行为/ 节点/ 属于/ 并发/ 结构/ ,/ 则/ 对/ 该/ 关键/ 节点/ 进行/ 重构/ ,/ 转变成/ PCDPN/ 模型/ ,/ 以此/ 对/ 该/ 节点/ 进行/ 重复/ 行为/ 检测/ ./ 以图/ 3/ 并发/ 结构/ 为例/ ,/ p1/ ~/ p6/ 是/ 库/ 所集/ ,/ 表示/ 状态/ ./ 当/ 用户/ 重复/ 提交/ 一个/ 行为/ ,/ 服务/ 行为/ 变迁/ t5/ 触发/ ./ 此时/ 服务/ 行为/ 变迁/ t4/ 和/ 控制/ 行为/ 变迁/ q1/ 在/ 此/ 情态/ 下/ 同时/ 满足/ 触发/ 条件/ ,/ 属于/ 冲突/ 关系/ ,/ 因/ 控制/ 行为/ 变迁/ q1/ 的/ 优先级/ 大于/ 服务/ 行为/ 变迁/ t4/ ,/ 控制/ 行为/ 变迁/ q1/ 优先/ 触发/ ,/ 且/ 重复/ 行为/ 数加/ 1/ ,/ 系统/ 行为/ 流程/ 库所中/ 的/ 托/ 肯值/ 减/ 1.4/ ./ 3.3/ 选择/ 结构/ 对系统/ 行为/ 流程/ 进行/ Petri/ 网/ 建模/ ,/ 如果/ 有/ 关键/ 行为/ 节点/ 属于/ 选择/ 结构/ ,/ 则/ 对/ 该/ 关键/ 节点/ 进行/ 重构/ ,/ 转变成/ PCDPN/ 模型/ ,/ 以此/ 对/ 该/ 节点/ 进行/ 重复/ 行为/ 检测/ ./ 以图/ 3/ 选择/ 结构/ 为例/ ,/ p1/ ~/ p6/ 是/ 库/ 所集/ ,/ 表示/ 状态/ ./ 当/ 用户/ 重复/ 提交/ 一个/ 行为/ ,/ 服务/ 行为/ 变迁/ t5/ 触发/ ./ 此时/ 服务/ 行为/ 变迁/ t4/ 和/ 控制/ 行为/ 变迁/ q1/ 在/ 此/ 情态/ 下/ 同时/ 满足/ 触发/ 条件/ ,/ 属于/ 冲突/ 关系/ ,/ 因/ 控制/ 行为/ 变迁/ q1/ 的/ 优先级/ 大于/ 服务/ 行为/ 变迁/ t4/ ,/ 控制/ 行为/ 变迁/ q1/ 优先/ 触发/ ,/ 且/ 重复/ 行为/ 数加/ 1/ ,/ 系统/ 行为/ 流程/ 库所中/ 的/ 托/ 肯值/ 减/ 1.4/ ./ 3.4/ 循环/ 结构/ 对系统/ 行为/ 流程/ 进行/ Petri/ 网/ 建模/ ,/ 如果/ 有/ 关键/ 行为/ 节点/ 属于/ 循环/ 结构/ ,/ 则/ 对/ 该/ 关键/ 节点/ 进行/ 重构/ ,/ 转变成/ PCDPN/ 模型/ ,/ 以此/ 对/ 该/ 节点/ 进行/ 重复/ 行为/ 检测/ ./ 以图/ 3/ 循环/ 结构/ 为例/ ,/ p1/ ~/ p4/ 是/ 库/ 所集/ ,/ 表示/ 状态/ ./ 当/ 用户/ 重复/ 提交/ 一个/ 行为/ ,/ 服务/ 行为/ 变迁/ t4/ 触发/ ./ 此时/ 服务/ 行为/ 变迁/ t3/ 和/ 控制/ 行为/ 变迁/ q1/ 在/ 此/ 情态/ 下/ 同时/ 满足/ 触发/ 条件/ ,/ 属于/ 冲突/ 关系/ ,/ 因/ 控制/ 行为/ 变迁/ q1/ 的/ 优先级/ 大于/ 服务/ 行为/ 变迁/ t3/ ,/ 控制/ 行为/ 变迁/ q1/ 优先/ 触发/ ,/ 且/ 重复/ 行为/ 数加/ 1/ ,/ 系统/ 行为/ 流程/ 库所中/ 的/ 托/ 肯值/ 减/ 1.4/ ./ 4/ 算法/ PCDPN/ 根据/ PCDPN/ 模型/ ,/ 将/ 所有/ 关键/ 行为/ 节点/ 的/ 所/ 检测/ 出来/ 的/ 重复/ 行为/ 数/ 进行/ 累加/ 得到/ 系统/ 总/ 的/ 重复/ 行为/ 数/ ./ 其中/ 用户/ 正常/ 提交/ 的/ 行为/ 数为/ 系统/ 行为/ 流程/ 库所/ 的/ 托/ 肯值/ ./ 然后/ 根据/ 定义/ 1/ ~/ 8/ 的/ 敏捷/ 感知/ 模型/ ,/ 计算/ 系统/ 的/ 预期/ 负载/ 和/ 行为/ 的/ 阻滞/ 度/ ./ 相应/ 的/ 系/ Page8/ 统/ 感知/ 检测/ 算法/ PCDPN/ 如下/ 所示/ ./ 算法/ PCDPN/ ./ 系统/ 异常/ 行为/ 敏捷/ 感知/ 检测/ ./ 输入/ :/ St/ ,/ Bt/ ,/ Brt/ ,/ Bft/ ,/ a/ ,/ n/ ;/ // // 在/ t/ 时刻/ 系统/ 监测/ 或计/ 输出/ :/ 系统/ 异常/ 预警/ 和/ 异常/ 行为/ 1/ ./ WHILEt/ >/ 0/ ;/ 2/ ./ Ct/ =/ Bt/ ×/ a/ ;/ // // 计算/ 所有/ 用户/ 在/ 当前/ 时刻/ t/ 提交/ 的/ 总/ 的/ 行为/ 数/ 对应/ 的/ 一个/ 实际/ 的/ 系统/ 负载/ C3/ ./ β/ 1/ =/ Brt/ // Bt/ ;/ β/ 2/ =/ Bft/ // Bt/ ;/ // // 计算/ 当前/ t/ 时刻/ 的/ 放大/ 因子/ 的/ 值/ 4/ ./ Cbt/ =/ NTR/ ×/ Bft/ ×/ a/ ;/ // // 计算/ 所有/ 用户/ 在/ 当前/ t/ 时刻/ 提交/ 的/ 正常/ 行为/ 数在/ 放大/ 因子/ 的/ 作用/ 下/ 所/ 需要/ 的/ 预期/ 系统/ 负载/ 5/ ./ IFCbt/ >/ CmaxTHEN6/ ./ 预警系统/ 在/ 未来/ 的/ 某个/ 时刻/ 会/ 发生/ 异常/ ;/ // // 定位/ 可能/ 发生/ 异常/ 的/ 系统/ 行为/ 7/ ./ i/ ←/ 1/ ;/ 8/ ./ WHILEi/ </ n/ // // 计算/ t/ 时刻/ 所有/ 行为/ bi/ 的/ 阻滞/ 度/ 9/ ./ wit/ =/ ∑/ bi/ // Bt/ ;/ i/ =/ i/ +/ 1/ ;/ 10/ ./ ENDWHILE11/ ./ wmax/ ←/ w1t/ ;/ k/ ←/ 0/ ;/ i/ ←/ 2/ ;/ 12/ ./ WHILEi/ </ n13/ ./ IFwit/ >/ wmaxTHEN14/ ./ wmax/ ←/ wit15/ ./ k/ ←/ i16/ ./ ENDIF17/ ./ i/ =/ i/ +/ 118/ ./ ENDWHILE/ // // 找出/ 阻滞/ 度/ 最大/ wkt19/ ./ PRINT/ 系统/ 在/ 未来/ 的/ 某个/ 时刻/ 会/ 发生/ 异常/ ,/ 且/ 导致/ 20/ ./ ENDIF21/ ./ t/ =/ t/ +/ m/ // // 检测时间/ 间隔/ 为/ m22/ ./ ENDWHILE23/ ./ 算法/ 结束/ ./ 5/ 实例/ 与/ 实验/ 5.1/ 购票/ 系统/ 的/ PCDPN/ 模型/ 某些/ 购票/ 系统/ 就是/ 典型/ 的/ 大规模/ 网络服务/ 软件系统/ ,/ 例如/ 12306/ 购票/ 系统/ ./ 每逢/ 春运/ ,/ 12306/ 购票/ 系统/ 的/ 用户量/ 就/ 会/ 突然/ 增多/ ,/ 以及/ 抢票/ 软件/ 的/ 使用/ ,/ 使得/ 系统/ 负载/ 的/ 增大/ ,/ 导致系统/ 变慢/ 甚至/ 崩溃/ ./ 模拟/ 某/ 购票/ 系统/ 的/ 基本/ 流程/ (/ 如图/ 4/ 所示/ )/ ,/ 在/ 其/ 购票/ 系统/ Petri/ 网/ 模型/ 的/ 基础/ 上/ 构建/ 重复/ 行为/ 检测/ 的/ PCDPN/ 网/ 模型/ ,/ 并/ 将/ 系统/ 异常/ 行为/ 敏捷/ 感知/ 检测/ 算法/ 运用/ 到/ 模型/ 中/ ,/ 通过/ 实验/ 验证/ 重复/ 行为/ 检测/ 模型/ 的/ 有效性/ ,/ 且/ 可以/ 敏捷/ 感知/ 到/ 系统/ 在/ 未来/ 的/ 某个/ 时间/ 是否/ 会/ 发生/ 异常/ ./ 所示/ ./ 根据/ 购票/ 系统/ 的/ 流程图/ 进行/ Petri/ 建模/ ,/ 如图/ 5/ 对于/ 图/ 5/ 中/ 各/ 变迁/ 的/ 含义/ 如表/ 3/ 所示/ ./ 变迁/ t1t2t3t4t5t6t7t8t9t10t11t12Page9/ 对图/ 5/ 的/ 购票/ 系统/ 的/ Petri/ 网/ 模型/ 进行/ 分析/ ,/ 确定/ 登录/ 行为/ 、/ 查询/ 行为/ 、/ 预订/ 行为/ 和/ 支付/ 行为/ 是/ 其/ 关图/ 5/ 购票/ 系统/ 的/ Petri/ 网/ 模型/ 图/ 6/ 购票/ 系统/ 的/ PCDPN/ 模型/ 对于/ 图/ 6/ 中/ t1/ ~/ t12/ 变迁/ 的/ 含义/ 见表/ 3/ ,/ t13/ ~/ t14/ ,/ q1/ ~/ q4/ 变迁/ 的/ 含义/ 如表/ 4/ 所示/ ./ 表/ 4/ 图/ 6/ 模型/ 中/ 狋/ 13/ ~/ 狋/ 14/ ,/ 狇/ 1/ ~/ 狇/ 4/ 变迁/ 所/ 对应/ 的/ 含义/ t13/ ~/ t14q1/ ~/ q45/ ./ 2/ 实验设计/ 本文/ 通过/ 对/ 购票/ 系统/ 的/ PCDPN/ 模型/ 所示/ 的/ 流程/ 进行/ 模拟/ ,/ 其中/ 对/ 登录/ 、/ 查询/ 、/ 预订/ 和/ 支付/ 这/ 几个/ 模块/ 进行/ 重点/ 考察/ ,/ 并/ 对/ 每个/ 模块/ 设置/ 了/ 监控/ ,/ 主要/ 包括/ 图/ 6/ 中/ 的/ 控制/ 行为/ 变迁/ q1/ ~/ q4/ ,/ 采集/ 行为/ 数等/ 相关/ 数据/ ,/ 其中/ 系统/ 服务/ 行为/ 流程/ 中/ 的/ 库/ 所/ 的/ 托/ 肯值/ 表示/ 用户量/ ,/ 用户/ 重复/ 行为/ 数由/ 累加/ 得到/ ./ 行为/ 及/ 数据/ 的/ 模拟/ 如下/ :/ 模拟系统/ 的/ 行为/ 序列/ 如图/ 7/ 所示/ ./ 图/ 7/ 中/ 主要/ 键/ 行为/ ,/ 利用/ PCDPN/ 对/ 这/ 几个/ 关键/ 行为/ 进行/ 行为/ 流程/ 建模/ ,/ 如图/ 6/ 所示/ ./ Page10IP/ 的/ 模拟/ ;/ 密码/ 、/ IP/ ,/ 进行/ 模拟/ 校验/ ;/ 点/ 、/ 时间/ 的/ 模拟/ ;/ (/ 1/ )/ 用户/ 登录/ ,/ 此/ 环节/ 需要/ 完成/ 用户名/ 、/ 密码/ 、/ (/ 2/ )/ 服务端/ 响应/ 登录/ 请求/ ,/ 接收/ 模拟/ 的/ 用户名/ 、/ (/ 3/ )/ 登录/ 完成/ 后/ ,/ 查询/ ,/ 此/ 环节/ 需要/ 完成/ 起止/ 地/ (/ 4/ )/ 响应/ 查询/ 请求/ ,/ 接收/ 模拟/ 的/ 查询/ 的/ 起止/ 地/ (/ 5/ )/ 模拟/ 预订/ 请求/ ,/ 此/ 环节/ 需要/ 确定/ 完成/ 订单/ (/ 6/ )/ 响应/ 预订/ 请求/ ,/ 根据/ 查询/ 条件/ 返回/ 此时/ 的/ 提交/ 的/ 订单/ 剩余/ 量/ ,/ 提交/ 进行/ 排队/ ,/ 计算/ 剩余时间/ ,/ 响应/ 预定/ 请求/ ,/ 返回/ 状态/ 码/ ;/ 点/ 、/ 时间/ ,/ 模拟/ 数据库/ 查询/ ,/ 返回/ 符合条件/ 列表/ ;/ 提交/ 的/ 模拟/ ;/ 的/ 模拟/ ;/ (/ 7/ )/ 模拟/ 支付/ 请求/ ,/ 此/ 环节/ 需要/ 车次/ 、/ 支付/ 节点/ (/ 8/ )/ 响应/ 支付/ 请求/ ,/ 连接/ 第三方/ 服务/ 代理/ ,/ 返回/ 支付/ 状态/ ./ 由于/ 无法/ 获取/ 到/ 购票/ 系统/ 的/ 实际/ 数据/ ,/ 本文/ 设置/ 一个/ 数据/ 发生器/ ,/ 使/ 其/ 对/ 各个/ 模块/ 不断/ 施加/ 用户/ 提交/ 的/ 正常/ 行为/ 数/ 和/ 重复/ 行为/ 数/ ,/ 造成/ 模拟系统/ 负载/ 的/ 增加/ ./ 计算/ 模拟/ 数据/ ,/ 为/ 保证数据/ 的/ 有效性/ ,/ 与/ 12306/ 系统/ 某/ 一时/ 段/ 的/ 具体/ 流量/ 图作/ 对比/ (/ 如图/ 8/ 所示/ ①/ )/ ,/ 使/ 之/ 符合/ 12306/ 购票/ 网站/ 的/ 流量/ 特征/ ,/ 即/ 短时/ 聚集/ 性/ ./ 对/ 12306/ 购票/ 网站/ 的/ 流量/ 进行/ 分析/ ,/ 发现/ 其/ 在/ 变化/ 的/ 过程/ 中/ 有着/ 单位/ 时间/ 内/ ,/ 系统/ 中/ 总行/ 为数/ 变表/ 5/ 第/ 1/ 组/ 实验/ 数据/ TimeBtBft/ // StBrtTimeBtBft/ // StBrtTimeBtBft/ // StBrt13/ :/ 0091890527583913215/ :/ 0079435465263290917/ :/ 002325617892536413/ :/ 1088068495483852015/ :/ 1064561395252503617/ :/ 102530819044626413/ :/ 2090636477904284615/ :/ 2060954392362171817/ :/ 202507418888618613/ :/ 3089358485344082415/ :/ 3055943365241941917/ :/ 302527818492678613/ :/ 4091314469384437615/ :/ 4048672349921368017/ :/ 402512218108701413/ :/ 5089922483244159815/ :/ 5042018301141190417/ :/ 502525418984627014/ :/ 0097274484974877716/ :/ 003135023892745818/ :/ 002509218312678014/ :/ 1090288524823780616/ :/ 103244223280916218/ :/ 102531418456685814/ :/ 2094734501124462216/ :/ 203126021810945018/ :/ 202506218264679814/ :/ 3090990521883880216/ :/ 3032076215641051218/ :/ 302457018576591614/ :/ 4094356525364182016/ :/ 4031770209221084814/ :/ 5086543552583128516/ :/ 50357842329212492/ 一般/ 的/ ,/ 预期/ 系统/ 负载/ Cbt/ 比/ 系统/ 实际/ 负载/ Ct/ 小/ ,/ 但/ 当/ 系统/ 总/ 的/ 行为/ 数/ 变化/ 量/ 较大/ 时/ ,/ 预期/ 系统/ 负载/ Cbt/ 比/ 系统/ 实际/ 负载/ Ct/ 大/ ./ 例如/ ,/ 当/ Time/ =/ 14/ :/ 00/ 时/ ,/ Ct/ =/ Bt/ ×/ a/ =/ 97274/ ×/ 1/ =/ 97274/ ,/ Δ/ St/ =/ 48497/ -/ 48324/ =/ 173/ ,/ Δ/ Brt/ =/ 48777/ -/ 41598/ =/ 7179/ ,/ NTR/ =/ β/ 1/ Δ/ Brt/ // Δ/ t/ +/ β/ 2/ Δ/ St/ // Δ/ t/ ≈/ 1.02/ ,/ 化不大/ 、/ 总行/ 为数/ 变化/ 缓慢/ 以及/ 总行/ 为数/ 激增/ 的/ 3/ 种/ 不同/ 的/ 流量/ 特征/ ./ 根据/ 这/ 3/ 种/ 12306/ 购票/ 网站/ 的/ 流量/ 特征/ ,/ 分别/ 模拟/ 3/ 组/ 不同/ 的/ 用户/ 及/ 用户/ 行为/ 数据/ 进行/ 实验/ ./ 定义/ 负载/ 在/ [/ 0/ ,/ 60000/ )/ 区间/ 内/ 属于/ 良好/ 服务区/ ,/ [/ 60000/ ,/ 120000/ )/ 区间/ 内/ 属于/ 可用性/ 受损/ 区/ ,/ [/ 120000/ ,/ +/ )/ 属于/ 服务/ 不可/ 用区/ ./ 将/ 这/ 3/ 组/ 实验/ 数据/ 代入/ 系统/ 异常/ 行为/ 敏捷/ 感知/ 检测/ 算法/ ,/ 通过/ JavaScript/ 和/ Java/ 编写/ 模拟系统/ ,/ 利用/ 画图/ 插件/ Highcharts/ 表现/ 3/ 个/ 实验/ 效果图/ ./ 5.3/ 实验/ 结果/ 分析/ 第/ 1/ 组/ 实验/ 数据/ 见表/ 5/ ,/ 把表/ 5/ 的/ 数据/ 运用/ 到/ 感知/ 检测/ 算法/ 中/ ,/ 得到/ 效果/ 如图/ 9/ 所示/ ./ 从图/ 9/ 可以/ 看出/ ,/ 实际/ 负载/ 随着/ 时间/ 的/ 推移/ 变化/ 比较/ 平缓/ ,/ 相比之下/ 系统/ 预期/ 负载/ 的/ 变化趋势/ 比较/ 明显/ ,/ 且/ 系统/ 预期/ 负载/ 变化/ 量/ 比较/ 大/ 的/ 时刻/ (/ 结合/ 表/ 5/ 的/ 数据/ )/ 和/ 系统/ 总/ 的/ 行为/ 数/ 变化/ 量/ 较大/ 的/ 时刻/ 是/ 重合/ 的/ ./ Cbt/ =/ NTR/ ×/ Bft/ ×/ a/ ≈/ 1.02/ ×/ 48497/ ×/ 1/ 当/ Time/ =/ 14/ :/ 10/ 时/ ,/ Ct/ =/ Bt/ ×/ a/ =/ 90288/ ×/ 1/ =/ 90288/ ,/ Δ/ St/ =/ 52482/ -/ 48497/ =/ 3985/ ,/ Δ/ Brt/ =/ 48777/ -/ 37806/ =/ 10971/ ,/ ①/ 12306/ 流量/ 超/ 京东/ 商城/ ./ http/ :/ // // news/ ./ youth/ ./ cn/ // jsxw/ // 201301/ // Page11/ 图/ 9/ 第/ 1/ 组/ 实验/ 结果/ NTR/ =/ β/ 1/ Δ/ Brt/ // Δ/ t/ +/ β/ 2/ Δ/ St/ // Δ/ t/ ≈/ 1.92/ ,/ Cbt/ =/ NTR/ ×/ Bft/ ×/ a/ ≈/ 1.92/ ×/ 52482/ ×/ 1/ 总之/ ,/ 该组/ 数据/ 中/ 的/ 系统/ 用户量/ St/ 和/ 用户/ 重复/ 提交/ 的/ 行为/ 数/ Brt/ 的/ 变化/ 量/ 大都/ 趋于平稳/ ,/ 此时/ St/ 和/ Brt/ 的/ 变化/ 量/ 对系统/ 负载/ 的/ 影响/ 比较/ 小/ ,/ 导致系统/ 异表/ 6/ 第/ 2/ 组/ 实验/ 数据/ TimeBtBft/ // StBrtTimeBtBft/ // StBrtTimeBtBft/ // StBrt13/ :/ 001981210882893014/ :/ 4073741406293311216/ :/ 2048192307441744813/ :/ 102530819044626414/ :/ 5064474385432593116/ :/ 3037050257161133413/ :/ 2042018301141190415/ :/ 0052272318962037616/ :/ 4047340297121762813/ :/ 3049712373151239715/ :/ 1036570238921267816/ :/ 5032537204561208113/ :/ 4060060435121654815/ :/ 2037248251341211417/ :/ 002798418312967213/ :/ 5088068495483852015/ :/ 3036024241081191617/ :/ 102507418888618614/ :/ 0065922428162310615/ :/ 4043696281701552817/ :/ 202547618582689414/ :/ 1072936470522588415/ :/ 5050486309821950417/ :/ 302620819356685214/ :/ 2080184459873419716/ :/ 0055424363841904017/ :/ 402525418984627014/ :/ 3091384483454303916/ :/ 10707164207228644/ 图/ 10/ 第/ 2/ 组/ 实验/ 结果/ 常/ 感知/ 模型/ 中/ 的/ 放大/ 因子/ NTR/ 的/ 值/ 不会/ 变/ 大/ ,/ 根据/ 放大/ 因子/ 和/ 系统/ 预期/ 负载/ 的/ 关系/ 模型/ 可以/ 得到/ 放大/ 因子/ NTR/ 的/ 值/ 不会/ 使/ 系统/ 预期/ 负载/ Cbt/ 的/ 值/ 大于/ 系统/ 最大/ 承受/ 负载/ Cmax/ ,/ 即/ 系统/ 不会/ 发出/ 预警/ 信号/ ./ 第/ 2/ 组/ 实验/ 数据/ 见表/ 6/ ,/ 把表/ 6/ 的/ 数据/ 运用/ 到/ 感知/ 检测/ 算法/ 中/ ,/ 得到/ 效果/ 如图/ 10/ 所示/ ./ 从图/ 10/ 可/ Page12/ 以/ 看出/ ,/ 系统/ 实际/ 负载/ 随着/ 时间/ 的/ 推移/ 逐渐/ 上升/ ,/ 且/ 系统/ 预期/ 负载/ 随着/ 实际/ 负载/ 的/ 变化/ 量/ 增长/ 而/ 变大/ ./ 例如/ ,/ 当/ Time/ =/ 15/ :/ 40/ ,/ Ct/ =/ Bt/ ×/ a/ =/ 43696/ ×/ 1/ =/ 43696/ ,/ Δ/ St/ =/ 28170/ -/ 24108/ =/ 4062/ ,/ Δ/ Brt/ =/ 15526/ -/ 11916/ =/ 3610/ ,/ NTR/ =/ β/ 1/ Δ/ Brt/ // Δ/ t/ +/ β/ 2/ Δ/ St/ // Δ/ t/ ≈/ 1.08/ ,/ Cbt/ =/ NTR/ ×/ Bft/ ×/ a/ ≈/ 1.08/ ×/ 28170/ ×/ 1/ 当/ Time/ =/ 15/ :/ 50/ ,/ Ct/ =/ Bt/ ×/ a/ =/ 50486/ ×/ 1/ =/ 50486/ ,/ Δ/ St/ =/ 30982/ -/ 28170/ =/ 2812/ ,/ Δ/ Brt/ =/ 19504/ -/ 15526/ =/ 3978/ ,/ NTR/ =/ β/ 1/ Δ/ Brt/ // Δ/ t/ +/ β/ 2/ Δ/ St/ // Δ/ t/ ≈/ 0.91/ ,/ Cbt/ =/ NTR/ ×/ Bft/ ×/ a/ ≈/ 0.91/ ×/ 30982/ ×/ 1/ 当/ Time/ =/ 16/ :/ 00/ 时/ ,/ Ct/ =/ Bt/ ×/ a/ =/ 55424/ ×/ 1/ =/ 55424/ ,/ Δ/ St/ =/ 36384/ -/ 30982/ =/ 5402/ ,/ 表/ 7/ 第/ 3/ 组/ 实验/ 数据/ TimeBtBft/ // StBrtTimeBtBft/ // StBrtTimeBtBft/ // StBrt13/ :/ 0045062282641679815/ :/ 1064702325363216617/ :/ 20139572798295974313/ :/ 1044570285761599415/ :/ 2086837445794225817/ :/ 30122156688625329413/ :/ 2044006280901591615/ :/ 30105946540425190417/ :/ 40115406554785992813/ :/ 3043256279221533415/ :/ 40107248501345711417/ :/ 50106762521105465213/ :/ 4062325362932603215/ :/ 5096024441085191618/ :/ 0095856525844327213/ :/ 5085898485363736216/ :/ 0077698451703252818/ :/ 1088692507903790214/ :/ 0070042405122953016/ :/ 1067524393842814018/ :/ 2083526480963543014/ :/ 1059204302942891016/ :/ 2050924319221900218/ :/ 3077176433523382414/ :/ 2042858284221443616/ :/ 3074188403823380618/ :/ 4065182418762330614/ :/ 3034590238921069816/ :/ 4096528510544547418/ :/ 5050136387471138914/ :/ 4036084229741311016/ :/ 50105670552565041419/ :/ 0048390358741251614/ :/ 5028752174481130417/ :/ 00126732601086662419/ :/ 1046105329971310815/ :/ 0057413292572815617/ :/ 10130342641376620519/ :/ 20423792979412585/ 图/ 11/ 第/ 3/ 组/ 实验/ 结果/ Δ/ Brt/ =/ 19504/ -/ 19040/ =/ 464/ ,/ NTR/ =/ β/ 1/ Δ/ Brt/ // Δ/ t/ +/ β/ 2/ Δ/ St/ // Δ/ t/ ≈/ 1.03/ ,/ Cbt/ =/ NTR/ ×/ Bft/ ×/ a/ ≈/ 1.03/ ×/ 36384/ ×/ 1/ 当/ Time/ =/ 16/ :/ 10/ 时/ ,/ Ct/ =/ Bt/ ×/ a/ =/ 70716/ ×/ 1/ =/ 70716/ ,/ Δ/ St/ =/ 42072/ -/ 36384/ =/ 5688/ ,/ Δ/ Brt/ =/ 28644/ -/ 19040/ =/ 9604/ ,/ NTR/ =/ β/ 1/ Δ/ Brt/ // Δ/ t/ +/ β/ 2/ Δ/ St/ // Δ/ t/ ≈/ 2.02/ ,/ Cbt/ =/ NTR/ ×/ Bft/ ×/ a/ ≈/ 2.02/ ×/ 42072/ ×/ 1/ 总之/ ,/ 该组/ 数据/ 中/ 系统/ 用户量/ St/ 和/ 用户/ 重复/ 提交/ 的/ 行为/ 数/ Brt/ 缓慢/ 变化/ ./ 随着/ St/ 和/ Brt/ 的/ 缓慢/ 增加/ ,/ 感知/ 模型/ 中/ 放大/ 因子/ NTR/ 也/ 随之/ 缓慢/ 增大/ ,/ 此时/ 系统/ 有/ 发生/ 异常/ 的/ 可能性/ ./ 当/ 预期/ 系统/ 负载/ 值/ Cbt/ 超过/ 系统/ 实际/ 负载/ Ct/ 并/ 先/ 到达/ 系统/ 所/ 能/ 承受/ 的/ 最大/ 负载/ Cmax/ ,/ 系统/ 发出/ 预警/ 信号/ ./ 第/ 3/ 组/ 实验/ 数据/ 见表/ 7/ ,/ 把表/ 7/ 的/ 数据/ 运用/ 到/ 感知/ 检测/ 算法/ 中/ ,/ 得到/ 效果/ 如图/ 11/ 所示/ ./ 从图/ 11/ 可/ Page13/ 以/ 看出/ ,/ 系统/ 实际/ 负载/ 随着/ 时间/ 的/ 推移/ 瞬间/ 上升/ ,/ 且/ 系统/ 预期/ 负载/ 也/ 随着/ 实际/ 负载/ 的/ 变化/ 快速/ 增大/ ./ 例如/ ,/ 当/ Time/ =/ 13/ :/ 30/ 时/ ,/ Ct/ =/ Bt/ ×/ a/ =/ 43256/ ×/ 1/ =/ 43256/ ,/ Δ/ St/ =/ 28090/ -/ 27922/ =/ 168/ ,/ Δ/ Brt/ =/ 15916/ -/ 15334/ =/ 582/ ,/ NTR/ =/ β/ 1/ Δ/ Brt/ // Δ/ t/ +/ β/ 2/ Δ/ St/ // Δ/ t/ ≈/ 0.10/ ,/ Cbt/ =/ NTR/ ×/ Bft/ ×/ a/ ≈/ 0.10/ ×/ 27922/ ×/ 1/ 当/ Time/ =/ 13/ :/ 40/ ,/ Ct/ =/ Bt/ ×/ a/ =/ 62325/ ×/ 1/ =/ 62325/ ,/ Δ/ St/ =/ 36293/ -/ 27922/ =/ 8371/ ,/ Δ/ Brt/ =/ 26032/ -/ 15334/ =/ 10698/ ,/ NTR/ =/ β/ 1/ Δ/ Brt/ // Δ/ t/ +/ β/ 2/ Δ/ St/ // Δ/ t/ ≈/ 2.60/ ,/ Cbt/ =/ NTR/ ×/ Bft/ ×/ a/ ≈/ 2.60/ ×/ 36293/ ×/ 1/ 当/ Time/ =/ 13/ :/ 50/ ,/ Ct/ =/ Bt/ ×/ a/ =/ 85898/ ×/ 1/ =/ 85898/ ,/ Δ/ St/ =/ 48536/ -/ 36293/ =/ 12243/ ,/ Δ/ Brt/ =/ 37362/ -/ 26032/ =/ 11330/ ,/ NTR/ =/ β/ 1/ Δ/ Brt/ // Δ/ t/ +/ β/ 2/ Δ/ St/ // Δ/ t/ ≈/ 3.29/ ,/ Cbt/ =/ NTR/ ×/ Bft/ ×/ a/ ≈/ 3.29/ ×/ 48536/ ×/ 1/ 总之/ ,/ 该组/ 数据/ 中/ 系统/ 用户量/ St/ 和/ 用户/ 重复/ 提交/ 的/ 行为/ 数/ Brt/ 短时/ 聚集/ ,/ 此时/ 放大/ 因子/ NTR/ 迅速/ 增大/ ,/ 且/ 预期/ 系统/ 负载/ 值/ Cbt/ 也/ 快速/ 超过/ 系统/ 实际/ 负载/ Ct/ 先/ 到达/ 系统/ 所/ 能/ 承受/ 的/ 最大/ 负载/ Cmax/ ,/ 系统/ 发出/ 预警/ 信号/ ./ 通过/ 这/ 3/ 组/ 实验/ 的/ 效果图/ 可以/ 看出/ ,/ 如果/ 系统/ 会/ 发生/ 异常/ ,/ 预期/ 负载/ 值/ 总是/ 先于/ 系统/ 实际/ 负载/ 值/ 到达/ 系统/ 所/ 能/ 承受/ 的/ 最大/ 负载/ 值/ ,/ 并/ 进入/ 系统/ 的/ 服务/ 受损/ 区/ 或/ 不可/ 用区/ ./ 该/ 实验/ 表明/ ,/ 感知/ 检测/ 算法/ 可以/ 把/ 系统/ 实际/ 负载/ 微小/ 的/ 变化/ 通过/ 放大/ 因子/ 观察/ 预期/ 负载/ 变化/ ,/ 可以/ 有效/ 预警系统/ 可能/ 发生/ 的/ 异常/ ./ 同时/ 表明/ ,/ 若/ 系统/ 因/ 行为/ 数/ 的/ 较大/ 变化/ 而/ 发生/ 异常/ ,/ 该/ 算法/ 一定/ 可以/ 提前/ 快速/ 感知/ ./ 6/ 相关/ 讨论/ 通过/ 环境/ 上下文/ 获取/ 和/ 处理软件/ 的/ 环境/ 信息/ [/ 7/ -/ 15/ ]/ ,/ 这种/ 方法/ 可能/ 会/ 导致/ 出现/ 新/ 的/ 上下文/ ,/ 软件/ 就/ 需/ 停止/ 运行/ ,/ 需要/ 较大/ 的/ 系统/ 代价/ ;/ 对于/ Web/ 用户/ 访问/ 行为/ 的/ 这些/ 感知/ 异常/ 行为/ 的/ 方法/ [/ 16/ -/ 17/ ]/ ,/ 主要/ 是/ 针对/ 各种/ 异常/ 行为/ 施加/ 到/ 系统/ 上/ ,/ 没有/ 考虑/ 用户/ 合法/ 行为/ 对系统/ 造成/ 的/ 影响/ ;/ 基于/ 流量/ 来/ 检测/ 系统/ 异常/ [/ 18/ -/ 20/ ]/ ,/ 只是/ 从/ 表征/ 出发/ ,/ 没有/ 实际/ 考虑/ 系统/ 负载/ 问题/ ;/ 而/ 软件系统/ 的/ 故障/ 检测/ [/ 21/ -/ 26/ ]/ 基本上/ 都/ 是/ 基于/ 数据挖掘/ 的/ 角度/ 提出/ 的/ 检测/ 方法/ ,/ 用/ 采集/ 的/ 数据/ 来/ 分析/ 系统/ 是否/ 发生/ 异常/ ,/ 计算/ 量/ 较大/ ,/ 缺乏/ 实时性/ ./ 由于/ 大规模/ 网络服务/ 系统/ 的/ 开放性/ 特征/ ,/ 使得/ 不可/ 预见/ 的/ 用户/ 的/ 需求/ 及其/ 行为/ 对系统/ 的/ 可控性/ 提出/ 了/ 更/ 高/ 的/ 要求/ ./ 而/ 系统/ 的/ 实时/ 可控/ 是/ 以/ 实时/ 可/ 预测/ 系统/ 异常/ 为/ 前提/ 的/ ./ 针对/ 施加/ 于/ 系统/ 的/ 非法行为/ ,/ 现有/ 的/ 感知/ 和/ 检测/ 方法/ 取得/ 了/ 积极/ 效果/ ;/ 但是/ 对于/ 施加/ 于/ 系统/ 的/ 群体/ 合法/ 行为/ (/ 大规模/ 用户/ 短时/ 聚集/ 并/ 施加/ 于/ 系统/ 的/ 行为/ ,/ 每个/ 用户/ 的/ 行为/ 都/ 是/ 系统/ 允许/ 的/ )/ 而/ 造成/ 系统/ 异常/ 的/ 情况/ ,/ 目前/ 未见/ 有/ 实时/ 感知/ 技术/ 的/ 研究/ ./ 在/ 大规模/ 网络服务/ 系统/ 中/ ,/ 对于/ 群体/ 合法/ 行为/ 的/ 短时/ 聚集/ 而/ 引起/ 系统/ 的/ 异常/ ,/ 本文/ 的/ 敏捷/ 感知/ 方法/ 能以/ 系统/ 负载/ 的/ 细微/ 变化/ 而/ 快速/ 预测/ 系统/ 是否/ 可能/ 发生/ 异常/ ./ 即/ 系统/ 若/ 发生/ 异常/ ,/ 本文/ 的/ 方法/ 一定/ 能/ 提前/ 检测/ 到/ ./ 这点/ 由/ 第/ 3/ 节/ 的/ 定理/ 所/ 保证/ ./ 在/ 实际/ 系统/ 中/ ,/ 本文/ 第/ 4/ 节/ 给出/ 了/ 一种/ 系统/ 异常/ 检测/ 实现/ 技术/ ,/ 其/ 包括/ 对/ 实际/ 系统/ 的/ 关键/ 行为/ 上/ 施加/ 相应/ 的/ 检测/ 控制/ ./ 这种/ 控制/ 通过/ 实时/ 监测/ 系统/ 的/ 行为/ 数/ ,/ 应用/ 感知/ 模型/ 计算/ 实际/ 负载/ 和/ 预期/ 负载/ ./ 当/ 预期/ 负载/ 大于/ 实际/ 负载/ 时/ ,/ 系统/ 可能/ 发生/ 异常/ ;/ 此时/ ,/ 通过/ 计算/ 出/ 行为/ 阻滞/ 度来/ 定位/ 可能/ 发生/ 异常/ 的/ 系统/ 行为/ ./ 第/ 5/ 节/ 的/ 实验/ 表明/ 当/ 预期/ 负载/ 大于/ 实际/ 负载/ 时/ ,/ 系统/ 会/ 发出/ 异常/ 预警/ ./ 7/ 结论/ 本文/ 针对/ 大规模/ 网络服务/ 系统/ 环境/ 中/ 用户/ 合法/ 行为/ 数/ 增长/ 而/ 使/ 系统/ 发生/ 异常/ 问题/ ,/ 提出/ 了/ 一种/ 系统/ 异常/ 敏捷/ 感知/ 模型/ 和/ 基于/ 带/ 优先/ 关系/ 的/ 颜色/ 双/ 变迁/ Petri/ 网/ 的/ 重复/ 行为/ 数/ 检测/ 模型/ 及/ 算法/ ./ 异常/ 敏捷/ 感知/ 模型/ 是/ 通过/ 行为/ 与/ 行为/ 之间/ 的/ 影响/ 因素/ ,/ 把/ 当前/ 的/ 系统/ 负载/ 在/ “/ 放大/ 因子/ ”/ 的/ 作用/ 下/ 放大/ 来看/ ,/ 在/ 系统/ 发生/ 异常/ 之前/ ,/ 敏捷/ 感知/ 系统/ 是否/ 会/ 发生/ 异常/ ./ 异常/ 敏捷/ 感知/ 模型/ 为/ 实际/ 系统/ 异常/ 发生/ 是否/ 能/ 提前/ 敏捷/ 感知/ 的/ 依据/ ./ 在/ 实际/ 系统/ 中/ 可以/ 应用/ 基于/ 带/ 优先/ 关系/ 的/ 颜色/ 双/ 变迁/ Petri/ 网/ 的/ 重复/ 行为/ 数/ 检测/ 模型/ 及/ 算法/ 检测/ 系统/ 的/ 潜在/ 异常/ 发生/ 的/ 可能性/ ,/ 其/ 关键/ 是/ 在/ 实际/ 系统/ 的/ 关键/ 行为/ 节点/ 上/ 增加/ 相应/ 的/ 行为/ 控制/ 部分/ (/ 图/ 6/ 所示/ )/ ,/ 并/ 运用/ 感知/ 模型/ 进行/ 计算/ 预期/ 负载/ 是否/ 大于/ 系统/ 最大/ 负载/ ./ 下/ 一步/ 我们/ 将/ Page14/ 在/ 感知/ 到/ 导致系统/ 发生/ 异常/ 行为/ 后/ 如何/ 进行/ 系统/ 服务/ 流程/ 重构/ 进行/ 研究/ 和/ 讨论/ ./ 

