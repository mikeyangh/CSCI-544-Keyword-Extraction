Page1X10/ 程序/ 的/ 差别/ 分析方法/ 陈雨亭/ 1/ )/ ,/ 3/ )/ 杨威/ 1/ )/ 赵建军/ 1/ )/ ,/ 2/ )/ ,/ 3/ )/ 1/ )/ (/ 上海交通大学/ 软件/ 学院/ 上海/ 200240/ )/ 2/ )/ (/ 中国科学院/ 软件/ 研究所/ 计算机科学/ 重点/ 实验室/ 北京/ 100190/ )/ 3/ )/ (/ 上海市/ 计算机软件/ 评测/ 重点/ 实验室/ 上海/ 201112/ )/ 摘要/ 程序/ 差别/ 分析/ 是/ 程序调试/ 的/ 常见/ 手段/ ,/ 其/ 主要/ 用于/ 分析程序/ 不同/ 版本/ 之间/ 的/ 差异/ 信息/ ./ 然而/ ,/ 将/ 现有/ 程序/ 差别/ 分析/ 算法/ 扩展/ 到/ 并行程序/ 语言/ 还/ 面临/ 众多/ 挑战/ ./ 其/ 主要/ 原因/ 在于/ 并行程序/ 复杂性/ 较/ 高/ ,/ 且/ 存在/ 支持/ 并行/ 活动/ 的/ 特殊/ 机制/ ,/ 如/ 地址/ (/ 或/ 线程/ )/ 、/ 活动/ 、/ 同步/ 等/ ,/ 从而/ 为/ 有效/ 进行/ 程序/ 差别/ 分析/ 设置/ 了/ 障碍/ ./ 文中/ 研究/ 基于/ PGAS/ 模型/ 的/ X10/ 并行程序/ 的/ 程序/ 差别/ 分析方法/ ,/ 并/ 设计/ 了/ 一种/ 语句/ 级/ 的/ 、/ 针对/ X10/ 程序/ 的/ 程序/ 差别/ 分析/ 算法/ X10Diff/ ./ X10Diff/ 包括/ 下列/ 步骤/ :/ (/ 1/ )/ 匹配/ 原程序/ 和/ 修改/ 后/ 程序/ 中/ 的/ 类/ 、/ 接口/ 、/ 方法/ 及/ 地址/ ;/ (/ 2/ )/ 为/ 待/ 分析程序/ 片段/ 构建/ 基于/ 地址/ 的/ 程序/ 流图/ ,/ 并/ 建立/ 相应/ 简化/ 图/ ;/ (/ 3/ )/ 迭代/ 扩展/ 并/ 比较/ 简化/ 图/ ,/ 并/ 将/ 差别/ 信息/ 定位/ 到/ 代码/ 中/ ./ 关键词/ 程序/ 差别/ 分析/ ;/ X10/ ;/ 程序/ 流图/ ;/ 软件测试/ ;/ 程序调试/ 1/ 引言/ 要/ 的/ 程序调试/ 技术/ [/ 1/ ]/ ,/ 主要/ 用于/ 分析/ 不同/ 程序/ 或/ 程序/ 不同/ 版本/ 之间/ 的/ 差异/ 信息/ ,/ 如/ 程序修改/ 位置/ 、/ 程序/ 相对/ 于原/ 版本/ 所/ 做出/ 的/ 修改/ 类别/ (/ 增加/ 、/ 删除/ 、/ 修改/ )/ 等/ ./ 程序/ 差别/ 分析/ (/ ProgramDifferencing/ )/ 是/ 一种/ 重/ 本文/ 研究/ X10/ 并行程序/ 的/ 差别/ 分析方法/ ./ X10Page2/ 是/ IBM/ 为/ 并行/ 编程/ 开发/ 的/ 语言/ ①/ ,/ 采用/ 分布式/ 全局/ 地址/ 空间/ (/ PartitionedGlobalAddressSpace/ ,/ PGAS/ )/ 模型/ ./ 目前/ ,/ 存在/ 针对/ C/ 、/ Java/ 等/ 语言/ 的/ 程序/ 差别/ 分析/ 算法/ ,/ 但/ 几乎/ 没有/ 针对/ 并行程序/ 语言/ (/ 包括/ X10/ )/ 的/ 程序/ 差别/ 分析/ 算法/ ./ 一方面/ ,/ 程序/ 差别/ 分析/ 算法/ 是/ 语言/ 相关/ 的/ ,/ 不易/ 在/ 不同/ 程序/ 范型/ (/ 面向/ 过程/ 、/ 面向对象/ 、/ 并行/ 等/ )/ 之间/ 实现/ 算法/ 迁移/ ./ 例如/ BMAT/ [/ 2/ ]/ 不能/ 识别/ 与/ 面向对象/ 特性/ (/ 如/ 异常/ 、/ 继承/ 结构/ )/ 相关/ 的/ 程序/ 差别/ 信息/ ;/ Semanticdiff/ [/ 3/ ]/ 及/ Horwitz/ 的/ 技术/ [/ 4/ ]/ 用于/ 分析/ 面向/ 过程/ 的/ 程序/ ,/ 不能/ 用于/ 分析/ 面向对象/ 程序/ 中/ 的/ 差别/ 信息/ 等/ ./ 另一方面/ ,/ 现有/ 程序/ 差别/ 分析/ 算法/ 难以/ 扩展/ 至/ X10/ 等/ 并行程序/ 语言/ 中/ ,/ 主要/ 原因/ 在于/ 并行程序/ 复杂性/ 较/ 高/ ,/ 多线程/ 编程/ 方式/ 及/ 同步/ 、/ 异步/ 并行/ 机制/ 对/ 差别/ 分析/ 造成/ 困难/ ,/ 具体/ 包括/ :/ (/ 1/ )/ 对/ X10/ 程序/ 的/ 差别/ 分析/ 不仅/ 需要/ 涵盖/ 与/ 类/ 、/ 方法/ 、/ 语句/ 等/ 程序/ 语法/ 或/ 结构/ 相关/ 的/ 差别/ ,/ 也/ 需要/ 考虑/ 程序/ 活动/ (/ Activity/ )/ 与/ 地址/ (/ Place/ )/ 的/ 差别/ ./ 其中/ ,/ 活动/ 可/ 被/ 看成/ 是/ 轻量级/ 线程/ ,/ 地址/ 用于/ 存储/ 数据/ 及/ 提供/ 活动/ 范围/ ,/ 待/ 分析程序/ 之间/ 活动/ 或/ 地址/ 存在/ 差别/ 也/ 意味着/ 程序/ 语义上/ 存在/ 差异/ ./ 例如/ ,/ 程序员/ 通过/ 重构/ 技术/ 将/ 单个/ 逻辑/ 地址/ 上/ 的/ 活动/ 拆/ 分为/ 多个/ 逻辑/ 地址/ 上/ 的/ 并行/ 活动/ ,/ 对/ 重构/ 前后/ 程序/ 之间/ 进行/ 基于/ 语法/ 树/ 的/ 差别/ 分析/ 不能/ 得出/ 程序/ 从/ 顺序/ 向/ 并行/ 、/ 分布式/ 执行/ 方式/ 的/ 转变/ ./ 我们/ 需要/ 考虑/ X10/ 程序/ 中/ 与/ 并行/ 相关/ 的/ 活动/ 及/ 地址/ 信息/ ,/ 进行/ 基于/ 语义/ 的/ 程序/ 差别/ 分析/ ./ (/ 2/ )/ 基于/ 语义/ 的/ 程序/ 差别/ 分析/ 通常/ 依赖于/ 程序/ 流图/ 的/ 匹配/ ./ 这里/ 的/ 难点/ 包括/ 为/ X10/ 程序/ 建立/ 支持/ 并行/ 活动/ 的/ 程序/ 流图/ 、/ 判断/ 两个/ 程序/ 流图/ 是否/ 存在/ 同构/ 关系/ 、/ 及/ 对/ 同构/ 流图/ 实现/ 匹配/ 与/ 比较/ 等/ ./ 本文/ 设计/ 了/ 一种/ 针对/ X10/ 并行程序/ 的/ 程序/ 差别/ 算法/ X10Diff/ ,/ 用于/ 实现/ 两个/ X10/ 程序/ (/ 或/ 程序/ 版本/ )/ 语句/ 级/ 差别/ 分析/ ./ X10Diff/ 包含/ 下列/ 步骤/ :/ (/ 1/ )/ 匹配/ 两个/ 程序/ 的/ 地址/ 、/ 类/ 、/ 接口/ 及/ 方法/ ;/ (/ 2/ )/ 为/ 待/ 分析程序/ 构建/ 扩展/ 程序/ 流图/ ,/ 并/ 将/ 其/ 简化/ 为/ 简化/ 图/ ./ 这里/ 采用/ 基于/ 分布式/ 地址/ 的/ 程序控制/ 流图/ ,/ 以/ 描述/ X10/ 中/ 的/ 并行/ 机制/ ;/ (/ 3/ )/ 迭代/ 扩展/ 、/ 比较/ 简化/ 图/ ,/ 将/ 差别/ 定位/ 至/ 代码/ 中/ ./ 本文/ 设计/ 的/ 程序/ 差别/ 算法/ 对/ X10/ 程序/ 的/ 维护/ 、/ 测试/ 等/ 具有/ 意义/ ./ 在/ 程序/ 维护/ 过程/ 中/ ,/ 程序/ 变更/ 可能/ 导致/ 程序/ 多个/ 方面/ 受到/ 影响/ ,/ 可以/ 对/ 程序/ 进行/ 变化/ 影响/ 分析/ 以/ 确保/ 程序/ 的/ 正确性/ ./ 在/ 该/ 过程/ 中/ ,/ 程序/ 差别/ 分析/ 定位/ X10/ 程序/ 改变/ 的/ 具体位置/ ,/ 而/ 影响/ 分析/ 进一步/ 分析程序/ 哪些/ 部分/ 会/ 受到/ 改变/ 的/ 影响/ ./ 关于/ 回归/ 测试用例/ 选择/ 的/ 研究/ 中/ ,/ 程序/ 差别/ 信息/ 可以/ 帮助/ 测试人员/ 评估/ X10/ 程序修改/ 轮廓/ 信息/ [/ 2/ ]/ ,/ 决定/ 哪些/ 测试用例/ 需要/ 在/ 修改/ 后/ 的/ 程序/ 版本/ 上/ 重新/ 测试运行/ ,/ 以/ 减少/ 测试/ 的/ 代价/ ./ 本文/ 主要/ 贡献/ 和/ 创新/ 点/ 包括/ 两/ 方面/ ./ 首先/ ,/ 大多数/ 程序/ 差别/ 分析/ 技术/ 是/ 针对/ 顺序程序/ 或者/ 面向对象/ 程序/ 而言/ 的/ ,/ 而/ 本文/ 将/ 差别/ 分析/ 技术/ 扩展/ 至/ 并行程序/ 分析/ 中/ ./ 其次/ ,/ 现有/ 程序/ 差别/ 分析/ 技术/ 主要/ 针对/ 于/ 程序/ 文本/ 或/ 语法结构/ ,/ 而/ X10Diff/ 是/ 一种/ 基于/ 语义/ 的/ 程序/ 差别/ 分析/ 技术/ :/ 对/ X10/ 程序/ 进行/ 基于/ 语义/ 的/ 差别/ 分析/ 有助于/ 辨识/ 程序/ 的/ 全局/ 行为/ 差异/ 及/ 各/ 逻辑/ 地址/ 上/ 的/ 活动/ 差异/ ./ 2X10/ 语言/ X10/ 是/ IBM/ 为/ 在/ 分布式系统/ 上/ 通过/ 共享内存/ 而/ 进行/ 并行计算/ 所/ 设计/ 的/ 编程语言/ ,/ 其/ 采用/ 分布式/ 全局/ 地址/ 空间/ PGAS/ 模型/ ./ PGAS/ 是/ 并行/ 编程/ 模型/ ,/ 其/ 假设/ 一个/ 全局/ 地址/ 空间/ 是/ 逻辑/ 分布/ 的/ ,/ 每/ 一个/ 逻辑/ 地址/ 对应/ 一个/ 本地/ 处理器/ ./ X10/ 利用/ 了/ 活动/ 和/ 派生/ 的/ 概念/ 来/ 描述/ 并行执行/ 的/ 软件/ 行为/ ./ 在/ X10/ 中/ ,/ 一个/ 计算/ 被/ 拆/ 分为/ 若干/ 活动/ (/ Activity/ )/ 到/ 多个/ 地址/ (/ Place/ )/ 中/ 并行/ 完成/ ;/ 一个/ 活动/ 可以/ 在/ 本地/ 或者/ 远程/ 派/ 生出/ 多个/ 子/ 活动/ ,/ 子/ 活动/ 也/ 可以/ 派/ 生出/ 更/ 多子/ 活动/ ./ async/ (/ place/ )/ S/ 语句/ 表明/ 在/ 地址/ place/ 中/ 创建/ 一个/ 异步/ 活动/ ,/ S/ 为/ 活动/ 中/ 执行/ 的/ 语句/ ./ 一个/ 活动/ 在/ 其/ 生命周期/ 中/ ,/ 仅能/ 在/ 一个/ 地址/ 中/ 被/ 执行/ ,/ 且/ 仅/ 能/ 直接/ 访问/ 在/ 同一/ 地址/ 中/ 的/ 数据/ ,/ 对/ 远程/ 数据/ (/ 即/ 不/ 在/ 同一/ 地址/ 中/ 的/ 数据/ )/ 的/ 访问/ 只能/ 通过/ 在/ 远程/ 地址/ 中/ 派生/ 新/ 活动/ 实现/ ./ 图/ 1/ 中/ QSort2/ 显示/ 了/ 一个/ 描述/ 快速/ 排序/ 算法/ 的/ X10/ 程序/ 片段/ :/ 第/ 25/ 行/ 的/ partition/ 函数/ 将/ 待/ 排序/ 的/ 数组/ data/ 分割/ 成/ 独立/ 的/ 两/ 部分/ ,/ 从/ 索引/ left/ 到/ index/ 的/ 数据/ 比/ 从/ index/ 到/ right/ 的/ 所有/ 数据/ 都/ 要/ 小/ ;/ 第/ 27/ ~/ 28/ 行对/ 从/ left/ 到/ index/ 的/ 数据/ 进行/ 快速/ 排序/ ;/ 第/ 30/ ~/ 31/ 行对/ 从/ index/ 到/ right/ 的/ 数据/ 进行/ 快速/ 排序/ ./ QSort2/ 是/ 一个/ 并行算法/ ./ 假设/ 当前/ 活动/ 为/ A1/ ,/ 活动/ 地址/ 为/ place1/ ./ A1/ 在/ 第/ 28/ 行/ 派生/ 一个/ 异步/ 活动/ (/ 假设/ 活动/ 名为/ A2/ ,/ 地址/ 为/ place2/ )/ ./ A2/ 和/ A1/ 分别/ 对/ 索引/ index/ 前后/ 的/ 数据/ 快速/ 排序/ ./ 第/ 26/ 行/ 关键字/ finish/ 指明/ 活动/ A1/ 和/ A2/ 完成/ 后/ 排序/ 任务/ 结束/ ./ ①/ http/ :/ // // x10/ -/ lang/ ./ org/ // Page324/ ./ staticdefqsort/ (/ data/ :/ Rail/ [/ int/ ]/ ,/ left/ :/ int/ ,/ right/ :/ int/ )/ {/ 25/ ./ index/ :/ int/ =/ partition/ (/ data/ ,/ left/ ,/ right/ )/ ;/ 26.27/ ./ if/ (/ left/ </ index/ -/ 1/ )/ 28/ ./ qsort/ (/ data/ ,/ left/ ,/ index/ -/ 1/ )/ ;/ 29/ ./ if/ (/ index/ </ right/ )/ 30/ ./ qsort/ (/ data/ ,/ index/ ,/ right/ )/ ;/ 31/ ./ }/ 24/ ./ staticdefqsort/ (/ data/ :/ Rail/ [/ int/ ]/ ,/ left/ :/ int/ ,/ right/ :/ int/ )/ {/ 25/ ./ index/ :/ int/ =/ partition/ (/ data/ ,/ left/ ,/ right/ )/ ;/ 26/ ./ finish/ {/ 27/ ./ if/ (/ left/ </ index/ -/ 1/ )/ 28/ ./ asyncqsort/ (/ data/ ,/ left/ ,/ index/ -/ 1/ )/ ;/ 29.30/ ./ if/ (/ index/ </ right/ )/ 31/ ./ qsort/ (/ data/ ,/ index/ ,/ right/ )/ ;/ 32/ ./ }/ 33/ ./ }/ 图/ 1/ 排序/ 算法/ QSort1/ 与其/ 并行/ 版本/ QSort23/ 程序/ 差别/ 例子/ 本/ 节/ 首先/ 采用/ 一个/ 简单/ 例子/ 说明/ X10/ 程序/ 间/ 的/ 差别/ ./ 图/ 2/ 中/ ,/ 程序/ APPTest2/ 的/ foo/ 方法/ 是/ 程序/ APPTest1/ 的/ foo/ 方法/ 经过/ 重写/ (/ 修改/ 语句/ 、/ 插入/ 语句/ 或者/ 删除/ 语句/ )/ 所得/ ./ 可以/ 得到/ APPTest1/ 和/ APPTest2/ 中/ 节点/ 对应/ 关系/ 及/ 差别/ 信息/ ,/ 如表/ 1/ 所示/ ./ 这里/ ,/ G1/ 、/ G2/ 分别/ 为/ 目标程序/ (/ 如/ APPTest1/ 与/ APPTest2/ )/ 的/ 程序/ 流图/ (/ 见/ 本文/ 第/ 4/ 节/ )/ ;/ 节点/ 号/ 对应/ 程序/ 语句/ 行号/ ;/ APPTest1/ 与/ APPTest2/ 存在/ 三处/ 差别/ ,/ 含/ 两处/ 语句/ 修改/ 和/ 一处/ 语句/ 插入/ ./ 图/ 2/ 具有/ 差别/ 的/ 程序/ APPTest1/ ,/ APPTest2/ 无差别/ 节点/ 及/ 差别/ ①/ (/ 修改/ 节点/ )/ G1/ 节点/ (/ 2/ )/ 修改/ 至/ G2/ 节点/ (/ 3/ )/ 差别/ ②/ (/ 修改/ 节点/ )/ G1/ 节点/ (/ 6/ ,/ 7/ )/ 修改/ 至/ G2/ 节点/ (/ 7/ )/ 差别/ ③/ (/ 插入/ 节点/ )/ G1/ 节点/ (/ 无/ )/ 修改/ 至/ G2/ 节点/ (/ 1/ )/ 图/ 2/ 介绍/ 了/ 一个/ 简单/ 的/ X10/ 程序/ 差别/ 的/ 例子/ ,/ 并未/ 涉及/ 地址/ 及/ 活动/ 等/ 更为/ 复杂/ 的/ 情况/ ./ 这里/ 回顾/ 图/ 1/ 的/ 例子/ 以/ 说明/ 与/ 语义/ 相关/ 的/ 程序/ 差别/ ./ 图/ 1/ 中/ 提供/ 了/ 两个/ 快速/ 排序/ 的/ 代码/ 片段/ :/ QSort1/ 与/ QSort2/ 的/ 差别/ 不仅/ 在于/ 后者/ 使用/ 了/ async/ 和/ finish/ 关键字/ ,/ 更/ 在于/ QSort2/ 通过/ 两个/ 并行/ 活动/ 完成/ 快速/ 排序/ ./ 表/ 2/ 显示/ 了/ QSort1/ 与/ QSort2/ 的/ 差别/ 信息/ ,/ 既/ 包括/ 两段/ 程序/ 语句/ 之间/ 的/ 对应/ 关系/ ,/ 也/ 包括/ 与/ 活动/ 相关/ 的/ 三处/ 差别/ ,/ 包括/ 一处/ 活动/ 缩减/ ,/ 一处/ 活动/ 新建/ 及/ 一处/ 活动/ 同步/ 关系/ 的/ 建立/ ./ 无差别/ 节点/ 及/ 差别/ ①/ (/ 缩减/ 活动/ )/ G1/ 节点/ (/ 27/ ,/ 28/ ,/ 29/ ,/ 30/ )/ 修改/ 至/ 差别/ ②/ (/ 新建/ 活动/ )/ G1/ 节点/ (/ 无/ )/ 修改/ 至/ G2/ 节点/ (/ 27/ ,/ 28/ )/ 差别/ ③/ (/ 新建/ 同步/ )/ G1/ 节点/ (/ 无/ )/ 修改/ 至/ G2/ 节点/ (/ 26/ )/ 4X10/ 程序/ 程序/ 流图/ 的/ 同构/ 关系/ 本文/ 设计/ 一种/ 基于/ 程序/ 流图/ 的/ 、/ 针对/ X10/ 程序/ 的/ 程序/ 差别/ 方法/ X10Diff/ ./ 传统/ 上/ ,/ 一个/ 程序/ 流图/ G/ 可定义/ 为/ 一个/ 四元组/ (/ N/ ,/ E/ ,/ START/ ,/ END/ )/ ,/ 其中/ :/ N/ 是/ 节点/ 集合/ ;/ E/ 是/ 有/ 向/ 边/ 集合/ ;/ START/ 和/ END/ 是/ 程序/ 流图/ 唯一/ 的/ 入口/ 点/ 和/ 唯一/ 的/ 出口/ 点/ ,/ 且/ START/ ∈/ N/ ,/ END/ ∈/ N/ ./ 此外/ ,/ 程序/ 流图/ 中/ ,/ 如果/ 一个/ 节点/ 有/ 多个/ 后继/ 节点/ ,/ 其为/ 决策/ 节点/ (/ 例如/ ,/ 条件/ 谓词/ 对应/ 的/ 节点/ )/ ,/ 从/ 该/ 节点/ 发出/ 的/ 边/ 称之为/ 分支/ ;/ 如果/ 一个/ 节点/ 存在/ 0/ 或/ 1/ 个/ 后继/ 节点/ ,/ 其为/ 处理/ 节点/ ./ 上述/ 定义/ 并/ 不能/ 有效/ 表示/ X10/ 语言/ 中/ 分布/ 存储/ 的/ 特性/ ./ 研究/ 中/ 采用/ 多/ 泳道/ 的/ 概念/ 来/ 扩展/ 程序/ 流/ Page4/ 图/ ,/ 以/ 对/ 不同/ 地址/ 中/ 的/ 活动/ 进行/ 描述/ :/ 每/ 一个/ 泳道/ 对应/ 程序/ 一个/ 逻辑/ 地址/ ,/ 并/ 包含/ 一个/ 或/ 多个/ 子程序/ (/ 活动/ )/ 流图/ ./ 例如/ ,/ 图/ 1/ 中/ QSort2/ 程序/ 对应/ 的/ 程序/ 流图/ 如图/ 3/ (/ a/ )/ 所示/ ,/ 其/ 包含/ 两个/ 并行/ 活动/ ,/ 分别/ 处于/ 不同/ 泳道/ 中/ ./ 当/ 程序/ 活动/ 与/ 地址/ 相关/ 时/ ,/ 程序/ 流图/ 的/ 构建/ 依赖于/ 对/ 活动/ 驻存/ 地址/ 的/ 计算/ ./ 我们/ 此前/ 提出/ 一种/ 基于/ 约束/ 的/ 地址/ 分析/ 技术/ Leopard/ (/ LocalityAnalysesofPartitionedGlobalAddressSpacePrograms/ )/ [/ 5/ ]/ ,/ 以/ 精确/ 识别/ 程序/ 单个地址/ (/ 泳道/ )/ 中/ 的/ 活动/ 和/ 对象/ :/ Leopard/ 定义/ 了/ 对象/ 、/ 活动/ 和/ 地址/ 之间/ 的/ 约束/ 关系/ ,/ 并/ 计算/ 每/ 一个/ 地址/ 表达式/ 的/ 可能/ 值/ ;/ Leopard/ 进一步/ 分析程序/ 中/ 的/ 指向/ 关系/ ,/ 建立/ 位置/ 约束/ 图来/ 计算/ 每/ 一个/ 实际/ 地址/ 中/ 的/ 可能/ 活动/ 与/ 对象/ ./ 基于/ Leopard/ ,/ 我们/ 将/ 活动/ 对应/ 流图/ 指定/ 至/ 不同/ 泳道/ 中/ ,/ 建立/ 包含/ 地址/ 信息/ 的/ 程序/ 流图/ ./ 程序/ 差别/ 分析/ 中/ 的/ 一个/ 重要/ 步骤/ 是/ 匹配/ 程序结构/ ./ 本文/ 基于/ 集簇/ 的/ 概念/ 建立/ 简化/ 程序/ 流图/ ,/ 以/ 确立/ 两个/ 程序/ 流图/ 的/ 同构/ 关系/ ./ 令/ 一个多/ 泳道/ 的/ 程序/ 流图/ 的/ 节点/ 集合/ N/ 中有/ 子集/ C/ ,/ N/ \/ C/ 为/ N/ 中/ C/ 的/ 补集/ ./ 如果/ C/ 满足/ 如下/ 条件/ ,/ 则/ 称/ 其/ 为/ G/ 中/ 的/ 集簇/ :/ (/ 1/ )/ C/ 中/ 所有/ 节点/ 属于/ 同一/ 泳道/ ;/ (/ 2/ )/ 在/ C/ 中有/ 入口/ 点/ STARTc/ ,/ 其为/ C/ 中/ 唯一/ 由/ N/ \/ C/ 中/ 节点/ 所/ 指向/ 的/ 点/ ;/ (/ 3/ )/ 在/ N/ \/ C/ 中有/ ENDc/ ,/ 其为/ N/ \/ C/ 中/ 唯一/ 被/ C/ 中/ 节点/ 所/ 指向/ 的/ 点/ ./ 四元组/ 〈/ C/ ∪/ {/ ENDc/ }/ ,/ (/ C/ ∪/ {/ ENDc/ }/ )/ ×/ (/ C/ ∪/ {/ ENDc/ }/ )/ ∩/ E/ ,/ STARTc/ ,/ ENDc/ 〉/ 则/ 构成/ 一个/ 程序/ 子图/ ./ 用/ 单个/ 节点/ 替代/ 程序/ 流图/ 中/ 的/ 一个集/ 簇/ ,/ 所/ 获得/ 的/ 流图/ 被/ 称之为/ 简化/ 图/ ./ 例如/ ,/ 图/ 3/ (/ a/ )/ 可以/ 被/ 简化/ 为/ 4/ 个/ 节点/ 的/ 简化/ 图/ ,/ 如图/ 3/ (/ b/ )/ 所示/ ./ 设/ G1/ =/ 〈/ N1/ ,/ E1/ ,/ START1/ ,/ END1/ 〉/ 和/ G2/ =/ 〈/ N2/ ,/ E2/ ,/ START2/ ,/ END2/ 〉/ 为/ 两个/ 程序/ 流图/ (/ 或/ 简化/ 图/ )/ ,/ B1/ 和/ B2/ 为/ 相应/ 的/ 分支/ 集合/ ./ 定义/ 1/ 定义/ G1/ 和/ G2/ 的/ 同构/ 关系/ ./ 定义/ 1/ ./ 带/ 标记/ 的/ 程序/ 流图/ 的/ 同构/ 关系/ ./ 当且/ 仅/ 当/ 以下/ 条件/ 满足/ 时/ ,/ 映射/ f/ :/ N1/ →/ N2/ 是/ G1/ 和/ G2/ 的/ 同构/ 关系/ :/ (/ 1/ )/ 对于/ N1/ 中/ 任意/ n1/ ,/ 存在/ 唯一/ 的/ n2/ ∈/ N2/ 使得/ nl/ (/ f/ (/ n1/ )/ )/ =/ nl/ (/ n2/ )/ ;/ (/ 2/ )/ 对于/ N1/ 中/ 任意/ m/ 、/ n/ ,/ (/ f/ (/ m/ )/ ,/ f/ (/ n/ )/ )/ ∈/ E2/ 当且/ 仅/ 当/ (/ m/ ,/ n/ )/ ∈/ E1/ ;/ (/ 3/ )/ 对/ B1/ 中/ 分支/ (/ d1/ ,/ n1/ )/ ,/ 存在/ 唯一/ 的/ 分支/ (/ d2/ ,/ n2/ )/ ∈/ B2/ ,/ 使得/ al/ (/ f/ (/ d1/ )/ ,/ f/ (/ n1/ )/ )/ =/ al/ (/ d2/ ,/ n2/ )/ ./ 定义/ 中/ ,/ nl/ 、/ al/ 为/ 相应/ 的/ 标记/ 函数/ :/ 如果/ N1/ 或者/ N2/ 中/ 节点/ n/ 对应/ 一条/ 程序/ 语句/ ,/ nl/ (/ n/ )/ 为/ 相应/ 的/ 程序/ 语句/ ;/ 如果/ n/ 对应/ 一个集/ 簇/ ,/ 那么/ nl/ (/ n/ )/ 对应/ 标记/ MOD/ ;/ al/ (/ b/ )/ 将/ 决策/ 节点/ 中/ 的/ 每/ 一个/ 分支/ b/ 赋予/ 不同/ 标记/ (/ 例如/ ,/ 对于/ 条件/ 语句/ ,/ 默认/ 将边/ 标记/ 设为/ TRUE/ 或/ FALSE/ )/ ./ 5/ 程序/ 差别/ 计算/ X10Diff/ 的/ 主要/ 思想/ 在于/ 为/ 修改/ 前后/ 的/ X10/ 程序/ 分别/ 建立/ 多/ 泳道/ 的/ 程序/ 流图/ ,/ 将/ 其/ 简化/ 为/ 多/ 泳道/ 的/ 简化/ 图/ ,/ 迭代/ 扩展/ 简化/ 图/ 并/ 完成/ 同构/ 简化/ 图/ 的/ 比较/ ./ 5.1/ 建立/ 同构/ 简化/ 图图/ G1/ 和/ G2/ ,/ 并/ 识别/ 出/ 相同/ 数量/ 的/ 集簇/ ,/ 使得/ :/ 对应/ ;/ 给定/ 程序/ 版本/ P1/ 和/ P2/ ,/ 建立/ 多/ 泳道/ 的/ 程序/ 流/ (/ 1/ )/ 对于/ G1/ 中/ 的/ 集簇/ ,/ G2/ 中有且/ 只有/ 一个集/ 簇/ (/ 2/ )/ 当/ 每个/ 图中/ 的/ 集簇/ 被/ 单个/ 节点/ 所/ 代替/ 时/ ,/ 对于/ 扩展/ 的/ 程序/ 流图/ G1/ 和/ G2/ ,/ 首先/ 匹配/ 程序/ 两图/ 中/ 的/ 节点/ 一一对应/ ./ Page5/ 流图/ 中/ 的/ 泳道/ (/ 即/ 活动/ 地址/ )/ ,/ 匹配/ 中/ 遵循/ 如下/ 原则/ :/ (/ 1/ )/ 相似/ 名/ 匹配/ ./ 如果/ G1/ 和/ G2/ 中/ 两个/ 泳道/ P1i/ 和/ P2j/ 具有/ 相似/ 的/ 标签/ ,/ 则/ 匹配/ P1i/ 和/ P2j/ ./ 例如/ ,/ 图/ 4/ (/ a/ )/ 中/ ,/ P11/ 和/ P21/ 展现/ 相似/ 名/ 匹配/ 的/ 情况/ ;/ (/ 2/ )/ 相似/ 流图/ 匹配/ ./ 如果/ G1/ 和/ G2/ 中/ 两个/ 泳道/ P1i/ 和/ P2j/ 中/ 包含/ 的/ 活动/ (/ 或子/ 流图/ )/ 相似/ ,/ 则/ 匹配/ 泳道/ P1i/ 和/ P2j/ ./ 例如/ ,/ 图/ 4/ (/ b/ )/ 中/ ,/ P11/ 和/ P22/ 具有/ 相似/ 的/ 集簇/ ,/ 可以/ 对/ 它们/ 实现/ 匹配/ ;/ (/ 3/ )/ 复杂/ 匹配/ ./ 如果/ G1/ 中/ 泳道/ P1/ 包含/ 的/ 活动/ (/ 或子/ 流图/ )/ 对应/ G2/ 中/ 泳道/ P21/ ~/ P2n/ 的/ 活动/ (/ 或子/ 流图/ )/ ,/ 将/ P1/ 分解/ 为/ n/ 条/ 泳道/ P11/ ~/ P1n/ ,/ 并/ 与/ P21/ ~/ P2n/ 分别/ 匹配/ ,/ 反之亦然/ ./ 例如/ ,/ 图/ 4/ (/ c/ )/ 中/ ,/ 由于/ 部分/ 活动/ 地址/ 变更/ ,/ P11/ 与/ P21/ 和/ P12/ 与/ P22/ 不能/ 完全/ 匹配/ ./ 我们/ 将/ 各/ 泳道/ 中/ 的/ 活动/ 进一步/ 分割/ ,/ 得到/ 匹配/ 关系/ 为/ 〈/ P111/ ,/ P211/ 〉/ 、/ 〈/ P112/ ,/ P213/ 〉/ 、/ 〈/ P121/ ,/ P22/ 〉/ 和/ 〈/ P122/ ,/ P212/ 〉/ ./ 对应/ 于/ 匹配/ 泳道/ 内/ 的/ 程序/ 子图/ G1/ 和/ G2/ ,/ 如果/ G1/ 中/ 的/ 节点/ 无法/ 与/ G2/ 中/ 的/ 节点/ 对应/ ,/ 则/ 对/ 程序/ 子图/ 执行/ 如下/ 3/ 个/ 操作/ :/ (/ 1/ )/ 重新/ 标记/ ./ 将/ 某个/ 节点/ 标记/ 改成/ MOD/ ;/ (/ 2/ )/ 折叠/ 节点/ ./ 如果/ C/ 是/ 一个/ 节点/ 集簇/ ,/ 则/ 用/ 标记/ 为/ MOD/ 的/ 节点/ 替代/ C/ ;/ (/ 3/ )/ 移除/ 节点/ ./ 当/ 确定/ 程序修改/ 是/ 在/ 原程序/ 中/ 移除/ 一组/ 唯一/ 入口/ 点/ 和/ 唯一/ 出口/ 点/ 的/ 指令集/ 以后/ ,/ 可/ 在/ 相应/ 程序/ 流图/ 上移/ 除/ 节点/ ./ 如果/ C/ 是/ 一个集/ 簇/ ,/ C/ 中/ 节点/ 及/ 相关/ 的/ 边/ 可/ 从/ 图/ 中/ 移除/ ./ 如/ 算法/ Find/ _/ Isomorphism/ 所示/ ,/ 对/ 程序/ 子图/ G1/ 和/ G2/ 中/ 的/ 一个/ 或/ 多个/ 节点/ 进行/ 上述/ 操作/ 后/ ,/ 将/ 其/ 简化/ 为/ 同构/ 简化/ 图/ SG1/ 和/ SG2/ ./ 同构/ 简化/ 图为/ 程序/ 差别/ 计算/ 的/ 基础/ ./ 算法/ 1/ ./ Find/ _/ Ismorphism/ ./ 输入/ :/ 匹配/ 泳道/ 中/ 的/ 程序/ 子流图/ G1/ 、/ G2/ 输出/ :/ 匹配/ 的/ 简化/ 图/ SG1/ 、/ SG2BEGINFOR/ (/ G1/ 或/ G2/ 上/ 的/ 任意/ 决策/ 节点/ n/ )/ DOEND/ 算法/ 2/ ./ Search/ _/ and/ _/ Reduce/ ./ 输入/ :/ 集簇/ C1/ ,/ C2/ 输出/ :/ 集簇/ RC1/ ,/ RC2BEGINFOR/ (/ C1/ 和/ C2/ 中/ 的/ 决策/ 节点/ n/ )/ DOIF/ (/ C1/ 和/ C2/ 无法/ 形成/ 同构/ )/ THENENDPage6/ 用图/ 2/ 中/ 程序/ APPTest1/ 和/ APPTest2/ 以/ 说明/ 算法/ ,/ 图/ 5/ 是/ 匹配/ 过程/ 中/ 相应/ 的/ 简化/ 图/ G11/ ~/ G16/ 以及/ G21/ ~/ G26/ ./ 具体/ 匹配/ 过程/ 如下/ :/ (/ 1/ )/ 将/ 两/ 程序/ 流图/ 中/ 的/ 决策/ 节点/ 转换/ 为/ 集簇/ ,/ 得到/ 简化/ 图/ G11/ 和/ G21/ ;/ (/ 2/ )/ 使用/ 简化/ 算法/ Search/ _/ and/ _/ Reduce/ 对/ 两个/ 图/ 进行/ 深度/ 优先/ 访问/ ,/ 并/ 采用/ 折叠/ 节点/ 操作/ ,/ 将/ 图/ 分别/ 简化/ 为/ G12/ 和/ G22/ ;/ (/ 3/ )/ 对/ G12/ 和/ G22/ 归导/ ,/ 使/ 其/ 在/ 全局/ 范围/ 内/ 同构/ ;/ 若/ 无法/ 同构/ ,/ 则/ 对/ 图/ 折叠/ ,/ 在/ 折叠/ 集簇/ 中/ 建立/ 对应/ 关系/ ./ 例子/ 中/ ,/ G12/ 和/ G22/ 中/ 折叠/ 集簇/ 的/ 起始/ 点/ 临时/ 标记/ “/ while/ (/ count/ </ size/ )/ ”/ ./ 因为/ 节点/ 1/ “/ sum/ :/ int/ =/ 0/ ”/ 在/ 图/ 5/ 程序/ 流图/ G11/ ~/ G16/ 以及/ G21/ ~/ G26/ 根据/ 定义/ 1/ ,/ G16/ 和/ G26/ 同构/ ./ 算法/ 正确性/ 和/ 复杂性/ 分析/ Find/ _/ Ismorphism/ 是/ 图同构/ 关系/ 的/ 构建/ 算法/ ,/ 其/ 算法/ 正确性/ 主要/ 表现/ 为/ 两个/ 方面/ :/ 建立/ 简化/ 图/ 步骤/ 的/ 正确性/ 和/ 迭代/ 扩展/ 简化/ 图/ 并/ 建立/ 同构/ 关系/ 步骤/ 的/ 正确性/ ./ 前者/ 依赖于/ 简化/ 图/ 的/ 定义/ ,/ 对于/ 一个多/ 泳道/ 的/ 程序/ 流图/ ,/ 其/ 最小/ 简化/ 图/ 唯一/ ,/ 从而/ 保证/ 算法/ 正确性/ ./ 后者/ 正确性/ 依赖于/ 程序/ 节点/ 、/ 子图/ 等/ 的/ 相似/ 度/ :/ 对/ 分析程序/ 中/ 相似/ 节/ G12/ 中/ 无/ 对应/ 匹配/ ,/ 保留/ G12/ ,/ 并/ 在/ G22/ 中/ 去掉/ 节点/ 1/ ,/ 得到/ 了/ G23/ ./ 因此/ ,/ G12/ =/ G13/ ;/ (/ 4/ )/ 重新/ 标记/ G13/ 中/ 节点/ 2/ “/ count/ :/ int/ =/ 1/ ”/ 和/ G23/ 中/ 节点/ 3/ “/ count/ :/ int/ =/ 0/ ”/ 为/ MOD/ ,/ 得到/ G14/ 和/ G24/ ;/ (/ 5/ )/ 由于/ 匹配/ 的/ 折叠/ 集簇/ 需/ 保留/ 尽可能/ 多/ 的/ 标签/ ,/ 还原/ 图至/ G15/ 和/ G25/ ;/ (/ 6/ )/ 比较/ G15/ 中集/ 簇/ C1/ =/ {/ 3/ ,/ 4/ ,/ 5/ ,/ 6/ ,/ 7/ ,/ 8/ }/ 和/ G25/ 中集/ 簇/ C2/ =/ {/ 4/ ,/ 5/ ,/ 6/ ,/ 7/ ,/ 8/ }/ ,/ 发现/ 对应/ while/ 循环/ 代码/ 不/ 一致/ ./ 前者/ 中/ 的/ 语句/ 6/ 、/ 7/ 被/ 后者/ 中/ 的/ 语句/ “/ sum/ ·/ ·/ =/ sum/ +/ num1/ / num2/ ”/ 所/ 替代/ ,/ 因此/ 折叠/ G15/ 中/ 的/ 节点/ 6/ 、/ 7/ ,/ 重新/ 标记/ G25/ 中/ 节点/ 7/ ,/ 得到/ G16/ 和/ G26/ ./ 点/ 进行/ 节点/ 移除/ 、/ 节点/ 折叠/ 和/ 标记/ 节点/ 、/ 扩展/ 节点/ 等/ 基本操作/ ,/ 从而/ 完成/ 同/ 构图/ 的/ 匹配/ ./ 算法/ 复杂性/ 的/ 最坏/ 情况/ 为/ O/ (/ n2/ )/ ,/ 这里/ ,/ n/ 为/ 程序/ 流图/ 的/ 节点/ 数目/ ./ 一个/ 节点/ 数为/ n/ 的/ 程序/ 流图/ 简化/ 的/ 最坏/ 情况/ 是/ 程序/ 流图/ 得不到/ 简化/ ,/ 因此/ 要求/ 两个/ 程序/ 流图/ 所有/ 节点/ 进行/ 一一/ 匹配/ ;/ 假设/ 判断/ 两个/ 节点/ 是否/ 匹配/ 的/ 代价/ 为/ 常量/ ,/ 匹配/ 的/ 复杂性/ 为/ O/ (/ n2/ )/ ./ 算法/ 复杂度/ 的/ 最好/ 情况/ 为/ O/ (/ n/ )/ ./ 程序/ 一/ 开始/ 简/ Page7/ 化为/ 单个/ 节点/ ,/ 然后/ 最/ 多/ 经过/ n/ 次/ 扩展/ ,/ 实现/ 同/ 构图/ 匹配/ ./ 最好/ 情况/ 下/ ,/ 每次/ 扩展/ 过程/ 中/ ,/ 被/ 扩展/ 节点均/ 实现/ 精确/ 匹配/ ./ 5.2/ 节点/ 匹配/ 下面/ 给出/ 匹配/ 算法/ Match/ ,/ 以/ 在/ 同构/ 简化/ 图/ 的/ 基础/ 上/ 建立/ 节点/ 匹配/ ./ 算法/ 中/ ,/ 用户/ 自定义/ 相似/ 度/ 标准/ S/ ,/ 以/ 决定/ 两个/ 节点/ 是否/ 相似/ ;/ Comp/ (/ n1/ ,/ n2/ ,/ LH/ ,/ S/ ,/ R/ )/ 根据/ 相似/ 度/ 标准/ S/ 对/ 节点/ n1/ 和/ n2/ 匹配/ ,/ 如果/ 实现/ 匹配/ ,/ 则/ 将/ 带/ 标记/ 的/ 节点/ 对/ 加入/ 集合/ R/ 并/ 返回/ TRUE/ ,/ 否则/ 返回/ FALSE/ ;/ succ/ (/ Set/ )/ 计算/ Set/ 中/ 每个/ 节点/ 的/ 后继/ 节点/ 并/ 以/ 节点/ 集合/ 的/ 形式/ 返回/ ;/ EdgeMatching/ (/ n1/ ,/ n2/ )/ 返回/ 配对/ 的/ 边/ ./ 算法/ 3/ ./ Match/ ./ 输入/ :/ 源程序/ 中/ 的/ 节点/ n1/ ;/ 输出/ :/ 布尔值/ resultBEGINresult/ =/ FALSE/ ;/ 图/ 6/ 待/ 比较/ 的/ 示例/ 程序/ P/ ,/ PENDWHILERETURNresult/ ;/ END/ 考察/ 图/ 6/ 中/ 的/ 例子/ ,/ 图/ 7/ 显示/ 了/ 修改/ 前后/ 的/ 程序/ 流图/ ./ 算法/ 将/ 出口/ 节点/ 〈/ 3/ ,/ 3/ 〉/ 添加/ 到/ 配对/ 节点/ 集中/ ,/ 将/ 节点/ 对/ 〈/ 1/ ,/ 1/ 〉/ 压栈/ 到/ ST/ 中/ ./ 在/ while/ 第一次/ 循环/ 中/ ,/ 调用/ Comp/ (/ 1/ ,/ 1/ ,/ 2/ ,/ 0.5/ ,/ R/ )/ 进行/ 比较/ ,/ 将/ 〈/ 1/ ,/ 1/ 〉/ 设/ 为/ 匹配/ 并/ 放入/ R/ 中/ ./ 由于/ 1/ 、/ 1/ 节点均/ 只有/ 一条/ 出边/ ,/ 且/ 两条/ 边/ 匹配/ ,/ 将/ 节点/ 对/ 〈/ 2/ ,/ 2/ 〉/ 压入/ 工作/ 表/ ./ 1/ ./ publicclassA/ {/ 2/ ./ publicdefm1/ (/ )/ :/ void/ {/ 3/ ./ …/ 4/ ./ }/ 5/ ./ }/ 6.7/ ./ publicclassBextendsA/ {/ 8/ ./ publicdefm1/ (/ )/ :/ void/ {/ 9/ ./ …/ 10/ ./ }/ 11/ ./ publicdefm2/ (/ )/ :/ void/ {/ 12/ ./ …/ 13/ ./ }/ 14/ ./ }/ 15.16/ ./ publicclassD/ {/ 17/ ./ publicdefm3/ (/ vara/ :/ A/ )/ :/ void/ {/ 18/ ./ a/ ./ m1/ (/ )/ ;/ 19/ ./ …/ 20/ ./ }/ 21/ ./ }/ Page8/ 图/ 7/ 简化/ 图/ 节点/ 间/ 匹配/ 将/ 节点/ 2/ 、/ 2/ 扩展/ 为/ 两个/ 子图/ ./ 算法/ 配对/ 起始/ 点/ 对/ 〈/ 4/ ,/ 4/ 〉/ 、/ 出口/ 点/ 对/ 〈/ 7/ ,/ 7/ 〉/ ,/ 并/ 将/ 〈/ 5/ ,/ 5/ 〉/ 、/ 〈/ 6/ ,/ 6/ 〉/ 压入/ 至/ ST1/ 中/ ./ 算法/ 接下来/ 将/ 节点/ 对/ 〈/ 5/ ,/ 5/ 〉/ 配对/ 并/ 压入/ R1/ 中/ ,/ 将/ 后继/ 节点/ 对/ 〈/ 7/ ,/ 7/ 〉/ 压入/ 至/ ST1/ ./ 依次/ 比较/ 节点/ 对/ 〈/ 6/ ,/ 6/ 〉/ 、/ 〈/ 6/ ,/ 7/ 〉/ 、/ 〈/ 7/ ,/ 6/ 〉/ ,/ 因为/ 均/ 不/ 匹配/ ,/ 则/ 添加/ 节点/ 对/ 〈/ 6/ ,/ 6/ 〉/ 到/ R1/ 中/ ,/ 标记/ 为/ “/ MODIFIED/ ”/ ,/ 将/ 后继/ 节点/ 对/ 〈/ 7/ ,/ 7/ 〉/ 压入/ 至/ ST1/ ./ 因为/ 大多数/ 节点/ 在子/ 图中/ 都/ 被/ 标记/ 为/ “/ UNCHANGED/ ”/ ,/ 而/ 设定/ 相似/ 度/ 标准/ S/ 为/ 0.5/ ,/ 故/ 两个/ 流图/ 匹配/ ./ 因此/ ,/ Comp/ (/ 2/ ,/ 2/ ,/ 2/ ,/ 0.5/ ,/ R/ )/ 返回/ TRUE/ ,/ 将/ 节点/ 对/ 〈/ 2/ ,/ 2/ 〉/ 加入/ 至/ R/ ,/ 并/ 标记/ 为/ “/ UNCHANGED/ ”/ ./ 算法/ 对/ 简化/ 图/ 剩余/ 部分/ 继续/ 完成/ 匹配/ ./ 上述/ 例子/ 包括/ 了/ 简化/ 图/ 节点/ 匹配/ 的/ 多种/ 情况/ ,/ 包括/ 节点/ 的/ 匹配/ 、/ 向前/ 读入/ 节点/ 、/ 流图/ 扩展/ 等/ ./ 算法/ 正确性/ 和/ 复杂性/ 分析/ ./ Match/ 算法/ 用于/ 判断/ 两个/ 节点/ 是否/ 匹配/ ./ 算法/ 正确性/ 主要/ 取决于/ :/ (/ 1/ )/ 匹配/ 节点/ 与/ 流图/ 中/ 其他/ 节点/ 之间/ 控制/ 依赖/ 关系/ 的/ 建立/ ,/ 即/ 如果/ 节点/ 依赖/ 的/ 节点/ 集能/ 与/ 另/ 一个/ 程序/ 中/ 节点/ 依赖/ 的/ 节点/ 集/ 形成/ 相似/ 匹配/ 关系/ ,/ 则/ 为/ 这/ 两个/ 节点/ 建立/ 匹配/ 关系/ ;/ (/ 2/ )/ 相似/ 度/ 取值/ ,/ 如果/ 相似/ 度/ 要求/ 高/ ,/ 则/ 不易/ 为/ 两个/ 程序/ 的/ 节点/ 匹配/ ,/ 反之/ 则/ 容易/ 匹配/ ./ 单个/ 节点/ 匹配/ 算法/ 复杂性/ 最坏/ 情况/ 为/ O/ (/ n2/ )/ ,/ n/ 为/ 待/ 匹配/ 的/ 流图/ 节点/ 数/ ./ 当该/ 节点/ 与/ 其他/ 所有/ 节点/ 都/ 有/ 控制/ 依赖/ ,/ 最坏/ 情况/ 下/ 需要/ 检查/ 每/ 一条/ 控制/ 边/ 是否/ 连接/ 到/ 相应/ 的/ 节点/ 上/ ./ 然而/ ,/ 由于/ 设立/ 了/ 相似/ 度/ ,/ 实际/ 计算/ 中当/ 不/ 满足/ 相似/ 度/ 要求/ 后/ 计算/ 会/ 结束/ ./ 同理/ ,/ 针对/ 流图/ 所有/ 节点/ 匹配/ 算法/ 复杂性/ 最坏/ 情况/ 为/ O/ (/ n4/ )/ ,/ 在/ 此/ 情况/ 下/ ,/ 需要/ 对/ 两个/ 流图/ 中/ 所有/ 节点/ 进行/ 一一/ 匹配/ ./ 5.3/ 差别/ 分析/ 结合/ 匹配/ 算法/ ,/ 设计/ X10/ 程序/ 差别/ 方法/ 如下/ ./ 这里/ ,/ 将/ 修改/ 前后/ 的/ 程序/ 版本/ P1/ 和/ P2/ 作为/ 输入/ ,/ 并/ 接收/ 另/ 两个/ 参数/ :/ LH/ 是/ 差别/ 分析/ 中/ 匹配/ 节点/ 时/ 向前/ 读入/ 的/ 最大/ 节点/ 数/ ;/ S/ 用于/ 计算/ 两个/ 程序/ 流图/ 的/ 相似/ 值/ ./ 输出/ 为类/ 对/ 集合/ CP/ 、/ 接口/ 对/ 集合/ IP/ 、/ 方法/ 对/ 集合/ MP/ 、/ 地址/ 对/ 集合/ PP/ 及/ 以/ 〈/ 〈/ node/ ,/ node/ 〉/ ,/ status/ 〉/ 形式/ 的/ 节点/ 对/ 集合/ NP/ ./ X10Diff/ 首先/ 完成/ 在/ 类/ 与/ 接口/ 级别/ 的/ 对比/ ,/ 然后/ 进行/ 方法/ 级别/ 的/ 对比/ 及/ 节点/ 级别/ 的/ 对比/ ./ (/ 1/ )/ 对比/ P1/ 和/ P2/ 中/ 的/ 类/ ,/ 将/ 匹配/ 的/ 类成/ 对/ 放入/ 类/ 对/ 集合/ CP/ 中/ ./ 在/ 进行/ 类/ 的/ 对比/ 的/ 时候/ ,/ 算法/ 会/ 寻找/ P1/ 中/ 与/ P2/ 中/ 名字/ 相似/ 的/ 类/ ,/ 并/ 输出/ 匹配/ 类/ 对/ 集合/ (/ CP/ )/ ./ 那些/ 未/ 被/ 加入/ CP/ 的/ P1/ 中/ 的/ 类/ ,/ 是/ 被/ 删除/ 的/ 类/ ,/ 而/ P2/ 中未/ 被/ 加入/ CP/ 中/ 的/ 类/ ,/ 是/ 新增/ 类/ ./ (/ 2/ )/ 对比/ P1/ 和/ P2/ 中/ 的/ 接口/ ,/ 并/ 采用/ 类似/ 类/ 匹配/ 的/ 方法/ 判断/ 删除/ 或/ 新增/ 接口/ ,/ 将/ 匹配/ 的/ 接口/ 成/ 对/ 放入/ 集合/ IP/ 中/ ./ (/ 3/ )/ 在/ 每/ 一对/ 类/ 或者/ 接口/ 中/ 继续/ 匹配/ 方法/ ./ 算法/ 匹配/ P1/ 与/ P2/ 中/ 具有/ 相同/ (/ 或/ 相似/ )/ 签名/ 的/ 方法/ ,/ 并/ 输出/ 匹配/ 方法/ 对/ 集合/ (/ MP/ )/ ./ P1/ 中未/ 出现/ 的/ 在/ MP/ 中/ 的/ 方法/ 为/ 在/ 后/ 一/ 版本/ 中/ 被/ 删除/ 的/ 方法/ ,/ 反之/ 则/ 为/ 后/ 一/ 版本/ 中/ 新增/ 的/ 方法/ ./ (/ 4/ )/ 节点/ 匹配/ 过程/ 中/ ,/ 算法/ 为/ 匹配/ 好/ 的/ 方法/ 对/ 〈/ m1/ ,/ m2/ 〉/ 创建/ 控制流/ 图/ G1/ 和/ G2/ 及/ 建立/ 扩展/ 的/ 程序/ 流图/ ,/ 并/ 实现/ 程序/ 流图/ 中/ 泳道/ 的/ 匹配/ ,/ 将/ 匹配/ 成功/ 的/ 活动/ 地址/ 对/ 〈/ place1/ ,/ place2/ 〉/ 加入/ 到/ PP/ 中/ ./ 将/ 每/ 一对/ 匹配/ 的/ 泳道/ 中/ 的/ 程序/ 子流图/ 分别/ 折叠/ 到/ 一个/ 节点/ ./ 接下来/ ,/ 利用/ Match/ 算法/ 匹配/ 简化/ 图/ ,/ 创建/ 节点/ 对集/ NP/ ./ 算法/ 结束/ 时/ ,/ 会/ 输出/ 成/ 对/ 节点/ 的/ 集合/ ,/ 也/ 会/ 返回/ 匹配/ 成功/ 的/ 类/ 对/ CP/ 、/ 接口/ 对/ IP/ 和/ 方法/ 对/ MP/ 、/ 地/ Page9/ 址/ 对/ PP/ ./ 5.4/ X10Diff/ 支撑/ 工具/ 架构/ 我们/ 基于/ 上述/ 算法/ 开发/ 了/ X10Diff/ 工具/ ,/ 以/ 识别/ 程序/ 之间/ 的/ 差别/ ./ X10Diff/ 工具/ 以/ 两个/ X10/ 程序/ 为/ 输入/ ,/ 输出/ 报告/ 为/ 这/ 两个/ 程序/ 的/ 差别/ 信息/ ./ 图/ 8/ 展示/ 了/ X10Diff/ 工具/ 的/ 开发/ 框架/ ./ 针对/ 目标程序/ ,/ X10Diff/ 基于/ WALA/ (/ Watson/ 分析/ 库/ ①/ )/ 对/ 其/ 进行/ 语法分析/ ,/ 生成/ 抽象/ 语法/ 树/ ,/ 并/ 在/ 抽象/ 语法/ 树/ 的/ 基础/ 上/ 完成/ 类/ 、/ 接口/ 和/ 方法/ 的/ 匹配/ 与/ 差别/ 分析/ ./ X10Diff/ 接下来/ 进行/ 程序/ 语义/ 分析/ ,/ 生成/ 控制流/ 图/ ./ 我们/ 也/ 利用/ WALA/ 框架/ 为/ 程序/ 源码/ 生成/ 控制流/ 图/ ,/ 并/ 利用/ Leopard/ 地址/ 分析/ 算法/ 分析程序/ 中/ 地址/ 、/ 活动/ 与/ 对象/ 信息/ ./ 接下来/ ,/ X10Diff/ 在/ 多/ 泳道/ 程序控制/ 流图/ 的/ 基础/ 上/ ,/ 利用/ 匹配/ 算法/ 完成/ 两个/ 同/ 构图/ 匹配/ 与/ 活动/ 内/ 语句/ 的/ 差别/ 分析/ ,/ 生成/ 程序/ 差别/ 信息/ ./ 5.5/ 实验/ 效果/ 研究/ 中/ 选择/ X10/ 程序/ 样例/ 程序/ ②/ 进行/ 实验/ ,/ 以/ 检验/ X10Diff/ 的/ 效果/ ./ 实验/ 中/ 安排/ 两组/ 独立/ 的/ 参与/ 人员/ :/ 程序/ 差别/ 植入/ 者/ 负责/ 在/ X10/ 程序/ 中/ 植入/ 若干/ 程序/ 差别/ ,/ 程序/ 差别/ 分析/ 者/ 采用/ X10Diff/ 对/ 程序/ 差别/ 予以/ 识别/ ./ 实验/ 主要/ 步骤/ 包括/ :/ (/ 1/ )/ 植入/ 程序/ 差别/ ./ 程序/ 差别/ 植入/ 者/ 针对/ 被/ 分析程序/ ,/ 手工/ 植入/ 若干/ 差别/ ,/ 即/ 对/ 程序/ 进行/ 修改/ ,/ 并/ 在/ 植入/ 过程/ 中/ 对/ 修改/ 点/ 予以/ 记录/ ./ 手工/ 植入/ 的/ 程序/ 差别/ 类型/ 包括/ 对类/ 、/ 方法/ 、/ 地址/ 、/ 语句/ 等/ 各级/ 别的/ 修改/ ,/ 并/ 保证/ 每个/ 程序/ 的/ 修改/ 程度/ 小于/ 10/ %/ ,/ 以/ 使得/ 程序/ 不同/ 版本/ 之间/ 得到/ 匹配/ ./ 这里/ 将/ 植入/ 的/ 程序/ 差别/ 集合/ 记为/ Diff1/ ./ 这一/ 步骤/ 后/ ,/ 可以/ 获得/ 修改/ 前后/ 的/ 程序/ 版本/ 供/ 程序/ 差别/ 分析/ ./ 注意/ 的/ 是/ ,/ 实验/ 中未/ 能够/ 严格/ 保证/ 修改/ 后/ 的/ 程序/ 是/ 能够/ 被/ 执行/ 的/ ./ (/ 2/ )/ 程序/ 差别/ 分析/ ./ 程序/ 差别/ 分析/ 者/ 独立/ 采用/ X10Diff/ 进行/ 识别/ 差别/ ,/ 从而/ 识别/ 出/ 程序/ 中/ 的/ 类/ 、/ 方法/ 、/ 地址/ 、/ 语句/ 等/ 的/ 匹配/ 关系/ 及/ 程序/ 差别/ ./ 我们/ 将/ 识别/ 出/ 的/ 程序/ 差别/ 集合/ 记录/ 为/ Diff2/ ./ 实验/ 结束/ 后/ ,/ 实验/ 参与者/ 对比/ Diff1/ 和/ Diff2/ ,/ 以/ 验证/ X10Diff/ 的/ 效果/ ./ 实验/ 结果/ 如表/ 3/ 所示/ ./ 这里/ ,/ 我们/ 将/ (/ Diff1/ -/ Diff2/ )/ 记录/ 为/ 差别/ 漏报/ ,/ 将/ (/ Diff2/ -/ Diff1/ )/ 记录/ 为/ 差别/ 误报/ ./ 识别率/ X10DiffRate/ =/ #/ (/ Diff1/ ∩/ Diff2/ )/ // #/ Diff1/ ,/ 误报率/ FalsePositiveRate/ =/ #/ (/ Diff2/ -/ Diff1/ )/ // #/ Diff2/ ./ 实验/ 结果表明/ ,/ X10Diff/ 可以/ 识别/ 程序/ 中/ 83/ %/ 的/ 差别/ ,/ 但/ 也/ 存在/ 17/ %/ 的/ 漏报/ 率/ 和/ 17/ %/ 的/ 误报率/ ./ 程序/ 手工/ 植入/ ArrayCopy1/ 地址/ 11000MontePi11/ 语句/ 210050MontePi22/ 类/ 、/ 语句/ 310033MontePiAsync2/ 地址/ 、/ 表达式/ 1500MontePiAsync22/ 表达式/ 21000MontePiCluster2/ 方法/ 、/ 地址/ 21000MontePiCluster22/ 表达式/ 、/ 地址/ 1500/ 合计/ 12/ // 10/ (/ 识别/ )/ +/ 进一步/ 的/ 分析表明/ ,/ 被/ 疏忽/ 的/ 差别/ 主要/ 来源于/ 地址/ 的/ 计算/ ,/ 即/ 静态/ 计算/ 不能/ 获取/ 准确/ 的/ 地址/ ,/ 对/ 地址/ 的/ 匹配/ 会/ 存在/ 失误/ ./ 而/ 误报/ 主要/ 原因/ 在于/ 语句/ 进行/ 了/ 次序/ 调整/ ,/ 例如/ ,/ 在/ 植入/ 错误/ 的/ 时候/ 被/ 记为/ 1/ 处/ 差别/ ,/ 但/ 在/ 分析/ 过程/ 中/ 被/ 记为/ 多处/ 差别/ ./ 6/ 相关/ 工作/ 典型/ 的/ 程序/ 差别/ 分析方法/ 可以/ 分为/ 两类/ :/ 基于/ 程序/ 语法/ 的/ 和/ 基于/ 程序/ 语义/ 的/ ./ 前者/ 强调/ 以/ 程序/ 文本/ 、/ 程序结构/ 、/ 语法/ 树为/ 基础/ ,/ 实现/ 程序/ 差别/ 分析/ ./ GNUDiffutils/ ③/ 是/ 一个/ 用来/ 定位/ 文件/ 差别/ 的/ 工具/ ①/ ②/ ③/ Page10/ 集/ ,/ 通过/ 使用/ diff/ 命令/ ,/ 用户/ 可以/ 定位/ 两个/ 文件/ (/ 包括/ 程序/ )/ 之间/ 区别/ ,/ 并/ 采用/ 按行/ 输出/ 的/ 方式/ 输出/ 这些/ 区别/ ./ Duley/ 等/ 人/ [/ 6/ ]/ 提出/ 针对/ VerilogHDL/ 语言/ 的/ 程序/ 差别/ 算法/ ,/ 该/ 算法/ 可以/ 将/ Verilog/ 特定/ 的/ 变化/ 类型/ 以/ 语法/ 形式/ 报告/ 出来/ ./ Tsantalis/ 等/ 人/ [/ 7/ ]/ 开发/ 了/ 一个/ 基于/ 网络/ 的/ 差别/ 分析/ 工具/ WebDiff/ ,/ 其/ 核心/ 算法/ 为树/ 差别/ 算法/ VTracker/ ,/ 该/ 算法/ 可以/ 将/ XML/ 文档/ 表示/ 为/ 偏序/ 树/ ,/ 并/ 进行/ 差别/ 分析/ ./ UMLDiff/ 是/ 一个/ 用于/ UML/ 类图/ 的/ 差别/ 分析/ 工具/ ,/ 可以/ 识别/ 出/ UML/ 类图/ 中/ 对/ 类/ 的/ 增/ 、/ 删/ 、/ 改等/ 操作/ [/ 8/ ]/ ./ 然而/ ,/ 程序/ 是/ 具有/ 语义/ 的/ ,/ 上述/ 基于/ 语法/ 或/ 程序结构/ 的/ 程序/ 差别/ 分析方法/ 并/ 不能/ 识别/ 程序/ 语义上/ 的/ 差异/ ./ 基于/ 语义/ 的/ 程序/ 差别/ 分析方法/ 需要/ 根据/ 目标语言/ 来/ 设计/ ./ 对于/ 传统/ 顺序程序/ 语言/ (/ 如/ C/ )/ 和/ 面向对象/ 程序语言/ (/ 如/ C++/ 、/ Java/ 等/ )/ ,/ 目前/ 均/ 已/ 存在/ 程序/ 差别/ 算法/ 并/ 已经/ 被/ 广泛应用/ 到/ 程序/ 分析/ 中/ ./ 例如/ BMAT/ [/ 2/ ]/ 、/ Semanticdiff/ [/ 3/ ]/ 及/ Horwitz/ 的/ 技术/ [/ 4/ ]/ 等/ 主要/ 用于/ 处理/ 面向/ 过程/ 的/ 程序/ ./ Term/ 提出/ 的/ 差别/ 分析/ 算法/ [/ 9/ ]/ 主要/ 针对/ Java/ 程序/ ./ Grg/ 等/ 人/ [/ 10/ ]/ 提出/ 了/ 针对/ AspectJ/ 程序/ 的/ 面向/ 方面/ 程序/ 差别/ 分析方法/ 等/ ./ Loh/ 和/ Kim/ 开发/ 了/ 一个/ 逻辑/ 结构/ 差别/ 分析/ 工具/ LSdiff/ [/ 11/ -/ 12/ ]/ ,/ 可以/ 自动/ 将/ 程序结构/ 差别/ 识别/ 为/ 一组/ 与/ 变化/ 相关/ 的/ 逻辑/ 规则/ ./ CloneDifferentiator/ 是/ 一个/ 用于/ 对/ 程序/ 克隆/ 实现/ 差别/ 分析/ 的/ 工具/ [/ 13/ ]/ ,/ 其/ 从/ 程序/ 依赖图/ 中/ 获取/ 克隆/ 中/ 的/ 语义/ 信息/ ,/ 并/ 使用/ 图形/ 匹配/ 技术/ 计算/ 精确/ 的/ 克隆/ 差别/ ./ 对于/ 基于/ PGAS/ 模型/ 的/ X10/ 语言/ ,/ 其/ 程序/ 分析方法/ 并/ 不/ 成熟/ ./ 本文/ 针对/ X10/ 这一/ 高性能/ 计算/ 语言/ ,/ 研究/ 相关/ 程序/ 差别/ 分析方法/ ./ X10Diff/ 是/ 一个/ 基于/ 语义/ 的/ 程序/ 差别/ 分析方法/ ./ 就/ 目前/ 所/ 检索/ 到/ 的/ 文献资料/ 而言/ ,/ 几乎/ 没有/ 基于/ 语义/ 的/ 并行程序/ 差别/ 分析方法/ ,/ 而/ X10Diff/ 则/ 对此/ 方面/ 进行/ 了/ 探索/ ./ 此外/ ,/ X10Diff/ 在/ 差别/ 分析/ 过程/ 中/ 结合/ 了/ 逻辑/ 地址/ 计算/ 和/ 活动/ 匹配/ 方法/ ,/ 有效/ 地/ 提高/ 了/ 分析/ 的/ 精度/ ./ 7/ 结束语/ 对/ 并行程序/ 中/ 程序/ 差别/ 的/ 识别/ 对于/ 并行程序/ 分析/ 、/ 测试/ 、/ 理解/ 和/ 维护/ 有/ 很/ 重要/ 的/ 作用/ ./ 本文/ 提出/ 了/ 比/ 对/ 两个/ X10/ 程序/ 并/ 寻找/ 语句/ 级差/ 别的/ 算法/ X10Diff/ :/ 给出/ 两个/ X10/ 程序/ ,/ 识别/ 匹配/ 的/ 类/ 与/ 方法/ ,/ 建立/ 每/ 一个/ 匹配/ 方法/ 对/ 和/ 地址/ 对/ ,/ 并/ 比较/ 活动/ 、/ 语句/ 等/ 方面/ 的/ 差别/ ./ 本文/ 所/ 提出/ 的/ 方法/ 对/ 其他/ 并行/ 语言/ 的/ 程序/ 分析/ 同样/ 有/ 启示/ 作用/ ,/ 比如说/ CrayInc/ ./ 开发/ 的/ Chapel/ 或是/ Sun/ 开发/ 的/ Fortress/ 语言/ ./ 进一步/ 的/ 工作/ 主要/ 包括/ :/ 现在/ 对/ Place/ 的/ 处理/ 方法/ 仍/ 不能/ 识别/ 比较复杂/ 的/ 程序/ 机制/ ,/ 如/ 时钟/ 、/ 原子/ 块/ 等/ ,/ 需要/ 进一步/ 解决/ 这些/ 机制/ 基础/ 上/ 的/ 并行程序/ 的/ 差别/ 分析/ ;/ 将/ X10/ 程序/ 差别/ 分析/ 的/ 工具/ 集成/ 到/ X10/ 集成/ 开发/ 工作/ 中/ ;/ 进行/ 综合/ 实验/ ,/ 以/ 检验/ 算法/ 的/ 实际效果/ 等/ ./ 

