Page1/ 一种/ 任意/ 维/ Line/ -/ Sweep/ 计算/ 的/ 数据/ 划分算法/ 王鹏/ 1/ )/ ,/ 2/ )/ 邱枫/ 3/ )/ 张为华/ 1/ )/ ,/ 2/ )/ 臧斌宇/ 1/ )/ ,/ 2/ )/ 朱传琪/ 1/ )/ ,/ 2/ )/ 1/ )/ (/ 复旦大学/ 计算机/ 学院/ 上海/ 200433/ )/ 2/ )/ (/ 复旦大学/ 并行处理/ 研究所/ 上海/ 200433/ )/ 3/ )/ (/ 复旦大学/ 高分子/ 科学系/ 上海/ 200433/ )/ 摘要/ 数据/ 划分/ 是/ 在/ 当前/ 主流/ 高性能/ 计算/ 平台/ 上/ 高效/ 并行/ 化/ 应用程序/ 的/ 关键技术/ ,/ 它/ 包括/ 数据/ 分割/ 和/ 处理机/ 分配/ 两个/ 主要/ 部分/ ./ Line/ -/ Sweep/ 计算/ 模式/ 被/ 众多/ 科学/ 工程/ 计算/ 核心/ 采用/ ,/ 目前/ 该/ 计算/ 模式/ 的/ 并行/ 化/ 主要/ 采用/ 多重/ 数据/ 划分/ ./ 多重/ 数据/ 划分/ 能/ 保证/ 各/ 处理机/ 的/ 计算/ 量/ 、/ 访/ 存量/ 和/ 通讯/ 量/ 相等/ ,/ 但/ 在/ 某些/ 情况/ 下/ 也/ 会/ 导致/ 访/ 存量/ 和/ 通讯/ 量/ 过/ 多/ ,/ 因此/ 无法/ 保证/ 性能/ 最优/ ./ 为/ 解决/ 这一/ 缺陷/ ,/ 文中/ 提出/ 均衡/ 数据/ 划分/ ,/ 进一步/ 放松/ 对/ 数据/ 分割/ 和/ 处理器/ 分配/ 的/ 非本质/ 约束/ ,/ 以利于/ 在/ 计算/ 、/ 访存/ 和/ 通讯/ 这/ 3/ 种/ 开销/ 之间/ 达到最佳/ 平衡/ ./ 文中/ 给出/ 生成/ 最佳/ 均衡/ 数据/ 划分/ 的/ 算法/ ,/ 它/ 包含/ 3/ 个/ 关键技术/ :/ 首先/ 建立/ 性能/ 模型/ ,/ 在/ 该/ 模型/ 中/ 均衡/ 数据/ 划分/ 的/ 性能/ 只/ 与/ 数据/ 分割/ 方式/ 有关/ ;/ 接着/ 基于/ 该/ 模型/ 缩减/ 数据/ 分割/ 方式/ 的/ 搜索/ 空间/ ,/ 并/ 以/ 该/ 模型/ 为/ 判据/ 搜索/ 性能/ 最佳/ 的/ 数据/ 分割/ 方式/ ;/ 最后/ 设计/ 处理机/ 分配/ 函数/ 以/ 满足/ 均衡/ 数据/ 划分/ 的/ 条件/ ./ 均衡/ 数据/ 划分/ 被/ 应用/ 于/ NPB/ 并行/ 测试/ 包中/ 的/ SP/ 程序/ 和/ 高分子/ 材料/ 计算/ 程序/ LineABC/ ./ 实验/ 结果表明/ ,/ 当/ 均衡/ 数据/ 划分/ 与/ 多重/ 数据/ 划分/ 的/ 数据/ 分割/ 方式/ 相同/ 时/ ,/ 二者/ 性能/ 基本一致/ ;/ 当/ 两种/ 数据/ 分割/ 方式/ 不/ 同时/ (/ 对于/ SP/ 和/ LineABC/ ,/ 这种/ 情况/ 所/ 占/ 比例/ 分别/ 高达/ 38.7/ %/ 和/ 37.9/ %/ )/ ,/ 采用/ 均衡/ 数据/ 划分/ 的/ SP/ 程序/ 和/ LineABC/ 程序/ 的/ 并行/ 效率/ 比/ 多重/ 数据/ 划分/ 平均/ 分别/ 高出/ 44.45/ %/ 和/ 22.15/ %/ ./ 关键词/ Line/ -/ Sweep/ 计算/ ;/ 负载/ 均衡/ ;/ 多重/ 数据/ 划分/ ;/ 均衡/ 数据/ 划分/ ;/ 性能/ 模型/ 1/ 引言/ 当前/ 以/ 集群/ 为/ 代表/ 的/ 分布式/ 内存/ 并行机/ 是/ 并行计算/ 的/ 主流/ 平台/ ,/ 数据/ 划分/ 是/ 在/ 这类/ 机器/ 上/ 有效/ 并行/ 化/ 应用程序/ 的/ 关键技术/ ,/ 该/ 技术/ 力求/ 将/ 数据/ 合理/ 地/ 分割/ 并/ 分配/ 给/ 计算/ 节点/ ,/ 以期/ 同时/ 达到/ 最大/ 的/ 并行度/ 和/ 最小/ 的/ 访存/ 与/ 通讯/ 开销/ ,/ 从而/ 最优化/ 整体/ 并行/ 效率/ ./ Line/ -/ Sweep/ 计算/ 是/ 众多/ 科学/ 工程/ 计算/ 的/ 核心/ [/ 1/ -/ 2/ ]/ ,/ 它/ 的/ 一个/ 重要/ 应用/ 是/ 交替/ 方向/ 隐式/ (/ ADI/ )/ 方法/ ,/ 该/ 方法/ 广泛/ 用于/ 求解/ 偏/ 微分方程/ [/ 3/ -/ 4/ ]/ (/ 如/ Navier/ -/ Stokes/ 方程/ )/ ,/ 并/ 因/ 其/ 高精度/ 和/ 高/ 稳定性/ 而/ 被/ 称为/ “/ 对/ 计算/ 数学/ 的/ 伟大/ 贡献/ ”/ [/ 2/ ]/ ./ 由于/ Line/ -/ Sweep/ 计算/ 通常/ 需要/ 大量/ 计算资源/ ,/ 故为/ 其/ 设计/ 高效/ 数据/ 划分/ 是/ 有/ 意义/ 的/ 课题/ ./ 图/ 1/ 展示/ 了/ 三维/ Line/ -/ Sweep/ 计算/ 的/ 程序结构/ 与/ 数据/ 访问/ 模式/ :/ 该/ 计算/ 整体/ 上/ 使用/ 迭代/ 收敛/ 模式/ ,/ 每次/ 迭代/ 依次/ 沿/ 目标/ 数组/ 的/ 各维/ 扫描/ 并/ 更新/ 数据/ ,/ 每维/ 扫描/ 对应/ 一个/ 循环/ ,/ 该/ 循环/ 只/ 存在/ 扫描/ 方向/ 上/ 的/ 数据/ 相关性/ ./ 图/ 1/ 左边/ 的/ 立方/ 块/ 表示/ 待/ 计算/ 的/ 三维/ 数组/ ,/ 右边/ 的/ (/ 1/ )/ ~/ (/ 6/ )/ 项/ 依次/ 列出/ 迭代/ 包含/ 的/ 扫描/ ,/ 每个/ 扫描/ 所沿/ 方向/ 在/ 左边/ 的/ 立方/ 块/ 上/ 用/ 箭头/ 标出/ ,/ 标注/ 框中/ 的/ 循环/ 代码/ 对应/ 于/ 扫描/ (/ 2/ )/ ./ 虽然/ 每维/ 扫描/ 对应/ 的/ 循环/ 只/ 存在/ 该维/ 方向/ 的/ 数据/ 相关性/ ,/ 但/ 从/ 全局/ 上/ 看/ ,/ 不/ 存在/ 一个/ 数据/ 维/ ,/ 使得/ 按该/ 维/ 分割/ 并/ 分配/ 数据/ 能够/ 避免/ 数据/ 重组/ 或/ 流水线/ 并行/ ,/ 这/ 就/ 给/ 高效/ 并行/ 化/ Line/ -/ Sweep/ 计算/ 设置/ 了/ 难题/ ./ 当前/ Line/ -/ Sweep/ 计算/ 的/ 有效/ 数据/ 划分/ 方法/ 有/ 通常/ 的/ 一/ 维和/ 二维/ 区域/ 分解/ 方式/ 和/ 多重/ 数据/ 划分/ ,/ 文献/ [/ 5/ ]/ 将/ 这些/ 划分/ 方法/ 的/ 性能/ 做/ 了/ 比较/ ,/ 根据/ 该/ 文献/ 多重/ 数据/ 划分/ 的/ 可扩展性/ 远/ 优于/ 传统/ 的/ 区域/ 划分/ ./ 多重/ 数据/ 划分/ 从/ 出现/ 到/ 成熟/ 经历/ 了/ 一系列/ 演变/ :/ Johnsson/ 等/ 人/ [/ 3/ ]/ 首次/ 实现/ 了/ 二维/ 多重/ 数据/ 划分/ ,/ Naik/ 等/ 人/ [/ 4/ ]/ 发展/ 了/ 三维/ 多重/ 数据/ 划分/ ,/ Darte/ 等/ 人/ [/ 6/ ]/ 进一步/ 推至/ 使用/ 任意/ 数目/ 处理机/ 并行/ 化/ 任意/ 维/ Line/ -/ Sweep/ 计算/ 的/ 情况/ ./ Darte/ 的/ 算法/ 自/ 提出/ 后/ 一直/ 没有/ 改进/ ,/ 之后/ 的/ 工作/ 主要/ 是/ 基于/ 该/ 算法/ 做/ 一些/ 调优/ 或者/ 将/ 其/ 应用/ 到/ 新/ 的/ 编程/ 模式/ 中/ [/ 7/ -/ 8/ ]/ ./ 图/ 2/ 是/ 处理机/ 数目/ 为/ 9/ 的/ 三维/ 多重/ 数据/ 划分/ 的/ 例子/ ,/ 图中/ 的/ 每个/ 方格/ 表示/ 一个/ 数据/ 块/ ,/ 方格/ 中/ 的/ 数字/ 表示/ 该/ 数据/ 块/ 所属/ 处理机/ ./ 该图/ 体现/ 了/ 多重/ 数据/ 划分/ 的/ 主要/ 特征/ :/ (/ 1/ )/ 给定/ 任意/ 数据/ 层面/ ,/ 每个/ 处理机/ 分配/ 到/ 相同/ 数目/ 的/ 该/ 层面/ 内/ 的/ 数据/ 块/ ;/ (/ 2/ )/ 任意/ 两个/ 相邻/ 数据/ 面/ 之间/ 的/ 通讯/ 可/ 表示/ 为/ 若干/ 置换/ 通讯/ (/ permutationtraffic/ )/ ,/ 这种/ 通讯/ 模式/ 能/ 被/ 当今/ 主流/ 集群/ 网络/ 有效/ 支持/ [/ 9/ ]/ ;/ (/ 3/ )/ 同一/ 维上/ 的/ 置换/ 通讯/ 的/ 置换/ 函数/ 相同/ ,/ 这样/ 每个/ 处理器/ 可以/ 将/ 同一/ 维/ 方向/ 上/ 的/ 多次/ 通讯/ 聚合/ 成/ 一次/ 通讯/ ,/ 从而/ 减少/ 通讯/ 次数/ 提高/ 通讯/ 带宽/ ./ 多重/ 数据/ 划分/ 的/ 核心理念/ 是/ 负载/ 均衡/ ,/ 它/ 保证/ 沿着/ 任意/ 维/ 扫描/ 时/ ,/ 每个/ 处理机/ 的/ 计算/ 量/ 、/ 访/ 存量/ 和/ 通讯/ 量/ 完全/ 相等/ ./ 从/ 直觉/ 上/ 看/ ,/ 负载/ 均/ Page3/ 衡/ 有利于/ 减少/ 处理/ 时间/ ./ 然而/ 实际上/ 对于/ 很多/ 处理机/ 数/ ,/ 多重/ 数据/ 划分/ 会/ 导致/ 一些/ 数据/ 维/ 分割/ 次数/ 过多/ ,/ 从而/ 增加/ 访/ 存量/ 和/ 通讯/ 量/ (/ 详见/ 后文/ 分析/ )/ ./ 为了/ 改进/ 该/ 方法/ ,/ 文本/ 提出/ 均衡/ 数据/ 划分/ ,/ 力求/ 在/ 计算/ 、/ 访存/ 和/ 通讯/ 这/ 3/ 种/ 开销/ 之间/ 取得/ 最佳/ 平衡/ ,/ 从而/ 将/ 整体/ 并行处理/ 时间/ 最小化/ ./ 和/ 多重/ 数据/ 划分/ 一样/ ,/ 均衡/ 数据/ 划分/ 同样/ 适用/ 于/ 使用/ 任意/ 数目/ 处理机/ 并行/ 化/ 任意/ 维/ Line/ -/ Sweep/ 计算/ ./ 本文/ 第/ 2/ 节/ 给出/ 本文/ 使用/ 的/ 通用/ 符号/ 和/ 数据/ 划分/ 的/ 定义/ ;/ 第/ 3/ 节/ 提出/ 均衡/ 数据/ 划分/ ;/ 第/ 4/ 节/ 详述/ 如何/ 生成/ 性能/ 最优/ 的/ 均衡/ 数据/ 划分/ ;/ 第/ 5/ 节/ 给出/ 一个/ 实例/ ;/ 第/ 6/ 节/ 给出/ 实验/ 结果/ ;/ 第/ 7/ 节/ 总结/ 全文/ ./ 2/ 基本概念/ 2.1/ 通用/ 符号/ 为了/ 方便/ 定义/ 概念/ 和/ 展开讨论/ ,/ 本文/ 通用/ 如下/ 符号/ :/ ①/ 若/ / 是/ 有/ 穷集/ ,/ 则/ |/ / |/ 表示/ 其所含/ 元素/ 总数/ ./ ②/ 若/ f/ 是/ 任意/ 函数/ ,/ / 是/ f/ 的/ 定义域/ 的/ 子集/ ,/ 则/ f/ [/ / ]/ =/ {/ f/ (/ x/ )/ |/ x/ ∈/ / }/ ./ ③/ / 表示/ 所有/ 正整数/ 的/ 集合/ ,/ 若/ m/ 是/ 正整数/ 则/ / 的/ 所有/ m/ 维/ 向量/ 的/ 集合/ ./ ④/ / 表示/ 所有/ 非负/ 整数/ 的/ 集合/ ,/ 默认/ 情况/ 下/ 本文/ 所有/ 标量/ (/ 包含/ 向量/ 的/ 分量/ )/ 都/ 属于/ / ,/ 因此/ 文中/ 的/ 闭/ 区间/ [/ a/ ,/ b/ ]/ 表示/ 大于/ 等于/ a/ 且/ 小于/ 等于/ b/ 的/ 所有/ 非负/ 整数/ 的/ 集合/ ./ ⑤/ 设/ m/ ∈/ / ,/ 狓/ =/ (/ x1/ ,/ x2/ ,/ …/ ,/ xm/ )/ ∈/ / ‖/ 狓/ ‖/ xi/ 量/ 狊/ 的/ 每/ 一维/ 分量/ 都/ 小于/ 或/ 等于/ 狓/ 的/ 对应/ 维/ 分量/ ./ ⑥/ d/ 表示/ 待/ 划分/ 数组/ 的/ 维数/ ,/ d/ / 2/ ;/ d/ 维/ 向量/ 狀/ =/ (/ n1/ ,/ n2/ ,/ …/ ,/ nd/ )/ 表示/ 待/ 划分/ 数组/ 各维/ 长度/ ,/ 其中/ 对于/ 任意/ i/ ∈/ [/ 1/ ,/ d/ ]/ ,/ ni/ 表示/ 待/ 划分/ 数组/ 第/ i/ 维/ 的/ 长度/ 且/ 有/ ni/ / 2/ ./ ⑦/ 设/ x/ 和/ y/ 都/ 是/ 正整数/ ,/ 若非/ 负/ 整数/ z/ 满足/ xz/ |/ y/ ∧/ xz/ +/ 1/ |/ // y/ ,/ 则/ z/ 称为/ x/ 在/ y/ 中/ 出现/ 的/ 次数/ ,/ 显/ ,/ / 狓/ =/ {/ 狊/ |/ 狊/ ∈/ / 然/ z/ 存在/ 且/ 唯一/ ,/ 其中/ 符号/ “/ |/ ”/ 表示/ 整除/ ,/ 符号/ “/ |/ // ”/ 表示/ 不能/ 整除/ ./ ⑧/ p/ 表示/ 处理机/ 总数/ ,/ p/ / 2/ ;/ t/ 表示/ p/ 的/ 互/ 异质/ 因子/ 的/ 个数/ ,/ 这些/ 质/ 因子/ 记为/ p1/ ,/ p2/ ,/ …/ ,/ pt/ ;/ 对于/ 任意/ i/ ∈/ [/ 1/ ,/ d/ ]/ ,/ qi/ 表示/ pi/ 在/ p/ 中/ 出现/ 的/ 次数/ ,/ 即/ p/ =/ ∏/ t2/ ./ 2/ 数据/ 划分/ 数据/ 划分/ 探讨/ 如何/ 将/ 目标/ 数组/ 划分/ 成子/ 数组/ 并/ 分配/ 给/ 参与/ 并行/ 的/ 处理机/ ,/ 使得/ 整体/ 效率/ 最佳/ ./ 本文/ 只/ 考虑/ 规则/ 数组/ 的/ 规则/ 数据/ 划分/ ,/ 且/ 不/ 考虑/ 一维/ 数组/ 的/ 数据/ 划分/ ,/ 因为/ 此时/ 只能/ 将/ 唯一/ 的/ 数据/ 维均/ 分给/ 各/ 处理机/ ./ 所谓/ 规则/ 数组/ 是/ 指数/ 组/ 每维/ 的/ 长度/ 是/ 固定值/ ,/ 从/ 直观/ 上/ 看/ ,/ 这样/ 的/ 数组/ 是/ 一个/ 超/ 立方/ (/ Hypercube/ )/ ./ 一个/ d/ 维/ 规则/ 数组/ 中/ 的/ 每个/ 元素/ 可/ 表示/ 为/ d/ 维/ 向量/ 狅/ =/ (/ o1/ ,/ o2/ ,/ …/ ,/ od/ )/ ,/ 其中/ 对于/ 任意/ i/ ∈/ [/ 1/ ,/ d/ ]/ ,/ oi/ 表示/ 该/ 元素/ 在/ 数组/ 中/ 的/ 第/ i/ 维/ 下标/ (/ 从/ 1/ 开始/ 编号/ )/ ,/ 从/ 直观/ 上/ 看/ ,/ oi/ 是/ 该/ 元素/ 在/ 规则/ 数组/ 构成/ 的/ 超/ 立方/ 的/ 第/ i/ 维上/ 的/ 偏移/ ,/ 狅/ 称为/ 数组/ 元素/ 的/ 坐标/ ./ 将/ 规则/ 数组/ 的/ 各维/ 的/ 长度/ 综合/ 表示/ 为/ d/ 维/ 向量/ 狀/ ,/ 则/ 该/ 数组/ 所有/ 元素/ 的/ 坐标/ 构成/ 集合/ / 狀/ ,/ 由于/ 数组/ 元素/ 与其/ 坐标/ 一一对应/ ,/ 因此/ 可以/ 认为/ / 狀/ 就是/ 数组/ 本身/ ./ 所谓/ 规则/ 数据/ 划分/ ,/ 形象/ 地说/ ,/ 就是/ 只/ 考虑/ 以/ 沿着/ 和/ 数组/ 各维/ 垂直/ 的/ 方向/ 一切/ 到底/ 的/ 方式/ 分割/ 数组/ ./ 在/ 只/ 考虑/ 规则/ 数组/ 的/ 规则/ 数据/ 划分/ 的/ 前提/ 下/ ,/ 一个/ 数据/ 划分/ 包含/ 两个/ 内容/ :/ ①/ 确定/ 目标/ 数组/ 的/ 每维/ 被/ 分为/ 几份/ (/ 本文/ 假定/ 目标/ 数组/ 的/ 每维/ 总是/ 被/ 尽量/ 均匀/ 地/ 划分/ )/ ./ ②/ 确定/ 如何/ 将/ 划分/ 形成/ 的/ 数据/ 块/ (/ 即子/ 数组/ )/ 分配/ 给/ 各/ 处理机/ ./ 第一个/ 内容/ 实际上/ 是/ 要/ 确定/ 一个/ d/ 维/ 整数/ 向量/ 狉/ =/ (/ r1/ ,/ r2/ ,/ …/ ,/ rd/ )/ ,/ 其中/ 对于/ 任意/ i/ ∈/ [/ 1/ ,/ d/ ]/ ,/ ri/ 代表/ 数组/ 第/ i/ 维/ 被/ 分成/ 几份/ ./ 考虑/ 到/ 每个/ 数组/ 的/ 第/ i/ 维/ 最/ 多/ 被/ 分割/ 成/ ni/ 块/ ,/ 因此/ 一个/ 合法/ 的/ 数据/ 分割/ 方式/ 狉/ 必/ 属于/ / 狀/ ./ 将/ 被/ 狉/ 分割/ 形成/ 的/ 每个/ 数据/ 块/ 看做/ 一个/ 元素/ ,/ 则/ 所有/ 数据/ 块/ 构成/ d/ 维/ 规则/ 数组/ / 狉/ ./ 因此/ 数据/ 划分/ 的/ 第/ 2/ 个/ 内容/ 实际上/ 是/ 要/ 找到/ 一个/ 从/ / 狉/ 到/ 处理机/ 集合/ [/ 1/ ,/ p/ ]/ 的/ 函数/ ./ 综上所述/ ,/ 规则/ 数组/ 的/ 规则/ 数据/ 划分/ 表述/ 为/ 定义/ 1/ ./ 定义/ 1/ ./ 若/ 狉/ ∈/ / 狀/ ,/ λ/ 是从/ / 狉/ 到/ [/ 1/ ,/ p/ ]/ 的/ 函数/ ,/ 则/ 二元/ 组/ (/ 狉/ ,/ λ/ )/ 是/ 一个/ 规则/ 数据/ 划分/ ,/ 简称/ 数据/ 划分/ ,/ 其中/ 狉/ 称为/ 数据/ 划分/ 向量/ ,/ 简称/ 划分/ 向量/ ,/ λ/ 称为/ 处理机/ 分配/ 函数/ ./ 3/ 均衡/ 数据/ 划分/ 设/ (/ 狉/ ,/ λ/ )/ 是/ 数据/ 划分/ ,/ 其中/ 狉/ =/ (/ r1/ ,/ r2/ ,/ …/ ,/ rd/ )/ ,/ Page4/ 则/ 狉/ 将/ 数组/ 划分/ 成/ 的/ 数据/ 块/ 构成/ 集合/ / 狉/ ,/ 从/ 直观/ 上/ 看/ ,/ / 狉/ 是/ 一个/ d/ 维超/ 立方体/ ,/ 对于/ 任意/ i/ ∈/ [/ 1/ ,/ d/ ]/ ,/ / 狉/ 中/ 第/ i/ 维/ 坐标/ 相等/ 的/ 数据/ 块/ 构成/ 若干/ 与/ 第/ i/ 维/ 垂直/ 的/ i/ -/ 1/ 维超/ 立方体/ ,/ 这些/ i/ -/ 1/ 维超/ 立方体/ 称为/ / 狉/ 在/ 第/ i/ 维上/ 的/ 数据/ 层面/ ,/ 可/ 形式化/ 为/ 定义/ 2/ ./ 显然/ / 狉/ 中/ 同一/ 维上/ 的/ 数据/ 层面/ 包含/ 相同/ 数量/ 的/ 数据/ ,/ 这个/ 性质/ 总结/ 为/ 引理/ 1/ ./ 当沿/ 第/ i/ 维正/ 方向/ 扫描/ 时/ ,/ 由于/ 数据/ 相关/ 只/ 存在/ 于/ 第/ i/ 维正/ 方向/ ,/ 故/ / 狉/ 在/ 第/ i/ 维上/ 的/ 任意/ 数据/ 层面/ 中/ 的/ 数据/ 块/ 可以/ 并行处理/ ,/ 同样/ 由于/ 数据/ 相关性/ 的/ 方向/ 是/ 沿着/ 第/ i/ 维正/ 方向/ ,/ 所以/ 必须/ 依次/ 处理/ 第/ 1/ ~/ ri/ 个/ 数据/ 层面/ ,/ 连续/ 处理/ 的/ 两个/ 数据/ 层面/ 之间/ 有/ 一个/ 边界/ 通讯/ 以/ 保证数据/ 相关性/ ./ 沿第/ i/ 维负/ 方向/ 扫描/ 的/ 情况/ 类似/ ,/ 只是/ 数据/ 层面/ 的/ 处理/ 顺序/ 相反/ ./ 直观/ 上/ 看/ ,/ 任意/ 维上/ 连续/ 处理/ 的/ 两个/ 数据/ 层面/ 相互/ 平行/ ,/ 且/ 它们/ 中/ 的/ 一个/ 可/ 由/ 另/ 一个/ 中/ 的/ 所有/ 数据/ 块/ 沿着/ 该维正/ 方向/ 移位/ 1/ 个/ 单位/ 构成/ ,/ 这样/ 的/ 一对/ 数据/ 层面/ 互/ 称为/ 该维上/ 的/ 相邻/ 数据/ 层面/ (/ 第一个/ 和/ 最后/ 一个/ 数据/ 层面/ 也/ 看作/ 相邻/ ,/ 它们/ 之间/ 通常/ 也/ 需要/ 交换/ 数据/ )/ ./ 相邻/ 的/ 概念/ 参见/ 定义/ 4/ ,/ 其中/ 用到/ 的/ 移位/ 函数/ 及其/ 性质/ 在/ 定义/ 3/ 和/ 引理/ 2/ 中/ 给出/ ./ 定义/ 2/ ./ 设/ 狉/ =/ (/ r1/ ,/ r2/ ,/ …/ ,/ rd/ )/ ∈/ / 狀/ ,/ 给定/ 任意/ i/ ∈/ [/ 1/ ,/ d/ ]/ ,/ 任意/ j/ ∈/ [/ 1/ ,/ ri/ ]/ ,/ 定义/ / 狉/ (/ i/ ,/ j/ )/ =/ {/ (/ s1/ ,/ s2/ ,/ …/ ,/ sd/ )/ |/ (/ s1/ ,/ s2/ ,/ …/ ,/ sd/ )/ ∈/ / 狉/ ∧/ si/ =/ j/ }/ ,/ 则/ / 狉/ (/ i/ ,/ j/ )/ 称为/ / 狉/ 在/ 第/ i/ 维上/ 的/ 第/ j/ 个/ 数据/ 层面/ ./ 引理/ 1/ ./ 给定/ 任意/ 狉/ =/ (/ r1/ ,/ r2/ ,/ …/ ,/ rd/ )/ ∈/ / 狀/ ,/ 任意/ i/ ∈/ [/ 1/ ,/ d/ ]/ ,/ 任意/ j/ ∈/ [/ 1/ ,/ ri/ ]/ ,/ 均/ 有/ |/ / 狉/ (/ i/ ,/ j/ )/ |/ =/ ‖/ 狉/ ‖/ i/ ./ 证明/ ./ 略/ ./ 定义/ 3/ ./ 对于/ 任意/ 狉/ ∈/ / 狀/ 和/ 任意/ i/ ∈/ [/ 1/ ,/ d/ ]/ ,/ 构造/ 双射/ θ/ 狉/ ,/ i/ :/ / 狉/ →/ / 狉/ ,/ θ/ 狉/ ,/ i/ (/ 狓/ )/ =/ (/ 狔/ )/ ,/ 狓/ =/ (/ x1/ ,/ x2/ ,/ …/ ,/ xd/ )/ ,/ 狔/ =/ (/ y1/ ,/ y2/ ,/ …/ ,/ yd/ )/ ,/ yj/ =/ ximodri/ +/ 1/ ,/ j/ =/ i/ θ/ 狉/ ,/ i/ 称为/ / 狉/ 在/ 第/ i/ 维上/ 的/ 移位/ 函数/ ./ 引理/ 2/ ./ 给定/ 任意/ 狉/ =/ (/ r1/ ,/ r2/ ,/ …/ ,/ rd/ )/ ∈/ / 狀/ ,/ 任意/ i/ ∈/ [/ 1/ ,/ d/ ]/ ,/ 任意/ j/ ∈/ [/ 1/ ,/ ri/ ]/ ,/ 均/ 有/ θ/ 狉/ ,/ i/ [/ / 狉/ (/ i/ ,/ j/ )/ ]/ =/ / 狉/ (/ i/ ,/ jmodri/ +/ 1/ )/ ./ 证明/ ./ 略/ ./ 定义/ 4/ ./ 设/ 狉/ ∈/ / 狀/ ,/ 狓/ ∈/ / 狉/ ,/ i/ ∈/ [/ 1/ ,/ d/ ]/ ,/ j/ ∈/ [/ 1/ ,/ ri/ ]/ ,/ 则/ :/ (/ 1/ )/ 狓/ 和/ θ/ 狉/ ,/ i/ (/ 狓/ )/ 在/ 第/ i/ 维上/ 相邻/ ,/ 其中/ θ/ 狉/ ,/ i/ (/ 狓/ )/ 是/ 狓/ 在/ 第/ i/ 维正/ 方向/ 上/ 的/ 相邻/ 数据/ 块/ ,/ 狓/ 是/ θ/ 狉/ ,/ i/ (/ 狓/ )/ 在/ 第/ i/ 维负/ 方向/ 上/ 的/ 相邻/ 数据/ 块/ ./ (/ 2/ )/ / 狉/ (/ i/ ,/ j/ )/ 和/ θ/ 狉/ ,/ i/ [/ / 狉/ (/ i/ ,/ j/ )/ ]/ 在/ 第/ i/ 维上/ 相邻/ ,/ 其中/ θ/ 狉/ ,/ i/ [/ / 狉/ (/ i/ ,/ j/ )/ ]/ 是/ / 狉/ (/ i/ ,/ j/ )/ 在/ 第/ i/ 维正/ 方向/ 上/ 的/ 相邻/ 数据/ 层面/ ,/ / 狉/ (/ i/ ,/ j/ )/ 是/ θ/ 狉/ ,/ i/ [/ / 狉/ (/ i/ ,/ j/ )/ ]/ 在/ 第/ i/ 维负/ 方向/ 上/ 的/ 相邻/ 数据/ 层面/ ./ Line/ -/ Sweep/ 计算/ 总共/ 花费/ 的/ 时间/ 可/ 进一步/ 细分/ 为/ 处理/ 本地/ 数据/ 块/ 的/ 时间/ 和/ 通讯/ 时间/ ,/ 前者/ 简称/ 为/ 本地/ 处理/ 时间/ ./ 如果/ 狉/ 能够/ 保证/ 第/ i/ 维上/ 的/ 每个/ 数据/ 层面/ 所/ 包含/ 的/ 数据/ 块/ 数能/ 被/ p/ 整除/ ,/ 且/ 处理机/ 分配/ 函数/ λ/ 保证/ 这些/ 数据/ 块/ 被/ 均/ 分给/ 各/ 处理机/ ,/ 则/ 沿/ 第/ i/ 维/ 扫描/ 时/ ,/ 每个/ 处理机/ 的/ 计算/ 量/ 、/ 访/ 存量/ 和/ 通讯/ 量/ 是/ 一样/ 的/ ,/ 具有/ 这种/ 性质/ 的/ 数据/ 划分/ 称为/ 在/ 第/ i/ 维/ 负载/ 均衡/ ./ 从/ 直觉/ 上/ 看/ ,/ 负载/ 均衡/ 对/ 性能/ 有利/ ,/ 这/ 正是/ 多重/ 数据/ 划分/ 的/ 核心/ 设计/ 理念/ ,/ 该/ 划分/ 总是/ 保证/ 在/ 每维/ 负载/ 均衡/ ./ 然而/ 为了/ 保证/ 任意/ 数据/ 层面/ 的/ 数据/ 块数/ 能够/ 被/ p/ 整除/ ,/ 给定/ 任意/ k/ ∈/ [/ 1/ ,/ t/ ]/ ,/ p/ 的/ 质/ 因子/ pk/ 在/ 狉/ 的/ 任意/ d/ -/ 1/ 个/ 分量/ 中/ 出现/ 的/ 总数/ 必须/ 大于/ 等于/ qk/ ./ 对于/ 某些/ 处理机/ 数/ ,/ 这会/ 使得/ 各维/ 的/ 划分/ 总数/ 很大/ ,/ 从而/ 导致/ 用于/ 存放/ 边界/ 数据/ 的/ “/ 影像/ 区/ ”/ (/ HALO/ 区/ )/ 占/ 的/ 存储/ 比例/ 增大/ ,/ 进而/ 产生/ 两个/ 后果/ :/ (/ 1/ )/ 在/ 处理/ 本地/ 数据/ 的/ 过程/ 中/ 需要/ 访问/ 影像/ 区/ ,/ 因此/ 影像/ 区/ 占/ 比/ 增加/ 会/ 导致/ 访/ 存量/ 增加/ ,/ 若访/ 存是/ 瓶颈/ 则/ 本地/ 处理/ 时间/ 会/ 增加/ ./ 在/ 现实/ 中/ 由于/ Line/ -/ Sweep/ 计算/ 中/ 单位/ 访/ 存量/ 对应/ 的/ 计算/ 量/ 很/ 低/ ,/ 加上/ 存储/ 墙/ 的/ 存在/ ,/ 所以/ 访存常/ 为/ 瓶颈/ ./ (/ 2/ )/ 影像/ 区为/ 存放/ 交换/ 数据/ 的/ 区域/ ,/ 影像/ 区/ 占/ 比/ 增加/ 会/ 导致/ 通讯/ 量/ 增大/ ,/ 从而/ 增加/ 通讯/ 时间/ ./ 更加/ 详细/ 的/ 例子/ 与/ 性能/ 分析/ 参见/ 第/ 5/ 节/ 的/ 实例/ ./ 通过/ 以上/ 分析/ 可知/ 传统/ 多重/ 数据/ 划分/ 基于/ 负载/ 均衡/ 的/ 设计/ 理念/ 未必/ 能够/ 保证/ 实际/ 性能/ 最优/ ./ 一个/ 理想/ 的/ 数据/ 划分/ ,/ 应该/ 在/ 计算/ 、/ 访存/ 和/ 通讯/ 之间/ 达到最佳/ 平衡/ ,/ 而/ 为了/ 能够/ 找到/ 这样/ 的/ 数据/ 划分/ ,/ 应适当/ 放松/ 传统/ 多重/ 数据/ 划分/ 的/ 条件/ ./ 具体/ 考虑/ 如下/ :/ ①/ 只/ 保证/ 一个/ 数据/ 维上/ 的/ 负载/ 均衡/ ,/ 但/ 保证/ 任意/ 数据/ 层面/ 内/ 的/ 数据/ 块/ 被/ 尽量/ 均匀/ 地/ 分配/ 给/ 各/ 处理机/ ./ 这样/ 设计/ 有利于/ 找到/ 整体/ 性能/ 最佳/ 的/ 数据/ 划分/ ,/ 且/ 能/ 避免/ 穷举/ ,/ 降低/ 算法/ 的/ 复杂度/ ./ ②/ Line/ -/ Sweep/ 程序/ 中/ ,/ 除了/ 沿着/ 数组/ 各维/ 依次/ 扫描/ 之外/ 往往/ 包含/ 一些/ 可以/ 完全/ 并行/ 化/ 的/ 代码/ ,/ 由于/ 传统/ 的/ 多重/ 数据/ 划分/ 保证/ 沿/ 给定/ 维/ 扫描/ 时/ 每个/ 处理机/ 具有/ 固定/ 的/ 通讯/ 对象/ ,/ 因此/ 在/ 完成/ 这些/ 代码/ 后/ 进行/ 交换/ 影像/ 区/ 的/ 通讯/ 时/ ,/ 每个/ 处理器/ 可以/ 将/ 同一/ 维/ 方向/ 上/ 的/ 消息/ 聚合/ 成/ 一次/ 置换/ 通讯/ ,/ 从而/ 减少/ 通讯/ 次数/ 提高/ 通讯/ 带宽/ ./ 然而/ 可/ 作/ 如此/ 优化/ 的/ 通讯/ 量/ 所/ 占/ 比例/ 较/ 小/ ,/ 且/ 在/ 当今/ 的/ 主流/ 并行处理/ 平台/ 上/ ,/ 单次/ 通讯/ 量/ 较/ 小时/ 可以/ 使用/ 计算/ 和/ 通讯/ 相互/ 覆盖/ 的/ 技术/ 大幅/ 减少/ 实际/ 通讯/ Page5/ 时间/ ./ 因此/ 只/ 需要/ 保证/ 相邻/ 数据/ 层面/ 之间/ 的/ 数据通讯/ 可以/ 划分/ 为/ 若干/ 置换/ 通讯/ 即可/ ./ 基于/ 这/ 两个/ 设计/ 原则/ ,/ 本文/ 在/ 定义/ 5/ 中/ 提出/ 均衡/ 数据/ 划分/ ./ 定义/ 5/ ./ 设/ (/ 狉/ ,/ λ/ )/ 是/ 数据/ 划分/ ,/ 其中/ 狉/ =/ (/ r1/ ,/ r2/ ,/ …/ ,/ rd/ )/ ,/ 若/ (/ 狉/ ,/ λ/ )/ 满足/ 以下/ 两个/ 条件/ 则/ 称为/ 均衡/ 数据/ 划分/ :/ (/ 1/ )/ 存在/ 一个/ i/ ∈/ [/ 1/ ,/ d/ ]/ ,/ 使得/ p/ |/ ‖/ 狉/ ‖/ i/ ;/ (/ 2/ )/ 给定/ 任意/ i/ ∈/ [/ 1/ ,/ d/ ]/ ,/ 给定/ 任意/ j/ ∈/ [/ 1/ ,/ ri/ ]/ ,/ 记/ m1/ =/ ‖/ 狉/ ‖/ i/ // p/ ,/ m2/ =/ ‖/ 狉/ ‖/ i/ // p/ ,/ 则/ / 狉/ (/ i/ ,/ j/ )/ 总是/ 可以/ 为/ 表示/ 为/ m2/ 个/ 互不/ 相交/ 的/ 非/ 空子/ 集/ / 1/ ,/ / 2/ ,/ …/ ,/ / m2/ 的/ 合集/ ,/ 且/ 这些/ 子集/ 满足/ :/ ①/ / k/ (/ k/ ∈/ [/ 1/ ,/ m1/ ]/ →/ |/ / k/ |/ =/ p/ )/ ,/ ②/ 给定/ 其中/ 的/ 任意/ 一个/ 子/ 集中/ 的/ 任意/ 两个/ 不同/ 的/ 数据/ 块/ 狊/ 1/ 和/ 狊/ 2/ ,/ 总有/ λ/ (/ 狊/ 1/ )/ ≠/ λ/ (/ 狊/ 2/ )/ 且/ λ/ (/ θ/ 狉/ ,/ i/ (/ 狊/ 1/ )/ )/ ≠/ λ/ (/ θ/ 狉/ ,/ i/ (/ 狊/ 2/ )/ )/ ./ 4/ 均衡/ 数据/ 划分/ 生成/ 算法/ 4.1/ 目标/ 函数/ 记/ 均衡/ 数据/ 划分/ 的/ 数据/ 划分/ 向量/ 为/ 狉/ =/ (/ r1/ ,/ r2/ ,/ …/ ,/ rd/ )/ ,/ 则/ 狉/ 决定/ 了/ / 狉/ 中/ 每个/ 数据/ 层面/ 的/ 数据/ 块数/ 和/ 各/ 数据/ 块/ 的/ 形状/ ,/ 且/ 均衡/ 数据/ 划分/ 总是/ 尽量/ 均匀/ 分配/ 每个/ 数据/ 层面/ 的/ 所有/ 数据/ 块/ ,/ 因此/ 均衡/ 数据/ 划分/ 的/ 本地/ 处理/ 时间/ 仅/ 由/ 其/ 数据/ 划分/ 向量/ 决定/ ,/ 与/ 具体/ 的/ 处理器/ 分配/ 方式/ 无关/ ./ 另外/ 均衡/ 数据/ 划分/ 保证/ 相邻/ 数据/ 层面/ 之间/ 的/ 数据通讯/ 可以/ 表示/ 为/ 若干/ 置换/ 通讯/ ,/ 如果/ 忽略/ 具体/ 置换/ 方式/ 带来/ 的/ 影响/ ,/ 则/ 通讯/ 开销/ 仅/ 取决于/ 影像/ 区/ 的/ 大小/ ,/ 而/ 影像/ 区/ 的/ 大小/ 亦/ 由/ 数据/ 划分/ 向量/ 决定/ ./ 综上所述/ ,/ 对于/ 给定/ 的/ 处理机/ 平台/ ,/ 均衡/ 数据/ 划分/ 的/ 性能/ 仅/ 取决于/ 它/ 的/ 数据/ 划分/ 向量/ ./ 下面/ 探讨/ 数据/ 划分/ 向量/ 狉/ 对/ 实际/ 性能/ 的/ 具体/ 影响/ ,/ 为/ 简化/ 讨论/ ,/ 只/ 探讨/ 沿/ 各维正/ 方向/ 扫描/ 的/ 情况/ ./ 狉/ 将/ 数组/ / 狀/ 分割/ 成/ 的/ 数据/ 块/ 的/ 大小/ 可/ 表示/ 为/ d/ 维/ 向量/ 狊/ =/ (/ s1/ ,/ s2/ ,/ …/ ,/ sd/ )/ ,/ 其中/ 对于/ 任意/ i/ ∈/ [/ 1/ ,/ d/ ]/ 总有/ si/ =/ ni/ // ri/ ;/ 设/ 第/ i/ 维/ 正负/ 方向/ 的/ 数据/ 相关/ 深度/ 相等/ 且/ 记为/ ai/ ,/ 则/ 每个/ 数据/ 子/ 块/ 狊/ 的/ 实际/ 存储/ 区域/ 可/ 表示/ 为/ 狋/ =/ (/ t1/ ,/ t2/ ,/ …/ ,/ td/ )/ ,/ 其中/ 对于/ 任意/ i/ ∈/ [/ 1/ ,/ d/ ]/ 总有/ ti/ =/ si/ +/ 2/ ×/ ai/ ./ 处理/ 每个/ 数据/ 子块/ 时/ 的/ 计算/ 量/ 和/ 访/ 存量/ 分别/ 与/ ‖/ 狊/ ‖/ 和/ ‖/ 狋/ ‖/ 成正比/ ,/ 设/ 处理机/ 单位/ 时间/ 可以/ 完成/ peakcomp/ 个/ 基本/ 运算/ ,/ 访问/ peakmem/ 个/ 基本/ 数据/ ,/ 则/ 每个/ 数据/ 子块/ 的/ 本地/ 处理/ 时间/ Tprocess/ 可以/ 表示/ 为/ 其中/ c1/ 和/ c2/ 都/ 是/ 常数/ ,/ 由/ 程序/ 的/ 特点/ 决定/ ./ 给定/ / 狉/ 中/ 第/ i/ 维上/ 的/ 任一/ 数据/ 层面/ / ,/ 则/ / 包含/ ‖/ 狉/ ‖/ i/ 块/ 数据/ ,/ 每个/ 处理机/ 最/ 多/ 分配/ 到/ ‖/ 狉/ ‖/ i/ // p/ 个/ / 中/ 的/ 数据/ 块/ ,/ 沿第/ i/ 维正/ 方向/ 扫描/ 一次/ 每个/ 数据/ 块/ 需要/ 交换/ 的/ 边界/ 数据量/ 为/ ai/ ×/ ‖/ 狊/ ‖/ i/ 个/ 基本/ 元素/ ,/ 忽略/ 每次/ 通讯/ 时延/ ,/ 记/ 通讯/ 网络/ 的/ 带宽/ 为/ w/ ,/ 考虑/ 到/ 共/ 需/ 处理/ ri/ 个/ 数据/ 层面/ ,/ 则/ 沿/ 第/ i/ 维正/ 方向/ 扫描/ 一次/ 所花/ 的/ 时间/ Ti/ 可以/ 表示/ 为/ Ti/ =/ Tprocess/ +/ c3/ ×/ ai/ ×/ ‖/ 狊/ ‖/ i/ 其中/ c3/ 是/ 常数/ ,/ 由/ 程序/ 的/ 特点/ 决定/ ./ 综合/ 上面/ 两/ 式/ ,/ 令/ T/ 表示/ 沿/ 各维正/ 方向/ 扫描/ 所/ 花费/ 的/ 总/ 时间/ ,/ 则/ 有/ T/ =/ ∑/ d/ 上式/ 中/ peakcomp/ 和/ peakmem/ 以及/ w/ 取决于/ 并行处理/ 平台/ 的/ 硬件/ 特性/ ,/ 可以/ 通过/ 硬件/ 手册/ 获得/ ,/ p/ 为/ 处理器/ 机数/ ,/ d/ 为/ 数据/ 维数/ ,/ 变量/ ai/ 、/ c1/ 、/ c2/ 和/ c3/ 对于/ 给定/ 的/ 程序/ 都/ 是/ 常数/ ,/ 它们/ 的/ 具体/ 值/ 由/ 程序/ 决定/ ;/ 剩下/ 的/ 所有/ 变量/ 都/ 决定/ 于/ 狉/ ./ 沿/ 各维负/ 方向/ 扫描/ 的/ 总/ 时间/ 的/ 计算/ 方式/ 与/ T/ 类似/ ,/ 不再/ 赘述/ ,/ 现将/ 其/ 记为/ T/ ,/ 我们/ 使用/ T/ +/ T/ 作为/ 目标/ 函数/ ,/ 选择/ 能够/ 使/ T/ +/ T/ 最小/ 的/ 均衡/ 数据/ 划分/ 作为/ 最后/ 产生/ 的/ 数据/ 划分/ 方案/ ./ 由于/ T/ 和/ T/ 与/ 均衡/ 数据/ 划分/ 的/ 处理器/ 分配/ 函数/ 无关/ ,/ 本文/ 的/ 算法/ 首先/ 寻找/ 使得/ T/ +/ T/ 最小/ 的/ 均衡/ 数据/ 划分/ 的/ 数据/ 划分/ 向量/ ,/ 然后/ 为/ 得到/ 的/ 数据/ 划分/ 向量/ 构造/ 处理机/ 分配/ 函数/ ./ 在实践中/ ,/ 如果/ 两个/ 不同/ 的/ 划分/ 向量/ 使得/ 目标/ 函数/ 的/ 值/ 相等/ ,/ 则/ 总是/ 选择/ 在/ 连续/ 存储/ 的/ 那个/ 数据/ 维上/ (/ Fortran/ 是/ 第/ 1/ 维/ )/ 分割/ 次数/ 最少/ 的/ 划分/ 向量/ ,/ 因为/ 这样/ 的/ 划分/ 方式/ 更加/ 有利于/ 发挥/ 当前/ 主流/ 体系结构/ 的/ 访存/ 性能/ ./ 以上/ 性能/ 模型/ 同样/ 适用/ 于/ 多重/ 数据/ 划分/ ,/ 但是/ 由于/ 多重/ 数据/ 划分/ 保证/ 任意/ 维上/ 的/ 负载/ 均衡/ ,/ 因此/ 该/ 性能/ 模型/ 可以/ 进一步/ 简化/ ,/ 能/ 使得/ 影像/ 区/ 体积/ 最小/ 的/ 数据/ 划分/ 向量/ 对应/ 的/ 多重/ 数据/ 划分/ 的/ 性能/ 最佳/ ./ 4.2/ 确定/ 数据/ 划分/ 向量/ 设/ 狉/ =/ (/ r1/ ,/ r2/ ,/ …/ ,/ rd/ )/ ∈/ / 狀/ ,/ 狊/ =/ (/ s1/ ,/ s2/ ,/ …/ ,/ sd/ )/ ∈/ / 狀/ ,/ 狊/ ≠/ 狉/ ,/ 对于/ 任意/ i/ ∈/ [/ 1/ ,/ d/ ]/ 都/ 有/ si/ / ri/ 且/ p/ |/ ‖/ 狉/ ‖/ i/ →/ p/ |/ ‖/ 狊/ ‖/ i/ ,/ 则/ 根据/ 4.1/ 节中/ 的/ 性能/ 模型/ 可知/ 狊/ 的/ 性能/ 优于/ 狉/ ,/ 因为/ 狉/ 比/ 狊/ 在/ 第/ i/ 维上/ 多/ 出来/ 的/ 划分/ 次数/ 既/ 不能/ 带来/ 额外/ 的/ 负载平衡/ ,/ 又/ 增加/ 了/ 访/ 存量/ 和/ 通讯/ Page6/ 量/ ./ 在/ 寻找/ 最佳/ 数据/ 划分/ 向量/ 的/ 时候/ ,/ 如果/ 已经/ 考虑/ 过/ 狊/ ,/ 则/ 没有/ 必要/ 再/ 考虑/ 狉/ ./ 不/ 严格/ 地说/ ,/ 在/ 寻找/ 性能/ 最优/ 的/ 均衡/ 数据/ 划分/ 的/ 划分/ 向量/ 时/ ,/ 只/ 需要/ 考虑/ 至少/ 具有/ 相同/ 程度/ 负载/ 均衡/ 的/ 数据/ 划分/ 向量/ 中/ 的/ 各维/ 分量/ 最小/ 的/ 那个/ ,/ 这样/ 的/ 划分/ 向量/ 称为/ 基本/ 数据/ 划分/ 向量/ ,/ 其/ 定义/ 如下/ ./ 定义/ 6/ ./ 设/ 狉/ =/ (/ r1/ ,/ r2/ ,/ …/ ,/ rd/ )/ ∈/ / 狀/ ,/ 若/ 狉/ 满足/ 以下/ 条件/ 则/ 是/ 基本/ 数据/ 划分/ 向量/ ,/ 简称/ 基本/ 划分/ 向量/ :/ (/ 1/ )/ 存在/ 一个/ i/ ∈/ [/ 1/ ,/ d/ ]/ ,/ p/ |/ ‖/ 狉/ ‖/ i/ ;/ (/ 2/ )/ 对于/ 任意/ i/ ∈/ [/ 1/ ,/ d/ ]/ ,/ 不/ 存在/ 狊/ =/ (/ s1/ ,/ s2/ ,/ …/ ,/ sd/ )/ ∈/ / 狀/ 满足/ :/ ①/ 狊/ ≠/ 狉/ ,/ ②/ 对于/ 任意/ i/ ∈/ [/ 1/ ,/ d/ ]/ 均/ 有/ si/ / ri/ 且/ p/ |/ ‖/ 狉/ ‖/ i/ →/ p/ |/ ‖/ 狊/ ‖/ i/ ./ 根据/ 定义/ 6/ 可以/ 推断出/ 基本/ 划分/ 向量/ 的/ 每维/ 分量/ 不/ 含有/ 除了/ p/ 的/ 质/ 因子/ 以外/ 的/ 质数/ ,/ 引理/ 3/ 给出/ 了/ 该/ 性质/ 的/ 证明/ ./ 定理/ 1/ 和/ 定理/ 2/ 总结/ 了/ 基本/ 划分/ 向量/ 中/ p/ 的/ 质/ 因子/ 在/ 各维/ 分量/ 中/ 的/ 分布/ 特点/ ,/ 可/ 根据/ 这/ 两个/ 定理/ 构造/ 产生/ 所有/ 基本/ 划分/ 向量/ 的/ 算法/ ./ 引理/ 3/ ./ 若/ 狉/ 是/ 基本/ 数据/ 划分/ 向量/ ,/ 则/ 狉/ 的/ 任意/ 分量/ 或者/ 等于/ 1/ 或者/ 可以/ 表示/ 为/ p/ 的/ 若干/ 质/ 因子/ 的/ 乘积/ ./ 证明/ ./ 使用/ 反证法/ ./ 设/ 狉/ =/ (/ r1/ ,/ r2/ ,/ …/ ,/ rd/ )/ ∈/ / 狀是/ 基本/ 数据/ 划分/ 向量/ ,/ i/ ∈/ [/ 1/ ,/ d/ ]/ ,/ x/ 是/ 质数/ 且/ 满足/ x/ |/ ri/ ∧/ x/ |/ // p/ ,/ 构造/ 向量/ 狉/ =/ r1/ ,/ …/ ,/ rix/ ,/ …/ ,/ r/ (/ ①/ 若/ p/ |/ ‖/ 狉/ ‖/ i/ ,/ 考虑/ 到/ ‖/ 狉/ ‖/ i/ =/ ‖/ 狉/ ‖/ i/ ,/ 故/ p/ |/ ‖/ 狉/ ‖/ i/ ;/ ②/ 若/ j/ ∈/ [/ 1/ ,/ d/ ]/ ∧/ j/ ≠/ i/ 且/ p/ |/ ‖/ 狉/ ‖/ j/ ,/ 考虑/ 到/ x/ |/ ri/ ∧/ x/ |/ // p/ ,/ 则/ p/ |/ (/ ‖/ 狉/ ‖/ j/ // x/ )/ ,/ 即/ p/ |/ ‖/ 狉/ ‖/ j/ ./ 综合/ ①/ 和/ ②/ 可知/ 对于/ 任意/ k/ ∈/ [/ 1/ ,/ d/ ]/ ,/ 均/ 有/ p/ |/ ‖/ 狉/ ‖/ k/ →/ p/ |/ ‖/ 狉/ ‖/ k/ ,/ 因此/ 狉/ 不是/ 基本/ 数据/ 划分/ 向量/ ,/ 这/ 与/ 题设/ 矛盾/ ./ 证毕/ ./ 定理/ 1/ ./ 设/ 狉/ =/ (/ r1/ ,/ r2/ ,/ …/ ,/ rd/ )/ ∈/ / 狀/ ,/ i/ ∈/ [/ 1/ ,/ d/ ]/ ,/ 则/ 狉/ 是/ 基本/ 数据/ 划分/ 向量/ 且/ 仅/ 在/ 第/ i/ 维/ 满足/ p/ |/ ‖/ 狉/ ‖/ i/ 的/ 充要条件/ 为/ (/ 1/ )/ 若/ d/ =/ 2/ ,/ 则/ 满足/ (/ r1/ =/ 1/ ∧/ r2/ =/ p/ )/ ∨/ (/ r1/ =/ p/ ∧/ (/ 2/ )/ 若/ d/ >/ 2/ ,/ 则/ 满足/ ‖/ 狉/ ‖/ =/ p/ ∧/ ri/ =/ 1/ ∧/ / j/ (/ j/ ∈/ 证明/ ./ 略/ ./ 定理/ 2/ ./ 设/ 狉/ =/ (/ r1/ ,/ r2/ ,/ …/ ,/ rd/ )/ ∈/ / 狀/ ,/ m1/ ,/ m2/ ,/ …/ ,/ ms/ 互异/ 且/ 属于/ [/ 1/ ,/ d/ ]/ ,/ s/ ∈/ [/ 2/ ,/ d/ ]/ ,/ 对于/ 任意/ i/ ∈/ [/ 1/ ,/ t/ ]/ ,/ 任意/ j/ ∈/ [/ 1/ ,/ d/ ]/ ,/ 令/ ai/ ,/ j/ 表示/ pi/ 在/ rj/ 中/ 出现/ 的/ 次数/ ,/ 令/ bi/ =/ ∑/ dai/ ,/ k/ -/ qi/ 则/ 狉/ 是/ 基本/ 数据/ 划分/ 向量/ 且/ / 狉/ 中/ 只有/ 第/ m1/ ,/ m2/ ,/ …/ ,/ ms/ 维上/ 的/ 数据/ 层面/ 包含/ 的/ 数据/ 块/ r2/ =/ 1/ )/ ./ [/ 1/ ,/ d/ ]/ ∧/ j/ ≠/ i/ →/ rj/ ∈/ [/ 2/ ,/ p/ -/ 1/ ]/ )/ ./ k/ =/ 1ai/ ,/ mj/ =/ ai/ ,/ mk/ =/ bi/ )/ ;/ [/ 1/ ,/ t/ ]/ ∧/ ai/ ,/ j/ >/ bi/ )/ ./ 数/ 才能/ 被/ p/ 整除/ 的/ 充分/ 必要条件/ 是/ (/ 1/ )/ / i/ (/ i/ ∈/ [/ 1/ ,/ t/ ]/ →/ bi/ ∈/ [/ 0/ ,/ qi/ ]/ )/ ;/ (/ 2/ )/ / i/ / j/ (/ i/ ∈/ [/ 1/ ,/ t/ ]/ ∧/ j/ ∈/ [/ 1/ ,/ s/ ]/ →/ ai/ ,/ mj/ ∈/ [/ 0/ ,/ bi/ ]/ )/ ;/ (/ 3/ )/ / i/ / j/ / k/ (/ i/ ∈/ [/ 1/ ,/ t/ ]/ →/ j/ ,/ k/ ∈/ [/ 1/ ,/ s/ ]/ ∧/ j/ ≠/ k/ ∧/ (/ 4/ )/ / j/ / i/ (/ j/ ∈/ [/ 1/ ,/ d/ ]/ -/ {/ m1/ ,/ m2/ ,/ …/ ,/ ms/ }/ →/ i/ ∈/ 证明/ ./ 见/ 附录/ ./ 确定/ 均衡/ 数据/ 划分/ 的/ 划分/ 向量/ 首先/ 需要/ 确定/ 哪些/ 维上/ 的/ 数据/ 层面/ 包含/ 的/ 数据/ 块数/ 可以/ 被/ p/ 整除/ ,/ 记/ 这些/ 数据/ 维/ 的/ 集合/ 为/ / =/ {/ m1/ ,/ m2/ ,/ …/ ,/ ms/ }/ ,/ 令/ / =/ [/ 1/ ,/ d/ ]/ -/ / ./ 当/ s/ =/ 1/ 时/ 可以/ 按照/ 定理/ 1/ 直接/ 生成/ p/ 的/ 各质/ 因子/ 在/ 各维/ 的/ 分布/ ./ 当/ s/ / 2/ 时/ 可/ 根据/ 定理/ 2/ 确定/ 各质/ 因子/ 在/ 各维/ 的/ 分布/ ,/ 具体/ 分/ 3/ 步/ :/ ①/ 首先/ 对于/ 每个/ pi/ ,/ i/ ∈/ [/ 1/ ,/ t/ ]/ ,/ 从/ / 中/ 任选/ 2/ 个/ 元素/ ,/ 将/ pi/ 在/ 这/ 两维/ 上/ 出现/ 的/ 次数/ 设置/ 为/ bi/ (/ 最后/ 一步/ 会/ 保证/ bi/ 是/ pi/ 在/ / 中/ 诸维上/ 的/ 出现/ 次数/ 的/ 最大值/ )/ ,/ 根据/ 定理/ 2/ ,/ 若/ s/ =/ 2/ 则/ bi/ =/ qi/ ,/ 若/ s/ >/ 2/ 则/ bi/ ∈/ [/ 0/ ,/ qi/ ]/ ./ ②/ 接下来/ 考虑/ 质/ 因子/ 在/ / 中/ 各维/ 的/ 分布/ ,/ 对于/ 任意/ i/ ∈/ [/ 1/ ,/ t/ ]/ ,/ pi/ 在/ / 中/ 各维上/ 出现/ 的/ 次数/ 之/ 和/ 的/ 取值/ 范围/ 是/ [/ ci/ ,/ qi/ -/ bi/ ]/ ,/ 其中/ ci/ =/ max/ (/ 0/ ,/ qi/ -/ bi/ ×/ (/ s/ -/ 1/ )/ )/ ,/ 记/ pi/ 在/ ei/ 个/ / 中/ 的/ 数据/ 维上/ 的/ 出现/ 次数/ 大于/ bi/ ,/ 则/ ei/ ∈/ [/ max/ (/ 0/ ,/ min/ (/ ci/ -/ bi/ ×/ (/ d/ -/ s/ )/ ,/ 1/ )/ )/ ,/ min/ (/ (/ qi/ -/ bi/ )/ // (/ bi/ +/ 1/ )/ ,/ d/ -/ s/ )/ ]/ ,/ 具体安排/ 质/ 因子/ 分布/ 时/ 只/ 需要/ 保证/ / 中/ 的/ 每个/ 维度/ 上/ 至少/ 有/ 一个/ 质/ 因子/ 的/ 出现/ 次数/ 大于/ 该质/ 因子/ 在/ / 中/ 各维/ 出现/ 次数/ 的/ 最大值/ 即可/ ./ ③/ 最后/ 考虑/ 剩下/ 的/ 数据/ 维/ ,/ 对于/ 任意/ i/ ∈/ [/ 1/ ,/ t/ ]/ ,/ 只/ 需/ 保证/ pi/ 在/ 这些/ 维上/ 出现/ 的/ 次数/ 小于/ 或/ 等于/ bi/ ,/ 且/ pi/ 在/ 所有/ 维上/ 出现/ 的/ 总/ 次数/ 为/ qi/ +/ bi/ ./ 以上/ 产生/ 所有/ 的/ 基本/ 数据/ 划分/ 向量/ 的/ 过程/ 可/ 总结/ 为/ 算法/ 1/ ,/ 为/ 节省/ 空间/ 略去/ 只有/ 一个/ 数据/ 维上/ 的/ 数据/ 层面/ 包含/ 的/ 数据/ 块数/ 可以/ 被/ p/ 整除/ 的/ 情况/ ./ 算法/ 1/ 的/ 复杂度/ 不/ 高于/ 穷举/ 各维/ 分量/ 都/ 能/ 整除/ p/ 的/ d/ 维/ 向量/ ,/ 而/ 根据/ 文献/ [/ 6/ ]/ 的/ 定理/ 1/ ,/ 后者/ 的/ 算法/ 复杂度/ 为/ (/ d/ (/ d/ -/ 1/ )/ // 2/ )/ logp/ (/ 1/ +/ o/ (/ 1/ )/ )/ // loglogp/ ./ 所有/ 集合/ / 的/ 包含/ i/ 个/ 元素/ 的/ 子集/ 的/ 集合/ ;/ 每个/ 数据/ 划分/ 向量/ 表示/ 为/ 一个二维/ 数组/ Config/ [/ 1/ :/ t/ ]/ [/ 1/ :/ d/ ]/ ,/ 给定/ 任意/ i/ ∈/ [/ 1/ ,/ t/ ]/ 和/ j/ ∈/ [/ 1/ ,/ d/ ]/ ,/ Config/ [/ i/ ]/ [/ j/ ]/ 的/ 值/ 表示/ 质/ 因子/ pi/ 在/ 数据/ 划分/ 向量/ 的/ 第/ j/ 维/ 分量/ 中/ 出现/ 的/ 次数/ ,/ Config/ 称为/ “/ 配置/ 数组/ ”/ ;/ GenConf/ (/ Config/ ,/ i/ ,/ Spots/ ,/ / 1/ ,/ / 2/ )/ 是/ 函数/ ,/ 其中/ Config/ 是/ 配置/ 数组/ ,/ i/ ∈/ [/ 1/ ,/ t/ ]/ ,/ Spots/ 是/ [/ 1/ ,/ d/ ]/ 的/ 子集/ ,/ / 1/ ,/ / 2/ 是/ / 的/ 子集/ ,/ GenConf/ 不会/ 修改/ 输入/ 参数/ ,/ 该/ 函数/ 的/ 输出/ 为/ 所有/ 算法/ 1/ 中/ 使用/ 的/ 符号/ 的/ 具体/ 含义/ 如下/ :/ / Page7/ 满足/ 以下/ 条件/ 的/ 配置/ 数组/ NewConfig/ 的/ 集合/ :/ (/ 1/ )/ / k/ / j/ (/ k/ ≠/ i/ →/ NewConfig/ [/ k/ ]/ [/ j/ ]/ =/ Config/ [/ k/ ]/ [/ j/ ]/ )/ ;/ (/ 2/ )/ / j/ (/ j/ ∈/ [/ 1/ ,/ d/ ]/ ∧/ j/ / Spots/ →/ NewConfig/ [/ i/ ]/ [/ j/ ]/ =/ Config/ [/ i/ ]/ [/ j/ ]/ )/ ;/ (/ 3/ )/ / j/ (/ j/ ∈/ Spots/ →/ NewConfig/ [/ i/ ]/ [/ j/ ]/ ∈/ / 1/ )/ ∧/ ∑/ j/ ∈/ SpotsNewConfig/ [/ i/ ]/ [/ j/ ]/ ∈/ / 2/ )/ ./ GenSpotsSet/ (/ Spots/ ,/ / 1/ ,/ / 2/ ,/ …/ ,/ / t/ )/ 也/ 是/ 函数/ ,/ 其中/ Spots/ 是/ [/ 1/ ,/ d/ ]/ 的/ 子集/ ,/ / 1/ ,/ / 2/ ,/ …/ ,/ / t/ 是/ [/ 0/ ,/ d/ ]/ 的/ 子集/ ,/ 该/ 函数/ 的/ 输出/ 为/ 集合/ {/ 〈/ / 1/ ,/ / 2/ ,/ …/ ,/ / t/ 〉/ |/ ∪/ ti/ =/ 1/ / i/ =/ Spots/ ∧/ / i/ (/ i/ ∈/ [/ 1/ ,/ t/ ]/ →/ |/ / i/ |/ ∈/ / i/ ]/ )/ }/ ,/ 其中/ 〈/ / 1/ ,/ / 2/ ,/ …/ ,/ / t/ 〉/ 表示/ 由/ / 1/ ,/ / 2/ ,/ …/ ,/ / t/ 构成/ 的/ 有序/ t/ 元组/ ,/ 〈/ / 1/ ,/ / 2/ ,/ …/ ,/ / t/ 〉/ 简记/ 为/ / 算法/ 1/ ./ 基本/ 数据/ 划分/ 向量/ 生成/ 算法/ (/ s/ / 2/ )/ ./ Config/ [/ 1/ :/ t/ ]/ [/ 1/ :/ d/ ]/ =/ -/ 1/ ;/ / =/ {/ Config/ }/ ;/ / =/ / ;/ / =/ / ;/ / =/ / foreachs/ ∈/ [/ 2/ ,/ d/ ]/ foreach/ / ∈/ / foreachi/ ∈/ [/ 1/ ,/ t/ ]/ foreach/ / ∈/ / foreachb/ ∈/ [/ 0/ ,/ qi/ ]/ foreachConfig/ ∈/ =/ / ;/ / =/ / if/ (/ s/ </ d/ )/ foreachConfig/ ∈/ foreachi/ ∈/ [/ 1/ ,/ t/ ]/ bi/ =/ 0foreachj/ ∈/ / bi/ =/ max/ (/ bi/ ,/ Config/ [/ i/ ]/ [/ j/ ]/ )/ xi/ =/ max/ (/ 0/ ,/ qi/ -/ bi/ ×/ (/ s/ -/ 1/ )/ )/ yi/ =/ max/ (/ 0/ ,/ min/ (/ xi/ -/ bi/ ×/ (/ d/ -/ s/ )/ ,/ 1/ )/ )/ zi/ =/ min/ (/ (/ qi/ -/ bi/ )/ // (/ bi/ +/ 1/ )/ ,/ d/ -/ s/ )/ foreach/ / foreachi/ ∈/ [/ 2/ ,/ t/ ]/ if/ (/ s/ >/ 2/ )/ foreachi/ ∈/ [/ 1/ ,/ t/ ]/ foreachConfig/ ∈/ bi/ =/ 0/ =/ / ;/ / =/ / return4/ ./ 3/ 确定/ 处理机/ 分配/ 设/ 狉/ 是/ 基本/ 数据/ 划分/ 向量/ ,/ 本/ 节/ 探讨/ 如何/ 给/ / 狉/ 中/ 的/ 数据/ 块/ 分配/ 处理机/ ,/ 以/ 保证/ 得到/ 均衡/ 数据/ 划分/ ./ 设/ 狉/ =/ (/ r1/ ,/ r2/ ,/ …/ ,/ rd/ )/ 是/ 基本/ 划分/ 向量/ ,/ 引理/ 4/ 证明/ 存在/ 向量/ 狌/ =/ (/ u1/ ,/ u2/ ,/ …/ ,/ ud/ )/ 满足/ / i/ (/ i/ ∈/ [/ 1/ ,/ d/ ]/ →/ ui/ |/ ri/ )/ ∧/ ‖/ 狌/ ‖/ =/ p/ ,/ 引理/ 4/ 的/ 证明/ 过程/ 给出/ 了/ 狌/ 的/ 构造方法/ ./ 一旦/ 确定/ 狌/ ,/ 可/ 构造/ 向量/ 狊/ =/ (/ s1/ ,/ s2/ ,/ …/ ,/ sd/ )/ ,/ 使得/ 对于/ 任意/ i/ ∈/ [/ 1/ ,/ d/ ]/ 均/ 有/ si/ =/ ri/ // ui/ ./ 将/ 狊/ 看作/ 数组/ / 狉/ 的/ 数据/ 划分/ 向量/ ,/ 则/ 数组/ / 狉/ 被/ 狊/ 分割/ 成/ 的/ 所有/ 子/ 数组/ 构成/ / 狊/ ,/ / 狊/ 中/ 的/ 每个/ 子/ 数组/ 的/ 各维/ 长度/ 可/ 综合/ 表示/ 为/ 狌/ ,/ 为了/ 区分/ 这些/ 子/ 数组/ ,/ 对于/ 任意/ 狏/ ∈/ / 狊/ ,/ 将/ 其/ 对应/ 的/ 子/ 数组/ 记/ 为/ / 狌/ ,/ 狏/ ,/ 则/ / 狌/ ,/ 狏/ / / 狉/ ./ 接着/ 按序/ 执行/ 以下/ 两步/ :/ ①/ 对于/ 任意/ 狏/ ∈/ / 狊/ ,/ 将/ / 狌/ ,/ 狏/ 中/ 的/ 元素/ 按照/ 从/ 低维到/ 高维/ 排序/ 并/ 从/ 1/ 开始/ 编号/ ,/ 并/ 将/ 该/ 编号/ 赋予/ 该/ 元素/ ,/ 考虑/ 到/ / 狌/ ,/ 狏/ 共有/ ‖/ 狌/ ‖/ =/ p/ 个/ 元素/ ,/ 故/ / 狌/ ,/ 狏/ 中/ 的/ 每个/ 元素/ 各自/ 得到/ 一个/ 属于/ [/ 1/ ,/ p/ ]/ 的/ 编号/ ./ ②/ 沿/ / 狊/ 各/ 维/ 正/ 方向/ 依次/ 扫描/ ,/ 在/ 按/ 每维/ 扫描/ 时/ ,/ 依次/ 处理/ 该维上/ 的/ 数据/ 层面/ ./ 具体/ 而言/ ,/ 对于/ 任意/ / 狊/ (/ i/ ,/ j/ )/ ,/ i/ ∈/ [/ 1/ ,/ d/ ]/ ,/ j/ ∈/ [/ 1/ ,/ si/ ]/ ,/ 首先/ 将/ / 狊/ (/ i/ ,/ j/ )/ 中/ 的/ 所有/ 元素/ 按照/ 从/ 低维到/ 高维/ 排序/ 并/ 从/ 1/ 开始/ 编号/ ,/ 对/ 任意/ 狏/ ∈/ / 狊/ (/ i/ ,/ j/ )/ ,/ 记其/ 编号/ 为/ k/ ;/ 然后/ 将/ / 狌/ ,/ 狏/ 中/ 的/ 每个/ 元素/ 的/ 编号/ 在/ / 狌/ ,/ 狏/ 内/ 沿着/ 第/ i/ 维正/ 方向/ 循环/ 移动/ k/ 个/ 单位/ ./ 完成/ 步骤/ ①/ 和/ ②/ 后/ / 狉/ 中/ 的/ 每个/ 数据/ 块/ 有/ 一个/ 属于/ [/ 1/ ,/ p/ ]/ 的/ 编号/ ,/ 将/ 数据/ 块/ 分配/ 给/ 该/ 编号/ 表示/ 的/ 处理机/ 即/ 得到/ 一个/ 均衡/ 数据/ 划分/ ./ 以上/ 分配/ 处理器/ 的/ 方法/ 总结/ 为/ 算法/ 2/ ,/ 其/ 输入/ 为/ 基本/ 数据/ 划分/ 向量/ 狉/ ,/ 算法/ 结束/ 时/ / 狉/ 的/ 任意/ 元素/ 狓/ 所属/ 的/ 处理机/ 编号/ 表示/ 为/ 标量/ 属性/ 狓/ ./ proc/ ./ 算法/ 2/ 中/ 采用/ 的/ 符号/ 含义/ 如下/ :/ ①/ 向量/ 的/ 分量/ 使用/ 相同/ 的/ 字母/ 加上/ 下标/ 表示/ ./ ②/ 对于/ 任意/ i/ ∈/ [/ 1/ ,/ d/ ]/ ,/ k/ ∈/ / ,/ 狓/ ∈/ / 狌/ ,/ θ/ k/ 表示/ 函数/ θ/ 狌/ ,/ i/ 的/ k/ 次/ 复合/ ,/ 从/ 直观/ 上/ 看/ ,/ θ/ k/ 量/ 狓/ 在/ / 狌/ 内/ 沿着/ i/ 维正/ 方向/ 循环/ 移位/ k/ 次/ ./ 算法/ 2/ 的/ 正确性/ 由/ 附录/ 的/ 定理/ 3/ 保证/ ,/ 定理/ 3/ 用到/ 的/ 函数/ 和/ 相关/ 记号/ 在/ 附录/ 中/ 的/ 定义/ 7/ 至/ 定义/ 9/ 中/ 给出/ ,/ 定理/ 3/ 用到/ 的/ 引理/ 5/ 亦/ 在/ 附录/ 中/ 给出/ ./ Page8/ 引理/ 4/ ./ 设/ 狉/ =/ (/ r1/ ,/ r2/ ,/ …/ ,/ rd/ )/ 是/ 基本/ 数据/ 划分/ 向量/ ,/ 则/ 存在/ 狌/ =/ (/ u1/ ,/ u2/ ,/ …/ ,/ ud/ )/ 满足/ / i/ (/ i/ ∈/ [/ 1/ ,/ d/ ]/ →/ ui/ |/ ri/ )/ ∧/ ‖/ 狌/ ‖/ =/ p/ ./ 证明/ ./ 记/ px/ 在/ ry/ 中/ 出现/ 的/ 次数/ 为/ ax/ ,/ y/ ,/ / x/ ∈/ [/ 1/ ,/ t/ ]/ ,/ / y/ ∈/ [/ 1/ ,/ d/ ]/ ./ 因为/ 狉/ 是/ 基本/ 划分/ 向量/ ,/ 故/ 存在/ i/ ∈/ [/ 1/ ,/ d/ ]/ 满足/ p/ |/ ‖/ 狉/ ‖/ i/ ,/ 故/ / j/ (/ j/ ∈/ [/ 1/ ,/ t/ ]/ →/ ∑/ daj/ ,/ i/ / qi/ )/ ./ 对于/ 任意/ j/ ∈/ [/ 1/ ,/ t/ ]/ ,/ 构造/ 整数/ 序列/ xj/ ,/ 1/ ,/ xj/ ,/ 2/ ,/ …/ ,/ xj/ ,/ d/ 满足/ :/ ①/ xj/ ,/ i/ =/ 0/ ,/ ②/ / k/ (/ k/ ∈/ [/ 1/ ,/ d/ ]/ ∧/ k/ ≠/ i/ →/ xj/ ,/ k/ ∈/ [/ 0/ ,/ aj/ ,/ k/ ]/ )/ ,/ ③/ ∑/ dud/ )/ ,/ 其中/ / k/ (/ k/ ∈/ [/ 1/ ,/ d/ ]/ →/ uk/ =/ ∏/ t/ 题设/ 条件/ 的/ 向量/ ./ 算法/ 2/ ./ 处理机/ 分配/ 函数/ 生成/ 算法/ ./ find/ 狌/ =/ (/ u1/ ,/ u2/ ,/ …/ ,/ ud/ )/ satisfying/ / i/ (/ i/ ∈/ [/ 1/ ,/ d/ ]/ →/ ui/ |/ ri/ )/ ∧/ s0/ =/ 1/ ;/ u0/ =/ 1/ ;/ 狊/ =/ r1u1foreach/ 狏/ ∈/ / 狊/ foreach/ 狑/ ∈/ / 狌/ 狑/ =/ (/ (/ v1/ -/ 1/ )/ ×/ u1/ +/ w1/ ,/ (/ v2/ -/ 1/ )/ ×/ u2/ +/ w2/ ,/ …/ ,/ 狑/ ./ proc/ =/ ∑/ dforeachi/ ∈/ [/ 1/ ,/ d/ ]/ foreachj/ ∈/ [/ 1/ ,/ si/ ]/ foreach/ 狏/ ∈/ / 狊/ (/ i/ ,/ j/ )/ k/ =/ ∑/ dforeach/ 狑/ ∈/ / 狌/ 狓/ =/ (/ (/ v1/ -/ 1/ )/ ×/ u1/ +/ w1/ ,/ (/ v2/ -/ 1/ )/ ×/ u2/ +/ w2/ ,/ …/ ,/ 狑/ =/ θ/ k/ 狔/ =/ (/ (/ v1/ -/ 1/ )/ ×/ u1/ +/ w1/ ,/ (/ v2/ -/ 1/ )/ ×/ u2/ +/ w2/ ,/ …/ ,/ 狔/ ./ tmp/ =/ 狓/ ./ procforeach/ 狑/ ∈/ / 狌/ 狓/ =/ (/ (/ v1/ -/ 1/ )/ ×/ u1/ +/ w1/ ,/ (/ v2/ -/ 1/ )/ ×/ u2/ +/ w2/ ,/ …/ ,/ 狓/ ./ proc/ =/ 狓/ ./ tmp/ 定理/ 3/ ./ 设/ 狉/ =/ (/ r1/ ,/ r2/ ,/ …/ ,/ rd/ )/ ∈/ / 狀是/ 基本/ 数据/ 划分/ 向量/ ,/ 狌/ =/ (/ u1/ ,/ u2/ ,/ …/ ,/ ud/ )/ ∈/ / 狀/ ,/ ‖/ 狌/ ‖/ =/ p/ ,/ 狊/ =/ (/ s1/ ,/ s2/ ,/ …/ ,/ sd/ )/ ∈/ / 狀/ ,/ / i/ (/ i/ ∈/ [/ 1/ ,/ d/ ]/ →/ ri/ =/ ui/ ×/ si/ )/ ,/ ε/ :/ / 狌/ →/ [/ 1/ ,/ p/ ]/ 是/ 双射/ ,/ 令/ :/ ι/ :/ / 狉/ →/ / 狌/ ,/ ι/ (/ 狓/ )/ =/ (/ y1/ ,/ y2/ ,/ …/ ,/ yd/ )/ ,/ yi/ =/ α/ ui/ (/ xi/ )/ ,/ / i/ ∈/ [/ 1/ ,/ d/ ]/ ;/ π/ :/ / 狉/ →/ / 狊/ ,/ π/ (/ 狓/ )/ =/ (/ y1/ ,/ y2/ ,/ …/ ,/ yd/ )/ ,/ yi/ =/ β/ ui/ (/ xi/ )/ ,/ λ/ :/ / 狉/ →/ [/ 1/ ,/ p/ ]/ ,/ λ/ (/ 狓/ )/ =/ ε/ / ι/ / δ/ 狌/ ,/ d/ ,/ zd/ / …/ / δ/ 狌/ ,/ 2/ ,/ z2/ / / i/ ∈/ [/ 1/ ,/ d/ ]/ ;/ δ/ 狌/ ,/ 1/ ,/ z1/ (/ 狓/ )/ ,/ zi/ =/ ζ/ 狊/ ,/ i/ (/ π/ (/ 狓/ )/ )/ ,/ / i/ ∈/ [/ 1/ ,/ d/ ]/ ;/ 则/ (/ 狉/ ,/ λ/ )/ 是/ 均衡/ 数据/ 划分/ ./ 证明/ ./ 见/ 附录/ ./ 5/ 实例/ 及其/ 性能/ 分析/ 考虑/ p/ =/ 30/ ,/ d/ =/ 3/ ,/ 待/ 划分/ 数组/ 3/ 维/ 大小/ 都/ 是/ 100/ ,/ 各维/ 正负/ 向上/ 的/ 相关/ 深度/ 都/ 是/ 2/ ,/ 数组/ 按列/ 优先/ 存储/ ./ p/ 共有/ 3/ 个质/ 因子/ 2/ 、/ 3/ 和/ 5/ ,/ 且/ 它们/ 在/ p/ 中/ 的/ 出现/ 次数/ 都/ 是/ 1/ ./ 由于/ 多重/ 数据/ 划分/ 的/ 划分/ 向量/ 需要/ 保证/ 任意/ 维上/ 的/ 数据/ 层面/ 包含/ 的/ 数据/ 块数/ 可以/ 被/ p/ 整除/ ,/ 故/ 每个/ 质/ 因子/ 只有/ (/ 0/ ,/ 1/ ,/ 1/ )/ 、/ (/ 1/ ,/ 0/ ,/ 1/ )/ 、/ (/ 1/ ,/ 1/ ,/ 0/ )/ 3/ 种/ 分布/ 方式/ ,/ 这些/ 向量/ 的/ 第/ i/ 维/ 分量/ 表示/ 对应/ 质/ 因子/ 在/ 数据/ 划分/ 向量/ 的/ 第/ i/ 维上/ 的/ 出现/ 次数/ ,/ 每个/ 质/ 因子/ 的/ 分布/ 方式/ 可以/ 任意/ 搭配/ ,/ 因此/ 共有/ 27/ 种/ 合法/ 的/ 数据/ 划分/ 向量/ ,/ 若/ 考虑/ 对称性/ 则/ 只有/ 5/ 种/ :/ (/ 1/ ,/ 30/ ,/ 30/ )/ 、/ (/ 2/ ,/ 15/ ,/ 30/ )/ 、/ (/ 3/ ,/ 10/ ,/ 30/ )/ 、/ (/ 5/ ,/ 6/ ,/ 30/ )/ 、/ (/ 6/ ,/ 10/ ,/ 15/ )/ ./ 在/ 所有/ 这些/ 数据/ 划分/ 向量/ 中/ ,/ (/ 6/ ,/ 10/ ,/ 15/ )/ 使得/ HALO/ 区/ 占/ 比/ 最小/ ,/ 因此/ 理论/ 上/ 使用/ 此/ 划分/ 向量/ 的/ 多重/ 数据/ 划分/ 性能/ 最好/ ,/ 其/ 对应/ 的/ 处理机/ 分配/ 方式/ 可以/ 参见/ 文献/ [/ 5/ ]/ 的/ 第/ 5/ 小节/ ./ 均衡/ 数据/ 划分/ 除了/ 可以/ 使用/ 多重/ 数据/ 划分/ 的/ 这/ 5/ 种/ 划分/ 向量/ ,/ 还/ 可以/ 采用/ 只/ 保证/ 一维/ 或/ 两维/ 上/ 的/ 数据/ 层面/ 的/ 数据/ 块/ 数能/ 被/ p/ 整除/ 的/ 划分/ 向量/ ,/ 在/ 考虑/ 对称性/ 的/ 情况/ 下/ 还有/ 8/ 种/ 有效/ 划分/ 向量/ :/ (/ 1/ ,/ 1/ ,/ 30/ )/ 、/ (/ 1/ ,/ 5/ ,/ 6/ )/ 、/ (/ 2/ ,/ 2/ ,/ 15/ )/ 、/ (/ 2/ ,/ 15/ ,/ 15/ )/ 、/ (/ 3/ ,/ 3/ ,/ 10/ )/ 、/ (/ 3/ ,/ 10/ ,/ 10/ )/ 、/ (/ 5/ ,/ 5/ ,/ 6/ )/ 、/ (/ 5/ ,/ 6/ ,/ 6/ )/ ./ 若访/ 存是/ 瓶颈/ ,/ 则/ 根据/ 本文/ 4.1/ 节/ 的/ 目标/ 函数/ 可知/ (/ 5/ ,/ 5/ ,/ 6/ )/ 的/ 性能/ 最好/ ./ 令/ 狉/ =/ (/ 5/ ,/ 5/ ,/ 6/ )/ ,/ 下面/ 根据/ 算法/ 2/ 讨论/ 如何/ 为/ 狉/ 确定/ 处理机/ 分配/ 方式/ ./ 令/ 狌/ =/ (/ 1/ ,/ 5/ ,/ 6/ )/ ,/ 则/ 狌/ 的/ 每/ 维/ 分量/ 整除/ 狉/ 的/ 对应/ 分量/ ,/ 且/ 有/ ‖/ 狌/ ‖/ =/ p/ ,/ 算法/ 2/ 中/ 的/ 狊/ =/ r1u1/ 个/ 元素/ 对应/ 于/ / 狉/ 中/ 第/ 1/ 维上/ 的/ 一个/ 数据/ 平面/ ,/ 首先/ 对/ 这些/ 数据/ 平面/ 中/ 的/ 数据/ 块/ 赋/ 初值/ ,/ 得到/ 如下/ 效果/ ,/ 其中/ 对于/ 每个/ 数据/ 层面/ ,/ 第/ 2/ 维/ 的/ 正/ 方向/ 为/ 从左到右/ ,/ 第/ 3/ 维/ 的/ 正/ 方向/ 为/ 从下到上/ :/ 2627282930/ 熿/ 21222324251617181920111213141567891012345/ 燀/ Page92627282930/ 熿/ 212223242516171819201112131415678910/ 燀/ 12345/ 接着/ 沿着/ / 狊/ 的/ 第/ 1/ 维/ 遍历/ ,/ 由于/ 狌/ 的/ 第/ 1/ 维/ 分量/ 为/ 1/ ,/ 处理机/ 标号/ 沿着/ 第/ 1/ 维/ 移动/ 不会/ 产生/ 变化/ ,/ 因此/ 本/ 步骤/ 结束/ 时/ 处理机/ 标号/ 没有/ 变化/ ./ 然后/ 沿着/ / 狊/ 的/ 第/ 2/ 维/ 遍历/ ,/ / 狊/ 在/ 第/ 2/ 维上/ 只有/ 一个/ 数据/ 层面/ ,/ / 狉/ (/ 1/ ,/ 1/ )/ ~/ / 狉/ (/ 1/ ,/ 5/ )/ 在/ / 狊/ 中/ 的/ 标号/ 分别/ 为/ 1/ ~/ 5/ ,/ 它们/ 包含/ 的/ 各/ 数据/ 块/ 的/ 处理机/ 标号/ 分别/ 沿着/ 第/ 2/ 维/ 循环/ 移动/ 1/ ~/ 5/ 次/ ,/ 得到/ 3026272829/ 熿/ 252122232420161718191511121314106789/ 燀/ 512342829302627/ 熿/ 232425212218192016171314151112891067/ 燀/ 34512/ 最后/ 沿着/ / 狊/ 的/ 第/ 3/ 维/ 遍历/ ,/ / 狊/ 在/ 第/ 3/ 维上/ 亦/ 只有/ 一个/ 数据/ 层面/ ,/ / 狉/ (/ 1/ ,/ 1/ )/ ~/ / 狉/ (/ 1/ ,/ 5/ )/ 在/ / 狊/ 中/ 的/ 标号/ 分别/ 为/ 1/ ~/ 5/ ,/ 它们/ 包含/ 的/ 各/ 数据/ 块/ 的/ 处理机/ 标号/ 分别/ 沿着/ 第/ 3/ 维/ 循环/ 移动/ 1/ ~/ 5/ 次/ ,/ 得到/ 最后/ 的/ 处理机/ 分配/ 方案/ :/ 2521222324/ 熿/ 2016171819151112131410678951234/ 燀/ 30262728291314151112/ 熿/ 8910673451228293026272324252122/ 燀/ 1819201617/ 假设/ 沿/ 每维/ 扫描/ 时/ 数组/ 里面/ 的/ 每个/ 元素/ 只/ 访问/ 一次/ ,/ 边界/ 数据/ 只/ 通讯/ 一次/ ,/ 访存/ 相对/ 计算/ 总是/ 瓶颈/ ,/ 通讯/ 时间/ 只/ 和/ 通讯/ 量/ 相关/ 且/ 成正比/ ./ 则/ 根据/ 上/ 一节/ 的/ 讨论/ ,/ 性能/ 最佳/ 的/ 多重/ 数据/ 划分/ 和/ 均衡/ 数据/ 划分/ 的/ 划分/ 向量/ 分别/ 为/ (/ 6/ ,/ 10/ ,/ 15/ )/ 和/ (/ 5/ ,/ 5/ ,/ 6/ )/ ,/ 下面/ 对比/ 二者/ 实际/ 性能/ ,/ 在/ 讨论/ 中/ ,/ 访/ 存量/ 和/ 计算/ 量/ 都/ 以/ 数组/ 元素/ 为/ 单位/ ./ 划分/ 向量/ (/ 6/ ,/ 10/ ,/ 15/ )/ 对应/ 的/ 每个/ 数据/ 子块/ 的/ 实际/ 计算/ 区域/ 大小/ 为/ 17/ ×/ 10/ ×/ 7/ ,/ 实际/ 存储/ 区域/ 大小/ 为/ 21/ ×/ 14/ ×/ 11/ ;/ (/ 5/ ,/ 5/ ,/ 6/ )/ 对应/ 的/ 每个/ 数据/ 子块/ 的/ 实际/ 计算/ 区域/ 大小/ 为/ 20/ ×/ 20/ ×/ 17/ ,/ 实际/ 存储/ 区域/ 大小/ 为/ 24/ ×/ 24/ ×/ 21/ ./ 多重/ 数据/ 划分/ 沿各维/ 正负/ 方向/ 各/ 扫描/ 一次/ ,/ 每个/ 处理机/ 访问/ 的/ 数据/ 块/ 数为/ 6/ ×/ 10/ ×/ 15/ 为/ (/ 21/ ×/ 14/ ×/ 11/ )/ ×/ 180/ =/ 5.82/ ×/ 105/ ;/ 均衡/ 数据/ 划分/ 中/ 每个/ 处理机/ 对应/ 的/ 访问量/ 为/ (/ 24/ ×/ 24/ ×/ 21/ )/ ×/ (/ 5/ +/ 5/ +/ 6/ )/ ×/ 2/ =/ 3.87/ ×/ 105/ ./ 多重/ 数据/ 划分/ 的/ 访/ 存量/ 约/ 为/ 均衡/ 数据/ 划分/ 的/ 1.5/ 倍/ ,/ 这个/ 值/ 也/ 是/ 二者/ 本地/ 处理/ 时间/ 之比/ ./ 就/ 通讯/ 量/ 而言/ ,/ 多重/ 数据/ 划分/ 沿各维/ 正负/ 方向/ 扫描/ 一次/ ,/ 每个/ 数据/ 块/ 需要/ 交换/ 的/ 数据量/ 为/ (/ 10/ ×/ 7/ ×/ 2/ +/ 17/ ×/ 7/ ×/ 2/ +/ 17/ ×/ 10/ ×/ 2/ )/ ×/ 2/ =/ 1436/ ,/ 每个/ 处理机/ 分配/ 到/ 的/ 数据/ 块/ 数为/ 6/ ×/ 10/ ×/ 15Page10/ 故/ 每个/ 处理机/ 的/ 通讯/ 量/ 为/ 1436/ ×/ 30/ ≈/ 4.31/ ×/ 104/ ./ 均衡/ 数据/ 划分/ 沿第/ 1/ 、/ 2/ 、/ 3/ 维/ 任意/ 方向/ 扫描/ 一次/ ,/ 每个/ 处理机/ 的/ 单向/ 通讯/ 量/ 为/ 20/ ×/ 17/ ×/ 2/ ×/ 5/ =/ 3400/ ,/ 20/ ×/ 17/ ×/ 2/ ×/ 5/ =/ 3400/ 和/ 20/ ×/ 20/ ×/ 2/ ×/ 6/ =/ 4800/ ,/ 故沿/ 各维/ 正负/ 方向/ 各/ 扫描/ 一次/ ,/ 每个/ 处理机/ 的/ 单向/ 通讯/ 量/ 为/ (/ 3400/ +/ 3400/ +/ 4800/ )/ ×/ 2/ =/ 2.32/ ×/ 104/ ./ 多重/ 数据/ 划分/ 中/ 每个/ 处理机/ 的/ 通讯/ 量/ 约/ 为/ 均衡/ 数据/ 划分/ 的/ 1.86/ 倍/ ,/ 这个/ 比例/ 也/ 是/ 通讯/ 时间/ 之比/ ./ 综上/ 可知/ ,/ 对于/ 本节/ 的/ 例子/ ,/ 均衡/ 数据/ 划分/ 的/ 性能/ 远高于/ 多重/ 数据/ 划分/ ./ 6/ 实验/ 为了/ 检验/ 均衡/ 数据/ 划分/ 的/ 实际/ 性能/ ,/ 我们/ 将/ 其/ 应用/ 于/ NPB/ (/ NASParallelBenchmarks/ )/ 并行/ 测试/ 包中/ 的/ SP/ 程序/ 和/ 一个/ 实际/ 使用/ 的/ 高分子/ 材料/ 计算/ 程序/ LineABC/ ./ SP/ 和/ LineABC/ 分别/ 使用/ Line/ -/ Sweep/ 模式/ 求解/ 五/ 对角/ 方程组/ 和/ 自洽/ 平均/ 场/ 方程/ [/ 10/ ]/ ./ 测试/ 平台/ 为/ 复旦大学/ 高端/ 计算中心/ 的/ 集群/ ,/ 该/ 系统/ 共有/ 100/ 个/ 计算/ 节点/ ,/ 每个/ 节点/ 是/ 双/ 处理机/ SMP/ ,/ 处理机/ 为/ IntelXeon3/ ./ 06GHz/ ,/ 二级/ Cache/ 大小/ 为/ 512KB/ ;/ 计算/ 节点/ 之间/ 通过/ Myrinet2000/ 高速/ 集群/ 网络/ 互联/ ;/ 操作系统/ 为/ RedHatLinux8/ ./ 0/ ,/ MPI/ 版本/ 为/ MPICH/ -/ GM1/ ./ 2.6/ ,/ 编译器/ 为/ IntelCompiler9/ ./ 1/ ./ 两个/ 测试程序/ 的/ 数据/ 规模/ 都/ 是/ 1203/ ,/ 测试/ 中/ 每个/ 计算/ 节点/ 只/ 使用/ 一个/ 处理机/ ./ 对于/ 给定/ 的/ 应用程序/ 和/ 处理机/ 数/ p/ ,/ 我们/ 首先/ 根据/ 性能/ 模型/ 找到/ 理论/ 性能/ 最佳/ 的/ 多重/ 数据/ 划分/ 和/ 均衡/ 数据/ 划分/ ,/ 其中/ 多重/ 数据/ 划分/ 采用/ 影像/ 区/ 体积/ 最小/ 的/ 划分/ 向量/ ,/ 均衡/ 数据/ 划分/ 采用/ 4.1/ 节/ 的/ 性能/ 模型/ ,/ 然后/ 测试/ 它们/ 的/ 性能/ ./ 对于/ 任意/ x/ / 2/ ,/ 令/ Tx/ 和/ Tx/ 分别/ 表示/ 使用/ x/ 个/ 处理机/ 的/ 多重/ 数据/ 划分/ 和/ 均衡/ 数据/ 划分/ 的/ 实际/ 并行/ 时间/ ,/ 现/ 给定/ 任意/ y/ / 2/ ,/ 若/ 不/ 存在/ z/ ∈/ [/ 2/ ,/ y/ -/ 1/ ]/ 使得/ min/ (/ Tz/ ,/ Tz/ )/ / min/ (/ Ty/ ,/ Ty/ )/ ,/ 则/ y/ 称为/ 有效/ 处理机/ 数/ ,/ 因为/ 处理机/ 的/ 增加/ 不会/ 导致/ 实际/ 性能/ 的/ 下降/ ./ 本节/ 只/ 列出/ 有效/ 处理机/ 数/ 对应/ 的/ 测试数据/ ,/ 因此/ 图/ 3/ ~/ 图/ 6/ 中/ 的/ 处理机/ 数/ 的/ 变化/ 不/ 规律/ ./ 有效/ 处理机/ 数可/ 进一步/ 分类/ :/ 若/ 均衡/ 数据/ 划分/ 和/ 多重/ 数据/ 划分/ 的/ 划分/ 向量/ 一致/ ,/ 则/ 该/ 处理机/ 数归为/ 类别/ I/ ,/ 否则/ 归为/ 类别/ II/ ./ SP/ 程序/ 介于/ 2/ ~/ 100/ 之间/ 的/ 有效/ 处理机/ 数/ 共有/ 31/ 个/ ,/ 其中/ 12/ 个/ 属于/ 类别/ II/ ,/ 占/ 总数/ 的/ 38.7/ %/ ;/ LineABC/ 程序/ 介于/ 2/ ~/ 100/ 之间/ 的/ 有效/ 处理机/ 数/ 共有/ 29/ 个/ ,/ 其中/ 11/ 个/ 属于/ 类别/ II/ ,/ 占/ 总数/ 的/ 37.9/ %/ ./ 图/ 3/ 和/ 图/ 4/ 分别/ 给出/ SP/ 和/ LineABC/ 的/ 属于/ 类别/ I/ 的/ 有效/ 处理机/ 数/ 的/ 并行/ 效率/ (/ 加速/ 比/ 除以/ 处理机/ 数/ )/ ,/ 图/ 5/ 和/ 图/ 6/ 则/ 给出/ 属于/ 类别/ II/ 的/ 并行/ 效率/ ./ 从图/ 3/ 和/ 图/ 4/ 可以/ 看出/ ,/ 当/ 均衡/ 数据/ 划分/ 和/ 多重/ 数据/ 划分/ 的/ 数据/ 分割/ 向量/ 相同/ 时/ ,/ 它们/ 的/ 性能/ 也/ 几乎/ 一致/ ,/ 且/ 在/ 大多数/ 情况/ 下/ 后者/ 性能/ 略优/ ./ 为了/ 方便/ 表示/ 性能/ 差别/ ,/ 对于/ 任意/ 有效/ 处理机/ 数/ p/ ,/ 定义/ diff/ (/ p/ )/ =/ (/ e1/ -/ e2/ )/ // max/ (/ e1/ ,/ e2/ )/ ,/ 其中/ e1/ 和/ e2/ 分别/ 表示/ p/ 所/ 对应/ 的/ 均衡/ 数据/ 划分/ 与/ 多重/ 数据/ 划分/ 的/ 并行/ 效率/ ,/ 则/ SP/ 程序/ 类别/ I/ 中/ 全部/ 有效/ 处理机/ 数/ 的/ diff/ (/ p/ )/ 的/ 平均值/ 为/ -/ 0.78/ %/ ,/ LineABC/ 的/ 对应/ 值为/ -/ 1.96/ %/ ,/ 这种/ 细微/ 的/ 性能/ 差别/ 来源于/ 多重/ 数据/ 划分/ 使用/ 了/ 通讯/ 聚合/ 的/ 优化/ 方法/ ./ 从图/ 5/ 和/ 图/ 6/ 可以/ 看出/ ,/ 对于/ 类别/ II/ 中/ 有效/ 处理机/ 数/ ,/ 均衡/ 数据/ 划分/ 的/ 性能/ 远高于/ 多重/ 数据/ 划分/ ,/ SP/ 的/ diff/ (/ p/ )/ 平均值/ 为/ 44.45/ %/ ,/ Line/ -/ ABC/ 的/ diff/ (/ p/ )/ 平均值/ 为/ 22.15/ %/ ./ Page11/ 对于/ 给定/ 的/ 程序/ 和/ 处理机/ 数/ p/ ,/ 为了/ 进一步/ 理解/ diff/ (/ p/ )/ 的/ 产生/ 原因/ ,/ 可/ 引入/ 相对/ 本地/ 处理/ 时间/ 和/ 相对/ 通讯/ 时间/ 的/ 概念/ :/ 将/ 实际/ 运行/ 时间/ 分为/ 本地/ 处理/ 时间/ 和/ 通讯/ 时间/ 两个/ 部分/ ,/ 并记/ 多重/ 数据/ 划分/ 的/ 本地/ 处理/ 时间/ 为/ benchmark/ (/ p/ )/ ,/ 则/ 多重/ 数据/ 划分/ 或/ 均衡/ 数据/ 划分/ 的/ 本地/ 处理/ 时间/ 与/ benchmark/ (/ p/ )/ 的/ 比值/ 称为/ 该/ 数据/ 划分/ 的/ 相对/ 处理/ 时间/ ,/ 多重/ 数据/ 划分/ 或/ 均衡/ 数据/ 划分/ 的/ 通讯/ 时间/ 与/ benchmark/ (/ p/ )/ 的/ 比值/ 称为/ 该/ 数据/ 划分/ 的/ 相对/ 通讯/ 时间/ ./ 图/ 7/ 和/ 图/ 8/ 显示/ 均衡/ 数据/ 划分/ 不仅/ 减少/ 了/ 通讯/ 时间/ ,/ 也/ 大幅/ 减少/ 了/ 本地/ 处理/ 时间/ ,/ 这/ 主要/ 原因/ 是/ 减少/ 了/ 实际/ 访/ 存量/ ,/ 这些/ 现象/ 和/ 4.1/ 节中/ 的/ 性能/ 模型/ 相符/ ,/ 也/ 进一步/ 印证/ 了/ 性能/ 模型/ 的/ 有效性/ ./ 图/ 8LineABC/ 相对/ 计算/ 和/ 通讯/ 时间/ (/ 类别/ II/ )/ 7/ 总结/ Line/ -/ Sweep/ 计算/ 是/ 众多/ 科学/ 工程/ 计算/ 的/ 核心/ ,/ 由于/ 它/ 具有/ 独特/ 的/ 数据/ 访问/ 模式/ ,/ 故/ 需要/ 为/ 其/ 设计/ 特殊/ 的/ 数据/ 划分/ ./ 多重/ 数据/ 划分/ 是/ 当前/ 并行/ 化/ Line/ -/ Sweep/ 计算/ 的/ 主要/ 数据/ 划分/ ,/ 其/ 核心理念/ 是/ 负载/ 均衡/ ,/ 它/ 要求/ 每个/ 数据/ 层面/ 的/ 数据/ 块数/ 恰好/ 是/ 处理机/ 数/ 的/ 倍数/ ,/ 对于/ 某些/ 处理机/ 数/ ,/ 这会/ 导致/ 一些/ 数据/ 维/ 分割/ 次数/ 过多/ ,/ 从而/ 增加/ 访/ 存量/ 和/ 通讯/ 量/ ./ 此时/ 以/ 少量/ 计算/ 开销/ 的/ 增加/ 换取/ 大量/ 访存/ 和/ 通讯/ 开销/ 的/ 减少/ ,/ 则/ 可能/ 获得/ 更好/ 的/ 整体/ 性能/ ./ 基于/ 该/ 思想/ ,/ 我们/ 提出/ 均衡/ 数据/ 划分/ ,/ 该/ 划分/ 和/ 多重/ 数据/ 划分/ 一样/ 亦/ 能/ 使用/ 任意/ 数目/ 处理机/ 并行/ 化/ 任意/ 维/ Line/ -/ Sweep/ 计算/ ,/ 且/ 能够/ 全局/ 平衡/ 计算/ 、/ 访存/ 和/ 通讯/ 开销/ ,/ 从而/ 达到最佳/ 整体/ 性能/ ./ 本中/ 首先/ 为/ 均衡/ 数据/ 划分/ 建立/ 性能/ 模型/ ,/ 根据/ 该/ 模型/ 均衡/ 数据/ 划分/ 的/ 性能/ 只/ 取决于/ 数据/ 划分/ 向量/ ,/ 因此/ 我们/ 求解/ 最佳/ 均衡/ 数据/ 划分/ 的/ 算法/ 可/ 分为/ 两步/ :/ 第/ 1/ 步/ 确定/ 理论/ 性能/ 最佳/ 的/ 数据/ 划分/ 向量/ ,/ 在/ 实际/ 应用/ 中/ ,/ 这/ 一步/ 很快/ ,/ 以/ 三维/ 数据/ 划分/ 为例/ ,/ 为/ 103/ 量级/ 的/ 处理机/ 数目/ 寻找/ 最佳/ 数据/ 分割/ 向量/ 所/ 耗费/ 的/ 时间/ 为/ 毫秒/ 量级/ ;/ 第/ 2/ 步/ 确定/ 处理机/ 分配/ 函数/ ,/ 给定/ 任意/ 在/ 第/ 1/ 步中/ 找到/ 的/ 数据/ 分割/ 向量/ ,/ 该/ 函数/ 能够/ 保证/ 最终/ 得到/ 均衡/ 数据/ 划分/ ./ 为了/ 检验/ 均衡/ 数据/ 划分/ 的/ 实际/ 性能/ ,/ 我们/ 将/ 其/ 应用/ 于/ NPB/ 并行/ 测试/ 包中/ 的/ SP/ 程序/ 和/ 高分子/ 材料/ 计算/ 程序/ LineABC/ ./ 实验/ 结果表明/ ,/ 均衡/ 数据/ 划分/ 具有/ 更/ 高/ 和/ 更/ 稳定/ 的/ 性能/ ./ 

