Page1/ 网络/ 协同/ 取证/ 计算/ 研究/ 张有/ 东/ 1/ )/ ,/ 2/ )/ ,/ 3/ )/ 曾庆凯/ 1/ )/ ,/ 2/ )/ 王建东/ 4/ )/ 1/ )/ (/ 南京大学/ 计算机软件/ 新/ 技术/ 国家/ 重点/ 实验室/ 南京/ 210093/ )/ 2/ )/ (/ 南京大学/ 计算机科学/ 与/ 技术/ 系/ 南京/ 210093/ )/ 3/ )/ (/ 淮阴/ 工学院/ 计算机/ 工程系/ 江苏/ 淮安/ 223003/ )/ 4/ )/ (/ 南京航空航天大学/ 信息科学/ 与/ 技术/ 学院/ 南京/ 210016/ )/ 摘要/ 网络/ 取证/ 面临/ 着/ 复杂/ 多样/ 的/ 网络/ 入侵/ 环境/ ,/ 尤其/ 是/ 对于/ 复合/ 攻击/ 的/ 取证/ ,/ 为此/ 提出/ 了/ 网络/ 协同/ 取证/ 计算/ 新/ 概念/ ./ 通过/ 对/ 传统/ 的/ 函数/ 依赖/ 关系/ 理论/ 的/ 扩展/ ,/ 提出/ 了/ 以/ 一定/ 概率/ 相/ 依赖/ 的/ 概率函数/ 依赖/ 关系/ 及其/ 分析方法/ 与/ 算法/ ,/ 进而/ 结合/ 贝叶斯/ 网络理论/ 、/ 报警/ 关联/ 分析/ 技术/ 和/ 对/ K2/ 算法/ 的/ 改进/ ,/ 提出/ 了/ 一种/ 网络/ 协同/ 取证/ 分析/ 算法/ ,/ 算法/ 通过/ 对元/ 报警/ 事件/ 的/ 聚类/ 和/ 综合/ 不同/ 的/ 网络/ 取证/ 数据源/ ,/ 能够/ 直观/ 地/ 再现/ 复杂/ 网络攻击/ 的/ 犯罪/ 场景/ ,/ 有效/ 地/ 实现/ 网络/ 取证/ 分析/ ;/ 而且/ 即使/ 在/ 部分/ 数据/ 缺失/ 情况/ 下/ ,/ 算法/ 也/ 可/ 推理/ 攻击/ 的/ 发生/ 过程/ ./ 关键词/ 协同/ 取证/ ;/ 复合/ 攻击/ ;/ 概率函数/ 依赖/ ;/ 贝叶斯/ 网络/ ;/ 犯罪/ 场景/ 1/ 引言/ 对于/ 复杂/ 的/ 网络/ 入侵/ ,/ 其/ 攻击行为/ 往往/ 是/ 分步/ 、/ 多变/ 或/ 综合/ 的/ ,/ 对/ 其/ 入侵/ 行为/ 的/ 认定/ 需要/ 对/ 不同/ 网络安全/ 设施/ 获取/ 的/ 信息/ 进行/ 关联/ 分析/ ,/ 才/ 可能/ 重构/ 入侵者/ 的/ 入侵/ 过程/ ,/ 获得/ 其/ 犯罪/ 证据/ ./ 事实上/ ,/ 对于/ 复杂/ 的/ 案件/ ,/ 法律/ 上/ 更/ 关注/ 证据/ 之间/ 的/ 关联性/ ,/ 对于/ 计算机网络/ 犯罪/ 而言/ ,/ 有/ 因果关系/ 的/ 、/ 相互/ 确证/ 的/ 多个/ 独立/ 证据/ 之间/ 的/ 关联/ 也/ 有利于/ 重建/ 攻击/ 过程/ ./ 定义/ 1/ ./ 协同/ 取证/ (/ coordinativeforensics/ )/ 计算/ 是/ 指/ 从/ 目标/ 系统/ 所有/ 可/ 利用/ 资源/ 中/ 发现/ 、/ 关联/ 、/ 解释/ 、/ 分析/ 信息/ ,/ 以/ 确定/ 证据/ 因果关系/ 、/ 再现/ 网络/ 犯罪/ 场景/ 的/ 过程/ 并/ 形成/ 证据/ 链/ ,/ 从而/ 支持/ 法庭/ 举证/ ./ 网络/ 取证/ 系统/ 需要/ 保存/ 大量/ 的/ 不同/ 来源/ 的/ 数据/ ,/ 这些/ 保存/ 的/ 数据/ 并/ 不/ 直接/ 等同于/ 举证/ 证据/ ,/ 一般/ 地/ 可以/ 认为/ 是/ 一种/ 疑似/ 证据/ ,/ 协同/ 取证/ 计算/ 是/ 一种/ 事后/ 取证/ 分析/ ,/ 是/ 通过/ 对/ 保存/ 的/ 疑似/ 证据/ 的/ 分析/ ,/ 再现/ (/ 重构/ )/ 攻击/ 的/ 场景/ (/ 或/ 犯罪/ 场景/ )/ ,/ 从中/ 发现/ 真正/ 的/ 犯罪/ 证据/ ./ 在/ 入侵/ 检测/ 技术/ 的/ 研究/ 中/ ,/ 已经/ 提出/ 了/ 对/ 攻击/ 场景/ 的/ 构建/ 问题/ 及/ 报警/ 关联/ 分析/ 技术/ ./ 本文/ 从/ 对/ 报警/ 关联/ 分析/ 技术/ 研究/ 着手/ ,/ 提出/ 了/ 一种/ 基于/ 贝叶斯/ 网络/ (/ BayesianNetwork/ ,/ BN/ )/ 的/ 协同/ 取证/ 计算/ 算法/ CFA/ ,/ CFA/ 的/ 核心思想/ 是/ 通过/ 概率函数/ 依赖/ 关系/ 分析/ ,/ 对/ K2/ 算法/ 的/ 先验/ 假设/ 进行/ 改进/ ,/ 并/ 将/ 无/ 丢失/ 数据处理/ 的/ K2/ 算法/ 扩展/ 到/ 对/ 不/ 完整/ 数据/ 的/ 处理/ ,/ 使/ 之/ 适用/ 于/ 网络/ 电子/ 证据/ 的/ 分析/ ./ CFA/ 可以/ 综合/ 多方/ 数据源/ ,/ 实现/ 犯罪/ 场景/ (/ crimescenario/ )/ 再现/ ./ 2/ 报警/ 关联/ 分析/ 技术/ 2000/ 年/ 第一次/ 大规模/ 的/ DDoS/ 攻击/ 引发/ 了/ 对/ 报警/ 关联/ (/ alertcorrelation/ )/ 分析/ 技术/ 的/ 研究/ ,/ 并/ 受到/ 越来越/ 多/ 的/ 关注/ ./ 报警/ 关联/ 指对/ 入侵/ 报警/ 信息/ 进行/ 组合/ 、/ 解释/ 和/ 分析/ ,/ 以/ 识别/ 攻击/ 和/ 进行/ 攻击/ 场景/ 重构/ ./ 入侵/ 报警/ 信息/ 可以/ 是/ 来自/ 同一个/ IDS/ 的/ ,/ 也/ 可以/ 是/ 来自/ 不同/ 的/ IDS/ 甚至/ 异构/ 的/ IDS/ ./ 报警/ 关联/ 分析/ 起初/ 主要/ 是/ 对/ 来自/ 于/ 同一个/ IDS/ 产生/ 的/ 报警/ (/ 消息/ )/ ,/ 通过/ 报警/ 属性/ 值/ 之间/ 的/ 相似性/ 对/ 报警/ 进行/ 聚类/ ,/ 使得/ 每个/ 聚类/ 的/ 报警/ 集合/ 具有/ 某些/ 相同/ 的/ 特性/ [/ 1/ ]/ ./ 这种/ 方法/ 不能/ 完全/ 揭示/ 相关/ 报警/ 之间/ 的/ 因果/ 联系/ ,/ 无法/ 进行/ 入侵/ 的/ 意图/ 识别/ 和/ 入侵/ 行为/ 预测/ ./ 为此/ ,/ 研究者/ 提出/ 了/ 复合/ 攻击/ 的/ 概念/ ,/ 认为/ 一些/ 复杂/ 的/ 攻击/ 是/ 由/ 若干/ 单步/ 攻击/ 按照/ 一定/ 的/ 逻辑关系/ 、/ 在/ 特定/ 的/ 时间/ 和/ 空间/ 形成/ 的/ 一个/ 攻击/ 序列/ ,/ 这里/ 的/ 每个/ 单步/ 攻击/ 是/ 指/ 一个/ 独立/ 的/ 、/ 不可分割/ 的/ 攻击行为/ ,/ 而/ 综合/ 多个/ 原始/ 报警/ 或/ 其它/ 元/ 报警/ 所/ 产生/ 的/ 报警/ ,/ 称为/ 超/ 报警/ 事件/ 或元/ 报警/ 事件/ (/ HyperAlertEvent/ 或/ MetaAlertEvent/ )/ [/ 2/ ]/ ,/ 超/ 报警/ 概念/ 的/ 提出/ 有利于/ 构造/ 层次化/ 的/ 报警/ 聚合/ 与/ 关联/ ./ 在/ 此基础/ 上/ ,/ 研究者/ 又/ 提出/ 了/ 入侵/ 事件/ 关联/ 方法/ [/ 3/ ]/ ,/ 将/ 每个/ 入侵/ 检测/ 传感器/ 产生/ 的/ 、/ 由于/ 入侵/ 行为/ 而/ 引发/ 的/ 报警/ 称为/ 一个/ 事件/ ./ 入侵/ 事件/ 关联/ 是/ 对/ 单个/ 或/ 多个/ IDS/ 的/ 传感器/ 产生/ 的/ 事件/ 进行/ 再/ 组织/ 和/ 再/ 分析/ 以/ 发现/ 攻击行为/ 的/ 过程/ ./ 报警/ 事件/ 关联/ 扩大/ 了/ IDS/ 的/ 检测/ 范围/ ,/ 尤其/ 是/ 在/ 大型/ 的/ 交换式/ 网络系统/ 中/ ./ 目前/ 已经/ 提出/ 了/ 许多/ 报警/ 关联/ 算法/ ,/ 对于/ 大型/ 网络/ 上/ 的/ 复杂/ 的/ 攻击/ ,/ 研究者/ 提出/ 了/ 用/ 图示/ 的/ 方法/ 来/ 表示/ 一个/ 攻击/ 的/ 过程/ 从而/ 再现/ 攻击/ ,/ 一些/ 研究/ 论文/ 称之为/ 攻击/ 场景/ (/ attackscenario/ )/ [/ 4/ ]/ 或/ 攻击/ 图/ [/ 5/ ]/ 的/ 重构/ ./ 但/ 实际上/ 这/ 类/ 算法/ 主要/ 是/ 基于/ 融合/ 技术/ 产生/ 超/ 报警/ ,/ 并/ 构造/ 超/ 报警/ 的/ 关联/ 图/ ,/ 而/ 所谓/ 的/ 场景/ 也/ 就是指/ 此/ 关联/ 图/ ,/ 它/ 并/ 不/ 等同于/ 网络/ 取证/ 所/ 要求/ 的/ 原始/ 的/ 攻击/ 现场/ ./ 文献/ [/ 6/ ]/ 从/ 网络/ 取证/ 的/ 需求/ 出发/ ,/ 提出/ 了/ 通过/ 证据/ 图/ 进行/ 网络/ 取证/ 分析/ 的/ 方法/ ,/ 该/ 方法/ 将/ 整个/ 系统/ 分为/ 攻击者/ (/ attacker/ )/ 、/ 受害者/ (/ victim/ )/ 、/ 跳板/ 主机/ (/ steppingstone/ )/ 和/ 后台/ 攻击者/ (/ backgroundattacker/ )/ 4/ 类/ 角色/ ,/ 首先/ 对/ 报警/ 事件/ 进行/ 时序/ 聚类/ ,/ 然后/ 将/ 聚类/ 结果/ 用/ 图示/ 的/ 方法/ 表示/ ,/ 即/ 表示/ 为/ 证据/ 图/ ,/ 最后/ 在/ 专家/ 干预/ 下/ ,/ 在/ 证据/ 图上/ 进行/ 推理/ 取证/ ,/ 这/ 实际上/ 是/ 一种/ 将/ 攻击/ 事件/ 聚类/ 后/ 可视化/ 的/ 方法/ ./ 3/ 协同/ 取证/ 计算/ 基本/ 思想/ 如前所说/ ,/ 现代/ 网络攻击/ 大多数/ 不是/ 孤立/ 的/ 行为/ ,/ 往往/ 是/ 经过/ 多个/ 单步/ 攻击/ 后/ 才能/ 完成/ 的/ 一种/ 复合/ 攻击/ ./ 如图/ 1/ 表示/ 的/ 一个/ 实际/ 攻击/ 过程/ [/ 7/ ]/ ,/ 该/ 过程/ 分为/ 5/ 个/ 步骤/ :/ 地址/ 探测/ 、/ 端口扫描/ 、/ 获取/ 口令/ 文件/ 、/ 口令/ 破解/ 和/ 登录/ 系统/ ./ 图中/ 每个/ 节点/ 代表/ 某种/ 攻击方式/ ,/ 攻击/ 的/ 每/ 一步/ 都/ 有/ 多种/ 方式/ 可/ 供选择/ ,/ 攻击者/ 只要/ 成功/ 地/ 使用/ 其中/ 一种/ 即可/ 实施/ 该步/ 攻击/ ./ 对/ 这种/ 复合/ 攻击/ 的/ 取证/ 是/ 对/ 网络/ 取证/ 提出/ 的/ 新/ 的/ 挑战/ ,/ 现有/ 网络/ 取证/ 技术/ 还/ 没有/ 涉及/ 对/ 该/ 问题/ 的/ 研究/ ./ 图/ 1/ 反映/ 的/ 是/ 一个/ 因果关系/ 图/ ,/ 但是/ 要/ 发现/ 这个/ 因果关系/ 图/ ,/ 需要/ 在/ 海量/ 的/ 信息/ 中/ 进行/ 因果/ 数据/ Page3/ 挖掘/ ./ 然而/ 数据挖掘/ 算法/ 大都/ 是/ 对/ 事物/ 间/ 的/ 统计/ 关联/ 关系/ 的/ 挖掘/ ,/ 如/ 关联/ 规则/ 挖掘/ 、/ 聚类/ 、/ 分类/ 等/ ,/ 都/ 没图/ 1/ 一个/ 复合/ 攻击/ 实例/ 因果/ 贝叶斯/ 网络/ 学习/ 理论/ 的/ 发展/ 为/ 因果/ 知识/ 发现/ 的/ 研究/ 提供/ 了/ 契机/ ,/ 基于/ 因果/ 贝叶斯/ 网络/ 学习/ 理论/ 的/ 知识/ 发现/ 能够/ 进一步/ 获得/ 对/ 事物/ 的/ 因果/ 本质/ 的/ 认识/ ,/ 是/ 对/ 统计数据/ 的/ 更/ 高层次/ 的/ 因果/ 知识/ 的/ 发现/ ./ 分析/ 图/ 1/ ,/ 它/ 实际上/ 是/ 一个/ 典型/ 的/ 包含/ 隐藏/ 变量/ 的/ 因果/ 贝叶斯/ 网络/ ,/ 在/ 前/ 3/ 步/ 攻击/ 之间/ 都/ 可以/ 认为/ 是/ 隐藏/ 了/ 隐藏/ 变量/ L1/ 、/ L2/ 和/ L3/ (/ 图略/ )/ ./ 本文/ 所/ 提出/ 的/ CFA/ 算法/ 是/ 基于/ 贝叶斯/ 网络/ 进行/ 因果/ 分析/ 的/ 协同/ 取证/ 计算方法/ ,/ 它/ 通过/ 对/ 综合/ 多个/ 原始/ 报警/ 或/ 其它/ 元/ 报警/ 所/ 产生/ 的/ 元/ 报警/ 事件/ 的/ 分析/ ,/ 生成元/ 报警/ 贝叶斯/ 网络/ ,/ 从而/ 反映/ 更/ 高层次/ 的/ 因果/ 知识/ ,/ 实现/ 犯罪/ 场景/ 的/ 重构/ 与/ 事后/ 取证/ ./ 算法/ 的/ 基本/ 步骤/ 为/ 1/ ./ 数据/ 预处理/ ,/ 对/ 不同/ 证据/ 源/ 的/ 原始/ 事件/ 经过/ 预处理/ 转换/ 为/ 统一/ 的/ 标准/ 报警/ 数据格式/ IDMEF/ ,/ 形成/ 标准/ 原始/ 事件/ ;/ 2/ ./ 对/ 标准/ 原始/ 事件/ 聚类/ 形成/ 元/ 事件/ ;/ 3/ ./ 用/ 贝叶斯/ 网络/ 对元/ 事件/ 进行/ 因果/ 分析/ ;/ 4/ ./ 重构/ 攻击/ 场景/ ./ 下面/ 将/ 分析/ CFA/ 算法/ 的/ 理论/ 基础/ 与/ 核心/ 组成/ ./ 4/ 贝叶斯/ 网络/ 基本原理/ 4.1/ 贝叶斯/ 网络/ 模型/ 贝叶斯/ 网络/ 最早/ 是/ 由/ Pearl/ 提出/ 的/ ,/ 它/ 模拟/ 人/ 的/ 认知/ 思维/ 推理/ 模式/ ,/ 用/ 一组/ 条件/ 概率函数/ 以有/ 向/ 无/ 环图/ (/ directedacyclicgraph/ )/ 形式/ 表示/ 因果/ 推理模型/ ./ 它/ 由/ 两/ 部分/ 组成/ :/ (/ 1/ )/ 贝叶斯/ 网络结构/ (/ G/ )/ ./ G/ 的/ 每个/ 节点/ 代表/ 对象/ 的/ 一个/ 属性/ 变量/ ,/ 变量/ 可以/ 是/ 离散/ 的/ 或/ 连续/ 的/ ;/ G/ 的/ 每条/ 弧/ 代表/ 一个/ 概率/ 依赖/ 关系/ ./ (/ 2/ )/ 每个/ 变量/ 对应/ 的/ 条件/ 概率分布/ (/ CPD/ )/ ./ 当/ 变量/ 有/ 涉及/ 到/ 事物/ 之间/ 的/ 底层/ 因果/ 结构/ ./ 为/ 离散/ 变量/ 时/ ,/ 常用/ 条件/ 概率/ 表/ (/ CPT/ )/ 来/ 表示/ ./ 考虑/ 离散/ 变量/ 的/ 情况/ ,/ 设有/ n/ 维/ 训练/ 数据/ 集/ Ξ/ ,/ V/ =/ {/ V1/ ,/ V2/ ,/ …/ ,/ Vk/ }/ 是/ 贝叶斯/ 网络/ 中/ 的/ 节点/ ,/ 离散/ 变量/ Vi/ 的/ vi/ 个/ 状态/ 对应/ 于/ vi/ 种/ 可能/ 的/ 模型/ 结构/ ,/ 用/ p/ (/ vi/ )/ 表示/ 其/ 概率分布/ ,/ 变量/ Vi/ 的/ CPT/ 说明/ 条件/ 分布/ p/ (/ Vi/ |/ Ξ/ )/ ./ 对于/ 每/ 一种/ 模型/ 结构/ vi/ ,/ 存在/ 一个/ 连续/ 向/ 量值/ 变量/ θ/ vi/ ,/ 其中/ θ/ vi/ 值/ 对应/ 的/ 是/ 可能/ 模型/ 的/ 真实/ 参数/ ./ 对于/ θ/ vi/ ,/ 使用/ 概率密度函数/ p/ (/ θ/ vi/ |/ vi/ )/ 进行/ 编码/ ./ 则/ 对/ 每个/ vi/ 和/ θ/ vi/ 使用/ 贝叶斯/ 规则/ 计算/ 其后/ 验/ 概率分布/ 如下/ :/ Vj/ 的/ 双亲/ (/ 父/ 节点/ )/ ,/ Vj/ 是/ Vi/ 的/ 后继/ ./ 定义/ 2/ ./ 如果/ 一条/ 弧由/ 节点/ Vi/ 到/ Vj/ ,/ 则/ Vi/ 是/ 假设/ 1/ ./ 条件/ 独立性/ 假设/ :/ 给定/ 双亲/ ,/ 假设/ 贝叶斯/ 网络/ 的/ 每个/ 变量/ 条件/ 独立/ 于/ 图/ 中/ 的/ 非/ 后继/ ,/ 即图/ 中/ 的/ 每个/ 节点/ Vi/ 条件/ 独立/ 于/ 由/ Vi/ 的/ 双亲/ 节点/ 给定/ 的/ Vi/ 的/ 非/ 后代/ 节点/ 构成/ 的/ 任何/ 节点/ 子集/ ./ 设/ A/ (/ Vi/ )/ 是/ 图/ 中非/ Vi/ 后代/ 节点/ 的/ 任何/ 节点/ 集合/ ,/ 设/ Pa/ (/ Vi/ )/ 是/ 图/ 中/ Vi/ 的/ 直接/ 双亲/ ,/ 则/ p/ (/ vi/ |/ A/ (/ Vi/ )/ ,/ Pa/ (/ Vi/ )/ )/ =/ p/ (/ vi/ |/ Pa/ (/ Vi/ )/ )/ ./ 定义/ 3/ ./ 一个/ 贝叶斯/ 网络/ 定义/ 为/ 一个/ 三元组/ (/ G/ ,/ Ξ/ ,/ P/ )/ ,/ 这里/ G/ =/ (/ V/ ,/ E/ )/ 是/ 一个/ 具有/ 节点/ V/ =/ {/ V1/ ,/ V2/ ,/ …/ ,/ Vk/ }/ 和/ 弧/ E/ 的/ 有/ 向/ 无/ 环图/ ,/ P/ 表示/ 概率分布/ ,/ Ξ/ 为/ 实例/ 空间/ ./ 应用/ 链/ 规则/ 以及/ Markov/ 条件/ ,/ 根据/ 假设/ 1/ ,/ 得到/ 贝叶斯/ 网络/ 中/ 所有/ 节点/ 的/ 联合/ 概率/ 如下/ :/ Page4p/ (/ V1/ ,/ V2/ ,/ …/ ,/ Vk/ )/ =/ ∏/ k/ 贝叶斯/ 网络/ 可/ 表示/ 事件/ 的/ 因果关系/ ,/ 其/ 连接/ 节点/ 的/ 弧/ 表达/ 了/ 两个/ 节点/ 间/ 的/ 直接/ 的/ 因果/ 影响/ ,/ 它/ 也/ 可/ 被/ 看作/ 是/ 拥有/ 许多/ 不同/ 组合/ 的/ 一个/ 抽象/ 知识库/ ./ 所谓/ 因果/ 贝叶斯/ 网络/ 就是指/ 具有/ 因果关系/ 的/ 贝叶斯/ 网络/ ,/ 网络/ 中/ 的/ 每个/ 节点/ 的/ 父/ 节点/ 被/ 解释/ 为/ 该/ 节点/ 相对/ 于/ 模型/ 中/ 其它/ 节点/ 的/ 直接/ 原因/ [/ 8/ ]/ ./ 贝叶斯/ 网络/ 模型/ 的/ 假定/ 避免/ 了/ 搜索/ 贝叶斯/ 网络结构/ 的/ 问题/ ,/ 尽管/ 这个/ 强/ 限制/ 假定/ 不是/ 很/ 现实/ ,/ 然而/ 大量/ 的/ 实验/ 表明/ ,/ 即使/ 在/ 违背/ 这种/ 独立性/ 假定/ 的/ 条件/ 下/ ,/ 它/ 仍/ 能/ 表现/ 出/ 很/ 好/ 的/ 健壮性/ ./ 定义/ 4/ ./ 没有/ 双亲/ 节点/ 的/ 节点/ V/ ,/ 概率/ 不/ 以/ 其它/ 节点/ 为/ 条件/ ,/ p/ (/ V/ )/ 称为/ 该/ 节点/ 的/ 先验概率/ ./ 为了/ 计算/ 给定/ 因果/ 贝叶斯/ 网络/ 的/ 联合/ 概率/ ,/ 需要/ 知道/ 先验概率/ 和/ 以/ 双亲/ 节点/ 为/ 条件/ 的/ 每个/ 节点/ 的/ 条件/ 概率函数/ ./ 因此/ ,/ 一个/ 随机变量/ 集合/ 的/ 概率/ 的/ 一个/ 完整/ 说明/ 涉及/ 到/ 这些/ 变量/ 的/ 一个/ 贝叶斯/ 网络/ 及/ 网络/ 中/ 每个/ 变量/ 的/ CPT/ ./ 4.2/ 贝叶斯/ 网络/ 学习/ 学习/ 一个/ 贝叶斯/ 网络/ 的/ 问题/ 是/ 寻找/ 一个/ 网络/ ,/ 包括/ DAG/ 结构/ 和/ DAG/ 中/ 每个/ 节点/ 的/ 概率分布/ 或/ CPT/ ,/ 它/ 能/ 最好/ 地/ 匹配/ 一个/ 数据/ 训练/ 集/ Ξ/ ,/ Ξ/ 是/ 所有/ 变量值/ 的/ 实例/ 集合/ ./ 在/ 学习/ 和/ 训练/ 贝叶斯/ 网络/ 时/ ,/ 网络结构/ 可以/ 由/ 领域专家/ 预先/ 给定/ ,/ 这种/ 情况/ 下/ 贝叶斯/ 网络/ 的/ 学习/ 问题/ 变得/ 比较/ 容易/ ,/ 否则/ 需要/ 由/ 训练/ 数据/ 导出/ ,/ 理论/ 上/ 讲/ ,/ 训练/ 得出/ 的/ 模型/ 是/ 实际/ 贝叶斯/ 网络/ 的/ 一个/ 同/ 构图/ ,/ 因此/ ,/ 训练/ 本身/ 是/ 一个/ 不断/ 渐进/ 的/ 学习/ 过程/ ./ 另外/ ,/ 网络/ 变量/ 可能/ 是/ 可见/ 的/ ,/ 也/ 可能/ 隐藏/ 在/ 所有/ 或/ 某些/ 训练样本/ 中/ ,/ 还/ 可能/ 是/ 缺失/ 的/ ./ 根据/ 统计学/ 领域/ 对/ 多/ 变量/ 联合/ 概率分布/ 的/ 近似/ 分解/ 方法/ ,/ 贝叶斯/ 网络/ 的/ 学习/ 可/ 分为/ 基于/ 评价/ 与/ 搜索/ 和/ 基于/ 独立性/ 检验/ 两大类/ 算法/ [/ 9/ ]/ ./ 基于/ 评价/ 与/ 搜索/ 的/ 典型/ 算法/ 是/ Cooper/ 等/ 提出/ 的/ K2/ 算法/ [/ 10/ ]/ ,/ K2/ 算法/ 在/ 给定/ 节点/ 顺序/ 先验/ 信息/ 的/ 情况/ 下/ ,/ 利用/ 贝叶斯/ 概率/ 作为/ 标准/ 来/ 评价/ 模型/ 与/ 数据/ 的/ 符合/ 程度/ ,/ 通过/ 不断/ 向/ 网络/ 中/ 增加/ 边/ 的/ 贪婪/ 搜索/ 方法/ 找到/ 最佳/ 网络结构/ ./ 5CFA/ 核心/ 算法/ 分析/ 5.1/ 网络结构/ 学习/ 的/ K2/ 算法/ [/ 10/ ]/ 设/ Z/ 是/ 数据库/ D/ 的/ 变量/ 集/ ,/ BS/ 表示/ 仅/ 包含/ 在/ Z/ 中/ 的/ 变量/ 的/ 任意/ 一个/ 贝叶斯/ 网络结构/ ,/ BSi/ 和/ BSj/ 是/ 两个/ 包含/ Z/ 中/ 变量/ 的/ 贝叶斯/ 网络结构/ ./ 用/ π/ i/ 表示/ xi/ 的/ 双亲/ ,/ 用/ ω/ ij/ 指明/ 在/ π/ i/ 中/ 变量/ 的/ 值/ 的/ 第/ j/ 个/ 唯一/ 的/ 实例/ (/ 相对/ 于/ D/ 中/ 案例/ 的/ 顺序/ )/ ,/ 则/ 有/ P/ (/ BS/ ,/ D/ )/ =/ ∫/ BP/ 这里/ BP/ 的/ 值/ 表示/ 与/ 贝叶斯/ 网络结构/ BS/ 相关联/ 的/ 条件/ 概率/ 分配/ ,/ f/ 是/ 给定/ BS/ 后/ 作用/ 于/ BP/ 的/ 条件/ 概率密度函数/ ./ 假设/ 2/ ./ 给定/ 贝叶斯/ 网络/ 模型/ ,/ 数据库/ 中/ 的/ 一条/ 记录/ 独立/ 地/ 发生/ ./ 根据/ 此/ 假设/ ,/ 有/ P/ (/ BS/ ,/ D/ )/ =/ ∫/ BP/ ∏/ m/ [/ 这里/ 的/ m/ 是/ D/ 中/ 的/ 案例/ 数/ ,/ Ch/ 是/ D/ 中/ 的/ 第/ h/ 个/ 案例/ ./ 定理/ 1/ ./ 设/ Z/ 为/ n/ 个/ 离散/ 变量/ 集/ ,/ Z/ 中/ 的/ 一个/ 变量/ xi/ 有/ ri/ 个/ 可能/ 的/ 值/ (/ ν/ i1/ ,/ …/ ,/ ν/ iri/ )/ ./ 设/ D/ 为/ 具有/ m/ 个/ 案例/ 的/ 数据库/ ,/ 每个/ 案例/ 包含/ 对/ Z/ 中/ 每个/ 变量/ 的/ 一个/ 赋值/ ./ 设/ BS/ 表示/ 仅/ 包含/ 在/ Z/ 中/ 变量/ 的/ 一个/ 贝叶斯/ 网络结构/ ,/ BS/ 中/ 的/ 每个/ 变量/ xi/ 有/ 一个/ 双亲/ 用/ π/ i/ 表示/ ,/ 用/ ω/ ij/ 指明/ 在/ π/ i/ 中/ 相对/ 于/ D/ 的/ 变量/ 的/ 值/ 的/ 第/ j/ 个/ 唯一/ 的/ 实例/ ./ 假设/ π/ i/ 中有/ qi/ 个/ 这样/ 的/ 唯一/ 实例/ ,/ 定义/ Nijk/ 为/ D/ 中/ 案例/ 的/ 数量/ ,/ 变量/ xi/ 有值/ vik/ ,/ 并且/ π/ i/ 被/ 实例/ 化为/ ω/ ij/ ,/ 设则/ P/ (/ BS/ ,/ D/ )/ =/ P/ (/ BS/ )/ ∏/ nK2/ 算法/ 寻求/ 最大/ P/ (/ BS/ ,/ D/ )/ 的/ 网络结构/ ,/ 但/ 作为/ 节点/ 数目/ 的/ 函数/ ,/ 可能/ 的/ 结构/ 呈/ 指数/ 增长/ [/ 11/ ]/ ,/ 显然/ ,/ 穷举/ 所有/ 可能/ 的/ 结构/ 在/ 大多数/ 情况/ 下/ 是/ 不/ 可行/ 的/ ./ 为此/ ,/ 下文/ 将/ 提出/ 一种/ 基于/ 概率函数/ 依赖/ 关系/ 分析/ 的/ 方法/ ,/ 对/ 变量/ 集/ 进行/ 约简/ ,/ 然后/ 通过/ 启发式/ 方法/ ,/ 搜索/ 适合/ 的/ 贝叶斯/ 网络结构/ ./ 5.2/ 概率函数/ 依赖/ 关系/ 分析/ 通常/ ,/ 人们/ 对/ 数据/ 集中/ 属性/ 的/ 函数/ 依赖/ 关系/ 会/ 有/ 一些/ 先验/ 的/ 认识/ ,/ 函数/ 依赖/ 关系/ 是/ 数据库/ 规范化/ 理论/ 的/ 重要/ 内容/ ,/ 已/ 形成/ 比较/ 成熟/ 的/ 理论体系/ ,/ 应用/ 规范化/ 理论/ ,/ 可以/ 极大地提高/ 对/ 数据库/ 数据分析/ 的/ 效率/ ./ Page5/ 下面/ 我们/ 将/ 提出/ 一种/ 概率函数/ 依赖/ 的/ 方法/ ,/ 相对/ 于/ 概率函数/ 依赖/ 而言/ ,/ 上述/ 函数/ 依赖/ 可以/ 认为/ 是/ 分布/ 概率/ 为/ 1/ 的/ 概率函数/ 依赖/ 关系/ ./ 定义/ 5/ ./ 设有/ 关系/ 模式/ R/ (/ U/ )/ ,/ X/ 和/ Y/ 是/ 属性/ 变量/ 集/ U/ 的/ 子集/ ,/ 概率函数/ 依赖/ 是/ 形为/ X/ →/ / / PY/ 的/ 一个/ 命题/ ,/ 只要/ r/ 是/ R/ 的/ 当前/ 关系/ ,/ 对/ r/ 中/ 任意/ 两个/ 实例/ t/ 和/ s/ ,/ 都/ 有/ t/ [/ X/ ]/ =/ s/ [/ X/ ]/ 以/ 概率/ P/ 蕴涵/ t/ [/ Y/ ]/ =/ s/ [/ Y/ ]/ ,/ 那么/ ,/ 概率函数/ 依赖/ X/ →/ / / PY/ 在/ 关系/ 模式/ R/ (/ U/ )/ 中/ 成立/ ./ 其中/ ,/ t/ [/ X/ ]/ 表示/ 实例/ t/ 在/ 属性/ 变量/ 集/ X/ 上/ 的/ 值/ ;/ 实例/ 概念/ 等同于/ 数据库/ 理论/ 中/ 的/ 元组/ ,/ 另外/ ,/ 为/ 叙说/ 方便/ ,/ 前/ 文中/ 的/ 变量/ 在/ 本节/ 用/ 属性/ 变量/ 表示/ ./ 定义/ 6/ ./ 设/ F/ 是/ 概率函数/ 依赖/ 集/ ,/ 被/ F/ 逻辑/ 蕴涵/ 的/ 概率函数/ 依赖/ 全体/ 构成/ 的/ 集合/ ,/ 称为/ 概率函数/ 依赖/ 集/ F/ 的/ 闭包/ (/ clouser/ )/ ,/ 记为/ F/ +./ 定理/ 2/ ./ 如果/ A1/ ,/ …/ ,/ An/ 是/ 关系/ 模式/ R/ 的/ 属性/ 变量/ 集合/ ,/ 那么/ X/ →/ / / PA1/ ,/ …/ ,/ An/ 成立/ 的/ 充分/ 必要条件/ 是/ X/ →/ / / PAi/ (/ i/ =/ 1/ ,/ 2/ ,/ …/ ,/ n/ )/ 成立/ ./ 定义/ 7/ ./ 设/ F/ 是/ 属性/ 变量/ 集/ U/ 上/ 的/ 概率函数/ 依赖/ 集/ ,/ X/ 是/ U/ 的/ 子集/ ,/ 那么/ (/ 相对/ 于/ F/ )/ 属性/ 变量/ 集/ X/ 的/ 闭包/ X/ +/ 表示/ 从/ F/ 集/ 使用/ 概率函数/ 依赖/ 推理/ 规则/ 推出/ 的/ 所有/ 满足/ X/ →/ / / PAi/ 的/ 属性/ 变量/ Ai/ 的/ 集合/ :/ 量/ 闭包/ X/ +./ 算法/ 1/ ./ 求/ 属性/ 变量/ 集合/ X/ 关于/ F/ 的/ 属性/ 变/ 输入/ :/ 关系/ 模式/ R/ 的/ 全部/ 属性/ 变量/ 集合/ U/ ,/ 在/ U/ 上/ 的/ 概/ 输出/ :/ 关于/ F/ 的/ 属性/ 变量/ 闭包/ X/ +/ 1/ ./ i/ =/ 0/ ,/ X/ (/ i/ )/ =/ X/ ;/ 2/ ./ 在/ F/ 中/ 寻找/ 尚未/ 用过/ 的/ 左边/ 是/ X/ (/ i/ )/ 的/ 子集/ 的/ 概率函数/ 依赖/ :/ 在/ Zj/ 中/ 寻找/ X/ (/ i/ )/ 中未/ 出现/ 过/ 的/ 属性/ 变量/ 集合/ A/ ,/ 令/ X/ (/ i/ +/ 1/ )/ =/ X/ (/ i/ )/ A/ ,/ 若/ 无/ 这样/ 的/ A/ ,/ 则/ 转步/ 4.3/ ./ 判断/ 是否/ 有/ X/ (/ i/ +/ 1/ )/ =/ X/ (/ i/ )/ ,/ 若/ 是/ ,/ 则/ 转步/ 4/ ;/ 否则/ 转步/ 2/ ./ 等价/ 情况/ :/ 4/ ./ 输出/ X/ (/ i/ )/ ,/ 即为/ X/ +./ 算法/ 中/ ,/ 对于/ 步/ 3/ 的/ 计算/ 停止/ 条件/ ,/ 有/ 以下/ 4/ 种/ (/ 1/ )/ X/ (/ i/ +/ 1/ )/ =/ X/ (/ i/ )/ ;/ (/ 2/ )/ 当/ 发现/ X/ (/ i/ )/ 包含/ 了/ 全部/ 属性/ 变量/ 时/ ;/ 找/ 不到/ X/ (/ i/ )/ 中未/ 出现/ 过/ 的/ 属性/ 变量/ ;/ 变量/ 已/ 没有/ X/ (/ i/ )/ 的/ 子集/ ;/ (/ 3/ )/ 在/ F/ 中/ 的/ 概率函数/ 依赖/ 的/ 右边/ 属性/ 中/ 再也/ (/ 4/ )/ 在/ F/ 中/ 未用过/ 的/ 概率函数/ 依赖/ 的/ 左边/ 属性/ 定义/ 8/ ./ 如果/ 关系/ 模式/ R/ (/ U/ )/ 上/ 的/ 两个/ 概率函数/ 依赖/ 集/ F/ 和/ G/ ,/ 有/ F/ +/ =/ G/ +/ ,/ 则/ 称/ F/ 和/ G/ 是/ 等价/ 的/ 概率函数/ 依赖/ 集/ ,/ 记作/ F/ ≡/ G/ ./ 定义/ 9/ ./ 设/ F/ 是/ 属性/ 变量/ 集/ U/ 上/ 的/ 概率函数/ 依赖/ 集/ ,/ 如果/ Fmin/ 是/ F/ 的/ 一个/ 最小/ 的/ 概率函数/ 依赖/ 集/ ,/ 那么/ Fmin/ 应/ 满足/ 下列/ 4/ 个/ 条件/ :/ (/ 1/ )/ F/ +/ min/ =/ F/ +/ ;/ (/ 2/ )/ 每个/ 概率函数/ 依赖/ 的/ 右边/ 都/ 是/ 单/ 属性/ 变量/ ;/ (/ 3/ )/ 每个/ 概率函数/ 依赖/ 的/ 左边/ 没有/ 冗余/ 的/ 属性/ 变量/ (/ 即/ F/ 中/ 不/ 存在/ 这样/ 的/ 概率函数/ 依赖/ XP/ →/ / / 1Y/ ,/ X/ 有/ 真/ 子集/ W/ 使得/ F/ -/ {/ XP/ →/ / / 1Y/ }/ ∪/ {/ WP/ →/ / / 2Y/ }/ 与/ F/ 等价/ )/ ./ (/ 4/ )/ Fmin/ 中/ 没有/ 冗余/ 的/ 概率函数/ 依赖/ (/ 即/ F/ 中/ 不/ 存在/ 这样/ 的/ 函数/ 依赖/ XP/ →/ / / 1Y/ ,/ 使得/ F/ 与/ {/ F/ -/ {/ XP/ →/ / / 1Y/ }/ }/ 等价/ )/ ./ 小/ 的/ 概率/ 依赖/ 集/ Fmin/ ,/ 且/ F/ ≡/ Fmin/ ./ 显然/ ,/ 每个/ 概率函数/ 依赖/ 集/ F/ 至少/ 存在/ 一个/ 最/ 算法/ 2/ ./ 求/ 概率函数/ 依赖/ 集/ 的/ 最小/ 的/ 概率函数/ 依赖/ 集/ ./ 输入/ :/ 一个/ 概率函数/ 依赖/ 集/ F/ 输出/ :/ F/ 的/ 一个/ 等价/ 最小/ 的/ 概率/ 依赖/ 集/ Fmin1/ ./ 应用/ 分解/ 规则/ ,/ 使/ F/ 中/ 每/ 一个/ 依赖/ 的/ 右/ 部属/ 性/ 变量/ 单一化/ ./ 2/ ./ 逐个/ 检查/ F/ 中/ 左部/ 是非/ 单/ 属性/ 变量/ 的/ 依赖/ ,/ 去掉/ 各/ 依赖/ 左部/ 冗余/ 的/ 属性/ 变量/ ./ 3/ ./ 去掉/ 冗余/ 的/ 依赖/ ./ 即/ 从/ 第一个/ 依赖/ 开始/ ,/ 从/ F/ 中/ 去掉/ 它/ (/ 假设/ 该/ 依赖/ 为/ XP/ →/ / / 1Y/ )/ ,/ 然后/ 在/ 剩下/ 的/ 依赖/ 中求/ X/ +/ ,/ 看/ X/ +/ 是否/ 包含/ Y/ ,/ 若/ 是/ ,/ 则/ 去掉/ XP/ →/ / / 1Y/ ;/ 若/ 不/ 包含/ Y/ ,/ 则/ 不能/ 去掉/ XP/ →/ / / 1Y/ ./ 根据/ 以上/ 的/ 分析/ ,/ 当/ 已知/ 数据库/ D/ 的/ 先验概率/ 函数/ 依赖/ 关系/ F/ 时/ ,/ 就/ 可以/ 根据/ 算法/ 1/ 和/ 2/ 得到/ 最小/ 的/ 概率函数/ 依赖/ 集/ F/ +/ ,/ 这样/ ,/ 非/ 集合/ 中/ 的/ 属性/ 变量/ 不/ 可能/ 作为/ 集合/ 中/ 属性/ 变量/ 的/ 双亲/ 节点/ ,/ 这/ 就/ 大大降低/ 了/ 贝叶斯/ 网络/ 学习/ 的/ 计算/ 复杂性/ ./ 事实上/ ,/ 先验概率/ 函数/ 依赖/ 关系/ 在/ 很多/ 情况/ 下/ 是/ 存在/ 的/ ,/ 如/ 通过/ 数据挖掘/ 方法/ 得到/ 的/ 关联/ 规则/ 集合/ 就/ 蕴含/ 了/ 一个/ 概率函数/ 依赖/ 关系/ 集合/ ./ Page65/ ./ 3/ 启发式/ 搜索/ 方法/ 通过/ 对/ D/ 的/ 概率函数/ 依赖/ 关系/ 分析/ ,/ 能够/ 对/ 所有/ 的/ n/ 个/ 变量/ 指定/ 一个/ 顺序/ ,/ 这样/ ,/ 如果/ 在/ 顺序/ 中/ xi/ 先于/ xj/ ,/ 则/ 不/ 允许/ 结构/ 中有/ 一条/ 弧/ 从/ xj/ 到/ xi/ ,/ 非/ 集合/ F/ +/ 中/ 的/ 变量/ 不/ 可能/ 是/ 集合/ 中/ 变量/ 的/ 双亲/ 节点/ ./ 给定/ 这样/ 一个/ 顺序/ 作为/ 约束/ ,/ 如果/ 顺序/ 变量/ 包括/ 了/ 所有/ n/ 个/ 变量/ ,/ 则/ 有/ 2n/ (/ )/ 2/ =/ 2n/ (/ n/ -/ 1/ )/ // 2/ 个/ 可能/ 的/ 贝叶斯/ 网络结构/ ./ 当/ n/ 较大/ 时/ ,/ 应用/ 等式/ (/ 6/ )/ 对/ 2n/ (/ n/ -/ 1/ )/ // 2/ 个/ 中/ 的/ 每个/ 可能/ 的/ 结构/ 进行/ 计算/ 还是/ 很难/ 实现/ 的/ ,/ 因此/ ,/ 除/ 节点/ 顺序/ 外/ ,/ 假设/ 在/ 观察/ 到/ 数据/ D/ 之前/ ,/ BS/ 等/ 优先级/ ,/ 则/ 可/ 得到/ P/ (/ BS/ ,/ D/ )/ =/ c/ ∏/ n/ 对于/ 每个/ BS/ ,/ 这里/ c/ 是/ 先验概率/ P/ (/ BS/ )/ 常量/ ,/ 最大化/ 等式/ (/ 7/ )/ ,/ 只/ 需要/ 发现/ 每个/ 变量/ 的/ 双亲/ 集合/ ,/ 最大化/ 乘积/ 的/ 第/ 2/ 项/ ,/ 有/ maxBS/ 这里/ 在/ 等式/ (/ 8/ )/ 右边/ ,/ 最大化/ 发生/ 在/ xi/ 的/ 双亲/ π/ i/ 的/ 每个/ 实例/ ./ 为了/ 最大化/ P/ (/ BS/ ,/ D/ )/ ,/ 可用/ 一种/ 贪婪/ 搜索/ (/ greedy/ -/ search/ )/ 方法/ 修改/ 等式/ (/ 8/ )/ 右边/ 的/ 最大化/ 操作/ ,/ 算法/ 开始/ 时/ 假设/ 节点/ 没有/ 双亲/ 节点/ ,/ 每次/ 加入/ 对/ 结构/ 的/ 概率/ 增长/ 最大/ 的/ 节点/ 作为/ 双亲/ ,/ 当/ 增加/ 单个/ 双亲/ 不能/ 增加/ 概率/ 时/ ,/ 停止/ 增加/ 双亲/ 到/ 该/ 节点/ ./ 实现/ 贪婪/ 搜索/ 使用/ 的/ 函数/ 如下/ :/ 这里/ 的/ Nijk/ 相对/ 于/ xi/ 的/ 双亲/ π/ i/ 和/ 数据库/ D/ 被/ 计算/ ,/ ri/ 、/ qi/ 的/ 定义/ 同/ 定理/ 1/ ,/ 则/ 结合/ 算法/ 1/ 和/ 2/ 以及/ K2/ 算法/ 得到/ 的/ 启发式/ 搜索算法/ 如/ 算法/ 3/ 所示/ ./ 算法/ 3/ ./ 启发式/ 搜索算法/ K2/ _/ C/ ./ 输入/ :/ 数据库/ D/ ,/ 最小/ 概率函数/ 依赖/ 集/ (/ 算法/ 2/ 的/ 结果/ )/ 输出/ :/ 每个/ 节点/ 的/ 双亲/ 节点/ ProcedureK2/ _/ C/ ;/ Fori/ =/ 1tolEndFor/ ;/ 假设/ 等式/ (/ 9/ )/ 的/ 所有/ 阶乘/ 都/ 已/ 计算/ 并/ 存入/ 一个/ 数组/ ,/ 因为/ Nij/ 不/ 可能/ 大于/ m/ ,/ 因此/ 等式/ (/ 9/ )/ 中/ 没有/ 因子/ 大于/ (/ m/ +/ r/ -/ 1/ )/ !/ ,/ 所以/ 可以/ 在/ O/ (/ m/ +/ r/ -/ 1/ )/ 时间/ 内/ 把/ 1/ ~/ (/ m/ +/ r/ -/ 1/ )/ 的/ 整数/ 阶乘/ 计算/ 并/ 存储/ 到/ 数组/ 中/ ./ 算法/ 中/ 的/ 函数/ g/ 最多/ 被/ 调用/ l/ -/ 1/ 次/ ,/ 因为/ xi/ 最多/ 有/ l/ -/ 1/ 个/ 双亲/ 节点/ ,/ 因此/ Pnew/ 最多/ 需要/ O/ (/ murl/ )/ 的/ 时间/ 就/ 可以/ 完成/ 所有/ 的/ 操作/ ./ While/ 循环/ 中/ 的/ 其它/ 语句/ 是/ 以/ O/ (/ l/ )/ 时间/ 执行/ 的/ ,/ 每次/ 进行/ 循环/ 时/ ,/ 需要/ 循环/ 的/ 次数/ 是/ O/ (/ u/ )/ 次/ ,/ For/ 语句/ 需要/ 循环/ l/ 次/ ./ 综合/ 以上/ 情况/ ,/ 算法/ 3/ 的/ 时间/ 复杂度/ 为/ O/ (/ m/ +/ r/ -/ 1/ )/ +/ O/ (/ marl/ )/ O/ (/ u/ )/ l/ =/ O/ (/ mu2r2l/ )/ ,/ 在/ 最坏/ 的/ 情况/ 下/ ,/ 当/ u/ =/ n/ ,/ l/ =/ n/ 时/ ,/ 其/ 时间/ 复杂度/ 为/ O/ (/ mn4r/ )/ ./ 5.4/ CPT/ 学习/ 5.4/ ./ 1/ 无/ 缺失/ 数据/ 学习/ 知道/ 贝叶斯/ 网络结构/ 后/ ,/ 要/ 得到/ 某个/ 节点/ xi/ 的/ CPT/ ,/ 如果/ 有/ 充足/ 的/ 样本/ ,/ 只要/ 计算/ 每个/ 节点/ 和/ 它/ 的/ 双亲/ 的/ 采样/ 统计/ 信息/ 即可/ ./ 遵从/ 前面/ 的/ 约定/ ,/ 设/ 变量/ xi/ 有/ ri/ 个/ 可能/ 的/ 值/ (/ ν/ i1/ ,/ …/ ,/ ν/ iri/ )/ ,/ 其/ 双亲/ 节点/ 为/ π/ i/ ,/ 用/ ω/ ij/ 指明/ 在/ π/ i/ 中/ 相对/ 于/ D/ 的/ 变量/ 的/ 值/ 的/ 第/ j/ 个/ 唯一/ 的/ 实例/ ,/ 采样/ 统计/ 结果/ 表示/ 为/ ^/ p/ (/ xi/ =/ rik/ |/ π/ i/ =/ wijk/ )/ =/ 5.4/ ./ 2/ 不/ 完整/ 数据/ 学习/ 当/ 贝叶斯/ 网络结构/ 给定/ 而/ 某/ 变量/ 有/ 空缺/ 或/ 不/ 全时/ ,/ 根据/ 具体情况/ ,/ 可/ 运用/ 贝叶斯/ 分类/ 的/ 链/ 规则/ 技巧/ 避开/ 空缺/ 项/ 进行/ 计算/ ./ 一般/ 地/ ,/ 我们/ 引入/ 梯度/ 下降/ 方法/ 学习/ 贝叶斯/ 网络/ 的/ CPT/ [/ 12/ ]/ ./ 设/ D/ 是/ n/ 个/ 训练样本/ 的/ 集合/ {/ C1/ ,/ C2/ ,/ …/ ,/ Cn/ }/ ,/ pijk/ 是/ 具有/ 双亲/ π/ i/ 的/ 变量/ xi/ 的/ CPT/ 项/ ,/ 用/ ω/ ij/ 指明/ π/ i/ 的/ 第/ j/ 个/ 唯一/ 的/ 实例/ ,/ pijk/ 可以/ 看作/ 权/ ,/ 类似/ 于/ 神经网络/ 中/ 隐藏/ 单元/ 的/ 权/ ,/ 权/ 的/ 集合/ 总/ 称为/ p/ ,/ 这些/ 权/ 被/ 初始化/ 为/ 随机/ 概率/ 值/ ./ 梯度/ 下降/ 策略/ 采用/ 贪心/ 爬山/ 法/ ,/ 在/ 每次/ 迭代/ 中/ ,/ 修改/ 这些/ 权/ ,/ 并/ 最终/ 收敛/ 到/ 一个/ 局部/ 最优/ 解/ ./ Page7/ 基于/ p/ 的/ 每个/ 可能/ 设置/ 都/ 等/ 可能/ 地/ 假定/ ,/ 梯度/ 下降/ 方法/ 能/ 搜索/ 最好/ 地/ 对/ 数据/ 建模/ 的/ pijk/ 值/ ,/ 其/ 目标/ 是/ 通过/ 按/ lnPp/ (/ D/ )/ 梯度/ 来/ 最大化/ Pp/ (/ D/ )/ =/ ∏/ n/ 给定/ 贝叶斯/ 网络结构/ 和/ pijk/ 的/ 初值/ ,/ 该/ 算法/ 表示/ 如下/ ./ 算法/ 4/ ./ 梯度/ 下降/ 方法/ 训练/ 贝叶斯/ 网络/ ./ 1/ ./ 计算/ 梯度/ ./ 对于/ 每个/ i/ ,/ j/ ,/ k/ ,/ 计算/ :/ 式/ (/ 11/ )/ 右/ 端的/ 概率/ 要/ 对/ D/ 中/ 的/ 每个/ 样本/ Cd/ 计算/ ,/ 为/ 方便/ 起/ 见/ ,/ 称此/ 概率/ 为/ p1/ ./ 当/ xi/ 和/ π/ i/ 表示/ 的/ 变量/ 对/ 某个/ Cd/ 隐藏/ 时/ ,/ 对应/ 的/ 概率/ p1/ 可以/ 使用/ 贝叶斯/ 网络/ 推理/ 的/ 标准/ 算法/ (/ 如/ 一些/ 商用/ 软件包/ 提供/ 的/ 标准/ 功能/ )/ 由/ 样本/ 的/ 观察/ 变量/ 计算/ ./ 2/ ./ 沿/ 梯度方向/ 前进/ 一/ 小步/ :/ 用/ 更新/ 权值/ ,/ 其中/ l/ 是/ 表示/ 步长/ 的/ 学习/ 率/ ,/ 而/ / lnPp/ (/ D/ )/ 式/ (/ 11/ )/ 计算/ ./ 学习/ 率/ 设置/ 为/ 一个/ 小/ 常数/ ./ 3/ ./ 重新/ 格式化/ 权值/ :/ 由于/ 权值/ pijk/ 是/ 概率/ 值/ ,/ 它们/ 必须/ 在/ 0.0/ 和/ 1.0/ 之间/ ,/ 并且/ 对于/ 所有/ 的/ i/ ,/ k/ ,/ ∑/ j/ 新后/ ,/ 可以/ 对/ 它们/ 进行/ 归一化/ 处理/ 来/ 保证/ 这一/ 条件/ ./ 6/ 实验/ 与/ 分析/ 6.1/ 元/ 报警/ 事件/ 聚类/ 我们/ 使用/ 基于/ 属性/ 相似性/ 和/ 上下文/ 要求/ 的/ 报警/ 聚合/ 来/ 合并/ 原始/ 报警/ 为元/ 报警/ ,/ 原始/ 报警/ 的/ 格式/ 为/ (/ AlertID/ ,/ Classificaton/ ,/ SrcIP/ ,/ DseIP/ ,/ detectime/ ,/ hyperID/ )/ ,/ 元/ 报警/ 的/ 格式/ 为/ (/ HyperID/ ,/ Classifica/ -/ 图中/ 的/ CPT/ 是/ 用/ Snort/ 得到/ 的/ 对/ 一个/ 实际/ 攻击/ 数据/ 学习/ 的/ 概率分布/ ,/ CPT/ 中/ 的/ N1/ ~/ N5/ 对应/ 攻图/ 2IISAttack/ 的/ 贝叶斯/ 网络/ tion/ ,/ SrcIP/ ,/ DesIP/ ,/ StartTime/ ,/ EndTime/ ,/ Count/ )/ ./ 报警/ 聚合/ 过程/ 将/ 去除/ 重复/ 报警/ 并/ 产生/ 保留/ 重要/ 信息/ 粒度/ 的/ 易于/ 分析/ 的/ 元/ 报警/ ./ 每个/ 元/ 报警/ 与/ 原始/ 报警/ 之间/ 具有/ 一对/ 多/ 的/ 关系/ ,/ 在/ 元/ 报警/ 中/ ,/ Count/ 域/ 记录/ 合并/ 入元/ 报警/ 的/ 原始/ 报警/ 的/ 数目/ ,/ 原始/ 报警/ 中/ 的/ HyperID/ 域/ 记录/ 着/ 它/ 并入/ 的/ 元/ 报警/ 的/ 唯一/ 标识码/ ./ 元/ 报警/ 的/ 聚合/ 使用/ 基于/ Leader/ -/ Follower/ 模型/ 的/ 聚合/ 算法/ [/ 13/ ]/ ,/ 其/ 聚合/ 准则/ 是/ 把/ 具有/ 相同/ 源地址/ 和/ 目的/ 地址/ 的/ 报警/ 组合/ 为/ 相同/ 类/ ,/ 其/ 时间/ 戳/ 落入/ 一个/ 自/ 扩展/ 的/ 时间/ 窗口/ ./ 当/ 原始/ 报警/ 的/ 时间/ 戳/ 超出/ 元/ 报警/ 的/ 时间/ 窗口/ 时/ ,/ 元/ 报警/ 的/ 时间/ 窗口/ 在/ 预定/ 义/ 的/ 界限/ T/ 内/ 自动/ 扩展/ ./ 这/ 意味着/ 能够/ 把/ 连续/ 重复/ 的/ 原始/ 报警/ 合并/ 为/ 一个/ 具有/ 适当/ T/ 时间/ 窗口/ 的/ 元/ 报警/ ./ 实际上/ ,/ 影响/ 聚合/ 结果/ 的/ 一个/ 重要/ 因素/ 是/ 攻击/ 类/ 的/ 划分/ ,/ 对于/ 针对/ 相同/ 的/ 系统/ 弱点/ 或/ 具有/ 相似/ 的/ 结果/ 的/ 攻击/ 类型/ ,/ 可以/ 在/ 一个/ 更/ 高/ 的/ 层次/ 上/ 划分/ 攻击/ 类/ ,/ 例如/ :/ 由/ Snort/ 产生/ 的/ “/ SCANNmapTCP/ ”/ 和/ “/ SCANNmapXMAS/ ”/ 报警/ 可以/ 合并/ 入/ “/ SCANAttack/ ”/ 类/ ,/ 当然/ ,/ 这种/ 报警/ 抽象/ 及/ 定义/ 合适/ 的/ 攻击/ 类/ 需要/ 人工干预/ ./ 6.2/ 事例/ 分析/ 图/ 1/ 是/ 一个/ 每个/ 单步/ 攻击/ 的/ 方法/ 可选/ 的/ 复合/ 攻击/ ,/ 而/ 有些/ 攻击/ 的/ 攻击/ 步骤/ 也/ 是/ 可选/ 的/ ,/ 例如/ 图/ 2/ 所示/ 的/ IIS/ 攻击/ ,/ 攻击者/ 启动/ 攻击/ 时/ 首先/ 对/ 攻击/ 主机/ 进行/ ping/ 操作/ ,/ 然后/ 对/ 其/ 80/ 端口/ 进行/ 扫描/ ,/ 第/ 3/ 步则/ 有/ 两个/ 选择性/ 操作/ ,/ 即/ ScanPort139/ 或/ ScanIISServer/ ,/ 第/ 4/ 步/ 也/ 存在/ 一个/ 选择/ ,/ 既/ 可/ 在/ ScanPort139/ 后/ 直接/ 进行/ 攻击/ ,/ 也/ 可/ 回到/ 步骤/ 3/ 后/ 继续/ 攻击/ ./ 也就是说/ 第/ 4/ 、/ 5/ 步/ 存在/ 两个/ 选择性/ 攻击/ 步骤/ ,/ 整个/ 攻击/ 过程/ 可以/ 4/ 步/ 完成/ ,/ 也/ 可以/ 5/ 步/ 完成/ ,/ 但/ 这/ 并/ 不/ 影响/ 攻击/ 的/ 结果/ ./ 击步/ ,/ P/ (/ N1/ )/ 可以/ 学习/ 得到/ ,/ 也/ 可/ 根据/ 经验/ 直接/ 设置/ 为/ 0.5/ ./ Page8/ 据此/ ,/ 就/ 可以/ 对/ 捕获/ 的/ 网络/ 数据/ 和/ 日志/ 数据/ 进行/ 推理/ ,/ 分析/ 得到/ 所/ 需/ 的/ 网络/ 电子/ 证据/ ,/ 另外/ ,/ 从/ 上述/ 过程/ 也/ 可以/ 发现/ ,/ 即使/ 在/ 部分/ 证据/ 丢失/ 的/ 情况/ 下/ ,/ 也/ 可以/ 很/ 好/ 地/ 推理/ 攻击/ 过程/ 的/ 发生/ ./ 6.3/ 比较/ 分析/ 我们/ 用/ 两个/ 数据/ 集对/ 算法/ 进行/ 了/ 测试/ ,/ 一个/ 是/ Cooper/ 使用/ 的/ [/ 10/ ]/ ALARM/ 网络/ 产生/ 的/ 10000/ 个/ 案例/ 的/ 数据/ 集/ [/ 14/ ]/ ,/ 用于/ 与/ K2/ 算法/ 的/ 对比/ 实验/ ./ 另/ 一个/ 是/ DARPA2000/ 入侵/ 场景/ 关联/ 评测/ 数据/ 集/ ①/ ,/ 用于/ 取证/ 分析/ 对比/ 实验/ ./ 测试/ 用/ 计算机/ 为/ DELLD620/ ,/ 系统/ 环境/ 为/ WindowsVista/ ./ ALARM/ 包含/ 了/ 37/ 个/ 网络/ 节点/ 和/ 46/ 条边/ ,/ 为了/ 对比/ 与/ 验证/ 算法/ 的/ 有效性/ ,/ 实验/ 中/ 训练/ 集/ 的/ 大小/ 分别/ 使用/ 了/ 100/ 、/ 500/ 、/ 1000/ 、/ 2000/ 和/ 3000/ 几种/ 尺度/ ,/ 对/ 每个/ 数据/ 集/ 比较/ 了/ 边/ 的/ 增加/ 、/ 边/ 的/ 减少/ 及/ 网络结构/ 计算/ 时间/ 3/ 种/ 性能/ ,/ 并/ 以/ ALARM/ 的/ 结构/ 为/ 标准/ ,/ 分别/ 用/ 均值/ 和/ 标准差/ 来/ 度量/ ,/ 实验/ 结果/ 如表/ 1/ 所示/ ./ 实验/ 中未/ 考虑/ 联合/ 概率分布/ 计算/ 情况/ 的/ 比较/ ,/ 显然/ 这种/ 比较/ 很难/ 选择/ 一种/ 标准/ 来/ 衡量/ ./ 从/ 实验/ 结果/ 可以/ 看到/ ,/ K2/ _/ C/ 算法/ 的/ 准确率/ 和/ 计算/ 时间/ 都/ 有/ 明显改善/ ./ 但是/ ,/ 正如/ 前面/ 分析/ ,/ 计算/ 时间/ 的/ 提高/ 与/ 先验/ 有关/ ,/ 显然/ 当/ 先验/ 的/ 准确性/ 较/ 高时/ ,/ 计算/ 时间/ 将/ 大大减少/ ./ 算法/ 数据/ 集/ K2K2/ _/ C1000/ ./ 751.280/ ./ 220.48321/ ./ 00K2/ _/ C5000/ ./ 220.420/ ./ 110.312213/ ./ 00K2K2K2/ _/ C10000/ ./ 110.310/ ./ 030.166783/ ./ 00K2/ _/ C20000/ ./ 050.230/ ./ 030.169147/ ./ 00K2K2K2/ _/ C30000/ ./ 000.000/ ./ 030.1618848/ ./ 00/ 我们/ 还用/ DARPA2000/ 数据/ 集/ 进行/ 了/ 取证/ 计算/ 实验/ ./ DARPA2000/ 数据/ 集是/ DARPA/ 资助/ MIT/ 林肯/ 实验室/ 构造/ 的/ 入侵/ 场景/ 关联/ 评测/ 数据/ 集/ ,/ 已/ 成为/ 入侵/ 报警/ 关联/ 算法/ 、/ 场景/ 构建/ 算法/ 的/ 有效性/ 验证/ 的/ 标准/ 数据/ 集/ ./ DARPA/ 数据/ 集/ 包括/ 用/ Tcpdump/ 分别/ 在/ 非军事区/ (/ DMZ/ )/ 和/ 内部网/ (/ Inside/ )/ 中/ 监听/ 到/ 的/ 全部/ 数据包/ ./ 该/ 数据/ 集/ 包括/ LLDOS1/ ./ 0/ 和/ LLDOS2/ ./ 0.2/ 两个/ 攻击/ 场景/ 实例/ ./ 在/ LLDOS1/ ./ 0/ 攻击/ 场景/ 中/ ,/ 攻击者/ 通过/ Solarissadmind/ 服务/ 漏洞/ 攻陷/ 并/ 控制/ 了/ Eyrie/ 空军基地/ 网络/ 中/ 的/ 3/ 台/ 主机/ ,/ 上传/ 了/ Mstream/ 工具/ ,/ 并/ 对/ 一个/ 政府/ 网站/ 发动/ 了/ DDoS/ 攻击/ ./ LLDOS2/ ./ 0.2/ 攻击/ 场景/ 与/ LLDOS1/ ./ 0/ 相似/ ,/ 所/ 不同/ 的/ 是/ 攻击者/ 对/ 漏洞/ 主机/ 的/ 发现/ 以及/ Mstream/ 分布式/ 拒绝服务/ 攻击/ 的/ 上传/ 使用/ 了/ 更加/ 隐蔽/ 的/ 方法/ ,/ 从而/ 能够/ 验证/ 关联/ 算法/ 在/ 底层/ 入侵/ 检测/ 系统/ 存在/ 漏报/ 情况/ 下/ 的/ 关联/ 效果/ ./ 我们/ 在/ LLDOS1/ ./ 0/ 数据/ 集上/ 进行/ 了/ 实验/ ,/ 首先/ 使用/ Leader/ -/ Follower/ 算法/ 进行/ 元/ 报警/ 事件/ 聚类/ ,/ 得到/ 元/ 报警/ 事件/ 集合/ ,/ 因元/ 报警/ 事件/ 较/ 少/ ,/ 直接/ 使用/ 算法/ 3/ 进行/ 贝叶斯/ 网络结构/ 学习/ ,/ 得到/ 的/ 结构/ 如图/ 3/ 所示/ ./ 图中/ 节点/ 与/ 元/ 报警/ 的/ 对应/ 关系/ 如表/ 2/ 所示/ ./ 节点/ 事实上/ ,/ LLDOS1/ ./ 0/ 中/ 包含/ 了/ 一个/ 复合/ 攻击/ 的/ 过程/ ,/ 其/ 完整/ 的/ 攻击/ 序列/ 分为/ 5/ 个/ 攻击/ 阶段/ :/ (/ a/ )/ 通过/ IPSweep/ 进行/ 主机/ 探测/ ;/ (/ b/ )/ 使用/ Sandmin/ _/ Ping/ 进行/ Sadminddaemon/ 服务/ 端口扫描/ ,/ 探测/ 可能/ 存在/ Sadmind/ 漏洞/ 的/ 主机/ ;/ (/ c/ )/ 利用/ 主机/ 漏洞/ 进行/ 系统/ 入侵/ ,/ 获得/ 3/ 台/ 主机/ 的/ root/ 控制/ 权限/ ;/ (/ d/ )/ 在/ 被/ 攻破/ 的/ 主/ 机上安装/ 可/ 用于/ DDoS/ 攻击/ 的/ 木马/ ;/ (/ e/ )/ 利用/ 被/ 控制/ 主机/ 发起/ DDoS/ 攻击/ ./ 图/ 3/ 的/ 贝叶斯/ 网络/ 完全/ 重构/ 了/ 这个/ 攻击/ 过程/ ./ 但图/ 中/ 的/ Email/ _/ Almail/ _/ Overflow/ 并/ 不是/ 一个/ 单步/ 攻击/ ,/ 分析/ 发现/ 仅/ 与/ Rsh/ 具有/ 较/ 高/ 的/ 概率函数/ 依赖/ 关系/ ,/ 如何/ 去除/ 这样/ 的/ 噪音/ 节点/ 是/ 需要/ 进一步/ 研究/ 的/ 问题/ ./ 除了/ 上述/ 攻击/ 场景/ 重构/ 功能/ 之外/ ,/ 算法/ 在/ 对/ 报警/ 事件/ 的/ 检测/ 方面/ 也/ 表现/ 了/ 较/ 好/ 的/ 性能/ ,/ 我们/ 对/ 两个/ 数据/ 集/ 进行/ 检测/ 并/ 在/ 相似/ 环境/ 下/ 与/ Ning/ [/ 2/ ]/ 的/ 报/ ①/ MITLincolnLaboratory/ ,/ 2000DARPAIntrusionDetec/ -/ tionScenarioSpecificDataSets/ ./ http/ :/ // // www/ ./ ll/ ./ mit/ ./ edu/ // Page9/ 警/ 关联/ 算法/ 进行/ 了/ 相同/ 的/ 实验/ 比较/ ,/ 用/ RealSecureNetworkSensor6/ ./ 0/ 对/ 数据/ 集/ 进行/ 比/ 对/ 分析/ ,/ 实验/ 表/ 3/ 入侵/ 检测/ 结果/ 比较/ LLDOS1/ ./ 0LLDS2/ ./ 0.27/ 结束语/ 本文/ 将/ 报警/ 关联/ 技术/ 、/ 贝叶斯/ 网络/ 学习/ 方法/ 、/ 概率函数/ 依赖/ 理论/ 相结合/ ,/ 提出/ 了/ 一种/ 能够/ 对/ 来自/ 于/ 不同/ 数据源/ 的/ 数据/ 进行/ 网络/ 协同/ 取证/ 计算/ 的/ 算法/ ./ 计算机/ 取证/ 是/ 一项/ 专业性/ 很强/ 的/ 工作/ ,/ 通过/ 贝叶斯/ 网络/ 可以/ 直观/ 地/ 再现/ 攻击/ 场景/ ,/ 便于/ 进行/ 网络/ 取证/ 分析/ ./ 因此/ 下/ 一步/ 的/ 工作/ 主要/ 是/ 实现/ 自动/ 生成/ 可视化/ 的/ 贝叶斯/ 网络图/ ,/ 用/ 图示/ 的/ 形式/ 直观/ 地/ 反映/ 取证/ 计算/ 的/ 结果/ ,/ 以便/ 于/ 广泛/ 使用/ ./ 

