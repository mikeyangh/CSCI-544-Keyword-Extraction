Page1/ 数据/ 集成/ 环境/ 下/ 一种/ 高效/ 一致性/ 聚集/ 查询/ 张晓刚/ 1/ )/ 杨路明/ 2/ )/ 潘久辉/ 1/ )/ 1/ )/ (/ 暨南大学/ 计算机科学/ 系/ 广州/ 510632/ )/ 2/ )/ (/ 中南大学/ 信息科学/ 与/ 工程学院/ 长沙/ 410083/ )/ 摘要/ 对于/ 不/ 一致/ 数据库/ 上/ 的/ 一致性/ 聚集/ 查询/ 问题/ ,/ Fuxman/ 扩展/ 基于/ 合取/ 查询/ 类/ Cforest/ 的/ 一阶/ 查询/ 重写/ 方法/ 并/ 给出/ 了/ 查询/ 重写/ 算法/ RewriteCount/ 和/ RewriteAgg/ 来/ 分别/ 处理/ 包含/ 不同/ 聚集/ 函数/ 的/ 查询/ ./ 算法/ 产生/ 的/ 重写/ 聚集/ 查询/ 能够/ 使用/ SQL/ 语句/ 表达/ ,/ 但是/ 其/ 性能/ 却/ 不够/ 理想/ ./ 文中/ 重点/ 考虑/ 在/ 数据/ 集成/ 环境/ 下/ 如何/ 有效/ 地/ 提高/ 一致性/ 聚集/ 查询/ 的/ 整体/ 性能/ ,/ 通过/ OR/ -/ database/ 集成/ 模式/ 有效/ 地/ 隔离/ 集成/ 数据库/ 的/ 一致性/ 部分/ 和/ 非/ 一致/ 新/ 部分/ ,/ 并/ 在/ 此基础/ 上/ 同样/ 针对/ 合取/ 查询/ 类/ Cforest/ 上/ 的/ 分组/ 聚集/ 查询/ 提出/ 了/ 基于/ OR/ -/ database/ 的/ 一致性/ 查询/ 重写/ 算法/ RewriteCount/ _/ OR/ (/ 主要/ 处理/ Count/ 函数/ )/ 和/ RewriteAgg/ _/ OR/ (/ 主要/ 处理/ Max/ ,/ Min/ 和/ Sum/ 函数/ )/ ,/ 后面/ 的/ 查询/ 代价/ 比较/ 及/ 模拟实验/ 都/ 表明/ :/ 与/ Fuxman/ 的/ 一致性/ 聚集/ 查询方法/ 相比/ ,/ 文中/ 的/ 一致性/ 聚集/ 查询方法/ 在/ OR/ -/ database/ 集成/ 数据库/ 上/ 具有/ 明显/ 的/ 性能/ 优势/ ./ 关键词/ 一致性/ 查询/ ;/ 聚集/ 查询/ ;/ 完整性/ 约束/ ;/ 修复/ ;/ 查询/ 重写/ ;/ 不/ 一致/ 集成/ 数据库/ 1/ 引言/ 数据/ 集成/ [/ 1/ ]/ 的/ 目标/ 是/ 联合/ 一个/ 分布/ 、/ 自治/ 及/ 异构/ 数据源/ 集合/ 的/ 数据/ 并/ 为/ 用户/ 提供/ 它们/ 的/ 统一/ 视图/ ./ 那么/ 在/ 数据/ 集成/ 环境/ 下/ ,/ 满足/ 各自/ 数据源/ 完整性/ 约束/ 的/ 数据/ 仍/ 可能/ 因/ 违反/ 全局/ 模式/ 的/ 完整性/ 约束/ 而/ 导致/ 集成/ 数据库/ 的/ 不/ 一致/ ./ 例如/ ,/ 不同/ 数据源/ 记录/ 了/ 同一个/ 雇员/ 不同/ 的/ 薪水/ 和/ 地址/ 而/ 导致/ 信息/ 不/ 一致/ ,/ 而/ 数据/ 集成系统/ 需要/ 为/ 查询/ 用户/ 提供/ 该/ 雇员/ 一致/ 的/ 信息/ ./ 如何/ 从不/ 一致/ 的/ 数据库/ 中/ 返回/ 一致性/ 的/ 查询/ 结果/ 呢/ ?/ 这/ 就是/ 一致性/ 查询/ (/ ConsistentQueryAnswering/ ,/ CQA/ )/ 所/ 要/ 解决/ 的/ 问题/ [/ 2/ ]/ ./ 对此/ ,/ Arenas/ 等/ 人/ 在/ 文献/ [/ 3/ ]/ 中/ 首先/ 提出/ 了/ 基于/ 不/ 一致/ 数据库/ 修复/ 的/ 查询/ 重写/ 方法/ ,/ 但是/ 它/ 仅/ 考虑/ 了/ 无/ 量化/ 或/ 无/ 析取/ 的/ 一阶/ 查询/ 及/ 二元/ 完整性/ 约束/ ;/ Fuxman/ 等/ 人/ [/ 4/ ]/ 在/ 主键/ 约束/ 下/ 的/ 一阶/ 查询/ 重写/ 上/ 取得/ 重要/ 突破/ ,/ 通过/ 查询/ 连接/ 图/ 定义/ 了/ 一个/ 合取/ 查询/ 类/ Cforest/ 并/ 给出/ 其一/ 阶/ 查询/ 重写/ 算法/ ,/ 并/ 对/ Cforest/ 上/ 的/ 聚集/ 查询/ 给出/ 了/ 基于/ 范围/ 语义/ [/ 5/ ]/ 的/ 一致性/ 查询/ 重写/ 算法/ RewriteCount/ 和/ RewriteAgg/ [/ 6/ ]/ 并/ 被/ 实际/ 应用/ 到/ ConQuer/ 系统/ [/ 7/ ]/ 中/ ;/ Wijsen/ [/ 8/ -/ 10/ ]/ 在/ 非/ 一致/ 数据库/ 的/ 一阶/ 合取/ 查询/ 方面/ 也/ 做/ 了/ 大量/ 工作/ ,/ 但/ 主要/ 是/ 在/ Fuxman/ 的/ 基础/ 上/ 对/ 满足/ 没有/ 自/ 连接/ 和/ 非环/ 条件/ 的/ 布尔/ 合取/ 查询/ 的/ 一阶可/ 表达/ 性/ 进行/ 深入研究/ ,/ 但/ 这样/ 的/ 布尔/ 查询/ 在/ 实际/ 用户/ 查询/ 中/ 很少/ 出现/ ;/ 基于/ 逻辑程序/ 描述/ 修复/ 并/ 通过/ 怀疑/ 推理/ 计算/ CQA/ 是/ 更/ 一般化/ 的/ 方法/ [/ 11/ -/ 13/ ]/ ,/ 它/ 能够/ 处理/ 任意/ 的/ 一阶/ 查询/ 及/ 通用/ 完整性/ 约束/ ,/ 其/ 通常/ 需要/ 付出/ 的/ 计算/ 复杂性/ 却/ 达到/ 了/ Π/ P/ 问题/ 是/ 很/ 难/ 和/ 现有/ 商业/ 数据库/ 技术/ 结合/ 而/ 得到/ 广泛/ 的/ 应用/ ;/ 其他/ 关于/ 不/ 一致/ 数据库/ 上/ 聚集/ 查询/ 的/ 研究/ 则/ 主要/ 集中/ 在/ 概率/ 数据库/ 模型/ 方面/ [/ 14/ -/ 17/ ]/ 或/ 其他/ 完整性/ 语义/ 约束/ 方面/ [/ 18/ -/ 20/ ]/ ,/ 它们/ 显然/ 不是/ 本文/ 所/ 要/ 面对/ 的/ 传统/ 数据/ 集成/ 环境/ ./ Fuxman/ 的/ 一致性/ 聚集/ 查询/ 可以/ 用/ SQL/ 语句/ 表达/ ,/ 对于/ 非/ 一致/ 数据库/ 不管/ 是/ 数据源/ 的/ 本地/ 数据库/ 还是/ 集成系统/ 的/ 全局/ 数据库/ 该/ 方法/ 都/ 是/ 适用/ 的/ ,/ 很/ 好地解决/ 了/ 一致性/ 聚集/ 查询/ 重写/ 的/ 可/ 实现/ 问题/ ,/ 但/ 其/ 对/ 不/ 一致/ 数据库/ 实例/ 形成/ 的/ 环境/ 、/ 过程/ 及/ 如何/ 有效/ 提高/ 一致性/ 聚集/ 查询/ 性能/ 等/ 问题/ 没有/ 深入/ 考虑/ ./ 实际上/ ,/ 数据源/ 数据库/ 由于/ 本地/ 完整性/ 约束/ 机制/ 而/ 产生/ 违反/ 主键/ 约束/ 的/ 情况/ 较/ 少/ ,/ 更/ 多/ 的/ 情况/ 是/ 在/ 数据/ 集成/ 环境/ 下/ 由于/ 缺少/ 全局/ 完整性/ 约束/ 机制/ 而/ 导致/ 非/ 一致/ 集成/ 数据库/ 的/ 产生/ ./ 对于/ 数据/ 集成/ 环境/ 下/ CQA/ 问题/ 的/ 解决/ ,/ 可以/ 在/ 数据/ 集成/ 构建/ 时/ 就/ 充分考虑/ 一致性/ 聚集/ 查询/ 如何/ 高效/ 地/ 实现/ ./ 因此/ ,/ 本文/ 通过/ OR/ -/ database/ 集成/ 模式/ 有效/ 隔离/ 集成/ 数据库/ 的/ 一致性/ 部分/ 和/ 非/ 一致性/ 部分/ ,/ 同样/ 针对/ 合取/ 查询/ 类/ Cforest/ 上/ 的/ 分组/ 聚集/ 查询/ 提出/ 了/ 基于/ OR/ -/ database/ 集成/ 模式/ 的/ 一致性/ 聚集/ 查询/ 重写/ 算法/ ,/ 并且/ 在/ 给出/ 了/ 重写/ 算法/ 正确性/ 证明/ 之后/ ,/ 通过/ 一致性/ 聚集/ 查询/ 代价/ 分析/ 比较/ 和/ 基于/ TPC/ -/ H/ 基准/ 的/ 模拟实验/ 表明/ :/ 与/ Fuxman/ 的/ 一致性/ 聚集/ 查询方法/ 相比/ ,/ 本文/ 的/ 一致性/ 聚集/ 查询方法/ 在/ 基于/ OR/ -/ database/ 的/ 集成/ 数据库/ 上/ 具有/ 更好/ 的/ 整体/ 性能/ ./ 2OR/ -/ database/ 数据/ 集成/ 模式/ 如果/ 用/ Dom/ (/ Ai/ )/ 表示/ 属性/ 集合/ U/ =/ {/ A1/ ,/ A2/ ,/ …/ ,/ Am/ }/ 上/ 关系/ 模式/ R/ (/ U/ )/ 的/ 第/ i/ 个/ 属性/ 域/ ,/ 则/ R/ 的/ 关系/ 实例/ r/ 就是/ Dom/ (/ A1/ )/ ×/ Dom/ (/ A2/ )/ ×/ …/ ×/ Dom/ (/ Am/ )/ 的/ 一个/ 子集/ ,/ 而/ 一个/ 关系数据库/ 模式/ 是/ 一个/ 关系/ 模式/ 集合/ Σ/ =/ {/ R1/ ,/ R2/ ,/ …/ ,/ Rn/ }/ ,/ 一个/ 关系数据库/ 实例/ 则/ 是/ Σ/ 上/ 的/ 关系/ 实例/ 集合/ I/ =/ {/ r1/ ,/ r2/ ,/ …/ ,/ rn/ }/ ./ OR/ -/ database/ [/ 21/ ]/ 是/ 定义/ 在/ 包含/ 简单/ 常量/ 和/ 有限/ 可/ 选/ 常量/ (/ 即/ OR/ -/ object/ )/ 集合/ 上/ 的/ 非/ 确定性/ 数据库/ ,/ 它/ 代表/ 了/ 一个/ 关系数据库/ 集合/ ,/ 即用/ 确定/ 的/ 域/ 可选/ 常量/ 替换/ 每/ 一个/ OR/ -/ object/ 所/ 获得/ 的/ 确定性/ 数据库/ 实例/ 集合/ ./ 考虑/ 到/ 数据/ 集成/ 环境/ 下/ 一致性/ 聚集/ 查询/ 重写/ 的/ 实现/ 及/ 效率/ 问题/ ,/ 本文/ 采用/ 如下/ 的/ 关系/ 模式/ 来/ 表示/ 非/ 确定性/ 数据库/ OR/ -/ database/ ./ 定义/ 1/ ./ 设/ ATOMIC/ 常量/ 域/ Dat/ 和/ OR/ -/ object/ 标识/ 常量/ 域/ Dor/ 是/ 两个/ 不/ 相交/ 的/ 可数/ 无限/ 常量/ 集合/ ,/ 定义/ 在/ D/ =/ Dat/ ∪/ Dor/ 上/ 表达/ OR/ -/ database/ 关系数据库/ 模式/ Σ/ 包含/ ATOMIC/ 和/ OR/ -/ objects/ 两类/ 关系/ ,/ 每个/ ATOMIC/ 关系/ R/ 都/ 存在/ 一个/ OR/ -/ object/ 关系/ R/ _/ or/ 与/ 之/ 对应/ ./ 如果/ 用/ Key/ (/ x/ )/ 和/ Nokey/ (/ x/ )/ 分别/ 表示/ x/ 的/ 主键/ 及/ 非/ 主键/ ,/ 则/ Σ/ 的/ R/ 及/ R/ _/ or/ 应该/ 满足/ :/ (/ 1/ )/ Dom/ (/ Key/ (/ R/ _/ or/ )/ )/ / Dor/ ∧/ Dom/ (/ Key/ (/ R/ )/ )/ / Dat/ ;/ (/ 2/ )/ Key/ (/ R/ _/ or/ )/ / Nokey/ (/ R/ )/ ∧/ Nokey/ (/ R/ _/ or/ )/ =/ Nokey/ (/ R/ )/ -/ Key/ (/ R/ _/ or/ )/ ./ 关系/ 模式/ Σ/ 通过/ OR/ -/ objects/ 关系/ R/ _/ or/ 存储/ 对应/ ATOMIC/ 关系/ R/ 中/ 出现/ 的/ OR/ -/ objects/ ,/ 即/ 违反/ 主键/ 约束/ 的/ 元组/ 集合/ ,/ R/ 仅/ 保留/ 一个/ 元组/ 并/ 通过/ 外键/ 引用/ R/ _/ or/ 中/ 的/ OR/ -/ objects/ ,/ 同时/ 设置/ Nokey/ (/ R/ )/ 冲突/ 属性/ 值为/ 未知/ ./ 定义/ 2/ ./ 一个/ 三元组/ 〈/ Σ/ ,/ / ,/ / 〉/ 可以/ 形式化/ 的/ Page3/ 表达/ 一个/ 数据/ 集成系统/ / 的/ 数据/ 集成系统/ 需要/ 满足/ 下面/ 3/ 个/ 条件/ :/ (/ 1/ )/ 全局/ 模式/ Σ/ 是/ 基于/ OR/ -/ database/ 的/ 关系/ 模式/ ,/ 同时/ 包含/ ATOMIC/ 关系/ 和/ OR/ -/ objects/ 关系/ ./ (/ 2/ )/ 数据源/ 模式/ / 是非/ OR/ -/ database/ 的/ 关系/ 模式/ ,/ 仅/ 包含/ ATOMIC/ 关系/ ./ (/ 3/ )/ 模式/ 映射/ / 是/ 扩展/ Source/ -/ to/ -/ TargetDependencies/ (/ STDs/ )/ [/ 22/ -/ 24/ ]/ 并/ 允许/ 出现/ 谓词/ 递归/ 并/ 可/ 表示/ 为/ ψ/ Σ/ (/ 狓/ ,/ 狌/ )/ :/ -/ φ/ / (/ 狓/ ,/ 狔/ )/ ,/ λ/ Σ/ (/ 狓/ ,/ 狑/ )/ 的/ 依赖/ 集/ ,/ 其中/ ψ/ Σ/ (/ 狓/ ,/ 狌/ )/ 和/ λ/ Σ/ (/ 狓/ ,/ 狑/ )/ 都/ 是/ 模式/ Σ/ 上/ 的/ 原子/ 或/ 原子/ 否定/ 构成/ 的/ 合取/ 公式/ ,/ 而/ φ/ / (/ 狓/ ,/ 狔/ )/ 是/ 模式/ / 上/ 的/ 任意/ 一阶/ 公式/ ./ 设/ s/ ,/ g/ 分别/ 为/ 数据源/ 模式/ / 和/ 全局/ 模式/ Σ/ 的/ 数据库/ 实例/ ,/ 如果/ s/ 和/ g/ 满足/ 模式/ 映射/ / ,/ 即/ 对/ / 中/ 的/ 每/ 一条/ 依赖/ 规则/ ψ/ Σ/ (/ 狓/ ,/ 狌/ )/ :/ -/ φ/ / (/ 狓/ ,/ 狔/ )/ ,/ λ/ Σ/ (/ 狓/ ,/ 狑/ )/ 都/ 有/ :/ 对/ 任意/ 元组/ 犪/ ,/ 犮/ 如果/ 存在/ 某/ 元组/ 犲/ 使得/ 数据库/ 实例/ s/ 和/ g/ 满足/ φ/ (/ 犪/ ,/ 犮/ )/ ∧/ λ/ (/ 犪/ ,/ 犲/ )/ ,/ 则/ 必定/ 存在/ 一个/ 元组/ 狏/ 使得/ 数据库/ 实例/ g/ 满足/ ψ/ (/ 犪/ ,/ 狏/ )/ ./ 例/ 1/ ./ 存储/ 雇员/ 信息/ 的/ OR/ -/ database/ 数据/ 集成系统/ / =/ 〈/ Σ/ ,/ / ,/ / 〉/ 的/ 全局/ 模式/ Σ/ =/ {/ e/ (/ ename/ ,/ sal/ ,/ or/ _/ id/ )/ ,/ e/ _/ or/ (/ or/ _/ id/ ,/ sal/ )/ }/ ,/ 其中/ 的/ ename/ 和/ or/ _/ id/ 分别/ 是/ ATOMIC/ 关系/ e/ 和/ OR/ -/ object/ 关系/ e/ _/ or/ 的/ 主键/ ,/ 并且/ e/ 通过/ 外键/ or/ _/ id/ 引用/ e/ _/ or/ 中/ 的/ OR/ -/ object/ ;/ 包含/ 两个/ 本地/ 雇员/ 信息/ 数据库/ 的/ 源/ 模式/ / =/ {/ s1/ :/ emp/ (/ ename/ ,/ sal/ )/ ,/ s2/ :/ employee/ (/ name/ ,/ salary/ )/ }/ ;/ 同样/ 的/ ,/ 下划线/ 属性/ 为/ 关系/ 主键/ ./ / 中/ 映射/ s1/ 源/ 数据/ 到/ 全局/ 模式/ Σ/ 的/ 元组/ 依赖/ 规则/ 应/ 包括/ (/ 1/ )/ ~/ (/ 3/ )/ ,/ 这里/ x/ ,/ y/ ,/ z/ ∈/ Dat/ ∧/ y/ ≠/ z/ ,/ 珘/ o/ ∈/ Dor/ ,/ 两个/ 特殊/ 的/ 属性/ 值/ “/ _/ ”/ 代表/ 未知/ ,/ 而/ “/ ⊥/ ”/ 代表/ 不/ 确定/ ./ (/ 1/ )/ e/ (/ x/ ,/ y/ ,/ _/ )/ :/ -/ emp/ (/ x/ ,/ y/ )/ ,/ / / z/ ./ e/ (/ x/ ,/ z/ ,/ _/ )/ ,/ / e/ (/ x/ ,/ ⊥/ ,/ 珘/ o/ )/ ;/ (/ 2/ )/ / e/ (/ x/ ,/ z/ ,/ _/ )/ ∧/ e/ (/ x/ ,/ ⊥/ ,/ 珘/ o/ )/ ∧/ e/ _/ or/ (/ 珘/ o/ ,/ z/ )/ ∧/ e/ _/ or/ (/ 珘/ o/ ,/ y/ )/ :/ -/ emp/ (/ x/ ,/ y/ )/ ,/ / z/ ./ e/ (/ x/ ,/ z/ ,/ _/ )/ ;/ (/ 3/ )/ e/ _/ or/ (/ 珘/ o/ ,/ y/ )/ :/ -/ emp/ (/ x/ ,/ y/ )/ ,/ e/ (/ x/ ,/ ⊥/ ,/ 珘/ o/ )/ 3/ 条/ 规则/ 表达/ 了/ s1/ 的/ 数据/ 如何/ 被/ 集成/ 到/ 全局/ 模式/ Σ/ 中/ ./ 其中/ ,/ (/ 1/ )/ 表明/ 如果/ s1/ 的/ emp/ 存在/ 元组/ (/ x/ ,/ y/ )/ 并且/ Σ/ 的/ e/ 不/ 存在/ 主键/ 为/ x/ 的/ 其他/ 元组/ 时/ e/ 中应/ 包含/ 元组/ (/ x/ ,/ y/ ,/ _/ )/ ;/ (/ 2/ )/ 表明/ 如果/ emp/ 存在/ 元组/ (/ x/ ,/ y/ )/ 并且/ Σ/ 中/ 的/ e/ 存在/ 元组/ (/ x/ ,/ z/ ,/ _/ )/ 时/ e/ 中/ 应用/ 元组/ (/ x/ ,/ ⊥/ ,/ 珘/ o/ )/ 代替/ 它/ 并且/ e/ _/ or/ 中应/ 包含/ 元组/ (/ 珘/ o/ ,/ z/ )/ 和/ (/ 珘/ o/ ,/ y/ )/ ;/ 最后/ 的/ (/ 3/ )/ 表明/ 如果/ emp/ 存在/ 元组/ (/ x/ ,/ y/ )/ 并且/ Σ/ 的/ e/ 存在/ 元组/ (/ x/ ,/ ⊥/ ,/ 珘/ o/ )/ 时/ e/ _/ or/ 中应/ 包含/ 元组/ (/ 珘/ o/ ,/ y/ )/ ./ 同理/ ,/ s2/ 到/ Σ/ 的/ 映射/ 只/ 需/ 把/ 其中/ 的/ emp/ 改成/ employee/ 即可/ ,/ 所有/ 规则/ 中/ 未知/ 及/ 不/ 确定/ 属性/ 值/ 在/ 实际/ 商业/ 数据库/ 中/ 可用/ 空值/ (/ null/ )/ 来/ 表示/ ./ 例如/ :/ 假设/ s1/ 的/ emp/ 包含/ 元组/ (/ Jenny/ ,/ 3000/ )/ 和/ (/ Alice/ ,/ 3200/ )/ ,/ s2/ 的/ employee/ 包含/ 元组/ (/ Jack/ ,/ 2800/ )/ 和/ (/ Alice/ ,/ 3500/ )/ ,/ 那么/ Σ/ 的/ e/ 为/ 空时/ ,/ 对/ s1/ 的/ 元组/ (/ Jenny/ ,/ 3000/ )/ 来说/ 满足/ 规则/ (/ 1/ )/ ,/ 则/ 元组/ (/ Jenny/ ,/ 3000/ ,/ null/ )/ 应/ 出现/ 在/ e/ 中/ ,/ 此时/ 对/ 元组/ (/ Alice/ ,/ 3200/ )/ 来说/ 同样/ 满足/ 规则/ (/ 1/ )/ ,/ 则/ e/ 也/ 应该/ 包含/ 元组/ (/ Alice/ ,/ 3200/ ,/ null/ )/ ;/ 这时/ ,/ 对/ s2/ 的/ 元组/ (/ Alice/ ,/ 3500/ )/ 来说/ 满足/ 规则/ (/ 2/ )/ ,/ 在/ e/ 中/ 应该/ 由/ 元组/ (/ Alice/ ,/ null/ ,/ #/ 1/ )/ 代替/ 元组/ (/ Alice/ ,/ 3200/ ,/ null/ )/ 并且/ e/ _/ or/ 应该/ 同时/ 包含/ 元组/ (/ #/ 1/ ,/ 3200/ )/ 和/ (/ #/ 1/ ,/ 3500/ )/ ;/ 当然/ ,/ 如果/ 此时/ 数据源/ 还/ 存在/ 另外/ 元组/ (/ Alice/ ,/ 4000/ )/ ,/ 那么/ 其/ 显然/ 满足/ 规则/ (/ 3/ )/ ,/ 此时/ e/ _/ or/ 中/ 还/ 应该/ 包含/ 元组/ (/ #/ 1/ ,/ 4000/ )/ ./ 3OR/ -/ database/ 聚集/ 查询/ 的/ 一致性/ 3.1/ OR/ -/ database/ 全局/ 模式/ 的/ 完整性/ 约束/ 完整性/ 约束/ 表达/ 数据/ 语义/ 一致性/ ,/ DBMS/ 一般/ 通过/ 事务管理/ 维护/ 其/ 有效性/ ,/ 最/ 常用/ 的/ 完整性/ 约束/ 是/ 函数/ 依赖/ (/ FunctionalDependency/ ,/ FD/ )/ 和/ 包含/ 依赖/ (/ InclusionDependency/ ,/ IND/ )/ ,/ 例如/ 主外键/ 约束/ ./ 如果/ 属性/ 集/ X/ 为/ 关系/ R/ (/ U/ )/ 的/ 主键/ 即/ Key/ (/ R/ )/ =/ X/ ,/ 则/ 主键/ 约束/ X/ →/ U/ 就是/ 一个/ 函数/ 依赖/ ;/ 对/ 关系/ R/ (/ U/ )/ 和/ S/ (/ V/ )/ 来说/ ,/ 外键/ 约束/ R/ (/ W/ )/ / S/ (/ Z/ )/ 就是/ 一个/ 包含/ 依赖/ ,/ 其中/ W/ / U/ ,/ Z/ / V/ 并且/ Z/ =/ Key/ (/ S/ )/ ./ 那么/ ,/ OR/ -/ database/ 全局/ 模式/ Σ/ 上/ 的/ 完整性/ 约束/ 集合/ 定义/ 了/ 来自/ 各/ 数据源/ 的/ 数据/ 应该/ 满足/ 的/ 语义/ 一致性/ ./ 定义/ 3/ ./ OR/ -/ database/ 全局/ 关系/ 模式/ Σ/ 上/ 的/ 完整性/ 约束/ C/ 仅/ 包括/ 主外键/ 约束/ ,/ Σ/ 上/ 的/ 集成/ 数据库/ 实例/ g/ 如果/ 满足/ C/ 则/ 称/ g/ 关于/ C/ 是/ 一致/ 的/ ,/ 记为/ g/ / C/ ;/ 否则/ 称/ g/ 关于/ C/ 是/ 不/ 一致/ 的/ ,/ 记为/ g/ / // C/ ./ 定理/ 1/ ./ 对/ 基于/ OR/ -/ database/ 的/ 数据/ 集成系统/ / =/ 〈/ Σ/ ,/ / ,/ / 〉/ ,/ 如果/ 所有/ 数据源/ 实例/ s/ 关于/ / 的/ 主外键/ 约束/ Cs/ 是/ 一致/ 的/ ,/ 那么/ Σ/ 上/ 的/ OR/ -/ database/ 集成/ 数据库/ 实例/ g/ 关于/ Σ/ 的/ 完整性/ 约束/ C/ 不/ 一致/ 只/ 需/ 满足/ 下面/ 两个/ 条件/ 之一/ :/ (/ 1/ )/ 设/ ATOMIC/ 关系/ Ri/ 存在/ 主键/ ,/ 如果/ Ri/ 的/ OR/ -/ objects/ 关系/ Ri/ _/ or/ 实例/ ri/ 不空/ ,/ 则/ 有/ g/ / // C/ ./ (/ 2/ )/ 设/ ATOMIC/ 关系/ Ri/ 的/ 属性/ A/ ∈/ Nokey/ (/ Ri/ )/ 是/ 参考/ ATOMIC/ 关系/ Rj/ 的/ 外键/ ,/ 如果/ 它们/ 的/ 实例/ ri/ 和/ rj/ 满足/ ri/ 中/ 存在/ 元组/ t/ 使得/ t/ [/ A/ ]/ / Dom/ (/ Key/ (/ rj/ )/ )/ 或/ Ri/ 的/ OR/ -/ objects/ 关系/ Ri/ _/ or/ 实例/ ri/ 存在/ 元组/ t/ 使得/ t/ [/ A/ ]/ / Dom/ (/ Key/ (/ rj/ )/ )/ 时/ ,/ 则/ 有/ g/ / // C/ ./ 全局/ 关系/ 模式/ Σ/ 能够/ 表达/ OR/ -/ database/ ,/ 但/ Σ/ 的/ 集成/ 数据库/ 实例/ 是否/ 是非/ 一致/ 的/ ,/ 关键/ 还是/ 看该/ Page4/ 数据库/ 实例/ 是否/ 违反/ 了/ Σ/ 上/ 的/ 主外键/ 完整性/ 约束/ ,/ 而/ 上述/ 定理/ 给出/ 了/ 集成/ 数据库/ 实例/ g/ 分别/ 违反/ 主外键/ 的/ 条件/ ,/ 定理/ 的/ 证明/ 详见/ 附录/ ./ 3.2/ 全局/ 模式/ 上/ 聚集/ 查询/ 的/ 一致性/ 回答/ 定义/ 4/ ./ 设/ C/ 是/ OR/ -/ database/ 全局/ 模式/ Σ/ 上/ 的/ 主外键/ 约束/ ,/ Σ/ (/ g/ )/ 表示/ Σ/ 的/ 一个/ 集成/ 数据库/ 实例/ g/ 的/ 元组/ 集/ ,/ 如果/ g/ 也/ 是/ Σ/ 的/ 一个/ 实例/ 并且/ Σ/ (/ g/ )/ 是/ 满足/ g/ / C/ 的/ Σ/ (/ g/ )/ 最大/ 子集/ ,/ 则/ 称/ g/ 是/ g/ 关于/ C/ 的/ 一个/ 修复/ ,/ 如果/ 用/ RepairsC/ (/ g/ )/ 表示/ g/ 关于/ C/ 的/ 所有/ 修复/ ,/ 则/ 有/ g/ ∈/ RepairsC/ (/ g/ )/ ./ 对/ OR/ -/ database/ 上/ 聚集/ 查询/ 的/ 一致性/ 问题/ ,/ 本文/ 沿用/ 文献/ [/ 3/ ]/ 基于/ 修复/ 的/ 观点/ 来/ 解决/ 并且/ 获取/ 修复/ 的/ 操作/ 仅/ 考虑/ 元组/ 删除/ [/ 4/ ,/ 25/ ]/ ./ OR/ -/ database/ 集成/ 数据库/ 实例/ g/ 的/ 一个/ 修复/ g/ 就是/ 通过/ 删除/ g/ 中/ 违反/ 主外键/ 约束/ 的/ 一个/ 最小/ 元组/ 集而/ 获得/ ,/ 即/ 删除/ 每个/ ATOMIC/ 关系/ 实例/ 中/ 不/ 存在/ 参考/ 引用/ 的/ 元组/ 使/ 其/ 满足/ 外键/ 约束/ ,/ 并/ 删除/ 对应/ OR/ -/ objects/ 关系/ 的/ 一个/ 最小/ 元组/ 集使/ 其/ 满足/ 主外键/ 约束/ ./ 本文/ 考虑/ 的/ OR/ -/ database/ 全局/ 模式/ Σ/ 上/ 的/ 聚集/ 查询/ Caggforest/ 同样/ 是/ 建立/ 在/ 文献/ [/ 4/ ]/ 提出/ 的/ 合取/ 查询/ 类/ Cforest/ 之上/ ,/ 并/ 通过/ 扩展/ 分组/ 及/ 聚集/ 操作/ 得到/ 的/ ./ 定义/ 5/ ./ 设/ q/ 是/ 一个/ 聚集/ 合取/ 查询/ ,/ q/ ∈/ Caggforest/ 当且/ 仅/ 当/ 它/ 具有/ 如下/ 形式/ :/ select/ 狕/ ,/ [/ count/ (/ / )/ |/ F1/ (/ 狏/ 1/ )/ ,/ F1/ (/ 狏/ 2/ )/ ,/ …/ ,/ Fm/ (/ 狏/ m/ )/ ]/ from/ [/ q/ / (/ 狕/ )/ |/ q/ / (/ 狕/ ,/ 狌/ )/ ]/ groupby/ 狕/ 这里/ q/ / 是/ Σ/ 的/ ATOMIC/ 关系/ 上/ 一个/ 合取/ 查询/ 类/ Cforest/ 中/ 的/ 查询/ ,/ 狏/ 1/ ,/ 狏/ 2/ ,/ …/ ,/ 狏/ m/ 是/ 由/ 狌/ 中/ 变量/ 构成/ 的/ 向量/ ,/ count/ (/ / )/ 为/ 元组/ 计数/ 函数/ 而/ F1/ ,/ F2/ ,/ …/ ,/ Fm/ 是/ 向量/ 狏/ 1/ ,/ 狏/ 2/ ,/ …/ ,/ 狏/ m/ 上/ 的/ 可能/ 为/ min/ ,/ max/ 或/ sum/ 的/ 聚集/ 函数/ ,/ 称/ 狕/ 为/ 分组/ 变量/ 并称/ 狏/ 1/ ,/ 狏/ 2/ ,/ …/ ,/ 狏/ m/ 为/ 聚集/ 变量/ ./ 这里/ 特别/ 注意/ ,/ Cforest/ 类/ 的/ 查询/ q/ / 的/ 连接/ 图/ (/ joingraph/ )/ [/ 4/ ]/ 必须/ 满足/ 是/ 一个/ 森林/ ,/ 所有/ 的/ 非键/ -/ 键/ 连接/ 是/ 完全/ 连接/ 且/ 不/ 出现/ 重复/ 关系/ 3/ 个/ 条件/ ./ 另外/ ,/ 在/ 全局/ 模式/ Σ/ 的/ ATOMIC/ 关系/ 上/ 执行/ 合取/ 查询/ q/ / 时/ ,/ 如果/ 元组/ or/ _/ id/ 属性/ 值/ 引用/ OR/ -/ objects/ 关系/ 元组/ ,/ 则/ 需要/ 连接/ OR/ -/ objects/ 关系/ 元组/ 以/ 形成/ 连接/ 元组/ 集合/ 代替/ 原始/ 元组/ ./ OR/ -/ database/ 全局/ 模式/ Σ/ 上/ 的/ 分组/ 聚集/ 查询/ q/ 可能/ 因为/ Σ/ 的/ 集成/ 数据库/ 实例/ g/ 的/ 非/ 确定性/ 而/ 导致/ 查询/ 结果/ 的/ 不一致性/ ,/ 所以/ 基于/ 修复/ 的/ Σ/ 上/ 分组/ 聚集/ 查询/ q/ 的/ 一致性/ 回答/ 语义/ 可以/ 作/ 如下/ 定义/ ./ 定义/ 6/ (/ 分组/ 聚集/ 查询/ 的/ 一致性/ 回答/ )/ ./ 设/ Σ/ 为/ 一个/ OR/ -/ database/ 全局/ 关系/ 模式/ ,/ C/ 是/ Σ/ 上/ 的/ 主外键/ 约束/ ,/ g/ 为/ Σ/ 的/ 数据库/ 实例/ ,/ 并设/ q/ 为/ 拥有/ 自由/ 变量/ 狕/ 和/ v/ 的/ 聚集/ 查询/ ,/ 这里/ v/ 可能/ 是/ 由/ 聚集/ 函数/ 计算/ 得来/ 的/ 数值/ 域/ 变量/ ,/ 满足/ 下面/ 三个/ 条件/ 的/ 元组/ (/ 狋/ ,/ bgl/ ,/ blu/ )/ 被/ 称为/ 是/ 聚集/ 查询/ q/ 的/ 一致性/ 查询/ 回答/ ,/ 记/ 为/ (/ 狋/ ,/ bgl/ ,/ blu/ )/ ∈/ CQAC/ (/ q/ ,/ g/ )/ ,/ 其中/ bgl/ 和/ blu/ 分别/ 为/ 狋/ 在/ q/ 中/ 的/ 最大/ 下界/ 和/ 最小/ 上界/ ./ (/ 1/ )/ 对/ 每/ 一个/ g/ 关于/ C/ 的/ 修复/ g/ ,/ 存在/ 某个/ d/ 使得/ (/ 狋/ ,/ d/ )/ ∈/ q/ (/ g/ )/ 并且/ 满足/ bgl/ / d/ / blu/ ./ (/ 2/ )/ 存在/ 某个/ g/ 关于/ / 的/ 修复/ g/ 满足/ (/ 狋/ ,/ bgl/ )/ ∈/ q/ (/ g/ )/ ./ (/ 3/ )/ 存在/ 某个/ g/ 关于/ / 的/ 修复/ g/ 满足/ (/ 狋/ ,/ blu/ )/ ∈/ q/ (/ g/ )/ ./ 4/ 聚集/ 查询/ 重写/ 4.1/ 聚集/ 查询/ 的/ 一致性/ 回答/ OR/ -/ database/ 全局/ 模式/ Σ/ 上/ 的/ 用户/ 查询/ 可能/ 因为/ Σ/ 的/ 集成/ 数据库/ 实例/ g/ 不/ 一致/ 而/ 返回/ 不/ 一致/ 结果/ ,/ 定义/ 5/ 给出/ 了/ OR/ -/ database/ 上/ 聚集/ 查询/ 的/ 一致性/ 语义/ ./ 基于/ 查询/ 重写/ 计算/ CQA/ 的/ 最大/ 优势/ 就是/ 无需/ 明确/ 地/ 构建/ 修复/ ,/ 而是/ 通过/ 查询/ 变换/ 获得/ 新/ 的/ 一阶/ 查询/ 并/ 直接/ 运行/ 在/ 不/ 一致/ 数据库/ 上/ 获得/ 与/ 原/ 查询/ 同样/ 预期/ 的/ 结果/ ./ 用户/ 查询/ 是/ 基于/ ATOMIC/ 关系/ ,/ 如果/ ATOMIC/ 关系/ R/ 中/ 存在/ 元组/ 狋/ 且/ 其/ 外/ 键/ or/ _/ id/ 上/ 的/ 值/ 非空/ ,/ 则/ 其/ 必然/ 引用/ 了/ 非空/ OR/ -/ objects/ 关系/ R/ _/ or/ 中/ 的/ 元组/ ,/ 由/ 定理/ 1/ 可知/ g/ 不/ 一致/ ./ 此时/ 的/ 一致性/ 查询/ 重写/ 就/ 需要/ 通过/ 连接/ ATOMIC/ 关系/ R/ 及其/ OR/ -/ objects/ 关系/ R/ _/ or/ 获取/ 一致性/ 查询/ 回答/ ./ 例/ 2/ ./ 同样/ 存储/ 雇员/ 信息/ 的/ OR/ -/ database/ 全局/ 模式/ Σ/ =/ {/ emp/ (/ ename/ ,/ dept/ ,/ sal/ ,/ or/ _/ id/ )/ ,/ emp/ _/ or/ (/ or/ _/ id/ ,/ dept/ ,/ sal/ )/ }/ ,/ C/ 是/ Σ/ 上/ 的/ 主外键/ 约束/ ,/ 其中/ 下划线/ 字段/ 为/ 关系/ 主键/ ,/ 不同/ 关系/ 中/ 同名/ 的/ 非/ 主键/ 属性/ 与/ 主键/ 属性/ 之间/ 存在/ 外键/ 约束/ ./ 假设/ Σ/ 上/ 的/ 一个/ 集成/ 数据库/ 实例/ g/ 如表/ 1/ 所示/ ./ 表/ 1OR/ -/ database/ 模式/ Σ/ 的/ 一个/ 集成/ 数据库/ 实例/ 犵/ enamedeptsalor/ _/ idor/ _/ iddeptsalJennyFinance3000null/ #/ 1Finance3000Smithnull3000/ #/ 1/ #/ 1Account3000JackSales2800null/ #/ 2Sales3500Alicenullnull/ #/ 2/ #/ 2Finance3200JohnAccountnull/ #/ 3/ #/ 3Account2800RoseSales3500null/ #/ 3Account2500Page5/ 根据/ 前面/ 定理/ 1/ ,/ 集成/ 数据库/ 实例/ g/ 显然/ 是非/ 一致/ 的/ ,/ 接下来/ 考虑/ ATOMIC/ 关系/ emp/ 上/ 的/ 一个/ 分组/ 聚集/ 查询/ q/ ,/ 它/ 要求/ 统计/ 各/ 部门/ 的/ 雇员/ 薪水/ 总和/ ,/ 该/ 查询/ 可以/ 使用/ 式/ (/ 1/ )/ 形式/ 的/ 语言表达/ 如下/ :/ 由/ 前面/ 定义/ 4/ 和/ 定义/ 6/ ,/ 设非/ 一致/ 的/ 数据库/ 实例/ g/ 的/ 修复/ 集合/ 为/ RepairsC/ (/ g/ )/ ,/ 则/ RepairsC/ (/ g/ )/ 一共/ 包含/ 8/ 个/ 数据库/ 修复/ ,/ 而/ 分组/ 聚集/ 查询/ q/ 的/ 一致性/ 回答/ CQAC/ (/ q/ ,/ g/ )/ 可以/ 通过/ RepairsC/ (/ g/ )/ 的/ 所有/ 修复/ 计算/ 获得/ ,/ 即/ 有/ CQAC/ (/ q/ ,/ g/ )/ =/ {/ (/ Account/ ,/ [/ 2500/ ,/ 5800/ ]/ )/ ,/ (/ Finance/ ,/ [/ 3000/ ,/ 9200/ ]/ )/ ,/ (/ Sales/ ,/ [/ 6300/ ,/ 9800/ ]/ )/ }/ ./ 查询/ 的/ 一致性/ 回答/ 表明/ 会计部/ 薪水/ 总和/ 在/ 2500/ ~/ 5800/ 之间/ ,/ 财务部/ 的/ 薪水/ 总和/ 在/ 3000/ ~/ 9200/ 之间/ ,/ 而/ 销售部/ 的/ 薪水/ 总和/ 在/ 6300/ ~/ 9800/ 之间/ ./ 当然/ ,/ CQAC/ (/ q/ ,/ g/ )/ 也/ 可以/ 通过/ 重写/ 的/ 一致性/ 查询/ Q/ (/ d/ ,/ low/ ,/ up/ )/ =/ Qg/ (/ d/ ,/ low/ )/ ∧/ Ql/ (/ d/ ,/ up/ )/ 直接/ 在/ 非/ 一致性/ 数据库/ 实例/ g/ 上/ 执行/ 获取/ ,/ 那么/ 分别/ 计算/ 各/ 部门/ 薪水/ 总和/ 最大/ 下界/ 和/ 最小/ 上界/ 的/ 子/ 查询/ Qg/ (/ d/ ,/ low/ )/ 和/ Ql/ (/ d/ ,/ up/ )/ 分别/ 可以/ 表示/ 为/ Qg/ (/ d/ ,/ low/ )/ =/ selectd/ ,/ sum/ (/ s/ )/ aslowfromQg/ (/ e/ ,/ d/ ,/ s/ )/ groupbydQg/ (/ e/ ,/ d/ ,/ s/ )/ =/ selectnamease/ ,/ deptasd/ ,/ salassfromempwhereor/ _/ id/ =/ =/ nullunionselectnamease/ ,/ emp/ ./ deptasd/ ,/ min/ (/ emp/ _/ or/ ./ sal/ )/ assfromemp/ ,/ emp/ _/ orwhered/ !/ =/ nullandemp/ ./ or/ _/ id/ =/ emp/ _/ or/ ./ or/ _/ idgroupbye/ ,/ dQl/ (/ d/ ,/ up/ )/ =/ selectd/ ,/ sum/ (/ s/ )/ asupfromQl/ (/ e/ ,/ d/ ,/ s/ )/ ∧/ Ql/ (/ e/ ,/ d/ ,/ s/ )/ =/ selectnamease/ ,/ deptasd/ ,/ salassfromempwhereor/ _/ id/ =/ =/ nullunionselectnamease/ ,/ emp/ ./ deptasd/ ,/ max/ (/ emp/ _/ or/ ./ sal/ )/ assfromemp/ ,/ emp/ _/ orwhereemp/ ./ or/ _/ id/ =/ emp/ _/ or/ ./ or/ _/ idgroupbye/ ,/ d4/ ./ 2/ 聚集/ 查询/ 重写/ 算法/ Qg/ (/ d/ ,/ low/ )/ groupbyd/ 针对/ OR/ -/ database/ 全局/ 模式/ Σ/ 上/ 的/ 分组/ 聚集/ 查询/ q/ ,/ 本/ 节/ 给出/ 它/ 的/ 一致性/ 查询/ 重写/ 算法/ ,/ 其中/ 的/ 子/ 查询/ q/ / 为/ ATOMIC/ 关系/ 上/ 符合/ Cforest/ 的/ 合取/ 查询/ ./ 分组/ 聚集/ 查询/ q/ 主要/ 考虑/ 基于/ 包/ 语义/ 的/ 返回/ 包/ 元组/ 个数/ 的/ count/ (/ / )/ ,/ 及/ 返回/ 包/ 元组/ 求和/ 、/ 最大/ 和/ 最小/ (/ sum/ ,/ max/ 和/ min/ )/ 这/ 4/ 个/ 聚集/ 函数/ ./ 下面/ 首先/ 对/ 带有/ count/ (/ / )/ 的/ 分组/ 聚集/ 查询/ q/ ,/ 提出/ OR/ -/ database/ 的/ 一致性/ 查询/ 重写/ 算法/ ,/ 算法/ 如下/ 所示/ ./ 算法/ 1/ ./ RewriteCount/ _/ OR/ (/ q/ ,/ C/ )/ ./ 输入/ :/ 具有/ 如下/ 形式/ 的/ 聚集/ 查询/ qselect/ 狕/ ,/ count/ (/ / )/ fromq/ / (/ 狕/ )/ groupby/ 狕/ ,/ 这里/ q/ / 为/ Cforest/ 中/ 的/ 合取/ 查询/ ,/ C/ 为/ Σ/ 的/ 关系/ 集合/ / 上/ 的/ 主外键/ 约束/ ./ 输出/ :/ Q/ ,/ q/ 的/ 一致性/ 查询/ 重写/ 设/ G/ 为/ q/ 的/ 连接/ 图/ ,/ R1/ (/ 狓/ 1/ ,/ 狔/ 1/ ,/ o1/ )/ ,/ R2/ (/ 狓/ 2/ ,/ 狔/ 2/ ,/ o2/ )/ ,/ …/ ,/ Rm/ (/ 狓/ m/ ,/ 狔/ m/ ,/ om/ )/ 为/ G/ 所有/ 树/ 的/ 根/ ,/ 设/ 狓/ =/ ∪/ i/ =/ 1/ ,/ 2/ ,/ …/ ,/ m/ 狓/ i/ ,/ 狕/ =/ 狕/ -/ 狓/ 且/ q/ / =/ / 狑/ ./ / (/ 狑/ ,/ 狕/ )/ ,/ 设/ 狑/ =/ 狑/ -/ 狓/ ,/ q/ (/ 狓/ ,/ 狕/ ,/ 狅/ )/ =/ / 狑/ ,/ 狅/ ./ / (/ 狓/ ,/ 狑/ ,/ 狕/ ,/ 狅/ )/ ,/ 这里/ 狅/ 为/ R1/ ,/ R2/ ,/ …/ ,/ Rm/ 的/ or/ _/ id/ 属性/ 变量/ 向量/ ,/ 即/ 狅/ =/ 〈/ o1/ ,/ o2/ ,/ …/ ,/ om/ 〉/ ,/ 而/ 狅/ 为/ 狕/ 所在/ 关系/ or/ _/ id/ 属性/ 变量/ 向量/ 并/ 满足/ 狅/ =/ 狅/ -/ 狅/ ./ Qg/ (/ 狕/ ,/ low/ )/ =/ select/ 狕/ ,/ count/ (/ / )/ fromq/ (/ 狓/ ,/ 狕/ ,/ 狅/ )/ where/ 狕/ !/ =/ nullgroupby/ 狕/ Ql/ (/ 狕/ ,/ up/ )/ =/ select/ 狕/ ,/ count/ (/ / )/ fromQl/ (/ 狓/ ,/ 狕/ )/ ∧/ Qg/ (/ 狕/ ,/ low/ )/ groupby/ 狕/ Ql/ (/ 狓/ ,/ 狕/ )/ =/ select/ 狓/ ,/ 狕/ fromq/ (/ 狓/ ,/ 狕/ ,/ 狅/ )/ where/ 狅/ =/ nullunionselect/ 狓/ ,/ 狕/ fromq/ (/ 狓/ ,/ 狕/ ,/ 狅/ )/ ∧/ Ri/ _/ or/ (/ oi/ ,/ 狕/ i/ ,/ _/ )/ ∧/ …/ ∧/ Rj/ _/ or/ (/ oj/ ,/ 狕/ j/ ,/ _/ )/ Q/ (/ 狕/ ,/ low/ ,/ up/ )/ =/ Qg/ (/ 狕/ ,/ low/ )/ ∧/ Ql/ (/ 狕/ ,/ up/ )/ RETURNQ/ (/ 狕/ =/ 狕/ i/ ∪/ …/ ∪/ 狕/ j/ ,/ 狅/ =/ 〈/ oi/ ,/ …/ ,/ oj/ 〉/ ,/ 1/ / i/ / j/ / m/ )/ 上/ 的/ 主外键/ 约束/ ./ 算法/ 2/ ./ RewriteAgg/ _/ OR/ (/ q/ ,/ C/ )/ ./ 输入/ :/ 具有/ 如下/ 形式/ 的/ 聚集/ 查询/ qselect/ 狕/ ,/ [/ max/ (/ u/ )/ |/ min/ (/ u/ )/ |/ sum/ (/ u/ )/ ]/ fromq/ / (/ 狕/ ,/ u/ )/ groupby/ 狕/ 同样/ 的/ ,/ q/ / 为/ Cforest/ 中/ 的/ 合取/ 查询/ ,/ C/ 为/ Σ/ 的/ 关系/ 集合/ / 输出/ :/ Q/ ,/ q/ 的/ 一致性/ 查询/ 重写/ 设/ G/ 为/ q/ 的/ 连接/ 图/ ,/ R1/ (/ 狓/ 1/ ,/ 狔/ 1/ ,/ o1/ )/ ,/ R2/ (/ 狓/ 2/ ,/ 狔/ 2/ ,/ o2/ )/ ,/ …/ ,/ Rm/ (/ 狓/ m/ ,/ 狔/ m/ ,/ om/ )/ 为/ G/ 所有/ 树/ 的/ 根/ ,/ 设/ 狓/ =/ ∪/ i/ =/ 1/ ,/ 2/ ,/ …/ ,/ m/ 狓/ i/ ,/ 狕/ =/ 狕/ -/ 狓/ 且/ q/ / =/ / 狑/ ,/ 狅/ ./ / (/ 狑/ ,/ 狕/ ,/ u/ ,/ 狅/ )/ ,/ 设/ 狑/ =/ 狑/ -/ 狓/ ,/ q/ (/ 狓/ ,/ 狕/ ,/ u/ ,/ 狅/ )/ =/ / 狑/ 狅/ ./ / (/ 狓/ ,/ 狑/ ,/ 狕/ ,/ u/ ,/ 狅/ )/ ,/ 这里/ 狅/ 为/ R1/ ,/ R2/ ,/ …/ ,/ Rm/ 的/ or/ _/ id/ 属性/ 变量/ 向量/ ,/ 即/ 狅/ =/ 〈/ o1/ ,/ o2/ ,/ …/ ,/ om/ 〉/ ,/ 而/ 狅/ 为/ 狕/ 所在/ 关系/ or/ _/ id/ 属性/ 变量/ 向量/ 并/ 满足/ 狅/ =/ 狅/ -/ 狅/ Qg/ (/ 狓/ ,/ 狕/ ,/ u/ )/ =/ select/ 狓/ ,/ 狕/ ,/ ufromq/ (/ 狓/ ,/ 狕/ ,/ u/ ,/ 狅/ )/ where/ 狕/ !/ =/ nullandu/ !/ =/ nullunionselect/ 狓/ ,/ 狕/ ,/ min/ (/ u/ )/ fromq/ (/ 狓/ ,/ 狕/ ,/ 狌/ ′/ ,/ 狅/ )/ ∧/ Ri/ _/ or/ (/ oi/ ,/ 狕/ i/ ,/ _/ )/ ∧/ …/ ∧/ Rk/ _/ or/ (/ ok/ ,/ 狕/ k/ ,/ u/ ,/ _/ )/ ∧/ …/ ∧/ Rj/ _/ or/ (/ oj/ ,/ 狕/ j/ ,/ _/ )/ where/ 狕/ !/ =/ nulland/ 狌/ ′/ =/ nullgroupby/ 狓/ ,/ 狕/ Ql/ (/ 狓/ ,/ 狕/ ,/ u/ )/ =/ select/ 狓/ ,/ 狕/ ,/ ufromq/ (/ 狓/ ,/ 狕/ ,/ u/ ,/ 狅/ )/ where/ 狕/ !/ =/ nullandu/ !/ =/ nullPage6unionselect/ 狓/ ,/ 狕/ ,/ max/ (/ u/ )/ fromq/ (/ 狓/ ,/ 狕/ ,/ 狌/ ′/ ,/ 狅/ )/ ∧/ Ri/ _/ or/ (/ oi/ ,/ 狕/ i/ ,/ _/ )/ ∧/ …/ ∧/ Rk/ _/ or/ (/ ok/ ,/ 狕/ k/ ,/ u/ ,/ _/ )/ ∧/ …/ ∧/ Rj/ _/ or/ (/ oj/ ,/ 狕/ j/ ,/ _/ )/ groupby/ 狓/ ,/ 狕/ (/ 狅/ =/ 〈/ oi/ ,/ …/ ,/ oj/ 〉/ ,/ 1/ / i/ / k/ / j/ / m/ )/ IFtheaggregatefunctionismaxTHENQg/ (/ 狕/ ,/ low/ )/ =/ select/ 狕/ ,/ max/ (/ u/ )/ fromQg/ (/ 狓/ ,/ 狕/ ,/ u/ )/ groupby/ 狕/ Ql/ (/ 狕/ ,/ up/ )/ =/ select/ 狕/ ,/ max/ (/ u/ )/ fromQl/ (/ 狓/ ,/ 狕/ ,/ u/ )/ ∧/ ELSEIFtheaggregatefunctionisminTHENQg/ (/ 狕/ ,/ low/ )/ =/ select/ 狕/ ,/ min/ (/ u/ )/ fromQg/ (/ 狓/ ,/ 狕/ ,/ u/ )/ groupby/ 狕/ Ql/ (/ 狕/ ,/ up/ )/ =/ select/ 狕/ ,/ min/ (/ u/ )/ fromQl/ (/ 狓/ ,/ 狕/ ,/ u/ )/ ∧/ ELSEIFtheaggregatefunctionissumTHENQg/ (/ 狕/ ,/ low/ )/ =/ select/ 狕/ ,/ sum/ (/ u/ )/ fromQg/ (/ 狓/ ,/ 狕/ ,/ u/ )/ groupby/ 狕/ Ql/ (/ 狕/ ,/ up/ )/ =/ select/ 狕/ ,/ sum/ (/ u/ )/ fromQl/ (/ 狓/ ,/ 狕/ ,/ u/ )/ ∧/ ENDIFQ/ (/ 狕/ ,/ low/ ,/ up/ )/ =/ Qg/ (/ 狕/ ,/ low/ )/ ∧/ Ql/ (/ 狕/ ,/ up/ )/ RETURNQ4/ ./ 3/ 重写/ 算法/ 的/ 正确性/ 定理/ 2/ ./ 设/ OR/ -/ database/ 全局/ 模式/ Σ/ 上/ 的/ 主外键/ 约束/ 为/ C/ ,/ q/ (/ 狕/ ,/ v/ )/ 是/ 满足/ 式/ (/ 1/ )/ 形式/ 的/ 分组/ 聚集/ 查询/ 并且/ Q/ 为/ 本文/ 查询/ 重写/ 算法/ RewriteCount/ _/ OR/ (/ q/ ,/ C/ )/ 或/ RewriteAgg/ _/ OR/ (/ q/ ,/ C/ )/ 返回/ 的/ 一致性/ 查询/ 重写/ ,/ 并设/ g/ 为/ Σ/ 的/ 集成/ 数据库/ 实例/ ;/ 那么/ 对/ 任意/ 元组/ 狋/ 和/ 一个/ 数值/ 对/ low/ 和/ up/ 都/ 有/ (/ 狋/ ,/ low/ ,/ up/ )/ ∈/ CQAC/ (/ q/ ,/ g/ )/ ,/ 当且/ 仅/ 当/ (/ 狋/ ,/ low/ ,/ up/ )/ ∈/ Q/ (/ g/ )/ ./ 上述/ 定理/ 表明/ :/ 对/ 满足/ Caggforest/ 类/ 的/ 任意/ 分组/ 聚集/ 查询/ q/ ,/ 本文/ 查询/ 重写/ 算法/ RewriteCount/ _/ OR/ 或/ RewriteAgg/ _/ OR/ 所/ 产生/ 的/ 查询/ 重写/ Q/ 就是/ q/ 的/ 一致性/ 查询/ 重写/ ,/ 即/ 本文/ 重写/ 算法/ 是/ 正确/ 的/ ./ 那么/ ,/ 关于/ 定理/ 的/ 证明/ ,/ 根据/ 前面/ 关于/ 分组/ 聚集/ 查询/ 的/ 一致性/ 回答/ 的/ 定义/ 6/ ,/ 对/ 全局/ 模式/ Σ/ 的/ 一个/ 不/ 一致/ 集成/ 数据库/ 实例/ g/ 来说/ ,/ 需要/ 证明/ :/ (/ 1/ )/ 对/ 每/ 一个/ g/ 关于/ C/ 的/ 修复/ g/ ,/ 存在/ 某个/ d/ 使得/ (/ 狋/ ,/ d/ )/ ∈/ q/ (/ g/ )/ 并且/ 满足/ low/ / d/ / up/ ./ (/ 2/ )/ 存在/ 某个/ g/ 关于/ C/ 的/ 修复/ g/ 满足/ (/ 狋/ ,/ low/ )/ ∈/ q/ (/ g/ )/ ./ (/ 3/ )/ 存在/ 某个/ g/ 关于/ C/ 的/ 修复/ g/ 满足/ (/ 狋/ ,/ up/ )/ ∈/ q/ (/ g/ )/ ./ 定理/ 的/ 详细/ 证明/ 过程/ 参见/ 附录/ ./ 5/ 一致性/ 聚集/ 查询/ 代价/ 比较/ 5.1/ 一致性/ 聚集/ 查询/ 代价/ 构成/ 数据/ 集成/ 环境/ 下/ ,/ 比较/ 本文/ 基于/ OR/ -/ database/ 的/ 查询/ 重写/ 与/ Fuxman/ 查询/ 重写/ 两种/ 一致性/ 聚集/ 查询方法/ 整体/ 代价/ 应该/ 包含/ :/ 全局/ 模式/ 的/ 集成/ 数据库/ 生成/ 代价/ ,/ 用户/ 聚集/ 查询/ 的/ 重写/ 代价/ 以及/ 重写/ 后/ 的/ 一致性/ 聚集/ 查询/ 执行/ 代价/ ./ 首先/ 考虑/ 集成/ 数据库/ 的/ 生成/ 代价/ ,/ 传统/ 数据/ 集成系统/ / =/ 〈/ Σ/ ,/ / ,/ / 〉/ 和/ 基于/ OR/ -/ database/ 的/ 数据/ 集成系统/ / =/ 〈/ Σ/ ,/ / ,/ / 〉/ 集成/ 相同/ 数据源/ 模式/ / 的/ 数据/ ,/ 它们/ 的/ 主要/ 区别/ 是/ 全局/ 模式/ Σ/ 是/ 传统/ 关系/ 模式/ 而/ Σ/ 是/ OR/ -/ database/ 关系/ 模式/ ,/ 并且/ 全局/ 模式/ 不同/ 导致/ 模式/ 映射/ 不同/ ./ 为了/ 便于/ 代价/ 的/ 量化/ 比较/ ,/ 不妨/ 假设/ Σ/ =/ {/ R1/ ,/ R2/ ,/ …/ ,/ Rn/ }/ ,/ Σ/ =/ {/ R1/ ,/ R2/ ,/ …/ ,/ Rn/ ,/ R1/ _/ or/ ,/ R2/ _/ or/ ,/ …/ ,/ Rn/ _/ or/ }/ ,/ 两种/ 集成/ 数据库/ 实例/ 分别/ 用/ g/ 和/ g/ 表示/ ,/ 设/ 每/ 一个/ Ri/ (/ 1/ / i/ / n/ )/ 的/ 元组/ 数为/ ki/ 及/ 主键/ 冲突/ 元组/ 所/ 占/ 比例/ 为/ p/ ,/ 单个/ 元组/ 插入/ 到/ Ri/ 的/ 代价/ 为/ c/ 而/ piki/ 个/ 主键/ 冲突/ 元组/ 需要/ 更新/ Ri/ 中主/ 元组/ 代价/ 及/ 插入/ 到/ Ri/ _/ or/ 中/ 的/ 代价/ 均/ 为/ c/ ,/ 那么/ 集成/ 数据库/ g/ 和/ g/ 的/ 生成/ 代价/ Cost/ (/ g/ )/ 和/ Cost/ (/ g/ )/ 可以/ 分别/ 表示/ 为/ Cost/ (/ g/ )/ =/ ∑/ n/ 显然/ ,/ 基于/ OR/ -/ database/ 集成/ 数据库/ 的/ 生成/ 代价/ 仅/ 比/ 传统/ 集成/ 数据库/ 的/ 生成/ 代价/ 多/ p/ %/ ,/ 而/ 数据/ 集成系统/ 中/ 主键/ 冲突/ 元组/ 的/ 比例/ 一般/ 都/ 是/ 很小/ 的/ ,/ 再/ 加上/ 集成/ 数据库/ 实例/ 的/ 生成/ 代价/ 是/ 一次性/ 的/ ,/ 与/ 集成/ 数据库/ 实例/ 上/ 大量/ 用户/ 查询/ 的/ 重写/ 与/ 执行/ 代价/ 相比/ ,/ OR/ -/ database/ 数据/ 集成/ 模式/ 带来/ 的/ 实例/ 生成/ 代价/ 增加/ 部分/ 就/ 显得/ 微不足道/ 了/ ./ 接下来/ 考虑/ 用户/ 聚集/ 查询/ 的/ 重写/ 与/ 执行/ 代价/ ,/ 对于/ 满足/ Caggforest/ 类/ 的/ 任意/ 分组/ 聚集/ 查询/ q/ ,/ Fuxman/ 的/ 重写/ 算法/ 和/ 本文/ 的/ 重写/ 算法/ 能够/ 分别/ 获得/ 一致性/ 查询/ 重写/ Q/ 和/ Q/ ./ 其中/ ,/ Fuxman/ 的/ RewriteCount/ 或/ RewriteAgg/ 都/ 需要/ 调用/ Cforest/ 合取/ 查询/ 类/ 的/ 一致性/ 重写/ 算法/ RewriteForest/ ,/ 其/ 可能/ 根据/ 查询/ q/ 的/ 连接/ 图/ 调用/ 递归/ 算法/ RewriteTree/ ,/ 递归/ 调用/ 的/ 次数/ 取决于/ 构成/ 连接/ 图/ 的/ 关系/ 个数/ ,/ 假设/ 查询/ q/ 涉及/ 关系/ 个数/ 为/ m/ (/ m/ / n/ )/ 并且/ 其/ 连接/ 图/ 构成/ 一棵树/ ,/ 如果/ 查询/ 重写/ 算法/ RewriteTree/ 每个/ 关系/ 节点/ 处理/ 算法/ RewriteLocal/ 的/ 代价/ 为/ 常量/ 时间/ d/ ,/ 则/ 其/ 查询/ 重写/ 代价/ 为/ 线性/ 时间/ md/ ;/ 而/ 本文/ 的/ RewriteCount/ _/ OR/ 或/ RewriteAgg/ _/ OR/ 是/ 直接/ 使用/ m/ 个/ ATOMIC/ 关/ Page7/ 系/ 及其/ OR/ -/ objects/ 关系/ 来/ 产生/ 查询/ 重写/ Q/ ,/ 其/ 重写/ 代价/ 也/ 等于/ 常量/ 时间/ d/ ,/ 与/ RewriteLocal/ 的/ 代价/ 相同/ ,/ 显然/ 在/ 查询/ 重写/ 的/ 代价/ 上/ 本文/ 算法/ 明显/ 低于/ Fuxman/ 的/ 重写/ 算法/ ./ 另外/ ,/ 在/ 用户/ 聚集/ 查询/ 的/ 整个/ 重写/ 与/ 执行/ 代价/ 中/ ,/ 查询/ 重写/ 的/ 关系/ 数/ 线性/ 时间/ 或/ 常量/ 时间/ 的/ 生成/ 代价/ 与其/ 在/ 关系/ 数及/ 关系/ 元组/ 数上/ 函数/ 时间/ 的/ 执行/ 代价/ 相比/ 不/ 在/ 同一个/ 数量级/ 上/ ,/ 即/ 查询/ 重写/ 的/ 生成/ 代价/ 远远/ 小于/ 其/ 执行/ 代价/ ,/ 再/ 加上/ 前面/ 的/ 关于/ 集成/ 数据库/ 实例/ 的/ 生成/ 代价/ 分析/ 与/ 比较/ 可知/ ,/ 要/ 从/ 代价/ 方面/ 对比/ 两种/ 一致性/ 查询/ 方案/ 的/ 优劣/ ,/ 可以/ 通过/ 集中/ 比较/ 两种/ 重写/ 的/ 一致性/ 查询/ 在/ 集成/ 数据库/ 实例/ 上/ 的/ 执行/ 代价/ 来/ 进行/ ./ 5.2/ 一致性/ 聚集/ 查询/ 执行/ 代价/ 比较/ i/ =/ 1i/ =/ 1/ 对/ Caggforest/ 查询/ q/ 的/ 两种/ 一致性/ 查询/ 重写/ Q/ 和/ Q/ ,/ 采用/ 线性/ 工作/ 度量/ [/ 24/ ]/ 作为/ 它们/ 的/ 代价/ 模型/ 并/ 使用/ 查询/ 执行/ 时/ 的/ 关系/ 扫描/ 元组/ 数/ 作为/ 度量/ 标准/ ,/ 则/ 它们/ 的/ 查询/ 代价/ Cost/ (/ Q/ )/ 和/ Cost/ (/ Q/ )/ 根据/ 连接/ 图/ 形成/ 了/ 不同/ 的/ 取值/ 范围/ ./ 注意/ ,/ T1/ ,/ T2/ ,/ …/ ,/ TK/ (/ 0/ / K/ / m/ -/ 1/ )/ 为/ 查询/ Q/ 递归/ 执行/ 中/ 形成/ 的/ 临时/ 关系/ 而/ R/ _/ or1/ ,/ R/ _/ or2/ ,/ …/ ,/ R/ _/ orm/ 为/ 与/ R1/ ,/ R2/ ,/ …/ ,/ Rm/ (/ m/ / n/ )/ 对应/ 的/ OR/ -/ object/ 关系/ ./ c/ ∑/ m/ |/ Ri/ |/ / Cost/ (/ Q/ )/ / c/ ∑/ mc/ ∑/ m/ |/ Ri/ |/ / Cost/ (/ Q/ )/ / c/ ∑/ m/ 当式/ (/ 4/ )/ 和/ (/ 5/ )/ 的/ 下界/ 代表/ q/ 的/ 合取/ 子/ 查询/ 连接/ 图为/ 包含/ m/ 棵/ 树/ (/ 仅/ 有/ 根/ 节点/ )/ 的/ 森林/ 时/ ,/ 并且/ 查询/ 返回/ 的/ 自由/ 向量/ 狕/ 仅/ 出现/ 关系/ R1/ ,/ R2/ ,/ …/ ,/ Rm/ 的/ 主键/ 上/ ,/ R1/ ,/ R2/ ,/ …/ ,/ Rm/ 之间/ 如果/ 存在/ 相同/ 的/ 存在/ 变量/ ,/ 它们/ 的/ 连接/ 也/ 仅/ 为/ 键键/ 连接/ ,/ 根据/ 查询/ 重写/ Q/ 和/ Q/ 的/ 定义/ 可知/ 它们/ 的/ 查询/ 代价/ 相等/ 即为/ R1/ ,/ R2/ ,/ …/ ,/ Rm/ 的/ 元组/ 数/ 之/ 和/ ;/ 式/ (/ 4/ )/ 和/ (/ 5/ )/ 的/ 上界/ 则/ 表示/ 当/ q/ 的/ 合取/ 子/ 查询/ 连接/ 图为/ 包含/ m/ 个/ 节点/ 的/ 树/ (/ 即/ 只有/ 一个/ 连通分支/ )/ 时/ ,/ q/ 的/ 合取/ 子/ 查询/ 涉及/ R1/ ,/ R2/ ,/ …/ ,/ Rm/ 这/ m/ 个/ 关系/ 的/ 连接/ ,/ 一致性/ 检查/ 是/ Q/ 和/ Q/ 的/ 最大/ 不同/ ./ Q/ 对/ Ri/ 的/ 查询/ 一致性/ 检查/ 是/ 在/ Ri/ 本身/ 中/ 完成/ 的/ ,/ 其/ 查询/ 代价/ 为/ c/ |/ Ri/ |/ 2/ ./ 由于/ q/ 一致性/ 结果/ 的/ 需要/ 计算/ 聚集/ 函数/ 的/ 上/ 下界/ ,/ 则/ Q/ 在/ 关系/ Ri/ 上/ 的/ 总/ 查询/ 代价/ 为/ c/ (/ |/ Ri/ |/ 2/ +/ |/ Ri/ |/ )/ ,/ 另外/ ,/ 由于/ Q/ 的/ 一致性/ 查询/ 结果/ 是/ 通过/ 在/ R1/ ,/ R2/ ,/ …/ ,/ Rm/ 上/ 递归/ 执行/ 一致性/ 检查/ 来/ 获得/ 并/ 形成/ 临时/ 关系/ ,/ 所以/ 最终/ 的/ Cost/ (/ Q/ )/ 需要/ 包含/ 临时/ 关系/ 的/ 查询/ 代价/ ;/ 而/ Q/ 则/ 是/ 通过/ Ri/ 的/ OR/ -/ object/ 关系/ R/ _/ ori/ 检查/ 查询/ 一致性/ ,/ 所以/ 其/ 查询/ 代价/ 仅为/ c/ (/ |/ Ri/ |/ +/ |/ R/ _/ ori/ |/ )/ ,/ 同样/ ,/ Q/ 在/ 关系/ Ri/ 上/ 的/ 总/ 查询/ 代价/ 为/ c/ (/ 2/ |/ Ri/ |/ +/ |/ R/ _/ ori/ |/ )/ ./ 对/ 一般/ 的/ 分组/ 聚集/ 查询/ q/ ,/ 其/ 合取/ 子/ 查询/ 的/ 连接/ 图是/ 介于/ 上/ 下界/ 之间/ 并/ 可能/ 包含/ 多个/ 连通分支/ ,/ 如果/ 在/ R1/ …/ Rm/ 中/ 出现/ 某/ 一个/ 关系/ Ri/ 单独/ 形成/ 树/ 的/ 情况/ ,/ 并且/ 狕/ 中/ 变量/ 出现/ 在/ Ri/ 的/ 非/ 主键/ 上/ ,/ 此时/ Q/ 和/ Q/ 在/ Ri/ 上/ 的/ 查询/ 代价/ 是/ c/ (/ |/ Ri/ |/ 2/ +/ |/ Ri/ |/ )/ 和/ 2c/ |/ Ri/ |/ ,/ 但/ 如果/ Ri/ 出现/ 在/ 多/ 节点/ 的/ 树/ 中/ 即/ Ri/ 涉及/ 与/ 其他/ 关系/ 连接/ 时/ ,/ Q/ 和/ Q/ 在/ Ri/ 上/ 的/ 查询/ 代价/ 则/ 是/ c/ (/ |/ Ri/ |/ 2/ +/ |/ Ri/ |/ )/ 和/ c/ (/ 2/ |/ Ri/ |/ +/ |/ R/ _/ ori/ |/ )/ ./ 通常/ ,/ |/ Ri/ |/ / |/ R/ _/ ori/ |/ 甚至/ 对/ |/ Ri/ |/ 来说/ |/ R/ _/ ori/ |/ 可以/ 忽略不计/ ,/ 显然/ 无论/ 哪/ 种/ 情况/ Cost/ (/ Q/ )/ 都/ 达到/ |/ Ri/ |/ 2/ 而/ Cost/ (/ Q/ )/ 仅为/ |/ Ri/ |/ ,/ 并且/ Q/ 的/ 查询/ 代价/ 还要/ 包含/ 其/ 递归/ 执行/ 过程/ 中/ 产生/ 的/ 临时/ 关系/ 查询/ 代价/ ,/ 所以/ Cost/ (/ Q/ )/ / Cost/ (/ Q/ )/ ./ 两者/ 的/ 本质/ 差别/ 是/ 由于/ 查询/ 重写/ 的/ 数据/ 一致性/ 检查/ 是/ 在/ 原/ 关系/ Ri/ 还是/ 在/ |/ R/ _/ ori/ |/ 中/ 进行/ 造成/ 的/ ,/ 这/ 也/ 充分/ 地/ 验证/ 了/ OR/ -/ database/ 集成/ 模式/ 有效/ 隔离/ 集成/ 数据库/ 的/ 一致性/ 部分/ 和/ 非/ 一致性/ 部分/ 带来/ 的/ 查询/ 执行/ 代价/ 上/ 的/ 优势/ ./ 6/ 实验/ 为了/ 比较/ RewriteCount/ _/ OR/ 或/ RewriteAgg/ _/ OR/ 产生/ 的/ 聚集/ 查询/ 重写/ 与/ Fuxman/ 的/ 聚集/ 查询/ 重写/ 的/ 执行/ 代价/ ,/ 考虑/ 如下/ 的/ 模拟实验/ :/ 实验/ 根据/ 是否/ 基于/ OR/ -/ database/ 集成/ 关系/ 模式/ 使用/ TPC/ -/ H/ 标准/ 在/ Oracle10g/ 上/ 创建/ 了/ OR/ -/ database/ 全局/ 模式/ 与/ 普通/ 全局/ 模式/ ,/ 并/ 使用/ 数据/ 产生器/ DBGen/ 分别/ 产生/ 大小/ 为/ 0.25/ GB/ 、/ 0.5/ GB/ 、/ 1GB/ 、/ 2GB/ 、/ 4GB/ 的/ 实验/ 数据/ ,/ 然后/ 选择/ 执行/ 不同/ 的/ 聚集/ 查询/ 及其/ 一致性/ 查询/ 重写/ 并且/ 比较/ 它们/ 的/ 平均/ 执行/ 时间/ ./ 实验/ 的/ 运行/ 环境/ 为/ IBMTHINKPADT400/ ,/ 2.8/ GHzIntelCore2DuoCPU/ ,/ 4GBDDR3RAM/ ,/ Seagate160GB/ (/ 7200RPM/ )/ ,/ 操作系统/ 为/ Windows7/ ./ 首先/ ,/ 考虑/ TPC/ -/ H/ 标准/ 中/ 关系/ customer/ ,/ orders/ 和/ lineitem/ 上/ 包含/ 一个/ 聚集/ 函数/ sum/ 的/ 查询/ Q3/ 以及/ 关系/ orders/ 和/ lineitem/ 上/ 包含/ 两个/ 聚集/ 函数/ sum/ 的/ 查询/ Q12/ ,/ 选择/ 数据库/ 大小/ 从/ 0.25/ GB/ 到/ 4GB/ 变化/ ,/ 不/ 一致/ 数据/ 比例/ 为/ 5/ %/ 的/ 情况/ 下/ ,/ 比较/ 原始/ 的/ 不/ 一致/ 查询/ ,/ Fuxman/ 给出/ 的/ 一致性/ 聚集/ 查询/ Page8/ 重写/ 1/ 及/ 本文/ 算法/ 的/ 一致性/ 聚集/ 查询/ 重写/ 2/ 的/ 查询/ 执行/ 代价/ ,/ 实验/ 结果/ 如图/ 1/ 和/ 图/ 2/ 所示/ ./ 实验/ 结果表明/ :/ 无论是/ 包含/ 一个/ sum/ 的/ Q3/ 还是/ 包含/ 两个/ sum/ 的/ Q12/ ,/ 它们/ 的/ 原始/ 查询/ 及/ 两个/ 一致性/ 查询/ 重写/ 在/ 数据库/ 大小/ 从/ 0.25/ GB/ 到/ 4GB/ 增长/ 时/ 的/ 执行/ 代价/ 变化趋势/ 基本一致/ ./ 与/ 查询/ 重写/ 1/ 的/ 执行/ 代价/ 相比/ ,/ 查询/ 重写/ 2/ 的/ 代价/ 明显/ 地/ 降低/ 仅/ 比/ 并/ 原始/ 不/ 一致/ 查询/ 的/ 代价/ 高出/ 不到/ 10/ %/ 的/ 比例/ ./ 同时/ ,/ 对比/ 图/ 1/ 和/ 图/ 2/ 可以/ 发现/ ,/ 包含/ 两个/ sum/ 的/ Q12/ 的/ 查询/ 重写/ 2/ 与/ 查询/ 重写/ 1/ 代价/ 之差/ 明显/ 地/ 大于/ 仅/ 包含/ 一个/ sum/ 的/ Q3/ 的/ 查询/ 重写/ 2/ 与/ 查询/ 重写/ 1/ 的/ 代价/ 之差/ ./ 然后/ ,/ 实验/ 选择/ 最大/ 关系/ lineitem/ 上/ 包含/ 8/ 个/ 聚集/ 函数/ 的/ 查询/ Q1/ ,/ 其他/ 条件/ 与/ 前面/ 的/ 实验/ 保持一致/ 的/ 情况/ 下/ 再次/ 对比/ 原始/ 查询/ ,/ 查询/ 重写/ 1/ 及/ 查询/ 重写/ 2/ 的/ 执行/ 代价/ ,/ 实验/ 结果/ 如图/ 3/ 所示/ ./ 此时/ ,/ Q1/ 查询/ 重写/ 2/ 与/ 查询/ 重写/ 1/ 的/ 代价/ 之差/ 随着/ 数据库/ 大小/ 的/ 增长/ 而/ 急剧/ 增加/ ,/ 并且/ 增加/ 幅度/ 远远/ 大于/ 图/ 1/ 和/ 图/ 2/ ,/ 但是/ 查询/ 重写/ 2/ 的/ 代价/ 与/ 原始/ 查询/ 代价/ 的/ 变换/ 趋势/ 却/ 基本/ 保持一致/ ./ 最后/ ,/ 实验/ 选择/ 关系/ lineitem/ 上/ 包含/ 一个/ sum/ 的/ 聚集/ 查询/ Q6/ ,/ 数据库/ 大小/ 固定/ 为/ 1GB/ ,/ 不/ 一致/ 数据/ 比例/ 从/ 5/ %/ ~/ 25/ %/ 变化/ 时/ ,/ 对比/ 原始/ 查询/ ,/ 查询/ 重写/ 1/ 及/ 查询/ 重写/ 2/ 的/ 执行/ 代价/ 变化趋势/ ,/ 实验/ 结果/ 如图/ 4/ 所示/ ./ 显然/ ,/ 随着/ 不/ 一致/ 数据/ 比例/ 的/ 增长/ ,/ 原始/ 查询/ 与/ 查询/ 重写/ 2/ 的/ 执行/ 代价/ 基本/ 保持/ 不变/ ,/ 但/ 查询/ 重写/ 1/ 的/ 执行/ 代价/ 出现/ 了/ 明显/ 地/ 增长/ ./ 7/ 结论/ 本文/ 主要/ 考虑/ 数据/ 集成/ 环境/ 下/ 如何/ 有效/ 提高/ 不/ 一致/ 数据库/ 上/ 一致性/ 聚集/ 查询/ 的/ 整体/ 性能/ 问题/ ./ 首先/ ,/ 通过/ OR/ -/ database/ 集成/ 模式/ 有效/ 地/ 隔离/ 集成/ 数据库/ 的/ 一致性/ 部分/ 和/ 非/ 一致性/ 部分/ ;/ 然后/ 在/ 此基础/ 上/ 对/ 合取/ 查询/ 类/ Cforest/ 上/ 的/ 分组/ 聚集/ 查询/ 提出/ 了/ 基于/ OR/ -/ database/ 的/ 一致性/ 查询/ 重写/ 算法/ ;/ 最后/ 基于/ 线性/ 工作/ 度量/ 的/ 查询/ 代价/ 分析/ 与/ 比较/ 以及/ Oracle10g/ 不/ 一致/ 数据库/ 上/ 的/ TPC/ -/ H/ 模拟实验/ 都/ 表明/ :/ 与/ Fuxman/ 的/ 一致性/ 聚集/ 查询方法/ 相比/ ,/ 本文/ 提出/ 的/ 一致性/ 聚集/ 查询方法/ 在/ OR/ -/ database/ 集成/ 数据库/ 上/ 具有/ 非常明显/ 的/ 性能/ 优势/ ./ Page9/ 

