Page1/ 快速/ 自/ 适应/ 调频/ 机制/ 及其/ 在/ NetFPGA/ 上/ 的/ 实现/ 汪漪/ 1/ )/ 孟玮/ 1/ )/ 胡成臣/ 2/ )/ 贺可强/ 1/ )/ 刘斌/ 1/ )/ 1/ )/ (/ 清华大学/ 计算机科学/ 与/ 技术/ 系/ 北京/ 100084/ )/ 2/ )/ (/ 西安交通大学/ 计算机科学/ 与/ 技术/ 系/ 西安/ 710049/ )/ 摘要/ 降低/ 网络设备/ 能耗/ 已经/ 成为/ 当前/ 研究/ 的/ 热点/ ./ 文中/ ,/ 作者/ 设计/ 了/ 一种/ 能够/ 实时/ 适应/ 流量/ 变化/ 的/ 动态/ 自/ 适应/ 频率/ 调整/ 方法/ FASS/ ,/ 它/ 能/ 根据/ 处理/ 模块/ 的/ 负载/ ,/ 实时/ 地/ 调整/ 模块/ 的/ 工作频率/ ,/ 从而/ 有效/ 降低/ 模块/ 的/ 能耗/ ./ 同时/ ,/ 作者/ 通过/ 修改/ NetFPGA/ 的/ 参考/ 路由器/ 设计/ ,/ 将/ FASS/ 添加/ 到/ 数据包/ 处理/ 模块/ 中来/ 验证/ FASS/ 的/ 性能/ ./ 马尔可夫/ 模型/ 分析/ 结果/ 和/ 实际/ 实验/ 的/ 测试/ 结果表明/ ,/ 在/ 仅/ 增加/ 可容忍/ 的/ 延迟/ 的/ 情况/ 下/ ,/ FASS/ 在/ 多种不同/ 的/ 负载/ 情况/ 下/ ,/ 都/ 能/ 有效/ 地/ 降低/ 模块/ 功耗/ ./ 另外/ ,/ 作者/ 的/ 工作/ 说明/ FASS/ 可以/ 应用/ 于/ 实际/ 的/ 物理/ 设备/ 中以/ 实现/ 节能/ ./ 关键词/ 自/ 适应/ 频率/ 调整/ ;/ 双/ 门限/ 多/ 阈值/ ;/ NetFPGA/ ;/ 节能/ ;/ 路由器/ ;/ 绿色/ 计算/ ;/ 绿色/ 网络/ 1/ 引言/ 根据/ Uclue/ 组织/ 的/ 研究/ 结果/ ①/ ,/ 2007/ 年/ InternetPage2/ 就/ 造成/ 大量/ 的/ 电能/ 被/ 空闲/ 网络/ 基础设施/ 所/ 消耗/ 与/ 浪费/ [/ 1/ ]/ ./ 为/ 降低/ 网络设备/ 的/ 能耗/ ,/ 学术界/ 和/ 工业界/ 提出/ 许多/ 能量/ 管理/ 的/ 方法/ ,/ 大致/ 可/ 分为/ 两类/ :/ (/ 1/ )/ 协议/ 方式/ ,/ 通过/ 创建/ 、/ 修改/ 协议/ 来/ 实现/ 全网/ 协同/ (/ 例如/ 流量/ 聚合/ )/ 来/ 降低功耗/ ;/ (/ 2/ )/ 设备/ 方式/ ,/ 通过/ 重新/ 设计/ 设备/ 体系结构/ 和/ 优化/ 处理单元/ 的/ 运行/ 模式/ 来/ 实现/ 节能/ ./ 设备/ 休眠/ 法/ 和/ 频率/ 调整法/ 是/ 降低/ 处理/ 模块/ 功耗/ 的/ 两种/ 基本/ 方法/ ./ 设备/ 休眠/ 法/ 通过/ 将/ 网络设备/ 在/ 运行/ 状态/ 和/ 休眠状态/ 之间/ 不断/ 地/ 切换/ 来/ 实现/ 节能/ ,/ 其中/ 什么/ 时候/ 切换/ ,/ 切换/ 多长时间/ 是/ 该/ 方法/ 的/ 核心/ 问题/ [/ 2/ ]/ ./ 设备/ 休眠/ 法在/ 流量/ 变化/ 不/ 大/ ,/ 或/ 可/ 提前/ 预知/ 的/ 情况/ 下/ ,/ 有/ 较/ 好/ 的/ 效果/ ,/ 但/ 对于/ 以/ 突发/ 为/ 基本/ 特点/ 的/ 网络/ 流/ ,/ 则/ 会/ 造成/ 网络/ 性能/ 的/ 急剧下降/ [/ 3/ ]/ ./ 频率/ 调整法/ 根据/ 实时/ 的/ 负载/ 情况/ ,/ 通过/ 动态/ 地/ 调整/ 物理/ 器件/ 的/ 时钟/ 频率/ 来/ 实现/ 节能/ ,/ 但/ 支持/ 调频/ 的/ 物理/ 器件/ 较/ 少/ ,/ 并且/ 传统/ 的/ 频率/ 调整/ 方法/ 只能/ 适应/ 较慢/ 的/ 流量/ 变化/ ,/ 整体/ 节能/ 效果/ 较差/ ./ 通常/ 情况/ 下/ ,/ 无论/ 外部/ 到达/ 的/ 流量/ 如何/ 变化/ ,/ 实际/ 的/ 路由器/ 、/ 交换机/ 等/ 网络设备/ 都/ 工作/ 在/ 最高/ 频率/ ,/ 进行/ 数据包/ 的/ 存储/ 与/ 转发/ 等/ 操作/ ./ 在/ 过去/ 几年/ 中/ ,/ 动态/ 链路/ 关闭/ 机制/ [/ 2/ ]/ 和/ 自/ 适应/ 链路/ 速率/ 调整机制/ [/ 4/ ]/ 被/ 提出/ 并/ 应用/ 于/ 以太网/ 设备/ 的/ 物理/ 链路/ 芯片/ 和/ 接口/ 中/ ,/ 但/ 设备/ 的/ 路由/ 查找/ 、/ 转发/ 、/ 背板/ 交换/ 网络/ 等/ 其余/ 模块/ 仍旧/ 满负荷/ 工作/ ,/ 使得/ 基于/ 这种/ 机制/ 不能/ 达到/ 理想/ 的/ 节能/ 效果/ ./ 本文/ 中/ ,/ 我们/ 设计/ 了/ 一种/ 能够/ 实时/ 适应/ 流量/ 变化/ 的/ 动态/ 自/ 适应/ 频率/ 调整/ 方法/ (/ FastAdaptiveSpeedScaling/ ,/ FASS/ )/ ,/ 并/ 将/ FASS/ 应用/ 于/ NetFPGA/ 平台/ ①/ 的/ 参考/ 路由器/ 数据/ 平面/ 的/ 各个/ 数据包/ 处理/ 模块/ 中来/ 进行/ 验证/ ./ NetFPGA/ 板卡/ 具有/ 4/ 个/ 千兆/ 以太网/ 接口/ ,/ 核心/ 处理部件/ 采用/ 可编程/ 的/ XilinxVirtexIIFPGA/ ,/ 通过/ PCI/ 接口/ 与/ 台式/ 电脑主板/ 相连/ ./ NetFPGA/ 是/ 一个/ 基于/ Linux/ 的/ 开放性/ 平台/ ,/ 它/ 为/ 研究/ 人员/ 提供/ 了/ 原型/ 快速/ 开发/ 与/ 实现/ 的/ 硬件平台/ ,/ 开/ 源代码/ 和/ 脚本/ 帮助/ 研究/ 人员/ 更好/ 地/ 使用/ 、/ 修改/ 参考/ 设计/ ,/ 甚至/ 创建/ 全新/ 的/ 系统/ 和/ 应用/ ./ FASS/ 的/ 设计/ 目标/ 是/ 能够/ 智能/ 地/ 根据/ 工作/ 模块/ 的/ 负载/ ,/ 快速/ 、/ 动态/ 地/ 调整/ 工作频率/ ,/ 在/ 不/ 显著/ 增加/ 等待/ 、/ 处理/ 时延/ 的/ 约束/ 下/ ,/ 最大/ 程度/ 地/ 降低/ 模块/ 的/ 能耗/ ./ 要/ 实现/ 以上/ 目标/ ,/ FASS/ 需要/ 攻克/ 以下/ 两个/ 难点/ :/ (/ 1/ )/ 频率/ 切换/ 策略/ ./ 频率/ 切换/ 策略/ 应该/ 保证/ 在/ 时延/ 、/ 资源/ 开销/ 的/ 约束/ 下/ ,/ 及时/ 响应/ 输入/ 流量/ 的/ 变化/ ,/ 最优化/ 模块/ 的/ 操作/ 频率/ ,/ 从而/ 降低/ 模块/ 的/ 能耗/ ;/ (/ 2/ )/ 快速/ 切换/ 机制/ 与/ 物理/ 实现/ ./ 不仅/ 能/ 适用/ 于/ 实际/ 物理/ 设备/ ,/ 而且/ 具有/ 占有/ 较/ 小/ 系统资源/ 和/ 支持/ 快速/ 切换/ 速度/ 机制/ 的/ 特性/ ,/ 为/ FASS/ 适用/ 于/ 流量/ 快速/ 变化/ 的/ 网络设备/ 提供/ 基础/ 支持/ ./ 本文/ 中/ ,/ 我们/ 主要/ 有/ 以下/ 4/ 点/ 贡献/ :/ (/ 1/ )/ 提出/ 一种/ 渐进/ 的/ 双/ 门限/ 多/ 阈值/ 的/ 频率/ 实时/ 自/ 适应/ 方法/ (/ FASS/ )/ ,/ 它/ 能/ 根据/ 等待/ 处理/ 的/ 队列/ 长度/ ,/ 平稳/ 地/ 自动/ 在/ 多个/ 模块/ 工作频率/ 之间/ 切换/ ,/ 有效/ 降低/ 网络设备/ 中/ 物理/ 模块/ 的/ 能耗/ ./ (/ 2/ )/ 采用/ 异步/ 时钟/ 实现/ 数据包/ 处理/ 模块/ 之间/ 的/ 协同工作/ ,/ 并/ 设计/ 和/ 实现/ 了/ 仅/ 需要/ 一个/ 时钟/ 周期/ 延迟/ 的/ 快速/ 频率/ 切换/ 机制/ ./ (/ 3/ )/ 通过/ 修改/ NetFPGA/ 平台/ 上/ 开源/ IPv4/ 参考/ 路由器/ ,/ 添加/ FASS/ 到/ 数据包/ 处理/ 的/ 模块/ 中/ ,/ 验证/ FASS/ 的/ 节能/ 效果/ ./ (/ 4/ )/ 使用/ “/ SmartBits600/ 网络/ 性能/ 分析仪/ ”/ ②/ 来/ 实际/ 测试/ FASS/ 引起/ 的/ 数据包/ 处理/ 时延/ 的/ 增加量/ ,/ 实际/ 实验/ 结果表明/ FASS/ 能够/ 在/ 只/ 增加/ 较/ 小时/ 延/ 的/ 情况/ 下/ ,/ 有效/ 降低/ 能耗/ ./ 本文/ 第/ 2/ 节对/ 动态/ 自/ 适应/ 频率/ 调整机制/ 进行/ 阐述/ ,/ 并/ 在/ 第/ 3/ 节中/ 应用/ 马尔可夫/ 链/ 对/ FASS/ 进行/ 理论/ 分析/ ;/ 第/ 4/ 节/ 描述/ 如何/ 在/ NetFPGA/ 参考/ 路由器/ 中/ 实现/ 动态/ 自/ 适应/ 频率/ 调整机制/ ,/ 其/ 实际/ 测试/ 结果/ 在/ 第/ 5/ 节中/ 给出/ ;/ 动态/ 频率/ 调节/ 的/ 相关/ 研究/ 工作/ 在/ 第/ 6/ 节中/ 论述/ ,/ 并/ 在/ 第/ 7/ 节中/ 对/ 本文/ 工作/ 进行/ 总结/ ./ 2/ 动态/ 自/ 适应/ 频率/ 调整机制/ 2.1/ FASS/ 的/ 性能指标/ 网络设备/ 的/ 动态/ 自/ 适应/ 频率/ 调整机制/ 在/ 有效/ 降低/ 工作/ 模块/ 能耗/ 的/ 同时/ ,/ 会/ 造成/ 单个/ 工作/ 模块/ 和/ 系统/ 整体/ 时延/ 的/ 增加/ ./ 所以/ 我们/ 基于/ 如下/ 两个/ 关键/ 性能指标/ 对/ FASS/ 进行/ 分析/ 和/ 验证/ :/ (/ 1/ )/ 节能/ 效果/ ./ 由于/ 设备/ 的/ 能耗/ 与/ 速率/ 基本/ 成/ 线性关系/ [/ 5/ ]/ ,/ 我们/ 使用/ 相对/ 速率/ (/ 实际/ 速率/ 与/ 最高/ 速率/ 的/ 比值/ )/ 来/ 间接/ 衡量/ 节能/ 的/ 效果/ ./ 特别/ 地/ ,/ 我们/ 采用/ 速率/ 降低/ 的/ 平均值/ 而/ 不是/ 瞬时值/ 来/ 更/ 宏观/ 、/ 准确/ 地/ 描述/ 节能/ 效果/ ./ (/ 2/ )/ 数据包/ 时延/ ./ 一般而言/ ,/ 系统/ 、/ 模块/ 工作/ 在/ 低频/ 模式/ 相比/ 工作/ 在/ 高频/ 模式/ 会/ 带来/ 更大/ 的/ 时延/ ./ 更进一步/ ,/ 由于/ 频率/ 切换/ 造成/ 的/ 数据包/ 时延/ 的/ 抖动/ 可能/ 会/ 对/ 基于/ 数据包/ 时延/ 进行/ 路由/ 选择/ 的/ 路由/ 协议/ 带来/ 负面影响/ ./ 因此/ ,/ 自/ 适应/ 频率/ 调节/ 方法/ 必须/ 使得/ 其/ 引起/ 的/ 时延/ 增加/ 限制/ 在/ 一定/ 范围/ ./ 总体而言/ ,/ 数据包/ 时延/ 增量/ 主要/ 由/ 队列/ 排队/ 时延/ 引起/ ./ 在/ 本文/ 中/ ,/ 我/ ①/ ②/ Page3/ 们/ 采用/ 队列/ 排队/ 时延/ 作为/ 时延/ 的/ 度量/ ./ 一个/ 自/ 适应/ 频率/ 调节/ 机制/ 需要/ 在/ 节能/ 效果/ 和/ 数据包/ 时延/ 之间/ 寻求/ 平衡/ ,/ 即/ 在/ 特定/ 的/ 时延/ 约束/ 和/ 输入/ 流量/ 动态变化/ 的/ 情况/ 下/ ,/ 最大/ 程度/ 地/ 节约/ 模块/ 能耗/ ./ 在/ 接下来/ 的/ 章节/ 中/ ,/ 我们/ 用/ 上面/ 定义/ 的/ 两个/ 指标/ 对/ 提出/ 的/ FASS/ 进行/ 理论/ 分析/ 和/ 实验/ 测试/ ./ 结果表明/ FASS/ 在/ 增加/ 可容忍/ 的/ 延迟/ 的/ 情况/ 下/ ,/ 能/ 实现/ 较佳/ 的/ 节能/ 效果/ ./ 2.2/ 双/ 门限/ 多/ 阈值/ 机制/ 现今/ 的/ 网络设备/ 大多/ 使用/ 缓存/ 应对/ 短时间/ 的/ 突发/ 流量/ ,/ 并/ 在/ 各个/ 功能/ 部件/ 之间/ 对/ 任务/ 队列/ 进行/ 缓冲/ ./ 在/ 图/ 1/ 中/ ,/ 以太网/ 帧/ 处理/ 模块/ 和/ 数据包/ 处理/ 模块/ 之间/ 就/ 通过/ 缓存/ 队列/ 进行/ 连接/ ./ 直观/ 上/ ,/ 缓存/ 的/ 占用率/ (/ 队列/ 长度/ )/ 可以/ 反映/ 设备/ 的/ 实时/ 负载/ ./ 在/ 我们/ 的/ FASS/ 机制/ 中/ ,/ 缓存/ 的/ 实际/ 占用/ 情况/ 是/ 进行/ 频率/ 切换/ 的/ 主要/ 依据/ ./ 我们/ 假设/ 硬件/ 支持/ 工作/ 在/ 多个/ 频率/ 下/ ,/ 并/ 设置/ 了/ 一系列/ 阈值/ 来/ 近似/ 衡量/ 设备/ 的/ 工作/ 负载/ ./ 图/ 1/ 路由器/ 线卡/ 中/ 各个/ 模块/ 之间/ 通存/ 队列/ 相连/ 实时/ 地/ 根据/ 输入/ 队列/ 长度/ 来/ 进行/ 频率/ 的/ 动态/ 调整/ 是/ 一种/ 有效/ 的/ 节约/ 能耗/ 的/ 方法/ ,/ 它/ 使得/ 模块/ 在/ 线路/ 负载/ 较轻/ 的/ 时候/ ,/ 工作/ 在/ 较/ 低/ 频率/ ,/ 实现/ 按/ 需/ 工作/ ,/ 从而/ 达到/ 较/ 低功耗/ 的/ 目的/ ./ 当仅/ 使用/ 一个/ 队列/ 长度/ 阈值/ 为/ 调频/ 依据/ 时/ ,/ 如果/ 队列/ 长度/ 恰好/ 在/ 阈值/ 附近/ 抖动/ ,/ 就/ 会/ 带来/ 频率/ 切换/ 的/ 抖动/ ,/ 造成/ 额外/ 的/ 切换/ 时延/ 和/ 功耗/ ./ 双/ 阈值/ 机制/ ,/ 即/ 一个/ 高/ 阈值/ tH/ 和/ 一个/ 低/ 阈值/ tL/ ,/ 正是/ 为/ 避免/ 单/ 阈值/ 带来/ 的/ 切换/ 抖动/ 的/ 发生/ 而/ 提出/ ./ 频率/ 切换/ 的/ 状态图/ 如图/ 2/ (/ a/ )/ 所示/ ,/ 当/ 模块/ 工作/ 在/ 低频/ 模式/ ,/ 队列/ 长度/ 由小到大/ 增长/ 超过/ tH/ 时/ ,/ 工作频率/ 被/ 切换/ 到/ 高频/ 模式/ ;/ 当/ 模块/ 工作/ 在/ 高频/ 模式/ 时/ ,/ 队列/ 长度/ 由大到/ 小/ 减小/ 到/ 低于/ tL/ 时/ ,/ 频率/ 被/ 切换/ 到/ 低频/ 模式/ ./ 双/ 阈值/ 机制/ 的/ 节能/ 效果/ 与/ 阈值/ 的/ 取值/ 密切相关/ ,/ 当/ 阈值/ 与/ 负载/ 情况/ 较/ 符合/ 时/ ,/ 可以/ 有效/ 降低/ 能耗/ ,/ 而/ 当/ 两者/ 不/ 相符合/ 时/ ,/ 特别/ 是/ 在/ tL/ </ 负载/ </ tH/ 时/ ,/ (/ 1/ )/ 会/ 带来/ 时延/ 的/ 急剧/ 增加/ (/ 模块/ 工作/ 在/ 低频/ 模式/ ,/ 且/ 队列/ 长度/ 始终/ 不/ 超过/ tH/ )/ ./ 在/ 这种/ 情况/ 下/ ,/ 模块/ 一直/ 工作/ 在/ 低频/ 模式/ ,/ 而/ 队列/ 的/ 长度/ 又/ 相对/ 较长/ ,/ 造成/ 时延/ 的/ 急剧/ 增加/ ./ (/ 2/ )/ 不能/ 有效/ 地/ 降低功耗/ ./ 当/ 模块/ 工作/ 在/ 高频/ 模式/ ,/ 且/ 队列/ 长度/ 始终/ 不/ 低于/ 阈值/ tL/ ,/ 在/ 这种/ 情况/ 下/ ,/ 模块/ 一直/ 工作/ 在/ 高频/ 模式/ ,/ 没有/ 达到/ 降低功耗/ 的/ 目的/ ./ (/ 3/ )/ 为/ 最大/ 程度/ 地/ 降低功耗/ ,/ 双/ 阈值/ 机制/ 一般/ 设置/ 低频/ 模式/ 时/ 的/ 处理/ 频率/ 较/ 低/ ,/ 往往/ 比/ 高频/ 模式/ 时/ 的/ 处理/ 频率/ 小/ 一个/ 数量级/ ,/ 例如/ ALR/ [/ 4/ ]/ 中/ 的/ 100Mbps/ 和/ 1Gbps/ ./ 这/ 就/ 带来/ 另外/ 一个/ 问题/ :/ 数据包/ 时延/ 的/ 抖动/ 过于/ 大/ ,/ 使得/ 一些/ 以/ 数据包/ 传送/ 时延/ 为/ 依据/ 的/ 拥塞/ 控制/ 机制/ 失效/ (/ 负载/ 轻时/ ,/ 时延/ 大/ ;/ 负载/ 重时/ ,/ 时延/ 反而/ 轻/ )/ ./ 为/ 解决/ 双/ 阈值/ 机制/ 中/ 的/ 几个/ 基本/ 问题/ ,/ 我们/ 提出/ 了/ 双/ 门限/ 多/ 阈值/ 机制/ ,/ 其/ 频率/ 切换/ 的/ 状态/ 转移/ 图如图/ 2/ (/ b/ )/ 所示/ ./ 其中/ ,/ 规定/ tiH/ </ t/ (/ i/ +/ 1/ )/ L/ </ t/ (/ i/ +/ 1/ )/ H/ ./ 两个/ 相邻/ 的/ 频率/ 之间/ 的/ 切换/ ,/ 仍然/ 采用/ 双/ 阈值/ 机制/ 来/ 确定/ ,/ 模块/ 工作频率/ 只能/ 在/ 相邻/ 的/ 频率/ 之间/ 切换/ ,/ 不能/ 越级/ 切换/ ./ 相邻/ 的/ 频率/ 之间/ ,/ 有/ fi/ =/ 1/ 双/ 阈值/ 机制/ ,/ tiH/ -/ tiL/ 小于/ tH/ -/ tL/ ,/ 从而/ 使得/ 负载/ 落/ 于/ 区间/ tiH/ -/ tiL/ 的/ 概率/ 降低/ ,/ 且/ 只要/ 一个/ 较/ 小幅度/ 的/ 流量/ 突发/ ,/ 就/ 能/ 打破/ 原来/ 的/ 僵局/ ,/ 实现/ 频率/ 的/ 切换/ ,/ 从而/ 实现/ 较/ 小/ 的/ 时延/ 和/ 减少/ 更/ 多/ 的/ 能耗/ 的/ 目标/ ./ 另一方面/ ,/ 由于/ 存在/ 多个/ 频率/ ,/ 减小/ 了/ 相邻/ 频率/ 之间/ 的/ 差值/ ,/ 使得/ 模块/ 工作频率/ 切换/ 带来/ 的/ 数据包/ 的/ 时延/ 抖动/ 较/ 小/ ,/ 更/ 符合/ 网络/ 实际/ 的/ 负载/ 情况/ ./ 3/ 理论/ 分析/ 在/ 这/ 一节/ 中/ ,/ 我们/ 给出/ 双/ 门限/ 多/ 阈值/ 策略/ 的/ 数学/ 定义/ ,/ 并用/ 马尔卡/ 夫链/ 进行/ 性能/ 分析/ ./ 之后/ ,/ 我们/ 采用/ 上/ 一节/ 中/ 定义/ 的/ 能耗/ 与/ 时延/ 的/ 标准/ 对/ 速率/ 和/ 阈值/ 的/ 设置/ 进行/ 研究/ ./ 3.1/ 双/ 门限/ 多/ 阈值/ 策略/ 首先/ ,/ 假设/ 数据包/ 的/ 到达/ 和/ 服务/ 时间/ 服从/ 泊松/ 分布/ ./ 双/ 门限/ 多/ 阈值/ 策略/ 可以/ 使用/ 单一/ 队列/ 、/ 单一/ 服/ Page4/ 务/ 排队/ 论/ 模型/ 进行/ 建模/ ,/ 其/ 服务/ 速率/ 取决于/ 服务/ 所处/ 的/ 工作/ 状态/ ,/ 双/ 门限/ 被/ 用于/ 避免/ 潜在/ 的/ 频率抖动/ 及其/ 造成/ 的/ 系统/ 不/ 稳定/ ./ 假设/ λ/ 为/ 数据包/ 的/ 到达/ 速率/ ,/ 且/ 系统/ 能够/ 工作/ 在/ M/ +/ 1/ 种/ 不同/ 的/ 速率/ ,/ 从/ μ/ 1/ 到/ μ/ M/ +/ 1/ (/ μ/ j/ </ μ/ j/ +/ 1/ ,/ 1/ / j/ / M/ +/ 1/ )/ ./ 相应/ 地/ ,/ 利用率/ 可以/ 表示/ 为/ ρ/ j/ =/ λ/ // μ/ j/ ./ 在/ 双/ 门限/ 多/ 阈值/ 策略/ 中/ ,/ 我们/ 定义/ 了/ 2M/ 个/ 阈值/ 用以/ 进行/ 速率/ 切换/ ./ 其中/ ,/ M/ 个/ 低/ 阈值/ 表示/ 为/ TjL/ (/ 1/ / j/ / M/ )/ ,/ M/ 个/ 高/ 阈值/ 表示/ 为/ TjH/ (/ 1/ / j/ / M/ )/ ,/ 并且/ 有/ TjL/ </ TjH/ </ T/ (/ j/ +/ 1/ )/ L/ ,/ 1/ / j/ / M/ -/ 1/ ./ 当/ 缓存/ 占用/ 降低/ 至/ 低/ 阈值/ TjL/ 以下/ 时/ ,/ 会/ 引起/ 服务/ 速率/ 由/ μ/ j/ +/ 1/ 降至/ μ/ j/ ;/ 而/ 当/ 缓存/ 占用/ 升至/ 高/ 阈值/ TjH/ 以上/ 时/ ,/ 服务/ 速率/ 将/ 由/ μ/ j/ 提高/ 至/ μ/ j/ +/ 1/ ./ 接下来/ ,/ 我们/ 将/ 双/ 门限/ 多/ 阈值/ 策略/ 建模/ 成/ 马尔卡/ 夫链/ 以/ 对/ 其/ 进行/ 分析/ ,/ 并/ 给出/ 系统/ (/ 缓存/ )/ 中有/ n/ 个/ 客户/ (/ 数据包/ )/ 的/ 稳态/ 概率/ Pn/ ./ 需要/ 特别/ 注意/ 的/ 是/ ,/ 我们/ 使用/ 符号/ π/ n/ 来/ 表示/ 马尔卡/ 夫/ 模型/ 中/ 状态/ n/ 的/ 稳态/ 概率/ ,/ 这/ 不同于/ Pn/ ./ 3.2/ 稳态/ 概率/ 图/ 3/ 中/ 显示/ 了/ 双/ 门限/ 多/ 阈值/ 调频/ 策略/ 的/ 马尔卡/ 夫链/ ,/ 其中/ 位于/ 顶部/ 的/ 一行/ 表示/ 与其/ 下方/ 状态/ 相对/ 应/ 的/ 缓存/ 占用率/ (/ 队列/ 长度/ )/ ./ 所/ 使用/ 的/ 参数/ 和/ 变量/ 定义/ 如下/ :/ λ/ 为/ 数据包/ 到达/ 速率/ ;/ M/ 为/ 高/ // 低/ 阈值/ 数量/ ;/ μ/ i/ 为/ 第/ i/ 档/ 服务/ 速率/ (/ 1/ / i/ / M/ +/ 1/ )/ ;/ ρ/ i/ =/ λ/ // μ/ i/ 为/ μ/ i/ 对应/ 的/ 利用率/ ;/ k2i/ -/ 1/ 表示/ 缓存/ 占用/ 的/ 低/ 阈值/ TiL/ (/ 1/ / i/ / M/ )/ ;/ k2i/ 表示/ 缓存/ 占用/ 的/ 高/ 阈值/ TiH/ (/ 1/ / i/ / M/ )/ ;/ π/ n/ 为/ 状态/ n/ 的/ 稳态/ 概率/ ./ 对/ 处于/ k2i/ +/ 1/ 和/ k2i/ +/ 2/ (/ 1/ / i/ </ M/ )/ 之间/ 的/ 缓存/ 占用/ ,/ 例如/ k2i/ +/ 1/ +/ j/ ,/ 对应/ 于/ 两个/ 状态/ ,/ 则/ 用/ π/ k2i/ +/ 1/ +/ 2j/ 表示/ 位于/ 上/ 链/ 状态/ 的/ 稳态/ 概率/ ,/ 用/ π/ k2i/ +/ 1/ +/ 2j/ +/ 1/ 表示/ 位于/ 下链/ 状态/ 的/ 稳态/ 概率/ ;/ Pn/ 对应/ 于/ 队列/ 长度/ 为/ n/ 的/ 稳态/ 概率/ ./ 对于/ 只/ 对应/ 于/ 一个/ 状态/ 的/ 情况/ 下/ ,/ Pn/ =/ π/ n/ ;/ 对于/ 对应/ 两个/ 状态/ 的/ 情况/ 下/ ,/ Pn/ 则/ 为/ 两个/ 对应状态/ 的/ 稳态/ 概率/ 的/ 和/ ,/ 例如/ Pk1/ =/ π/ k1/ +/ π/ k1/ +/ 1/ ;/ Ti/ 是/ 对应/ 于/ 服务/ 速率/ μ/ i/ 的/ 时间/ 占用率/ ./ 图/ 3/ 多双/ 阈值/ 的/ 马尔可夫/ 链/ 特别/ 地/ ,/ k0/ 表示/ 缓存/ 占用/ 为/ 0/ 的/ 情况/ ,/ 而用/ Pk2i/ 代表/ 缓存/ 占用/ 为/ 高/ 阈值/ THi/ (/ 1/ / i/ / M/ )/ 的/ 情况/ 下/ 的/ 稳态/ 概率/ ./ 在/ 给出/ 上述/ 定义/ 之后/ ,/ 其/ 最终/ 的/ 稳态/ 概率/ 、/ 时间/ 占用率/ 、/ 相对/ 速率/ 的/ 数学/ 表达式/ 如下/ 所示/ ,/ 具体/ 推导/ 过程/ 详见/ 文献/ [/ 6/ ]/ ./ 队列/ 长度/ 为/ n/ 的/ 稳态/ 概率/ 为/ ρ/ n/ -/ k2ii/ +/ 1Pk2i/ ,/ k2i/ / n/ </ k2i/ +/ 1/ ,/ 0/ / i/ </ M/ 烄/ π/ k2i/ +/ 1/ +/ 2/ (/ n/ -/ k2i/ +/ 1/ )/ +/ π/ k2i/ +/ 1/ +/ 2/ (/ n/ -/ k2i/ +/ 1/ )/ +/ 1/ ,/ Pn/ =/ 烅/ ρ/ n/ -/ k2M/ 烆/ 其中/ Pk2i/ +/ 2/ =/ (/ 1/ -/ ρ/ k2i/ +/ 2/ -/ k2i/ +/ 1/ +/ 1/ 由于/ 服务/ 速率/ 大小/ 不/ 确定/ ,/ 因而/ 无法/ 直接/ 推出/ P0/ 的/ 表达式/ ./ 然而/ ,/ 由于/ Pn/ 从/ 0/ 到/ 无穷的/ 积分/ 等于/ 1/ ,/ 只要/ 给定/ 了/ M/ ,/ 可以/ 近似/ 求得/ P0/ 的/ 值/ ./ 不同/ 服务/ 速率/ 的/ 时间/ 占用率/ 可以/ 作为/ 衡量/ 节能/ 效果/ 的/ 标度/ ,/ 对于/ μ/ i/ 的/ 时间/ 占用率/ Ti/ 可以/ 由/ 如下/ 表达式/ 描述/ :/ 烄/ ∑/ k1/ -/ 1n/ =/ 0/ ∑/ k2i/ -/ 2/ -/ k2i/ -/ 3/ -/ 1Ti/ =/ 烅/ ∑/ k2M/ -/ k2M/ -/ 1/ -/ 1/ 烆/ 因而/ ,/ 相对/ 速率/ 可以/ 表达/ 为/ Page5/ 队列/ 排队/ 时延/ 可以/ 表达/ 为/ Delay/ =/ ∑/ M/ -/ 1/ (/ 1/ )/ 均匀/ 速率/ 、/ 均匀/ 阈值/ ,/ N/ 个/ 不同/ 的/ 速率/ 在/ 1/ // 3.3/ 速率/ 和/ 阈值/ 设置/ 在/ 得到/ 上述/ 表达式/ (/ 1/ )/ ~/ (/ 4/ )/ 后/ ,/ 我们/ 在/ 本节/ 中/ 分析/ 速率/ 和/ 阈值/ 分布/ 对系统/ 性能/ 的/ 影响/ ./ 我们/ 选取/ 如下/ 3/ 种有/ 代表性/ 的/ 速率/ 和/ 阈值/ 分布/ 进行/ 分析/ :/ N/ 最大/ 速率/ (/ 1/ 布/ ,/ N/ -/ 1/ 个/ 高/ 阈值/ 亦/ 按/ 均匀分布/ ,/ 表示/ 为/ URUT/ -/ N/ ./ (/ 2/ )/ 指数/ 速率/ 、/ 均匀/ 阈值/ ,/ (/ L/ =/ log2N/ +/ 1/ )/ 个/ 速率/ 在/ 1/ // N/ 最大/ 速率/ (/ 1/ 间/ 指数分布/ ,/ log2N/ 个/ 高/ 阈值/ 按/ 均匀分布/ ,/ 表示/ 为/ ERUT/ -/ L/ ./ (/ 3/ )/ 指数/ 速率/ 、/ 指数/ 阈值/ ,/ (/ L/ =/ log2N/ +/ 1/ )/ 个/ 速率/ 在/ 1/ // N/ 最大/ 速率/ (/ 1/ 间/ 按/ 指数分布/ ,/ log2N/ 个/ 高/ 阈值/ 亦/ 按/ 指数分布/ ,/ 表示/ 为/ ERET/ -/ L/ ./ 在/ 这/ 3/ 种/ 设置/ 中/ ,/ 低/ 速率/ 的/ 分布/ 与/ 高速率/ 相同/ ,/ 并/ 假设/ 每/ 对/ 高低/ 速率/ 的/ 差/ 相等/ ./ 对于/ 指数分布/ ,/ 使用/ 2/ 作为/ 幂/ ./ 在/ 接下来/ 的/ 理论/ 估计/ 中/ ,/ 缓存/ 大小/ 设置/ 为/ 32KB/ ./ 除了/ 分析/ 速率/ 及/ 阈值/ 的/ 分布/ 外/ ,/ 高低/ 阈值/ 之间/ 的/ 差异/ (/ 亦/ 即/ 频率/ 切换/ 的/ 缓冲区/ 大小/ )/ 也/ 需要/ 考虑/ ./ 为此/ ,/ 我们/ 在/ 上面/ 3/ 种/ 分布/ 的/ 基础/ 上/ 额外/ 独立设置/ 了/ 两个/ 关于/ 高低/ 阈值/ 差异/ 的/ 配置/ ./ 配置/ A/ 的/ 高低/ 阈值/ 差/ 接近/ 于/ 0/ ,/ 亦/ 即/ (/ TLi/ ≈/ THi/ )/ ∧/ (/ TLi/ </ THi/ ,/ 1/ / i/ / M/ )/ ,/ 这种/ 情况/ 是/ 对/ 单/ 门限/ 策略/ 的/ 趋近/ ;/ 配置/ B/ 的/ 高低/ 阈值/ 差/ 接近/ 于/ 最大/ 可能/ 值/ ,/ 亦/ 即/ (/ TLi/ / THi/ -/ 1/ )/ ∧/ (/ THi/ -/ 1/ </ TLi/ )/ ,/ 1/ </ i/ / M/ ,/ 这/ 模拟/ 了/ 较大/ 频率/ 切换/ 缓冲区/ 的/ 情况/ ./ 图/ 4/ 显示/ 了/ 配置/ A/ 和/ 配置/ B/ 的/ 3/ 种/ 分布/ 在/ 不同/ 系统/ 负载/ 情况/ 下/ 的/ 平均/ 队列/ 时延/ ,/ 图/ 5/ 显示/ 了/ 配置/ A/ 和/ 配置/ B/ 的/ 3/ 种/ 分布/ 在/ 不同/ 系统/ 负载/ 情况/ 下/ 的/ 平均/ 相对/ 速率/ ,/ 其中/ N/ 的/ 值/ 均/ 为/ 16/ ./ 如图/ 4/ 所示/ ,/ 在/ 3/ 种/ 分布/ 中/ ,/ ERET/ -/ 5/ 的/ 队列/ 时延/ 最低/ ,/ 而/ ERUT/ -/ 5/ 的/ 队列/ 时延/ 则/ 比/ 另外/ 两个/ 分布/ 高出/ 很多/ ,/ 这种/ 情况/ 在/ 系统/ 利用率/ 不高/ 的/ 时候/ 尤为/ 明显/ ./ 这/ 说明/ 阈值/ 的/ 分布/ 应该/ 与/ 所/ 选取/ 的/ 速率/ 分布/ 相一致/ 或/ 匹配/ ./ 对于/ 平均/ 相对/ 速率/ ,/ 3/ 种/ 分布/ 的/ 效果/ 非常/ 接近/ ,/ 且/ 均/ 与/ 系统/ 的/ 利用率/ 成/ 比例/ ./ 从图/ 5/ 中/ 可以/ 看出/ ,/ 与/ 配置/ A/ 相比/ ,/ 配置/ B/ 的/ 相对/ 速率/ 更加/ 理想/ ,/ 更/ 接近/ 于/ 最优/ 值/ ./ 对于/ 队列/ 时延/ ,/ 配置/ B/ 也/ 略低于/ 配置/ A/ ,/ 这是/ 由于/ 频率/ 切换/ 的/ 缓冲区/ 加大/ 了/ (/ 马尔卡/ 夫/ 模型/ 中/ 的/ 单链/ 变短/ )/ ,/ 从/ 平均/ 意义/ 而言/ ,/ 系统/ 有/ 更/ 多/ 的/ 机会/ 工作/ 在/ 相对/ 较/ 高/ 的/ 频率/ 下/ ./ 另一方面/ ,/ 由于/ 缓冲区/ 变/ 大/ ,/ 系统/ 进行/ 频率/ 切换/ 的/ 次数/ 会/ 减少/ ,/ 这/ 保证/ 了/ 系统/ 的/ 稳定/ ,/ 也/ 减少/ 了/ 频率/ 切换/ 所/ 带来/ 的/ 开销/ ./ 总体而言/ ,/ 上述/ 结果/ 说明/ 双/ 门限/ 策略/ 比单/ 门限/ 策略/ 的/ 性能/ 更优/ ,/ 且/ 性能/ 会/ 随着/ 高低/ 阈值/ 的/ 差/ 增大/ 而/ 提升/ ./ 从图/ 5/ 中/ ,/ 我们/ 可以/ 注意/ 到/ ,/ 在/ 低频/ 时/ 系统/ 所/ 能/ 降低/ 的/ 频率/ 近似于/ 1/ -/ 1/ // N/ ,/ 这/ 说明/ 频率/ 划分/ 越细/ (/ 即/ N/ 越大/ )/ ,/ 或是/ 最低/ 频率/ 越低/ ,/ 在/ 低频/ 时所能/ 节约/ 的/ 能量/ 越多/ ./ 而/ 对于/ 系统/ 利用率/ 高于/ 1/ // N/ 时/ ,/ N/ 对/ 相对/ 速率/ 的/ 大小/ 没有/ 影响/ ./ 因而/ 在/ 实际/ 应用/ 中/ ,/ 过度/ 追求/ 频率/ 的/ 细分/ 和/ 过/ 低/ 的/ 频率/ 是/ 没有/ 必要/ 的/ ./ 综上所述/ ,/ 频率/ 和/ 阈值/ 的/ 分布/ 对系统/ 性能/ 有着/ 非常/ 大/ 的/ 影响/ ,/ 对于/ 所/ 选取/ 的/ 3/ 种/ 频率/ 和/ 阈值/ 的/ 分布/ ,/ 第/ 3/ 种/ 指数/ 频率/ 指数/ 阈值/ 的/ 性能/ 最佳/ ./ 特别/ 地/ ,/ 高低/ 阈值/ 的/ 差异/ 应该/ 设置/ 地/ 尽可能/ 大/ ,/ 以/ 降低/ 队列/ Page6/ 延迟/ 和/ 增强/ 系统/ 稳定性/ ./ 另外/ ,/ 阈值/ 的/ 分布/ 应该/ 与/ 频率/ 的/ 分布/ 相匹配/ ,/ 而/ 频率/ 划分/ 的/ 粒度/ 和/ 最低/ 频率/ 的/ 大小/ 仅/ 对系统/ 利用率/ 低时/ 的/ 功耗/ 有着/ 有限/ 的/ 影响/ ./ 而/ 由于/ 阈值/ 的/ 选取/ 是/ 基于/ 缓存/ 的/ 大小/ 的/ ,/ 一般而言/ 缓存/ 取值/ 越小/ ,/ 系统/ 可以/ 在/ 队列/ 更/ 短/ 的/ 时候/ 切换/ 到/ 高频/ 状态/ ,/ 有利于/ 减少/ 因/ 调频/ 带来/ 的/ 额外/ 队列/ 时延/ ./ 因此/ ,/ 在/ 理论/ 上/ 使用/ FASS/ 进行/ 路由器/ 数据通路/ 的/ 节能/ 是/ 可行/ 的/ ./ 为了/ 进一步/ 验证/ 我们/ 的/ 分析/ ,/ 我们/ 在/ NetFPGA/ 平台/ 的/ 参考/ 路由器/ 上/ 实现/ 了/ FASS/ ,/ 并/ 进行/ 了/ 实际/ 流量/ 的/ 测试/ ,/ 这/ 将/ 在/ 接下来/ 的/ 章节/ 中/ 讨论/ ./ 4FASS/ 在/ NetFPGA/ 参考/ 路由器/ 中/ 的/ 实现/ 4.1/ NetFPGA/ 参考/ 路由器/ NetFPGA/ 是/ 美国斯坦福大学/ 开发/ 的/ ,/ 具有/ 千兆/ 速率/ (/ 以太网/ RJ45/ 接口/ )/ 的/ 可编程/ 硬件平台/ ./ NetFPGA/ 是/ 基于/ Linux/ 的/ 开源/ 项目/ ,/ 所有/ 参考/ 的/ 路由器/ 、/ 交换机/ 、/ 网卡/ 等/ 设计/ 与/ 实现/ 都/ 面向/ 研究/ 人员/ 和/ 学生/ 开发/ ,/ 为/ 大家/ 提供/ 了/ 一个/ 实用/ 、/ 高效/ 的/ 网络/ 系图/ 6NetFPGA/ 参考/ 路由器/ 数据通路/ 流水/ 架构/ 4.2/ 具有/ FASS/ 功能/ 的/ 原理/ 路由器/ 实现/ 具有/ FASS/ 功能/ 的/ 原理/ 路由器/ 是/ 以/ NetFPGA/ 的/ 参考/ 路由器/ 为/ 基础架构/ ,/ 添加/ 少量/ 频率/ 调节/ 模块/ 和/ 队列/ 到/ 数据通路/ 上/ 实现/ 的/ ,/ 如图/ 6/ 中/ 阴影/ 部分/ 所示/ ./ 原有/ 的/ 模块/ 之间/ 的/ 缓冲/ 队列/ 都/ 是/ 同步/ 队列/ ,/ 为/ 实现/ 各个/ 模块/ 异步/ 的/ 动态/ 工作频率/ 调整/ ,/ 我们/ 使用/ 异步/ 队列/ 替换/ 所有/ 原先/ 的/ 同步/ 队列/ 以/ 支持/ 前后/ 级/ 模块/ 工作/ 在/ 不同/ 的/ 频率/ ./ 所有/ 异步/ 队列/ 的/ 数据位/ 宽/ 都/ 与/ 之前/ 的/ 同统/ 开发/ 平台/ ./ 研究/ 人员/ 可以/ 通过/ 修改/ 参考/ 设计/ 中/ 的/ 部分/ 某块/ 或者/ 添加/ 自定义/ 模块/ 来/ 快速/ 实现/ 、/ 验证/ 自己/ 的/ 想法/ ./ 当前/ 有/ 两个/ 版本/ 的/ NetFPGA/ 板卡/ :/ NetFPGA/ -/ 1G/ 和/ NetFPGA/ -/ 10G/ ,/ FASS/ 通过/ 修改/ NetFPGA/ -/ 1G/ 的/ 参考/ 路由器/ 进行/ 实际/ 的/ 性能/ 测试/ ./ NetFPGA/ 核心/ 处理器/ 是/ 一块/ XilinxVirtexIIPro50FPGA/ [/ 7/ ]/ ,/ 工作频率/ 可/ 配置/ 为/ 125MHz/ 或/ 62.5/ MHz/ ./ 另外/ ,/ 两块/ SRAM/ 协同/ 核心/ FPGA/ 实现/ 数据包/ 和/ 其它/ 数据/ 的/ 存储/ ./ 在/ 我们/ 的/ 实现/ 中/ ,/ FPGA/ 和/ SRAM/ 的/ 工作频率/ 设置/ 为/ 125M/ ./ NetFPGA/ -/ 1G/ 的/ 参考/ 路由器/ 体系/ 架构/ 如图/ 6/ 所示/ ,/ 共有/ 8/ 对/ 接收/ 和/ 发送/ 队列/ ,/ 其中/ 4/ 对/ 队列/ 对应/ 4/ 个/ 千兆/ 以太网/ RJ45/ 接口/ ,/ 其余/ 4/ 对/ 队列/ 对应/ 与其/ 相连/ 的/ 主机/ 的/ CPU/ -/ DMA/ 接口/ ./ 图/ 6/ 中/ 的/ 时钟/ 适配器/ 是/ FASS/ 添加/ 的/ 模块/ ,/ 用于/ 动态/ 调整/ 各个/ 模块/ 的/ 工作频率/ ./ 在/ 用户/ 数据通路/ 上/ 的/ 流水/ 架构/ 采用/ 64/ 比特/ 的/ 总线/ 宽度/ ,/ 在/ 125MHz/ 时钟/ 下/ ,/ 最高/ 支持/ 8Gbps/ 的/ 带宽/ [/ 8/ ]/ ./ 所有/ 的/ 内部/ 模块/ 采用/ 标准/ 的/ 先进先出/ 的/ 请求/ 、/ 授权/ 协议/ ./ 使用者/ 可以/ 通过/ 额外/ 的/ 队列/ 和/ 模块/ 到/ 用户/ 数据通路/ 上/ ,/ 实现需求/ 的/ 功能/ ./ 步/ 队列/ 的/ 数据位/ 宽/ 相同/ ,/ 为/ 64/ 比特/ ,/ 保持/ 了/ 原先/ 数据通路/ 最高/ 带宽/ 为/ 8Gbps/ 的/ 特性/ ./ 频率/ 调整/ 模块/ 根据/ 实际/ 等待/ 队列/ 的/ 长度/ ,/ 动态/ 地/ 调整/ 模块/ 的/ 工作频率/ 、/ 与/ 之/ 对应/ 的/ 输入/ 队列/ 的/ 输出/ 时钟/ 频率/ (/ 读/ 时钟/ 频率/ )/ 和/ 输出/ 队列/ 的/ 输入/ 时钟/ 频率/ (/ 写/ 时钟/ 频率/ )/ ,/ 如图/ 7/ 所示/ ./ 相邻/ 的/ 模块/ 可以/ 根据/ 自身/ 处理/ 速率/ 和/ 等待/ 队列/ 长度/ 的/ 不同/ ,/ 动态/ 地/ 调整/ 各自/ 的/ 工作频率/ ,/ 从而/ 实现/ 各个/ 模块/ 的/ 异步/ 调频/ ,/ 实现/ 降低/ 模块/ 功耗/ 目标/ ./ Page7/ 在/ 我们/ 目前/ 实现/ 的/ 原型/ 系统/ 中/ ,/ 频率/ 适配器/ 被/ 设置/ 在/ “/ 输入/ 选择器/ ”/ 模块/ 、/ “/ 路由/ 查找/ ”/ 模块/ 以及/ “/ 输出/ 队列/ ”/ 中/ 的/ 子/ 模块/ 中/ ./ 频率/ 适配器/ 具有/ 6/ 档/ 频率/ ,/ 分别/ 是/ 125MHz/ 、/ 62.5/ MHz/ 、/ 31.25/ MHz/ ,/ 15.625/ MHz/ ,/ 7.813/ MHz/ 和/ 3.096/ MHz/ ,/ 相邻/ 两档/ 频率/ 时间/ 是/ 二/ 倍频/ 关系/ ./ 由于/ SRAM/ 的/ 工作频率/ 是/ 与/ FPGA/ 芯片/ 的/ 工作频率/ 一致/ 的/ ,/ 我们/ 在/ 原型/ 系统/ 中/ 没有/ 实现/ 对/ SRAM/ 频率/ 的/ 动态/ 调整/ ./ NetFPGA/ 的/ 寄存器/ 接口/ 允许/ 运行/ 在/ 主机/ 上/ 的/ 软件/ 通过/ PCI/ 接口/ 与/ NetFPGA/ 接口卡/ 通信/ ,/ 发送数据/ 到/ 寄存器/ (/ 指令/ 等/ )/ 或/ 查询/ 寄存器/ 的/ 数据/ ./ 为/ 测量/ 采用/ FASS/ 路由器/ 原型/ 系统/ 的/ 性能/ ,/ 我们/ 添加/ 频率/ 计数/ 寄存器/ 到/ NetFPGA/ 的/ 寄存器/ 组中/ ,/ 实时/ 记录/ 各个/ 模块/ 在/ 不同/ 频率/ 下/ 运行/ 的/ 次数/ (/ 时间/ )/ ./ 5/ 实验/ 结果/ 由于/ 路由器/ 的/ 基本功能/ 是/ 快速/ 的/ 转发/ 数据包/ ,/ 如果/ 某一/ 调频/ 机制/ 在/ 节约/ 能耗/ 的/ 同时/ ,/ 急剧/ 增加/ 了/ 转发/ 的/ 时延/ ,/ 则/ 这种/ 节能/ 机制/ 不能/ 应用/ 于/ 实际/ 系统/ ./ 所以/ 在/ 对/ FASS/ 的/ 性能/ 测试/ 中/ ,/ 主要/ 关注/ 两点/ :/ 节能/ 效果/ 和/ 增加/ 的/ 系统/ 延迟/ ./ 功耗/ 与/ 频率/ 之间/ 的/ 关系/ 是/ :/ Power/ =/ α/ V2f/ ,/ 其中/ α/ 是/ 依赖于/ 实际/ 器件/ 有关/ 的/ 参数/ ,/ 可以/ 认为/ 是/ 常量/ ,/ V/ 是/ 供电/ 电压/ ,/ f/ 是/ 工作频率/ [/ 5/ ]/ ./ 由于/ FASS/ 仅/ 动态/ 调节/ 模块/ 的/ 工作频率/ ,/ 可以/ 简化/ 功耗/ 与/ 频率/ 之间/ 的/ 关系/ 为/ Power/ =/ Bf/ ,/ 其中/ B/ 是/ 与/ 器件/ 相关/ 的/ 参数/ ./ 因此/ ,/ 我们/ 采用/ 以下/ 的/ 式/ (/ 5/ )/ ~/ (/ 7/ )/ 计算/ 一个/ 模块/ 的/ 功耗/ ./ 其中/ ,/ Fmax/ 是/ 模块/ 的/ 最高/ 工作频率/ ;/ k/ 是/ 调节/ 的/ 频率/ 档数/ ;/ Fi/ 表示/ 第/ i/ 档/ 的/ 频率/ ;/ Count/ (/ Fi/ )/ 是/ 对/ 第/ i/ 档/ 频率/ 的/ 计/ 数值/ ;/ P/ (/ Fi/ )/ 是/ 归一化/ 后/ ,/ 模块/ 工作/ 在/ 第/ i/ 档/ 频率/ 的/ 时间/ 比例/ ./ 在/ 上/ 一节/ 中/ ,/ 我们/ 已经/ 详细/ 介绍/ 了/ 实验/ 中/ 所/ 使用/ 的/ NetFPGA/ 平台/ ./ 特别/ 地/ ,/ 我们/ 将/ NetFPGA/ 的/ 核心/ 时钟/ 频率/ 配置/ 为/ 其/ 默认值/ 125MHz/ ,/ 使得/ NetFPGA/ 最高/ 能/ 有/ 8Gbps/ 的/ 吞吐/ 率/ ./ 然而/ 在/ 我们/ 的/ 实验/ 中/ ,/ 只/ 利用/ 了/ 4/ 个/ 以太/ 接口/ (/ 并/ 没有/ 使用/ CPU/ -/ DMA/ 通路/ )/ ,/ 使得/ NetFPGA/ 实际上/ 能/ 达到/ 的/ 最高/ 吞吐/ 率为/ 4Gbps/ ./ 为了/ 能够/ 衡量/ 节能/ 效果/ 和/ 增加/ 的/ 传输/ 时延/ ,/ 我们/ 在/ NetFGPA/ 上/ 实现/ 了/ 两个/ IP/ 路由器/ :/ 一个/ 是/ NetFPGA/ 默认/ 的/ 参考/ 路由器/ ,/ 一个/ 是/ 应用/ 了/ FASS/ 机制/ 的/ 路由器/ ./ 对于/ FASS/ 路由器/ ,/ 我们/ 使用/ 时钟/ 适配器/ 来/ 调整/ 时钟/ 的/ 大小/ ./ 为了/ 防止/ 低速/ 模式/ 下/ 可能/ 出现/ 的/ 数据/ 溢出/ ,/ 我们/ 在/ 所有/ 实验/ 中将/ 缓存/ 的/ 大小/ 设置/ 为/ 16KB/ ./ 为/ 从/ 实验/ 角度/ 验证/ 第/ 3/ 节中/ 理论/ 分析/ 的/ 结果/ ,/ 对于/ FASS/ 路由器/ 我们/ 采用/ 4/ 组/ 不同/ 的/ 配置/ ./ 在/ 所有/ 的/ 4/ 组/ 配置/ 中/ ,/ M/ =/ 5/ ,/ 且/ 均/ 采用/ 幂为/ 2/ 的/ 指数/ 分频/ 方式/ ./ 应用/ 时钟/ 适配器/ 的/ 模块/ ,/ 其/ 频率/ 可/ 被/ 指数/ 分为/ 6/ 档/ ,/ 使得/ 最低/ 能/ 获得/ 125/ 应于/ 250Mbps/ 的/ 吞吐/ 率/ ./ 对应/ 于/ 6/ 档/ 频率/ ,/ 一共/ 有/ 5/ 组双/ 门限/ 阈值/ ,/ 在/ 4/ 组/ 配置/ 中/ 分别/ 按照/ 指数/ 和/ 均匀/ 形式/ 进行/ 分布/ ,/ 其中/ 最高/ 阈值/ TMH/ 均/ 为/ 512/ (/ 对应/ 于/ 4KB/ )/ ./ 对于/ 高低/ 阈值/ 差/ ,/ 如同/ 第/ 3/ 节/ 的/ 理论/ 分析/ ,/ 分为/ A/ 和/ B/ 两组/ ./ 具体/ 地/ ,/ 4/ 组/ 配置/ 可/ 总结/ 在/ 表/ 1/ 之中/ (/ 其中/ M/ =/ 5/ ,/ T0H/ =/ 0/ )/ ./ ReferenceA/ -/ ERUT/ (/ i/ // M/ )/ TMHA/ -/ ERET2/ -/ (/ M/ -/ i/ )/ TMHB/ -/ ERUT/ (/ i/ // M/ )/ TMHT/ (/ i/ -/ 1/ )/ H/ +/ 4B/ -/ ERET2/ -/ (/ M/ -/ i/ )/ TMHT/ (/ i/ -/ 1/ )/ H/ +/ 4/ 在/ 给出/ 如上/ 4/ 组/ 配置/ 后/ ,/ 我们/ 使用/ 一台/ 思博伦/ SmartBits600/ 网络/ 性能/ 分析仪/ 来/ 生成/ 实验/ 流量/ 并/ 分析/ 系统/ 性能/ ./ 在/ 我们/ 的/ 实验/ 中/ ,/ NetFPGA/ 的/ 4/ 个/ 1GE/ 端口/ 都/ 被/ 使用/ ./ 输入/ 流量/ 从/ 最大/ 输入/ 流量/ 的/ 5/ %/ 调节/ 至/ 95/ %/ ,/ 步进/ 为/ 5/ %/ ,/ 特定/ 流量/ 下/ 都/ 采用/ 随机/ 数据包/ 发送/ 方式/ ./ 对于/ 每/ 一个/ 不同/ 大小/ 的/ 流量/ ,/ 我们/ 进行/ 30s/ 的/ 测试/ ,/ 记录/ 系统/ 的/ 平均/ 时延/ 和/ 应用/ Page8FASS/ 的/ 模块/ 的/ 频率/ 分布/ ./ 为了/ 使得/ 实验/ 数据/ 可靠/ ,/ 所有/ 的/ 实验/ 均/ 重复/ 10/ 次以/ 获得/ 平均/ 结果/ ./ 图/ 8/ 中/ 展示/ 了/ 参考/ 路由器/ 和/ FASS/ 路由器/ 在/ 4/ 个/ 不同/ 配置/ 下/ ,/ 所/ 处于/ 不同/ 流量/ 输入/ 的/ 平均/ 响应/ 时间/ (/ 包括/ 队列/ 时延/ 和/ 例行/ 的/ 处理/ 时间/ )/ ./ 由图/ 8/ 所示/ ,/ FASS/ 路由器/ 4/ 个/ 配置/ 下/ 的/ 时延/ 曲线/ 与/ 理论/ 模型/ 的/ 曲线/ 一致/ ./ 其中/ ,/ 在/ 所有/ 的/ 输入/ 情况/ 下/ ,/ 指数/ 频率/ 指数/ 阈值/ 的/ 配置/ ,/ 其时/ 延都/ 低于/ 指数/ 频率/ 均匀/ 阈值/ 的/ 配置/ ,/ 这/ 验证/ 了/ 阈值/ 的/ 分布/ 应/ 与/ 频率/ 的/ 分布/ 相匹配/ 的/ 推论/ ./ 另一方面/ ,/ B/ 组/ 的/ 时延/ 均/ 略低于/ A/ 组/ 的/ 时延/ ,/ 这/ 支持/ 了/ 高低/ 阈值/ 差应/ 设置/ 为/ 尽可能/ 大/ 的/ 结论/ ./ 在/ 图/ 8/ 中/ ,/ 在/ 某些/ 负载/ 下/ ,/ 平均/ 延迟/ 会/ 发生/ 突变/ ,/ 是因为/ 在/ 这种/ 负载/ 下/ ,/ 队列/ 的/ 队长/ 会/ 恰好/ 陷入僵局/ ,/ 即/ 一直/ 运行/ 在/ 低频/ ,/ 但/ 又/ 不能/ 突破/ 队列/ 长度/ 来/ 切换/ 到/ 更/ 高频率/ ,/ 从而/ 使得/ 平均/ 时延/ 加大/ ./ 图/ 8/ 参考/ 路由器/ 和/ FASS/ 路由器/ 在/ 不同/ 配置/ 、/ 不同/ 负载/ 下/ 的/ 然而/ ,/ 在/ 实际/ 实验/ 中/ 的/ 时延/ 要/ 远大于/ 参考/ 路由器/ 的/ 时延/ ,/ 即便/ 是/ 在/ 处理/ 速率/ 更快/ 的/ 情况/ 下/ ,/ 这/ 仍然/ 与/ 理论/ 分析/ 不/ 相吻合/ ./ 我们/ 认为/ 这/ 可能/ 由/ 三/ 方面/ 的/ 原因/ 所致/ ./ 首先/ ,/ 实际/ 实验/ 中/ 数据包/ 到达/ 可能/ 并/ 不/ 严格/ 服从/ 理论/ 分析/ 中/ 假设/ 的/ 泊松/ 分布/ ;/ 其次/ ,/ 实际/ 频率/ 切换/ 所/ 需/ 的/ 时间/ 并不一定/ 可以/ 忽略/ ,/ 这/ 有待于/ 进一步/ 研究/ ;/ 最后/ ,/ 也/ 是/ 最/ 有/ 可能/ 的/ ,/ 理论/ 分析/ 中/ 对应/ 的/ 结果/ 只/ 适用/ 于/ 一个/ 模块/ ,/ 而/ 在/ 我们/ 的/ 硬件/ 实现/ 当中/ ,/ 有/ 多个/ 模块/ 应用/ 了/ FASS/ 策略/ 中/ 的/ 调频/ 机制/ ./ 总体而言/ ,/ 由于/ 双/ 门限/ 多/ 阈值/ 多频/ 调频/ 策略/ 的/ 引入/ ,/ 整个/ 路由器/ 的/ 系统/ 响应/ 时间/ 有所增加/ ,/ 但/ 始终/ 处于/ 一个/ 可/ 接受/ 的/ 范围/ ./ 而/ 对于/ 阈值/ 的/ 分布/ ,/ 应/ 与/ 频率/ 的/ 分布/ 相匹配/ ,/ 且/ 同组/ 高低/ 门限/ 的/ 差异/ 应/ 尽可能/ 设置/ 大/ ,/ 以/ 减少/ 路由器/ 进行/ 频率/ 切换/ 的/ 次数/ ,/ 使得/ 系统/ 尽可能/ 多地/ 工作/ 在/ 稳定/ 的/ 状态/ 下/ ./ 图/ 9/ 中/ 显示/ 了/ 应用/ FASS/ 的/ 模块/ 的/ 动态/ 相对/ 功耗/ ./ 由于/ 受限于/ 测量/ 仪器/ ,/ 模块/ 级/ 功耗/ 我们/ 不能/ 直接/ 测/ 得/ ,/ 因而/ 我们/ 根据/ 记录/ 的/ 频率/ 分布/ 按照/ 式/ (/ 8/ )/ 推出/ 模块/ 的/ 动态/ 功耗/ ./ 从图/ 中/ 可得/ ,/ 在/ 所有/ 的/ 流量/ 输入/ 下/ ,/ FASS/ 路由器/ 都/ 能/ 节省/ 大量/ 的/ 动态/ 功耗/ ./ 相反/ 地/ ,/ 由于/ 参考/ 路由器/ 始终/ 工作/ 在/ 最高/ 频率/ ,/ 因而/ 即使/ 在/ 输入/ 流量/ 很/ 低/ 的/ 时候/ ,/ 参考/ 路由器/ 依然/ 会/ 消耗/ 非常/ 多/ 的/ 能量/ ./ 然而/ 读者/ 可能/ 会/ 产生/ 疑问/ ,/ 为什么/ 当/ 流量/ 负载/ 接近/ 100/ %/ 时/ ,/ 相对/ 的/ 动态/ 功耗/ 只有/ 不到/ 50/ %/ ?/ 正如/ 在/ 第/ 4/ 节所/ 介绍/ 的/ ,/ NetFPGA/ 的/ 用户/ 数据通路/ 与/ 8/ 个/ 接收/ // 发送/ 队列/ 相连/ ,/ 其中/ 4/ 个/ 是/ 我们/ 并/ 没有/ 用到/ 的/ CMU/ -/ DMA/ 通路/ ./ 由于/ 路由器/ 的/ 核心/ 频率/ 配置/ 为/ 125MHz/ ,/ 实际上/ 路由器/ 数据通路/ 支持/ 的/ 吞吐/ 率为/ 8Gbps/ ,/ 因而/ 对应/ 的/ 功耗/ 也/ 和/ 流量/ 为/ 8Gbps/ 时/ 相等/ ./ 然而/ 由于/ 系统/ 的/ 最大/ 输入/ 流量/ 为/ 4Gbps/ ,/ 因而/ 相对/ 的/ 动态/ 功耗/ 最大值/ 也/ 应/ 在/ 50/ %/ 左右/ ./ 然而/ 对于/ 参考/ 路由器/ ,/ 即使/ 是/ 在/ 空闲/ 状态/ 下/ ,/ 其/ 所有/ 的/ 模块/ 均/ 工作/ 在/ 最高/ 频率/ ,/ 这/ 导致/ 了/ 与/ FASS/ 路由器/ 相比/ 较大/ 的/ 动态/ 功耗/ ./ 另一方面/ ,/ 由于/ 频率/ 只/ 对/ 设备/ 的/ 动态/ 功耗/ 有/ 影响/ ,/ 实际/ 对应/ 的/ 节能/ 效果/ 可能/ 并/ 不如/ 图/ 9/ 中/ 所示/ 的/ 那样/ 理想/ ./ 但是/ ,/ 通常/ 情况/ 下/ 在/ 不/ 支持/ 频率/ 调节/ 的/ 设备/ 中/ ,/ 其/ 动态/ 功耗/ 远大于/ 静态/ 功耗/ ./ 因而/ ,/ FASS/ 机制/ 可以/ 使得/ 支持/ 它/ 的/ 模块/ 节省/ 可观/ 的/ 能量/ ,/ 特别/ 是/ 当/ 设备/ 和/ 模块/ 的/ 平均/ 利用率/ 较/ 低/ 的/ 时候/ ./ 图/ 10/ 中/ 显示/ 了/ B/ 组/ 的/ 指数/ 频率/ 、/ 指数/ 阈值/ 配置/ 在/ 不同/ 流量/ 输入/ 下/ 所/ 对应/ 的/ 平均/ 速率/ 分布/ ,/ 其中/ 柱状图/ 的/ 每/ 一列/ 表示/ 归一化/ 后/ 各个/ 频率/ 运行/ 时间/ 的/ 比例/ ./ 可以/ 看出/ ,/ 随着/ 输入/ 流量/ 的/ 不断/ 增大/ ,/ 模块/ 工作/ 在/ 较/ 高频率/ 的/ 时间/ 会/ 有所增加/ ./ 而/ 即便/ 当/ 输入/ 流量/ 接近/ 最大/ 负荷/ 时/ ,/ 设备/ 也/ 并不需要/ 时刻/ 工作/ 在/ 对应/ 的/ 处理/ 速率/ 上/ ./ 这/ 是因为/ 在/ 实际/ 的/ 网络/ 环境/ 当中/ ,/ 数据包/ 的/ 到达/ 都/ 存在/ 间隙/ ,/ 这一/ 阶段/ 中/ 设备/ 所/ 面临/ 的/ 处理/ 压力/ 相对/ 较/ 小/ ,/ 因而/ 可以/ 工作/ 在/ 相对/ 较/ 低/ 的/ Page9/ 频率/ 上/ ,/ 同样/ 可以/ 达到/ 节能/ 效果/ ./ 而/ 一旦/ 流量/ 的/ 输入/ 速率/ 超过/ 了/ 当前/ 的/ 工作/ 速率/ ,/ 设备/ 则/ 会/ 切换/ 回/ 对应/ 的/ 甚至/ 更/ 高/ 的/ 频率/ 进行/ 处理/ ,/ 以/ 满足/ 性能/ 需要/ ./ 因此/ ,/ FASS/ 确实/ 能/ 使/ 设备/ 的/ 工作/ 速率/ 适应/ 其/ 工作/ 负载/ ,/ 这样/ 可以/ 节约/ 大量/ 能量/ ./ 对/ 大部分/ 网络设备/ 而言/ ,/ 它们/ 在/ 多数/ 时间/ 都/ 处于/ 较/ 低/ 利用/ 状态/ ,/ 这样/ 通过/ 应用/ FASS/ 机制/ ,/ 就/ 能/ 使/ 模块/ 大部分/ 时间/ 工作/ 在/ 较/ 低/ 频率/ ,/ 从而/ 在/ 维持/ 足够/ 的/ 系统/ 性能/ 的/ 前提/ 下/ ,/ 使/ 这些/ 设备/ 上/ 节约/ 大量/ 能量/ ./ 图/ 11/ 显示/ 了/ 在/ 1/ %/ ~/ 30/ %/ 负载/ 下/ ,/ B/ 组/ 的/ 各个/ 频率/ 的/ 比例/ ./ 可以/ 看到/ 当/ 流量/ 小于/ 10/ %/ 时/ ,/ 90/ %/ 的/ 时间/ ,/ 模块/ 工作/ 在/ 最低/ 的/ 两档/ 频率/ ;/ 当/ 流量/ 小于/ 30/ %/ 时/ ,/ 80/ %/ 的/ 时间/ ,/ 模块/ 工作/ 在/ 最低/ 的/ 三档/ 频率/ ./ 图/ 11B/ 组/ 指数/ 阈值/ 配置/ 在/ 1/ %/ ~/ 30/ %/ 负载/ 下/ 的/ 6/ 相关/ 工作/ 在/ 过去/ 的/ 几年/ 中/ ,/ 降低/ 网络设备/ 的/ 能耗/ 已经/ 成为/ 网络体系结构/ 设计/ 、/ 路由器/ 和/ 交换机/ 等/ 网络设备/ 设计/ 的/ 重要/ 指标/ ,/ 引起/ 学术界/ 和/ 工业界/ 的/ 广泛/ 关注/ ,/ 有/ 许多/ 工作/ 都/ 围绕/ 节能/ 、/ 绿色/ 互联网/ 展开/ ./ Nedevschi/ 等/ 人/ [/ 3/ ]/ 提出/ 的/ 两种/ 设备/ 能耗/ 管理/ 方案/ ,/ 被/ 研究/ 人员/ 广泛/ 认可/ 和/ 使用/ ./ 第/ 1/ 种/ 将/ 处于/ 空闲/ 状态/ 的/ 模块/ 休眠/ ,/ 例如/ 路由器/ 控制/ 平面/ 的/ CPU/ 、/ 内存模块/ 等/ ;/ 第/ 2/ 种/ 根据/ 模块/ 的/ 负载/ 动态/ 地/ 调整/ 模块/ 的/ 工作频率/ ,/ 例如/ 将/ CPU/ 从/ 全速/ 100/ %/ 工作/ 调整/ 为/ 半速/ 50/ %/ 工作/ ./ 一般/ 认为/ 休眠/ 方式/ 具有/ 较/ 好/ 的/ 节能/ 效果/ ,/ 而/ 调频/ 方式/ 则/ 更/ 适合/ 负载/ 不断/ 变化/ 的/ 网络/ 环境/ ./ 而/ Wierman/ 等/ 人/ [/ 9/ ]/ 在/ 处理器/ 共享/ 系统/ 中/ 研究/ 、/ 应用/ 调频/ 机制/ ,/ 实验/ 结果表明/ 在/ 相同/ 的/ 节能/ 效果/ 下/ ,/ 动态/ 调频/ 机制/ 能够/ 显著/ 地/ 改进/ 系统/ 处理/ 突发/ 流量/ 的/ 鲁棒性/ ./ Gupta/ 和/ Singh/ [/ 2/ ]/ 设计/ 的/ 动态/ 链路/ 关闭/ 算法/ ,/ 能够/ 根据/ 当前/ 系统/ 数据包/ 处理/ 等待/ 队列/ 的/ 长度/ ,/ 结合/ 预测/ 机制/ ,/ 动态/ 地/ 关闭/ 或/ 开启/ 设备/ 的/ 以太网/ 接口/ ,/ 从而/ 实现/ 节能/ ./ 而/ 根据/ Tucker/ 等/ 人/ [/ 10/ ]/ 和/ Neilson/ [/ 11/ ]/ 对/ 路由器/ 、/ 交换机/ 中/ 各个/ 物理/ 部件/ 能耗/ 的/ 调查/ ,/ 以太网/ 设备/ 的/ 接口/ 器件/ 仅/ 占/ 整个/ 设备/ 能耗/ 的/ 13/ %/ ,/ 所以/ 需要/ 其他/ 技术/ 来/ 实现/ 除/ 接口/ 外/ 其他/ 物理/ 器件/ 的/ 节能/ ./ Gunaratne/ 等/ 人/ [/ 4/ ]/ 第一次/ 提出/ 采用/ 双/ 阈值/ 来/ 动态/ 调整/ 频率/ 的/ 思路/ ,/ 能够/ 有效/ 解决/ 因为/ 单/ 阈值/ 引起/ 的/ 频率/ 不断/ 切换/ (/ 抖动/ )/ 的/ 问题/ ,/ 从而/ 大大降低/ 了/ 系统/ 的/ 整体/ 时延/ 和/ 能耗/ ./ 但/ 双/ 阈值/ 策略/ 依然/ 存在/ 阈值/ 选取/ 等/ 问题/ ./ NetFPGA/ [/ 12/ ]/ 提供/ 了/ 一个/ 能够/ 让/ 研究/ 人员/ 快速/ 学习/ 、/ 使用/ 的/ 工业/ 级/ 系统/ 设计/ 、/ 开发/ 平台/ ./ 它/ 以/ 开源/ 方式/ 提供/ 多个/ 路由器/ [/ 8/ ]/ 、/ 交换机/ [/ 7/ ,/ 13/ ]/ 、/ 网卡/ 、/ 发包/ 仪/ [/ 14/ ]/ 等/ 参考/ 设计/ ,/ 帮助/ 科研人员/ 验证/ 自己/ 的/ 网络/ 优化/ 设计/ ,/ 大大减少/ 了/ 网络/ 研究/ 的/ 任务量/ ./ 7/ 结束语/ 本文/ 提出/ 了/ 一种/ 快速/ 自/ 适应/ 频率/ 调整/ 的/ 机制/ FASS/ 用于/ 减少/ 网络设备/ 的/ 能耗/ ./ FASS/ 采用/ 双/ 门限/ 多/ 阈值/ 实现/ 频率/ 的/ 平稳/ 切换/ ./ 一方面/ 避免/ 了/ 单/ 阈值/ 带来/ 的/ 频率抖动/ 问题/ ;/ 另一方面/ ,/ 相比/ 双/ 阈值/ 策略/ ,/ 有效/ 降低/ 了/ 模块/ 能耗/ 和/ 时延/ ./ 同时/ ,/ 我们/ 通过/ 修改/ NetFPGA/ 现有/ 的/ 4/ 端口/ 千兆/ 参考/ 路由器/ ,/ 添加/ FASS/ 到/ 数据包/ 处理/ 模块/ 中/ ,/ 验证/ 了/ FASS/ 的/ 有效性/ ;/ 建立/ 马尔可夫/ 模型/ 对/ 阈值/ 的/ 选取/ 进行/ 了/ 理论/ 分析/ ,/ 并/ 使用/ Smartbits600/ 网络/ 测试仪/ 测试/ 了/ 不同/ 负载/ 情况/ 下/ FASS/ 的/ 性能/ ./ 马尔可夫/ 模型/ 分析/ 结果/ 和/ 实际/ 实验/ 结果表明/ FASS/ 能/ 在/ 仅/ 增加/ 可容忍/ 的/ 时延/ Page10/ 情况/ 下/ ,/ 有效/ 减少/ 模块/ 能耗/ ./ 负载/ 较/ 重为/ 3.6/ Gbps/ (/ 原型/ 路由器/ 的/ 45/ %/ 负载/ 率/ )/ 时/ ,/ 可以/ 降低/ 60.83/ %/ 的/ 功耗/ ,/ 伴随/ 1.26/ ms/ 的/ 时延/ 增加/ ./ 对于/ 一般/ 负载/ 小于/ 1.2/ Gbps/ (/ 原型/ 路由器/ 的/ 15/ %/ 负载/ 率/ )/ 时/ ,/ 可以/ 节约/ 89.6/ %/ 以上/ 的/ 能耗/ ,/ 伴随/ 小于/ 2.92/ ms/ 的/ 时延/ 增加/ ./ 

