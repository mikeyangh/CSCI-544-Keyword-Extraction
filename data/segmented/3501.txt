Page1/ 云/ 环境/ 下/ 优化/ 科学/ 工作/ 流/ 执行/ 性能/ 的/ 两/ 阶段/ 数据/ 放置/ 与/ 任务调度/ 策略/ 刘少伟/ 1/ )/ 孔令梅/ 2/ )/ 任开军/ 1/ )/ 宋君强/ 1/ )/ 邓/ 科峰/ 1/ )/ 冷/ 洪泽/ 1/ )/ 1/ )/ (/ 国防科学技术大学/ 计算机/ 学院/ 长沙/ 410073/ )/ 2/ )/ (/ 中国人民解放军/ 78046/ 部队/ 成都/ 610011/ )/ 摘要/ 云/ 环境/ 中/ 跨/ 数据中心/ 科学/ 工作/ 流/ 的/ 高效/ 执行/ 通常/ 面临/ 数据/ 交互/ 量/ 大/ 的/ 问题/ ./ 文中/ 给出/ 基于/ 相关度/ 的/ 两/ 阶段/ 高效/ 数据/ 放置/ 策略/ 和/ 任务调度/ 策略/ :/ 即/ 在/ 工作/ 流/ 建立/ 阶段/ 根据/ 数据/ 依赖/ 关系/ 图/ 把/ 关系/ 紧密/ 型/ 数据/ 集/ 尽可能/ 放置/ 到/ 同一/ 数据中心/ ;/ 而后/ 任务调度/ 策略/ 在/ 运行/ 阶段/ 将/ 任务调度/ 到/ 数据/ 依赖/ 最大/ 的/ 数据中心/ 执行/ ,/ 并/ 将/ 新/ 产生/ 数据/ 集/ 放置/ 到/ 相关度/ 最高/ 的/ 数据中心/ ./ 实验/ 表明/ ,/ 该/ 策略/ 能/ 有效/ 减少/ 跨/ 数据中心/ 科学/ 工作/ 流/ 执行/ 时/ 的/ 数据传输/ 量/ ,/ 从而/ 能/ 有效/ 提升/ 科学/ 工作/ 流/ 的/ 执行/ 效率/ ,/ 并/ 能/ 减少/ 资源/ 的/ 租赁/ 费用/ ./ 关键词/ 云/ 计算/ ;/ 科学/ 工作/ 流/ ;/ 数据/ 放置/ ;/ 数据/ 相关/ ;/ 任务调度/ 1/ 引言/ 在/ 众多/ 科学研究/ 领域/ 中/ ,/ 例如/ 高能物理/ 学/ 、/ 生物/ 信息学/ 、/ 大气/ 科学/ 等/ ,/ 科学计算/ 过程/ 往往/ 由/ 成千上万/ 个/ 步骤/ 构成/ ,/ 这/ 往往/ 需要/ 对/ TB/ 甚至/ PB/ 量级/ 的/ 数据/ 进行/ 分析/ 和/ 处理/ ./ 在/ 过去/ ,/ 科学家/ 通常/ 使用/ 简单/ 的/ 方法/ (/ 例如/ Perl/ 脚本语言/ )/ 编排/ 任务/ 以及/ 管理/ 数据/ ,/ 但是/ 这种/ 方式/ 不仅/ 耗时/ 而且/ 容易/ 出错/ ./ 针对/ 这一/ 问题/ ,/ 科学/ 工作/ 流/ 系统/ [/ 1/ ]/ 开始/ 受到/ 关注/ 并/ 被/ 用来/ 进行/ 自动化/ 科学/ 任务/ 的/ 编排/ 、/ 执行/ 、/ 监控/ 以及/ 追踪/ [/ 2/ ]/ ./ 随着/ 问题/ 求解/ 规模/ 的/ 增大/ ,/ 当今/ 大型/ 科学/ 工作/ 流/ 通常/ 需要/ 在/ 复杂/ 的/ 分布式/ 计算机系统/ 上/ 执行/ ,/ 例如/ 超级计算机/ 、/ 分布式/ 集群/ 系统/ 以及/ 网格/ 系统/ 等/ ./ 然而/ ,/ 构造/ 这样/ 的/ 系统/ 往往/ 需要/ 付出/ 异常/ 昂贵/ 的/ 代价/ ,/ 申请/ 访问/ 这些/ 系统/ 也/ 需要/ 复杂/ 耗时/ 的/ 过程/ ./ 云/ 计算/ [/ 3/ ]/ 技术/ 提供/ 共享/ 基础架构/ 的/ 方法/ ,/ 它/ 通过/ 虚拟/ 技术/ 将/ 分布/ 在/ 不同/ 地理位置/ 的/ 计算资源/ 和/ 存储资源/ 虚拟/ 成/ 一个/ 资源/ 池/ ,/ 用户/ 需要/ 使用/ 时/ 申请/ 资源/ ,/ 使用/ 完成/ 后/ 释放/ 资源/ ,/ 从而/ 使得/ 资源/ 可以/ 重复/ 利用/ ./ 通过/ 这种/ 方式/ ,/ 云/ 计算中心/ 可以/ 提供/ 高性能/ 的/ 计算资源/ 和/ 海量/ 的/ 存储资源/ ,/ 而且/ 成本/ 低廉/ ,/ 使用/ 简单/ ./ 随着/ 云/ 计算技术/ 的/ 深入/ 发展/ 和/ 不断/ 成熟/ ,/ 其/ 高效/ 、/ 灵活/ 、/ 可/ 定制/ 的/ 特点/ 为/ 解决/ 科学/ 工作/ 流/ 运行/ 过程/ 中/ 遇到/ 的/ 难题/ 提供/ 了/ 一种/ 新思路/ ./ 许多/ 地理/ 上/ 分离/ 的/ 科学研究/ 机构/ 都/ 有/ 单独/ 的/ 私有/ 云/ ,/ 每个/ 私有/ 云/ 都/ 可以/ 提供/ 一部分/ 存储资源/ 和/ 计算资源/ ,/ 可以/ 将/ 它们/ 看作/ 是/ 独立/ 的/ 数据中心/ ,/ 这些/ 数据中心/ 通过/ 互联网/ 技术/ 形成/ 更大/ 的/ 云/ 计算/ 平台/ ./ 研究/ 人员/ 使用/ 该/ 平台/ 时/ ,/ 需要/ 将/ 数据/ 集上/ 传到/ 云/ 计算/ 平台/ ./ 由于/ 数据/ 集/ 规模/ 可能/ 非常/ 庞大/ 、/ 数据中心/ 之间/ 存在/ 带宽/ 限制/ 且/ 部分/ 数据/ 集/ 只能/ 存放/ 于/ 指定/ 的/ 数据中心/ ,/ 研究/ 人员/ 不/ 可能/ 将/ 所有/ 数据/ 集上/ 传到/ 同一/ 数据中心/ 或/ 为/ 每个/ 数据中心/ 上传/ 所有/ 数据/ 集/ ,/ 而/ 需要/ 将/ 不同/ 数据/ 集/ 分别/ 上/ 传到/ 不同/ 数据中心/ ,/ 从而/ 使得/ 科学/ 工作/ 流/ 的/ 多个/ 子/ 任务/ 可以/ 并行执行/ ./ 由于/ 科学/ 工作/ 流/ 任务/ 间/ 存在/ 较强/ 的/ 数据/ 依赖/ 关系/ ,/ 其/ 执行/ 往往/ 需要/ 频繁/ 对/ 跨/ 数据中心/ 的/ 数据/ 集/ 进行/ 传输/ 和/ 访问/ ,/ 不合理/ 的/ 数据/ 放置/ 和/ 任务调度/ 策略/ 容易/ 导致/ 数据中心/ 间/ 数据传输/ 量/ 和/ 访问/ 量过大/ ,/ 一方面/ 增加/ 用户/ 使用/ 云/ 资源/ 的/ 费用/ 外/ ,/ 另一方面/ 也/ 严重/ 影响/ 了/ 科学/ 工作/ 流/ 的/ 执行/ 效率/ ,/ 因此/ 研究/ 基于/ 云/ 环境/ 的/ 高效/ 数据/ 放置/ 策略/ 和/ 任务调度/ 策略/ 对/ 减少/ 跨/ 数据中心/ 数据传输/ 量/ 、/ 提升/ 科学/ 工作/ 流/ 执行/ 性能/ 、/ 减少/ 用户/ 费用/ 等/ 方面/ 具有/ 重要/ 意义/ ./ 但是/ ,/ 现阶段/ 已有/ 方法/ 还/ 不能/ 很/ 好/ 解决/ 这一/ 问题/ ,/ 我们/ 在/ 相关/ 工作/ 中/ 给予/ 了/ 详细分析/ ./ 本文/ 通过/ 分析/ 科学/ 工作/ 流/ 数据/ 集/ 之间/ 的/ 依赖/ 关系/ 、/ 数据/ 集/ 和/ 数据中心/ 之间/ 的/ 相关度/ 以及/ 任务/ 和/ 数据中心/ 之间/ 的/ 相关度/ ,/ 提出/ 了/ 一种/ 云/ 平台/ 下/ 基于/ 相关度/ 的/ 两/ 阶段/ 高效/ 数据/ 放置/ 策略/ ./ 该/ 策略/ 首先/ 根据/ 数据/ 依赖/ 关系/ 图/ 在/ 工作/ 流/ 建立/ 阶段/ 将/ 关系/ 紧密/ 的/ 数据/ 集/ 放置/ 到/ 同一个/ 数据中心/ ,/ 将/ 关系/ 松散/ 的/ 数据/ 集/ 放置/ 在/ 不同/ 数据中心/ ,/ 这样/ 保持/ 了/ 不同/ 数据中心/ 数据/ 集/ 之间/ 的/ 低/ 耦合/ 性/ 和/ 同一/ 数据中心/ 数据/ 集/ 之间/ 的/ 高/ 内聚性/ ;/ 之后/ 任务调度/ 策略/ 在/ 运行/ 阶段/ 将/ 任务调度/ 到/ 数据/ 依赖/ 最大/ 的/ 数据中心/ 执行/ ,/ 并/ 将/ 新/ 产生/ 数据/ 集/ 放置/ 到/ 相关度/ 最高/ 的/ 数据中心/ ./ 实验/ 表明/ ,/ 本文/ 提出/ 的/ 策略/ 不但/ 极大/ 地/ 减少/ 了/ 数据中心/ 间/ 的/ 数据/ 移动/ 量/ ,/ 提高/ 了/ 工作/ 流/ 任务/ 的/ 并行执行/ 效率/ ,/ 同时/ 也/ 节省/ 了/ 用户/ 的/ 云/ 资源/ 使用/ 费用/ ./ 本文/ 的/ 贡献/ 主要/ 表现/ 在/ 以下/ 几个/ 方面/ :/ 在/ 科学/ 工作/ 流/ 建立/ 阶段/ ,/ 提出/ 了/ 基于/ 数据/ 依赖/ 的/ 初始化/ 数据/ 布局/ 方法/ ,/ 充分/ 挖掘/ 数据/ 相关性/ ,/ 使得/ 数据/ 布局/ 尽可能/ 的/ 符合/ 使用/ 规则/ ,/ 同一个/ 任务/ 所/ 需/ 数据/ 集/ 最/ 大规模/ 地/ 聚集/ 在/ 一个/ 数据中心/ ;/ 在/ 科学/ 工作/ 流/ 运行/ 阶段/ ,/ 提出/ 一种/ 相应/ 的/ 任务调度/ 策略/ ,/ 将/ 任务调度/ 到/ 所/ 需/ 数据/ 集/ 规模/ 最大/ 的/ 数据中心/ 上/ ,/ 减少/ 数据中心/ 之间/ 的/ 数据传输/ 量/ ,/ 加快/ 科学/ 工作/ 流/ 执行/ 速度/ ./ 针对/ 任务/ 执行/ 过程/ 中/ 产生/ 的/ 中间/ 数据/ 集/ ,/ 本文/ 利用/ 数据/ 集/ 之间/ 的/ 关系/ ,/ 通过/ 量化/ 计算/ 将/ 它们/ 放置/ 到/ 合适/ 的/ 数据中心/ ,/ 使得/ 后续/ 的/ 任务调度/ 与/ 执行/ 能够/ 快速/ 展开/ ./ 本文/ 第/ 2/ 节/ 介绍/ 相关/ 工作/ ,/ 说明/ 本/ 研究/ 的/ 意义/ 以及/ 与/ 相关/ 工作/ 的/ 差异/ ;/ 第/ 3/ 节/ 介绍/ 科学/ 工作/ 流在/ 云/ 环境/ 下/ 的/ 执行/ 流程/ ,/ 并/ 给出/ 相关/ 的/ 符号/ 定义/ ,/ 然后/ 分析/ 数据/ 放置/ 策略/ 需要/ 考虑/ 的/ 各种因素/ ;/ 第/ 4/ 节/ 详细/ 阐述/ 基于/ 相关度/ 的/ 两/ 阶段/ 数据/ 放置/ 策略/ ;/ 第/ 5/ 节/ 通过/ 模拟实验/ 将/ 本/ 策略/ 与/ 其它/ 数据/ 放置/ 策略/ 进行/ 了/ 对比/ ,/ 并/ 对/ 结果/ 进行/ 了/ 详细分析/ ;/ 第/ 6/ 节对/ 全文/ 进行/ 总结/ 并/ 对/ 以后/ 的/ 研究/ 方向/ 进行/ 展望/ ./ 2/ 相关/ 工作/ 科学/ 工作/ 流/ 的/ 数据/ 放置/ 是/ 一个/ 非常/ 重要/ 且/ 富有/ 挑战性/ 的/ 问题/ ,/ 目前/ 已有/ 部分/ 学者/ 对此/ 进行/ 了/ 研究/ 与/ 探索/ ./ 现有/ 科学/ 工作/ 流/ 一般/ 都/ 有/ 自身/ 所属/ 的/ 数据/ 管理系统/ ,/ 如/ Pegasus/ 工作/ 流/ 系统/ 使用/ 的/ 数据/ 放置/ Page3/ 策略/ [/ 4/ -/ 5/ ]/ :/ 它/ 首先/ 预先/ 分配/ 数据/ 到/ 执行/ 任务/ 的/ 计算/ 单元/ ,/ 这样/ 可以/ 加快/ 任务/ 的/ 执行/ 速度/ ,/ 降低/ 任务/ 等待时间/ ;/ 然后/ 动态/ 地/ 删除/ 那些/ 不会/ 被/ 后续/ 任务/ 使用/ 的/ 数据/ ,/ 以/ 减少/ 存储/ 开销/ ./ 但/ 这种/ 策略/ 只是/ 保证/ 了/ 数据传输/ 的/ 可靠性/ 和/ 有效性/ ,/ 并/ 没有/ 考虑/ 到/ 云/ 计算环境/ 下/ 因为/ 数据/ 交互/ 引起/ 的/ 跨/ 数据中心/ 之间/ 的/ 传输/ 开销/ ./ 为了/ 减少/ 数据传输/ 开销/ ,/ 文献/ [/ 6/ ]/ 采用/ 副本/ 机制/ ,/ 它/ 使用/ 改进/ 后/ 的/ 贪婪/ 算法/ 和/ 经过/ 优化/ 的/ 遗传算法/ 计算/ 副本/ 的/ 最佳/ 放置/ 策略/ ,/ 并/ 利用/ 基于/ Web/ 服务/ 的/ 数据/ 网络系统/ ADPPS/ (/ AstronomyDataProcessingPipelineSystem/ )/ 产生/ 工作/ 流/ 来/ 进行/ 实验/ 验证/ ./ 但/ 数据/ 集/ 副本/ 机制/ 增加/ 了/ 存储/ 开销/ ,/ 该/ 策略/ 主要/ 针对/ 网络/ 环境/ 下多/ 节点/ 之间/ 的/ 数据传输/ 而/ 非/ 针对/ 云/ 计算/ 平台/ 上/ 多/ 数据中心/ 之间/ 的/ 数据传输/ ,/ 并/ 没有/ 考虑/ 到/ 数据/ 之间/ 存在/ 相关性/ 和/ 依赖/ 关系/ ./ 另外/ 一些/ 研究/ 对/ 数据/ 依赖/ 进行/ 了/ 分析/ ,/ 如/ BitDew/ [/ 7/ ]/ 由/ 用户/ 定义数据/ 间/ 的/ 依赖/ 关系/ ,/ 但/ 并/ 没有/ 利用/ 数据/ 间/ 的/ 依赖/ 关系/ 减少/ 传输/ 开销/ ./ Gu/ 等/ 人/ [/ 8/ ]/ 设计/ 和/ 实现/ 一种/ 分布式文件系统/ Sector/ // Sphere/ ,/ 系统/ 中/ 数据/ 集是/ 规模/ 庞大/ 的/ 若干/ 未/ 分块/ (/ non/ -/ block/ )/ 的/ 文件/ 集合/ ;/ Sphere/ 通过/ 设置/ 目录/ 和/ 文件/ 树/ 将/ 文件/ 按照/ 数据/ 局部性/ 原则/ 聚合起来/ ,/ 同时/ 使用/ 高速传输/ 协议/ UDT/ [/ 9/ ]/ 和/ 文件/ 副本/ 减少/ 传输/ 延迟/ ,/ 实验/ 结果表明/ ,/ 该/ 系统/ 比/ Hadoop/ ①/ 处理/ 数据/ 要/ 快/ 2/ ~/ 4/ 倍/ ,/ 但/ Sphere/ 只是/ 根据/ 任务/ 来/ 聚集/ 数据/ ,/ 并/ 没有/ 对/ 数据/ 之间/ 的/ 关系/ 进行/ 仔细分析/ 利用/ ./ Nephele/ 项目/ [/ 10/ ]/ 是/ 现有/ 的/ 第一个/ 数据处理/ 框架/ ,/ 注重/ 发掘/ 在/ 任务/ 的/ 调度/ 、/ 执行/ 过程/ 中/ IaaS/ 云/ 环境/ 下/ 资源/ 的/ 动态分配/ ,/ 有效/ 地/ 减少/ 了/ 资源/ 使用/ 开销/ ,/ 却/ 没有/ 减少/ 数据传输/ 开销/ ./ 值得注意/ 的/ 是/ ,/ 以上/ 的/ 几种/ 数据管理/ 策略/ 均/ 不适/ 用于/ 云/ 计算环境/ 下/ 数据/ 密集型/ 的/ 工作/ 流/ ./ 针对/ 云/ 计算环境/ 下/ 数据/ 密集型/ 科学/ 工作/ 流/ 问题/ ,/ Yuan/ 等/ 人/ 在/ 文献/ [/ 11/ ]/ 中/ 提出/ 了/ 一种/ 基于/ 聚类/ 矩阵/ 的/ 数据/ 放置/ 策略/ ,/ 用于/ 多/ 数据中心/ 之间/ 数据/ 集/ 的/ 放置/ ./ 该/ 方法/ 的/ 数据/ 放置/ 策略/ 分为/ 两步/ ,/ 在/ 科学/ 工作/ 流/ 建立/ 阶段/ ,/ 先/ 利用/ 所有/ 数据/ 集/ 之间/ 的/ 关系/ 构建/ 一个/ 相关度/ 矩阵/ ,/ 然后/ 通过/ BEA/ 算法/ 对/ 相关度/ 矩阵/ 进行/ 变换/ 得到/ 聚类/ 矩阵/ ,/ 然后/ 通过/ 该/ 矩阵/ 将/ 所有/ 数据/ 集/ 划分/ 为/ K/ 个/ 集合/ ,/ 每/ 一个/ 集合/ 内部/ 的/ 数据/ 集都/ 是/ 高/ 内聚/ 的/ ,/ 集合/ 之间/ 的/ 数据/ 集则/ 是/ 低/ 耦合/ 的/ ;/ 在/ 科学/ 工作/ 流/ 执行/ 阶段/ ,/ 在/ 考虑/ 存储/ 条件/ 满足/ 的/ 情况/ 下/ ,/ 新/ 产生/ 的/ 数据/ 集/ 被/ 放置/ 在/ 与/ 它/ 相关度/ 最大/ 的/ 数据中心/ 上/ ./ 实验/ 表明/ ,/ 该/ 方法/ 可以/ 有效/ 减少/ 跨/ 数据中心/ 之间/ 的/ 数据/ 移动/ 次数/ ./ 但/ 这种/ 方法/ 并未/ 考虑/ 移动/ 的/ 数据/ 大小/ ,/ 如果/ 移动/ 次数/ 较/ 少/ ,/ 但/ 所/ 移动/ 的/ 数据/ 太/ 大/ ,/ 传输/ 开销/ 不/ 一定/ 降低/ ,/ 导致/ 科学/ 工作/ 流/ 的/ 执行/ 效率/ 反而/ 下降/ ./ 3/ 科学/ 工作/ 流/ 形式化/ 描述/ 和/ 问题/ 分析/ 3.1/ 相关/ 模型/ 和/ 符号/ 定义/ 和/ 参数/ 模型/ ./ 我们/ 首先/ 形式化/ 定义/ 了/ 科学/ 工作/ 流/ 的/ 运行/ 环境/ 定义/ 1/ ./ 数据中心/ 设为/ DC/ =/ ∪/ i/ =/ 1/ ,/ 2/ ,/ …/ {/ dci/ }/ ,/ 其中/ ,/ dci/ =/ 〈/ capi/ ,/ csi/ ,/ λ/ ini/ 〉/ 表示/ 编号/ 为/ i/ 的/ 数据中心/ ,/ capi/ 表示/ dci/ 的/ 计算能力/ ,/ 并用/ 执行/ 同一/ 任务/ 所/ 需/ 的/ 时间/ 的/ 倒数/ 来/ 量化/ 表示/ ,/ 并/ 假设/ 该值/ 保持/ 不变/ ;/ csi/ 表示/ dci/ 的/ 存储空间/ 大小/ ;/ λ/ ini/ 表示/ 在/ 科学/ 工作/ 流/ 建立/ 阶段/ ,/ 数据中心/ 可以/ 使用/ 的/ 存储空间/ 的/ 比例/ [/ 11/ ]/ ./ 因为/ 科学/ 工作/ 流/ 执行/ 过程/ 中/ 产生/ 的/ 中间/ 数据/ 有/ 可能/ 规模/ 庞大/ ,/ 因此/ 在/ 原始数据/ 分配/ 阶段/ 要/ 留有/ 一定/ 的/ 空间/ 来/ 存储/ 中间/ 数据/ ,/ 所以/ 0/ </ λ/ ini/ </ 1/ ./ λ/ ini/ 是/ 一个/ 经验值/ ,/ 它/ 的/ 大小/ 取决于/ 科学/ 工作/ 流/ 的/ 性质/ ./ 定义/ 2/ ./ 原始数据/ 集设/ 为/ DSini/ =/ {/ d1/ ,/ d2/ ,/ d3/ …/ }/ 表示/ 在/ 科学/ 工作/ 流/ 建立/ 时所/ 存在/ 的/ 数据/ 集/ ,/ 即/ 所有/ 原始/ 输入/ ./ 中间/ 数据/ 集设/ 为/ DSgen/ =/ {/ d1/ ,/ d2/ ,/ d3/ …/ }/ ,/ 表示/ 在/ 科学/ 工作/ 流/ 执行/ 过程/ 中/ 所/ 产生/ 的/ 数据/ 集/ ./ 固定/ 数据/ 集和非/ 固定/ 数据/ 集/ 分别/ 设为/ FD/ 和/ NFD/ ./ FD/ 表示/ 必须/ 放置/ 在/ 固定/ 数据中心/ 的/ 数据/ 集/ ,/ 这/ 是因为/ 某些/ 数据/ 需要/ 特定/ 数据中心/ 的/ 特定/ 设备/ 才能/ 处理/ ,/ 或者/ 某些/ 数据/ 具有/ 私有/ 性/ 和/ 产权/ 性/ ./ NFD/ 表示/ 没有/ 固定/ 数据中心/ 的/ 数据/ 集/ ,/ 这是/ 相对/ FD/ 而言/ 的/ ./ 定义/ 3/ ./ T/ =/ {/ t1/ ,/ t2/ ,/ t3/ …/ }/ 表示/ 在/ 科学/ 工作/ 流/ 上/ 运行/ 的/ 任务/ 集/ ,/ 每/ 一个/ 任务/ 执行/ 都/ 需要/ 若干/ 数据/ 集/ 作为/ 输入/ ./ 定义/ 4/ ./ di/ =/ 〈/ Ti/ ,/ si/ ,/ dci/ ,/ fix/ _/ flag/ ,/ depLink/ 〉/ 表示/ 科学/ 工作/ 流中/ 编号/ 为/ i/ 的/ 数据/ 集/ ./ 其中/ Ti/ =/ {/ t1/ ,/ t2/ ,/ t3/ …/ }/ 表示/ 使用/ di/ 的/ 任务/ 集合/ ;/ si/ 表示/ 数据/ 集/ 的/ 大小/ ;/ dci/ 表示/ di/ 所/ 对应/ 的/ 数据中心/ ;/ fix/ _/ flag/ 为/ true/ 表示/ di/ 是/ 固定/ 数据/ ,/ 反之/ 则/ 为/ 非/ 固定/ 数据/ ;/ depLink/ 是/ 一个/ 链表/ ,/ 将/ 在/ 定义/ 5/ 中/ 详细/ 解释/ ./ 3.2/ 实例/ 分析/ 与/ 问题/ 说明/ 科学/ 工作/ 流在/ 云/ 平台/ 中/ 的/ 运行/ 过程/ 可以/ 分为/ 以/ ①/ Hadoop/ ,/ http/ :/ // // hadoop/ ./ apache/ ./ org/ // (/ accessed2011/ ./ 07.04/ )/ Page4/ 下/ 几步/ :/ (/ 1/ )/ 地理/ 上/ 分布/ 在/ 不同/ 地区/ 的/ 若干/ 数据中心/ 构成/ 了/ 科学/ 工作/ 流/ 运行/ 的/ 云/ 计算环境/ ;/ (/ 2/ )/ 使用者/ 运行/ 科学/ 工作/ 流/ 时/ ,/ 需要/ 向云/ 平台/ 申请/ 资源/ ,/ 并/ 对/ 云/ 平台/ 进行/ 定制/ ;/ (/ 3/ )/ 使用者/ 获取/ 了/ 所/ 需要/ 的/ 运行/ 平台/ 后/ ,/ 上传/ 输入/ 数据/ 并/ 设置/ 科学/ 工作/ 流/ 的/ 运行/ 方式/ ;/ (/ 4/ )/ 在/ 科学/ 工作/ 流/ 的/ 建立/ 阶段/ ,/ 按照/ 特定/ 的/ 数据/ 放置/ 策略/ 将/ 使用者/ 的/ 输入/ 数据/ 集/ 放置/ 在/ 合适/ 的/ 数图/ 1/ 一个/ 简单/ 的/ 科学/ 工作/ 流/ 以图/ 1/ 为例/ ,/ 科学/ 工作/ 流/ 的/ 数据/ 放置/ 策略/ 需要/ 考虑/ 以下几点/ :/ (/ 1/ )/ 数据/ 相关/ 对/ 科学/ 工作/ 流/ 的/ 影响/ ./ 科学/ 工作/ 流/ 运行/ 中/ 数据/ 集/ 和/ 任务/ 之间/ 并/ 不是/ 一对/ 多/ 或者/ 多/ 对/ 一/ 的/ 关系/ ,/ 而是/ 多/ 对/ 多/ 的/ 关系/ ,/ 即/ 一个/ 数据/ 集/ 可能/ 会/ 被/ 多个/ 任务/ 同时/ 使用/ ,/ 一个/ 任务/ 也/ 可能/ 调用/ 多个/ 数据/ 集/ ./ 从图/ 1/ (/ a/ )/ 中/ 可以/ 看出/ ,/ {/ d1/ ,/ d2/ }/ 同时/ 被/ 任务/ {/ t1/ ,/ t2/ ,/ t3/ }/ 使用/ ,/ {/ d3/ ,/ d4/ _/ f/ ,/ d6/ }/ 同时/ 被/ 任务/ {/ t4/ }/ 使用/ ,/ {/ d5/ }/ 被/ 任务/ {/ t5/ }/ 使用/ 并且/ 任务/ 执行/ 完毕/ 后/ 会/ 产生/ 一个/ 中间/ 数据/ {/ d6/ }/ ./ 由于/ 移动/ 数据/ 比/ 调度/ 任务/ 代价/ 更大/ ,/ 即/ 相比之下/ 调度/ 任务/ 的/ 开销/ 几乎/ 可以/ 忽略/ ,/ 所以/ 需要/ 将/ 关系/ 紧密/ 的/ 数据/ 集/ 尽量/ 放置/ 到/ 同一个/ 数据中心/ ./ (/ 2/ )/ 数据/ 集/ 大小/ 对/ 科学/ 工作/ 流/ 的/ 影响/ ./ 图/ 1/ (/ b/ )/ 是/ 按照/ 文献/ [/ 11/ ]/ 中/ 的/ 数据/ 放置/ 策略/ 对/ 产生/ 的/ 中间/ 数据/ 集/ {/ d6/ }/ 进行/ 放置/ ./ 因为/ {/ d6/ }/ 和/ {/ d1/ ,/ d2/ }/ 同时/ 被/ 两个/ 任务/ {/ t2/ ,/ t3/ }/ 使用/ ,/ {/ d6/ }/ 和/ {/ d3/ ,/ d4/ _/ f/ }/ 同时/ 被/ 任务/ {/ t4/ }/ 使用/ ,/ 所以/ {/ d6/ }/ 产生/ 后/ 放置/ 在/ dc1/ 上/ ,/ 科学/ 工作/ 流总据/ 中心/ ,/ 然后/ 根据/ 一定/ 的/ 任务调度/ 策略/ 将/ 科学/ 工作/ 流中/ 的/ 子/ 任务调度/ 到/ 合适/ 的/ 数据中心/ 执行/ ;/ (/ 5/ )/ 在/ 科学/ 工作/ 流/ 的/ 执行/ 阶段/ ,/ 大量/ 的/ 任务/ 可能/ 产生/ 大量/ 的/ 中间/ 数据/ 集/ ,/ 这些/ 中间/ 数据/ 集/ 也/ 需要/ 放置/ 到/ 合适/ 的/ 数据中心/ ,/ 直到/ 科学/ 工作/ 流/ 运行/ 完毕/ ./ 图/ 1/ (/ a/ )/ 给出/ 了/ 一个/ 科学/ 工作/ 流/ 的/ 例子/ ,/ 该/ 科学/ 工作/ 流/ 包含/ 5/ 个子/ 任务/ {/ t1/ ,/ t2/ ,/ t3/ ,/ t4/ ,/ t5/ }/ ,/ 5/ 个/ 输入/ 数据/ 集/ {/ d1/ ,/ d2/ ,/ d3/ ,/ d4/ _/ f/ ,/ d5/ }/ 和/ 一个/ 中间/ 数据/ 集/ {/ d6/ }/ ,/ 其中/ {/ d4/ _/ f/ }/ 是/ dc2/ 上/ 的/ 固定/ 数据/ 集/ ,/ 不能/ 移动/ ./ 的/ 数据/ 移动/ 次数/ 是/ 两次/ ./ 图/ 1/ (/ c/ )/ 使用/ 的/ 数据/ 放置/ 策略/ 则/ 将/ {/ d6/ }/ 放在/ dc2/ 上/ ,/ 科学/ 工作/ 流/ 总/ 的/ 数据/ 移动/ 次数/ 是/ 5/ 次/ ./ 但/ 如果/ 考虑/ 数据/ 大小/ ,/ 比如/ {/ d1/ =/ 1MB/ ,/ d2/ =/ 1MB/ ,/ d6/ =/ 30MB/ }/ ,/ 那么/ 图/ 1/ (/ b/ )/ 中/ 数据/ 移动/ 次数/ 虽然/ 是/ 两次/ ,/ 但/ 数据/ 移动/ 量/ 是/ 60MB/ ,/ 而图/ 1/ (/ c/ )/ 的/ 数据/ 移动/ 次数/ 是/ 5/ 次/ ,/ 但/ 数据/ 移动/ 量/ 是/ 34MB/ ,/ 总/ 的/ 数据/ 移动/ 量/ 大幅/ 减少/ ./ 所以/ 数据/ 集/ 大小/ 对于/ 科学/ 工作/ 流/ 的/ 数据/ 放置/ 策略/ 和/ 任务调度/ 有着/ 很大/ 影响/ ./ (/ 3/ )/ 固定/ 数据/ 集对/ 科学/ 工作/ 流/ 的/ 影响/ ./ 因为/ 固定/ 数据/ 集/ 只能/ 放置/ 在/ 特定/ 的/ 数据中心/ ,/ 无法/ 向外/ 传输/ ,/ 一旦/ 任务/ 使用/ 到/ 固定/ 数据/ 集/ ,/ 该/ 任务/ 一定/ 会/ 被/ 调度/ 到/ 这个/ 数据中心/ 上/ 执行/ ./ 如图/ 1/ (/ b/ )/ 、/ (/ c/ )/ 所示/ ,/ t4/ 使用/ 了/ 固定/ 数据/ 集/ d4/ _/ f/ ,/ 所以/ 只能/ 在/ dc2/ 上/ 执行/ ,/ 这/ 不仅/ 影响/ 了/ 原始数据/ 集/ d3/ 的/ 放置/ ,/ 还/ 影响/ 了/ 中间/ 数据/ 集/ d6/ 的/ 放置/ ./ 所以/ 固定/ 数据/ 集/ 通过/ 影响/ 任务调度/ 间接/ 地/ 影响/ 了/ 其它/ 数据/ 集/ 的/ 放置/ ./ (/ 4/ )/ 数据中心/ 的/ 计算能力/ 、/ 存储/ 能力/ 对/ 科学/ 工/ Page5/ 作流/ 的/ 影响/ ./ 由于/ 各个/ 数据中心/ 隶属于/ 不同/ 的/ 组织/ 机构/ ,/ 其/ 计算能力/ 、/ 存储/ 能力/ 可能/ 差异/ 较大/ ./ 合理/ 的/ 数据/ 放置/ 策略/ 也/ 要/ 也/ 要/ 将/ 这/ 两个/ 因素/ 考虑/ 到/ ,/ 即/ 在/ 存储空间/ 足够/ 的/ 前提/ 下/ ,/ 向/ 计算能力/ 强/ 的/ 数据中心/ 放置/ 尽量/ 多/ 的/ 数据/ 集/ ,/ 以/ 加快/ 科学/ 工作/ 流/ 的/ 执行/ 速度/ ./ 由于/ 数据/ 移动/ 开销/ 对/ 科学/ 工作/ 流/ 性能/ 影响/ 较大/ ,/ 因此/ 合理/ 的/ 数据/ 放置/ 策略/ 应该/ 努力/ 减少/ 数据/ 移动/ 量/ ,/ 本文/ 针对/ 这种/ 情况/ 提出/ 了/ 一种/ 基于/ 相关度/ 的/ 数据/ 放置/ 策略/ ,/ 该/ 策略/ 综合/ 考虑/ 了/ 数据/ 相关度/ (/ 即/ 数据/ 之间/ 被/ 相同/ 任务/ 使用/ 的/ 多少/ )/ 、/ 数据/ 大小/ 、/ 固定/ 数据/ 集/ 、/ 数据中心/ 的/ 计算能力/ 和/ 存储/ 能力/ ,/ 有效/ 提升/ 了/ 科学/ 工作/ 流/ 的/ 执行/ 效率/ ./ 4/ 基于/ 相关度/ 的/ 两/ 阶段/ 数据/ 放置/ 与/ 任务调度/ 策略/ 基于/ 相关度/ 的/ 数据/ 放置/ 策略/ 包括/ 建立/ 阶段/ 的/ 数据/ 放置/ 策略/ 和/ 运行/ 阶段/ 的/ 数据/ 放置/ 策略/ 两/ 部分/ ./ 4.1/ 建立/ 阶段/ 数据/ 放置/ 策略/ 在/ 科学/ 工作/ 流/ 建立/ 阶段/ ,/ 该/ 策略/ 对/ 所有/ 的/ 原始/ 输入/ 数据/ 集在/ 逻辑/ 上/ 进行/ 预/ 分配/ ,/ 这样/ 做/ 可以/ 优化/ 数据/ 分配/ 方案/ ,/ 防止/ 前期/ 出现/ 不合理/ 分配/ 的/ 情况/ ./ 预/ 分配/ 主要/ 从/ 局部性/ 考虑/ ,/ 使得/ 子/ 任务/ 在/ 调度/ 后/ ,/ 所/ 需/ 使用/ 的/ 数据/ 集都/ 尽量/ 在/ 本地/ 数据中心/ 上/ 存储/ ./ 预/ 分配/ 首先/ 把/ 所有/ 的/ 数据/ 集/ 分为/ 两类/ :/ 固定/ 数据/ 集/ (/ 有/ 固定/ 数据中心/ 的/ 数据/ 集/ )/ 和/ 非/ 固定/ 数据/ 集/ (/ 无/ 固定/ 数据中心/ 的/ 数据/ 集/ )/ ,/ 然后/ 对非/ 固定/ 数据/ 集中/ 的/ 数据/ 属性/ 进行/ 研究/ ,/ 考虑/ 数据/ 集/ 大小/ 的/ 前提/ 下/ 分析/ 它们/ 之间/ 的/ 数据/ 相关度/ ,/ 然后/ 根据/ 数据中心/ 的/ 计算能力/ 和/ 存储/ 能力/ 对/ 数据/ 集/ 进行/ 预/ 分配/ ./ 所有/ 原始数据/ 集预/ 分配/ 完成/ 以后/ ,/ 根据/ 结果/ 把/ 数据/ 集/ 物理/ 上/ 分配/ 到/ 相应/ 的/ 数据中心/ ./ 在/ 这种/ 方式/ 下/ ,/ 数据/ 相关度/ 大/ 的/ 数据/ 集/ 原则上/ 会分/ 到/ 同一个/ 数据中心/ ,/ 拥有/ 较强/ 计算/ 性能/ 的/ 数据中心/ 原则上/ 能分/ 到/ 更/ 多/ 的/ 数据/ 集/ ./ 假定/ 科学/ 工作/ 流/ 总共/ 使用/ m/ 个/ 数据中心/ ./ 定义/ 5/ ./ 数据/ 集/ 相关度/ [/ 12/ ]/ 设为/ depij/ =/ count/ (/ Ti/ ∩/ Tj/ )/ ×/ min/ {/ si/ ,/ sj/ }/ ,/ di/ ,/ dj/ ∈/ NFD/ 烄/ count/ (/ Ti/ ∩/ Tj/ )/ ×/ si/ ,/ di/ ∈/ NFD/ ,/ dj/ ∈/ FD/ 烅/ count/ (/ Ti/ ∩/ Tj/ )/ ×/ si/ ,/ di/ ∈/ FD/ ,/ dj/ ∈/ NFD0/ ,/ 烆/ 表示/ 数据/ di/ 和/ 数据/ dj/ 的/ 相关度/ 大小/ ,/ 其中/ count/ (/ Ti/ ∩/ Tj/ )/ 表示/ 共同/ 使用/ di/ 和/ dj/ 的/ 任务/ 数量/ ./ depij/ 与/ 数据/ 集/ 大小/ 有关/ ./ 由/ 定义/ 4/ 知/ ,/ 数据/ 集/ di/ 有/ 一个/ 属性/ depLink/ ,/ 此处/ 定义/ 为/ depLink/ (/ i/ )/ =/ {/ 〈/ di/ ,/ depij/ 〉/ |/ j/ ≠/ i/ }/ ,/ 根据/ depij/ 大小/ 形成/ 一个/ 降序/ 链表/ ./ 定义/ 6/ ./ 预/ 分配/ 数据中心/ 设为/ DCk/ ,/ k/ =/ 1/ ,/ 2/ ,/ …/ ,/ m/ ,/ 假定/ DCk/ 的/ 存储空间/ 值为/ 相应/ 的/ dck/ 存储空间/ 大小/ ./ 在/ 科学/ 工作/ 流/ 建立/ 阶段/ ,/ 需要/ 先/ 将/ 原始数据/ 集/ 逻辑/ 上/ 分配/ 到/ DCk/ ,/ k/ =/ 1/ ,/ 2/ ,/ …/ ,/ m/ ,/ 然后/ 按照/ DCk/ →/ dck/ 的/ 映射/ 原则/ ,/ 将/ 逻辑/ 上/ 的/ 分配/ 方案/ 在/ 物理/ 的/ 数据中心/ 上/ 实现/ ./ 定义/ 7/ ./ 待/ 分配/ 数据/ 集/ 集合/ 设为/ DCwait/ ./ 在/ 科学/ 工作/ 流/ 建立/ 阶段/ ,/ 该/ 集合/ 中/ 存放/ 的/ 是/ 与/ 其它/ 任何/ 数据/ 集/ 相关度/ 均/ 为/ 0/ 的/ 数据/ 集/ ;/ 在/ 科学/ 工作/ 流/ 运行/ 阶段/ ,/ 该/ 集合/ 中/ 存放/ 在/ 后续/ 过程/ 中/ 需要/ 分配/ 的/ 数据/ 集/ ./ 有/ 的/ 原始数据/ 进行/ 预/ 分配/ ,/ 其/ 流程/ 大致/ 如下/ :/ 如图/ 2/ 所示/ ,/ 在/ 科学/ 工作/ 流/ 建立/ 阶段/ 需要/ 对/ 所/ 第/ 1/ 步/ (/ 语句/ 1/ ~/ 5/ )/ ./ 算法/ 首先/ 将/ 所有/ 的/ 原始数据/ 分为/ 两类/ ,/ 固定/ 数据/ 集/ FD/ 和/ 非/ 固定/ 数据/ 集/ NFD/ ,/ 由于/ 固定/ 数据/ 集/ 的/ 数据中心/ 是/ 不能变更/ 的/ ,/ 因此/ 可以/ 将/ 它们/ 预/ 分配/ 到/ 相应/ 的/ 逻辑/ 数据中心/ DCk/ ./ 而/ 对于/ 在/ NFD/ 集合/ 中/ 的/ 每/ 一个/ di/ ,/ 按/ 定义/ 5/ 计算/ 与/ 其它/ 所有/ 数据/ 集/ 的/ 相关度/ ,/ 并/ 按照/ 相关度/ 的/ Page6/ 大小/ 降序/ 排列/ ,/ 加入/ 到/ 它/ 的/ 属性/ 链表/ depLink/ 中/ ,/ 链表/ 中/ 第一个/ 元素/ 即/ 是/ 相关度/ 最大/ 的/ 数据/ 集/ ./ 第/ 2/ 步/ (/ 语句/ 6/ ~/ 22/ )/ ./ 判断/ di/ 的/ depLink/ 中/ 相关度/ 最大/ 的/ 数据/ 集/ dj/ 是/ 固定/ 数据/ 集/ 还/ 是非/ 固定/ 数据/ 集/ ./ 如果/ dj/ 是/ 固定/ 数据/ 集且/ 对应/ 的/ 数据中心/ 为/ DCj/ ,/ 若/ 存储空间/ 足够/ 则/ 将/ di/ 预/ 分配/ 到/ DCj/ 上/ ,/ 否则/ dj/ =/ di/ ./ depLink/ →/ next/ ,/ 然后/ 重新/ 分析/ 计算/ ./ 如果/ dj/ 是非/ 固定/ 数据/ 集/ 并且/ 已经/ 分配/ 到/ 数据中心/ DCj/ ,/ 则/ 处理/ 方法/ 同/ 上/ ;/ 如果/ dj/ 是非/ 固定/ 数据/ 集/ 并且/ 还/ 没有/ 分配/ 到/ 数据中心/ ,/ 则/ 根据/ 各个/ 数据中心/ 的/ 计算能力/ 属性/ capi/ ,/ 找出/ 计算能力/ 最强/ 的/ 数据中心/ DCk/ ,/ 若/ 存储空间/ 足够/ 则/ 将/ di/ 预/ 分配/ 到/ DCk/ 上/ ,/ 不足/ 则/ 查找/ 下/ 一个/ 计算能力/ 强/ 的/ 数据中心/ ,/ 直到/ 将/ di/ 放置/ ./ 如果/ 与/ di/ 相关度/ 最大/ 的/ 数据/ 集/ 不/ 存在/ ,/ 即/ 所有/ 的/ 数据/ 集/ 和/ 它/ 的/ 相关度/ 都/ 为/ 0/ ,/ 则/ 将/ di/ 放置/ 到/ DCwait/ 上/ ,/ 等到/ 最后/ 阶段/ 分配/ ./ 第/ 3/ 步/ (/ 语句/ 23/ ~/ 27/ )/ ./ 对/ DCwait/ 中/ 的/ 数据/ 集/ 进行/ 预/ 分配/ ./ 对于/ 每/ 一个/ di/ ∈/ DCwait/ ,/ 根据/ 各个/ 数据中心/ 的/ 计算能力/ 属性/ capi/ ,/ 找到/ 计算能力/ 最强/ 的/ 数据中心/ DCk/ ,/ 存储空间/ 足够/ 则/ 将/ di/ 预/ 分配/ 到/ DCk/ 上/ ,/ 不足/ 则/ 查找/ 下/ 一个/ 计算能力/ 强/ 的/ 数据中心/ ,/ 直到/ 将/ di/ 放置/ 为止/ ./ 预/ 分配/ 完成/ 后/ ,/ 将/ 逻辑/ 数据中心/ DCi/ 中/ 的/ 数据/ 集/ 映射/ 到/ 相应/ 的/ 物理/ 数据中心/ dci/ ,/ 这/ 就/ 实现/ 了/ 科学/ 工作/ 流/ 建立/ 阶段/ 的/ 数据/ 放置/ ./ 4.2/ 运行/ 阶段/ 数据/ 放置/ 与/ 任务调度/ 策略/ 在/ 科学/ 工作/ 流/ 执行/ 阶段/ ,/ 子/ 任务/ 执行/ 可能/ 会/ 产生/ 大量/ 的/ 中间/ 数据/ 集/ ,/ 这些/ 数据/ 集/ 可能/ 被/ 其它/ 或/ 后续/ 的/ 子/ 任务/ 使用/ ,/ 由于/ 这些/ 中间/ 数据/ 集/ 规模/ 可能/ 非常/ 庞大/ ,/ 且/ 数据中心/ 之间/ 存在/ 带宽/ 限制/ ,/ 因此/ 仍/ 需要/ 对/ 这些/ 数据/ 集/ 进行/ 合理/ 放置/ ./ 基于/ 相关度/ 的/ 数据/ 放置/ 策略/ 将/ 中间/ 数据/ 集/ 放置/ 到/ 与/ 它/ 相关度/ 最大/ 的/ 数据中心/ 上/ ,/ 如果/ 该/ 中心/ 存储空间/ 不足/ ,/ 则/ 按照/ 该/ 策略/ 中/ 的/ Adjustment/ 算法/ 对/ 全局/ 数据/ 集/ 进行/ 调整/ ./ dc/ _/ depmk/ =/ ∑/ N/ 据/ 中心/ dcm/ 上/ 数据/ 集/ di/ 所需/ 使用/ 的/ 任务/ 集/ ,/ N/ 表示/ dcm/ 上/ 数据/ 集/ 的/ 个数/ ,/ Tk/ 指/ 使用/ 数据/ 集/ dk/ 的/ 任务/ 集/ 集合/ ,/ sk/ 表示/ 数据/ 集/ dk/ 大小/ ./ 定义/ 9/ ./ 调度/ 任务/ tk/ 在/ 数据中心/ dcm/ 上/ 执行/ 引起/ 的/ 传输/ 开销/ 设为/ transCostmk/ =/ [/ size/ (/ DSk/ )/ -/ size/ (/ DSk/ ∩/ DSm/ )/ +/ size/ (/ DSgen/ -/ DSm/ )/ ]/ ,/ 其中/ size/ (/ DS/ )/ 表示/ 集合/ DS/ 中/ 所有/ 数据/ 集/ 大小/ 之/ 和/ ,/ DSk/ 是/ 任务/ tk/ 所需/ 使用/ 的/ 数据/ 集/ ,/ DSm/ 包含/ 数据中心/ dcm/ 上/ 的/ 所有/ 数据/ 集/ ,/ DSgen/ 表示/ 任务/ tk/ 执行/ 完毕/ 后/ 产生/ 的/ 数据/ 集/ ,/ DSm/ 表示/ DSgen/ 中/ 应该/ 放在/ dcm/ 上/ 的/ 数据/ 集/ ./ 定义/ 8/ ./ 数据/ 集/ dk/ 和/ 数据中心/ dcm/ 的/ 相关度/ 传输/ 开销/ 中/ [/ size/ (/ DSk/ )/ -/ size/ (/ DSk/ ∩/ DSm/ )/ ]/ 表示/ tk/ 在/ dcm/ 上/ 执行/ 需要/ 从/ 其它/ 数据中心/ 调入/ 的/ 数据/ 集/ 大小/ ,/ size/ (/ DSgen/ -/ DSm/ )/ 表示/ tk/ 在/ dcm/ 上/ 执行/ 完毕/ 后/ 产生/ 的/ 中间/ 数据/ 集向/ 其它/ 数据中心/ 发送/ 的/ 数据/ 集/ 大小/ ./ 如果/ transCosthk/ =/ mink/ 到/ dch/ 上/ 执行/ 所/ 引起/ 的/ 传输/ 开销/ 是/ 最低/ 的/ ./ 科学/ 工作/ 流/ 运行/ 阶段/ 数据/ 放置/ 与/ 任务调度/ 算法/ 如图/ 3/ 所示/ ./ 科学/ 工作/ 流/ 运行/ 的/ 时候/ ,/ 从/ 任务/ 集合/ 中/ 选取/ 任务/ ti/ ,/ 根据/ 定义/ 9/ 将/ ti/ 调度/ 到/ 合适/ 的/ 数据中心/ 执行/ ,/ 执行/ 完毕/ 后/ 若/ 产生/ 新/ 的/ 任务/ 和/ 新/ 的/ 数据/ 集/ ,/ 则/ 首先/ 更新/ 任务/ 集合/ ,/ 然后/ 给/ 新/ 产生/ 的/ 数据/ 集/ 选择/ 合适/ 的/ 数据中心/ 放置/ ./ 对/ 新/ 产生/ 的/ 中间/ 数据/ dk/ ,/ 根据/ 定义/ 8/ 计算/ 其/ 与/ 所有/ 数据中心/ 的/ 相关度/ dc/ _/ depmk/ ,/ 选择/ 相关度/ 最大/ 的/ 数据中心/ 分配/ ,/ 如果/ 该/ 数据中心/ 存储空间/ 不足/ ,/ 表明/ 科学/ 工作/ 流/ 已经/ 运行/ 了/ 一段时间/ ,/ 出现/ 了/ 负载/ 不/ 均衡/ ,/ 因此/ 需要/ 对/ 所有/ 数据/ 集/ 进行/ 重新/ 调整/ ./ 调整/ 算法/ 如图/ 4/ 所示/ ,/ 详细/ 过程/ 如下/ :/ 第/ 1/ 步/ (/ 语句/ 1/ ~/ 31/ )/ ./ 对/ 所有/ 数据中心/ 上/ 的/ 数据/ 集/ 进行/ 预/ 分配/ ./ 预/ 分配/ 过程/ 和/ 科学/ 工作/ 流/ 建立/ 阶段/ 算法/ 相似/ ,/ 只/ 在/ 两种/ 特殊/ 情况/ 下/ 略有不同/ ./ 一种/ 情况/ 如/ 语句/ 19/ ~/ 23/ 所示/ ,/ 如果/ 与非/ 固定/ 数据/ 集/ di/ 相关度/ 最大/ 的/ 数据/ 集/ dj/ 未/ 分配/ ,/ 且/ di/ 归属/ 物理/ 数据中心/ dck/ ,/ 则/ 将/ di/ 放置/ 在/ DCk/ 上/ ,/ 若/ di/ 也/ 未/ 分配/ ,/ 则/ 按照/ 数据中心/ 的/ 计算能力/ 为/ di/ 寻找/ 合适/ 的/ 数据中心/ 放置/ ;/ 另/ 一种/ 情况/ 如/ 语句/ 27/ ~/ 30/ 所示/ ,/ 对于/ DCwait/ 中/ 的/ 每/ 一个/ 数据/ 集/ ,/ 处理/ 方法/ 和/ 前/ 一种/ 情况/ 相同/ ./ 第/ 2/ 步/ (/ 语句/ 32/ ~/ 38/ )/ ./ 预/ 分配/ 完成/ 以后/ ,/ 对/ 所有/ 逻辑/ 数据中心/ DCi/ 和/ 物理/ 数据中心/ dci/ 上/ 的/ 每个/ 数据/ 集/ dk/ 进行/ 对比/ :/ 若/ dk/ ∈/ DCi/ 且/ dk/ ∈/ dci/ ,/ 则/ 不/ 需要/ 移动/ ;/ 若/ dk/ ∈/ DCi/ 且/ dk/ ∈/ dcj/ (/ j/ ≠/ i/ )/ ,/ 则/ 将/ dk/ 从/ dcj/ 移动/ 到/ dci/ ./ Page75/ 实验/ 分析/ 5.1/ 实验/ 环境/ 和/ 设置/ 为了/ 验证/ 基于/ 相关度/ 的/ 数据/ 放置/ 策略/ 效果/ ,/ 在/ “/ 天河/ ”/ 集群/ 上/ 建立/ 了/ 一个/ 包含/ 80/ 个/ 节点/ 的/ 测试/ 平台/ ,/ 每/ 一个/ 节点/ 包含/ 一个/ IntelXeonE55402/ ./ 53GHz/ 的/ 四核/ CPU/ ./ 为了/ 模拟/ 云/ 计算/ 平台/ ,/ 在/ 每个/ 节点/ 上/ 安装/ Xen/ 并/ 在/ 上面/ 创建/ 了/ 虚拟/ 集群/ 以/ 模拟/ 数据中心/ ;/ 为/ 每/ 一个/ CPU/ 核/ 创建/ 一个/ 带有/ 存储空间/ 的/ 计算/ 实体/ ,/ 每个/ 数据中心/ 包含/ 16/ 个/ 计算/ 实体/ ,/ 于是/ 共有/ 20/ 个/ 数据中心/ ;/ 为了/ 对/ 数据/ 进行/ 管理/ ,/ 在/ 每个/ 数据中心/ 上/ 安装/ 了/ ApacheHDFS/ ,/ 并/ 运行/ SwinDeW/ -/ C/ (/ SwinburneDecentralisedWorkflowforCloud/ )/ [/ 13/ ]/ 用来/ 解释/ 和/ 执行/ 工作/ 流/ ./ 由于/ 实际/ 的/ 科学/ 工作/ 流/ (/ 如/ 大气/ 科学/ 工作/ 流/ )/ 不能/ 全方位/ 检测/ 基于/ 相关度/ 的/ 数据/ 放置/ 策略/ 策略/ 的/ 效果/ ,/ 只能/ 部分/ 验证/ ,/ 因此/ 本文/ 将/ 采用/ 模拟/ 的/ 、/ 可/ 定制/ 的/ 科学/ 工作/ 流/ 来/ 测试/ 基于/ 相关度/ 的/ 数据/ 放置/ 策略/ ./ 通过/ 分别/ 改变/ 科学/ 工作/ 流/ 的/ 数据/ 集/ 和/ 任务/ 的/ 数量/ 来/ 控制/ 科学/ 工作/ 流/ 的/ 复杂度/ ;/ 通过/ 改变/ 上界/ 与/ 下界/ 来/ 控制数据/ 集/ 大小/ 的/ 取值/ 范围/ ;/ 同样/ ,/ 固定/ 数据/ 集/ 的/ 比例/ 和/ 数据中心/ 的/ 数量/ 也/ 可以/ 进行/ 调整/ ./ 实验/ 过程/ 中/ ,/ 为了/ 保证/ 结果/ 的/ 可靠性/ ,/ 每/ 一个/ 科学/ 工作/ 流在/ 保持/ 配置/ 和/ 云/ 平台/ 环境/ 不变/ 的/ 情况/ 下/ ,/ 运行/ 300/ 次后/ 取/ 平均值/ 作为/ 测试/ 结果/ ./ 为了/ 说明/ 本文/ 所提/ 数据/ 放置/ 策略/ 的/ 效果/ ,/ 实验/ 对比/ 了/ 3/ 种/ 数据/ 放置/ 策略/ ,/ 分别/ 是/ Random/ 、/ Cluster/ 和/ 本文/ 所/ 提出/ 的/ 基于/ 相关度/ 的/ 数据/ 放置/ 策略/ ./ Random/ 策略/ :/ 输入/ 数据/ 集在/ 建立/ 阶段/ 随机/ 的/ 放到/ 其中/ 一个/ 数据中心/ ,/ 如果/ 是/ 固定/ 数据/ 集则/ 放置/ 到/ 指定/ 的/ 数据中心/ ;/ 运行/ 阶段/ ,/ 如果/ 空间/ 足够/ ,/ 产生/ 的/ 中间/ 数据/ 集则/ 存放/ 在/ 本地/ 数据中心/ ,/ 否则/ 随机/ 放置/ 到/ 其中/ 一个/ 数据中心/ ./ 在/ 网格/ 、/ 集群/ 系统/ 中/ ,/ 产生/ 的/ 中间/ 数据/ 集/ 就是/ 存放/ 在/ 本地/ 或者/ 随机/ 放在/ 存储空间/ 富余/ 的/ 结点/ 上/ ./ Cluster/ 策略/ :/ 在/ 文献/ [/ 11/ ]/ 中/ 提到/ 的/ 数据/ 放置/ 策略/ ./ 在/ 建立/ 阶段/ ,/ 把/ 所有/ 的/ 输入/ 数据/ 分为/ K/ 个/ 数据/ 集合/ ,/ 把/ 这/ K/ 个/ 数据/ 集合/ 放置/ 到/ 合适/ 的/ 数据中心/ ;/ 在/ 运行/ 阶段/ ,/ 把/ 新/ 产生/ 的/ 数据/ 集/ 放置/ 到/ 合适/ 的/ 数据中心/ ./ 基于/ 相关度/ 的/ 数据/ 放置/ 策略/ :/ 本文/ 所提/ 的/ 数据/ 放置/ 策略/ ,/ 在/ 文章/ 后续/ 部分/ 所有/ 图示/ 中用/ Data/ -/ dependence/ 表示/ 该/ 策略/ 5.2/ 测试/ 结果/ 及/ 分析/ 5.2/ ./ 1/ 数据/ 集/ 数量/ 变化/ 对/ 结果/ 的/ 影响/ 图/ 5/ 显示/ 的/ 是/ 当/ 数据/ 集/ 数量/ 增加/ 时/ ,/ 数据/ 移动/ 图/ 5/ 数据/ 集/ 数量/ 变化/ 对/ 数据/ 移动/ 次数/ 和/ 移动/ 量/ 的/ 影响/ Page8/ 次数/ 和/ 数据/ 移动/ 量/ 的/ 变化趋势/ ./ 实验/ 设定/ 如下/ :/ 科学/ 工作/ 流/ 任务量/ N/ 和/ 数据/ 集/ 数量/ N/ 取/ 相同/ 的/ 值/ ,/ 数据/ 集/ 的/ 变化/ 范围/ 设为/ 1/ ~/ 500MB/ ,/ 固定/ 数据/ 集/ 比例/ 为/ 20/ %/ ,/ 数据中心/ 为/ 15/ 个/ ./ 实验/ 结果表明/ ,/ 随着/ 数据/ 集/ 数量/ 的/ 增多/ ,/ 本文/ 所/ 使用/ 的/ 策略/ 和/ Cluster/ 策略/ 在/ 数据/ 移动/ 次数/ 上/ 相差无几/ ,/ 相比/ Random/ 策略/ ,/ 数据/ 移动/ 次数/ 明显/ 减少/ ;/ 数据/ 移动/ 量/ 方面/ ,/ 3/ 种/ 策略/ 随着/ 数据/ 集/ 规模/ 增加/ 而/ 呈现出/ 近似/ 的/ 线性/ 增长/ ,/ Random/ 策略/ 效果/ 最差/ ,/ Cluster/ 策略/ 次之/ ,/ 基于/ 相关度/ 的/ 数据/ 放置/ 策略/ 则/ 比/ Cluster/ 策略/ 在/ 数据/ 移动/ 量少/ 约/ 10/ %/ ./ 原因/ 分析/ :/ Cluster/ 策略/ 按照/ 最大/ 数量/ 的/ 原则/ 将/ 数据/ 集/ 聚集/ 在/ 同一个/ 数据中心/ ,/ 而/ 基于/ 相关度/ 的/ 数据/ 放置/ 策略/ 按照/ 最大/ 流量/ 的/ 原则/ 将/ 数据/ 集/ 聚集/ 在/ 同一个/ 数据中心/ ;/ 同时/ ,/ 在/ 运行/ 阶段/ Cluster/ 策略/ 将/ 任务调度/ 到/ 包含/ 数据/ 个/ 数最多/ 的/ 数据中心/ ,/ 基于/ 相关度/ 的/ 数据/ 放置/ 策略/ 则/ 将/ 任务调度/ 到/ 数据量/ 最多/ 的/ 数据中心/ ,/ 所以/ 任务/ 执行/ 时/ ,/ 基于/ 相关度/ 的/ 数据/ 放置/ 策略/ 引起/ 的/ 数据传输/ 量/ 就/ 会/ 明显/ 减少/ ./ 5.2/ ./ 2/ 数据/ 集/ 大小/ 取值/ 范围/ 变化/ 对/ 数据/ 移动/ 量/ 的/ 图/ 6/ 表示/ 数据/ 集/ 大小/ 幅度/ 改变/ 时/ 数据/ 移动/ 量/ 的/ 变化趋势/ ./ 实验/ 设定/ 如下/ :/ 科学/ 工作/ 流/ 任务量/ 为/ 80/ ,/ 数据/ 集/ 数量/ 为/ 80/ ,/ 固定/ 数据/ 集/ 比例/ 为/ 20/ %/ ,/ 数据中心/ 为/ 15/ 个/ ,/ 数据/ 集/ 大小/ 的/ 平均值/ 是/ 250MB/ ./ 图/ 6/ 数据/ 集/ 大小/ 变化/ 幅度/ 对/ 数据/ 移动/ 量/ 的/ 影响/ 实验/ 结果表明/ ,/ 当/ 数据/ 平均值/ 相同/ 时/ ,/ Random/ 和/ Cluster/ 策略/ 的/ 数据/ 移动/ 量/ 变化/ 幅度/ 很小/ ,/ 在/ 某/ 一/ 平均线/ 上下/ 浮动/ ,/ 而/ 基于/ 相关度/ 的/ 数据/ 放置/ (/ Data/ -/ dependence/ )/ 策略/ 则/ 不同/ ,/ 数据/ 集/ 大小/ 的/ 变化/ 幅度/ 越大/ ,/ 数据/ 移动/ 量/ 越少/ ./ 原因/ 分析/ :/ 若/ 数据/ 大小/ 变化/ 幅度/ 很大/ ,/ 则/ Data/ -/ dependence/ 策略/ 在/ 大多数/ 情况/ 下会/ 选择/ 移动/ 规模/ 小/ 的/ 数据/ 集/ ,/ 这样/ 就/ 降低/ 了/ 数据/ 移动/ 量/ ./ 5.2/ ./ 3/ 固定/ 数据/ 集/ 比例/ 的/ 改变/ 对/ 数据/ 移动/ 量/ 的/ 影响/ 图/ 7/ 表出/ 的/ 是/ 固定/ 数据/ 集/ 比例/ 改变/ 时/ 数据/ 的/ 移动/ 量/ 的/ 变化趋势/ ./ 实验/ 设定/ 如下/ :/ 科学/ 工作/ 流/ 任务量/ 为/ 80/ ,/ 数据/ 集/ 个数/ 为/ 80/ ,/ 数据中心/ 为/ 15/ 个/ ,/ 数据/ 集/ 的/ 变化/ 范围/ 是/ 1/ ~/ 500MB/ ./ 实验/ 结果表明/ ,/ 随着/ 固定/ 数据/ 集/ 比例/ 上升/ ,/ 3/ 种/ 策略/ 的/ 数据/ 移动/ 量/ 都/ 是/ 先/ 增后/ 减/ ./ 从图/ 7/ 中/ 可以/ 看出/ Random/ 策略/ 数据/ 移动/ 量/ 最大/ ,/ Cluster/ 比起/ Random/ 策略/ 性能/ 有/ 很大/ 提高/ ,/ 而/ 相比/ Cluster/ ,/ 当/ 固定/ 数据/ 集/ 比例/ 超过/ 15/ %/ 后/ Data/ -/ dependence/ 策略/ 又/ 有/ 较大/ 提高/ ./ 原因/ 分析/ :/ 随着/ 固定/ 数据/ 集/ 比例/ 的/ 上升/ ,/ 因为/ 固定/ 数据/ 集/ 的/ 因素/ ,/ 某些/ 任务/ 只能/ 调度/ 到/ 特定/ 数据中心/ 执行/ ,/ 如果/ 这些/ 任务/ 使用/ 了/ 非/ 固定/ 数据/ 集/ ,/ 那么/ 非/ 固定/ 数据/ 集/ 的/ 移动/ 次数/ 会/ 不断/ 上升/ ,/ 导致/ 传输/ 的/ 开销/ 逐渐/ 增大/ ,/ 导致/ 3/ 种/ 数据/ 放置/ 策略/ 的/ 数据/ 移动/ 量/ 都/ 呈上升/ 趋势/ ;/ 当/ 固定/ 数据/ 集/ 达到/ 一定/ 比例/ 后/ ,/ 非/ 固定/ 数据/ 集/ 的/ 数量/ 越来越少/ ,/ 3/ 种/ 数据/ 放置/ 策略/ 传输/ 开销/ 都/ 在/ 减少/ ./ 在/ Data/ -/ dependence/ 策略/ 中/ ,/ 若/ 任务/ 中/ 存在/ 固定/ 数据/ 集/ ,/ 则/ 该/ 任务/ 中/ 使用/ 的/ 非/ 固定/ 数据/ 集/ 很/ 有/ 可能/ 与/ 固定/ 数据/ 集/ 放置/ 在/ 同一个/ 数据中心/ ,/ 相比/ Cluster/ 明显/ 减少/ 了/ 数据/ 移动/ 量/ ./ 5.2/ ./ 4/ 数据中心/ 数量/ 变化/ 对/ 数据/ 移动/ 量/ 的/ 影响/ 图/ 8/ 给出/ 的/ 是/ 当/ 数据中心/ 数量/ 改变/ 时/ 数据/ 移动/ Page9/ 量/ 的/ 变化趋势/ ./ 实验/ 设定/ 如下/ :/ 科学/ 工作/ 流/ 任务量/ 为/ 80/ ,/ 数据/ 集/ 数量/ 为/ 80/ ,/ 固定/ 数据/ 集/ 比例/ 20/ %/ ,/ 数据/ 集/ 的/ 变化/ 范围/ 是/ 1/ ~/ 500MB/ ./ 实验/ 结果表明/ ,/ 随着/ 数据中心/ 数量/ 的/ 增多/ ,/ 3/ 种/ 策略/ 的/ 数据/ 移动/ 量/ 都/ 在/ 逐步/ 上升/ ./ 可以/ 明显/ 看出/ ,/ Random/ 效果/ 最差/ ,/ Data/ -/ dependence/ 策略/ 比起/ Cluster/ 也/ 有/ 很大/ 的/ 性能/ 提升/ ./ 原因/ 分析/ :/ 随着/ 数据中心/ 数量/ 的/ 增多/ ,/ 平均/ 每个/ 数据中心/ 分得/ 的/ 数据/ 集将/ 减少/ ,/ 任务/ 执行/ 时/ 调用/ 其它/ 数据中心/ 数据/ 集/ 的/ 可能性/ 增加/ ,/ 导致/ 数据传输/ 量/ 上升/ ./ Data/ -/ dependence/ 策略/ 要/ 优于/ Cluster/ 策略/ ,/ 再次/ 表明/ 考虑/ 数据/ 集/ 大小/ 的/ 计算/ 调度/ 方式/ 可以/ 减少/ 数据传输/ 流量/ ./ 5.3/ 小结/ 当/ 数据/ 集/ 的/ 变化/ 范围/ 为/ 1/ ~/ 500MB/ 、/ 固定/ 数据/ 集/ 比例/ 为/ 20/ %/ 及/ 数据中心/ 为/ 15/ 时/ ,/ 随着/ 数据/ 集/ 数量/ 的/ 增多/ ,/ 本文/ 所/ 使用/ 的/ 基于/ 相关度/ 的/ 数据/ 放置/ (/ Data/ -/ dependence/ )/ 策略/ 相比/ Cluster/ 策略/ 在/ 数据/ 移动/ 量/ 方面/ 减少/ 约/ 10/ %/ ;/ 当/ 任务量/ 为/ 80/ 、/ 数据/ 集/ 数量/ 为/ 80/ 、/ 固定/ 数据/ 集/ 比例/ 为/ 20/ %/ 、/ 数据中心/ 为/ 15/ 及/ 数据/ 集/ 大小/ 的/ 平均值/ 是/ 250MB/ 时/ ,/ Random/ 策略/ 和/ Cluster/ 策略/ 的/ 数据/ 移动/ 量/ 分别/ 在/ 50GB/ 和/ 40GB/ 上下/ 浮动/ ,/ 而/ 基于/ 相关度/ 的/ 数据/ 放置/ 策略/ 的/ 数据/ 移动/ 量/ 则/ 呈/ 递减/ 趋势/ ,/ 数据/ 集/ 大小/ 上/ 下限/ 之差/ 每/ 增大/ 100MB/ ,/ 数据/ 移动/ 量减少/ 2/ %/ ~/ 3/ %/ ;/ 当/ 任务量/ 为/ 80/ 、/ 数据/ 集/ 个数/ 为/ 80/ 、/ 数据中心/ 为/ 15/ 及/ 数据/ 集/ 的/ 变化/ 范围/ 是/ 1/ ~/ 500MB/ 时/ ,/ Cluster/ 比起/ Random/ 策略/ 数据/ 移动/ 量/ 有/ 了/ 大幅度/ 减少/ ,/ 而/ 相比/ Cluster/ 策略/ ,/ 基于/ 相关度/ 的/ 数据/ 放置/ 策略/ 在/ 固定/ 数据/ 集/ 比例/ 在/ 15/ %/ ~/ 40/ %/ 时/ ,/ 数据/ 移动/ 量减少/ 约/ 10/ %/ ~/ 11/ %/ ;/ 当/ 任务量/ 为/ 80/ 、/ 数据/ 集/ 数量/ 为/ 80/ 、/ 固定/ 数据/ 集/ 比例/ 20/ %/ 及/ 数据/ 集/ 的/ 变化/ 范围/ 是/ 1/ ~/ 500MB/ 时/ ,/ 随着/ 数据中心/ 数量/ 的/ 增加/ ,/ 基于/ 相关度/ 的/ 数据/ 放置/ 策略/ 比起/ Cluster/ 策略/ 在/ 数据/ 移动/ 量/ 上/ 减少/ 7/ %/ ~/ 11.5/ %/ ,/ 而且/ 随着/ 数据中心/ 数量/ 的/ 不断/ 增多/ ,/ 这个/ 比率/ 将/ 持续增长/ ./ 综合/ 以上/ 实验/ 结果/ ,/ 基于/ 相关度/ 的/ 数据/ 放置/ 策略/ 在/ 降低/ 数据传输/ 开销/ 方面/ 要/ 明显/ 优于/ Cluster/ 策略/ 和/ Random/ 策略/ ./ 所以/ ,/ 基于/ 相关度/ 的/ 数据/ 放置/ 策略/ 可以/ 有效/ 提高/ 科学/ 工作/ 流/ 的/ 执行/ 效率/ ./ 6/ 结论/ 与/ 展望/ 本文/ 首先/ 对/ 科学/ 工作/ 流在/ 云/ 平台/ 上/ 的/ 执行/ 过程/ 做出/ 了/ 分析/ ,/ 指出/ 了/ 多个/ 数据中心/ 之间/ 的/ 数据传输/ 开销/ 是/ 制约/ 科学/ 工作/ 流/ 执行/ 性能/ 的/ 一个/ 瓶颈/ ,/ 并/ 在/ 此基础/ 上/ 提出/ 了/ 一种/ 基于/ 相关度/ 的/ 数据/ 放置/ 策略/ ,/ 该/ 策略/ 综合/ 考虑/ 数据/ 相关/ 、/ 数据/ 集/ 大小/ 、/ 固定/ 数据/ 集/ 比例/ 及/ 数据中心/ 计算能力/ ./ 通过/ 与/ 其它/ 数据/ 放置/ 策略/ 进行/ 实验/ 对比/ ,/ 结果表明/ 这种/ 数据/ 放置/ 策略/ 可以/ 有效/ 提升/ 科学/ 工作/ 流/ 的/ 执行/ 效率/ ,/ 减少/ 跨/ 数据中心/ 之间/ 的/ 数据传输/ 流量/ ./ 下/ 一步/ 准备/ 在/ 本文/ 工作/ 的/ 基础/ 上/ 进行/ 副本/ 机制/ 的/ 研究/ ./ 注意/ 到/ 云/ 计算/ 平台/ 收费/ 的/ 特点/ ,/ 在/ 综合/ 考虑/ 计算/ 代价/ 和/ 存储/ 代价/ 的/ 基础/ 上/ 加入/ 副本/ 机制/ ,/ 进一步/ 提升/ 科学/ 工作/ 流/ 的/ 执行/ 性能/ ./ 

