Page1/ 一种/ 提高/ 时序/ 安全/ 属性/ 静态/ 检测/ 实用性/ 的/ 方法/ 霍玮/ 1/ )/ 李丰/ 1/ )/ ,/ 2/ )/ 丁兆伟/ 1/ )/ 桑/ 春雷/ 1/ )/ ,/ 2/ )/ 张兆庆/ 1/ )/ 冯晓兵/ 1/ )/ 1/ )/ (/ 中国科学院计算技术研究所/ 计算机/ 体系结构/ 国家/ 重点/ 实验室/ 北京/ 100190/ )/ 2/ )/ (/ 中国科学院/ 研究生院/ 北京/ 100049/ )/ 摘要/ 程序/ 时序/ 安全/ 属性/ 可以/ 用/ 有限/ 状态/ 自动机/ (/ FSM/ )/ 来/ 描述/ ,/ 对/ 该/ 属性/ 的/ 静态/ 检测/ 是/ 当前/ 研究/ 的/ 热点/ 之一/ ./ 该文/ 提出/ 了/ FSM/ 切片/ 技术/ ,/ 以/ 需求/ 驱动/ 的/ 模式/ 抽取/ 出/ 关于/ 时序/ 安全/ 属性/ 等价/ 的/ 程序/ 切片/ ./ 该/ 切片/ 使/ 检测/ 规模/ 减小/ 、/ 程序结构/ 简化/ ,/ 因而/ 减小/ 了/ 检测/ 中/ 组合/ 爆炸/ 情形/ 出现/ 的/ 机会/ ,/ 最终/ 使/ 时序/ 安全/ 属性/ 的/ 静态/ 检测/ 在/ 准确性/ 和/ 可伸缩性/ 上/ 都/ 得到/ 了/ 提高/ ./ 实验/ 表明/ ,/ FSM/ 切片/ 可以/ 使/ Saturn/ 的/ 可伸缩性/ 平均/ 提高/ 到/ 原来/ 的/ 6.34/ 倍/ ,/ 使/ Fastcheck/ 的/ 准确性/ 平均/ 提高/ 到/ 原来/ 的/ 1.20/ 倍/ ./ 关键词/ 有限/ 状态/ 自动机/ ;/ 时序/ 安全/ 属性/ ;/ 切片/ 技术/ ;/ 程序/ 静态/ 检测/ ;/ F/ -/ 衡量/ 1/ 引言/ 当今/ 软件系统/ 已经/ 逐渐/ 深入/ 到/ 社会/ 的/ 各个领域/ ,/ 软件/ 的/ 正确性/ 问题/ 得到/ 人们/ 的/ 广泛/ 关注/ ,/ 成为/ 一个/ 研究/ 的/ 热点/ ./ 使用/ 自动化/ 的/ 程序/ 静态/ 检测工具/ 辅助/ 程序开发/ 是/ 提高/ 软件/ 正确性/ 的/ 有效/ 方法/ 之一/ ./ 当前/ ,/ 对于/ 程序/ 静态/ 检测工具/ 的/ 研究/ 取得/ 了/ 很大/ 的/ 进/ Page2/ 展/ ,/ 产生/ 了/ 很多/ 优秀/ 的/ 成果/ ./ 根据/ 其/ 使用/ 的/ 典型/ 技术/ 不同/ ,/ 可以/ 将/ 这些/ 工具/ 粗略/ 的/ 分为/ 三大类/ :/ 扩展/ 静态/ 检测器/ (/ extendedstaticchecker/ )/ [/ 1/ -/ 2/ ]/ 、/ 软件/ 模型/ 检测器/ (/ softwaremodelchecker/ )/ [/ 3/ -/ 4/ ]/ 和/ 程序/ 静态/ 分析器/ (/ programstaticanalyzer/ )/ [/ 5/ -/ 6/ ]/ ./ 程序/ 的/ 时序/ 安全/ 属性/ 具有/ 非常/ 广泛/ 的/ 描述/ 能力/ ,/ 可以/ 描述/ 计算机/ 软硬件/ 资源/ 的/ 安全/ 使用/ 规则/ (/ 比如/ 内存/ 、/ 文件/ 或锁/ 等/ )/ ,/ 也/ 可以/ 描述/ 软件系统/ 中/ 的/ 编程/ 规则/ [/ 3/ ,/ 7/ ]/ 等/ ./ 所以/ ,/ 对于/ 程序/ 时序/ 安全/ 属性/ 的/ 检测/ 是/ 程序/ 静态/ 检测/ 领域/ 的/ 重要/ 研究课题/ ./ 通常/ ,/ 可以/ 使用/ 有限/ 状态/ 自动机/ (/ FSM/ )/ 来/ 描述/ 程序/ 的/ 时序/ 安全/ 属性/ ./ 定义/ 1/ (/ 有限/ 状态/ 自动机/ )/ ./ M/ 是/ 一个/ 五元/ 组/ :/ M/ =/ (/ Q/ ,/ Σ/ ,/ δ/ ,/ q0/ ,/ F/ )/ ./ 其中/ ,/ Q/ 为/ 状态/ 的/ 非空/ 有限/ 集合/ ;/ Σ/ 是/ 动作/ 集合/ ;/ δ/ 是/ 状态/ 转移/ 函数/ ,/ δ/ :/ Q/ ×/ Σ/ →/ Q/ ;/ q0/ 是/ M/ 的/ 初始状态/ ;/ F/ 是/ M/ 的/ 终止/ 状态/ 集合/ ./ 图/ 1/ 和/ 图/ 2/ 分别/ 给出/ 了/ 使用/ 有限/ 状态/ 自动机/ 描述/ 的/ 关于/ 文件/ 操作/ 规则/ 和/ 内存/ 操作/ 规则/ 的/ 时序/ 安全/ 属性/ (/ 双线/ 框/ 状态/ 表示/ 终止/ 状态/ )/ ./ 目前/ 已有/ 很多/ 静态/ 检测工具/ 可以/ 检测/ 程序/ 的/ 时序/ 安全/ 属性/ ,/ 其中/ 具有/ 代表性/ 的/ 有/ 软件/ 模型/ 检测器/ SLAM/ [/ 3/ ]/ 、/ BLAST/ [/ 4/ ]/ ;/ 程序/ 静态/ 分析器/ Saturn/ [/ 5/ ]/ 、/ Fastcheck/ [/ 6/ ]/ 、/ ESP/ [/ 8/ ]/ 、/ MYGCC/ [/ 9/ ]/ 等等/ ./ 虽然/ 这些/ 工具/ 使用/ 的/ 技术/ 不同/ ,/ 但/ 一般/ 从/ 检测/ 的/ 准确性/ (/ precision/ )/ 和/ 可伸缩性/ (/ scalability/ )/ 两/ 方面/ 来/ 衡量/ 它们/ 的/ 水平/ ./ 实际上/ ,/ 检测/ 的/ 准确性/ 和/ 可伸缩性/ 是/ 一对/ 矛盾/ ./ 为了/ 获得/ 更/ 高/ 的/ 检测/ 准确性/ ,/ 就/ 需要/ 使用/ 更/ 高精度/ 的/ 程序/ 分析/ ,/ 这/ 就/ 会/ 增加/ 分析/ 的/ 时空/ 开销/ ,/ 在/ 最坏/ 情况/ 下/ 可能/ 导致/ 指数/ 级/ 的/ 增加/ ,/ 使得/ 检测/ 的/ 可伸缩性/ 受到/ 很大/ 限制/ ./ 所以/ 上述/ 工具/ 在/ 准确性/ 和/ 可伸缩性/ 上/ 进行/ 了/ 不同/ 的/ 权衡/ ./ 然而/ ,/ 由于/ 工具/ 在/ 检测/ 的/ 过程/ 中/ 没有/ 充分利用/ 程序/ 信息/ ,/ 它们/ 在/ 准确性/ 和/ 可伸缩性/ 上/ 都/ 存在/ 提高/ 的/ 空间/ ./ 对于/ BLAST/ 、/ Saturn/ 等/ 高/ 准确性/ 的/ 检测工具/ ,/ 它们/ 在/ 使用/ 高精度/ 的/ 程序/ 分析/ 技术/ (/ 比如/ 路径/ 敏感/ 分析/ )/ 时/ ,/ 由于/ 没有/ 利用/ 检测/ 的/ 相关性/ 而/ 导致/ 分析/ 的/ 时空/ 开销/ 代价/ 过高/ ,/ 使得/ 它们/ 的/ 可伸缩性/ 受到/ 很大/ 影响/ ;/ 对于/ Fastcheck/ 、/ MYGCC/ 等/ 高/ 可伸缩性/ 的/ 检测工具/ ,/ 它们/ 在/ 追求/ 高效/ 、/ 高可/ 伸缩/ 时/ ,/ 由于/ 不/ “/ 安全/ ”/ 地/ 使用/ 保守/ 的/ 数据流/ 信息/ ,/ 甚至/ 没有/ 使用/ 数据流/ 信息/ ,/ 从而/ 降低/ 了/ 它们/ 的/ 准确性/ ./ 针对/ 以上/ 问题/ ,/ 本文/ 提出/ 了/ FSM/ 切片/ 技术/ ,/ 使得/ 程序/ 时序/ 安全/ 属性/ 的/ 静态/ 检测/ 在/ 准确性/ 和/ 可伸缩性/ 两/ 方面/ 都/ 得到/ 了/ 显著/ 提高/ ,/ 并/ 获得/ 了/ 更好/ 的/ 平衡/ ./ 不同于/ 传统/ 的/ 切片/ 标准/ ,/ 该/ 技术/ 使用/ 有限/ 状态/ 自动机/ 作为/ 切片/ 标准/ ,/ 以/ 需求/ 驱动/ 的/ 模式/ 利用/ 切片/ 技术/ 提取/ 出/ 部分/ 原程序/ ,/ 使得/ 切片/ 后/ 程序/ 与/ 原程序/ 关于/ 时序/ 安全/ 属性/ 具有/ 语义/ 等价/ 性/ ./ 由于/ 程序/ 切片/ 减小/ 了/ 待/ 检测/ 程序/ 的/ 规模/ ,/ 从而/ 提高/ 了/ 检测/ 的/ 可伸缩性/ ;/ 更/ 重要/ 的/ 是/ ,/ 程序/ 切片/ 简化/ 了/ 待/ 检测/ 程序/ 的/ 结构/ ,/ 特别/ 是/ 降低/ 了/ 复杂/ 程序结构/ 对/ 程序/ 分析/ 复杂度/ 的/ 影响/ ,/ 减少/ 了/ 检测/ 中/ 组合/ 爆炸/ 情形/ 出现/ 的/ 机会/ ,/ 因而/ 提高/ 了/ 分析/ 的/ 精度/ ,/ 最终/ 提高/ 了/ 检测/ 的/ 准确性/ ./ 实验/ 表明/ ,/ 使用/ FSM/ 切片/ 技术/ 可以/ 使/ Saturn/ 的/ 可伸缩性/ 在/ 最好/ 情况/ 下/ 提高/ 到/ 原来/ 的/ 1314/ 倍/ ,/ 平均/ 提高/ 到/ 原来/ 的/ 6.34/ 倍/ ;/ 使/ Fastcheck/ 的/ 准确性/ 在/ 最好/ 情况/ 下/ 提高/ 到/ 原来/ 的/ 2.19/ 倍/ ,/ 平均/ 提高/ 到/ 原来/ 的/ 1.20/ 倍/ ./ 本文/ 第/ 2/ 节/ 给出/ 研究/ 的/ 动机/ 和/ 示例/ ;/ 第/ 3/ 节/ 给出/ FSM/ 切片/ 的/ 定义/ 和/ 计算/ FSM/ 切片/ 的/ 算法/ ;/ 第/ 4/ 节/ 讨论/ FSM/ 切片/ 的/ 实现/ 要点/ ;/ 第/ 5/ 节/ 讨论/ 静态/ 检测/ 中/ 准确性/ 和/ 可伸缩性/ 的/ 衡量标准/ ;/ 第/ 6/ 节对/ FSM/ 切片/ 的/ 作用/ 进行/ 实验/ ;/ 最后/ 是/ 结论/ 以及/ 下/ 一步/ 的/ 工作/ 计划/ ./ 2/ 研究/ 动机/ 及/ 示例/ 下面/ 通过/ 分析/ 典型/ 程序/ 静态/ 检测工具/ 检测/ 的/ 工作/ 过程/ ,/ 讨论/ 这些/ 工具/ 存在/ 的/ 问题/ ,/ 并/ 展示/ FSM/ 切片/ 技术/ 在/ 提高/ 检测/ 准确性/ 和/ 可伸缩性/ 上/ 的/ 作用/ ./ 考虑/ 使用/ Saturn/ 对图/ 3/ (/ a/ )/ 中/ 代码/ 进行/ 内存/ 时序/ 安全/ 属性/ 检测/ ./ 该段/ 代码/ 来源于/ SPECCPU2000/ 中/ 的/ ammp/ 并/ 稍作/ 简化/ ./ Saturn/ 的/ 工作/ 流程/ 是/ :/ 首先/ 对/ 源程序/ 进行/ 建模/ ;/ 然后/ 对/ 编码/ 后/ 的/ 程序/ 进行/ 路/ Page3/ 径/ 敏感/ 的/ 指针/ 分析/ ,/ 并/ 将/ 结果/ 记录/ 在/ 带/ 路径/ 信息/ 的/ 位置/ 集合/ ①/ 中/ ;/ 最后/ 根据/ 检测/ 目标/ 文件/ 指定/ 的/ 步骤/ 完成/ 检测/ ./ 其中/ 后/ 两个/ 步骤/ 占/ 检测/ 总/ 时间/ 的/ 90/ %/ 以上/ ./ 这段/ 大约/ 1067/ 行/ 的/ 程序/ (/ 包含/ 空行/ )/ ,/ 含有/ 大量/ 的/ 循环/ 和/ 分支/ 语句/ ./ 由于/ Saturn/ 在/ 检测/ 含有/ 循环/ 的/ 代码/ 时/ ,/ 会/ 将/ 循环展开/ 有限/ 次/ ,/ 然后/ 再/ 简化/ 成/ 分支/ 语句/ 进行/ 检测/ ./ 所以/ 根据/ 我们/ 的/ 统计/ ,/ 这/ 段/ 代码/ 大约/ 含有/ 4/ 亿/ 多条/ 程序/ 路径/ ./ 由于/ 路径/ 数量/ 太过/ 巨大/ ,/ 使得/ Saturn/ 中/ 路径/ 敏感/ 的/ 指针/ 分析/ 和/ 对/ 错误/ 路径/ 的/ 符号执行/ 这/ 两步/ 都/ 无法/ 在/ 设定/ 的/ 时间/ 和/ 空间/ 内/ (/ 100s/ 处理器/ 时间/ 和/ 512MB/ 内存/ )/ 完成/ ,/ 最终/ 使得/ Saturn/ 图/ 3/ 代码/ 示例/ 考虑/ 使用/ Fastcheck/ 检测/ 图/ 3/ (/ b/ )/ 中/ 代码/ ./ 该/ 工具/ 使用/ 基于/ 值流/ 分析/ 的/ 检测/ 技术/ ./ 它/ 首先/ 利用/ 定值/ 引用/ 分析/ 给/ 全/ 程序/ 建立/ 值流图/ ,/ 然后/ 使用/ 上下文/ 敏感/ 的/ 切片/ 技术/ 计算/ 出值/ 流/ 切片/ 并/ 对/ 该/ 切片/ 进行/ (/ 部分/ )/ 路径/ 可行性/ 分析/ 来/ 完成/ 检测/ ./ 但是/ 为了/ 提高/ 可伸缩性/ ,/ 它/ 的/ 定值/ 引用/ 分析/ 是/ 基于/ 流/ 不/ 敏感/ 、/ 上下文/ 不/ 敏感/ 指针/ 分析/ (/ Steensgaard/ 指针/ 分析/ )/ 的/ 结果/ ,/ 在/ 这样/ 建立/ 的/ 值/ 流图/ 中/ 可能/ 会/ 存在/ 伪值/ 流/ 关系/ (/ 即定值/ 引用/ 关系/ 与/ 控制流/ 关系/ 不符/ )/ ,/ 将/ 导致/ 检测/ 的/ 准确性/ 降低/ ./ 对于/ 该段/ 代码/ ,/ 语句/ 10/ 使得/ 指针/ 分析/ 分析/ 出/ 指针/ f/ 和/ g/ 别名/ ,/ 于是/ 在/ 值/ 流图/ (/ (/ b/ )/ 图下/ 半部/ ,/ 节点/ 中/ 标出/ 其/ 对应/ 的/ 语句/ 号/ )/ 中/ 使用/ 一个/ 节点/ 表示/ (/ 阴影/ 节点/ )/ ./ 由于/ 语句/ 9/ 对/ 该/ 节点/ 代表/ 的/ 变量/ 进行/ 定值/ 而/ 语句/ 3/ 对/ 该/ 节点/ 代表/ 的/ 变量/ 进行/ 引用/ ,/ 这样/ 在/ 值/ 流图/ 上会/ 存在/ 由/ 语句/ 9/ 到/ 语句/ 3/ 的/ 值流/ 关系/ ,/ 这个/ 值流/ 关系/ 是/ 违反/ 了/ 控制流/ 顺序/ 的/ 伪值/ 流/ 关系/ ./ 但/ 它/ 的/ 无法/ 完成/ 对/ 该段/ 代码/ 的/ 检测/ ./ 实际上/ 程序/ 中/ 大部分/ 的/ 循环/ 和/ 分支/ 语句/ 并/ 不/ 影响/ 对/ 该段/ 代码/ 进行/ 时序/ 安全/ 属性/ 静态/ 检测/ 的/ 结果/ ,/ 如图/ 中/ 循环/ 和/ 分支/ 语句/ 所示/ ,/ 所以/ 可以/ 使用/ FSM/ 切片/ 技术/ 简化/ 该段/ 代码/ ,/ 只/ 保留/ 与/ 检测/ 相关/ 的/ 语句/ ./ 这样/ 经过/ 切片/ 预处理/ 后/ ,/ 该段/ 代码/ 只/ 含有/ 约/ 26/ 万条/ 程序/ 路径/ ,/ 路径/ 减少/ 了/ 99.9/ %/ 以上/ ./ 使用/ Saturn/ 检测/ 切片/ 后/ 的/ 程序/ ,/ 不仅/ 可以/ 完成/ 检测/ ,/ 而且/ 能够/ 准确/ 地/ 报告/ 出/ 这段/ 代码/ 关于/ 内存/ 的/ 时序/ 安全/ 属性/ 是/ 正确/ 的/ ./ 可见/ ,/ FSM/ 切片/ 技术/ 可以/ 提高/ Saturn/ 检测/ 时序/ 安全/ 属性/ 的/ 准确性/ 和/ 可伸缩性/ ./ 1/ ./ FILE/ / f/ ;/ 2/ ./ voidmyclose/ (/ )/ {/ 3/ ./ fclose/ (/ f/ )/ ;/ 4/ ./ }/ 5/ ./ voidmain/ (/ )/ {/ 6/ ./ FILE/ / g/ ;/ 7/ ./ f/ =/ fopen/ (/ )/ ;/ 8/ ./ myclose/ (/ )/ ;/ 9/ ./ g/ =/ fopen/ (/ )/ ;/ 10/ ./ f/ =/ g/ ;/ 11/ ./ }/ 存在/ 使得/ Fastcheck/ 认为/ 语句/ 9/ 打开/ 的/ 文件/ 在/ 程序/ 结束/ 前/ 由/ 语句/ 3/ 关闭/ ,/ 从而/ 产生/ 漏报/ ./ 使用/ 切片/ 预处理/ 后/ ,/ 语句/ 10/ 由于/ 与/ 检测/ 语句/ 9/ 打开/ 的/ 文件/ 是否/ 关闭/ 无关/ 而/ 被/ 切除/ ,/ 这样/ 消除/ 了/ 由于/ f/ 和/ g/ 别名/ 带来/ 的/ 伪值/ 流/ 影响/ ,/ 使得/ Fastcheck/ 可以/ 正确/ 地/ 检测/ 出/ 语句/ 9/ 打开/ 的/ 文件/ 指针/ 在/ 程序/ 结束/ 前/ 泄漏/ ,/ 从而/ 在/ 提高/ Fastcheck/ 的/ 可伸缩性/ 的/ 同时/ 提高/ 了/ Fast/ -/ check/ 的/ 准确性/ ./ 考虑/ 使用/ BLAST/ 检测/ 图/ 3/ (/ c/ )/ 中/ 的/ 代码/ ./ 该/ 代码/ 是/ BLAST/ 相关/ 文章/ 中/ 常用/ 示例/ ./ BLAST/ 是/ 典型/ 的/ 软件/ 模型/ 检测器/ ,/ 它/ 使用/ 的/ 是/ 反例/ 制导/ 的/ 抽象/ 精化/ (/ counter/ -/ exampleguidedabstractionrefinement/ )/ 检测/ 机制/ ./ 该/ 机制/ 的/ 主要/ 流程/ 是/ :/ 首先/ 根据/ 初始/ 谓词/ 对/ 程序/ 进行/ 抽象/ (/ 即/ 谓词/ 抽象/ )/ ,/ 该/ 步骤/ 需要/ 定理/ 证/ ①/ GuardedlocationsetsPage4/ 明器/ 的/ 支持/ ,/ 是/ 检测/ 过程/ 中/ 主要/ 的/ 时间/ 开销/ 之一/ ;/ 然后/ 在/ 抽象/ 的/ 程序/ 上/ (/ 一般/ 为/ 布尔/ 程序/ )/ 检测/ 程序/ 的/ 时序/ 安全/ 属性/ ./ 如果/ 没有/ 发现错误/ 则/ 证明/ 原程序/ 正确/ ;/ 如果/ 发现错误/ ,/ 则/ 根据/ 抽象/ 程序/ 中/ 的/ 错误/ 路径/ 在/ 原程序/ 上/ 找到/ 对应/ 的/ 程序/ 路径/ ,/ 并且/ 判断/ 该/ 路径/ 的/ 可行性/ ,/ 这个/ 步骤/ 需要/ 符号执行/ ,/ 也/ 是/ 检测/ 过程/ 中/ 主要/ 的/ 时间/ 开销/ 之一/ ./ 如果/ 该/ 路径/ 可行/ ,/ 则/ 报告/ 该/ 错误/ ;/ 如果/ 路径/ 不/ 可行/ ,/ 则/ 根据/ 不/ 可行/ 的/ 原因/ 修改/ 谓词/ ,/ 然后/ 再/ 进入/ 谓词/ 抽象/ 阶段/ ,/ 重复/ 上述/ 过程/ ./ 基于/ 这个/ 机制/ ,/ BLAST/ 在/ 检测/ 图/ 3/ (/ c/ )/ 中/ 代码/ 时/ ,/ 为了/ 发现/ 在/ 语句/ 2/ 中/ 条件/ 为/ 假/ 的/ 情况/ 下/ 语句/ 10/ 是否/ 可/ 达/ ,/ 需要/ 依次/ 地/ 发现/ 1000/ 个/ 谓词/ {/ i/ =/ =/ 0/ }/ ,/ {/ i/ =/ =/ 1/ }/ ,/ {/ i/ =/ =/ 2/ }/ ,/ …/ ,/ {/ i/ =/ =/ 999/ }/ (/ 即/ 进行/ 谓词/ 抽象/ 1000/ 次/ )/ ,/ 直到/ 当/ {/ i/ / 1000/ }/ 时/ 才能/ 在/ 抽象/ 程序/ 中/ 发现/ 一条/ 可以/ 到达/ 语句/ 10/ 的/ 可能/ 路径/ ./ 找到/ 该/ 路径/ 在/ 原程序/ 中/ 对应/ 的/ 路径/ 〈/ 2/ ,/ 4/ ,/ 5/ ,/ 6/ ,/ 7/ ,/ …/ 5/ ,/ 6/ ,/ 长度/ 为/ 3005/ 的/ 路径/ 上/ 进行/ 符号执行/ ,/ 计算/ 得到/ 路径/ 条件/ 为/ {/ a/ / 0/ ∧/ a/ </ 0/ }/ ,/ 所以/ 这/ 条/ 路径/ 不/ 可行/ ,/ 语句/ 10/ 在/ 语句/ 2/ 中/ 条件/ 为/ 假时/ 不可/ 达/ ./ 然而/ 从/ 需求/ 驱动/ 的/ 角度/ 考虑/ ,/ 语句/ 10/ 是否/ 可/ 达/ 直接/ 取决于/ 语句/ 9/ 中/ 条件/ 是否/ 为/ 真/ ./ 而/ 语句/ 9/ 对/ 语句/ 4/ 、/ 5/ 、/ 6/ 、/ 7/ 既/ 没有/ 控制/ 依赖/ ,/ 也/ 没有/ 数据/ 依赖/ ,/ 所以/ 语句/ 9/ 中/ 条件/ 的/ 值/ 与/ 语句/ 4/ 、/ 5/ 、/ 6/ 、/ 7/ 无关/ ./ 这/ 正是/ 切片/ 技术/ 可以/ 给出/ 的/ 结论/ ./ 所以/ 经/ 切片/ 预处理/ 后/ ,/ BLAST/ 对/ 语句/ 1/ 、/ 2/ 、/ 3/ 、/ 9/ 、/ 10/ 、/ 11/ 组成/ 的/ 程序/ 切片/ 进行/ 验证/ 可以/ 得到/ 相同/ 的/ 结论/ ,/ 但是/ 可以/ 避免/ 上述/ 步骤/ ,/ 从而/ 在/ 保持/ BLAST/ 检测/ 准确性/ 的/ 同时/ ,/ 提高/ 它/ 的/ 可伸缩性/ ./ 综上/ 可见/ ,/ 使用/ 切片/ 技术/ 对/ 程序/ 进行/ “/ 预处理/ ”/ 后/ ,/ 不仅仅/ 使得/ 程序/ 的/ 规模/ 减少/ ,/ 而且/ 使得/ 检测工具/ 可以/ 仅/ 对/ 与/ 检测/ 目标/ 相关/ 的/ 程序/ 部分/ 进行/ 重量级/ 的/ 程序/ 分析/ ,/ 最大/ 程度/ 地/ 避免/ 无关/ 程序/ 部分/ 特别/ 是/ 可能/ 导致/ 组合/ 爆炸/ 的/ 程序/ 成分/ (/ 如/ 分支/ 、/ 上下文/ 等/ )/ 对/ 程序/ 分析/ 时空/ 开销/ 的/ 影响/ ,/ 从而/ 有效/ 地/ 缓和/ 了/ 分析/ 精度/ 和/ 效率/ 的/ 矛盾/ ,/ 使得/ 检测工具/ 可以/ 达到/ 更/ 高/ 的/ 准确性/ 和/ 可伸缩性/ ./ 3FSM/ 切片/ FSM/ 切片/ 技术/ 是/ 提高/ 程序/ 静态/ 检测/ 准确性/ 和/ 可伸缩性/ 的/ 一个/ 关键技术/ ./ 相对/ 于/ 传统/ 切片/ 技术/ 中/ 使用/ 给定/ 语句/ 的/ 变量/ 作为/ 切片/ 标准/ ,/ FSM/ 切片/ 技术/ 使用/ 描述/ 程序/ 时序/ 安全/ 属性/ 的/ 有限/ 状态/ 自动机/ 作为/ 切片/ 标准/ ./ 同时/ ,/ 与/ 传统/ 程序/ 切片/ 应用/ 于/ 程序调试/ 、/ 测试/ 或/ 理解/ 等/ 不同/ ,/ FSM/ 切片/ 是/ 服务/ 于/ 程序/ 时序/ 安全/ 属性/ 的/ 静态/ 检测/ ./ 所以/ ,/ FSM/ 切片/ 利用/ 了/ 传统/ 切片/ 并/ 与/ 领域/ 知识/ 相结合/ ,/ 是/ 切片/ 技术/ 的/ 拓广/ 和/ 新/ 应用/ ./ 这种/ 新/ 应用/ 也/ 缓解/ 了/ 切片/ 技术/ 的/ 主要/ 问题/ :/ 切片/ 程序/ 往往/ 过大而/ 无法/ 应用/ 于/ 人工/ 分析/ ./ 因为/ FSM/ 切片/ 是/ 服务/ 于/ 自动/ 的/ 程序/ 静态/ 检测/ ,/ 所以/ FSM/ 切片/ 对于/ 原程序/ 任何/ 的/ 减少/ 都/ 直接/ 导致/ 检测时间/ 的/ 减少/ 和/ 可伸缩性/ 的/ 提高/ ./ 并且/ 由于/ 切掉/ 了/ 与/ FSM/ 无关/ 的/ 程序/ 部分/ ,/ 往往/ 还/ 简化/ 了/ 程序结构/ 和/ 复杂/ 的/ 变量/ 关系/ ,/ 从而/ 有利于/ 提高/ 检测/ 的/ 准确性/ ./ 本文/ 首先/ 给出/ FSM/ 切片/ 的/ 定义/ ,/ 然后/ 讨论/ 计算/ FSM/ 切片/ 的/ 算法/ ./ 3.1/ FSM/ 切片/ 的/ 定义/ 定义/ 2/ (/ FSM/ 切片/ )/ ./ 程序/ P/ 的/ 一个/ FSM/ 切片/ S/ (/ fsm/ )/ 是/ 一个/ 程序/ P/ ,/ 其中/ fsm/ 是/ 给定/ 的/ 时序/ 安全/ 属性/ 描述/ ,/ 并且/ :/ (/ 1/ )/ P/ 是从/ P/ 中/ 删除/ 0/ 条/ 或/ 多条/ 语句/ 获得/ ;/ (/ 2/ )/ 对于/ fsm/ 描述/ 的/ 时序/ 安全/ 属性/ ,/ P/ 是/ P/ 的/ 安全/ 抽象/ ./ 定义/ 3/ (/ 安全/ 抽象/ )/ ./ 给定/ 程序/ 的/ 一个/ 时序/ 安全/ 属性/ p/ ,/ 用/ 有限/ 状态/ 自动机/ M/ =/ (/ Q/ ,/ Σ/ ,/ δ/ ,/ q0/ ,/ F/ )/ 描述/ ,/ 称/ 程序/ P/ 是/ P/ 的/ 安全/ 抽象/ ,/ (/ 1/ )/ 如果/ P/ 中/ 存在/ 路径/ path/ =/ s1/ ,/ s2/ ,/ …/ ,/ sn/ ,/ 使得/ M/ 终止/ 于/ 错误/ 状态/ f/ ∈/ F/ ,/ 则/ 在/ P/ 中/ 存在/ 路径/ path/ =/ s1/ ,/ s2/ ,/ …/ ,/ sm/ 使得/ M/ 的/ 同一/ 实例/ 终止/ 于/ 相同/ 的/ 错误/ 状态/ ;/ 并且/ 设/ path/ 在/ P/ 中/ 的/ 路径/ 条件/ 为/ pc/ ,/ path/ 在/ P/ 中/ 的/ 路径/ 条件/ 为/ pc/ ,/ 则/ pc/ / pc/ ./ (/ 2/ )/ 如果/ P/ 中/ 存在/ 路径/ path/ =/ s1/ ,/ s2/ ,/ …/ ,/ sn/ ,/ 使得/ M/ 终止/ 于/ 正常/ 状态/ f/ ∈/ F/ ,/ 则/ 在/ P/ 中/ 存在/ 路径/ path/ =/ s1/ ,/ s2/ ,/ …/ ,/ sm/ 使得/ M/ 的/ 同一/ 实例/ 终止/ 于/ 相同/ 的/ 正常/ 状态/ ;/ 并且/ 设/ path/ 在/ P/ 中/ 的/ 路径/ 条件/ 为/ pc/ ,/ path/ 在/ P/ 中/ 的/ 路径/ 条件/ 为/ pc/ ,/ 则/ pc/ / pc/ ./ 这里/ 的/ 路径/ 条件/ 是/ 指/ :/ 对于/ 给定/ 的/ 程序/ 路径/ p/ ,/ 通过/ 符号执行/ 得到/ 它/ 的/ 一组/ 关于/ 变量/ 初始值/ 的/ 约束/ ,/ 并且/ p/ 是/ 可行/ 的/ ,/ 当且/ 仅/ 当/ 路径/ 条件/ 可/ 被/ 满足/ ./ 这里/ 使用/ 有限/ 状态/ 自动机/ M/ 的/ 实例/ 这个/ 概念/ ,/ 是因为/ 对于/ 给定/ 的/ 有限/ 状态/ 自动机/ ,/ 一个/ 程序/ 中/ 通常/ 存在/ 多组/ 该/ 自动机/ 的/ 动作/ 语句/ ,/ 为/ 保证/ 检测/ 算法/ 的/ 正确/ 和/ 叙述/ 方便/ ,/ 我们/ 称/ 每组/ 动作/ 语句/ 构成/ 该/ 自动机/ 的/ 一个/ 实例/ ./ 比如/ 给定/ 的/ 时序/ 安全/ 属性/ 为/ 文件/ 操作/ ,/ 则/ 我们/ 称/ 程序/ 中/ 所有/ 与/ 该/ 自动机/ 相关/ 的/ 文件/ 操作/ 函数/ 为/ 动作/ 语句/ ./ 因为/ 程序/ 中/ 每个/ 被/ 操作/ 的/ 文件/ 都/ 应该/ 遵循/ 该/ 安全/ 属性/ ,/ 所以/ 我们/ 首先/ 需要/ 将/ 这些/ 动作/ 语句/ 按照/ 其/ 操作/ 的/ 文件/ 对象/ 进行/ 分组/ (/ 每/ 一组/ 动作/ Page5/ 语句/ 是/ 关于/ 同一个/ 文件/ 的/ 操作/ )/ ,/ 然后/ 对/ 每组/ 动作/ 语句/ 所/ 代表/ 的/ 不同/ 文件/ 操作/ 自动机/ 实例/ 分别/ 进行/ 检测/ ./ 安全/ 抽象/ 指出/ 了/ 如果/ 原程序/ 中/ 存在/ 违反/ 时序/ 安全/ 属性/ 的/ 错误/ ,/ 则/ 该/ 错误/ 也/ 存在/ 于/ 抽象/ 后/ 的/ 程序/ 中/ ;/ 如果/ 原程序/ 中/ 的/ 操作/ 遵守/ 时序/ 安全/ 属性/ ,/ 则/ 抽象/ 后/ 的/ 程序/ 也/ 遵守/ 该/ 属性/ ./ 3.2/ FSM/ 切片/ 的/ 算法/ FSM/ 切片/ 的/ 算法/ 是/ 以/ 文献/ [/ 11/ ]/ 中/ 上下文/ 敏感/ 的/ 过程/ 间/ 切片/ 算法/ 为/ 基础/ 设计/ 的/ ./ 因为/ 相比/ 于/ 传统/ 的/ 切片/ 技术/ ,/ FSM/ 切片/ 的/ 切片/ 标准/ 不是/ 确定/ 程序/ 位置/ 上/ 的/ 程序/ 变量/ 而是/ 描述/ 时序/ 安全/ 属性/ 的/ 有限/ 状态/ 自动机/ ,/ 所以/ 在/ 进行/ FSM/ 切片/ 的/ 过程/ 中/ 首先/ 需要/ 进行/ 有限/ 状态/ 自动机/ 的/ 实例/ 化/ ./ 然后/ 对于/ 每/ 一个/ 自动机/ 实例/ ,/ 以/ 其中/ 的/ 动作/ 语句/ 作为/ 切片/ 标准/ ,/ 使用/ 上下文/ 敏感/ 的/ 过程/ 间/ 切片/ 算法/ ,/ 从而/ 得到/ 这个/ 自动机/ 实例/ 的/ FSM/ 切片/ ./ 3.2/ ./ 1/ 实例/ 化/ 有限/ 状态/ 自动机/ 实例/ 化/ 有限/ 状态/ 自动机/ ,/ 即/ 根据/ 给定/ 有限/ 状态/ 自动机/ 的/ 状态/ 迁移/ 函数/ 找到/ 程序/ 中/ 的/ 所有/ 动作/ 语句/ 并/ 进行/ 分组/ ./ 算法/ 1/ 给出/ 了/ 实例/ 化/ 的/ 算法/ ./ 算法/ 1/ ./ 实例/ 化/ 有限/ 状态/ 自动机/ ./ procedureInstFsm/ (/ P/ ,/ M/ )/ n/ ←/ 1E/ [/ 1/ ../ m/ ]/ ←/ / // // cleararrayEforalle/ :/ q0/ →/ / / / actionq/ ∈/ δ/ doendforfori/ ←/ 1/ ,/ ndoendforreturnEendprocedure/ 该/ 算法/ 分为/ 两步/ ,/ 第/ 1/ 步/ 确定/ 实例/ 化/ 标准/ ./ 对于/ 描述/ 计算机系统/ 软硬件/ 资源/ 操作/ 的/ 有限/ 状态/ 自动机/ ,/ 它/ 的/ 状态/ 迁移/ 函数/ 在/ 程序/ 中/ 对应/ 的/ 动作/ 语句/ 一般/ 是/ 函数调用/ ,/ 并且/ 该/ 函数/ 操作/ 的/ 资源/ 一般/ 使用/ 指针/ 变量/ 来/ 代表/ ,/ 所以/ 可以/ 根据/ 指针/ 变量/ 对象/ 作为/ 实例/ 化/ 的/ 标准/ ./ 为此/ 我们/ 首先/ 确定/ 程序/ 中/ 所有/ 被/ 操作/ 的/ 资源/ ,/ 即/ 在/ 程序/ 中/ 找到/ 与/ 导致/ 初始状态/ 转移/ 的/ 状态/ 迁移/ 函数/ 所/ 匹配/ 的/ 所有/ 动作/ 语句/ ,/ 这些/ 语句/ 中/ 所/ 操作/ 的/ 指针/ 变量/ 就/ 代表/ 所有/ 被/ 操作/ 的/ 资源/ ./ 我们/ 将/ 这些/ 语句/ 记录/ 并/ 把/ 每/ 一条/ 语句/ (/ 准确/ 地/ 说/ 是/ 语句/ 所/ 操作/ 的/ 指针/ 变量/ 对象/ )/ 作为/ 一个/ 实例/ 化/ 的/ 标准/ ./ 算法/ 1/ 中/ 第/ 1/ 个/ 最/ 外层/ For/ 循环/ 即/ 完成/ 上述/ 功能/ ./ 其中/ Match/ (/ st/ ,/ action/ )/ 用来/ 判断/ 函数调用/ st/ 的/ 函数/ 名/ 是否/ 与/ 状态/ 迁移/ 函数/ action/ 的/ 函数/ 名/ 相同/ ./ 第/ 2/ 步/ 根据/ 实例/ 化/ 标准/ 完成/ 实例/ 化/ ./ 我们/ 对于/ 每/ 一个/ 实例/ 化/ 标准/ ,/ 从/ 这个/ 标准/ 开始/ 遍历/ 程序/ 所有/ 语句/ ,/ 如果/ 动作/ 语句/ 所/ 操作/ 的/ 指针/ 变量/ 与/ 该/ 标准/ 所/ 操作/ 的/ 指针/ 变量/ 是/ 别名/ 关系/ ,/ 则/ 它们/ 操作/ 的/ 是/ 同一/ 资源/ ,/ 该/ 语句/ 与/ 实例/ 化/ 标准/ 属于/ 同一个/ 有限/ 状态/ 自动机/ 实例/ ./ 这样/ 便/ 可/ 完成/ 有限/ 状态/ 自动机/ 的/ 实例/ 化/ ./ 算法/ 1/ 中/ 第/ 2/ 个/ 最/ 外层/ For/ 循环/ 即/ 完成/ 上述/ 功能/ ./ 其中/ Belong/ (/ st/ ,/ st/ _/ set/ )/ 用来/ 判断/ 函数调用/ st/ 与/ 集合/ st/ _/ set/ 中/ 的/ 任意/ 函数调用/ 是否/ 操作/ 的/ 是/ 同一/ 资源/ ,/ 即/ 属于/ 同一个/ 有限/ 状态/ 自动机/ 实例/ ;/ 一个/ 数组/ E/ 中/ 的/ 元素/ 用来/ 记录/ 一个/ 有限/ 状态/ 自动机/ 的/ 实例/ ./ 3.2/ ./ 2FSM/ 切片/ 算法/ 2/ 给出/ 了/ 完整/ 的/ FSM/ 切片/ 过程/ ./ 算法/ 2/ 主要/ 包含/ 3/ 个/ 步骤/ ./ 首先/ 对/ 有限/ 状态/ 自动机/ 进行/ 实例/ 化/ ;/ 然后/ ,/ 使用/ 文献/ [/ 12/ ]/ 中/ 算法/ 建立/ 系统/ 依赖图/ ,/ 再/ 对/ 每/ 一个/ 有限/ 状态/ 自动机/ 实例/ ,/ 依次/ 以/ 每/ 一个/ 动作/ 语句/ 作为/ 切片/ 标准/ ,/ 使用/ 文献/ [/ 11/ ]/ 中/ 算法/ (/ 以/ Inter/ -/ Slicing/ 函数/ 代表/ )/ 进行/ 上下文/ 敏感/ 的/ 过程/ 间/ 切片/ ,/ 并/ 将/ 切片/ 结果/ 合并/ ,/ 计算/ 得到/ 一个/ 有限/ 状态/ 自动机/ 实例/ 的/ FSM/ 切片/ ./ 通常/ ,/ 切片/ 的/ 结果/ 只是/ 语句/ 的/ 集合/ ,/ 所以/ 最后/ 还/ 需要/ 使用/ FSM/ 切片/ 的/ 结果/ ,/ 在/ 原程序/ 中/ 提取/ 出/ 切片/ 结果/ 指示/ 的/ 语句/ 从而/ 得到/ 最终/ 的/ 自动机/ 实例/ 的/ FSM/ 切片/ ./ 该/ 算法/ 将/ 原程序/ 的/ FSM/ 切片/ 结果/ 记录/ 在/ 数组/ P/ 中/ ,/ 数组/ 中/ 的/ 每/ 一个/ 元素/ 记录/ 的/ 是/ 每/ 一个/ 实例/ 的/ FSM/ 切片/ 结果/ ./ 可以/ 证明/ 算法/ 2/ 得到/ 的/ 结果/ 就是/ FSM/ 切片/ (/ 见/ 附录/ )/ ./ 算法/ 2/ ./ FSM/ 切片/ 算法/ ./ precedureFsmSlicing/ (/ P/ ,/ M/ )/ // // 1/ ./ InstantiatetheFSME/ ←/ InstFsm/ (/ P/ ,/ M/ )/ // // 2/ ./ FSMSlicingPage6BuildingSystemDependenceGraphGforPS/ [/ 1/ ../ |/ I/ |/ ]/ ←/ / fori/ ←/ 1/ ,/ |/ E/ |/ doendfor/ // // 3/ ./ ConstructSlicefori/ ←/ 1/ ,/ |/ S/ |/ doendforreturnPendprocedure/ 以图/ 3/ (/ b/ )/ 作为/ 示例/ 说明/ ./ 在/ 实例/ 化/ 阶段/ ,/ 找到/ 文件/ 操作/ 有限/ 状态/ 自动机/ 的/ 实例/ 化/ 标准/ 分别/ 是/ 语句/ 7/ 和/ 语句/ 9/ ./ 对于/ 语句/ 7/ ,/ 在/ 程序/ 的/ 遍历/ 过程/ 中/ ,/ 找到/ 语句/ 3/ 与其/ 处于/ 同一个/ 实例/ 化/ 标准/ 下/ (/ 操作/ 同一个/ 文件/ 指针/ 对象/ )/ ,/ 所以/ 语句/ 7/ 和/ 语句/ 3/ 属于/ 有限/ 状态/ 自动机/ 的/ 同一个/ 实例/ ./ 对于/ 语句/ 9/ ,/ 由于/ 从/ 语句/ 9/ 开始/ 遍历/ 无法/ 到达/ 语句/ 3/ ,/ 所以/ 语句/ 3/ 与/ 语句/ 9/ 不/ 属于/ 同一个/ 有限/ 状态/ 自动机/ 实例/ ./ 这样/ ,/ 程序/ 中有/ 两个/ 自动机/ 实例/ {/ E/ [/ 1/ ]/ =/ {/ 3/ ,/ 7/ }/ ,/ E/ [/ 2/ ]/ =/ {/ 9/ }/ }/ ./ 以/ E/ [/ 1/ ]/ 作为/ 切片/ 标准/ 进行/ 切片/ ,/ 得到/ 的/ 结果/ 如图/ 4/ (/ d1/ )/ 所示/ ;/ 以/ E/ [/ 2/ ]/ 作为/ 切片/ 标准/ 进行/ 切片/ ,/ 得到/ 的/ 结果/ 如图/ 4/ (/ d2/ )/ 所示/ ./ 4FSM/ 切片/ 实现/ 要点/ 以/ FSM/ 切片/ 技术/ 为/ 核心/ ,/ 我们/ 在/ Open64/ 开放源码/ 高级/ 编译系统/ 的/ 基础/ 上/ 实现/ 了/ 一个/ FSM/ 模型/ 驱动/ 的/ 检测/ 编译/ 框架/ ,/ 称为/ Fedora/ ./ 该/ 检测/ 编译/ 框架/ 以/ 编译/ 技术/ 为/ 基础/ 支撑/ ,/ 以/ FSM/ 切片/ 技术/ 为/ 核心/ ,/ 对/ 输入/ 的/ C/ 程序/ 检测/ 给定/ 的/ 程序/ 时序/ 安全/ 属性/ ./ 图/ 5/ 给出/ 了/ Fedora/ 的/ 总体/ 结构/ (/ 阴影/ 部分/ 表示/ 对/ Open64/ 的/ 扩充/ 与/ 改造/ )/ ./ Open64/ ①/ 是/ 一个/ 开发/ 源码/ 的/ 编译/ 研究/ 平台/ ,/ 具有/ 良好/ 的/ 程序/ 分析/ 框架/ ,/ 非常适合/ 作为/ 实现/ 检测工具/ 的/ 基础架构/ ./ Fedora/ 提供/ 了/ 图形/ 用户/ 接口/ ,/ 使/ 用户/ 可以/ 直观/ 、/ 方便/ 、/ 快速/ 地/ 描述/ 有限/ 状态/ 自动机/ ,/ 提供/ 待/ 检测/ 的/ 时序/ 安全/ 属性/ ./ 在/ 该/ 框架/ 下/ ,/ 我们/ 与/ MYGCC/ 进行/ 了/ 集成/ 实验/ ./ 通过/ 利用/ 图形/ 用户/ 接口/ 描述/ 有限/ 状态/ 自动机/ ,/ 并/ 将/ 该/ 自动机/ 自动/ 地/ 转换成/ MYGCC/ 能够/ 接受/ 的/ condate/ (/ MYGCC/ 中/ 描述/ 待测/ 性质/ 的/ 格式/ )/ ,/ 可以/ 极大/ 地/ 减少/ 用户/ 负担/ ,/ 这/ 说明/ Fedora/ 具有/ 很/ 好/ 的/ 易用性/ ./ 同时/ ,/ 我们/ 改造/ Open64/ 中/ 的/ 过程/ 间/ 分析/ 框架/ 为/ 全/ 程序/ 分析/ 框架/ ,/ 支持/ 实现/ 流/ 敏感/ 、/ 上下文/ 敏感/ 的/ 过程/ 间/ 分析/ ,/ 能够/ 提高/ 切片/ 的/ 精度/ ,/ 满足/ FSM/ 切片/ 的/ 需求/ ./ 在/ 当前/ 的/ 框架/ 上/ ,/ 使用/ 的/ 是/ Steensgaard/ 的/ 流/ 不/ 敏感/ 、/ 上下文/ 不/ 敏感/ 指针/ 分析/ ,/ 并/ 在/ 构建/ 程序/ 的/ 静态/ 单/ 赋值/ 形式/ 之前/ 进行/ 全/ 程序/ 的/ 副作用/ 分析/ 以/ 精化/ 定值/ 引用/ 信息/ ,/ 建立/ 更/ 精确/ 的/ 静态/ 单/ 赋值/ 形式/ ./ 在/ 这个/ 以/ 静态/ 单/ 赋值/ 形式/ 为/ 中间/ 表示/ 的/ 全/ 程序/ 分析/ 框架/ 上/ ,/ 我们/ 实现/ 了/ 程序/ 依赖图/ 以及/ 系统/ 依赖图/ 的/ 建/ ①/ http/ :/ // // www/ ./ open64/ ./ net/ // Page7/ 立/ ,/ 并/ 按照/ 算法/ 2/ 实现/ 了/ FSM/ 切片/ 算法/ ./ 然后/ ,/ 我们/ 根据/ FSM/ 切片/ 的/ 结果/ 提取/ 出/ FSM/ 切片/ ,/ 再/ 使用/ 第三方/ 的/ 检测工具/ ,/ 完成/ 时序/ 安全/ 属性/ 的/ 检测/ ./ 5/ 可伸缩性/ 和/ 准确性/ 的/ 评价/ 标准/ 本文/ 主要/ 是/ 衡量/ FSM/ 切片/ 技术/ 对于/ 时序/ 安全/ 属性/ 静态/ 检测/ 可伸缩性/ 和/ 准确性/ 的/ 提高/ ,/ 所以/ 需要/ 确定/ 合理/ 的/ 可伸缩性/ 和/ 准确性/ 的/ 评价/ 标准/ ./ 5.1/ 可伸缩性/ 评价/ 标准/ 对于/ 可伸缩性/ 的/ 评价/ ,/ 当前/ 主要/ 有/ 两个/ 标准/ :/ 每秒钟/ 能够/ 检测/ 程序/ 的/ 行数/ (/ 检测/ 速率/ ,/ 单位/ 千行/ // s/ )/ ;/ 在/ 合理/ 的/ 时间/ 内/ 能够/ 检测/ 的/ 最大/ 程序/ 规模/ ./ 对于/ 第/ 2/ 个/ 标准/ ,/ 由于/ “/ 合理/ 的/ 时间/ ”/ 这种/ 说法/ 很难/ 量化/ ,/ 并且/ 很多/ 工具/ 在/ 检测/ 中/ 可以/ 设定/ 最大/ 的/ 时空/ 开销/ 来/ 强制/ 完成/ 检测/ (/ 如/ Saturn/ )/ ,/ 使得/ 其/ 在/ 理论/ 上/ 可以/ 检测/ 任意/ 规模/ 的/ 程序/ ,/ 所以/ 第/ 2/ 个/ 标准/ 并/ 不合理/ ,/ 故/ 本文/ 使用/ 第一个/ 标准/ 来/ 量化/ 评价/ 检测/ 的/ 可伸缩性/ ./ 5.2/ 准确性/ 评价/ 标准/ 对于/ 准确性/ 的/ 评价/ ,/ 当前/ 主要/ 使用/ 误报率/ 作为/ 衡量标准/ ./ 然而/ ,/ 当前/ 的/ 程序/ 静态/ 检测工具/ 由于/ 技术/ 上/ 的/ 原因/ 或/ 实现/ 上/ 的/ 原因/ ,/ 一般/ 既/ 不是/ 可靠/ 的/ (/ 即/ 存在/ 漏报/ )/ 也/ 不是/ 完备/ 的/ (/ 即/ 存在/ 误报/ )/ ./ 所以/ 仅用/ 误报率/ 不能/ 全面/ 客观/ 地/ 评价/ 准确性/ ./ 本文/ 提出/ 了/ 借鉴/ 信息检索/ 领域/ 中/ 的/ F/ -/ 衡量/ 来/ 作为/ 静态/ 检测工具/ 准确性/ 的/ 评价/ 标准/ ./ 定义/ 4/ (/ F/ -/ 衡量/ )/ ./ TP/ 、/ FP/ 、/ TN/ 、/ FN/ 的/ 含义/ 精确/ 率/ (/ precision/ )/ =/ |/ TP/ |/ 召回/ 率/ (/ recall/ )/ =/ |/ TP/ |/ F/ β/ -/ 衡量/ (/ F/ β/ -/ measure/ )/ =/ 见/ 6.1/ 节/ ./ 精确/ 率/ 的/ 含义/ 是/ 对于/ 产生/ 的/ 关于/ 程序/ 错误/ 的/ 检测/ 报告/ 中/ ,/ 所/ 包含/ 的/ 程序/ 中/ 真实/ 存在/ 的/ 错误/ 的/ 比例/ ./ 所以/ 精确/ 率/ 是/ 衡量/ 误报/ 情况/ 的/ 一个/ 指标/ ./ 召回/ 率/ 的/ 含义/ 是/ 对于/ 程序/ 中/ 真实/ 存在/ 的/ 错误/ ,/ 能够/ 包含/ 在/ 生成/ 的/ 程序/ 错误报告/ 中/ 的/ 比例/ ./ 可见/ 召回/ 率/ 是/ 衡量/ 漏报/ 情况/ 的/ 一个/ 指标/ ./ 一个/ 好/ 的/ 检测工具/ 应该/ 具有/ 高/ 精确/ 率/ 和/ 高/ 召回/ 率/ ./ 但是/ ,/ 通常/ 情况/ 下/ ,/ 精确/ 率/ 和/ 召回/ 率/ 很/ 难/ 同时/ 做到/ 最好/ ./ 所以/ 评价/ 一个/ 检测工具/ 的/ 准确性/ ,/ 应该/ 能够/ 综合/ 检测/ 的/ 精确/ 率/ 和/ 召回/ 率/ ,/ 使/ 这/ 两个/ 指标/ 达到/ 一个/ 好/ 的/ 平衡/ ./ 这时/ ,/ 可以/ 使用/ 精确/ 率/ 和/ 召回/ 率/ 的/ 加权/ 的/ 调和/ 平均/ 来/ 作为/ 指标/ ./ 这/ 就是/ F/ -/ 衡量/ ./ 其中/ β/ ∈/ [/ 0/ ,/ )/ ,/ 表明/ 的/ 是/ 召回/ 率/ 比/ 精确/ 率/ 的/ 重要性/ 高/ 的/ 比例/ ./ 我们/ 认为/ ,/ 检测工具/ 应该/ 尽可能/ 多地/ 发现/ 程序/ 中/ 的/ 真正/ 错误/ ,/ 而/ 用户/ 对/ 误报/ 具有/ 一定/ 的/ 容忍性/ ,/ 也/ 就是/ 召回/ 率要/ 比/ 精确/ 率/ 重要/ ,/ 故/ 基本/ 的/ 要求/ 是/ β/ >/ 1/ ./ 在/ 本文/ 实验/ 中/ ,/ 选取/ β/ =/ 4/ ①/ ./ 6/ 实验/ 6.1/ 实验/ 方法/ 对于/ 时序/ 安全/ 属性/ ,/ 本文/ 选取/ 文件/ 时序/ 安全/ 属性/ (/ 文件/ FSM/ )/ 和/ 内存/ 时序/ 安全/ 属性/ (/ 内存/ FSM/ )/ ,/ 如图/ 1/ 和/ 图/ 2/ 所示/ ,/ 检测/ 程序/ 中/ 是否/ 存在/ 文件/ 指针/ 泄露/ 和/ 内存/ 泄露/ 的/ 错误/ ./ 对于/ 第三方/ 的/ 检测工具/ ,/ 本文/ 选取/ Fastcheck/ 和/ Saturn/ ./ Fastcheck/ 和/ Saturn/ 都/ 是/ 代表性/ 的/ 程序/ 静态/ 分析/ 工具/ ,/ 但是/ 两者/ 各具/ 不同/ 的/ 特点/ ,/ 如/ 第/ 2/ 部分/ 所/ 讨论/ ./ Fastcheck/ 由/ 康奈尔大学/ 开发/ ,/ 具有/ 高/ 可伸缩性/ ,/ 但/ 由于/ 不/ 安全/ 地/ 使用/ 别名/ 信息/ 、/ 只/ 进行/ 部分/ 的/ 路径/ 敏感/ 分析/ (/ 不/ 计算/ 路径/ 条件/ )/ 等/ 而/ 影响/ 了/ 准确性/ ./ 本文/ 实验/ 中/ 选取/ 的/ 是/ Fastcheck/ 的/ 最新/ 版本/ ,/ Fastcheck1/ ./ 0/ ./ Fastcheck/ 内置/ 了/ 检测/ 文件/ 时序/ 安全/ 属性/ 和/ 内存/ 时序/ 安全/ 属性/ 的/ 功能/ ,/ 可以/ 直接/ 进行/ 本/ 实验/ ./ Saturn/ 由/ 斯坦福大学/ 开发/ ,/ 由于/ 支持/ 路径/ 敏感/ 的/ 过程/ 间/ 分析/ 而/ 具有/ 很/ 好/ 的/ 检测/ 准确性/ ,/ 但/ 可伸缩性/ 受到/ 较大/ 限制/ ./ 本文/ 实验/ 中/ 选取/ 的/ 是/ Saturn/ 的/ 最新/ 版本/ ,/ Saturn1/ ./ 1/ ./ 在/ 使用/ Saturn/ 检测/ 文件/ 时序/ 安全/ 属性/ 和/ 内存/ 时序/ 安全/ 属性/ 时/ ,/ 需要/ 提供/ 属性/ 描述/ 文件/ ./ 为此/ 我们/ 在/ 能力/ 范围/ 内/ 反复/ 地/ 手工/ 调整/ 该/ 属性/ 描述/ 文件/ 以/ 尽可能/ 地/ 发挥/ Saturn/ 的/ 检测/ 能力/ ./ 本/ 实验/ 的/ 过程/ 如下/ :/ 对于/ 每/ 一个/ 待测/ 用例/ ,/ 首先/ 分别/ 针对/ 每/ 一个/ 时序/ 安全/ 属性/ ,/ 计算/ FSM/ 切片/ (/ 将/ 每个/ 实例/ 的/ FSM/ 切片/ 结果/ 合并/ 求得/ 原程序/ 的/ FSM/ 切片/ )/ ,/ 并/ 根据/ 切片/ 结果/ 利用/ 分析/ 工具/ exceptor/ (/ 基于/ Crystal/ 实现/ ②/ )/ 在/ 原程序/ 中/ 取出/ FSM/ 切片/ ./ 在/ 给定/ 时序/ 安全/ 属性/ 和/ 待/ 测用例/ 的/ 情况/ 下/ ,/ 使用/ Fast/ -/ ①/ β/ =/ 8/ 、/ β/ =/ 10/ ,/ 发现/ 当/ β/ >/ 4/ 以后/ ,/ F/ -/ 衡量/ 的/ 值/ 随/ β/ 增大/ 变化/ ②/ Page8check/ 和/ Saturn/ 分别/ 对/ 原程序/ 和/ FSM/ 切片/ 进行/ 检测/ ,/ 共/ 得到/ 4/ 个/ 测试报告/ ./ 这/ 4/ 个/ 报告/ 其实/ 是/ 关于/ 同一个/ 程序/ 检测/ 同/ 一种/ 错误/ ./ 所以/ ,/ 对/ 每个/ 报告/ 的/ 每/ 一个/ 条目/ 逐一/ 进行/ 人工/ 确认/ ,/ 并/ 将/ 每/ 一个/ 条目/ 划定/ 到/ 以下/ 4/ 类/ 之一/ :/ 报告/ 是/ 错误/ 且/ 是/ 实际/ 存在/ 的/ 违反/ 时序/ 安全/ 属性/ 的/ 错误/ (/ TP/ )/ ,/ 报告/ 是/ 错误/ 但/ 实际/ 是/ 遵守/ 时序/ 安全/ 属性/ 的/ 情况/ (/ FP/ )/ ,/ 报告/ 是/ 正确/ 且/ 实际上/ 也/ 是/ 遵守/ 时序/ 安全/ 属性/ 的/ 情况/ (/ TN/ )/ ,/ 报告/ 是/ 正确/ 但是/ 实际/ 存在/ 违反/ 时序/ 安全/ 属性/ 的/ 错误/ (/ FN/ )/ ./ 由于/ Fastcheck/ 和/ Saturn/ 只能/ 检测/ C/ 程序/ ,/ 所以/ 我们/ 根据/ 程序/ 规模/ ,/ 选取/ 了/ SPECCPU2000/ 、/ SPECCPU2006/ ①/ 中/ 的/ 部分/ C/ 程序/ (/ 包括/ 浮点/ 程序/ 和/ 定点/ 程序/ )/ 和/ OpenSSH/ ②/ 中/ 部分/ 程序/ ./ 这些/ 测试用例/ 都/ 是/ 源自/ 现实/ 中/ 广泛/ 使用/ 的/ 应用程序/ ,/ 覆盖/ 了/ 相当/ 广泛/ 的/ 应用领域/ ,/ 能够/ 体现/ 不同/ 的/ 应用程序/ 特征/ ,/ 代码/ 规模/ 从/ 几千/ 行到/ 几十万/ 行/ ,/ 能够/ 全面/ 客观/ 地/ 衡量/ FSM/ 切片/ 和/ Fedora/ 的/ 有效性/ ./ 6.2/ 实验/ 环境/ 本/ 实验/ 的/ 所有/ 实验/ 数据/ 均/ 是/ 在/ 同一/ 台/ 服务器/ 上测/ 得/ ./ 该/ 服务器/ 是/ 一台/ 双处理器/ 的/ 机器/ ,/ 每个/ 处理器/ 都/ 是/ IntelXeon/ (/ R/ )/ E5430/ ,/ 含有/ 4/ 个/ 处理器/ 核/ ,/ 主频/ 为/ 2.66/ GHz/ ,/ 每个/ 核/ 私有/ 64KB/ 的/ 一级/ Cache/ ,/ 每/ 两个/ 核/ 共享/ 6MB/ 的/ 二级/ Cache/ ,/ 并/ 支持/ 64/ 位/ 指令集/ ./ 该/ 服务器/ 具有/ 16GB/ 的/ 内存/ 和/ 1T/ 的/ 硬盘/ ,/ 预装/ 有/ 64/ 位/ 的/ RedHat/ 企业/ 版/ Linux5/ ./ 2/ ,/ 内核/ 版本/ 2.6/ ./ 18/ ./ Fastcheck/ 的/ 运行/ 选项/ 是/ 其/ 默认/ 的/ 选项/ ;/ Saturn/ 的/ 运行/ 选项/ 也/ 是/ 其/ 默认/ 选项/ ,/ 对于/ 每个/ 函数/ 的/ 处理/ ,/ 限制/ 使用/ 512MB/ 的/ 内存/ 和/ 100s/ 的/ 处理器/ 时间/ ./ 测试用例/ 的/ 简单/ 描述/ 如表/ 1/ 所述/ ./ 用例/ 名称/ 规模/ // 千行/ sftpssh/ -/ agentssh/ -/ rand/ -/ helper1/ ./ 5175/ ./ vpr177/ ./ mesa188/ ./ ammp253/ ./ perlbmk254/ ./ gap300/ ./ twolf403/ ./ gcc433/ ./ milc445/ ./ gobmk458/ ./ sjeng482/ ./ sphinx3/ 表/ 2Fastcheck/ 可伸缩性/ 实验/ 结果/ 286.1/ (/ 278.5/ )/ 0.7/ (/ 0.3/ )/ 0.1/ (/ 0.1/ )/ 0.3/ (/ 0.1/ )/ 3.1/ (/ 1.2/ )/ 2.3/ (/ 2.0/ )/ 1.7/ (/ 0.6/ )/ 8.1/ (/ 0.9/ )/ 4.8/ (/ 2.5/ )/ 117.4/ (/ 59.6/ )/ 3.1/ (/ 0.7/ )/ 8.4/ (/ 4.0/ )/ 6.2/ (/ 4.3/ )/ 3.6/ (/ 1.1/ )/ 用例/ 名称/ 描述/ 用例/ 名称/ 描述/ OpenSSH/ 系列/ 远程/ 访问/ 服务器/ 175/ ./ vprFPGA/ 线路/ 布局/ 403/ ./ gccC/ 程序/ 编译器/ 177/ ./ mesa3/ 维/ 图形库/ 433/ ./ milc/ 量子/ 色/ 动力学/ 188/ ./ ammp/ 计算/ 化学/ 445/ ./ gobmk/ 人工智能/ 程序/ GO253/ ./ perlbmkPerl/ 程序/ 解释器/ 458/ ./ sjeng/ 国际象棋/ 计算/ 254/ ./ gap/ 聚合/ 理论/ 解释器/ 482/ ./ sphinx3/ 语音/ 识别/ 6.3/ 实验/ 结果/ 6.3/ ./ 1/ 可伸缩性/ 表/ 2/ 和表/ 3/ 分别/ 给出/ 了/ 使用/ FSM/ 切片/ 对于/ Fastcheck/ 和/ Saturn/ 进行/ 可伸缩性/ 实验/ 的/ 结果/ ./ 对于/ 每个/ 工具/ 检测/ 的/ 每个/ 时序/ 安全/ 属性/ ,/ 分别/ 给出/ 了/ 检测/ 原程序/ 的/ 时间/ (/ 第/ 3/ 列/ 和/ 第/ 5/ 列/ )/ 和/ 检测/ FSM/ 切片/ 的/ 时间/ (/ 第/ 4/ 列/ 和/ 第/ 6/ 列/ ,/ 该/ 时间/ 已/ 包含/ 计算/ FSM/ 切片/ 的/ 时间/ ,/ 并/ 在/ 括号/ 内/ 给出/ )/ ./ 表中/ 黑体/ 表示/ 最好/ 情况/ ./ 这样/ 我们/ 就/ 可以/ 根据/ 程序/ 的/ 规模/ 来/ 计算/ 每次/ 检测/ 的/ 检测/ 速率/ ./ FSM/ 切片/ 对于/ Fastcheck/ 和/ Saturn/ 的/ 可伸缩性/ 提高/ 如图/ 6/ 和/ 图/ 7/ 所示/ ./ 两图/ 中/ Y/ 轴/ 表示/ 的/ 是/ FSM/ 切片/ 使得/ 可伸缩性/ 提高/ 的/ 比例/ (/ 将/ 原程序/ 的/ 检测/ 速率/ 进行/ 归一化/ 处理/ )/ ./ ①/ ②/ Page9/ 用例/ 名称/ 规模/ // 千行/ sftpssh/ -/ agentssh/ -/ rand/ -/ helper1/ ./ 5175/ ./ vpr177/ ./ mesa188/ ./ ammp253/ ./ perlbmk254/ ./ gap300/ ./ twolf433/ ./ milc445/ ./ gobmk458/ ./ sjeng482/ ./ sphinx3/ 表/ 3Saturn/ 可伸缩性/ 实验/ 结果/ 66.4/ (/ 0.3/ )/ 0.1/ (/ 0.1/ )/ 4.2/ (/ 0.1/ )/ 394.3/ (/ 1.2/ )/ 5.1/ (/ 2.0/ )/ 697.9/ (/ 0.6/ )/ 55495/ (/ 281.5/ )/ 87912/ (/ 0.9/ )/ 2392/ (/ 2.5/ )/ 190.8/ (/ 0.7/ )/ 1807/ (/ 4.0/ )/ 1318/ (/ 4.3/ )/ 834.2/ (/ 1.1/ )/ 对于/ 177/ ./ mesa/ ,/ 文件/ FSM/ 切片/ 可以/ 使/ Fastcheck/ 的/ 可伸缩性/ 提升/ 高/ 达/ 原来/ 的/ 5.62/ 倍/ ,/ 尤其/ 使/ Saturn/ 的/ 可伸缩性/ 提升/ 高/ 达/ 原来/ 的/ 1314/ 倍/ ./ 这/ 主要/ 因为/ mesa/ 的/ 文件/ FSM/ 切片/ 仅为/ 原程序/ 的/ 0.56/ %/ ./ 平均/ 而言/ ,/ 文件/ FSM/ 切片/ 使得/ Fastcheck/ 可伸缩性/ 提高/ 到/ 原来/ 的/ 1.48/ 倍/ ,/ 使/ Saturn/ 的/ 可伸缩性/ 提高/ 到/ 原来/ 的/ 6.34/ 倍/ ./ 在/ 内存/ 时序/ 安全/ 属性/ 的/ 实验/ 中/ ,/ 内存/ FSM/ 切片/ 可以/ 使/ Fastcheck/ 的/ 可伸缩性/ 提升/ 高/ 达/ 原来/ 的/ 4.82/ 倍/ ,/ 使/ Saturn/ 的/ 可伸缩性/ 提升/ 高/ 达/ 原来/ 的/ 4.09/ 倍/ ./ 平均/ 而言/ ,/ 内存/ FSM/ 切片/ 使得/ Fastcheck/ 的/ 可伸缩性/ 提高/ 到/ 原来/ 的/ 1.23/ 倍/ ,/ 使得/ Saturn/ 的/ 可伸缩性/ 提高/ 到/ 原来/ 的/ 1.88/ 倍/ ./ 6.3/ ./ 2/ 准确性/ 对于/ 文件/ 时序/ 安全/ 属性/ 和/ 内存/ 时序/ 安全/ 属性/ ,/ 我们/ 使用/ Fastcheck/ 和/ Saturn/ 分别/ 检测/ 原程序/ 和/ FSM/ 切片/ ,/ 并/ 对/ 所/ 得到/ 的/ 报告/ 逐一/ 进行/ 确认/ 和/ 分类/ ./ 我们/ 对/ 我们/ 能够/ 确定/ 的/ 检测/ 报告/ (/ 排除/ 复杂/ 测试用例/ 和/ FSM/ 切片/ 算法/ 的/ 实现/ 对/ 报告/ 确认/ 的/ 干扰/ )/ 分别/ 列入/ 表/ 4/ 和表/ 5/ 中/ ,/ 同时/ 给出/ 了/ 根据/ 5.3/ 节/ 的/ 公式/ 计算/ 出/ 的/ F/ -/ 衡量/ 的/ 值/ ./ 其中/ 黑体/ 部分/ 表示/ FSM/ 切片/ 可以/ 提高/ 检测/ 准确性/ 的/ 测试用例/ ./ FSM/ 切片/ 对于/ Fastcheck/ 和/ Saturn/ 检测/ 文件/ 时序/ 安全/ 属性/ 和/ 内存/ 时序/ 安全/ 属性/ 准确性/ 的/ 提高/ 分别/ 如图/ 8/ 和/ 图/ 9/ 所示/ ./ 两图/ 中/ Y/ 轴/ 表示/ 的/ 是/ FSM/ 切片/ 对于/ 准确性/ 提高/ 的/ 比例/ (/ 将/ 原程序/ 的/ F/ -/ 衡量/ 值/ 进行/ 归一化/ 处理/ )/ ./ 图/ 8FSM/ 切片/ 对/ 检测/ 文件/ 时序/ 安全/ 属性/ 准确性/ 的/ 提高/ 图/ 9FSM/ 切片/ 对/ 检测/ 内存/ 时序/ 安全/ 属性/ 准确性/ 的/ 提高/ Page10/ 表/ 4/ 文件/ 时序/ 安全/ 属性/ 检测/ 结果/ 例子/ 名称/ ssh/ -/ rand/ -/ helper10001/ ./ 0010001.0010001/ ./ 0010001.00177/ ./ mesa20201/ ./ 0020201.0020201/ ./ 0020201.00254/ ./ gap300/ ./ twolf302901/ ./ 00302901.00302901/ ./ 00302901.00445/ ./ gobmk20401/ ./ 0020401.0020401/ ./ 0020401.00458/ ./ sjeng20101/ ./ 0020101.0020101/ ./ 0020101.00464/ ./ h264ref10640/ ./ 2120630.4140610/ ./ 8140610.81482/ ./ sphinx3402070/ ./ 38902020.83602050/ ./ 56902020.83/ 表/ 5/ 内存/ 时序/ 安全/ 属性/ 检测/ 结果/ 例子/ 名称/ sftpssh/ -/ agent10220/ ./ 3520210.6810220/ ./ 3530201.00175/ ./ vpr32053720/ ./ 3234053700.3410374610/ ./ 9910374610.99188/ ./ ammp300430/ ./ 91310420.94290440/ ./ 89320410.97433/ ./ milc20027350/ ./ 3822225330.415122540/ ./ 935122540.93445/ ./ gobmk809140/ ./ 38909130.42200920/ ./ 91220901.00/ 检测/ 程序/ ,/ 所以/ 它/ 的/ 优势/ 就/ 在于/ 可伸缩性/ 比较/ 好/ ;/ 相反/ ,/ Saturn/ 由于/ 使用/ 路径/ 敏感/ 的/ 分析/ ,/ 可伸缩性/ 则/ 受到/ 了/ 限制/ ./ FSM/ 切片/ 不仅/ 减少/ 了/ 程序/ 规模/ ,/ 而且/ 简化/ 了/ 程序结构/ 和/ 复杂/ 的/ 变量/ 关系/ ,/ 特别/ 是/ 减少/ 了/ 可能/ 导致/ 程序/ 分析/ 指数/ 爆炸/ 的/ 程序/ 成分/ 比如/ 分支/ 语句/ ,/ 这样/ 就/ 提高/ 了/ Saturn/ 中/ 的/ 路径/ 敏感/ 的/ 程序/ 分析/ 效率/ ,/ 这/ 加速/ 了/ FSM/ 切片/ 对于/ Saturn/ 可伸缩性/ 的/ 改善/ ./ 6.4/ ./ 2/ 准确性/ 无论是/ 文件/ FSM/ 切片/ ,/ 还是/ 内存/ FSM/ 切片/ ,/ 都/ 可以/ 使/ Fastcheck/ 检测/ 时序/ 安全/ 属性/ 准确性/ 提高/ ./ 这/ 主要/ 是因为/ 召回/ 率/ 的/ 提高/ ,/ 而/ 召回/ 率/ 提高/ 的/ 原因/ ,/ 主要/ 是/ FSM/ 切片/ 克服/ 了/ Fastcheck/ 中/ 不/ “/ 安全/ ”/ 技巧/ 的/ 影响/ ./ FSM/ 切片/ 去掉/ 了/ 程序/ 中/ 与/ 检测/ FSM/ 无关/ 的/ 部分/ ,/ 降低/ 了/ 程序/ 的/ 复杂性/ ,/ 可以/ 使/ 指针/ 分析/ 得到/ 更/ 精确/ 的/ 结果/ 以/ 间接/ 地/ 消除/ 部分/ 不/ “/ 安全/ ”/ 的/ 使用/ ,/ 如图/ 3/ (/ b/ )/ 代码/ 所示/ ,/ 从而/ 使/ 漏报/ 减少/ ,/ 相对/ 召回/ 率/ 提高/ ./ 无论是/ 文件/ FSM/ 切片/ ,/ 还是/ 内存/ FSM/ 切片/ ,/ 都/ 可以/ 使/ Saturn/ 检测/ 时序/ 安全/ 属性/ 的/ 准确性/ 提高/ ./ 准确性/ 的/ 提高/ 同样/ 也/ 主要/ 来源于/ 召回/ 率/ 的/ 提高/ ,/ 而/ 召回/ 率/ 提高/ 的/ 原因/ ,/ 主要/ 是/ FSM/ 切片/ 可以/ 提高/ Saturn/ 中/ 指针/ 分析/ 的/ 效率/ ./ 值得/ 指出/ 的/ 是/ ,/ 因为/ Saturn/ 使用/ 的/ 路径/ 敏感/ 的/ 指针/ 分析/ 可能/ 导致/ 组合/ 爆炸/ 问题/ ,/ 所以/ Saturn/ 中/ 设定/ 了/ 分析/ 每个/ 函数/ 所/ 可以/ 使用/ 的/ 最大/ 内存/ 量/ 和/ 最长/ 处理器/ 用时/ ,/ 使得/ 发生/ 组合/ 爆炸/ 的/ 情况/ 下/ ,/ 检测/ 仍/ 得以/ 进行/ ./ 对于/ 测试用例/ 中/ 从/ 图/ 8/ 中/ 可以/ 看出/ ,/ 文件/ FSM/ 切片/ 没有/ 使/ 任何/ 一个/ 工具/ 的/ 检测/ 准确性/ 降低/ ./ 对于/ Fastcheck/ ,/ 文件/ FSM/ 切片/ 可以/ 使/ 其/ 准确性/ 提升/ 高/ 达/ 原来/ 的/ 2.19/ 倍/ ,/ 平均/ 提高/ 到/ 原来/ 的/ 1.20/ 倍/ ;/ 对于/ Saturn/ ,/ 文件/ FSM/ 切片/ 可以/ 使/ 其/ 准确性/ 提升/ 高/ 达/ 原来/ 的/ 1.48/ 倍/ ,/ 平均/ 提高/ 到/ 原来/ 的/ 1.05/ 倍/ ./ 从图/ 9/ 中/ 可以/ 看出/ ,/ 内存/ FSM/ 切片/ 没有/ 使/ 任何/ 一个/ 工具/ 的/ 检测/ 准确性/ 降低/ ./ 对于/ Fastcheck/ ,/ 内存/ FSM/ 切片/ 可以/ 使/ 其/ 准确性/ 提升/ 高/ 达/ 原来/ 的/ 1.96/ 倍/ ,/ 平均/ 提高/ 到/ 原来/ 的/ 1.15/ 倍/ ;/ 对于/ Saturn/ ,/ 内存/ FSM/ 切片/ 可以/ 使/ 其/ 准确性/ 提升/ 高/ 达/ 原来/ 的/ 2.88/ 倍/ ,/ 平均/ 提高/ 到/ 原来/ 的/ 1.24/ 倍/ ./ 6.4/ 讨论/ 6.4/ ./ 1/ 可伸缩性/ 从/ 横向/ 上/ 看/ ,/ 文件/ FSM/ 切片/ 对于/ 可伸缩性/ 的/ 提高/ 要/ 明显/ 好于/ 内存/ FSM/ 切片/ ,/ 这/ 两个/ 工具/ 都/ 体现/ 出/ 了/ 这/ 一/ 特点/ ./ 这/ 是因为/ ,/ 通常/ 情况/ 下/ ,/ 程序/ 中/ 与/ 操作/ 文件/ 相关/ 的/ 语句/ 要/ 明显/ 少于/ 与/ 操作/ 内存/ 相关/ 的/ 语句/ ,/ 所以/ 文件/ FSM/ 切片/ 要/ 明显/ 小于/ 内存/ FSM/ 切片/ ,/ 相应/ 的/ ,/ 文件/ FSM/ 切片/ 对于/ 检测时间/ 的/ 减小/ 也/ 要/ 大于/ 内存/ FSM/ 切片/ 对于/ 检测时间/ 的/ 减小/ ,/ 这样/ 文件/ FSM/ 切片/ 对于/ 可伸缩性/ 的/ 改善/ 要/ 好/ 于/ 内存/ FSM/ 切片/ ./ 从/ 纵向/ 上/ 看/ ,/ FSM/ 切片/ 对于/ Saturn/ 的/ 可伸缩性/ 改善/ 要/ 明显/ 优于/ 对/ Fastcheck/ 的/ 改善/ ,/ 实验/ 的/ 两个/ 时序/ 安全/ 属性/ 都/ 体现/ 了/ 这/ 一点/ ./ 这/ 与/ 工具/ 本身/ 的/ 特点/ 相关/ ./ Fastcheck/ 的/ 设计/ 理念/ 就是/ 尽可能/ 高效/ 地/ TPFPTNFNF4TPFPTNFNF4Page11/ 的/ 大/ 函数/ ,/ Saturn/ 很难/ 在/ 这些/ 规定值/ 内/ 完成/ 预定/ 分析/ ,/ 从而/ 导致/ 漏报/ ./ 而/ FSM/ 切片/ 有效/ 地/ 减小/ 了/ 函数/ 规模/ ,/ 简化/ 了/ 程序结构/ ,/ 降低/ 了/ 程序/ 复杂性/ ,/ 使得/ Saturn/ 可以/ 在/ 规定值/ 内/ 完成/ 预定/ 分析/ ,/ 如图/ 3/ (/ a/ )/ 中/ 代码/ 所示/ ,/ 使得/ 召回/ 率/ 提高/ ./ 7/ 结论/ 及下/ 一步/ 工作/ 计划/ 软件/ 正确性/ 问题/ ,/ 随着/ 信息技术/ 的/ 发展/ ,/ 越来越/ 多地/ 得到/ 了/ 人们/ 的/ 广泛/ 重视/ ./ 在/ 软件开发/ 中/ 使用/ 程序/ 静态/ 检测工具/ 是/ 一种/ 有效/ 的/ 提高/ 软件/ 正确性/ 的/ 方法/ ./ 当前/ 有/ 代表性/ 的/ 静态/ 检测工具/ 由于/ 使用/ 的/ 技术/ 不同/ 而/ 在/ 检测/ 的/ 准确性/ 和/ 可伸缩性/ 上/ 进行/ 不同/ 的/ 权衡/ ./ 然而/ ,/ 这些/ 工具/ 在/ 检测/ 过程/ 中/ ,/ 没有/ 以/ 检测/ 需求/ 为/ 驱动/ ,/ 没/ 能/ 充分利用/ 已有/ 程序/ 信息/ ,/ 使得/ 它们/ 的/ 准确性/ 和/ 可伸缩性/ 都/ 受到/ 了/ 不同/ 程度/ 的/ 损失/ ./ 本文/ 在/ 分析/ 和/ 总结/ 这些/ 典型/ 检测工具/ 工作/ 特点/ 的/ 基础/ 上/ ,/ 针对/ 时序/ 安全/ 属性/ 的/ 检测/ ,/ 提出/ 了/ FSM/ 切片/ 技术/ ./ 不同于/ 传统/ 的/ 切片/ 标准/ ,/ 该/ 技术/ 使用/ 有限/ 状态/ 自动机/ 作为/ 切片/ 标准/ ,/ 以/ 需求/ 驱动/ 的/ 模式/ 利用/ 切片/ 技术/ 提取/ 出/ 部分/ 原程序/ ,/ 在/ 减少/ 程序/ 规模/ 的/ 基础/ 上/ 简化/ 了/ 程序/ 成分/ 和/ 复杂/ 变量/ 关系/ ,/ 是/ 使/ 检测/ 的/ 准确性/ 和/ 可伸缩性/ 获得/ 更好/ 平衡/ 的/ 关键技术/ ./ 本文/ 基于/ 传统/ 上下文/ 敏感/ 的/ 过程/ 间/ 切片/ 算法/ ,/ 给出/ 了/ FSM/ 切片/ 算法/ ,/ 并/ 以/ 该/ 算法/ 为/ 核心/ 实现/ 了/ Fedora/ 检测/ 编译/ 框架/ 原型/ 系统/ ./ 实验/ 表明/ ,/ FSM/ 切片/ 可以/ 使/ Saturn/ 和/ Fastcheck/ 检测/ 的/ 可伸缩性/ 和/ 准确性/ 都/ 取得/ 明显提高/ ./ 对于/ 文件/ 时序/ 安全/ 属性/ 的/ FSM/ 切片/ ,/ 可以/ 使/ Saturn/ 的/ 可伸缩性/ 平均/ 提高/ 到/ 原来/ 的/ 6.34/ 倍/ ,/ 准确性/ 平均/ 提高/ 到/ 原来/ 的/ 1.05/ 倍/ ;/ 可以/ 使/ Fastcheck/ 的/ 可伸缩性/ 平均/ 提高/ 到/ 原来/ 的/ 1.48/ 倍/ ,/ 准确性/ 平均/ 提高/ 到/ 原来/ 的/ 1.20/ 倍/ ./ 对于/ 内存/ 时序/ 安全/ 属性/ 的/ FSM/ 切片/ ,/ 可以/ 使/ Saturn/ 的/ 可伸缩性/ 平均/ 提高/ 到/ 原来/ 的/ 1.88/ 倍/ ,/ 准确性/ 平均/ 提高/ 到/ 原来/ 的/ 1.24/ 倍/ ;/ 可以/ 使/ Fastcheck/ 的/ 可伸缩性/ 平均/ 提高/ 到/ 原来/ 的/ 1.23/ 倍/ ,/ 准确性/ 平均/ 提高/ 到/ 原来/ 的/ 1.15/ 倍/ ./ 对于/ FSM/ 切片/ 技术/ ,/ 我们/ 的/ 进一步/ 工作/ 包括/ :/ 一方面/ 是/ 改进/ 现有/ 切片/ 算法/ ,/ 进一步提高/ 切片/ 的/ 效率/ 和/ 准确性/ ;/ 另一方面/ 是/ 在/ 切片/ 的/ 过程/ 中/ ,/ 进一步/ 使用/ 有限/ 状态/ 自动机/ 所/ 描述/ 的/ 语义/ ,/ 构造/ 不/ 确定/ 状态/ 切片/ ./ 不/ 确定/ 状态/ 切片/ 是/ 在/ 现有/ FSM/ 切片/ 的/ 基础/ 上/ ,/ 将/ 确定/ 能够/ 导致/ 有限/ 状态/ 自动机/ 转移/ 到/ 正确/ 终止/ 状态/ 或/ 错误/ 终止/ 状态/ 的/ 语句/ 进一步/ 切除/ ,/ 只/ 保留/ 导致/ 有限/ 状态/ 自动机/ 进行/ 不/ 确定/ 转移/ 的/ 程序/ 成分/ ,/ 这样/ 可以/ 进一步/ 减少/ FSM/ 切片/ 规模/ ,/ 使得/ 静态/ 检测/ 在/ 可伸缩性/ 和/ 准确性/ 上/ 得到/ 更好/ 的/ 改善/ ./ 

