Page1RocketTC/ :/ 一个/ 基于/ FPGA/ 的/ 高性能/ 网络流量/ 分类/ 架构/ 付文亮/ 1/ )/ 嵩天/ 1/ )/ 周舟/ 2/ )/ 1/ )/ (/ 北京理工大学/ 计算机/ 学院/ 北京市/ 海量/ 语言/ 信息处理/ 与/ 云/ 计算/ 应用/ 工程技术/ 研究/ 中心/ 北京/ 100081/ )/ 2/ )/ (/ 中国科学院/ 信息工程/ 研究所/ 信息内容/ 安全/ 技术/ 国家/ 工程/ 实验室/ 北京/ 100093/ )/ 摘要/ 基于/ 深包/ 检测/ 技术/ 的/ 流量/ 分类/ 方法/ 可以/ 达到/ 95/ %/ 以上/ 的/ 识别率/ 和/ 准确率/ ./ 然而/ ,/ 由于/ 计算/ 复杂性/ 高/ 、/ 存储/ 消耗/ 大/ 等/ 原因/ ,/ 主流/ 软件/ 方法/ 只能/ 提供/ 百兆/ (/ 线/ 速率/ )/ 处理/ 能力/ ,/ 而且/ 不能/ 处理/ 大量/ 流/ 并发/ 的/ 情况/ ./ 文中/ 提出/ 一个/ 基于/ 深包/ 检测/ 技术/ 的/ 芯片级/ 流量/ 分类/ 架构/ RocketTC/ ,/ 通过/ 对/ 应用层/ 协议/ 特征/ 、/ 匹配/ 引擎/ 和/ 流/ 管理策略/ 进行/ 优化/ ,/ 使/ 其/ 支持/ 万兆级/ 数据/ 吞吐/ 率/ ./ RocketTC/ 具有/ 两个/ 核心/ 模块/ :/ 基于/ FPGA/ 的/ 流/ 管理器/ 和/ 动态/ 可/ 重构/ 的/ 分类/ 引擎/ 阵列/ ,/ 前者/ 实现/ 万兆/ 吞吐/ 率下/ 的/ 流表/ 管理/ ,/ 后者/ 快速/ 检测/ 流量/ 特征/ 并/ 支持/ 动态/ 协议/ 特征/ 更新/ 特性/ ./ 文中/ 提出/ 的/ 分类/ 方法/ 使用/ 轻量级/ DPI/ 方法/ ,/ 通过/ 缩小/ 检测/ 范围/ 和/ 特征/ 长度/ 进一步/ 减少/ 计算/ 复杂度/ 和/ 存储/ 消耗/ ./ 我们/ 使用/ XilinxVirtex/ -/ 5FPGA/ 对/ 上述/ 设计/ 进行/ 实现/ 与/ 在线/ 流量/ 测试/ ,/ 结果表明/ RocketTC/ 可以/ 对/ 92/ 种/ 网络协议/ 进行/ 识别/ ,/ 准确率/ 达到/ 97/ %/ ,/ 而且/ 稳定/ 提供/ 20Gbps/ 线速/ 处理/ 能力/ ./ 关键词/ 架构设计/ ;/ 网络流量/ 分类/ ;/ FPGA/ ;/ 多级/ 流水/ ;/ 部分/ 动态/ 可/ 重构/ (/ PDR/ )/ 1/ 引言/ 网络流量/ 分类/ 是/ 网络管理/ 、/ 流量/ 工程/ 和/ 网络安全/ 行为/ 分析/ 等/ 网络/ 研究/ 和/ 应用/ 的/ 基础/ ,/ 也/ 是/ 网络/ 研究/ 的/ 重点/ 内容/ 之一/ ./ 同时/ ,/ 准确/ 的/ 从/ 应用层/ 角度/ 了解/ 网络/ 也/ 是/ 下一代/ 互联网/ 设计/ 的/ 基础/ ./ 网络流量/ 分类/ 研究/ 发展/ 至今/ ,/ 衍生/ 出/ 多种/ 分类/ 方法/ ,/ 从/ 不同/ 角度/ 对/ 网络/ 数据流/ 的/ 特征/ 进行/ 分析/ 与/ 识别/ ./ 这些/ 方法/ 主要/ 有/ 基于/ 端口号/ 、/ 基于/ 有效载荷/ 、/ 基于/ 主机/ 和/ 基于/ 机器/ 学习/ 等/ ./ 基于/ 端口号/ 的/ 分类/ 方法/ 通过/ 检测/ 数据包/ 端口号/ 进行/ 流量/ 识别/ ,/ 实现/ 简单/ 、/ 速度/ 快/ 、/ 延迟/ 低/ ,/ 然而/ ,/ 由于/ 大量/ 使用/ 非标准/ 或/ 随机/ 端口号/ 通信/ ,/ 该/ 方法/ 仅能/ 提供/ 不足/ 70/ %/ 的/ 识别/ 准确率/ [/ 1/ ]/ ./ 基于/ 有效载荷/ 的/ 分类/ 方法/ [/ 1/ -/ 6/ ]/ ,/ 又称/ 深包/ 检测/ 方法/ (/ DPI/ )/ ,/ 主要/ 通过/ 检测/ 数据包/ 中/ 协议/ 特征/ 字符串/ 进行/ 分类/ ./ 这种/ 方法/ 能够/ 达到/ 较/ 高/ 的/ 识别率/ 和/ 准确率/ ,/ 但是/ 计算/ 复杂性/ 高/ ,/ 存储/ 开销/ 大/ ,/ 且/ 不能/ 识别/ 加密/ 数据流/ ./ 基于/ 主机/ 的/ 分类/ 方法/ [/ 7/ -/ 9/ ]/ 通过/ 分析/ 数据流/ 的/ 社会/ 特征/ 进行/ 分类/ ./ 由于/ 不/ 涉及/ 有效载荷/ 且/ 计算/ 复杂度/ 不高/ ,/ 这种/ 方法/ 不仅/ 可以/ 识别/ 加密/ 流/ ,/ 还/ 能/ 提供/ 较/ 高/ 的/ 数据/ 吞吐/ 率/ ./ 基于/ 机器/ 学习/ 的/ 方法/ [/ 10/ -/ 11/ ]/ 将/ 网络/ 中/ 的/ 数据流/ 统计/ 特征/ (/ 如/ 平均/ 到达/ 时间/ 、/ 数据包/ 的/ 个数/ )/ 进行/ 抽取/ ,/ 形成/ 网络协议/ 特征/ 集/ 作为/ 流量/ 分类/ 的/ 标准/ ./ 其中/ ,/ 后/ 两者/ 的/ 分类/ 准确率/ 远/ 低于/ 基于/ 有效载荷/ 的/ 分类/ 方法/ ./ 总的来看/ ,/ 在/ 良好/ 的/ 协议/ 特征/ 支持/ 下/ ,/ 基于/ 有效载荷/ 的/ 分类/ 方法/ 可以/ 提供/ 最佳/ 的/ 识别率/ 和/ 识别/ 准确率/ ./ 此外/ ,/ 虽然/ DPI/ 方法/ 需要/ 较/ 高/ 的/ 计算/ 和/ 存储/ 开销/ ,/ 但/ 其/ 实现/ 简单/ 、/ 鲁棒且/ 更/ 符合/ 实时性/ 的/ 要求/ ./ 基于/ 深包/ 检测/ 的/ 分类/ 方法/ ,/ 本文/ 设计/ 并/ 实现/ 了/ 一个/ 基于/ FPGA/ 的/ 流量/ 分类/ 架构/ ,/ 其/ 主要/ 具有/ 以下/ 几个/ 特点/ :/ (/ 1/ )/ 高/ 吞吐/ 率/ ./ 在/ 高速/ 网络/ 环境/ 中/ ,/ 实时/ 流量/ 分类/ 设备/ 必须/ 具备/ 相应/ 的/ 处理/ 能力/ ./ 例如/ ,/ OC/ -/ 192/ (/ 10Gbps/ )/ 网络/ 满负荷/ 工作/ 时/ ,/ 要求/ 接入/ 的/ 实时/ 设备/ 每秒/ 处理/ 3125/ 万个/ 最/ 小包/ (/ 以太网/ 包长/ 64/ 字节/ )/ ./ 如果/ 在线/ 接入/ 设备/ 处理/ 能力/ 不足/ ,/ 就/ 会/ 出现/ 丢包/ 等/ 现象/ ./ RocketTC/ 提供数据/ 吞吐/ 率高达/ 20Gbps/ ,/ 满足/ 万兆级/ 高性能/ 网络/ 的/ 要求/ ./ (/ 2/ )/ 芯片级/ 设计/ ./ 受到/ 计算/ 和/ 存储资源/ 的/ 限制/ ,/ 现有/ 涉及/ 芯片/ 的/ 流量/ 识别方法/ 中/ ,/ 不是/ 使用/ 软硬件/ 相结合/ 的/ 方式/ [/ 12/ ]/ ,/ 就是/ 仅/ 支持/ 特定/ 应用/ 类型/ 数据流/ 的/ 硬件/ 方法/ [/ 13/ -/ 15/ ]/ (/ 如/ 多媒体/ 数据流/ )/ ./ 为了/ 达到/ 万兆级/ 吞吐/ 率/ ,/ 我们/ 针对/ FPGA/ 芯片/ 的/ 特性/ 设计/ 了/ 基于/ 片上/ 存储器/ (/ BlockRAM/ )/ 的/ 高效/ 流表/ 管理策略/ 和/ 具有/ 部分/ 动态/ 可/ 重构/ 特性/ [/ 16/ ]/ (/ PDR/ )/ 的/ 分类/ 引擎/ 阵列/ ,/ 使用/ 硬件/ 设计/ 解决/ 流量/ 分类/ 问题/ ,/ 减少/ 系统/ 瓶颈/ ./ (/ 3/ )/ 轻量级/ DPI/ 方法/ ./ 为了/ 提高/ 检测/ 效率/ 、/ 降低/ 资源/ 使用率/ ,/ RocketTC/ 采用/ 简化/ 的/ DPI/ 方法/ ,/ 仅/ 针对/ 部分/ 有效载荷/ (/ 前/ 32/ 字节/ )/ 进行/ 特征/ 检测/ ./ 理论/ 上/ ,/ 这种/ 轻量级/ 深包/ 检测/ 方法/ 可/ 覆盖/ 95/ %/ 以上/ 的/ 协议/ 特征/ 字/ 段/ [/ 12/ ]/ ./ (/ 4/ )/ 精简/ 协议/ 特征/ 集/ ./ 良好/ 的/ 协议/ 特征/ 是/ 保证/ DPI/ 方法/ 高/ 准确率/ 的/ 关键/ ./ 为了/ 达到/ 这个/ 目的/ ,/ 我们/ 设计/ 了/ 一套/ 针对/ 部分/ 有效载荷/ (/ 前/ 32/ 字节/ )/ 的/ 协议/ 特征/ 集/ ./ 实验/ 表明/ ,/ 在/ 这套/ 协议/ 特征/ 集/ 的/ 支持/ 下/ ,/ RocketTC/ 的/ 分类/ 准确率/ 可达/ 97/ %/ ./ (/ 5/ )/ 在线/ 更新/ 特性/ ./ RocketTC/ 使用/ 了/ 动态/ 可/ 重构/ 和/ 菊花链/ 式/ 引擎/ 配置/ 的/ 方式/ 实现/ 匹配/ 单元/ 和/ 协议/ 特征/ 的/ 在线/ 更新/ ,/ 在/ 整个/ 动态/ 更新过程/ 中/ ,/ 系统/ 始终/ 处于/ 正常/ 工作/ 状态/ ./ 本文/ 第/ 2/ 节/ 介绍/ 相关/ 研究/ 情况/ ;/ 第/ 3/ 节对/ RocketTC/ 整体/ 架构/ 进行/ 描述/ ;/ 第/ 4/ 、/ 5/ 节/ 介绍/ 流/ 管理/ 单元/ 和/ 流/ 分类/ 引擎/ 阵列/ 的/ 详细/ 设计/ ;/ 第/ 6/ 节/ 实验/ 结果/ 及/ 相关/ 分析/ ;/ 第/ 7/ 节/ 总结/ 全文/ ./ 2/ 相关/ 研究/ 近年来/ ,/ 很多/ 研究者/ 尝试/ 将/ FPGA/ 等/ 可编程/ 芯片/ 引入/ 流量/ 分类/ 系统/ 以/ 解决/ 系统/ 在/ 吞吐/ 率/ 方面/ 的/ 瓶颈/ ./ Luo/ 等/ 人/ [/ 13/ ]/ 将/ C4/ ./ 5/ 决策树/ 作为/ 突破点/ ,/ 在/ FPGA/ 上/ 实现/ 决策树/ 快速/ 查找/ ,/ 理论/ 上/ 大大提高/ 了/ 系统/ 吞吐/ 率/ ./ 然而/ ,/ 他们/ 并/ 没有/ 将/ 算法/ 进行/ 硬件/ 实现/ ,/ 无法/ 对/ 引入/ FPGA/ 的/ 影响/ 做/ 全面/ 评估/ ./ Canini/ 等/ 人/ [/ 12/ ]/ 提出/ 了/ 一个/ 软硬件/ 结合/ 方案/ ./ 他们/ 将/ 流量/ 分类/ 系统/ 中/ 计算/ 复杂性/ 高/ 、/ 内存/ 消耗/ 大/ 、/ 实时性/ 较/ 低/ 的/ 协议/ 分类/ 模块/ 用/ 软件/ 实现/ ,/ 实时性/ 高/ 的/ 流表/ 查找/ 模块/ 用/ 硬件/ 实现/ ./ 在/ NetFPGA/ 平台/ 上/ 的/ 实验/ 表明/ ,/ 系统/ 吞吐/ 率/ 最高/ 可达/ 8Mpps/ ,/ 基本/ 达到/ 千兆/ 线/ 速率/ 的/ 要求/ ./ 然而/ ,/ 其/ 软件/ 部分/ 仍/ 成为/ 系统/ 的/ 瓶颈/ ,/ 不仅/ 增加/ 了/ 整个/ 系统/ 的/ 延迟/ ,/ 还/ 不/ 支持/ 大量/ 数据流/ 并发/ 的/ 情况/ ./ Jiang/ 等/ 人/ [/ 14/ ]/ 设计/ 了/ 一个/ 基于/ FPGA/ 的/ 多媒体/ 流量/ 分类/ 系统/ ./ 这个/ 系统/ 使用/ FPGA/ 实现/ 近似/ K/ 最近/ 邻/ 算法/ 以/ 增加/ 吞吐/ 率/ ./ 最终/ 测试表明/ ,/ 在/ 保证/ 高/ 准确率/ 的/ 前提/ 下/ ,/ 系统/ 吞吐/ 率/ 可以/ 达到/ 约/ 80Gbps/ (/ 64/ 字节/ Page3/ 数据包/ )/ ./ 但是/ ,/ 这个/ 硬件/ 方法/ 只能/ 处理/ 多媒体/ 数据流/ ,/ 具有/ 较大/ 限制/ ./ 此外/ ,/ Khan/ 等/ 人/ [/ 15/ ]/ 提出/ 一个/ 基于/ FPGA/ 的/ 流量/ 疏导/ 图/ (/ trafficdispersiongraphs/ )/ 方法/ ./ 测试表明/ ,/ 系统/ 平均/ 吞吐/ 率/ 可达/ 7.4/ Mpps/ ,/ 平均/ 每个/ 疏导/ 图/ 包涵/ 10K/ 个/ 数据流/ ./ 综上/ 可见/ ,/ 目前/ 涉及/ 芯片/ 的/ 流量/ 分类/ 方法/ ,/ 不是/ 基于/ 软硬件/ 相结合/ 的/ 思想/ ,/ 就是/ 仅/ 针对/ 某种/ 特殊/ 应图/ 1RocketTC/ 架构/ 及/ 数据通路/ 帧/ 聚合/ 模块/ (/ FrameAggregation/ ,/ FA/ )/ 将/ 以太网/ 帧/ 进行/ 拆分/ ,/ 并/ 以/ 固定/ 位/ 宽/ 将/ IP/ 数据包/ 送入/ 包头/ 及/ 有效载荷/ 提取/ 模块/ (/ HeaderandPayloadExtraction/ ,/ HPE/ )/ ./ HPE/ 提取/ 数据包/ 五元/ 组/ ,/ 将/ 其/ 转发/ 到流/ 管理/ 模块/ (/ FlowManagement/ ,/ FM/ )/ 并/ 等待/ 处理结果/ ./ 如果/ 该/ 数据包/ 未/ 被/ 识别/ ,/ 则/ 将/ 其/ 信息/ 送入/ 流/ 分类/ 引擎/ 阵列/ (/ TrafficClassificationEngineArray/ ,/ TCEA/ )/ ;/ 否则/ 不/ 对/ 该/ 数据包/ 做/ 进一步/ 处理/ (/ 该包/ 所属/ 数据流/ 已/ 识别/ )/ ./ FM/ 管理/ 数据流/ 应用/ 信息/ ,/ 快速/ 过滤/ 已/ 识别/ 数据包/ ./ 其/ 对/ 数据包/ 五元/ 组做/ Hash/ 运算/ ,/ 并/ 由/ 所得/ Hash/ 值/ 索引/ 流表/ ./ 根据/ 命中/ 情况/ ,/ FM/ 单元/ 维护/ 流表/ 状态/ ,/ 并/ 将/ 查找/ 结果/ 反馈/ 到/ HPE/ 单元/ (/ 数据流/ 由/ 五元/ 组/ 区分/ )/ ./ 这部分/ 内容/ 将/ 在/ 第/ 4/ 节/ 详细描述/ ./ TCEA/ 模块/ 通过/ 特征/ 字符串/ 匹配/ 的/ 方式/ 对/ 数据包/ 有效载荷/ 进行/ 检测/ ./ 如果/ 识别/ 成功/ ,/ TCEA/ 将/ 结果/ 反馈/ 给/ FM/ 模块/ ,/ 并/ 促使/ 后者/ 记录/ 相关/ 数据流/ 信息/ ./ 这部分/ 将/ 在/ 第/ 5/ 节/ 详细/ 介绍/ ./ 4/ 流表/ 管理策略/ 流量/ 分类/ 结果/ (/ 流/ 信息/ 和/ 应用/ 标识/ )/ 以条/ 目的/ 形式/ 存储/ 在/ 流表/ ,/ 其/ 高性能/ 组织/ 是/ 影响/ 在线/ 设备/ 性能/ 的/ 主要/ 瓶颈/ 之一/ ./ 我们/ 设计/ 了/ 基于/ 片上/ 存储器/ 的/ 流表/ 管理策略/ ./ 功能/ 上/ 看/ ,/ 流表/ 管理/ 主要/ 包括/ 如下/ 内用/ 的/ 硬件/ 分类/ 方法/ ./ 目前/ 还/ 没有/ 一个/ 协议/ 覆盖/ 较为/ 全面/ 的/ 芯片级/ 解决方案/ ./ 3RocketTC/ 架构/ RocketTC/ 是/ 一个/ 芯片级/ 高/ 吞吐/ 率流/ 分类/ 系统/ 架构/ ,/ 如图/ 1/ 所示/ ./ 其中/ ,/ 网络/ 数据/ 由/ 以太网/ 控制器/ 送入/ 帧/ 聚合/ 模块/ ./ 容/ :/ (/ 1/ )/ 查询/ 流表/ ,/ (/ 2/ )/ 添加/ 条目/ 和/ (/ 3/ )/ 维护/ 条目/ 有效性/ ./ FM/ 模块/ 负责/ 维护/ 系统/ 流表/ ,/ 储存/ 已/ 识别/ 的/ 数据流/ 信息/ 和/ 分类/ 结果/ ./ 通过/ 查询/ 流表/ ,/ RocketTC/ 可以/ 快速/ 过滤/ 已/ 被/ 识别/ 的/ 数据包/ ,/ 极大/ 的/ 提高/ 了/ 系统/ 效率/ ./ 为了/ 达到/ 条目/ 管理/ 高性能/ ,/ FM/ 模块/ 采用/ 片上/ 存储器/ 和/ Hash/ 索引/ 的/ 方式/ 快速/ 定位/ 流表/ 条目/ ,/ 并/ 通过/ 分块/ 的/ 方式/ 减少/ Hash/ 冲突/ 率/ ./ 针对/ 成功/ 识别/ 的/ 流/ 信息/ 和/ 应用/ 标识/ ,/ FM/ 模块/ 为/ 其/ 添加/ 条目/ 并/ 存储/ 到/ 流表中/ ./ 同/ 传统/ 的/ “/ 先/ 添加/ ,/ 后/ 识别/ ”/ 方法/ [/ 12/ ]/ 不同/ ,/ RocketTC/ 采用/ “/ 先/ 识别/ ,/ 后/ 添加/ ”/ 的/ 设计/ ,/ 不仅/ 减少/ 了/ 流表/ 数量/ ,/ 降低/ 了/ 流表/ 维护/ 的/ 难度/ ,/ 还/ 避免/ 了/ 可能/ 针对/ 流表/ 的/ DDOS/ 攻击/ ./ 换句话说/ ,/ 系统/ 只/ 关心/ 那些/ 已/ 识别/ 的/ 数据流/ ./ 当/ 一个/ 流表/ 条目/ 失效/ (/ 其/ 标记/ 的/ 数据流/ 生命周期/ 结束/ )/ ,/ FM/ 模块/ 应/ 尽快/ 将/ 其/ 删除/ 以/ 减少/ 误报/ ./ 传统/ 遍历/ 流表/ 的/ 方法/ 不适/ 用于/ 高/ 吞吐/ 率/ 的/ 情况/ (/ 以/ 32768/ 个/ 条目/ ,/ 存储器/ 存取/ 周期/ 8ns/ 为例/ ,/ 一次/ 遍历/ 需要/ 约/ 524/ μ/ s/ ,/ 在/ 万兆/ 吞吐/ 率下/ 造成/ 至多/ 5000/ 个/ 数据包/ 丢失/ )/ ./ 因此/ ,/ 我们/ 设计/ 了/ 一个/ 高效/ 的/ 流表/ 管理策略/ ,/ 其中/ 包含/ 两个/ 重要/ 内容/ :/ 高性能/ 流表/ 数据结构/ 和/ 高效/ 的/ 条目/ 管理机制/ ./ 4.1/ 流表/ 设计/ 合理/ 的/ 数据结构/ 是/ 实现/ 高速/ 查找/ 表/ 的/ 关键/ ./ FM/ 模块/ 使用/ 片上/ 存储器/ (/ on/ -/ chipblockRAM/ )/ 存/ Page4/ 储流表/ 条目/ ,/ 并/ 通过/ Hash/ 索引/ 的/ 方式/ 进行/ 快速/ 查找/ ./ 流表/ 条目/ 由/ 部分/ 五元/ 组/ Hash/ 值/ (/ 流/ 特征/ )/ 、/ 流/ 类型/ (/ 应用层/ 协议/ 编号/ )/ 和/ 时间/ 标记/ 组成/ ,/ 如图/ 2/ 所示/ ./ 为了/ 实现/ 高速/ 查找/ ,/ 我们/ 使用/ Hash/ 函数/ 将/ 一个/ M/ 位/ (/ 此处/ 为/ 数据包/ 五元/ 组/ 的/ 数据位/ 宽/ ,/ 共/ 104/ 位/ )/ 数值/ 均匀/ 映射/ 到/ N/ 位/ (/ 64/ 位/ )/ 索引/ 值/ ./ 具体/ 到/ RocketTC/ 中/ ,/ 我们/ 使用/ 循环/ 冗余/ 检验/ 算法/ (/ CRC/ )/ 作为/ Hash/ 函数/ ,/ 因为/ CRC/ 算法/ 具有/ 相对/ 较/ 好/ 的/ 唯一性/ [/ 17/ ]/ ,/ 而且/ 具有/ 很/ 高/ 的/ 计算/ 性能/ ①/ ./ 如图/ 2/ 所示/ ,/ 我们/ 将/ 流表/ 存储/ 在/ FPGA/ 的/ 片/ 上/ 存储器/ ,/ 由/ 五元/ 组/ Hash/ 值/ 的/ 低/ 15/ 位/ 进行/ 索引/ ,/ 最多/ 可存/ 215/ 个块/ (/ bucket/ )/ ./ 此外/ ,/ 为了/ 降低/ 冲突/ 率/ ,/ 每个/ 块/ 可以/ 存放/ 4/ 个/ 条目/ (/ 具有/ 相同/ 的/ Hash/ 索引/ 值/ )/ ,/ 整个/ 流表/ 最/ 多/ 可/ 存储/ 217/ 个/ 条目/ ./ 具体来说/ ,/ 每个/ 条目/ 存储/ 48/ 位/ 数据/ ,/ 包括/ 32/ 位流/ 特征/ (/ signature/ )/ ,/ 8/ 位/ 协议/ 号/ (/ 自定义/ )/ 和/ 8/ 位/ 的/ 时间/ 戳/ (/ 由/ 高位/ 到/ 低位/ )/ ./ 其中/ 32/ 位流/ 特征/ 为/ 五元/ 组/ Hash/ 值/ 的/ 高/ 32/ 位/ ,/ 与/ 索引/ 流表/ 的/ Hash/ 值低/ 15/ 位/ 并/ 不/ 重复/ ./ 进行/ 索引/ 时/ ,/ FM/ 模块/ 将/ Hash/ 索引/ 的/ 一个/ 块/ 数据/ (/ 4/ 个/ 条目/ )/ 取出/ 进行/ 比/ 对/ ,/ 一个/ 时钟/ 周期/ 得到/ 结果/ ./ 由于/ 采用/ 了/ Hash/ 索引/ ,/ 流表/ 管理/ 中/ 可能/ 产生/ 冲突/ 问题/ (/ 两个/ 不同/ 的/ 数据流/ 得到/ 相同/ 的/ Hash/ 值/ )/ ,/ 这种/ 情况/ 我们/ 称为/ 假/ 阳性/ 错误/ ./ Prodanoff/ 等/ 人/ [/ 18/ ]/ 证明/ ,/ 最好/ 情况/ 下/ ,/ Hash/ 冲/ 概率/ 突/ 问题/ 符合/ 经典/ 的/ 生日/ 悖论/ 模型/ ./ 基于/ 此/ 结论/ ,/ 我们/ 由/ 以下/ 公式/ 估算/ 冲突/ 概率/ :/ Pcollision/ =/ 1/ -/ m/ !/ 其中/ ,/ m/ 是/ Hash/ 值/ 总/ 数量/ ,/ n/ 是/ 已经/ 被/ 占用/ 的/ 条目/ 数量/ ./ 为了/ 更/ 清晰/ 的/ 展示/ 和/ 评估/ 冲突/ 率/ 可能/ 产生/ 的/ 影响/ ,/ 我们/ 将/ 流表/ 使用率/ 作为/ 参数/ ,/ 计算/ 得到/ Hash/ 冲突/ 率/ ./ 由表/ 1/ 所示/ :/ 当流表/ 占用率/ 为/ 50/ %/ 时/ ,/ 添加/ 新条/ 目的/ 冲突/ 概率/ 为/ 1.5/ ×/ 10/ -/ 5/ ;/ 当流表/ 全部/ 被/ 占/ 满时/ ,/ 冲突/ 概率/ 依然/ 保持/ 在/ 6.1/ ×/ 10/ -/ 5/ ./ 流表/ 条目/ 中/ ,/ 除了/ 32/ 位/ 的/ 流/ 特征/ 外/ ,/ 还/ 包括/ 8/ 位/ 协议/ 号/ 和/ 8/ 位/ 时间/ 戳/ ./ 协议/ 号/ 标明/ 该/ 数据流/ 属于/ 哪个/ 网络应用/ ./ 由于/ 硬件资源/ 限制/ ,/ RocketTC/ 支持/ 92/ 个/ 应用/ ,/ 我们/ 使用/ 8/ 位/ 对/ 其/ 进行/ 标记/ ./ 条目/ 中/ 的/ 时间/ 戳/ 记录/ 了/ 条目/ 添加/ 或/ 最后/ 访问/ 的/ 时间/ ,/ 是/ 流/ 生命周期/ 管理机制/ 的/ 关键/ 标记/ ,/ 在/ 4.2/ 节中/ 详细/ 介绍/ ./ 流表/ 查找/ 和/ 添加/ 操作/ 针对/ 具体/ 条目/ 进行/ ./ 数据包/ 进入/ 系统/ 后/ ,/ FM/ 模块/ 根据/ 其/ 五元/ 组/ Hash/ 值/ 索引/ 流表/ ./ 如果/ 条目/ 已/ 存在/ ,/ 将/ 返回/ 已/ 识别/ 信号/ 并/ 结束/ 查找/ ;/ 如果/ 不/ 存在/ ,/ 则/ 指示/ HPE/ 将/ 数据包/ 相关/ 信息/ 送到/ TCEA/ 模块/ 进行/ 识别/ ./ TCEA/ 模块/ 将/ 识别/ 成功/ 的/ 分类/ 信息反馈/ 给/ FM/ 模块/ ,/ 并/ 促使/ 后者/ 添加/ 流表/ 条目/ ./ 4.2/ 生命周期/ 机制/ 由于/ 数据流/ 具有/ 时效性/ ,/ 流/ 管理/ 模块/ 必须/ 定期/ 将/ 过期/ 条目/ 进行/ 标记/ 和/ 删除/ (/ 常用/ 数据流/ 有效期/ 为/ 60s/ )/ ./ 为了/ 达到/ 这个/ 目的/ ,/ FM/ 模块/ 维护/ 一个/ 全局/ 时钟/ ,/ 每隔/ 一定/ 时间/ 递增/ (/ 10s/ )/ ./ 由于/ 系统资源/ 的/ 限制/ ,/ 我们/ 将/ 计数器/ 位宽/ 设为/ 8/ 位/ ,/ 这个/ 颗粒/ 度为/ 10s/ 的/ 全局/ 时钟/ 经过/ 2560s/ (/ 10/ ×/ 28/ )/ 循环/ 一个/ 周期/ ./ 添加/ 条目/ 时/ ,/ 流/ 管理/ 模块/ 将/ 系统/ 时间/ 作为/ 标记/ 插入/ 条目/ ./ 当/ 索引/ 到/ 条目/ 时/ ,/ 系统/ 通过/ 比较/ 当前/ 系统/ 时钟/ 与/ 条目/ 建立/ 时间/ 的/ 方式/ 验证/ 条目/ 实效性/ ./ 流/ 管理/ 模块/ 采用/ 触发/ 检查和/ 定期/ 清理/ 两种/ 方法/ 维护/ 流表/ 实效性/ ./ 系统/ 索引/ 到/ 某/ 条目/ 时/ ,/ 首先/ 判断/ 其/ 实效性/ ,/ 如果/ 过期/ ,/ 则/ 删除/ ./ 这种/ 触发式/ 的/ 删除/ 方法/ 可能/ 会/ 出现/ 某些/ 记录/ 长时间/ 没有/ 被/ 访问/ ,/ 一个/ 全局/ 时钟/ 周期/ 后/ 仍/ 有效/ 的/ 假/ 阳性/ 错误/ ./ 针对/ 这种/ 情况/ ,/ FM/ 模块/ 采用/ 了/ 定时/ 清空/ 机制/ ,/ 在/ 每个/ 全局/ 时钟/ 周期/ 固定/ 时间/ 清空/ 流表/ 条目/ ,/ 以/ 减少/ 假/ 阳性/ 错误/ ./ 系统/ 流表/ 共有/ 215/ 个块/ ,/ 清理/ 1/ 个块/ 需要/ 1/ 个/ 时钟/ 周期/ ,/ ①/ Xilinx/ ./ “/ Vertex/ -/ 5CyclicRedundancyCheck/ (/ CRC/ )/ Wizard/ ?/ Page5/ 共需/ 215/ 个/ 周期/ 完成/ 清理/ 操作/ ./ 在/ 芯片/ 时钟/ 周期/ 为/ 8ns/ 的/ 情况/ 下/ ,/ 整个/ 清理/ 操作/ 耗时/ 约/ 262/ μ/ s/ ./ FM/ 模块/ 判断/ 条目/ 有效性/ 和/ 定期/ 清空/ 机制/ 算法/ 如/ 算法/ 1/ 所示/ ./ 查找/ 开始/ 后/ ,/ 系统/ 先/ 检查/ 全局/ 时钟/ 是否/ 循环/ 了/ 一个/ 周期/ (/ 是否/ 重新/ 开始/ 计数/ )/ ./ 如果/ 是/ ,/ 则/ 清空/ 所有/ 流表/ 条目/ 开始/ 新/ 循环/ ,/ 并/ 将/ 当前/ 数据包/ 送入/ 识别/ 引擎/ 进行/ 识别/ ;/ 否则/ 进行/ 条目/ 查找/ ./ 算法/ 1/ ./ 超时/ 算法/ 伪/ 代码/ ./ 1/ ./ IFGlobeTimer/ =/ 0/ ,/ THEN2/ ./ clearAllFlowRecord3/ ./ forwardHash/ &/ PayloadtoTCEA4/ ./ ELSE5/ ./ IFFlowRecord5/ -/ tupleHashexistsTHEN6/ ./ λ/ ←/ |/ Timecurrent/ -/ Timetimestamp/ |/ 7/ ./ IF/ λ/ / θ/ THEN8/ ./ deleteFlowRecord5/ -/ tupleHash9/ ./ forwardHash/ &/ PayloadtoTCEA10/ ./ ELSE11/ ./ updateTimetimestamp12/ ./ reporthit13/ ./ ENDIF14/ ./ ELSE15/ ./ forwardHash/ &/ PayloadtoTCEA16/ ./ ENDIF17/ ./ ENDIF/ 系统/ 找到/ 相应/ 流表/ 条目/ 后/ ,/ 计算/ 其/ 时间/ 戳/ 与/ 全局/ 时钟/ 的/ 差/ λ/ ,/ 并/ 与/ 阈值/ θ/ 比较/ :/ 如果/ λ/ 大于/ θ/ ,/ 则/ 表明/ 此流表/ 已过期/ ,/ 删除/ 此子/ 条目/ ,/ 并/ 将/ 相应/ 数据/ 转到/ TCEA/ ;/ 否则/ 返回/ 查找/ 成功/ 信号/ ./ 在/ RocketTC/ 中/ ,/ θ/ 的/ 默认值/ 设为/ 6/ (/ 流表/ 条目/ 生命周期/ 为/ 60s/ )/ 与/ 通常/ 使用/ 的/ 数据流/ 生命周期/ 一致/ [/ 7/ ]/ ./ 5/ 流/ 分类/ 引擎/ 阵列/ 协议/ 识别/ 在/ 流量/ 分类/ 引擎/ 阵列/ (/ TCEA/ )/ 模块/ 完成/ ./ TCEA/ 模块/ 的/ 设计/ 主要/ 使用/ 轻量级/ 深包/ 检测/ 方法/ ,/ 具有/ 高/ 准确率/ ,/ 低/ 延迟/ 及/ 高/ 可扩展性/ 等/ 特点/ ./ 5.1/ 轻量级/ 分类/ 方法/ 为了/ 达到/ 高/ 准确率/ ,/ TCEA/ 模块/ 采用/ DPI/ 方法/ 对/ 数据包/ 进行/ 分类/ ./ 然而/ ,/ 传统/ DPI/ 方法/ (/ 如/ Aho/ -/ Corasick/ 算法/ )/ 将/ 数据包/ 的/ 全部/ 有效载荷/ 作为/ 检测/ 对象/ ,/ FPGA/ 有限/ 的/ 硬件资源/ 无法/ 承担/ 由此/ 带来/ 的/ 高/ 计算/ 复杂度/ 和/ 存储/ 消耗/ ./ 因此/ ,/ 我们/ 设计/ 了/ 一个/ 轻量级/ DPI/ 方法/ ,/ 在/ 保证/ 高/ 准确率/ 的/ 基础/ 上/ ,/ 大幅度/ 缩小/ 数据/ 检测/ 的/ 范围/ ,/ 从而/ 在/ 检测/ 准确率/ 与/ 资源/ 消耗/ 之间/ 达到/ 平衡/ ./ 轻量级/ DPI/ 检测/ 方法/ 要求/ 数据/ 检测/ 更具/ 针对性/ ./ Aceto/ 等/ 人/ [/ 3/ ]/ 对/ 当前/ 流行/ 的/ 正则表达式/ 分类器/ L7/ -/ filter/ 做/ 了/ 深入/ 的/ 分析/ 发现/ ,/ 几乎/ 所有/ 成功/ 识别/ 的/ 数据包/ 中/ ,/ 协议/ 特征/ 字符串/ 大多/ 开始/ (/ 99.98/ %/ )/ 并/ 结束/ (/ 90.77/ %/ )/ 于/ 有效载荷/ 的/ 前/ 32/ 个/ 字节/ ./ 由此可知/ ,/ 轻量级/ DPI/ 方法/ 的/ 准确率/ 理论/ 上/ 可以/ 达到/ 90/ %/ ./ 我们/ 采用/ 的/ 轻量级/ 分类/ 方法/ 具有/ 以下/ 几个/ 特征/ :/ 首先/ ,/ 轻量级/ 分类/ 方法/ 仅/ 检测/ 数据包/ 有效载荷/ 的/ 前/ 32/ 个/ 字节/ ;/ 其次/ ,/ 模式/ 集由/ 针对/ 固定/ 位置/ 的/ 协议/ 特征/ 构成/ ,/ 而/ 不是/ 复杂/ 的/ 正则表达式/ ./ 通过/ 对/ 协议/ 规范/ 及/ 当前/ 流行/ 分类/ 方法/ 进行/ 分析/ ,/ 我们/ 总结/ 了/ 可/ 支持/ 92/ 个/ 协议/ 的/ 特征/ 集/ ,/ 涵盖/ 了/ 包括/ 网页/ 浏览/ 、/ P2P/ 下载/ (/ 如/ 电驴/ )/ 、/ FTP/ 、/ 即时/ 通信/ (/ QQ/ 、/ MSN/ 等/ )/ 、/ 流媒体/ 、/ VOIP/ 、/ 网络游戏/ 等/ 主流/ 网络应用/ ,/ 见表/ 2/ ./ 网络应用/ HTTP/ / HTTP/ // 1.1/ ./ 200QQ2010/ / 0x020x1b0x550x00FTP/ / 220/ ./ / ftpCVS/ / BEGIN/ (/ AUTH/ |/ VERIFICATION/ |/ GSSAPI/ )/ POP3/ / (/ \/ +/ ok/ |/ -/ err/ )/ SSH/ / 0x530x530x480x2dTonghuashun/ / fdfdfdfd/ 注/ :/ / 表示/ 特征/ 从/ 用户/ 有效载荷/ 的/ 第一个/ 字节/ 开始/ ./ 5.2/ 流/ 分类/ 引擎/ 阵列/ 凭借/ FPGA/ 的/ 高/ 并行性/ 和/ 部分/ 动态/ 可/ 重构/ 特性/ ,/ 我们/ 设计/ 了/ 一个/ 高性能/ 、/ 支持/ 在线/ 更新/ 的/ TCEA/ 架构/ ,/ 如图/ 3/ 所示/ ,/ 整个/ 模块/ 由/ 配置/ 与/ 控制/ 单元/ (/ Configure/ &/ Control/ ,/ CC/ )/ 和/ 并行/ 排列/ 的/ 多条/ 分类/ 引擎/ 流水线/ 组成/ ./ (/ 1/ )/ 配置/ 与/ 控制/ 单元/ (/ CC/ )/ ./ CC/ 单元/ 主要/ 负责/ 两/ 部分/ 工作/ :/ 首先/ ,/ 配置/ 和/ 管理/ 静/ 、/ 动态/ 引擎/ 单元/ ,/ 保证/ 流水线/ 正常/ 工作/ ;/ 其次/ ,/ 处理/ CE/ 返回/ 的/ 匹配/ 结果/ ,/ 并/ 将/ 其/ 反馈/ 到流/ 管理/ 单元/ ./ CC/ 单元/ 支持/ 在线/ 配置/ 动态/ 引擎/ 协议/ 特征/ ,/ 且/ 在/ 配置/ 过程/ 中/ 不/ 影响/ 其它/ 模块/ 工作/ ./ 此外/ ,/ TCEA/ 的/ 分级/ 流水/ 引擎/ 只有/ 在/ 本/ 单元/ 没有/ 匹配/ 成功/ 的/ 情况/ 下/ ,/ 才/ 将/ 数据/ 转到/ 下/ 一个/ 单元/ ,/ 具有/ 固定/ 的/ 优先级/ ./ 当/ 不同/ 流水线/ 上/ 相同/ 优先级/ 的/ 引擎/ 单元/ 报告/ 匹配/ 时/ ,/ CC/ 单元/ 中/ 内置/ 的/ 仲裁/ 器/ 可以/ 根据/ 协议/ 优先级/ 做出/ 最终/ 裁决/ ,/ 保证/ 得到/ 最优/ 匹配/ 结果/ ./ (/ 2/ )/ 分类/ 引擎/ (/ CE/ )/ ./ CE/ 单元/ 以多/ 流水/ 方式/ 配置/ :/ 每个/ 引擎/ 单元/ 独立/ 识别/ 一个/ 网络应用/ 特征/ ,/ 多个/ CE/ 单元/ 串连/ 起来/ 组成/ 流水线/ ,/ 多条/ 流水/ 并行/ 组成/ Page6/ 图/ 3/ 流量/ 分类/ 引擎/ 阵列/ TCEA/ 的/ 数据通路/ ./ 当有/ 数据/ 进入/ TCEA/ 模块/ 时/ ,/ CC/ 单元/ 将/ 待/ 匹配/ 数据/ 同时/ 发送到/ 所有/ 并行/ 的/ 流水线/ ./ 由于/ 仅/ 针对/ 部分/ 有效载荷/ 进行/ 处理/ ,/ 分类/ 引擎/ 单元/ 采用/ 掩码/ 加/ 特征/ 字符串/ 的/ 方式/ 进行/ 识别/ ,/ 前者/ 标识/ 特征/ 位置/ ,/ 后者/ 存储/ 特征/ 内容/ ./ TCEA/ 分为/ 静态/ 和/ 动态/ 两个/ 区域/ ./ 静态/ 区域/ 由/ 系统/ 固化/ 的/ CE/ 单元/ 组成/ ,/ 这些/ 静态/ 引擎/ 不/ 支持/ 动态/ 可/ 重构/ 技术/ ,/ 但/ 可以/ 通过/ 读写/ 寄存器/ 的/ 形式/ 对/ 协议/ 特征/ 和/ 掩码/ 进行/ 修改/ ,/ 从而/ 改变/ 所/ 识别/ 协议/ 特征/ ./ 与/ 静态/ 引擎/ 不同/ ,/ 动态/ 区域/ 的/ CE/ 单元/ 可以/ 在/ 系统/ 工作/ 的/ 任何/ 时候/ 进行/ 重构/ (/ 重新分配/ 资源/ ,/ 更/ 有/ 识别/ 针对性/ )/ ,/ 且/ 在/ 更新过程/ 中/ 不会/ 影响/ 其它/ 流水线/ 工作/ ./ 动态/ 可/ 重构/ 功能/ 是/ RocketTC/ 的/ 一个/ 重要/ 特点/ ,/ 图/ 4/ 分类/ 引擎/ 如果/ 某/ CE/ 单元/ 匹配/ 成功/ ,/ 则/ 将/ 本/ 单元/ 对应/ 协议/ 号/ 和/ 五元/ 组/ Hash/ 值/ 反馈/ 到/ CC/ 单元/ ,/ 且/ 不再/ 转发/ 数据/ (/ 到/ 下个/ CE/ 单元/ )/ ;/ 如果/ 匹配/ 不/ 成功/ ,/ 则/ 将/ 待/ 测流/ 数据/ 和/ 相关/ 控制/ 信号/ 传递/ 给/ 本/ 流水线/ 下个/ CE/ 继续/ 检测/ ./ 流水线/ 式/ 的/ 设计/ 使/ CE/ 单元/ 功能/ 相对/ 独立/ ,/ 它/ 使/ RocketTC/ 具有/ 在线/ 配置/ 芯片/ 资源/ 的/ 特性/ ./ 此外/ ,/ 如果/ 用户/ 配置/ 的/ 单元/ 超过/ 最大/ 可/ 配置/ 单元/ 数/ ,/ TCEA/ 模块/ 会/ 按照/ 优先级/ 挑选/ 用户/ 最/ 关心/ 的/ 协议/ ./ RocketTC/ 系统/ 支持/ 92/ 个/ 网络应用/ 的/ 识别/ ,/ 分散/ 在/ 各个/ 引擎/ 单元/ 中/ ./ 如何/ 合理/ 的/ 部署/ 引擎/ 是/ 一个/ 值得/ 研究/ 的/ 问题/ ./ 例如/ ,/ 一个/ 数据流/ 可能/ 既/ 属于/ Gnutella/ 又/ 属于/ HTTP/ ,/ 当/ 两者/ 的/ CE/ 单元/ 同时/ 报告/ 匹配/ 成果/ 时/ ,/ CC/ 单元/ 根据/ 优先级/ 做出/ 裁决/ ,/ 将/ 高/ 优先级/ 的/ 匹配/ 结果/ 反馈/ 给/ FM/ ./ 我们/ 在/ 设计/ TCEA/ 单元/ 时/ ,/ 将/ 协议/ 优先级/ 与/ 协议/ 号/ 相对/ 应/ ,/ 简化/ 设计/ ./ 数据通路/ 和/ 控制/ 通/ 贯穿/ 整个/ CE/ 流水线/ ,/ 如图/ 4/ 所示/ ./ 数据通路/ 负责/ 传递/ 数据流/ 的/ Hash/ 值/ 和/ 有效载荷/ (/ 前/ 32/ 字节/ )/ ,/ 控制/ 通路/ 负责/ 传递/ 控制/ 信号/ ./ 从而/ 获得/ 高/ 扩展性/ ./ 在/ CE/ 单元/ 的/ 设计/ 中/ ,/ 我们/ 使用/ 引擎/ 计数器/ 判断/ 流水线/ 的/ 终端/ ./ 引擎/ 计数器/ 在/ 数据/ 进入/ 流水线/ 时/ 被/ 赋值/ ,/ 并/ 随着/ 流水线/ 进程/ 递减/ ./ 当/ 变量/ 为/ 0/ 时/ ,/ 表明/ 数据/ 已到/ 当前/ 流水线/ 的/ 终点/ ./ 综上所述/ ,/ TCEA/ 是/ 一个/ 快速/ 、/ 轻量级/ 、/ 高/ 准确/ Page7/ 率且/ 可/ 扩展/ 的/ 结构化/ 设计/ ./ 当前/ 实现/ 的/ 原型/ 系统/ 具有/ 4/ 条/ 流水线/ ,/ 支持/ 多达/ 92/ 个/ 协议/ 的/ 识别/ ./ 6/ 性能/ 评估/ 我们/ 基于/ 赛灵思/ Virtex/ -/ 5FX200TFPGA/ 的/ 可编程/ 芯片/ 平台/ 实现/ 了/ RocketTC/ 原型/ 系统/ ./ 本节/ 主要/ 就/ RocketTC/ 的/ 具体/ 性能/ 进行/ 评估/ 与/ 分析/ ,/ 所有/ 测试/ 均/ 在/ 实际/ 网络/ 环境/ 中/ 进行/ ./ 6.1/ 实验/ 设置/ (/ 1/ )/ 性能指标/ ./ 由于/ RocketTC/ 属于/ 芯片级/ 设计/ ,/ 我们/ 的/ 考核/ 指标/ 不仅/ 包括/ 准确率/ 等/ 软件/ 分类器/ 的/ 性能指标/ ,/ 还/ 对/ 芯片/ 资源/ 消耗/ 等/ 参数/ 进行/ 测量/ ./ 具体/ 性能指标/ 如下/ :/ ①/ 准确率/ :/ 正确/ 识别/ 流量/ 与/ 总流量/ 的/ 比例/ ./ ②/ 吞吐/ 率/ :/ 每秒/ 处理/ 数据包/ 的/ 数量/ (/ pps/ )/ ./ 这个/ 参数/ 与/ 数据包/ 大小/ 相乘/ 便/ 得到/ 每秒/ 传输/ 的/ 数据位/ (/ bps/ )/ ./ ③/ 延迟/ :/ 处理/ 一个/ 数据包/ 的/ 平均/ 时间/ ./ (/ 2/ )/ 数据/ 集/ ./ 本文/ 采用/ 某/ 高校/ 网络/ 出口/ 采集/ 的/ 30min/ 网络/ 数据/ 集/ 进行/ 评测/ ./ 这个/ 学校/ 的/ 有效/ 用户/ 约千人/ ,/ 主要/ 由/ 研究/ 人员/ 与/ 学生/ 组成/ ./ 数据/ 集/ 包含/ 了/ 所有/ 进出/ 数据流/ ,/ 具体/ 描述/ 如表/ 3/ 所示/ ./ 日期/ 时间/ IP地址/ 数据流/ 字节/ 2010/ -/ 05/ -/ 1030min1709525130627/ ./ 49GB/ (/ 3/ )/ 方法/ ./ 为了/ 在/ 真实/ 环境/ 下/ 测试/ RocketTC/ 的/ 各个/ 性能参数/ ,/ 我们/ 使用/ Tcpreplay/ 软件/ 重/ 放/ 测试数据/ 集/ ,/ 在线/ 部署/ 原型/ 系统/ ./ 本/ 实验/ 采用/ L7/ -/ filter/ 软件测试/ 结果/ 作为/ 流量/ 分类/ 结果/ 的/ 真值/ ./ 6.2/ 系统/ 吞吐/ 率/ 和/ 资源/ 使用率/ 首先/ ,/ 我们/ 对/ RocketTC/ 进行/ 吞吐/ 率/ 测试/ ./ 在/ TCEA/ 模块/ 中/ ,/ 4/ 条/ 流水线/ 并行/ 工作/ ,/ 每个/ 流水线/ 23/ 级/ 流水/ (/ CE/ )/ ,/ 可/ 识别/ 92/ 个/ 应用/ ./ 同时/ ,/ 我们/ 还/ 将/ 两条/ 流水线/ 划入/ 动态/ 区域/ ,/ 测试/ 系统/ 的/ 动态/ 部分/ 可/ 重构/ 性能/ ./ 整个/ 系统/ 的/ 实现/ 情况/ 如表/ 4/ 所示/ ./ Virtex/ -/ 5FX200T/ 芯片/ 共有/ 16Mb/ 片内/ 随机/ 存储器/ ,/ 分为/ 912/ 个块/ (/ block/ )/ ./ 我们/ 使用/ 了/ 其中/ 452/ 个/ 存储/ 块/ ,/ 实现/ 了/ 一个/ 可/ 存储/ 13.1/ 万条/ 目的/ 流表/ ./ 由于/ 引入/ 双口/ 随机/ 存储器/ (/ dual/ -/ portRAM/ )/ 和/ 多级/ 流水/ 等/ 特性/ ,/ RocketTC/ 最高/ 工作频率/ 为/ 220MHz/ ,/ 系统/ 吞吐/ 率/ 可达/ 70Mpps/ (/ 或/ 20Gbps/ ,/ 包/ 大小/ 为/ 64/ 字节/ )/ .#/ Slices11179/ ./ 03072036/ #/ BRAMs452/ ./ 091249/ 块/ 内存储器/ (/ Mb/ )/ 7.61647/ TCEA/ 可以/ 通过/ 动态/ 重构/ 支持/ 更/ 多/ 的/ 协议/ ./ 换句话说/ ,/ 只要/ 有/ 足够/ 的/ 硬件资源/ ,/ TCEA/ 可以/ 通过/ 动态/ 更新/ 的/ 方式/ 更改/ 分类/ 引擎/ 中/ 的/ 协议/ 特征/ ./ 实际上/ ,/ CE/ 单元/ 的/ LUT/ 使用量/ 与/ 特征/ 字符串/ 的/ 复杂度/ 有关/ ,/ 协议/ 的/ 特征/ 字符串/ 越/ 复杂/ ,/ 耗费/ 的/ 资源/ 就/ 越/ 多/ ./ 在/ 资源/ 使用/ 方面/ ,/ CE/ 单元/ 所/ 耗费/ 的/ LUT/ 数量/ 从/ 58/ (/ 5/ 个/ 特征/ 字符串/ )/ 到/ 252/ (/ 16/ 个/ 特征/ 字符串/ )/ 不/ 等/ ,/ 平均/ 为/ 135/ ./ 从/ 这个/ 趋势/ 来看/ ,/ 如果/ 使用/ 百万/ LUT/ 级别/ 的/ 新型/ FPGA/ ,/ RocketTC/ 可以/ 支持/ 最/ 多达/ 7000/ 个/ 网络协议/ ,/ 完全/ 满足/ 未来/ 几年/ 人们/ 对/ 流量/ 识别系统/ 的/ 要求/ ./ 另外/ ,/ 充足/ 的/ FPGA/ 资源/ 还/ 可以/ 为/ RocketTC/ 添加/ 数据/ 测量/ 和/ 网络应用/ 管理/ 等/ 更/ 复杂/ 的/ 功能/ ./ 6.3/ 系统/ 延迟/ 在/ 平均/ 处理/ 延迟/ 的/ 问题/ 上/ ,/ 我们/ 将/ RocketTC/ 与/ 其它/ 分类/ 方法/ 进行/ 对比/ ./ 本/ 实验/ 以/ 如下/ 几种/ 方法/ 作为/ 参考/ :/ (/ 1/ )/ 纯/ 软件/ 解决方案/ ,/ 包括/ L7/ -/ filter/ 和/ PortLoad/ [/ 3/ ]/ 和/ (/ 2/ )/ 结合/ 硬件/ 的/ 实现/ 方案/ AtoZ/ [/ 12/ ]/ 和/ 基于/ LSH/ 的/ 多媒体/ 分类器/ [/ 14/ ]/ ./ 运行/ L7/ -/ filter/ 的/ 计算机/ 采用/ 2.83/ GHz/ 的/ IntelCore2QuadCPU/ ,/ 装配/ 4GB/ 内存/ ./ 我们/ 以/ 最快/ 速度/ 响应/ 数据/ 捕获/ 以/ 测量/ 实际/ 延迟/ ./ 结果/ 归纳/ 如表/ 5/ ,/ 在/ 整个/ 测试/ 过程/ 中/ ,/ RocketTC/ 始终保持/ 很小/ 的/ 延迟/ (/ / 450ns/ )/ ,/ 且/ 没有/ 明显/ 的/ 丢/ 包/ 现象/ ./ 这个/ 结果表明/ ,/ 同/ L7/ -/ filter/ 相比/ ,/ RocketTC/ 的/ 延迟/ 要/ 比/ 前者/ 低/ 两个/ 数量级/ ./ 需要/ 注意/ 的/ 是/ ,/ 在/ 这些/ 分类/ 方法/ 中/ ,/ 只有/ LSH/ 的/ 性能/ 稍高于/ RocketTC/ ,/ 主要/ 有/ 下面/ 两个/ 原因/ ./ 首先/ ,/ LSH/ 实现/ 方法/ 并/ 没有/ 集成/ 网络接口/ ,/ 因此/ 减少/ 了/ 数据/ 进出/ 网口/ 的/ 延迟/ ./ 其次/ ,/ LSH/ 使用/ 机器/ 学习/ 的/ 方法/ ,/ 针对/ 多媒体/ 三大/ 分类/ 进行/ 处理/ ,/ 其/ 计算/ 复杂度/ 和/ 识别/ 协议/ 数量/ 远/ 低于/ 基于/ DPI/ 方法/ 的/ RocketTC/ ./ 此外/ ,/ 同/ RocketTC/ 识别/ 90/ %/ 以上/ 的/ 通用/ 流量/ 分类器/ 不同/ ,/ LSH/ 仅/ 识别/ 多媒体/ 数据流/ ./ 分类器/ 平均/ 延迟/ // μ/ s/ 方差/ // μ/ s2/ 加速/ 比/ L7/ -/ filter206/ ./ 9228532.58/ RocketTC0/ ./ 45PortLoad/ [/ 3/ ]/ 6.99/ AtoZ/ [/ 12/ ]/ 17.00/ LSH/ [/ 14/ ]/ 0.11/ N/ // A1880/ ./ 1Page86/ ./ 4/ 识别/ 准确率/ 为了/ 强化/ 对/ RocketTC/ 的/ 测试/ ,/ 我们/ 以/ 1min/ 为/ 跨度/ 对/ 准确率/ 进行/ 测量/ ,/ 如图/ 5/ 所示/ ./ 从/ 测试/ 结果/ 来看/ ,/ RocketTC/ 具有/ 很强/ 的/ 鲁棒性/ ,/ 成功/ 识别/ 超过/ 95/ %/ 的/ 数据流/ ,/ 且/ 准确率/ 高于/ 97/ %/ ./ 由/ 分析/ 可知/ ,/ RocketTC/ 不能/ 识别/ 或/ 错误/ 识别/ 数据流/ 的/ 原因/ 主要/ 有/ 以下几点/ :/ (/ 1/ )/ 计算/ 五元/ 组/ Hash/ 值/ 产生/ Hash/ 冲突/ (/ 即/ 不同/ 的/ 五元/ 组/ 得到/ 相同/ 的/ Hash/ 值/ )/ ,/ 流表/ 管理/ 模块/ 使用/ 冲突/ 的/ Hash/ 值/ 索引/ 流表/ 导致/ 假/ 阳性/ 错误/ ;/ (/ 2/ )/ 协议/ 特征/ 出现/ 在/ 检测/ 范围/ 之外/ ,/ RocketTC/ 不能/ 对/ 这些/ 特征/ 的/ 识别/ ,/ 产生/ 伪/ 阴性/ 错误/ ;/ (/ 3/ )/ RocketTC/ 所/ 使用/ 的/ DPI/ 方法/ 不能/ 识别/ 加密/ 数据流/ ./ 图/ 5Rocket/ 原型/ 系统/ 的/ 协议/ 识别率/ 与/ 准确率/ 7/ 结束语/ 针对/ 当前/ 数据流/ 分类/ 系统/ 的/ 不足/ ,/ 我们/ 提出/ 一个/ 基于/ 深包/ 检测/ 的/ 芯片级/ 架构/ ,/ 其/ 在/ 满足/ 实时/ 流量/ 分类/ 系统/ 高/ 吞吐/ 率/ 和/ 高/ 识别率/ 的/ 要求/ 下/ ,/ 提供/ 较强/ 的/ 扩展性/ ,/ 适合/ 当前/ 复杂/ 的/ 高速/ 网络/ 环境/ ./ 由于/ 使用/ 了/ 深包/ 检测/ 的/ 方法/ ,/ RocketTC/ 可以/ 提供/ 比/ 其他/ 方法/ 更佳/ 的/ 识别/ 准确率/ 和/ 颗粒/ 度/ ./ 同时/ ,/ 由于/ 使用/ 了/ 轻量级/ 深包/ 检测/ 检测/ 方法/ ,/ RocketTC/ 流量/ 分类/ 架构/ 更/ 适合/ 硬件/ 实现/ ./ 另外/ ,/ 由于/ 使用/ 了/ 高效/ 的/ 流/ 管理策略/ 和/ 高/ 并行/ 的/ 分类/ 引擎/ 阵列/ ,/ RocketTC/ 理论/ 上/ 可以/ 提供/ 高达/ 20Gbps/ 的/ 数据/ 吞吐能力/ ./ 实验/ 表明/ ,/ 以/ L7/ -/ filter/ 作为/ 参考/ ,/ RocketTC/ 支持/ 近/ 百个/ 协议/ ,/ 识别/ 了/ 超过/ 95/ %/ 的/ 网络流量/ ,/ 且/ 识别率/ 不/ 低于/ 97/ %/ ./ 同时/ 我们/ 认为/ ,/ 即将/ 上市/ 的/ 百万/ LUT/ 级/ FPGA/ 必然/ 可以/ 为/ RocketTC/ 的/ 性能/ 带来/ 较大/ 提升/ ./ 后续/ 的/ 研究/ 可以/ 从/ 以下/ 方面/ 展开/ ./ 首先/ ,/ 通过/ 重构/ ,/ RocketTC/ 可以/ 支持/ 更/ 多/ 应用/ 协议/ ./ 其次/ ,/ 将/ RocketTC/ 集成/ 到/ 网络/ 基础/ 设备/ 中/ ,/ 进行/ 更/ 贴近/ 实际/ 的/ 测试/ ./ 最后/ ,/ 我们/ 还/ 准备/ 对/ RocketTC/ 架构/ 做/ 修改/ ,/ 使/ 其/ 成为/ 具有/ 针对性/ 的/ 网络/ 测量/ 和/ 流量/ 管理系统/ ./ 

