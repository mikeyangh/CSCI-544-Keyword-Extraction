Page1/ 基于/ 汉明/ 重/ 的/ SMS4/ 密码/ 代数/ 旁路/ 攻击/ 研究/ 刘会英/ 1/ )/ 赵新杰/ 1/ )/ ,/ 2/ )/ 王韬/ 1/ )/ 郭/ 世泽/ 1/ )/ ,/ 2/ )/ 张帆/ 3/ )/ 冀/ 可可/ 1/ )/ 1/ )/ (/ 军械/ 工程学院/ 计算机/ 工程系/ 石家庄/ 050003/ )/ 2/ )/ (/ 北方/ 电子设备/ 研究所/ 北京/ 100083/ )/ 3/ )/ (/ 康涅狄格/ 大学/ 计算机科学/ 与/ 工程系/ 康涅狄格州/ 斯托斯/ 06269/ 美国/ )/ 摘要/ 基于/ 汉明/ 重/ 泄露/ 模型/ ,/ 对/ SMS4/ 算法/ 抗/ 代数/ 旁路/ 攻击能力/ 进行/ 了/ 评估/ ./ 首先/ 构建/ SMS4/ 算法/ 等价/ 布尔代数/ 方程组/ ,/ 然后/ 采集/ SMS4/ 加密/ 功耗/ 泄露/ ,/ 基于/ 模板/ 分析/ 对/ 加密/ 中间状态/ 字节/ 的/ 汉明/ 重/ 进行/ 推断/ ,/ 并/ 转化/ 为/ 与/ 密码/ 算法/ 联立/ 的/ 代数方程/ 组/ ,/ 最后/ 利用/ 解析器/ 进行/ 密钥/ 求解/ ./ 结果表明/ :/ SMS4/ 密码/ 易/ 遭受/ 代数/ 旁路/ 攻击/ ;/ 已知/ 明文/ 条件/ 下/ ,/ 2/ 个/ 样本/ 4/ 轮/ 连续/ 汉明/ 重/ 泄露/ 或/ 26/ 轮/ 离散/ 汉明/ 重/ 泄露/ 可/ 恢复/ 128bitSMS4/ 主/ 密钥/ ;/ 未知/ 明/ 密文/ 条件/ 下/ ,/ 2/ 个/ 样本/ 连续/ 5/ 轮/ 汉明/ 重/ 泄露/ 可/ 恢复/ 128bitSMS4/ 主/ 密钥/ ;/ 使用/ 随机/ 掩码/ 防御/ 的/ SMS4/ 实现/ 仍/ 不能/ 有效/ 防御/ 代数/ 旁路/ 攻击/ ,/ 已知/ 明文/ 条件/ 下/ ,/ 2/ 个/ 样本/ 连续/ 14/ 轮/ 汉明/ 重/ 泄露/ 可/ 恢复/ 128bitSMS4/ 主/ 密钥/ ./ 为/ 提高/ 攻击/ 实用性/ ,/ 提出/ 了/ 一种/ 容错/ 代数/ 旁路/ 攻击/ 方法/ ,/ 结果表明/ 汉明/ 重/ 推断/ 错误率/ 不/ 超过/ 60/ %/ 的/ 情况/ 下/ ,/ 2/ 个/ 样本/ 可/ 恢复/ 128bitSMS4/ 主/ 密钥/ ./ 本文/ 方法/ 对/ 其它/ 分组/ 密码/ 代数/ 旁路/ 攻击/ 研究/ 具有/ 一定/ 的/ 借鉴/ 意义/ ./ 关键词/ SMS4/ ;/ 代数/ 旁路/ 攻击/ ;/ 汉明/ 重/ ;/ 模板/ 分析/ ;/ 掩码/ 防护/ ;/ 容错/ 1/ 引言/ 密码/ 实现/ 需/ 依附/ 具体/ 物理/ 设备/ 平台/ ,/ 其/ 运行/ 过程/ 中/ 会/ 泄露/ 出/ 时间/ 、/ 功耗/ 、/ 电磁/ 等/ 旁路/ 信息/ ,/ 这种/ 利用/ 旁路/ 信息/ 进行/ 密钥/ 破解/ 的/ 方法/ 称为/ 旁路/ 攻击/ ./ 自/ Kocher/ 等/ 人于/ 1999/ 年/ 首次/ 提出/ 旁路/ 攻击/ [/ 1/ ]/ 以来/ ,/ 攻击/ 对象/ 趋于/ 多样化/ ,/ 分析方法/ 趋于/ 复杂化/ ./ 为/ 提高/ 攻击/ 效率/ ,/ 拓展/ 应用/ 场景/ ,/ 将/ 传统/ 密码/ 分析/ 与/ 旁路/ 攻击/ 结合/ 已/ 成为/ 近年来/ 密码/ 分析/ 的/ 一个/ 重要/ 研究/ 方向/ ./ 在/ INSCRYPT2009/ 上/ ,/ Renauld/ 等/ 人/ 首次/ 将/ 代数/ 攻击/ 和/ 旁路/ 攻击/ 相结合/ ,/ 提出/ 代数/ 旁路/ 攻击/ (/ AlgebraicSideChannelAttack/ ,/ ASCA/ )/ [/ 2/ -/ 3/ ]/ ./ 作为/ 一种/ 新/ 的/ 密码/ 分析方法/ ,/ 代数/ 旁路/ 攻击/ 克服/ 了/ 代数/ 攻击/ 方程组/ 求解/ 复杂度/ 高/ 的/ 缺点/ ,/ 同时/ 可/ 弥补/ 旁路/ 攻击/ 样本量/ 大/ 、/ 可/ 分析/ 轮数/ 少/ 、/ 通用性/ 差/ 等/ 不足/ ./ 此外/ ,/ 代数/ 旁路/ 攻击/ 还/ 拓展/ 了/ 旁路/ 攻击/ 适用范围/ ./ 对于/ 某些/ 密码/ 算法/ ,/ 攻击/ 可/ 在/ 未知/ 明/ 密文/ 条件/ 下/ 或/ 在/ “/ 一次/ 一密/ ”/ 运行/ 模式/ 下/ 成功/ ./ 鉴于/ 以上/ 优点/ ,/ 代数/ 旁路/ 攻击/ 自/ 提出/ 以来/ 即/ 受到/ 国内外/ 密码/ 学者/ 广泛/ 关注/ ./ 1.1/ 相关/ 工作/ 2009/ 年/ ,/ Renauld/ 等/ 人/ [/ 2/ -/ 3/ ]/ 首次/ 提出/ 代数/ 旁路/ 攻击/ 思想/ ,/ 基于/ 汉明/ 重/ 泄露/ 模型/ 在/ 8/ 位/ 微控制器/ 环境/ 下/ 对/ PRESENT/ 和/ AES/ 密码/ 进行/ 分析/ ./ 结果表明/ :/ 1/ 条/ 样本/ 功耗/ 轨迹/ 即可/ 恢复/ 完整/ PRESENT/ 和/ AES/ 完整/ 密钥/ ./ 随后/ ,/ Renauld/ 等/ 人/ [/ 4/ ]/ 对/ 影响/ 代数/ 旁路/ 攻击/ 效率/ 的/ 各种因素/ 进行/ 了/ 分析/ ./ 2010/ 年/ ,/ Oren/ 等/ 人/ [/ 5/ ]/ 提出/ 容错/ 代数/ 旁路/ 攻击/ (/ TolerantAlgebraicSide/ -/ ChannelAnalysis/ ,/ TASCA/ )/ ,/ 基于/ 伪/ 随机/ 布尔/ 优化/ 问题/ (/ PBOPT/ )/ 进行/ 密钥/ 恢复/ 和/ 容错/ 处理/ ,/ 可能/ 在/ 推断/ 错误率/ 不/ 大于/ 20/ %/ 条件/ 下/ 成功/ 恢复/ 密钥/ ./ 当前/ ,/ 代数/ 旁路/ 攻击/ 研究/ 正/ 处于/ 起步/ 阶段/ ,/ 现有/ 研究/ 工作/ 主要/ 存在/ 以下/ 不足/ :/ (/ 1/ )/ 主要/ 针对/ 密钥/ 扩展/ 方案/ 较/ 简单/ 的/ 算法/ 进行/ 研究/ ,/ 如/ PRESENT/ 、/ AES/ 、/ Keeloq/ 等/ ./ 针对/ 一些/ 密钥/ 扩展/ 方案/ 复杂/ 的/ 算法/ ,/ 如/ SMS4/ 等/ ,/ 现有/ 研究/ 工作/ 较/ 少/ ;/ (/ 2/ )/ 现有/ 攻击/ 方法/ 对于/ 旁路/ 信息/ 推断/ 错误/ 十分/ 敏感/ ,/ 容错/ 能力/ 较差/ ,/ 制约/ 了/ 攻击/ 实用性/ ./ SMS4/ 算法/ [/ 6/ ]/ 是/ 中国/ 公布/ 的/ 第一个/ 商用/ 分组/ 密码/ 算法/ ,/ 是/ 中国/ 无线/ 局域网/ 安全/ 标准/ WAPI/ 的/ 重要/ 组成部分/ ,/ 对/ 其/ 安全性/ 进行/ 研究/ 具有/ 重要/ 意义/ ./ 自/ 2006/ 年/ 公开/ 以来/ ,/ 密码/ 学者/ 对/ 其/ 进行/ 了/ 一系列/ 的/ 安全性/ 分析/ ,/ 主要/ 围绕/ 面向/ 设计/ 的/ 数学分析/ 和/ 面向/ 实现/ 的/ 旁路/ 攻击/ 两个/ 方面/ 开展/ ./ 在/ SMS4/ 传统/ 密码/ 分析/ 方面/ ,/ 钟名富/ 等/ 人/ [/ 7/ ]/ 根据/ SMS4/ 轮/ 结构/ 特点/ 对/ 14/ 轮/ SMS4/ 进行/ Square/ 攻击/ ,/ 所/ 需/ 明文/ 数据量/ 为/ 232/ 且/ 计算/ 复杂度/ 为/ 296.5/ ;/ 陈杰/ 等/ 人/ [/ 8/ ]/ 提出/ 一种/ 针对/ 17/ 轮/ SMS4/ 的/ 不/ 可能/ 差分/ 分析方法/ ,/ 所/ 需/ 的/ 选择/ 明文/ 为/ 2103/ 且/ 计算/ 复杂度/ 为/ 2124/ ;/ 张/ 美玲/ 等/ 人/ [/ 9/ ]/ 提出/ 一种/ 针对/ 22/ 轮/ SMS4/ 的/ 差分/ 分析方法/ ,/ 攻击/ 过程/ 需要/ 2117/ 个/ 选择/ 明文/ ,/ 且/ 时间/ 复杂度/ 为/ 2123/ ;/ Ji/ 等/ 人/ [/ 10/ ]/ 给出/ 了/ SMS4/ 在/ GF/ (/ 2/ )/ 和/ GF/ (/ 28/ )/ 方程组/ 描述/ ,/ 并/ 分析/ 了/ 利用/ XL/ 算法/ 估计/ 代数/ 攻击/ 的/ 复杂度/ ;/ Erickson/ 等/ 人/ [/ 11/ ]/ 分别/ 利用/ Gr/ ?/ bner/ 基/ 以及/ Minisat/ 对/ 5/ 轮/ SMS4/ 算法/ 进行/ 代数/ 分析/ ./ 总体/ 上/ ,/ 传统/ 密码/ 分析方法/ 数据/ 复杂度/ 和/ 计算/ 复杂度/ 较/ 高/ ,/ 难以/ 对/ 全轮/ SMS4/ 的/ 安全性/ 构成威胁/ ./ 在/ SMS4/ 密码/ 旁路/ 分析/ 方面/ ,/ 白雪/ 飞/ 等/ 人/ [/ 12/ ]/ 对/ SMS4/ 抗/ 功耗/ 分析/ 能力/ 进行/ 研究/ ,/ 在/ 仿真/ 环境/ 下/ 利用/ 5000/ 条/ 功耗/ 样本/ 成功/ 恢复/ SMS4/ 主/ 密钥/ ;/ 赵新杰/ 等/ 人/ [/ 13/ ]/ 提出/ 一种/ 针对/ SMS4/ 前/ 4/ 轮/ 和/ 后/ 4/ 轮/ 的/ 访问/ 驱动/ Cache/ 计时/ 攻击/ ,/ 80/ 个/ 样本/ 可/ 恢复/ SMS4/ 完整/ 密钥/ ;/ 张蕾/ 等/ 人/ [/ 14/ ]/ 、/ 李玮/ 等/ 人/ [/ 15/ ]/ 、/ Li/ 等/ 人/ [/ 16/ ]/ 分别/ 对/ SMS4/ 算法/ 抗/ 故障/ 攻击能力/ 进行/ 了/ 研究/ ./ 其中/ ,/ 最好/ 的/ 结果/ 第/ 29/ 轮/ 进行/ 1/ 字节/ 故障注入/ ,/ 将/ SMS4/ 主/ 密钥/ 搜索/ 空间/ 降至/ 222.11/ [/ 16/ ]/ ./ 可以/ 看出/ ,/ 当前/ 旁路/ 攻击/ 已/ 对/ SMS4/ 实现/ 的/ 物理/ 安全性/ 构成威胁/ ,/ 而且/ 将/ 随着/ 测试/ 计量/ 技术/ 及/ 仪器/ 的/ 发展/ 以及/ SMS4/ 的/ 广泛应用/ 而/ 扩大/ ./ 目前/ ,/ 在/ SMS4/ 代数/ 旁路/ 攻击/ 方面/ ,/ 尚未/ 发现/ 国内外/ 有/ 公开/ 发表/ 的/ 结果/ ./ 1.2/ 本文/ 的/ 贡献/ 攻击能力/ 进行/ 评估/ ,/ 主要/ 研究/ 贡献/ 如下/ :/ 本文/ 从/ 攻击/ 角度/ 对/ SMS4/ 密码/ 算法/ 抗/ 代数/ 旁路/ (/ 1/ )/ 提出/ 一种/ 针对/ SMS4/ 密码/ 的/ 代数/ 旁路/ 攻击/ ./ 前人/ 代数/ 旁路/ 攻击/ 大都/ 针对/ 密钥/ 扩展/ 简单/ 的/ 密码/ 算法/ ,/ 如/ PRESENT/ [/ 2/ ]/ 、/ AES/ [/ 3/ ]/ ,/ 其/ 相邻/ 轮/ 的/ 扩展/ 密钥/ 之间/ 具有/ 较强/ 的/ 相关性/ ,/ 恢复/ 了/ 任意/ 轮/ 密钥/ 就/ 基本/ 等价/ 于/ 恢复/ 主/ 密钥/ ./ 而/ 对于/ SMS4/ 来说/ ,/ 相邻/ 轮/ 扩展/ 密钥/ 之间/ 相关性/ 很/ 弱/ [/ 6/ ]/ ,/ 恢复/ 连续/ 4/ 轮/ 的/ 扩展/ 密钥/ 方可/ 恢复/ 出主/ 密钥/ ,/ 因此/ 攻击/ 难度很大/ ./ 首次/ 在/ 8/ 位/ 微控制器/ 上/ ,/ 基于/ 代数/ 旁路/ 攻击/ 对/ SMS4/ 安全性/ 进行/ 了/ 分析/ ./ 结果表明/ :/ 已知/ 或/ 未知/ 明/ Page3/ 密文/ 条件/ 下/ ,/ 2/ 个/ 样本/ 部分/ 轮/ 的/ 汉明/ 重/ 泄露/ 均/ 可/ 恢复/ 128bitSMS4/ 主/ 密钥/ ./ 同/ 现有/ 基于/ 功耗/ 的/ SMS4/ 旁路/ 攻击/ 相比/ ,/ 所/ 需/ 样本量/ 是/ 最小/ 的/ ,/ 同时/ 攻击/ 也/ 拓展/ 了/ 现有/ 密码/ 攻击/ 的/ 适用范围/ ,/ 可/ 在/ 未知/ 明/ 密文/ 场景/ 下/ 成功/ 实施/ ./ (/ 2/ )/ 提出/ 一种/ 基于/ 代数/ 旁路/ 攻击/ 的/ SMS4/ 掩码/ 防护/ 攻击/ 方法/ ./ 在/ 密码/ 实现/ 过程/ 中/ 加入/ 掩码/ [/ 17/ ]/ ,/ 使得/ 旁路/ 泄露/ 信息/ 与/ 真实/ 的/ 加密/ 中间状态/ 无关/ ,/ 是/ 现有/ 防御/ 功耗/ 旁路/ 攻击/ 的/ 最/ 有效/ 方法/ ./ 文中/ 研究/ 表明/ :/ 即使/ 是/ 带/ 掩码/ 防护/ 的/ SMS4/ 密码/ 实现/ ,/ 由于/ 旁路/ 泄露/ 仍/ 可/ 表示/ 为/ 密钥/ 信息/ 同/ 掩码/ 的/ 代数方程/ 组/ ,/ 对于/ 某些/ 特定/ 的/ 掩码/ 方案/ [/ 18/ ]/ ,/ 代数/ 旁路/ 攻击/ 仍然/ 可以/ 成功/ 实施/ ./ 结果表明/ :/ 已知/ 明文/ 条件/ 下/ ,/ 2/ 个/ 样本/ 仍/ 可/ 成功/ 恢复/ 128bitSMS4/ 主/ 密钥/ ./ (/ 3/ )/ 提出/ 一种/ 通用/ 的/ 容错/ 代数/ 旁路/ 攻击/ 策略/ ./ 在/ 攻击/ 过程/ 中/ ,/ 由于/ 环境噪声/ 和/ 测试/ 仪器/ 精度/ 的/ 影响/ ,/ 对于/ 加密/ 某个/ 中间状态/ 的/ 汉明/ 重/ 推断/ 常会/ 存在/ 一定/ 的/ 误差/ ,/ 研究/ 容错/ 代数/ 旁路/ 攻击/ 对于/ 提高/ 攻击/ 实用性/ 十分/ 重要/ ./ 对/ 错误/ 汉明/ 重/ 推断/ 可/ 选取/ 两种/ 策略/ :/ 一是/ 只/ 选取/ 区分/ 出来/ 推断/ 正确/ 的/ 汉明/ 重/ ,/ 转化/ 为/ 额外/ 方程组/ 同/ 密码/ 方程/ 进行/ 联立/ ,/ 另/ 一种/ 是/ 充分利用/ 所有/ 的/ 汉明/ 重/ 推断/ 信息/ ,/ 尤其/ 是/ 选取/ 合适/ 的/ 方法/ 表示/ 错误/ 的/ 汉明/ 重/ 推断/ ./ 前面/ 攻击/ [/ 2/ -/ 3/ ]/ 选取/ 了/ 第/ 1/ 种/ 策略/ ,/ 在/ 第/ 2/ 种/ 策略/ 方面/ ,/ 文献/ [/ 5/ ]/ 利用/ SCIP/ 进行/ 了/ 一定/ 的/ 研究/ ,/ 但/ 结果表明/ 该/ 方法/ 仅/ 对/ 密码/ 设计/ 较为简单/ 的/ Keeloq/ 密码/ 有效/ ,/ 对于/ 使用/ 了/ 复杂/ 的/ 非线性/ 变换/ (/ 如/ S/ 盒/ )/ 的/ 密码/ 算法/ (/ 如/ AES/ )/ ,/ 攻击/ 效果/ 欠佳/ ./ 实际/ 物理/ 实验/ 表明/ :/ 对/ 单条/ 功耗/ 曲线/ ,/ 汉明/ 重/ 推断/ 可能/ 存在/ 大约/ 正负/ 1/ 的/ 误差/ ./ 基于/ 该/ 误差/ ,/ 可/ 将/ 汉明/ 重/ 推断/ 值/ 转换/ 为/ 一个/ 有限/ 的/ 推断/ 值/ 集合/ ./ 文中/ 给出/ 了/ 一种/ 多/ 推断/ 值/ 的/ 代数方程/ 组/ 表示/ 方法/ ,/ 并/ 结合/ 汉明/ 重/ 旁路/ 泄露/ 模型/ 进行/ 攻击/ 应用/ ./ 结果表明/ :/ 本文/ 容错/ 策略/ 切实有效/ ,/ 在/ 汉明/ 重/ 推断/ 错误率/ 不/ 超过/ 60/ %/ 情况/ 下/ ,/ 攻击/ 仍/ 可/ 成功/ 恢复/ SMS4/ 主/ 密钥/ ./ 文中/ 容错/ 方法/ 可/ 适用/ 于/ AES/ 、/ Camellia/ 、/ ARIA/ 等/ 分组/ 密码/ 容错/ 代数/ 旁路/ 攻击/ ./ 1.3/ 结构/ 组织/ 本文/ 第/ 2/ 节对/ SMS4/ 密码/ 算法/ 进行/ 描述/ ;/ 第/ 3/ 节/ 分析/ 代数/ 旁路/ 攻击/ 模型/ ;/ 第/ 4/ 节/ 给出/ 基于/ 汉明/ 重/ 模型/ 的/ SMS4/ 代数/ 旁路/ 攻击/ 方法/ 及/ 若干/ 攻击/ 实验/ ;/ 第/ 5/ 节/ 给出/ 一种/ 有效/ 的/ 容错/ 代数/ 旁路/ 攻击/ 方案/ 及/ 攻击/ 实验/ ;/ 第/ 6/ 节/ 总结/ 全文/ ./ 2SMS4/ 算法/ 2.1/ 加密算法/ SMS4/ 迭代/ 轮数/ 为/ 32/ 轮/ ,/ 采用/ 非/ 平衡/ Feistel/ 结构/ 进行/ 设计/ ,/ 轮/ 函数/ 结构/ 如图/ 1/ 所示/ ./ SMS4/ 分组/ 长度/ 和/ 密钥/ 长度/ 均/ 为/ 128bit/ ,/ 加解密/ 算法/ 结构/ 相同/ ,/ 只是/ 轮/ 密钥/ 使用/ 顺序/ 相反/ [/ 6/ ]/ ./ 设/ 明文/ 输入/ 为/ (/ X0/ ,/ X1/ ,/ X2/ ,/ X3/ )/ ∈/ (/ F322/ )/ 4/ 分别/ 为/ 第/ i/ 轮/ 加密/ 的/ 输入/ 和/ 输出/ ,/ 则/ 第/ i/ 轮加/ 输出/ 为/ (/ Y0/ ,/ Y1/ ,/ Y2/ ,/ Y3/ )/ ∈/ (/ F32Xi/ +/ 2/ ,/ Xi/ +/ 3/ )/ ∈/ (/ F32/ (/ F32/ 密/ 表示/ 如下/ :/ Xi/ +/ 1/ =/ Xi/ ;/ Xi/ +/ 2/ =/ Xi/ +/ 1/ ;/ Xi/ +/ 3/ =/ Xi/ +/ 2/ ;/ Xi/ +/ 4/ =/ Xi/ / T/ (/ Xi/ +/ 1/ / Xi/ +/ 2/ / Xi/ +/ 3/ / RKi/ )/ ,/ 其中/ ,/ i/ =/ 0/ ,/ 1/ ,/ …/ ,/ 31/ 且/ RKi/ ∈/ F32T/ 变换/ 由/ 变换/ τ/ 和/ L/ 复合/ 而成/ ,/ 为/ 非线性/ 变换/ ,/ 由/ 4/ 个/ 并行/ 的/ S/ 盒/ 代换/ 构成/ ./ L/ 为/ 线性变换/ ,/ 表示/ 如下/ :/ L/ (/ x/ )/ =/ x/ / (/ x/ </ </ </ 2/ )/ / (/ x/ </ </ </ 10/ )/ / 2.2/ 密钥/ 扩展/ 算法/ 轮/ 密钥/ 扩展/ 算法/ 与/ 轮/ 函数/ 基本相同/ ,/ 只是/ 将/ 其中/ 的/ 线性变换/ L/ 修改/ 为/ L/ [/ 6/ ]/ :/ L/ (/ x/ )/ =/ x/ / (/ x/ </ </ </ 13/ )/ / (/ x/ </ </ </ 23/ )/ ,/ x/ ∈/ F32/ 设主/ 密钥/ 为/ K/ 且/ 系统/ 参数/ 为/ FK/ ,/ 则/ 第/ i/ 轮/ 密钥/ RKi/ 生成/ 过程/ 如下/ :/ k/ =/ (/ k0/ ,/ k1/ ,/ k2/ ,/ k3/ )/ =/ K/ / FK/ ,/ RKi/ =/ ki/ +/ 4/ =/ ki/ / L/ (/ τ/ (/ ki/ +/ 1/ / ki/ +/ 2/ / ki/ +/ 3/ / CKi/ )/ )/ ,/ 其中/ ,/ i/ =/ 0/ ,/ 1/ ,/ …/ ,/ 31/ ;/ FK/ =/ (/ 0xA3B1BAC6/ ,/ 0x56AA3350/ ,/ 0x677D9197/ ,/ 0xB27022Dc/ )/ ;/ CKi/ =/ (/ cki/ ,/ 0/ ,/ cki/ ,/ 1/ ,/ cki/ ,/ 2/ ,/ cki/ ,/ 3/ )/ 且/ cki/ ,/ k/ =/ 28i/ +/ 7k/ (/ mod256/ )/ ./ Page43/ 代数/ 旁路/ 攻击/ 模型/ 代数/ 旁路/ 攻击/ 模型/ 如图/ 2/ 所示/ ./ 其中/ ,/ P/ 、/ X/ 、/ C/ 图/ 2/ 代数/ 旁路/ 攻击/ 模型/ (/ 1/ )/ 密码/ 算法/ 方程组/ 构建/ ./ 将/ 密码/ 算法/ 表示/ 为/ 关于/ 明文/ P/ 、/ 中间状态/ X/ 、/ 密文/ C/ 以及/ 密钥/ K/ 的/ 代数方程/ 组/ ./ 对于/ SMS4/ ,/ 如何/ 构建/ S/ 盒/ 代数方程/ 组是/ 其/ 关键/ ./ 本文/ 借鉴/ 文献/ [/ 19/ ]/ 中/ 思想/ ,/ 基于/ 布尔/ 积/ 理论/ 构建/ SMS4/ 的/ S/ 盒/ 等价/ 代数方程/ 组/ ./ (/ 2/ )/ 旁路/ 信息/ 采集/ ./ 攻击者/ 通过/ 旁路/ 攻击/ 手段/ 采集/ 密码/ 算法/ 运行/ 过程/ 中/ 泄露/ 的/ 功耗/ 、/ 电磁/ 、/ 故障/ 等/ 旁路/ 信息/ L/ ,/ 并/ 进行/ 相应/ 的/ 预处理/ ./ (/ 3/ )/ 中间状态/ 推断/ 及/ 表示/ ./ 根据/ 采集/ 到/ 的/ 旁路/ 信息/ L/ ,/ 选取/ 相应/ 的/ 旁路/ 信息/ 泄露/ 模型/ M/ ,/ 利用/ 模板/ 分析/ [/ 20/ ]/ 等/ 方法/ 推断出/ 中间/ 状态值/ D/ ./ 然后/ ,/ 将/ D/ 转化/ 为/ 关于/ 中间/ 状态变量/ X/ 和/ 密钥/ 变量/ K/ 的/ 代数方程/ ./ (/ 4/ )/ 基于/ 代数方程/ 组/ 求解/ 的/ 密钥/ 恢复/ ./ 当/ 上述/ 方程组/ 构建/ 完成/ 后/ ,/ 剩余/ 工作/ 通过/ 代数方程/ 组/ 求解/ 进行/ 密钥/ 恢复/ ./ 典型/ 的/ 代数方程/ 组/ 求解/ 主要/ 包括/ SAT/ 问题/ 求解/ [/ 2/ ,/ 21/ -/ 22/ ]/ 、/ Gr/ ?/ bner/ 基/ 方法/ [/ 23/ -/ 24/ ]/ 、/ 线性化/ 方法/ 等/ ./ 本文/ 主要/ 基于/ SAT/ 问题/ 进行/ 代数方程/ 组/ 求解/ ,/ 选取/ CryptoMinisat/ 解析器/ 作为/ 求解/ 工具/ ./ 4SMS4/ 代数/ 旁路/ 攻击/ 4.1/ SMS4/ 代数方程/ 组/ 构建/ 对于/ SMS4/ ,/ S/ 盒/ 是/ 其/ 唯一/ 非线性/ 部件/ ./ 如何/ 有效/ 构建/ S/ 盒/ 代数方程/ 组是/ 方程组/ 构建/ 的/ 关键/ ./ 设/ S/ 分别/ 表示/ 明文/ 、/ 中间状态/ 字节/ 以及/ 密文/ ./ 由图/ 2/ 可以/ 看出/ ,/ 代数/ 旁路/ 攻击/ 大致/ 可以/ 分为/ :/ 密码/ 算法/ 方程组/ 表示/ 、/ 旁路/ 信息/ 采集/ 、/ 中间状态/ 推断/ 及/ 表示/ 以及/ 代数方程/ 组/ 求解/ 4/ 个/ 阶段/ ./ 盒/ 输入/ 比特/ 串为/ (/ x0/ ‖/ x1/ ‖/ x2/ ‖/ x3/ ‖/ x4/ ‖/ x5/ ‖/ x6/ ‖/ x7/ )/ ,/ 输出/ 比特/ 串为/ (/ y0/ ‖/ y1/ ‖/ y2/ ‖/ y3/ ‖/ y4/ ‖/ y5/ ‖/ y6/ ‖/ y7/ )/ ./ 通过/ 分析/ 真值表/ ,/ 并/ 引入/ 布尔/ 基本/ 积/ 变换/ [/ 19/ ]/ ,/ 可/ 表示/ 为/ GF/ (/ 2/ )/ 如下/ 形式/ 的/ 8/ 个/ 高阶/ 布尔方程/ :/ 其中/ ,/ 0/ / t/ </ 256/ 且/ 0/ / l/ </ 8/ ;/ t/ =/ t0/ +/ 2/ ×/ t1/ +/ …/ +/ 27/ ×/ ts/ -/ 1/ 且/ tl/ ∈/ {/ 0/ ,/ 1/ }/ ./ 假定/ (/ X0/ ,/ X1/ ,/ X2/ ,/ X3/ )/ ∈/ (/ F32/ 变量/ ,/ (/ X32/ ,/ X33/ ,/ X34/ ,/ X35/ )/ ∈/ (/ F32/ 变量/ ./ 引入/ 5/ 类/ 32bit/ 变量/ ./ 具体/ 为/ RKi/ 为/ 第/ i/ 轮/ 密钥/ 变量/ ;/ Wi/ 为/ 第/ i/ 轮/ S/ 盒/ 代换/ 输入/ ;/ Vi/ 为/ 第/ i/ 轮/ S/ 盒/ 代换/ 输出/ ;/ Ui/ 为/ 第/ i/ 轮/ 线性变换/ 输出/ ;/ Xi/ +/ 4/ 为/ 第/ i/ 轮/ 加密/ 轮/ 函数/ 输出/ ./ SMS4/ 加密/ 过程/ 可/ 转化/ 为/ 如下/ 布尔/ 方程组/ :/ 其中/ i/ =/ 0/ ,/ 1/ ,/ …/ ,/ 31/ ./ 根据/ 以上/ 方法/ ,/ 可/ 得到/ GF/ (/ 2/ )/ 上/ 关于/ 5248/ 个/ 变量/ 的/ 4352/ 个/ 方程/ ,/ 其中/ 包括/ 1024/ 个/ 非线性/ 方程/ 和/ Page53328/ 个/ 线性方程/ ./ 同样/ 可/ 构建/ 密钥/ 扩展/ 在/ GF/ (/ 2/ )/ 上/ 的/ 4096/ 个/ 方程/ ,/ 其中/ 非线性/ 方程/ 1024/ 个/ ,/ 线性方程/ 3072/ 个/ ;/ 共/ 包含/ 4224/ 个/ 变量/ ,/ 其中/ 密钥/ 变量/ 为/ 1152/ 个/ ./ 对/ 完整/ 32/ 轮/ SMS4/ 加密/ ,/ 得到/ 关于/ 9472/ 个/ 变量/ 的/ 9472/ 个/ 方程/ ./ 实际/ 攻击/ 中/ ,/ 一般/ 仅/ 需/ 建立/ 部分/ 轮/ 方程组/ 即可/ ./ 4.2/ 基于/ SAT/ 的/ 代数方程/ 组/ 求解/ 基于/ SAT/ 进行/ 方程组/ 求解/ ,/ 首先/ 须/ 将/ 方程组/ 转化/ 为/ CNF/ (/ 合取范式/ )/ ,/ 一般/ 包括/ 如下/ 步骤/ :/ (/ 1/ )/ 降幂/ 操作/ ./ 对于/ 每个/ 次数/ d/ >/ 1/ 的/ 单项式/ ,/ 引入/ 1/ 个/ 变量/ 和/ d/ +/ 1/ 个/ CNF/ 子句/ 进行/ 替换/ ./ (/ 2/ )/ 线性方程/ 转换/ CNF/ ./ 对于/ 长度/ 为/ L/ 的/ 线性方程/ ,/ 可/ 将/ 其/ 转化/ 为/ 2L/ -/ 1/ 个/ CNF/ 子句/ 的/ 合取/ ,/ 其中/ ,/ 每个/ 合取/ 子句/ 又/ 分别/ 为/ m/ 个/ 变量/ (/ 其中/ m/ -/ 1/ 个/ 变量/ 取反/ )/ 的/ 析取/ 且/ m/ 为/ 大于/ 0/ 且/ 不/ 大于/ L/ 的/ 偶数/ ./ 当/ 转化/ 为/ CNF/ 子句/ 后/ ,/ 剩下/ 的/ 工作/ 根据/ CNF/ 子句/ 生成/ CryptMinisat/ 解析器/ 所/ 需/ 的/ txt/ 文件/ [/ 22/ ]/ ./ 下面/ ,/ 以/ 非线性/ 布尔方程/ x0/ +/ x1/ +/ x1x2x3/ +/ x0x1x2x3/ =/ 0/ 为例/ 进行/ 说明/ ./ 首先/ ,/ 进行/ 降幂/ 操作/ ./ 引入/ 两个/ 变量/ p/ 和/ q/ ,/ 其中/ p/ =/ x1x2x3/ 且/ q/ =/ x0x1x2x3/ ,/ 则/ 有/ :/ x1/ ∨/ p/ =/ 1/ ,/ x2/ ∨/ p/ =/ 1/ ,/ x3/ ∨/ p/ =/ 1/ ,/ x1/ ∨/ x2/ ∨/ x3/ ∨/ p/ =/ 1/ ;/ x0/ ∨/ q/ =/ 1/ ,/ x1/ ∨/ q/ =/ 1/ ,/ x2/ ∨/ q/ =/ 1/ ,/ x3/ ∨/ q/ =/ 1/ ,/ x0/ ∨/ x1/ ∨/ x2/ ∨/ x3/ ∨/ q/ =/ 1/ ./ 然后/ ,/ 将/ 方程/ x0/ +/ x1/ +/ p/ +/ q/ =/ 0/ 转化/ 为/ 如下/ CNF/ :/ 图/ 3SMS4/ 汉明/ 重/ 信息/ 采集/ 点/ 选取/ (/ x0/ ∨/ x1/ ∨/ p/ ∨/ q/ )/ ∧/ (/ x0/ ∨/ x1/ ∨/ p/ ∨/ q/ )/ ∧/ (/ x0/ ∨/ x1/ ∨/ p/ ∨/ q/ )/ ∧/ (/ x0/ ∨/ x1/ ∨/ p/ ∨/ q/ )/ ∧/ (/ x0/ ∨/ x1/ ∨/ p/ ∨/ q/ )/ ∧/ (/ x0/ ∨/ x1/ ∨/ p/ ∨/ q/ )/ ∧/ (/ x0/ ∨/ x1/ ∨/ p/ ∨/ q/ )/ ∧/ (/ x0/ ∨/ x1/ ∨/ p/ ∨/ q/ )/ =/ 1/ ./ 通过/ 对/ 完整/ SMS4/ 算法/ 代数方程/ 组/ 进行/ 转化/ ,/ 可/ 得到/ 关于/ 84865/ 个/ 变量/ 的/ 342922/ 个/ CNF/ 子句/ ./ 4.3/ 功耗/ 信息/ 采集/ 实验/ 中/ ,/ 在/ 8/ 位/ AVR/ 微控制器/ 上/ 实现/ SMS4/ 加密/ 程序/ ./ 为/ 采集/ 微控制器/ 功耗/ 变化/ ,/ 在/ 微控制器/ 接地/ 端/ 和/ 稳压电源/ 之间/ 串联/ 一个/ 电阻/ ./ 通过/ 差分/ 探头/ 接/ 电阻/ 的/ 两端/ ,/ 将/ 微控制器/ 的/ 功耗/ 信号/ 传给/ 示波器/ 进行/ 采集/ 并经/ USB/ 传输/ 到/ PC机/ 进行/ 处理/ ./ 示波器/ 的/ 采集/ 过程/ 由/ PC机/ 上用/ LabView/ 编写程序/ 实现/ 自动控制/ (/ 参数/ 见表/ 1/ )/ ./ 实际/ 实验/ 中/ ,/ 电压/ 设置/ 为/ 5V/ ,/ 微控制器/ 工作频率/ 为/ 8MHz/ ,/ 数字/ 示波器/ 采样/ 频率/ 为/ 100MS/ // s/ ./ 设备/ 微控制器/ ATMETGA324P/ :/ 1KBEEPROM/ ,/ 2KBSRAM/ ,/ 数字/ 示波器/ MSO6012A/ :/ 最大/ 采样/ 频率/ 2GS/ // s/ 电源/ 电阻/ SMS4/ 算法/ 主要/ 包括/ 轮/ 密钥/ 加/ 、/ 非线性/ 变换/ S/ 盒/ 、/ 线性变换/ L/ 及轮/ 白化/ 4/ 类/ 操作/ ./ 实验/ 过程/ 中/ 主要/ 采集/ 轮/ 密钥/ 加/ 、/ 非线性/ 变换/ 以及/ 轮/ 白化/ 操作/ 泄露/ 的/ 汉明/ 重/ ./ 如图/ 3/ 所示/ ./ 每轮/ 加密/ 有/ 12/ 个/ 采集/ 点/ ,/ 整个/ 加密/ 过程/ 共有/ 12/ ×/ 31/ +/ 8/ =/ 380/ 个/ 采集/ 点/ ./ 需要/ 说明/ 的/ 是/ ,/ 实际/ 攻击/ 中仅/ 需/ 采集/ 部分/ 轮/ 的/ 汉明/ 重/ 泄露/ ./ Page64/ ./ 4/ 基于/ 模板/ 分析/ 的/ 汉明/ 重/ 推断/ 功耗/ 采集/ 阶段/ ,/ 利用/ 前面/ 的/ 实验/ 配置/ ,/ 采集/ 并/ 存储/ 微控制器/ 执行/ SMS4/ 加密/ 过程/ 中/ 泄露/ 的/ 功耗/ 信息/ ./ 然后/ 从/ 功耗/ 轨迹/ 中/ 分别/ 找出/ 每轮/ 加密/ 过程/ 中轮/ 密钥/ 加/ 、/ 非线性/ 变换/ 、/ 轮/ 白化/ 等/ 操作/ 对应/ 的/ 功耗/ 轨迹/ 部分/ ./ 微控制器/ 中/ ,/ 密码/ 算法/ 运行/ 过程/ 中/ 泄露/ 的/ 功耗/ 信息/ 和/ 操作数/ 的/ 汉明/ 重/ 之间/ 具有/ 很强/ 的/ 相关性/ [/ 1/ ]/ ./ 因此/ ,/ 基于/ 采集/ 到/ 的/ 功耗/ 轨迹/ 可推断/ 加密/ 过程/ 中/ 各个/ 操作/ 对应/ 的/ 中间状态/ 字节/ 汉明/ 重/ ./ SMS4/ 加密/ 过程/ 第/ 3/ 轮中轮/ 密钥/ 加/ 操作/ 对应/ 的/ 功耗/ 轨迹/ 部分/ 如图/ 4/ 所示/ ./ 由图/ 4/ 可以/ 看出/ ,/ 每轮/ SMS4/ 轮/ 密钥/ 加/ 操作/ 可/ 拆/ 分为/ 4/ 个/ 8/ 位/ 异或/ 操作/ ./ 令/ 第/ 1/ 个/ 8/ 位/ 异或/ 操作/ 为/ AK1/ ./ 图/ 4/ 加密/ 第/ 3/ 轮中轮/ 密钥/ 加/ 操作/ 对应/ 的/ 功耗/ 轨迹/ 在/ ATMETGA324P/ 上/ 分别/ 执行/ 不同/ 操作数/ 汉明/ 重/ 的/ AK1/ 操作/ 各/ 1000/ 次/ ,/ 采集/ 对应/ 功耗/ 泄露/ 并求/ 均值/ ,/ 不同/ 汉明/ 重/ (/ HW/ )/ 对应/ 的/ 功耗/ 轨迹/ 如图/ 5/ 所示/ ./ 本文/ 基于/ 模板/ 分析方法/ ,/ 对/ 加密/ 中间状态/ 字节/ 的/ 汉明/ 重/ 进行/ 推断/ ,/ 分析/ 过程/ 包括/ 模板/ 搭建/ 和/ 模板/ 匹配/ 两个/ 阶段/ ./ 在/ 模板/ 搭建/ 阶段/ ,/ 根据/ 已知/ 中间状态/ 字节/ 的/ 汉明/ 重/ 和/ 对应/ 的/ 功耗/ 轨迹/ ,/ 为/ 9/ 个/ 不同/ 的/ 汉明/ 重量/ (/ 0/ ~/ 8/ )/ 分别/ 构建/ 由/ 均值/ 向量/ 和/ 噪声/ 向量/ 协方差/ 矩阵/ 组成/ 的/ 二元/ 组/ :/ 其中/ ,/ 狋/ i/ 为/ 均值/ 向量/ ;/ 犌/ i/ 为/ 噪声/ 协方差/ 矩阵/ ,/ 详细/ 计算/ 过程/ 可/ 参考文献/ [/ 20/ ]/ ./ 为/ 精确/ 搭建/ 汉明/ 重/ 模板/ ,/ 需/ 采集/ 大量/ 功耗/ 轨迹/ ,/ 实际/ 攻击/ 中/ n/ =/ 1000/ 次/ ./ 模板/ 搭建/ 完成/ 后/ ,/ 将/ 实际/ 测量/ 的/ 功耗/ 轨迹/ t/ 与/ 搭建/ 的/ 汉明/ 重/ 模板/ 进行/ 模板/ 匹配/ ,/ 具体方法/ 如下/ :/ p/ (/ t/ ;/ 〈/ 狋/ i/ ,/ 犌/ i/ 〉/ )/ =/ 1/ (/ 2/ π/ )/ m/ |/ 犌/ i/ 槡/ |/ 根据/ 极大/ 似然/ 法则/ ,/ p/ (/ t/ ;/ 〈/ 狋/ i/ ,/ 犌/ i/ 〉/ )/ 最大值/ 对应/ 的/ 汉明/ 重即/ 为/ 该/ 中间状态/ 字节/ 汉明/ 重/ 推断/ 值/ ./ 代数/ 旁路/ 攻击/ 中/ SAT/ 解析器/ 对/ 汉明/ 重/ 推断/ 错误/ 十分/ 敏感/ ./ 实际/ 情况/ 下/ ,/ 由于/ 环境噪声/ 的/ 存在/ ,/ 功耗/ 信息/ 采集/ 过程/ 中/ 的/ 误差/ 不可避免/ ,/ 从而/ 可能/ 会/ 导致/ 推断出/ 的/ 中间状态/ 字节/ 汉明/ 重/ 和/ 实际/ 汉明/ 重/ 不符/ ./ 因此/ ,/ 需要/ 对/ 中间状态/ 字节/ 汉明/ 重/ 推断/ 值/ 进行/ 差错/ 检测/ ,/ 典型/ 差错/ 检测/ 方法/ 如下/ :/ (/ 1/ )/ 通过/ 判断/ S/ 盒/ 输入/ 、/ 输出/ 中间状态/ 字节/ 的/ 汉明/ 重/ 推断/ 值/ 是否/ 满足/ S/ 盒/ 的/ 输入输出/ 关系/ ./ 如果/ 不/ 满足/ ,/ 则/ 该/ S/ 盒/ 输入/ 、/ 输出/ 中间状态/ 字节/ 发生/ 汉明/ 重/ 推断/ 错误/ ./ (/ 2/ )/ 根据/ 功耗/ 轨迹/ 与/ 汉明/ 重/ 模板/ 匹配/ 的/ 极大/ 似然/ 概率/ 和/ 设定/ 阈值/ σ/ (/ 具体/ 取决于/ 所/ 执行/ 操作/ )/ 来/ 判定/ 功耗/ 点/ 相比/ 来/ 判定/ 是否/ 出错/ ,/ 如果/ 小于/ σ/ ,/ 则/ 认为/ 发生/ 汉明/ 重/ 推断/ 错误/ ./ 实验/ 中/ 发现/ ,/ 对/ 同一/ 加密/ 重复/ 进行/ 5/ 次/ 测量/ 并/ 计算/ 平均/ 功耗/ 曲线/ ,/ 可/ 达到/ 98/ %/ 以上/ 的/ 汉明/ 重/ 推断/ 正确率/ ./ 4.5/ 汉明/ 重/ 信息/ 的/ 布尔/ 函数/ 表示/ 对于/ 长度/ 为/ n/ 的/ 二值/ 向量/ 犡/ =/ (/ x1/ ,/ x2/ ,/ …/ ,/ xn/ )/ ,/ 可能/ 的/ 汉明/ 重值/ 有/ n/ +/ 1/ 个/ ,/ 可用/ 长度/ 为/ k/ 的/ 二值/ 向量/ 犢/ =/ (/ y1/ ,/ y2/ ,/ …/ ,/ yn/ )/ 对/ 其/ 汉明/ 重/ HW/ (/ X/ )/ 进行/ 表示/ :/ yl/ =/ ∑/ p/ 其中/ ,/ p/ =/ n/ 对于/ 8bit/ 的/ 中间状态/ 字节/ X/ ,/ 有/ 9/ 种/ 可能/ 的/ 汉明/ 重/ HW/ (/ X/ )/ ,/ 且/ 0/ / HW/ (/ X/ )/ / 8/ ./ 其/ 汉明/ 重/ HW/ (/ X/ )/ 可以/ 用/ 4bit/ 二值/ 向量/ 犢/ =/ (/ y1/ ,/ y2/ ,/ y3/ ,/ y4/ )/ 进行/ 表示/ :/ Page7y1/ =/ ∏/ 8/ 烄/ y2/ =/ ∑/ 70/ 烅/ y3/ =/ ∑/ 28y4/ =/ ∑/ 8/ 烆/ i/ 当/ 汉明/ 中/ 推断/ 值/ 确定/ 后/ ,/ 可以/ 通过/ 上述/ 方法/ 构建/ 关于/ 加密/ 中间状态/ 字节/ X/ 的/ 布尔代数/ 方程组/ ,/ 并/ 与/ SMS4/ 加密/ 代数方程/ 组/ 进行/ 联立/ ,/ 从而/ 降低/ 密钥/ 求解/ 复杂度/ ./ 4.6/ 攻击/ 实验/ 及/ 比较/ 分析/ 在/ 普通/ PC机/ 器上/ (/ CPU/ 为/ Pentium/ (/ R/ )/ Dual/ -/ CoreE54002/ ./ 7GHz/ ,/ 内存/ 2GB/ )/ 利用/ CryptoMinisat2/ ./ 90/ 进行/ 攻击/ 实验/ ./ 攻击/ 场景/ 分为/ 已知/ 明文/ 连续/ 汉明/ 重/ 泄露/ 、/ 未知/ 明/ 密文/ 连续/ 汉明/ 重/ 泄露/ 、/ 已知/ 明文/ 离散/ 汉明/ 重/ 泄露/ 、/ 未知/ 明/ 密文/ 离散/ 汉明/ 重/ 泄露/ 4/ 种/ ./ 首先/ 在/ 已知/ 明文/ 、/ 连续/ 汉明/ 重/ 泄露/ 条件/ 下/ ,/ 对/ SMS4/ 代数/ 旁路/ 攻击/ 的/ 旁路/ 泄露/ 下限/ 以及/ 求解/ 时间/ 特性/ 进行/ 分析/ ,/ 然后/ 进行/ 不同/ 场景/ 下/ 不同/ 轮数/ 汉明/ 重/ 泄露/ 的/ 攻击/ 实验/ 及/ 分析/ ,/ 最后/ ,/ 对/ 添加/ 掩码/ 防护/ 的/ SMS4/ 算法/ 实现/ 进行/ 攻击/ 实验/ ./ 当/ SAT/ 求解/ 器/ 的/ 求解/ 时间/ 超过/ 7200s/ ,/ 视为/ 攻击/ 失败/ ./ 后续/ 实验/ 结果/ 均/ 是/ 在/ 2/ 个/ 样本/ 条件/ 下/ 得到/ 的/ ./ (/ 1/ )/ 基于/ SAT/ 的/ 密钥/ 求解/ 时间/ 分布/ 特性/ 分析/ ./ 通过/ 对/ 同一/ 加密/ 过程/ 进行/ 多次/ 采集/ 保证/ SMS4/ 加密/ 过程/ 中/ 所有/ 轮/ 密钥/ 加/ 、/ S/ 盒/ 输出/ 以及/ 轮/ 白化/ 操作/ 的/ 汉明/ 重/ 信息/ 泄露/ 都/ 准确/ 提取/ ,/ 然后/ 在/ 不同/ 轮/ 汉明/ 重/ 泄露/ 条件/ 下/ 进行/ 攻击/ 实验/ ./ 图/ 6/ ~/ 图/ 8/ 为/ 对/ 不同/ 轮/ 汉明/ 重/ 泄露/ 条件/ 下/ 分别/ 进行/ 100/ 次/ 攻击/ 实验/ 得到/ 的/ 密钥/ 求解/ 时间/ 分布/ ./ 不同/ 汉明/ 重/ 泄露/ 轮数/ 条件/ 下/ ,/ 密钥/ 平均/ 求解/ 时间/ 如图/ 9/ 所示/ ./ 图/ 68/ 轮/ 汉明/ 重/ 泄露/ 条件/ 下/ 密钥/ 求解/ 时间/ 分布图/ 716/ 轮/ 汉明/ 重/ 泄露/ 条件/ 下/ 密钥/ 求解/ 时间/ 分布图/ 9/ 不同/ 轮数/ 汉明/ 重/ 泄露/ 条件/ 下/ 平均/ 密钥/ 求解/ 时间/ ①/ 由图/ 6/ ~/ 图/ 8/ 可以/ 看出/ :/ 汉明/ 重/ 泄露/ 轮数/ 相同/ 的/ 条件/ 下/ 密钥/ 求解/ 时间/ 近似/ 服从/ 指数分布/ ,/ 求解/ 时间/ 越长/ 的/ 实例/ 出现/ 概率/ 就/ 越/ 低/ ,/ 大多数/ 情况/ 的/ 求解/ 时间/ 相差/ 不大/ ./ ②/ 由图/ 9/ 可以/ 看出/ :/ 随着/ 攻击/ 轮数/ 增加/ ,/ 虽然/ 旁路/ 泄露/ 信息量/ 增多/ 了/ ,/ 但/ 代数方程/ 组/ 的/ 规模/ 也/ 随之/ 增大/ ,/ 密钥/ 求解/ 时间/ 大致/ 呈/ 线性/ 增长/ 趋势/ ./ (/ 2/ )/ SMS4/ 未加/ 防御/ 实现/ 攻击/ 场景/ 下/ 攻击/ 结果/ ./ 由于/ 噪声/ 原因/ ,/ 部分/ 中间状态/ 字节/ 的/ 汉明/ 重推/ Page8/ 断值/ 可能/ 会/ 存在/ 误差/ ./ 这里/ ,/ 对于/ 错误/ 汉明/ 重/ 的/ 处理/ 方法/ 是/ 直接/ 剔除/ ,/ 只/ 保留/ 正确/ 的/ 汉明/ 重/ 信息/ ./ 因此/ ,/ SMS432/ 轮/ 加密/ 过程/ 中/ 的/ 汉明/ 重/ 信息点/ 只有/ 部分/ 信息/ 可以/ 利用/ ,/ 相当于/ 从/ 全部/ 32/ 轮中/ 离散/ 选取/ 汉明/ 重/ 信息点/ ,/ 即/ 离散/ 汉明/ 重/ 泄露/ 场景/ ./ 不同/ 攻击/ 场景/ 下/ ,/ 随着/ 汉明/ 重/ 泄露/ 轮数/ 增加/ ,/ 攻击/ 成功率/ 的/ 变化趋势/ 如图/ 10/ 所示/ ,/ 可以/ 看出/ :/ ①/ 已知/ 明文/ 条件/ 下/ ,/ 至少/ 需/ 连续/ 4/ 轮/ 汉明/ 重/ 泄露/ 才/ 可以/ 100/ %/ 成功/ 恢复/ SMS4/ 算法/ 128bit/ 主/ 密钥/ ./ 未知/ 明/ 密文/ 条件/ 下/ ,/ 连续/ 5/ 轮/ 汉明/ 重/ 信息/ 可以/ 100/ %/ 成功率/ 求解/ 密钥/ ./ 连续/ 汉明/ 重/ 泄露/ 场景/ 下/ ,/ 明/ 密文/ 未知/ 对/ 密钥/ 求解/ 效率/ 影响/ 不大/ ./ ②/ 离散/ 汉明/ 重/ 泄露/ 场景/ 下/ ,/ 密钥/ 求解/ 的/ 复杂度/ 明显增加/ ,/ 大约/ 需/ 26/ 轮/ 汉明/ 重/ 信息/ 才/ 可以/ 100/ %/ 成功/ 恢复/ 密钥/ ./ 这是/ 由于/ 汉明/ 重/ 离散/ 选取/ ,/ 导致/ 选取/ 的/ 汉明/ 重/ 信息/ 相关性/ 变弱/ ,/ 从而/ 使得/ 密钥/ 求解/ 时间/ 变长/ ./ (/ 3/ )/ 对/ SMS4/ 掩码/ 防护/ 实现/ 不同/ 攻击/ 场景/ 下/ 的/ 攻击/ 结果/ ./ 掩码/ 作为/ 常用/ 的/ 防御/ 手段/ ,/ 可以/ 有效/ 抵抗/ 差分/ 功耗/ 分析攻击/ ./ 文献/ [/ 18/ ]/ 借鉴/ 文献/ [/ 17/ ]/ 给出/ 了/ 一种/ SMS4/ 随机/ 掩码/ 方案/ ,/ 如图/ 11/ 所示/ ./ 由于/ 非线性/ 变换/ 操作/ 无法/ 通过/ 简单/ 的/ 掩码/ 相异/ 或/ 的/ 方法/ 去除/ 掩码/ m/ ,/ 该/ 方案/ 需在/ 每轮/ 加密/ 过程/ 中/ 动态/ 产生/ 相应/ 的/ 随机/ 掩码/ 修正/ 值/ q/ ./ 其中/ ,/ 掩码/ 修正/ 值/ q/ 满足/ 如下/ 关系式/ :/ q/ =/ s/ (/ p/ +/ m/ +/ k/ ,/ m/ )/ =/ s/ (/ p/ +/ k/ +/ m/ )/ ∧/ s/ (/ p/ +/ k/ )/ 对/ SMS4/ 掩码/ 方案/ 进行/ 分析/ ,/ 需要/ 根据/ 式/ (/ 1/ )/ 建立/ 非线性/ 变换/ S/ 的/ 输入输出/ 关系/ 代数方程/ 组/ 并联/ 立/ ,/ 同时/ 加密/ 过程/ 中/ 每轮/ 需/ 另外/ 采集/ 非线性/ 变换/ S/ 的/ 输出/ ,/ 即/ 额外/ 增加/ 4/ 个/ 汉明/ 重/ 信息/ 采集/ 点/ ./ 已知/ 明文/ 条件/ 下/ 实验/ 结果/ 如图/ 12/ 所示/ ./ 由图/ 12/ 可以/ 看出/ ,/ 掩码/ 防护/ 增加/ 了/ 攻击/ 难度/ ,/ 但是/ 依然/ 可以/ 成功/ 恢复/ 出/ 密钥/ ./ (/ 4/ )/ 同/ 国内外/ 相关/ 工作/ 比较/ 分析/ ./ 攻击/ 结果/ 同/ 国内外/ 攻击/ 的/ 比较/ 如表/ 2/ 所示/ ./ 文献/ [/ 7/ -/ 9/ ,/ 11/ ]/ 从/ 数学/ 角度/ 对/ SMS4/ 算法/ 进行/ 分析/ ,/ 攻击/ 所/ 需/ 样本量/ 大/ ,/ 计算/ 复杂度/ 高/ ,/ 对/ 密码/ 算法/ 的/ 安全性/ 难以/ 构成/ 实际/ 威胁/ ;/ 差分/ 功耗/ 分析/ [/ 12/ ]/ 实现/ 简单/ ,/ 但是/ 所/ 需/ 样本量/ 大/ ,/ 且/ 对/ 采用/ 掩码/ 防护/ 的/ 密码/ 算法/ 实现/ 攻击/ 失效/ ;/ Cache/ 攻击/ [/ 13/ ]/ 主要/ 针对/ 微处理器/ 上/ 的/ SMS4/ 软件/ 实现/ ,/ 对/ 微控制器/ 等/ 上/ 的/ SMS4/ 软件/ 实现/ 难以/ 构成威胁/ ;/ 差分/ 故障/ 分析/ 所/ 需/ 样本量/ 较/ 小/ ,/ 但/ 现有/ 攻击/ [/ 14/ -/ 16/ ]/ 都/ 是/ 通过/ 修改/ 加密算法/ 在/ 计算机/ 上/ 模拟/ 实现/ 故障/ 导入/ ,/ 真实/ 环境/ 下/ 对/ SMS4/ 加密/ 特定/ 轮/ 和/ 特定/ 字节/ 进行/ 故障/ 导入/ 十分困难/ ,/ 如何/ 实现/ 故障/ 的/ 精确/ 注入/ 是/ 其/ 未来/ 需/ 解决/ 的/ 问题/ [/ 16/ ]/ ./ 文中/ 提出/ 的/ SMS4/ 代数/ 旁路/ 攻击/ 利用/ 的/ 是/ 密码/ 执行/ 泄露/ 的/ 功耗/ 信息/ ,/ 旁路/ 信息/ 的/ 采集/ 在/ 很多/ 文献/ 中/ 都/ 有/ 研究/ [/ 12/ ,/ 20/ ]/ ,/ 所/ 需/ 样本量/ 较/ 小/ ;/ 攻击/ 在/ 未知/ 密文/ 条件/ 下/ 仍然/ 有效/ ,/ 且/ 对/ 添加/ 掩码/ 防御/ 的/ SMS4/ 密码/ 实现/ 仍然/ 适用/ ,/ 攻击/ 实用性/ 相对/ 较强/ ;/ 文中/ 分析方法/ 具有/ 普遍/ 适用性/ ,/ 对/ 其它/ 典型/ 分组/ 密码/ 如/ Camellia/ 、/ ARIA/ 、/ CLEFIA/ 等/ 仍然/ 适用/ ./ Page9/ 表/ 2/ 攻击/ 结果/ 与/ 国内外/ 已有/ SMS4/ 攻击/ 比较/ 攻击/ 文献/ [/ 7/ ]/ Square/ 攻击/ 文献/ [/ 8/ ]/ 不/ 可能/ 差分/ 分析/ 文献/ [/ 9/ ]/ 文献/ [/ 11/ ]/ 文献/ [/ 12/ ]/ 差分/ 功耗/ 分析/ 文献/ [/ 13/ ]/ Cache/ 计时/ 攻击/ 文献/ [/ 14/ ]/ 差分/ 故障/ 分析/ 文献/ [/ 15/ ]/ 差分/ 故障/ 分析/ 文献/ [/ 16/ ]/ 差分/ 故障/ 分析/ 本文/ 攻击/ 代数/ 旁路/ 攻击/ 已知/ 明文/ 或/ 未知/ 明/ 密文/ 5SMS4/ 容错/ 代数/ 旁路/ 攻击/ 5.1/ 代数/ 旁路/ 攻击/ 容错/ 策略/ 第/ 4/ 节对/ 错误/ 汉明/ 重/ 推断/ 的/ 处理/ 方法/ 是/ 直接/ 剔除/ ,/ 该/ 方法/ 会/ 导致/ 选取/ 的/ 汉明/ 重/ 泄露/ 之间/ 相关性/ 变弱/ ,/ 使得/ 密钥/ 求解/ 复杂度/ 急剧/ 增加/ ./ 下面/ 给出/ 一种/ 通用/ 的/ 代数/ 旁路/ 攻击/ 容错/ 方法/ ,/ 基本/ 思想/ 是/ 当/ 密码/ 算法/ 运行/ 中间状态/ 推断/ d/ 不/ 确定/ 时/ ,/ 不是/ 直接/ 剔除/ 而是/ 构造/ 中间状态/ 推断/ 值/ 的/ 可能/ 集合/ D/ 并/ 将/ 其/ 转化/ 为/ 等价/ 布尔代数/ 方程/ ,/ 然后/ 与/ 密码/ 代数方程/ 组/ 联立/ ,/ 降低/ 密钥/ 求解/ 复杂度/ ./ 使用/ 该/ 方法/ 的/ 前提/ 是/ 正确/ 的/ 推断/ 值/ 一定/ 在/ D/ 中/ ,/ 具体/ 思路/ 如下/ :/ (/ 1/ )/ 构造/ 关于/ 真实/ 中间状态/ 推断/ d/ 的/ 布尔代数/ 方程组/ ./ 假定/ 真实/ 中间状态/ 为/ X/ =/ x1/ ‖/ x2/ ‖/ …/ ‖/ xm/ ,/ xj/ 为单/ 比特/ 布尔/ 变量/ ,/ 1/ / j/ / m/ ,/ ‖/ 表示/ 连接符/ ./ 令/ θ/ 为/ 关于/ 中间状态/ X/ 的/ 函数/ ,/ 其/ 具体/ 含义/ 取决于/ 所/ 选取/ 的/ 旁路/ 信息/ 泄露/ 模型/ ,/ 可/ 构造/ 如下/ 代数方程/ 组/ :/ (/ 2/ )/ 构造/ 集合/ D/ =/ {/ d1/ ,/ d2/ ,/ …/ ,/ dn/ }/ 的/ 等价/ 布尔代数/ 方程组/ ./ 假定/ B/ =/ {/ B1/ ,/ B2/ ,/ …/ ,/ Bn/ }/ 为/ 中间状态/ X/ 的/ 可能/ 值/ 集合/ ./ 其中/ ,/ Bi/ =/ b1i/ ‖/ b2i/ ‖/ …/ ‖/ bmi/ ,/ bji/ 为单/ 比特/ 布尔/ 变量/ 且/ 1/ / i/ / n/ ,/ 1/ / j/ / m/ ,/ 可/ 构建/ 方程组/ 如下/ :/ (/ 3/ )/ 构造/ 与/ d/ ∈/ D/ 等价/ 的/ 布尔代数/ 方程组/ ./ 为/ 表示/ 集合/ D/ 中/ 元素/ di/ ,/ 1/ / i/ / n/ 和/ 真实/ 中间状态/ 推断/ 值/ d/ 的/ 关系/ ,/ 引入/ n/ 个单/ 比特/ 变量/ ci/ ,/ 1/ / i/ / n/ ./ 当/ di/ =/ d/ 时/ ci/ =/ 1/ ,/ 否则/ ci/ =/ 0/ ./ 令/ C/ =/ c1/ ‖/ c2/ ‖/ …/ ‖/ cn/ ./ 由于/ 集合/ D/ 中/ 只有/ 1/ 个/ 元素/ 等于/ d/ ,/ 则/ C/ 中/ 只有/ 1/ 个/ 元素/ 为/ 1/ ,/ 即/ 汉明/ 重为/ 1/ ./ 令/ HW/ (/ ·/ )/ 为/ 汉明/ 重/ 函数/ (/ 见/ 4.5/ 节/ )/ ,/ 则/ 可/ 构建/ 如下/ 方程组/ :/ 5.2/ SMS4/ 容错/ 代数/ 旁路/ 攻击/ 表/ 3/ 为/ 1/ 次/ 攻击/ 实验/ 中/ SMS4/ 加密/ 第/ 3/ 、/ 4/ 轮/ 的/ 轮/ 密钥/ 加/ 操作/ 输出/ 的/ 8/ 个/ 中间状态/ 字节/ 对应/ 功耗/ 轨迹/ 与/ 9/ 个/ 汉明/ 重/ 模板/ (/ 0/ ~/ 8/ )/ 的/ 匹配/ 的/ 极大/ 似然值/ ./ 其中/ ,/ 表/ 3/ 中/ 每行/ 的/ 加粗/ 位置/ 标识/ 真实/ 汉明/ 重值/ ./ 由表/ 3/ 可以/ 发现/ :/ 对于/ 某个/ 具体/ 中间状态/ 字节/ 的/ 匹配/ ,/ 推断/ 汉明/ 重/ 和/ 与其/ 相邻/ 的/ 汉明/ 重/ 对应/ 的/ 匹配/ 概率/ 一般/ 比较/ 接近/ ./ 但/ 由于/ 噪声/ 等/ 环境因素/ 的/ 影响/ ,/ 少数/ 情况/ 下会/ 出现/ 推断/ 汉明/ 重/ d/ 和/ 真实/ 汉明/ 重/ d/ 有/ 一定/ 微小/ 偏差/ ,/ 基本/ 在/ ±/ 1/ 范围/ 内/ ./ 因此/ ,/ 当/ 发生/ 汉明/ 重/ 推断/ 错误/ 时/ ,/ 可以/ 获得/ 关于/ 真实/ 汉明/ 重/ d/ 的/ 候选/ 值/ 集合/ D/ :/ 令/ θ/ =/ HW/ (/ ·/ )/ ,/ d/ =/ HW/ (/ X/ )/ ,/ 根据/ 式/ (/ 2/ )/ ~/ (/ 5/ )/ 构建/ 集合/ D/ 的/ 等价/ 代数方程/ 组/ ,/ 然后/ 将/ 其/ 与/ SMS4/ 算法/ 代数方程/ 组/ 进行/ 联立/ ./ D/ =/ {/ HW/ (/ X/ )/ -/ 1/ ,/ HW/ (/ X/ )/ ,/ HW/ (/ X/ )/ +/ 1/ }/ ./ 中间状态/ 字节/ X300/ ./ 310.330/ ./ 480.630/ ./ 750.650/ ./ 530.440/ ./ 284X310/ ./ 180.340/ ./ 230.510/ ./ 590.780/ ./ 620.380/ ./ 425X320/ ./ 850.790/ ./ 730.640/ ./ 620.430/ ./ 410.320/ ./ 210X330/ ./ 590.670/ ./ 710.650/ ./ 580.510/ ./ 470.440/ ./ 372X400/ ./ 690.760/ ./ 740.620/ ./ 560.510/ ./ 460.310/ ./ 391X410/ ./ 280.420/ ./ 570.650/ ./ 780.690/ ./ 540.410/ ./ 334X420/ ./ 220.480/ ./ 620.680/ ./ 590.410/ ./ 360.350/ ./ 183X430/ ./ 610.630/ ./ 710.770/ ./ 670.580/ ./ 600.450/ ./ 2935.3/ 攻击/ 实验/ 及/ 比较/ 分析/ (/ 1/ )/ 实验/ 结果/ ./ 已知/ 明/ 密文/ 条件/ 下/ ,/ 不同/ 错误率/ 对应/ (/ 汉明/ 重/ 泄露/ 轮数/ 为/ 10/ )/ 密钥/ 求解/ 平均/ 时间/ 如图/ 13/ 所示/ ./ 从图/ 中/ 可以/ 出/ ,/ 随着/ 错误率/ 的/ 增加/ ,/ 密钥/ 求解/ 的/ 平均/ 时间/ 大致/ 呈/ 线性/ 增长/ 趋势/ ./ 当/ 汉明/ 重/ 推断/ 错误率/ 不/ 超过/ 60/ %/ 条件/ 下/ ,/ 均/ 可以/ 在/ 有限/ 时间/ 内/ 成功/ 恢复/ 密钥/ ./ (/ 2/ )/ 同/ 国内外/ 相关/ 工作/ 比较/ 分析/ ./ 与/ 文献/ [/ 5/ ]/ 中/ 容错/ 代数/ 旁路/ 攻击/ 策略/ 相比/ ,/ 文中/ (/ a/ )/ 容错/ 能力/ 更强/ ./ 文献/ [/ 5/ ]/ 在/ 汉明/ 重/ 推断/ 错误/ 不/ 超过/ 20/ %/ 条件/ 下/ ,/ 可/ 成功/ 恢复/ Keeloq/ 完整/ 密钥/ ./ 对于/ 文中/ 容错/ 方法/ ,/ 汉明/ 重/ 推断/ 错误/ 不/ 超过/ 60/ %/ 条/ 方法/ 具有/ 以下/ 优点/ :/ Page10/ 件/ 下/ 均/ 可/ 在/ 有限/ 时间/ 内/ 成功/ 恢复/ SMS4/ 主/ 密钥/ ./ (/ b/ )/ 通用性/ 更强/ ./ 文献/ [/ 5/ ]/ 中/ 容错/ 方法/ 的/ 前提/ 是/ 中间状态/ 推断/ 值/ 和/ 真实/ 值/ 之间/ 可用/ 一个/ 不等式/ 来/ 表示/ ,/ 如/ 正确/ 汉明/ 重/ H/ 为/ 3/ ,/ 汉明/ 重/ 推断/ 误差/ 范围/ 为/ 正负/ 1/ ,/ 则/ 汉明/ 重/ 推断/ 可/ 表示/ 为/ ,/ 1/ </ H/ </ 5/ ./ 该/ 方法/ 仅/ 对/ 汉明/ 重/ 模型/ 有效/ ,/ 对于/ Cache/ 攻击/ 等/ 模型/ 则/ 无效/ ./ 以/ 访问/ 驱动/ Cache/ 攻击/ 为例/ ,/ 攻击者/ 可/ 得到/ S/ 盒/ 输入/ 的/ 高/ n/ 位/ 索引/ y/ 的/ 可能/ 值/ (/ 如/ n/ =/ 4/ )/ ,/ 0/ / y/ / 15/ 如/ 正确/ 的/ 高/ 4/ 位/ 索引/ 为/ 4/ ,/ 而/ 根据/ 采集/ 信息/ 得到/ 的/ y/ 值/ 推断/ 还/ 可能/ 是/ 除了/ 4/ 以外/ 的/ 任意/ 15/ 个值/ ,/ 应用/ 文献/ [/ 4/ ]/ 中/ 方法/ 无法/ 明确/ 确定/ 误差/ 的/ 范围/ ./ 如果/ 简单/ 将/ 所有/ 的/ y/ 建立/ -/ 1/ </ y/ </ 16/ 的/ 不等式/ ,/ 则/ 无法/ 利用/ 信息/ 泄露/ ./ 而/ 本文/ 提出/ 方法/ 则/ 适用/ 于/ 所有/ 能/ 将/ 推断/ 值/ 缩小/ 到/ 一个/ 有限/ 集合/ 的/ 攻击/ 场景/ ,/ 可/ 普遍/ 适用/ 于/ 汉明/ 重/ 泄露/ 模型/ 和/ Cache/ 泄露/ 模型/ 攻击/ ./ 此外/ ,/ 文献/ [/ 5/ ]/ 中/ 方法/ 对于/ 使用/ 了/ 复杂/ 非线性/ 变换/ (/ S/ 盒/ )/ 的/ 密码/ 算法/ 如/ AES/ 是/ 失效/ 的/ ,/ 而/ 本文/ 方法/ 对/ AES/ 、/ Camellia/ 、/ ARIA/ 、/ SMS4/ 等/ 此类/ 分组/ 密码/ 代数/ 旁路/ 攻击/ 依然/ 适用/ ./ 6/ 结束语/ 本文/ 对/ SMS4/ 算法/ 代数/ 旁路/ 攻击/ 进行/ 了/ 研究/ 和/ 实验/ ./ 在/ 建立/ SMS4/ 密码/ 代数方程/ 组/ 基础/ 上/ ,/ 通过/ 采集/ 密码/ 算法/ 运行/ 过程/ 中/ 泄露/ 功耗/ ,/ 结合/ 汉明/ 重/ 模型/ 将/ 其/ 转化/ 密码/ 中间状态/ 汉明/ 重值/ ,/ 并/ 转化/ 为/ 额外/ 代数方程/ 组/ ,/ 同/ 密码/ 算法/ 方程组/ 联立/ ,/ 降低/ 了/ 代数方程/ 组/ 求解/ 复杂度/ ,/ 减少/ 了/ 攻击/ 所/ 需/ 样本量/ ;/ 同时/ 文中/ 给出/ 了/ 一种/ 高效/ 的/ 代数/ 旁路/ 攻击/ 差错/ 处理/ 策略/ ,/ 提高/ 了/ 代数/ 旁路/ 攻击/ 的/ 适用性/ ./ 下/ 一步/ 工作/ 包括/ 采用/ 更为/ 高效/ 的/ 代数方程/ 组/ 求解/ 工具/ ,/ 如何/ 将/ 更/ 多/ 类型/ 的/ 旁路/ 信息/ 结合/ 到/ 代数/ 旁路/ 攻击/ 中/ ,/ 以及/ 如何/ 将/ 其它/ 传统/ 的/ 密码/ 分析方法/ 结合/ 到/ 代数/ 旁路/ 攻击/ 中/ ,/ 提高/ 代数/ 旁路/ 攻击/ 效率/ ./ 

