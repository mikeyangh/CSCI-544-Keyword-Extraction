Page1基于最优值搜索框架的CT序列图像肝脏分割1)(山东师范大学物理与电子科学学院生命与健康研究院山东省医学物理图像处理技术省级重点实验室济南250014)2)(济南大学信息科学与工程学院济南250022)3)(山东省肿瘤医院放疗科济南250117)摘要显式模型下建立的肝脏分割算法受适用条件的限制,不能有效地控制分割进程,制约了算法鲁棒性和泛化能力的提高.针对这一问题,该文提出了一个新的方法,将肝脏分割问题转化为隐式函数最优值搜索,依据图像实际数据和先验形状信息有效地控制分割进程,以迭代搜索策略得到肝脏的最优分割结果.每一个迭代步骤由两部分组成:首先,利用MRF(MarkovRandomField)实现已有肝脏轮廓邻域的局部再分割,重新调整肝脏轮廓;然后,利用先验形状稀疏表示调整后的形状,有效地修正噪声、边界模糊等因素引起的错误分割,并将修正后的肝脏轮廓用于下一轮局部再分割.肝脏分割结果在迭代过程中不断逼近真实值.为了提高形状稀疏表示的计算精度和速度,该文改进了相关技术细节,提出了动态字典生成策略,并利用混合粒子群算法求解稀疏表示方程.与金标准相比,该文所提算法在边界模糊、对比度低、存在大量其他干扰组织区域等不利因素的情景中,其分割精度(VolumeOverlapPercentage,VOE)可达到90%以上.关键词肝脏分割;最优值搜索;稀疏表示;马尔可夫随机场;混合粒子群1引言医学图像处理是实现计算机辅助诊疗的基础研究工作之一,肝脏分割是医学图像处理领域的一个重要研究课题.例如,在当前临床实施图像引导肿瘤精确放射治疗时,放射线在有效“打击”恶性肿瘤靶区的同时,会杀伤肿瘤周围的危及器官,进而可能引发放疗并发症.当涉及肺癌、肝癌等胸部、腹部肿瘤的治疗时,肝脏作为人体的一种重要器官,需要被精确识别并统计肝脏的辐射累计量,从而控制人体肝脏的受量在合理范围内,避免损伤正常肝脏组织.因此,在临床放疗计划制定时,肝脏组织的精确分割是一个非常重要的工作.目前,临床多采用人工手动分割的方式在放疗计划CT序列图像中获取肝脏区域,其缺点是耗时,并对相关人员的经验有一定要求.因此,研究在CT序列图像中的肝脏自动分割技术有利于降低临床医生或放疗物理师的劳动强度,降低因个人主观因素引起的分割误差,从而提高诊断的准确率.根据分割模型的建模角度将相关图像分割研究工作分为3类模式:全局模式、局部模式和混合模式.全局模式是指在全局角度调整分割规则或参数以达到准确分割目标的目的,例如基于阈值[1]、边缘检测[2]、区域生长[3]、高斯混合模型[4]等方法.全局模式在全局角度制定分割策略,忽略了对局部细节部分的精细处理.局部模式是建立图像的局部数据处理模型,实现目标细节的精确分割.例如Snake[5]、ASM(ActiveShapeModel)[6]、AAM(ActiveAppearanceModel)[7]等算法.局部模式实现了对图像数据的精细处理,也忽略了重要的宏观信息,分割结果易受到干扰因素的影响.混合模式融合了全局模式与局部模式的优点,在实现细节精细处理的基础之上结合全局约束信息分割感兴趣的目标.例如结合图谱与局部相似性的脑MR图像的特定组织分割[8]、H-MRF(HierarchialMarkovRandomField)模型实现由局部到全局的分割[9]、融合边缘和区域信息的水平集分割方法[10]、结合改进水平集和区域生长的分割方法[11]等.全局模式一般反应了问题的全局特征,对特殊情况不具有针对性;局部模式建立的局部精细处理的模型,未有效利用全局信息的约束作用;混合模式融合了全局模式与局部模式的优点,有助于提高模型泛化能力和特殊区域的分割精度.有效的融合方式是实现混合模式的关键.肝脏分割是目标分割领域的一个具体研究内容,同时又具有其自身的特殊性.目前,针对半自动和全自动的肝脏分割算法已取得了一定的研究成果[12],但肝脏分割研究仍面临一些亟待解决的难题,例如:(1)与肝脏毗邻的组织、器官具有相近的组织密度,使得肝脏边界模糊,如图1所示;(2)同一个体的肝脏在不同断层图像中的尺寸和形状会发生改变;(3)不同个体之间,肝脏的形态存在差异;(4)因成像设备及条件的变化、噪声干扰等因素的影响,CT序列图像中肝脏的灰度值会出现波动;(5)在CT序列图像中,肝脏会因呼吸运动而发生位移或变形.因此,CT序列图像中的肝脏分割是一项重要而复杂的工作.图1模糊肝脏边界示例(第1幅分别为肝脏与胃之间的模糊边界,第2幅为肝脏与肋间肌、胃之间的模糊边界)CT序列图像的肝脏分割可以被认为是一种最优值搜索问题,即根据先验信息和图像的真实数据确定肝脏区域.但由于实际应用中难以确定绝对精确的分割边界(GroundTruth),所以肝脏区域的最优值搜索是一个NP-hard问题,我们得到的分割结果是在某种评价准确控制下的相对最优分割结果.先验信息具有重要的参考价值,可有效地抑制因肝脏边界模糊、形变、噪声等不利因素引起的分割难度的提高.图像的真实数据又体现当前分割目标的自Page3身特点.正常肝脏在人体中的形态和位置是相对稳定的,肝脏先验形状是宏观修正分割结果的重要依据.稀疏表示是目前常用的一种利用先验信息拟合新信息的工具,在移动目标跟踪[13-14]、人脸识别[15]等领域中成功运用.肝脏与移动目标、人脸的一个共同特点就是宏观特性保持相对稳定,局部特征会发生改变.稀疏表示在肝脏形状修正的任务中表现出良好的性能,例如SSC(SparseShapeComposition)模型[16].然而,利用稀疏表示在宏观角度修正肝脏形状后,丢弃了统计不明显的局部特征,我们有必要根据图像真实数据进行调整以更新局部分割结果.MRF是建立图像上下文关联性的一种常用工具,可实现图像的局部精细分割,在医学图像分割中表现出了良好的分割性能[17-18].基于MRF的分割算法的缺点在于忽略了对分割结果的宏观评价.因此,有效地结合形状稀疏表示与MRF可实现兼顾宏观形状和局部细节的肝脏精确分割.本文提出了一种基于最优值搜索框架的CT序列图像的肝脏分割方法.其核心思想是将肝脏的分割进程等价为隐式函数的最优值搜索,融合不同算法的优势,在迭代步骤中逐步完善肝脏的宏观形状和局部细节.肝脏分割结果是框架的优化目标,图像的实际数据是驱动目标改变细节的内力,先验形状信息是约束目标改变的外力.基于最优值搜索框架的肝脏分割算法综合考虑了宏观形状特征与实际细节信息,在内力和外力的共同作用下,利用迭代的手段逐步完善分割结果,提高算法的分割精度和泛化能力.2最优值搜索框架的建立肝脏分割是在一幅图像中搜索肝脏最优解的过程,类似于求解等式,如公式其中,x表示输入图像,y表示先验信息,f表示映射模型,Z表示肝脏分割结果.肝脏分割的难点在于很难找到一个合理的映射模型.显式映射模型具有局限性,往往针对某种特定情况建立,很难表征出肝脏分割过程中遇到的各种难以预测的情况.把f定义为隐式模型有利于涵盖多种情况,利用智能计算技术,通过迭代运算,逐步搜索隐式模型的最优值,例如遗传算法、模拟退火算法、EM算法等.肝脏分割结果是优化目标,把所有形状的集合定义为一个形状空间,迭代步骤中得到的每一种肝脏分割结果的形状是目标在形状空间中停留的一个位置,肝脏形状的改变描述为目标的运动.在肝脏分割最优值搜索任务过程中,图像实际数据产生的内力驱动目标在形状空间中不停运动,同时又结合先验信息产生的外力对目标的运动进行有效约束.最优值搜索框架由3个部分组成:(1)肝脏区域初始化,为目标的运动设定起始点;(2)内力驱动目标运动,根据图像真实数据改变当前肝脏分割结果;(3)外力约束目标运动,利用先验形状信息修正肝脏分割结果.肝脏分割的最优值搜索框架设计如下:(1)肝脏区域初始化.初始化肝脏区域是为肝脏搜索提供起始出发点,利用了人体骨骼的固定结构特征,以简单、高效的方法得到肝脏的初始化区域,在本文第3节做了详细论述.(2)目标运动.在原有的肝脏分割结果(LO)的基础之上,依据图像的真实数据,在LO边缘的邻域内重新分割肝脏,在调整LO的边缘后得到一个新的肝脏分割结果(LN).与LO相比,LN的局部边缘会向内或向外运动,目标的位置会发生改变.本部分选择了MRF随机场作为分割工具,驱动目标运动.(3)目标运动约束.依据图像真实数据引导的目标运动易受到噪声区域的干扰,并且不易于处理模糊的边界区域,目标的盲目运动可能会引起肝脏的分割错误,所以利用先验信息对目标的运动进行约束.肝脏形状稀疏是目标运动约束的实现工具,将肝脏的分割结果约束在先验形状信息控制范围内.(4)最优值判定.最优值判定有两个参考标准,分别比较第t次和第t+1次迭代步骤的LN、LC.若Lt的真实数据已不能驱动目标运动,内力驱动与外力N与Lt+1约束达到了平衡状态,肝脏分割结果的搜索已进入稳定状态,肝脏分割结果已逼近最优值.利用重合率定量地衡量前后肝脏分割结果的变化率,如公式其中,L1、L2分别表示两种肝脏分割结果,|L1∩L2|表示L1与L2的交集区域面积,L1∪L2表示L1与L2并集区域面积.当L1与L2完全相同时,S=100%;当L1与L2完全不相同时,S=0.基于最优值搜索框架的肝脏分割方法的实现流程如图2所示.Page4图2系统实现流程图3肝脏区域初始化受成像条件、设备、噪声等干扰因素的影响,不同患者CT图像序列中的肝脏区域的灰度值会发生波动.由于肝脏与其他器官之间的相对密度保持稳定,因此不同器官之间成像的灰度值差分也保持相对稳定.对图像以相同的参考基准进行归一化预处理,有利于降低噪声对肝脏分割的影响.存在肝脏的CT序列图像中必会存在脊椎,并且脊椎区域总是呈现出高亮区域包围低暗区域,其特征明显,很容易在图像中提取,如图3所示.以CT序列图像中各自脊髓区域的灰度值为参考,实现CT序列图像的预处理,如公式其中,G(i,j)表示(i,j)位置的灰度值,T表示当前图像的参考基准(脊髓区域的灰度平均值),C是一个常数.C的作用是整体提高图像的差分值,所有图像取相同值.人体骨骼的密度高且结构稳定,在CT序列图像中呈现为高亮区域.提取图像中的肋骨区域,并依次连接,粗略定位出腹腔区域后,以脊髓为中心点将腹腔分为将腹腔分割为A、B两部分,如图4所示,人体肝脏大多存在于A区.用先验样本数据建立肝脏区域灰度分布的高斯混合模型(GaussianMixtureModel,GMM),如公式根据建立的肝脏区域的GMM分割A区肝脏,实现肝脏区域初始化.当肝脏与人体腹腔臂连接紧密且边缘模糊时,利用骨骼结构生成的腹腔结构有利于在初始化肝脏区域时确定肝脏区域.4基于MRF的目标运动将一个二维图像中所有可能的闭合曲线的集合Page5定义为形状空间Ψ,每一种形状就是形状空间中的一个点p.CT序列图像中肝脏分割的任务就是在空间中定义一个搜索目标O,控制目标O在形状空间中移动,得到最优值.目标O的移动表现在分割工作的具体操作上就是根据图像真实数据,在已有的肝脏轮廓边缘点的邻域范围内以局部数据特征为主要依据,调整肝脏轮廓边缘,从而驱动分割目标向最优值靠近.本部分选择了可建立像素之间关联性,具有较好的局部数据处理能力的MRF作为实现工具.图像是一个规则的方格网,定义为S={(i,j)|1iW,1jH},W、H为图像的宽、高.图像每一个像素点的灰度取值及其属性是一个随机变量,扩展到整幅图像,形成观测场和标记场.观测场的取值由图像各像素点可观察到的灰度值组成,标记场的取值由各像素点的属性取值组成,属性即是各像素点所属的分割类别.在肝脏分割工作中,各像素点可取的属性值有两个,即非肝脏区域和肝脏区域,记为L={0,1},0表示非肝脏区域,1表示肝脏区域.肝脏分割的过程就是在一幅未知结果的图像中对各像素点添加标记属性的过程.MRF构建的基团系统建立了图像的空间关联性,空间像素点之间的关联性被表征为单点基团、两点基团、三点基团等.所有的基团单元组成了图像的基团集合,从而建立起了图像的空间关联性.著名的HC(Hammersley-Clifford)定理证明了MRF与Gibbs分布之间的等价性,推动了MRF从理论走向实际应用.一幅图像的MRF随机场利用Gibbs分布可表示为其中,l表示标记场的取值变量,Z是一个能量归一化量,T是一个常量(常取1),U(l)是基团集合的能量,Vc(l)是各基团的势能.本文选择了MLL(Multi-LevelLogistic)模型定义各集团的势能[19],如公式Vc(l)=其中,Qc、Ql是未知数,一般是赋为定值,或利用先验样本信息学习获得.本文根据先验样本数据,利用最大似然估计确定MLL模型的参数,如公式其中θ=(Qc,Ql).MAP-MRF是一种常用的分割模型,就是通过找一种最佳的分割方式,使分割标签相对于观测值的后验概率p(l|g)最大,其中l表示分割标签,g表示观测场的灰度值.根据贝叶斯公式,分割标签的最大后验概率可分解为基于先验样本数据及MRF的表达形式,如公式p(g|l)表示具有同一标记属性的像素的灰度值先验概率分布.其中,当l=1时,p(g|l)与式(4)相同.p(l)可由式(5)求得,p(g)是不分属性的灰度值概率分布.最终,根据图像实际灰度值,找到一种最优的标记场取值,使其后验概率最大,如公式其中,Ω表示一幅图像中所有可能的标签组合形式的集合.基于MRF的图像分割是一个最优值优化问题,很难找到准确的显式模型描述分割进程,得到精确的分割结果.目前常用的一种策略是采用迭代优化的方式获取某一准则衡量下的最优分割结果,优化过程一般采用智能计算技术,如EM算法,迭代条件模式(IterativeConditionModel,ICM),模拟退火算法等.本文选择ICM完成基于MRF的肝脏轮廓边缘再分割任务.5基于形状稀疏表示的目标运动约束MRF依据图像实际数据驱动目标运动,但受噪声、边界模糊等因素的影响,可能会造成局部分割错误,因此有必要对目标的运动进行约束.形状的稀疏表示是利用先验形状信息拟合一个新的形状,保留新形状符合先验信息的成分,舍弃新形状不符合先验信息的成分,有效地约束了肝脏的形状变化,并将其控制在先验信息的约束下,防止肝脏分割过程中出现严重的分割错误,提高了肝脏分割的精度.5.1形状坐标序列的逻辑转换在数字图像中,肝脏的轮廓通常以目标边缘点的图像坐标序列表示.然而,应用中更加关心的是肝脏的形状,而不是轮廓点坐标是如何分布的.轮廓点Page6之间特定的约束关系形成了其表现出的形状.原始的坐标点不能体现轮廓点之间的约束关系,因此将肝脏轮廓的原始坐标转换成轮廓的逻辑坐标,凸显了轮廓的形状信息.假设一个肝脏的轮廓坐标点序列为d={(x1,y1),(x2,y2),(x3,y3),…,(xM,yM)},各坐标点之间蕴含了各点之间的约束关系,这种约束关系形成了轮廓所表现出的形状.用偏移向量ν表示轮廓点之间的位置关系,并采用后项循环差分的形式计算相邻轮廓点之间的偏移向量,实现了肝脏轮廓坐标的逻辑转换,如公式其中,2rM.令犛=(x1,y1),={ν1,ν2,ν3,…,νn},向量集及犛完整地表达出肝脏的形状及位置,得到一种新的轮廓表达形式d={,犛}.这种表达方式描述了相邻轮廓点之间的约束关系,决定了轮廓的形状,犛确定了轮廓所在的位置.任意两点之间的约束关系可利用约束集求得,循环移位约束集可实现两个轮廓的对齐,并且表征出的形状是具有移动不变性.例如,轮廓点(xr,yr)与(xr+k,yr+k)之间的约束关系狏r→k=狏r+1+狏r+2+…+狏r+k,如图5所示.图6动态字典生成策略示例5.2肝脏形状字典的生成字典是稀疏表示的一个重要部分,由大量的先验形状信息组成.肝脏在不同断层图像中的形状会发生变化,若将肝脏在每个断层图像中的形状信息都引入形状字典,必会成倍地增加字典的容量,并造成计算量的成倍增加.为了提高计算效率,减小字典的冗余性,我们设计了一种动态字典生成策略.肝脏的动态字典建立在字典库基础之上,字典库由不同患者的CT序列图像中的肝脏形状组成,每一位患者的肝脏断层形状序列成为一个样本单元.根据输入形状的特征在字典库中挑选形状实例组成形状字典,每一个样本单元中只挑选一个最相近的形状实例.为了保证字典库的可靠性与多样性,每一个样本单元的肝脏形状都是由临床医生和放射科物理师通过手工勾画所得,进入字典库的样本单元也是由临床医生和放射科物理师根据经验选择各种形状的肝脏.动态字典生成策略通过以下步骤实现:(1)计算新目标形状的周长J.(2)在每一个样本单元中搜索周长最接近J的形状实例Er示样本单元中形状实例的序号.(3)将(2)抽取的形状实例组成形状字典.动态字典生成策略如图6所示.字典库是在使用过程中不断完善的,当字典库中的形状实例与待分割的肝脏形状具有明显差别时,抽取的字典可能不够准确,稀疏表示将不能准确地修正肝脏形状,甚至会导致分割错误.此时,仍需要依靠临床医生和放射科物理师手动勾画肝脏的形Page7状,并将其加入到字典库中.在下次分割遇到类似情况时可得到适用的字典.选择形状的周长作为在样本单元中抽取形状实例组成形状字典的衡量标准,虽然这种选择标准可能会选择出与输入形状完全不相同的形状实例,但正是靠这种衡量标准的不完全准确性可抽取出多种形状实例,保证了字典的多样性.同时,在根据形状周长建立字典时,与输入形状最接近的肝脏实例必然会被选中,由此保证了字典的准确性.动态字典中各形状实例的轮廓点数及轮廓的起始记录点各不相同,因此在利用稀疏表示约束肝脏形状之前应对字典中的各形状实例对齐.传统抽样或插值算法即可实现轮廓点序列的长度归一化.起始记录点影响着整个轮廓的数据表现形式,不同的起始记录点会使相同的轮廓在数值上存在较大的差别,所以对齐各形状实例的起始记录点也是必须要完成的准备工作.选择字典中的第一个轮廓d1作为对齐基准,对第i个待对齐的轮廓di进行循环移位,并结合文献[16]使用的PA(ProcrustesAnalysis)算法中将di向d1对齐的方法,选择各对齐点之间平方误差最小的轮廓点记录顺序作为对齐起始记录点的轮廓.算法实现如算法1所述.算法1.肝脏轮廓起始记录点对齐算法实现.输入:对齐标准,未对齐形状输出:已向标准对齐的形状实现:1.di向左循环移1位,得到一个新的轮廓记录形似dt2.利用PA算法,将dt序列dNi,N++,其中N代表循环移位的次数.3.计算对齐后新的轮廓点序列dN的均方差,σ=∑轮廓点的个数.4.更新di=dtdti,完成轮廓起始记录点的对齐功能.对齐字典中示例轮廓点个数、起始记录点后,利用式(10),对轮廓的原始坐标进行逻辑转换,得到肝脏实例的形状信息,并组成肝脏形状字典D={1,2,…,N}∈犚M×N.5.3基于形状稀疏表示和混合粒子群算法的目标运动约束目标运动约束表现在肝脏分割的具体操作是利用先验形状信息拟合分割结果,对肝脏的形状改变进行有效的约束,抑制因干扰引起的错误分割.将一个待处理的输入形状狔向形状字典中的d1实例对齐,并计算得到其形状逻辑信息y.利用字典中的形状信息拟合输入的形状信息,得到一个误差最小的拟合方式,如其中,狓表示形状的稀疏表示系数矩阵,狔表示轮廓局部错误的稀疏矩阵,e用于矫正局部形状分割错误,k1、k2限定了矩阵的稀疏度.将输入形状更新为拟合后的形状,如公式式(16)的变形来源于SSC模型[16],经过肝脏形状的对齐及逻辑转换,优化了形状的全局变化操作,使模型得以简化.文献[16]利用EM算法搜索稀疏表示方程的最优解.与遗传算法、粒子群算法等智能计算方法相比,EM算法更易陷入局部最优解.为了提高计算精度及效率,利用混合粒子群算法搜索式(16)的最优解.式(17)的求解是一个具有两个优化参数(狓,e)的高维复杂函数求解的过程.研究人员对高维复杂函数的求解进行了相关研究,如利用混合优化策略[20]、混合粒子群算法[21-23]等方法.在粒子群算法的更新部分中引入遗传算法的交叉、变异操作[24],使稀疏表示方程的最优解搜索进程不易陷入局部最优.字典中的肝脏实例个数为N,故狓、e的维数均为N.本文所使用的混合粒子群算法做如下设计:(1)粒子编码.将狓、e编码成1个粒子,并生成由R个粒子组成的种群T={T1,T2,…,TR},粒子的维数为2N,第i个粒子表示为Ti={x1,x2,…,xN,e1,e2,…,eN}.(2)个体最优粒子,全局最优粒子.个体最优是指个体粒子搜索过的最优的值,每一个粒子都有一B个最优值,第i个粒子遍历位置的个体最优粒子记i;全局最优是指所有粒子搜索过的位置中最优为T的值,只有一个全局最优值TG.i,v2i,…,v2N(3)粒子运动速度及粒子更新.每一个粒子都对应一个速度矢量,第i个粒子的运动矢量记为狏={v1次迭代的速度vi、当前粒子位置Ti、个体最优位置i、全局最优位置TG共同决定,如式(18)、(19)TB所示.(4)适应度函数.选择拟合的轮廓与实际轮廓的均方差的倒数为粒子群算法的适应度函数,如Page8式(20).误差越大,适应度之约小,反之越大.(5)粒子交叉与变异.在个体、全局最优粒子中随机选择交叉位置和长度,与随机选取的普通粒子进行交叉操作;在随机选择的粒子中选择一定数量的非零数,并在再次随机抽取的粒子中随机替换某一位置的参数.同样需要注意的是,只允许相同含义的变量之间进行交叉、变异替换,不允许不同含义的变量之间进行变异操作.其中,s表示迭代步骤,ξ表示惯性系数,a、b表示加速度系数,r1、r2为[0,1]之间的随机数,j表示粒子图7基于混合粒子群算法的稀疏方程最优解搜索6实验测试与结果分析6.1样本数据库与实验测试数据库的组成样本数据由不同患者的临床CT序列图像组成,每一个患者的CT图像序列是一个样本单元,共选取了100个包含各种肝脏形态的样本单元.样本数据库需要尽可能包含肝脏在CT图像中可能呈现的形态和灰度值,保证样本的多样性.实验测试数据库由随机选择的100位患者的CT序列图像组成.每一个样本单元包含20~30幅CT图像,样本数据与测试数据库中各自至少包含2000幅CT图像.样本数据库中的肝脏区域及形状由临床医生和放射科物理师手动勾画,作为先验信息.由临床医生和放射科物理师在实验数据库中手动勾画的肝脏区的第j个参数.在稀疏方程最优解搜索过程中,将两个变量合并成一个粒子,并在交叉、变异操作中加以区分,防止因粒子种群中不同属性解的相互混杂而导致求解失败.另外,在求解稀疏方程解的过程中,应限制狓、e解的稀疏性.当狓、e解的稀疏性不满足稀疏性要求时,依次删除狓、e中的最小值元素,直至满足稀疏性约束条件.在迭代的最后,可能会生成多个满足稀疏性约束条件且拟合误差满足要求的解,这时我们需要在稀疏性要求和误差大小这两个指标上进行筛选,根据实际需要选出最优解.利用混合粒子群算法搜索稀疏表示方程的最优解不易陷入局部最优,其拟合出的输入形状将更加逼近真实形态.基于混合粒子群算法的稀疏方程最优解搜索算法流程如图7所示.域是实验对比的金标准(GroundTruth).样本数据库用来获取肝脏的先验形状信息和灰度信息,实验数据库用来验证算法的有效性.6.2对比实验及结果分析为了在对比中体现本文所提算法的优势,我们选择以下四种经典分割算法进行比较实验,分别是区域生长、GVF-snake[25]、水平集[26]和马尔可夫随机场[18].其中,区域生长算法是由本文作者实现,人工在肝脏区域选择种子生长点,沿8邻域向外生长,得到肝脏分割结果.另外3种方法均是利用他人已有的研究成果进行比较.对比实验结果如图8所示,与其他算法相比,利用本文所提算法得到的分割结果与“金标准”非常接近.尤其是在模糊边界、图像质量低的图像中,本文所提算法明显优于其他对比方法.由图8可以看出,Page9区域生长算法不能有效地处理模糊边界,将灰度值与肝脏相近的临近器官误分割为肝脏区域,当图像质量较差,灰度分布不均匀时也不能有效地分割肝脏区域;GVF-Snake算法主要依据图像的梯度信息调整肝脏轮廓,在边界模糊区域的梯度值较小,很难准确处理模糊边界,并且任意位置的梯度变化都可能造成分割错误;水平集与MRF都是图像分割方法,然图8对比实验结果基于最优值搜索策略的肝脏分割模型是一种依赖于迭代步骤,逐步完善分割结果的进程.肝脏区域初始化和基于MRF得到肝脏分割结果是依据图像真实数据得到的,受各种干扰因素的影响,分割错误可能存在.利用先验形状信息在全局角度调整肝脏形状,修正了因过度依赖图像数据而产生的分割错误.然而,先验信息修正后的分割结果可能导致某些局部位置的分割错误,此时需要依据图像的实际数据修正局部形状.如此不断迭代,相图9肝脏分割最优值搜索进程((a)组从左至右依次为金标准、肝脏初始化区域、初始化区域与金标准对比,(b)至(d)组从左至右依次为MRF分割结果、形状稀疏表示修正结果、本步骤分割结果与金标准对比)6.3评价分析本文研究的分割工作主要针对二维CT图像,利用本文所提方法与“金标准”对比.实验如图10所示.实验结果表明,本文所提算法能准确分割肝脏区而它们过度依赖图像数据,当图像质量较好,肝脏与周边区域有着明显的界线时,可达到很好的分割结果,但是当肝脏边界模糊,肝脏区域成像质量较差时,仍然不能有效地分割肝脏.本文算法的优势在于同时兼顾了图像实际数据与先验形状信息,在处理模糊边界和低质量图像时,先验信息具有一定的导向作用,再结合图像实际数据,从而实现肝脏的精确分割.互修复分割错误,最终使分割结果逼近最优值.肝脏分割的最优值搜索进程如图9所示,分别展示了肝脏分割的“金标准”,初始化区域,第1次、50次、最后一次的MRF分割结果和形状稀疏表示修正结果.为了便于观察迭代过程中分割结果的变化,将分割的中间结果与金标准绘在一个空白图中,黑色区域为“金标准”,灰色区域为当前分割结果.由图9可看出,随着搜索进程的进行,肝脏分割结果逐渐逼近“金标准”.域.在人工分割肝脏得到“金标准”时,受主观因素和其他因素干扰,“金标准”未必是100%准确的,本文所提算法的分割精度在某些局部位置甚至优于手动分割结果.Page10图10本文算法实验结果(第1列为“金标准”,第2列为本文所提算法分割结果,第3列为分割结果与“金标准”重合区域)稀疏表示的修正精度受字典影响,当字典中不包含输入形状时,将可能产生修正错误,如图12所示.因某种原因,病人的肝脏有部分切除,当字典中不包含此类型的肝脏时,稀疏表示将不能准确修正肝脏.手动分割此类非常规的肝脏形状,将其添加到字典库中,再次利用稀疏表示修正图11(a)的肝脏形状,得到如图12(b)的修正结果,与图12(a)的“金标准”比较可已看出,添加形状实例后,形状稀疏表示可有效修正此类非常规肝脏形状.利用肝脏分割结果与“金标准”的重合率作为算法分割精度的衡量标准,如式(2)所示.取测试库中所有样本的分割结果与“金标准”重合率的均值,如表1所示,本文所提算法的分割精度明显高于对比算法.在本文实验中,对比算法分割精度较低,是因为本文所选择的数据库中包含较多边界模糊、图像质量差的CT图像,以验证本文算法的鲁棒性.将测试数据集中每一个患者的CT序列图像定义为一个样本单元,取样本单元中所有图像的平均分割重合作为测试样本单元的评价准则,本文所提算法在每一个样本单元中的平均分割精度如图13所示.基于最优值搜索框的肝脏分割算法,将肝脏分割问题转化成搜索方程的最优值问题,肝脏的分割结果在搜索步骤中逐渐逼近最优值,如图14所示.图14肝脏平均分割精度随搜索进行的变化Page11在提高肝脏分割精度的同时应该兼顾算法的时间复杂度,分割精度与时间复杂度同等重要.本文所提算法的先验信息提取部分在分割任务运行前已做好准备工作,在分割时不占用CPU时间.正式分割前的图像归一化与肝脏区域初始化的计算量也极小.虽然基于MRF的图像分割算法运算复杂,但利用MRF在修改局部分割结果时,只在轮廓边缘的邻域内进行调整,处理的数据量小.形状稀疏表示方程是一个NP-Hard问题,并且维数较高,因此本文所提算法的时间复杂度主要受形状稀疏部分的影响.迭代优化模型的一个重要分析要素就是收敛性.本文建立的迭代优化模型以MAP-MRF和形状稀疏表示为实现工具,利用ICM实现基于MRF的图像分割算法是收敛的,基于混合粒子群算法的稀疏表示方程求解也是收敛的.所以两种收敛的模型以线性组合的形式建立起的新模型也是收敛的.为迭代步骤102030405060708090100表2迭代进程变化率样本517.7214.0511.027.823.411.271.030.810.890.94肝脏分割的变化率变小主要由以下两方面因素引起:(1)肝脏区域面积逐渐变大,改变部分所引起的数据变化越来越小.(2)当分割进程达到一定程度,肝脏分割的改变越来越小,最终肝脏的改变和形状约束达到平衡状态,从而使肝脏分割的改变率稳定在一个很小的值.为了提高计算效率,我们采用多核编程技术实现本文所提算法的并行运行.将肝脏轮廓的邻域等面积划分,采用4个线程实现MRF驱动形状改变的功能.形状稀疏表示的求解部分将粒子划分,同样使用4个线程遍历最优值.如此一来,在提高分割精度的同时,不影响肝脏分割的工作效率.实验测试所使用的计算机硬件配置为:Corei7-47703.40GHz,8GB内存,100个测试样本单元的各个模块的平均运行时间如表3所示,算法运算的时间可控制在35s左右.了验证本文所提算法的收敛性,我们又跟踪计算了迭代修正后肝脏分割结果的变化率.变化率计算如公式其中,t表示迭代步骤,p表示计算步长,St、St+p分别表示迭代前后的两种肝脏分割结果,StSt+p表示St与St+p的未重叠区域面积,St∪St+p表示St与St+p并集区域面积.当St与St+p完全相同时,C=0;当St与St+p完全不相同时,C=100%.利用10组数据测试本文所提算法的收敛性,每组数据由100幅包含肝脏的CT图像组成,以每10个迭代步骤为一个统计步长,计算样本中所有个体变化率的均值,测试结果如表2所示.结合图14,实验结果表明,在随着分割进程的进行,肝脏分割的变化率逐渐变小,并且趋于稳定.样本614.1512.349.366.813.071.250.890.920.911.05基于最优值搜索框架的肝脏分割算法,利用迭代步骤使分割结果逐步逼近最优值,其带来的问题是计算量较大,以增大运算量为代价,提高了肝脏分割的精度,并利用多线程编程技术克服了运算量大的缺陷.7结论和讨论文中介绍了一种基于最优值搜索框架的肝脏分割算法,输入CT图像中的肝脏分割结果是优化的目标.利用图像是数据的内部能量驱动目标移动,并依据外力对目标的运动进行约束,最终使目标逼近肝脏分割的最优值.利用MRF作为描述驱动目标Page12运动内力的工具,选取先验形状信息作为目标运动的外部约束力,并以形状稀疏表示约束目标的运动.然而,这并不是实现利用最优值搜索框架分割肝脏的唯一实现方式.图像的内力是图像真实数据所蕴含的能驱动搜索位置不断改变的能量,任何一种有效描述图像数据的方式均有可能成为驱动目标运动的实现工具,如GMM等.图像的外力也不仅仅只有先验形状信息,任何一种可用来约束肝脏分割进程,防止出现各种错误的准则均可作为外部约束力.实验和分析表明,本文所提算法具有较高的分割精度,尤其是能准确处理肝脏的模糊边缘和肝脏临近干扰区域的影响.本文所提的算法以最优值搜索框架为基础,多次的迭代搜索会增大算法的时间复杂度.医学图像处理一般对时间具有一定的容忍度,而对处理精度敏感.因此,我们提出的基于最优值搜索框架的肝脏分割算法以牺牲运算的时间复杂度为代价,换取肝脏分割精度的提高.我们期待能有研究人员在此框架的基础上,提出更好更高效的实现方法,进一步提高肝脏分割算法的分割精度、泛化能力和运算效率.致谢特别感谢山东肿瘤医院放射治疗科对本文研究工作提供的宝贵意见!
