Page1一种基于概率图模型的不确定性数据世系表示方法岳昆刘惟一朱运磊张伟(云南大学信息学院计算机科学与工程系昆明650091)摘要不确定性数据的世系分析是基于数据产生和演变的过程来跟踪数据不确定性的来源.为了有效地描述数据间复杂的相关性及不确定性,并从理论上保证世系分析中概率计算的正确性,文中研究了基于贝叶斯网这一重要的概率图模型的不确定性数据世系表示方法.以世系的布尔公式和不确定性数据本身为出发点,提出了将布尔公式等价转换为贝叶斯网的方法,并讨论了相应的条件独立性质和概率语义.案例研究和实验结果表明,文中的方法为世系分析提供了一种有效性的、可扩展的数据相关性表示和概率计算框架.关键词不确定性数据;世系表示;概率计算;概率图模型;贝叶斯网1引言式多样化,大量的不确定性数据随之产生,普遍存在于经济、军事、物流、金融、电信和科学计算等领域中、并且扮演着关键的角色.当前数据特点的新变数据规模不断扩大、共享范围越来越广、数据形化,使得不确定性数据管理成为了国内外研究的热Page2点,目前仍面临着不确定性建模、管理和优化等方面的挑战[1-2].不确定性数据世系分析,是指基于数据产生和演变的过程来跟踪数据不确定性的来源,在各类不确定性数据的查询优化、集成及质量保证等方面,具有广泛的应用.文献[3]对世系管理研究进行了综述,指出了不确定性数据世系分析研究的重要意义和面临的挑战.ULDB(Uncertainty-LineageDataBase)是Stanford开发的面向世系分析的不确定性数据EventsIDday21MondayReception0.822TuesdayMuseum1.023WednesdayBanquet0.9EventRoster=πperson,event(AttendsEvents)的查询结果EventAttendees=πperson(EventRoster)的查询结果图1不确定性数据及世系Re等人[5]针对大规模世系,提出了近似世系及其查询处理技术.Sarma等人[6]针对ULDB查询处理,提出了基于世系表达式来计算查询结果概率的方法及优化策略.这些方法将世系表示为布尔公式,并基于世系表达式计算查询结果的概率,但逻辑形式的布尔公式并不能有效地描述数据间复杂的相关性及数据相关的不确定性,也缺乏保证结果概率正确性的理论基础.因此,如何针对表示为布尔公式的世系表达式,描述所涉及数据的相关性,并应用于世系表达式的高效概率计算,是这类研究的核心,即需要建立一种既能等价表达布尔公式信息、又能有效支持概率计算的模型.幸运的是,以贝叶斯网(BayesianNetwork,BN)为典型代表的概率图模型(ProbabilisticGraphicalModel,PGM),是不确定性知识表示和推理的有效框架[7-8],具有坚实的概率论理论基础和广泛的应用.Deshpande等人[9]指出了PGM在数据库研究中的作用,基于PGM可有效地描述数据间的相关性和相互依赖.PGM具有良好的概率语义和成熟的推理方法,为不确定性数据管理中概率计算这一关键问题提供了重要的工具,也是本文研究的基础.近年来,基于PGM的不确定性数据管理已有许多研究工作,是目前用来描述不确定性数据库中数据相关性的重要方法.Wang等人[10]基于BN扩展了概率关系模型,提出了直接支持概率数据库内部关系查询和概率模型上推理计算及查询优化的方库[4],是许多不确定性数据世系分析研究的基础.目前,世系通常基于连接查询被表示为所涉及元组的布尔公式(图1给出了一个元组独立假设下不确定性数据世系的例子[4]).基于表示世系的布尔公式计算查询结果的概率(如计算λ(31)的概率),称为世系概率计算,是世系分析研究的重要内容,有效支持查询处理的重要任务,也具有较大的挑战,成为了目前不确定性数据世系研究的焦点[4-6].IDpersonprob41Garcia-Molina0.8668λ(41)=(11∧21)∨(12∧23)42Ullman0.54λ(42)=13∧23法.Sen等人[11]用BN表示不确定性数据库中元组间的相关性,从而避免了计算查询结果概率时的大量概率分布计算,也为高效的世系概率计算奠定了基础.PGM也被用于世系的处理中,Kanagal等人[12]基于连接树(Junctiontree)及其上的概率推理算法,提出了可用于大规模世系表达式的概率计算方法,连接树就是PGM的一种等价表示.这些方法基于PGM表示数据查询计划(或世系)对应的布尔公式,利用PGM的图形特征及其中的条件独立性[8-9],大大简化概率的计算.然而,Pearl[7]已给出重要结论:一个有向无环图只有满足了条件独立性、具有概率语义,才能视为PGM并进行概率推理.但以上研究[10-12]并未给出满足条件独立性和概率语义的PGM构建方法,也未讨论图模型的条件独立性和概率语义,从而无法从理论和模型基础方面保证PGM与布尔公式具有等价的条件概率独立性,进而不能保证结果概率的正确性.针对同时涉及逻辑知识与概率知识的情形,目前的研究通过逻辑知识来扩展BN的概率推理能力[14],或者用BN来增强逻辑知识的表达能力[15],而都未考虑从逻辑知识到概率模型的等价转换,进而都不能用来将表示世系的布尔公式等价地转换为可有效支持概率计算的PGM.因此,本文主要研究从表示世系的布尔公式到BN的等价转换方法,旨在为不确定性数据世系分析提供一种有效支持世系表示和概率计算的理论基础和知识框架.总的来说,Page3本文的研究主要包括:(1)从布尔公式到BN有向无环图结构的等价转换.BN是以随机变量为结点的有向无环图(DirectedAcyclicGraph,DAG),每个结点有一张定量反映变量间依赖关系的概率参数表(Condi-tionalProbabilityTable,CPT)[7-8],构建反映变量间条件概率独立性的DAG,是构建BN的关键.为了以表示不确定性数据连接查询世系的布尔公式构建相应的BN,本文首先将各布尔公式等价地表示为Horn子句[13],利用Horn子句与逻辑蕴含式之间的等价特征,重点研究并提出了从Horn子句到DAG的转换算法以及多个Horn子句所对应DAG的合并策略,将其称为世系图(LineageGraph,LG).我们进一步讨论LG的条件独立性和概率语义,证明LG为概率图模型,从而保证可基于LG进行有效的概率推理.LG等价地反映了世系表达式的逻辑语义和概率独立性,为基于LG进行世系概率计算奠定了模型层面上的基础.(2)BN概率参数的计算.基于LG的图形特征和条件独立语义,针对LG本身的性质和BN概率推理的特点,本文通过为LG中各结点定义满足布尔公式的函数,给出了从LG和不确定性数据计算各结点CPT的方法,从而构建了等价反映世系表达式的BN,称为世系贝叶斯网(LineageBayesianNetwork,LBN),弥补了现有基于PGM的不确定性数据管理方法在理论基础和模型构建方面存在的不足之处.(3)案例研究和实验分析.本文进一步给出了基于LBN进行世系概率计算的案例,同时对LBN的构建方法及相应的世系概率计算进行了实验测试.案例研究和实验结果表明,本文的方法为世系分析提供了一种有效性的数据相关性表示和概率计算框架.本文第2节是研究的重点,给出从表示世系的布尔公式和不确定性数据构建LBN的方法;第3节给出基于LBN进行世系概率计算的案例研究;第4节给出实验结果;第5节总结全文,并展望将来的研究工作.2从世系表达式到贝叶斯网假设不确定性数据库中元组相互独立,借鉴文献[4-6]中的相关描述,我们基于x-relation和元组级不确定性,以世系表达式为重点,首先定义带有世系的不确定性数据库,作为后续讨论的基础.定义1.带世系的不确定性数据库D是一个三元组(珚S,I(珚S),λ),其中(1)珚S=S1,S2,…,Sn为输入的基本x-relation集合,其中每个Si是包含若干元组的多数据集.(2)D中每个元组有一个唯一的标识,I(珚S)为所有标识的集合.(3)λ为表示为布尔公式的世系函数.设x-relationR为珚S上的查询处理结果,I(R)为R中元组标识的集合,则t∈I(R),λ(t):I(珚S)→I(R)定义为珚S上的布尔公式,λ(t)→t称为世系表达式.注意到,λ(t)→t反映了得到查询处理结果t的过程,λ(t)中仅包含I(珚S)中元组标识的布尔公式,而不包含查询处理中间结果元组的标识.以元组标识作为原子公式,取值为1(True)或0(False),分别表示给定查询中是否包含该元组.例1.针对图1中的连接查询EventRoster=πperson,event(AttendsEvents)和EventAttendees=πperson(EventRoster),结果元组41的世系表达式为(11∧21)∨(12∧23)→41.为了从世系表达式λ(t)和输入的不确定性数据珚S构建等价的BN,以下2.1节和2.2节分别讨论BN的概率图模型结构构建和各结点概率参数的计算.2.1构建贝叶斯网的有向无环图结构我们首先从世系表达式构建反映数据间依赖关系的DAG,然后分别讨论其条件独立性和概率语义,证明该DAG是反映数据间条件独立性的概率模型,作为BN的DAG结构.2.1.1基于世系表达式构建依赖模型Horn子句是文字的析取式,其中带有最多一个正文字,基于Horn子句进行逻辑推理可得出唯一的结论,且Horn子句可以方便地转换为等价的逻辑蕴含式[14].因此,我们将λ(t)中的元组标识(正文字)作为原子公式(其否定也是原子公式),为了将布尔公式转换为等价的DAG,首先将λ(t)→t等价地转换为Horn子句的合取式,Horn子句的集合记为Σ.例2.例1中的世系表达式(11∧21)∨(12∧23)→41,可做如下转换:(11∧21)∨(12∧23)→41=(11∧21)∨(12∧23)∨41=((11∧21)∧(12∧23))∨41=(11∨21∨41)∧(12∨23∨41),转换结果为Horn子句(11∨21∨41)和(12∨23∨41)的合取式.Page4为了将世系表达式转换为满足条件独立语义的DAG模型,即用图模型表示查询处理中数据的相互依赖关系(即数据的相关性),我们将其称为世系依赖模型,记为MΣ.定义2.设F为Σ中原子公式的集合,X和Y分别是Σ中两个不相交的原子公式集,X和Y对Z独立,记为〈X|Z|Y〉MΣ,Z=F\(X∪Y),如果(1)存在一个Horn子句的集合CSΣ,使得F中包含于CS中的原子公式也包含X和Y;(2)不存在Σ中的任何一个Horn子句Ci,使得Ci包含X和Y.例3.若Σ=(C1=A∨B∨C)∧(C2=A∨D)∧(C3=B∨D),S={A,B,C,D},则存在CS={C1,C2,C3},使得X=C,Y=D,有{A,B,C,D}X∪Y,且不存在任何一个Ci(i=1,2,3)包含X∪Y,因此Z=S\(X∪Y)=A∪B,有〈X|Z|Y〉MΣ,即〈C|A∪B|D〉MΣ.由世系表达式A1A2…An→B,可以得到等价的Horn子句Ci=(A1∨A2∨…∨An∨B),其中B为查询处理结果元组的标识,A1,A2,…,An为输入元组的标识,是Ci中依赖关系的基础.直观地,Ci蕴含A1∧A2∧…∧An→Ai(i=1,2,…,n)和A1∧A2∧…∧An→B.因此,我们将Ci=(A1∨A2∨…∨An∨B)等价地转换为Cj=(A1∨A2∨…∨An∨A1∧A2∧…∧An∨B),将A1∧A2∧…∧An称为Cj的核,记为Corej.为了表示的方便,我们用A1A2…An表示A1∧A2∧…∧An.Cj的世系图(LG)G=(V,E),其中V是结点的集合,E是有向边的集合.G中的每个结点对应Cj中的一个原子公式或原子公式的合取式,若Cj蕴含X→Y,那么G中就有一条从X指向Y的有向边.根据上述思想,Cj可转换为图2中与之逻辑上等价的G1或G2,但是G1不满足PGM的条件独立性,由后续讨论可知G1不是一个概率模型.因此,我们首先针对各Ci构建形如G2的LG,然后再将构建的LG进行合并,下面给出构建LG的方法.考虑不确定性数据查询本身的特征,连接查询的安全性决定了是否可以得到正确的查询结果概率,不安全(Unsafe)的数据查询(中间结果不独立)处理是#P困难的问题[17].以两个x-relation的安全(Safe)连接查询为代表,如例2中的(11∧21)∨(12∧23),基于上述构建LG的基本思想,核结点中包含参与连接的每个x-relation中的元组,对应于查询处理的中间结果,例如11∧12和12∧23,各LG中的核结点相互独立.然而,对于形如(11∨13)∧23→51的不安全查询,由51共同指向的两个核结点12∧23和13∧23并不独立,这与概率模型的条件独立性[7]相违背.文献[17]也针对引起不安全的数据引入了符号变量、给出了局部世系的概念,用And-Or图描述独立关系的中间结果.因此,借鉴这一思路,为了基于PGM给出一种对于安全和不安全连接查询都适用的统一世系表示机制,且保证图模型的条件独立性,我们将参与某个连接查询、且属于同一个的x-rela-tion的多个元组的析取式视为一个整体来考虑.定理1.对于任意Si与Sj(i≠j,Si,Sj∈珚S)连接查询的世系函数∨i,jtjl)),令x=ti1∨…∨tik,y=tj1∨…∨tjk,则LG中对应于∨i,j证明.由于x和y分别是对Si和Sj(i≠j)执行选择操作的结果,x∩y=,则对于任意两个核结点x1∧y1和x2∧y2,由于x1∩y1=且x2∩y2=,又有x1≠x2且y1≠y2,则核结点x1∧y1与x2∧y2相互独立.因此,我们首先按照定理1对λ(t)→t的Horn子句集进行预处理,例如(11∨13)∧23→51对应的Horn子句为x-∨23∨51(其中x=11∨13),仍将x视为原子公式.然后,通过算法1构建各Horn子句对应的LG.算法1.对每个Ci构建LG.输入:世系表达式λ(t)→t输出:各Ci对应的LGGi步骤:1.初始化:1.1.将λ(t)→t等价地转换为满足定理1的Horn子1.2.将每个Ci=(A1∨A2∨…∨An∨B)等价转换为2.对Σ中的每一个Horn子句,构建相应的LG:2.1.针对Cj=(A1∨A2∨…∨An∨A1∧A2∧…∧An∨Page52.2.针对Ck=(Ai∨B),构建形如图3(b)中的G2.例4.针对世系表达式(11∧21)∨(12∧23)→41对应的Horn子句(11∨21∨41)和(12∨23∨41),分别构建如图4(a)和图4(b)的LG.注意到,指向核的结点包括两类原子公式对应的结点:连接所涉及x-relation中的元组标识的否定以及查询结果元组标识的否定.为了计算结果元组t的概率,需考虑Σ中的所有Horn子句(具有合取关系),即需将各Ci对应的LG合并为一个全局LG.合并Gk和Gl的基本思想如下:(1)对于查询结果元组t,存在t-→Corei和t-→Corej,为了方便计算t的概率,我们将t-→Corei和t-→Corej分别等价转换为Corei→t和Corej→t,并引入结点⊥、Corei和Corej,⊥=Corei∧Corei,⊥分别指向Corei和Corei.(2)将Gk和Gl中的两个⊥合并为一个⊥,并指向原⊥所指向的所有结点.(3)将Gk和Gl中的两个t合并为一个t,并将原来指向t的所有结点指向合并后的t.需要说明的是,对任意Gk和Gl,由定理1可知,不可能存在相同的Ai分别指向Gk和Gl的核结点.引入的结点⊥=Corei∧Corei恒为False(即0),则⊥→Corei和⊥→Corei都恒为True(即1),因此引入⊥保证了Horn子句逻辑上的等价性.例5.根据上述思想对图4(a)和图4(b)的LG进行合并,可以得到如图5所示的全局LG.若|Σ|为Horn子句的个数,每个Horn子句至多包含n个原子公式,则算法1的计算时间为O(|Σ|·n),对各LG进行合并的计算时间为O(|Σ|).因此,我们可以在多项式时间内高效地构建LG.如前所述,只有LG反映了Σ中数据的条件独立性,才可能作为拟构建BN的图结构.d-分离[7-8]是用DAG模型中描述变量间条件独立性的基本概念,下面首先给出d-分离的定义,进而讨论LG的d-分离性质,证明LG即为定义2中的依赖模型MΣ.定义3[7-8].设X,Y和Z是DAGG=(V,E)中不相交的结点集,称X和Y对于Z是d-分离的,记为〈X|Z|Y〉G,当且仅当从X中结点到Y中结点的路都不能被Z激活.DAG中一条路被结点集Z激活,如果它满足:(1)路上的每个汇聚结点(即两条有向边指向的公共结点)都在Z中,或者存在一条从汇聚结点到Z中的结点有向路;(2)路上的非汇聚结点都不在Z中.引理1.设α和β是LG中的两个非核结点,如果α和β包含于某个含有α的Horn子句Ci对应的子图Gα中,则〈α|V-α-β|β〉G不成立.证明.由算法1和LG的合并策略可知,存在从α到β的路包含了核结点Coreα,该核结点在带有汇聚边的Gα中.由定义3,由于Coreα∈V-α-β,因此〈α|V-α-β|β〉G不成立.引理2.设α和β是LG中的两个非核结点,如果α和β不被包含于某个含有α的Horn子句Ci对应的子图Gα中,则〈α|V-α-β|β〉G成立.证明.由算法1和LG的合并策略可知,α和β之间任意一条路ri必包含子图Gα和Gβ的核结点Coreα和Coreβ.(1)若ri包含⊥,注意到⊥是非汇聚结点且⊥∈V-α-β,由定义3,ri不能被V-α-β激活.(2)若ri包含Coreα和Coreβ,由于Coreα和Coreβ不相邻,则ri中必存在非核结点θ(θ∈V-α-β)为非汇聚结点,由定义3,ri不能被V-α-β激活.因此,〈α|V-α-β|β〉G成立.Page6由引理1和引理2,可以容易地得出结论:LG即为定义2中的依赖模型MΣ,如定理2所述.定理2.设Σ为世系表达式所对应Horn子句的集合,G为相应的LG,X和Y是Σ中两个不相交的原子公式集,Z=F\X∪Y,F为Σ中原子公式的集合.设,和=V--为G中与X,Y和Z对应的结点集.若〈||〉G成立,则〈X|Z|Y〉MΣ成立;若〈||〉G不成立,则〈X|Z|Y〉MΣ也不成立.即〈|V--|〉G〈X|F-X-Y|Y〉MΣ.2.1.2依赖模型的概率语义由PGM的定义可知,仅当依赖模型为一个概率模型,才能基于该模型进行概率推理[7-8].也就是说,只有有向无环图LG仍为一个概率模型,才可基于LG进行概率推理,进而得到结果元组t的概率.Pearl[7]已经证明了依赖模型作为概率模型的必要条件:对称律、分解律、弱归并律、收缩律和相交律.定理3给出了依赖模型LG所满足的概率模型条件.定理3.设Σ为世系表达式所对应Horn子句的集合,X,Y和Z是Σ中3个不相交的原子公式集.〈X|Z|Y〉MΣ满足如下独立条件:〈X|Z|W〉MΣ;Y〉MΣ;〈X|Z|Y∪W〉MΣ;〈X|Z|Y∪W〉MΣ.(1)对称律〈X|Z|Y〉MΣ〈Y|Z|X〉MΣ;(2)分解律〈X|Z|Y∪W〉MΣ〈X|Z|Y〉MΣ∧(3)弱归并律〈X|Z|Y∪W〉MΣ〈X|Z∪W|(4)收缩律〈X|Z|Y〉MΣ∨〈X|Z∪Y|W〉MΣ(5)相交律〈X|Z∪W|Y〉MΣ∨〈X|Z∪Y|W〉MΣ证明.(1)由独立表达式可知,对称律成立.(2)假设〈X|Z|Y∪W〉MΣ成立,由定义2可知,Σ中存在3个Horn子句的集合F1X∪Z,F2Y∪Z,F3W∪Z,而不存在Cix,y(或Cix,w),其中x,y和w分别为X,Y和W中的原子公式.根据定义2,如果〈X|Z|Y〉MΣ且〈X|Z|W〉MΣ成立,则Σ中存在F1X∪Z,F2Y∪Z,F3W∪Z,而不存在Cjx,y,Ckx,w.注意到,Σ中不存在这样的Ci,Cj和Ck,因此F1=F1,F2=F2,F3=F3,进而〈X|Z|Y∪W〉MΣ〈X|Z|Y〉MΣ∧〈X|Z|W〉MΣ成立.(3)由〈X|Z|Y∪W〉MΣ可知,Σ中存在3个Horn子句的集合F1X∪Z,F2Z∪Y,F3Z∪W,而不存在Cix,y(或Cix,w).根据定义2,若〈X|Z∪W|Y〉MΣ成立,则Σ中存在两个Horn子句的集合F1X∪Z∪W,F2Z∪W∪Y,而不存在Cjx,y.若F1和F3为Σ中的Horn子句集,那么F1也是一个Horn子句集;若F2和F3为Σ中的Horn子句集,那么F2也是一个Horn子句集.由于Ci不存在,Cj也不存在.因此,〈X|Z|Y∪W〉MΣ〈X|Z∪W|Y〉MΣ成立.(4)由〈X|Z|Y〉MΣ∨〈X|Z∪Y|W〉MΣ可知,Σ中存在4个Horn子句的集合F1X∪Z,F2Y∪Z,F3X∪Z∪Y,F4Z∪Y∪W,而不存在Cix,y,Cjx,w.根据定义2,如果〈X|Z|Y∪W〉MΣ成立,则Σ中存在两个Horn子句的集合F1X∪Z,F2Z∪Y∪W,而不存在Ckx,y(或Ckx,w).注意到F1=F1,F4=F2,由于Σ中不包含Ci和Cj,则Σ中不包含Ck.因此,〈X|Z|Y〉MΣ∨〈X|Z∪Y|W〉MΣ〈X|Z|Y∪W〉MΣ成立.(5)由〈X|Z∪W|Y〉MΣ∨〈X|Z∪Y|W〉MΣ可知,Σ中存在3个Horn子句的集合F1X∪Z∪W,F2Z∪W∪Y,F3X∪Z∪Y,而不存在Cix,y,Cjx,w.注意到F1F1,F2=F2,由于Σ中不包含Ci和Cj,则Σ中不包含Ck.因此,〈X|Z∪W|Y〉MΣ∨〈X|Z∪Y|W〉MΣ〈X|Z|Y∪W〉MΣ成立.由定理3可得出结论:依赖模型LG满足概率模型的条件,LG既等价地反映了λ(t)→t中的逻辑语义,也等价地反映了其中蕴含的概率独立语义.上述讨论从理论上保证了所构建的LG为PGM,我们以LG作为BN的DAG结构.2.2计算贝叶斯网的概率参数为了计算LG中各结点的CPT,与输入x-relation中相关元组对应的结点(即无父亲的结点),我们直接由输入的x-relation计算得到,例如:基于图1中的不确定性数据,可得到P(11=1)=0.2.而计算对应于查询处理中间结果的各结点的CPT,是本节讨论的重点.根据LG的构建及合并方法,不难看出,LG具有如下性质:(1)为了合并各Horn子句所对应的LG,我们引入了保证逻辑上等价的⊥结点,而这类结点对于描述λ(t)中表达的连接查询、计算结果元组t的概率,并不产生直接影响.因此,在CPT计算和概率推理时,我们将忽略LG中的⊥结点,图6给出了忽略图5中⊥结点后的LG形式.(2)全局LG中,除⊥结点之外,无父亲的结点对应于x-relation中的输入元组,无孩子的结点对Page7应于查询结果元组t,其它结点对应于查询处理的中间结果且相互独立(如定理1所述).(3)对于涉及多个x-relation的连接查询,多个父亲结点与其共同孩子结点之间为逻辑“或(OR)”的关系.例如,图5中的LG包含如下“或”关系:11∨21→11∧21和(11∧21)∨(12∧23)→41.BN的概率推理基于DAG结构和CPT、通过信念传播(Beliefpropagation)完成[7-8].因此,为了构图7LG的CPT基于世系表达式和输入的不确定性数据,2.1节和2.2节分别给出了构建DAG概率依赖模型、计算结点概率参数的方法,从而构建了描述世系表达式中所涉及数据间相互依赖关系的PGM,我们将其称为世系贝叶斯网(LineageBayesianNetwork,LBN),为世系分析提供了有效的概率推理模型基础.3案例研究针对文献[6]中的经典案例,即本文图1中的不确定性数据和例1中的世系表达式(11∧21)∨建中间结点的CPT,体现父子结点取值之间的“或”关系,我们借鉴文献[11]中“因子(Factor)”参数的概念,给出通过父亲结点取值来导出孩子结点取值的函数,并反映基于DAG进行信念传播的思想,将其称为概率参数函数.定义4.设A为LG中任意存在父亲的结点,A的概率参数函数定义为P(A=a|犘犪(犃)=(a1,a2,…,am))=fOR其中:犘犪(犃)=A1,A2,…,Am,为A的父亲结点集,a,a1,a2,…,am∈{0,1},分别为A,A1,A2,…,Am的取值,P(A=a|犘犪(犃)=(a1,a2,…,am))∈{0,1}.例6.对于表示为图5的LG,根据定义4,我们分别定义fOR12∧23,12,23,fORfOR所示.(12∧23)→41,基于本文中基于PGM的世系表示方法,LBN的DAG和CPT分别如图6和图7所示,本节给出将所构建的LBN应用于世系概率计算的案例.需要计算结果元组41的概率,即变量41取值为1(True)时的边缘概率分布P(41=1),基于LBN可以得到如下计算公式(由于篇幅的限制,我们忽略了值为0的所有项):P(41=1)=∑11∑21∑12∑23∑11∧21∑12∧23P(23)·P(11∧21|11,21)·P(12∧23|12,23)·P(41=1|11∧21,12∧23)=Page80.8×0.8×0.7×0.9×1×1×1+…+0.8×0.8×0.7×0.1×1×1×1+…+0.8×0.8×0.3×0.9×1×1×1+…+0.8×0.8×0.3×0.1×1×1×1+…+0.8×0.2×0.7×0.9×1×1×1+…+0.2×0.8×0.7×0.9×1×1×1+…+0.2×0.2×0.7×0.9×1×1×1=0.8668.可见,基于LBN的世系概率计算结果与文献[6]中的结果相同,这从一定程度上验证了本文基于PGM的不确定性数据世系表示方法是正确的、可行的.同时,由以上P(41=1)的计算过程不难看出,相对于直接基于可能世界的方法,LBN中变量间的条件独立性使得边缘概率的计算得到很大程度的简化,大大减少了所涉及概率分布的数量,这正是基于PGM进行世系分析的优势所在.4实验结果第2节给出了LBN构建算法的时间复杂度分析和LBN作为PGM的正确性证明,除此之外,为了进一步测试本文方法的有效性,我们实现了LBN构建以及基于LBN的世系概率计算方法,测试了LBN构建方法的效率、基于LBN表示世系的空间开销以及基于LBN进行世系概率计算的性能.实验环境如下:IntelPentium(R)Dual-Core3.00GHz处理器,2GB内存,WindowXPProfessional操作系统,使用MySQL5.1存储不确定性数据和LBN的CPT,使用Java语言编写程序.首先,我们基于TPC-H基准数据集[18]中的Orders表和Lineitems表(分别简记为O和L),针对O和L的一对一、一对多和多对多连接查询,测试了连接所涉及元组总数增加时构建LBN的效率,如图8所示.可以看出,构建LBN所需时间对元组总数并不敏感.元组数量相同时,多对多情形下构建LBN耗时最多,一对一情形下耗时最少,因为需要针对一对多和多对多的情形进行如定理1所描述的预处理,这成为了影响LBN构建效率的瓶颈.然后,我们测试了用LBN表示不确定性数据连接查询世系的空间开销,并与直接基于布尔公式的世系表示的空间开销进行了比较.基于本文第2节中的从Horn子句到DAG的转换、DAG的合并等步骤,我们可得到表示给定世系表达式的LBN,作为最终表示世系信息的概率图模型.我们将表示世系的布尔公式及相应LBN的DAG结构存储在文件中,测试了连接操作所涉及元组总数增加时文件大小增加的趋势,如图9所示(采用了对数刻度).可以看出,对于表示同一世系信息的布尔公式和LBN,后者所耗费的空间远远高于前者,这与布尔公式及LBN本身的表示机制而导致的空间开销差异相一致,因为后者不仅需要描述参与连接查询的输入元组、中间结果和结果元组,并且还要以DAG描述它们之间的相互关系.然而,基于构建得到的LBN可进行任意正确、高效的概率推理,而不需在每次世系分析时都为给定的布尔公式构建支持概率计算的模型,因此,LBN与给定的世系表达式一一对应,LBN的空间开销保证了方法统一且处理高效的世系分析.接着,我们分别考虑O表和L表的一对多和多对多连接查询且查询结果中只包含1个元组的情形,测试了世系概率计算(记为LBN)的效率,并将其与文献[6]中信念值计算方法(记为RC)的效率进行了比较,如图10所示.可以看出,LBN和RC的效率随着参与连接的元组数量增加都不敏感,且计算时间增加的趋势基本一致.然而,预处理也是影响基于LBN进行世系概率计算效率的瓶颈.综上,本节给出的实验结果表明,本文基于PGM的不确定性数据世系表示方法,在模型构建、空间开销和应用于世系概率计算等方面,都有较好的性能,从一定程度上验证了本文所提出方法的有效性.然而,针对预处理的高效算法和优化策略,是我们将要重点研究并进行测试的内容.Page9图10基于LBN的世系概率计算效率5总结与展望以有效支持不确定性数据世系分析为目标,以不确定性的跟踪和计算为核心,本文基于元组独立假设提出了一种基于概率图模型的世系表示方法,给出了将布尔公式等价转换为贝叶斯网的算法,适用于数据处理结果包含任意多个元组、以及世系表达式中包含任意多个布尔公式的情形.理论分析、案例研究和实验结果表明,本文的方法为世系分析提供了一种有效性的数据相关性表示和概率计算框架.然而,缺乏高效的预处理策略,是本文方法的主要不足之处.直接计算不确定性数据查询结果元组的概率往往是#P困难的[4,6],由第3节中的案例可以看出,虽然基于本文的方法可以提高世系分析的效率,但基于LBN的精确概率推理计算仍具有指数级的时间复杂度,因此,对精确概率推理算法的优化或进行近似推理,是我们正在开展的工作.此外,将世系表示为LBN,除了世系概率计算之外,仍可以利用LBN之上的后验概率推理进行任意形式的世系分析,进而追踪数据来源的不确定性、数据审核与质量评估;针对元组不独立的情形,讨论世系的有效表示和概率计算方法,这些是我们将要开展的工作.
