Page1基于Petri网的跨组织应急联动处置系统建模与分析曾庆田鲁法明刘聪孟德存(山东科技大学信息科学与工程学院山东青岛266510)摘要应急联动系统具有的跨组织特性、组织部门间任务协同模式的复杂性以及应急处置时间和资源消耗的不确定性,使得跨组织应急联动系统缺乏形式化的建模和分析方法.为此,文中针对跨组织应急联动系统的形式化建模和分析方法进行研究.首先给出了应急联动任务的形式化模型,分析了跨组织协作过程中任务之间存在的各种关系;在Petri网模型的基础上扩展了任务执行组织部门、资源消耗以及消息传递等任务要素,提出了OTRM_Net的概念,并以此为工具对跨组织应急联动系统中的任务协同模式和应急处置流程进行了形式化建模;最后,基于OTRM_Net模型研究了应急处置流程的时间性能分析、资源冲突检测以及部门内部任务化简等问题,针对上述问题提出了形式化的解决方案.关键词应急联动系统,跨组织工作流,Petri网,资源冲突检测,时间性能分析1引言随着突发事件种类日益复杂与多变,传统的应对机制已不能适应突发事件应急处置的需要.尤其是面临突发重大灾害事件时,单个部门的能力无法解决危机,需要联合多家单位共同参与应急处置,2001年的“9·11”恐怖袭击事件是这类事件的典型代表.自“9·11”事件爆发以来,各地掀起了建立应急联动系统(EmergencyResponseSystem,ERS)的研究热潮.所谓应急联动系统就是将公安、交通、通信、急救、电力、水利、地震、人民防空、市政管理等组织部门纳入统一的指挥调度系统,处理突发紧急事件和向公众提供社会紧急救助服务的信息系统,以此实现跨区域、跨组织、跨警种之间的统一指挥、快速反应、统一应急、联合行动,为城市的公共安全提供强有力的保障[1].跨组织的应急联动系统具有多组织协同的特性,而且组织间任务的协同模式非常复杂[2-5].此外,应急处置过程中,任务执行时间和应急资源的消耗均具有不确定性,这使得跨组织应急联动系统缺乏行之有效的形式化建模和分析方法.关于应急联动系统的建模和分析问题已有很多研究[4-8],其中不乏基于Petri网对应急联动系统进行分析的研究工作[6-8].文献[6]利用Petri网对我国典型的城市重大突发事件应急联动系统的应急性能进行分析,并初步建立城市重大事件应急联动系统性能分析的Petri网模型.文献[7]利用着色Petri网对应急联动系统业务流程进行分析,并利用CPNTools实现应急联动系统流程的建模与仿真,同时对所建模型的时间性能进行了分析.上述工作对基于Petri网进行应急联动指挥系统的建模和分析具有一定的指导作用和借鉴意义.但是这些工作普遍缺乏对组织间协同模式的研究.在跨组织工作流研究领域,文献[2]总结了跨组织工作流的典型特征:文献[3]基于交互模式的不同将其分为分布式工作流和外包式工作流.文献[4]总结了工作流程间的5种相互操作形式,它们是能力共享、合同转包、事例转移、链状执行和松散耦合.文献[5]对跨组织应急联动系统中的组织间任务的协同模式进行了初步研究.但是上述工作缺少对跨组织流程形式化模型的研究.在跨组织工作流建模方面,文献[9]提出的基于消息顺序图(MSC)和Petri网的建模方法可应用于分布式情境(供应链)中的工作流.文献[10]把数据库领域中事件驱动的思想应用于工作流建模领域中来,由此提出事件驱动过程链的方法,并把业务流程描述为一连串的事件.文献[11]使用面向对象的方法对跨组织工作流进行建模.除上述基于Petri网的跨组织工作流建模研究之外,文献[12-17]基于Petri网对工作流系统的结构性质和时间性能等进行了理论上的分析.这些研究成果对于跨组织应急联动系统中组织间协同模式的研究和跨组织应急联动流程的建模、分析有很好的借鉴和指导意义,但它们普遍缺乏对应急联动领域的特点和实际需求的分析,对组织间任务的资源冲突消解问题和多组织协作基础上的时间性能分析问题研究较少.针对上述问题,本文从应急联动场景出发,首先分析了跨组织协作过程中任务之间存在的各种协同关系;之后,在Petri网模型的基础上扩展了执行组织部门、使用资源以及收发消息等任务要素,提出了OTRM_Net的概念,并以此为工具对跨组织应急联动系统中的任务协同关系、应急处置流程进行了形式化建模.此外,本文基于OTRM_Net模型对应急联动系统中组织部门内部业务流程的化简问题、资源冲突检测问题、应急处置流程的时间性能分析问题提出了形式化的解决方案,并结合实例对这些理论和方法进行了验证.2跨组织应急联动系统本节结合某市恐怖袭击事件应急预案中规定的处置流程实例描述应急联动系统中任务的构成要素以及任务之间的协同关系,由此抽象出跨组织应急联动系统中任务的形式化模型,并给出任务协同关系的形式化定义.2.1应急联动场景实例根据某市预案规定,当发生突发恐怖袭击事件后,各组织部门的应急处置框架如图1所示,具体的联动处置程序如下:(1)地方派出所接警,之后向区反恐和刑事案件应急指挥部办公室(区公安局)汇报警情,在针对该事件的应急指挥部成立之前开展先期处置(就近调动警力和专门力量赶赴现场,疏散群众,封锁现场,抢救伤员,开展现场调查,搜捕疑犯等),并及时向指挥部上报现场调查情况;(2)应急指挥部办公室接报后立即开通指挥部,组织相关部门和专家及时判明事件性质和危害,提出应对意见,制定处置方案;Page3工作,主要措施包括:(3)指挥部立即组织力量开展现场处置和救援①组织排爆部门赶赴现场排除并转移现场易②组织消防等部门赶赴现场进行灭火、人员救燃、易爆物品;治和隐患清除,并及时将相关情况汇报指挥部;图1某恐怖爆炸袭击事件应急处置框架分析上述应急处置方案可见:(1)参与应急联动的组织部门包括5个:派出所、应急指挥部办公室(公安局)、消防队、卫生局和特警排爆分队;(2)每个组织部门有各自的任务集合,任务具有一些固有属性.例如,派出所的任务有“接警”、“事件上报”等,指挥部办公室有“开通指挥部”、“制定下达处置方案”等,消防队有“赶赴现场”、“灭火”等.每个任务包含任务名称、任务执行部门、执行时间等要素;(3)任务的执行可能需要使用一定的资源.比如派出所执行“赶赴现场”任务时需要用到警车,消防队执行任务“灭火”需要用到“消防车”;(4)任务之间可能存在顺序依赖关系.以派出所③组织卫生部门的医疗力量赶赴现场,进行现场急救与分流,对污染区域洗消除毒,并及时汇总伤亡情况汇报指挥部;(4)缜密侦查,缉捕恐怖分子和刑事犯罪分子;(5)组织消防、医疗等各部门研究确定对外宣传口径,开展宣传报道.负责的任务为例,“上报”是“接警”的一个后继任务;(5)任务之间可能存在并行关系.以消防队负责的任务为例,任务“灭火”与“人员救治”可以同时展开,相互之间不存在顺序依赖关系;(6)组织部门间的任务可能存在消息传递关系.比如,派出所执行“事件上报”任务时向指挥部办公室上报“警情信息”,办公室收到该消息后触发任务“成立指挥部”,“警情信息”以消息的方式在派出所的任务“事件上报”和指挥部办公室的任务“成立指挥部”间进行传递;(7)任务间可能存在资源共享关系,例如,消防队赶赴现场任务和控制火势任务都用到“消防车”资源,这两个任务间存在资源共享关系;(8)某些任务的执行可能需要多个组织部门同Page4时参与.以任务“宣传报道”为例,该任务需要指挥部办公室、卫生局、消防等多个部门共同参与完成.此时,指挥部的“宣传报道”任务和卫生局的“宣传报道”任务之间具有的关系为“同步”.由上述分析可见,跨组织应急联动系统中,一个任务应该包括任务名称、执行部门、执行时间、发送消息集合、接收消息集合、使用资源集合以及后继任务等要素,而且任务之间可能存在顺序、并行、同步、消息传递、资源共享等各种关系.基于上述分析,下面分别给出跨组织应急联动系统中的任务模型以及任务之间各种关系的定义.2.2任务模型化定义如下:跨组织应急联动系统中,一个任务模型的形式定义1.一个任务是一个七元组Task=〈Name,Duration,Organization,其中:做什么;(1)Name表示任务的名称,指出该任务具体要(2)Duration表示任务执行的时长;(3)Organization表示任务的执行组织部门;(4)MessagesReq表示任务执行前需要接收的消息集合.若集合为则说明该任务不需要接收任何消息就可以执行;(5)MessagesSent表示任务执行完成后发出的消息集合.该集合为则表明任务执行完成后不会发出消息;(6)犚犲狊狅狌狉犮犲狊表示任务执行时需要使用的资源集合.假设系统所需资源集合为ResourceSet={r1,r2,…,rn},则犚犲狊狅狌狉犮犲狊是一个n维向量,记为Resource(t)=〈amount(r1),amount(r2),…,amount(rn)〉,其中,amount(ri)表示任务t执行时需要使用资源ri的数量(1in);(7)PostTasks表示任务的后继任务集合,只有当前任务执行完成后,PostTasks中的任务才能被执行.在定义1所给出的任务模型中,Duration给出了任务执行的时长,用一个闭区间[α,β]表示,其中α表示任务执行需要的最小时间,β表示任务执行需要的最大时间.犚犲狊狅狌狉犮犲狊用一个向量〈amount(r1),amount(r2),…,amount(rn)〉表示,amount(ri)表示任务执行时需要占用资源ri的数量.本文中假设资本节给出突发事件处置过程中任务关系的形式顺序关系分直接顺序依赖和间接顺序依赖两种源在任务执行完毕释放后仍然是可重用的,对于不可重用资源的情况将在后续文章中予以详细讨论.若某任务t的PostTasks=,则表示t完成后无后续任务可以执行.2.3任务关系化定义.如果一个任务执行完毕之后另一个任务方能开始执行,则此时两个任务之间存在执行次序上的依赖关系,称两者之间具有顺序关系.例如,图1中,派出所的任务“接警”与任务“事件上报”之间存在顺序关系,因“事件上报”必须在“接警”之后执行.情况,其定义如下.定义2.如果任务〈T1,D1,O1,MessagesReq1,MessagesSent1,犚犲狊狅狌狉犮犲狊1,PostTasks1〉和〈T2,D2,O2,MessagesReq2,MessagesSent2,犚犲狊狅狌狉犮犲狊2,PostTasks2〉满足条件T2∈PostTask1,则称T2直接依赖于T1,记作T1<·T2.如果存在任务序列σ=Ti1Ti2…Tik满足T1<·Ti1<·Ti2<·…<·Tik<·T2(其中k1),则称T2间接依赖于T1,记作T1<T2.若(T1<·T2)∨(T1<T2)为真,则称T2间接依赖于T1,记作T1<T2.当(O1=O2)∧(T1<T2)时,T1和T2是同一组织部门内部具有顺序关系的两个任务;当(O1≠O2)∧(T1<T2)时,T1和T2是分属于两个组织部门的具有顺序关系的两个任务.在同一突发事件的应急处置过程中,如果两个任务之间不存在顺序依赖关系,则这两个任务之间存在并行关系.例如图1中,消防队的任务“灭火”与“人员救治”不存在顺序依赖关系,两者之间可以并行开展,存在并行关系.并行关系的形式化定义如下.定义3.如果任务〈T1,D1,O1,MessagesReq1,MessagesSent1,犚犲狊狅狌狉犮犲狊1,PostTasks1〉和〈T2,D2,O2,MessagesReq2,MessagesSent2,犚犲狊狅狌狉犮犲狊2,PostTasks2〉满足条件(T1<T2)∧(T2<T1),则称T1和T2间存在并行关系,记作T1‖T2.若O1=O2,则T1和T2称为组织部门内部的并行任务;若O1≠O2,则称T1和T2为组织部门间的并行任务.如果两个任务在执行过程中用到同一资源,则称两者之间存在资源共享关系.例如图1中,消防队“赶赴现场”任务和“灭火”任务都用到“消防车”资源,这两个任务间存在资源共享关系.资源共享关系Page5的形式化定义如下.定义4.如果两个任务〈T1,D1,O1,MessagesReq1,MessagesSent1,犚犲狊狅狌狉犮犲狊1,PostTasks1〉和〈T2,D2,O2,MessagesReq2,MessagesSent2,犚犲狊狅狌狉犮犲狊2,PostTasks2〉满足条件犚犲狊狅狌狉犮犲狊1·犚犲狊狅狌狉犮犲狊2≠0,其中,犚犲狊狅狌狉犮犲狊1·犚犲狊狅狌狉犮犲狊2表示向量犚犲狊狅狌狉犮犲狊1和向量犚犲狊狅狌狉犮犲狊2做乘法运算,0为零向量.则称T1和T2之间存在资源共享关系.若O1=O2,则T1和T2为同一组织部门内部具有资源共享关系的任务;若O1≠O2,则T1和T2为组织部门间具有资源共享的任务.如果同一任务由多个组织共同承担,由此形成了多个分属于各自组织部门内部的任务,这些部门内部的任务具有相同的任务内容、任务执行时间、收发消息及使用资源等属性,此时称这些任务之间存在同步关系.例如图1中,“宣传报道”任务由指挥部、卫生局、消防等组织部门共同完成,这些组织的这一任务之间就存在同步关系.同步关系的形式化定义如下.定义5.如果两个任务〈T1,D1,O1,MessagesReq1,MessagesSent1,犚犲狊狅狌狉犮犲狊1,PostTasks1〉和〈T2,D2,O2,MessagesReq2,MessagesSent2,犚犲狊狅狌狉犮犲狊2,PostTasks2〉满足条件则称T1和T2之间存在同步关系.如果一个组织任务的执行需要接收另一个组织任务发出的消息,则称两者之间存在消息传递关系.例如,图1中,派出所执行“事件上报”任务时向指挥部办公室发送消息“警情信息”,指挥部执行任务“成立指挥部”需要接收这一消息.消息传递关系的形式化定义如下.定义6.如果两个任务〈T1,D1,O1,MessagesReq1,MessagesSent1,犚犲狊狅狌狉犮犲狊1,PostTasks1〉和〈T2,D2,O2,MessagesReq2,MessagesSent2,犚犲狊狅狌狉犮犲狊2,PostTasks2〉满足条件(O1≠O2)∧(MessagesReq1∩MessagesSent2≠)∨(MessagesReq2∩MessagesSent1≠),则称T1和T2之间存在消息传递关系.3基于扩展Petri网的建模方法在应急联动系统中,任务存在执行部门、消耗资源、消息传递以及执行时间等属性,这些属性对于应急处置流程的性能分析、资源冲突检测和部门间任务隐私保护具有重要作用,为进行流程分析,本节基于Petri网对处置流程中的任务逻辑关系进行建模,同时在Petri网模型的基础上扩充任务的资源和消息等信息,同时记录任务的执行时间和执行部门等信息.3.1扩展的Petri网模型Petri网通常可以用一个有向二分图来表示,其形式化定义如下.定义7[18].Petri网是一个四元组Σ=(P,T;F,M0),其中P为库所集,T为变迁集,两者不相交,F(P×T)∪(T×P)称为网的流关系,M0:P→{0,1,2,…}是Σ的初始标识.对x∈S∪T,记·x={y∈P∪T|(y,x)∈F},x·={y∈P∪T|(x,y)∈F}.图2给出了一个Petri网的例子.其中,小矩形称为变迁;小圆圈称为库所,库所内的黑点称为标记,一个库所可以没有或者有多个标记;库所和变迁之间的有向弧称为流关系.在应急联动系统中,突发事件应急处置流程中的任务可以通过Petri网中的变迁表示,任务之间的顺序和并行关系可以借助库所以及变迁引发规则来表示.比如图2中,仅当T1引发后T2方可以引发,这对应着两个任务之间的顺序关系.但是,在应急联动系统中,任务存在执行组织部门、消耗资源、消息传递以及执行时间等属性,为便于这些任务属性的显示表达以及模型分析的便利,我们在传统Petri网的基础上将任务的执行组织部门、资源、消息和时间等信息显示表达出来,称此类Petri网模型为OTRM_Net.应急联动系统中的一个任务Ti可通过图3所示的一个OTRM_Net模型表示.其中Pi1和Pi2称为逻辑库所,对应普通Petri网中的库所,用以表示任务执行时系统逻辑上需要满足的前提条件(Pi1中必须含有标记)和任务执行后对系统状态产生的逻辑上的影响(Pi2中增加一个标记).Mi1和Mi2称为消息库所,从Mi1到Ti的有向弧表示任务Ti的执行Page6需要读取库所Mi1中的消息,从Ti到Mi2的有向弧表示任务Ti执行完毕后向Mi1中输出一个消息.关于执行组织部门、执行时间、所需资源等信息不在Petri网模型中表达.下面给出OTRM_Net模型的形式化定义,其变迁引发规则与传统Petri网的引发规则类似,不再单独介绍.定义8.Σ=(P,T;F,I,E,M0)称为一个OTRM_Net,如果该模型满足下列条件:(1)P=PL∪PM,PM表示消息集合,PL表示逻辑库所;(2)T为变迁集合,每个变迁表示一个应急处置任务.若t∈T∧·(·t)=,则称t为一个初始任务,意味着该任务的执行不依赖于其它任何任务,是整个流程中最先开始执行的任务之一;若t∈T∧(t·)·=,则称t为一个结束任务,意味着该任务是整个流程中需要最后执行的任务之一;(3)FP×T∪T×P为流关系的集合;表1各类任务关系的OTRM_Net模型任务关系组织内部任务直接顺序依赖关系模型组织间任务直接顺序依赖关系模型组织间任务的同步关系模型3.3建模实例根据任务模型与任务之间关系的模型,本节建立2.1节所述应急联动处置流程的OTRM_Net模(4)(PL,T;F∩PL×T∩T×PL,犕0|PL)是一个Petri网,其中犕0|PL是标识向量犕0在集合PL上的投影;(5)I:T→R0×(R0∪{})是任务执行时间函数,这里R0表示非负实数.记I(t)=[α(t),β(t)],则α(t)表示任务t执行所需的最小时间,β(t)表示任务t执行所需的最大时间;(6)E:T→O是任务执行组织部门函数,其中O表示参与应急处置的组织部门集合;(7)犚:T→Resource(t)是任务执行的资源向量,Resource(t)={犚(t)|t∈T},犚(t)是任务t对应的资源向量.假设系统所需资源集合为ResourceSet={r1,r2,…,rn},则有犚(t)=〈amount(r1),amount(r2),…,amount(rn)〉,其中amount(ri)表示任务t执行时需要使用资源ri的数量(1in);(8)M0:p∈P,M0(p)=1,·p=的初始标识.3.2建模方法上节已经介绍了应急联动系统中一个任务的OTRM_Net模型,根据OTRM_Net模型的变迁引发规则,任务间顺序、并行、同步和消息传递关系的模型表示如表1所示.任务关系部门内部任务间接顺序依赖关系模型任务的并行关系模型组织间任务的消息传递关系模型型.对图1细化后,整个应急处置流程涉及的任务信息如表2所示.表2中所涉及的符号的具体含义如表3所示.Page7表2某恐怖袭击事件应急处置过程的任务集合事件上报赶赴现场封锁现场疏散群众抢救伤员现场勘查与报告T7D7O1搜捕疑犯开通指挥部T9D9O2制定下达处置方案T10D10O2汇总案情,缜密侦察T11D11O2{M6,M7,M8}调查破案,缉捕疑犯T12D12O2确定宣传口径T13D13O2排爆分队赶赴现场T15D15O3消防队赶赴现场T17D17O4搜爆排爆人员救治消除火灾隐患T20D20O4汇报火灾损失情况T21D21O4医疗力量赶赴现场T22D22O5现场急救与分流T23D23O5重伤者送至医院T24D24O5轻伤者现场处理T25D25O5污染区域洗消除毒T26D26O5汇总上报伤亡情况T27D27O5宣传报道R1接警电话R2R6事发现场入口R7搜爆设备R8消防车R9救护车M1警情信息M2现场情况M3医疗救援指令M4消防救援指令M5搜爆排爆指令M6搜爆排爆情况M7消防救援情况M8人员伤亡情况M9宣传口径消息O1派出所O2指挥部办公室O3特警排爆分队O4消防队O5卫生局组织部门时间符号含义符号含义符号含义符号含义符号含义表3表2中符号的具体含义资源D1[3,5]D2[2,3]D3[5,8]D4[5,8]D5[6,10]D6[20,50]D7[15,40]D8[20,50]D9[10,20]D10[20,40]D11[30,60]D12[60,7200]D13[20,40]D14[20,30]D15[5,15]D16[40,90]D17[5,15]D18[30,90]D19[20,70]D20[10,30]D21[5,10]D22[10,30]D23[10,30]D24[20,30]D25[10,20]D26[15,40]D27[5,15]D28[20,60]由表2和表3中任务的相关属性可得图1所给的应急联动处置流程的OTRM_Net模型如图4所示.其中T1为整个应急处置流程的初始任务,T14为整个应急处置流程的结束任务.4模型分析由图4所得的OTRM_Net模型可以看出,模型{M1}{M2}{M3,M4,M5}{M5}{M4}{M3}{M9}的结构较为复杂,时间和资源利用情况也不明确,本节对流程的时间性能、资源冲突检测以及部门内部模型的化简规则等问题进行讨论.4.1时间性能分析在OTRM_Net模型中,每个任务都有一个执行时间函数I:T→R0×(R0∪{}).在此基础上,根据任务之间的依赖关系可以分析单个任务的最早执行时间和最晚执行时间,进而可以分析整个流程Page8图4某恐怖爆炸袭击事件应急处置流程的OTRM_Net模型开始到结束需要的时间.4.1.1任务的最早执行时间与流程周期设I(t)=[α(t),β(t)],则任务t的最小执行时间为α(t),最大执行时间为β(t).当任务t的依赖任务集合均以最小执行时间执行完毕时,任务t的开始执行时间最早,称该时间为任务t理想的最早执行时间,记之为Timee1(t).易知Timee1(t)=0,烅烄max{Timee1(t)+α(t)|t∈·(·t)},烆如果所有任务均以最小执行时间执行完毕,则整个流程可以在最短时间内完成,称这一时间为流程的理想执行周期,记之为TimeE1.易知TimeE1=max{Timee1(t)+α(t)|(t·)·=}.当任务t的依赖任务集合均以最大执行时间执行完毕时,任务t最早可以执行的时间称为该任务稳妥的最早执行时间,记之为Timee2(t).易知Timee2(t)=0,烅烄max{Timee2(t)+β(t)|t∈·(·t)},烆表4任务的最早执行时间和最晚执行时间任务理想执行周期内完成Timee2(t)Timel2(t)任务理想执行周期完成T10000T156580T2T3T41025如果所有任务均以最大执行时间内执行完毕,整个流程的最早结束时间称为该流程的稳妥执行周期,记之为TimeE2.易知TimeE2=max{Timee2(t)+β(t)|(t·)·=}.4.1.2任务的最晚执行时间为确保整个流程以在理想执行周期TimeE1完成,各任务应有一个最晚开始执行时间,称该时间为任务理想的最晚执行时间,记之为Timel1(t).易知Timel1(t)=TimeE1,烅烄min{Timel1(t)-α(t)|t∈(t·)·},烆当要求流程以稳妥执行流程周期TimeE2完成时,各任务的最晚开始执行时间称为该任务稳妥的最晚执行时间,记之为Timel2(t).易知Timel2(t)=TimeE2,烅烄min{Timel2(t)-β(t)|t∈(t·)·},烆以图4所示OTRM_Net模型为例,根据任务间的依赖关系以及任务执行时间的定义,易得各任务的最早执行时间和最晚执行时间信息如表4所Page9Timee2(t)Timel2(t)任务理想执行周期完成任务理想执行周期内完成T51024T61010T73030T8452351067641T226565146186T9T104545106106T248585206246T11125125331331T258595206256T12155155391391T26105105236276T1321521575917591T27120120276316T1425525576917691T2823523576317631示.因T14为结束任务,故图4所示整个流程的理想执行周期为Timee1(T14)+α(T14)=275,稳妥执行周期为Timee2(T14)+β(T14)=7721.4.2资源冲突检测在OTRM_Net模型中,组织内部或者组织间的任务之间可能存在资源共享的关系,因为资源的独占性,由资源共享可能会引起资源冲突,但是资源共享并不意味着一定会出现资源冲突,仅当两者具有并行关系、执行时间有重叠、共享同一资源且对该资源请求数量超出了当前该资源总量时才会出现冲突.若要求流程在理想的流程周期内结束,则对任意任务t而言,其可能的最早执行时间为Timee1(t),可能的最晚执行时间为Timel1(t),记任务t最小执行时间为α(t),则该任务可能的执行时间区间为Interval1(t)=[Timee1(t),Timel1(t)+α(t)].此时,对于任务〈T1,D1,O1,MessagesReq1,MessagesSent1,犚犲狊狅狌狉犮犲狊1,PostTasks1〉和〈T2,D2,O2,MessagesReq2,MessagesSent2,犚犲狊狅狌狉犮犲狊2,PostTasks2〉而言,这两个任务有冲突当且仅当(犚犲狊狅狌狉犮犲狊1·犚犲狊狅狌狉犮犲狊2≠0)∧(T1‖T2)∧({x|x∈Interval1(T1)∧x∈Interval1(T2)}≠).若仅要求流程在稳妥执行周期内结束,则对任意任务t而言,其可能的最早执行时间为Timee1(t),可能的最晚执行时间为Timel2(t),记任务t最大执行时间为β(t),则该任务可能的执行时间区间为Interval2(t)=[Timee1(t),Timel2(t)+β(t)].此时,对于任务〈T1,D1,O1,MessagesReq1,MessagesSent1,犚犲狊狅狌狉犮犲狊1,PostTasks1〉和〈T2,D2,O2,MessagesReq2,MessagesSent2,犚犲狊狅狌狉犮犲狊2,PostTasks2〉而言,这两个任务有冲突当且仅当(犚犲狊狅狌狉犮犲狊1·犚犲狊狅狌狉犮犲狊2≠0)∧(T1‖T2)∧({x|x∈Interval2(T1)∧x∈Interval2(T2)}≠).下面给出资源冲突检测的算法.假设R=(amount(r1),amount(r2),…,amount(rn))是整个流程可用的资源总量,Tconflict是存在冲突的任务.算法1.输入:Σ=(P,T;F,I,E,M0),输出:Tconflict={(t1,t2)|t1与t2冲突}1.Tconflict←,TshareR←,Timee1(ps)←0,2.FORti,tj∈T(1i,j|T|∧ti≠tj)DO3.IFTshareR≠THEN4.OutputTconflict;以图4所示OTRM_Net中的任务T22和T24为例,两者共享资源R9,但是由图4中的网结构易见两个任务间有顺序依赖关系,不能并行执行,故两者不存在资源冲突.再以任务T15和T22为例,两者共享资源R6,由表3和表4中数据易知Interval1(T15)=[65,85],Interval1(T17)=[65,70],{x|x∈Interval1(T15)∧x∈Interval1(T17)}=[65,70]≠,Interval2(T15)=[146,241],Interval2(T17)=[146,161],{x|x∈Interval2(T15)∧x∈Interval2(T17)}=[146,161]≠,由此可见,无论要求流程在理想执行周期内结束Page10还是在稳妥执行周期内结束,两个任务的执行时间区间均有重叠.此外,由表2中任务关系定义可见两者之间存在并行关系,因此,这两个任务之间可能存在资源冲突,是否真正存在资源冲突应考虑资源的数量.当检测到资源冲突时应制定相应的冲突消解策略,就本例而言,根据表7中数据可知,任务T17的最早执行时间和最晚执行时间相等,这意味着该任务的延期执行将会影响整个应急处置流程的执行周期,故应该将资源优先分配给任务T17.篇幅所限,一般意义下的冲突消解策略我们将在以后的文章中给出.4.3OTRM_Net的化简为了提高跨组织应急联动系统模型时间性能分析和资源冲突检测的效率,本节给出OTRM_Net的化简规则.通过这些化简规则可以保证时间性能和资源冲突不变的前提下化简模型的规模.规则1.假设Σ=(P,T;F,I,E,M0)是一个OTRM_Net,P=PL∪PM.若存在Ti,Tj∈T,Pij∈PL使得(E(Ti)=E(Tj))∧(Ti(({Ti,Tj}×{PM}∪{PM}×{Ti,Tj})∩F=)∧({TkTk∈T∧E(Tk)≠E(Ti)∧(Tk<Ti∨Ti<Tk∨Tk<Tj∨Tj<Tk)}=)∧({TkTk∈T∧E(Tk)≠E(Ti)∧(Tk=Ti∨Tk=Tj)}=)成立,且I(Ti)=[α(Ti),β(Ti)],I(Tj)=[α(Tj),β(Tj)],则可以将Ti、Tj、Pij从网中删除,引入一个新的变迁Tij使得图6同一部门内部并行任务的化简规则需要指出的是,上述规则可以组合或重复多次使用.以图4所示OTRM_Net,根据化简规则2可将任务T4、T5与T6合并为任务T4-6,类似的T19与T20可合并为T19-20、T24与T25可合并为T24-25;再根据化简规则1,任务T3可与T4-6合并为一个任务T3-6,任务T18可与T19-20合并为一个任务T18-20,任务T23可与T24-25、T26合并为一个任务T23-25.最终可得图7所示化简后的OTRM_Net模型.·Tij=·Ti∧Tij化简规则1的含义是指,同一部门内部具有直接顺序依赖关系的两个任务,如果两者与其它部门的任务之间不存在消息传递、资源共享、顺序、同步等协同关系,则这两个任务可以合并为一个任务,如图5所示.规则2.假设Σ=(P,T;F,I,E,M0)是一个OTRM_Net,P=PL∪PM.若存在Ti,Tj,Tk∈T,Pij,Pik∈PL使(E(Ti)=E(Tj)=E(Tk))∧(·Tj=Pij∧·Tk=Pik∧·Pij=·Pik={Ti})∧(({Tj,Tk}×{PM}∪{PM}×{Tj,Tk})∩F=)∧({Tk|Tk∈T∧E(Tk)≠E(Ti)∧(Tk=Ti∨Tk=Tj)}=)∧({TmTm∈T∧E(Tm)≠E(Tj)∧(Tm=Tj∨Tm=Tk)}=)成立,且I(Tj)=[α(Tj),β(Tj)],I(Tk)=[α(Tk),β(Tk)],则可以将Tj、Tk、Pij、Pik从网中删除,引入一个新逻辑库所Pjk和变迁Tjk使得·Pjk=Ti∧Pjk化简规则2的含义是指,同一部门内部并行执行的两个任务,如果两者与其它部门的任务之间不存在消息传递、资源共享、同步、顺序等协同关系,则这两个任务可以合并为一个任务,如图6所示.相比而言,图7所示模型一方面在保留与其它组织交互接口的同时实现了内部任务细节的隐藏,使得模型中的变迁个数和库所个数有所减少;另一方面,就时间性能分析而言,从图7所示模型中可得各任务的最早开始时间、最晚开始时间信息如表5所示,整个流程的理想执行周期为Timee1(T14)+α(T14)=275,稳妥执行周期为Timee2(T14)+β(T14)=7721.分析结果与化简前所得结果相同,但问题分析得到了简化.Page11图7化简图4中OTRM_Net所得模型表5化简后任务的最早执行时间和最晚执行时间Timee2(t)Timel2(t)任务理想执行周期完成任务理想执行周期内完成T100T2犜3-6T73030T8452351067641犜18-207070T9T104545106106T226565T11125125331331犜23-267575T12155155391391T27120120T1321521575917591T28235235763176315结束语突发事件应急处置需要公安、消防、医疗等多个组织部门进行跨组织协同合作,是一种典型的跨组织协同工作流应用场景.但是,跨组织应急联动系统处置流程的建模、性能分析和资源冲突检测等问题缺乏形式化的解决方法.针对上述问题,本文主要开展了3方面的研究工作:(1)结合应急联动流程实例分析了应急联动系统中任务具有的要素,抽象出了任务的形式化模型.以任务模型为基础提炼出了任务的五种协同关系:顺序关系、并行关系、同步关系、资源共享关系和消息传递关系;(2)提出了一种基于Petri网的工作流模型OTRM_Net,并给出了利用OTRM_Net对应急联动流程进行形式化建模的方法;(3)基于OTRM_Net研究了应急处置流程时间性能分析、资源冲突检测以及模型化简规则等问题,给出了基于OTRM_Net的形式化解决方案.基于本文的工作,后续还有许多问题需要继续研究:(1)尚未处理流程中选择结构和循环结构的建模问题;(2)进行时间性能分析时未考虑资源冲突带来的影响;(3)针对资源冲突尚未给出一般化的消解算法.后续工作中,我们将围绕这几方面的问题展开研究.
