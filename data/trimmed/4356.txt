Page1V-Mesh:面向三维堆叠芯片的低时延低功耗片上网络结构谭海1),2)何月顺2)靳文兵3)苏岩1)1)(北京理工大学计算机学院北京100081)2)(东华理工大学信息工程学院南昌330013)3)(北方自动控制技术研究所太原030006)摘要针对片上网络直径大、功耗高、可扩展性差以及物理实现复杂的问题,提出了一个低直径、且直径为常数的三维片上网络V-Mesh,并为该网络结构提供了VM路由算法.V-Mesh结构由一层2DMesh子网和多层行/列互连子网通过三维堆叠技术互连而成,具有功耗低的特点,能支持任意多的节点数,可用于三维堆叠芯片中的节点间互连.相对于一种全互连3D片上网络F-Mesh来说,V-Mesh结构采用行/列互连技术大大减少了其长互连线条数,从而减少了功耗和布线复杂度,可扩展性强.理论分析和实验结果表明,和F-Mesh结构相比,V-Mesh结构的时延与其相当,但能够减少约12.5%的功耗开销.和3DMesh相比,在节点数较多的情况下,其时延能降低23%,吞吐量能提高12%,功耗能降低34%.总的来说,V-Mesh和3DMesh相比各方面具有明显优势;和F-Mesh的互连性能相当,但其物理实现更为简单,布线量小,可扩展性更好.关键词众核;三维堆叠;低时延;低功耗;片上网络1引言随着摩尔定律的持续发展,芯片内的晶体管数量将达到海量,它们按一定规模分组后形成并行计算单元.这些并行计算单元之间通过片上网络高速互连[1-2],以片内多处理核的形式提供高性能计算,是当前处理器体系结构的发展趋势[2-3].计算机已经步入了多核时代,并且将马上迎来众核时代.在众核时代,片内处理核数目将达上千、甚至更多.众多的节点数对片上网络的高速互连提出了很高的要求.片上网络的直径和功耗对众核的性能有很大的影响,低直径和低功耗的片上网络成为了当前研究的热点[3-5].诸如2DMesh、3DMesh、3DTorus的经典片上网络具有扩展性强、带宽高及容易实现等优点,在多核处理器中广泛使用.但是,2DMesh、3DMesh、3DTorus等片上网络存在直径大的问题[5-6].当片内节点数达到一定规模后,直径大的片上网络会产生较长的传输时延,降低处理器的性能.为提供低时延的片内通信,文献[6-9]应用Fat-tree、高维拓扑等结构,在此基础上形成片上网络互连众核内各计算节点.Fat-tree、高维拓扑等结构具有等分带宽和低网络直径的优势,已经被广泛应用于超级计算机和数据中心的商用网络中[7-9],为计算节点间提供了高效互连,使得高性能集群系统具有良好的可扩展性.Fat-tree拓扑具有多级互连的结构特点,高维拓扑的节点具有高基数的结构特征.这两类拓扑实现的物理互连线多,布线复杂,功耗开销大.在高性能计算中,集群系统一般占用的物理空间大,很容易实现Fat-tree和高维结构中互连线的布设,而且不用考虑结构的功耗开销和布线的复杂度.与之不同的是,众核设计时只能在有限的空间部署片上网络,面积和功耗是处理器中极为重要的成本.在保证良好互通性能的前提下,众核对其片上网络的要求是布线简单,互连线少,功耗低.包括F-Mesh[10]在内,现有片上网络及其互连线存在功耗大和布线多的问题.据统计,片上网络的功耗占到了整个芯片功耗的15%~36%左右,在节点较多时甚至达到了整个芯片功耗的50%左右[11].在这些功耗中,大部分是互连线消耗的功耗,其占到了片上网络功耗的70%左右[11-12].在高维结构时,由于互连线较多,其所消耗的功耗占的比重将更大.综上所述,众核的设计受布线复杂度、互连线条数和功耗的严格限制,这些限制对其可扩展性有重要的影响.由于众核和集群环境之间存在很大的不同,众核的可扩展性无法基于高性能集群系统中的现有拓扑结构实现.因此,在现有技术背景下,如何根据众核设计制约条件,研究扩展性强的片上网络拓扑是很有意义的.本文应用三维堆叠技术优势,提出了一种低直径、且其为常数(仅为5“跳”)的三维片上网络,其所需互连线少,功耗低,布线简单,具有良好的可扩展性.和F-Mesh相比,本文所提出的三维片上网络在未大幅增加网络直径的同时,有效降低了布线规模数和复杂度,所需的路由数量减少,整体结构的动态开销降低.本文把所提出的片上网络简称为V-Mesh,其中V表示网络直径为5.本文的主要贡献包括:(1)提出了面向三维堆叠芯片的低时延和低功耗片上网络V-Mesh,形式化描述了该拓扑设计,同时对3DMesh和F-Mesh拓扑做了形式化描述.(2)通过计算,得出了V-Mesh在不同节点下所需要的层数L、节点数N及节点路由基数R之间的关系,并给出了其布线策略、路由表和路由算法的设计,以及相关的三维堆叠路由器实现.(3)通过理论分析,得出了V-Mesh、3DMesh和F-Mesh的网络直径、理想吞吐量、(长)互连线规模数和扩展性等参数,对它们进行了相应的比较.结果表明V-Mesh在上述参数方面均具有明显优势.(4)参照F-Mesh,给出了V-Mesh中长互连线的功耗和时延参数.实验比较了V-Mesh、3DMesh和F-Mesh,结果表明V-Mesh在时延、吞吐量和功耗方面具有较明显的优势.Page3本文第2节介绍相关工作;第3节描述V-Mesh拓扑结构;第4节给出路由算法及相关技术实现细节;第5节从各个方面对V-Mesh、3DMesh和F-Mesh三种结构进行理论评估;第6节通过两组实验,对以上结构的时延、吞吐量和功耗进行比较;最后是结束语.2相关工作与本文工作相关性较大的主要是文献[10]提出的3D全互连网络拓扑,该网络拓扑基于三维堆叠技术[13-15]实现,具有低基数低直径的良好特点,能显著减少3DMesh片上网络上的互连线,具有层间互连线短和时延低的特点,为实现新的片上互连技术提供了支持.由于3DMesh是基础的三维片上网络,为不失全面性,下面对3DMesh和3D全互连网络拓扑这两种结构做重点介绍.3DMesh结构.假定N×N×L的网络中,某节点X的坐标是(i,j,l),0i<N,0j<N,0l<L,任何节点Y(i,j,l),只要满足|i-i|+|j-j|+|l-l|=1,都与节点X相连.3DMesh的路由算法比较多,在确定性算法中,比较常用的有XYZ路由算法.3DMesh具有网络直径大的缺点,其直径随节点数的增大而线性增大.图1给出了3DMesh的拓扑和路由示意图.在完整的3DMesh拓扑结构中,不同的层间还有垂直互连线连接上下两相邻节点.特点:3D全互连结构.3D全互连结构满足以下2个(1)处于3D片上网络的任何两节点X(i,j,k),Y(i,j,k),有且只存在某层l,在l层两节点X(i,j,l)和Y(i,j,l)之间存在互连线直连.形式化描述为(l)P(X,Y),其中P(X,Y)表示(X,Y)(2)假定N×N×L的网络中,某节点X的坐标是(i,j,l),0i<N,0j<N,0l<L,与X相邻的节点Y(i,j,l),只要满足|l-l|=1,则与节点X垂直相连.3D全互连结构的网络直径最长为3跳,路由算法也较为简单,可通过查找节点路由表实现.路径为X(i,j,k)→X(i,j,l)→Y(i,j,l)→Y(i,j,l),即先经过1次垂直通路,接着经过同层的水平通路,最后再经过1次垂直通路即可到达目的节点.该片上网络具有直径低的优点,但该拓扑直接支持的节点数有限.为便于描述,本文把3D全互连结构称为FullMesh,简称为F-Mesh.节点对之间有互连线直连.图2给出了F-Mesh的拓扑和路由示意图.在完整的F-Mesh拓扑结构中,不同的层间同样有垂直互连线互连两上下相邻的节点.从图中可以看出,F-Mesh结构中任何两节点间的最长距离为3跳,其层内采用长弯折互连线连接不处于同行或同列的两节点.除了验证理论上的可行性之外,文献[10]还从技术上论证了长互连线的面积和功耗代价,证明了Page4其在布局布线上的可行性,并通过基准测试程序的trace实验进行了评估,表明由多层、(多)长互连线构成的拓扑理论设想在技术上也是可行的.比较.F-Mesh与3DMesh相比,最多能够减少29%的时延和24%的功耗,以及最大能够提升10%的吞吐量[10].虽然F-Mesh直径为3跳,但其能够支持的处理核数仅为36,而且布线复杂;当节点数超过36个节点时,则需要采用节点分组的方法,即多个节点构成一组,采用分级的方式互连,这破坏了拓扑结构的完整性.另外,文献[8,16-18]分别从加速路由速度和减少网络直径的角度来降低网络时延.但是,文献[8,17-18]所提方案仍然存在网络直径大、布线复杂和时延长的问题.3V-Mesh拓扑结构本节对V-Mesh片上网络拓扑进行了描述,这里提到的“跳”的概念和文献[10]给出的类似.为便于描述,先给出如下相关定义.定义1.长互连线.片上网络中,连接同一行或同一列上的非相邻两节点间的互连线.长互连线有别于互连两相邻节点的短互连线.为保证通信性能,长互连线的直径比短互连线的要大,这时能达到与短互连线同样的互连特性,但相应的功耗也会增加.文献[10]提出了通过泄漏还原技术(leakagereductiontechnique)来控制长互连线的功耗.定义2.行互连.3D片上网络r行上的任何两不相邻节点X(i,r,k),Y(i,r,k),有且只存在某层l,在l层两节点X(i,r,l)和Y(i,r,l)之间存在互连线直连.行互连形式化描述为(l)P(X,Y),其中P(X,Y)表示节点对(X,Y)有互连线直连.l和k可以一样,当l和k一样时,表示互连该两点的互连线刚好布设在k层.定义3.列互连.3D片上网络c列上的任何两不相邻节点X(c,j,k),Y(c,j,k),有且只存在某层l,在l层两节点X(c,j,l)和Y(c,j,l)之间存在长互连线直连.列互连形式化描述为(l)P(X,Y),其中P(X,Y)表示节点对(X,Y)之间有互连线直连.同样,l和k可以一样,当l和k一样时,表示互连该两点的互连线刚好布设在k层.定义4.行/列互连结构.满足行互连和列互连结构的三维拓扑结构.定义5.垂直互连.假定N×N×L的网络中,某节点X的坐标是(i,j,l),0i<N,0j<N,0l<L,与X相邻的节点Y(i,j,l),只要满足|l-l|=1,则与节点X垂直相连.定义6.V-Mesh.在3DMesh结构的基础上,保留最上层的节点网络(即2DMesh层),对其余层上的层内互连线重新布线,布设为行/列互连子网,层间采用三维堆叠技术垂直互连.如图3所示,V-Mesh可以在3DMesh的基础上变换而来.即在原来3DMesh的基础上,保留最上层的节点网络,其余层的层内互连线进行重新布线为:第2层每行有左、中、右三点,重新布设长互连线互连左右两节点,第3层每列有前、中、后三点,重新布设长互连线互连前后两节点.中数据传输时,通过的互连线的条数.定义7.V-Mesh网络中的跳.V-Mesh网络其中经过1条长互连线就算1“跳”,经过1次垂直互连也算1“跳”.“跳”在本文中也作为V-Mesh片上网络直径的单位.定义8.V-Mesh节点间距离.V-Mesh网络中,根据路由算法,从某节点到另一节点所经过的“跳”数.定义9.V-Mesh中的通信链路.V-Mesh网络中,根据路由算法,从某节点到另一节点依次所经过的互连线.如图4所示,垂直互连线FE、长互连线ED、垂直互连线DC、长互连线CB和垂直互连线BA构成了从节点F到节点A的通信链路.离最长为5“跳”.定理1.V-Mesh网络中,任意两节点间的距证明.令A(x,y,j)表示处于j层的第x行、y列的节点,设A、B、AB、AB分别表示和节点A、B、AB、AB具有相同的x、y坐标,但处于不同层的节点,它们之间的通信通过层间互连线进行.Page5根据定义1有(l)P(A,AB)=Line(A(x,y,l),AB(u,y,l))根据定义2有(l)P(AB,B)=Line(AB(u,y,l),B(u,v,l))式(1)、式(2)中节点A到A、AB到AB、B到B的通信分别通过1“跳”的层间垂直互连线进行,即Line(A,A)、Line(AB,AB)和Line(B,B).这里的Line(A,B)表示节点A、B之间的长互连线.综上,V-Mesh网络拓扑中,任何两节点间的距离最长为5“跳”.定理1表明,V-Mesh的网络直径为5“跳”.该网络直径为一常数,和V-Mesh中的节点数无关,故V-Mesh具有良好的可扩展性.4V-Mesh拓扑实现为实现V-Mesh拓扑中的行/列互连子网,需要有多个网络层的支持.另外,还需要合理地分配算法,来对行/列互连子网中的长互连线进行分配.为此,本节对该拓扑的网络层数、长互连线分配算法、路由节点表、路由算法、长互连线的功耗、时延参数等技术实现细节和计算依据进行了描述.4.1V-Mesh网络层数计算假定V-Mesh拓扑结构中参数为:层数为L层、每层有N×N个节点,底层由2DMesh网络互连各节点,R表示路由节点中非本地数据输入输出端口数.在给定节点数的情况下,通过计算,得出实现行/列互连所需要的最少层数.表1给出了L、N和R三者之间的关系,随后给出了该计算依据和过程.NLRRLNLRRL43.03.021014.43.6454.83.221116.43.7566.63.321218.33.7578.63.431320.23.76810.53.53…………912.43.642238.183.810容易得出,每层最多可以容纳RN2/2条互连线,故L层的存储层最多能容纳的互连线条数为LRN2/2.对该片上网络构建行互连和列互连,共需要N(N-1)/2×2N=N2(N-1)条互连线.除去2DMesh层中的2(N2-N)条互连线,该网络的其余层总共需要容纳N2(N-1)-2(N2-N)条互连线.因此有式(3)可化简为由于V-Mesh的底层已经有2(N2-N)条互连线,每一层最多容纳的互连线条数为RN2/2条,为确保网络带宽的一致,2DMesh子网和行/列互连子网的互连线应该相同,有如下公式.式(5)可化简为式(6)表明,当N>4时,节点的路由基数最大不超过4,平均节点的路由基数在3和4之间.结合式(4)、式(6),在给定节点数的情况下,能够确定V-Mesh网络的层数.V-Mesh中节点数和层数的对应关系如表1所示,即在给定节点数的情况下,实现行/列互连所需要的最少层数.4.2V-Mesh长互连线分配算法V-Mesh网络中,由于每层的互连线连接情况都不相同,在具体实现时需要一定的算法,用于指导各层层内长互连线的互连.长互连线分配的工作主要是确定各路由节点基数和该节点能够互连的长互连线条数.换句话说,即决定节点X和节点Y是否在层l有长互连线直连.从式(6)和表1中可以看出,路由基数R在3和4之间.故V-Mesh中,有的路由基数是3,有的路由基数是4.为此,给出的长互连线分配算法如下:Page6(1)根据表1中给出的路由基数,对网络中的节点预分配长互连线:对于路由基数是4的网络,先给每个节点分配3条长互连线;对于路由基数是3的网络,则给每个节点先分配2条互连线.(2)在不超出节点的路由基数R的情况下,将剩下来的长互连线平均分配到网络中各层.该互连线分配算法的优点是能快速确定网络中每个路由节点的基数、长互连线条数及布局.图5中给出了4×4的网络中某层节点间互连线分配示意图.根据表2得知,4×4网络的路由基数为3,故可为每个节点分配2条互连线.具体的分配过程标注为1、2和3.其中标注为“1”的互连线表示对网络中每行的4个节点设置两两互连,标注为“2”的互连线表示网络中每列的4个节点设置两两互连,标注为“3”的互连线表示将余下的互连线平均分配下去的过程.低频网络(1GHz)高频网络(3GHz)4.3长互连线功耗时延参数与短互连线相比,长互连线具有不一样的功耗时延特性.文献[10]中对长互连线和TSV进行了详细建模,这里采用其建模结果,同样也采用文献[10]中的垂直通路TSV参数.3D路由器中的垂直通路TSV参数见表3所示,长互连线的功耗和时延参数设置见表2所示.Pillar互通层数时延/cycles能耗/fJ表3表明,三维堆叠技术的导通能力很强,能在1个时钟周期内互通多层.但不同层的能耗,随层数不同而略有不同.表2采用hop作为互连线长度的单位,这里1hop的长度为1.5mm.从表2可以看出,在低频网络下,基本能在1个周期内完成数据在长互连线上的传输.在高频网络下,则需要2~3个周期才能完成数据在长互连线上的传输.能耗随互连线长度的不同而不同.由于长互连线能够显著减少数据传输过程中的路由节点数,且其时延特性在低频网络下具有跟短互连线一致的性能,从而长互连线在时延上具有很大的优势.4.4V-Mesh节点路由表设计V-Mesh中的路由通过查找路由表实现.在V-Mesh中,各节点中设有路由表.该表记录了处于同列的所有节点的互连线连接情况,以〈行或列,层,端口号〉方式来表示,其中第3位表示该路由节点上的互连线编号.如〈x,l,0〉表示该节点和x面的通信通过l层的0号长互连线进行.4.5V-Mesh路由算法设计V-Mesh网络中数据传输时,最长路径为5“跳”,即依次经过垂直通信、水平行通信、垂直通信、水平列通信,最后经过垂直通信到达,该路由算法简称为ZXZYZ算法,又称为VM算法,如算法1所示.算法1.ZXZYZ路由算法(ZXZYZRA).输入:目的节点输出:找出数据所在节点出口,并将数据转发到该出口1.ZXZYZ_Routing_Algorithm(destination.node){2.IF(destination.node.x==my.node.x3.transmit_data(my.direction.z,z);}4.ELSE{5.IF(destination.node.y==my.node.y)6.IF(my.wire.l!=x){Page77.8.transmit_data(my.wire,l);}9.IF(destination.node.x==my.node.x){10.IF(my.wire.l!=y){11.l=lookup(my.router_table,y);12.transmit_data(my.direction.z,l);}13.transmit_data(my.wire,l);}14.}当两节点不处于同行或同列所在的面时,它们之间存在两条通路,采用ZXZYZ路由算法确定其中一条.结合算法1对ZXZYZ路由算法进行描述:当数据从节点A(u,v,w)传往节点B(x,y,0)时,A所在的路由节点检查其是否与第x列纵面有直连线相连,若有,把该数据往相连的那个长互连线转发,若没有,请求数据包通过垂直通道传输,直到到达与第x列纵面相连的那层;每个路由节点收到数据包图6关键部件构成示意图三维堆叠芯片中层间距离很小,1个TSV就可以连接所有芯片层.因此,本文采用高性能的ConnectionBox(CB)来构造高速垂直互连线TSV.CB内部结构如图6(b)所示,每个CB由5个晶体管组成,CB能够同时传递水平方向和垂直方向的数据包.后检查其路由表是否存在有与y列纵面相连的互连线,若有,就把数据请求转往该互连线,没有则继续往垂直通道的下一个路由转发,直到数据包转往y纵面.该算法中,由于数据包的每次转发均朝目标推进,故能有效避免死锁.另外,可在算法中对所经过的节点数进行计数,当某个数据包的传输距离超过5“跳”时,则丢弃该数据包.V-Mesh拓扑中,行互连和列互连技术确保了节点之间的互通性,每一条互连线能为固定的某一列或某两列上的所有节点提供通信通道.若节点的利用率相同,则互连节点的长互连线的利用率相当.4.6V-Mesh三维路由器设计V-Mesh需要3D路由器来实现节点间的互通.含有V-Mesh片上互连的芯片构成示意图如图6(a)所示,其中的3D路由器如图6(c)所示.53种拓扑结构的理论评估3DMesh结构是三维片上网络中的经典拓扑,F-Mesh结构是利用了三维堆叠技术优势的代表拓Page8扑.本节从网络直径、理想吞吐量、理想平均时延、物理实现难度和扩展性等方面对V-Mesh、3DMesh和F-Mesh三种拓扑进行评估.从结果来看,V-Mesh在扩展性、网络直径、理想时延三方面都比3DMesh要好;另外,V-Mesh的理想平均时延与F-Mesh相当,但其布线规模数要远远低于F-Mesh.从物理实现难度来说,V-Mesh结构的实现是最容易的,F-Mesh结构的实现是最难的.总的来说,V-Mesh结构在这3种结构中是最好的.表4对上述静态特性进行了总结,列出了3种拓扑下的静态特性理论评估比较.随后给出了3种拓扑的理论评估细节.网络直径大互连线规模小理想平均时延大理想吞吐量低物理实现难度一般高可扩展性较差差5.1网络直径网络直径是指网络中任意两节点间距离的最大值[3].通常情况下,小直径片上网络数据传输的最大时延低,从而具有时延优势.本文采用“跳”作为网络直径的单位.在n×n×l的网络中,3DMesh的网络直径是(2n+l-3),V-Mesh的网络直径是5,F-Mesh的网络直径是3.V-Mesh和F-Mesh的网络直径都远远小于3DMesh,V-Mesh和F-Mesh的最大时延同样要小于3DMesh的最大时延.虽然单从直径上看,V-Mesh的网络直径(5“跳”)比F-Mesh(3“跳”)的要大,但是V-Mesh和F-Mesh的时延几乎相当.主要原因是:由于F-Mesh采用弯折互连线,和V-Mesh结构下节点间通信时所经过的长互连线长度基本一致,根据表2数据,长的长互连线的时延也跟着变大,抵消了其网络直径低的部分优势.这点从后面的实验数据中也可以看出.5.2(长)互连线规模数片上网络拓扑结构中的互连线条数的多少和该片上网络需要的功耗有很大的关系.一般来说,在保证互通性的前提下,片上网络应布设较少的互连线数目.在N×N×L的网络中,V-Mesh、F-Mesh和3DMesh具有同样多的垂直互连线,但其层内的互连线条数相差较大,具体为V-Mesh需要的层内长互连线条数为C2要的层内长互连线条数为C2Mesh需要的层内互连线条数为2(N-1)·N·L.从表1中的数据可以看出,2·l接近N.故3种结构中,单从互连线的条数来看,3DMesh和V-Mesh的互连线条数近似,均远少于F-Mesh结构的互连线条数.5.3理想吞吐量对于给定的拓扑结构,其理想吞吐量[19]是指在完美的流控和路由机制下,网络中所达到的最大吞吐量.文献[19]给出的理想吞吐量公式如下:式(7)中,BC是把整个网络分成均等的两半所需要的通道个数,b是每个通道的数据宽度,N是总节点的数目.对于4×4×2的3DMesh,N=32,BC=16,要想把3DMesh分成两半,需要切开8条边,每个边又都是双向的,所以BC=16;对于同样规模的V-Mesh,N=32,BC=24,要想把V-Mesh分成两半,需要切开12条边;对于同样规模的F-Mesh,N=32,BC=72,要想把F-Mesh分成两半,需要切开36条边.由此,得出三者的吞吐量大小依次为THideal,3DMeshTHideal,V-MeshTHideal,F-Mesh.总的说来,V-Mesh的理想吞吐量比3DMesh的大,比F-Mesh的小.5.4理想平均时延理想平均时延[19]是指假设在路由过程中没有拥塞发生,对于给定的拓扑中的所有节点对之间的平均路由时延.文献[19]给出了理想平均时延的公式:H是指从源节点到目标节点的平均跳数,Tr是单个路由器上的延时,D是从源节点到目标节点的平均距离.通常情况下,H等于D.v是线上的传输速度,L是数据包的长度,b是带宽.在不同的拓扑结构中,H的值是不一样的,Tr依赖于路由器的物理实现.式(8)得知,计算平均时延主要是计算H.为了与3DMesh、F-Mesh比较理想平均时延,需要分别计算3种结构的平均跳数.根据文献[20]Page9可知,当网络规模为n×n×l时,3DMesh结构的节点间平均跳数计算公式如下:给定网络规模为n×n×l的V-Mesh结构,对于指定的节点X来说,拓扑中的其它节点可以按与该节点的位置关系,分为和该节点处于同面的以及和该节点不处于同面的两类节点.分别计算这两类节点到节点X的距离:和该节点处于同一纵面的节点到该节点的距离为HV-Mesh(同面)=3·(n·l-2·l)+2·l+l(10)和该节点处于不同面的节点到该节点的距离:HV-Mesh(异面)=5·(n·l-2·l)+4·l+3l(11)式(10)和式(11)中,符号前面的系数表示距离,即“跳”数,与之相乘的是节点数.综合式(10)、式(11),得出节点间的平均跳数为代入式(10)、式(11),得出HV-Mesh=8·(n·l-2·l)+6·l+4·l给定网络规模为n×n×l的F-Mesh结构,对于指定的节点X来说,拓扑结构中的其它节点可以按与该节点的位置关系,分为和该节点处于同层的、同列的、靠近该节点所在层的那层节点,以及其余节点4大类.分别计算这4大类节点到节点X的距离:和该节点处于同层以及和该节点处于同列的节点数总共为(n·n-1)+(l-1)=n·n+l-2,这些节点到X的跳数为1;靠近该节点所在层的那层节点数为n·n-1,其中减1是减去和X处于同列的那个节点,这些节点到X的跳数为2;其余节点到X的距离为3,这些节点的节点数为n·n·l-(n·n+l-2)-(n·n-1)=n·n(l-2)-l-3.依据上面数据,得出F-Mesh结构的节点间的平均跳数为HF-Mesh=1·(n·n+l-2)+2·(n·n-1)+3·(n·n(l-2)-l-3)=3-3l-2为简化分析,这里假定3种网络的路由器延时相同,相邻节点间的距离相等,线上的传输速度和带宽相同,数据包的长度相等.由式(8)可知,理想平均时延只与H有关.综合式(9)、式(11)和式(14),当网络规模为4×4×2时,3种拓扑的平均跳数分别为H3DMesh=2.75,HV-Mesh=3.25,HF-Mesh=1.5;当网络规模为22×22×10时,3种拓扑的平均跳数分别为H3DMesh=17.94,HV-Mesh=3.86,HF-Mesh=2.7.这些数据表明,当网络中节点数较多时,3DMesh的理想平均时延远远大于V-Mesh和F-Mesh的,V-Mesh和F-Mesh的理想平均时延相差不大.5.5物理实现难度物理实现难度主要取决于结构的维数、路由switch基数(即端口数)以及路由算法复杂度.这3种结构都是三维结构,三者的路由算法都比较简单.然而,也存在一些不一样的地方:从路由基数来看,3DMesh结构的路由基数为5,F-Mesh结构和V-Mesh结构的路由基数在3~4之间.另外,F-Mesh中,通过弯折互连线连接不在同一行和同一列的两个节点,该种布线策略无疑也加大了物理实现的难度.因此,全面来看,V-Mesh的物理实现难度在三者中是最低的.5.6可扩展性片上网络拓扑的可扩展性主要是从系统易用的角度来考虑的.随着工艺技术的持续发展,片上网络拓扑需要容纳越来越多的节点,并且其特性不能随着节点数的增多而减弱.F-Mesh结构最多只能支持36个节点,超出后需要采用分组、多级网络互连,可扩展性差;而3DMesh结构虽然能够支持很多的节点数,但是,其网络直径和理想平均延时随节点数的增加而线性增长,可扩展性较差.V-Mesh具有良好的可扩展性,该结构能支持任意多的节点,而且其网络直径不随节点数的增加而变化.由于文献[10]中对线的面积对布局布线的影响进行了专门的论证,V-Mesh采用类似文献[10]的技术,同样在布局布线方面具有可行性.另外,注意到N×N×N规模的V-Mesh的片内长连线数量级达到了O(N3),当节点规模数持续增大时,连线数量显著增加,这将不可避免的加大Page10V-Mesh的物理实现难度.在综合权衡布局布线复杂度和时延、吞吐量之间折衷情况下,采用F-Mesh中类似的方法,通过对节点进行分组和多级网络互连的实现方式,组内节点可以共用一条长互连线,这样能够大大降低物理布线的复杂度.同样,通过该种方法,能够在物理布线同样复杂的情况下,支持更多数量的节点互连.6性能分析文献[10]中对F-Mesh进行了完备的trace实验,通过相关实验充分论证了长互连线、多层三维堆叠芯片技术的可行性.为突出优势,在第5节对V-Mesh、F-Mesh和3DMesh拓扑进行了充分的理论评估,在性能分析部分,本节主要对上述3种拓扑进行实验评测.本节主要对3DMesh、F-Mesh和V-Mesh三种结构进行吞吐量、时延和功耗方面的对比.考虑到F-Mesh拓扑结构在不分组的情况下最大仅支持36个节点,性能评估实验分两组进行:一组是在36个节点的情况下对3个结构进行比较;另一组是在361个节点(19×19)的情况下对3DMesh和V-Mesh两种结构进行比较,模拟众核对节点数要求多的情况.6.1仿真实验平台本文采用Noxim片上网络模拟器①搭建仿真实验平台.这是一个用SystemC语言编写的周期准确的片上网络模拟器,能够比较详细的模拟片上网络中功能部件的主要行为.为能够模拟3DMesh、F-Mesh和V-Mesh三种结构,从节点度数、端口连接、信号使能等方面对Noxim进行了修改,设置了相应的路由算法.另外,通过设置两节点间的连接路由表,以及相应的时延和功耗参数来对F-Mesh和V-Mesh中的长互连线及其通信进行模拟.根据表2、表3对互连线进行参数设置,3DMesh中互连线功耗和时延参照表2中1hop的互连线设置,路由器的其它参数参照Orion2.0[21]设置.实验平台参数设置为:warmup为5000cycles,sim总共模拟时间25000cycles,数据包大小设置为4flits,数据注入速率单位为packets/(node·cycle).6.2小规模节点实验本小节在36个节点的小规模数情况下,比较3个结构的时延、功耗和吞吐量情况.图7给出了3DMesh、F-Mesh和V-Mesh三种结构在36个节点时的时延对比情况.从图中可以看出,F-Mesh的时延最小,3DMesh的时延最大,V-Mesh的时延介于F-Mesh和3DMesh之间.V-Mesh的时延大约超出F-Mesh时延的1%~10%,大概是3DMesh时延的70%~80%.主频较高时(3GHz),V-Mesh和F-Mesh具有几乎相当的时延.实验结果和5.4节中的理论分析结论一致.图8给出了3DMesh、F-Mesh和V-Mesh三种结构在36个节点时的吞吐量对比情况,其中3DMesh的吞吐量规约为1(为不失一般性,这里以随机测试来进行评估,下同).从图中可以看出,F-Mesh的吞吐量最大,3DMesh的吞吐量最小.V-Mesh的吞吐量大约是F-Mesh的90%~98%,大约超出3DMesh的5%~10%,实验结果和5.3节中的理论分析情况一致.图9给出了3DMesh、F-Mesh和V-Mesh三种结构在36个节点、网络频率为高频时的功耗对比情况,其中3DMesh结构的功耗规约为1.从图中可以看出,F-Mesh的功耗大约是3DMesh的80%~93%,V-Mesh的功耗大约是3DMesh的70%~90%,V-Mesh能比F-Mesh减少3.2%~12.5%的功耗.另外,3DMesh中互连线的功耗占到了整个功耗的70%左右,F-Mesh中互连线的功耗占到了65%左右,而V-Mesh中互连线的功耗占到了55%左右.如5.3节中的理论分析,虽然V-Mesh和F-Mesh的长互连线数目比3DMesh的要多,但是V-Mesh和F-Mesh的功耗比3DMesh的反而要更低一些.主要原因是:(1)采用了泄漏还原技术(leakagereductiontechnique),该技术能有效隔断暂时没有数据传输的互连线[10],并能在数据到来时及时接通互连线,从而省下空闲状态时的互连线功耗;(2)由于减少了路由上的功耗,n-hop的长互连线方案要比n个1-hop的短互连线方案节省功耗;(3)在V-Mesh和F-Mesh结构中,由于经过的“跳”数少,数据传输过程中能够减少对链路的竞争,从而减少功耗.而V-Mesh比F-Mesh功耗低的主要原因,是在网络直径仅增加2“跳”的情况下,V-Mesh比F-Mesh少需要很多的互连线,减少了功耗.①PalesiM,PattiD,FazzinoF.Noxim:AnOpenNetwork-Page11图73种结构时延比较(36节点数)图83种结构吞吐量比较(36节点数)6.3大规模节点实验由于众核中节点数均很多,故本小节在361个节点(19×19)的情况下,对V-Mesh和3DMesh两种结构的时延、功耗和吞吐量进行比较.图10给出了3DMesh和V-Mesh两种结构在361个节点(19×19)时的时延对比情况(同样,为不失一般性,这里以随机测试来进行评估,下同).从图中可以看出,在节点数较多的情况下,相比于3DMesh,V-Mesh具有较强的时延优势.V-Mesh的时Page12延大约是3DMesh的72%~95%.主要的原因是,V-Mesh的网络直径仅为5“跳”,而361个节点下3DMesh结构的网络直径为36“跳”,后者的网络直径远大于前者的网络直径,过多的网络直径导致有较长的传输时延.实验结果同样和5.3节中的理论分析结论一致.图11给出了3DMesh和V-Mesh两种结构在361个节点时的吞吐量对比情况,其中3DMesh结图10两种结构时延比较(361节点数)图11两种结构吞吐量比较(361节点数)构的吞吐量规约为1.从图中可以看出,V-Mesh的吞吐量大约超出3DMesh的5%~12%.主要的原因是V-Mesh比3DMesh的互通链路略多,而且V-Mesh的行/列互连结构更有助于提高吞吐量.同时,V-Mesh的网络直径低,也能减少数据传输时对链路的竞争冲突次数,有助于提高其吞吐量.图12给出了3DMesh和V-Mesh两种结构在361个节点、网络高频率时的功耗对比情况,其中3DMesh结构的功耗规约为1.从图中可以看出,V-Mesh的功耗大约是3DMesh的66%~76%.另外,互连线在各个拓扑中所占的功耗比例跟前面的实验类似.7结束语3D堆叠封装技术具有很强的优势,除了小尺寸、高硅片利用率、低信号传输延迟和高系统性能等优点外,3D堆叠方式也不会增加封装方面的成本.其原因在于,3D堆叠技术对功能复杂的芯片做了小Page13型化处理,小的芯片能在生产过程中带来较高的良率,有助于降低整个芯片的生产成本.基于三维堆叠技术,本文所提出的V-Mesh,是一种低直径和低功耗的三维片上网络,支持任何节点数,可扩展性强,克服了F-Mesh结构扩展性差的缺点,具有时延低、吞吐量大、便于实现和功耗适合的优点.通过理论分析和实验证明,与3DMesh、F-Mesh结构相比,V-Mesh的时延、吞吐量和能耗均有极佳表现.下一步的工作将在片上网络V-Mesh的基础上,充分利用其低直径、低时延的特点,构建基于行/列互连的片上Cache(SRAM)存储体系,拟进行符合大数据计算特点的3D众核微体系结构设计.致谢薛立成博士和国防科技大学吴俊杰教授给予了帮助,审稿专家对本文提出了宝贵意见,在此一并表示感谢!
