Page1一种新的局部不变特征检测和描述算法杨恒王庆(西北工业大学计算机学院西安710072)摘要局部不变特征已经被成功地用来解决计算机视觉领域诸多实际问题.文中提出一种新的局部不变特征检测和描述算法,提取出的特征能够对旋转、尺度缩放、光照等变化,甚至弱仿射变换保持不变.一般说来,局部特征的提取分为特征检测和描述两个关键步骤.在特征检测阶段,首先在每一层尺度图像上提取Harris角点,然后在以Harris角点为中心的固定大小的搜索窗内搜索三维尺度空间的极值点作为局部特征点的位置和特征尺度,最后为每个特征点计算主方向.文中的特征检测算法具有良好的可重复率性能.在特征描述阶段,建立了梯度的距离和方向直方图来描述局部特征,文中的特征描述子不但具有良好的匹配性能,而且维数更低,十分有利于提高图像特征的匹配速度.大量的图像匹配与图像检索实验结果验证了文中算法的有效性.关键词局部特征;特征检测;特征描述子;不变性;图像匹配1引言视觉的许多领域,如宽基线图像匹配、全景图拼接、目标识别、图像检索以及场景重建[1-6].局部特征能够对图像间旋转、尺度缩放、视点变换、光照变化等图像变化因素保持不变性,对物体运动、遮挡、噪声局部不变特征已经越来越广泛地应用在计算机Page2等因素也可保持较好的可匹配性.局部特征建立在尺度空间的理论上,一般说来,提取局部特征可以分为两个关键步骤,即特征检测阶段和特征描述阶段.特征检测阶段的任务是在尺度空间确定出关键点的位置、特征尺度及其主方向,这些参数就可以描述出一个局部图像区域.特征描述阶段的任务是为这个局部图像区域建立描述子,该描述子应该能对图像间的各种变化因素保持不变,以确保特征能够在这些变化因素的影响下保持较好的可匹配性.近十几年来,许多局部特征检测和描述算法被提出.(1)特征检测Schmid等[7]利用Harris角点检测算法提取局部特征,该局部特征能够抗旋转变换.Harris特征检测器对噪声和光照变化具有很强的鲁棒性,但是它对图像间的尺度缩放不具备不变性[8].Dufour-naud等[9]提出了多尺度Harris特征检测算法,即在各个尺度图像上用Harris算子进行特征提取,该方法可以解决不同尺度图像间的特征匹配问题.Brown等[2]使用了改进的多尺度Harris特征提取算法,用Harris矩阵特征值的调和平均值作为极值的判别函数.多尺度的Harris特征检测算法虽然可以解决存在尺度缩放的图像间匹配特征的问题,但是对于同一个图像局部结构,该算法会提取出许多重复的特征,而这些特征仅仅在位置和尺度上略有不同,这种大量的重复性会增加误配率和匹配计算的复杂度.为了克服这个缺点,Lindeberg[10]在深入研究尺度空间理论的基础上,提出LoG(Laplacian-of-Gaussian)尺度空间的三维局部极值点可以作为稳定的局部特征.Lowe[11]提出了著名的尺度不变特征变换算法SIFT(ScaleInvariantFeatureTransform),SIFT在特征检测阶段采用DoG(Difference-of-Gaussian)算子,搜索尺度空间上的局部三维极值点,并以此来确定局部特征的位置和尺度,再通过拟和三维二次函数进行位置和尺度的精确定位,同时去除低对比度的特征点和不稳定的边缘响应点,以提高抗噪声能力.DoG算子是LoG算子的近似,但是其计算速度更快.Mikolajczyk[12]分析并指出DoG和LoG算子的缺点是提取出来的特征未必都是稳定的.因为这些极值点有可能会位于亮度只在一个方向变化的边缘上,这样的点容易受到噪声或者细小纹理变化的干扰.同时,Mikola-jczyk还提出Harris-Laplace尺度不变特征检测算法.该算法首先在每一层尺度图像上检测Harris角点,然后用Laplace函数去除掉不在尺度轴上达到极值的角点.Bay等人[13]于2006年提出Fast-Hessian特征检测算法,该算法基于汉森矩阵定位局部特征.(2)特征描述Johnson等[14]引入了一种可以描述物体形状的纺线图(spinImage)作为描述子,该描述子能够对特征点的刚性变换保持不变.Brown[2]对关键点周围的点进行采样组成一个8×8大小的图像片,再对形成的64维描述向量进行规范化以消除光照影响,最后对特征向量进行Harr小波变换,用前三个非零小波系数作为索引以提高特征匹配速度.Gool[15]引入了广义颜色矩反映信号的多谱特征,这些矩特征描述了区域的形状和颜色特征.Florack等[16]用一组不同阶的微分算子组成描述子,该描述子可以保持旋转不变性.Schaffalitzky等[1]提出了一组复滤波器,这种方法避免了特征主方向的估计问题,此外复滤波器是正交的,因此可以用欧氏距离作为相似性度量准则.Lowe[11]提出了著名的SIFT描述子,该描述子对特征周围一定区域内像素点梯度的模值和方向用三维直方图进行统计,统计时对关键点附近4×4个子区域都计算8个方向直方图,最终形成128维特征向量.SIFT描述子具有很强的抗噪声能力,同时对于含有定位误差的特征匹配也提供了较好的容错性.但是由于SIFT提出的特征描述子维数较高,使得进行图像匹配时速度较慢.为了降低SIFT特征维数,Ke等[17]在SIFT算法基础上提出了PCA-SIFT算法,先对每个关键点周围39×39区域内像素统计梯度的两个垂直分量组成3042维的描述向量,然后使用主成分分析(PCA)将高维特征向量投影到前20维特征向量空间,由于PCA-SIFT的维数低,使得其匹配速度大大增加.Mikolajczyk等[18]比较评价了各种建立描述子的算法性能,并通过实验表明SIFT算法的性能是最优异的,同时Mikolajczyk还提出了一种扩展SIFT的描述子GLOH(GradientLocationandOrientationHisto-gram),GLOH采用对数极坐标的形式对关键点周围划分出17个位置区域,对每一个位置区域内的梯度统计16个方向的直方图,这样共形成272维特征描述向量,最后再用主成分分析的方法将特征维数降至128维.本文提出一种新的尺度不变局部特征检测和描述算法,提取出来的特征能够对图像间旋转、尺度缩放、线性光照变化以及部分视点变换保持不变性.在特征检测阶段,我们在多尺度Harris角点附近一定Page3区域内搜索DoG尺度空间的局部极值点,以确定特征的位置和尺度,再采用与SIFT一样的方法统计每个特征点的主方向.在特征描述阶段,我们在特征点周围的圆形区域内统计梯度的距离和方向直方图,并以此建立描述子.实验表明,本文的特征检测算法在图像间具有尺度缩放、旋转变换、光照变化、噪声干扰以及小视点变换的情况下都具有良好的可重复率.另外,本文提出的特征描述子不但与SIFT,PCA-SIFT以及GLOH描述子具有相当的性能,而且特征向量维数更低,使得在图像特征匹配的应用中具有明显的速度优势.2关键点检测我们首先简要分析Harris-Laplace检测算法[12],并在此基础上提出本文的Harris-Difference特征检测算法.2.1Harris-Laplace特征检测算法Harris-Laplace算法首先在每一层尺度图像上使用Harris函数(如式(1))来定位图像中的角点,如果Harris函数在周围8个点中取得极值,则该点就为Harris角点.其中σI表示积分尺度,σD是差分尺度,L(狓,σn)=G(σn)I(狓)表示尺度空间函数,由标准高斯核G(σn)与图像I(狓)卷积得到.μ是Harris矩阵,det()表示矩阵的行列式,trace()是矩阵的迹,α是常数,取值为0.04,Lx和Ly分别是尺度函数对x和y的偏导数.det(μ(狓,σI,σD))-αtrace2(μ(狓,σI,σD))(1)其中,μ(狓,σI,σD)=σ2DG(σI)L2x(狓,σD)LxLy(狓,σD)然后,对于每个Harris角点,用Laplace函数选择特征尺度,即如果Laplace函数值在尺度轴上与附近两个点比较达到极值并且大于给定阈值(如式(2)),则该角点作为稳定的特征点予以保留;否则就排除这个Harris角点.LoG(狓,σn)=σ2n|Lxx(狓,σn)+Lyy(狓,σn)|>threshold,LoG(狓,σn)>LoG(狓,σp),p∈{n-1,n+1}(2)其中LoG表示Laplace函数,Lxx与Lyy分别是尺度函数对x和y的二阶偏导数,threshold是给定的阈值.然而在实验中我们发现,如果用Laplace函数选择特征尺度,仅有不到10%的初始角点能够得到保存,绝大多数的Harris角点将会被滤除掉.另外,选择的Harris角点也只是在一维尺度轴上的极值点,并不是三维尺度空间的局部极值点,这可能会导致不稳定的特征提取.2.2Harris-Difference特征检测算法针对Harris-Laplace算法的不足,本文提出Harris-Difference特征检测算法,该算法可以保留相对较多的和相对稳定的Harris角点或者其附近点,提高特征检测的性能.Harris-Difference特征检测算法分为以下3个步骤.不同尺度图像上检测Harris角点.1.先用文献[11]的方法构造金字塔尺度空间,然后在2.使用多尺度Harris角点作为初始点,在其附近一个固定大小的窗口内搜索DoG函数在三维局部空间(3×3×3)上的极值点,如式(3),其中k是常数,与金字塔每一层内不同尺度图像的个数有关.2.1.选择一幅尺度图像上的一个Harris角点,验证其DoG函数值是否是三维局部空间(3×3×3)的极值点,如果是,保留该Harris角点并作为特征点,跳转至步2.3;否则,去除该Harris角点,跳转至步2.2.2.2.在以当前角点为中心的5×5大小的窗口内,搜索DoG函数在局部三维空间(3×3×3)的极值点.如果找到这样的点,只保留距离搜索窗中心最近的点并作为特征点,然后跳转至步2.3;否则,直接跳转至步2.3.2.3.如果每一层尺度图像上的所有Harris角点都已经计算过,则保存所有特征点的位置和尺度信息,结束步2;否则,跳转至步2.1.图1显示了两组不同变换条件下图像对随着搜索窗尺寸变化的可重复率曲线(见5.1节),可以看出,在搜索窗大小为5的时候,可重复率最高,当搜索窗大于5以后,检测算法的性能反而会略有下降.原因是当搜索窗过大后,虽然可以找到更多的特征点,但这些点未必是稳定的,它们并不能保证可重复率会提高.因此,在本文的后续实验中,搜索窗大小都设置成5×5.3.使用文献[11]中的方法,为每个特征点计算主方向.在后面建立描述子的过程中,通过旋转坐标至主方向上,可以使得描述子具有旋转不变性.Page4图2是本文算法在两幅标准图像上提取出来的局部特征点的示例,左右两幅图像大小分别是512×348和850×684,分别检测到896个和6762图2本文提出的Harris-Difference算法在两幅图像上检测出来的局部特征示例3局部特征描述子图像的局部特征描述子应该能够对图像间的旋转、尺度缩放、光照变化甚至小视点变换保持不变性,而且具有很高的区分力和鲁棒性.受SIFT描述子的启发,本文的描述子也是基于特征点邻域梯度统计的思想,以增强描述子的抗噪声能力以及对定位误差的容错性.建立新描述子的目标是保持与SIFT、PCA-SIFT以及GLOH这些描述子相当的性能,同时降低描述向量的维数,以减小图像特征匹配的时间复杂度.本文提出的描述子基于梯度的距离和方向直方图(GradientDistanceandOrientationHistogram,GDOH),图3解释了建立描述子的过程.首先,计算特征点周围圆形区域内的梯度的模值和方向(如图3(a)中的箭头),圆形区域的大小与特征点的尺度成正比.然后,用一个高斯窗函数对每一个梯度模值加权,高斯窗大小与圆形区域大小一致(如图3(a)中的最外层圆形点画线).高斯窗加权的目的是为了减少距离中心远的点的影响.接着,将每个梯度方向旋转至主方向以保证旋转不变性,同时计算每个梯度点到中心点的距离.根据距离和旋转后的方向,建立具有48个单元(距离划分6个单元,方向划分8个单元)的直方图,直方图每个单元的统计值是由加权的梯度模值累加得到的,描述子如图3(b)所示.一般来讲,计算出来的距离单元和方向单元都不是整数,为了使得相邻距离单元以及相邻方向单元间过渡平滑,我们采用双线性插值算法来分配梯度模值对相邻单元间的贡献.最终形成的48维描述子向量就对应着直方图的每个单元的值,如个局部特征点.特征点用箭头表示,箭头末端表示特征点位置,箭头长度表示特征尺度大小,箭头指向表示特征点主方向.图3(b)中的箭头长度.最后,将特征向量归一化以进一步去除光照的影响.在实验中,我们发现距离划分6个单元且方向划分8个单元或者距离划分8个单元且方向划分8个单元都可以取得最优的性能,这两种方案分别可以产生48维和64维的特征描述向量,考虑到向量维数对后面匹配速度的影响,我们在后续实验中都选择前一种划分方法,即为每一个特征建立一个48维的描述向量.4特征匹配特征描述子建立好以后,使用BBF(Best-Bin-First)[11]算法进行特征点间的粗匹配.BBF是一种Page5近似的最近邻搜索算法,能够以很高的概率找到待匹配点的最近邻点和次近邻,如果最近邻和待匹配点的距离与次近邻和匹配点的距离之比小于匹配门限阈值(实验中取0.4),则认为该最近邻点是待匹配点的候选匹配.在对所有点进行粗配之后,使用RANSAC(RANdomSampleConsensus)算法估计两个图像对之间的单应变换矩阵并作为几何约束,进而去除误配,完成特征点之间的精确匹配.5实验结果和分析实验中选用的测试图像均来自标准图像数据集①,该图像数据库中图像包含了各种变换条件下的场景图像.实验采用的评价准则包括:算法.线[17],评价描述子的性能.(1)可重复率(repeatability)[14],评价特征检测(2)查全率-查错率(recallvs.1-precision)曲(3)匹配的时间代价,比较特征匹配的速度.(4)特征匹配实例,主观比较匹配性能.(5)图像检索应用,验证本文算法在实际应用中的性能.所有的实验都运行在2.80GHzCPU和512MB内存的PC机环境上,采用VC6.0编程语言实现.5.1可重复率可重复率是指在两幅图像上检测到的对应特征数的比率,它体现了特征检测算法的性能,是衡量检测算法的重要指标.如果检测算法在两幅待匹配图像上的相同区域内分别检测出m1和m2个特征点,则可重复率rR计算如下:其中min(m1,m2)为两幅图像中最少的特征点数.C(m1,m2)指的是对应特征点数,对应的特征点需要满足如下两个条件[12]:(1)特征点的位置误差εL=|狓a-犎·狓b|<误差限阈值,其中犎是两幅图像间的单应变换矩阵,误差限阈值是设定好的常数(3像素).(2)特征区域的表面误差εS=1-s2σ2a其中s是图像间实际的尺度缩放因子,σa和σb分别是两个特征点的特征尺度.图4~图8分别给出了随着图像间的尺度变化、旋转变化、光照变化、噪声干扰以及视点变换的条件下,DoG、Harris-Laplace、Fast-Hessian以及本文的Harris-Difference特征检测算法的可重复率变化曲线.图4(a)1为参考图像,2~5分别是尺度放大2倍~5倍的变换图像,从图4(b)可以看出在有尺度缩放变化的条件下,DoG算法可以获得最好的可重复率性能,而本文的Harris-Difference算法要略微低于DoG算法,但是要高于Fast-Hessian以及Harris-Laplace算法.图5(a)1为参考图像,2~7分别是旋转角度为30°,60°,90°,120°,150°以及180°的变换图像,从图5(b)可以看出,4种算法的可重复率曲线都具有周期性,当旋转角度为90°和180°时出现峰值,本文Harris-Difference算法的可重复率略微低于DoG算法,但仍然高于Fast-Hessian以及Harris-Laplace算法.DoG算法在尺度和旋转变换中都获得了最好的检测性能,原因是DoG算法检测了尺度空间中所有的局部极值点.但是DoG检测出来的特征点可能是不稳定的,因为它检测的这些极值点有可能会落在亮度信号只在一个方向变化的边缘附近,这就导致这些检测出来的特征点对于噪声干扰或者细微的纹理变化很敏感.而基于Harris的检测算法以及基于Hessian矩阵的算法检测的是图像角点特征,即亮度信号在两个正交方向同时变化比较明显的图像特征点,这种特性使得这类算法具有较高的鲁棒性和抗干扰能力,这种特性在图6、图7和图8的结果中得到了体现.图6(a)1为参考图像,2~6分别是亮度增强2倍~6倍的变换图像,从图6(b)可以看出在有亮度变化的条件下,4种算法的可重复率性能相当,而Harris-Difference算法要略微优于其它3种算法.图7(a)1为参考图像,2~6是加入了高斯噪声的模糊图像,其高斯半径σ分别为1,1.5,2,2.5,3,从图7(b)可以看出在有噪声污染的条件下,Harris-Difference、Harris-Laplace和Fast-Hessian3种算法的可重复率都要明显高于DoG算法,而Harris-Difference算法的性能是最优的.图8给出了在视点变换条件下的实验结果,(a)1为参考图像,2~6的视点变换角度分别为20°,30°,40°,50°以及60°,从图8(b)中可以看出在视点变换不大的情况下(不超过40°),Harris-Difference算法的可重复率要高于其它3种算法,而当视点变换超过40°时,由于图像间发生较大的畸变,4种算法的可重复率均降为0.综合以上实验结果可以得出结①实验图像数据集来源.http://lear.inrialpes.fr/people/Page6论,Harris-Difference算法在图像间具有几何变换(旋转和尺度变换)的条件下,可重复率要略低于DoG算法;而在图像间具有光照变化、高斯污染以及视点变换的条件下,Harris-Difference算法性能要优于DoG算法.此外,在任何条件下,本文算法都优于Harris-Laplace和Fast-Hessian算法.这说明本文提出的Harris-Difference算法具有良好的特征检测性能.图44种算法随着尺度变化的可重复率曲线图54种算法随着旋转角度变化的可重复率曲线图64种算法随着亮度变化的可重复率曲线图74种算法随着不同程度高斯噪声干扰情况5.2查全率-查错率曲线查全率-查错率曲线是对描述子性能的评价,查全率(recall)是指正确匹配数占对应(correspon-dence)特征数目的比率,查错率是错误匹配数目占整个匹配数目(正确匹配与错误匹配之和)的比率.查全率-查错率曲线评价准则的思想就是增加正确匹配数目的同时减少查错率.图9是评价查全率-查错率性能的4组实验数据,(a)中图像对间存在55°的旋转变换和1.6倍的尺度缩放;(b)中图像间存在着20°的视点变换;(c)中图像对间存在着1.2倍的Page7亮度变化;(d)中图像存在高斯噪声污染,高斯半径σ=3.图10分别给出了对应图9中的4组实验数据的SIFT、PCA-SIFT、GLOH以及本文的GDOH算法随着不同的匹配门限做出的查全率-查错率曲线图84种算法随着视点变换角度变化的可重复率曲线图9评价查全率-查错率性能的4组实验数据图10分别对应图9的4组不同变换类型下的4种描述子的查全率-查错率曲线比较图,从图10(a)中可以看出,当图像间存在几何变换(旋转和尺度缩放)时,4种描述子的性能是接近的,当查错率小于0.3时,GLOH的性能最优,而当查错率大于0.3时,GDOH的性能最优.当图像间存Page8在较小的视点变换时(见图10(b)),GDOH的性能最优,尤其是在查错率低于0.2的情况下,GDOH的优势较为明显,在查错率高于0.2时,4种描述子的性能十分接近.图10(c)的结果表明,在光照变化的情况下,4种描述子都可以达到很好的性能(查全率都在0.8以上),而GDOH获得了最优的性能.在图像间存在噪声干扰的情况下(见图10(d)),当查错率低于0.5时,4种描述子性能相当;当查错率高于0.5时,PCA-SIFT描述子的性能要明显低于其它3种描述子.综合这些实验结果可以得出结论,本文的GDOH描述子的性能和目前优秀的SIFT、PCA-SIFT以及GLOH描述子性能相当,甚至在某些变换条件下GDOH性能更优,比如小视点变换和光照变化.5.3特征匹配的时间复杂度比较我们从图像数据集中选取79对图像,包括各种不同的图像变换类型(见表1),比较SIFT算法和本文算法的特征检测和特征匹配的时间复杂度.表1给出实验结果,可以看出本文算法的平均特征检测时间与SIFT几乎一样,没有很明显的速度增益,但是总的平均匹配时间仅为SIFT的40.9%(1419/3468),特征匹配的速度增益非常显著,这是由于本文提出的描述子向量维数更低.表1本文提出的算法与SIFT算法的时间代价比较旋转&尺度缩放(29对)356365841330202303视点变换(25对)290533694205301586光照变化(25对图像)71204896911226总平均2452934682080514195.4特征匹配实例图11给出了一组匹配结果的实例,左图和右图分别显示了SIFT算法和本文算法的匹配结果,设定的误差限是1.5个像素,这里只显示前10个特征匹配作为比较.匹配的图像对之间的旋转变化和尺度缩放都比较大,而且图像细节信息比较丰富.可以看出,在这个例子当中本文算法的正确匹配率明显高于SIFT算法,SIFT算法的正确匹配率仅有50%,而本文的算法对于所有的匹配都正确.同时可以发现,SIFT算法在这种具有丰富细节信息的图像间进行特征匹配的表现并不理想,比较容易受到细小纹理的干扰,导致查错率比较高.图11SIFT算法和本文算法的匹配实例比较5.5图像检索应用我们在一个小的图像数据库上①进行图像检索实验以验证本文提出算法的有效性.该数据库一共有30幅图像,包含10组不同的物体场景,每组是由3幅包含同一物体场景的不同变换的图像组成.我们分别用SIFT算法和本文提出的算法分别提取图像局部特征,然后为每个局部特征计算描述子向量,接着对每两幅图像进行特征匹配,并将匹配的特征个数作为图像间相似度测量准则.最后按照文献[17]的计分规则,对于每一幅图像返回2幅检索到的最相似图像,如果这两幅图像和待检索图像在同一组,加2分;如果有一幅在同一组,加1分;否则,没有加分.在这样的规则下满分可以达到60分.用两种算法得到的分数分别除以60就可以得到图像检索的正确率.表2分别列出了SIFT算法和本文算法的图像检索的正确率,以及两种算法的平均特征检测时间和平均特征匹配时间.可以看出,在这个实验中本文算法的图像检索性能要优于SIFT算法,比SIFT算法的检索正确率高出6.7%;在特征检测速度方面,两种算法基本持平;而由于本文描述子维数更低,使得本文算法的图像特征匹配速度优势明显,比SIFT算法的速度提高62.4%.表2两种算法在图像检索实验中的性能比较SIFT48.3本文算法55.0①图像检索数据库,http://www.cs.cmu.edu/~yke/Page96结论本文提出了一种新的局部不变特征检测和描述算法,并应用于宽基线的图像匹配与检索.在局部特征检测方面,本文提出Harris-Difference算法,首先以多尺度的Harris角点作为初始点,然后在其附近一定范围内搜索DoG函数的局部空间极值点作为特征点的位置和尺度信息,最后为每个特征点计算主方向.Harris-Difference具有比Harris-Laplace和Fast-Hessian更高的可重复率,并且比DoG算法具有更好的抗干扰能力.在特征描述方面,本文提出的GDOH描述子不但与目前优秀的SIFT,PCA-SIFT以及GLOH描述子性能相当,甚至在某些变换条件下GDOH性能更优,比如小视点变换和光照变化,而更为重要的是GDOH特征向量的维数更低,十分有利于提高图像特征匹配的速度.大量图像匹配和检索的实验结果验证了本文算法的有效性.
