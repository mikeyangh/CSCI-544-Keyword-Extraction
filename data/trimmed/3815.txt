Page1基于动态定价策略的数据中心能耗成本优化王巍罗军舟宋爱波(东南大学计算机科学与工程学院南京211189)摘要当前,云数据中心的能耗问题已成为业界关注的热点.已有研究工作大多致力于从技术角度降低数据中心的能耗,或在能耗与性能之间寻求一种最佳的折衷.云计算作为一种商业计算模式,已有研究成果很少考虑到云定价策略对能耗管理机制的影响.文中提出了基于动态定价策略的数据中心能耗成本优化方案.建立起服务价格和能耗成本的统一模型,通过研究两者之间的关系.协同优化服务价格与能耗成本,使数据中心的收益达到最优.鉴于数据中心规模庞大、承载任务繁重等特点,论文采用基于重载近似的大规模排队系统来对数据中心建模,根据不同数据中心间的服务需求量和电价差别,设计了多数据中心间的负载路由机制,旨在削减数据中心的整体能耗成本.针对单个数据中心,定义了双阈值策略以动态调节服务器的各种状态(On/Off/Idle等),从而使数据中心能耗成本得到进一步优化.实验结果表明,论文提出的解决方案能够在满足用户QoS需求的前提下,较好地优化数据中心能耗成本,同时使数据中心的收益达到最优.关键词数据中心;能耗;定价策略;排队系统;绿色计算1引言近年来,国内外的互联网厂商纷纷兴建各自的数据中心以提供各种云存储或计算服务.随着数据中心规模的扩展,其消耗的能源及温室气体排放问题也愈显突出.据统计[1-2],能耗已成为数据中心运营和维护的最大成本所在.日益凸显的能耗问题严重阻碍了云计算技术的普及与发展.这一矛盾促生了IT界在技术发展方向上的又一个成长支点.许多数据中心商家意识到节能技术具备诸多优势:第一,降低碳排放量,利于环保.第二,削减能耗成本,取得良好的经济效果.第三,摆脱对冷却设施的过度依赖,利于维持系统的稳定性.因此,许多厂商都在积极研究绿色节能技术,以期通过快速抢占节能技术领域的制高点来攫取自身利益的最大化.目前的能耗优化工作大多致力于优化数据中心的能耗总量,或在能耗与性能之间寻求一种最佳的折衷.但优化能耗总量并不一定能耗降低数据中心的能耗成本[3].能耗成本取决于许多因素,如能耗总量、电力价格以及服务需求量等.文献[3]等认为降低数据中心的能耗成本更符合数据中心的商业利益.然而,现有工作很少考虑云定价模式对能耗成本优化技术的影响.目前,云提供商一般会采用一种灵活的定价模式(FlexiblePricingScheme)来调节服务请求量,使得自身的收益达到最大.如Amazon在需求量较低时廉价出售云资源,以提高资源的利用率.实现其商业收益的最优.尽管Amazon的这种定价模式还只是初步的尝试,但已经引起了学术界及工业界的广泛关注[2].显然,不同价格水平对市场需求量有着直接的影响[4-5].如图1(a)所示,当价格增长时,需求量随之减小,两者呈反比关系,并且这种关系呈现一定随机波动性.图1(b)显示3种不同价格水平下,需求量随时间的变化情况.由此可见,价格水平决定着需求量(但不是唯一决定因素),而需求量对数据中心的能耗管理则有着显著的影响.当前,许多云提供商,如Amazon、Google等均在全球多地建立多个数据中心,将数据中心部署在不同地理位置不仅便于扩展云服务市场,而且有利于削减能耗成本(利用温差、电价差别等).考虑如图2所示的多数据中心环境:假定云提供商P在不同区域建立了多个数据中心,由于地域差异,电力价格及面向的用户市场均不同.例如,时刻t0,数据中心的服务价格为p0,到t1时刻,云提供商P为了刺激消费,将服务价格调低至p1,此时各地的市场需求量对价格调整可能有不同的反应.与此同时,各地的电力价格也可能发生了改变(如采用阶梯电价或分时电价).此时,如果能将负载转移到需求量和电价均较低的数据中心,将能够有效地提高资源的利用率并降低数据中心的能耗成本.具体而言,可按照如下两步来优化数据中心的能耗成本:(1)负载分配:合理地将负载调度到不同的数据中心,在保证服务性能的同时,尽可能地利用电价和服务需求差别降低能耗成本.(2)服务器状态调节:在既定负载分配策略下,对单个数据中心,实时决策服务器所处状态(On/Idle/Off等)以进一步优化能耗成本.由于不同数据中心具有异构性大、跨区域等特点,上述优化策略面临如下几个方面的挑战:(1)负载转移需要花费一定的时间,可能造成用户QoS性能的下降.(2)不同数据中心服务能力并不相同,并且规模有限,负载分配须考虑数据中心的异构性.(3)数据中心价格调整的目的是为了获取自身利益的最大化.能耗优化策略应与价格调节策略协调一致.两者不存在冲突.(4)现实环境中的负载流量受多种因素影响,具有随机波动性.能耗优化策略应能有效适应负载Page3流量的动态变化.为了解决上述问题,本文将服务定价、负载分配以及服务器状态调节等相关策略统一考虑,制定出一个协调一致的系统优化方案,从而达到有效削减数据中心能耗成本的目的.首先建立起市场需求的变化模型,利用排队理论分析服务价格、任务响应时间以及服务能力等性能指标的关联关系,据此设计出合理的负载路由机制及具有QoS保证的能耗成本优化策略.针对负载流量的动态变化,提出了基于双阈值的服务器状态调节策略.双阈值策略无需对负载进行预测,能够根据需求量变化实时调整服务器所处状态,使得数据中心的能耗成本得到进一步优化.归纳而言,本文的主要贡献如下:(1)目前的能耗成本优化工作很少考虑定价机制对能耗成本的影响.针对这一不足,我们介绍了需求函数弹性的概念,建立不同市场的需求函数模型.基于重载近似的排队理论分析相关系统性能参数,给出相应的参数关系表达式.(2)建立起服务定价及能耗成本的统一模型.据此提出了负载流量的动态路由机制,设计了最优服务定价策略,从而给出数据中心能耗成本的优化方案.本文的优化策略能够在保证用户QoS的同时,有效降低能耗成本.并使得数据中心的收益达到最优.(3)为了处理负载流量的动态波动性,定义了双阈值策略以实现数据中心服务器状态的实时控制.分析了相关系统参数对阈值选取的影响,给出了最优阈值的计算方法.双阈值策略在真实的仿真数据中,能够较好地贴近负载流量,有效地避免了能耗浪费.本文第2节介绍相关工作;第3节建立数据中心能耗成本与服务定价模型以及形式化描述;第4节主要分析服务定价策略、负载分配机制以及能耗成本优化方案,给出近似最优解,最后提出双阈值策略;第5节为实验以及结果分析;第6节总结全文并提出未来工作.2相关工作对本文启发较大的工作主要有两个方面:(1)数据中心能耗或能耗成本优化的研究;(2)云计算服务定价策略的相关工作.本节将分别对这两个方面予以阐述.数据中心能耗/能耗成本优化.能耗优化和能耗成本优化的区别在于:能耗优化一般只考虑系统的能耗总量,而能耗成本优化不仅要考虑能耗总量,还要考虑单位能耗的价格.本文的工作主要是对能耗成本的优化.文献[3]利用排队论建立的系统模型和本文相似.该文献利用全美各地的电力差价,适时地将负载流量调度到不同的数据中心去,以期削减数据中心的能耗成本.该文献将负载分配问题建模成最小代价流问题,提供了一个快速的近似求解算法.与我们工作不同的是,文献[3]考虑的负载流量是稳定的泊松到达流.但是在真实的数据中心环境中,负载流量具有动态波动性,本文在泊松到达模型的基础上提出了双阈值策略,能够更好地适应流量的动态变化.文献[4]研究了多数据中心架构下的碳排放量优化问题.该文献所提出的问题模型和求解思路均可适用于能耗优化.文献[4]分析了用户及提供商双方的相关需求函数及约束条件,将碳排放量优化问题转化为双目标优化问题,提出了3种启发式的求解思路.对于单个数据中心,该文献采用DVS技术进一步对碳排放量进行了优化.与本文不同的是,文献[4]的优化目标是单个任务,考虑的定价策略是静态的,而本文考虑的是面向统计负载流量的动态定价策略.文献[5]利用时间序列分析技术,结合不同的定价策略来预测云市场的需求量.同本文一样,文献[5]考虑了多用户市场的需求差别,基于预测结果,提出了一个动态的云资源管理方案.该文献把动态资源分配问题建模成多维背包问题.针对不同的定价模式,给出了最优回报的求解算法.文献[6]认为能耗优化需要资源管理策略的支持.而当前面向市场的云资源管理机制大多没有考虑能耗优化.该文献利用排队论分析了用户的响应时间和系统能耗量之间的函数关系,并通过博弈论对用户和提供者双方进行建模,将能耗优化建模成Stackelberg博弈,双方各自优化自身的目标函数,最终达到了系统的一种均衡.并据此给出了能耗最优值的上下界.与我们不同的是,文献[6]考虑的是单通道排队系统,优化目标是系统的能耗总量,并且没有考虑系统的整体收益.文献[7]认为地理上分布在各地的多数据中心可以利用如下3个方面来削减能耗成本:(1)不同数据中心处在不同的电力市场,电价计费模式不一致;(2)即便电价计费模式一致,时区差异也可能导致电价不同;(3)不同数据中心所处的气候环境不一样.基于上述3点不同,文献[7]研究了数据中心虚拟机迁移和放置策略.对能耗成本、峰值成本、温度影响、制冷成本以及迁移成本等各种成本因素进行建模.提出了具有成本感知的负载放置策略.通过研究负载变化对能耗的影响,提出了“预制冷”机制,Page4以避免服务器的局部过热.上述研究工作同本文的异同点可参见表1.本文工作Rao等人[3]Garg等人[4]Zhang等人[5]León等人[6]Le等人[7]云服务定价模型及成本优化.文献[8]用遗传算法计算云市场的最优价格,使得云服务提供商的利益得到最大化.该算法综合考虑了云提供商自身和潜在竞争对手的资源供应能力,给出了一个有竞争力的资源定价模型.该模型能够灵活地调整价格以适应动态变化的云市场需求,但是遗传算法本身较为复杂,实际应用起来存在困难.文献[9]从用户的角度研究了3种不同价格模式下的资源规划问题.该文献用排队论计算满足用户QoS性能所需的资源量.通过QoS监控模块实时监控用户QoS需求是否得到满足.如果无法满足,则从现货市场(SpotMarket)购买资源.如果得到满足,则依据既定准则,决策是否释放部分资源以节省成本.文献[10]认为云计算是一种商业计算模式,这种特点改变了原有分布式系统的设计理念和优化机制.云服务的定价模式应在系统优化和经济效益之间起到一个”桥梁”的作用.该文献研究了定价对系统可能产生的影响,包括性能、成本、公平性、稳定性等.基于此,文献[10]在真实的实验环境中得出了如下结论:(1)只考虑成本优化并不一定能增加系统的效益;(2)现有的定价模式均没有考虑用户公平性;(3)定价机制应考虑系统的可靠性.上述结论为云定价机制的进一步研究提供了重要的参考依据.文献[11]假设用户和提供商均为理性的,均要最大化自身的效益.基于该假设,该文献提供了一种动态定价机制,以适用于用户从不同提供商购买资源的情形.文献[11]将该定价模型和固定价格模型进行比较,验证了动态定价模型的有效性.文献[12]将服务价格同QoS联系起来,提出了一种具有QoS感知的服务定价模式.该定价模式主要面向批处理任务,优化社会总效益.文献[12]认为现有的定价模式导致目前服务提供商的资源利用率普遍较低.为此提出了一种激励兼容的定价模式,并且证明了该模式能够使得社会的效益达到最优.基于定价策略研究数据中心的节能工作相对较少,论文在对上述研究成果进行深入分析的基础之上,将服务定价和能耗优化问题相结合,研究定价策略对能耗优化的影响.提出了服务定价和能耗成本的联合优化机制,供数据中心能耗管理的研究者参考借鉴.3基于排队论的多数据中心建模本节基于排队理论对多数据中心的服务价格及能耗成本进行建模.服务定价、系统成本及收益等相关优化问题在排队理论领域已取得了丰硕的研究成果[13,24].基于现有的研究工作[13],我们将主要研究多数据中心的服务定价、系统成本及收益优化问题.本文研究工作与文献[13]的区别在于:(1)本文研究的多数据中心模型之间的服务器数量及服务能力异构;(2)本文的多数据中心模型需要负载均衡机制.数据中心对每个接入服务的用户设定一个访问价格以获取一定的收益.用户访问数据中心,不仅需要考虑该服务的价格,同时也要考虑服务质量.为了简化模型,本文用延迟成本来描述用户对服务质量的满意程度.任务响应时间越长,延迟成本就越高,而用户的服务质量满意度就越低.延迟成本可表示为任务响应时间的函数,常用的成本函数有线性函数、指数函数[24]等.只有当服务价格和延迟成本之和小于用户保留价格时(心理价位),用户才会选择访问数据中心.比如现实生活中,用户付费观看某网站的视频,如果长时间得不到响应(延迟成本过高),用户则可能会点击“停止”按钮,终止访问.以下针对图2所示的多数据中心环境,采用基于重载近似的大规模排队理论,将其建模成图3所示的排队模型.Page5基于该模型,研究在稳定的系统状态下不同系统参数(价格、延迟、服务器数量等)之间的关联关系.为了清晰地表述文章内容,将文中变量的记法和描述列于表2之中.符号iAgent的编号索引,最大值为Mj数据中心的编号索引,最大值为NφiAgenti的需求量λj数据中心j的需求量,无下标则为数据中心总需求量pij需求从前端i路由到数据中心j的概率p服务价格q用户的延迟代价ψ用户潜在需求量,带下标则为不同市场的潜在需求量Pj数据中心j的拥塞概率Λjψ按概率路由矩阵分解到数据中心j的潜在最大流量ED服务的端到端平均延迟v用户的保留价格F,f用户的保留价格分布函数及密度函数ωj数据中心j每单位服务能力消耗的能耗μj数据中心j的服务能力nj数据中心j的服务器数量ej数据中心j的电力价格Lj数据中心j的规模上限Dj数据中心j的延迟约束R数据中心的总服务收益[a,b]价格p的变化区间β1β2双阈值策略中服务器的启动阈值和关闭阈值ρ(t)单数据中心系统的平均效用θ,σ服务器的启动和关闭速率假定服务提供者设定的价格为p>0,任务延迟为ED.本文采用线性函数qED来表示用户的延迟成本,q为一常量.用户的保留价格为一随机变量v,服从概率累积分布函数F.假定F连续可微,其密度函数f处处为正,初值为有限值.当给定p时,用户可根据自身的保留价格v,通过概率P(vp+qED)来决定是否访问数据中心.本文主要分析数据中心处于稳定状态时的系统行为.则用户需求率应满足以下的需求关系:λ(p)=ψP(vp+qED)=ψ(1-F(p+qED)),其中ψ是市场的潜在需求量.即用户的实际访问量等于市场的潜在需求量乘以访问概率.上述的需求量模型常见于各种经济模型当中[13].下面,定义需求函数弹性的概念,以衡量市场中服务需求量对服务价格变动的敏感程度.价格.则λ(p)的弹性可定义为定义1.令λ(p)为客户的需求函数.p为服务如果λ(p)在区间[a,b]上满足ε(p)>1,则称λ(p)是弹性的.对需求弹性的直观解释是:由于经济规律的作用,价格与需求之间存在着反比关系,即当价格升高时,需求量下降,反之亦然.弹性概念旨在说明价格变化比率与需求量变化比率之间的关系.价格与需求函数之间这种简单而又重要的关系,被广泛地运用于各种形式的经济模型当中.虽然数据中心建在不同的区域,电力价格和服务能力各异,但服务价格应一致.即价格具有区域无关性,比如用户不论身处何地,均需要同等积分下载某网站的资料.我们假定不同市场的需求函数均满足上文定义的弹性条件.用户通过分布在各地的Agent访问数据中心.令不同区域市场的用户保留价格分布函数分别为Fi,需求函数为φi(p),i=1,2,…,M(即生成的任务到达强度).p为服务价格,则按照上文分析,φi=ψ(1-Fi(p+qED)).令φ为各地用户的总需求量,并定义函数于是可有如下推导:φ=∑Mpij()=1为任务的路由概率,即Agenti的令pij∑N任务被送到数据中心j的概率为pij.因此,[pij]构成了一个路由矩阵.令λij=φipij,于是数据中心j的到达强度为λj=∑M当需求函数满足弹性关系时,有如下定理.定理1.假定Agent的潜在最大需求总量ψ=njμj=κψ.那么,对于任何满足∑M∑Mi=1ψi和数据中心总服务能力∑N即∑Nj=1的概率路由矩阵犘[pij]和服务价格p>0,下列等式成立:P1(congestion)=…=Pj(congestion)→ν∈(0,1),其中Pj(congestion)为数据中心j的拥塞概率.并且,(1)用户请求总到达率为φ=∑Nη的计算见下文式(5).Page6(2)服务价格p具有如下结构其中,p=珚F-1(κ),独立于数据中心的服务器数量.pj=∑Mi=1(3)数据中心j的平均延迟为j=1j=1Λj(流量守恒),Λj为服务请求强度依概率分其中,(π,η,d)由ν唯一决定[13].证明.文献[13]已证明对于单通道的排队系统,当n→,并且需求函数和服务器数量保持如下比例关系λ=nμ-η槡nμ+o(槡n)时,系统的拥塞概率趋向于定值ν,且到达率、服务价格和服务迟延均与该值一一对应.借助其结论,只需证明存在概率路由矩阵犘[pij],使得各数据中心的请求到达率和服务能力满足这一关系即可.由假设∑Nψ=∑N解后到达数据中心j的潜在最大流量.得∑Nκψ=∑N服务能力的约束关系分解到各数据中心,并且依然满足原来的假设.由Λj=ψ∑Mnjμj/κ,于是,可令∑M由矩阵犘[pij]满足这一关系即可.同时,由文献[13],为保证拥塞概率为v,每个数据中心的服务价格应为pj=p+π计算为p=p+∑N该定理表明,虽然系统接近满负载,但拥塞概率依然可能较低,并且经过负载均衡,可使各数据中心的平均时延均控制在d/n槡j左右.根据文献[13],η可由1qf(p)η-(唯一解得.其中,φ(η)、Φ(η)分别为标准正态分布的概率密度函数和累计分布函数.下一节基于该定理分析最优定价和能耗优化策略.4数据中心最优定价与节能策略上节利用重载近似理论对处在不同区域的数据中心进行了建模和形式化描述.为了考察系统稳定状态下的性质,定理1刻画了需求函数同服务价格、服务器数量之间的一一映射关系.本节将基于该定理,分析如何优化服务价格和能耗成本,并介绍双阈值策略进一步削减数据中心的能耗成本.4.1最优定价及能耗成本优化如图3所示,假设数据中心j每提供一单位服务能力,其消耗的能量为ωj,数据中心j的电力价格为ej,数据中心j的总处理能力为njμj.则数据中心j的总能耗成本为wjejnjμj.假设我们只考虑能耗成本,而忽略其它成本因素,则服务提供者的收益等于价格收入减去能耗成本.按照表2的符号约定,服务提供者面临的优化问题如下:其中R(p,nj)为数据中心j的服务收入.根据定理1,R(p,nj)可表示为R(p,nj)=λj×p≈(njμj-ηn槡jμj)×p(nj)+π将其代入式(6),可得到如下的近似表达式:max∑N由于数据中心的规模有限并需要保证用户的QoS需求.上述优化目标存在一系列的约束条件,包括服务能力上限、任务延迟、价格区间等.于是,服务方收益最大化问题可形式化为P1:P1:max∑N其中,数据中心j的延迟约束为Dj,价格p的变化区间为[a,b].由定理1,当nj→时,njμj→λj.于是Page7问题P1的目标函数可近似为∑N面,我们基于重载近似的思路分为三步考虑如何求解该问题.首先,求解数据中心的负载分配策略,即负载路由策略,实质上为路由向量的求解(原因在于当服务价格p确定时,系统的总需求量也是确定的.因此,不同的用户市场可以合并为一个用户市场.因此路由矩阵犘[pij]退化为一个路由向量).对于M/M/n排队系统的延迟,精确的表达式应为ρvnu-λ,ν为系统的拥塞概率.假定各数据中心服务能力均已达到上限,即nj=Lj,令ρjvjnjuj-λj=Dj,由定理1,令各数据中心拥塞概率νj相同且趋近于1,再由ρj→1,便可求出路由向量.其次,根据已知的路由向量,联合定理1的式(3),可得到数据中心的整体服务能力.最后,在延迟和价格约束的条件下,求解各数据中心的最优服务器数量.最终得到最优能耗解.详细步骤如下:第1步.当nj→时,根据以上分析,以下等式Dk(Lkuk-λk)≈Dj(Ljuj-λj)≈1,1j,kN,可求出近似路由向量.第2步.令C为数据中心总服务能力,由p(λj)=p(λk)=p(C),则∑N(p(λj)-ωjej)λj=p(C)C-C∑Nj=1其中pj为服务流量分配到数据中心j的概率.令成立.由p=珚F-1C()Λ,得到式(10)FC=p(C)-C令其等于0,联立κ=C/Λ,p(C)=珚F-1(κ),即可解出κ,进而得出C,p(C).第3步.根据已解出的路由矩阵和价格p(C),把需求函数分解到各个数据中心.这时,需要变换约束条件.由λj=φ(p)pj,于是,价格区间条件可变为ap=φ-1λjp()jb.对于延迟约束,由ρv条件可表示为EDj≈1fj(p)η-(又由珚Fj(p)qDjn槡jπ,再由p=p+π/n槡j,得π=φ-1λjp()j-p(延迟条件的表达式为这样,约束条件简化很多,便可求出分解到各个数据中心的流量.为使数据中心的服务器数量最少,根据式(2)和式(5),再由试探法确定π的值,最终得到最优的价格和能耗量.上述求解过程可通过范例1予以说明.例1.假定需求函数为200-50p,e1=0.8,e2=0.5,L1=60,L2=45,D1=0.7,D2=0.5,N=M=2,ω1=1,ω2=2,μ1=μ2=1,用户的延迟成本q=1.首先求解近似路由矩阵,由D1(60-λ1)≈D2(30-λ2)≈1可得近似路由矩阵为〈0.584,0.416〉.将其代入一阶最优性条件(10),有如下方程组:烄烅烆解之,得p=2.44,C=77.88.又由λj=(200-50p)pj,得p=4-λj/(50pj).将其代入问题P1,则问题可转化为P1:max∑N将p1=0.58,p2=0.42代入并解之,得λ2=28.69,λ1=43.93,试探得π=0.397.于是n2=33.69,n1=48.93,p=2.485.能耗值为116.31.最优的收益为78.27.而n1+n2=82.62略大于C=77.88,因为我们求的是近似解.当C→时,两者应趋于一致.分析与讨论.上述3步求解过程依次为由重载近似求出负载的路由向量.根据路由向量,优化数据中心的整体服务能力.最后再根据约束条件,确定不同数据中心的最优服务器数量,最终得到能耗的最优解.在问题P1的求解过程中,亦完成了对负载分配、最优定价以及能耗成本优化等机制的设计.本节的最优服务器数量是基于流量稳定等理想情况.真实的数据中心环境中,影响服务器能耗的因Page8素有很多,比如服务器失效、突发流量等.一般而言,数据中心会设置一些备用服务器(处于空闲态的服务器)来保证用户的服务质量.但是服务器空闲也需要消耗大量的能耗.下节将基于本节的最优服务器数量介绍双阈值策略以动态控制服务器所处状态(On/Idle/Off等),实现更细粒度的能耗成本优化.4.2双阈值策略对于单数据中心而言,常用的服务器级能耗优化技术主要有两种:一种是DVFS(DynamicVoltage/FrequencyScaling),另一种是DPS(DynamicPowe-ringOn/OffServers).DVFS通过动态调节CPU的频率和电压来降低完成任务所需的能耗量.但是即便CPU利用率为0%,服务器也需消耗能耗峰值的60%左右[14].因此DVFS的能耗节省能力有限.本文主要考虑DPS技术.DPS技术是根据负载情况动态地选择开启或关闭服务器以节省能耗.由于用户请求的流量动态变化且具有不可预测性,而服务器启动和关闭均需要花费一定的时间.这不仅影响了系统的性能,还会导致额外的能耗开销.因此DPS技术需要预留部分空闲服务器以缓冲流量的动态变化,同时需要对服务器的开关时机进行合理的决策.一种有效统计动态负载的方法是利用文献[15]中的式(6)对一段时间内的流量进行实时统计:其中ρ(t)可理解为系统的平均效用.GcGμ(t)=P(S(μ)>t).S(μ),λ(μ)分别为时刻μ到达的任务的执行时间和到达率.n为4.1节计算出的最优服务器数量.下面基于式(12)介绍一种双阈值策略来实时调节服务器所处状态(On/Idle/Off等)以解决服务器预留以及开关时机决策问题.采用双阈值策略,当负载流量超过已开启服务器的服务能力时,数据中心并不立即启动服务器,而是等负载量积累到一定比例β1(阈值β1)时,才开始开启服务器.当部分服务器空闲时,数据中心并不立即关闭服务器,而是等待服务器空闲量到达一定比例β2(阈值β2)时,再开始关闭服务器.双阈值策略的主要思想来源于休假排队系统(VacationQueuingSystem)中休假时间的选择问题[16-17].本文借助其思想,将其应用到数据中心服务器状态控制策略中.下面,本文不加证明地选取如下参数作为双阈值策略中的阈值,参数的选取规则可参见文献[16].β1≈nlogρ(t)n(1+β1)μ1β2≈nlogρ(t)n(1-β2)μ1其中,T为用户给定的延迟上限.θ和σ分别为服务器的启动和关闭的速率(平均启动和关闭时间的倒数).ρ(t)的计算公式如式(12).n为4.1节计算的最优值.基于这一思路,双阈值策略可衍生出多种变体.如多阈值策略(用户延迟等也作为阈值参数)、动态阈值策略(阈值计算方式动态调整)等.限于篇幅,不同阈值策略的效果比较另文给出.表3、表4分别给出不同参数对阈值β1选取的影响.固定参数:T=0.02,θ=0.01,Gc固定参数:T=0.02,ρ(t)=0.5,Gc从表3中可以看出,当系统效用ρ(t)较低时,阈值β1的取值相应较高,而当ρ(t)增大时,阈值β1变小并且下降速度很快.这是由M/M/n排队模型等待时间分布函数的性质决定的.因为M/M/n排队模型的平均等待时间随着平均系统效用的增加而增加,但增长幅度越来越大.较小的阈值β1可以促使服务器快速启动以降低服务延迟.当ρ(t)较小时,服务器空闲率较高,此时阈值β2起主导作用,较大的阈值β1可以避免机器的频繁开关,利于维持系统的稳定性.表4给出启动速率θ对阈值的影响.当启动Page9速率较大时,服务器启动时延对服务性能影响较小.阈值β1取值较低利于服务器快速响应流量变化.当启动速率较小时,阈值β1取值较高,此时决定任务响应时间的是已开启的服务器数量.较大的阈值可以避免服务器频繁启动引起的能耗开销和系统的不稳定.上述参数对β2的影响与β1类似.限于篇幅,文中不再赘述.5实验本节通过实验验证上文提出的定价和节能机制的有效性.首先介绍实验设置,包括电价、需求函数的选取.其次选择3种定价策略与本文提出的动态定价策略进行比较.最后通过对比两种常见的启发式DPS技术,验证双阈值策略的有效性.5.1实验设置实验采用的电力价格来自于Amazon在美国所建数据中心的所在地.包括如下各地:Virginia(佛吉尼亚)、Dallas(达拉斯)、LosAngeles(洛杉矶)、Seattle(西雅图)和NewJersey(新泽西).电力价格可在美国能源部官网查到(隶属于商业用电类别)[18],总结见表5.各地数据中心的服务能力、功耗以及服务器的数量可在Amazon最新发布的用户手册上找到参考值(为了便于实验,数据随机选取)[2],同样列于表5.前端Agent数量设置为3.地点ID(j)ej($)Lj(103)μjωj/kW佛吉尼亚17.5181.50.12达拉斯29.96121.750.14洛杉矶312.26101.250.10西雅图47.4792.00.15新泽西513.29101.00.12实验选择3种需求函数模型,包括线性需求、负指数需求和异弹性需求,对比不同需求模型下本文给出的最优定价及能耗优化效果.需求函数的表达式见表6,具体参数根据实验另行设置.为了验证本文提出的定价策略的有效性.与3种常用的定价策略进行对比分析.分别是固定定价策略、现货市场定价策略和随机定价策略.固定定价策略.常见的固定定价策略有两种:一种是实时定价策略.用户可以实时地购买资源,资源按时计价.当用户使用完毕以后,可以选择继续购买或释放资源.实时定价策略的优点是便于用户使用资源,成本较低.缺点是按时计费的价格比一般定价策略要高.另一种是预留定价策略:用户可以长期购买某种资源.若购买时一次付清,可以享受折扣优惠.该策略下,服务提供商一直预留该部分资源给用户.现货市场定价策略(SpotMarket).服务提供商根据市场需求制定服务资源的拍卖价格.用户选择自身意愿提出能接受的最高价格,如果最高价格高于拍卖价格,则获得资源.在资源使用过程中,服务提供商可以提高价格,如果用户不接受,则用户的服务可能被终止,换言之,服务提供商不保证服务质量.随机定价策略.在预留价格和实时价格区间内,随机选择服务价格.一般而言,服务提供商不会采用随机定价策略,本实验采用随机定价策略,只是作为一个参考标准.为了验证本文提出的双阈值策略的有效性,本文和另两种启发式DPS技术:Delayoff策略[19]和Lookahead策略[20]进行比较.Delayoff策略.Delayoff策略设置服务器空闲等待时间阈值,当空闲时间达到该阈值时,再关闭服务器.Lookahead策略.与Delayoff策略不同,Looka-head策略基于预测机制,对下一周期的任务量进行预测,据此判断是否需要关闭服务器以节省能耗.5.2实验结果(1)不同定价策略的效益对比.实验需求函数选取为线性需求λ(p)=Λ-αp.Λ和α为反映市场需求能力变化的参数.上节3种定价策略均采用本文的路由机制.这并不影响实验的公平性.因为负载需求的变化和路由向量无关.图4显示在需求函数不变时,4种不同定价策略的收益对比.在市场需求量较小时,固定定价策略价格最高,用户请求量最低,从而损失了部分收益,其收益反而最低.现货市场定价策略在需求量较低时,由于采用比较合理的拍卖机制,价格收取比固定定价策略略低,收益相对较高.随机定价策略的收益取决于随机价格的选取,实验选择的随机价格低于固定价格,在市场总体需求量较低时其收益比固定价格高,比现货市场价格低.动态价格机制以最大化提供商收益为优化目标,Page10收益最高.在需求量规模中等时,固定价格与动态价格接近,收益相差无几.现货市场定价策略的定价略高,损失了部分需求量,收益较低.随机定价策略的收益最低.在需求量规模较大时,随机定价策略和固定价格策略的服务请求量均较大,但是需求量的增长不足以弥补价格的损失,虽然收益有所增加,但相对其它两种策略仍较低.动态定价策略采用了较高的定价,因而收益最高.从图4中可以看出,在不同规模的市场需求中,动态定价策略的收益相比于其它策略可多出4%~9%左右.图5显示了固定定价策略的收益损失示意图,现货市场策略与随机定价策略与之类似.从图中可以看出,当市场需求量较低时,固定定价策略收费较高,很多人选择使用价格更低的动态价格,损失了部分需求收益.当市场需求较大时,固定价格收费太低,损失了部分价格收益.而动态定价策略以最大化数据中心收益为目标,总能达到收益的最优.(2)定价策略对QoS、系统效用的影响.图6、图7分别描述随着市场需求量的变化,不同定价策略对用户时延及系统效用的影响.市场需求量较低时,固定定价策略收费最高,需求量最低,用户延迟最低,只有0.001s.随机定价策略的定价比固定价格要低,用户延迟略高,为0.04s.现货市场价格不考虑用户的QoS,延迟最高,达到0.05s左右.动态价格策略在市场需求量较低时,延迟比固定价格要高.随着市场需求量的上升,固定定价策略的QoS性能随之下降,同时下降较快的还有随机定价策略.两者在需求量较大时,用户延迟均急剧上升,高达0.2s,因为两种策略均没有调节负载的功能,造成了系统的拥塞.对于现货市场定价策略,在市场需求量较小时,用户延迟高于固定定价和随机定价策略,并随着需求量的增加逐渐增加.但当需求量较大时,则低于固定价格和随机价格.动态定价策略在市场规模较小时,用户延迟略高于固定价格,但差别不大,随着市场规模的增长,动态定价策略的用户延迟增长平缓,表现出良好的调节能力.在市场需求量为80000时,延迟时间低于其它策略多达0.4~0.6倍.固定定价策略的系统效用在市场规模较小时最低,只有13%.随着市场规模的增大,系统效用逐步增加.随机定价策略表现出了类似的性质.而现货市场定价策略开始时系统效用较高,达36%.随着市场规模的增加,变化较为平缓.动态定价策略为了保证QoS性能而抑制系统效用的增长.市场规模较大时,系统效用只有61%.随机价格的选取低于固定价格,从而需求量高于固定价格.所以对于同样的服Page11务资源,系统效用也高于固定价格.(3)定价策略对能耗成本的影响.本实验对比不同定价策略对能耗成本的影响.在需求量较低时,固定定价策略使用的服务器数量最低,从而能耗也最低,约为12000.随机定价策略次之.现货市场定价策略的能耗最高,达到48000.因为其将资源廉价出售出去.资源利用率最高.随着市场规模的扩大,动态定价策略的能耗增速缓慢.主要有两个原因:一是由于价格调节,抑制了服务需求量的快速增长;另一个原因是由于路由矩阵的作用,降低了能耗成本.路由矩阵的优化只针对动态策略,因此其它3种定价策略的能耗成本均增长较快.特别是随机定价策略,在市场规模较大时,能耗成本为动态定价策略的2倍之多.(4)路由机制对能耗成本的优化.以上实验对比了价格机制对各种性能参数的影响.本组实验考虑路由机制对能耗成本的优化效果.图9为采用固定路由策略(根据数据中心的处理能力按比例分配)时的能耗成本.假定需求量固定,随着电力成本的增加,各地的能耗成本均在增长,其中,西雅图的电力成本变化最大,能耗成本增长最快.而洛杉矶的电价没有改变.因而能耗成本基本没有变化,图10显示路由机制在电价较高时将负载转移到电价较低的底特律和洛杉矶,此时,尽管底特律和洛杉矶的能耗成本有所增加,但是总体成本却减少了20%左右.并且从图中可以看出,通过负载调节,各地的能耗成本分布也较为均衡.(5)数据中心服务器数量优化.当前许多数据中心的资源供应方式是为了满足负载的峰值需求,这导致了资源的过量供应,造成了大量的能耗浪费.本实验验证文中给定的服务器数量最优值能够在满足QoS需求的同时,尽可能地减少能耗开销.图11显示对于不同需求函数,服务器数量最优值的选取和相应的数据中心最大收益值.图11不同需求函数对应的服务器数量最优值图12显示任务延迟和能耗成本随服务器数量的变化关系,从图中可以看出,在服务器数量较少时,增加服务器数量能够显著改善服务质量.但是当服务器数量增加到一定程度,继续增加服务器,服务质量提高幅度不大,而能耗值却呈线性快速增长.文中选取的最优服务器数量是通过最大化数据中心的整体效益得到的,在满足用户QoS需求的同时,实现能耗和性能的折衷.(6)双阈值策略的有效性.本实验选取两组负载流量的到达模式,验证双阈值策略的有效性.一组Page12是正弦曲线生成的到达流[21-22].一组是参照维基百科的访问日志生成的真实流量[23-24].图14基于Wikipedia负载的资源供应对比图中对比了不同服务器状态控制策略所启动的服务器数量.在不影响实验效果的前提下,为了简化实验,假定每个请求需占用一台服务器.该假设只是对负载规模做了处理,而没有改变其动态性的特点.从图中可以看出,Delayoff策略在负载波动较大时,随机性较大,造成了能耗的浪费.基于预测结果的Lookahead策略能够成功“学习”到正弦负载,表现出了很好的匹配效果.双阈值策略不基于预测,启动的服务器数量略高于实际需求的服务器数量.双阈值和Lookahead策略均能够有效地避免了资源过量供应而导致的能耗浪费.对于真实的Wikipedia负载流量,基于预测Lookahead策略则表现较差,因为Lookahead策略依赖于预测结果的准确性,现有的预测机制对于真实负载的预测效果均不甚理想.Lookahead策略甚至会出现服务器供不应求的情况.此时Delayoff策略表现尚可,因为Delayoff策略不依赖于预测,对于随机性较强的实际负载,呈现出了较好的适应性.但Delayoff策略的时间阈值选取方式不够灵活,而双阈值策略能够基于负载的统计特性实时调整阈值,很好地适应了负载的动态变化,因而表现最佳.6结论及未来工作当前很多研究者从降低能耗总量的角度出发,研究各种数据中心节能技术.然而这些技术并没有考虑定价机制对能耗优化技术的影响.数据中心管理者更关注的是获取自身利益的最大化.因此,在真实环境中这些技术往往难以发挥作用.基于此,本文从经济学的角度出发,研究服务定价与能耗优化之间的关系,给出最优的定价策略和能耗成本优化方案.实验结果表明,本文的定价策略能够满足既定的优化目标,较好地达到能耗成本优化的效果.在未来的工作中,我们拟设计出一种激励-兼容的定价机制,在用户和服务提供商双方的利益都达到最大化的前提下,实现能耗成本的优化.此外,在真实的市场环境中,影响价格的因素很多,更精确的价格模型也是我们的下一步工作之一.
