Page1三部图张量分解标签推荐算法廖志芳1)李玲1)刘丽敏2)李永周3)3)(中南大学信息科学与工程学院计算机科学与技术博士后流动站长沙410083)1)(中南大学软件学院长沙410075)2)(中南大学信息科学与工程学院长沙410075)摘要三部图作为社会标签系统的表示方法,虽然可以简化标签系统元素间关系的表达,但也丢失了部分元素间的相关信息,而且不能有效处理标签系统中具有大量稀疏值和缺失值的数据.基于以上问题,文中提出了基于三部图的三维张量分解推荐算法(TTD算法).首先分析三部图元素间可能丢失的信息,通过定义以三部图为基础的低阶张量分解模型,对高阶稀疏数据进行分析.该模型不仅包含三部图所表达的系统信息,同时还表达了三部图所丢失的元素间相互信息;在此基础上,利用缺失值处理,进行社会标签系统中的标签推荐预测.通过模型对比实验以及标签预测实验,表明TTD模型所揭示的社会标签系统中元素间的相互关系更加全面,同时在进行标签预测时,所得到的预测结果召回率和精确率得到了显著改善.关键词三部图;张量分解三部图模型(TTD);标签预测;社会标签系统1引言作为Web2.0的重要特征[1],社会标签允许用户利用开放平台,对系统资源赋予个性化标签,为具有相同兴趣爱好的用户提供资源推荐及共享.比较成功的社会标签系统有如音乐标签系统last.fm、图片标签系统flickr以及Web网页标签系统Del.icio.us等,这些网站利用社会标签进行资源整合,搜索用户之间的联系,并通过推荐算法将用户感兴趣的标签推荐给使用同一资源的用户.社会标签系统起源于传统的推荐系统,社会标签系统的主要元素包括{资源(item),标签(tag),用户(user)},系统可定义为F··=(U,T,I,R),其中,U为user;T为tag;I为item;R为user、item和tag之间的关系,其中R∈T×U×I[2].而传统推荐系统包括{资源(item),用户(user)}及两者之间的关系,系统定义为F··=(U,I,R),其中R∈U×I[3].根据上述定义,在问题描述上传统推荐系统分析的是{item,user}之间的二维关系,而社会标签系统分析的是{item,user,tag}三维关系,因而传统推荐系统中的推荐算法不能直接应用于社会标签系统.但是很多基于传统推荐系统中的推荐方法具有良好的性能和效果[3],如协调过滤CF算法[4]、图模型推荐算法等,这些算法在推荐系统中都有良好的应用.国内外很多学者对将推荐算法应用于社会标签推荐系统进行了研究,提出了很多算法.这些算法可以分为两种,一种方法是将算法直接进行改进,将其设计成能处理三维关系的算法和模型,如Zhang与Liu[5]提出的超图模型,模型的结果能够很好地再现标签网络中的超度分布、超度-簇系数分布和节点距离排序,能够充分体现元素间的关系,但是在处理大量稀疏数据时算法复杂性较高.另外一种就是将社会标签的三维关系转换为二维关系,直接应用传统推荐系统算法及模型,如扩展PLSA(ProbabilisticLatentSemanticAnalysis)方法[6],由Cohn和Hofmann[7]提出的基于内容和基于链接相结合的统一框架模型以及当前应用较为广泛的由Mika[8]提出的利用三部图的模型,这些模型的主要目的是将标签系统三维关系转换为二维关系.除了系统分析复杂性问题外,标签系统还存在数据极度稀疏的问题.为解决这个问题,Symeonidis等人[9]首先提出将能完整地表示高维数据并且能维持高维空间数据的本征结构信息的tensor(张量)应用于社会标签系统中,并且利用张量分解方法进行标签预测.如果定义犢为张量,则犢分别表示item、tag和user的张量分解关系,不同的张量分解方法代表不同的犢.其中典型张量分解方法有Tucker分解[10]和ParaFac[10]以及由Tucker分解推广的高阶奇异值分解(HighOrderSingularValueDecompo-sition,HOSVD)[10],但是高维张量导致了算法具有高阶的时间复杂度,同时在进行标签预测时,存在对标签预测结果的过拟合问题.为改进此问题,Syme-onidis[9]采用三阶张量方法,定义稀疏张量犢,以值为1表示用户在标签上进行了标记,而0则表示没有用户没有标记.该方法去除数据集中的部分噪音,在预测效果上高于传统张量分解方法.与Symeoni-dis相似,Rendle等人[10]则是以正负来代表用户标签是否标记,如果用户对标签进行标记,则分类为“+”,如果没有标记,则分类为“-”,这种方法可以有效区分用户的标签分类,但是在标签预测过程中则不能为用户提供有效的标签序列.Rendle等人[10-11]在2010年提出了一个新的推荐算法:PITF(PairwiseInteractionTensorFactorization),它的主要思想就是在张量分解的时候,考虑3个二维关系两两之间的关联,PITF分解算法是一种特殊的具有线性时间复杂度的Tucker分解算法,在推荐质量上也有了很好的提高.通过以上研究分析,我们发现当前应用最为广泛地将三维关系转化为二维关系的为三部图模型,在三部图转换成二部图过程中存在的三元组信息丢失问题;同时由于社会标签系统数据稀疏性问题,三部图的处理方法会损失更多的三元组信息.为解决上述两个问题,本文在分析张量分解方法的基础上,基于三部图的张量分解模型对标签系统中三元组{item,user,tag}的关系进行集成及描述,分析3个对象之间潜在的关系,并在分析其有效性的基础上利用张量分解三部图模型进行用户标签预测.2三部图基础三部图将标签系统中item、user、tag定义为如图1的关系,其中,item表示为i,tag表示为j,而user表示为k;Uij表示{item,tag}之间的关系,Wik表示{item,user}之间的关系,而Vjk表示{user,tag}之间的关系.在进行标签系统推荐时,三部图通过计算3个关系对中的元素同时发生的次数,将三部图Page3转换成3个二部图的关系,即{item,user},{item,tag}以及{user,tag}之间的关系来进行社会标签系统的描述如图2所示.我们将同时发生的次数定义如下.定义1.设A,B为{item}集中的两个标签tag,则A,B同时发生的次数定义为从图1到图2的转换过程可以看出,这种方法简单明了,但是在标签系统中原始数据是以三元组出现,即{it,jt,kt},说明用户kt在资源it上进行了jt标签标注,因此标签系统数据集为{it,jt,kt},t=1,…,m.三部图在转换成二部图的过程中,如图2所示,因为只考虑了Uij、Wik和Vjk的关系,因而损失了部分{it,jt,kt}之间的信息.以图3为例,我们可以看出,item中i2与tag标签j2之间不仅仅存在着Ui2j2的关系,同时i2与j2还可以沿着item中的i2与user中的k2以及user中的k2到tag中的j2之间传递i2与j2之间的信息.但是三部图到二部图的转换中,遗失了这部分信息.因此三部图作为社会标签一个应用模型,虽然简化了标签系统的复杂关系,但是也损失了标签系统的部分信息,直接影响预测分析结果.为解决这个问题,除了要考虑三元组中各个元素间直接联系外,还需要考虑元素间的间接联系.基于此考虑,我们提出了本文的模型,简单地说,就是模型在考虑{item,tag}间的关系时,不仅要考虑{item,tag}间的直接联系,也需要考虑从{item,user}再到{user,tag}之间的间接关系.3基于三部图的张量分解方法由于标签系统中的数据集为三元组,也为三阶张量分解方法进行三部图的转换提供了理论基础.利用张量分解处理稀疏数据以及三部图简化处理方法的优越性,本文在三部图基础上建立张量分解三部图模型,定义如下根据图3,考虑到三部图中三元组元素之间两其中不同的Y代表不同的张量分解方法.两相关性,本文提出了如下张量分解模型.根据图1所示的三部图模型,item节点i和tag节点j之间的关系为而根据式(2)所定义的张量分解模型,item节点i和tag节点j之间的关系为珟犝ij=∑Nk其中,犝ij是I×J矩阵,犞jk是J×K矩阵,犠ik是I×K矩阵,比较式(3)和式(4),式(3)中三部图模型的^犝ij显示了{item,tag}之间的直接关系,而三维张量分解模型中的珟犝ij,根据式(4),可以看到珟犝ij则不仅来自{item,tag}之间的直接关系犝ij,同样也来自{item,user}即犞jk、{user,tag}即犠ik以及犞jk和犠ik的传递关系.同样也可以得到三部图模型中的^犞jk与张量模型珟犞jk以及三部图模型^犠ik与张量模型珦犠ik之间的比较结果.由此可以得出,本文提出的基于三部图的张量分解模型所包含的信息珟犝ij、珟犞jk、珦犠ik与三部图中的^犝ij、^犞jk、^犠ik相比,不仅仅来自于模型中的二维直接关系,同时也来自于模型中三元组{item,user,tag}之间的关系,因此这个模型为标签系统提供比三部图更多的系统间的相关信息,解决了三部图在转换成二部图中信息丢失的问题.该模型在进行标签预测时,为获得最优的标签Page4预测值,犡ijk、犢ijk需要满足式(5),即其中,犡ijk为标签系统实际值,犢ijk为标签预测值,其中α是一个模型参数,用于调整犝,犞,犠,使得犝、犞、犠的元素都有基本相同的数量级.4三部图张量分解算法根据式(3)所定义的张量分解三部图模型进行社会标签的预测,本文将该算法命名为TTD(Tri-partitetensorDecomposition).表1列出了算法中的所有符号含义.符号犡初始张量,犡=犡Ω+犡m犝犝ij从二维到犡Ω犡中具有值的元素集合犞犞ik从二维到犡m犡中缺失值的元素集合犠犠jk从二维到NiNjNk犡犡2=∑犝i+∑犲i=[1,1,…,1]T长度为Ni的向量犡k犲j=[1,1,…,1]T长度为Nj的向量ε收敛因子,犲k=[1,1,…,1]T长度为Nk的向量4.1TTD计算方法所示,即为得到标签预测最优解,定义目标函数如式(3)其中犢ijk为式(2),即为求解最优预测值,我们分别求解犝ij、犞jk以及犠ik的最优值,通过迭代,求取式(5)的最优值.为得到犝ij,将犞jk和犠ik固定,计算式(6)min犝J(犝)=min∑ijk令J/犝=0,得到犝的最优解:犝=(犞犞T犲T(犡k按照同样的方法得到犞和犠的最优解,其最优解分别为(犞=犝犝T犲i犲Tk+犲i犲Tk犠T犠+2犝犠+α(犡j((犡i犠=犝T犝犲j犲Tk+犲j犲Tk犞T犞+2犝T犞+α分别将犝,犞,犠最优值代入式(5),通过不断迭代求解,最终得到式(3)的最优值,即犢ijk的最优解以用于标签推荐.4.2TTD算法收敛性分析由式(3)可知,为取得最优预测值,须满足:其中,犢ijk=犝ij犞jk+犞jk犠ik+犝ij犠ik.即,求解min∑[犡ijk-(犝ij犞jk+犞jk犠ik+犝ij犠ik)]2+根据TTD计算方法,先对犝ij进行求解,为求犝nij最小值,则算法表示为:令J/犝=犅+犃犝=0,得到犝nij最小值.接着将犝nij代入,得到犞n到犠nik.假如Jn-Jn-1>ε,ε表示最小阈值,则需要继根据以上算法过程,可以知道续计算犝n+1ij、犞n+1J(犝n+1)=argminJ(犝n)J(犝n+1)<J(犝n),同理可推出,J(犞n+1)<J(犞n),J(犠n+1)<J(犠n),则J(犝n+1,犞n+1,犠n+1)<J(犝n,犞n+1,犠n+1)<即Jn+1<Jn,由此可以得到算法TTD是收敛的.4.3缺失值的处理在标签数据集中,如果某用户没有用标签对某资源项进行标注,或者某标签与某资源项没有对应关系,则称该对应关系是缺失的,形式化描述就是三元组(i,j,k)无实际有效值,即为缺失值.由于社会Page5标签数据极度稀疏,即社会标签数据集中非零值的相对数量少,所以标签系统缺失值是大量存在的,在缺失值处理中,本文采用与文献[12]相同的方法.如果标签系统中的元素为非零值,则需要满足式(10),其中Ω表示张量中所有被赋予了非零值的元素的集合.如果犡m表示标签系统F中缺失值元素组成的集合,因此对系统中的犡,有犡=犡Ω+犡m,在进行缺失值处理时,常用方法主要包括将缺失值全部置0或者值平均值,并按式(3)张量分解方法来依次迭代计算缺失值犡0m,犡1m,犡2m,…,则数据应满足式(11):其中,犡Ω就是输入张量犡中的非零值元素集合,犡tm是犡t中的缺失值部分第t次迭代的解.犡t+1是下一次迭代值.当连续两次迭代差值达到了收敛要求时,即连续两次迭代后的犡t+1与犡t之间的变化已经很小时,迭代终止,此时得到的缺失值最近似于标签系统中的犡ijk.而由于每次迭代前都把缺失值部分用前一次迭代的数据进行了填充,所以缺失值部分得到了逐次优化,最后就可以对缺失值部分进行较合理的预测.详细的证明可参看文献[12].4.4TDD算法三部图张量分解算法(TDD)将社会标签数据集描述为张量犡ijk,迭代计算式(3)中的犝ij、犞ik和犠jk的最优解并得到犡ijk的最优解,其算法表述如下.这个算法包含3个输入参数:存在缺失值的张量数据、收敛因子ε以及最大迭代次数,算法输出是预测张量犢ijk.首先算法初始化缺失值部分,我们将每个缺失值元素都初始化为张量三维的平均值,经过比较,这种初始化方法比初始值全部赋0的效果更好些.从第6行到第12行是求预测值迭代计算部分,当满足第12行中的收敛条件时算法停止迭代计算,第14行给出结果并返回.算法1.三部图张量分解算法.输入:a:Item-Tag-UserTensor犡withmissingvalues;b:εforconvergencetest;c:max-iteration输出:PredicatedTensor犢1.InitializeMissingValuepartof犡as犢0;2.Dot=0tomax-iteration3.犢t=犡Ω+犢tm;4.update犝by(7);5.update犞by(8);6.update犠by(9);7.input犝,犞,犠toCompute(3)asJt+1;8.DoStep6toStep79.ifJt+1-Jt<ε,gotoLine11;10.EndDo;11.Compute犢ijk=犝ij犞jk+犞jk犠ik+犝ij犠ik;12.return犢ijk;算法空间复杂度为O(NiNjNk),时间复杂度为O(NiNjNk×m),其中m为迭代次数.实验数据表明,m≈20左右,算法得到收敛.5实验结果及分析本文实验包括两部分:第一部分实验是三部图张量分解模型与三部图之间的预测效率比较;第二部分实验中,我们使用三部图张量分解方法对社会标签进行预测.实验所用数据集为Lastfm,Bibso-nomy和Movielens.考虑到性能比较的一致性,本文主要选择当前常用的张量分解推荐算法以及作为Benchmark的Folkrank进行比较,其张量分解方法包括Tucker[10]、ParaFac[10]、Pairwise[10]、Lower-2D(LOTD-2D)[12]算法.5.1数据集本文对3个数据集分别选择了稍大以及稍小数据集进行比较,数据集列在表2中,可以看到各个实验数据集的详细信息.每一个数据集可以看做一个大小为item×tag×user的张量.数据集itemtaguserLast.fmLast.fmMovielensMovielensBibsonomy160101Bibsonomy1601012040表2中Last.fm数据集来自Last.fm网站的网页数据,该网站为其用户提供个性化的多媒体服务,同时允许用户对多媒体文件添加标签,数据集转换为张量大小分别为100×157×280,100×157×560;Page6Movielens数据集来自Movielens网站,这是一个在线电影推荐系统,数据集张量分别为大小为98×200×246,98×200×592;Bibsonomy数据集下载自bibsonom-y.org网站,小数据集张量大小为160×101×204,大数据集张量大小为160×101×2040.5.2算法性能比较指标实验中采用传统的精度-召回率方法,依据前N个坐标值的曲线状态来衡量算法对标签的预测质量.在实验中,对于每个用户,随机屏蔽一标签列Post(i,k),该Post(i,k)数据作为缺失值,对每个屏蔽的标签列Post(i,k),我们将预测结果排序,Nj个值对应Nj个tags,实验中依次选取排序最靠前的N=1,2,…,10个值,并设定与这些选取值有关的标签的预测值为正值“positive”.精度和召回率按如下方法计算:图4TTD与三部图推荐效果比较从图4中可以看到三部图张量分解模型(TTD)的预测效果比三部图更好.这说明在同样的时间和空间消耗下,三部图张量分解模型能更准确的描述社会标签系统中的相互关系.5.4TTD标签预测算法性能比较在本节中,我们比较三部图张量分解算法和一些经典张量分解推荐算法的有效性,这些算法包括Folkrank、Tucker、ParaFac、Pairwise和Lowor-2D,同样,α=0.8,实验结果如图5(a)~(f)所示.图5(a)、(b)分别表示Last.fm在小数据集以及较大数据集上的实验结果;图5(c)、(d)表示Movielens在小数据集以及较大数据集上的实验结果;图5(e)、(f)表示Bibsonomy在小数据集以及较大数据集上的实验结果.实验结果表明:在Bibson-omy和Movielens数据集上,三部图张量分解算法具有更好的Precision-Recall曲线.在Last.fm数据集上,预测的前1~3标签有效性比Lowor-2D高,但是4~10中其它的数据比Lowor-2D低;与Precision(Ttest,N)=t∈Top(i,k,N)∩t∈Post(i,k)Recall(Ttest,N)=t∈Top(i,k,N)∩t∈Post(i,k)5.3张量分解三部图模型与三部图有效性比较本文在3个真实小数据集上对三部图张量分解模型(TTD)与三部图模型进行比较,实验以Folkrank[11]算法作为基准进行标签推荐,将三部图模型以及TTD模型作为Folkrank的矩阵输入,进行标签预测,并比较TTD与三部图预测结果,通过实验,α分别取值0.5,0.8,0.9以及1,其中以0.8的实验效果最好,因此本文实验结果均为α=0.8的结果.实验结果如图4.Folkrank相比,前1~7相对较高,而8~10较低;与其它传统算法相比则性能更好,其主要原因是用户、标签、资源三者分布关系对不同算法的影响所引起的,这部分内容在后续论文中进行论证及说明.在图5较大数据集和较小数据集的实验中,我们将Last.fm和Movielens较大数据集用户数扩大一倍,在Bibsonomy中我们将用户数据量增大一个数量级,从实验结果可以看到,较大数据集的预测精度不如小数据集预测精度,而Bibsonomy的大数据集预测精度衰减更大,其主要原因是由于用户数目增大,使得数据稀疏性增大,因此实验结果不如小数据量结果,如图5(b)、(d)、(f)所示.从结果来看,而传统的张量分解方法Truck和ParaFac方法,这两种算法的准确性比其他算法低,但是Folkrank总能达到较高的精度.在表3中,我们比较了每个算法的时间,结果表明三部图分解模型(TTD)获得了高效率,但相比Lower2D等算法具有更高的算法复杂性.Page7图5TTD算法在不同数据集上的性能比较6结论社会标签系统中的数据是非常稀疏的,并且存在缺失值.虽然三部图可以表示社会标签系统中的关系,但是处理社会标签系统中的稀疏和带缺失值的数据精确度不高,而张量分解是一种用低阶表示原始、稀疏数据的方法.Page8在本文中,我们提出基于三部图三维张量分解模型,获取社会标签系统中item,tag和user之间的潜在关系.在3个数据集上,我们以Folkrank为基准,比较了三部图和TTD模型的有效性,同时通过和当前流行的社会标签预测算法进行了比较,实验结果表明TTD模型在recall/precision精度上比其他算法的预测性能更好.
