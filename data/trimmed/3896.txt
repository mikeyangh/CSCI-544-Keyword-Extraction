Page1云计算环境中绿色服务级目标的分析、量化、建模及评价孙大为1),2)常桂然3)陈东1),4)王兴伟1)1)(东北大学信息科学与工程学院沈阳110819)2)(清华大学计算机科学与技术系北京100084)3)(东北大学计算中心沈阳110819)4)(麻省大学计算机科学系阿默斯特美国01002)摘要高能效性问题是开启绿云计算新纪元的主要障碍之一.特别是随着全球气候变化和对能量依赖程度的不断增加,绿色计算作为一种新的高端计算,受到了人们的广泛关注.为了实现云计算能耗的最小化,实现对绿色服务级目标的可量化和可管理,我们开展了关于云计算环境中绿色服务级目标的分析、量化、建模及评价的研究.在本文中,首先给出了绿云的定义.随后,通过借鉴服务级目标和绿色计算的相关理论,对实现绿色服务级目标的原理进行了系统的分析.之后,基于绿云的原理和方法,提出了一种多维能耗模型M2EC.理论和实验结果均表明M2EC模型在高能效方面具有明显优势,实现了云计算环境中能耗和服务级目标之间的均衡.关键词服务级目标;高能效;绿色云;绿色计算;云计算;大数据1引言云计算是以商业目标为主要源动力的大规模分布式计算范式,利用抽象化、虚拟化、透明化、自动化、即时部署、宽带网络等关键技术,通过网络实现资源间的互联、互通和互操作;以统一服务(XasaService,XaaS)的形式,利用多终端、多平台和多网络,在任意时间、任意地点,并以任意方式为用户提供包括软件、平台和基础设施在内的按需即用、随需应变、快速部署、瞬时释放、物美价廉、安全高效的非平凡SLOs(ServiceLevelObjectives)服务,其目标是为用户提供高效、灵活且价格低廉的服务;为满足急剧增长的硬件成本、存储能力、服务计算等因互联网的广泛应用所带来的各种新的需求,提供了高效的解决方案,受到政府、工业企业、科研机构、高等院校等的广泛关注[1-9].美国国家标准与技术研究院(NationalInstituteofStandardsandTechnology,NIST)给出了迄今为止最为全面的云计算定义[5]:“云计算是一种按需即用、随需应变、快速部署、瞬时释放、物美价廉的服务范式,通过网络可以实现对共享计算资源池(如计算、存储、网络、应用、服务)的可访问性、可定制性、可更改性、可付费性和可释放性.同时,在仅需最少的付费、最少的管理、最少的沟通的情况下,即可实现对服务的快速获取、资源的瞬时释放和信息的触手可及”.云计算具有3种交互模式、4种部署模式、5种公共特征[1-9].3种交互模式为基础设施即服务、平台即服务和软件即服务;4种部署模式为公有云、私有云、社区云和混合云;5种公共特征为按需付费、泛在接入、快速部署、资源透明和标准服务.在当前云计算的研究过程中,高性能、高可靠、高服务级目标受到了足够的重视,但高能效问题则通常被忽视.据不完全统计[10-13,19],各类数据中心当前年均电能消耗量占全球年均总电能消耗量的0.5%.按照当前数据中心规模和数量的发展速度,预计到2020年,数据中心年均电能消耗量将占全球年均总电能消耗量的1%.数据中心之所以消耗掉如此多的电力资源,主要有两个方面的原因:一方面是由于数据中心的规模和数量与日俱增;另一方面是由于数据中心资源的低效组织与无效管理,如设备大量冗余、制冷系统老化、建筑结构不合理等.因此,随着全球气候变化和对能量依赖程度的不断增加,需要实现云计算环境中能量的有效组织、全面监控、合理管理和高效使用,同时,实现云计算系统高性能和高服务级目标的统一.本文工作的灵感来自于以下事实:“绿色”已经被广泛用于描述事物具有环境友好性特征,如低碳、节能(高能效)、健康、经济、可持续等.绿色计算,即从设计、制造、运输、使用、维护、回收和再利用的整个生命周期过程中,以一种经济、高能效方式使用计算资源.其主要目的是维持三元底线(TripleBottomLine,3BL),即人群、地球和利润(People,PlanetandProfit,3P)间的利益均衡[13-14].绿色云计算,即绿云计算,就是实现云计算的可持续性发展,减少云系统对环境的可能影响.本质而言,云计算本身就是一种高效地实现绿色计算的方式,例如通过虚拟化技术,实现了对资源的有效整合,提高了资源的利用率;通过休眠技术,实现了对能量的有效节省.绿云计算的目标不仅仅要实现计算资源使用效率的极大提高,同时也要实现能量消耗的最小化[14-19].为了实现绿云计算,实现云计算的可持续性发展,需要确定云计算环境中整体能量消耗情况.更为重要的是,需要理解如何实现数据中心的能量消耗最小化,高效地实现能量和性能间的均衡,而这些问题恰恰是当前关于云计算能效的研究所缺失的[14-19].本文系统地分析、量化、建模和评价了大规模数据中心的能量消耗,为实现能量消耗的最小化,实现对高能效的量化、管理打下了基础,同时也满足了用户服务级目标.Page3(1)资源整合资源整合是实现数据中心能量节省的一个主要方法,通过对数据中心进行资源整合,可以实现多个不同应用程序共享一台高性能服务器.一方面,可以有效地提高服务器资源的利用率,节省硬件资源的成本,提高资源的使用效率,节省电力成本,并保持系统的负载均衡;另一方面,资源整合也可以为各个应用程序提供一个独立的运行环境,保持应用程序间的独立性和稳定性.随着硬件技术的不断发展,在当前大多数服务器运行模式中,为了保持各个应用的独立性和稳定性,一台服务器中往往仅仅运行一个应用程序.这样就导致了服务器长期处于较低的使用率,并且,随着服务器硬件性能的改善,服务器的使用效率反而更低.当前情况下,服务器全负荷工作时间仅占全部时间的10%~30%,台式机的平均使用效率往往低于5%[14,15,17-19].然而,通过虚拟化技术,利用虚拟机实现服务器资源的共享,实现服务器资源的整合,服务器的平均使用效率可以提高到80%以上,能极大地降低系统中能量的消耗.(2)在线迁移在线迁移虚拟机是指在不中断应用服务的情况下,将一个应用及运行该应用的虚拟机从当前运行服务器迁移到另一台服务器中,可以实现全局的负载均衡.或者在可预见的未来,在当前服务器要崩溃的情况下,将当前服务器中运行的应用及运行该应用的虚拟机迁移到其他服务器上,从而满足用户的服务级目标.(3)动态资源管理高能效的动态资源管理也是实现绿云计算的关键技术之一.如图1(a)所示,在静态的资源管理情况下,当App2需要申请新的资源时,即使App1已经释放了部分资源,但系统无法将该部分资源动态地分配给App2使用.因此,App2需要向系统申请其他可用资源,或等待App1运行结束后,才使用该部分释放的资源.然而,当同样的情况发生在动态资源管理环境中时,如图1(b)所示,App2可以动态地使用App1随时释放的资源,而不需要向系统申请新的资源,更不需要等到App1运行结束后才使用该部分资源.可见动态的资源管理,一方面提高了系统中资源的利用率;另一方面也改善了用户的服务级目标.(4)休眠机制在不影响到服务级目标的前提下,尽可能地将服务器从高能耗状态转换到低能耗状态,以达到降低系统能耗的目标.如图2所示,在该4种能耗状态下,从唤醒状态到关机状态的转换过程中,能量消耗依次减小,其中,在关机状态下,实现了单位时间内能量消耗的最小化.因此,在任何可能的情况下,在不影响到系统性能的前提下,可以将系统转换到该低能耗状态下,以达到降低系统能耗的目的.本文首先给出了绿云的定义,随后通过借鉴服务级目标和绿色计算的相关理论,对实现绿色服务级目标的原理进行了系统的分析.之后提出了一种多维能耗模型M2EC.本文的主要贡献包括:(1)从量化角度系统地定义了绿云计算、绿云体系结构和绿色服务级目标;(2)分析了云数据中心能量消耗和服务级目标之间的数学关系,得出了满足绿色服务级目标的约束条件;(3)量化了度量绿色云计算的多维指标,如能耗、碳排放、健康、经济、可持续性等指标,并得出了绿云度;(4)建模了基于FIFO和M2EC的虚拟机启发式调动算法,量化了虚拟机迁移成本,有效地管理了虚拟机的迁移,通过最小化绿云度,实现了云计算环境中的绿色服务级目标;(5)评价了在大规模云数据中心中基于M2EC虚拟机调动的绿色服务级目标,实现了云计算环境中能耗和服务级目标之间的均衡.Page4本文对云计算环境中的高能效性问题进行深入研究.第2节系统建模云计算环境中的高能效性,主要包括绿云计算的基本概念、绿云体系结构和绿色服务级目标;第3节量化多维性能指标和绿云度;第4节具体描述实现高能效性的主要策略,主要包括在线迁移成本量化、虚拟机迁移管理、FIFO和M2EC虚拟机调度算法的描述;第5节详细介绍实验环境、参数设置、实验结果和性能分析.实验分析表明M2EC虚拟机调度算法在绿云度优化、虚拟机负载均衡离差、虚拟机在线迁移率、任务成功执行率等方面具有明显优势;最后,第6节对本文进行归纳和总结.2问题建模绿云计算,即实现云计算的可持续性发展,减少云系统对环境的可能影响,实现开启未来计算新纪元的目标.其目的是不仅仅要实现计算资源使用效率的极大提高,同时也要实现对能量消耗的最小化[14,19-27].在本节中,从量化角度定义了绿云计算、绿云度、绿云服务等概念,详细地分析了绿云体系结构及绿云评价周期,并明确了云计算环境中的绿色服务级目标.2.1绿云计算绿云计算是一种环境友好型的云计算模式,为了进行定量的绿色分析,一个可量化的绿云计算的定义如定义1所示.定义1.绿云计算(greencloudcomputing).绿云计算是一个客观评价者(objectiveevaluator),如政府机构、绿色非营利组织、独立的第三方机构等,关于一个特定的云计算环境的可管理性、可评测性、可维护性等指标进行的层次性的客观评价,其主要目的是维持三元底线(即人群、地球和利润)间的利益均衡.也就是在设计、制造、运输、使用、维护、回收和再利用的整个生命周期中,通过多维性能指标,如低碳、高能效、健康、经济、可持续等,实现对云计算的量化.一般而言,绿云计算的绿色程度是通过绿云度(greenclouddegree)来反映的,并描述为绿云服务(greencloudservice).很明显,在定义1中,将绿云计算视为一个客观的、可量化的、可管理的度量,其中,“可管理性”、“可评测性”、“可维护性”、“客观评价”等关键词均是重点强调绿云计算的客观性、可量化性、可管理性等特征.其次,绿云计算的目标是实现对三元底线的全面负责,其中,“三元底线”重点强调绿云计算考虑到了人群、地球和利润,高效地均衡了高能效性和绿色服务级目标之间的关系.该理念最早是在社会科学中描述事物具有很好的环境友好性和可持续性.再次,绿云计算可以通过多维性能指标实现度量,其中,“多维性能指标”是强调绿云计算的度量指标往往不是某个性能指标,而是需要多个不同方面、不同角度、不同层次的性能指标的协调度量,才能真实、全面、客观地反映出绿云计算的特征.通常情况下,选择低碳、高能效、健康、经济、可持续等性能指标实现对绿云计算的度量.最后,绿云计算的评价考虑云数据中心生命周期的全部过程,其中,“整个生命周期过程”是强调绿云计算的评价需要考虑设计、制造、运输、使用、维护、回收和再利用整个生命周期的全部阶段,而不能简单地选择数据中心生命周期的某个或某些阶段进行绿云计算的评价.定义2.绿云度(greenclouddegree).绿云度是对云计算环境中绿色程度的一种量化表示,绿云度Gd取值于描述云计算环境绿云度的集合D,D∈[0,1].绿云度Gd可以定义为映射Gd:f(犡)D,其中,f是映射函数,犡是绿云计算的多维性能指标向量.具体而言,绿云度Gd可以描述如式(1)所示.Gd=f(犡)=犠犡,烄犠=(w0,w1,…,wn-1),∑n-1烅犡=(x0,x1,…,xn-1烆其中,犠=(w0,w1,…,wn-1)是多维性能指标的权重向量,当wi∈犠时,wi的取值范围在区间[0,1],且满足∑n-1指标向量,不失一般性,当xi∈犡时,设定xi是一个连续量,且取值范围在区间[0,1].因此,绿云度Gd也将是一个连续量,且取值范围为[0,1].在一个有五维性能指标的云计算环境中,当多维性能指标向量犡=(0.97,0.86,0.99,0.92,0.52)时,并且权重向量犠=(0.22,0.26,0.31,0.12,0.09),那么该云计算环境中的绿云度Gd=f(X)=犡犠T=0.9011.为了简化问题,在本文的研究过程中,仅仅选择云数据中心的5个基本的性能指标来实现对绿云计算的评测,该5个性能指标分别为系统能耗Esys、系Page5统碳排放量Csys、系统健康Hesys、系统经济Ecsys以及系统可持续性Susys.定义3.绿云服务(greencloudservice).绿云服务Gs是对绿云提供商所提供的服务等级的描述,该服务等级是由绿云度Gd所决定的.绿云服务Gs可以描述为一个模糊集,当L是一个包含n个绿云服务级的有序评价向量时,即L=(l0,l1,ln-1),并且满足0l0<l1<…<ln-11.li∈L,li的数值越大,相应的绿云服务等级水平则越高,那么绿云服务判定函数Γ实现了绿云度Gd到绿云服务Gs的映射,如式(2)所示.Gs=Γ(Gd)=其中,s0,s1,…,sn是n+1个有序绿云服务集,该绿云服务集的数目n可以根据具体的云计算环境需要进行确定.定函数Γ如下,例如:一个绿色非营利组织可定义绿云服务判Gs=Γ(Gd)=其中,绿云服务集s0,s1,s{}2={完全非绿色服务,绿色服务,完全绿色服务},而完全非绿色服务、绿色服务、完全绿色服务的具体规范可以根据具体环境进行确定.在一个云计算环境中,当其绿云度Gd=0.15时,Γ(Gd)=Γ(0.15)=s0,则意味着该云计算环境将会为其提供完全非绿色服务;当其绿云度Gd=0.55时,Γ(Gd)=Γ(0.55)=s1,则意味着该云计算环境将会为其提供绿色服务;当其绿云度Gd=0.95时,Γ(Gd)=Γ(0.95)=s2,则意味着该云计算环境将会为其提供完全绿色服务.2.2绿云体系结构绿云体系结构可以细分为4个空间,即硬件空间、绿色空间、虚拟空间和用户空间,如图3所示.在硬件空间中,n个数据中心分布于不同的地理位置,在每个数据中心中,有多个性能不同的物理服务器.通常情况下,每个服务器上可以运行一个或多个不同或相同配置的虚拟机系统.在绿色空间中,在VMM/hypervisor的统一配置和协调之下,6个绿色模块协调实现相应的绿色服务级目标.这6个绿色模块分别是低碳模块、高能效模块、健康模块、经济模块、可持续性模块和管理监控模块,并且分别用于计量碳排放量、能量消耗、辐射等级、投资收益率、可再利用率和进行模块间的管理与监控.在虚拟空间中,数据中心可以根据需要创建一个或多个不同配置的虚拟机,并且可以灵活地实现虚拟机的创建、挂起、迁移或终止等不同能耗状态的转变.作为用户和数据中心之间的接口,每台虚拟机可以在一个时间片内接受一个用户的服务请求,全部虚拟机可以同时并行工作,并且不同的虚拟机可以根据用户服务请求的需要,配置不同的操作系统、软件环境和用户软件,并设置不同的用户服务级目标.因此,可以高效地权衡绿色服务和服务级目标之间的关系.在用户空间中,一个或多个用户可以在任何时间,从任何地点,并以任何方式实现对绿云数据中心的服务请求和数据访问.对应于该绿云体系结构的绿云模型如定义4所述.定义4.绿云模型(greencloudmodel).绿云模型可以进一步地描述为一个五元组模型,即Gm=(U,DC,Gs,Of,Θ),其中,U=u0,u1,…,un{Page6由n个用户组成的用户集合,同时,每个用户的服务请求相互独立、互不干扰;DC={dc0,dc1,…,dcn-1}是由cn个数据中心组成的数据中心集合,其中,第i个数据中心dci={pmi0,pmi1,…,pmin-1},pmik(0k<dcni)是第i个数据中心dci中的第k台物理服务器;Gs是根据非营利绿色组织所定义的一个绿云服务等级;Of是为了优化绿云计算环境而定义的目标函数,其定义如式(3)所示,且通过以下5个性能指标实现对其进行量化,即系统能耗Esys、系统碳排放量Csys、系统健康Hesys、系统经济Ecsys以及系统可持续性Susys;Θ是实现相应优化策略的优化算法.Of=Of(Esys,Csys,Hesys,Ecsys,Susys)=max(Gdsys),烄s.t.Gdsys∈[0,1],min(Esys),Esys∈[0,1],min(Csys),Csys∈[0,1],烅max(Hesys),Hesys∈[0,1],max(Ecsys),Ecsys∈[0,1],max(Susys),Susys∈[0,1]烆对应于该绿云体系结构的绿云评测周期如定义5所述.定义5.绿云评测周期(greencloudevaluatecycle).一个完整的绿云评测周期可以细分为4个阶段,即分析阶段、量化阶段、建模阶段和评价阶段,如图4所示.周期性地通过该4个阶段工作,可以实现对绿云计算环境的合理评测,同时可以及时、动态地反馈最新的云计算环境信息.在分析阶段,实现了对数据中心中能量消耗和服务级目标之间的数学关系的分析,得出了满足绿色服务级目标所需要满足的基本条件.在量化阶段,实现了通过多维性能指标的量化以达到量化绿云计算的功能,同时通过多维性能指标,得出了数据中心的绿云度.在建模阶段,通过FIFO和M2EC虚拟机调度算法,实现了对绿云的建模,同时实现了对在线迁移成本的量化和虚拟化迁移的管理,满足了绿云度最小化的需求,并且也满足了绿色服务级目标的需求.最后,在评价阶段,实现了对大规模数据中心绿色服务级目标的评价,有效地权衡了绿云计算和服务级目标.2.3绿云服务级目标在用户和服务提供商之间,服务级目标(ServiceLevelObjectives,SLOs)是服务级协议的最核心内容(ServiceLevelAgreement,SLA),且服务级目标可以通过服务级协议的多个不同特征属性实现对其度量,如可用性、可测量性、可控性、可理解性、可支付性等[28-31].如图5所示,在绿色服务级目标中,不仅仅考虑到了服务级目标,同时也考虑到了绿云计算,实现了对三元底线间的利益均衡,可以通过在云计算环境的全部生命周期过程中的多维性能指标实现对其量化,如碳排放量、高能效、健康性、经济性、可持续性等.3绿云量化本节给出了对云计算环境中5个基本性能指标的量化,同时通过组合该5个基本性能指标,实现了对云计算环境中绿云度的量化.3.1多维性能指标量化在云计算环境中,多维性能量化指标主要选取以下5个基本的性能指标,即系统能耗Esys、系统碳排放量Csys、系统健康Hesys、系统经济Ecsys和系统可持续性Susys.3.1.1系统能耗在云计算环境中,第i个数据中心的第j个节点cnij的能耗Ecnij,可以通过节点cnij在时间段Page7[t0,tn-1]内的电能消耗量Pcnij(μ(t))计算得出,如式(4)所示.其中,第i个数据中心的第j个节点cnij在时间段[t0,tn-1]内的电能消耗量Pcnij(μ(t)),可以进一步细分为Pidlcnij(μij(t))和Pspdcnij(μij(t)),如式(5)所示.Pcnij(μij(t))=Pidlcnij(μij(t))+Pspdcnij(μij(t))(5)其中,Pidlcnij(μij(t))是第i个数据中心的第j个节点cnij的基本(idlestate)电能消耗;Pspdcnij(μij(t))是第i个数据中心的第j个节点cnij提供服务时所需要具备(spreadstate)的电量消耗,μij(t)∈[0,1]是第i个数据中心的第j个节点cnij的实时动态变化的负载因子,在当前数据中心的负载状况下,负载因子μij(t)的实际取值通常在区间[0.1,0.5]内.节点cnij的电能消耗量Pcnij(μij(t))是由CPU、内存、磁盘等设备的电能消耗量共同决定的[12,19,32,33].由于CPU是最主要的电能消耗设备,为了简化起见,节点cnij的电能消耗量Pcnij(μij(t))可以通过CPU的电能消耗量来计算,如式(6)所示.Pidlcnij(μij(t))=α·Pcnij(max),α∈[0,1]烄Pspdcnij(μij(t))=(1-α)·Pcnij(max)·μij(t),烅烆其中,Pcnij(max)是第i个数据中心的第j个节点cnij在全负荷状态下的最大电能消耗量,α∈[0,1]是Pidlcnij(μij(t))和Pspdcnij(μij(t))的调节参数,α的取值由计算机体系结构决定.Pidlcnij(μij(t))、Pspdcnij(μij(t))和Pcnij(μij(t))之间的关系[12,32-33],如图6所示,第i个数据中心的第j个节点cnij的能耗Ecnij由定理1给出.图6Pidlcnij(μij(t)),Pspdcnij(μij(t))和Pcnij(μij(t))之间的关系定理1.当时间区间[t0,tn-1]可以进一步细分为[t0,t1,…,tn-1]时,且[tk,tk+1],k∈[0,1,…,n-1],满足μij(t∈[tk,tk+1])≡μijk,其中,μijk是不随时间变化的常量,且μijk∈[0,1],那么,第i个数据中心的第j个节点cnij的能耗Ecnij如式(7)所示.Ecnij=(α·Pcnij(max))·(tn-1-t0)+((1-α)·Pcnij(max))·∑n-1证明.由于第i个数据中心的第j个节点cnij的电能消耗量Pcnij(μij(t))可以细分为Pidlcnij(μij(t))和Pspdcnij(μij(t))两部分,那么,Ecnij=∫tn-1=∫tn-1=∫tn-1=∫tn-1∫tn-1=(α·Pcnij(max))·(tn-1-t0)+∫tn-1当时间区间[t0,tn-1]可以进一步细分为n-1个时间区间[t0,t1,t2,…,tn-2,tn-1]时,且t∈[tk,tk+1],i∈[0,1,…,n-1],满足μij(t∈[tk,tk+1])≡μijk,其中,μijk是不随时间变化的常量,且μijk∈[0,1],那么,Ecnij=(α·Pcnij(max))·(tn-1-t0)+∫tn-1=(α·Pcnij(max))·(tn-1-t0)+∫t1∫t2∫tn-1=(α·Pcnij(max))·(tn-1-t0)+=(α·Pcnij(max))·(tn-1-t0)+=(α·Pcnij(max))·(tn-1-t0)+Page8((1-α)·Pcnij(max))·∑n-1如图7所示,随着参数α的不断增加,Pidlcnij(μij(t))也将不断增加,而Pspdcnij(μij(t))将不断减少,但节点cnij的总电能消耗量Pcnij(μij(t))最终将不断增加.同时,随着负载因子μij(t)的不断增加,节点cnij的总电能消耗量Pcnij(μij(t))最终也将不断增加.可见保持较低的Pidlcnij(μij(t)),可以有效地减少节点cnij的总电能消耗量Pcnij(μij(t)).图7Pcnij(μij(t))和Pidlcnij(μij(t))之间的关系定义6.系统能耗(systemenergyconsump-tion).系统能耗Esys是对云计算环境中每个节点单位时间内的能量消耗的一种度量,当一个云计算环境由m个数据中心组成,且节点数量向量犖狌犿=(num0,num1,…,numm-1),其中numi是第i个数据中心所拥有的节点数目,那么,整个系统在时间区间[t0,tn-1]内的能耗Esys如式(8)所示.由于第i个数据中心的第j个节点cnij的最大电能消耗量Pcnij(max)可以根据其体系结构来确定,那么,由式(7)可以得出i=0∑numi∑m-1((1-α)·Pcnij(max))·∑n-1Esys=.3.1.2系统碳排放量由于第i个数据中心的第j个节点cnij在时间段[t0,tn-1]内的碳排放量Ccnij可以使用相关仪器直接测量出来,那么,系统碳排放量Csys可由定义7给出.定义7.系统碳排放量(systemcarbonemis-sion).系统碳排放量Csys是对云计算环境中每个节点单位时间内的碳排放量的一种度量,当一个云计算环境由m个数据中心组成,且节点数量向量犖狌犿=(num0,num1,…,numm-1),其中numi是第i个数据中心所拥有的节点数目,那么,整个云系统在时间段[t0,tn-1]内的碳排放量Csys如式(9)所示.3.1.3系统健康由于第i个数据中心的第j个节点cnij在时间区间[t0,tn-1]内的实时辐射量Hecnij可以使用相关仪器直接测量出来,那么,系统健康Hesys可由定义8给出.定义8.系统健康(systemhealthful).系统健康Hesys是对云计算环境中每个节点单位时间内的辐射量的一种度量,当一个云计算环境由m个数据中心组成,且节点数量向量犖狌犿=(num0,num1,…,numm-1),其中numi是第i个数据中心所拥有的节点数目,那么,整个系统在时间段[t0,tn-1]内的系统健康Hesys如式(10)所示.3.1.4系统经济在云计算环境中,第i个数据中心的第j个节点cnij在时间段[t0,tn-1]内的经济效益Eccnij可由式(11)计算,那么,系统经济Ecsys由定义9给出.其中,Ccnij(tn-1,t0)是节点cnij在时间区间[t0,tn-1]内的直接总成本,Rcnij(tn-1,t0)是节点cnij在时间区间[t0,tn-1]内的直接总收益.为了简化起见,假设t0=tstart,tn-1→+,那么,Ccnij(t+,tstart)将是节点cnij购买时的总成本,Rcnij(t+,tstart)将是节点cnij在运行期间内所能实现的直接总收益.定义9.系统经济(systemeconomics),系统经济Ecsys是对云计算环境中每个节点单位时间内的经济效益的一种度量,当一个云计算环境由m个数据中心组成,且节点数量向量犖狌犿=(num0,num1,…,numm-1),其中numi是第i个数据中心Page9所拥有的节点数目,那么,整个系统在时间区间[t0,tn-1]内的系统经济Ecsys如式(12)所示.根据式(11)可以得出Ecsys=∑m-13.1.5系统可持续性在云计算环境中,第i个数据中心的第j个节点cnij在时间区间[t0,tn-1]内的可持续性Sucnij可由式(13)计算,那么,系统可持续性Susys可由定义10给出.其中,Ccnij(tn-1,t0)是节点cnij在时间段[t0,tn-1]内的直接总成本,Rccnij(tn-1,t0)是节点cnij在时间区间[t0,tn-1]内的可再利用时能获得的总收益.为了简化起见,假设t0=tstart,tn-1→+,那么,Ccnij(tn-1,t0)将是节点cnij购买时的总成本,Rccnij(tn-1,t0)将是节点cnij被废弃之后能被再利用时所带来的直接总收益.定义10.系统可持续性(systemsustainable).系统可持续性Susys是对云计算环境中每个节点单位时间内的可循环再利用收益的一种度量,当一个云计算环境由m个数据中心组成,且节点数量向量犖狌犿=(num0,num1,…,numm-1),其中numi是第i个数据中心所拥有的节点数目,那么,整个系统在时间区间[t0,tn-1]内的可持续性Susys如式(14)所示.根据式(13)可以得出Susys=∑m-13.2绿云度度量云计算环境的绿云度Gd可以通过以下5个基本性能指标计量得出,即系统能耗Esys、系统碳排放量Csys、系统健康Hesys、系统经济Ecsys以及系统可持续性Susys,也即五维性能指标向量犡=(E-1sys,C-1sys,Hesys,Ecsys,Susys).当每个性能指标均被测量n次时,五维性能指标向量犡就转换为矩阵犕n×5=(pij)n×5.在更为一般的情况下,假设有m个性能指标,那么,犕n×m=(pij)n×m,其中pij是第j个性能指标的第i次取值.一般而言,m维性能指标之间的度量单位是不统一的,为了消除不同度量指标之间度量单位的差异性,需要对矩阵犕n×m进行标准差标准化处理.另外,为了保证矩阵犕n×m中所有数据的取值均在区间[0,1]内,需要对标准差标准化后的矩阵犕n×m进行极差标准化处理[34].对矩阵犕n×m进行标准差标准化处理,如式(15)所示,i∈{0,1,…,n-1},j∈{0,1,…,m-1}(15)其中,p-·j=1标的均值,S·j的定义如式(16)所示,是矩阵犕n×m的第j个性能指标的标准差.那么,标准差标准化处理后的矩阵犕n×m=(pij)n×m.(pij-p-·j)槡2,i∈{0,1,…,n-1}S·j=1经过标准化处理后,可以保证矩阵犕n×m中每个性能指标的均值为0,方差为1,但是并不保证所有数据元素的取值范围在区间[0,1]内.为了保证矩阵犕n×m中所有数据的取值均在区间[0,1]内,需要对标准差标准化后的矩阵犕n×m通过式(17)进行极差标准化处理,极差标准化处理后的矩阵犕n×m=(pij)n×m.i∈{0,1,…,n-1},j∈{0,1,…,m-1}(17)其中,参数pminj=min(p0j,p1j,…,pn-1j),参数pmaxj=max(p0j,p1j,…,pn-1j).m维性能指标的权重向量犠=(w0,w1,…,wm-1),其中wi∈[0,1]是第j维性能指标的权重,且∑m-1wi=1.i=0那么,最终的绿云度可以通过矩阵犕n×m和权重向量犠相互结合计算得出,即犌犇=(Gd0,Page10Gd1,…,Gdn-1)可以通过式(18)计算得出,且Gdi∈犌犇,Gdi是在区间[0,1]内的连续量,系统最终的绿云度是这n次处理结果的均值.即Gdi=∑m-1其中,Gdi是系统中第i次的绿云度处理结果.4绿云优化在本节中,给出了对在线迁移成本的量化和虚拟机迁移的有效管理方法,同时通过FIFO虚拟机调度算法和M2EC启发式虚拟机调度算法实现对绿云度的最小化,并满足了对绿云计算环境中的绿色服务级目标.4.1在线迁移成本量化在线迁移虚拟机,是指在不中断应用服务的前提下,实现将虚拟机从一台服务器迁移到另一台服务器,满足全局的负载均衡;或者是在可预见的未来当前服务器可能要崩溃时,需要将当前服务器上的在线应用迁移到其他可正常提供服务的服务器上来,以满足用户的服务级目标[35-45].然而在在线迁移的过程中,也将会影响到当前迁移虚拟机中所正在运行的应用服务.一方面,由于在线迁移过程包括以下6个步骤:预迁移(pre-migration)、等待迁移(reservation)、预拷贝(iterativepre-copy)、拷贝(stop-and-copy)、迁移(commitment)和激活(activation),而这6步均需要消耗掉一定的时间,因此,势必将增加待迁移虚拟机中的在线服务的完成时间.另一方面,由于待迁移虚拟机中的服务可能因为缺少所需要的资源而被迫中止,因此在线迁移过程中也可能会影响到在线服务的服务质量.可见需要实现对在线迁移的时间成本和性能成本进行量化,实现相关成本的最小化,才能改善云计算环境中的绿云度Gd.虚拟机VMi在线迁移的时间成本tcVMi可以细分为3部分,如式(20)所示,即关机(shutdown)时间成本tcsd本tcmg时间成本与运行于虚拟机之上的应用服务无关,而只与虚拟机本身的特征有关.VMi以及启动(startup)时间成本tcsu其中,关机时间成本tcsd一种特定的虚拟机而言将是一个固定值,即为常量;迁移持续时间成本tcmg的文件大小SVMi以及当前系统可用带宽BVMi之间的关系如式(21)所示.虚拟机VMi在线迁移的性能成本pcVMi如式(22)所示[36-39].其中,θi是调节参数,通常取值0.1,t0是虚拟机VMi开始迁移的时间,tn是虚拟机VMi结束迁移的时间,且tn=t0-tcVMi,uVMi是虚拟机VMi的CPU利用率.定理2.设在当前时间片内共有m台虚拟机需要被在线迁移,并且将所有的调节参数θ0,θ1,…,θm均设置为θ.那么,系统全部的性能成本PcVMs如式(23)所示.证明.由于当前时间片内共有m台虚拟机需要被在线迁移,那么,根据式(22),PcVMs=∑m当将所有的调节参数均设置为θ后,即那么,PcVMs=∑m4.2虚拟机迁移管理迁移虚拟机的目标是为了满足一定的绿色服务级目标的要求,因此在迁移虚拟机时需要考虑以下两个情况:(1)如图8所示,当服务器pmi处于较低的负载状态时,若数据中心的其他服务器可以接受服务器pmi上的全部m台虚拟机,并且该m台虚拟机的迁移成本PcVMs小于服务器pmi运行该m台虚拟机的运行成本Rcpmi,如式(24)所示,那么,可以考虑迁移全部m台虚拟机.Rcpmi>τ·PcVMs,或者,烄烅Rcpmi>τ·θ·∑m烆Page11其中,τ是判别是否进行在线迁移的参数,可以根据需要动态设置.当τ=1时,即一旦m台虚拟机的迁移成本PcVMs小于服务器pmi运行该m台虚拟机的运行成本Rcpmi时,就立即迁移出全部m台虚拟机.迁移出全部m台虚拟机,并且关闭之前运行的服务器pmi,所能够节省的成本为Rcpmi-τ·PcVMs,因此,可以在一定程度上改善系统的绿云度.(2)当服务器pmi处于一个较高的负载状态Ldpmi,且已经不能够满足系统的服务级目标SLOsu的要求,如式(25)和图9所示,或者服务器pmi在未来一个可以预测的时间内即将崩溃,在这种情况下也需要迁移出服务器pmi上部分或全部m台虚拟机.其中,ε是判别是否进行在线迁移的参数,可以根据实际系统的需要进行设置,Ldsys是整个数据中心各台服务器负载均值,σ是整个数据中心各台服务器负载标准差,SLOspm是服务器pmi在当前负载状态Ldpmi下所可能提供的服务级目标.通过在线迁移服务器pmi上的部分或全部m台虚拟机,可以显著地改善服务器pmi上的服务级目标.然而,需要迁移的虚拟机的具体数目,则需要权衡绿云度和服务级目标之间的关系.在满足一定的服务级目标的情况下,尽可能少地迁移虚拟机将是一个较优的选择,因为每多迁移一台虚拟机,势必将多增加一个单位的性能成本pcVMi.4.3FIFO虚拟机调度算法先来先服务虚拟机调度算法(FisrtIn,FirstOut,FIFO)是一种简单的根据服务请求的到达时间来为该服务分配虚拟机的算法,也是一种最原始、最简单、最基本的虚拟机调度算法[36-39].如图10所示,FIFO虚拟机调度算法只是简单地从用户请求队列QUserss的最早到达的服务请求,即队头中,取出一个应用App0,然后将App0运行于虚拟机队列QVms的队头虚拟机VM0中.由于FIFO虚拟机调度算法没有考虑到任何的优化机制,对应用和虚拟机的选择,仅仅是根据应用和虚拟机到达队列的时间来确定的.因此,使用FIFO虚拟机调度算法时的系统绿云度GdFIFO可以作为系统的基本绿云度,FIFO虚拟机调度算法可以描述为如算法1所示.算法1.FIFO调度算法.输入:userqueueQUserss,virtualmachinequeueQVms,输出:greenclouddegreeGdFIFO1.IfuserqueueQUserssisemptyatcurrenttimeslicets02.Waitatimeslice.3.Endif4.WhileuserqueueQUserssisnotemptyatcurrenttime5.FetchthefirstapplicationApp0inuserqueue6.IfvirtualmachinequeueQVmsisemptythen7.MonitorthevirtualmachinequeueQVmsuntil8.Endif9.FetchthefirstvirtualmachineVM0invirtual10.RunthefetchedApp0onthefetchedVM0.11.AllocatetheVM0toaPhysicalmachinePMofPage1212.Endwhile13.CalculateenergyconsumptionEsys,systemcarbon14.CalculategreenclouddegreeGdFIFOby(18).15.ReturnGdFIFO.FIFO虚拟机调度算法的输入分别是用户队列QUserss、虚拟机队列QVms、服务器队列QPms、五维性能向量犡=(E-1sys,C-1sys,Hesys,Ecsys,Susys)和权重向量犠=(wE,wC,wHe,wEc,wSu),FIFO虚拟机调度算法的输出是绿云度GdFIFO.在FIFO虚拟机调度算法中,从步4到步12,实现了从用户队列QUserss中取出相应的队头的用户服务请求,并分配到虚拟机队列QVms中的队头的虚拟机上;步13分别计算系统能耗Esys、系统碳排放量Csys、系统健康Hesys、系统经济Ecsys以及系统可持续Susys;步14计算该云计算环境的绿色度GdFIFO.FIFO虚拟机调度算法的时间复杂度为O(1).4.4M2EC虚拟机调度算法多维能耗虚拟机调度算法(Multi-MetricEnergyConsumptionvirtualmachinesschedulingalgorithm,M2EC)是基于首次适合下降算法(FirstFitDecrea-singalgorithm,FFD)的思想,再次改进和开发出来的.由于FFD算法具有很好的理论基础,在实践中得到了广泛应用.但FFD算法具有负载不均衡性特征,因此重点是对该不足进行必要的调整和完善[27,35-36,41-48].M2ME虚拟机调度算法如算法2所示.算法2.M2EC调度算法.输入:userqueueQUserss,virtualmachinequeueQVms,输出:greenclouddegreeGdM2EC1.IfuserqueueQUserssisemptyatcurrenttimeslice2.Waitatimeslice.3.Endif4.IfvirtualmachinequeueQVmsisemptyatcurrent5.Waitatimeslice.6.Endif7.WhileuserqueueQUserssisnotemptyatcurrent8.FetchanapplicationAppinuserqueueQUserssand9.RunthefetchedApponthefetchedVM.10.Endwhile11.SortthevirtualmachinesinthequeueQVmsbyper-12.SortthephysicalmachinesinthequeueQPmsbythe13.ForeachvirtualmachineinqueueQVmsdo14.Foreachphysicalmachineinqueuedo15.Iftheremainingavailableresourcesaremore16.AllocatetheVMtoaPhysicalmachinePM.17.Updatetheremainingavailableresourcesof18.Endif19.Break.20.Endfor21.Endfor22.CalculatetheenergyconsumptionEsys,systemcar-23.CalculatethegreenclouddegreeGdM2ECby(18).24.ReturnGdM2EC.M2EC虚拟机调度算法的输入分别是用户队列QUserss、虚拟机队列QVms、服务器队列QPms、五维性能向量犡=(E-1sys,C-1sys,Hesys,Ecsys,Susys)和权重向量犠=(wE,wC,wHe,wEc,wSu),M2EC虚拟机调度算法的输出是绿云度GdM2EC.在M2EC虚拟机调度算法中,从步7到步10,实现了接收用户的服务请求,并分配到虚拟机上;步11对虚拟机队列QVms按性能降序排列;步12对服务器队列QPms按性能降序排列;从步13到步21,使用FFD算法的基本思想,为虚拟机选择并分配一个最合适的服务器;步22分别计算系统能耗Esys、系统碳排放量Csys、系统健康Hesys、系统经济Ecsys以及系统可持续Susys;步23计算绿色度GdM2EC.M2EC虚拟机调度算法的时间复杂度为O(nlogn).5实验与性能分析为了分析所提出的M2EC虚拟机调度算法的性能,本节介绍实验过程中的详细的模拟环境和相关参数的设置,然后给出了实验性能的对比测试和分析结果.其中,测试和分析的性能指标为绿云度Gd、虚拟机负载均衡离差σ、虚拟机在线迁移率ldr和任务成功执行率ser.Page135.1实验环境与参数设置我们选择CloudSimToolkit[49-51]作为实验模拟平台,该模拟平台基于Java开发,可以有效地进行大规模云计算数据中心的模拟和建模.其中,云计算环境中的用户和资源的特殊需求可以通过重写相应的接口得以实现,该特性可以有效地构建云计算环境中不同用户和资源的需要.此外,CloudSimTool-kit是在GridSimToolkit的基础上开发和发展起来的,而GridSimToolkit可以有效地支持建模和构建多网格接口的高级别软件构建.而GridSimToolkit是基于SimJavaToolkit开发的,SimJavaToolkit可以为高层次的模拟架构提供分散事件模拟引擎,并且可以有效地通过多线程模拟不同实体,该特性可以有效地满足云计算环境中相应实体的随机特性.因此,选择CloudSimToolkit作为实验的模拟平台,可以较好地测试本文提出的M2EC虚拟机调度算法的相关性能,并且可以较好地反映实际云计算环境的相关情况.在实验过程中,共创建了10个云数据中心,每个云数据中心的详细参数配置如表1所示.同时,设置了500台虚拟机来提供云服务,每台虚拟机的PE(ProcessingElements)数目在区间[2,4]内.数据中心ID机器数每台机器的PE数处理能力(MIPS)带宽/GbpsDC_0~1102~4200~4001.0DC_2~3202~4400~6002.0DC_4~5304~8600~8005.0DC_6~7408~16800~10005.0DC_8~95012~16800~100010.0此外,在实验过程中,提交了1000个任务到500台虚拟机上,每个任务的提交时间服从泊松分布,每个任务的计算长度在区间[10000,20000]MI内.实验过程测试了5个基本性能指标,即系统能耗Esys、系统碳排放量Csys、系统健康Hesys、系统经济Ecsys以及系统可持续Susys.实验的详细参数配置如表2所示.w0,w1,w2,参数αw3,w4θτε5.2实验结果与性能分析对实验过程中测试和分析的4个主要相关指标,分别说明如下.(1)绿云度Gd,即云计算系统中绿色程度的一种度量.绿云度Gd可以通过系统能耗Esys、系统碳排放量Csys、系统健康Hesys、系统经济Ecsys以及系统可持续Susys5个基本性能指标综合计算得出.一个云系统的绿云度Gd越大,反映该系统能耗Esys和系统碳排放量Csys越小,系统健康Hesys、系统经济Ecsys以及系统可持续Susys则越大,那么,就可以在更大的程度上满足用户的绿色服务级目标,如式(18)所示.如图11所示,随着任务负载比例的不断增加,M2EC虚拟机调度算法可以保证系统的绿云度Gd处于较高的水平,即使是在系统中任务的负载比例高达90%以上时,仍然可以保证系统的绿云度Gd高达0.72.与FIFO虚拟机调度算法相比较,M2EC虚拟机调度算法可以明显改善整个系统的绿云度Gd,极大地改进了整个系统的绿色服务级目标,能很好地满足用户的需求.(2)虚拟机负载均衡离差σ,反映了随着用户请求服务的不断变化,在在线迁移后的整个系统中的虚拟机的负载均衡情况.虚拟机负载均衡离差σ越小,表明整个系统中虚拟机在各台服务器间的负载越均衡,越能较好地满足绿色服务级目标,如式(26)所示.其中,ldi如式(27)所示,其中,num(VMs)i是第i台服务器所拥有的虚拟机数目,num(PEs)i是第i台服务器所拥有的处理单元PE数目.Page14如图12所示,随着任务负载比例的不断增加,M2EC虚拟机调度算法可以保证负载均衡离差处于一个相对较低的水平.即使是在系统中任务的负载比例高达90%以上时,仍然可以保证系统的虚拟机负载均衡离差σ位于0.349这一相对较低的水平之下.与FIFO虚拟机调度算法相比,M2EC虚拟机调度算法可以明显改善虚拟机负载均衡离差σ,满足了用户的绿色服务级目标.(3)通过在线迁移虚拟机,实现虚拟机在整个系统中各台服务器间的负载均衡,将可以极大地改善用户的绿色服务级目标.虚拟机在线迁移率ldr反映了整个系统中虚拟机在线迁移的比值,ldr越小,相应的虚拟机迁移成本则越小,必将进一步改善整个系统的绿色度Gd.具体而言,虚拟机在线迁移率ldr如式(28)所示.ldr=1其中,n是在整个系统服务过程中所创建的虚拟机数目.如图13所示,随着任务负载比例的不断增加,M2EC虚拟机调度算法可以保证系统的虚拟机在线迁移率ldr处于较低的水平.即使是在系统中任务的负载比例高达90%以上时,仍然可以保证ldr位于0.21这一相对较低的水平.与FIFO虚拟机调度算法相比,M2EC虚拟机调度算法在付出较小的成本的情况下,将极大地改进了整个系统的绿色服务级目标.特别是在系统的负载比例较高的情况下,这种优势将更加明显.(4)任务的成功执行是指一个任务在所需要的最短结束时间之前被成功完成,任务成功执行率ser是指在最短结束时间之前成功完成的任务和系统中用户请求服务的全部任务之间的比值.在一个云计算环境中,任务成功执行率ser越高,用户的绿色服务级目标将越容易满足.具体而言,任务成功执行率ser如式(29)所示.其中,mj是用户j所请求服务的任务总数.如图14所示,在没有部署M2EC虚拟机调度算法的情况下,随着任务负载比例的不断增加,整个系统的任务成功执行率ser急剧下降,特别是当系统的任务负载比例高于50%的情况下,这种趋势则更加明显.当系统部署了M2EC虚拟机调度算法后,M2EC虚拟机调度算法可以保证系统的任务成功执行率ser处于一个相对较高的、较稳定的水平,即使是在系统中任务的负载比例高达90%以上时,仍然可以保证系统的任务成功执行率ser位于0.951这一相对较高的水平.可见M2EC虚拟机调度算法可以在很大程度上改善整个系统的任务成功执行率ser,满足用户的绿色服务级目标.Page156总结本文对云计算环境中的高能效性问题进行了深入研究.给出了云计算环境中的高能效性概念模型,主要包括绿云计算的基本概念、绿云体系结构和绿色服务级目标.为定量评估绿色服务的等级,给出了量化的多维性能指标和绿云度.具体描述了实现高能效性的绿云优化策略,主要包括在线迁移成本量化、虚拟机迁移管理、FIFO虚拟机调度算法和M2EC虚拟机调度算法.通过实验分析表明,M2EC虚拟机调度算法在绿云度优化、虚拟机负载均衡离差、虚拟机在线迁移率、任务成功执行率等方面具有明显优势.在将来的研究工作中,我们将进一步深化绿云度量、量化指标、优化策略等内容的研究.同时,结合具体的云计算环境,在大规模云数据中心进行部署和实践.
