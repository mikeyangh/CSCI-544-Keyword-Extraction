Page1不确定图上的高效top-犽近邻查询处理算法张海杰姜守旭邹兆年(哈尔滨工业大学计算机科学与技术学院哈尔滨150001)摘要图的不确定性普遍存在,研究不确定图的高效查询处理具有重要意义.文中提出了不确定图上一种新型查询———近邻查询.给定一个查询标签集R和距离约束σ,在不确定图G上进行近邻查询是要找到标签集包含R并且任意两个顶点间距离不超过σ的匹配顶点集.为解决该问题,文中首先提出了“可靠期望距离”,然后基于可靠期望距离建立了高效的近邻关系图索引,将不确定图上的近邻查询等价地转化为近邻关系图上的团查询问题,最后使用树搜索算法解决近邻关系图上的团查询问题.理论分析和实验结果表明文中提出的算法能够高效地完成不确定图上的top-k近邻查询.关键词不确定图;近邻查询;可靠期望距离;近邻关系图1引言近年来,现实世界中出现大量以图建模的数据,Page2络被表示成一个无向图,其中顶点代表蛋白质,边代表蛋白质之间的交互.由于蛋白质交互检测实验技术自身存在固有误差,实验测得的蛋白质交互网络存在不确定性[1].在移动自组织网络中,网络的拓扑结构被抽象成一个有向图,顶点代表通信节点,边代表节点之间的无线通信链路.由于节点的移动性,节点之间的无线通信链路是否正常工作是不确定的,因此移动自组织网络拓扑结构也存在不确定性[2].同样,在社交网络研究中,经常用图模型刻画用户之间的数据流通,但是匿名通信数据的干扰也会使社交网络带有不确定性[3].传统图论中的图模型无法刻画图数据的不确定性.为此,我们拓展了不确定数据管理中常用的“可能世界”语义,提出了不确定图的“可能世界”语义模型[4].在该模型中,不确定图的每条边上带有一个(0,1]内的实数,表示该边实际存在的概率.该模型假定边的存在概率之间相互独立.依据边的存在概率对边进行独立随机选取,可以得到该不确定图的一种可能的确定图存在形式(即“可能世界”),称作“蕴含子图”.理论证明,一个不确定图表达了其全部蕴含子图上的一个概率分布.由于不确定图广泛存在且规模不断增加,因此对不确定图进行高效的查询处理具有非常重要的意义.现有的不确定图查询处理方面的研究几乎全部基于文献[4]中提出的不确定图语义模型,然而这方面研究结果目前还很少,仅限于概率k-近邻查询[5]、概率最短路径查询[6]、概率子图匹配查询[7].本文研究不确定图上一种新型查询“近邻查询(proximityquery)”,其定义如下:给定一个不确定图G,G的每个顶点v上带有一个标签集合L(v);同时,还给定一种G中顶点之间的概率距离度量函数d.不确定图G上的近邻查询是一个二元组Q=〈R,σ〉,其中R是一个顶点标签集合,σ0.Q的查询结果是G中的“匹配顶点子集”构成的集族F,其中每个匹配顶点子集W∈F满足如下3个条件:(1)R∪v∈WL(v);(2)W的任意真子集均不满足条件1;(3)W中任意两个顶点u和v在G中概率距离d(u,v)的最大值(记作diam(W))不大于σ.特别地,本文研究不确定图上的top-k近邻查询,即查询结果是近邻查询结果中前k(k>0)个具有最小diam(W)值的顶点子集W.不确定图上的top-k近邻查询具有许多重要应用.例如,在生物信息学中,生物学家经常需要了解在蛋白质交互网络中具有某些功能的蛋白质在不同功能团中是如何连接的.我们已经知道蛋白质交互网络是一个不确定图(在该不确定图中,顶点标签代表蛋白质具有的功能),并且在该网络中,具有某些功能的蛋白质在不同功能团中的连结方式往往是不同的.如图1所示,具有a,b,c3种功能的蛋白质频繁地同时出现在不同的功能团中,然而其具体连接方式并不相同,如图1中虚线所示.在这种情况下,生物学家若想了解具有功能a,b,c的蛋白质之间是否存在紧密关联,传统子图匹配查询[8-9]显然是做不到的,因为生物学家必须先知道具有功能a,b,c的蛋白质之间的连接方式才能形式化给出子图匹配查询;而不确定图近邻查询并不要求知道具有功能a,b,c的蛋白质之间的具体连接方式,只需给出蛋白质之间的概率距离约束条件,因此更适用于生物学家的需求.在社交网络分析中,Lappas等人[10]提出了社交网络中的团队构建问题.在该问题中,社交网络以确定图建模,图的顶点代表候选专家,顶点标签代表专家所掌握的领域知识,边代表专家之间的朋友关系,边上的权值代表专家之间的沟通代价(或熟悉程度).给定一个社交网络关系图G和一个任务需求R,团队构建问题是要组建一个专家团队,使得团队中的专家所掌握的领域知识能满足任务要求R,并且专家之间的沟通代价最小.由于社交网络中存在匿名通信数据,专家之间的朋友关系可能是不确定的,因此该社交网络需要用不确定图建模.在带有不确定性的社交网络上解决团队构建问题就需要应用不确定图近邻查询处理算法.据我们所知,不确定图上的top-k近邻查询处理尚未被研究过,并且确定图上的相关研究结果也无法处理不确定图近邻查询.在文献[10]提出的解决团队构建问题的算法中,顶点间的距离采用加权最短路径长度;而在不确定图中,两个顶点在不同的蕴含子图中的加权最短路径长度不尽相同.另外,这些算法只返回代价最小的结果;而top-k近邻查询要求找到直径最小的k个结果.另外,不确定图上的子图匹配查询算法无法处Page3理近邻查询问题,因为子图匹配查询是基于结构的查询,需要事先知道匹配顶点子集的具体结构,而近邻查询不限制匹配顶点子集的结构,其查询结果具有结构多样性.们提出了如下挑战问题:综合上述分析,不确定图top-k近邻查询向我(1)不确定图上的近邻查询基于不确定图顶点之间的概率距离度量函数,对该函数既要考虑不确定图的结构也考虑不确定图的不确定性.由文献[4],由于一个不确定图有多种可能的存在形式(即蕴含子图),相同的两个顶点在不同的蕴含子图中的距离可能不同,所以如何度量不确定图顶点间的距离是一项挑战;(2)与传统的子图匹配查询不同,近邻查询的查询结果具有结构多样性.目前图数据上的查询多数是基于结构的查询,并且不确定图本身的结构存在不确定性,因此,如何设计高效的近邻查询处理算法来解决这种结构多样性查询也是一项挑战.为解决上述问题,本文提出了不确定图上的可靠期望距离度量函数,并基于可靠期望距离定义了近邻关系图.本文证明了在不确定图上进行近邻查询等价于在对应的近邻关系图上进行团查询.本文的主要贡献如下:(1)提出不确定图顶点间的可靠期望距离度量;基于不确定图数据模型和可靠期望距离,首次提出不确定图的top-k近邻查询问题,并形式化地定义了该问题;(2)基于可靠期望距离定义σ-近邻关系图并设计高效的σ-近邻关系图索引结构及其快速构建算法.(3)提出了一种高效的基于搜索树的算法来完成近邻查询处理,其中利用一种两阶段预处理方法来降低搜索时间复杂度,并利用分支界限方法高效地计算top-k结果.2相关工作子图匹配查询[8-9]是图查询领域的研究热点.给定一个标签图G,一个连通的包含n个顶点的查询图Q,子图匹配查询是从G中找到n个顶点,这n个顶点构成的子图同构于查询图Q.显然,子图匹配查询是一种基于结构的查询.模式匹配查询[11-12]是图查询领域另一种重要查询.给定一个标签图G,一个连通的包含n个顶点的查询图Q以及距离约束σ,模式匹配查询是从G中找到n个顶点,这n个顶点与Q的n个顶点一一对应,并且对应顶点的标签相同,对于Q中相邻的两个顶点,其对应顶点在G中距离不大于σ.在本文提到的近邻查询中,查询Q包括顶点标签集R和距离约束σ.查询结果是图G的顶点子集,这个顶点子集的标签集包含R,并且其任意两个顶点间的距离不超过σ.因此,近邻查询是一种基于距离的查询.子图匹配查询和近邻查询是两种类型的查询,利用子图匹配查询算法不能解决近邻查询问题.近邻查询是一种特殊情况下的模式匹配查询.当模式匹配查询的查询Q是一个团时,该模式匹配查询就等价于以Q的顶点标签集作为输入的近邻查询.因此,可以使用模式匹配查询算法来解决近邻查询问题.但是据我们所知,目前尚没有不确定图上的模式匹配查询方面的工作,而且确定图上的相关算法也无法直接应用到不确定图上,因此有必要提出高效的不确定图上近邻查询处理算法.3问题定义3.1不确定图本文沿用文献[4]提出的不确定图语义模型.为使本文内容完整,这里再次给出不确定图的相关定义.定义1(不确定图).不确定图是一个五元组G=((V,E),Σ,L,P),其中(V,E)是一个无向图,Σ是一个标签集合,L:V→2Σ是一个为顶点分配标签子集的函数.P:E→(0,1]是一个为边分配存在概率值的函数,P((u,v))表示顶点u和顶点v之间的边存在概率.特别地,P((u,v))=1表示边(u,v)一定存在.一个不确定图G具有多种可能的存在形式,每个存在形式被称为G的一个蕴含子图.形式化地说,一个确定图G=((V,E),Σ,L)是G=((V,E),Σ,L,P)的一个蕴含子图当且仅当V=V,EE,Σ=Σ,L=L.不确定图G的所有蕴含子图构成的集合记为Imp(G).本文假设不确定图中边的存在概率相互独立,因此蕴含子图G被不确定图G蕴涵的概率为P(GG)=∏e∈E(G)P(e)∏e∈E(G)\E(G)文献[4]证明了G的全部蕴含子图被G蕴涵的概率和为1,即∑G∈Imp(G)Pr(GG)=1.Page4图2(a)是一个不确定图G,图2(b)是G的蕴含子图集Imp(G).根据式(1)可以计算出G的每个蕴图2不确定图G、Imp(G)以及顶点v1,v2间距离的概率分布pv1,v23.2不确定图顶点距离度量函数在确定图中,两个顶点间的距离用这两个顶点之间的最短路径长度表示.然而,在不确定图中,两个顶点在不同蕴含子图中的最短路径长度不尽相同.因此,在定义不确定图上近邻查询之前,需要先定义不确定图顶点距离度量函数.本文基于文献[5]提出的不确定图顶点间的众数距离和期望可达距离,提出一种新的不确定图顶点距离度量函数———可靠期望距离.于d的概率为给定一个不确定图G,G中顶点u和v距离等其中,dG(u,v)表示蕴含子图G中,顶点u,v之间的最短路径长度.图2(c)表示图2(a)中G的顶点v1和v2之间距离的概率分布.由此,文献[4]定义了如下两种距离度量函数:(1)众数距离.不确定图G中任意两个顶点u和v间的众数距离为dJ(u,v)=argmaxd{pu,v(d)},即u与v之间概率最大的距离值.(2)期望可达距离.不确定图G中任意两个顶点u和v之间的期望可达距离为含子图被G蕴含的概率.例如,G7被G蕴含的概率为0.9×0.7×(1-0.4)=0.378.即u与v之间距离的期望值(需要注意的是,在计算期望可达距离时,不考虑u与v之间距离为无穷的情况).然而,上述2种距离度量都有其局限性:(1)当顶点u和v在不确定图G中的距离分布较平均时,众数距离度量不具有一般性.例如,在顶点u,v之间距离的概率分布中,pu,v(1)=pu,v(2)=0.33,pu,v()=0.34,此时u和v之间的众数距离为.而实际上u和v之间的距离为无穷的概率只有0.34,为有穷的概率为0.66;(2)为保证期望可达距离有穷,计算时将d=的部分排除.所以,只要pu,v()≠1,u和v之间的距离就始终有穷.例如,在顶点u,v之间距离的概率分布中,pu,v(1)=0.05,pu,v()=0.95,此时u,v之间的期望可达距离为1.而实际上两个顶点之间距离有穷的概率仅为0.05,距离为无穷的概率是0.95.本文对上述2种不确定图顶点距离度量函数的不足进行修正,提出可靠期望距离度量函数.其定义如下:不确定图G中任意两个顶点u和v之间的可靠期望距离为dRE(u,v)=dER(u,v),若pu,v()<0.5其含义是:当pu,v()<0.5时,期望可达距离Page5是一种非常可靠的距离度量,于是采用期望可达距离来度量顶点间距离;当pu,v()0.5时,期望可达距离变得不可靠,由于此时在所有可能距离值中概率最大,根据众数距离定义,u,v之间的距离为.3.3近邻查询定义2(顶点集直径).给定一个不确定图G=((V,E),Σ,L,P)和G的一个顶点子集WV,W在G中的直径为diam(W)=argmaxu,v∈W{dRE(u,v)}.由此,我们给出不确定图近邻查询的形式化定义.定义3(不确定图上的近邻查询).给定一个不确定图G=((V,E),Σ,L,P),G上的近邻查询是一个二元组Q=〈R,σ〉,其中RΣ,σ为非负整数.Q的每个查询结果是G的一个顶点子集WV,W满足如下性质:(1)标签集覆盖性.R∪v∈WL(v);(2)极小性.W的任意真子集都不满足性质1;(3)紧密性.diam(W)σ.本文将Q的每个查询结果称作Q的匹配顶点子集.对于用户给定的近邻查询,满足条件的匹配顶点子集的数量可能非常大.在这种情况下,选择直径最小的前k个匹配顶点子集便可满足应用需要.由此,不确定图上的top-k近邻查询问题的定义如下:输入:不确定图G=((V,E),Σ,L,P),查询Q=〈R,σ,k〉,其中RΣ,σ为非负整数,k为正整数.输出:G中直径最小的k个匹配顶点子集.若满足条件的匹配顶点子集的数量少于k个,则将其全部输出.4近邻查询处理本节提出了一种高效处理不确定图上top-k近邻查询的算法.给定一个不确定图G=((V,E),Σ,L,P)和一个top-k近邻查询Q=〈R,σ,k〉,算法包括以下4个步骤:1.计算G中任意两个顶点u和v之间的可靠期望距离dRE(u,v).根据可靠期望距离定义可知,为计算dRE(u,v),需先计算u和v之间距离的概率分布.解决该问题的精确方法是穷举G的所有蕴含子图,然后在每个蕴含子图上计算u和v之间最短路径长度的概率分布.然而,G的全部蕴含子图的数量为2|E|,其中|E|是G的边数,穷举方法效率显然非常低.本文使用采样方法来近似计算u和v之间最短路径长度的概率分布,在保证计算结果精度的前提下显著提高计算效率.具体方法见4.2.1节.2.根据顶点间可靠期望距离以及距离约束σ,构建σ-近邻关系图Gσ.Gσ是一个确定图,其构建方法如下:Gσ的顶点集和G的顶点集相同,并且对于G中任意两个顶点u和v,若dRE(u,v)σ,则在Gσ中存在一条连接u和v的边.本文4.1节将给出近邻关系图的形式化定义.后文将证明G中任意顶点子集W的直径小于等于σ当且仅当W在Gσ是一个团.3.根据查询Q给出的标签集R对Gσ进行预处理.通过分析可知,Gσ中可能出现在结果中的顶点v具有如下性质:3.1.v的标签集L(v)与R的交集不为空.3.2.Gσ中与v相邻的全部顶点的标签集与L(v)的并集一定包含R.利用这两条性质,对Gσ中的顶点和边进行迭代删除,直至将不可能出现在任何查询结果中的顶点及其相连的边全部删除.记预处理后得到的图为Gσ.4.根据查询标签集R,在Gσ上找出k个团,使得每个团中所有顶点标签集的并集包含R,并且这些团在G中的直径最小.这k个团就是不确定图G近邻查询Q的结果集.本文采用树搜索策略来解决带标签覆盖的团查询问题,并运用分支界限方法计算直径最小的top-k结果.对于两个查询Q1=〈R1,σ1,k1〉和Q2=〈R2,σ2,k2〉,上述算法对G中任意两个顶点计算得到相同的可靠期望距离;并且,若σ1=σ2,则上述算法为Q1和Q2计算得到相同的σ-近邻关系图.因此,为避免重复计算,对每个可能的距离σ构造σ-近邻关系图Gσ,并建立近邻关系图索引.对于任意查询Q=〈R,σ,k〉,算法可以直接在Gσ执行查询处理.本节余下内容将介绍索引结构、索引构造算法以及查询处理算法.4.1索引结构定义4(σ-近邻关系图).给定不确定图G=((V,E),Σ,L,P)和非负整数σ,G的σ-近邻关系图Gσ=((Vσ,Eσ),Σσ,Lσ,Wσ)是一个确定加权图,其中Vσ=V,Σσ=Σ,Lσ=L,Eσ={(u,v)|u,v∈Vσ且在G中dRE(u,v)σ},Wσ是为Eσ中的边分配权值的函数,对于任意(u,v)∈Eσ,Wσ(u,v)=dRE(u,v).σ-近邻关系图是不确定图top-k近邻查询处理算法使用的重要数据结构.我们对σ-近邻关系图有以下3个重要观察:(1)对不确定图G上任意两个查询Q1=〈R1,σ1,k1〉和Q2=〈R2,σ2,k2〉,若σ1=σ2,则Gσ1=Gσ2;(2)Gσ中任意边(u,v)上的权值Wσ(u,v)仅与不确定图G相关而与查询Q无关,因为Wσ(u,v)=Page6dRE(u,v);(3)若σ1σ2,则Gσ1Gσ2.根据观察(1),可对σ=1,2,3,…,预先计算出Gσ,并将全部Gσ按照σ进行索引.当处理查询Q=〈R,σ,k〉时,直接根据σ快速取回Gσ,并在Gσ上执行查询处理.根据观察(2),可将所有Gσ(σ=1,2,3,…)边上的权值仅存储一次,从而降低空间复杂性.我们使用表Graph存储Gσ中边的权值.根据观察(3),可将Graph表中边的权值按递增的顺序排序,Gσ用Graph表中边的权值不大于σ的所有记录表示.具体的索引结构如图3所示,包括两个部分:第1部分是Index表,具有2列:第1列是距离约束σ;第2列是指向Graph表记录的指针,Graph表的第1条记录到该指针所指记录之间的所有记录表示Gσ.第2部分是Graph表,具有3列:第1列和第2列是Gσ的顶点;第3列是Gσ中边的权值.4.2索引构造4.2.1索引构造第1阶段σ-近邻关系图索引构建的第1阶段是计算不确定图G中任意两个顶点间的可靠期望距离.我们已经知道可靠期望距离dRE(u,v)的计算依赖G上u和v之间距离的概率分布,而通过穷举G的全部蕴含子图的方法来计算u和v之间距离概率分布是极其低效的.为了既保证计算结果精度又显著提高计算效率,本文采用MonteCarlo方法近似计算可靠期望距离dRE(u,v),该算法的思想如下:按照G的蕴含子图被G蕴含的概率对G的蕴含子图集合Imp(G)进行r次独立采样(r的具体数值在后文给出),得到r个G的蕴含子图G1,G2,…,Gr;在每个采样得到的蕴含子图Gi上,计算任意两个顶点之间的最短路径长度;然后,对于G中任意两个顶点u和v,将G1,G2,…,Gr上u和v之间最短路径长度的分布作为G上u和v之间距离概率分布的近似;最后,使用该近似距离分布,计算近似可靠期望距离.下面分析采样次数r的取值.引理1.对于一个不确定图G=((V,E),Σ,L,P)以及0<ε,δ<1,设S={G1,G2,…,Gr}是按照G的蕴含子图被G蕴含的概率对G的蕴含子图集合Imp(G)进行r>0次独立采样得到的样本空间.对G的顶点u和v,设0,{否则Ii=1,若u和v在抽样得到的蕴含子图Gi中连通得到,若r3Pr1其中,p(u,v)表示G中u和v连通的概率.证明.引理1是ChernoffBound[13]的简单应用.其中I1,I2,…,Ir是独立同分布示性随机变量,根据ChernoffBound有Pr1若r应满足r3(Pr1引理2.对于一个不确定图G=((V,E),Σ,L,P)以及0<ε,δ<1,设S={G1,G2,…,Gr}是按照G的蕴含子图被G蕴含的概率对G的蕴含子图集合Imp(G)进行r>0次独立采样得到的样本空间.对G的顶点u和v,设0,{di=u,v在Gi中最短路径长度,若u,v在Gi中连通得到,若r(n-1)2其中n=|V|.证明.引理2是Hoeffding不等式的简单应用.根据式(5)可知Pr(di∈[0,n-1])=1,由Hoef-Page7fding不等式有(r∑rPr1若r满足r(n-1)2由引理1和2,我们得到如下定理.定理1.对于不确定图G=((V,E),Σ,L,P)以及0<ε,δ<1,设S={G1,G2,…,Gr}是按照G的蕴含子图被G蕴含的概率对G的蕴含子图集合Imp(G)进行rmax6采样得到的样本空间.对G的顶点u和v,设p(u,v)表示G中u和v连通的概率,p(u,v)=1中Ii如式(4)定义;又设dRE(u,v)=其中di的定义见式(5).我们有如下结论:(1)若p(u,v)>0.5+ε,则Pr[p(u,v)<0.5]<δ/2,进而Pr[dRE(u,v)<]<δ/2;(2)若0.5<p(u,v)<0.5+ε,则Pr[p(u,v)<0.5]<δ/2+(1-δ)/2·(ε-p(u,v)+0.5)/ε,进而Pr[dRE(u,v)<]<δ/2+(1-δ)/2·(ε-p(u,v)+0.5)/ε;(3)若p(u,v)<0.5-ε,则Pr[p(u,v)>0.5]<δ/2,进而Pr[|dRE(u,v)-dRE(u,v)|>ε]<δ(1-δ/2);(4)若0.5-ε<p(u,v)<0.5,则Pr[p(u,v)>0.5]<δ/2+(1-δ)/2·(ε-0.5+p(u,v))/ε,进而Pr[|dRE(u,v)-dRE(u,v)|>ε]<δ(δ/2+(1-δ)/2·(ε-0.5+p(u,v))/ε).根据上述定理,得到如下计算不确定图中任意两个顶点之间可靠期望距离的算法.算法1.近似可靠期望距离计算算法.输入:不确定图G=((V,E),Σ,L,P),初始精度参数输出:不确定图G的任意两个顶点u,v之间的近似可1.按照G的蕴含子图被G蕴含的概率对Imp(G)进行rmax6S={G1,G2,…,Gr},其中每个Gi是通过对G的每条边e按照其存在概率值P(e)进行独立随机选取得到的.2.在S中每个蕴含子图Gi上,使用Johnson算法[14]计算Gi中任意两个顶点之间的最短路径长度.3.对G中任意顶点u和v,令p(u,v)表示样本空间S中u和v连通的概率.由此,计算u和v之间的近似可靠期望距离为dRE(u,v)=算法1第1步采样每个蕴含子图的时间复杂性为O(|E|),故第1步的时间复杂性为O(r|E|).第2步使用Johnson算法计算每个采样得到的蕴含子图Gi中任意两个顶点之间的最短路径长度的时间复杂度为O(|V|2log|E|+|V||E|),故第2步的时间复杂性为O(r(|V|2log|E|+|V||E|)).第3步计算G中任意顶点u和v之间的近似可靠期望距离的时间复杂性为O(r|V|2).综上所述,算法1的时间复杂度为O(r(|V|2log|E|+|V||E|)).4.2.2索引构建第2阶段σ-近邻关系图索引包括Graph表和Index表.这两个表的建立过程如下:对于Gσ0中任意两个顶点u和v,若Wσ0(u,v)σ0,则向Graph表中插入记录(u,v,Wσ0(u,v));Graph表建完后,将Graph表的记录按照边的权值从小到大的顺序排序,然后顺序扫描一遍Graph表,对于每个距离d(d=1,2,…,σ0),当首次遇到权值大于d的记录t时,向Index表中插入记录(d,addr(t-1)).其中记录t-1是Graph表中记录t的前一条记录,addr(t-1)是记录t-1的地址.Graph表中从开始到记录t-1之间的所有记录构成的集合就表示Gd.4.2.3索引构造算法优化引理2给出采样次数rD2样本空间中,di(见式(5))的取值范围宽度.引理2中D=n-1,当n较大时,r将非常大,此时索引构建效率将非常低.通过选取合适的D来降低r,可提高索引构建的效率.为此我们提出如下3种优化策略:(1)D等于近似直径.Aingworth等人[15]研究了近似计算图直径的算法Appro-Diameter.令D等于近似直径会减少采样次数,但Appro-Diameter算法时间复杂度高,因此该方法不会明显提高索引构建的效率.(2)D等于cσ,其中c(c1)为距离约束σ的松弛系数.通过实验我们得知:在多数情况下,当顶Page8点u和v在样本Gi中的最短路径长度di超过cσ时,把di当作无穷处理不会影响查询结果.因为若dRE(u,v)>σ,只有当将超过cσ部分当作无穷处理得到的近似可靠期望距离小于σ时才会影响查询;若dRE(u,v)σ,只有当将超过cσ的部分当作无穷处理得到的近似可靠期望距离等于无穷时,才会影响查询.大量实验表明,上述两种情况发生的概率非常低.根据上述特性,在蕴含子图Gi中,若u和v之间的最短路径长度大于cσ,则认为u,v不连通,否则用di表示u和v之间的最短路径长度,di的取值范围为[0,cσ].于是令D=cσ,便有rc2σ2(3)在具有小世界性质的图中,D近似等于6[16].若不确定图G的每个的蕴含子图都具有小世界性质,那么在图G上利用算法1计算近似期望可达距离时,r满足r18在具体应用中,可以根据实际情况选择上述优化方法中的一种来加速计算.4.2.4索引维护索引构建完成后,若用户给出新的精度要求ε和δ,索引维护算法将首先计算满足该精度要求所需采样次数r.设构建索引时算法1使用的采样次数为r,如果rr,则索引仍然有效;如果r<r,则说明采样次数不足,不能满足精度要求ε,δ,此时需要更新索引.具体方法如下:对不确定图G的任意顶点u和v,设初始样本空间上的近似期望可达距离为dER(u,v),连通概率为p(u,v).按照G的蕴含子图被G蕴含的概率对Imp(G)进行r-r次独立采样得到补充样本空间.设补充样本空间上的近似期望可达距离为dER(u,v),连通概率为p(u,v).因此,更新后的近似连通概率以及近似期望可达距离分别为p~(u,v)=p(u,v)·r+p(u,v)·(r-r)珟dER(u,v)=r·p(u,v)·dER(u,v)+(r-r)·p(u,v)·dER(u,v)最后,使用索引构建算法1的第3步来更新计算G中任意两个顶点u和v之间的可靠期望距离,接着使用4.2.2节介绍的方法更新Graph表及Index表.4.3查询处理算法给定查询Q=〈R,σ,k〉,查询处理算法首先从σ-近邻关系图索引中取出与σ对应的σ-近邻关系图Gσ.对于Gσ,有如下定理.定理2.给定不确定图G=((V,E),Σ,L,P)和G的σ-近邻关系图Gσ,G中任意顶点子集W的直径diam(W)小于等于σ当且仅当W在Gσ是一个团.证明.首先证明充分性.若W在Gσ中是一个团,则W中任意两个顶点之间的可靠期望距离都小于等于σ,于是diam(W)σ.然后,证明必要性.若diam(W)σ,则W中任意两个顶点之间的可靠期望距离都不超过σ,于是在Gσ中,W中任意两个顶点之间都存在一条边,即W在Gσ中是一个团.根据定理2易得,在不确定图G上执行top-k近邻查询Q=〈R,σ,k〉等价于在Gσ上计算顶点标签集能够覆盖R的直径最小的前k个团.为解决后一问题,本文首先对Gσ进行预处理,以缩小Gσ的规模,提高计算效率;然后,在预处理后的Gσ上进行树搜索,从而计算得到Gσ上顶点标签集能够覆盖R的直径最小的前k个团.第4.3.1节提出预处理方法;第4.3.2节给出树搜索算法.4.3.1预处理算法定义5(σ-可达标签集).设v是不确定图G的σ-近邻关系图Gσ=((Vσ,Eσ),Σσ,Lσ,Wσ)中的顶点,v的σ-可达标签集为reachable(v)=L(v)∪(∪(v,u)∈Eσ设不确定图G的顶点子集W是查询Q的一个匹配顶点子集,W中的顶点满足下面定理3给出的性质.定理3.设不确定图G的顶点子集W是查询Q的一个匹配顶点子集,对任意v∈W,有Rreachable(v)且L(v)∩R≠.证明.由定理2,W在Gσ中是一个团,于是对任意v∈W,有reachable(v)=∪v∈WL(v).再由匹配顶点子集的标签覆盖性,有R∪v∈WL(v)=reachable(v).由W的极小性可知,对任意v∈W,有L(v)∩R≠.由定理3,可直接得到如下预处理规则:若σ-近邻关系图Gσ中的顶点v满足L(v)∩R=或Rreachable(v),则v一定不会出现在任何查询结果中,可将v从Gσ删除.基于上述预处理规则,本文提出一种两阶段预处理算法.第1阶段.将Gσ中满足性质L(v)∩R=的Page9顶点全部删除,同时删除与这些顶点相连的边;第2阶段.计算Gσ中剩余顶点的σ-可达标签集,将满足性质Rreachable(v)的顶点全部删除,同时删除与这些顶点相连的边;然后更新被删除顶点相邻顶点的σ-可达标签集.接下来继续迭代执行上述过程,直至将不可能出现在任何查询结果中的顶点及其相连的边全部删除.算法2.两阶段预处理算法.输入:σ-邻近关系图Gσ,查询Q=〈R,σ,k〉输出:过滤掉Gσ中不可能出现在结果集中顶点及其相1.初始化待判定队列K为Gσ的顶点集Vσ2.ForK中的每个顶点v3.IfL(v)∩R=4.从K中删除顶点v,同时从Gσ删除v及其相连5.WhileK不为空6.ForK中每个顶点v7.计算v的σ-可达标签集reachable(v);8.IfRreachable(v)9.将v添加到过滤顶点队列K10.将v从K中移除11.ForK中每个顶点v12.从Gσ中删除顶点v以及相连的边13.将与v相邻的顶点添加到K14.ReturnGσ算法2给出了两阶段预处理算法的伪代码描述.第1行将待判定队列K初始化为Gσ的顶点集Vσ;第2~4行执行第1阶段过滤.将不包含任何查询标签的顶点及其相连边删除;第5~13行执行第2阶段过滤;最后,第14行返回预处理后的Gσ.实验表明,该预处理算法可以有效降低查询处理算法的时间复杂性.4.3.2带剪枝的树搜索算法根据定理2,我们将不确定图G上执行top-k近邻查询Q=〈R,σ,k〉的问题等价地转化为在预处理后的Gσ上计算顶点标签集能够覆盖R的直径最小的前k个团的问题.为解决该问题,本文提出了一种树搜索算法.给定G的σ-近邻关系图Gσ=((Vσ,Eσ),Σσ,Lσ,Wσ),用表示Vσ上一种全序关系,如顶点标号的大小关系.Gσ中所有团可以被组织到一棵搜索树中,该树具有如下性质:(1)树的每个节点唯一表示Gσ中一个团;(2)树的根节点表示平凡团,即空集;C,满足(3)树的非叶节点C的儿子节点表示另一个团①CC;②|C|=|C|+1;③顶点v∈C\C与C中任一顶点u都满足uv.通过设置合理的顶点之间的全序关系,可进一步降低搜索空间.本文采用RarestFirst[10]思想,先找出Gσ中出现次数最少的标签LRarest,然后令Gσ中包含标签LRarest的顶点u与任意不包含标签LRarest的顶点v满足关系uv.按照RarestFirst原则建立全序关系后,开始建立搜索树,具体算法过程如下:首先将当前搜索节点S置为搜索树的根节点.计算S的候选扩展顶点集合cand(S).cand(S)满足对任意顶点v∈cand(S),有(1)对任意u∈S,有uv;(2)v与S中所有顶点都相邻;(3)L(v)∩(L(S)\R)≠,其中L(S)表示S中所有顶点上的标签集的并集.特别的是,当S=时,cand(S)为包含标签LRarest的顶点集.然后,为每个顶点v∈cand(S),建立新节点v∪S,易知每个新节点都是S的儿子节点.接下来,依次将每个新构造的节点作为当前搜索节点S,迭代执行上述扩展操作,直到待扩展节点的候选扩展顶点集为空或者当前节点满足查询要求时,结束扩展.算法3给出了带标签覆盖的团搜索算法的伪代码描述,其子过程TSC描述了建立搜索树的过程.算法3.带标签覆盖的团查询算法.输入:σ-近邻关系图Gσ,标签集R,整数k输出:直径最小的前k个标签覆盖R的团1.初始化结果集F为空集2.F=TSC()3.RuturnF中直径最小的前k个顶点集.//建立搜索树的子过程TSC(vectorS)描述如下//输入:团S//输出:标签集包含R的团4.IfS的标签集合包含R5.ReturnS6.Else7.计算S的扩展候选集合cand(S)8.Ifcand(S)不为空9.Forcand(S)中的每个顶点v10.TSC(v∪S)在搜索树的基础上运用分支界限方法计算直径最小的前k个团可以尽早剪枝.使用一个尺寸为k的最大堆Htop-k来存储当前搜索结果中直径最小的Page10前k个团,其中堆的根节点表示Htop-k中半径最大的团S,S在G中的直径为diam(S).当树搜索算法建立新节点S时,比较diam(S)与diam(S)大小.若前者大,停止继续扩展该节点,即剪枝;否则,验证S的标签集合能否覆盖R,若能,则用S替换掉Htop-k中的根节点数据,并重新维护最大堆Htop-k;否则,继续扩展该节点.算法结束时,Htop-k中存储的k个团即为半径最小的k个标签覆盖R的团.最后,将Htop-k中k个团全部输出.至此,完成了不确定图上的top-k近邻查询.5实验结果5.1实验配置我们进行了大量实验来验证本文提出的索引构建算法的执行效率及其可扩展性以及查询处理算法的性能.由于目前尚没有处理不确定图上的top-k近邻查询的算法,因此我们主要考察本文提出的方法在不同规模的数据集上以及不同参数条件下的效率.实验中使用的数据取自BioGRID数据库[17]以及通过修改真实图数据得到的合成不确定图数据.表1给出了实验中使用到的不确定图数据的特性.其中Rat、ThaleCress、Worm和Human是取自BioGRID数据库的真实数据;G1,G2,G3,G4为合成数据,它们是从Human中随机抽取不同数量的顶点得到的子图.实验运行环境为具有IntelPentium43.2GHzCPU、512MB内存、运行Ubuntu10.04的PC机.算法采用C++语言编写,并使用BoostGraphLibrary1.44.0.不确定图名称RatThaleCressWormHumanG1G2G3G4实验中使用4.3.2节提到的第2种索引构建优化策略,采样次数r满足r=max6其中距离约束σ4,并以小世界理论为参考,设置距离约束的松弛系数c∈[1.5,6].5.2索引构建算法性能分析我们首先考察算法1中采样次数r对索引构建时间的影响.图4给出在Rat、ThaleCress和Worm3个不确定图上,当采样次数从1增加到150时,索引构建时间的变化情况,其中σ=3,c=2.从图4可以看出,索引构建时间随采样次数的增加线性增长,并且在采样次数相同的情况下,索引构建时间随不确定图尺寸的增大而增加.用户给定精度要求参数ε和δ,设顶点u和v之间精确可靠期望距离为dRE(u,v),近似可靠期望距离为dRE(u,v),定义指示函数I(u,v):I(u,v)=1,若|dRE(u,v)-dRE(u,v)|ε由此我们定义近似距离相对于精确距离的精确度Precision=2图5给出在Rat、ThaleCress和Worm3个不确定图上,当1-δ从0.1增加到0.9时,近似可靠期望距离的精确度变化情况,其中σ=3,c=2,ε=0.5.横坐标表示由ε,δ,σ确定的采样次数,δ从0.9减小到0.1.从图5可以看出,在Rat、ThaleCress和Worm3个不确定图上计算得到的近似可靠期望距离的精确度均高于1-δ,并且随着1-δ的增加,近似可靠期望距离的精确度达到较高水平后保持稳定.5.3查询处理算法性能分析本节考察近邻查询Q=〈R,σ,k〉中的R,σ和kPage11对本文提出的算法性能的影响,此外还考察不确定图的规模对算法性能的影响.首先,考察查询标签集R的尺寸以及距离约束σ对查询处理时间的影响.图6给出在不确定图Worm上,当距离约束从1增加到4时,不同尺寸标签集的查询处理时间变化.其中Query_R3,Query_R5,Query_R7,Query_R9分别对应查询标签集尺寸等于3,5,7,9的查询,查询处理时间是随机生成的尺寸相同的20组查询的平均查询处理时间,并且k=20.从图6可以看出,当查询标签集的尺寸相同时,随着距离约束σ的增加,查询处理时间呈指数增长;当距离约束σ相同时,查询处理时间随查询标签集尺寸的增大而增加.其次,考察结果数量k以及图数据的规模对查询处理时间的影响.图7给出在合成不确定图G1,G2,G3,G4上,当整数k从20增加到100时,查询处理时间的变化.其中|R|=5,σ=2,查询处理时间是随机生成的20组查询的平均处理时间.从图7中不难看出,在同一个图上进行查询时,k的大小对查询处理时间的影响很小;并且在k相同的情况下,随着不确定图规模的扩大,查询处理时间呈指数增长.图7不同的整数k以及不同规模图数据的查询处理时间6结论本文研究了不确定图上的top-k近邻查询问题,首次形式化定义了不确定图top-k近邻查询问题,设计了有效支持该查询处理的σ-近邻关系图索引结构,提出了基于MonteCarlo随机算法的不确定图顶点间可靠期望距离计算算法,并提出了基于此算法的σ-近邻关系图索引构建算法.在σ-近邻关系图索引的基础上,将不确定图top-k邻近查询问题转化为计算σ-近邻关系图上带标签覆盖的top-k团问题.本文提出了一种两阶段预处理算法来有效减小σ-近邻关系图的规模,还提出了基于分支界限法的树搜索算法来快速计算σ-近邻关系图上带标签覆盖的top-k团.本文进行了大量实验来考察索引构建算法和查询处理算法的性能.实验结果表明本文提出的算法能有效处理不确定图top-k近邻查询.
