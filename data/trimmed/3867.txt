Page1基于汉明重的SMS4密码代数旁路攻击研究刘会英1)赵新杰1),2)王韬1)郭世泽1),2)张帆3)冀可可1)1)(军械工程学院计算机工程系石家庄050003)2)(北方电子设备研究所北京100083)3)(康涅狄格大学计算机科学与工程系康涅狄格州斯托斯06269美国)摘要基于汉明重泄露模型,对SMS4算法抗代数旁路攻击能力进行了评估.首先构建SMS4算法等价布尔代数方程组,然后采集SMS4加密功耗泄露,基于模板分析对加密中间状态字节的汉明重进行推断,并转化为与密码算法联立的代数方程组,最后利用解析器进行密钥求解.结果表明:SMS4密码易遭受代数旁路攻击;已知明文条件下,2个样本4轮连续汉明重泄露或26轮离散汉明重泄露可恢复128bitSMS4主密钥;未知明密文条件下,2个样本连续5轮汉明重泄露可恢复128bitSMS4主密钥;使用随机掩码防御的SMS4实现仍不能有效防御代数旁路攻击,已知明文条件下,2个样本连续14轮汉明重泄露可恢复128bitSMS4主密钥.为提高攻击实用性,提出了一种容错代数旁路攻击方法,结果表明汉明重推断错误率不超过60%的情况下,2个样本可恢复128bitSMS4主密钥.本文方法对其它分组密码代数旁路攻击研究具有一定的借鉴意义.关键词SMS4;代数旁路攻击;汉明重;模板分析;掩码防护;容错1引言密码实现需依附具体物理设备平台,其运行过程中会泄露出时间、功耗、电磁等旁路信息,这种利用旁路信息进行密钥破解的方法称为旁路攻击.自Kocher等人于1999年首次提出旁路攻击[1]以来,攻击对象趋于多样化,分析方法趋于复杂化.为提高攻击效率,拓展应用场景,将传统密码分析与旁路攻击结合已成为近年来密码分析的一个重要研究方向.在INSCRYPT2009上,Renauld等人首次将代数攻击和旁路攻击相结合,提出代数旁路攻击(AlgebraicSideChannelAttack,ASCA)[2-3].作为一种新的密码分析方法,代数旁路攻击克服了代数攻击方程组求解复杂度高的缺点,同时可弥补旁路攻击样本量大、可分析轮数少、通用性差等不足.此外,代数旁路攻击还拓展了旁路攻击适用范围.对于某些密码算法,攻击可在未知明密文条件下或在“一次一密”运行模式下成功.鉴于以上优点,代数旁路攻击自提出以来即受到国内外密码学者广泛关注.1.1相关工作2009年,Renauld等人[2-3]首次提出代数旁路攻击思想,基于汉明重泄露模型在8位微控制器环境下对PRESENT和AES密码进行分析.结果表明:1条样本功耗轨迹即可恢复完整PRESENT和AES完整密钥.随后,Renauld等人[4]对影响代数旁路攻击效率的各种因素进行了分析.2010年,Oren等人[5]提出容错代数旁路攻击(TolerantAlgebraicSide-ChannelAnalysis,TASCA),基于伪随机布尔优化问题(PBOPT)进行密钥恢复和容错处理,可能在推断错误率不大于20%条件下成功恢复密钥.当前,代数旁路攻击研究正处于起步阶段,现有研究工作主要存在以下不足:(1)主要针对密钥扩展方案较简单的算法进行研究,如PRESENT、AES、Keeloq等.针对一些密钥扩展方案复杂的算法,如SMS4等,现有研究工作较少;(2)现有攻击方法对于旁路信息推断错误十分敏感,容错能力较差,制约了攻击实用性.SMS4算法[6]是中国公布的第一个商用分组密码算法,是中国无线局域网安全标准WAPI的重要组成部分,对其安全性进行研究具有重要意义.自2006年公开以来,密码学者对其进行了一系列的安全性分析,主要围绕面向设计的数学分析和面向实现的旁路攻击两个方面开展.在SMS4传统密码分析方面,钟名富等人[7]根据SMS4轮结构特点对14轮SMS4进行Square攻击,所需明文数据量为232且计算复杂度为296.5;陈杰等人[8]提出一种针对17轮SMS4的不可能差分分析方法,所需的选择明文为2103且计算复杂度为2124;张美玲等人[9]提出一种针对22轮SMS4的差分分析方法,攻击过程需要2117个选择明文,且时间复杂度为2123;Ji等人[10]给出了SMS4在GF(2)和GF(28)方程组描述,并分析了利用XL算法估计代数攻击的复杂度;Erickson等人[11]分别利用Gr?bner基以及Minisat对5轮SMS4算法进行代数分析.总体上,传统密码分析方法数据复杂度和计算复杂度较高,难以对全轮SMS4的安全性构成威胁.在SMS4密码旁路分析方面,白雪飞等人[12]对SMS4抗功耗分析能力进行研究,在仿真环境下利用5000条功耗样本成功恢复SMS4主密钥;赵新杰等人[13]提出一种针对SMS4前4轮和后4轮的访问驱动Cache计时攻击,80个样本可恢复SMS4完整密钥;张蕾等人[14]、李玮等人[15]、Li等人[16]分别对SMS4算法抗故障攻击能力进行了研究.其中,最好的结果第29轮进行1字节故障注入,将SMS4主密钥搜索空间降至222.11[16].可以看出,当前旁路攻击已对SMS4实现的物理安全性构成威胁,而且将随着测试计量技术及仪器的发展以及SMS4的广泛应用而扩大.目前,在SMS4代数旁路攻击方面,尚未发现国内外有公开发表的结果.1.2本文的贡献攻击能力进行评估,主要研究贡献如下:本文从攻击角度对SMS4密码算法抗代数旁路(1)提出一种针对SMS4密码的代数旁路攻击.前人代数旁路攻击大都针对密钥扩展简单的密码算法,如PRESENT[2]、AES[3],其相邻轮的扩展密钥之间具有较强的相关性,恢复了任意轮密钥就基本等价于恢复主密钥.而对于SMS4来说,相邻轮扩展密钥之间相关性很弱[6],恢复连续4轮的扩展密钥方可恢复出主密钥,因此攻击难度很大.首次在8位微控制器上,基于代数旁路攻击对SMS4安全性进行了分析.结果表明:已知或未知明Page3密文条件下,2个样本部分轮的汉明重泄露均可恢复128bitSMS4主密钥.同现有基于功耗的SMS4旁路攻击相比,所需样本量是最小的,同时攻击也拓展了现有密码攻击的适用范围,可在未知明密文场景下成功实施.(2)提出一种基于代数旁路攻击的SMS4掩码防护攻击方法.在密码实现过程中加入掩码[17],使得旁路泄露信息与真实的加密中间状态无关,是现有防御功耗旁路攻击的最有效方法.文中研究表明:即使是带掩码防护的SMS4密码实现,由于旁路泄露仍可表示为密钥信息同掩码的代数方程组,对于某些特定的掩码方案[18],代数旁路攻击仍然可以成功实施.结果表明:已知明文条件下,2个样本仍可成功恢复128bitSMS4主密钥.(3)提出一种通用的容错代数旁路攻击策略.在攻击过程中,由于环境噪声和测试仪器精度的影响,对于加密某个中间状态的汉明重推断常会存在一定的误差,研究容错代数旁路攻击对于提高攻击实用性十分重要.对错误汉明重推断可选取两种策略:一是只选取区分出来推断正确的汉明重,转化为额外方程组同密码方程进行联立,另一种是充分利用所有的汉明重推断信息,尤其是选取合适的方法表示错误的汉明重推断.前面攻击[2-3]选取了第1种策略,在第2种策略方面,文献[5]利用SCIP进行了一定的研究,但结果表明该方法仅对密码设计较为简单的Keeloq密码有效,对于使用了复杂的非线性变换(如S盒)的密码算法(如AES),攻击效果欠佳.实际物理实验表明:对单条功耗曲线,汉明重推断可能存在大约正负1的误差.基于该误差,可将汉明重推断值转换为一个有限的推断值集合.文中给出了一种多推断值的代数方程组表示方法,并结合汉明重旁路泄露模型进行攻击应用.结果表明:本文容错策略切实有效,在汉明重推断错误率不超过60%情况下,攻击仍可成功恢复SMS4主密钥.文中容错方法可适用于AES、Camellia、ARIA等分组密码容错代数旁路攻击.1.3结构组织本文第2节对SMS4密码算法进行描述;第3节分析代数旁路攻击模型;第4节给出基于汉明重模型的SMS4代数旁路攻击方法及若干攻击实验;第5节给出一种有效的容错代数旁路攻击方案及攻击实验;第6节总结全文.2SMS4算法2.1加密算法SMS4迭代轮数为32轮,采用非平衡Feistel结构进行设计,轮函数结构如图1所示.SMS4分组长度和密钥长度均为128bit,加解密算法结构相同,只是轮密钥使用顺序相反[6].设明文输入为(X0,X1,X2,X3)∈(F322)4分别为第i轮加密的输入和输出,则第i轮加输出为(Y0,Y1,Y2,Y3)∈(F32Xi+2,Xi+3)∈(F32(F32密表示如下:Xi+1=Xi;Xi+2=Xi+1;Xi+3=Xi+2;Xi+4=XiT(Xi+1Xi+2Xi+3RKi),其中,i=0,1,…,31且RKi∈F32T变换由变换τ和L复合而成,为非线性变换,由4个并行的S盒代换构成.L为线性变换,表示如下:L(x)=x(x<<<2)(x<<<10)2.2密钥扩展算法轮密钥扩展算法与轮函数基本相同,只是将其中的线性变换L修改为L[6]:L(x)=x(x<<<13)(x<<<23),x∈F32设主密钥为K且系统参数为FK,则第i轮密钥RKi生成过程如下:k=(k0,k1,k2,k3)=KFK,RKi=ki+4=kiL(τ(ki+1ki+2ki+3CKi)),其中,i=0,1,…,31;FK=(0xA3B1BAC6,0x56AA3350,0x677D9197,0xB27022Dc);CKi=(cki,0,cki,1,cki,2,cki,3)且cki,k=28i+7k(mod256).Page43代数旁路攻击模型代数旁路攻击模型如图2所示.其中,P、X、C图2代数旁路攻击模型(1)密码算法方程组构建.将密码算法表示为关于明文P、中间状态X、密文C以及密钥K的代数方程组.对于SMS4,如何构建S盒代数方程组是其关键.本文借鉴文献[19]中思想,基于布尔积理论构建SMS4的S盒等价代数方程组.(2)旁路信息采集.攻击者通过旁路攻击手段采集密码算法运行过程中泄露的功耗、电磁、故障等旁路信息L,并进行相应的预处理.(3)中间状态推断及表示.根据采集到的旁路信息L,选取相应的旁路信息泄露模型M,利用模板分析[20]等方法推断出中间状态值D.然后,将D转化为关于中间状态变量X和密钥变量K的代数方程.(4)基于代数方程组求解的密钥恢复.当上述方程组构建完成后,剩余工作通过代数方程组求解进行密钥恢复.典型的代数方程组求解主要包括SAT问题求解[2,21-22]、Gr?bner基方法[23-24]、线性化方法等.本文主要基于SAT问题进行代数方程组求解,选取CryptoMinisat解析器作为求解工具.4SMS4代数旁路攻击4.1SMS4代数方程组构建对于SMS4,S盒是其唯一非线性部件.如何有效构建S盒代数方程组是方程组构建的关键.设S分别表示明文、中间状态字节以及密文.由图2可以看出,代数旁路攻击大致可以分为:密码算法方程组表示、旁路信息采集、中间状态推断及表示以及代数方程组求解4个阶段.盒输入比特串为(x0‖x1‖x2‖x3‖x4‖x5‖x6‖x7),输出比特串为(y0‖y1‖y2‖y3‖y4‖y5‖y6‖y7).通过分析真值表,并引入布尔基本积变换[19],可表示为GF(2)如下形式的8个高阶布尔方程:其中,0t<256且0l<8;t=t0+2×t1+…+27×ts-1且tl∈{0,1}.假定(X0,X1,X2,X3)∈(F32变量,(X32,X33,X34,X35)∈(F32变量.引入5类32bit变量.具体为RKi为第i轮密钥变量;Wi为第i轮S盒代换输入;Vi为第i轮S盒代换输出;Ui为第i轮线性变换输出;Xi+4为第i轮加密轮函数输出.SMS4加密过程可转化为如下布尔方程组:其中i=0,1,…,31.根据以上方法,可得到GF(2)上关于5248个变量的4352个方程,其中包括1024个非线性方程和Page53328个线性方程.同样可构建密钥扩展在GF(2)上的4096个方程,其中非线性方程1024个,线性方程3072个;共包含4224个变量,其中密钥变量为1152个.对完整32轮SMS4加密,得到关于9472个变量的9472个方程.实际攻击中,一般仅需建立部分轮方程组即可.4.2基于SAT的代数方程组求解基于SAT进行方程组求解,首先须将方程组转化为CNF(合取范式),一般包括如下步骤:(1)降幂操作.对于每个次数d>1的单项式,引入1个变量和d+1个CNF子句进行替换.(2)线性方程转换CNF.对于长度为L的线性方程,可将其转化为2L-1个CNF子句的合取,其中,每个合取子句又分别为m个变量(其中m-1个变量取反)的析取且m为大于0且不大于L的偶数.当转化为CNF子句后,剩下的工作根据CNF子句生成CryptMinisat解析器所需的txt文件[22].下面,以非线性布尔方程x0+x1+x1x2x3+x0x1x2x3=0为例进行说明.首先,进行降幂操作.引入两个变量p和q,其中p=x1x2x3且q=x0x1x2x3,则有:x1∨p=1,x2∨p=1,x3∨p=1,x1∨x2∨x3∨p=1;x0∨q=1,x1∨q=1,x2∨q=1,x3∨q=1,x0∨x1∨x2∨x3∨q=1.然后,将方程x0+x1+p+q=0转化为如下CNF:图3SMS4汉明重信息采集点选取(x0∨x1∨p∨q)∧(x0∨x1∨p∨q)∧(x0∨x1∨p∨q)∧(x0∨x1∨p∨q)∧(x0∨x1∨p∨q)∧(x0∨x1∨p∨q)∧(x0∨x1∨p∨q)∧(x0∨x1∨p∨q)=1.通过对完整SMS4算法代数方程组进行转化,可得到关于84865个变量的342922个CNF子句.4.3功耗信息采集实验中,在8位AVR微控制器上实现SMS4加密程序.为采集微控制器功耗变化,在微控制器接地端和稳压电源之间串联一个电阻.通过差分探头接电阻的两端,将微控制器的功耗信号传给示波器进行采集并经USB传输到PC机进行处理.示波器的采集过程由PC机上用LabView编写程序实现自动控制(参数见表1).实际实验中,电压设置为5V,微控制器工作频率为8MHz,数字示波器采样频率为100MS/s.设备微控制器ATMETGA324P:1KBEEPROM,2KBSRAM,数字示波器MSO6012A:最大采样频率2GS/s电源电阻SMS4算法主要包括轮密钥加、非线性变换S盒、线性变换L及轮白化4类操作.实验过程中主要采集轮密钥加、非线性变换以及轮白化操作泄露的汉明重.如图3所示.每轮加密有12个采集点,整个加密过程共有12×31+8=380个采集点.需要说明的是,实际攻击中仅需采集部分轮的汉明重泄露.Page64.4基于模板分析的汉明重推断功耗采集阶段,利用前面的实验配置,采集并存储微控制器执行SMS4加密过程中泄露的功耗信息.然后从功耗轨迹中分别找出每轮加密过程中轮密钥加、非线性变换、轮白化等操作对应的功耗轨迹部分.微控制器中,密码算法运行过程中泄露的功耗信息和操作数的汉明重之间具有很强的相关性[1].因此,基于采集到的功耗轨迹可推断加密过程中各个操作对应的中间状态字节汉明重.SMS4加密过程第3轮中轮密钥加操作对应的功耗轨迹部分如图4所示.由图4可以看出,每轮SMS4轮密钥加操作可拆分为4个8位异或操作.令第1个8位异或操作为AK1.图4加密第3轮中轮密钥加操作对应的功耗轨迹在ATMETGA324P上分别执行不同操作数汉明重的AK1操作各1000次,采集对应功耗泄露并求均值,不同汉明重(HW)对应的功耗轨迹如图5所示.本文基于模板分析方法,对加密中间状态字节的汉明重进行推断,分析过程包括模板搭建和模板匹配两个阶段.在模板搭建阶段,根据已知中间状态字节的汉明重和对应的功耗轨迹,为9个不同的汉明重量(0~8)分别构建由均值向量和噪声向量协方差矩阵组成的二元组:其中,狋i为均值向量;犌i为噪声协方差矩阵,详细计算过程可参考文献[20].为精确搭建汉明重模板,需采集大量功耗轨迹,实际攻击中n=1000次.模板搭建完成后,将实际测量的功耗轨迹t与搭建的汉明重模板进行模板匹配,具体方法如下:p(t;〈狋i,犌i〉)=1(2π)m|犌i槡|根据极大似然法则,p(t;〈狋i,犌i〉)最大值对应的汉明重即为该中间状态字节汉明重推断值.代数旁路攻击中SAT解析器对汉明重推断错误十分敏感.实际情况下,由于环境噪声的存在,功耗信息采集过程中的误差不可避免,从而可能会导致推断出的中间状态字节汉明重和实际汉明重不符.因此,需要对中间状态字节汉明重推断值进行差错检测,典型差错检测方法如下:(1)通过判断S盒输入、输出中间状态字节的汉明重推断值是否满足S盒的输入输出关系.如果不满足,则该S盒输入、输出中间状态字节发生汉明重推断错误.(2)根据功耗轨迹与汉明重模板匹配的极大似然概率和设定阈值σ(具体取决于所执行操作)来判定功耗点相比来判定是否出错,如果小于σ,则认为发生汉明重推断错误.实验中发现,对同一加密重复进行5次测量并计算平均功耗曲线,可达到98%以上的汉明重推断正确率.4.5汉明重信息的布尔函数表示对于长度为n的二值向量犡=(x1,x2,…,xn),可能的汉明重值有n+1个,可用长度为k的二值向量犢=(y1,y2,…,yn)对其汉明重HW(X)进行表示:yl=∑p其中,p=n对于8bit的中间状态字节X,有9种可能的汉明重HW(X),且0HW(X)8.其汉明重HW(X)可以用4bit二值向量犢=(y1,y2,y3,y4)进行表示:Page7y1=∏8烄y2=∑70烅y3=∑28y4=∑8烆i当汉明中推断值确定后,可以通过上述方法构建关于加密中间状态字节X的布尔代数方程组,并与SMS4加密代数方程组进行联立,从而降低密钥求解复杂度.4.6攻击实验及比较分析在普通PC机器上(CPU为Pentium(R)Dual-CoreE54002.7GHz,内存2GB)利用CryptoMinisat2.90进行攻击实验.攻击场景分为已知明文连续汉明重泄露、未知明密文连续汉明重泄露、已知明文离散汉明重泄露、未知明密文离散汉明重泄露4种.首先在已知明文、连续汉明重泄露条件下,对SMS4代数旁路攻击的旁路泄露下限以及求解时间特性进行分析,然后进行不同场景下不同轮数汉明重泄露的攻击实验及分析,最后,对添加掩码防护的SMS4算法实现进行攻击实验.当SAT求解器的求解时间超过7200s,视为攻击失败.后续实验结果均是在2个样本条件下得到的.(1)基于SAT的密钥求解时间分布特性分析.通过对同一加密过程进行多次采集保证SMS4加密过程中所有轮密钥加、S盒输出以及轮白化操作的汉明重信息泄露都准确提取,然后在不同轮汉明重泄露条件下进行攻击实验.图6~图8为对不同轮汉明重泄露条件下分别进行100次攻击实验得到的密钥求解时间分布.不同汉明重泄露轮数条件下,密钥平均求解时间如图9所示.图68轮汉明重泄露条件下密钥求解时间分布图716轮汉明重泄露条件下密钥求解时间分布图9不同轮数汉明重泄露条件下平均密钥求解时间①由图6~图8可以看出:汉明重泄露轮数相同的条件下密钥求解时间近似服从指数分布,求解时间越长的实例出现概率就越低,大多数情况的求解时间相差不大.②由图9可以看出:随着攻击轮数增加,虽然旁路泄露信息量增多了,但代数方程组的规模也随之增大,密钥求解时间大致呈线性增长趋势.(2)SMS4未加防御实现攻击场景下攻击结果.由于噪声原因,部分中间状态字节的汉明重推Page8断值可能会存在误差.这里,对于错误汉明重的处理方法是直接剔除,只保留正确的汉明重信息.因此,SMS432轮加密过程中的汉明重信息点只有部分信息可以利用,相当于从全部32轮中离散选取汉明重信息点,即离散汉明重泄露场景.不同攻击场景下,随着汉明重泄露轮数增加,攻击成功率的变化趋势如图10所示,可以看出:①已知明文条件下,至少需连续4轮汉明重泄露才可以100%成功恢复SMS4算法128bit主密钥.未知明密文条件下,连续5轮汉明重信息可以100%成功率求解密钥.连续汉明重泄露场景下,明密文未知对密钥求解效率影响不大.②离散汉明重泄露场景下,密钥求解的复杂度明显增加,大约需26轮汉明重信息才可以100%成功恢复密钥.这是由于汉明重离散选取,导致选取的汉明重信息相关性变弱,从而使得密钥求解时间变长.(3)对SMS4掩码防护实现不同攻击场景下的攻击结果.掩码作为常用的防御手段,可以有效抵抗差分功耗分析攻击.文献[18]借鉴文献[17]给出了一种SMS4随机掩码方案,如图11所示.由于非线性变换操作无法通过简单的掩码相异或的方法去除掩码m,该方案需在每轮加密过程中动态产生相应的随机掩码修正值q.其中,掩码修正值q满足如下关系式:q=s(p+m+k,m)=s(p+k+m)∧s(p+k)对SMS4掩码方案进行分析,需要根据式(1)建立非线性变换S的输入输出关系代数方程组并联立,同时加密过程中每轮需另外采集非线性变换S的输出,即额外增加4个汉明重信息采集点.已知明文条件下实验结果如图12所示.由图12可以看出,掩码防护增加了攻击难度,但是依然可以成功恢复出密钥.(4)同国内外相关工作比较分析.攻击结果同国内外攻击的比较如表2所示.文献[7-9,11]从数学角度对SMS4算法进行分析,攻击所需样本量大,计算复杂度高,对密码算法的安全性难以构成实际威胁;差分功耗分析[12]实现简单,但是所需样本量大,且对采用掩码防护的密码算法实现攻击失效;Cache攻击[13]主要针对微处理器上的SMS4软件实现,对微控制器等上的SMS4软件实现难以构成威胁;差分故障分析所需样本量较小,但现有攻击[14-16]都是通过修改加密算法在计算机上模拟实现故障导入,真实环境下对SMS4加密特定轮和特定字节进行故障导入十分困难,如何实现故障的精确注入是其未来需解决的问题[16].文中提出的SMS4代数旁路攻击利用的是密码执行泄露的功耗信息,旁路信息的采集在很多文献中都有研究[12,20],所需样本量较小;攻击在未知密文条件下仍然有效,且对添加掩码防御的SMS4密码实现仍然适用,攻击实用性相对较强;文中分析方法具有普遍适用性,对其它典型分组密码如Camellia、ARIA、CLEFIA等仍然适用.Page9表2攻击结果与国内外已有SMS4攻击比较攻击文献[7]Square攻击文献[8]不可能差分分析文献[9]文献[11]文献[12]差分功耗分析文献[13]Cache计时攻击文献[14]差分故障分析文献[15]差分故障分析文献[16]差分故障分析本文攻击代数旁路攻击已知明文或未知明密文5SMS4容错代数旁路攻击5.1代数旁路攻击容错策略第4节对错误汉明重推断的处理方法是直接剔除,该方法会导致选取的汉明重泄露之间相关性变弱,使得密钥求解复杂度急剧增加.下面给出一种通用的代数旁路攻击容错方法,基本思想是当密码算法运行中间状态推断d不确定时,不是直接剔除而是构造中间状态推断值的可能集合D并将其转化为等价布尔代数方程,然后与密码代数方程组联立,降低密钥求解复杂度.使用该方法的前提是正确的推断值一定在D中,具体思路如下:(1)构造关于真实中间状态推断d的布尔代数方程组.假定真实中间状态为X=x1‖x2‖…‖xm,xj为单比特布尔变量,1jm,‖表示连接符.令θ为关于中间状态X的函数,其具体含义取决于所选取的旁路信息泄露模型,可构造如下代数方程组:(2)构造集合D={d1,d2,…,dn}的等价布尔代数方程组.假定B={B1,B2,…,Bn}为中间状态X的可能值集合.其中,Bi=b1i‖b2i‖…‖bmi,bji为单比特布尔变量且1in,1jm,可构建方程组如下:(3)构造与d∈D等价的布尔代数方程组.为表示集合D中元素di,1in和真实中间状态推断值d的关系,引入n个单比特变量ci,1in.当di=d时ci=1,否则ci=0.令C=c1‖c2‖…‖cn.由于集合D中只有1个元素等于d,则C中只有1个元素为1,即汉明重为1.令HW(·)为汉明重函数(见4.5节),则可构建如下方程组:5.2SMS4容错代数旁路攻击表3为1次攻击实验中SMS4加密第3、4轮的轮密钥加操作输出的8个中间状态字节对应功耗轨迹与9个汉明重模板(0~8)的匹配的极大似然值.其中,表3中每行的加粗位置标识真实汉明重值.由表3可以发现:对于某个具体中间状态字节的匹配,推断汉明重和与其相邻的汉明重对应的匹配概率一般比较接近.但由于噪声等环境因素的影响,少数情况下会出现推断汉明重d和真实汉明重d有一定微小偏差,基本在±1范围内.因此,当发生汉明重推断错误时,可以获得关于真实汉明重d的候选值集合D:令θ=HW(·),d=HW(X),根据式(2)~(5)构建集合D的等价代数方程组,然后将其与SMS4算法代数方程组进行联立.D={HW(X)-1,HW(X),HW(X)+1}.中间状态字节X300.310.330.480.630.750.650.530.440.284X310.180.340.230.510.590.780.620.380.425X320.850.790.730.640.620.430.410.320.210X330.590.670.710.650.580.510.470.440.372X400.690.760.740.620.560.510.460.310.391X410.280.420.570.650.780.690.540.410.334X420.220.480.620.680.590.410.360.350.183X430.610.630.710.770.670.580.600.450.2935.3攻击实验及比较分析(1)实验结果.已知明密文条件下,不同错误率对应(汉明重泄露轮数为10)密钥求解平均时间如图13所示.从图中可以出,随着错误率的增加,密钥求解的平均时间大致呈线性增长趋势.当汉明重推断错误率不超过60%条件下,均可以在有限时间内成功恢复密钥.(2)同国内外相关工作比较分析.与文献[5]中容错代数旁路攻击策略相比,文中(a)容错能力更强.文献[5]在汉明重推断错误不超过20%条件下,可成功恢复Keeloq完整密钥.对于文中容错方法,汉明重推断错误不超过60%条方法具有以下优点:Page10件下均可在有限时间内成功恢复SMS4主密钥.(b)通用性更强.文献[5]中容错方法的前提是中间状态推断值和真实值之间可用一个不等式来表示,如正确汉明重H为3,汉明重推断误差范围为正负1,则汉明重推断可表示为,1<H<5.该方法仅对汉明重模型有效,对于Cache攻击等模型则无效.以访问驱动Cache攻击为例,攻击者可得到S盒输入的高n位索引y的可能值(如n=4),0y15如正确的高4位索引为4,而根据采集信息得到的y值推断还可能是除了4以外的任意15个值,应用文献[4]中方法无法明确确定误差的范围.如果简单将所有的y建立-1<y<16的不等式,则无法利用信息泄露.而本文提出方法则适用于所有能将推断值缩小到一个有限集合的攻击场景,可普遍适用于汉明重泄露模型和Cache泄露模型攻击.此外,文献[5]中方法对于使用了复杂非线性变换(S盒)的密码算法如AES是失效的,而本文方法对AES、Camellia、ARIA、SMS4等此类分组密码代数旁路攻击依然适用.6结束语本文对SMS4算法代数旁路攻击进行了研究和实验.在建立SMS4密码代数方程组基础上,通过采集密码算法运行过程中泄露功耗,结合汉明重模型将其转化密码中间状态汉明重值,并转化为额外代数方程组,同密码算法方程组联立,降低了代数方程组求解复杂度,减少了攻击所需样本量;同时文中给出了一种高效的代数旁路攻击差错处理策略,提高了代数旁路攻击的适用性.下一步工作包括采用更为高效的代数方程组求解工具,如何将更多类型的旁路信息结合到代数旁路攻击中,以及如何将其它传统的密码分析方法结合到代数旁路攻击中,提高代数旁路攻击效率.
