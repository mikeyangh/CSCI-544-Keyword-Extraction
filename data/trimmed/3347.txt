Page1基于应用层协议分析的应用层实时主动防御系统谢柏林1),2)余顺争1)1)(中山大学电子与通信工程系广州510006)2)(广东外语外贸大学思科信息学院广州510006)摘要主动防御是当今网络安全研究领域的一个热点,现有的主动防御技术主要从网络层和传输层的角度来防御攻击.由于新出现的网络攻击主要发生在应用层,这类攻击在网络层和传输层的数据流与正常数据流没有显著区别,导致现有的主动防御技术无法有效应对这一类攻击,因此研究有效的应用层主动防御具有重要的意义.文中提出一种基于隐半马尔可夫模型的应用层风险实时评估方法,该方法通过分析网络中的实时数据流来评估应用层风险.基于上述风险实时评估方法和应用层协议分析,提出一种应用层实时主动防御系统,当系统发现用户的应用层协议行为存在风险时,该系统根据用户行为的风险值对其产生的数据包进行排队控制,自动纠正用户的异常行为,实现应用层主动防御.实验结果表明该系统具有良好的实时主动防御性能.关键词主动防御;应用层;风险评估;协议分析;隐半马尔可夫模型1引言主动防御是当今网络安全研究领域的一个热点.对网络的主动防御就是要能够有效地对付各种已知的网络攻击,特别是对付各种未知的、新颖的网络攻击.主动防御的战略目标是:“通过态势感知、风险评估、安全检测等手段来对当前安全情况进行判断,并依据判断结果来实施网络主动防御”[1].目前国内外学者主要从以下三个方面来研究主动防御:基于规则异常来研究主动防御;基于陷阱来研究主动防御,例如Wang等人[2]提出一种基于蜜罐网络的防火墙方案,该方案具有主动防御的功能;基于异常检测来研究主动防御.另外,姜伟等人[3]提出一种基于网络系统安全测评的主动防御模型以及基于该模型的一种最优主动防御策略选取算法;Deng等人[4]提出一种基于云计算的分布式主动防御框架;Nguyen等人[5]提出使用k-NN分类法(k-NearestNeighborclassifier)来主动检测网络层DDOS攻击.现有的主动防御技术基本上都是通过分析网络层或传输层的数据来防御网络攻击,而忽略了应用层数据的信息.目前网络攻击越来越多地发生在应用层.根据市场研究公司Gartner最近预测:在未来的几年里80%的企业将成为应用层攻击的受害者.这些应用层攻击在网络层和传输层的数据流与正常用户产生的数据流通常没有显著的区别,例如应用层DDOS攻击[6].所以现有的主动防御技术不能有效防御这类攻击,因此研究有效的应用层主动防御具有重要的意义.网络风险实时评估是实施网络主动防御的前提,要想实现对网络的主动防御,一般都需要有与其对应的网络风险实时评估方法,并且网络风险实时评估方法的性能直接影响主动防御的效果.目前国内外有不少学者正在研究如何对网络风险进行实时评估,他们提出了一些网络风险实时评估方法.例如Arnes等人[7]提出一种基于隐马尔可夫模型(Hid-denMarkovModel,HMM)的网络风险实时评估方法,该方法以入侵检测系统(IDS)的告警作为输入,采用HMM来评估整个网络所面临的风险程度,在该方法中HMM的状态数选为4个,分别为Good、Probed、Attacked、Compromised,HMM的模型参数则通过手工来设置.李伟明等人[8]对上述基于HMM的网络风险实时评估方法进行了一些改进和优化,缩小了HMM观测值矩阵的规模,并使用遗传算法来自动求解HMM的模型参数.陈秀真等人[9]提出一种层次化的网络风险实时评估方法,该方法基于IDS告警信息和网络性能指标来评估网络风险,并且分别从服务、主机及网络系统这三个层面来评估风险.上述几种网络风险实时评估方法均以IDS的告警作为输入,由于现有的IDS主要针对网络层和传输层上的已知攻击,因此上述几种评估方法只能评估已知攻击对网络造成的风险程度,而不能评估未知攻击、新颖攻击对网络造成的风险程度,也不能有效评估应用层攻击对网络造成的风险程度.另外王益丰等人[10]提出一种基于人工免疫的网络风险实时评估方法,该方法依据人体免疫系统中抗体浓度的变化与人体生病严重程度的关系来评估某种已知攻击对网络造成的风险程度.由于主动防御是要能够有效地对付各种网络攻击,特别是对付各种未知的、新颖的网络攻击,因此现有的网络风险实时评估方法不能满足主动防御的需求,更不能满足应用层主动防御的需求.本文首次提出一种基于隐半马尔可夫模型(HiddenSemi-MarkovModel,HSMM)[11-12]的应用层风险实时评估方法.该方法分为模型训练和风险评估两个阶段:在模型训练阶段,利用前后向算法训练得到正常用户在使用每种应用层协议时其行为的隐半马尔可夫模型;在风险评估阶段,在线统计每个观测序列相对于模型的平均对数或然概率,并根据平均对数或然概率值计算得到每个用户行为的风险值.本文提出的风险实时评估方法是基于异常检测来评估应用层风险,该方法能够评估应用层已知攻击对网络造成的风险程度,也能够评估应用层未知攻击和新颖攻击对网络造成的风险程度,因此该方法能够满足应用层主动防御的需求.本文提出的风险实时评估方法直接使用网络中的实时数据流来评估应用层风险,因此该方法具有很强的实时性.基于这种应用层风险实时评估方法,本文提出一种基于应用层协议分析的应用层实时主动防御系统.本文第2节介绍系统的结构;第3节介绍系统中各个模块的原理,重点介绍应用层风险评估模块的原理;第4节给出实验结果;最后在第5节总结并讨论下一步研究工作.本文的创新点主要有以下两个:第一,提出一种基于隐半马尔可夫模型的应用层风险实时评估方法;第二,把这种应用层风险实时评估方法与现有的一些技术相结合,提出一种应用层实时主动防御系统.Page32系统结构本文提出的应用层实时主动防御系统主要应用于网络边界的网关处,该系统由应用层协议识别模块、应用层协议关键词提取模块、应用层风险评估模块、控制模块四部分组成,该系统的结构如图1所示.在网关处,过往的数据包依次经过应用层协议识别模块、应用层协议关键词提取模块、应用层风险评估模块、控制模块.其中,应用层协议识别模块的功能是识别过往的数据包属于哪种应用层协议;应用层协议关键词提取模块的功能是提取数据包载荷中包含的应用层协议关键词;应用层风险评估模块的功能是对用户的应用层协议行为进行风险评估,并根据用户行为的风险值对其产生的数据包标记不同的mark值;控制模块的功能是根据数据包的mark值对数据包进行排队控制,在排队控制的过程中,让不同mark值的数据包进入不同的队列,而不同队列的带宽不同.通过这种软控制方式可以自动纠正用户的异常行为,使得用户的行为与网络公众的共同行为特征相类似、且潜在行为无害,最终实现应用层主动防御.3各模块原理介绍3.1应用层协议识别模块应用层协议识别模块采用开源软件L7-filter[13]的思想来识别应用层协议,即基于正则表达式(regularexpression)来识别应用层协议.在识别基于TCP的应用层协议时,首先缓存每个连接的前几个数据包,然后再重组这些数据包的应用层数据,最后对重组后的应用层数据进行协议正则表达式的匹配.这样一旦识别出某个连接所属的应用层协议,则对于后续的数据包,只需检查其是否属于该连接,如果属于该连接,那么这些数据包就一定属于相同的应用层协议,而无需另外进行协议正则表达式的匹配.在识别基于UDP的应用层协议时,直接对每个数据包的载荷进行协议正则表达式的匹配.采用上述方法识别应用层协议,其准确度高、速度快[14].3.2应用层协议关键词提取模块在识别出数据包所属应用层协议的基础上,通过应用层协议关键词提取模块来提取数据包载荷中所包含的应用层协议关键词以及记录这些关键词到达网关时的时间.所谓的应用层协议关键词(keywords)是指能反映用户在使用该协议时其行为的词.例如用户在使用HTTP协议时,为了描述用户的应用层行为,该协议的关键词可选为GET、POST、HAED、100、200、304、404等;而当用户在使用SMTP(SimpleMailTransferProtocol)协议时,该协议的关键词由HELO、MAILFROM、RCPTTO、QUIT、VFRY、DATA、REST、NOOP、EXPN、HELP和一些状态码组成.在协议识别的基础上提取关键词,是为了减少每次提取关键词时所需匹配的关键词的数目,从而提高关键词提取的速度.3.3应用层风险评估模块应用层风险评估模块是从应用层协议的角度来评估每个用户在使用每种应用层协议时其行为所存在的风险程度.从应用层协议的角度来看,一个用户在使用某种应用层协议时,其在一段时间里的行为反映到应用层协议上就是一系列应用层协议关键词之间的交互.假设某种应用层协议具有K个关键词,即word1,word2,…,wordK,并分别数字化为1,2,…,K,则某个用户在使用该协议时,其在一段时间里的行为反映到应用层协议上就是由这K个关键词组成的一个关键词序列.例如图2为用HTTP协议关键词序列表示的单个用户与Web服务器之间的通信过程,其中该用户的HTTP协议关键词序列为GET,304,GET,200,….大部分正常用户在使用某种应用层协议时,其产生的关键词序列的统计特征具有一定的相似性.例如用户在使用HTTP协议时,由于正常用户的点击速度、浏览时间、浏览过程等具有一定的相似性,导致在正常用户产生的关键词序列中每个关键词出现的频率和关键词之间的时间间隔具有一定的相似性.可以把这种统计特征作为正常用户的模型,而异常用户产生的关键词序列的统计特征与该统计特征具有比较大的差异.例如当某个僵尸主机(Bot)发起HTTP请求泛洪攻击(HTTPrequestfloodattack[15])时,由于其发送网页请求的频率远Page4大于正常用户的频率,从而导致在僵尸主机产生的关键词序列中,关键词“GET”出现的频率非常高,
