Page1实时响应物联网中基于查询的数据转发方案李英龙1),2),3)陈红1),2)莫尚丰1),2),3)1)(教育部数据工程与知识工程重点实验室(中国人民大学)北京100872)2)(中国人民大学信息学院北京100872)3)(湖南科技大学数学与计算科学学院湖南湘潭411201)摘要在许多基于传感器网络技术的物联网应用中,用户需要快速的查询响应,比如智能交通物联网应用中,行驶在路上的司机即时查询附近的空停车位信息.如何为此类物联网设计一种符合传感器网络特性(如能量有效等)的快速数据转发方案是一项重要的挑战性工作.已有的传感器网络实时数据转发协议大都因未解决好转发断路带来的额外开销、孤立节点处理耗时、难以适应网络拓扑动态变化等关键性问题而未取得理想的实时性效果.为此,该文提出一种新的基于查询的快速数据转发方案,利用查询消息为每个传感器节点建立最快速的数据转发路径(有向无环图),此外文中给出的综合路径代价模型可以均衡网络能量和减少网络拥塞延时,最后设计了贪婪的分布式数据转发算法及其改进算法,并用仿真实验验证了该方案的有效性和高效性.关键词物联网;实时数据转发;转发断路;孤立节点;优先转发节点;备份转发节点;连通度;无线传感器网络1引言物联网(InternetofThings,IoT)是以感知为目的,实现人与人、人与物、物与物全面互联的网络,其特征是通过传感器、射频识别(RFID)等方式获取物理世界的各种信息,结合互联网、移动通信网等网络进行信息的传送与交互,采用智能计算技术对信息进行分析处理,从而提高对物质世界的感知能力,实现智能化的决策和控制[1].物联网广泛应用于安防、电力、交通、医疗等许多领域.在许多物联网应用中,用户需要得到快速而可靠的查询响应.比如智能交通物联网应用中,行驶在道路上的司机即时查找附近的空闲停车位信息;在安防物联网视频监控应用系统中获取指定区域的实时音频/视频监控信息;国家核电站监控物联网中查询实时的放射物辐射水平;在闭环控制物联网系统中快速查找事故点[2];在国防军事物联网中,搜集敌对区域的实时情报等等.在此类实时响应的物联网应用中,数据需要非常及时地转发给用户,否则就会失效(数据的有效期很短).如何为此类物联网设计一种快速的数据转发方案是一项亟待解决的挑战性工作.物联网体系结构包括应用层、通信网络层(包括互联网,2G、3G、4G等移动通信网络)和感知层,其中感知层主要由各类同构或异构传感器网络(Wire-lessSensorNetworks,WSNs)组成[3],这些传感器网络负责各类物理目标的感知、监控以及感知数据的转发和上传,它们是物联网实现物与物、人与物等互联通信的基础设施,是物联网的核心组成部分之一.物联网底层的数据转发主要依靠传感器网络完成.近年来,有许多研究[4-20]试图提高传感器网络数据转发的实时性、能量有效性、可靠性等方面的服务质量,但由于这些数据转发策略和算法未能较好地解决数据转发断路带来的额外时间和能量的开销、孤立节点处理耗时、难以适应网络拓扑结构动态变化等关键性问题,因此它们都未能在实时性方面取得理想效果,难以满足物联网感知层中数据转发的实时性要求.文献[4]提出了传感器网络中可调的局部最优地理转发策略(tunableLocally-OptimalGeograph-icalForwardingpolicy,LOGF),包括一个简化的数据转发数学模型和一个简单的单步前瞻数据转发规则.LOGF可以在端到端数据包延迟和转发跳数之间取得较好的平衡,但该策略基于一个很苛刻的假设前提,即在LOGF中,假设每个节点至少有一个离汇聚节点(Sink)近于自己的邻居节点,使得沿此类邻居节点转发数据时总能到达Sink.虽然这个假设前提可以较好地回避转发断路问题,但相同跳数邻居节点之间的数据转发也会影响查询响应的实时性.文献[5]基于一种虚拟队列结构为传感器网络设计了一个机会调度算法,可以控制单跳和多跳网络中最坏情况下的延迟,但不适用于实时性要求高的应用.文献[6]提出了通过贪婪嵌入机制以确保基于嵌入坐标的路由总能找到目的节点,但没有有效地解决能量有效和传输延迟问题.文献[7]提出一种无线网络中非编码传输协助的编码方案来减少多播流数据传输跳数,同样存在转发断路问题.文献[8]引入“睡眠-唤醒”调度机制以减少端到端的延迟,但不能保证数据以最小跳数方式转发,从而影响了实时性.文献[9]通过减少每个节点的先进先出队列积压和实际物理队列出队连接数,提出一种镜像架构来改进背压(back-pressure)调度算法的延迟性能.SPEED[10]是传感器网络一种著名的实时性地理路由,它只选择满足要求的快速连接作为转发路径,并采用局部反馈控制以应对不断变化的负载和拥塞.MMSPEED[11]是SPEED的扩充,除了在转发速率等方面的改进之外,MMSPEED还支持数据的可靠传输.SPEED和MMSPEED虽然在数据转发时采用了局部反馈控制,但都没有解决转发断路问题,而且缺少对延迟、可靠性和能效的均衡考虑.目前,有不少研究[16-20]也关注传感器网络基于查询的路由.文献[16]提出了在间歇性的连接移动传感器网络中分别利用数据对象和查询的空间信息来指引数据聚集和转发的方法,但该方法没有考虑多跳数据转发的情况,也未能较好地解决网络拓扑结构变化问题.定向扩散(DirectedDiffusion,DD)[17]是一个著名的基于查询的路由协议,该路由包含(查询)兴趣传播阶段、初始梯度建立阶段和沿加强路径传输数据阶段.DD虽然可以解决转发断路问题,但梯度中会存在跳数相同的邻节点(有时还存在“环”),影响了数据转发的实时性.文献[18]提出优先调度策略以改进DD,但仍未解决上述问题.谣传路由(rumorrouting)[19]提出了基于查询消息的随机单播数据转发机制.在谣传路由中,事件区域内的传感器节点产生的代理消息和Sink发送的查询消息都沿随机路径传播,当它们相遇时,一条从SinkPage3到事件点的完整路径被建立.谣传路由机制减少了利用洪泛方法建立数据转发路径的大量开销,但是随机方法建立的转发路径不是最优的,并且存在环路,从而影响数据转发的实时性.文献[20]通过引入第二层地理路由改进谣传路由,用到达角度(AngleofArrival,AoA)天线和信号强度探测器来代替定位装置,但由于转发路径并非最优,导致了平均转发跳数和能量消耗仍然很大.我们不难看出,目前已有的实时数据转发研究难于满足物联网中数据转发的高实时性要求.为此本文提出一种新的基于查询的快速数据转发方案,该方案主要包括以下工作:(1)提出了一种新的优先/备份转发节点策略及算法,并给出了该策略下网络连通度的近似分析.(2)构建了综合路径代价模型,以实现数据转发时能做到均衡能量和避免拥塞.(3)基于优先/备份转发节点方案提出贪婪的分布式数据转发算法及改进算法,并通过仿真实验验证了本数据转发方案的有效性和高效性.本文第2节是网络模型和问题的定义;第3节中给出优先/备份转发节点策略、算法和连通度分析;第4节提出基于优先/备份转发节点策略的分布式数据转发算法及改进算法;第5节为实验结果分析;第6节给出结论和进一步的研究工作.2网络模型和问题定义2.1网络模型本文研究对象为物联网感知层的传感器网络(WSNs),是由一个位置固定的Sink和随机均匀分布在事件区域内的n个可移动的传感器节点组成.每个节点(我们用“节点”表示传感器节点或Sink)都有唯一的标识(ID).节点i和节点j可以直接通信当且仅当它们的距离d(i,j)不超过无线通信半径R,即d(i,j)R,并称i和j互为邻节点.d(i,j)为基于地理位置(GPS)的欧式距离,或通过无线通信电磁波的传输速率和时间计算获得(GPS失效的室内环境下).数据链路层(如MAC)等底层的协议以及“睡眠-唤醒”等协议都较好地被自动管理[4,8].2.2问题定义定义1.转发断路,当一个节点i沿着某一条路径L转发数据D,D到达某一节点j处再也无法被继续转发,除非按原路L返回i改走其它路径,否则不能到达目的节点.那么称L(i→j)为转发断路.在许多地理路由算法[4,10-11]中,每个节点选择离Sink更近的邻节点转发数据,这可能导致出现转发断路,如图1中,S9,S11和S15都是S12的候选转发节点,当S12选择S15转发数据,S15再选择S16转发数据时,就会形成一个转发断路S12→S15→S16,因为当数据包到达S16时,再也没有候选转发节点了,除非由原路返回至S12改走其它的路径,否则数据不能转发到Sink.不难得出,转发断路只会增加不必要的耗时和耗能,严重影响了查询的实时响应和能量有效性,而这个问题存在于大部分现有数据转发路由协议中(详见第1节“引言”中的阐述).定义2.孤立节点,随着网络部署时间推移,越来越多的节点因能量耗尽而失效,如果网络中某节点i的通信范围内没有任何有效(具有足够能量转发一个数据包)的邻节点,无论采用什么策略,i的数据都不能被转发,则称i为孤立节点.如图1中,由于失效节点S18和S19,节点S20成为孤立节点,无论采用什么策略,S20的数据都不能被转发.采用如文献[10-11]等提出策略,只会耽误查询响应的时间.很多路由算法如定向扩散[17-18]中,为了达到能量平衡或其它目的,数据转发路径中会存在环和跳数相同的邻节点,如图1中,S11的一条转发路径S11→S10→S9→S11→S8中存在环路,S11的另一条转发路径S11→S9→S8存在两个跳数相同的邻节点(S11和S9的跳数都为2),这都会增加数据转发时间和能耗.由于物联网中的传感器节点能量受限,节省耗能是另外一个重要的问题.传感器网络中一个通用的能耗模型[13]如下ET(i,j)=k·(Eelec+εfs·d2(i,j)),d(i,j)<dcoPage4其中,εfs和εmp分别代表在自由空间模型和多路径模型中的节点发射功率放大器;k为数据包的比特数;Eelec表示发送或接受一个比特数据的能耗;ET(i,j)为节点i发送k比特数据包到j节点的传输耗能;dco为通信阈值.从式(1)和文献[21]可知,短距离多跳传输数据比直接长距离传输更节省能量.因此如果能将逐跳数据传输的通信距离控制在阈值dco以内,便可降低能耗,而且较短距离的数据传输可以降低接收端的冲突概率(较少的来自多个发送端的数据包传输重叠)[22],对于提高数据传输的可靠性也有好处.然而过小的传输距离(小于dmin)对于降低能耗的作用却很小,反而会影响数据包传输的实时性.如图2中,A为数据包发送者,B和C为A的候选转发节点,假设它们间的距离都小于dco,并且d(A,B)<dmin.根据式(1),只有在图2(b)所示的情况下,转发路径A→B→C比A→C节省能量,但更耗时,假设两邻节点传输通道延迟(Channel.delay)为100ms(包括数据包的排队、转发处理和MAC冲突处理等耗时),则路径A→B→C的耗时为200ms,而路径A→C只需要100ms.我们同样可以得出,图2(b)和(c)中的路径A→B→C不但不能减少能耗,反而降低了数据转发的实时性.图2中的3种情况对于实时性来说,一跳的转发路径A→C都会更好.路径文献[13]给出了一种过小通信距离定义dmin=(Eelec/ε)1/σ,σ∈{2,4},ε为发射功率放大器.图23种过小距离数据传输情况(d(A,B)<dmin)我们认为,应该根据网络分布密度情况和具体的应用设置过小通信距离dmin,本文将设置如[dmin,dco)(dco<R时)区间的数据转发通信范围.3优先/备份转发节点策略和算法3.1优先/备份转发节点策略定义3.查询消息(QueryMessage,QM),是由Sink广播的能够表达用户查询要求的消息.查询消息由标识号(QM_ID)、发送节点标识号(SN_ID)、发送节点跳数(SN_HOP)以及具体查询(QUERY)组成,如图3所示.定义4.优先转发节点(PreferredForwardingNodes,PFNs),节点i的所有PFNs(记作PFNs(i))是i的部分邻节点(partofNNs(i),pNNs(i)),并满足如下条件:(1)节点i经由pNNs(i)转发数据不会出现转发断路;(2)HOP(pNNs(i))<HOP(i);(3)d(pNNs(i),i)∈[dmin,dco)(部分符号说明见表2).定义5.备份转发节点(BackupForwardingNodes,BFNs),节点i的所有BFNs(记作BFNs(i))是i的所有不属于PFNs(i)的邻节点,BFNs(i)可以被形式化地描述如下BFNs(i)={nodej|nodejPFNs(i)∧d(i,j)R}.PFNs通过减少转发跳数提高数据转发的实时性和可靠性等服务质量,当某节点i的PFNs(i)失效时,i的BFNs(i)参加数据转发以最大程度地延长网络生命周期,每个节点在QM广播阶段根据PFNs/BNFs策略和算法(见第3节)获得它的所有PFNs和BFNs.我们为每个节点定义一张本地表,以保存一些有用信息,如表1所示.V_PFNV_BFNPFN_NEXT其中,HOP的初始值为0.V_PFN和V_BFN为结构体向量,如图4所示,分别存放节点的优先和备份转发节点的标识(ID)和节点到其优先和备份转发节点之间的综合路径代价(HybridLinkCost,HLC),其中HLC将在4.1节中详细阐述.图4节点内的优先/备份转发节点向量结构PFN_NEXT是该节点下次转发数据时能否成为其它节点的PFN的标志,初始值为TRUE,当某节点或其所有PFNs的能量耗尽时,其PFN_NEXTPage5变为FALSE,此时该节点不能成为其它节点的PFN.PFN_NEXT可以保证整个网络中的PFNs被优先地用于转发数据.基于查询的数据转发的一个挑战是Sink不知道哪些传感器节点有满足查询要求的数据,所以Sink需要将QM洪泛(flooding)地广播到所有的传感器节点.尽管洪泛广播有耗能较多等缺点,但洪泛广播仍作为鲁棒性很好的信息传播技术被广泛应用.在QM广播阶段,每个节点按如下优先/备份转发节点策略(PFNs/BFNs策略)得到其所有的PFNs和BFNs.PFNs/BFNs策略:在QM广播阶段,当某节点i广播QM时,i所有的邻节点都会收到该QM并根据它们自己的HOP以及i的HOP来决定i是它们的PFN还是BFN.如果接收者j是第一次接收QM(此时j的HOP=0)并且i和j的距离属于[dmin,dco),则i为j的PFN并修改j的跳数为i的跳数加1,否则i为j的BFN.如图5,当节点m广播QM时,假设m的HOP为h,c和d为第一次收到QM(c和d的HOP为0),如果d(m,c)和d(m,c)属于[dmin,dco),则m为c和d的PFN,并且c和d的HOP由0变为h+1.节点e也是第一次收到QM,但由于e和m的距离超过dco,所以m为e的BFN,且e的HOP保持不变.如果QM的接收节点的HOP比发送节点的大,而且它们之间的距离属于[dmin,dco),则发送节点为接收节点的PFN,其余的情况发送节点都是接收节点的BFN.如图5,节点d因为第一次接收了m发送的QM而使它的HOP变为h+1,当它接收到n节点发送的QM时,它的跳数比n大,如果d(n,d)属于[dmin,dco),则n也为d的PFN,其它情况比如a和b的跳数比m小,则m为a和b的BFN.QM广播从Sink开始,直到所有节点都完成一次QM广播结束,更详细的描述见3.2节的PFNs/BFNs获取算法(算法1).3.2PFNs/BFNs获取算法本文将用到的一些符号和描述如表2所示.符号NNs(i)HOP(i)PA(i)V_PFN(i)V_BFN(i)thrd_pfnthrd_bfn其中,thrd_pfn为一个节点是否为其它节点的PFN的阈值,如果两邻节点间的HLC值大于或等于thrd_pfn,则它们不能互为PFN,thrd_bfn具有类似的意义.根据3.1节描述的PFNs/BFNs策略,我们可以得到相应的PFNs/BFNs获取算法.算法1.每个节点得到PFNs和BFNs.输入:Sink广播QM输出:每个节点i得到V_PFN(i)和V_BFN(i)1.Sink广播QM;//NNs(Sink)都能收到此QM2.do3.for每个接收到QM的节点j//假设发送节点为i4.ifHOP(j)=0then//j第一次收到QM5.j计算d(i,j);6.ifd(i,j)∈[dmin,dco)then//如果dco>R,则dco=R7.V_PFN(j)push_back(i,0);//HLC初值为08.HOP(j)←HOP(i)+1;j保存QM中的QUERY;9.elseV_BFN(j)push_back(i,0);10.elseifHOP(j)>HOP(i)then11.j计算d(i,j);12.ifd(i,j)∈[dmin,dco)thenV_PFN(j)push_back(i,0);13.elseV_BFN(j)push_back(i,0);14.else//HOP(j)HOP(i)15.V_BFN(j)push_back(i,0);16.j广播QM;17.endfor18.while(所有节点完成一次QM广播)根据算法1,每个节点都可以得到它的PFNs.如图6为图1中所有节点到Sink的转发路径.在图6中,每个节点到Sink的转发路径都是无相同跳数邻节点的有向无环图(节点下方括号内的数字为节点相对于Sink的跳数),比如S14有查询数据时,它的数据将只会沿着图6中“实线”某条路径转发,将不会出现转发断路和相同跳数邻节点之间转发数据的情况.S12的一跳邻节点(通信范围[dmin,dco)内)有S7、S9、S11、S13和S15,但S12的PFNs只有S9和S11,S15不会成为S12的PFN,这将避免形成转发Page6断路.S11的PFNs分别是S8和S10,而S9不是S11的PFN,这可以避免相同跳数的邻节点之间转发数据.另外如果孤立节点S20(如图1)接收不到QM,S20就不会参与数据转发,因而数据转发程序不需要处理它而节省时间.3.3PFNs连通性分析传感器网络中的一个基本问题就是覆盖和连通问题,基于PFNs/BFNs策略下每个节点得到的PFNs和BFNs可以覆盖以它为圆心,以R为半径的整个圆形区域,这类网络的覆盖和连通性问题已经有很多研究[23-25].我们知道为随机分布的传感器网络构建一个稳定的连通覆盖集是一个NP困难问题,因此本文尝试给出基于PFNs策略的随机均匀分布网络覆盖和连通性近似分析.定义6.节点连通度,如果一个节点有h个邻根据PFNs/BFNs策略,在给定的通信范围之内,当节点i第一次收到QM(HOP(i)=0)或者i的HOP大于QM发送者j的HOP时,j即为i的一个PFN,如图7所示,假设Sink逆时针顺序广播QM,节点间的距离为dco,Sink、i坐标分别为(0,0),(2dco,dco).以Sink为圆心,dco为半径圆上的点a的坐标为(s,t),点c为圆(x-s)2-(y-t)2=d2co和圆节点,则称该节点的连通度为h.数学方法求得i的PFNs覆盖最大夹角θ近似为125.7°(此时t和s都近似为槡2dco/2),如图7中阴影区域所示.有文献资料[24-25]表明,传感器节点的邻居节点数目过多或过少,都会对整个网络有不利影响.邻居太少,容易导致连通性和可达率太低,出现较多的孤立节点;反之,太多邻节点容易增加信息冗余、通信负担和信号干扰.因此通常根据具体应用选定固定的连通度h,要求每个节点的邻居数越接近h越好.所以我们的问题可以描述为:在面积为Q的区域中随机均匀分布N个传感器节点,通信距离范围为[dmin,dco)时,N为多大,可使基于PFNs策略的每个节点的连通度为指定值h的概率最大?定理1.在给定的传输半径范围内,要使PFNs策略下的网络连通性为指定值h的概率最大,网络节点个数是不采用该策略的网络(每个节点的所有邻节点都是它的转发节点)节点数的近3倍.证明.由于讨论的传感器网络是随机均匀分布的,因此网络近似服从二维泊松分布,传感器节点的分布密度为μ=N/Q,0<μ<,根据上述PFNs最大覆盖夹角分析,我们可以得到每个节点的PFNs覆盖区域S的面积近似为S=π(d2co-d2min)/3(θ取近似值120°),则S内恰有h个传感器节点的概率[23]为也就是说,在S域内含有传感器节点的数目近似服从均值为μ·S的泊松分布.从式(2)可知,在[dmin,dco)固定不变情况下,要提高区域S内恰好有h个节点的概率,需要增加传感器节点的分布密度.稍前也讨论过,节点数目不能过多,所以通常根据具体应用场合选定节点连通度期望值为固定值h,要求基于PFNs策略的每个节点的邻节点数目越接近h越好.即在[h-u,h+v](0u<h-1,v0)之间的概率值P(h-uxh+v)越大越好,也即求P(h-uxh+v)=∑h+v关于N的极值问题.令ξ=N/Q·S,则有P(h-uxh+v)=∑h+v对P关于ξ求导,得dξ=∑h+vdPx=h-uPage7令dPdξξ=ξ0整理得可以证明,当ξ=ξ0时,有dξ2=e-ξ·∑h+vd2P=e-ξ·ξh-u-2上式表明概率P(h-uxh+v)可以在ξ=ξ0=[(h+v)!/(h-u-1)!]1/(u+v+1)处取极大值.由ξ=N·π(d2co-d2min)/3Q可知,在Q和通信距离范围[dmin,dco)已知时,要使基于PFNs策略的节点连通度在区间[h-u,h+v]内的概率最大,传感器节点的数目N应为由式(5)可知定理1的正确性,因为不采用本文PFNs策略,则需要的节点数为Qξ0/π(d2co-d2min).4贪婪的数据转发算法4.1综合路径代价模型为了实现网络能量均衡和避免网络拥塞,我们给出了一个基于剩余能量和路径拥塞程度的综合路径代价(HybridLinkCost,HLC)模型.节点i发送k比特数据到节点j的主要能耗E(i,j)包括两部分[13]:发送端i的发送耗能ET(i,j)和接收端j的接收耗能ER(j).其中接收耗能ER(j)=k·Eelec,由于本文设定传输距离小于dco,根据2.2节的式(1),ET(i,j)=k·(Eelec+εfs·d2(i,j)).因此E(i,j)=ER(i)+ET(i,j)=2k·Eelec+k·εfs·d2(i,j)定义7.拥塞程度(CongestionDegree,CD),节点i和j之间的路径拥塞程度CD(i,j)包括两部分:路径i→j信道占用情况以及节点j内转发队列缓冲区占用情况.CD(i,j)∈[0,1)由底层协议如MAC自动管理和获取[26-28],即每个节点可以通过探测消息获取与周围邻节点路径的拥塞程度.定义8.综合路径代价(HLC)模型可以形式化定义如下HLC(i,j)=ω·Ε(i,j)·PA(j)-α+(1-ω)·CD(i,j)其中,ω是一个可调的权重,可以根据能量均衡和拥塞延迟要求确定,比如对于查询实时响应系统来说,ω可以设置小一些.α是和拥塞程度定义有关的剩余能量系数,α取值范围一般为[0.5,1].不难得出,当各节点的剩余能量较大时,式(7)前半部分值较小,因而拥塞程度对转发路径选择影响较大,这可以减少拥塞延迟,提高响应实时性;反之,如果节点的剩余能量较小,则式(7)中前半部分值会比较大,因而能量均衡对转发路径选择影响较大,这可以最大化传感器网络生命期.因此HLC模型可以起到能量均衡和拥塞避免的作用.4.2基于PFNs/BFNs策略的数据转发算法定义9.数据包结构,数据包(DataPacket,DP)由数据包标识(DP_ID)、发送节点标识(SN_ID)、数据(DATA)和其它信息(OTHER_INFO)组成,如图8所示.QM广播结束后,每个节点都会根据PFNs/BFNs策略(算法1)得到其所有的PFNs和BFNs,此时满足查询要求的节点开始转发数据(在某些特殊应用中,如即时查找停车位的智能交通物联网中,Sink发出查询空停车位的QM,只要某个停车位上传感器节点上检测到停车位是空闲的,就可以立即转发结果数据给Sink,而不必等QM广播结束才开始数据转发,因为Sink只需要一个满足查询要求的结果,可以提前结束该查询过程.).具体的基于PFNs/BFNs数据转发算法(PFNs/BFNsbasedDataForwarding,P/BDF)如下.算法2.基于PFNs/BFNs策略的数据转发.输入:Sink广播QM输出:查询结果1.for每个有满足QM要求数据的节点i2.i广播MAR;3.for每个收到MAR的节点j4.ifj==SinkthenHLC(i,j)←0;//Sink为最优先转发节点5.elseifj’sPFN_NEXT==TRUE&&PA(j)>0then6.j根据HLC模型计算HLC(i,j);7.else8.HLC(i,j)←thrd_pfn;9.j发送RRM给i;//HLC(i,j)在MRR中Page810.endfor11.NNs(i)返回MRR后i从其V_PFN向量中选取HLCmin;12.ifHLCminthrd_pfnthen13.i的PFN_NEXT←FALSE并启动i的BFNs转发数据;14.else15.i发送DP给对应HLCmin的PFNk;//RN_ID=k16.PA(i)←PA(i)-E(i,k);17.ifk==Sinkthen18.continue;//选择其它有数据转发的节点作为i;19.elsei←k;20.endfor(所有的查询结果数据转发到Sink)BFNs转发数据:21.i从它V_BFN向量中选取HLCmin;22.ifHLCminthrd_bfnthen23.存在异常孤立节点,查询失败;24.endSimulation();25.elsei同14~19行各语句进行处理;endBFNs算法2的一个运行例子如下:当一个节点i(图9中的S13)有数据(S13也可能聚集收到其它节点的数据)待转发,i发出一个建立路由请求消息(MessageofAskingforRouting,MAP),接收到此MAP的NNs(i)(图9中S10,S11,S12等)首先判断它们是否为“Sink”,如果“是”,则设置对应的HLC为0,否则再判断它们的PFN_NEXT,如果为“真”,则根据HLC模型计算相应的HLC值(图中HLC(S13,S10)等),否则HLC为thrd_pfn,然后通过回答路由消息(MessageofReplyingforRouting,MRR)返回HLC给i.当i收到所有NN(i)返回的MRR,则i首先从它的V_PFN向量中选取最小的HLC值HLCmin,如果HLCmin大于或等于thrd_pfn,这意味着i的所有PFNs失效,则修改i的PFN_NEXT图9基于优先/备份转发节点策略的数据转发为“假”,并且启动i的BFNs转发数据,否则i选择HLCmin(当i的一个PFN为Sink时,这时HLCmin为0)对应的PFN作为数据转发节点(通过DP的RN_ID实现).当BFNs转发数据时,同样地选取最小值HLCmin对应的BFN来转发数据,当所有节点的查询结果数据都已返回Sink时,则该查询成功结束,或者存在“异常孤立节点”(可以接收到QM的孤立节点)时,该查询以失败而结束.4.3改进的数据转发算法从算法2中我们不难看出,数据转发过程中建立路由消息(MAR)和路由应答消息(MRR)比较多,尽管这些消息占用字节数较小,但仍会消耗比较多的能量.因此我们尝试通过减少MAR/MRR数量来改进算法2,以达到节省能量的目的.由于无线通信具有泛播(anycast)特性[8],当一个节点发送DP时,理论上在其通信范围R内的所有邻节点都可以接收到(在算法2中,我们通过RN_ID让指定的节点来响应接收DP).我们知道一个节点V_PFN和V_BFN中的HLC主要由邻接点的剩余能量(PA)变化而改变,而一个节点PA的变化主要是由接收和发送DP引起的.若在一个节点发送DP时,我们把它的PA放入DP(DP结构将发生变化),则它所有的邻节点都可以更新PFN和BFN向量中相应的HLC值,这样每个节点只需在第一次转发数据时发送建立路由请求消息,就可以得到它所有PFNs和BFNs的HLC.之后根据本地V_PFN和V_BFN就可贪婪地转发数据,不再需要重新请求建立路由的消息,从而减少大量的MAR和MRR.在给出改进算法之前,我们需要修改数据包的结构,即增加发送节点的剩余能量(SN_PA)到DP结构中,新的数据包(DP)结构如图10所示.改进的数据转发算法(IMprovedP/BDFalgo-rithm,IM-P/BDF)和算法2的区别是:节点每次发送数据时把自己的PA加入DP(结构如图10所示)中,以动态更新其邻居与之对应的HLC值,每个节点除了第一次通过路由消息获得它的PFNs和BFNs的HLC值外,之后的数据转发将根据本地V_PFN或V_BFN向量中的HLC值转发数据,详见算法3.Page9算法3.改进的数据转发算法(IM-P/BDF).输入:Sink广播QM输出:查询结果1.do2.for每个有数据待转发的节点i3.ifi是第一次转发数据then4.i通过MAR/MRR获得其PFNs或BFNs的5.else6.据算法2和本地V_PFN或V_BFN转发数据;7.endfor8.for每个接收到DP的节点j9.j根据DP中的PA更新V_PFN或V_BFN10.endfor11.while(所有的查询结果数据转发到Sink)5实验分析我们使用OMNET++仿真平台来评估我们的P/BDF和IM-P/BDF算法性能.我们在100m×100m区域内随机均匀分布了20、30、50、70、80和100个传感节点,Sink被固定在区域边缘.为了尽可能地覆盖整个网络,我们随机选取了离Sink节点最远的几个节点作为源节点.为简单起见,假设节点在一个查询过程中保持静止(该假设不是强制性的,如果传感器节点在一个查询过程中移动而改变网络拓扑结构的话,则只需重发QM).其它的仿真参数设置[15]详见表3,由于R小于dco,所以本文方案的通信范围为[dmin,R].dco信道延迟(Channel.delay)5.1性能对比我们评估算法2(P/BDF)、算法3以及采用转发集合的LOGF[4]算法(详细阐述见引言部分)在转发跳数(影响实时性的主要因素)、能耗、拥塞延迟三方面的表现.假设一个数据包大小为40字节,包括30字节数据,10字节如“包头”等其它信息.当源节点有600字节的查询结果数据待转发时(不考虑网内聚集),在P/BDF算法中需要20个数据包(DP),而在IM_P/BDF算法中,数据包中增加的SN_PA占用两个字节,所以至少需要22个DP才能转发完600个字节的数据.另外,设置MAR的大小为2字节,MPP的大小为4字节(其中HLC占2字节).即使没有像LOGF那样苛刻的假设(引言部分有详细阐述),我们的P/BDF和IM-P/BDF算法仍比LOGF算法的转发跳数更少,如图11所示,这是因为基于PFNs策略的每条转发路径上没有相同跳数的邻节点.由于IM-P/BDF算法中的数据包数有少量增加,使得其转发总跳数比P/BDF算法稍多,如图11所示,而且当单个的数据包大小越大,IM-P/BDF需要的总跳数越接近P/BDF.转发一定数量的数据包到Sink节点,LOGF耗能最大,P/BDF的能耗比IM-P/BDF大,如图12所示.LOGF允许跳数相同的邻节点之间转发数据使得总转发跳数增加,因而消耗更多能量,由于在IM-P/BDF中减少了大量的路由消息(MAR和MRR),因而比P/BDF更节省能量.从4.1节中,我们知道CD(i,j)可以由传感器节点内置缓存区模块以及底层协议自动管理获得,因此我们用[0,1]之间的随机数模拟每条路径的即时拥塞程度来测试转发数据时的拥塞避免性能.采用HLC模型(ω=0.8)的数据转发算法P/BDF和IM-P/BDF可以更好地避免路径拥塞,而由于P/BDF转发的总数据包比IM-P/BDF更少,因此P/BDF的拥塞避免效果最好,如图13所示,而且ω取值越小,采用HLC模型来避免拥塞的效果越好(见5.2(3)).Page105.2OQDF(P/BDF)的性能评价(1)能量均衡表现.首先我们选取靠近Sink的4个节点(它们的PFN为Sink)来考察它们的剩余能量变化(以50个节点分布为例),如图14,节点7(WSN:sNode[7])的初始能量最大,但由于它到Sink的距离以及路径拥塞情况使得HLC(7,Sink)小于HLC(50,Sink),所以在前8次数据转发中,节点50成为转发节点.之后节点7和50根据他们的HLC值(ω=0.8)轮流转发数据,直到它们对应的路径代价比节点38或42小,这时这4个节点都参与数据转发.如果其它节点的能量足够多,这4个节点的能量终将均衡地被耗尽,如图14.我们再随机选取跳数相同的两个中间节点,考察他们的能量变化情况,如图15,我们可以看出节点29和34(HOP都为4)的能量消耗比较均衡,更多类似的实验(由于篇幅限制,未列出)可以验证本文算法具有较好的能量均衡效果.(2)整体性能表现.随着时间推移,可能会有更多的BFNs参与数据转发,使得网络后期数据转发跳数、能耗等剧增,从而影响网络整体性能.但实验表明在整个网络生命期内只有很少的BFNs参与数据转发,这是因为靠近Sink的邻节点的能量容易耗尽,这也是传感器网络中一个普遍的难题.在以70个节点分布为例的实验中,当第47个数据包到达节点67时(74.1×100ms),节点67所有的PFNs失效,这时它的BFNs开始转发数据,同时67的PFN_NEXT变为FALSE,以保证它将不会成为其它节点的PFN.同样地,在148.8×100ms时,节点17和18的PFN_NEXT同时被置为FALSE,并分别启动各自的BFNs工作,其它节点按照算法2转发数据,直到网络生命周期结束为止(此时,Sink节点总共收到109个数据包,如图18),网络的转发跳数和能耗的整体性能表现试验结果分别如图16和图17所示,网络生命期内,只有少数几个BFNs参与了数据转发.Page11(3)参数ω对能量均衡和拥塞避免的影响.在Sink节点收到一定数量的数据包(本实验为50个DPs)时,分别选取不同的ω值,考察网络的能量均衡和拥塞避免表现.如果ω值较小,则能量均衡性能较差,如图19,随机考察中间节点29和34,它们的剩余能量并不均衡,但此时拥塞避免效果更好,如图21,在不同的网络中,ω=0.2的拥塞总延时都比ω=0.8时更小.反之ω取值较大,能量均衡性能就会较好(如图20),但拥塞避免效果会更差(如图21),这说明根据具体的应用要求,通过调整HLC模型参数,可以满足能量均衡或拥塞避免的不同需求.6结论本文为实时响应物联网提出一种新的基于查询的数据转发方案(PFNs/BFNs方案)和算法(P/BDF及其改进算法).PFNs方案利用广播的QM(不增加额外开销的情况下)为每个节点建立最快速的查询结果返回路径,很好地解决了转发断路额外开销和孤立节点处理耗时等问题;BFNs方案可以最大程度地延长网络生命周期.另外我们还尝试在PFNs方案中设定通信范围以节省能量和减少干扰,并给出了综合路径代价(HLC)模型以实现数据转发时节点能量均衡和拥塞避免.基于PFNs/BFNs方案和HLC模型,我们分别给出了贪婪的分布式数据转发算法(P/BDF)及其改进算法(IM-P/BDF),最后我们通过大量的仿真实验验证了本方案和算法可以实现非常快速的数据转发,同时具有良好的能量有效性和传输可靠性.在整个网络生命期内,BFNs很少参与数据转发,一般情况下PFNs可以完成数据转发任务,这是因为影响网络生命期的主要原因是靠近Sink的传感器节点的能量最容易耗尽,而这种Sink周围的能量空洞(这时Sink成为孤立节点)问题是传感器网络中的一个普遍存在的难题.虽然本文的改进算法(IM-P/BDF)可以节省能量,但会增加少量的数据包,从而会一定程度地影响到查询实时响应效果.所以未来工作的一个方向是,设计更好的路径代价更新方法来减少路由消息,以实现在不增加查询响应时间开销(与P/BDF比)的情况下节省能量,另外,还可以将本文提出的方案应用到三维空间下的实时响应物联网中.
