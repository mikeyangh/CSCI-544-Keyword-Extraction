Page1劣质数据库上阈值相似连接结果大小估计张岩杨龙王宏志(哈尔滨工业大学计算机科学与技术学院哈尔滨150001)摘要劣质数据普遍存在于现代数据管理系统中,严重影响了数据的质量,从而降低了数据的实用性以及数据的价值,这为数据管理带来了新的挑战.当前,已经有不少管理劣质数据的数据模型被提出,实体关系数据模型是其中一种,其中每条元组表示一个现实世界中的实体.该模型允许劣质数据的存在,给出了衡量数据质量的方法,并且可根据用户对结果质量的需求给出达到一定质量的查询结果.鉴于该模型的特点,传统的查询代价估计方法不再适用,需要新的代价估计技术.文中研究如何估计连接操作结果的大小,提出了在应用局部敏感Hash算法对属性值聚类的基础上,再进行采样估计的方法,并且在聚类过程中考虑数据质量对查询结果的影响.与传统随机采样方法对比,实验结果表明文中估计方法有更好的准确性.关键词代价估计;采样估计;劣质数据;数据质量;阈值1引言数据质量[1]问题已经在很多研究领域引起了人Page2所谓劣质数据主要是指错误的、不确定的、不一致的以及重复的数据.研究表明,大部分数据库中都含有劣质数据.例如,有调查报告[2]指出超过65%的零售商库存记录数据库中的数据是不精确的.劣质数据给企业带来的后果是严重的.有错误、重复、不精确或者不一致的数据会导致错误的业务决策、不好的客户关系以及无效的营销策略等,从而给企业带来巨大损失.文献[3]指出每年美国各企业因为劣质数据所带来的损失高达6000亿美元.因此,需要有新的技术来处理劣质数据,降低劣质数据的危害.目前,处理劣质数据的方法主要集中于数据清洗[4]和数据修复[5].数据清洗是指检测并移除数据库中的错误数据,从而提高数据质量.数据修复是指检测数据库中错误或不一致的数据,通过给定的规则(如条件函数依赖规则等)或者专家反馈来修复数据.然而,无论是数据清洗还是数据修复都存在一定的局限性.第一,多数情况下,数据清洗无法彻底除去劣质数据,而且如果清洗过度可能会导致信息的丢失;第二,数据修复过程中,不可能给出所有的规则,而且多条规则的修复结果可能会产生冲突.因此,数据清洗和数据修复均不能彻底除去数据库中的劣质数据,也就不能有效地解决劣质数据引起的问题.基于上述原因,一些研究人员开始考虑如何在不经过数据清洗和数据修复的劣质数据上直接处理查询,从中得到正确、一致的查询结果或者满足质量要求的查询结果.当前,已经有部分工作开始了对劣质数据库(含有劣质数据的数据库)上查询处理技术的研究[6-8].但是这些工作中,大部分都是针对特定的查询或者特定方法展开的.因此,为了更好地处理劣质数据,需要统一的模型来管理劣质数据.当前,已经有部分劣质数据模型被提出,其中应用最为广泛的是概率数据模型[9].概率数据模型可以表示非精确的数据,但这只是劣质数据的一种,而且从数据操作角度来看,这种模型无法描述数据操表2实体元组ID1(Wal-Mart,0.67),实体关系数据模型通过实体识别和清洁度巧妙地表示了劣质数据.该模型利用了实体识别的结果,每条元组表示一个实体.因此,该模型中的所有查询操作的对象均是实体;相反地,概率数据模型中的查询操作针对的是所有的可能世界实例,而在所有可作对操作结果质量的影响,更重要的是,应用概率数据模型的数据库在执行查询的过程中,会产生所有的可能世界实例,这将导致数据规模的指数增长,从而降低查询处理效率.本文考虑基于实体的关系数据模型[10],在这种模型中,每条元组表示一个实体,每个属性值是不确定的,可能含有多个值,对每个值用一个清洁度来表示该值的质量.采取这种表示方式的原因在于,在实际应用中,对同一个现实世界实体的不同表示方法是劣质数据的一个重要来源.尤其在数据融合[11](信息集成)过程中,将会导致出现不一致的、不确定的或者重复的数据.在实体关系数据模型中,表示同一个实体的数据合并为一条记录,为不确定或者不一致的属性值赋予一个概率值,表示该值的清洁度(或质量,本文中,清洁度即表示质量,不加以区别).例1描述了这种表示方法.例1.表1是一个劣质数据片段.通过实体识别算法[12-13],可以判断元组1、3和6表示同一个实体.因此,可以合并这3条元组,得到一条实体元组(如表2).在合并过程中不删除任何数据,因为,根据这个数据片段只能判断“Name”取值更可能为“Wal-Mart”,但无法完全排除“Mal-Mart”.因此,我们保留所有可能取值,即属性取值是不确定的.为了描述每个可能取值的质量,赋予每个值一个概率值,表示该值的清洁度.如“Wal-Mart”在3条元组中出现了2次,则清洁度为2/3≈0.67,类似的,可以计算出每个可能值的清洁度,从而得到表2中的实体元组.IDNameCityZipcodePhnReprsnt1Wal-MartBeijing9001580103389Sham2CarrefourHarbin2001680374832Morgan3Wal-MartBJ90015010-80103389Sham4Wal-martHarbin2004070937485Sham5CarrefourBeijing9001583950321Morgan6Mal-MartBeijing9001580103389ShamZipcode(90015,1.0)(80103389,0.67),能世界实例中会有多个实例表示的是同一个实体.现实应用中,很多情况下,用户查询希望得到的是实体结果,而不是同一个实体的多种不同表示.例如,表2表示的是各地区超市基本信息,如果在该表中查找企业法人代表(Reprsnt)为“Sham”的超市,则Page3概率数据模型会产生并返回8个可能世界实例(如表3所示),但这8个实例实际表示的是同一个超市,而实体关系数据模型只会返回一个超市,显然这更符合查询的期望.因此,与概率数据模型相比,该模型在查询处理过程中不会产生所有的可能世界实例,也就不会导致数据规模的指数增长,从而提高了查询处理的效率.IDNameCityZipcodePhnReprsnt1Wal-MartBeijing9001580103389Sham2Wal-MartBeijing90015010-80103389Sham3Wal-MartBJ9001580103389Sham4Wal-MartBJ90015010-80103389Sham5Mal-MartBeijing9001580103389Sham6Mal-MartBeijing90015010-80103389Sham7Mal-MartBJ9001580103389Sham8Mal-MartBJ90015010-80103389Sham考虑到实体关系数据模型的特点,每个属性值是不确定的,可能还有多个取值,而且都有对应的清洁度,现有的查询优化方法不再适用.因此,我们需要新的查询优化技术.作为查询优化的基础,如何准确估计一个数据操作的结果大小是十分重要的.考虑到连接操作是数据库中的重要操作之一,本文着重研究如何估计实体关系数据库中相似连接操作的结果大小.当前已经有很多工作研究连接(主要是等值连接)结果大小的估计[14-16],主要是应用采样进行估计,如自适应采样(Adaptivesampling)[14]、双重采样(Bifocalsampling)[15]、交叉采样(Crosssam-pling)[16]等.其中部分方法可以应用于相似连接,但是无法保证采样结果适用于不同的相似度要求.例如,文献[17]中指出,对DBLP数据集合进行自连接时,如果相似度阈值设为0.9,则连接结果的选择率只有0.00001%.这种情况下,上述采样方法很难抽取到可以连接的元组对,从而无法给出准确估计.针对相似连接估计算法[17-18]也已经有部分工作,但这些算法相对于实体关系数据库均不太适用.主要原因有两点.第一,现有算法中相似连接的属性值是确定的,而实体关系数据库中属性可能包含多个值,是不确定的;第二,实体关系数据库中引入了清洁度的概念,而现有算法中均没有这一概念.基于上述分析,本文提出了新的相似连接结果大小估计算法.考虑到如果先对相似元组加以聚类,然后在聚类集中采样可以提高采样的质量.因为即使相似度阈值较高,在聚类集中也能以很大概率采样得到满足相似度要求的元组对.因此,本文首先应用局部敏感Hash算法(LocalitySensitiveHas-hing,LSH)对不确定属性值进行聚类,然后在聚类集中采样估计相似连接的结果大小.鉴于实体关系数据库的特点,本文提出了基于清洁度的局部敏感Hash聚类算法,在聚类过程中,充分考虑了实体关系数据模型中属性取值的不确定性以及不同取值的清洁度的影响.本文的主要贡献如下:(1)提出了一种适用于实体关系数据库的基于清洁度的局部敏感Hash聚类算法.该算法可以把相似的不确定属性值聚集在一起.(2)提出了一种基于相似聚类的采样估计算法,能够更加准确地估计相似连接的结果大小.(3)通过实验证明,本文的估计算法可以得到比现有方法更高的估计准确率.本文第2节介绍实体关系数据模型以及相似连接的相关概念;第3节给出基于采样的相似连接估计算法的框架;第4节提出基于清洁度的局部敏感Hash聚类算法;第5节给出实验结果和分析;第6节对本文进行总结.2相关定义2.1实体关系数据模型第1节中已经简单介绍了实体关系数据模型,本节中我们通过几个概念定义该模型.首先给出不确定属性值的概念,正如第1节介绍的,在实体关系数据模型中,属性值是不确定的,包含多个可能值.定义1给出了不确定属性值的定义,它不仅包含所有的可能值,也包含其对应的清洁度,而且一个不确定属性值的所有可能值的清洁度之和为1.然后,我们给出了实体的定义,实体是实体关系数据模型中的基本存储单位,是多个不确定的属性值的集合.定义1.不确定属性值.一个不确定的属性值是一个集合A={(v,p)|v是某个可能的取值,p是该可能值对应的清洁度}.定义2.实体.一个实体是一条元组,可以表示为一个二元组E=(K,A),其中A是不确定属性值的集合,K是主键集合,它可以唯一确定一个实体(如实体ID号).表2给出了一条实体元组,包含主键ID和5个不确定属性值,每个不确定属性值都包含一个或多个可能取值,而且多个可能取值对应的清洁度之和为1.有了这些概念,我们可以给出实体关系数据库上的相关操作的定义.Page4本文主要考虑实体关系数据库中的相似连接操2.2阈值相似连接作,估计其结果的大小.相似连接是在两个元组集合中选择出满足相似性下界的元组对.当前已经有很多衡量相似性的方法,应用较广泛的有:编辑距离(Editdistance)、Hamming距离(Hammingdistance)、杰卡德相似度(Jaccardsimilarity)以及余弦相似度(Cosinesimi-larity)等.本文考虑的是基于编辑距离的相似连接.对于给定的两个字符串s和t,s和t的编辑距离ed(s,t)是指从s变为t所需要的最少的编辑操作(插入、删除和替换)次数.考虑到实体关系数据库中,属性值都是不确定的,可能含有多个取值.本文给出相似连接定义如下.定义3.相似连接.给定两个不确定属性值集合R和S以及编辑距离阈值k,R和S的相似连接是指选出所有的属性值对(r,s),其中r∈R,s∈S,而且r和s满足至少存在一组可能取值vri和vsj,它们的编辑距离ed(vri,vsj)k,即{(r,s)|r∈R,s∈S,vri∈r,vsj∈s,s.t.ed(vri,vsj)k},其中vri表示不确定属性值r的第i个可能取值.例2.表4给出了一组不确定属性值集合R和S.若编辑距离阈值k设为3,则相似连接结果为{(r1,s1),(r2,s2)}.因为ed(Wal-Mart,Wal-mart)=13,ed(JohnStrauss,JohnStrauss)=03.表5给出了连接结果.r1r2ID集合R1(Wal-Mart,0.67),2(JohnSmith,0.8),(JohnStrauss,0.2)由于实体关系数据库中,所有可能值都有对应的清洁度,所以,所有相似连接结果也都会有一个清洁度,表示该结果的质量(反映了结果的价值),如表5所示.实际应用中,多数情况下,我们只对清洁度比较高的结果感兴趣,对于较低清洁度的结果可以忽略.在本文中,只考虑达到一定清洁度要求(不低于某个阈值θ)的连接结果,本文称这样的连接为阈值相似连接,其定义如下.定义4.阈值相似连接.给定两个不确定属性值集合R和S,清洁度阈值θ和编辑距离阈值k,R和S的阈值相似连接是指选出所有属性值对(r,s),r和s连接结果的清洁度不低于θ.即阈值相似连接结果集合可表示为(r,s)∑ed(vripri代表不确定属性值r的第i个可能取值对应的清洁度.例如,如果清洁度阈值θ设为0.3,那么表4中的两个集合R和S的阈值相似连接结果为{(r1,s1)}.(r2,s2)不再属于连接结果,因为对于(r2,s2)有∑ed(vri0.2<0.3,即该结果不满足清洁度阈值要求.的大小,下一节给出估计算法的基本框架.3估计算法框架本文主要考虑阈值相似连接,估计其连接结果本节给出估计算法的框架描述.阈值相似连接的特点是当相似度阈值较小(即编辑距离阈值较大)而且清洁度阈值也较小时,连接结果大小会接近于n2(n是连接集合的大小),反之,连接结果集比较小.当前已有的连接结果大小的估计方法主要是基于采样的方法.这些方法中部分可以应用于本文所考虑的阈值相似连接估计,但在应用到这个问题时有一个显著缺陷:只适用于阈值比较小,连接结果集合较大的情况.当阈值较大,连接结果集合较小时,就无法保证估计效果.针对一般采样的缺陷,文献[17]提出了一种基于局部敏感Hash(LocalitySensitiveHashing,LSH)的采样方法用来估计相似自连接结果大小.文献[17]主要解决向量(或集合)相似连接问题,其主要思想是应用局部敏感Hash算法把相似的向量(或集合)Hashing到相同的桶中,然后分两种情况进行采样.一是从相同的桶中进行采样估计结果大小;二是从不同的桶中进行采样估计结果大小,两者结合可得到较准确的估计值.在这种方法中,即使取较大的相似度阈值,从同一个桶中的采样满足阈值的可能性也比较大,因为同一个桶中的对象都是比较相似的,从而可以保证估计的效果.虽然这种方法可以提高相似度阈值较高时采样方法的估计准确度,但是该方法只适用于属性值为Page5单个向量(或集合)时的相似连接估计.因此,对于本文考虑的实体关系数据库中阈值相似连接不太适用.这主要体现在三个方面.一是在实体关系数据库中,每个属性值有多个可能取值,在聚类过程中,要同时考虑多个取值的影响;二是实体关系数据模型中增加了数据的清洁度,那么即使有相同的可能取值,但是对应的清洁度不同,也会产生不同的连接结果;三是文献[17]中的方法针对的是相似自连接估计,而且其采样方法可能会产生重复的采样.考虑到基于聚类采样的方法可以解决相似度较高时,一般采样方法的缺陷,本文的估计算法正是以此为基本框架.为了解决其不足,本文提出了基于清洁度的局部敏感Hash聚类算法.该算法不仅考虑了每个属性值的多个可能取值,而且还考虑了不同取值对应清洁度的影响,例3展示了该算法的优点.其次,为了避免重复采样,本文采用无重复随机采样方法.例3.考虑两个不确定属性值:t1:{(Robert,0.9),(Bob,0.1)}和t2:{(Robert,0.1),(Bob,0.9)}.如果应用文献[17]中的方法分别考虑所有取值,那么t1和t2将会分别被计数2次,而本文算法将会综合多个取值,对t1和t2只计数1次.其次,文献[18]中的方法无法反映不同取值清洁度的影响,则无法区别t1和t2.而实际上,如果给定t3:{(Robert,1)},编辑距离阈值为2,清洁度阈值为0.3,则仅(t1,t3)满足连接条件,(t2,t3)并不满足.所以,t1和t2仅取值相同,而实际代表的属性值并不相同,本文的算法则可以在聚类过程中区别t1和t2.的基本框架.算法1给出了阈值相似连接结果大小估计算法算法1.JoinEstimation.步骤1.数据预处理输入:不确定属性值集合R和S输出:集合R和S的聚类结果集合//P、C分别表示相似对集合、聚类集合1.PR←LSH_Quality(R)/返回R中所有的相似对/2.PS←LSH_Quality(S)3.CR←Clustering(PR)/返回R的聚类结果集合/4.CS←Clustering(PS)步骤2.采样估计输入:不确定属性值集合R和S的聚类结果,相似度阈输出:集合R和S的阈值相似连接结果大小估计值N//SR、SS表示采样集合1.SR←Sampling(CR)2.SS←Sampling(CS)3.N=04.FORiFROM1TO|SR|/SR中每一个采样集合/5.FORjFROM1TO|SS|/SS中每一个采样集合/6.n=07.FOREACHpair(r,s),其中r∈SRi,s∈SSj8.IF∑sim(vri9.n++10.ENDFOR11.N+=|CRi||CSj|n/(|SRi||SSj|)12.ENDFOR13.ENDFOR14.RETURNN框架分为两个部分:首先对数据集进行预处理,把相似的不确定属性值聚集在一起;然后再从聚类集中采样估计连接结果大小.采样函数Sampling()采用随机采样,从每个聚类中随机采样组成样本集合,在该样本集合上做阈值相似连接,估计连接结果大小.即,如果R中第i个聚类CRi的采样集合SRi与S中第j个聚类CSj的采样集合SSj连接结果大小为n,则CRi和CSj连接结果大小估计值为|CRi||CSj|n/(|SRi||SSj|).分别估计不同聚类连接结果大小,相加即可得到整个集合连接结果大小的估计值.对于聚类函数Clustering(),本文以局部敏感Hash算法为基础提出了基于清洁度的局部敏感Hash聚类算法,下一节我们给出该算法的详细介绍.4基于清洁度的局部敏感Hash聚类局部敏感Hash聚类算法是本文估计方法的核心,本节讨论该聚类算法,通过该算法计算出所有的相似对,然后应用该相似对结果进行聚类.首先我们简单介绍局部敏感Hash算法,然后讨论如何在实体关系数据库中应用该算法,同时考虑所有的可能取值以及清洁度的影响,最后给出聚类算法.4.1局部敏感Hash算法局部敏感Hash算法最早由Indyk和Motwani提出[19],用以解决高维空间的k-NN(kNearestNeighbor)问题.算法的主要思想是:对于给定的高维向量集合,选择一族局部敏感Hash函数,如果两个向量夹角越小(越相似),那么它们对应的Hash值就越有可能相近.从而可以根据向量的Hash值来判断向量是否相似.文献[20]对局部敏感Hash函数做了详细描述,并给出定义如下.定义5.局部敏感Hash函数.给定一族HashPage6函数H,如果对于任意两个向量狌,狏∈Rm,h∈H都满足则称其为一族局部敏感Hash函数,其中sim(狌,狏)为相似性衡量函数.对于给定的m维向量集合,文献[20]给出了一种选择敏感Hash函数的方法:随机选择一个m维向量狏,定义敏感Hash函数如下:然后对于给定两个向量狏和狌,有如下公式:如果取相似度函数为余弦相似度,那么夹角越小,余弦值越大,两个向量就越相似.因此,根据等式(1)和(2),该Hash函数符合定义5.Goemans和Williamson在文献[21]给出了等式(1)的证明.为了提高Hash函数的准确率,在实际应用中,一般选取多个随机向量,然后分别应用Hash函数得到0/1值,从而可以把一个高维向量转化为一个0/1串.即如果选取d(dm)个随机向量,那么每个m维向量就转化为长度为d的0/1串.根据文献[22],有如下公式:P(h狉(狌)=h狉(狏))=1-hamming_distance(狌,狏)其中hamming_distance(狌,狏)表示狌和狏的Ham-ming距离.两个0/1串的Hamming距离等于两者相同位置不同取值的个数.如1011101和1101111的Hamming距离为3.根据等式(1)和(3)可得sim(狌,狏)=1-hamming_distance(狌,狏)因此,根据式(4),可以把判断两个向量是否相似的问题转化为计算两个向量对应0/1串的海明距离.如果海明距离小于某个阈值l,则两个向量相似,反之,则不相似.而计算两个0/1串的海明距离是快速高效的,因此,通过局部敏感Hash算法,可以快速计算出所有的相似向量对.在下一节中,将给出如何在考虑多个可能值和其对应清洁度的同时,应用局部敏感Hash算法计算所有不确定属性值相似对.4.2基于清洁度的Hash算法4.1节已经介绍了局部敏感Hash算法,但该算法是针对高维向量的,如果要在本文的问题中应用该算法,需要将每个不确定属性值转换成一个向量,同时还要考虑不同取值清洁度的影响.本节主要讨论如何在考虑不同取值的清洁度的影响下,把一个不确定属性转换成一个向量,并给出基于此向量的局部敏感Hash算法.4.2.1不确定属性值的向量化本文在计算相似连接时,应用编辑距离来衡量相似度.现有基于编辑距离的相似连接方法都是基于q-gram做的,q-gram是字符串中长度为q的连续子串,q-gram集合是一个字符串中所有q-gram的集合.显然如果两字符串之间的编辑距离越小,那么两个字符串共有的q-gram一定越多.例如:给定两个字符串s1和s2,如果ed(s1,s2)k,那么s1和s2至少公共的q-gram数为基于以上分析,实体关系数据库中的所有可能取值都有其对应的q-gram集合,每个不确定属性值也有其对应的q-gram集合(即该不确定属性值的所有可能取值的对应q-gram集合的并集).表6给出了一个实例.需要注意的是:在这些集合中,我们允许元素重复出现,如表6中集合S含有两个“ob”.{(Robert,0.6),(Bob,0.4)}S=S1∪S2:{Ro,ob,be,er,rt,Bo,ob}由式(5)可得,如果两个字符串s1和s2相似(ed(s1,s2)k),则至少含有max(|s1|,|s2|)+1-(k+1)q个公共q-gram,表示为L(s1,s2).再考虑到实体关系数据模型中相似连接(定义3)的特点:如果元组对(r,s)越相似,则它们对应可能取值的相似对(ri,sj)就越多.由此,可以得到如下性质.性质1.如果元组对(r,s)对应可能取值的相似对数量为m,那么r和s对应的q-gram集合的公共q-gram数至少为mL(ri,sj).从而元组对(r,s)越相似,对应的q-gram集合的公共q-gram数越多,对应的高维向量也应该越相似.根据性质1,假如对每个不确定属性值所有的q-gram进行计数,那么每个属性值便可以转换成一个高维向量,其中每一维对应一个不同的q-gram,向量的维度等于不确定属性值集合的所有不同的q-gram的种类数,本文称该过程为不确定属性值的向量化.需要注意的是,在实际向量化过程中,计数所有q-gram的代价较大,所以向量的维数会小于不同的q-gram的种类数.图1展示了一个向量化过程,其中不确定属性值为{(Robert,0.6),(Bob,0.4)},其向量化结果为(3,0,2,2,0).Page7但是上述向量化过程中没有考虑清洁度的影响,例如对于两个不确定属性值:{(Robert,0.9),(Bob,0.1)}和{(Robert,0.1),(Bob,0.9)},上述方法向量化结果均为(3,0,2,2,0),无法区别两个值.为了处理这个情况,考虑阈值相似连接(定义4)的特点,我们可以得到另一个性质.性质2.如果元组对(r,s)对应清洁度为p,由于p=∑ed(vripsj也越大,即元组对(r,s)对应清洁度越大,其公共q-gram所在的对应值的清洁度也会越大.根据性质2,我们可以对不确定属性值的向量化进行改进,加入清洁度的影响,使得到的向量能更准确地代表其对应的属性值.只需要在向量化的过程中,对每一个q-gram乘以其所在取值的清洁度再进行计数,这样便可以在向量化过程中反映出不同取值的清洁度.如图2所示,{(Robert,0.9),(Bob,0.1)}向量化值为(1.9,0,1,1.8,0),而类似的,{(Robert,0.1),(Bob,0.9)}向量化值为(1.1,0,1,0.2,0).可以看出,该向量化方法能更准确地反映不确定属性值.4.2.2详细算法由4.2.1节中的方法,可以把所有不确定属性值向量化.在此基础上,由4.1节中的介绍,我们给出详细算法,计算出所有相似对.算法2描述了这一过程.算法2.LSH_Quality.输入:不确定属性值集合S和Hamming距离阈值l输出:不确定属性值集合S中所有的相似对PS1.随机d个m维向量{狏1,…,狏d}2.FOREACHs∈SDO3.狏←vectorize(s)/把s向量化结果为狏/4.FOREACH狏i∈{狏1,…,狏d}5.ui←h狏i(狌)/局部敏感Hash函数/6.ENDFOR/向量狏转化为长度为d的0/1串/7.ENDFOR8.FOREACHpair(ui,uj)do9.IFhamming_distance(ui,uj)<lTHEN10.PS←(ui,uj)11.ENDFOR12.RETURNPS函数vectorize(s)用来将s向量化,返回一个m维向量.该过程是对q-gram集合中不同q-gram计数的过程,假定属性值对应的字符串长度均在一定范围内,则函数可在常数时间内完成,时间复杂度为O(1).函数hamming_distance(狌i,狌j)计算狌i和狌j的海明距离,由于每个不确定属性值均转换成长度为d的0/1,而且dm,所以该函数时间复杂度也是O(1).因此算法2的时间复杂度为O(n)+O(n2),即O(n2).4.3聚类算法通过第4.2节中的算法,可以得到所有相似对集合.本节给出聚类算法,应用相似对集合把所有相似的不确定属性值聚集在一起.从而可以在每个聚类集上进行采样,估计阈值相似连接的结果大小.考虑到已经得到了所有的相似对,如果把每个不确定属性值看作一个顶点,每个相似对看作顶点之间的边,即如果两个属性值相似,那么其对应的顶点之间有一条边.经过上述变换,可以把不确定属性值集合转化为一个图,该图反映了集合中所有不确定属性值之间的相似关系,从而把相似属性值聚类问题转化为图聚类(图聚集)或者社区发现问题.当前已经有很多工作研究图聚类问题[23]和社区发现问题[24-25],本文中,我们采用了社区发现中应用最为广泛的CNM算法进行聚类.该算法是基于模块度划分聚类的.模块度被用来衡量一个划分的好坏.通常一个好的划分会使聚类内部的边较多,而聚类之间的边较少.CNM算法中定义模块度如下:其中,eij表示为连接聚类i和聚类j的点的边数所占的比例,ai表示聚类i内部的边所占的比例.该算法的主要思想是:初始化聚类,不断合并聚类,使其沿着模块度增大最多或者减少最小的方向合并,直到最终合并为一个聚类.该过程结束后会得Page8到一个可分解的聚类结构树状图,对该聚类结构树状图的不同断开方式对应不同聚类划分,则其中对应最大模块度的聚类结构树状图断开方式就是最好的图的划分,即最好聚类结果.文献[25]给出了该算法的详细描述.通过CNM算法得到聚类结果后,我们就可以应用第3节中的方法进行采样并估计阈值相似连接结果的大小.5实验为了充分验证本文方法的估计效果,我们的实为了验证本文算法的估计效果,我们在Windows7操作系统上用C++实现了全部算法.实验运行的硬件环境为因特尔酷睿2处理器,主频为2.93GHz,内存2GB.软件开发环境为Code∷Blocks10.05.5.1实验数据以及评估方法验数据集合来自实体识别的结果.数据集合:首先我们采用数据生成系统生成了2个含有50K个不同实体的数据集合,其中所有的属性值均是长度不超过32的随机字符串.通过实体识别并合并表示同一个实体的数据,得到符合本文数据模型的两个实体数据集合.为了方便实验,我们选取包含p个可能值的不确定属性值作为实验数据集合R和S,其中p∈{1,2,3,4,5}.评估方法:本文采用平均相对误差来评估本文估计方法的效果.相对误差可用如下公式计算:其中C^为阈值相似连接结果大小的准确值,C为本文算法的估计值.5.2实验结果及分析在本文实验中,我们对比了本文的方法(LSH-S)和一般随机采样方法(RS).表7给出了实验中所涉及的参数默认值.实验基于编辑距离来衡量相似性,相似性计算公式如下:Hamming距离阈值l5.2.1算法效率实验表8给出了实际阈值相似连接时间与本文采样估计时间的对比.需要注意的是:在实验过程中,两者只采用了简单的优化过滤操作,但这并不影响估计的准确度.由表8中数据可以看出采样估计时间远远小于实际连接操作执行时间,均不超过1s,相对实际连接操作执行时间可以忽略.表8实际操作执行时间和采样估计时间对比数据集采样估计时间/s实际操作时间/s两者比值/%5K0.0918K0.17210K0.22820K0.8195.2.2数据集合大小的影响本实验中,我们考虑数据集合大小对算法估计效果的影响.我们从实验数据集合R和S中选取适当数量的不确定属性值组成不同大小的数据集合,包含不确定属性值的数量分别为5K,8K,10K,20K,50K.由图3可以看出,在采样比例不变的情况下,两种算法均在数据集合较大时,估计值更加准确.但相比之下,本文算法更加稳定,受数据集合大小影响较小.5.2.3相似度阈值大小的影响相似度阈值是相似连接中一个重要的参数.不同的相似度阈值会产生不同大小的结果集,阈值越小,连接结果越多,极端情况下,当阈值趋近于0时,连接结果趋近于n2.为了测试相似度阈值的影响,我们分别取相似度为0.1~0.9进行实验.图4给出Page9了实验结果.两种算法都在阈值较小时更加精确,随着阈值的变大,估计误差逐渐变大,但是很明显本文算法相对更加精确.5.2.4清洁度阈值大小的影响清洁度是本文所考虑的实体关系数据模型特有的参数,反映了连接结果的质量.质量越高,说明结果的价值越大,反之,价值越小,小于一定阈值可忽略不计.我们变化清洁度阈值从0.1~0.9来测试它对估计算法的影响.从图5中可以看出,随机采样算法随着阈值增大,误差逐渐变大,而本文算法则受清洁度变化的影响较小.这主要是因为本文算法在局部敏感Hash过程中,采用的是基于清洁度的Hash算法,充分考虑了清洁度在阈值相似连接过程中的影响.6总结实体关系数据模型是一种有效的管理劣质数据的模型.中间结果大小估计是查询优化过程中重要的方法.考虑到传统估计方法已不再适用于实体关系数据库,需要新的技术来估计中间结果的大小.本文针对阈值相似连接操作,给出了新的基于采样的估计方法.该方法首先通过应用局部敏感Hash算法对相似对象进行聚类,再在聚类结果中进行采样估计.实验结果表明,与随机采样方法相比,本文方法能给出更加精确的估计结果.未来工作包括在更多真实数据上进行进一步的实验以及将本文的方法应用到实体识别当中去.
