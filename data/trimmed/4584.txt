Page1绿色数据中心不完备能耗大数据填补及分类算法研究1)(武汉理工大学计算机科学与技术学院武汉430070)2)(佛罗里达大学电气与计算机工程系佛罗里达州美国32611)摘要随着云计算和大数据时代的到来,大规模数据中心在全球范围内得到了广泛的部署.但大规模数据中心的高能耗仍然是当今亟待解决的问题.为解决这一问题,通常采用太阳能等可再生绿色新能源为数据中心供电.绿色数据中心能够根据新能源的变化配合市电为数据中心提供高效、低能耗且稳定的电能供给,这是数据中心发展的趋势.文中针对数据收集不完善和断电等因素会造成一定程度的数据缺失情况,提出了一种基于完备相容类的不完备大数据填补算法,来填补数据中心的缺失数据;针对绿色数据中心能耗大数据的不稳定、间歇性和随时变化等特点,提出了一种基于离散弱相关的决策森林并行分类算法,通过对数据中心能耗大数据并行分类,来指导供电方式,以利于高效节能和延长电池寿命;此外进一步提出了一种增量更新决策森林的算法,来增量更新分类模型,该算法能够保障分类模型不断适应数据变化,防止分类准确率随时间而下降,从而避免电池频繁充放电,以保证稳定供电.整体来说,文中提出了一种数据中心能耗大数据管理模型,该模型针对大规模绿色数据中心的能源供给相关问题,运用不完备能耗大数据的填补、能耗大数据的并行分类、分类模型更新这三方面的技术方法,动态调控太阳能和市电供电端口,为数据中心提供高效、低能耗且稳定的电能供给.最后,采用绿色数据中心真实的能耗相关大数据集进行实验,实验结果说明文中提出的能耗大数据管理模型,能够帮助绿色数据中心有效管理太阳能和其他资源来配合市电提供稳定且充足的电能供应,从而为整个数据中心服务体系提供高效的能源服务.关键词绿色数据中心;能耗大数据;不完备大数据填补;并行分类;增量更新;大数据1引言随着云计算和大数据时代的到来,大规模数据中心在全球范围内得到了广泛的部署.但其高能耗问题却越来越突出.据不完全统计,2013年各类数据中心电能消耗量占全球年均总电能消耗量的0.5%.按当前的发展趋势,预计到2020年,数据中心年均电能消耗量将占全球年均总电能消耗量的1%[1].数据中心的高能耗造成了电能的浪费和系统的不稳定,同时也给环境带来了不利影响.降低数据中心耗电量最直接的方法是提高数据中心效率,而合理使用新能源是数据中心提高效率、降低运维成本的主要途径.IBM曾提出“绿色数据中心的含义是提高数据中心的能源效率”.因此,建立绿色数据中心是数据中心发展的趋势.绿色数据中心通常采用太阳能等绿色新能源为绿色数据中心供电.虽然利用新能源能缓解数据中心对资源环境的压力,但目前数据中心依然不适合完全脱离传统电网.如何协同配合传统电网和新能源的各自特点,并根据新能源的实时变化,控制市电供能端口和新能源供能端口以提供高效、低能耗的电能供给是如今所要面对的一个重要问题[2].针对这个问题,我们需要高效处理绿色数据中心产生的能耗相关大数据(文中简称能耗大数据).能耗大数据规模庞大(Volume),且由于新能源不稳定,能耗大数据会随时变化(Velocity).尽管能耗大数据很少涉及非结构化数据,但其需要考虑电流电压等信号、系统日志和新能源监控数据等诸多半结构化数据,以及断电等因素造成的数据不完备,使得数据形式更为复杂(Variety).有效分析和处理能耗大数据可减少电能消耗,这在当今计算规模庞大的云计算时代,具有极大的数据价值(Value).处理能耗大数据和控制数据中心电能供需要消耗电能并带来很高的操作开销,而且其伴随的电池的频繁充放电会给基础设施和环境造成负面影响.如何运用数据挖掘相关算法,对数据中心的能耗大数据用途进行分类,从而指导供电方式是绿色数据中心需要重点考虑的问题.然而,绿色数据中心因断电、设备故障、信息采集等因素造成的数据不完备问题,会严重降低分类效果,在数据属性密度低的情况下甚至影响分类模型的训练.此外,随着数据中心中数据不断变化,根据历史数据建立的数据模型的适应性会不断下降.因此,对不完备能耗大数据的处理以及建立更合理的能耗管理模型,逐渐成为绿色数据中心所面临的新的挑战.本文主要工作如下:(1)针对太阳能等新能源供电不稳定、间歇性、设备故障、信息采集等因素造成的能耗数据缺失问题,提出了一种基于完备相容类的不完备大数据填补算法.该算法扩展了粗糙集中的相容关系,保证数据的完备性,从而提高了分类的精度,并且并行实现了该算法以便高效处理大数据.(2)设计绿色数据中心的能耗管理架构,提出了一种适用能耗大数据的并行分类方法.本文改进了传统的随机森林算法,提出一种基于离散弱相关的决策森林分类算法对能耗大数据并行分类;并且进一步提出增量更新分类模型的算法,使得分类模Page3型能够适应系统新产生的数据,防止分类准确率随时间推移而下降.2相关工作2.1数据中心能耗模型为了分析和处理数据中心的能耗大数据,首先需要构建能耗模型.目前,关于数据中心能耗模型的构建,已有广泛的研究.林闯等人[3]将能量看作一种系统资源,从资源分配与任务管理角度分析了绿色网络的机制与策略,提出了基于随机模型的绿色评价框架,并对数据中心的能耗管理进行了理论建模和分析,提出了开销感知的作业调度算法[4].Fan等人[5]改进了一元回归能耗模型,提出了不同的能耗管理框架.Lee等人[6]则利用服务器的最小功率、最大功率及CPU的当前使用率来建立能耗模型.Bohra等人[7]提出了新的能耗分析工具Vmeter,对CPU、catche、内存与磁盘等系统组件分别进行监控,建立分解的四元线性模型.Dhiman等人[8]根据CPU利用率、IPC、MPC建立高斯混合模型,并采用概率建立了能耗与性能指标的关系.Choi等人[9]通过分析服务器整合、虚拟机迁移场景下的能源消耗,提出了一种动态环境下的能耗预测模型.罗亮等人[10]结合多元线性回归和非线性回归的数学方法,提出了一种适合云计算数据中心基础架构的服务器能耗模型.王巍等人[11]采用基于重载近似的大规模排队系统来对数据中心建模,设计了多数据中心间的负载路由机制,从而使数据中心能耗成本得到进一步优化.孙大为等人[1]系统地分析了实现绿色服务级目标的原理,提出了一种多维能耗模型M2EC,实现了云计算环境中能耗与服务级目标之间的均衡.叶可江等人[12]提出了一种针对虚拟化云计算平台的能耗建模方法.李翔等人[13]提出了面向多节点的热量管理机制的理论框架.此外,由于数据中心的运营离不开与电网之间的交互,具有新能源发电站的数据中心通常与智能电网合作,利用需求响应机制保障智能电网的稳定性[14].我们合作的佛罗里达大学IDEAL实验室设计了一种太阳能驱动的多核体系架构下的能耗管理方案SolarCore,该方案能凭据吞吐率和能耗的比值,利用DVFS技术动态调节每个核的负载,从而充分利用太阳能实现最优性能[15].IDEAL实验室的另一个研究成果iSwitch能在两组服务器之间动态调节负载,使其能够最大化利用间歇、不稳定的新能源,并根据能源波动合理的迁移虚拟机[16].在此基础上,Li等人提出了InSURE[17]、PDS[18]、Oasis[19]等多个能耗管理模型,为绿色数据中心运用能耗大数据提供高效稳定的能源供应服务提供了全新的思路.2.2不完备数据填补受新能源不稳定、间歇性、设备故障、信息采集误差等因素的影响,数据中心的能耗数据常常会出现不精确、不一致、不完整等问题.对于上述问题,不完备数据的处理方法显得尤为重要,其一般分为直接处理方法和间接处理方法.直接处理方法既不删除含有缺失数据的记录,也不填补缺失数据,一般通过直接扩充粗糙集模型进行处理.钱进和苗夺谦等人[20]为适应不断扩大的数据规模,提出了基于粗糙集理论的面向大规模数据的并行知识约简算法,并通过实验证明其具有良好的可行性和较好的扩展性.Yang等人[21]在基于优势关系的粗糙集模型的基础上,提出了基于相似优势关系的粗糙集决策方法,并将其应用于处理不完备信息系统.Yang等人[22]实现了粗糙集理论基于MapReduce的并行化.Zhang等人[23-24]比较了在处理大数据的不同系统中,使用MapReduce实现的多种基于粗糙集的处理方法的优劣.间接处理方法一般指数据填补,其特点是采用某种方法(如基于概率统计)将不完备信息系统转化成完备信息系统.武森[25]通过分析不完备约束容差集合,提出了一种基于不完备数据聚类的缺失数据填补方法.Gebregziabher等人[26]提出了一种用一系列可能值来填补缺失值,并进行综合分析得到总体参数的估计值的多重填补方法.Daniel等人[27]提出了一种通过估计值,结合不同的噪声,形成多组可选插补值的多重填补方法.Hong等人[28]利用上下近似提出了一种填补缺失值并同时提取规则的方法.ZhangkNN缺失数据填补算法.我们也曾提出了一种针对不完备数据的自动阈值调节的动态量化非对称相似关系模型[30].2.3大数据分类对能耗大数据进行分类和分析,能够指导数据中心的供电方式,提高能源利用效率.决策树是分类应用中采用最为广泛的模型之一.相比神经网络及贝叶斯方法,决策树避免了消耗大量的时间和上千次Page4的迭代来训练模型,且表现出了良好的分类效果,适用于不完备大数据集.因此,众多学者将决策树改进,应用于不完备大数据的分类问题.Franco-Arcega等人[31]提出了一种能够有效解决内存限制问题的决策树构建方法,提高了决策树构建算法的计算速度.王涛等人[32]设计并实现了一种基于线索化排序二叉树的增量模糊决策树分类算法fVFDT,该算法有效地降低了新样本插入及最佳划分节点选取的时间复杂度.Yang等人[33]提出了一种用于处理带有噪音的大数据的增量优化的快速决策树算法iOVFDT,很好地处理了不完备大数据分类的问题.而由多棵决策树组成的随机森林模型有着更为广泛的应用.王爱平等人[34]提出了一种增量式极端随机森林分类器,并将其应用于解决视频在线跟踪问题.Han等人[35]实现了基于MapReduce模型的可扩展随机森林算法SMRF,该算法更适用于大规模数据集在云计算平台上的分类.Wang等人[36]将基于Hadoop的随机森林分类算法应用于多元神经影像表型的全基因组关联分析.国内外研究机构已经对绿色数据中心的能耗模型进行了广泛的研究,也有较为成熟的数据处理方法.但针对具体绿色数据中心的实际能耗大数据处理所面临的数据缺失和模型更新等问题还有待进一步研究.因此,本文从数据中心能耗不完备大数据的填补、能耗大数据分类、分类模型增量更新3个方面分析和处理能耗大数据,构建更适合数据中心的能耗大数据管理模型.3能耗大数据管理模型3.1能耗大数据的定义能耗大数据主要由两个方面组成,首先是环境监控数据,即监控数据中心的内部环境与辅助设备所得,包括对内部气流的温度、湿度等数据的测量和收集;其次是资源监控数据,即监控服务器集群、网络设施等云计算资源的物理参数与运行状况所得[13].我们根据其获取方法将资源监控数据分成3种不同的类型.第1种类型:直接从计算机或操作系统的接口获取,例如CPU使用率、内存或网络带宽的使用状况等;第2种类型:对于部分数据,计算机与操作系统均未提供相应的接口进行测量,则需利用软硬件结合的方式或间接计算获得[37];第3种类型:通过集成在计算机主板、芯片上的传感器监控所得.为了准确地获取数据中心的运行状况,采集点越来越多,采样频率越来越高,普通的数据中心就达到百万甚至千万级.且数据中心广域分布、数据类型繁多,包括实时数据、历史数据、文本数据、时间序列数据等各类结构化、半结构化数据.海量的过程数据被保存下来,形成能耗大数据.这些数据中蕴藏着丰富的信息,对绿色数据中心分析运行状态、提供控制和优化策略、故障诊断以及知识发现和数据挖掘具有重要意义.3.2能耗大数据的特点能耗大数据不仅具备“4V”特征,即规模大(volume)、类型多(variety)、价值密度低(value)和变化快(velocity),而且这些特征又和其他大数据有所区别.能耗大数据规模大且阶段性变化:这些数据是由不同检测点按一定间隔阶段性收集的,常规SCADA系统包含上万个检测点,按采样间隔3s到4s计算,每年约产生1TB数据.能耗大数据范畴大且类型繁多:数据中心中与能源有关的数据都属于能耗大数据,它的数据种类众多,各类数据的处理频度及性能要求也不尽相同.能耗大数据价值密度低且变化快:在几十毫秒内会更新大量数据,历史数据会不断积累,单一数据中心的某一时间点的数据对于数据分析没有任何意义,数据价值密度低,因此,需要同时综合考虑历史数据以及更新数据.另外,软硬件、断电和能源不稳定等因素可能引起服务器、交换机、机架等故障,从而会导致能耗大数据出现一定程度的不完备[38].同时,RTU采集、电能表采集、通道状况、参数设置等多种因素也会影响数据中心能耗大数据的质量.这些缺失数据不仅会对数据中心的能耗有影响,还可能危及到整个数据中心的正常运转.所以,及时地处理能耗大数据,对数据中心的安全问题和数据中心减少能耗均有很大的益处[39].3.3能耗大数据管理模型针对绿色数据中心规模大、数据处理时效性强、数据监控来自多个不同渠道等特征,本文抽象出了如图1所示的绿色数据中心的能耗大数据管理架构,一般通过特定的监控设备完成对环境的监控,并在每个服务器上运行监控程序(例如可以是一个守护进程)进行资源监控.这些设备和进程通过一定的Page5标准规范与主节点进行通信,传输收集的数据.整个能耗大数据管理模型首先由主节点对原始数据加上时间戳,并对其进行预处理,然后对能耗不完备大数据进行填补处理,随后根据处理后的数据建立决策森林,并按时间戳不断使用新增数据集增量更新之图1绿色数据中心的能耗大数据管理架构4不完备大数据填补方法数据中心的能耗大数据不仅规模大,而且往往要面临数据采集不完善、断电、故障等因素造成信息大量缺失的难题.传统粗糙集理论一般只能处理完备的信息系统,为了使粗糙集理论能适应于能耗大数据的处理,通常采用模型扩充或数据填补方法.但模型扩展方法不能在保持数据标签唯一的情形下处理不完备数据,且空值过多时会失效.基于粗糙集的填补方法可以处理数据属性缺失量大的情况,但是该方法中求解相容关系以及相容类十分复杂,不适合数据规模大且阶段性变化的能耗大数据.因此,本文将相容关系扩展为完备相容关系,用于划分完备相容类,并在此基础上提出不完备大数据填补算法来填补数据中心能耗大数据中的缺失属性值.4.1不完备信息系统相关概念(1)限制相容关系及其划分在不完备信息系统I=(U,A,V,f)[40]中,属性集合RA,在U上定义一个限制相容关系LCS(R)={(x,y)∈U×U|a∈R,(fR(x)=fR(y)=)∨((QR(x)∩QR(y)≠)∧(fR(x)≠∧fR(y)≠→fa(x)=fa(y)))}.其中QR(x)={a∈前的决策森林模型,最后根据决策森林分类的结果(太阳能和市电端口开关数)制定电能供应策略,有效管理太阳能和其他资源配合市电提供电能供应,从而为整个数据中心服务体系提供高效的能源服务.R|fa(x)≠},显然,限制相容关系是自反和对称的,但不一定是传递的,属于广义的不可区分关系.限制相容关系克服了容差关系会误判相同己知属性值对象的缺陷,也克服了非对称相似关系无法划分一些具有大量相同己知属性值且直观上就可以判定为相似的对象的缺陷[40].(2)完备相容关系及其划分在一个不完备信息系统中,定义对象集X为不完备对象集,即x∈X,a∈A,fa(x)=;对象集Y为完备对象集,即y∈Y,a∈A,fa(y)=,则U=X∪Y.定义属性集C为条件属性集,D为决策属性集.对任一属性集合RC,在U上定义COM(R)={(x,y)∈X×Y|a∈R,fa(x)=fa(y)}的一个完备相容关系.用对象集CA(x)表示x的完备相容集合,其定义为CA(x)={y∈Y|(x,y)∈COM(A)}.U/COM(A)中的任意元素CA(x)为一个完备相容类,其定义为U/COM(A)={(IA(x),CA(x))|x∈X}.其中IA(x)叫做完备相容类的不完备部分,CA(x)叫做完备相容类的完备部分.由于具有完备相容关系的两对象来自不同数据集,可见完备相容关系是非对称的.满足完备相容关Page6系的对象必满足限制相容关系,以克服容差关系条件宽松的缺陷,从而避免完备相容集合的多次求解.4.2不完备能耗大数据填补算法本文提出基于完备相容类的不完备大数据填补算法(CompletingIncompleteBigData,简称CIBD算法)来填补数据中心的缺失数据.(1)不完备大数据填补算法流程首先,需要将数据集中的连续属性离散化.然后,将属性值缺失的不完备数据与完备数据区分开来(为保证分类准确性,去除决策属性缺失的记录),并分别生成属性值序列和倒排索引.接着,检测不完备数据是否存在完备相容类.若有完备相容类,根据最小描述长度原则(MDL),选择条件属性对决策属性预测的不确定性最小的属性值来填补缺失属性值.反之,选择缺失属性中频率最大的属性值来填补该缺失属性值.不完备大数据填补算法流程如图2所示.(2)不完备大数据填补算法描述不完备大数据填补算法主要由提取不完备数据和填补缺失属性两个步骤组成.提取不完备数据算法描述如算法1.算法1.提取不完备数据.输入:原始数据集DS,连续属性区间数t输出:不完备数据集IDS,部分完备数据集CDS,属性DS←Dispersion(DS,t);FOREACHdatarecorddINDSDOattr_flag=TRUE;IFattr_flag=TRUETHENENDRETURNIDS,CDS,List,Index;首先,该算法通过Dispersion(DS,t)离散化DS中的连续属性为t个区间.然后,creat_List(d)负责将数据记录d划分到完备数据集,并生成相应的属性值序列.delete(DS,d)负责从数据集DS中删除决策属性缺失的数据记录.而inverted(d)负责将条件属性缺失的数据记录d划分到不完备数据集IDS,并为它建立倒排索引,索引的key为缺失属性及记录id组成的元组.该算法对每个记录的全部属性进行缺失检测,并建立倒排索引,其时间复杂度为O(h×n),其中h为记录的属性个数(维度),n为读取的记录数.算法1作为不完备数据填补的预处理过程,能够有效的进行数据清洗,有助于针对性分析条件属性缺失的填补方法.该算法生成的倒排索引结构,可以用于记录缺失值所在属性列,以便并行填补,并且利于发现相容关系和完备相容关系.填补缺失属性值算法描述如算法2.算法2.填补缺失属性值.输入:不完备数据集IDS,部分完备数据集CDS,属性输出:完备数据集CDSFOREACHdatarecorddINCDSDOcount_file←count(d,List);ENDFOREACHdatarecordxINIDSDOIA(x)←getInd(x,IDS,index);IDS/IND(A)←divide(IDS,IA(x));Page7ENDFOREACHdatasetsXINIDS/IND(A)DOx←getData(X);FOREACHdatarecorddINCDSDOIF(x,d)∈Com(A)THENENDIFCA(X)=THENELSEENDENDCDS←DS;RETURNCDS;首先,该算法通过count(d,List)统计各属性值出现的频数,然后,getInd(x,IDS,index)负责找到数据记录x的等价数据集IA(x).divide(IDS,IA(x))负责将不完备数据集IDS划分为等价类.图3不完备大数据填补任务流程其中,系统从云平台的HDFS中读取数据,数据输出到HDFS都是并行执行的过程,避免因读写数据造成的任务等待,充分发挥数据并行优势.Job1的任务是分离不完备数据.对于执行Job1的节点,多个MapReduce任务分别检测数据集分片中属性缺失的情况.经Job1分离出的决策属性缺失的不完备数据,条件缺失的不完备数据以及完备数据分别提交给Job2、Job3和Job4处理.Job2负责统计决策属性缺失数据的记录ID,Job3为条件属性缺失数据建立倒排索引,Job4负责生成完备数据的属性值序列,3个任务在不同节点上并行执行.Job3和Job4getCom(d,List)负责找到d的完备相容集合.fill(X,Count_file)是一种填充缺失属性值的方法,负责使用频数最大的值,填充不具有完备相容类的记录的缺失属性值;fill(X,L)负责根据完备相容类填充缺失属性值.其中,填充序列L是通过getMinMDL(MDLA(X))获得的MDL值最小的序列.根据倒排索引,该算法并行地将数据记录划分为完备相容类,并分别在各完备相容类中并行计算填补的候选值,充分发挥了云平台的数据并行化优势.算法2是一个先划分完备相容类,然后在各完备相容类中分别填补缺失值的过程.缺失值计算的时间复杂度为O(n×k×r),整个填补算法的并行化执行的时间复杂度为O(n×k×r×c/j).其中,k为存在缺失值的条件属性的组合数k=2m-1,m为存在缺失值的条件个数,r为各完备相容类中的数据个数的最大值,c为产生的完备相容类的个数,j为分布式平台并行执行的任务数.4.3CIBD算法的并行优化CIBD算法架构在其云平台上,能够发挥数据并行、节点内Map和Reduce任务的并行以及节点间Job任务并行3方面优势,从而提高算法的时间和空间效率.具体任务流程如图3所示.将执行结果提交给Job5.Job5负责并行求解完备相容类,将存在完备相容类的部分提交给Job7,将不存在完备相容类的部分提交给Job8.Job7负责根据完备相容类填补缺失属性值,Job8负责根据属性值的频率填补缺失属性值,而Job6负责去除决策属性缺失的数据,Job6、Job7和Job8这3个任务可以并行执行.5能耗大数据并行分类数据中心主要通过控制太阳能供电端口和市电Page8供电端口,调整供电方式和能源使用方式.对能耗大数据的合理分类,可以根据分类结果指导供电方式,更为高效的使用太阳能等新能源,配置市电电能供给,从而避免数据中心中电能存储设备的频繁充放电,在延长设备寿命的同时保护环境.因此,本文设计了数据中心能耗大数据并行分类方法.5.1能耗大数据的分类算法改进策略能耗大数据信息量大、数据的维度高、数据的结构复杂,传统的分类算法在对其进行处理时会显得力不从心.随机森林分类算法训练过程复杂度低,预测算法的速度很快,对噪音有较好的耐受能力,且对高维数据分类问题具有良好的可扩展性和并行性.因此随机森林分类算法十分适用于处理能耗大数据.(1)随机森林分类.建立随机森林的过程实质是构建多棵决策树的过程.在建立决策树时,建树过程中会随机抽取若干个属性,计算最大增益属性作为结点.当使用随机森林分类时,每棵决策树都参与分类,并通过投票机制决定输入数据的分类类别[41].(2)改进策略1:选择合适的决策树及属性个数.使用随机森林对大数据进行分类时,决策树的个数会在一定程度上影响建立模型的时间效率(建模时间)、空间效率(结点数)和分类效果(准确率).因此,在对数据中心的能耗大数据分类之前,应该综合考虑属性个数,平台节点数以及数据规模,计算出较为合适的输入参数.(3)改进策略2:离散化连续属性.数据中心的能耗大数据往往具有多维连续属性,对连续属性进行离散化能够在一定程度上提高分类的准确率和可靠性.(4)改进策略3:弱相关化随机抽样属性组.在能耗大数据的分类过程中,由于太阳能的不稳定性,会导致属性值的关联具有一定的随机性.合适的属性选择方法,能提高能耗大数据的分类准确率和可靠性.因此,本文采用了相关性检测的方法.在保证随机抽样的前提下,选择与已抽样属性组相关性最小的属性元组,作为参与建树属性,从而降低决策树之间的相关性,提高决策树对领域的覆盖精度,保证随机森林模型更加合理.5.2基于离散弱相关的决策森林算法流程基于离散弱相关的决策森林分类算法(Discreti-zationandWeak-correlationbasedDecisionForestalgorithm,简称DWDF算法)是一种由随机森林改进得到的,面向能耗大数据的分类算法.该算法从参数选择、离散化连续属性和弱相关化随机抽样这3个方面改进随机森林算法,其算法流程图如图4所示.(1)计算决策树及属性个数.选择合适的决策树数目及属性个数是DWDF算法的预处理环节.首先,对属性个数m和决策森林个数T的计算.随机森林对输入属性十分敏感,我们通常将决策树选取属性的个数设定为其中[log2d]为不超过log2d的最大整数[36].决策树数目过少,会导致分类模型不准确,分类时间效率低;在决策树数目过多时,会出现一定程度的过拟合,不仅空间效率低而且分类准确率降低.综合考虑这些因素,需要尽量让各个Reduce任务经归约后,能够单独计算一个属性的熵.因此,这里将决策树数目设定为其中,node_num和re_num分别为云平台的Data_Page9Node节点个数和各节点统一设定的reduce任务数;m为决策树分类选取属性的个数.T的整数部分即为决策树数目,参数λ根据实际数据集进行设置.(2)离散化连续属性.离线化连续属性也属于DWDF算法中的预处理环节,该步骤需要根据输入的属性描述,找到连续属性(属性描述为N).然后,在生成描述性信息过程中,记录所有记录中连续属性的属性值,计算最值.选择其中分布较均匀的属性i,属性i的离散区间长度为其中,max_i和min_i分别为该连续属性的最大值和最小值,t为设定的离散区间个数(t的值依据数据集中离散属性的取值数确定).然后,根据离散区间长度计算连续属性的分裂点.属性i的第j个分裂点split_i_j=min_i+j×split_i_len,j=1,2,…,t-1.属性分裂点信息和其他描述信息一起存放在描述性文件中.在用于分类能耗大数据的决策树中,决策属性和太阳能的端口数相关.因此,初始的离散区间个数t0=λ×s.这里λ取1,s为太阳能端口数.为了减少数据节点的分裂次数,需要满足条件(1):离散后每个数据区间的属性值数目小于阈值threshold_1(threshold_1为Δt内数据记录总数的5%);为了防止区间值域过于分散,t需要满足条件(2):离散个数t小于阈值threshold_2(threshold_2为2s,s为太阳能端口数).考虑到数据中心的实时性,设置时间戳Δt为半小时.每隔Δt系统自动检测一次,若不满足条件(1),则t的个数增加1;若不满足条件(2),则t的个数减少1.(3)弱相关化随机抽样属性组.在完成前面的预处理后,DWDF算法会检测数据集容量是否小于阈值N,若小于则直接生成决策树;反之,计算最大增益属性A,然后将A分为连续属性和离散属性两个部分.在生成描述信息的过程中,计算数据集中各连续属性值的平均值,以及离散属性各离散值出现的次数.对于离散属性,采用TF-IDF(TermFrequency-InverseDocumentFrequency)思想来计算离散属性的相关程度,两组属性中离散属性相似程度计算公式为其中i为离散属性,C为所有离散属性的集合,i_tag为两组属性是否都包含离散属性i的判断值.若都包含i_tag取1,否则取0.num为属性的总个数,num_c为离散属性个数.对于连续属性,将其所有记录的属性均值,作为描述属性输入.这样可以使相关性检验和离散化成为两个独立的过程.连续属性间的相关性计算公式为其中,i为连续属性,N为所有连续属性的集合,i_tag为两组属性是否都包含连续属性i的判断值,若都包含i_tag取1,否则取0.v_i为连续属性i的均值.两组属性的相关性为W=WC+WN.计算抽样属性与各已建树属性的相关项的均值W.W越接近0,表示相关性越小,找到2m个随机抽样属性中与已抽样属性相关性最小的m个属性,作为随机抽样的属性元组,从而达到弱相关化随机抽样属性组的目的.5.3基于离散弱相关的决策森林算法描述本文提出的基于离散弱相关的决策森林算法主要包括生成决策森林和建立决策树两个部分.整体生成决策森林算法描述如算法3.算法3.生成决策森林算法.输入:原始数据集DS,连续区间数t,阈值N,属性数输出:决策森林DFde_file←describe(DS,t);FORi=1TOTDOdataset←bootstrap(DS);DF←Build_DecisionTree(dataset,de_file,m,N);ENDRETURNDF;其中,describe(DS,t)能够根据数据集及其属性描述创建描述性文件de_file,此外均值信息和连续属性的分裂点等额外信息也存入到de_file中.而bootstrap(DS)用于对原始数据集bootstrap抽样.核心函数Build_DecisionTree(dataset,de_file,m,N)会调用决策树算法建立一棵决策树.基于离散弱相关的决策森林算法的核心部分是建立决策树,见算法4.算法4.建立决策树算法.输入:原始数据集DS,描述文件de_file,属性数m,阈输出:决策树D_TreeIFthesizeofdatasetc_num<NDOR_attributes←getRandomAttr(DS,2m);Page10W_attributes←getWeakCorrelation(R_attributes,A=getMaxGain(DS,W_attributes);de_file←update(de_file,A);IFACTHENELSEENDELSED_Tree←returnCategory(Tree);ENDRETURND_Tree;其中,getRandomAttr(DS,2m)负责从数据属性集中,随机抽取2m个属性,而getWeakCorrelation(R_attributes,file,m)负责选择其中的m个相关性最小的属性元组.然后getMaxGain(DS,W_attributes)会计算其中的最大增益属性.计算完成后,通过update(de_file,A)将已分裂属性名放入描述性文件.divide(DS,A,k)将数据集划分为k个部分,分别建立k棵子树.divide(DS,A,t)有同样的作用,只是这里的t为连续属性的离散区间个数.returnCategory(Tree)负责返回决策树,其中返回叶子节点类别是DS中类别最多的一个.Build_DecisionTree(DS,de_file,m,N)的时间复杂度为O(h×n),其中h为记录的属性数.Build_DecisionTree算法的时间复杂度为O(n×2m×log(2m)).Build_Forest算法的时间复杂度为O(n×2m×log(2m)×T/j).其中,T为分类模型中的决策树个数,n为数据集dataset中的记录数,m为n的数据元组选择的属性个数,j为分布式平台并行执行的任务数.6增量更新决策森林算法增量更新分类模型是能耗大数据管理模型的一个重要步骤.数据中心中用于处理能耗大数据的虚拟机会动态迁移,以保证各数据中心充分利用资源.随着时间的推移,虚拟机的迁移以及环境因素的变化会导致分类模型的分类效果越来越差;且能耗大数据的规模庞大,读取全部数据,重建分类模型会造成大量的时间和空间的开销;而且数据中心更新速度快,能耗大数据变化大,历史数据不断积累.数据的价值会随着时间的流逝而不断下降,因此需要尽快地对最新的数据做出分析并对模型做出调整.6.1增量更新能耗大数据分类模型本文提出增量更新决策森林算法(IncrementalUpdatingDecisionForest算法,简称IUDF算法),来解决分类模型无法处理数据规模大,并不断更新的问题.该算法能利用新增数据,检验已经建立的决策森林模型中各个决策树的分类准确率,将分类准确率过低的决策树标记;然后将新增加的数据集作为训练数据集,重建相同数目的决策树来替代那些标记了的决策树.这样获得的决策森林分类模型能够不断更新以适应变化的能耗大数据.增量更新决策森林算法描述如算法5.算法5.增量更新分类模型.输入:决策森林DF,更新数据集UDS,准确率阈值N输出:新决策森林DFcount=0;FOREACHdecisiontreeTINDFDOaccuracy←classify(T,UDS);IFaccuracy<NTHENcount++;DF←deleteTree(DF,T);ENDENDIFcount≠0THENDF←Build_Forest(UDS,t,N,m,count);ENDRETURNDF;其中,classify(T,UDS)的作用是决策树T对更新数据集UDS进行分类;分类后得到的分类准确率与阈值N比较,如果它小于阈值,则通过deleteTree(DF,T)将对应决策树从决策森林中剔除.在检验完所有决策树后,如果有决策树被剔除了,则通过Build_Forest(UDS,t,N,m,count)重新建立相同数目的决策树.Update_Forest算法的时间复杂度为O(T×n+n×2m×log(2m)),其中T为分类模型中的决策树个数,n为UDS中的记录数,m为n的数据元组选择的属性个数.该算法通过检测新增数据集的Page11分类效果,检验已构建的分类模型是否适应系统环境的变化.6.2增量更新决策森林算法的并行化数据中心通常采用太阳能等不稳定的新能源辅助供电,因此对能耗大数据的分析和处理策略需要不断调整.由于决策森林模型由多棵决策树组成,不同决策树的使用互不影响,因此增量更新模型和决策森林分类都可以并行处理多棵决策树,其任务流程如图5所示.名称高性能PC普通PCcompute1_power_expected(×4)compute1_power_var(×4)表1Hadoop平台环境配置表硬盘750GB500GB表2真实数据集相关描述52535527155030表3FX属性描述性信息表属性说明产生数据的时间点计算节点1的功耗,一共有4个计算节点太阳能发电功率计算节点1的功耗均值(最近半小时),共4个太阳能发电功率的均值(最近半小时)电池电压均值(最近半小时)计算节点1在最近半小时的功耗标准差太阳能发电功能标准差,波动阈值100电池电压电池电流方向电池那里温度传感器状态值实际太阳能口的中输出功率实际太阳能所用端口数目7.2实验指标(1)填补准确率.考虑到待处理的不完备数据集存在离散属性和7实验分析7.1实验环境(1)实验平台.本文实验采用Hadoop分布式云计算平台.整个体系由一个JobTracker和若干个TaskTracker组成的,其中JobTracker负责分割任务并调度TaskTracker去执行.实验采用一台高性能PC作为运行NameNode和JobTracker进程的主节点Master,19台普通PC作为运行DataNode和Task-Tracker进程的从节点slaver,从而搭建20个结点的集群.实验平台配置如表1所示,每个普通PC上创建1台虚拟机每台虚拟机分配内存为2GB,硬盘200GB.Hadoop平台环境配置详见表1.(2)实验数据.本实验选取某绿色数据中心的日志数据作为真实的数据集.真实数据的取样数据表描述详见表2.FX数据集(某绿色数据中心系统能耗数据集)用于分类的属性描述性的信息如表3所示(其中属性描述栏中C为离散属性,N为连续属性,L为类标签).总功率连续属性,填补准确率应综合考虑两种情况.对于离散属性,若填补值和替换前的真实值相同,则填补准确;对于连续属性,由于计算的填补值和真实值必定Page12会存在一定的差异,因此填补值和替换前的真实值误差在一定范围内,则填补准确.因此填补准确率的计算公式如下:P0=∑i∈C其中C表示离散属性集,N表示连续属性集,nl表示缺失的属性个数.若离散属性i填补准确,则ti=1;否则ti=0.tag(x)为判断函数,若x>0或x=0,则tag(x)=1,否则tag(x)=0.vr表示真实值,v表示填补值,λ表示系数(本实验取1),Sj表示数据j的方差值(真实的大数据集中表示半小时内的方差值).(2)分类准确率.分类准确率通常作为分类效果评价的一个重要指标,本实验采用的分类准确率计算公式为其中N表示对象的总个数,bi表示正确分类到第i类的对象个数,k表示分类的个数.(3)生成结点数.由于云平台各节点共享资源池,生成较多的节点,不仅影响空间效率,而且过多节点的存入与访问图6不完备大数据填补准确率对比都会对整个集群的任务调度速度造成影响.本实验通过生成节点数目来间接衡量生成的分类模型的优劣.算法产生的节点数越少,所生成森林的规模就越小,分类模型就越好.(4)决策森林模型生成时间.决策森林模型生成时间是衡量决策森林的时间效率的重要指标之一,生成时间越少,则决策森林算法的时间效率越高.7.3实验分析实验1.填补缺失值.为了使得填补的准确率评价更为客观合理,首先使用随机函数,数据集FX中选择部分属性值,用“”去替代这些属性值,从而得到不同缺失率的不完备数据集(缺失率10%至70%).目前常用的填补缺失值的方法包括Meanbasedfillingmethod(MEAN)[42],FrequencyEstimatorbasedfillingmethod(FE)[43],ExistedRoughSetbasedfillingmethod(ERS)[44].因此本文分别采用MEAN、FE、ERS和本文提出的不完备大数据填补方法CIBD分别填补之前得到的不完备数据集,按照式(6)计算填补准确率,所得填补准确率结果如图6所示.Page13实验结果表明对于大数据中缺失属性值填补,填补准确率会随着缺失率的上升呈下降趋势.对比基于粗糙集的ERS填补方法和本文提出的CIBD算法,CIBD算法充分利用了数据集中的数据信息,能够明显提高填补的准确率.且随着数据集规模的扩大(从FX1到FX4)优势越来越明显.特别是对数据属性低(缺失率70%)的数据进行数据密补时,本文的填补准确率也能达到50%以上,比其他方法具有一定的优势.实验2.能耗大数据分类.本实验分为两个部分,第一部分针对不同数据集,记录决策森林中随着决策树个数t的变化,建立分类模型时间的变化,分类模型中结点个数的变化以及分类准确率的变化;通过上述变化分析t对时间效率(主要是建立模型的时间)、空间效率以及分类效果的影响.第二部分,选择第一部分得到的最优t,通过分类不同数据集,对比分析传统的随机森林算法RF,采用改进策略2的离散化随机森林DRF算法,采用改进策略3的弱相关化随机森林WRF算法以及结合两者的离散弱相关决策森林DWDF算法的分类效果.本实验首先分别从填补后的FX1~FX4数据集抽取70%做为训练集,余下的30%作为测试集.然后分别随机建立分类模型.根据决策森林的改进策略1,决策树最优个数为24(本实验中node_num=19,re_num=3,attribute_num=5,λ=16).建立的分类中决策树个数分别取6,12,18,24,30,36.上述每组实验均测试10次,取结果的平均值作为最终实验结果.第一部分实验结果如图7~图9所示.通过分析图7中的实验结果,可看出决策森林构建时间在决策树个数小于某一值(在上述实验中某一值为24).随决策树个数的增加,构建决策森林的时间趋于稳定,但当决策树个数大于某一值时,随决策树个数的增加,构建决策森林的时间直线上升.如实验结果图8所示,决策森林结点总个数随决策树个数的增加而增多.如实验结果图9所示,当决策树个数小于某一值(在上述实验中为24)时,分类准确率随其个数的增加而上升,一旦超过了该值,分类准确率下降,这是由于决策树个数过多,导致决策森林的过拟合所造成的.因此决策树个数取某一值时应正处于分类效率、时间效率和空间效率的平衡点.第二部分实验结果如图10、图11所示.Page14图10和图11中的实验结果显示,对于不同规模的大数据集(0.8GB,1.2GB,1.6GB,2GB),本文提出的基于离散弱相关的决策森林算法DWDF建立的分类模型,比随机森林算法RF,离散化随机森林DRF算法和弱相关化随机森林WRF算法生成的分类模型,分类准确率和可靠性指数都要高.实验3.增量更新决策森林分类模型.图12不同更新模型方法分类准确率对比本实验首先分别从填补后的FX1~FX4数据集抽取70%作为训练集,余下的30%作为测试集.对FX1~FX4数据集分别进行分析.以FX1为例,每次时间戳间隔为1h,从该时间段内FX1所在数据中心新增加的数据集DS_new中抽取70%数据加入训练集,剩余30%加入测试集,分别采用不更新NotUpdate(NU),根据DS_new数据新建决策森林NewForest(NeF),根据DS_new数据重建决策森林RebuildForest(ReF),采用增量更新算法(IUDF)更新模型4种方式处理.按相同方法分别处理填补后的FX1~FX4,测试3种不同方式的分类准确率随时间的变化.上述过程中每个数据集都进行10次分类模型的建立,取其分类准确率平均值作为最终实验结果.由于数据中心处理能耗大数据的虚拟机会随着时间的推移发生迁移,因此分类模型的分类准确性会随着时间的推移发生变化.图12(a)~(d)中的NU曲线表明,根据历史数据建立的分类模型准确Page15率会不断下降.NeF曲线表明,根据新增数据集建立的决策森林由于未考虑历史数据集FX,随着时间的推移,分类准确率波动很大.ReF和IUDF曲线表明重建决策森林模型和IUDF算法都能保证决策森林具有较高的且稳定的分类准确率,而且二者差别不大.因此对ReF和IUDF做进一步实验,比较两者的决策森林结点总个数和其平均建模时间,实验结果如图13和图14,表明ReF需要创建的结点总个数和更新时间明显多于IUDF.此外,ReF需要持续保持和读入全部历史数据不适合能耗大数据,而IUDF只需要调整根据历史数据建立的模型,其具有更好的扩展性.图13不同算法对决策森林结点总个数的影响图14不同算法对决策森林平均构建时间的影响8结论语绿色数据中心,在提供高效、稳定的电能供给的同时,也能够降低能耗、保护环境和节省成本,这是未来数据中心发展的必然趋势.本文根据绿色数据中心能耗大数据的特点,针对大规模绿色数据中心的能源供给相关问题,提出了一种数据中心能耗大数据管理模型:提出基于完备相容类的不完备大数据填补算法,保证了数据的完备性,降低了数据缺失对分类的影响;提出了基于离散弱相关的决策森林分类算法,对数据中心能耗大数据并行分类,用于动态调控太阳能和市电供电端口;进一步提出了增量更新决策森林模型算法,使得分类模型能根据实际数据的变化不断更新模型.本文研究通过分析和处理能耗大数据,有效管理太阳能和其他资源来配合市电提供稳定且充足的电能供应,为数据中心服务体系提供了高效的能源服务.今后,将进一步全面研究绿色数据中心的能耗评估体系和能源服务策略.
