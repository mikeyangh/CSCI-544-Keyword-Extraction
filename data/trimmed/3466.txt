Page1基于鲁棒估计的并行磁共振成像中部分数据重建算法黄鑫1)陈武凡2)冯衍秋2)1)(中国人民解放军总医院器械处北京100853)2)(南方医科大学生物医学工程学院广州510515)摘要部分傅立叶数据重建和多通道并行成像是两种有效的磁共振快速成像技术,两种技术都是通过减少梯度编码步数来缩短数据获取时间.结合技术相比于单项技术可以更加有效地提高扫描速度.但是,由于在部分数据恢复过程中由于共轭对称性的破坏会产生破坏数据并且带来相位偏移,使得在之后进行的并行重建过程产生误差,造成重建图像产生伪影.文中提出了一种新的约束重建算法去消除重建图像中产生的伪影.算法应用AM鲁棒估计的框架对破坏数据进行数据修正,很好地抑制了异常值对数据集造成的影响.实验结果显示文中算法达到了优质快速成像的目的,更具有实用性.关键词磁共振成像;部分傅立叶数据重建;并行磁共振成像;SENSE算法;鲁棒估计1引言成像速度是临床磁共振应用所关注的重要指标,因此快速成像一直是磁共振成像领域的研究热点之一.随着梯度场强已经接近极限,硬件的发展极大制约了扫描速度的进一步提高.为了加速成像,在临床应用中常常需要减少相位编码次数,来缩短数据采集时间以保持合适的信噪比.临床采用部分数据进行傅立叶重建(PartialFourier,PF)常应用Homodyne算法[1],它利用了低频数据的相位信息来校正整幅图像的相位偏移,算法已经成功重建出符合诊断要求的图像.近几年,随着多通道采集技术与并行成像算法的出现,使得成像不再依赖梯度性能的提高就可以大幅加快数据的采集.多线圈并行成像技术(ParallelImaging,PI)主要是利用相控阵线圈中单个相控阵线圈的空间敏感度差异来编码空间信息,降低成像所必需的梯度编码步数,从而获得更快的扫描速度.基于并行成像重建理论的算法已经被先后提出,其中获得临床广泛应用的算法主要有包括基于k-空间的GRAPPA(GeneRalizedAutocalibratingPatiallyParallelAcquisitions)方法[2]与基于图像域的SENSE(SENSitivityEncoding)方法[3].对于两种快速成像技术的结合,文献[4]中已经给出了成功的应用,King等人把部分数据的Homodyne算法与并行成像的SENSE技术进行了有效的结合,部分数据并行重建(PFPI)相比于单项技术可以更大幅度地缩短数据获取时间,又不会因为加大并行重建中的加速因子而大幅牺牲图像重建质量.但是,在结合的过程中,由于实际扫描数据的非共轭对称性会引入少量伪影和噪声,并且在之后的并行重建过程中被进一步放大,使得最后的重建图像会出现混叠伪影.针对这个问题,约束重建技术被引入来减少伪影.在文献[5-7]中都使用了同样的约束条件,作者根据k-空间数据满足Hermitian对称性的特点认定理想图像应为一幅实图像,根据这个特性引入了相位约束来修正重建结果.这类方法在一定程度上提高了重建图像的信噪比,同时也突破了并行重建过程中线圈数目受到加速因子的限制,但是应用在PFPI重建中对混叠伪影的消除效果并不十分明显;另一类正则化的方法[8]在参数选择上十分复杂,且合适的参数对重建精度的影响较大.作者讨论了应用在不同正则化参数λ数值下的重建误差.可以看出在参数选择恰当时重建图像能够得到理想的效果,但文中λ的选取仅是作者经验选择结果,并没有给出明确的解析表达.在本文中,作者提出了一种基于AM鲁棒估计框架下的AM-PFPI算法来解决原有PFPI算法的不足.文中应用鲁棒估计来处理PF重建时产生的噪声数据,在并行重建过程中把破坏数据看成观测数据样本中的异常值,应用了AM鲁棒估计与现有的SENSE算法相结合,最大程度上抑制了异常值对数据集造成的影响,以此来达到消除伪影改善图像质量的目的.2PFPI重建理论2.1PF重建与Homodyne算法临床应用中常需要采用部分数据重建技术来缩短扫描时间,用于重建的部分数据常常是丢掉一半的高频数据,直接进行补零重建会在重建图像中引入Gibbs伪影,所以重建时常依据k空间数据的共轭对称性来近似恢复缺失的高频数据.但是,由于实际中众多不理想因素的影响造成原始数据的共轭对称性遭到破坏,使得重建后的图像加上了一个空间相关变化的相位偏移.Homodyne算法有效地解决了部分数据重建遇到的问题.当缺失一半的高频数据时,部分k空间数据可视为高频部分乘以一个单位阶跃函数.算法通过将对称部分的低频数据进行低通滤波消除Gibbs伪影来统计图像相位信息:这里ms(x,y)为对称低频数据所生成的低分辨率图像,p(x,y)为相应统计的相位信息.然后高频部分数据mpk(x,y)进行高频加权,进行傅立叶重建后生成图像mpk(x,y)×w(x,y),再通过前面统计的相位信息p(x,y)消去重建后的附加相移并取实部,理论上可近似等于理想重建图像m(x,y),如式(2)m(x,y)=Re{p(x,y)(mpk(x,y)×w(x,y))}Homodyne重建利用了采集到的对称的低频数据获得的相位图信息来校正重建图像的相位误差,已经被临床证明是一种有效的部分傅立叶数据重建算法.2.2PI理论与SENSE算法多线圈并行采集技术中每个相控阵线圈都同时对物体接收信号,各自获取到欠采样方式下的k空间数据.此时采用欠采样k空间数据成像时,将得到减小视野的混叠(aliasing)图像.由于每个相控阵线Page3圈都有着截然不同的空间敏感度信息.这样就造成每个线圈所成的图像在同一位置有着不同的亮度差异,同时也相应带来额外的物体空间位置信息.PI重建公式的离散形式可表示为sl(kx,ky)=∑Nx-1这里sl(kx,ky)为第l个相控阵线圈采集的k空间数据,Cl(x,y)为第l个相控阵线圈在位置(x,y)处所对应的敏感度信息,ρ为待重建图像,(kx,ky)为图像空间位置(x,y)所对应的k空间坐标,Nx,Ny分别为图像在x与y方向上的采样点数目即重建图像的大小.SENSE方法[3]是由Pruessmann等人提出的一种基于图像域操作的并行重建方法.主要通过欠采样方式缩短扫描时间来进行傅立叶变换成像获得一系列混叠图像,然后利用多个相控阵线圈所成的图像结合各自线圈特有空间敏感度信息来消除混叠伪影产生一幅如同传统成像方式一样的全视野图像.SENSE重建用矩阵形式可以表达为这里,犛A为单个相控阵线圈所成的混叠图像,ρ为重图1不同快速成像技术下的k空间数据采样方式3AM-PFPI重建方法3.1AM鲁棒估计理论从第2.2节PI重建过程中可以看出,并行成像的求解可以归结为一个逆问题.由于在线性方程(4)中敏感度矩阵为犆病态矩阵[9],所以使得观测数据(线圈图像)中的微小扰动很容易使系统解产生巨大改变.在PF重建过程中由于数据的共轭对称性遭到破坏使得恢复数据引入少量噪声和伪影,而破坏数据会在之后的PI重建过程中进一步被放大,使得最终得到的重建图像包含有明显的伪影.这种含伪影的破坏数据我们可以把它看成观测数据集中的异常值.此时用LS估计得到解(5)是基于残差平方和∑ir2i最小下的解,这里残差定义为但是由于破坏数据和异常值的存在往往会造成大残建图像,犆为空间敏感度信息.通常情况下,在这个线性系统中要求加速因子小于相控阵线圈的个数,即R<L,这样式(3)中的方程组即为超定方程组,方程组的解通常为在最小二乘(LeastSquares,LS)意义下求得的解,那么所求的重建图像为犆H为矩阵犆的Hermitian转置.PFPI结合了上述介绍的两类快速成像技术,采取不同于常规的k-空间数据采样方式来达到最大程度地减少相位编码次数的目的.图1(a)给出了PF重建数据的采样方式,数据通过舍掉近一半的高频数据来减少数据获取量;图1(b)给出了PI的数据采样方式,数据中间部分低频数据采取全采样方式用来估计线圈的敏感性系数,其余部分的数据采取加速因子R=2的隔行采样方式,扫描时间可以节省将近一半.图1(c)为PFPI重建的数据采样方式,中间全采样的低频数据既用来估计PF重建中的相位图信息,又用来估计并行重建过程中的线圈敏感性信息.扫描时间近似约为原始的1/4.差的情况,而最小二乘解通常对具有大残差的数据点十分敏感,这些异常值能够破坏LS解[6].可见,基于LS意义下求得的解并不具有鲁棒性.针对上述问题,我们提出了一种基于鲁棒估计的重建算法.通过鲁棒估计对数据进行校正,使校正后的数据具有较高的可靠性,从而降低异常值对方程解的敏感性[10].鲁棒估计就是设计一种新的误差准则函数来最小程度上降低异常值的影响.本文选择AM鲁棒估计[11-12],它是一种结合了确定性退火程序的改进的M估计算法.M估计的核心就是通过引入代价函数g来对产生的大残差进行光滑约束,使得最优解变为在能量函数最小的指导下产生的解,即这里能量函数E(ρ)=∑ig(r)=2rd(r)的形式,其中d(r)为连接强度函数,充当权重的作用.Page4在LS意义下的解可以看成误差函数为标准平方的形式,即g(r)=r2,此时连接强度函数d(r)=1,所有数据点相当于等权重.但是从图2(a)可以看出,当r→时,误差函数随着残差的增大而无限增大.根据鲁棒估计理论可知,这种误差函数显然不具有鲁棒性,对大误差十分敏感.为了提高算法的鲁棒性,我们希望误差准则函数g(r)能容忍较大的数据误差,并能根据误差不同的局部特征采取不同的“平滑力度”减少其对解的影响,而这时的连接强度函数提供了一种自适应权重,根据数据点的残差来自动调整.所以代价函数g根据DA(DiscontinuityAdap-tivity)马尔可夫(MRF)先验模型,选取了如下的形式[11]此时如图2(b)所示,在小残差r1的时候,两种函数具有相近的函数值.但在大残差的位置点r2处,平方函数(A)同样具有很大的值,所以对估计产生了较大的影响.而新构造的误差函数则对大残差r2进行了很好的平滑约束,这样就有效降低了大残差对估计解的影响.为了求解式(6)应使∑i重建图像式(5)应变为犇为对角矩阵,对角线上的元素根据连接强度函数(9)求得,即犇=diag(d1,d2,…,di),这里,i为残差点数目.鲁棒估计中的一个重要问题就是需要极小的目标函数往往是非突的,这样就不能保证最终解能够收敛到全局最小值.因而算法要求初值估计具有较高的准确性,靠近全局最小值.AM估计就很好地解决了这个问题,它通过确定性退火算法引入了参数t,并使其在迭代求解过程中不断变化来改变代价函数g使其达到了自适应的效果,从而有效地解决了解容易陷入局部极值的问题.3.2算法描述AM-PFPI算法以构造的误差准则函数和最小为优化目标,以AM鲁棒估计算法为优化方法,其算法流程如图3所示,主要步骤描述如下:首先对获取多通道采集的部分k-空间数据应用Homodyne算法对采样数据进行恢复重建;其次把得到的图像应用SENSE技术对混叠图像进行伪影消除,在SENSE过程中运用了AM鲁棒估计的框架,迭代对数据进行修正,以此来降低其中破坏数据造成的影响,最后应用低频数据得到的相位图进行相位校正.值得注意的是:由于SENSE过程需要利用线圈的敏感度信息也就是B1场的非均匀性,所以应该在SENSE过程之后进行相位校正.最后,依据Homodyne算法理论取图像实部得到近似理想图像.4结果与讨论本节我们分别进行了两组实验对提出算法的有效性进行验证.第1组数据为真实采集的体模数据,数据采集方式为8通道并行方式采集,GE成像序列,图像大小为256×256.我们把获取到全采样方式的k空间数据进行隔行遗漏,并舍掉一半高频数据,模拟成欠采样方式下获取的部分数据(加速因子R=3.2).线圈的敏感性系数通过低分辨的参考图像获得(32×256).为了体现本算法在相同采样方式下重建图像伪影消除的优越性,我们给出了PFPI重建中King的方法重建结果作为对比实验;此外,Page5为了展示本文算法在快速成像中优质重建的特点,实验也给出了在相近加速因子情况下直接应用并行重建技术下的mSENSE算法的重建结果.图4是对体模数据进行重建的结果,图4(a)为应用并行全采样数据情况下采用平方和算法(Sum-Of-Square,SOS)重建结果近似作为参考图像;图4(b)为直接应用并行采集数据在加速因子R=4时的重建结果,重建方法为获得临床应用的mSENSE算法.从图像中可以看出由于在并行重建中加速因子受到线圈数目的限制,使得当R过大时图像质量受到了严重的破坏,图像中间区域被破坏,细节完全无法分辨,不能满足临床诊断需求.图4(c)为采用PFPI方式采样获取的部分数据应用King方法重建的图像.在图像中间区域箭头标记处可以清晰的看到有明显的混叠伪影存在.另外在图像感兴趣区域左下方图像十分模糊,影响了对细节的分辨.分析其原因在于由于部分数据重建产生的数据误差使得图4体模数据重建结果第2组数据为临床8通道头部相控阵线圈并行采集,采用FSE序列获得的脑部数据,图像大小为256×256,加速因子R=3.6,舍掉一半高频数据.线圈的敏感性系数通过中间全采样的低频数据重建图像得到(16×256).图5给出了真实脑部部分数据重建的结果,对比实验依然采用上述使用过的mSENSE算法和King的方法,同样得到了令人期待的效果,虽然从图5(e)、(f)的差图显示上看,结果并没有得到与图4体模图像那样明显的伪影消除效SENSE方法不能正确、有效地将混叠伪影消除,以至残留有明显的伪影.图4(d)给出了我们算法重建的图像,结果通过10次迭代得到.可以看出本文算法在采样时间相近的情况下图像质量要明显强于mSENSE算法,而相比与King算法重建体模图像的细节分辨率有了明显的提高,背景噪声得到了大幅度的消除,除去在箭头标记处仍残留有微小伪影外,在图像感兴趣区域内的混叠伪影基本得到了消除,图像质量得到了极大的改善.为了更加直观地展示本文重建结果在局部上的重建精度以及算法对伪影的有效抑止,我们把图4(c)、(d)两组重建结果与参考图像图4(a)分别做了差值操作,通过图4(e)、(f)的差图来体现.同样也可以看到本文的重建结果在灰度分布上更加接近参考图像,在感兴趣区域内的图像相似度更大,整体图像的误差得到了有效的平滑抑止,并没有出现突变的异常值.果,原因在于对于真实脑部数据而言,数据来源更加复杂,图像细节也更加丰富.但同样通过对比可以看出,在箭头标记的地方混叠伪影也都得到了一定程度的消除.由此可见,本文算法在数据获取时间相似的情况下图像质量要明显强于直接应用并行重建技术重建的结果;而无论在伪影的消除还是边缘的细节分辨上也要优于现有的PFPI方法,重建图像更加接近于参考图像,有助于临床诊断.为了定量比较重建算法的性能,我们选取了Page6图5真实脑部数据重建结果AP(ArtifactPower)作为测度[13](它主要反应了重建图像与参考图像的接近程度),对两种方法进行了量化比较,其计算公式如下:这里Irec为重建图像,Iref为参考图像表1给出了上述两组实验中,mSENSE、King与AM-SENSE3种算法的AP值统计.从数值上可以清楚地看到相对于mSENSE算法,两种PFPI方法在重建精度上都更加接近于参考图像,与King算法相比本文算法对伪影的抑制能力更强,两组实验AP值分别提高了约75%和20%.分析其原因在于,AM-SENSE算法利用鲁棒估计对破坏数据进行了平滑处理,减少了大残差的异常值,能够在保持图像边缘的同时很好地滤除图像中的噪声,保证了并行重建的准确进行,进而提高了图像质量.mSENSE算法King方法AM-SENS算法0.00685结论部分傅立叶数据重建与多通道并行成像的结合技术可以大幅度地减少梯度编码步数从而更加有效提高成像的扫描速度.本文基于这项数据采样技术提出了应用AM鲁棒估计的约束重建方法来降低在部分数据恢复过程中会产生的破坏数据对最终重建图像的影响,达到快速优质成像的目的.本研究实验结果显示,相比原有算法本方法可以有效消除图像中产生的混叠伪影,重建图像在细节分辨率上也有更好的表现.然而,本文也仅仅是对MR快速成像领域的一次初步探讨,随着PI技术的出现对MR成像产生的根本变革,如何进一步地结合现有的多种快速重建技术,提出和完善算法在今后也将有着巨大的研究空间.
