Page1可证明安全的可信网络连接协议模型马卓1)马建峰1),2)李兴华1)姜奇1)1)(西安电子科技大学计算机学院西安710071)2)(西安电子科技大学计算机网络与信息安全教育部重点实验室西安710071)摘要该文作者发现可信计算组织TCG提出的可信网络连接架构存在安全缺陷,攻击者利用这一缺陷可以发起一种平台替换攻击,攻击将导致可信网络连接过程中平台身份认证的失败和平台完整性校验错误.针对这一情况,文中形式化地给出了可信网络连接协议的安全目标.在此基础之上,为了使协议的设计和分析更具一般性和安全性,提出一种可证明安全的可信网络连接协议模型(TNC-PS),通过模型中的绑定器,可将理想环境下设计的完整性评估层协议,转化为实际环境下安全性相同的等价协议.从而在保持可信网络连接架构不变的基础上,避免其安全缺陷造成的影响.最后,利用TNC-PS模型设计了一个完整性评估层协议,该协议能够满足可信网络连接协议的安全目标.关键词可信网络连接;平台替换攻击;可证明安全模型;绑定器1引言随着计算机网络与信息化的不断发展,信息安全问题日趋复杂,系统安全问题,特别是计算机平台的开放框架所带来的威胁层出不穷.面对严峻的网络安全形势,传统的信息安全系统从架构和强度上已经难有大的突破.人们在信息安全的实践中逐渐Page2认识到,大多数安全隐患来自于终端,因此必须确保源头的信息安全,即从每一台连接到网络的终端开始,遏制恶意攻击,由此产生出可信计算的基本思想[1-5].可信计算本质上是要通过增强现有终端体系结构的安全性来保证整个系统的安全,其主要思路是基于安全硬件和安全操作系统来实现一个可信的平台.可信计算经过多年的发展,1999年由IBM、HP等著名IT企业发起成立了可信计算平台联盟TCPA(TrustedComputingPlatformAlliance),2003年TCPA改组为可信计算组织TCG(TrustedComputingGroup).可信计算组织制定了关于可信平台模块[6]、可信存储[7]等一系列技术规范,在可信计算领域具有较大的影响力.其可信网络连接分组(TNCSubGroup,TNC-SG)制定了一个基于可信计算技术的可信网络连接TNC架构[8],它本质上就是要从终端的完整性开始,建立连接.在传统网络接入认证基础上,增加平台的身份认证和平台的完整性校验,终端用户只有在两层认证通过且平台完整性校验成功后才可以接入网络.研究人员对TNC架构以及基于TNC架构的可信网络连接协议进行了大量的研究[9-13].IBM公司在TNC架构基础上提出了一个完整性评估层协议———完整性报告协议[13],该协议实现TNC架构中完整性评估层平台的身份认证和完整性校验.本文通过对TNC架构和完整性报告协议的分析发现,TNC-SG提出的可信网络连接(TNC)架构存在一个安全缺陷,即用户与平台之间没有安全绑定关系,这一安全缺陷直接造成基于TNC架构的完整性评估层协议漏洞.因此,可信网络连接协议的设计应避免这一漏洞.为使协议的设计和分析更具一般性和安全性,本文设计了一个可证明安全的可信网络连接协议模型,通过模型指导协议的设计和分析,从而解决了TNC架构的安全缺陷.可信网络连接架构是在传统网络认证协议接入架构基础上提出的,两者有着密切的联系和本质的区别.因此本文基于当前非常流行的可证明安全形式化方法———CK模型[14]的基本思想,结合TNC架构的具体规范[8],设计了可证明安全的可信网络连接协议模型TNC-PS.TNC-PS模型为两层结构:网络访问层模型和完整性评估层模型.我们通过对网络访问层协议的内部和外部攻击者以及协议运行环境的分析,指出CK模型可以直接作为网络访问层协议的设计和分析模型.完整性评估层模型将协议的运行环境抽象为两类:可信链路模型(PTM)和非可信链路模型(PUM).可信链路模型是一种理想化的链路模型,在这一模型中,网络访问层用户与完整性评估层平台之间存在安全绑定关系,完整性评估层协议的运行在网络访问层安全信道保护下进行;非可信链路模型PUM是现实协议的运行环境,其中不存在上述绑定关系.本文还提出了绑定器的概念,它是完整性评估层模型的核心,通过绑定器,可以将PTM中设计的安全协议简单的转化为PUM中具有同等安全性的协议,从而避免TNC架构的安全缺陷.本文第2节对背景知识进行介绍,包括可信网络连接TNC、CK模型;第3节给出针对完整性评估层协议的一种新的攻击———平台替换攻击,并指出TNC架构的安全缺陷;第4节给出可证明安全的可信网络连接协议模型TNC-PS,并形式化地定义可信网络连接协议;第5节利用TNC-PS模型设计一个满足可信网络连接安全目标的完整性评估层协议;最后一节对全文进行总结并给出下一步的工作.2预备知识2.1可信网络连接可信计算组织可信网络连接分组(TNCSubGroup,TNC-SG)制定了一个基于可信计算技术的网络连接规范,它本质上就是要从终端的完整性开始,建立连接.即在传统网络接入认证基础上,增加平台的身份认证和平台的完整性校验,终端用户只有在两层认证通过且平台完整性校验成功后才可以接入网络.可信网络连接(TNC)[8]架构如图1所示,包含3类实体:访问请求者、策略执行者和策略决策者,这些都是逻辑实体,可以分布在任意位置.TNC架构在纵向从下到上分为3个层次.网络访问层.这一层用于支持传统的网络连接技术,进行用户身份认证和密钥协商并建立安全信道,完成后通知上层进行完整性评估层协议;Page3完整性评估层.负责评估所有请求访问网络的平台的完整性,这一层协议的运行受网络访问层安全信道的保护;完整性度量层.收集和校验请求访问者的完整性相关信息的组件.2.2Canetti-Krawczyk模型CK(Canetti-Krawczyk)模型是用于形式化分析密钥交换协议的工具[14].该模型给出了会话密钥安全的定义和利用该定义证明认证和密钥交换协议安全性的模块化方法.CK模型的主要目标是,通过模块化的方法来设计和分析认证和密钥交换协议,以简化协议的安全设计与安全性分析.CK模型有3个重要的组成部分:非认证链路模型(UM)、认证链路模型(AM)和认证器(authenticator).(1)非认证链路模型(UM)非认证链路模型(UM)中的攻击者除了能够控制通信链路和协议事件的调度外,还能够通过明确的攻击手段得到协议参与者存储器中的秘密信息.为了区分各种攻击,确保信息在被暴露情况下最大限度的安全,根据攻击者能够得到信息的实际情况,CK模型将攻击分为3类:攻陷参与者(Partycorrup-tion)、会话密钥查询(Session-keyquery)和会话状态暴露(Session-statereveal).(2)认证链路模型(AM)AM的定义方式和UM的基本相同,一个根本不同之处在于,AM中的攻击者只能够传递由参与者产生的真实消息,而不能够改变或增添消息的内容.定义1(认证器authenticator)[15-16].认证器是一种特殊的算法,其作用类似于一个自动的编译器,它能够将AM中的协议转化为UM中一个安全性相同的等价协议.(3)会话密钥安全(SK-secure)定义2(测试会话查询test-sessionquery)[14].图2完整性报告协议我们发现,上述协议容易遭受一种新的攻击———平台替换攻击.可信网络连接架构中完整性评估层的目的是验证接入平台的身份和平台完整性,这一攻击将导致平台身份认证的失败以及平台完整性校针对密钥交换协议的对手U可以在它运行的任何时刻,从那些完成的、没过期的、没暴露的会话中选择一个测试会话(test-session).设K是测试会话的会话密钥,当U对测试会话查询时,掷币b,b←R{0,1}.若b=0,把K给U;否则,从协议产生的密钥的概率分布空间随机选择一个值r给U.除了在测试会话过期前不允许使测试会话暴露外,U可以继续进行各种活动.最后,U输出一个比特b0,作为b的猜测.定义3(KE对手)[14].被允许执行测试会话查询的密钥交换协议对手是KE对手.定义4(会话密钥安全SK-secure)[14].如果对于UM中任何KE对手U,协议能够满足下列两条性质,则我们称该协议在UM中是会话密钥安全的:①如果两个未被攻陷的参与者完成了匹配的会话.它们将输出相同的会话密钥;②U进行测试会话查询,它猜中b的概率不超过0.5+ε,其中ε为安全参数下可忽略的概率.如果上述性质对于任何AM中的KE对手是满足的,则协议在AM中是会话密钥安全的.3平台替换攻击及其分析3.1完整性报告协议完整性报告协议[13]被用于实现平台身份认证和平台的完整性校验,它基于挑战-应答认证协议[17].如图2所示,平台PA向平台PB证明自己的身份和完整性,其中nonce为不可预知的随机数,AIKpriv和AIKpub为证明身份密钥对[6],loadkey(AIKpriv)表示使用存储根密钥从可信平台模块TPM中读取证明身份密钥AIKpriv,SML为存储测量日志[8],cert(AIKpub)为PrivacyCA向平台签发的AIK证书,Sig{PCR,nonce}AIKpriv表示以AIKpriv为私钥将选择的PCR值和收到的随机数nonce进行签名.验错误,造成可信网络连接的安全目标不能达到.3.2平台替换攻击合法用户M希望通过不可信的平台PM接入平台PB,攻击过程如图3所示.Page4假定.用户A、M和B都是合法用户,且A与M、M与B之间分别建立了安全信道.用户A、M和B分别控制平台PA、3.PA接收到PM发来的挑战消息nonce,按照3.1节协议规定,使用存储根密钥从TPM中读取证明身份密钥AIKpriv,并以AIKpriv为私钥将选择的PCR值和收到的随机数nonce进行签名Sig{PCR,nonce}AIKpriv,然后将签名消息连同存储测图3平台替换攻击攻击中,平台PM成功地说服平台PA对平台PB的一次性随机数进行签名,并进而允许平台PM成功地欺骗平台PB.这是一次完美的攻击,因为平台PA和平台PB都不能够察觉到任何错误.攻击结束后,平台PB认为PM是可信平台并允许其接入,平台PA认为它与平台PM进行了一次协议交互.但实际上平台PM是一个不可信平台,它借助可信平台PA接入PB.3.3平台替换攻击产生的原因及TNC架构的安全缺陷可信网络连接框架中,完整性评估层协议是在网络访问层用户之间建立的安全信道基础上进行的.尽管有安全信道保护,但无法避免平台替换攻击,如图3所示.攻击发生的根本原因是:一方面,按照TPM主规范[6]的规定,对于验证平台而言,AIK签名只能说明消息来自一个含有真实TPM芯片的平台,不能证明签名消息的平台就是议定的通信平台,证明身份密钥AIK不能直接用于认证通信平台的身份.因此,验证平台PB不能确定接收到的消息属于协议议定的响应平台PM,而只能确定消息来自一个可信的平台.另一方面,在进行可信网络连接过程中,同一用户可以使用不同的计算平台,不同的用户也可以使用同一平台进行连接,这就使得用户与用户所使用的平台之间不存在一一对应的关系.网络访问层建立的安全信道只能保证网络访问层用户之间通信的认证性和保密性,不能保证用户所使用的平台之间的认证性.可信网络连接架构规定,网络访问层的安全信道能够保护完整性评估层协议的消息交互[8],但实质上用户与平台之间没有绑定关系,不能将两者看作一个整体来处理,平台之间的身份认证和完整性校验不能完全依赖于用户之间的安全信道.这是造成平台替换攻击最主要的原因,同时它也是TNC架构的设计中没有考虑到的一个安全缺陷.4可证明安全的可信网络连接协议模型由于TNC架构设计上的缺陷(网络访问层用户与完整性评估层平台之间不存在安全绑定关系),基于这一架构设计的协议容易遭受平台替换攻击.本文发现在保持TNC架构不变的前提下,通过协议的巧妙设计可以实现网络访问层用户与完整性评估层平台之间的动态绑定,从而避免了TNC架构安全缺陷造成的影响.但协议的设计和分析是一项十分复杂的工作,凭借经验进行协议的设计和分析,是非常容易出错的[18],而且为了使协议的设计和分析更具一般性,需要有可证明安全或形式化的方法来指导.现有的可证明安全模型和形式化方法(如CK模型[14]、UC模型[19]、PCL模型[20]等)在网络接入认证协议方面只针对传统协议,而且这些模型和方法多是基于Dolev-Yao威胁模型[19]构造的.可信网络连接协议与传统网络接入认证协议有着很大的差别:首先,网络连接设备有所不同,可信的网络连接设备具有TPM模块,由于TPM的物理Page5防篡改特性,能够保护系统内部部分敏感数据;其次,可信网络连接架构在传统网络连接架构基础上,增加了完整性评估层,这一层协议的网络运行环境与传统网络访问层协议的运行环境有所不同(完整性评估层协议是在网络访问层安全信道上进行的).这导致Dolev-Yao威胁模型在可信环境下不再完全适用,相应的基于这一模型构造的可证明安全模型和形式化方法也就不再适用.这就要求我们设计一种新的可信环境下的协议设计和分析模型.通过对TCG可信网络连接架构的深入分析,我们提出了可信网络连接协议的安全目标,在此基础之上,结合可证明安全模型CK模型的基本思想,给出一种可证明安全的可信网络连接协议模型.4.1可信网络连接协议的安全目标根据TNC的规定,可信网络连接架构底层网络访问层采用传统网络连接技术(如VPN[22],802.1x[23]等),完整性评估层协议在底层安全信道保护下进行.因此,可信网络连接协议的一个最基本要求是底层网络连接协议的安全性.目标1.网络访问层实现用户身份认证,协商出用户之间SK安全的会话密钥,在此基础之上,实现通信用户实体之间的安全信道.在网络访问层协议安全基础上,可信网络连接架构提出了新的要求,即要求用户所使用的平台之间进行平台身份认证和平台完整性校验.这是可信网络连接协议的又一安全目标.目标2.完整性评估层在网络访问层安全信道保护下,实现平台身份认证和平台完整性校验.TNC架构指出用户间建立的安全信道可以直接用来保护平台间的消息交互.TNC架构没有考虑到用户与平台之间并不是一种固定的绑定关系,同一用户可以使用任意平台进行网络连接,不同用户也可以使用同一平台,用户之间的每一次连接会话都可能使用不同的平台.TNC架构的这一缺陷直接导致了3.2节攻击的产生.所以需要在用户与平台之间建立一种动态的安全绑定关系.定义5(用户与平台动态授权绑定).对于每一次可信网络连接会话,网络访问层用户都与唯一的完整性评估层平台相对应.目标3.用户与平台之间存在动态授权绑定关系.在网络访问层用户之间建立安全信道基础上,通过用户对平台的动态授权,实现用户与平台之间的安全绑定,从而使平台可以安全地使用用户之间建立的安全信道.4.2基于CK模型的可证明安全的可信网络连接协议模型可信网络连接架构包括相互关联的两个过程[8]:网络访问层的用户身份认证和密钥协商以及完整性评估层的平台身份认证和平台完整性校验.完整性评估层协议是在网络访问层用户身份认证和密钥协商完成,并建立了安全信道基础上进行的.因此,本文设计的可证明安全的可信网络连接协议模型是相互关联的两层:网络访问层模型和完整性评估层模型.4.2.1网络访问层模型CK模型是一种模块化的协议设计方法,它具有3类攻击者模型[14]:攻陷参与者、会话密钥查询及会话状态暴露.这3类攻击模型是针对计算实体内部的攻击,不涉及对网络上传输消息的攻击.认证器[15-16]保证了协议消息在网络上传输时不会遭受攻击,从而保证了AM中安全的协议转化为现实环境(UM)中具有同等安全性的协议.从本质上来说,CK模型将攻击分为两大类,针对计算实体内部的攻击以及网络上的攻击.可信网络连接架构中的网络访问层协议与传统的网络接入认证协议相同,它们具有相同的协议参与者、相同的链路环境以及相同的安全目标.对于可信网络连接架构中的网络访问层协议,CK模型中的3类内部攻击同样存在.对于会话密钥查询来说,协议会话密钥的泄漏可能是密钥拥有者处理不当被攻击者获取,或攻击者通过密码分析的手段也可能造成会话密钥的暴露.会话状态暴露查询用来暴露会话的状态信息,网络访问层模型中协议的会话状态与CK模型中定义的会话状态相同(如在DH交换中用于计算gx的指数x).由于会话状态信息需要在内存中进行处理,即使会话状态信息存放于TPM内部,但由于TPM不能直接对这些状态信息进行处理,因此需要将会话状态信息读入内存中.这就有可能造成会话状态信息的泄露.对于攻陷实体攻击,除了能够获取上述两种攻击所能获取的信息外,还能够获取实体的长期密钥.用户的长期密钥有可能是证书权威CA或密钥管理中心KMC生成的长期私钥,也可能是预共享的主密钥,这一信息在未存入TPM之前、或从TPM读入内存进行处理的过程中以及用户的处理不当都有可能被攻击者获取.Page6对于可信网络连接架构中的网络访问层协议,CK模型中的外部攻击同样存在.可信网络连接架构网络访问层采用传统网络连接技术(如VPN,802.1x等),可信计算技术没有对网络访问层用户之间的消息交互提供更多的安全保障.因此传统网络接入认证协议的漏洞,在可信网络连接架构网络访问层协议中同样存在.结论1.CK模型可以作为可信网络连接架构完整性评估层模型是可证明安全的可信网络连网络访问层协议的分析与设计模型.4.2.2完整性评估层模型接协议模型的核心.根据CK模型的设计思想,完整性评估层模型中包括两类攻击:平台内部攻击和网络攻击.完整性评估层协议完成平台身份认证和平台完整性校验,协议需要交互的秘密信息以及有关平台身份和平台完整性的信息(包括签注密钥EK[6]、认证身份密钥AIK[6]、平台完整性度量值[6]等信息)在平台内部是安全的.在平台内部,这些秘密信息存放在TPM中的受保护区域,TPM的安全存储特性保证了攻击者(包括非授权用户)无法从TPM中直接获取这些秘密信息.所以攻陷实体攻击在这一层不存在.完整性评估层协议交互过程中的状态信息存放在TPM内部,协议交互过程中这些状态信息不读入内存,而是直接在TPM内部进行签名等操作,然后通过网络传送给通信平台.完整性评估层协议中的会话状态信息受TPM保护.因此,会话状态暴露攻击在这一层不会发生.完整性评估层协议的目的是进行平台身份认证和平台完整性校验,平台之间并不协商会话密钥,因此会话密钥查询攻击在这一层没有意义.结论2.完整性评估层模型中不存在平台内部攻击.CK模型定义了认证链路模型AM和非认证链路模型UM,分别用来表示协议的不同运行环境[14].完整性评估层协议的运行环境与网络访问层协议的运行环境有所不同.完整性评估层协议是在网络访问层用户身份认证和密钥协商结束,并建立安全信道的基础上进行的,完整性评估层协议的消息交互借助网络访问层的安全信道进行传输.协议运行环境的差异,导致CK模型中的链路模型与完整性评估层协议模型的链路模型有着很大的差别.因此,我们给出了完整性评估层的链路模型:平台不可信链路模型(PUM)和平台可信链路模型(PTM).4.2.2.1平台不可信链路模型(PUM)平台不可信链路模型PUM定义了攻击者能力以及攻击者与协议的交互.图4总结了在存在PUM敌手的情况下协议的执行情况.考虑存在n个平台的消息驱动协议,其中用P1…Pn表示不同的平台.每个平台Pi都有输入xi和ri.在这一环境下,存在一个PUM敌手U.PUM环境下协议π的运行包括不同平台之间的一系列协议π的激活行为,这些激活行为被敌手U控制和安排.参与方:平台P1…Pn分别以x1…xn为输入执行n方协议π,敌手U.1.初始化.网络访问层用户之间安全信道建立后,完整性评估层协议开始.每个平台Pi以本地输入xi、秘密参数k和随机输入ri调用协议π.2.若敌手U没有终止,则执行以下操作:敌手U可以激活一些平台Pi之间的协议π,这一激活过程可以有两种形式:i.激活请求狇:这一激活来自平台内部的程序调用;ii.输入消息犿:这一激活来自网络中的另一个平台.如果一个激活发生,那么被激活平台Pi执行它的程序并将产生的输出消息和激活请求提交给敌手U(敌手U能够完全控制激活的顺序以及决定输入消息的值).协议产生的本地输出不会被敌手U获取.3.协议执行的全局输出是敌手U和平台P1…Pn输出的级联组合.在PUM环境下,虽然完整性评估层协议是在网络访问层安全信道基础上进行的,但由于网络访问层的安全信道是网络用户实体之间建立起来的,用户实体与实体所使用的平台之间并没有一种安全绑定的关系.网络访问层用户之间的安全信道不能保护平台之间的消息交互,同样不能保证完整性评估层协议免受网络攻击.因此,平台没有得到用户的授权而使用用户之间建立的安全信道是不安全的.这一链路模型中的网络攻击者能够决定何时发送什么样的消息,可以修改消息或者任意插入自己产生的消息.在这一链路模型中,由结论2可知不存在平台内部攻击.全局输出:在PUM中运行的协议的全局输出是协议参与平台Pi和敌手U的本地输出的级联.PUM-ADVπ,U(k,狓,狉)表示敌手U与协议参与平台交互的本地输出,其中k表示秘密参数,狓=x1…xn表示输入,狉=r0…rn表示随机输入(r0给敌手U).UNPTRUSTπ,U(k,狓,狉)i表示平台Pi的本地输出的级联.定义6(PUM中协议运行的全局输出).UNPTRUSTπ,U(k,狓,狉)=PUM-ADVπ,U(k,狓,狉),UNPTRUSTπ,U(k,狓,狉)1,…,UNPTRUSTπ,U(k,狓,狉)n.Page74.2.2.2平台可信链路模型(PTM)在这一链路模型中,平台可以安全地使用网络访问层建立的安全信道,也就是说,在这一链路模型中,用户与平台之间存在安全绑定.这一环境中存在PTM敌手T,与PUM敌手U不同,敌手T只能通过协议中的其它平台产生的输入消息来激活平台.PTM中的网络攻击者,只能够传递由参与者产生的真实消息,而且不能够改变或增添消息的内容.在这一链路模型中,由结论2可知不存在平台内部攻击.PTM模型下全局输出的定义PTRUSTπ,T与PUM模型下UNPTRUSTπ,U的定义类似.绑定器与CK模型中的认证器相仿,是一种特殊的算法,其作用类似于一个自动的编译器,它能够将PTM中的协议转化为PUM中一个安全性相同的等价协议.定义7.设π和π是n方消息驱动协议,π运行在PTM中,π运行在PUM中.我们称π在PUM中仿真(emulates)π,如果对于任何PUM对手U,存在一个PTM对手T使得式中表示计算上是不可区分的.算法,它的输入和输出都是协议的描述.定义8(编译器compiler).编译器C是一个定义9(绑定器binder).若编译器C对于PTM中的任何协议π,协议C(π)可以在PUM中仿真π,则称这个编译器为绑定器.绑定器的设计和构造是模块化的,当协议需要增加新的安全属性时,只需要针对这一安全属性设计一个新的绑定器并证明其安全性,那么经过这一绑定器编译的协议就能够保证要求的安全属性.我们将设计一个绑定器,它能够实现用户与平台动态授权绑定.绑定器λbind.λbind的构造基于公钥签名.网络访问层用户实体之间已经协商出了SK安全的会话密钥kij.初始函数I进行密钥分配,假设AIKprivi和AIKpubi分别表示参与者pi的AIK签名和验证密钥,其中I0=AIKpub1…AIKpubn为公开信息,发送给每个参与方pi,Ii=AIKprivi为pi的私有信息.当完整性评估层平台pi发送消息m给平台pj的请求被激活时,λbind激活一个双方通信协议^λbind,^λbind过程如下(既然^λbind仅涉及两个平台,我们使用pA,pB代替pi,pj);(1)pA把消息m发送给pB;(2)pB收到来自pA的消息m后,选择一个随机数NB←R{0,1}k,把挑战{m,NB}发送给pA;kAB}AIKprivA,把响应m,SIGN发送给pB;过后接受m.(3)pA收到pB的挑战后,计算SIGN={m,NB,(4)pB收到pA的响应后,验证SIGN和kAB,通定理1.如果签名算法可抵抗选择消息攻击,则完整性报告协议[13]在PTM中是安全的.则协议λbind在PUM中仿真PTM中的消息传输协议.证明.设U是一个和λbind交互的PUM对手,我们要构造一个PTM对手T使PTRUSTMT,TUNPTRUSTλbind,U,其中“”表示计算上是不可区分的.运行U,U和n个运行λbind的参与者p1,…,pn进行仿真的交互,T同时在PTM中和p1,…,pn交互(直观上,T在PTM中和p1,…,pn的交互作为λbind协议的上层协议),T按照以下规则进行:(1)参与者p1,…,pn拥有平台使用者之间的共享密钥;(2)当U激活某个平台pi,把消息m发送给参与者pj时,T在PTM中激活pi把消息m发送给pj;在PTM中用来自pi的消息m激活pj;(3)U继续与运行λbind的参与者pj交互;(4)当pj输出“pj收到pi发来的消息m”时,T(5)U所输出的就是T的输出.从上面规则容易看出,除了第2条规则外,T的行为是合法的PTM对手.在第2条规则中,(pi,pj,m)可能没有在pi的未送达消息队列中.当pj输出“pj收到pi发来的消息m”,而pi没有发送m给pj或pj以前已经收到过m,让β代表这个事件.如果β没有出现,则T执行规则2时是合法的PTM对手行为.这时T在PTM中精确地模仿了U的运行,即PTRUSTMT,T=UNPTRUSTλbind,U,“=”表示同一分布(identicallydistributed).如果β出现,我们可说明其出现的概率是可忽略的,PTRUSTMT,TUNPTRUSTλbind,U.假设β出Page8现的概率是ε,ε是不可忽略的,我们构造一个伪造器F以概率ε/n破坏签名机制.伪造器F.如下定义F:F的输入是NB和KAB.F可以访问SIGNOracleS,它根据输入m,N≠NB且K≠KAB计算输出{m,N,K}AIKprivA.若N=NB或K=KAB,S(m,N,K)=⊥.F运行U,U和一组运行λbind的参与者进行如下仿真交互:(1)F根据初始函数I给各个运行λbind的参与者分配密钥,除了随机选择的一对参与者pA、pB,pA的验证密钥AIKpubi替换为AIKpub发送给pB;(2)对于不是pA和pB交互的消息,涉及的那些参与者按照λbind执行;(3)设L是pB从pA收到的所有消息的集合,m是在其中随机选择的一个消息;(4)当pB被来自pA的消息m激活后,若m=m,F让pB回应挑战NB;否则,随机选择N←R{0,1}k作为挑战;(5)当pA被来自pB的挑战N激活时,若N≠NB且K≠KAB,计算输出{m,N,K}AIKprivA;若N=NB或K=KAB,F询问它的SIGNOracleS进行计算S(m,N,K)=⊥,如果得到⊥,仿真中止,F失败.从U看来,它和F的交互(在F没有中止仿真的情况下)与它和PUM中参与者的真实交互是没有区别的.假设β是指β出现在U和F的仿真交互的事件,这时参与者是pA,消息是m.既然pA、pB和m都是随机选择的,若β出现的概率是ε,则β出现的概率是ε/n.如果β出现,则pB最后收到的消息是对(m,NB,KAB)的有效签名.从上述规则看出,pA从来没有产生过这个签名.(若pA没有被激活发送消息m,很明显pA不会产生这个签名;若pB输出两次相同的值,但所有消息都应该是不同的,因此pA只会发送消息m一次).因此F不会访问他的SIGNOracleS进行这个签名.所以,F可以成功的攻破签名机制,这违反了签名机制的安全假设.综上所述,β出现的概率是可忽略的,因此PTRUSTMT,TUNPTRUSTλbind,U.证毕.4.3可信网络连接的定义定义10.如果协议能够满足下列3条性质,则我们称该协议是一个可信网络连接协议:PUM环境下是匹配会话.5一个可证明安全的可信网络连接协议可信网络连接架构中网络访问层协议采用传统网络连接技术,文中不再考虑.我们通过本文提出的模型,将存在平台替换攻击的完整性报告协议[13]转换成安全的完整性评估层协议.转换成模型所能理解的形式并消除冗余的信息:首先对完整性报告协议进行形式化描述,将其(1)网络访问层用户在UM环境下协商出SK-Secure的会话密钥,并建立用户之间的安全信道;(2)网络访问层用户与完整性评估层平台之间存在动态授权绑定;(3)完整性评估层平台之间的协议会话在(1)通信用户双方预共享一个密钥kij;(2)发起方pi收到建立会话(pi,pj,s)的请求后,选择随机数ri←R{0,1}k,然后把消息(pi,s,ri)发送给pj;(3)响应方pj收到消息(pi,s,ri)后,计算tj=sig{PCR,ri}AIKprivj,然后把消息(pj,s,tj)发送给pi;(4)pi收到消息(pj,s,tj)后,验证tj,验证通过做出接入判断.通过绑定器λbind,将完整性报告协议编译为协议PSTNCP,如图6所示.与完整性报告协议不同,该协议通过两个随机数,保证协议参与双方的消息新鲜性,同时利用网络访问层协商的共享密钥,对完整性评估层协议消息进行加密,实现用户与平台之间的安全绑定.钥kij;(1)网络访问层用户之间共享SK安全的密(2)发起方pj收到建立会话(pj,pi,s)的请求后,选择随机数rj←R{0,1}k,然后把消息(pj,s,rj)发送给pi;(3)响应方pi收到消息(pj,s,rj)后,选择随机数ri←R{0,1}k,然后把消息(pi,s,rj,ri)发送给pj;(4)发起方pj收到消息(pi,s,rj,ri)后,计算tj=sig{PCR,ri,kij}AIKprivj,然后把消息(pj,s,ri,tj)发送给pi;(5)pi收到消息(pj,s,ri,tj)后,验证tj,验证通过做出接入判断.Page9图6可证明安全的可信网络连接协议PSTNCP定理2.如果签名算法可抵抗选择消息攻击,则完整性报告协议[13]在PTM中是安全的.证明.在PTM环境下平台可以安全的使用网络访问层建立的安全信道,用户与平台之间存在安全绑定.因此,可抵抗选择消息攻击的AIK签名能够保证完整性报告协议在该环境下的安全性.证毕.定理3.如果签名算法可抵抗选择消息攻击,则协议PSTNCP在PUM中是安全的.证明.由定义7、定理1和定理2,可直接推出结论.6结论与下一步工作本文通过对TNC架构和完整性报告协议的深入分析,发现TNC架构存在安全缺陷,即网络访问层的用户和完整性评估层的平台之间不存在绑定关系,造成网络访问层建立的安全信道不能保护完整性评估层协议的交互.这一安全缺陷会引起一种新的攻击———平台替换攻击.为有效解决TNC架构安全缺陷造成的影响,我们形式化的提出了可信网络连接协议的安全目标.基于这一目标和CK模型的基本思想,本文对可信环境下的攻击者模型和链路模型进行了抽象,提出了一种可证明安全的可信网络连接协议模型TNC-PS.该模型在保持可信网络连接架构不变的前提下,通过其中的绑定器,可以建立用户与平台之间的动态绑定关系,使存在安全缺陷的完整性评估层协议转化为TNC-PS模型证明安全的协议,且协议能够达到可信网络连接协议的安全目标,有效解决了TNC架构的安全缺陷.我们下一步的工作是:使绑定器带有隐私保护属性,以解决完整性评估层协议隐私保护的问题.另外,TNC-PS模型的设计基于CK模型的基本思想,并未考虑协议的并发组合情况.因此,我们将从协议组合理论角度出发,对模型进行进一步的完善,使它能够在更为复杂的并行环境下对可信网络连接协议进行设计和分析.
