Page1一种基于选择性协同学习的网络用户异常行为检测方法陆悠1),2)李伟1)罗军舟1)蒋健1)夏怒1)1)(东南大学计算机科学与工程学院南京210096)2)(苏州科技学院电子与信息工程学院江苏苏州215000)摘要为了快速准确检测网络用户的异常行为,机器学习技术得到了广泛应用.但随着用户规模的扩大及用户行为的复杂化,基于机器学习的传统检测方法面临着大量标记训练样本而导致的巨大开销、实际网络用户异常行为数据非平衡性而导致的检测准确性不足等问题.因此,将选择性集成技术引入到协同学习过程中,提出了一种基于选择性协同学习的网络用户异常行为检测方法,使用基于多数类分布的改进EasyEnsemble方法将非平衡训练样本划分为平衡的样本子集,然后使用基于混合扰动的生成方法构造差异性成员分类器对样本子集进行协同学习,在学习过程中使用选择性集成进行置信度计算与数据更新以减少开销,并基于准确性选择构建集成分类器用于实际检测,使得检测方法在获得非平衡性复杂分布数据的处理能力的同时进一步提高检测准确性.实验结果表明,该方法较传统方法减少了对训练样本中标记数据的需求,同时在准确性评价指标上表现更好,能更快速准确地检测出网络用户的异常行为.关键词网络用户异常行为检测;协同学习;选择性集成学习;支持向量机;机器学习1引言网络用户异常行为是网络面临的一大威胁,所谓异常行为,顾名思义,是指与正常行为相对应,由网络用户实施的对网络正常运行造成影响的行为,例如传播蠕虫、DDoS攻击等.这些行为会造成网络服务质量急剧下降,网络负载加重甚至瘫痪等后果.随着网络快速发展,网络用户异常行为的新变种以及新行为层出不穷,其威胁也日益严重.因此无论是加强对用户行为的管控,还是保障网络的正常运行,都要求能够对网络用户的异常行为实施快速、准确的检测[1-2].早期人们通常采用端口扫描、报文特征字段匹配等方法对异常行为进行深入分析以获取特征,从而实现网络用户异常行为的检测.然而,随着用户异常行为不断变化,依靠人工对异常行为进行分析以获取特征的代价越来越高昂甚至不可行[3].随着人工智能技术的发展,机器学习技术更多地被用于从网络数据中自动计算异常行为模式、提取其特征,从而自动产生检测规则,大大降低了开发代价[3].根据使用的机器学习技术不同,检测方法大致分为以下几类:(1)基于无监督学习(UnsupervisedLearning)的检测方法.这类方法无需使用有标记的训练样本,通过聚类[4]、自组织图(Self-OrganizingMap,SOM)[5]等算法实现对异常模式的自动获取.但该类方法训练开销大,分类模型可读性差,检测率低.(2)基于监督学习(SupervisedLearning)的检测方法.这类方法需要使用有标记的训练样本,按分类器类型不同,有隐马尔可夫模型[6]、贝叶斯网络[7]、决策树[8]及支持向量机(SupportVectorMachine,SVM)[9-12]等不同方法.该类方法在准确性、模型可读性等方面优于无监督学习的检测方法,但其对训练样本中标记数据数量及分布平衡性等方面要求较高,实际应用时为了获取标记数据,往往需积累不同时间段甚至不同网络环境数据并进行大量的筛选与标记工作,不但开销巨大,甚至还会损失实际数据的分布情况,进而影响检测结果的准确性.(3)基于半监督学习(Semi-supervisedLearning)的检测方法.半监督学习又称为协同学习(Collabo-rativeLearning),通过生成的若干成员分类器进行协作学习,能够充分利用蕴含在无标记训练样本中的信息,从而降低了对训练样本数据进行标记的数量要求,在检测准确性和标记训练样本数量之间取得了较好的折中[13-14].目前已得到广泛应用,例如Zhang等人[15]分析了协同学习对聚类相关应用的效果,Erman等人[16]首次将协同学习应用于实时流量分类并验证了有效性,Meng等人[17]提出基于SVM协同学习方法用于修正入侵检测的误报率,Li等人[18]分析了将Tri-Training协同学习方法应用于主机系统入侵检测的效果等等.虽然协同学习方法能够因只需部分标记的训练样本数据而降低系统开销,但其通常假设训练样本是均匀和平衡的,而实际的网络环境中,包含网络用户异常行为的网络数据中存在着明显的非平衡性和分布复杂性[19],若将协同学习方法直接用于网络用户异常行为的检测,则其生成的成员分类器会产生过拟合(overfit)现象,从而影响协同学习的效果、降低检测的准确性.为了解决上述问题,本文将选择性集成学习(SelectiveEssembleLearning)技术引入到协同学习过程中,提出了一种基于选择性协同学习(SelectiveCollaborativeLearning)的网络用户异常行为检测方法,以提升协同学习方法处理非平衡复杂分布数据的能力,提高网络用户异常行为的检测准确性.该方法在训练样本处理环节使用改进的EasyEssemble方法,针对训练样本存在非平衡性、多数类分布复杂以及部分标记的特点,在分析多数类分布基础上将非平衡训练样本划分为多个均衡且保留原分布信息的训练样本子集,分别供成员分类器训练;在成员分类器生成环节,结合训练样本处理方法,使用样本子空间、样本子空间特征和分类器参数互相组合的混合扰动方法生成足够数量且具备差异性的成员分类器,然后在成员分类器的训练过程中使用选择性集成结果计算置信度及更新数据以降低开销,最后在集成环节则根据所有成员分类器在训练过程中积累的准确性进行选择和组合,构造最终的集成分类器用于网络用户异常行为的检测.实验结果表明,本文提出的方法在减少对标记数据需求、降低系统开销以及提高检测准确性等方面均优于其它基于机器学习的传统检测方法.本文第2节介绍网络用户异常行为检测模型;第3节描述选择性协同学习方法,包括训练样本处理、成员分类器生成以及分类器的选择性集成;第4节介绍网络用户异常行为检测方法;第5节对本文方法进行实验验证分析;第6节为总结和展望.Page32网络用户异常行为检测模型2.1相关概念用户不同的网络行为数据往往具有不同的统计特征,这些特征反映行为的内在特性.基于选择性协同学习的用户异常行为检测,实质即使用选择性协同学习方法自适应地学习用户正常和异常行为在不同统计特征上的差异,以此检测异常行为.为更好地描述检测方法,本文给出如下定义.定义1.网络用户异常行为.即影响网络平稳运行的用户某类型特定行为,例如某种DDoS攻击行为、过度占用带宽的P2P下载应用等.本文使用Object来表示需要被检测的异常网络行为.定义2.检测特征指标集.即用户网络行为流量中具备的可能包含用户正常和异常行为差异的可统计考察因素集,如流持续时间、报文到达间隔等,使用向量犉object={C1,C2,…,Cn}表示,其中Ci(i∈[1,n])表示第i项考察因素.为了保证检测方法的有效性,须选择对用户应用覆盖面较广的特征指标集犉object.目前在流量识别、网络安全等领域已有较多研究成果可借鉴,如文献[20]提出了高达246种候选指标等等.但在具体的异常行为识别环境中,考虑这些考察因素在采集以及数据处理时的可行性和效率因素,可以有选择地去除一些冗余或难以采集的特征指标.定义3.网络用户行为数据:即按检测特征指标集对网络流量进行采集和预处理后所得的网络用户行为具体数据,基于给定的检测特征指标集犉object={C1,C2,…,Cn},当前收集到的第i条用户行为数据可以使用向量犃犮狋犻狅狀i={xi1,xi2,…,xin}表示,其中xij(j∈[1,n])为在特征指标Cj下得到的测量值.网络用户行为数据可直接供检测使用.定义4.标记.即对获得的用户网络行为数据使用人工或其它方法分析后所作出的类别标识,用t表示,由于SVM是一种二分类的检测方法,因此标记具体取值为t∈{1,0,-1},其中取值1为正标记,对应异常行为;-1为负标记,对应用户正常行为;0则表示无标记,即该行数据行为类别未知.定义5.训练样本.即经部分标记处理后所得的可用于训练分类器的带标记的用户网络行为数据犡.所谓部分标记数据即从采集得到的用户网络行为数据中选择一部分使用人工或其它技术方法进行分析,根据结果,将异常行为标记为1,正常行为标记为-1,其余未分析数据标记为0.m条用户行为数据进行部分标记后构成的训练样本犡可表示为熿犡=燀其中每一行都由用户行为数据xij,i∈[1,m],j∈[1,n]与对应的类别标记ti,i∈[1,m],ti∈{1,-1,0}联立而成.2.2异常行为检测模型描述为了快速准确地检测出网络用户的异常行为,首先需要对从网络上采集到的反映网络用户行为的网络数据进行训练和学习,获取用户行为特征,生成分类模型.然后,基于生成的分类模型对从网络上获得的实时数据进行检测,从而识别出网络用户的异常行为.其中,所采用的学习技术的性能和学习效果直接影响着用户行为检测结果的准确性.协同学习技术因其在检测准确性和标记训练样本数量之间取得了较好的折中而得到广泛应用,但其要求训练样本必须是均匀和平衡的,这并不适用于从网络上获取的、具有明显非平衡性和分布复杂性的网络用户行为数据.为此,将选择性集成学习技术引入到协同学习过程中,提出了一种选择性协同学习方法用于获取用户行为分类模型,在适应非平衡训练样本数据的同时,提升训练学习效果.首先采集网络实际流量数据并进行预处理,包括根据检测特征指标对流量数据进行统计和测量以构造网络用户行为数据,使用软件工具、人工分析等方法对部分网络用户行为数据进行标记,得到部分标记的训练样本;然后使用改进的EasyEnssemble方法对训练样本进行处理,包括使用基于特征子空间的聚类方法获取样本分布情况,将训练数据划分为保留原有分部信息的、平衡的样本子集;随后采用基于混合扰动方法生成具备差异性的成员分类器;最后使用改进的协同学习方法对成员分类器进行训练并根据准确性筛选成员构建集成分类器.基于集成分类器,则可以根据检测特征对经过预处理的网络原始流量数据进行检测,以对用户行为进行识别.由此,本文提出了一种基于选择性协同学习的网络用户异常行为检测模型,该模型由选择性协同学习和异常行为检测两部分组成,其结构如图1所示.Page4(1)选择性协同学习训练数据预处理模块.对采集到的用户行为流量数据进行统计、测量以及标记,生成样本处理模块使用的训练样本.样本处理模块.使用基于多数类分布的改进EasyEnssemble方法处理训练样本,生成训练样本子集.成员分类器构建模块.使用混合扰动技术生成成员分类器,供后续的协同学习和选择性集成使用.协同学习模块.使用改进的协同学习方法对成员分类器进行训练,供生成集成分类器使用.选择性集成模块.基于准确性筛选成员分类器来构建集成分类器,用以检测网络用户异常行为.(2)用户异常行为检测检测数据预处理模块.对欲检测的用户行为流量数据进行统计测量,生成集成分类器可处理的用户行为数据.异常行为识别模块.使用集成分类器对网络用户行为数据进行分类,根据结果识别用户的异常行为.3选择性协同学习3.1训练样本的处理基于协同学习的检测方法不足之处主要在于缺乏对非平衡数据的处理能力,引入非平衡数据处理方法可对其进行改进.但传统非平衡性数据处理方法如过取样、欠取样等对实际数据有较多增、删操作,会损失实际分布信息,对于非平衡较为严重的网络数据而言,EasyEssemble方法更为合适.该方法利用集成分类思想,根据非平衡程度,将训练样本划分为若干平衡的子集并以此训练相应数量的成员分类器,最后集成成员分类器进行检测,从而避免直接增删数据导致遗漏样本信息、引入误差等缺陷.然而EasyEnsemble方法并不适宜直接引入基于选择性协同学习的检测方法.一方面,选择性协同学习使用部分标记训练样本,样本包含的大量无标记数据并未明确归属少数类或多数类,无法直接进行划分;另一方面,EasyEssemble方法假设多数类数据是均匀分布,对其进行随机划分,然而网络用户正常行为数据的分布有偏重,很多研究结果都指出,当前的网络流量组成存在着类似“重尾分布”的结构,少数行为占据流量数据中的大部分,而其余行为数据仅占流量的一小部分,例如根据文献[21],当前Internet网络的流量从应用类型来看,基于TCP的WWW应用可占40%以上,主要基于UDP的如P2P等应用占据了30%左右,两者占据流量大部分,反之基于其它协议如ICMP等的网络操作仅占2%,而一些恶意行为(例如ICMPFlood攻击等)恰是利用此类协议进行的.显然对这种复杂分布的数据进行随机划分会严重影响样本子集质量:随机划分所得的n(n值与平衡性相关,非平衡性越严重,n值越大)个子集内少数协议数据量将非常稀疏,甚至成为孤立点,由此训练而得的成员分类器将难以识别此类恶意行为,进而影响最终的检测准确性.因此需要对EasyEssemble方法进行改进,引入聚类技术来确定无标记数据的归属及分析多数类分布信息来帮助样本划分,划分时向低比例数据倾斜,增加样本子集中低比例数据的数量,最终构造平衡、尽可能包含全部分布信息的训练样本子集.另外,由于样本数据属于高维数据,因此在选择聚类算法时可采用子空间聚类算法,该类算法将特征指标集划分为若干特征子空间,这些特征子空间还可用于3.2节中成员分类器生成算法,从而进一步降低检测方法的开销.基于以上分析,本文提出基于多数类分布的改进EasyEssemble方法,通过两阶段处理划分训练样本子集:(1)第1阶段任务为识别无标记数据的归属,首先划分特征指标子空间,随后使用子空间聚类的两分类聚类处理包含所有数据的训练样本,最后根据结果中包含少数类标记的数量投票来确定无标记数据的归属等步骤.(2)第2阶段任务是多数类数据进行划分,首先使用子空间聚类的多类别聚类方法分析正常行为数据类型及其数量比例,然后根据比例有倾斜地划Page5分训练样本子集,增加子集中低比例数据的数量,相对减少高比例数据,确保划分后的每个子集都包含足够的、包含所有类别行为的信息.改进EasyEnssemble样本处理算法描述如算法1所示,其中1~3行为无标记数据的处理过程,4~8行为对多数类数据的划分,9~10行为最终训练样本子集的生成.相对通用的EasyEssemble方法,本文样本处理方法:(1)具备处理部分标记训练样本的能力;(2)能对多数类数据的复杂分布进行分析,并根据分析结果进行有倾斜的划分,构建平衡且包含全部分布信息的训练样本子集;(3)形成的特征指标子空间还可用于后续的成员分类器生成,有利于降低开销.算法1.基于多数类分布的改进EasyEnssemble样本处理算法.输入:训练样本输出:训练样本子集{X1,X2,…,XM},检测特征指标1.随机从犉object中选取s项特征指标,重复N次,构造N个特征指标子集{F1,F2,…,FN},对每一个Fi(i∈[1,N]),有Fi={C1,C2,…,Cs},其中C1,C2,…,Cs∈犉object且各特征指标子集互不相同.2.根据每个Fi(i∈[1,N])对训练样本犡进行投影,得对应特征指标子空间上的样本犡Fi=使用CURE方法对{a1,a2,…,am}进行二分类聚类(取聚类数目K=2,收缩因子a=0.3,从两种已标记数据中抽取约10%作为代表点),计算结果两个类别中对应t=1的元素数量,令数量多者为少数类结果Minor(Fi).3.对所有Minor(Fi)(i∈[1,N])中对应t=0的元素进行投票,按简单多数确定其是否为少数类元素,投票结果与训练样本犡中t=1元素合并,构成少数类样本集合Minor(MinorX),设其s1项数据,则Minor={a1,a2,…,as1},其中aj(j∈[1,N])或aj对应的t=1,或者t=0但其出现在过半数的Minor(Fi)中,其余元素构成多数类样本集合Mayor(MayorX),设其有s2项数据,则有s1+s2=m.4.根据每个Fi对少数类样本集合Mayor进行投影,得对应特征指标子空间上的少数类样本Minor(Fi)=计算其中心位置,公式为Minor(Fi)=(x-x-i=∑s1j=1s15.根据每个Fi对多数类样本集合Mayor进行投影,得对应特征指标子空间上的多数类样本Mayor(Fi)=对其使用CLIQUE方法进行多类别聚类,设结果中类别数量最多的子空间为Mayor(Fmax),计算其中每一类别的中心位置,公式为Mayor(Fmax)=(x-搜索距中心距离最近的数据为投票参照点,距离公式为daj=Dist(Minor(Fi),ai)=(x-设共有t个类别,对应的参照点集合为T={a1,a2,…,at}.6.对其余子空间的分类结果进行集成:在每个子空间的分类结果中查看不属于T的所有数据,若其与参照点xt,(xt∈T)同属一类,则将xt标记加入该数据(若与多个xt同属一类则加入多个标记).完毕后对多数类Mayor所有数据的标记投票,选择支持数最多(若相同则选择T中排列靠前的类别)的标记作为该数据类别,检查结果并去除仅含少数点的类别.7.设多数类分布的分析结果为D1,D2,…,Dt,每个类别包含数据数量为Count(D1),Count(D2),…,Count(Dt),确定D1,D2,…,Dt的抽样权重于是类别Di的抽样数量为8.计算子样本空间数量M=s2/s1,构造M个多数类样本子集{X1,X2,…,XM},每个子集初值为空,依次对多数类元素每个类别Di进行无放回抽样,取样数量计算为Size(Di),若取样过程Di中数据已被取完,则将该类数据重置为初始状态再继续抽取,共取M次,分别加入每个Xj(j∈[1,M])中.9.构造M个训练样本子集{X1,X2,…,XM},其中Xi=10.返回训练样本子集{X1,X2,…,XM}和特征指标子Xi∪Minor(i∈[1,M]).集合{F1,F2,…,FN}.Page63.2成员分类器的生成协同学习方法能够使用样本中有标记数据先行训练分类器,继而对无标记数据分类,将置信度较高的结果加入有标记数据,如此反复迭代后可充分利用无标记数据的信息对分类器进行强化,从而确保准确性同时减少对训练样本中标记数据的开销需求.然而目前较为普及的协同学习技术如基于双分类器的Co-Training[13]、三分类器的Tri-Training[13]以及多分类器的CoForest方法[14]等都倾向于使用较少的成员分类器(最受认可的Tri-Training方法使用3个成员分类器),但非平衡性较为严重的网络数据经本文训练样本处理方法划分后会形成较多的样本子集,仍使用较少的成员分类器对其进行协同学习会造成成员分类器出现过拟合等现象,影响准确性,因此需要对其进行改进,生成足够数量的有差异性的成员分类器.文献[22]已证明SVM分类器是特征及参数敏感的,特征敏感指不同特征空间下的样本子集训练而得的分类器具有较大差异,参数敏感则指基于高斯核函数的SVM的分类能力与其参数ξ和惩罚参数C密切相关.另外训练样本不同也可造成一定差异性.根据以上结论,本文提出一种对特征子空间、训练样本子集以及SVM参数三者进行充分组合的基于混合扰动的成员分类器生成方法,首先对样本处理过程中生成的特征子空间和训练样本子集进行组合;然后按文献[22]在每个组合上计算可降低分类器偏差的参数ξ和C取值空间(即“低偏差区域”RegLow),从中随机选择参数ξ和C,并进一步与特征指标、样本空间进行组合,最终生成一定数量的、有差异的成员分类器.过程描述如算法2所示.算法2.基于混合扰动的个体分类器生成算法.输入:训练样本子集{X1,X2,…,XM},特征指标子集输出:个体分类器集合Fall={f1,f2,…,fN×M×W}及对1.FORi=1toN2.FORj=1toM3.根据特征指标集Fi,对训练样本子集Xj进行4.分析样本Yi,j,使用文献[23]方法计算其RegLow,5.FORk=1tow6.使用参数ξk和Ck,生成个体分类器f(fi×j×k),7.令对应的训练样本Y(fi×j×k)=Yi,j,将其加8.返回分类器集合Fall和对应的训练样本集合Yall3.3成员分类器的选择性协同学习选择性协同学习方法在完成样本处理以及成员分类器生成后,接下来的工作则是对这些差异性成员分类器进行协同训练,然而传统的协同训练方法在成员分类器数量增加时存在不足:一方面,传统方法(如CoForest方法)采取每个成员分类器相对其余所有成员分别计算的方案计算置信度,n个分类器时间复杂度大致为O(n×(n-1))=O(n2),置信度本身则采用十折交叉验证等方法计算,显然当非平衡性较为严重导致成员分类器数量n增大时,这种方法会极大地增加时间开销;另一方面,传统方法将所有成员分类器用于最终的检测,成员分类器数量增大时更易出现受噪音积累影响的成员影响检测准确性的情况.针对以上不足,本文在成员分类器的协同学习和集成环节分别进行改进,主要思路是应用选择性集成技术:首先在成员分类器协同学习环节使用选择性集成方法对置信度计算进行简化,即每次迭代中不再对每个成员分类器分别计算置信度并更新数据,而是基于准确性选择部分成员分类器的集成分类结果来计算无标记数据的置信度并从整体上更新数据,从而较传统方法的时间复杂度降为O(n);然后在成员分类器集成环节进行选择性集成,基于协同学习过程中积累的准确性选择质量较高的成员分类器来构建最终用于检测的集成分类器.使用选择性集成分类方法简化置信度计算的关键在于保证选择性集成分类结果的准确性.由于协同训练起始时成员分类器已使用有标记的数据进行过训练,本文所使用泛化能力较强的SVM成员分类器可被认为至少是一个弱分类器(准确性大于随机猜测的50%),据文献[23],集成分类在成员分类器具有较高的准确性及差异性条件下可将一定数量的弱分类器集成为一个强分类器,本文的分类器生成方法已保证了成员分类器的差异性,因此置信度准确性依赖于参与计算的成员分类器准确性.基于以上分析,本文使用选择性集成技术,在迭代过程中累计成员分类器准确性,选择准确度较高的成员分类器的结果进行集成(初始化时使用随机选择),进而计算置信度并更新数据.协同学习过程中噪音积累问题较难避免,若所有成员分类器用于最终检测,则受其影响而质量较差的成员会影响准确性.考虑到集成分类器性能达Page7到最优所需分类器数量存在上限[24](20~30),因此本文基于准确性集成这一数量的成员分类器,剔除受噪音积累影响而准确性较差的成员分类器,确保用于检测的集成分类器的准确性.分类器协同学习和选择性集成的具体步骤如算法3所描述.算法3.成员分类器协同学习和选择性集成算法.输入:个体分类器集合Fall={f1,f2,…,fN×M×W}及输出:集成分类器Fresemble={f1,f2,…,fz}1.记每个成员分类器fi(i∈[1,N×M×W])的准确2.FOR每个成员分类器fi∈Fall3.使用样本Y(fi)中有标记数据训练成员分类器4.对无标记数据的分类结果进行集成,每项数据置5.IF(R=0)or(稳定值>Ma)or(迭代次数>Mb)6.GOTO127.ELSE8.使用Result更新所有成员分类器的样本Yi,9.选择准确性最高前TOP个成员分类器(如果10.GOTO211.选择准确度最高的z个成员分类器构成集成分类12.返回Fresemble4网络用户异常行为检测利用选择性协同学习所生成的集成分类器,可从网络数据中检测网络用户异常行为.然而网络的流量数据并不能被集成分类器直接识别,还需要根据检测特征指标对网络流量数据进行预处理,构造集成分类器可以识别的网络用户行为数据,因此网络用户异常行为检测过程可以划分为数据预处理和检测两个阶段.(1)数据预处理阶段的主要工作包括:采集某连续时间段内的网络原始流量数据,根据检测特征指标对其统计和测量,构造供集成分类器使用的检测样本.在实现上可在用户接入点设备(通常为网关或者交换机等,在一个自治域内,接入点可以为多个)上使用端口镜像等方法对捕捉网络报文,然后分析数据并转化为具体用户对应的流(Flow),最后根据检测特征指标集对这些流进行测量,构造检测样本.(2)检测阶段的主要工作包括:将预处理生成的网络用户行为数据输入集成分类器,由于其中各成员分类器通常建立在不同特征子空间上,因此输入时还需进行必要的投影操作.当所有成员分类器输出结果后,使用简单多数原则进行投票后即得检测结果.网络用户的行为数据具有流式数据的特征,而无论数据预处理还是检测都需要一定的时间开销,在这段时间内必然有新行为数据到达,为避免因处理开销而遗漏新到达的数据,本文检测方法采取数据预处理与检测两阶段交互迭代的方案,即确定一定长度的时间间断,设时间段T内数据预处理工作生成相应的网络用户行为数据.则该数据将在时间段T+1内进行检测,而数据预处理工作在时间段T+1内则生成新的行为数据,如图2所示.显然,需要综合考虑数据预处理与检测等方面开销来设置时间间断的长度,一般以能够及时检测完数据预处理阶段提交的检测数据为宜,当网络繁忙时可适当缩短,空闲时可适当延长时间间断.图2两阶段交互迭代的网络用户异常行为检测流程由此,网络用户异常行为检测的具体步骤可以由过程1描述.Page8过程1.网络用户异常行为检测.输入:集成分类器Fresemble={f1,f2,…,fz},每个成员输出:检测结果1.设本次迭代时间为T,上轮迭代得到的用户网络行2.按特征指标犉object={C1,C2,…,Cn}进行测量,得待3.FOR每个成员分类器fi∈Fall4.将向量犇犜T-1按成员分类器fi对应的特征指标5.整理向量犇犜T-1在Fresemble中每个分类器输出的分6.根据简单多数原则,输出流量的最终标记,若标记7.返回检测结果,进入下一轮迭代,goto15实验与分析5.1实验环境为验证本文检测方法的实际性能,本文基于校园网中电子与信息工程学院两处实验楼局域网的实际网络环境进行实验,网络环境拓扑结构如图3所示.网络环境中共有约400多台主机,两处实验楼分别有一台CiscoCatalyst2928路由交换机作为汇聚交换机,使用百兆带宽链路出口与教育网路由器连接.对汇聚交换机处的网络流量进行端口镜像,所得数据供本文实验使用.实验使用的软硬件平台设置如下:软件采取自行开发并结合svmlib等相关软件的网络用户异常行为检测系统,对应使用的数据库为SQLServer2005,硬件配置为IntelCore2Quad2.3GHz,4GB内存,操作系统为WindowsXPSP3.两处实验楼作为电子与信息工程学院学生的专业课程实验及全校学生课余上网使用,实验安排学生在该网络环境中进行预定的网络攻击行为(DDoS攻击域内服务器)以及相应的各类正常行为(包括Web浏览、视频点播以及非多线程的P2P文件下载等),因此可以采集到正常与异常的网络用户行为数据用于实验.针对训练样本中的数据标记问题,本文采取的方法是使用流量分析工具L7-filter对正常行为进行标记,然后根据实验安排结合防火墙告警信息、服务器记录以及人工分析标记用户的恶意行为,进而构建训练样本.实验采集了2012年9月17日从上午8:00到晚上21:00时间段内的约26G的网络流量,从中获取用户行为数据.根据检测方法设计,本文需要根据测量指标对采集到的流量数据进行分析、测量等预处理工作,构建训练样本及检测数据.因此参考文献[24]使用如表1所示的23维测量指标对获取的用户流量进行测量.指标类别报文特征流特征源端口数、目的端口数、目的IP地址数、平均流长应用层特征上传流量、下载流量、TCP上传流量、TCP下载流5.2对照方法及评估指标为衡量和验证本文检测方法的准确性以及开销方面的性能,本文采用2类对照方法:一类为基于CoForest协同学习的检测方法(分别使用SVM、朴素贝叶斯和C4.5的成员分类器),具备协同学习能力,可使用部分标记数据样本进行训练;另一类为基于单分类器的检测方法,这类方法不进行协同学习,仅使用有标记数据进行训练.本文采用查全率、查准率和调和平均值作为评价指标,设用于检测的网络用户行为样本中,TP表示被正确识别为异常行为的样本数,FN表示被误判为正常行为的样本数,FP表示被误判为异常行为的样本数,评价指标如下:(1)查全率(Recall):R=TP(2)查准率(Precision):P=TP(3)调和平均值(F-measure):F=2×P×R查全率和查准率能反映检测方法针对异常行为Page9的分类能力,而查全率和查准率的调和平均值综合评价能力更好,这3个指标应用较广泛,几乎为所有研究采纳.5.3实验方案及结果分析为了验证本文检测方法在网络用户行为数据存在非平衡性情况下,能否在降低对训练样本中标记数据需求的同时确保准确性,本文主要从以下方面进行验证:首先验证异常行为数据的不同平衡程度下本文检测方法的准确性;然后验证训练样本中标记数据的不同比例下本文方法的性能.由于训练开销(包括准备数据标记和训练分类器)是决定检测方法能否快速准确检测异常行为的重要因素,因此最后还对检测方法的开销进行了验证.因此本文设计以下3个实验.实验1.验证在异常行为数据不同平衡程度下本文方法的性能.其步骤为:首先分析不同用户行为数据集中异常行为的比例,然后选择比例不同的数据集构建训练样本分别进行选择性协同学习,最后使用相同的验证数据(从全部用户行为数据中随机抽取)比较不同平衡程度的训练样本下本文方法与对照方法的准确性.实验1所使用的数据设置如表2所示.实验1的对比分析结果则由图4给出,图4的(a)、(b)和(c)分别给出了训练样本中异常行为比例为1.12%、5.32%、9.76%、20.60%、31.62%和41.76%时准确性指标的比较结果,从中可以看出,由于选择性协同学习方法在样本处理环节对非平衡图4实验1的结果实验2.验证训练样本中不同标记数据数量下本文方法的性能.其步骤为:首先选择某一数据集(本文选取异常行为数据比例在20%左右的数据集)构建训练样本,然后并分别设置样本中标记数据的比例,构建相应的训练样本进行选择性协同学习,最后使用相同的验证数据比较本文方法与对照方法的准确性.实验2所使用的数据设置如表3所示.性的数据进行了有效处理,在成员分类器集成环节则利用选择性集成进一步提高了准确性,因此检测准确性在不同的非平衡程度上都较对照方法高(与所有对照方法相比,查全率提高至少约14.4个百分点、查准率提高17.3个百分点,调和平均值提高20.3个百分点),尤其当异常行为数据比例极低(例如异常行为比例仅为1.12%以及5.32%)时,本文方法仍能取得80%左右的准确率(对照方法普遍低于70%,甚至接近60%).观察准确性的变化趋势则可看出,对照方法大多存在着随训练样本中异常行为比例逐步提高而准确性逐步提高的现象,当比例逐步接近均衡时(如对照方法1在30%到40%比例间)性能有较大提升,说明对照方法的准确性与异常行为数据平衡程度正相关.但本文方法性能在平衡程度较低的时候即可逐步趋于稳定(异常行为比例在20%以上时即稳定在90%左右),这说明本文方法更能适应当今网络环境下用户异常行为数据比例较低的非平衡性特点.数据集异常行为1150133871.123023838721525.323035167529419.76304200859750020.60305208326588231.62306348188337741.7630数据集标记15879111706520.602117591058271020.60317638999471520.60423517940682020.60517638999472520.60635276823103020.60Page10实验2的对比分析结果由图5给出:图5的(a)、(b)和(c)分别比较了训练样本中标记数据比例为5%、10%、15%、20%、25%和30%时各个指标的比较结果,从中可以看出:由于选择性协同学习方法在样本处理环节引入了非平衡性数据处理方法,并把选择性集成技术引入到成员分类器协同学习和集成环节中,从而有效地降低了对标记数据的需求,提高了检测准确性,因此检测准确性在不同的标记数据比例上都比对照方法要好(与所有对照方法相比,查全率至少领先约19.6个百分点、查准率领先25.3个百分图5实验2的结果实验3.验证本文方法与对照方法在开销方面的差别.其步骤则为:首先在实验2的数据集基础上进一步进行数据标记工作,然后分别比较不同比例的样本数据进行标记的开销情况,接着比较了本文方法与对照方法使用不同比例标记数据的训练样本进行协同学习(单分类器对照方法则仅使用标记数据进行学习)的开销,最后将两者开销结合起来,比较本文方法与对照方法取得的准确性相对开销的对比情况,即取得同样检测性能所需要的开销情况.传统的检测方法更多关注分类器训练方面所需要的开销,但实际上与训练开销相比,对基于机器学习的检测方法而言,准备训练样本尤其是对其中的数据进行标记所耗费的时间开销更为巨大,标记不同比例的样本数据的开销情况如表4所示,本文以及对照方法使用不同标记比例的训练样本的训练开销情况如表5所示.从表4和表5的结果来看,基于SVM协同学习的传统检测方法在训练开销方面非常巨大,在标记比例较少时(少于20%)甚至超过了标记数据的开销,本文方法的训练时间开销较同样基于SVM的传统协同学习检测方法下降了约71.3%,说明本文方法在成员分类器的协同学习方面的改进起到了作用.但总体来说,所有检测方法在点,调和平均值领先22.3个百分点),尤其当标记数据比例较低时(仅5%),本文方法准确性仍能超过80%.观察准确性变化趋势可以看出,对照方法存在准确性随着标记数据比例的上升而线性提升现象(在标记数据比例从20%到30%时尤为明显),但准确性多在80%以下,而当样本中标记数据的比例提高到30%以上时性能即趋于稳定(90%左右).说明对照方法的准确性与样本标记数据数量存在依赖关系,而本文方法则更适应非平衡的训练样本,能够使用更少的标记数据进行训练并取得更好的性能.准备标记方面耗费的时间还是较训练的开销要高一个数量级(标记数据耗时最多在3h左右,而训练方法的耗时最多仅在15min左右),因此降低检测方法对标记数据需求所节省的时间开销对实现快速检测用户异常行为更有实际意义,例如标记90%的数据需要耗费至少约3h,而标记25%左右的数据仅需45min左右,如果使用25%标记数据的检测方法在检测性能上能够与基于90%标记数据的方法相当甚至更优,那么这种方法必然能够更为快速准确地应对用户异常行为.因此本文比较了本文和对照方法在不同时间开销(包括样本标记和分类器训练)相对取得的检测性能的对照情况,结果如图6所示.开销情况Page11表5分类器训练开销情况标记比例本文方法1245.652534.4710245.402528.5520240.502535.1330238.742516.2040239.642507.3850240.462505.1560236.742498.91670238.232493.62580236.352484.80690235.562476.928从图6可以看出,本文方法使用较少的时间开销(2000s左右)即可趋于较为稳定的性能(约90%的准确程度),而对照方法在同样的时间开销条件下其检测性能都在75%以下,需要更多的时间开销之后才能提高检测性能,而获得接近90%的准确程度普遍需要6000s~10000s甚至更多的时间.充分说明本文方法有效地降低了对标记数据的需求,同时仍能维持甚至提高检测准确性,可以更为快速准确地检测用户异常行为.综合以上实验结果可知,与传统的网络用户异常行为检测方法相比,本文方法能够有效处理异常行为数据的非平衡性和分布复杂性,在减少训练样本中标记数据量前提下获得更高的分类准确性能.6总结和展望在用户规模日益扩大、行为日趋多样化的当今网络环境下,如何快速准确地检测出用户异常行为是网络管理人员的一大挑战.在网络的大数据规模下,传统基于无监督学习和监督学习的检测方法由于对网络数据进行标记的巨大开销而无法胜任,基于协同学习的检测方法虽然降低了对标记数据的需求,但不能处理实际网络数据所存在的非平衡和复46.332.590.010.1247.8742.9042.7741.91103.470.474.7040.10129.340.595.8839.37155.210.717.0638.73181.080.828.2337.49206.950.949.4136.42232.821.0610.58杂分布的不足使其在准确性方面受到影响.因此本文引入选择性集成技术对传统基于协同学习的检测方法进行改进,提出基于选择性协同学习的检测方法,使用基于多数类分布的改进EasyEnssemble方法,将非平衡性和复杂分布的训练样本划分为若干平衡、充分包含分布信息的样本子集,随后使用基于混合扰动方法的成员分类器生成方法构造差异性成员分类器对样本子集进行协同学习,从而获得非平衡数据的处理能力,同时在协同学习过程中使用选择性集成分类方法进行置信度计算及更新数据以降低训练开销,在成员分类器集成过程中基于准确性选择成员分类器,剔除受噪音积累影响的成员以提高准确性,最终使检测方法具备对非平衡、复杂分布的数据处理能力,同时进一步提高了准确性,实现对用户异常行为快速准确的检测.实际网络环境的实验表明,本文检测方法在开销、准确性等多个指标上比传统方法表现更好.我们下一步的工作包括:引入在线学习等方法实现检测模型的动态更新;基于异常行为检测结果研究相应的网络用户行为控制机制,最终实现网络用户行为的可感知、可控制.
