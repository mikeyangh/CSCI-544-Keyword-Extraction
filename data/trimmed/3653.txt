Page1一种抛物反射折射圆像的拟合方法段慧仙1)李光耀1)李超1)谭云兰2)1)(同济大学电子与信息工程学院上海201804)2)(井冈山大学电子与信息工程学院江西井冈山343009)摘要基于圆的摄像机标定有着无可比拟的优势.目前,虽有文献证明了圆在反射折射摄像机下的像是一条四次曲线,但由于存在遮挡,仅仅部分封闭曲线在像平面上是可见的,且通过其可见部分无法拟合圆像的方程,进而无法标定摄像机参数.因此,当摄像机位率为1且斜率为0时,作者提出了一种抛物反射折射圆像的拟合方法,为研究基于圆的摄像机标定算法奠定了基础.首先,推导出了抛物反射折射圆像需要满足的条件;其次,在这些条件基础上提出了一种抛物反射折射圆像的拟合方法;最后,利用拟合得到的抛物反射折射圆像和通过抛物镜面的投影轮廓线估计得到的摄像机主点直接计算出摄像机焦距,以此评价文中拟合方法的性能.大量的模拟实验和真实实验均验证了文中拟合方法的有效性.关键词反射折射摄像机;抛物反射折射圆像;摄像机标定;拟合1引言反射折射摄像机可以获得很大的视角,因而被Page2机.其中,中心反射折射摄像机容易生成透视图像,因而得到了更广泛的应用.其反射镜面包括抛物镜面、双曲镜面、椭球镜面和平面镜.2001年,Geyer和Daniilidis[3-4]研究了反射折射摄像机的射影几何理论.作者证明了反射折射成像过程等价于经过单位球的两步成像过程,从而给出了关于射影几何的统一模型.由于传统的透视摄像机可以看成由一个虚拟的平面镜和透视摄像机构成,因此被统一到该射影模型中.目前,关于反射折射摄像机标定方法的研究十分活跃.近年来,文献中已经有了一系列的标定算法,其中具有代表性的有:(1)基于三维控制点的方法.(2)基于二维控制点的方法.(3)基于直线的方法.(4)基于球的方法.(5)自标定方法.(1)基于三维控制点的方法.主要利用三维空间坐标与其二维图像坐标之间的对应关系恢复反射折射摄像机的内外参数.该方法的优点是标定精度高,不足在于需要精度很高的标定块.Aliaga[5]设计了一种抛物反射折射摄像机模型,并在此基础上给出了摄像机内参数和姿态估计算法.估计摄像机内参数时使用了三维点坐标与其对应的二维图像点坐标之间的关系,而进行姿态(外参数)估计时使用了基于界标的姿态估计算法.2008年,Bastanlar等人[6]以文献[7]的理论为基础,提出了一种类似DLT的标定算法.(2)基于二维控制点的方法.主要利用具有控制点的二维标定块作为标定物进行摄像机标定.Scaramuzza等人[8]假设反射折射成像过程可以用Taylor展式来表示,从而提出了一种标定反射折射摄像机的方法.不同于上述文献,Mei和Rives[9]在标准的反射折射摄像机成像模型基础上,提出了一种基于平面标定物的反射折射摄像机标定方法.2007年,Deng等人[10]基于反射折射成像模型和透视摄像机成像模型之间的变换关系,利用非线性优化方法估计了摄像机内外参数.2009年,Zhang等人[11]研究了一组反射折射直线像的几何性质,并提出了通过手动标注平面标定块的交点来标定摄像机的方法.(3)基于直线的方法.不需要知道空间直线之间的相对位置以及直线相对于摄像机的位置关系,但是只能估计摄像机的内参数,不能估计外参数.1999年,Geyer和Daniilidis[12]研究了两组平行直线在抛物反射折射摄像机下像(二次曲线)的性质,由此提出了一种恢复抛物反射折射摄像机内参数的方法.2002年,作者在另一文献[13]中研究了空间直线在抛物反射折射摄像机下像的射影不变性质,根据这一性质提出了一种在没有任何度量信息的情况下,恢复摄像机所有内参数的方法.然而,这两种方法都只是针对抛物反射折射摄像机进行了研究.对此,Barreto和Araujo[14]给出了直线在所有反射折射摄像机下像的具体表达式,且研究了它们的几何性质并将其应用于摄像机的标定.此外,Wu等人[15]提出了一种基于直线的线性标定方法,该方法同样适用于所有的反射折射摄像机.文中,作者引入了对极图像点,并研究了图像点与其对极图像点之间的关系,从而得到一组关于反射折射摄像机内参数的线性约束方程.通过这些约束方程,基于3条或3条以上直线的像就可以恢复反射折射摄像机的所有内参数.(4)基于球的方法.由于球的投影轮廓线通常是封闭的二次曲线(椭圆),从而可以得到很高的拟合精度,进而得到较高的标定精度.Ying和Hu[16]提出了一种基于直线像或球像进行反射折射摄像机标定的统一模型.文中,作者通过直线或球的映射得到了关于反射折射摄像机内参数的约束方程,从而估计出摄像机的内参数.由于该方法得到的约束方程是非线性的,作者提出了一个两步标定算法,即把内参数分成两组分别求解.然而,即使分成两步求解也要进行非线性优化,并且需要一个很好的初值.针对这一问题,Ying和Zha[17]定义了校正的内参数矩阵、绝对二次曲线的校正像(MIAC)以及对偶绝对二次曲线的校正像(DMIAC).在此基础上,作者提出了一种基于球像的线性反射折射摄像机标定算法.该方法较文献[16]中提出的方法大大提高了运行速度,且能达到相似的精度.然而,这两种方法对于抛物反射折射摄像机都属于退化的情况.因此,Duan和Wu[18-19]提出了一种基于球像的抛物反射折射摄像机标定方法,从而完善了基于球的中心反射折射摄像机标定方法.(5)自标定方法.直接从场景图像出发,使用多幅图像对应点之间的约束来标定摄像机.优点在于不需要使用标定块且不需要任何关于摄像机运动和场景几何结构的信息,不足在于精度不高.Kang[20]基于反射折射摄像机的成像特征,利用点对间相互关系的一致性,描述了一种可行的抛物反射折射摄像机自标定方法.圆在现实生活中是普遍存在的,且基于圆的标定算法有着无可比拟的优势,如标定时不需要物体Page3与图像、图像与图像之间进行匹配.然而,由于反射折射摄像机存在大的畸变,在该摄像机下对这一问题的研究还很不透彻且还有很多困难.2011年,Duan和Wu[21]推导出了圆在反射折射摄像机下的像是一条四次曲线,并在此基础上统一了几何元在反射折射摄像机下的成像理论.此外,文中指出由于存在遮挡,仅仅圆像的部分封闭曲线在像平面上是可见的,且通过其可见部分无法拟合出圆像的方程,进而无法估计摄像机的内外参数.针对这一问题,当位率为1和斜率为0时,本文提出了一种抛物反射折射圆像的拟合方法,为研究基于圆的标定算法奠定了基础.首先,推导出了抛物反射折射圆像需要满足的条件;其次,在此基础上建立了一种目标函数,从而通过最小化该目标函数来优化得到圆像的方程;最后,利用拟合得到的圆像和抛物镜面的投影轮廓线估计的摄像机主点计算出摄像机焦距,以此来评价拟合方法的性能.模拟实验和真实实验均验证了我们方法的有效性.本文第2节是一些预备知识;第3节推导出抛物反射折射圆像需要满足的条件;第4节给出一种抛物反射折射圆像的拟合方法;第5节是模拟实验和真实实验;最后给出本文的结论.2预备知识2.1透视摄像机设摄像机的内参数矩阵为其中,rc为位率,fc为焦距,s为畸变因子,[u0v01]T为摄像机主点坐标记为狆.设空间点犡=[xyz]T对应的图像点为犿=[xy1]T,则空间点在像平面上的成像过程可表示为(如图1所示)其中,α是非零的常数因子,犚是一个3阶的旋转矩阵,狋是长度为3的平移向量,[]犚狋是摄像机外参数矩阵.2.2反射折射摄像机Geyer和Daniilidis[3]指出所有中心反射折射成像过程都等价于一个经过单位球的两步成像模型.如图2所示:首先,在视球坐标系犗-XsYsZs下,空间点犡经过透视射影到以反射镜面焦点犗为中心的单位球上的点犡s=[xsyszs]T;然后,以空间点犗c为投影中心将犡s投影到与直线犗c垂直的平面Π上,从而形成图像点犿.其中犗c称为虚拟摄像机光心,犗称为视球中心.虚拟摄像机的光轴是直线犗犗c,则直线犗犗c与像平面Π的交狆=[u0v01]T为摄像机的主点.犗c到犗的距离ξ=犗-犗c称为镜面参数,不同的镜面参数对应不同类型的反射镜面:当0<ξ<1时,对应的反射镜面是双曲面或椭球面;当ξ=1时,对应的反射镜面是抛物面;当ξ=0时,对应的反射镜面是平面镜.反射折射摄像机的成像过程可表示为中心反射折射摄像机下,吴福朝等人[15]给出了其中,犓c为摄像机内参数矩阵,为向量范数,且ξ表示镜面参数.其它参数见式(1).2.3对极图像点对极图像点的定义及性质.定义1.如果犿和犿分别是某条视球直径的两个端点的像,则{犿,犿}称为一对对极图像点(见图3).命题1.在中心反射折射摄像机下,如果Page4犿,犿{}是一对对极图像点,则1+1+τ犿T槡犿其中,τ=(1-ξ2)/ξ2,=犓-Tc犓-1c.在抛物反射镜面情况下,式(2)简化为3抛物反射折射圆像的性质在现实生活中,我们使用的摄像机近似为标准的透视摄像机,即位率为1且斜率为0.因此,我们只讨论当rc=1且s=0时,抛物反射折射圆像的性质.圆在抛物反射折射摄像机下的像是一条四次曲线[21](如图4所示).设犿为四次曲线(圆像)上的点,则4珦犿T^犆珦犿-4珦犿T^犆犲珦犿T珦犿+犲T^犆犲(珦犿T珦犿)2=0(4)其中犲=[001]T,珦犿=犓-Tc犿,犓c为摄像机内参数矩阵,^犆是一个3×3的对称矩阵.当rc=1且s=0时,摄像机内参数矩阵为则为简化表达式,记犓-1c=在抛物反射折射摄像机下,圆的像是一条四次曲线.因为四次曲线有14个自由度(DOF),则可以用一个14维射影空间中的一个点犆来表示.通过Maple程序展开式(4)得到抛物反射折射圆像的具体代数表达式.犿=[xy1]T为圆像上的点,则犆(1)x4+犆(2)x3y+犆(3)x2y2+犆(4)xy3+犆(5)y4+犆(6)x3+犆(7)x2y+犆(8)xy2+犆(9)y3+犆(10)x2+犆(11)xy+犆(12)y2+犆(13)x+犆(14)y+犆(15)=0.犆的具体表达式为且犆(10)=-2a2(6dt1+2et2-2t3+(d2+e2+1)c33)烄犆(11)=-8a2(et1+dt2-t5)犆(12)=-2a2(2dt1+6et2-2t4+(d2+e2+1)c33)犆(13)=-4a((3d2+e2-1)t1+2t2de-2dt3-2et5)烅犆(14)=-4a(2t1de+(d2+3e2-1)t2-2et4-2dt5)犆(15)=-4(d2+e2-1)(dt1+et2)+8d2t3+烆其中定理1.假设圆在抛物反射折射摄像机下的像为四次曲线犆,则有下列等式成立:证明.由式(5)可知,结论成立.证毕.通常情况下,由于反射镜面的投影轮廓线估计的摄像机主点是比较准确的.因此,当摄像机主点已知,则有下列定理成立.Page5定理2.假设摄像机主点狆=[u0v01]T已知,且圆在抛物反射折射摄像机下的像为四次曲线犆.则有下列等式成立:δ7=(犆(7)+4v0犆(1))α1-(犆(6)+4u0犆(1))α2=0其中α1=犆(13)+2u0v0犆(7)+2u20犆(6)+2u0犆(10)+烄v0犆(11)烅α2=犆(14)+2u0v0犆(6)+2v20犆(7)+2v0犆(12)+u0犆(11烆)证明.由犓-1c知记τ3=f2ct3c33由式(5)可知由式(6)可知犆(10)烄犆(1)=-(12u0τ1+4v0τ2+4τ3-2(u20+v20+f2c))犆(11)犆(1)=-(8v0τ1+8u0τ2+8τ4)犆(12)犆(1)=-(4u0τ1+12v0τ2+4τ5-2(u20+v20+f2c))烅犆(13)犆(1)=-4((3u20+v20-f2c)τ1+2u0v0τ2+2u0τ3+2v0τ5)犆(14)犆(1)=-4(2u0v0τ1+(u20+3v20-f2c)τ2+2v0τ4+2u0τ5烆把式(7)代入式(8)中前三项,解得烄τ3=(1τ4=(1τ5=(1烅烆此外,把式(7)和式(9)代入式(8)第4项得犆(13)犆(1)+(3u20+v20+f2c)犆(6)2u0犆(10)由上式解出犆(1)+v0犆(11)其中β1=犆(13)+(3u20+v20)犆(6)+2u0v0犆(7)+2u0犆(10)+v0犆(11)+4u0(u20+v20)犆(1).同理,把式(7)和式(9)代入式(8)第5项得犆(14)犆(1)+(u20+3v20+f2c)犆(7)u0犆(11)犆(1)+2v0犆(10)由上式解出其中β2=犆(14)+(u20+3v20)犆(7)+2u0v0犆(6)+u0犆(11)+2v0犆(12)+4v0(u20+v20)犆(1).由式(10)和式(11)相等得β1(犆(6)+4u0犆(1))-β2(犆(7)+4v0犆(1))=0,上式整理得δ7=(犆(7)+4v0犆(1))α1-(犆(6)+4u0犆(1))α2)=0,其中,α1=犆(13)+2u0v0犆(7)+2u20犆(6)+烄2u0犆(10)+v0犆(11)烅α2=犆(14)+2u0v0犆(6)+2v20犆(7)+2v0犆(12)+u0犆(11烆假设犆为抛物反射折射圆像,则定理1和定理2成立,从而可以用来优化抛物反射折射圆像的方程.4抛物反射折射圆像的拟合方法本节,我们利用3节得到的定理1和定理2优化估计抛物反射折射圆像的方程.假设在像平面上抛物反射折射圆像为犆.犿i是从犆上提取的图像点,其中i=1,2,…,N.通常情况下,反射镜面的投影轮廓线在像平面上是可见的且为一条二次曲线.首先,通过最小二乘方法拟合得到抛物镜面的投影轮廓线犆0.然后通过犆0对摄像机内参数进行初始化.Page64.1初始化因为rc=1且s=0,则犆0的表达式为从而,摄像机内参数fc,u0,v0的初始估计为{其中[u0v01]T为摄像机主点狆.接下来,利用得到的初始内参数,根据式(3)计算出犿i=[xi,yi,1]T的对极图像点犿i=[xi,yi,1]T,i=1,2,…,N.然后利用点(犿i,犿i),i=1,2,…,标函数来初始估计抛物反射折射圆像犆:其中犕=[珦犿1珦犿2…珦犿N珦犿1珦犿2…珦犿N]T,珦犿i=(x4i,x3iyi,x2iy2i,xiy3i,y4i,x3i,x2iyi,xiy2i,y3i,x2i,珦犿i=(x4i,x3iyi,x2iy2i,xiy3i,y4i,x3i,x2iyi,xiy2i,y3i,到目前为止,我们得到了四次曲线犆的初始估计.下面,给出抛物反射折射圆像的拟合方法.4.2抛物反射折射圆像的拟合方法xiyi,y2i,xi,yi,1),x2i,xiyi,y2i,xi,yi,1).拟合方法.输入:从抛物镜面的投影轮廓线和圆像上分别手动提输出:抛物反射折射圆像的方程犆1.通过犿0i,i=1,2,…,线,从而得到摄像机内参数的初始估计;2.通过初始化的摄像机内参数和图像点{犿i,i=1,2,…,N},利用4.1节提出的方法得到圆像犆的初始估计;3.定义目标函数其中,λ指Lagrange乘子,犕见式(13),δi见定理1和定理2(i=1,2,…,7).通过最小化目标函数(14)优化得到圆像的方程犆.5实验结果本节通过模拟和真实实验来验证我们拟合方法的性能.首先,用抛物镜面的投影轮廓线估计摄像机主点.而由式(10)或式(11)可知,通过优化得到的圆像和摄像机主点可以直接计算出摄像机焦距,以此来评价我们拟合方法的性能.5.1模拟实验阵为在模拟实验中,假设反射折射摄像机内参数矩其中,[5003501]T为摄像机主点狆,600为摄像机焦距fc.图5是模拟生成的圆像.其中大的二次曲线是抛物镜面的投影轮廓线,小的封闭曲线是圆在抛物反射折射摄像机下的像.在圆像上的每个图像点加入均值为0,标准差为σ的高斯噪声,σ分别取为0.5,1,1.5,2,2.5,3.由于图像边缘的分辨率比较低,我们在抛物镜面投影轮廓线上的每个图像点加入均值为0,标准差为2σ的高斯噪声.在每个噪声水平下分别做100次独立实验.利用第4节提出的方法来估计抛物反射折射圆像的方程.图6给出了点到四次曲线(圆像)代数距离的均值和标准差.从图6中可以看出,抛物反射折射圆像得到了很好的估计,从而说明了我们拟合方法的有效性.图6点到四次曲线代数距离的均值和标准差Page7此外,用拟合得到的四次曲线(圆像)和式(12)估计的摄像机主点,通过式(10)直接解出焦距fc.然后,把求出的焦距fc和通过式(12)初始化的焦距fc0进行比较.图7给出了比较结果,也说明了我们提出的方法可以较准确地拟合出抛物反射折射圆像的方程.5.2真实实验我们用由捷克技术大学感知中心(TheCenterforMachinePerception,CzechTechnicalUniversity)设计的旋转双曲镜面和NIKONCOOLPIX990数码相机构成的反射折射摄像机进行实验.该反射折射摄像机的镜面参数ξ=0.966接近1,因此可以近似为抛物反射折射摄像机来进行实验.用该摄像机拍摄杯子的图像(如图8所示),图像分辨率为1080×810.首先,利用以下网址上提供的方法分别手动提取反射镜面的投影轮廓线和圆像(即A杯子和B杯子的杯口)上的图像点:http//mail.isr.uc.pt/~carloss/software/software.htm.然后,用本文提出的拟合方法对图8中A杯子和B杯子的杯口进行拟合.把拟合得到的四次曲线反投影到图8中.图9给出了放大后的反投影结果,可以看出圆像得到了较好的拟合.此外,用拟合得到的四次曲线(抛物反射折射圆像)和式(12)估计的摄像机主点,通过式(10)计算出摄像机焦距fc.由于缺乏参数的真值,我们用得到的摄像机内参数对图10进行校正,通过校正后的直线像是否保持直线来评价标定结果.图11通过拟合A杯子的杯口得到的校正结果Page8图12通过拟合B杯子的杯口得到的校正结果图11和图12分别为拟合A杯子和B杯子的杯口得到的校正结果.从图11和图12中可以看出天花板上的直线得到了很好的校正,从而说明了我们拟合方法的有效性.6结论圆在反射折射摄像机下的像是一条四次曲线,但由于存在遮挡,通过其在像平面上的可见部分无法正确地拟合圆像的方程.对此,本文提出了一种抛物反射折射圆像的拟合方法,为研究基于圆的摄像机标定奠定了基础.首先,推导出了抛物反射折射圆像需要满足的条件;其次,利用这些条件来优化得到圆像的方程;最后,利用拟合得到的抛物反射折射圆像和摄像机主点计算出摄像机焦距,以此评价我们拟合方法的性能.模拟实验和真实实验均验证了我们拟合方法的有效性.从实验结果中也可以看出,在没有高标定精度要求的情况下,通过一个圆像可以直接计算出摄像机的焦距.在以后的工作中,我们将继续研究圆在双曲镜面或椭球反射折射摄像机下像的拟合方法及基于圆的摄像机标定方法.
