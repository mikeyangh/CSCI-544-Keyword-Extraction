Page1基于汉明距离递减变换的可逆逻辑综合算法陈汉武1),4)李文骞1)阮越1),2)李志强3)1)(东南大学计算科学与工程学院南京210096)2)(安徽工业大学计算机学院安徽马鞍山243005)3)(扬州大学信息工程学院江苏扬州225009)4)(东南大学计算机网络和信息集成教育部重点实验室南京210096)摘要可逆逻辑综合是指对给定的可逆函数自动构造对应的可逆逻辑电路.现有的可逆逻辑综合算法虽然通过后期优化能够得到近似最优解,但是都存在生成的原始电路门数较多的问题,增加了后期优化工作的难度.文中提出一种基于真值表异位数计算的综合方法,根据异位数判定是否需增加逻辑非门达到减少输入和输出向量的汉明距离,从而实现边计算边简化函数,最后采用汉明距离递减变换的方法生成最终的电路.通过实验表明,相比于其他的综合算法,该算法得到的原始电路更接近于最优解或近似最优解,很大程度上减少了算法后续的优化工作量.关键词可逆逻辑综合;扩展Toffoli门;汉明距离;异位数1引言可逆逻辑综合是指对给定的可逆函数自动构造对应的可逆逻辑电路.量子可逆逻辑电路综合算法设计的终极目标是:发现更简单的方法,构造更高效的算法,实现计算机自动设计具有更小量子代价的量子可逆逻辑电路.最近30多年来,科研工作者基于多种可逆量子逻辑门,如控制非门(CNOT)、Toffoli门、Fredkin门等,围绕量子可逆逻辑综合算法设计,提出了许多设计方案,取得了若干标志性成果.归纳这些算法设计的思路大体可以分为两大类:穷举搜索法和启发式搜索法.穷举搜索法虽然能够产生最优解,但是由于其搜索范围过大,往往需要很长的计算时间,而且随着电路规模增大一个量子比特,其搜索空间成指数级的阶乘增长,使得现有计算机系统的硬软设备都将无法忍受.代表性的工作发生在2003年,Shende等人[1]利用穷尽搜索法,第一次综合出所有三量子的最优电路,但此类算法缺乏普遍适用性.因为结果表明,变量可逆逻辑函数的数量是2n!,当n4时(注:四量子比特的电路规模将是24!=20922789888000=O(1013)),目前技术还无法实现同时存储24!个可逆电路,且运行时间也无法忍受,这是个Pspace难题.2008年Li等人[2]采用多种压缩方法综合四量子电路,虽然结果已是当前的最好结果,但也只能综合出4量子可逆逻辑的前8层最优电路.除此以外一般性的方法还有布尔可满足性方法(BooleanSatisfi-ability,SAT)[3]、定量布尔公式方法(QuantifiedBooleanFormula,QBF)[4]、动态规划方法(DynamicProgramming,DP)[5]和符号的可达性(SymbolicReachability)[6]等近似穷举的搜索方法.启发式搜索法是穷举法的改进,在搜索的过程中增加了启发式规则,减少了搜索的范围,缩短了运行时间,但是这类方法综合出的电路往往代价不是最小的,长度不是最短的,有时还不能保证合成算法的收敛性.启发式搜索法的代表性工作是2003年前后Miller等人[7-8]应用谱函数实现了近似最优的可逆电路化简,而Reed-Muller法是对探索法的改进,在小规模电路综合中效果很好,它缩小了电路的试探代价,缩短了运行时间.但是,这类方法由于缩小了选择范围,并且对于综合效果没有回馈也没有预测,所以它不能保证综合算法的收敛,即电路综合也可能失败.2005年Maslov等人[9]率先在量子可逆电路综合中提出真值表构造法以及使用模板技术优化电路的思想,真值表法是一种贪心算法,它根据给定的函数功能,有目的地在逻辑门库中选择逻辑门,不断试探生成电路,直至找到实现该函数功能的电路为止.真值表法能够综合任意量子电路,但其综合出来的门电路冗余度很高.针对门的冗余,提出模板技术优化电路,但减少门的数量有限.除此以外一般性的方法还有如Rademacher-Walsh谱均数方法[10]、二进制共享决策图方法[11]、基于模板的变换法(Tem-plate-BasedTransformation)[12]和基于PPRM表达式的变换法(Positive-PolarityRead-Muller)[13]等等.总之,目前量子逻辑电路综合算法还存在着量子逻辑电路规模小、量子代价过高、优化过程中时空复杂度高等一系列问题,还不能满足未来量子计算和量子信息以及其他领域对量子逻辑电路的要求.因此,系统而深入地研究量子可逆电路的合成及优化技术,寻找更为高效的合成和优化算法是很有必要的.本文提出一种基于汉明距离递减变换的综合方法.算法首先计算出所求可逆函数的最大的异位数(也称异位最大数),决定是否能用一个NOT门来大幅度降低电路的复杂度,达到对其生成电路的先行优化效果;接着运用汉明距离递减的方法,得到一系列的对换序列;最后将这些对换所对应的EGT门级联起来生成函数的电路.本算法最大的优点在于:边合成边优化,此法能够较多地减少综合电路在优化之前门的数目,降低了后期优化的工作.该算法思想简明易懂,时间复杂度小,且不涉及各种复杂运算.2预备知识定义1[14].可逆逻辑.设f(x1,x2,…,xk)=(y1,y2,…,yk)为一个k元的布尔函数.f:Bk→Bk,其中B={0,1},则f是可逆的当且仅当f是双射函数.逻辑门是可逆的当且仅当它实现一个可逆函数,若干可逆逻辑门的级联构成的电路称为可逆电路.定义2[14].量子门.Toffoli量子门,记为TOF(C,T),简称TOF门.输入变量集合In={xi1,xi2,…,xin},控制端集合C={xi2,xi3,…,xin},用“·”表示;受控端集合T={xi1},用“”表示,且C∩T=,C∪TIn;输出变量集合映射为xi1∏n常用的几种TOF门如图1所示.Page3传统的Toffoli门,控制端都置1时,受控端信号反转.然而1并没有任何特殊之处,当然也可以考虑控制端为0时,受控端信号反转.从工程角度来说,以0控制和以1控制的TOF门实现代价相等.定义3[14].扩展通用Toffoli(ExtendedGeneralToffoli)门,记为EGT(C,T),其是由下面4种线型组成(如图2).(1)肯定控制线(图2(a)).如果在这条线上输入的是0,则受控线的值将不改变.如果输入的是1,则其他的肯定/否定控制线确定受控线上的值是否被反转.通过肯定控制线的值不变.(2)否定控制线(图2(b)).如果在这条线上输入的是1,则受控线的值将不改变.如果输入的是0,则其他的肯定/否定控制线确定受控线上的值是否被反转.通过否定控制线的值不变.(3)受控线(图2(c)).每个门只有一条受控线,通过受控线的值,受肯定/否定控制线的控制.(4)无关线(图2(d)).通过无关线的值不变,也不对其他线产生影响.由这4种线型组成的可逆逻辑门,称之为扩展通用Toffoli门,简称EGT.EGT门可转化成TOF门,如图3(a)和图3(b).定义4.函数f的真值表,如果某输入位与其对应的输出位异或值为1,则称之为输出位的异位,否则称之为输出位的同位.定义5.函数f(x1,…,xn)=(y1,…,yn)中某一条线路上所有输出位的异位数总和称为函数f在这条线路上的异位数.函数的异位数就是函数f(x1,…,xn)=(y1,…,yn)在所有线路中最大的异位数,也称异位最大数.例如:函数f及其真值表如下:f(0,1,2,3,4,5,6,7)=(7,0,1,2,3,4,5,6)与线路a3对应的线路b3的异位数为2,与线路a2对应的线路b2的异位数为4,与线路a1对应的线路b1的异位数为8,3条线路中异位数最大的为b1,所以函数f(0,1,2,3,4,5,6,7)=(7,0,1,2,3,4,5,6)的异位数为8.推理1.可逆函数的异位数是偶数.证明.每个可逆函数都对应一个n×n的可逆电路,需要一个rn×rn转置矩阵,r是一个基数(r=2是二元量子电路,r>2是多元量子电路).取r=2,任取n×n可逆电路生成的真值表中的一条线路,观察便可知,其中0和1的个数之和必为2n,其中0的个数为2n-1,1的个数也为2n-1.假设有m个异位,那么一定有2n-m个位相同.再假设m异位中,输入项有m1个0和m2个1,且m1+m2=m,那么输出项就一定有m2个0和m1个1.输入项同位的0有2n-1-m1,输出项同位的0有2n-1-m2,又因为两者是同位,所以2n-1-m1=2n-1-m2,又因为m1=m2,所以m=m1+m2=2m1为偶数.因为函数的异位数为线路的异位数的最大值,因此也为偶数,得证.定义6[15].等长字符串p和q之间的汉明距离H(p,q)是p和q对应位置的不同字符的个数.特别的,可逆函数f的任意输出项与对应输入项的汉明距离简称为输出项的汉明距离.定义7[15].函数f的复杂性C(f)是其所有输出项的汉明距离之和.例如函数f=(0,1,2,7,4,6,3,5)的复杂性为C(f)=0+0+0+1+0+2+2+1=6.定义8[15].对n比特的可逆函数f,如果存在两个只有1位不同输出项A、B,可将A、B交换而得到一个新的可逆函数f,这个交换操作定义为SWAP[A,B].整个交换过程可记作fSWAP[A,B→]f,f=f·SWAP[A,B].每个SWAP操作都可以用一个EGT门实现.Page4例1.考虑图4函数f={0,1,2,7,4,6,3,5},输出项[000]与[001]只有一位不同,则可以做SWAP[000,001]操作,从而得到一个新的函数f={1,0,2,7,4,6,3,5},对应的EGT门为TOF(x-2,x1),如图4所示.x-汉明距离为1.图4f={0,1,2,7,4,6,3,5}做SWAP操作定理1.每个SWAP操作改变相应输出项的证明.SWAP操作只改变了输出项的一位,故汉明距离改变为1.定理2.每个SWAP操作改变函数f的复杂性为2,0或-2.证明.假设f的两个输出项为A、B可以进行SWAP操作,在SWAP之前A、B的汉明距离分别记为HA和HB,不失一般性假设A、B最后一位不同,则A、B可表示为A=[x1,x2,…,xn-1,xn],B=[x1,x2,…,xn-1,x-xn-1,x-的值或+1,或-1(HB同样),而HA和HB值的变化互不影响,故当前函数f的复杂性,在HA和HB同时增加1时,为C(f)+2;在同时减少1时,为C(f)-2;当一个增加一个减少时,为C(f)不变.证毕.3算法描述算法的目的是通过一系列的变换使得输出序列有序.算法由两部分构成:基于异位数的选择算法化简最初的函数;对简化了的函数使用汉明距离递减变换算法来生成最终的电路.下面详细描述了算法的两个步骤:算法1和算法2,并且在最后给出完整的例子来说明算法是如何进行的.算法1.异位数的选择算法.N:函数f的异位数fori←1to2n-1ifi=y[i]i++elseendifendfor按照SWAP操作的逆序将每个SWAP对应的EGT门连接起来,得到量子电路CircuitreturnCircuit:{t1,t2,…,tm}如果N=2n,则在这条线路上加一个NOT门,将对应的全部是异位的这条线路全部改成同位,然后运行汉明距离递减的算法.如果N>2n-1,则交换在这条线路上的两两同位对应的值(交换之后,使得这两个输出项在这条线路上转变为异位),经过(2n-N)/2次变换使得变换后的函数f的异位数N=2n,在这条线路上加一个NOT门,将对应的全部是异位的这条线路全部改成同位,然后运行汉明距离递减的算法.如果N2n-1,则运行汉明距离递减的算法.算法2.运用汉明距离递减变换的算法将可逆函数f生成EGT门表示的量子线路.输入:用异位数算法化简过的可逆函数输出:EGT门表示的量子线路H(A,B):A和B的汉明距离;SWAP(A,B):交换A和B;y[i]:在函数中生成与输入项i相对应的输出项yi.算法扫描到第一个汉明距离不为0的输出项时,下面必然存在一个与之汉明距离为1,并且能使得交换之后的汉明距离减少的输出项,使得这个算法闭合.譬如:在四量子电路中,扫描到1000→1100(汉明距离为1,此时,1000之前的所有输出项都已经排好序),则下面至少存在1000,使得算法能够继续执行.或者扫描到1000→1111(汉明距离大于1),下面一定存在使得算法闭合的输出项1011、1110和1101.算法举例:以可逆函数f={7,0,1,2,3,4,5,6}为例说明汉明距离递减的算法的流程(见表1).Page5表1犳={7,0,1,2,3,4,5,6}带汉明距离的真值表x3x2x1y3y2y1H00011130010001010001201101011000113101100111010121111101注:表中H为汉明距离(下同).复杂性为C(f)=3+1+2+1+3+1+2+1=14.(1)其中相对应的线路x3和y3的异位数为2,相对应的线路x2和y2的异位数为4,相对应的线路x1和y1的异位数为8,所以函数f的异位数为8,则在线路y1上加一个非门,然后让y1对应的位全部变为同位(如表2):表2犳={6,1,0,3,2,5,4,7}带汉明距离的真值表x3x2x1y3y2y1H00011020010010010000101101101000102101101011010011111110复杂性为C(f)=2+0+1+0+2+0+1+0=6.(2)接着运行汉明距离递减变换的算法,从头开始扫描,第1行110的汉明距离并不为零,接着往下扫描,找到和第1行110的汉明距离为1并且交换后使得输入项000对应的输出项的汉明距离减少的项,找到了010,交换,汉明距离分别变为1和1,记为(110,010)(如表3):表3犳={2,1,0,3,6,5,4,7}带汉明距离的真值表x3x2x1y3y2y1H00001010010010010000101101101001101101101011010011111110复杂性为C(f)=1+0+1+0+1+0+1+0=4.(3)由于第1行010的汉明距离为1,往下扫描,找与第1行010的汉明距离为1并且交换之后使得输入项000对应的输出项的汉明距离减少的项,找到了000,交换,记为(010,000)(如表4):表4犳={0,1,2,3,6,5,4,7}带汉明距离的真值表x3x2x1y3y2y1H00000000010010010010001101101001101101101011010011111110复杂性为C(f)=0+0+0+0+1+0+1+0=2.(4)由于第1行的汉明距离变为0,接着从第2行往下扫描,找出汉明距离不为0的行,扫描到第5行110(汉明距离为1),接着往下面扫描,找与第5行的汉明距离为1并且交换之后使得输入项100对应的输出项的汉明距离减少的项,找到100,交换,记为(110,100)(如表5):表5犳={0,1,2,3,4,5,6,7}带汉明距离的真值表x3x2x1y3y2y1H00000000010010010010001101101001000101101011011001111110复杂性为C(f)=0+0+0+0+0+0+0+0=0.(5)这时汉明距离全部为0,算法结束,根据前几步所得到的SWAP的序列为SWAP[110,010],SWAP[010,000],SWAP[110,100],按照逆序连接起来即可生成对应的线路.如图5所示可实现函数f={7,0,1,2,3,4,5,6}.可以看出该算法计算简单,而且没有过多的迭代过程,可逆函数f={7,0,1,2,3,4,5,6}的最优可逆电路的门数为3,而该算法得到的电路门数在优化之前已经减少为4,接近于最优电路,极大地减少了后期优化工作量.4实验结果和分析以文献[16]为例,将本文算法与文献[16]的结果进行比较,比较结果详见表6.Page6[1,0,3,2,5,7,4,6]4546[7,0,1,2,3,4,5,6]4738[0,1,2,3,4,6,5,7]3332[0,1,2,4,3,5,6,7]5552[1,2,3,4,5,6,7,0]5558[7,5,2,4,6,1,0,3]6966[4,3,0,2,7,5,6,1]7774[5,0,3,6,1,4,7,2]3638其中:(1)列表示本算法优化前计算出的Toffoli门的个数;(2)列表示文献[16]的算法优化前计算出的Toffoli门的个数;(3)列表示文献[16]的算法优化后得到的Toffoli门的个数.由于在文献[16]中,作者已经和其他目前结果较好的算法(PPRM表达式法、Non-search方法、POT方法)进行了比较,因此在这里只和文献[16]提到的算法相比较.从表6可以看出来,异位最大数为8和6的可逆函数在运用本文提到的方法时,生成的电路的门数有很大的改进,有的就已经达到了文献[16]中所用方法优化后的结果.在异位最大数为2和4的情况下,与文献[16]中所用的方法优化之前的结果是一样的.三量子可逆逻辑电路中,由推理1可知,异位最大数只会出现0、2、4、6、8.由表7可以看出函数的异位数出现0的概率最小,只有一种情况出现6和8总和达到所有情况的一半以上.可逆函数的异位最大数如果为8的话,将极大地增加函数的计算复杂度,这时在异位数为8的这条线路上加一个非门就可以最大程度地减少函数的汉明距离(减少的数为8),即减少了函数的计算复杂性.当异位数为6的时候,仅仅需要交换两个同位所对应的项,就可以化为异位最大数为8的情况.而在异位最大数为4和2的时候,同位数很多,如果要转变为异位最大数为8的情况,则需要通过2次或者3次的交换才行,这样反而会增加电路的个数,因此就直接采用汉明距离递减变换的算法.而异位数为0的情况只有一种,即恒等电路,不需要任何的一个门,结果详见表7.5结论本文提出了一种新颖的可逆逻辑电路综合方法,其实质就是基于变换规则的合成法,首先计算异位数,将可逆函数的汉明距离大幅度地降低,从而降低了量子电路综合的复杂度,接着再用汉明距离递减的算法来综合可逆量子逻辑电路.实验验证了本文算法的高效性,综合算法能将特定函数转化为电路,采用边综合边优化的方法,有效地降低了电路优化阶段的工作量.虽然减少了优化之前门的数目,不过与理想效果还有一定的差距,引入群理论对于中间过程进行精简,建立更多更高效的启发式规则,以及引入更有效的优化技术,则是以后研究的方向.
