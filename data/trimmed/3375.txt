Page11引言PnP问题一直是计算机视觉、摄影测量学乃至数学领域的一个经典问题.为了求解机器人的位姿,在1981年,Fischler和Bolles首先提出了PnP问题[1].由于其在物体定位方面具有重要价值,因此受到了世界各国学者的广泛关注[2-8].传统的PnP问题是以假设摄像机的内参已知为前提的,然而在有些实际任务中,摄像机的内参数需要经常被调节[9].因此对未标定摄像机PnP问题的研究就更具有实际意义.未标定摄像机PnP问题是指已知n个控制点在世界坐标系及图像坐标系中的坐标,在摄像机内参未知的情况下,求出摄像机在世界坐标系中的位姿,同时求出摄像机的内参[9].类似的,未标定摄像机PnP问题的研究焦点也是确定问题的实解最多可达到多少个.文献[9]和[10]分别利用SVD分解方法和消元法较系统地研究了未标定四参数摄像机P5P问题解的情况,同时提出了各自的求解方法.文献[11]研究了未标定二参数摄像机(即只有两个方向上的尺度因子)共面P4P问题解的情况,所得到的结论是:唯一解或无穷解,同时讨论了有唯一解的代数条件.针对未标定二参数摄像机,本文研究了非共面P4P问题的解析解.重要结果有:当4个控制点不共面时,未标定二参数的P4P问题的解仅有两种可能:(1)最多有8个实解,而且解的上限可以达到;(2)有无穷多解.本文同时给出了例子验证上述结论,并且利用仿真及真实图像实验说明求解算法的稳定性和对像素噪声的鲁棒性.2约束方程设4个控制点在图像坐标系中的坐标为犔pi=(xpi,ypi)T(i=1,2,…,4),而在世界坐标系中的坐标为犔wi=(xwi,ywi,zwi)T(i=1,2,…,4).摄像机为二参数针孔模型,令犕=其中fu,fv分别为图像平面u,v轴的尺度因子.从世界坐标系到摄像机坐标系的刚体变换为犔ci=犚(犔wi-犘0)(i=1,2,…,4),其中犔ci=(xci,yci,zci)T(i=1,…,4)表示4个控制点在摄像机坐标系中的坐标,犚=(X0,Y0,Z0)T为摄像机坐标系原点(镜头光心)在世界坐标系中的坐标,犚,犘0常被称为摄像机的外参.为了方便,我们令犪1=(a11,a12,a13),犪2=(a21,a22,a23),犪3=(a31,a32,a33).如果OCZC是摄像机的光轴,那么从摄像机坐标系到图像坐标系的投影变换可表示为xpi=fuxcizci是从世界坐标系到图像坐标系的变换可写为如下:xpi=fu犪1·(犔wi-犘0)式(1)也可重写为fu犪1·犔wi-fu犪1·犘0=xpi犪3·(犔wi-犘0),fv犪2·犔wi-fv犪2·犘0=ypi犪3·(犔wi-犘0),由于犚也是正交矩阵,于是我们还能获得另外6个基本方程:方程组(2)、(3)和(4)是由14个变量构成的14个方程,其中12个变量来自外参,而另外2个是内参.3解析解因为4个控制点不共面,因此有犇1=根据式(2)和式(3)可得fu犪T1=xp2犔T烄xp3犔Txp4犔T烆2=fv犪Typ2犔T烄yp3犔Typ4犔T烆犇-11犇-11利用式(4)、(5)和(6),可以得到Page2fu犪3犪T1=xp2犔T烄xp3犔Txp4犔T烆犪3犇-11fv犪3犪T2=yp2犔T烄yp3犔Typ4犔T烆犪3犇-11fufv犪1犪Txp2犔T烄烄xp3犔T犇-11xp4犔T烆烆yp2犔T烄烄yp3犔T犇-11yp4犔T烆烆为了便于说明,分别重写式(7)、(8)和式(9)为如下形式:其中w1不含未知数,p1,q1,w2为a31,a32,a33的一次齐次多项式,而p2,q2,w3为a31,a32,a33的二次齐次多项式.于是利用析配消元法可构造出5个关于a31,a32,a33的齐次多项式方程:p1p2q1q2p1p200q1q2w1w2w3其中第1个方程为3次齐次多项式方程,其余均为4次齐次多项式方程.不妨设x=a32/a31,y=a33/a31,隐藏变量y,上述5个方程可简写为再次利用析配消元法,我们可以构造出3个只含变量y的10次多项式方程,具体构造方法如下:将上述3个方程逐个消掉变量y的最高次项,最终可得到一个只含变量y的8次多项式方程,此方程就是未标定二参数摄像机非共面P4P问题的闭型解,同时也说明最多可有8个实解.由每个解y可得到一个x,进而可得到两个方向相反的犪3.把犪3代入到式(7)或(8)中可得到犪3犘0,然后将式(5)和(6)单位化,可得到犪1和犪2,反过来又可求出fu和fv.由于旋转矩阵犚满足犚=1,因此可排除掉犪3的一个解.最后根据式(2)和(3)就能求出犘0.通过以上分析,我们断言未标定二参数摄像机非共面P4P问题最多有8个实解.4模拟与真实图像实验为了检验本文所提出算法的实用性和鲁棒性,我们进行了大量的模拟和真实图像的实验.4.1模拟实验例1.8组实解.已知4个控制点在世界坐标系的坐标为犔w1=(0,0,0)T,犔w2=(0,0,35)T,犔w3=(0,40,0)T,犔w4=(50,0,0)T.对应的图像坐标分别为Page3犕=犕=犕=犕=犕=犕=犕=犕=表1例1中的所有8个实解烄0.423367-0.7080170.56522-3.542620.8446240.534120.03641155.261烆-0.3276750.4619830.8241370.391331烄-0.433615-0.598876-0.6732942.16908-0.7833590.619805-0.04680022.56791烆0.4453390.507138-0.737892-0.206772烄0.305288-0.05385240.95073655.5982-0.113110.9892810.09235617.54133烆-0.945518-0.1357330.2959250.722332烄0.095022600.995475100-0.7039070.7071070.0671911100烆-0.703907-0.7071070.067191110烄-0.3870510.6180020.684299-2.68347-0.824749-0.5638810.04275923.69144烆0.412288-0.5478250.727947-0.302662烄0.4770710.65139-0.5899942.763760.786942-0.615511-0.04323853.30245烆-0.391313-0.443663-0.8062490.247602烄-0.897912-0.3684160.2408856.66580.389921-0.9196530.046911725.7882烆0.2042420.1360470.969421-1.35581烄-0.598623-0.7800710.18204361.13920.79625-0.6042720.028997982.3528烆0.08738330.1623110.982863-4.24584制点分别投影在512×512的图像平面上.图像坐标中所加噪声为均匀噪声,幅度从0到1.0个像素,共10个噪声级,相邻两个噪声级之间的间隔为0.1像素.在每个噪声级下,运算本算法1000次,计算所得内外参与真实值之间的绝对误差绝对值的平均值.图1显示了在不同噪声级下,所求得各结果的变化趋势.例2.无穷多解.已知4个控制点的世界坐标为犔w1=(50,0,0)T,犔w2=(0,0,50)T,犔w3=(0,-50,0)T,犔w4=(0,50,0)T.对应的图像坐标分别为犔p1=(0,0)T,犔p2=(400,0)T,犔p3=(0,-400)T,犔p4=(0,400)T.不难验证,这4个控制点不共面.对应的无穷多解为8x00烄08x0犕=烎001烆例3.鲁棒性分析.通过计算机模拟实验来验证在图像坐标有噪声的情况下文中算法在确定摄像机内外参上的鲁棒性.,实验设计如下:摄像机的内参矩阵为所选的4个控制点世界坐标为犔w1=(0,0,0)T,犔w2=(0,0,50)T,犔w3=(0,30,40)T,犔w4=(20,-20,30)T.随机选取不同的摄像机外参,将4个控不难验证,4个控制点不共面.实解,如表1所示.根据上面所提出的求解方法,可得到如下8个从图1中可以看出,文中所提出的方法在噪声级为0时可以得到十分精确的内外参结果,这也说明该算法理论上是完全正确的.随着噪声的增大,所求出的各项结果的精度会有所下降,但仍然接近真实值,特别是外参.通过实验,我们也发现,在有噪声的情况下,当选定4个控制点后,选取不同的成像姿态对结果精度的影响也不同.实验表明,当4个控制点的像点相互距离比较大,即分布比较分散时,所求内外参的精度较高,这个结论对指导如何选择合适的像点具有重要价值.Page4图1模拟实验结果4.2真实图像实验除了模拟实验,我们还进行了大量的真实图像实验.实验采用CanonPowerShotA530拍摄一幅640×480大小的图像,如图2所示.经后期加工,图中已标出世界坐标系及各个控制点的位置.经测量,可得如下已知:犔w1=(0,0,0)T,犔w2=(0,0,43)T,犔w3=(0,106,0)T,犔w4=(106,106,106)T(单位:mm),对应的图像坐标分别为犔p1=-111犔p3=-249表2标定结果犕=为了验证标定所得内参数是否正确,我们对图3中的真实图像(a)、(b)进行了重建实验,(c)为重建结果,其中实心点为在图(a)、(b)上所选取的对应点.若令π12365表示图(c)中由点P1,P2,P3,P6,P5所确定的平面,则通过重建所求得的平面π12365与π12489之间的夹角为89.1175°(真实值应为90°),平应用本文方法,计算出摄像机的内外参数,如表2所示.烄-0.9113330.40778-0.0564527-104.295-0.183599-0.525341-0.830848-256.75烆-0.368461-0.7468150.553629277.986面π159与π34678之间的夹角为3.438°(真实值应为0°),平面π159与π234之间的夹角为51.6585°(真实值应为54.7356°),上述实验结果说明对于真实图像,利用本文方法求出的内参数较为精确,可以得到很好的重建结果.Page5图3重建所用真实图像以及重建结果的示意图5结束语本文对未标定二参数摄像机非共面P4P问题的解析解进行了研究,最终得到了只含一个未知数的8次多项式方程.分析表明,该问题最多有8个实根.同时给出了最多有8个实解和有无穷多解的具体例子以及存在像素噪声时的鲁棒性模拟实验和利用标定结果进行三维重建的实际例子,各种实验结果表明文中算法在确定摄像机内外参上精度很高,且鲁棒性很强.利用本文的方法不需要任何初值就能求出所有的解,可以避免初值选取不妥给结果带来的影响.文中结果在物体定位、手眼定标、路标导航等领域具有比较重要的实际应用价值.
