Page1SAN-EBON:一种基于结构化对等网的P2P工作流系统节点定位网络高磊曾广周(山东大学计算机科学与技术学院济南250101)摘要基于P2P的工作流系统符合工作流去中心化的发展趋势.目前,P2P工作流系统主要是基于非结构化P2P网络构建的.然而,非结构化P2P网络提供的泛洪或基于超级节点的中心化发现策略和中心化的负载分配机制无法满足大型P2P工作流系统在动态环境下的需求.因此,在基于非结构化P2P网络构建的工作流系统中,节点发现和任务负载均衡成为制约系统性能的关键因素.文中提出一种新的基于结构化P2P网络的工作流系统节点定位网络———SAN-EBON.该系统采用分层逐步求精的节点发现策略,外层在服务聚类的基础上首次在工作流系统中引入服务定位网络组织服务联盟,构建一种新的多层结构化P2P网络SAN,实现服务的快速发现;内层构建一种新的负载均衡网络EBON,使用基于随机图的增强算法实现服务联盟内部实时的去中心化负载均衡,与SAN结合,从而达到提高发现效率和精度、降低通信带宽的目的.关键词P2P工作流系统;结构化P2P网络;服务联盟;服务寻址网络;平衡覆盖网1引言基于P2P的工作流系统是一种新的工作流管理系统,符合下一代工作流管理系统去中心化的发展趋势[1].对等计算模式的引入使工作流节点在运行时阶段直接通信,尤其实现了控制流在各节点中的分布,更好地反映了工作流的分布特性和群组协作的社会属性.目前对工作流的研究主要集中在工作流模型及其执行语义和时序约束等方面[2],对于运行时阶段的流程控制主要依赖于工作流中心引擎.但P2P工作流系统更加强调分布式的控制结构和对等点之间的协同效率,因此高效的节点定位机制,即服务请求消息在参与节点之间的路由,成为影响这类系统性能的重要因素.文献[3]通过业务流程组织服务工作流,根据全局服务信息搜索最优执行路径,但在缺少全局信息的对等环境中无法有效展开.文献[4-5]均采用分布式控制结构,其中文献[4]使用一种静态路由结构,在建模时阶段静态绑定了任务前驱和后继节点的消息队列标识;文献[5]则采用类似于UDDI的中心路由结构实现对执行节点的动态查询;静态路由无法适应动态变化的应用环境,而中心化的动态定位机制容易形成路由瓶颈.SwinDeW及其扩展系统[6-9]是基于JXTA[10]构造的非结构化P2P工作流系统,采用了动态非中心化的路由机制避免了上述问题.但该系统通过泛洪实现节点定位引入较大的通信负载,且定位效率和准确性不高;通过群组内节点之间的协商机制实现任务分配要求每个节点必须在线维护本群组内所有节点状态,在动态环境中容易引发网络波动.针对上述问题,本文采用分层逐步求精的路由策略,按服务对节点进行聚类,首次将结构化P2P网络引入工作流系统,提出一种新的基于结构化对等网的P2P工作流节点定位系统SAN-EBON.结构化P2P网络采用基于DHT(DistributedHashTable)的分布式发现和路由算法[11],有着良好的定位准确性、可扩展性和自组织性.基于这一特性,本系统外层结合CAN算法[12]和服务聚类构建了一种新的结构化P2P网络SAN(ServiceAddressedNet-work),该网络可视作多层结构化P2P网络的叠加,实现了对服务联盟的快速精确定位;在联盟中,内层将工作负载映射为随机图拓扑,采用基于随机漫步的EBON(EnhancedBalancedOverlayNetwork)网络,可以较小的连接度数在联盟节点中实现去中心化的实时任务负载分配,最终精确定位执行节点.两者结合提高了路由精度和效率,降低了定位最优执行节点时的通信带宽,达到缩短流程实例在P2P工作流系统中非人为因素执行时间的目的,适用于节点数目多且动态变化范围大的系统.2SAN-EBON系统结构系统主要由工作流模型映射(WorkflowMod-elingMapping,WMM)、流程模型发布(WorkflowModelingPublishing,WMP)和SAN-EBON网络三部分构成(如图1所示).WMM在建模时阶段进行,将已有的业务流程映射为SAN网络中的逻辑节点,通过流程发布与相应的执行节点绑定,从而实现流程模型在SAN网络中的部署.定义1.业务流程可表示为一个有向图D=〈T,R〉,其中T对应有向图中的顶点集,表示流程中所有任务(包括原子任务和复合任务)的集合,称为任务集;RT×T对应有向图中的边集,为定义在任务集上的逻辑关系.定义2.任务ti∈T,i=1,2,…,n由二元组表示(Task_id,Task_des),其中,Task_des=(input,output,pre_condition,post_condition,task_seman-tic,resource,QoS)为任务描述;input,output,pre_condition,post_condition分别为输入数据、输出数据、入口约束条件、出口约束条件;task_semantic为任务语义描述(语义描述语言和模型在此不作讨论);resource为任务所需的计算资源,QoS为完成该任务必须提供的服务质量.Task_id=(tp_id,san_id)为任务标识,tp_id为任务模型标识,在流程模型中唯一标识一个任务;san_id=(x1,x2,…,xd)Page3是d维笛卡儿坐标,在SAN逻辑坐标空间中唯一标识一个任务以及部署了该任务的节点,称为SAN坐标.定义3.SanHash:Task_des→san_id是定义在T上的映射,对于任意一个Task_des,唯一确定一个san_id与之对应,该映射通过一致性散列函数[11]实现,记作(x1,x2,…,xd)=SanHash(Task_des).定义4.Td:R→Rlo是定义在R上的映射,Rlo是当前任务的局部控制关系,由二元组(Tsetpre,Tsetpost)表示,其中,Tsetpre={(san_idj,Lpre)|t(san_idj)∈T∧〈t(san_idj),t(san_idi)〉∈R,i,j=1,2,…,n}是任务t(san_idi)的前驱任务集,Lpre是前驱任务与当前任务之间的逻辑关系;Tsetpost={(san_idj,Lpost)|t(san_idj)∈T∧〈t(san_idi),t(san_idj)〉∈R,i,j∈1,2,…,n}是任务t(san_idi)的后继任务集,Lpost是后继任务与当前任务之间的逻辑关系.通过SanHash和Td映射,业务流程中的原子任务被打包为相应的流程服务并映射到SAN空间中的逻辑节点上,即定义5.定义5.SAN流程服务Si,i=1,2,…,n由二元组(ti,Rlo)表示.由上述定义,每个SAN逻辑节点由san_id唯一标识,即SAN坐标空间中的不同逻辑节点对应了工作流模型中的不同流程服务,从而实现了工作流模型到SAN坐标空间的映射.WMP将经过散列后的业务流程发布到相应的执行节点,使流程服务与具体的执行节点绑定,从而将物理节点映射到SAN空间.该过程在流程运行时阶段进行,采用自顶向下由物理节点主动拉动的方式实现.流程模型的定义及映射后的流程服务可由系统的注册服务器统一管理,模型发布则在运行阶段由注册节点主动发起.Task-des;1.注册节点从注册服务器下载希望承担的任务描述2.与本地服务描述进行匹配,评估本地资源,若达到QoS要求,则在本地部署该任务(包括加载相应服务和资源);3.向注册服务器注册本地部署任务和加载服务;4.注册服务器将部署任务的san_id和Rlo绑定到注册节点;5.注册节点根据san_id加入系统,确定其在SAN-EB-ON网络中的位置,根据Rlo明确需要接收什么数据并将自身的处理结果传递给什么任务,实现流程模型在所有参与节点中的数据和控制分布.SAN-EBON网络(见第3节)是系统数据流和控制流运行的自组织环境,构成系统的基础结构.系统执行节点的自组织、有效定位、加入、离开以及任务实例的负载分配均通过该网络实现.该网络由SAN和EBON两层网络组成,其中SAN以一种新的结构化P2P网络组织外层定位,较已有的P2P网络(结构化和非结构化)具有更高的路由效率和更小的通信负载;EBON以随机图映射节点负载状况,实现了内层的去中心化实时负载均衡,较已有的P2P工作流系统(均采用中心化任务调度)避免了网络负载波动和路由瓶颈.3SAN-EBON网络结构3.1SAN网络可扩展内容寻址网络(CAN)在结构化P2P网络中引入了多维标识符空间的概念,与单维空间中线性遍历相比,路由效率得到了极大的提高.CAN将覆盖网映射到一个d维笛卡尔坐标空间,每个节点的位置由其自身IP经散列后得到的d维坐标决定,坐标空间被不同节点分割成互不相交的区域,且每个节点占有一个区域.但是CAN网络中每个区仅包含一个节点,在节点变化频繁的动态环境中,由于区域的合并拆分将引入较大的拓扑维护开销;同时像所有基于DHT的结构化P2P网络一样,CAN网络中的节点上存储的是指向其它节点数据源的索引,因此CAN中的目标节点并不是数据源的存储节点,还需进行二次映射.针对上述问题,在CAN的基础上,我们首先用服务对节点进行聚类,形成服务联盟,将服务联盟映射到多层CAN坐标空间中,再通过EBON网络将多层逻辑空间压缩到一起,从而构成SAN(ServiceAddressedNetwork)网络.定义6.承担相同任务的节点构成的集合称为服务联盟,一个服务联盟对外提供同一类服务.定义7.任务的SAN坐标唯一标识坐标空间中的一个逻辑节点,称为集结点,集结点唯一标识一个服务联盟以及联盟中承担该任务的所有物理节点.定义8.集结点将坐标空间划分为不同的区域,设空间维数是d,若两个集结点坐标中有d-1维是相等的,剩余的一维相邻,则称两个集结点相邻,相应区域为邻接区域.集结点相邻是其对应联盟中节点相邻的必要条件.由上述定义,SAN网络是由各集结点共同构成的逻辑坐标空间,两个相邻集结点沿相邻维度划分坐标区域(具体划分算法在4.2节给出),每个集结点占有一个区域,由san_id唯一标识.根据定义2、6,因为san_id在逻辑空间中唯一标识一个任务及Page4标识承担该任务的所有物理节点,所以承担相同任务的物理节点具有相同的SAN坐标,将被映射为同一个集结点,从而将服务联盟映像到SAN空间中.这样在一个坐标区域中实现了分配多个物理节点,使得SAN网络中的逻辑节点(集结点)数目等于流程模型中的原子任务数,相对于CAN等典型的结构化P2P网络以及非结构化P2P网络极大减少了坐标空间中的节点数目,从而有效提高了路由效率.同时在一个SAN区域中分配多个物理节点提高了区域的有效性,即只要有一个有效节点存在,区域拓扑就保持不变,从而避免了CAN网络中由于节点频繁加入、离开给系统带来的区域分裂、合并等巨大的结构维护开销;当联盟中的节点状态发生变化时,SAN的逻辑拓扑保持稳定,使其更加适用于动态环境.但是在每个SAN区域中并不存在超级节点(SuperNode,SN),域内节点不依赖联盟内的其它节点独立路由,即每个节点独立与相邻区域的一个或多个节点形成域间邻居关系,由此形成一层类CAN路由子网,并依赖其所在子网转发路由请求,因此可以将SAN-EBON网络看作多层CAN网络的叠加,每一条路由消息只需通过任意子网转图2二维SAN网络3.2EBON网络EBON(EnhancedBalancedOverlayNetwork)网络用于在服务联盟内均衡任务负载,实现联盟内最优执行节点的定位.BON网络[13]是一个有向随机图;图中的每个顶点代表一个物理节点,每条有向边代表一个任务实例负载,节点权值wi表示结点i所能承担实例负载的个数,节点的入度in_degree(i)发到目标区域,而各层子网通过区域内的EBON网络连结在一起.这一结构与CAN中的过载区域(OverloadingCoordinateZones)[12]相比有效避免了中心节点带来的区域路由瓶颈及由多节点分配带来的区域维护开销.根据上述结构,每个物理节点在SAN网络中的映像位置是由其所承担任务的san_id决定和唯一标识的,因此在SAN中,对服务的请求即是对能够提供该服务的目标区域节点的查找,无须经二次映像,从而将业务流程映射到SAN坐标空间中.图2给出了一个二维SAN网络映射的例子,图中空心点代表物理节点,实心点代表集结点,不同形状表示加载了不同任务,承担相同任务的物理节点由EBON网络连结为服务联盟.由图中可见共有3个服务联盟,分别用圆、三角、正方形不同形状表示.3个集结点将二维坐标空间分为3个互相邻接的区域,每个区域中分别包含2、3、4个物理节点,相同形状的空心点之间的细虚线表示该联盟内的EBON网络.由图中可见,左侧的SAN网络可被分解为右侧的两个子网,处于同一子网中的物理节点逻辑上为域间邻接节点,并通过EBON网络联结在一起.表示节点i空闲实例负载的个数,这样节点的负载状况被映射为随机图的拓扑.每个节点的入度数反比于节点的任务负载,通过随机采样选择空闲负载最大的节点接受任务.随机采样中请求消息的随机游走遵循由节点i向其相邻节点j的转移概率为节点k被采样的概率为Page5由此可见,入度数越大说明空闲资源越多,被采样的概率也就越大,从而通过在图上的随机游走指引任务向轻负载节点流动,且负载的概率分布正比于节点的空闲资源.这样就以较小的连接度数实现了节点之间的去中心化动态负载分配,消除了中心化负载分配带来的性能瓶颈,减弱了因全连接结构引起的网络波动.但BON算法假设所有节点的处理能力是相同的,采样时只考虑空闲资源,而实际系统中参与节点的处理能力和能够提供的服务质量都存在较大差异,因此我们在BON基础上提出EBON算法,同时考虑节点的处理能力、空闲资源和服务质量的差异.(1)考虑节点处理能力和拥有资源的差异,具有较多空闲资源的节点其处理队列也可能较长,无法第一时间处理当前任务,因此应以节点中空闲资源所占比例作为度量.定义如下.定义9.以单个任务实例为单位,称节点i所能承担的最大任务实例数为节点i的权值,记作wi;设当前节点i处理队列长度为λi,则为节点i的占空比;ρi越大表明当前节点有效计算资源越多.(2)考虑承担相同任务的节点其所能提供服务的QoS可能差异很大,根据文献[3]提出的工作流服务质量调度算法,QoS调度要考虑的主要因素有QoS(cap)、QoS(tim)、QoS(co)、QoS(ava)、QoS(rep),通常要求计算能力尽量大,执行时间尽图3EBON网络负载分配实例4SAN-EBON网络功能4.1SAN-EBON路由算法SAN-EBON路由是指对服务请求消息的路由,量短,开销费用尽量小,服务可用性尽量高,服务可靠性尽量大.根据上述优化目标,并将极小约束转变为极大约束,有如下定义.定义10.设节点i的QoS权值向量为[ω1,ω2,…,ω5],则αi=[ω1,ω2…,ω5]·[QoS(cap),(1-QoS(tim)),(1-QoS(co)),QoS(ava),QoS(rep)]T(4)为节点i的QoS因子;αi越大表明节点提供服务质量越高.定义11.设节点i的占空比为ρi,QoS因子为αi,则为节点i的采样值.根据上述定义,EBON算法在随机采样时记录并优先选择随机路径上具有最大采样值的节点分配任务,即Target=argmaxi∈VΦi,其中Target为选定的目标节点.图3给出了一个通过EBON网络分配负载的例子.图中每个节点的标号为该节点的权值,节点旁的小圆为分配给该节点的任务负载,图3(b)中的虚线为新负载分配时随机采样的路径,图3(c)为负载分配后新的拓扑结构.设ni为图中权值为wi的节点,αi=1,按顺时针方向i={6,2,3,4,1,5,4},则采样路径上各节点的采样值依次为Φn1=0,Φn4=1/4,Φn6=1/3,Φn2=1/2,Φn3=2/3,Φn4=1,根据对图中随机漫步路径上各节点采样值的比较选择具有最大采样值的节点,目标节点为Φn4=1的n4,因此将新任务分配给n4,同时剪除一条指向n4的有向边〈n3,n4〉.即节点完成本地任务实例后定位下一步最优执行节点的过程.这个过程在SAN-EBON网络的基础上分服务联盟定位和区域负载均衡两个阶段完成.4.1.1服务联盟定位服务联盟定位实现对目标域的快速定位,遵循Page6SAN坐标空间中从源坐标到目的坐标的一条直线转发路由请求.每条SAN路由消息都包含目的域坐标,如果本地节点不拥有包含这些坐标的区域,则它将消息转发到拥有离目标域最近坐标的邻居节点.最近转发邻居节点的确定需要考虑两个因素:确定最近转发邻域和选择最小延时节点.最近转发邻域具有到目标域的最短直线距离,由SAN空间中本地域到目标域的欧式距离给出:设当前节点第i个邻接区域Σi的SAN坐标为(xi1,xi2,…,xid),i∈[1,d],其中d是当前SAN空间的维数;目标域的SAN坐标为(xs1,xs2,…,xsd),则Σmin=argmini∈[1,d](xi1-xs1)2+(xi2-xs2)2+…+(xid-xsd)其中Σmin为最近转发邻域.根据SAN-EBON结构,当前节点在Σmin中可拥有多个邻居节点,并记录到每个Σmin邻居节点的延时,从而选择延时最小的节点作为最近转发邻居节点.这一过程直到找到目标区域为止,而目标区域的转发节点作为区域接入节点发起区域负载均衡.每个SAN-EBON节点均维护域间路由表以支持上述域间路由过程.域间路由表记录SAN网络中邻接区域的邻居节点信息,每个表目对应一个域间邻居节点,可描述为一个四元组(节点san_id,节点IP,节点区域范围,节点延迟),若节点离开网络,相应表目将被删除.域间路由表的生成基于EBON网络上的随机漫步,对每一个邻接区域,采样随机路径上节点的域间路由表,选择拥有该区域邻居最多的节点,均分其在该区域的邻居节点,形成本地对该区域的相邻节点表目.定理1.设SAN空间维数是d,mi为第i个邻接区域Σi的节点数目,若当前区域的节点数为n,则该区域中节点的域间路由表空间复杂度上限为mi/2log2(Ο∑2di=1证明.对Σi邻居表的裂变过程可表示为一棵完全二叉树(如图4所示).因为树中的每个节点对应一个新的Σi邻居表(灰色节点为已扩展节点,白色节点为尚未加入的节点),当节点加入域时,将分割父节点Σi邻居表生成两个子节点,其Σi邻居数为父节点的1/2;设根节点的层数为0,则第h层节点的Σi邻居数为mi/2h;因此,当n=2h时,节点Σi邻居数为mi/2h;当2h-1<n<2h时,节点Σi邻居数∈[mi/2h,mi/2h-1].又由于当前节点的最小层次为log2n,所以Σi区域路由表复杂性上限为Ο(mi/2log2n);又因在d维空间中最多有2d个邻接区域,因此,域间路由表复杂性上限为(Ο∑2d2log2)n.根据CAN算法的期望路由跳数为Ο(dn1/d)(其中n为系统节点数)[12]可知SAN网络的域间期望路由复杂度为Ο(dN1/d),其中d为SAN空间维数,N为系统中的联盟数.由于服务联盟数N等于流程模型中的任务数,远远小于系统中的物理节点数n,从而较CAN网络和泛洪的Ο(n2)有效降低了域间路由复杂度;由式dN1/d/d=0可得,当d=lnN时,有极小值Ο((lnN)1/lnN).设服务请求消息带宽为β,则域间路由带宽为Ο(dN1/dβ),明显低于泛洪且其定位精度为100%.4.1.2区域负载均衡区域负载均衡基于EBON网络实现服务联盟内的去中心化负载调度,确定任务最终执行节点.根据式(1),通过在EBON网络上的随机漫步转发路由请求,并由式(3)~(5)在采样路径上确定最优执行节点分配任务负载.每个节点除维护域间路由表外同时维护域内路由表以支持上述域内路由过程.域内路由表记录EBON网络中的邻居节点信息(两个域内节点之间存在有向边即存在邻居关系),每个表目对应一个域内邻居节点,可分为入度节点和出度节点两类,用四元组(节点IP,节点权值,节点负载,连接方向)表示.当节点被分配新任务时,将通过随机漫步选择一个入度邻居,删除其相应表目;被选中节点删除本地指向当前节点的出度表目.当节点完成当前任务时,通过随机漫步选择一个不相邻节点,添加为入度邻居;被选中节点添加本地指向当前节点的出度表目.根据规则随机图特性[14]及文献[13]实验表明,当BON网络最小入度数不小于4时,其对应的无向随机图为强连通图.因此可Page7确定节点i域内路由表入度复杂性Οi在正常负载下有Οi∝wi;在过载情况下入度应为0,但为保持网络的连通性,有最小入度复杂性Οmini=4.根据BON网络期望直径为Ο(logm)(其中m为网络节点数)[13]可知域内期望路由复杂度为Ο(log珨M),其中珡M为各服务联盟节点数目的期望值.4.1.3算法描述基于以上描述,SAN-EBON路由算法如下.1.初始化.若节点Rlo=,即节点无后继任务集,转步6;否则节点根据Rlo将后继任务san_id、本地IP和san_id封装为服务请求消息Request;地区域范围内,则转步4;否则转步3;2.若Request中的目的坐标与本地坐标相同或落在本3.查找域间路由表,根据式(6)计算邻接区域与目标域之间的空间距离,选择距离最小的区域作为转发区域,记为Πpost,在Πpost邻居节点中选择延迟最小的节点转发Request,转步2;4.当前节点为区域接入节点,在本联盟内通过EBON算法,根据式(1)~(5)找到最优执行节点,转发Request;5.检查当前节点Rlo,若源san_id∈本地Tsetpre,则通过源IP与Request发起节点建立数据连接,接受新任务,同时根据EBON算法更新本地相关节点的域内路由表,转步1;6.任务分支结束.4.2SAN-EBON网络动态维护SAN-EBON网络维护主要处理节点加入离开时SAN-EBON坐标空间的差分、合并以及相关节点路由表的刷新.新节点加入系统时分两种情况:(1)节点加入时对应集结点已存在,根据SAN路由算法找到其坐标所在区域接入节点,通过EB-ON算法构建自身的域间和域内路由表,并通知其邻居节点更新自身的域间和域内路由表.(2)节点是其服务联盟的第1个加入点.首先根据SAN路由算法找到其坐标所在区域接入节点,由于坐标不同于接入节点,因此需要差分接入节点所在区域,此时选择两个节点坐标相差最大的维度,沿该维度平分接入节点所辖区域,两者建立域间邻居关系,接入节点更新自身的区域范围和域间路由表;同时通知其域间和域内邻居新节点的san_id、所辖区域范围、节点IP以及自己的新区域范围;收到通知的域间和域内邻居节点根据通知更新自身的域间路由表,同时通知其他相邻的域内邻居并与新节点建立邻居关系;新节点根据收到的邻接请求建立自身的域间路由表.节点离开系统时也分为两种情况:(1)离开节点不是联盟中的最后一个节点,只需通知路由表中的域间和域内邻居节点更新相应的域间和域内路由表,同时调整其出度边所指节点的拓扑结构,即该出度边所指节点通过随机漫步在联盟内采样新节点生成新的入度边代替离开节点的出度边.(2)离开节点是联盟中的最后一个节点,此时撤销节点对其区域的管辖,进行区域合并.SAN坐标区域的重分割可按一棵二分树[15]展开,树中每个节点代表一个集结点,两个子节点分割父节点所辖区域.区域合并可分两种情况讨论:①撤销区域的兄弟节点(即邻接区域)为叶节点,即两者共同分割了父节点区域,则由兄弟节点接管撤销区域;离开节点将自身域间路由表移交兄弟节点,据此信息,兄弟节点在域内更新自身区域范围和域间路由表,同时通知其域间邻居节点更新本地的区域范围和域间路由表.②撤销区域的兄弟节点为中间节点,则称其父节点所辖区域为裂变区域,裂变区域的邻接区域为非裂变区域.当前区域撤销后,由以兄弟节点为根的子树重新划分裂变区域,划分过程从子树的根部开始逐层向下进行.相应的,离开节点将自身的域间路由表移交给子树中的邻接区域,并通过区域相邻传递给裂变区域中的所有子区域,各区域节点根据子树结构自顶向下重新计算自身的区域范围,更新域间路由表,并通知邻接的非裂变区域节点更新域间路由表.从以上讨论可以看出,当网络动态维护涉及区域的差分、合并时牵涉节点较多,运算代价较大,但根据SAN-EBON结构,服务联盟中只要存在一个节点,就不需要进行区域调整,在系统运行的大部分时间内只需处理第一种情况,网络结构保持相对稳定,因此可以较小的维护代价适应节点状态变化频繁的环境.4.3SAN-EBON路由实例文献[6]中的学生注册服务将在较短时间段内接受大量请求,从而对系统运行效率有较高要求.我们构造SAN-EBON网络以支持该业务流程,并与SwinDeW系统在路由效率和通信负载方面针对该实例进行了对比.学生注册服务可表示为图5所示的流程[6],其中略去了与路由无关的业务描述,着重讨论其节点定位过程.任务描述(只给出名称)、SAN坐标和局部逻辑关系如表1所示.表中信息在节点注册前通过工作流模型映射过程在建模时阶段生成,并保存在注册服务器中,节点注册后绑定到执行节点,并在执行时阶段控制节点的局部逻辑关系.Page8图5学生注册服务业务流程图表1学生注册服务流程映射T1PreexaminationT2ApprovalT3RecordingT4PaymenthandingT5Accountmanagement(4,5)T6CollectingT7Fileclosing任务发布后各节点构成的SAN-EBON网络(此处映射为二维空间)如图6所示,其中实心圆点表示相应服务联盟对应的集结点,空心圆点表示服务联盟中的物理节点,域间相邻节点用虚线连接.由图6学生注册系统SAN-EBON网络拓扑表2~5分别给出了节点A、B、C的域间路由表和节点C的域内路由表,其它节点路由表有相同的形式,其中省略了邻居节点的IP地址(用节点标识代替),同时省略了与本例转发路径无关的节点标识,并假设到各邻居节点的延迟均为1(此参数需要通过心跳信息由节点实时刷新).序号节点标识SAN坐标区域范围延迟1B(4,5)x∈[0,8],y∈[0,10]12—(10,18)x∈[8,13],y∈[10,)1—图可见坐标空间分为7个区域,每个区域中包含多个承担相同任务的物理节点,如T1、T2、T5所辖区域分别包含4个、5个、2个节点.序号节点标识SAN坐标区域范围延迟1A(5,17)x∈[0,8],y∈[10,)12—(5,17)x∈[0,8],y∈[10,)13C(11,3)x∈[8,),y∈[0,10]14D(11,3)x∈[8,),y∈[0,10]15E(11,3)x∈[8,),y∈[0,10]1序号节点标识SAN坐标区域范围延迟1B(4,5)x∈[0,8],y∈[0,10]12—(10,18)x∈[8,13],y∈[10,)1Page9序号节点标识节点权值节点负载连接方向1E2D3G节点A完成本地任务后将按下述步骤定位下一步执行节点:(1)根据Tsetpost可知后继任务坐标为(11,3),将其加入查询消息;(2)查询本地域间路由表,发现(11,3)在邻居节点中没有命中且不在邻接区域内;(3)计算邻接区域T3(区域坐标为(10,18)),T5(区域坐标为(4,5))与(11,3)的空间距离分别为15.03和7.28,选择空间距离最小邻域T5为转发区域,在该区域内节点A只有一个域间邻居节点B,则B为转发节点转发查询消息;(4)节点B收到消息后查询本地域间路由表,命中目标节点C、D、E;(5)选择延迟最小节点,当延迟相同时按均匀概率随机选取目标节点转发查询消息,此处选C;(6)节点C作为目标区域的接入节点查询本地域内路由表,根据EBON算法选择随机路径上采样值最大的节点(图6右图为区域T2的局部放大,其中虚线给出了域内随机路径)G(计算方法同图3实例);(7)节点G为最终执行节点,并与节点A直接建立连接(图6中实心箭头标出了域间转发路径,空心箭头标出了新分配的任务)接受相关任务数据.由上述实例可见,在服务联盟内,任务分配通过EBON网络实现了去中心化.节点的负载状况通过在EBON网络上的随机漫步采样得到,而不需要由中心节点统一管理,从而每个节点只需维护与其所能承担的负载数量成正比的邻居数.如T2区域中(图6中右图)节点的最大域内度数为4,最小为2,而传统的中心化负载分配需要域内节点实时维护本区域所有节点,则每个节点的邻居数为5.并且当域内节点数目增大时,中心化结构的域内邻居数将随N的增大而增大,其复杂度为O(N),而EBON网络的域内邻居数仍保持稳定,即若T2中的节点数增大到10000,节点C,D,E,F,G的域内最大度数仍保持不变,而中心化结构每个节点则需维护10000个域内节点.因此在节点数目较大且动态变化频繁的系统中,EBON的优势比较明显.对于服务联盟间的服务发现效率,基于多层结构化对等网的SAN网络较SwinDeW系统中的洪泛策略有了明显的提高.定义服务发现请求在到达目标区域前跳转的次数为服务请求路由步数,记为Hij,表示由区域Ti向区域Tj跳转的步数,即加载任务Ti的节点完成任务后在网络中搜索加载后继任务Tj的节点的步数.同时定义在路由过程中,到达目标节点前服务请求传递到的节点数目为扩展节点数,记为Nij,表示由区域区域Ti向区域Tj跳转过程中除起始和目标节点外扩展的节点数.例如,在上述实例中,由区域T1向区域T2的路由路径有节点A→B→C,则H12=2,N12=1.基于上述定义和实例,我们比较了SAN和SwinDeW对应于学生注册系统的路由步数和扩展节点数,列于表6和表7中,其中SwinDeW系统的结构见文献[6].表6SAN-EBON与SwinDeW服务请求路由步数比较SAN-EBON21112111.286SwinDeW22164613.143表7SAN-EBON与SwinDeW扩展节点数比较SAN-EBON1010.667SwinDeW7687上表中E(H)和E(N)分别表示路由步数和扩展节点数的平均值,其中表6中列出了实例中所有可能路径的路由步数,表7中仅列出了与实例中相对应的T1,T2,T3,和T5区域的扩展节点数,但已具代表性.从上述比较结果可以看出,SAN网络的路由步数和扩展节点数明显优于SwinDeW系统.并且,随着系统中节点数目的增长,SwinDeW系统的路由步数和扩展节点数将按节点数目的幂率增长(4.1节中有具体分析),而SAN网络的路由步数仅与工作流模型中的任务数有关,只要工作流模型不发生变化,其路由步数不随节点数目的增长而增大,而扩展节点数等于路由步数减1,所以也保持稳定.因此在节点数较大的系统中SAN网络具有明显优的路由效率且引入较小的通信负载.5结束语本文提出一种新的基于结构化P2P网络的P2P工作流系统节点定位网络SAN-EBON.讨论了其网络结构、路由算法以及系统的动态维护机制.主要贡献有:(1)以任务关系对参与节点进行聚类,较基于角色的方法使联盟边缘更加清晰;(2)首次在工作流系统中引入结构化P2P网络组织服务联盟,提出SAN网络,相比于非结构化P2P网络提供了更高的服务发现效率和更小的通信负载;(3)以节点承载服务标识该节点,实现了所查即所得;(4)在联盟内部基于BON网络,考虑节点的异质性改进其采样机制,提出了EBON算法,实现了去中心化Page10实时定位最优执行节点.SAN-EBON网络在控制流上为相对封闭的自组织运行环境,运行时阶段正常的业务流程无需任何中心服务器介入.注册服务器在系统运行时阶段提供主动性监控,即只有当系统管理者需要了解系统参数及流程实例或者工作位置运行情况时,由注册服务器主动向工作节点查询(其相关协议,数据结构及策略属相对独立的主题,将在后续工作中单独讨论,本文不再展开描述).对于系统异常我们将其分为结构性和非结构性两种.结构性异常影响系统连通性,导致系统产生多个强连通块,此时,被独立的工作节点将通过注册服务器作为新节点重新加入系统,新节点加入实现过程见4.2节.非结构性异常不影响系统的连通性和控制流路由,此时异常节点的邻居节点将按异常节点退出自组织修复系统,节点退出实现过程见4.2节.在后续工作中我们将考虑利用工作流模型信息构造结构化对等网,以更小的通信负载获得更高的节点定位效率,进一步缩短系统实例的执行时间.
