Page1求解Boltzmann模型方程高性能并行算法在航天跨流域空气动力学应用研究吴俊林1)1)(中国空气动力研究与发展中心超高速空气动力研究所四川绵阳621000)2)(中国空气动力研究与发展中心空气动力学国家重点实验室四川绵阳621000)3)(无锡江南计算技术研究所江苏无锡214083)摘要对Boltzmann方程碰撞积分物理分析与可计算建模,得到适于描述航天再入从外层空间到近地面各流域统一Boltzmann模型方程,提出求解Boltzmann模型方程统一算法高性能并行计算数学模型.发展离散速度空间区域分解大规模并行计算技术,分析统一算法变量依赖关系,建立可扩展并行计算方案;研究数据并行分布与并行执行特征,开展大规模并行化程序设计,并在小、中、大规模256~512、4096~20625CPU及异构计算机500~45000、3125~112500进程并行算法测试,建立稳定运行于国产千万亿次超级计算机高性能可扩展大规模并行算法与航天器再入跨流域复杂气动力/热绕流问题并行化软件应用平台.通过对稀薄流到连续流再入飞行不同高度可回收返回式卫星飞行器、近空间大尺度机动飞行器跨流域绕流环境不同粒度高性能计算与验证,揭示大尺度复杂结构飞行器跨流区飞行稀薄过渡流区热流系数比连续、近连续流区热流系数随物面变化剧烈得多、大得多,发现该类飞行器后端面热流最大值发生在水平舵外侧拐角处,达驻点热流六分之一量级,提供了一个可靠求解航天器再入各流域高超声速绕流问题统一算法高性能并行计算应用研究方向.关键词航天器;跨流域空气动力学;Boltzmann模型方程;统一算法;区域分解;高性能并行计算1引言随着科学技术的迅猛发展,基于巨型计算机与互联网技术所发展起来的国家高性能计算环境对解决航天、军工领域飞行器再入复杂空气动力学问题具有极其重要的机遇与挑战[1-4].传统的各流域气动特征数值模拟与实验研究,只能针对某些高度、某些状态进行,研究范围窄,研究能力有限.如何发展精细、准确的连续流到稀薄流各流域空气动力学特征模拟手段与途径,一直是人们共同关心的问题.Boltzmann方程作为气体分子运动论(气体动理学理论)的基本方程[5-7],自1872年提出以来,一直是国际学术界追踪研究相当活跃的问题,它作为一个高度复杂的高维积分、微分、多相空间多尺度非线性刚性问题[6],精确求解至今未成现实.根据Boltzmann方程气体动理论模型研究趋势[8-15],为了探索跨流域气体流动问题一体化模拟方法,文献[16-23]从研究Boltzmann方程碰撞松弛间隔理论出发,提出适于描述各流域气体流动输运现象统一的Boltzmann模型方程.研究引入计算数学关于指数型无穷积分求解原理,发展离散速度坐标法,提出求解Boltzmann模型方程气体动理论统一算法(GKUA),证实所建立各流域多尺度流动问题统一算法精度与可靠性,取得较好的研究效果.如果进行三维复杂飞行器高超声速绕流数值计算,必须使用现代高性能、大内存、多CPU的并行计算机系统,作为计算研究的强有力工具.这将直接与高性能大规模并行计算机技术的发展息息相关.为此,如何发展可稳定运行于成千上万CPU核的高性能并行计算方法,成为GKUA应用研究需要解决的核心问题.本文拟从研究GKUA求解Boltzmann模型方程计算过程与特点出发,提出新型的离散速度空间区域分解高性能并行计算策略,建立用于求解航天器再入跨流域气动力/热问题高性能可扩展并行算法.以此为基础,开展可回收卫星体再入飞行器、近空间复杂结构机动飞行器110km~60km近地空间飞行环境高超声速绕流问题并行计算,研究解决工程研制需求问题.2构建求解Boltzmann模型方程气体动理论统一算法高性能并行计算数学模型对Boltzmann方程碰撞积分物理分析与可计算建模[5-6,8-12,16-23],引入气体分子碰撞松弛参数ν和当地平衡态分布函数fN,给出在全飞行流域都适用的统一表达式,确立可描述航天器再入从外层空间到Page3近地面各流域统一Boltzmann模型方程(比原始Boltzmann方程要简单得多),其无量纲形式为fN=fM·[1+(1-Pr)犮·狇(2c2/T-5)/(5PT/2)]ν=2α(5-2ω)(7-2ω)5(α+1)(α+2)槡π这里,f(狉,犞,t)表示气体分子速度分布函数,依赖位置空间狉、分子速度犞和时间t;fM是当地Maxwell平衡态分布函数;n、P、T是气体分子数密度、压力和温度,狇是热流矢量;λ是来流分子平均自由程;Kn表示划分各流域流动状态的控制参数,定义为基于特征长度L的来流Knudsen数;犮表示气体分子热运动速度犮=犞-犝,且c=犮;Pr是联系于气体粘性输运系数μ、定压比热比Cp与热传导系数K的普朗特(Prandtl)数Pr=μCP/K;χ=(ζ+3)/(2(ζ-1));ω、α分别是联系于分子变硬球(VHS)与变软球(VSS)模型作用指数.取远前方未扰来流值(n,T)作为无量纲化的参考量,其中无量纲化的特征速度取为来流气体分子最可几热运动速度值=2RT槡cmL为所研究问题的特征长度;定义mnc2关力的无量纲参考量;定义mnc3参考量;定义n/c3气体分子速度分布函数f(狉,犞,t)是气体分子运动论的基础,宏观流动物理量(ρ、T、犝、τ、狇)均可由f(狉,犞,t)积分表征,其无量纲形式为发展和应用气体动理论离散速度坐标技术(DVOM)[12,18,20,23],研制适于跨流域高超声速绕流问题模拟的离散速度坐标点优化选取技术与基于离散速度分布函数适应大规模并行分布式求和的宏观流动参数与物面气动力/热动态确定最佳离散求和表征方法,且将离散速度坐标法处理后的Boltzmann模型方程化为守恒形式,其在贴体坐标系(ξ,η,ζ)下的无量纲形式为N这里,U=Jfσ,δ,θ,F=珡UU,G=珚VU,H=珨WU,S=Jν(fσ,δ,θ-fσ,δ,θ).各离散速度坐标点σ,δ,θ处的气体分子速度分量定义为Vxσ,Vyδ,Vzθ.其中,珡U=Vxσξx+Vyδξy+Vzθξz;珚V=Vxσηx+Vyδηy+Vzθηz;珨W=Vxσζx+Vyδζy+Vzθζz;J=(x,y,z)/(ξ,η,ζ).基于气体分子碰撞松驰与对流运动的非定常变化特性,运用二阶Runge-Kutta方法和基于原始变量的NND格式[24],构造如下气体动理论数值格式:Un+1=LS其中,LS,Lξ,Lη,Lζ分别代表式(12)~(15)的差分算子:U=Ls(Δt)Un=Un+1-U=Lζ(Δt)U=1-珨WΔtδζ+U=Lη(Δt)U=1-珚VΔtδη+Un+1=Lξ(Δt)U=1-珡UΔtδξ+这里,计算时间步长Δt应由格式稳定条件确定:其中,CFL为时间步长调节系数,可取CFL=0.99.为了捕捉飞行器绕流场宏观流动参数随当地气体分子速度分布函数演化的实时更新,任一时刻t、(x,y,z)中的宏观变量可由离散速度数值积分方法动态确定[22,25],如使用经改进的Gauss-Hermite无穷积分法,基于离散速度空间坐标Vxσ,Vyδ,Vzθ而被大规模并行分布式求和动态表示:N1n=∑σ=-N1N1nU=∑σ=-N1N1nV=∑σ=-N1Page4N1nW=∑σ=-N13nT=∑2σ=-N1N1∑σ=-N1N1∑σ=-N1n(U2+V2+W2),N1τxx=∑σ=-N1nU2,N1τxy=∑nUV,σ=-N1N1τyy=∑σ=-N1nV2,N1τyz=∑nVW,σ=-N1N1τzz=∑σ=-N1nW2,N1τxz=∑nUW,σ=-N1N1qx=∑σ=-N1N1∑σ=-N1N1∑σ=-N12(Uτxx+Vτxy+Wτxz)-nUU2+V2+W2+N1qy=∑σ=-N1N1∑σ=-N1N1∑σ=-N12(Uτxy+Vτyy+Wτyz)-nVU2+V2+W2+N1qz=∑σ=-N1N1∑σ=-N1N1∑σ=-N12(Uτxz+Vτyz+Wτzz)-nWU2+V2+W2+3建立求解Boltzmann模型方程离散速度空间区域分解可扩展并行计算方案求解Boltzmann模型方程统一算法计算空间是由离散速度空间和位置空间组成的六维相空间,本文在文献[26-27]开展求解Boltzmann模型方程的HPF数据并行程序设计环境基础上,研究将GKUA求解空间划分为速度空间ΩV分解策略.通常将ΩV按三维方式等分分解:令Ωσ,δ,θ=ΩV,σ,δ,θ×Ωr,将Ωσ,δ,θ上的变量映射到处理器PEi,j,k中.依据二叉树方式并行归约求和原理,可得到ΩV分解策略下GKUA整个算法的总数据通信量表达式为为了分析离散速度空间的网格阵列与处理器阵列的分布关系,将式(19)改写为式中,V=NiNjNkNσNδNθ.从式(20)看出,为获得较小CV值,通常设置NpσNσ、NpδNδ、NpθNθ为宜.所以,处理器数最多可达到离散速度坐标点数Nσ×Nθ×Nδ,由此看出,如果使用离散速度空间并行分解策略,Boltzmann模型方程数值算法理论上可实现高达成千上万以至更大粒度超大规模并行计算.由此分析,本文根据块(block)布局并行分布离散速度空间(σ,δ,θ)中的三维,其他维不分布,基于速度空间并行分解策略,建立求解Boltzmann模型方程GKUA高性能可扩展大规模并行计算方法.图1绘出该并行算法的计算流程图,其中符号“”表示不存在离散通信的并行计算,符号“●”表示仅产生归约求和通信的并行计算.Page5图1求解Boltzmann模型方程统一算法并行计算流程4并行计算与结果分析4.1求解Boltzmann模型方程并行算法测试为了考验求解Boltzmann模型方程跨流域高超声速绕流气动力/热问题统一算法并行计算策略可行性与不同规模并行计算加速性能,拟定某返回式卫星体同一绕流状态进行并行计算,图2绘出在n=256、400、512个CPU并行计算加速比随CPU数变化关系,图3展示分别在4950、9900、12375、20625个CPU上进行并行测试的加速比随CPU分布,图中横坐标为处理器数,纵坐标表示并行计算加速比.可看出,统一算法MPI并行程序无论在数百还是成千上万CPU并行计算,并行算法加速比随CPU增加均呈现拟线性分布,证实本文求解Boltzmann模型方程离散速度空间区域分解可扩展并行计算方案实现的正确性与高效可靠性.由图3还看出,当处理机数达到8192,GKUA并行计算加速比随处理机数变化关系出现拐点,这是由于机群式超级计算机系统进行并行计算作业运行所需要的CPU数通常越少越稳定,如果作业运行所用CPU数超过8192,则CPU数越多越不稳定.这需要从事计算机研制人员与并行算法、行业用户协同攻关,解决机群式超级计算机节点数量过于庞大时,常常会遭遇到网络延迟加剧和并行处理环境等方面的瓶颈问题[28-29].图2统一算法在小规模256~512CPU并行加速比图3统一算法在大规模4096~20625CPU并行图4展示GKUA经OpenACC并行移植优化在500~45000CPU核并行加速比与效率,其中横坐标表示计算所用的处理器进程数.可看出,本文研究设计适于众核异构计算机气体动理论高性能并行算法的加速比,仍属于拟线性加速比,效率80%~90%,由此使得高稀薄自由分子流到连续流全飞行流域复杂高超声速绕流问题计算求解变为现实成为可能,足显发展国家高性能大规模并行计算环境对航天领域新型流体力学数值方法研究发展的重要性与巨大推动作用.求解Boltzmann模型方程GKUA计算量(90%)集中在各离散速度坐标点的有限差分迭代过程,高度并行性使得可用硬件加速技术对计算过程加速.GPU的优势在于加速线程多、适合并行度极高、分支较少的计算[30-31];而MIC架构将多个核心整合在一起作为CPU的协处理器,提供高度并行的计算能力,MIC加速卡能达上百加速线程,MIC设备单Page6图4统一算法在众核异构计算机500~45000线程运算能力优于GPU.为此,发展以CPU为主、MIC为辅异构协同模式的硬件并行加速技术对求解Boltzmann模型方程统一算法过程加速效果最好,其实现过程为:将速度空间离散分配到各CPU,CPU间采用MPI通信实现主进程间并行,位置空间通过“广播”方式传递到进程[32];将CPU计算任务分配到加速设备上,每个离散速度坐标点分配到每个MIC加速线程计算;加速线程计算结果返回主进程,对分布函数归约操作得到宏观流动量,准备下一步迭代过程.图5绘出本文求解Boltzmann模型方程统一算法在异构协同模式巨型计算机3125~112500处理器进程并行加速比与并行计算效率.可看出,使用CPU+MIC异构协同模式并行加速技术图5统一算法在众核异构计算机500~45000对统一算法并行程序时,数万到十几万进程并行加速比测试,成拟线性分布,实测加速比与理论加速比很接近甚至重合;统一算法程序在各进程并行效率基本在90%以上,有的进程并行效率达到或超过了100%理想水平,证实直接求解Boltzmann模型方程统一算法具有很高并行加速性能与并行效率,进一步优化设计,极有可能实现国家新一代超级计算机E级并行计算与解决航天领域工程研制需求相结合,稳定运行于数万、数十万处理器进程的高性能并行计算应用研究平台.4.2可重复使用卫星体飞行器再入气动热环境并行计算验证为了验证将本文求解Boltzmann模型方程并行算法程序用于再入飞行器跨流域绕流问题计算可靠性与精度,拟定某返回式卫星球锥飞行器[33](底部半径R=503.5mm,总长L=1410mm,锥身段半锥角θ=11.4°),设置特征尺度为卫星体底部半径.拟定较高马赫数M=10、Tw/T=10跨流区高、低两个飞行高度绕流状态:H=109.7km、Kn=1.618、Re=10.2与H=75.9km、Kn=0.004、Re=4074.5,在位置空间网格51×25×31和速度空间网格80×60×60设置下,使用2048个处理机进行并行计算,得到绕流场马赫数等值线见图6(a)、(b)与绕流流场、物面流线结构见图7(a)、(b),由图看出,对于卫星体再入飞行H=109.7km、Kn=1.618的高稀薄绕流流场,气流在离飞行器很远的区域都存在显著的扰动,气流附着物面流动;而对于近连续过渡流区高超声速(H=75.9km、Kn=0.004)绕流,因产生强烈的脱体激波,罩在绕流物体前部一定位置,包括驻点域、附着激波以及在飞行器底部出现真空区、尾涡流场结构,并在飞行器后部尾迹流场中出现两道再压缩波延伸到飞行器远后方等流动现象均能很好地捕捉.同时由于高超声速绕流,在飞行器底部一定区域,都出现相对低压、低密度真空区.图8绘出本文GKUA并行计算M=10上述卫星体飞行器(H=75.9km、Kn=0.004、Tw/T=1.64)绕流驻点线密度、温度分布与典型文献[33]结果定量化比较,可看出本文GKUA计算值与文献结果相当一致,关于密度分布的计算偏差2.17%~6.71%,关于温度分布的计算偏差0.00%~10.49%.图9绘出卫星体绕流(H=75.9km、M=10、Tw/T=10)驻点线密度分布(本文GKUA并行计算与文献[33]结果比较).可以看出,对于Tw/T=10的热壁面,驻点线密度分布较冷壁面更快速光滑过渡到远前方来流值,两种结果驻点线轮廓吻合很好.Page7图6卫星体再入跨流区绕流(M=10)流场马赫数等值线分布图7卫星体再入跨流区绕流(M=10)场与物面流线结构图8卫星体再入H=75.9km,M=10,Tw/T=1.64绕流流场密度、温度驻点线分布(GKUA与文献[27]结果比较)Page8图9卫星体热壁再入绕流驻点线密度分布(GKUA与文献[33]结果比较,H=75.9km,M=10,Tw/T=10)4.3近空间复杂结构机动飞行器跨流域高超声速绕流环境大规模并行计算如何精细求解近空间高超声速飞行器绕流出现连续流、近连续滑移流或稀薄过渡流多流区共存混合流动现象,揭示稀薄过渡流区极高超声速气动热环境、复杂绕流现象机理,是近空间飞行器研制关键基础.本文拟定大尺度复杂结构机动飞行器H=60km、80km、90km、M=20~25不同攻角绕流状态,设置物理空间网格101×101×41、速度空间网格110×90×85,使用23800个CPU并行计算.图10展示该飞行器绕流H=80km、M=24、α=20°、Tw/T0=0.05、Pr=0.72流场与物面流线结构及马赫数等值线,图中看出,对此极高超声速绕流状态,毫米量级的来流气体分子平均自由程λ=0.003419m已反映出气体绕流出现严重的间断粒子稀薄效应,由于该飞行器特征尺度数米量级,表征飞行器绕流稀薄程度的Knudsen数Kn=0.0019仍然较小,以致沿平板腹部一定距离的脱体激波层,拖曳到飞行器远后方,并形成如图10(b)所示较密集的马赫数等值线过渡带,在飞行器腹部出现压缩激波层,在飞行器上部出现膨胀波系,向远后方延伸出去.分析该飞行器物面流线结构看出,由于该飞行器前部球锥结合后掠三角翼且极具尖前缘,具有较严重稀薄效应的气流绕流物面在左右锥身形成压缩会聚流线带,附着物面流向飞行器后部,遇飞行器椭圆柱身段因流动膨胀,物面流线分别向上、下散开,流向飞行器尾部.为了分析揭示该大尺度复杂结构飞行器跨流区物面热环境变化规律,拟定该飞行器近连续流区绕流状态H=60km、Kn=0.00014、M=20、α=12°、Re=2.164×105、Tw/T0=0.25与H=90km、图10翼身组合大尺度复杂飞行器绕流流线与马赫数等值线(H=80km,M=24,Kn=0.0019,α=20°)Kn=0.012、M=25、α=20°、Re=3153、Tw/T0=0.05进行大规模并行计算.图11列举了该飞行器跨流域飞行近连续过渡流区上述两个绕流状态下,飞行器尾部后端面自Z=0物面热流系数随边缘线弧长位置变化关系,从图11(a)看出,对于H=60km近连续绕流,自该飞行器后端面Z=0沿Y<0边缘线横向Z方向物面距离,热流不断增大至水平舵外侧拐角处达到最大,而后因流动翻过水平舵迎风面进入水平舵背风区上缘线,物面热流突降至最小,后因来自水平舵上表面的压缩流动影响,物面热流上升,跨越上表面压缩流线,物面热流又迅速下降,在整个后舱边缘线受背风区流动影响,物面热流维持在最小状态.对于图11(b)绘出的H=90km稀薄效应很强的过渡区极高超声速绕流,虽然飞行器后端面边缘线物面热流变化趋势与H=60km近连续绕流状态相似,因更为严重的来流间断粒子稀薄效应,气流附着物面流动,加之来自飞行器腹部压缩气流冲击,致物面热流系数迅速升高,而在包括水平舵、整个后舱在内背风区边缘线,物面热流仅小幅变化.该图首次剖析了这类复杂结构大尺度机动飞行器近空间跨流区飞行绕流物面热流分布变化规律,引起飞行器研制部门高度重视,对该类飞行器工程设计产生重要指导作用,反映了依托国家Page9高性能并行计算环境,开展求解Boltzmann模型方程统一算法超级并行计算,对揭示跨流域飞行器特殊绕流现象与物面力/热变化规律,解决工程研制问题具有重要意义与应用前景.图11大尺度复杂结构机动飞行器后端面边缘线热流分布5结论基于Boltzmann方程碰撞积分物理分析与可计算建模,确立可描述大尺度复杂结构机动飞行器近空间多流区共存气体流动输运现象统一的Boltzmann型速度分布函数方程,发展适于极高超声速流动问题的离散速度数值积分动态确定宏观流动变量计算方法,构造气体动理论数值格式,提出求解Boltzmann模型方程离散速度空间区域分解高性能并行计算方案,建立了面向国产千万亿次超级计算机稳定运行于1024~23800以上CPU求解稀薄流到连续流跨流域复杂高超声速气动力/热绕流问题大规模并行计算应用研究平台.初步得到如下结论:(1)通过对小、中、大规模256~512、4096~20625CPU及异构协同模式计算机500~45000、3125~112500CPU进程并行算法测试,证实本文发展的求解Boltzmann模型方程高性能并行计算方法不仅负载平衡好,且有很好的并行可扩展性,基本达到了线性加速的并行效果,数万到十几万CPU进程并行加速比仍成拟线性分布,实测加速比与理论加速比很接近甚至重合,并行效率90%以上,这为依托现代超大规模并行计算机求解六维相空间Boltzmann型速度分布函数方程模拟航天再入各流域复杂飞行器高超声速空气动力学问题开辟了一个高性能计算应用研究方向.(2)通过对稀薄流到连续流跨流域不同飞行高度可回收卫星体、近空间大尺度复杂结构机动飞行器110km~60km气动力/热绕流环境并行数值模拟,证实所建立求解多流区共存混合流动GKUA与大规模可扩展并行算法软件可靠性.(3)计算揭示:复杂结构飞行器跨流域飞行高低不同高度气动热环境差别很大,稀薄过渡流区热流系数比连续、近连续流区热流系数随物面变化剧烈得多、大得多,发现该类飞行器后端面热流最大值发生在水平舵外侧拐角处,达驻点热流六分之一量级;即使在极低Knudsen数低高度高超声速飞行绕流,物面仍存在严重速度滑移、温度跳跃局部稀薄气体间断粒子效应,表现出多流区共存混合流动现象.这为我们进一步发展求解尖前缘大尺度复杂飞行器近连续过渡区高超声速绕流问题高效并行数值模拟方法指明了方向.(4)研究表明,所建立离散速度空间区域分解并行计算策略对极高超声速绕流问题Boltzmann模型方程数值求解具有很好静态稳定性,不存在临界与边界离散通信,由此发展大规模并行计算方法通信效率与并行计算效率较高,证实求解Boltzmann模型方程统一算法(GKUA)具有良好的高性能大规模并行计算优势.进一步研究发展,可实现高效使用数十万处理器核超大规模可扩展并行算法,足显国家高性能并行计算环境对解决航天跨流域空气动力学问题应用前景.致谢本文工作得到第一作者课题组彭傲平助理研究员、无锡江南计算技术研究所陈德训高工、漆锋滨研究员等的支持帮助,部分计算在国家超级计算济南中心、国家并行计算机工程技术研究中心、国家超级计算天津中心进行,特此感谢!Page10
