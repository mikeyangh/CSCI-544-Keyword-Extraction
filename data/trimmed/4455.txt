Page1一种改进的网络安全态势量化评估方法席荣荣云晓春张永铮郝志宇(中国科学院信息工程研究所北京100093)摘要在基于隐马尔可夫模型的网络安全态势评估中,观测序列的获取和状态转移矩阵的确立是影响评估准确性的关键.目前观测序列多以随机方式获取,不能有效表征网络的安全性;而状态转移矩阵往往依据经验给出,具有很强的主观性.该文提出改进方法:首先,基于警报的统计特性提出警报质量的概念,依据警报质量获取的观测序列,可改进数据源的有效性;其次,基于安全事件和防护措施的博弈过程,提出确定状态转移矩阵的方法,并结合攻击成功的概率对其进行修正,提高状态转移矩阵的有效性.对比实验证明,基于改进算法生成的风险值对网络安全态势的量化更加合理.关键词观测序列;状态转移矩阵;警报质量;博弈矩阵;攻击成功的概率1引言面对当前日益复杂的网络安全问题,传统的安全检测和防护措施为网络管理者提供了海量多源数据,但由于大量误报或不相关信息的存在,使得数据信息具有不确定性.基于不确定信息评估网络的安全态势,准确性受到严重影响.为解决警报信息的不Page2确定性问题,?rnes等人[1]提出采用隐马尔可夫模型(HiddenMarkovModel,HMM)对网络安全状态建模,基于统计模型特性解决警报信息的不确定性问题.但模型中的观测序列随机获取,无法保证数据源的有效性;状态转移矩阵根据经验值设定,不能客观反映网络安全状态的变化过程.后续研究不断对该方法进行改进,但仍存在局限性.如Haslum等人[2]基于安全状态的持续时间确定状态转移矩阵,但由于网络攻击行为的随机性,使得安全状态的持续时间难以确定.李伟明等人[3]利用遗传算法自动求解状态转移矩阵和观测向量分布矩阵,该方法可量化评估网络的安全态势.但方法中风险描述规则是针对特定攻击和风险的形式化描述,面对网络攻击行为的灵活性和多样性,构造通用的风险描述规则库存在很大难度.针对观测序列的获取和状态转移矩阵的确定,本文提出改进方法,主要工作包括两点:第一,基于警报统计特性提出警报质量的概念,并依据警报质量获取观测序列,提高数据源的有效性;第二,基于安全事件和防护措施的博弈过程,提出确定状态转移矩阵的方法,并结合攻击成功的概率对其进行修正,提高状态转移矩阵的有效性.2基于HMM的网络安全态势评估方法在实际网络中,网络安全状态是不可见的,但安全状态产生的警报信息是可见的,而且各安全状态与可能产生的警报信息之间存在特定的概率函数,警报序列能够揭露安全状态的变化信息,这与隐马尔可夫模型的核心思想是一致的[4].因此本文采用隐马尔可夫模型刻画网络安全状态的变化过程.隐马尔可夫模型由五元组构成λ={犛,犞,犘,犙,π}[5],为了将其应用于网络安全态势评估,首先对五元组进行说明:(1)犛为状态集合空间,犛={S1,S2,…,SN},其中Si表示一个独立的状态,N表示状态的数目.不同的安全事件导致网络进入不同的安全状态,依据安全事件的划分,将网络的安全状态划分为安全状态G、探测状态R、入侵状态B和攻陷状态C,即犛={G,R,B,C}.安全状态G(Good)表示网络中不存在任何攻击行为,处于安全状态;探测状态R(Reconnaissance)表示网络中存在扫描类的行为,攻击者采集信息阶段;统权限的行为,攻击者入侵网络阶段;入侵状态B(Break-in)表示网络中存在破坏系攻陷阶段C(Compromised)表示网络已被攻陷,攻击者获得系统权限.(2)犞是观测向量集合空间,犞={狏1,狏2,…,狏M},其中狏i表示观测向量,M表示各状态观测向量值的数目.网络安全状态是不可见的,可直接观测到的只有安全防护设备产生的警报信息.若直接将海量警报种类应用于HMM模型,会导致模型规模过大,严重影响运算效率.为解决上述问题,将原始警报进行分类.根据警报所代表的安全事件,将警报分为4类犞={g,r,b,c}.g表示在采样周期内,没有采集到任何警报信息;r表示扫描类的警报信息,如ICMPping,ICMPdestinationunreachable等;b表示入侵类的警报信息,如webcgiredirectaccess,badtrafficloopback等;c表示获取root权限的警报信息,如servicesrshroot等.(3)犘为状态转移矩阵,表示从一个状态转移到另一个状态的概率分布,犘={pij},其中pij=P(qt+1=Sj|qt=Si),1i,jN,表示在T时刻网络处于Si状态,在T+1时刻处于Sj状态的概率.本文采用的状态转移矩阵如图1所示.(4)犙为观测向量概率分布矩阵犙={qi(vk)},其中qi(vk)=p(o=vkqt=Si),1iN,1kM,表示T时刻,网络处于状态Si且观测到的警报信息为vk的概率.(5)π为初始状态概率分布矩阵,π={πi},其中πi=p(q1=Si),1iN,表示在最初时刻,网络处于状态Si的概率.确定HMM五元组之后,根据每个采样周期获取的观测向量可实时更新网络T时刻处于状态SiPage3的概率λt(i),再引入一个风险损失向量犆(i),可求解任意T时刻网络总风险犚T其中:λt(i)表示T时刻网络处于状态Si的概率,犆(i)表示状态Si相应的风险损失,N表示状态数目.在安全态势评估过程中,观测序列的获取和状态转移矩阵的确立是影响评估准确性的关键.目前观测向量多以随机方式获取,不具有代表性,不能表征网络的安全特性.本文通过选取质量最高的警报作为HMM观测向量,可提高警报数据源的有效性.对于状态转移矩阵的确立,往往根据专家经验设置,但手工设置主观性强,准确性不高,效果的好坏往往依赖于专家水平的高低.为解决上述问题,基于安全事件和防护措施的博弈过程,提出确定状态转移矩阵的方法,并结合攻击成功的概率对其进行修正,提高状态转移矩阵的有效性.3算法改进3.1获取观测序列入侵检测系统通常会产生海量警报信息,其中很大比例为误报或者不相关警报.报警量大、不相关警报多,使得HMM观测向量的获取存在很大难度.为了更加明确地定义警报表征网络安全特性的有效程度,参考质量因子[7]的思想,本文引入一个新的概念———警报质量.定义1.警报质量QoA(QualityofAlert),指警报表征网络安全特性的有效程度.警报的质量越高,越能有效表征网络的安全特性[8].为了量化警报质量,首先将警报模型化为笛卡尔积的形式:其中(A1,A2,…,An)表示警报的属性[9],DAi表示属性Ai的取值范围.警报的属性Ai既包括警报的基本属性,如警报的源IP,目的IP,类型以及产生时间等,也包括警报的统计特性[10-13],如警报出现频次AlF(AlertFrequency),警报关键程度AlC(AlertCriticality)以及警报严重程度AlS(AlertSeverity)等.基本属性用于描述警报的内在属性,与网络安全特性无关,因此不属于讨论范畴,主要讨论警报的统计属性:AlF为警报出现频次,表示单位时间内警报出现的相对次数.安全设备的特性决定针对某一攻击行为,在短时间内会产生大量同类型的警报信息,即出现频次越高的警报信息越能刻画当前的网络攻击行为.因此将警报出现频次作为警报质量的一个统计特征,定义为AlC为警报关键程度,指警报表征网络安全状态发生转变的强弱程度.警报的关键程度越高表示网络安全状态发生转变的可能性越大.监测过程中,若出现新的警报,表明网络中存在新的攻击行为,网络安全状态发生转变的可能性增加.因此将警报的出现节点作为警报关键程度的指征.根据警报的出现情况,将其分为3类:本采样周期内已出现过的警报;在之前的N个周期内出现过的警报;在之前的N个周期内未出现过的警报.其相应的优先级别分别设为1,2,3.其中周期N的选择不仅与周期间隔有关,而且与周期的持续时间相关.根据文献[14]提出的攻击事件持续时间的阈值及本文的采样周期,将周期N设置为3.AlS为警报严重程度,表示警报产生的影响.严重程度越高表明其对安全状态的影响越大.参考Snort用户手册定义的攻击类别,将警报严重程度划分为高、中、低3个等级,分别设置为1,2,3.上述分析表明,警报出现频次、关键程度和严重程度是决定警报质量的关键因素,结合3个关键因素,给出警报质量的量化模型如图2所示.模型将各属性值作为警报质量的量化因子,将警报质量定义为各属性值连线所包围的面积之和:Page4其中:AlC,AlS分别表示警报关键程度和严重程度的属性值;AlF表示警报出现频次AlF的标准化值.因为AlF∈[0,1],与其他属性的取值范围不同,为均衡各属性对警报质量的影响,应保证各属性具有相同的值域.因此采用离差标准化的反函数将警报出现频次AlF标准化为AlF:AlF=AlF(Max-Min)+Min=2AlF+1(5)标准化值AlF∈[1,3],与其他属性具有相同的值域.当警报的出现频次、关键程度和严重程度的属性值确定时,可根据式(4)求解警报质量.如图2所示,当AlF=0.4,AlC=1,AlS=2时,AlF=1.8,QoA=(1.8,1,2)=3.7.在每个采样周期,通过选取质量最高的警报,获取HMM的观测向量.依据警报质量获取的观测向量可有效改进数据源,提高评估准确性.3.2确定状态转移矩阵状态转移矩阵是影响安全态势评估准确性的关键.传统的状态转移矩阵往往依据经验给出,具有很强的主观性.本文将基于网络安全状态转移过程确定状态转移矩阵.事件驱动的网络安全状态转移过程将网络视作一个状态机[15],安全事件则是网络状态转移的依据.事件驱动的网络状态转移模型如图3所示.其中G,R,B,C表示网络状态;Ei表示安全事件;Di表示防护措施.若T时刻网络处于状态Si,在此状态下,发现异常情况形成安全事件Ej,或者执行了安全防护措施Dj,则导致网络T+1时刻进入状态Sj.该过程表示为Si上述分析表明网络状态转移的实质为安全事件与防护措施的博弈.因此基于博弈过程提出了确定状态转移矩阵的方法,该方法根据博弈过程确定状态转移矩阵,并结合攻击成功的概率对其进行修正.(1)确定状态转移矩阵基于安全事件与防护措施的博弈,网络安全状态的转移可描述为犈×犇矩阵,如表1.表1安全事件与防护措施的犈×犇矩阵E1…En犈为安全事件,网络中存在多种安全事件,为简化分析,定义4种安全事件:无安全事件、扫描类安全事件ER、入侵类安全事件EB、获取系统权限类安全事件EC;定义犈={,ER,EB,EC}.犇为网络中的防护措施,将网络中的防护措施简化为:无任何防护措施,监测类防护措施DS,阻止类防护措施DF,修复类防护措施DR;定义犇={,DS,DF,DR}.犈×犇矩阵直观给出了安全状态转移的分布情况.由矩阵可知,状态Si转移到Sj的概率pij=NSj∑i∈{G,R,B,C}Nsi率,即从Si转移到Sj的状态数目占从Si转出的所有可能状态数目的比重.Nsj表示从状态Si转移到状态Sj的数目,∑i∈{G,R,B,C}Nsi表示从状态Si转出的所有可能状态数目之和.根据各状态的概率分布,可确定状态转移矩阵.例如当网络处于安全状态G时,安全事件与防护措施的博弈过程[16]如下:当网络中无安全事件时,则无论采取何种防护措施,网络均处于安全状态.当网络中发生扫描类安全事件时,若网络中无任何防护措施,则网络转移到探测状态R;若网络中存在监测类防护措施,表明网络可检测到扫描行为,但并不阻止,则网络转移到探测状态R;若网络中存在阻止类或者修复类防护措施,则网络保持在安全状态G.当网络中发生入侵类安全事件时,若网络中无任何防护措施,则网络转移到入侵状态B;若网络中存在监测类防护措施,则网络安全状态的转移取决于管理人员采取的策略.本文对50名网络安全管理人员进行了调查,发现其中27名安全管理人员实时处理安全事件,另外23名安全管理人员周期性对系统进行维护.根据不同的管理策略,将网络保持在安Page5全状态G和转移到入侵状态B的概率均设为1/2.若网络具有阻止类或者修复类防护措施,则网络保持在安全状态G.当网络中存在攻陷类安全事件时,分析同入侵依据上述分析,构建安全状态G的犈×类安全事件.犇矩阵如表2.安全事件GGGGERRRGGEBB1/2G,1/2BGGECC1/2G,1/2CGG根据状态G的犈×犇矩阵,求解状态G转移到其他状态的概率分别为pGG=转移到状态G的状态数pGR=转移到状态R的状态数pGB=转移到状态B的状态数pGC=转移到状态C的状态数分别构建状态R,B,C的犈×犇矩阵,则可初步确定状态转移矩阵如下所示:上述分析中存在一个假设,即若安全事件发生,则攻击行为肯定成功.但我们已知,真实网络中并非所有的攻击行为都会成功[17].为了使得状态转移矩阵更加合理,对攻击行为成功的概率进行分析,修正状态转移矩阵.(2)修正状态转移矩阵通过进一步分析攻击行为,发现攻击成功的概率与攻击者的类型,攻击者的能力,攻击所需的资源及网络的防护措施相关,因此定义状态转移矩阵的修正函数为AM为攻击者的类型,网络中的攻击行为大部分由初始攻击者发起,少部分由熟练攻击者发起,只有极少部分由专业人员发起,但由极少数专业人员发起的攻击却对网络安全状态的变化起决定作用,这与帕累托分析法[16]的思想是一致的.因此运用帕累托法则,将攻击者为专业人员,熟练攻击者和初始攻击者的概率分别设定为1/25、4/25和4/5.AC为攻击者的能力,攻击者的能力越强,攻击成功的概率越高.按照能力的不同将攻击者划分为专业人员、熟练攻击者和初始攻击者3个等级,其能力分别设定为100、10、1.AR为完成攻击所需要的资源,攻击需要的资源越多,攻击成功的概率越低.按照安全事件对资源需求的不同,将其划分为需要大量资源、需要部分资源和不需要资源3个等级,分别设定为100、10、1.与攻击者的能力相比,攻击对资源的需求对攻击成功概率的影响要弱一些,为了提高函数的合理性,采用系数10进行调整.D为网络中的防护措施,防护措施级别越高,攻击成功的概率越低.根据定义的4种防护措施,将无任何防护措施,监测类的防护措施DS,阻止类的防护措施DF和修复类的防护措施DR分别量化为0、1、2、3.与完成攻击所需的资源相比,防护措施对于攻击成功的影响更大一些,因此采用指数形式表征防护措施.i,j,k的取值由划分面决定.划分面是指进入某种网络安全状态所必须的条件组合.例如网络若要从安全状态G进入探测状态R,划分面如图4所示.任何能力的攻击者都可以实现,AC∈{1,10,100};且相应的AM∈{4/5,4/25,1/25};不需要任何资源,AR∈{1};网络中不存在阻止类及更高级的防护措施,D∈{0,1};得到的修正函数p如下:p=∑100Page6采用修正函数p更新状态G转移到状态R的概率PGR:同理可分别求得状态B,C的修正函数,利用修正函数更新状态转移矩阵,修正结果如下:PGR=PGR×p=0.13×0.9=0.117犘=3.3网络状态更新算法确定观测序列Ot和模型参数λ={犛,犞,犘,犙,π}之后,采用与文献[1]相同的前向算法更新T时刻网络处于状态Si的概率λt={λt(i)}.算法的复杂度为O(N2),算法如算法1所示.算法1.网络状态概率更新算法.输入:T时刻的观测向量犗t,HMM的模型参数λ输出:T时刻网络处于状态Si的概率λt(i)1.IfT=1then2.fori=1toNdo3.α1(i)=πiqi(O1)4.λ1(i)=α1(i)表3LLDOS1.0的攻击说明1获得活动主机列表;2找到薄弱soliar主机;3由sadmind缓冲区溢出漏洞侵入系统;10:33:1010:35:01225354在控制主机上安装DDOS攻击木马;5由控制主机攻击远程服务器;总计LLDOS1.0所有数据流设定采样周期Δt为5min,在每个采样周期内,从snort产生的警报流中选取质量最高的警报作为观测向量.获取的观测序列如附表1所示.LLDOS1.0作为一个网络流量的基准评测数据集,并不提供网络防护措施的说明,依据对安全事件及警报信息的分析[19],分别构建各状态的犈×犇矩阵,其中安全状态G的犈×犇矩阵如表4.安全事件EREBEC5.Endfor6.Else7.Fori=1toNdo8.αt(i)=qi(Ot)∑N9.λt(i)=αt(i)10.Endfor利用该算法可实时更新T时刻网络处于状态Si的概率λt(i),结合风险损失向量犆(i),即可求解网络安全风险值RT4实验验证为了验证方法的有效性,采用林肯实验室提供的经典数据源LLDOS1.0①进行验证.LLDOS1.0是一个DDOS攻击场景测试集,提供了DDOS攻击的网络流量.攻击场景分为5个阶段,每个阶段的安全事件导致网络处于不同的安全状态.根据说明文档,各阶段的信息如表3所示.为了再现攻击场景,采用流量重放技术,将原始流量导向snort,由其充当采集器对数据进行分析.采集信息见表3最右侧,相对于攻击说明文档,各阶段的警报数目略有差别,主要是由于不同的snort规则集导致的,但警报数目总体趋势是一致的,且所有算法均采用相同数据集,并不影响实验结果.根据犈×犇矩阵求解状态转移的概率分布,确定状态转移矩阵如下:犘=①LincolnLaboratory.Lincolnlaboratoryscenario(DDoS)Page7修正后的状态转移矩阵:犘=为了保证与?rnes方法的可比性,采用与?rnes方法相同的观测向量概率分布矩阵犙,初始状态概率分布矩阵π及风险损失向量犆(i).犙==π=πGπRπBπC=1000犮=cGcRcBcC=02550100确定观测序列Ot和模型参数λ={S,V,P,Q,π}图5各算法状态概率分布图之后,采用算法1实时更新网络在T时刻处于状态Si的概率λt(i),实验结果如图5所示.图5(a)改进算法生成的状态概率表明在1200s之前及9600s之后,网络处于安全状态;在1200s~4200s之间网络处于探测状态;4200s~9600s之间网络处于入侵状态.图5(b)?rnes算法生成的状态概率表明在900s之前,网络处于安全状态,其余时段网络处于探测状态.图5(c)Haslum算法生成的状态概率表明网络交替处于探测状态和安全状态.图5(d)遗传算法生成的状态概率值具有均衡趋势,无明显优势状态.上述分析表明,改进算法生成的状态概率与攻击场景的描述基本一致.为量化评估网络的安全态势,结合风险损失向量犆(i),可求解T时刻各算法生成的网络风险值RT,结果如图6所示.图6表明改进算法在攻击入侵阶段生成的网络风险值明显高于探测阶段的风险值,且在5400s出现小波峰,表明攻击行为异常;?rnes算法由于一直处于探测状态,其产生的网络风险值维持在50左右;Haslum算法由于交替处于探测状态和安全状态,其产生的网络风险值亦处于波动状态;遗传算法生成的网络风险值无明显变化趋势.上述分析表明,基于改进算法生成的风险值对网络安全态势的量化更加合理.Page85讨论(1)改进算法对于网络安全状态变化趋势的判定与攻击场景的描述基本一致,表明改进算法可以较准确地评估网络安全状态的变化趋势.(2)?rnes算法可准确判定网络的探测状态,但同时将入侵行为判定为探测状态,这主要是因为?rnes算法的观测序列Ot是随机采样获取,Ot不能有效表征网络的真实状况,影响算法准确性.(3)Haslum算法采用的状态转移矩阵中56%的转移概率值为零值,而且非零值中采用互补方式描述反向的状态转移,即整个状态转移矩阵仅有3个有效值,使得生成的状态概率值存在误差.不合理的状态转移矩阵影响Haslum算法的准确性.(4)遗传算法根据警报的严重程度,将警报划分为10个等级,即算法中观测向量值为10.细化的观测向量使得算法过于敏感,导致生成的状态概率值波动频繁,无法判定网络的变化趋势.(5)根据攻击场景描述,5400s时,攻击者获得了控制主机上的系统权限,网络应处于被攻陷状态.但图5中各算法对于攻陷状态的表征均不明显.各算法生成的攻陷状态概率值的分布情况如图7所示.图7表明改进算法生成的攻陷状态概率值一直处于0.001的极小值,但是在5400s时,出现了小幅波动,达到了0.14.?rnes算法生成的攻陷状态概率值一直维持在0.003.Haslum算法在6300s,7500s以及11100s出现了0.8的高概率值.遗传算法在多点出现了0.5左右的高概率值,但根据攻击场景描述,这些点并没有出现高危险级别安全事件.分析表明,改进算法体现了攻陷状态的变化,但不明显.5400s时,各算法生成的状态概率值如图8所示.图8表明5400s时,虽然改进算法攻陷状态的概率值提升到0.14,但入侵状态的概率值为0.82,远高于攻陷状态的概率值,所以网络处于入侵状态,与攻击场景描述的网络处于攻陷状态出现不一致.因为T时刻网络处于状态Si的概率是由所有可能到达该状态的路径之和表示,它不仅与T时刻的观测向量有关,还与隐含了T-1时刻之前观测序列信息的部分概率αt-1(i)相关.在5400s之前,网络中没有出现过攻陷警报,当第一次出现攻陷警报时,算法对攻陷状态的概率值有所提升,但由于累积效应,并不是最大的状态概率值.所以改进算法体现了攻陷状态的变化,但不明显.6结束语本文对?rnes提出的基于隐马尔可夫过程的网络安全态势评估模型进行了改进,主要工作有两点:第一,基于警报统计特性提出警报质量的概念,依据警报质量获取的观测向量,可改进数据源的有效性;第二,基于安全事件和防护措施的博弈过程,提出确定状态转移矩阵的方法,并结合攻击成功的概率对其进行修正,提高转移矩阵的有效性.对比实验证明,基于改进算法生成的风险值对网络安全态势的量化更加合理.但该方法还存在局限性,例如现在的数据源主要是基于入侵检测系统产生的警报信Page9息,如果可以采集更多的信息完善观测序列,则可进一步提高方法的准确性;另外目前算法求解的只是下一个采样周期各安全状态的概率,如果可实现对未来多个采样周期内安全状态出现概率的求解,则可以实现对网络安全状态的预测,为网络管理员提供决策依据.因此下一步工作主要集中在这两个方向.
