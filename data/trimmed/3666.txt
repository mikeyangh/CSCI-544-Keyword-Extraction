Page1可重写Petri网:位置可重写及性质分析庞善臣1)林闯2)1)(山东科技大学信息科学与工程学院山东青岛266590)2)(清华大学计算机科学与技术系北京100084)摘要针对Petri网对动态系统重构形式化描述和建模能力的不足,提出了可重写Petri网和位置可重写Petri网的基本概念.分析了位置可重写Petri网保持有界性、保守性、可重复性及活性等性质.给出了位置可重写Petri网保持活性的一个充要条件.证明了共享合成Petri网是位置可重写Petri网的一个实例,建立了退化的位置可重写Petri网模拟共享合成Petri网的算法.所得结果能够为动态重构系统的Petri网形式化建模提供理论方法,为大规模动态分布式系统的形式化验证提供有效途径.关键词可重写Petri网;位置可重写Petri网;共享合成Petri网;活性;模拟1引言博士于1962年在他的博士论文中提出[1].40多年来,Petri网理论不断充实和发展,Petri网的描述能力也在不断得到丰富,从基本的条件事件网(C/E)、Petri网的概念最早由德国的CarlAdamPetri位置变迁网(P/T)到有色网;从一般有向弧发展到Page2禁止弧和可变弧;从自然数Token到概率Token;从瞬时变迁到时延变迁等.Petri网分析技术也得到了丰富和完善,能够借助Petri网的代数分析技术来刻画系统结构,建立状态可达的线性系统关系;借助Petri网的图分析技术,展现系统的运行机制,分析系统的动态行为;借助Petri网的归纳分析技术,可缩小系统的可达状态空间,降低系统分析的复杂度;借助Petri网语言能够形式表示和分析系统的动态行为性质;借助随机过程能够分析性能等特性.在应用方面,Petri网以其简洁、直观、潜在模拟能力强等特点被广泛用于分布式、并发系统的建模和分析,如计算机、通信、交通、电子与电力、服务、通信协议验证、网络性能分析、并行程序设计、柔性制造系统控制、知识推理及人工神经元网络等.但是,随着系统规模的激增,系统的复杂性、柔性(松耦合性)不断增加,系统的异构、分布、协同、自治性增强,系统的动态更新速度加快.然而,传统Petri网的形式化方法不能提供直接支持系统结构的动态变化和业务的多种操作模式,Petri网建模方法在解决系统上述问题过程中遇到极大困难和挑战[2].因此,具有动态建模能力扩展Petri网的研究得到不断发展[2-7].Petri网的动态建模理论及方法,主要有以下3个方向.1.1Petri网的化简和精炼为了解决Petri网模型分析带来的状态空间爆炸问题,许多学者开展了Petri网化简和精炼的研究[8-25],建立了多种化简规则和运算方法,给出了化简后活性、有界性、公平性等性质保持条件,以解决系统复杂性增长所带来的空间状态爆炸问题.Murata是较早从事Petri网化简的主要研究人员,Murata等人[8]针对T-图提出了若干化简规则,讨论了这些规则对活性和安全性的保持关系.Ehrig等人[10]给出了Petri网变换的化简规则,并将结果应用在软件工程领域.国内研究人员对Petri网化简开展了卓有成效的研究[11-17].Jensen[18]研究了基于求精思想的有色Petri网的层次化建模方法,开发了复杂系统的设计工具Design/CPN.Betous-Almeida等人[19]讨论了在随机Petri网中,利用精炼操作逐步求精以构建一个可靠性模型的方法.Suzuki等人[20]研究了Petri网的精炼操作,提出了精炼网的定义,并研究了精炼网的动态性质(如有界性、活性等)保性关系.Huang等人[21]定义了两类Petri网的精炼操作,并对包括结构性质(如不变量、可重复性等)和动态性质在内的19种性质的保性关系进行了较全面的论述和分析.Ding等人[17]基于序列投影,建立精炼Petri网与原网、子网间的动态行为关联关系,并分析了该精炼操作的相关动态性质,得到一组性质保持判据.Petri网化简和精炼技术在系统建模与分析中得到广泛应用.近几年,在工作流和服务组合研究中应用成果更为常见.Sadiq等人[22]针对工作流建模语言,利用一组Petri网化简规则,建立了可视化的验证算法来识别工作流过程模型中的结构冲突.Li等人[23]改进了文献[20]的化简规则,建立了化简矩阵的工作流验证算法.最近,有学者开始研究一种新的Petri网化简技术———切片技术来实现Petri网的动态建模[24-25].上述这些工作,为Petri网的层次化分析奠定了理论基础.1.2Petri网的合成Petri网化简和精炼体现了模型验证和分析由上到下的思想,为了解决系统集成时由下向上的模型表达问题,人们开始关注Petri网的合成[26-43].近年来,合成Petri网研究已取得很大的进展[28-31],其研究成果主要集中在共享合成和同步合成上.Souissi[32]研究了共享合成Petri网系统的活性保持性问题,基于对活性满足单调性条件的推广,提出了F-强网的概念,得出两个活的F-强网共享合成后仍是活的结论.Jeng[33]研究了用Petri网系统来建模柔性制造系统的合成方法,提出资源控制网的概念,每一个子系统都是资源控制网,且按两个约束条件合成起来,这样得到的大系统有结构活性.Jiang等人[34]首次提出了Petri网的加法、笛卡儿积、广义笛卡儿积的Petri网合成运算,得到了一系列的重要性质.Jiang[35]研究了Petri网同步合成和共享合成两种组合网的动态不变性,即状态和行为不变性.Jiao等人[36]研究了针对AC网进行库所集合合成的转化问题.Badouel等人[37]提出了Petri网合成后的网保持死锁-陷阱性质、活性、有界性和可逆性的条件.Chen[38]给出了一种对具有控制器的离散事件系统进行合成的系统方法.夏传良等人[39]给出了使共享PP-型子网合成Petri网系统保持活性、有界性和可逆性的条件;Jiang[35]对Petri网系统同步合成的进程和语言关系式进行了研究,得到了反映系统行为关系的进程和语言关系式.Wang等人[40]利用同步合成的语言关系式去研究其他Petri网系统合成操作,如抑制弧连接、自环连接的语言关系式,由此得到行为不变性质.蒲飞等人[41]着重研究了Petri网系统共享合成的行为关系(语言关系),指出并证明了Petri网系统共享合成过程中语言的递归性Page3质,得到一个并发语言形式的共享合成语言关系式,并可用小系统的语言子集来判定共享合成网系统的活性,从而达到用小系统来研究大系统活性的目的系式.另有文献[42]和[43]分别提出了新的Petri网共享合成活性判定条件.上述研究工作为Petri网的层次化建模奠定了理论基础.1.3Petri网的分解Petri网化简策略主要利用功能和行为等效机制,将复杂结构简化为一个简单结构,来分析系统的性能.在结构化简过程中,因化简带来黑盒现象,系统的资源信息将会丢失,因此部分研究者开始了Petri网分解的研究,以避免化简的不足,但Petri网分解研究的成果尚不多见.Berthelot[44]提出用分解和变形的方法来研究系统的一些性质,如活性、无死锁性及有界性等的保持性问题.Aybar等人[45]用分解方法研究大系统的性质,采用一种称为包含原则方法分解大系统,以保证合成后的大系统具有小系统相应的性质,并给出了这种方法在分散控制中的应用.在应用方面,李建强等人[46]给出了工作流网的一个特殊子类———无环自由选择工作流网的一个分解算法.Li等人[47]将文献[46]的分解算法推广,进一步给出了含有循环结构的自由选择工作流网的分解算法,并在分解的基础上对工作流模型的性能进行了分析.文献[48-49]在研究Petri网分解中,给出了基于不变量分解算法,并在工作流性能分析中得到较好应用.上述的Petri网化简、精炼、合成、分解等内容,都是Petri网动态建模理论的研究范畴,上述许多方法在获得动态建模能力的同时,也造成了已有信息的丢失,使对Petri网的性质判断变得十分困难或不可能.2000年前后,部分学者基于图重构的思想,提出重构网的概念[2-7],但是,活性、有界性、可逆(可重复)性和公平性等一些基本性质的保持和继承问题仍然没有解决.Llorens等人[2-3]提出了网重写系统和重构网的并发系统建模方法,并证明了具有图灵机的计算能力,该方法在假设被重写的位置没有Token的情况下,使用图重构的方法,就是将一个同构的嵌入子图替换成新子图的方法,丢失了Petri网的状态动态性,使得活性、有界性、可逆性等性质难以判断.Li等人[5]对重写网系统和可重构Petri网进行了改进,将重写规则中左手、右手的接口限定为位置和变迁两种类型,并相应建立了几种结构模式,该方法能够较好地应用在柔性制造系统的建模中,但重写位置中的托肯仍然被忽略,另外,该方法即便在给定的结构模式下,重构系统的一些性质.如活性、有界性、公平性等仍无法得到保证.文献[7]对重写网系统改进,明确了流关系和权函数的区别,同时考虑了重写位置中的托肯对重写系统的影响,并分析了动态编程工作流网重写后的活性和健壮性等问题.本文在文献[2-7]基础上,提出了可重写Petri网(RewritablePetriNets,RWPN)和位置可重写Petri网(RewritablePlaceofPetriNets,RWPPN)的概念,分析了位置可重写Petri网保持有界性、公平性、可逆性、可重复性及活性等性质,给出了退化的位置可重写Petri网模拟共享合成Petri网的算法,证明了共享合成Petri网是位置可重写Petri网的一个实例.所得结果能够为动态重构系统的Petri网形式化建模提供理论方法,为大规模动态分布式系统的形式化验证提供有效方法.本文第2节介绍一些基本概念,建立可重写Petri网和位置可重写Petri网的概念,并举例子说明;第3节分析位置可重写Petri网的性质,证明位置可重写Petri网有界性、可重复性,提出判定一个位置可重写Petri网保持活性的充要条件,给出退化的位置可重写Petri网模拟共享合成Petri网的算法,证明共享合成Petri网是位置可重写Petri网的一个实例;第4节给出一个实例解释我们的方法;第5节总结本文的工作.2位置可重写Petri网(RWPPN)2.1Petri网的基本概念在Petri网的图形表示中,用圆表示库所,矩形框表示变迁,有向弧是连接两个不同类型节点(库所和变迁)的弧.库所中的托肯用圆点表示.本文引入几个必要的定义,其余概念参见文献[1,34].定义1.四元式N=(P,T;F,M0)称为Petri网,当且仅当,(P,T;F)是一个网;其中P,T分别是库所和变迁的有限集,P∩T=;F(P×T)∪(T×P)是流关系;M:P→Z为标识函数,其中M0是初始标识,Z={0,1,2,…}为非负整数集.(1)·x={y|(y,x)∈F}称为x的输入集或前集;x·={y|(x,y)∈F}称为x的输出集或后集;(2)对M1和M2,M1M2,当且仅当对所有的p∈P:M1(p)M2(p);Page4引发规则:(3)变迁t∈T在标识M下是使能的,当且仅当(4)若t在M下使能,则t可以引发,且引发后p∈·t,M(P)1,记M[t〉;产生一个后继标识M,记作M[t〉M,其中,M(p)=设R(M0)表示N的从M0可达的所有状态(标识)集合.如果存在M1,M2,…,Mk∈R(M0),且i:1ik,ti∈T:Mi[ti〉Mi+1,则称变迁序列σ=t1t2…tk在M1下是使能的,Mk+1从M1可达,记作M1[σ>Mk+1.定义2.设N=(P,T;F,M0)是Petri网,存在如下性质:(1)(N,M0)是活的,当且仅当t∈T,M∈R(M0),M∈R(M),M[t〉;(2)(N,M0)是有界的,当且仅当对M∈R(M0),k∈N,M(p)k;(3)(N,M0)是安全的,当且仅当对M∈R(M0),M(p)1;(4)(N,M0)是公平的,当且仅当t1,t2∈T,如果存在正整数k使得任意的M∈R(M0)和任意的σ∈T:M[σ〉都有#(ti/σ)=0→#(tj/σ)k,i,j∈{1,2},i≠j.定义3.Petri网N=(P,T;F,M0)是N的子网,当且仅当PP,TT,F=F∩((P×T)∪(T×P));Petri网N=(P,T;F,M0)是N库所子集P的外延子网,当且仅当PP,T=·P∪P·;F=F∩((P×T)∪(T×P)).定义4.PP是N的一个非空死锁(陷阱),当且仅当P≠,且·PP·(P··P);P是N的极小死锁(陷阱),当且仅当P真子集都不是N的死锁(陷阱).定义5.设Petri网Ni=(Pi,Ti;Fi,M0i),i=1,2,令N=(P,T;F,M0),若:①P=P1∪P2,P0=P1∩P2≠,设|P0|=h,|P|=m;②T=T1∪T2,T1∩T2=;③F=F1∪F2;④M0(P)=max{M01(P),M02(P)},若P∈P1∩P2烅烄M0i(P),烆i=1,2;称N为N1与N2的共享合成Petri网.在Petri网图形中,由一个节点到达另一个节点的所有有向弧连接的节点序列称为路径.设S是一个集合,S表示S中元素的所有有限序列的集合,且空序列λ∈S.σ∈S,记作(σ)={x|x是σ中的元素}.因此,算符将序列σ转换成一个字母表(σ).定义6.N是Petri网,一个从节点n1到nk的通道C是一个节点的序列〈n1,n2,…,nk〉,其中〈ni,ni+1〉∈F,1ik-1,(C)={n1,n2,…,nk}是通道C的字母表.通道C是基本的,当且仅当对通道C上的任意两个节点ni,nj,若i≠jni≠nj.定义7.一个Petri网是强连通的,当且仅当对于每一对节点x,y∈P∪T,都存在一个从x到y的通道.定义8.一个强连通的Petri网在结构上是良构的,当且仅当对任意一对不同类型的节点x,y(一个为变迁,一个为库所),若C1,C2是从x到y的任意两条基本路径,且(C1)∩(C2)={x,y}C1=C2.由定义8可以得到定义9.定义9.一个Petri网在结构上是良构的,当且仅当对任意两个相同类型的节点x1,x2与不同类型的节点y之间,如果存在基本路径C1和C2,则(C1)∩(C2)≠{y}(C1)∩(C2)=(Ci),i=1,2.2.2位置可重写Petri网(RWPPN)类似文献[2-3],本节主要建立可重写Petri网和位置可重写Petri网的概念.定义10.若RX×Y为二元关系,令XR={y∈Y|x∈X,(x,y)∈R}记作X的像,XX;令RY={x∈X|y∈Y,(x,y)∈R}记作Y的逆像,YY.R的域和陪域分别为Dom(R)=RY和Cod(R)=XR.定义11.G=(V,E)和G=(V,E)是两个图,G和G称为同构,若存在双射φ:V→V使得x,y∈V,(x,y)∈E(φ(x),φ(y))∈E.定义12.N=(P,T,F)和N=(P,T,F)为两个Petri网.N和N称为同构,若存在双射φ:P∪T→P∪T,使得x,y∈P∪T,F(x,y)∈NF(φ(x),φ(y))∈N.定义13.N=(P,T,F)和N=(P,T,F)为两个Petri网,N是N的全嵌入(fullembedding)定义为单射f:P∪T→P∪T,它映射库所到库所Page5和变迁到变迁,即f(P)P且f(T)T,使得x,y∈P∪T,F(x,y)=F(f(x),f(y)).在单射f下N的镜像也称为N的全子网(fullsubnet),当f(P)P或f(T)T时,在单射f下N的镜像也称为N的真子网(truesubnet).下面给出可重写Petri网(RWPN)的概念.定义14.可重写Petri网是一个二元组N=(,N0),其中={r1,r2,…,rh}为有限的重写规则集,N0=(P0,T0,F0,M0)为初始Petri网.一个重写规则r∈是一个四元组,结构为r=(L,R,·τ,τ·),其中:(1)L=(PL,TL,FL,ML)和R=(PR,TR,FR,MR)为Petri网,分别称为规则r的左手和右手;(2)·τ(PL×PR)∪(TL×TR)称为r的输入重写关系,是左手L的输入库所(变迁)关联到右手R的输入库所(变迁)的二元关系,即PLTL·τTR,·τPRPL,·τTRTL;(3)τ·(PL×PR)∪(TL×TR)称为r的输出重写关系,是左手L的输出库所(变迁)关联到右手R的输出库所(变迁)的二元关系,即PLτ·PR,TLτ·TR,τ·PRPL,τ·TRTL.可重写Petri网N=(,N0)的库所集P、变迁集T和流关系F由下列公式给出,其中f是L到N0的一个全嵌入,即f:L→N0.库所集:P=P0-f(PL)+PR,变迁集:T=T-f(TL)+TR,流关系:F(x,y)=库所p∈P,标识M(p)由下式给出M(p)=.定义15.可重写Petri网N=(,N0)的状态可达图为G(N),它的节点为N的状态,它的弧的描述如下:变迁使能:由状态M到状态M的弧标注了变迁t,即在状态M下,变迁t能够使能,并且到达一个新状态M:(N0,M)→t(N,M)(N=N0∧M[t〉).组态变化:由状态M到状态M的弧标注了重写规则r=(L,R,·τ,τ·),即存在一个全嵌入f:L→N0使得x∈P0∪T0∧xf(L)∧y∈L:x∈·f(y)y∈Dom(·τ)∨x∈f(y)·y∈Dom(τ·).为了更好地说明定义14和定义15,下面我们给出一个简单的例子.图1(a)中给出了重写规则,其中输入重写规则关系为·τ={({pstart},{ps1,ps2})},输出重写规则关系为τ·={({pend},{pend})}.图1(b)给出了重写过程,根据定义14和定义15,可以方便地求出N=(,N0)的位置集P、变迁集T、流关系F、标识M和状态可达图G(N),说明了系统(N0,M)在线运用了重写规则r={L,R,·τ,τ·}后到达的新状态(N,M),重写后系统中的标识增加了一倍.定义16.位置可重写Petri网N=(,N0)是一个可重写Petri网,其中:一个可重写规则r∈是一个四元组,结构为r=(L,R,·τ,τ·),称为位置重写规则,其中:(1)L=(PL,TL,FL,ML)和R=(PR,TR,FR,MR)为Petri网,分别称为规则r的左手和右手,PL=PLi∪PLo∪PLr,其中PLi、PLo和PLr是PL的划分.对p∈PLi,·p=;对p∈PLo,p·=.PLi和PLo分别描述左手库所集合的输入和输出接口.PR=PRi∪PRo∪PRr,其中PRi、PRo和PRr是PR的划分.对p∈PRi,·p=;对p∈PRo,p·=.PRiPage6和PRo分别描述右手库所集合的输入和输出接口.如果析取式(PLi=)∨(PLo=)∨(PRi=)∨(PRo=)为真,则称N=(,N0)为退化的位置可重写Petri网.(2)重写关系·τ和τ·分别称为输入位置重写关系和输出位置重写关系,即·τ(PLi×PRi),τ·(PLo×PRo).位置可重写Petri网N=(,N0)的位置集P、变迁集T和流关系F由下列公式给出,其中f是L到N0的一个全嵌入,即f:L→N0.则库所集为P=P0-f(PL)+PR,变迁集为T=T-f(TL)+TR.流关系F为F(x,y)=.对p∈P,标识M(p)为M(p)=M(p),烄max{M(p)p∈p·τ∪pτ·,M(p)},若p∈PRi∪PRo烅M(p),烆设N0,L,R的关联矩阵分别为犃1,犃L,犃R,其中犃i为ni×mi矩阵,i=1,L,R,记犃1=犃11犃12,其中,犃11、犃12、犃22分别是T-TL与P-PL、T-TL与PL、TL与PL所对应的关联子阵;显然犃22=犃L,同理犃12=犃PLiTL与PLi和PLo的关联矩阵,进一步得到位置可重写Petri网N=(,N0)的关联矩阵犃=犃11犃12,其中犃12是T-TL与PR所对应的关联子阵,同理犃12=犃PRiPRi和PRo的关联矩阵.3位置可重写Petri网的性质分析12犃PRo[]12,其中犃PRi图1展示了位置可重写Petri网的重写过程和结果.由定义15和定义16可知,位置可重写Petri网是重写Petri网的一个子类,该子类在众多可重构系统的建模中占有较大比例,因此研究该子类性质对系统建模具有重要意义.本节主要分析位置可重写Petri网的一些基本性质及定理.引理1[1].设犃是Petri网N的关联矩阵,则N为结构有界Petri网(守恒网)当且仅当存在m维正整数向量狔使得犃狔0(犃狔=0).引理2[50].Petri网N是良构的,则N为结构有界Petri网,若N是强连通的,则N是活的.定理1.设N=(,N0)是位置可重写Petri网,若N0是结构有界的,重写规则的右手R是良构的,则N=(,N0)是结构有界网.证明.要证明位置可重写Petri网N=(,N0)是结构有界的,当且仅当证明存在一个正整数向量犢使得犃犢0,即犃犢=犃11犃12犃11Y11+犃12Y12+犃RY120.量犢1,使得犃1犢10,由犃1=犃11犃12犃11Y11+犃12Y12+犃22Y120,犃11Y110,犃22Y120和犃12Y120.下面分别构造犢1、犢2,使得犃犢=犃11犃12因为Petri网N0是结构有界的,即存在整数向0犃[]RR是结构有界的,由N0和R的结构有界性,可以得到T-TL与PR的子网也是结构有界的,即存在整数向量犢2,使得犃R犢20,犃12犢20.令犢1=Y11,于是得到犃11犢1+犃12犢2+犃R犢20,由于犃犢=犃11犃120犃[]R使得犃犢0,由引理1知,N=(,N0)是结构有界网.同理可证定理2成立.定理2.设N=(,N0)是位置可重写Petri网,若N0是是守恒的,重写规则的右手R是良构和守恒的,则N=(,N0)是守恒网.引理3[1].设犃是Petri网N的关联矩阵,则N为可重复Petri网(协调网)当且仅当存在n维正整数向量犡使得犃T犡0(犃T犡=0).定理3.设N=(,N0)是位置可重写Petri网,若N0是可重复的,重写规则的右手R是良构的,则N=(,N0)是可重复网.证明.N0是可重复的,则存在n1维正整数向量犡1=(X11,X12),使得犃T1犡10,由犃1=犃11犃12Page7犃T11X110烅烄犃T12X11+犃T烆,使得犃T犡=犃T犡1烌烄犡烆烎2构的,由定义9可知,对p∈PRi,都存在唯一一条基本路径到达PRo,使得P·则存在n2维正整数向量犡2,使得犃T令犡1=X11,则数向量犡=X11由引理3,N=(,N0)是可重复网得证.证毕.同理可证下述结论成立.定理4.设N=(,N0)是位置可重写Petri网,若N0,R都是协调网,重写规则的右手R是良构,则N=(,N0)是可重复网.引理4[42].设N为一个Petri网,M为N的一个标识,记T={t∈T|M[t〉},P={p∈P|M(p)=0},P=·T∩P,如果·PT,则P是N的一个死锁,且M(P)=0.引理5.设N=(,N0)是位置可重写Petri网,若N0是活的,R是良构的,PRi∪PRo的外延子网不含非空死锁,则N=(,N0)是活的.证明.反证法.假设N=(,N0)不是活的,则M1∈R(M0),t∈T,对M∈R(M1):M[t〉,记T={t∈T|M∈R(M1):M[t〉},PM1={p∈P|M1(P)=0},P1=·T∩PM1;现在考察P1,若·P1T,即t1∈·p1和M1∈R(M1):M1[t1>,显然t1T.设M1[t1>M2,p1∈P1,M2(p1)=1,然而由于p1∈P1,若p1∈PN\(PRi∪PRo),这与N0是活的相矛盾,同理p1PR\(PRi∪PRo),故p1∈PRi∪PRo,以下分两种情况分析:(1)p·p1中增加的这个标志不能导致任何变迁发生,只能“冻结”在那里,令PM2={p∈P|M2(p)=0},P2=·T∩PM2,显然P2P1.再分析·P2,若·P2T,即t2∈·P2和M2∈R(M2),使得M2[t2〉,则t2T.设M2[t2〉M3,则p2∈P2,使M3(p2)=1,同p1一样,p2中的标志也“冻结”在那里,不会导致任何变迁发生.由于M1的有限性,上述过程重复有限步之后,必然会遇到一个Mk:Pk=·T∩PMk,PMk={p∈P|Mk(p)=0}使得t∈·Pk,M∈R(Mk):M[t〉.这时便有·PkT,由引理4知,Pk是一个死锁,且Pk≠(否则·T∩Pk=→t∈T:Mk[t〉)这与题设相矛盾,命题得证.(2)p·死锁,这与题设相矛盾,命题得证.证毕.引理6[1].设N是一个Petri网,M是网N的一个标识,D是N的一个死锁,S是N的一个陷阱,D不被M标识M∈R(M),D不被M标识;S被M标识M∈R(M),S被M标识.定理5.设N=(,N0)是位置可重写Petri网,N0是活的,R是良构的,若N=(,N0)是活的,当且仅当PRi∪PRo的外延子网的每个极小死锁Q中均包含一个含有标志的陷阱.Pk-1,Tk=·Pk-1,T-k=Pk-1·-·Pk-1.Pk=,即·(·Pk-1)=或Pk-1=,由NPk-1的构造知Pk-1=不成立.因为,若·Pk-1=,则Pk-1内的标志在Pk-1·的变迁发生之后,Pk-1的标志将丢失,则Pk-1·将永远不再发生,这与NPk-1是活的相矛盾,即·Pk-1≠证明.先证充分性.(1)Q既是死锁也是陷阱,这时只需证明M0(Q)≠0.由于Q既是陷阱又是死锁,即·Q=Q·,若M0(Q)=0,因Q是死锁,由引理6知M∈R(M0),M(Q)=0,则t∈Q·,M∈R(M0):M[t〉,这与N=(,N0)是活的相矛盾,故M0(Q)≠0成立.(2)Q不是陷阱,则一定t∈Q·,t·Q,记T1=·Q,T-1={t|t∈Q·∧t·Q},P1={p|p∈·T1∩Q},NP1=(P1,T1;F1,M(P1)),F1=((P1×T1)∪(T1×P1))∩F,由N=(,N0)的活性知,则NP1也是活的.因Q是死锁,由引理6知,Q以外的标志不会进入Q,而T-1的发生会使Q中的标志减少,P1若是陷阱,由于NP1是活的,则M(P1)≠0,即得证.若P1··P1,重复以上步骤,将得到一个活网NP2=(P2,T2;F2,M(P2)),在执行若干步之后就会出现下述情况:①Pk≠φ,Pk··Pk,且M(Pk)≠0,即结论②Pk=φ,由PNpk的构造过程可知,Pk=·Tk∩得证.Page8;若·Pk-1≠,即Tk≠,则NPk是只含有变迁的Petri网,·Tk中的标志可以经过T-k流到NPk-1之外,进而流到Q之外,使得Tk中的变迁永远不能发生,这与N=(,N0)是活的相矛盾.综上所述,充分性得证.再证必要性(反证法).假设N=(,N0)不是活的,由引理5的证明过程知:PRi∪PRo外延子网含有空的死锁,而由题设知PRi∪PRo外延子网含的极小死锁中都含有陷阱,由引理6和题设知,陷阱被M标识M∈R(M),陷阱被M标识,因此无论变迁怎样发生,都不可能使PRi∪PRo外延子网中的死锁为空,这与题设相矛盾,即必要性得证.定理6.共享合成Petri网是位置可重写Petri网的一个实例.证明.只需证明位置可重写Petri网能够模拟共享合成Petri网,下面我们给出一个构造性证明.根据共享合成Petri网的概念,令N1或N2为位置可重写Petri网N=(,N0),不防令N1=N0,通过构建重写规则,使得重写规则的左手L是一个仅含有库所的退化Petri网(重写规则r=(L,R,·τ,τ,τ·),对p∈P0=P1∩P2,令PLi={p},TLi=,FLi=),重写规则的右手R是一个Petri网N2的一个子网,且该子网是含有左手L的库所p,但不含有其它共享库所P0\{p}中任何库所的最大连通子网,用R重写N0.令N2=N2-R,继续重写规则的构建过程,经过|P0|次(|P0|表示集合P0元素的个数)重写后得到N1和N2共享合成Petri网N.具体构造过程见算法1.由上面的构造,可以知道N=(,N0)是一个退化的位置可重写Petri网,经过|P0|个位置重写过程,我们就可以得到N1和N2共享合成Petri网,这是因为位置可重写Petri网N=(,N0)在结构上满足:①P=P1∪P2,P0=P1∩P2≠;②T=T1∪T2,T1∩T2=;③F=F1∪F2是显然的.由位置重写Petri网标识的定义,同样满足条件:④M0(P)=max{M01(P),M02(P)},若P∈P1∩P2烅烄M0i(P),烆i=1,2;即位置可重写Petri网N=(,N0)的重写结果满足共享合成Petri网概念,命题得证.证毕.算法1.通过Petri网N2构造重写规则的右手Ri.1.i=1toP0;2.初始化,PRi=,TRi=,FRi=,Y=;3.取任意一个p∈P0;4.Y←Y∪{p}#{构造含有p,但不含有P0\{p}中任何位置的最大连通子网,从p开始遍历Petri网PN2,直到求得最大子网}5.判断是否Y=,不为空,执行步6,若为空,执行步17;6.取y∈Y;7.x←y,Y←Y-{x};8.判断是否(P2\P0)∪T2=,若为空,则执行步9,不为空,则执行步10;9.判断是否F2=,不为空,执行步16,为空,则执行步18;则返回步5;10.取y∈(P2\P0)∪T2,若(x,y)∈F,执行步11,否11.判断y是否标记已访问,若未被访问,则执行步12,若y已被访问,则执行步14;12.如果y∈P2,则执行步13;否则,执行步14;13.TRi←TRi∪{x},PRi←PRi∪{y};14.y∈T2:PRi←PRi∪{x},TRi←TRi∪{y};15.FRi←FRi∪{(x,y)},Y←Y∪{y},对y标记已访问;16.FRi←FRi∪{(x,y)},返回步10;17.P0←P0\{p};16.T2←T2-TRi,P2←P2-PRi,F2←F2-FRi;18.i←i+1,返回步1;19.算法终止.4性质分析示例在下面图2、图3的示例中,给出重写规则的右手R是非良构的两种不同的重写结果.由图2分析,显然N0是活的,R是非良构的,N=(,N0)是一个退化的位置可重写Petri网(R重写库所p4),位置可重写Petri网N=(,N0)是有界的,但不是活的.由图3分析,显然N0是活的,R是非良构的,N=(,N0)是一个退化的位置可重写Petri网(R重写库所p4),位置可重写Petri网N=(,N0)是活的,但不是有界的.由图4分析,显然N0是活的,R是良构的,N=(,N0)是一个退化的位置可重写Petri网,位置可重写Petri网N=(,N0)是结构有界的、活的和可重复的.图5给出了共享合成Petri网的一个示例,图6给出了位置可重写Petri模拟图5的过程.Page95总结本文在文献[2-7]等研究的基础上,提出了可重写Petri网和位置可重写Petri网的概念,分析了位置可重写Petri网保持有界性(保守性)、可重复性(协调性)及活性等的性质,给出了位置可重写Petri网保持活性的一个充要条件,建立了退化的位置可重写Petri网模拟共享合成Petri网的算法,证明了共享合成Petri网是位置可重写Petri网的一个实例.该结果能够为Petri网对动态重构系统的形式化建模提供理论方法,为大规模动态分布式系统的形式化建模和验证提供有效途径.今后我们将进一步研究可重写Petri网的其它子类的概念和性质,Page10图6位置可重写Petri网模拟共享合成Petri网不断丰富可重写Petri网的理论成果.
