Page1基于X.509证书测量的隐私泄露分析曹自刚1)熊刚2)赵咏2)1)(北京邮电大学计算机学院北京100876)2)(中国科学院信息工程研究所北京100093)摘要SSL协议由于易于部署以及集成在Web浏览器中的天然属性,被广泛应用于保障网页浏览、电子邮件、文件传输等应用服务的信息传输安全,其中最典型的应用是HTTPS.然而,实践中往往由于HTTPS服务的部署存在问题,比如服务器采用自签名X.509证书等,给用户带来严重的安全威胁,包括信息遭窃取、用户身份和行为隐私泄露等.本文从标识服务器身份的X.509证书出发,通过对真实环境HTTPS服务端证书的大范围测量和分析来揭示采用自签名证书的HTTPS服务存在的应用服务类型泄露问题,以及由此引起的用户网络行为隐私泄露威胁.针对大规模真实环境中用户网络行为的测量分析和海量日志挖掘结果表明,X.509自签名证书提供了较强区分服务器加密应用类型的身份信息,加密HTTPS应用服务器的身份隐藏手段在很大程度上可以通过统计行为分析来识破,提供相同或相似的特定应用服务的服务器的被正确分类的准确率最高可达95%.关键词HTTPS;X.509证书;自签名;测量;用户行为隐私;隐私保护1引言近年来,网络媒体、电子商务和社交网站的迅速发展,给广大互联网用户带来了极大便利.与此同时,不法分子利用互联网的开放性,采用木马、网络钓鱼和网络攻击等手段盗取信息或进行破坏,给人们带来信息隐私泄露和财产损失.为保护用户隐私和数据安全,基于X.509证书公钥基础设施(PKI)的SSL/TLS协议被广泛用于网络身份认证和信息加密传输,其中典型应用有HTTPS、POPS、SMTPS和FTPS等,且HTTPS应用最为广泛.然而,公钥机制安全性的实现依赖于安全实施.目前大量加密网络服务采用不安全的SSL部署,给攻击者以可乘之机.更重要的是,服务提供者和用户甚至对自身面临的信息泄露等安全风险毫不知情,也不会改善安全措施,因此隐私威胁长期无法消除.另一方面,目前已知的恶意软件如木马、僵尸网络和APT(AdvancedPersistentThreat)等已经出现采用常见SSL/TLS服务端口(如443)以及SSL/TLS协议来躲避安全防护设备检查的情况,这些也给个人隐私安全与企业和政府机构的信息保密带来极大挑战.因此,深入研究HTTPS服务的网络行为特点,挖掘背后的动机和目的,对于提升对恶意隐蔽信道和行为的检测能力,加强用户隐私保护和网络安全管理等都具有重要意义.一般意义的隐私含义很广泛,而这里的隐私仅指互联网中用户行为的隐私,包括两个层次:第1层是指用户的通信内容隐私,主要针对非加密通信流量,包括电子邮件内容、访问网页内容、观看视频内容等;第2层是指用户的网络行为隐私,主要针对加密流量,比如用户访问了哪些网站,加密信道内部的承载应用类型(如HTTP、远程登录、文件传输、视频).网络行为的外在表现形式是网络流量,因此,对网络行为的隐私分析可以转化为对网络流量的分析.本文研究对象是HTTPS加密服务的网络行为隐私问题.针对HTTPS等加密服务的隐私研究,可分为隐私泄露发现和隐私保护两个方面.就隐私保护方法而言,目前有两大途径:一个是匿名系统,如Tor①和JAP②,通过流量伪装、信息隐藏和密码技术实现身份和内容隐藏;另一个是加密机制,如SSL/TLS、SSH、VPN,借助于密码学和公钥基础设施来确保信息的机密性、完整性,并进行身份认证.其中,SSL/TLS与PKI结合紧密、部署方便,往往应用于加密Web浏览、文件传输和加密电子邮件等网络基本常用服务.就隐私泄露发现而言,有针对匿名网络和针对SSL等安全机制在协议和应用层面的攻击等.本文重点分析SSL服务实际部署中的安全弱点给用户造成的隐私泄露.要想从宏观上把握现实环境中HTTPS隐私威胁现状,就必须对HTTPS的部署实施情况有真实全面的了解,而测量是把握HTTPS服务现状最直接和最有效的方法之一,也是网络协议、服务和应用研究的一般性方法.通过测量可以了解SSL/TLS服务的总体情况并发现其中的规律和实际问题,为进一步的隐私分析和保护策略的制定提供数据支持.目前,对于SSL/TLS的整体状况的测量研究在国外已经有人做了较为完整的工作[1-3].国内尚未见到系统深入的测量研究,也没有基于证书的公开性研究成果.本文的测量部分的工作填充了这一空白,且与国外相关工作在测量方法和研究侧重方面有较大差异.针对HTTPS隐私发现的研究方法很多,比如理论分析、协议漏洞发现与利用、统计学习等.目前的主流方法是统计学习,涉及的主要领域是流量分析.此类方法大都从流量统计属性出发采用机器学习等方法对加密信道内部应用进行分类,或者对访问的网站等进行判定[4-6],发现的隐私属于用户网络行为隐私.首先根据包长度、包时间间隔、传输的字节数等信息建立网站指纹库,然后对实际流量的相应属性进行抽取并进行比较.此类研究给我们以启示,即虽然加密后攻击者无法查看传输的真实内容,但可以从协议、传输内容以及服务器的自身特性(如网站首页的资源个数)等统计属性中找到识别特征.然而,这一类基于学习的方法能够成功的前提是被研究对象在包长、包间时间间隔等属性方面具有可区分彼此的统计特征.在小数据集上这一假设基本成立,但在真实场景中,这些统计特征区分度随着数据集的增大和应用的复杂化越来越不明显,不能作为区分判断的有效依据.因此,实验结果往往随着数据集的增大变差,或者在实验结果和真实环境结果有较大差距,距离实际应用尚有一段距离,比如文献[7-9].为了解决上述统计方法面临的难题,我们尝试①②Page3从SSL服务器的自签名X.509证书的属性出发,从中挖掘出服务器相关的信息并提取特征,以此对用户访问此类加密服务的细粒度应用类别进行区分,从而揭示出HTTPS服务长期存在的用户访问应用内容类别隐私泄露问题.需要说明的是,基于证书是服务器的真实身份标识的考虑,合法有效的X.509证书一般包含了其域名、公司机构等信息,识别其应用类型比较容易,且安全性较高,不太具有隐私研究价值.本文的主要研究对象是采用自签名证书的HTTPS服务,此类服务器的证书不是由权威机构颁发,而是自己随意制作,缺乏也无法进行完整身份认证.由于完全自主颁发,证书的身份标识可以随意伪造、空缺、隐藏或模糊处理,因此此类服务处于相当混乱的状态,也存在极大的安全隐患,属于最不安全的数字证书应用之一.我们的目的是识别这些不可信证书的真实身份,比如应用服务类别等刻意隐藏的信息,从而揭示其存在的用户行为隐私泄露问题.本文面向X.509证书的隐私分析有两个方面:一是根据测量统计结果,对采用自签名证书的HT-TPS服务的隐私威胁进行分析;二是通过对此类X.509证书的挖掘分析,揭示出在大量自签名证书缺乏完整可信身份标识的情况下,仍然可以在很大程度上对SSL服务类别进行区分.2相关研究工作2.1网络测量从传统意义上讲,网络测量是指借助特定的方法,利用已有或构造的软硬件设施,对网络性能参数进行测试评估的活动[10].随着新技术、新应用的不断涌现,现在的网络测量不仅包括对网络自身性能的评估,而且融入了对特定应用或服务流量及行为特征的提取、建模和预测等.网络测量的要素主要包括测量对象、测量内容和测量方法.其中,测量对象表明测量范围是网络、服务或者应用;测量内容是指测量对象的被测属性和特征;测量方法是指最终实施测量的具体操作流程、规范等.根据测量方式的不同,网络测量可划分为主动方法和被动方法[11].被动测量借助已有网络环境或在网络节点等特定位置增加网络设备,通过被动捕获流经的网络数据流来记录网络活动等信息.主动测量则是通过人工或自动向网络中发送特定探测数据,然后观察响应并记录相应参数信息.两者各有优缺点,在实际应用中往往需要根据实际情况进行取主动测量具有如下优点:(1)简单便利性.对测量位置无特殊要求,无需考虑网络拓扑环境等,只需发送少量数据并记录被测对象的响应信息,适合端点间网络性能(如连通性、延迟等)的测量.(2)无侵犯用户隐私法律风险.只关心自身相关数据,不查看网络中其他用户的信息.(3)可控性.如果需要观察协议、应用服务在特定情况下的反应,只需构造相应参数的数据进行测试即可,无需长时间被动等待.其主要缺点如下:(1)增加了网络中的流量,可能影响被测对象,导致测量偏差,甚至严重影响网络的正常运行.(2)大面积、集中式主动测量容易被网络安全设备当作网络异常或攻击,导致探测或响应包被拦截、丢弃,从而使测量失败或结果偏差极大.舍,或者将两者结合起来.何影响,结果可靠性高.息,比如流量大小、访问次数等统计信息.被动测量具有如下优点:(1)不增加网络负载,对网络中用户基本无任(2)能够获得一些主动方法无法获取的详细信被动测量的缺点有:(1)隐私问题.被动监测往往需要从流经的所有数据中过滤所需信息,存在侵犯用户隐私的法律风险.(2)局部性.由于被动测量设备一般是在固定地点,因此只能获得相连网络的数据,无法获知网络大范围的整体情况,且测量数据中不一定包含所需的数据样本.(3)可操作性.被动测量严重依赖网络环境和设备,灵活性不强.对于缺乏相应网络环境的研究者来说,几乎无法开展此类测量工作.2.2SSL/TLS测量2.2.1SSL/TLS与X.509证书SSL(SecureSocketLayer),即安全套接层协议,是Netscape公司提出的信息加密传输协议,其目的是为客户端与服务器之间的信息传输构建一个加密通道.SSL通过身份认证、使用数字签名确保完整性、使用加密确保机密性,实现安全通讯.该协议由两层组成:SSL记录协议和SSL握手协议.1994年11月首次公开发行了SSL协议2.0版本(之前版本未公开).由于此版本被证实有很多缺陷,Netscape公司于1996年5月发布了SSL3.0版本.Page4IETF以SSL3.0为基础,于1999年发布了TLS(TransportLayerSecurity)即传输层安全协议的1.0版本,之后进行修订和扩充,先后发布了TLS1.1版(2006年)和TLS1.2版(2008年)的协议标准.目前在SSL握手过程中常见的版本号与具体协议版本对应关系如表1所示.握手协议版本号SSL/TLS版本RFC编号0x030x000x030x010x030x020x030x03SSL/TLS协议之所以能够广泛应用,最重要的一点是其依赖公钥基础设施的安全性.公钥基础设施的核心是基于X.509证书的认证链.理论情况下,依靠这种完整机制可以保证信息的完整性、机密性和不可否认性.X.509证书,也称公钥证书,是SSL/TLS握手协议进行身份认证依赖的通用实体.只有身份认证成功才会协商密钥并进行应用数据加密传输.X.509证书标准包含在X.509标准中,由ITU-T(国际电信联盟)制定.X.509证书版本主要有V1、V2、V3,目前的主流版本是V3.其实,证书根据用途分为PKCS格式和X.509格式,其中SSL身份认证使用的是X.509公钥证书.一般而言,证书必须包含的属性有版本(version)、序列号(serialNumber)、签名(signature)、颁发者(issuer)、有效期(validity)、持有者(subject)和主体公钥信息,其中颁发者和持有者可能包含一个或多个子项,常见的子项有通用名(CommonName)、机构名(OrganizationName)、国家名(CountryName)等.V2和V3版本支持颁发者唯一标识符和持有者唯一标识符,V3版本还支持扩展项.2.2.2证书认证体系与自签名证书证书的颁发由证书认证机构CA(certificateau-thority)实施.证书认证采用的是信任链机制.验证的时候,最终用户的身份通过末端实体证书中的公钥来标识,而证书的真实性由其颁发机构(即另一个CA)来证明,但最终证书链的顶点即根证书的公钥真实性无法用此方法证明.公钥基础设施一般依靠其他安全信道解决,比如对根CA的公钥通过公共途径公布.而公告根CA时考虑到兼容性和便利性,通常仍采用证书形式.这种形式上的证书作为一种特殊证书,称之为自签名(Self-signed)证书.与末端实体的证书不同,自签名证书是自己给自己签发的证书,颁发者和持有者相同,无法被验证,因此必须通过可信途径获得,以防止被假冒.目前,Web浏览器一般通过内置方式添加特定的根CA自签名证书作为默认的可信根.虽然大部分大型机构如银行等采用浏览器内置的国外知名根CA颁发的证书,但小型机构或个人往往采用自签名CA证书作为身份认证实体.这些证书一旦被浏览器验证,都会弹出安全警告.自签名证书很容易被一些非法应用及钓鱼网站等利用.由于没有可信第3方对其身份进行验证,伪造自签名证书十分容易,攻击者可以随意签发一个和真实网站证书几乎一模一样的证书,用户难以辨别其真实性,浏览器也无法确认真假.如果用户访问部署此类证书的服务器,容易遭受中间人攻击导致信息泄露.而恶意软件也可采用此类证书部署加密服务,既能躲避安全审查,又便于隐藏真实身份.因此,自签名证书是公钥证书中最不安全的一类.2.2.3SSL测量国内外现状Holz等人[1]从X.509证书的角度借助主被动测量的方法对SSL的整体态势进行了深入分析.在一年半时间内从全球9个不同地理位置对大量流行的HTTPS服务器进行了扫描,并利用10Gbps链路进行被动监测.通过对主机响应和证书有效期、证书链、扩展验证、主机名、公钥和颁发者等多个属性的分析揭示了当前PKI实施的糟糕状况:即使在绝对合法的证书中,高强度属性的证书比例也很低.作者也提到了X.509自签名证书,根据他们的测量结果,97.78%的通用名与主机名不符,前3名通用名为plesk、localhost和localhost.localdomain,但没有进一步深入分析.Levillain等人[2]对互联网上的HTTPS服务器在2010年7月到2011年7月间进行了枚举探测来评估HTTPS服务器的质量.首先探测出整个IPv4网段中全部可路由IP中开放HTTPS服务端口的IP列表,然后根据一系列DNS对这些IP解析出的域名进行HTTPS连接并收集真实流量.他们从协议版本、密码套件、TLS扩展、服务器响应和证书链等方面分析了SSL主机的安全状况,并重点分析了两类TLS主机:信任主机(trustedhosts)和扩展验证主机(ExtendedValidationhosts).与上述已有测量工作相比,我们的测量有如下差异:(1)侧重点不同.已有测量工作侧重于从整体Page5上测量,测量范围全面,其目的在于揭示SSL的总体特性;我们的测量以一类不安全的SSL服务为重点,目的是从服务器的X.509证书这一新的角度探索HTTPS在实际应用中的隐私泄露威胁.(2)测量方法细节有差异.已有的主被动测量方法是主被动分离,主动方法是对整个IPv4可路由地址段进行主机端口扫描和连接探测,被动则是对实验网络的纯被动数据监测;我们的方法将主被动进行有机结合,根据被动监测到的NetFlow信息对其中的HTTPS服务器IP地址进行主动探测,不仅大大减少了需要探测的IP地址数,避免了大面积长时间扫描,而且成功率高.(3)测量环境及性能不同.我们的测量以中国教育和科研网的实际访问的IP范围为基础,数据真实可靠.已有方法则主要或仅仅采用主动探测方法,虽然能够通过分布式主动探测获得全球范围服务器的行为,但无法获得服务器被访问的频度等信息,无法反映实际情况.从性能上讲,本方法将探测IP地址范围缩小到十万级别,与已有主动探测方法相比效率更高、耗时更短.2.2.4本文中测量的目的和内容从研究安全浏览隐私风险的角度出发,我们主要关注SSL/TLS的安全属性测量,而不是性能等其他方面.根据我们的研究发现,缺乏有效认证的自签名证书的大量使用是Web浏览过程中安全和隐私风险主要来源之一.同时,一些僵尸网络如Spy-eye采用SSL的服务端口通信来躲避安全检查.关于APT的研究[12-13]也发现了恶意软件通过443端口传输加密数据躲避审查.卡巴斯基于2012年发布的报告中也指出Duqu和Flame等APT样本通过SSL加密连接与命令和控制服务器通信,且服务器采用自签名证书①.因此,测量工作对于隐私分析来讲不仅为后续的隐私安全风险分析提供基础数据,还有助于分离SSL服务端口上的非SSL服务,进而使用信息熵、异常检测等方法来发现可能导致隐私信息泄露的恶意应用或隐蔽性攻击.由于加密的原因,对于SSL几乎无法从内容层面进行深入分析,除了常见的连接持续时间、包长度序列和传输字节数等统计属性外,难以找到有效刻画其行为的测量属性.经过调研,我们最终选取了X.509证书作为测量和研究内容,其原因如下:(1)X.509数字证书作为加密服务器的身份标识和安全标识,很可能是加密应用服务的外在表现,其测量结果很大程度上反映出SSL状态信息.(2)虽然SSL应用数据是加密传输的,但是服务器采用的证书可以通过主动探测的方法获得,为测量分析提供了方便.(3)就测量的最终目的———隐私分析来说,根据SSL协商过程,身份认证总是在连接的开始阶段,因此基于证书的隐私发现可较早进行.主流的统计方法往往需要对SSL、SSH握手结束后一段时间的应用数据信息甚至整个连接持续过程进行统计属性分析,明显在时间上延迟较大.(4)采用流级别的统计属性不存在任何隐私法律风险,但结果往往面临着实验环境和真实环境在数据集大小和复杂性等方面差异带来的挑战.而证书作为公钥机制的身份标识,其意图就是公开可见.本方法若应用于被动监测,除了对证书进行分析外不检查任何其它通信内容,尽力做到最大程度保护用户隐私.(5)目前已有利用X.509进行的SSL测量的相关工作[1],说明了基于测量的分析方法的可行性,且我们的研究侧重点是证书中的自签名证书及隐私安全问题,与之前工作差异较大.2.3加密Web浏览隐私Web浏览的隐私安全风险问题一直是安全界研究的热点问题.近年来加密Web浏览的规模不断增大,受到研究者广泛关注.CNCERT统计结果②显示HTTPS默认服务端口443上的流量在TCP端口流量中排行第4位,因此对加密Web浏览的研究很有意义.目前的研究分为隐私威胁分析和威胁对抗两方面,其中前者主要手段是流量分析(trafficanalysis)[14]攻击,且基本是基于统计方法.早在2002年,微软的研究人员就采用统计方法对加密Web浏览的流量进行识别[15],将HTTP请求对象的个数和对象的长度作为统计特征并针对不同网页建立指纹库,通过流量模式匹配判断与库中的哪个网页访问指纹最相似.作者还介绍了该统计方法的对抗措施,包括填充(Padding)、模仿(Mimic-king)和变形(Morphing).Bissias等人[16]指出加密HTTP流无法抵抗针对流量模式的流量分析攻击.通过对收集的100个最常访问站点Web请求的包长和时间间隔的分布①②Page6这两个统计特征抽取并建模,对加密WEP/WPA、IPsec和SSH隧道的加密HTTP访问进行站点识别.对25个最具标识性站点的最优实验结果显示,3次猜测可以获得100%的准确率.Schatzmann等人[17]利用协议和时间之间的关联关系,采用NetFlow层面的统计特征对HTTPS中的加密Webmail流量进行分类.3个特征为Web-mail与传统POP、IMAP的继承相似性,回话持续时间和每天、每周流量轮廓以及AJAX客户端检查新消息的周期性.Dyer等人[9]对HTTP通过SSL等多种加密隧道场景下的通用流量分析对抗措施进行了全面分析,结果表明9种已知的对抗措施无法应对利用流量粗特征(time,bandwidth,burstbandwidth)的简单攻击.Herrmann等人[18]提出一种新方法将常见的文本挖掘技术应用到可观察的IP分组大小归一化频率分布,采用多项式朴素贝叶斯分类器对775个样本站点的分类准确率达到97%.Cai等人[19]提出了针对几种常见流量分析防护措施的网页指纹攻击方法,防护包括SSH、HTT-POS[20]、Tor、基于样本的伪装以及他们的组合.该方法采用Damerau-Levenshtein距离来计算网页访问流量之间的相似性,并通过隐马尔科夫模型将网页分类器扩展为网站分类器.实验结果显示,当前的防护措施不够充分,指纹攻击十分有效.上述HTTPS隐私威胁发现研究都是针对Web客户端对特定范围内服务器访问的流量统计特征进行抽取,建立指纹库,然后进行匹配.其缺点是对大规模网站集合的分类效果会明显变差,对于非已知集合内的网站的访问很可能被误识别.另外,HTTPS流量中的加密Web服务种类很多,而上述研究一般仅仅是对少量Web浏览访问站点的区分,缺少对SSL加密服务整体的隐私安全研究.我们的工作则是在测量基础上从服务器的角度研究SSL总体的泄露用户行为的隐私安全风险,侧重于揭露加密Web服务总体的粗粒度隐私威胁.与上述研究相比,出发点不同,研究面也更为宽泛,更具有大规模实际应用前景.3基于SSL证书测量的隐私分析3.1主被动测量方法及过程我们采用主被动结合的高效率方法进行SSL测量.实际测量时,为了避免大规模扫描对网络影响和节约资源,同时尽量不侵犯用户隐私,我们从主干网络网关NetFlow连接信息中提取443端口号的IP地址列表作为HTTPS服务器列表.通过真实NetFlow提取服务器IP的好处是大大缩小探测IP范围并具有很高的访问成功率.获取到IP地址范围后,通过分布在多台客户端主机上的Python脚本程序并行访问服务器列表中的IP.如果连接IP的443端口失败,则尝试通过域名解析系统获取该IP地址的域名,一旦获取成功则模拟浏览器访问该域名.整个探测过程中对客户端主机的443端口流量进行捕获并提取服务器SSL/TLS版本和证书信息.主被动测量系统的流程如图1所示.需要说明的是,图中省略了与主动测量并行的流量记录和分析步骤,具体包括探测机网卡数据包捕获、数据包解析、服务器X.509证书信息提取等.将主动测量获取的证书信息与从网关得到的NetFlow信息根据服务器的IP地址进行对照,就可以获得完整的测量结果数据集.3.2测量结果3.2.1SSL基本情况根据我们从教育和科研网主干路由器24h采集的NetFlow信息和我们主动测量的结果,经过数量统计,IP地址和证书信息去重,IP地理位置查询等分析处理,有如下发现:(1)被测网络范围内客户端访问国外443端口的服务器IP次数为8229万次/d,服务器IP数为Page734.2万/d,客户端IP数为89.0万/d.其中,SSL成功访问次数为7956万/d,服务器IP数为27.1万/d,客户端IP数为88.9万/d;探测失败访问次数为273万/d,服务器IP数为7.1万/d,客户端IP数为1.3万/d.即确认的SSL访问次数占96.7%,其余占3.3%.探测失败的服务器提供何种服务值得进一步探索.(2)所有SSL访问中,服务器SSL握手采用的协议版本分布为TLS1.0占86.27%、TLS1.1占9.50%、TLS1.2占2.36%、SSL3.0占1.87%.从安全角度考虑,SSL3.0目前应该被淘汰,而TLS1.0也有一些安全问题[2],因此TLS实际部署存在明显滞后性,存在数据隐私泄露的安全隐患.(3)所有访问中,不同版本证书比例如表2所示.由结果可知,服务器实际部署的证书中,绝大部分是V3版本的,其次较多的是V1版本的.值得一提的是,V1版本证书中,自签名证书比例为81.8%;V3版本证书中,自签名证书比例为0.42%.可见V3版本证书是目前的主流,而V1版本证书具有较高的自签名比例,存在隐私安全风险.证书版本(4)借助于MaxMind公司的GeoIP数据库①和API接口,我们编写程序对27.1万服务器IP地理位置情况进行了统计,结果如表3所示.排名地理位置/国家12345这里的结果是针对去重后的IP统计得出的,美国IP比例过半.如果按访问次数计算,美国IP的比例将更大.(5)最活跃的服务器IP段信息:在访问最多的服务器IP中,按照B段进行合并得到,前10名依次为:74.125.0.0/16、207.46.0.0/16、157.56.0.0/16、65.55.0.0/16、173.194.0.0/16、65.54.0.0/16、64.4.0.0/16、17.172.0.0/16、17.151.0.0/16和17.158.0.0/16.通过WHOIS信AOL息查询得知,这些网段分别属于Google、Microsoft和Apple公司.而根据访问次数前20名服务器IP段的汇总归属信息,可得到如表4所示结果.表4访问次数前20名服务器IP段信息统计公司名称访问次数占总访问次数比例累计百分比/%Microsoft(微软)Google(谷歌)Apple(苹果)DROPBOXAKAMAI由此可见,中国教育和科研网访问的国外HT-TPS服务中,最多的是微软、谷歌和苹果.推测原因是这些公司的多个SSL服务具有大量用户,比如微软操作系统的自动升级服务、Hotmail和Live等,谷歌的加密Web搜索、Gmail、Docs、开发和社交应用等,苹果公司的官方应用商店和消息推送等.值得注意的是,前3个公司IP段的SSL访问量占据了整个SSL访问量的近80%,而排名前20的IP段仅来自6个公司,由此可以看出访问的局部性,也印证了美国在互联网中的核心地位.3.2.2自签名证书测量结果由于自签名证书是我们的主要研究对象,因此我们进一步扩展了NetFlow信息采集范围,并根据端口号443提取SSL服务器IP列表,通过主动探测筛选出此类证书的结果.2013年1月30日~2013年2月28日共30天的自签名证书的统计结果如下图2~图4所示.由图2可见,虽然存在较大波动,平均每天的①MaxMind-GeoIP|IP地址位置数据库[EB/OL],http://Page8V1自签名证书服务器访问次数接近800万次,V3自签名证书服务器访问次数从600多万到1000多万次.总体来讲,两者差别不大.由图3中V1、V3自签名证书服务器的数量可以看出,V3数量明显多于V1,前者最大值是后者的4倍左右.但V1版本证书中自签名证书比例很高,平均约65%.由图4可见,国内HTTPS客户端数量相对稳定,访问V1和V3自签名证书服务器的日平均客户端数分别为42万和25万.经过对证书常见属性的统计,得到如下结果:(1)通用名CN(CommonName)证书的通用名作为网站身份的标识,一般应该与服务器域名相符合.由表5可以看出,通用名为空缺、localhost和localhost.localdomain这种隐匿真实身份信息的通用名在自签名证书中大量存在.(2)证书有效期对于大型公司的证书,有效期一般不超过两年,有效期过长将给攻击者充足时间来进行密钥破解.然而,自签名证书的有效期一般较长,在我们的测量结果中,证书有效期最长有7993年.按照PKI诞生时间及RFC规定,证书有效期开始年份值不早于1950年,但我们发现有少量证书有效期起始年份值很小,最早为1692年.同时,过期失效证书大量存在,所有访问中有约29%使用了过期证书.自签名证书有效期年数统计结果(取整)如表6所示.以上有效期的证书,存在隐私安全隐患.排名有效期年数出现次数百分比/%12345累计超过50%的访问中服务器使用了5年及(3)公钥信息主题公钥长度是防止密码破解攻击安全性的保证.2009年12月,编号为RSA-768(768位)的大数也被成功分解,威胁到1024位密钥的安全性.目前推荐使用2048位的公钥密钥.表7是自签名证书公钥算法前5名,结合上面表6证书有效期结果可知,有相当数量的服务器使用有效期长但密钥安全性不足的证书,存在严重密钥安全隐患,用户信息隐私泄露风险巨大.排名算法密钥长度12345(4)常见异常属性汇总由表8可知,V4版本的证书,随意的通用名身份标识、异常的有效期、长度为32字节的序号等异常现象都不遵循RFC,这些事实表明X.509公钥体系实施的不规范状态.Page9名称版本号4通用名空;IP地址有效期过大;负数;起始、终止时序号0;长度过长;特殊值一般为1-20字节整数综合测量结果可知,互联网存在大量HTTPS应用,其中采用自签名证书的现象是较为常见的,且存在很大的隐私安全风险.3.3自签名证书服务行为及隐私泄露隐患分析开发者应该知道自签名证书安全性差,且明白浏览器会弹出安全警告提示甚至终止连接带来不好的用户体验,为什么还要采用自签名证书?这种网络行为背后的动机又是什么呢?我们分析如下:(1)经济性.低成本,安装开源的OPENSSL并通过简单命令即可生成自签名证书,无需向商业公司支付任何购买和服务费用,对于个人和小型机构非常方便,因此牺牲安全性换来便利性.(2)便利性.易部署,可以批量生成证书,一旦出现证书丢失或损坏等问题可以快速改变证书并迁移服务.(3)匿名性.通过隐匿或者伪造服务器身份信息实现匿名性,比如僵尸网络、木马等的HTTPS加密控制通道.根据文献[1]的测量结果,自签名证书中有97.78%的CN域与主机名不符.(4)自身安全考虑.可信的国外第3方证书认证机构(公司)不一定永远不做出欺骗行为,尤其是在国家安全的名义之下.出于安全考虑,国内小型机构或个人较多直接采用自签名证书.一些机构通过公开自己的根CA证书,并部署由自己根CA颁发的证书的方式来实施公钥安全设施.这种情况并未直接采用自签名证书,与一般意义的合法证书区别在于其根证书并未内置在浏览器中,通过浏览器HTTPS访问此类网站同样会弹出安全警告提示.而一个典型例子就是铁路客户服务网站12306.cn.根据自签名证书的测量结果,HTTPS服务行为相当不规范.大量的缺失、错误和异常属性表明其部署相当混乱,安全状况极差.这种特定的服务行为自身给用户带来的隐私安全威胁如下:(1)无法察觉的中间人攻击.中间人攻击,即MITM(ManInTheMiddle)攻击,一般是指恶意攻击者(称为中间人)通过技术手段作为通信中转窥探甚至篡改客户端和服务器之间通信内容的行为.图5是其基本示意图.理论上讲,SSL/TLS提供的身份认证机制可以抵御中间人攻击,中间人无法假冒服务器欺骗客户端.当用户使用浏览器访问使用合法的X.509证书的HTTPS服务器时,访问页面可正常打开,且可以看到浏览器的安全锁标识;反之,当访问使用有问题证书的网站时,则会弹出安全警告,而不直接打开访问网页.通过警告页面可以看到详细原因,比如证书颁发者不被信任,有效期过期,证书所有者与访问域名不符等.当用户访问银行等网站时被劫持,浏览器会弹出安全警告,此时用户就知道很可能受到了中间人攻击,及早终止访问,防止隐私泄露.但是,当用户访问使用自签名证书的服务器时,无法知道是否真正受到了中间人攻击,因为网站自身部署了不安全的X.509证书,无论用户是否被攻击者劫持,都是会弹出警告.在这种情况下,一般用户都会选择忽略这些警告,不知不觉中泄漏了个人隐私,比如个人账号密码、访问的页面和电子邮件内容.具备安全知识的用户可能会查看证书信息来确认,然而由于自签名证书的随意性,攻击者很容易伪造一个基本一模一样的证书,让用户防不胜防.(2)不安全的证书属性带来的隐私威胁.一般而言,只有可信任根CA证书的有效期较长(20或30年),如果有效期过短将导致频繁的用户证书更换.这些根证书都采用高强度的安全参数,防止私钥在其有效期内被攻击者破解,从而保证部署其颁发证书的服务器安全.对于一般商用证书,有效期一般为1~2年.然而,从对自签名证书的测量结果来看,去重后的自签名证书中有51.8%的证书有效期在5年以上且公钥长度不大于1024位,更令人震惊的是有效期10年以上且公钥长度不大于1024位的证书比例高达47.8%.这样的证书容易受到有一定计算资源的攻击者的暴力破解,访问这些服务器所有用户面临严重的信息泄露问题.Page104基于证书的应用类型泄露研究基于测量得到的统计数据,我们进一步提出了基于自签名证书的SSL服务分类方法,对大部分同类服务进行了有效聚类,从而从服务器角度证明了自签名证书存在泄露服务类别的隐私安全风险.即在服务器身份标识不可信、不全面、匿名化和模糊化情况下,仍然可以从统计规律上找到识别其应用服务类别的方法.访问此类加密服务的用户面临访问应用类型泄露的隐私威胁.4.1基于证书的应用服务类型聚类我们采用了两种方法对服务器自签名证书进行挖掘和分析,一种是基于Jaccard’scoefficient[21]的文本相似度度量,另一种是基于改进K-Means的文本属性聚类方法.4.1.1特征选取和数据标注我们采用的特征集合为8个证书属性的集合①:{版本,序号,有效期起始年月,有效期天数,通用名,签名算法,公钥算法,公钥长度},其中标识证书身份信息的主要有序号、通用名(颁发者和持有者信息),而其它属性主要表示其安全性,这些属性的集合可以较为完整地衡量一个证书.对HTTPS服务器应用类型的标注,采用了多维护信息综合判定方法、通过WHOIS注册信息、多个DNS服务器的域名查询结果、IP地理位置、https访问响应及域名实体信息搜索等给出可信的结果.根据文献[22]中对HTTPWeb应用的类别并结合HTTPS自身的服务特点,我们研究的加密Web应用类别为普通HTTPS服务器、邮件服务器、控制管理服务器和视频服务器等.4.1.2相似度度量方法Jaccard系数通常用于计算个体之间的相似性,比如文本相似度、物种多样性相似指数等,计算公式为Sim(X;Y)=|X∩Y|公共(即交集)元素个数,分母为两个集合的并集中元素的个数.在我们的实验中,X与Y分别表示两个X.509自签名证书,X,Y的元素是证书的属性.为了方便,选取了常见的公共属性进行比较,即X与Y属性个数相同,均为n=8,且属性一一对应.同时,我们将证书的各个属性进行了字符串化.两个证书的相似度计算方法如下:设X=[X1,X2,…,Xn],Y=[Y1,Y2,…,Yn],其中Xi(i∈[1,n])表示X的一个属性,Yj(j∈[1,n])表示Y的一个属性,且当i=j时,Xi与Yj表示同一属性,比如证书版本.为方便描述,引入相似度向量犛.定义1.相似度向量犛为X与Y的相似度,犛=[S1,S2,…,Sn],其中X=[X1,X2,…,Xn],Y=[Y1,Y2,…,Yn],Si表示Xi与Yi的字符串相似度系数,|S|的计算公式为|S|=∑nSi计算方法如下:(1)如果Xi=Yi,Si=1;(2)如果Xi≠Yi,则按如下方法计算Si.Si计算方法基于广泛应用的字符串相似性度量方法Levenshtein距离②,此处简记为Levens(Xi,Yi).设Xi,Yi的长度分别为Lx,Ly,两者较大者记为max{Lx,Ly},则Si=1-Levens(Xi,Yi)Levens(Xi,Yi)∈[0,max{Lx,Ly}].显然,字符串之间的相似度随着距离的增大而降低.此方法可以保证两个字符串在没有公共字符时Si值为0,在两字符串相同时Si值为1,且满足Si∈[0,1].通过计算各个Si得到|S|,即Jaccard系数计算公式中的分子|X∩Y|=|S|.记n个不同Si中值为1(重合元素)的个数为m(mn),则公式中分母为|X∪Y|=m+2(n-m)=2n-m,从而得到最终计算公式为通过设定临界阈值R(0Rn),然后根据两个证书X与Y之间的相似度Sim(X;Y)来判断两个服务器是否提供同类服务,即如果Sim(X;Y)R,则X与Y为同一类别服务;否则,X与Y不是同类别加密应用服务.通过调整阈值取值进行实验来获取最优结果.4.1.3K-means聚类方法K-Means是数据挖掘中常用的一种简单的无监督学习算法,适合对无标注数据集合进行基于样本距离的聚类.相对于分类算法,聚类具有不依赖预①②Page11定义的类和类标号的训练实例等优势.我们使用Weka平台①提供的SimpleKmeans算法以及自己用Python实现的K-Means算法对获得的全部32.55万个不同自签名证书进行了聚类,希望从无监督学习的角度找出证书内在自然规律性.采用自己实现的K-means算法是因为Weka提供的k-means采用的距离度量方法只能为欧式距离,不适合对字符串度量,且可能因某一个维度数值差距过大导致总体距离过大,无法体现多个属性的综合效果.需要说明的是,由于对整个数据集标注很耗时,且标注存在主观性和不确定性,我们选用了无监督算法而不是有监督算法开展实验.选择K-Means算法的另一原因是其简单实用.我们的方法采用了自定义的距离度量方法,充分考虑了证书各个属性的均衡性,针对数值型属性和字符串型属性分别采用各自的距离计算方法(欧式距离和编辑距离),并将两个证书每个分量的距离Di取值范围归一化为Di∈[0,1],避免了某个属性距离较大导致的整体距离偏差.最终的距离D计算公式为算法的一个难点是依靠均值获得每一轮循环的新质心.由于通用名、签名算法等属性是字符串,字符串的平均值难以衡量,依靠类似算数平均的方法得到的新字符串可能和任何一个字符串都有较大距离.为了解决这一问题,我们首先计算出5个数值型属性的平均值,得到新质心的5个属性,然后从对应簇所有样本中寻找与新质心的这5个已知属性距离最近的样本为属性完整的新质心.4.2实验结果4.2.1相同证书聚合经过我们的实验发现,即使很简单的方法就可以得到一些有意思的结果,而这些结果是通过IP域名解析和流统计属性等手段难以获得的.比如,运用相似度度量方法、保留IP地址标签,取阈值R=8,即仅对相同证书进行合并归类时,我们就成功发现了多个同类服务,表9举出几个例子.序号1通用名为localhost.localdomain;版本3;序号为0,有效期365天;2通用名为空;颁发日期为2010年2月;序号为8字节的特定数3通用名为xxx.info根据相同证书合并归类结果,结合每个类别中IP地址集合的地址熵(即IP地址的离散度),可以有效推测出该类别服务的类型.一般来说,较为公开的服务IP地址一般具有较高的集中度(一个或几个段,且每个段内的IP数量较多),而匿名性较强的服务,则往往表现出较强IP地址分布离散度.比如表9的结果,我们发现其中第3个例子IP地址离散度很高,经确认是代理服务器.4.2.2相似证书聚类由于Weka的K-means只能通过计算欧式距离和曼哈顿距离来聚类,因此对字符串的距离度量不太好.即使在这种情况下,通过K-means聚类算法对证书进行聚类的结果表明,自签名证书集合内部存在明显的相似性.我们对K取不同值(2K15)进行试验,观察采用相似度度量,Weka的SimpleKmeans和自定义距离度量的K-means算法的聚类结果.当K=5时,且采用我们距离度量方法的K-means方法,结果最好,此时同类别的证书能够被很好的聚类.K值过小,区分度太低;K值过大,同类证书明显被过度拆分到多个簇中.K=5时的自定义距离度量方法的一次聚类总体结果见表10.由表10可直观看出,5个质心各个属性彼此差距很大,区分度较强.从我们对聚类结果的详细分析看出,同类别的证书能够很好地被聚类同一个簇中.K<5时,区分度不够强,而K=6,两个将近的类已被分开.表10犓=5时自定义距离度量犓-means聚类结果类别[version:‘3’,serial:‘3F3751F80977BB924D03FCABECD9E200’,NotBefore:‘201010’,valid_days:‘7’,CN:‘“Webmail.sisgraph.com.br”’,pubkey:‘RSA’,keylen:‘1024’,sig_alg:‘sha1WithRSA’][version:‘3’,serial:‘02’,NotBefore:‘200301’,valid_days:‘3650’,CN:‘“00:16:b6:87:ea:3e”’,pubkey:‘RSA’,keylen:‘1024’,sig_alg:‘sha1WithRSAEncryption’][version:‘1’,serial:‘4F87DAA1’,NotBefore:‘201204’,valid_days:‘365’,CN:‘“plesk”’,pubkey:‘RSA’,keylen:‘2048’,sig_alg:‘sha1WithRSAEncryption’][‘3’,‘FDF9389F38579658’,‘197001’,‘24852’,‘“cbeckmann.dyndns.org”’,‘RSA’,‘1024’,‘sha1WithRSAEncryption’][‘3’,‘51310603’,‘201212’,‘1155’,‘“firewareWebca”’,‘RSA’,‘2048’,‘sha1WithRSAEncryption’]12345①Weka—MachineLearningSoftwareinJava[EB/OL],ht-tp://sourceforge.net/projects/weka/.2013-04-15Page12我们对部分实验数据进行人工分析,虽然从应用上讲,并非所有同类别的服务(比如Webmail)都能被聚类到一起(证书差异较大必然不能),然而,同一类别的地理位置较远(IP地址分布),但应用内容相近的服务(比如同一公司的游戏服务,或同一个服务商的网络认证系统等)能够非常有效地被聚类到一起,准确率在95%以上.我们发现,部署相似证书的服务器往往提供着相似的服务.4.2.3自签名证书的持续性验证自签名证书的一个显著特征是构造的随意性,表112013年2月和6月自签名证书服务器结果比较日平均结果/月份V1自签名服务器访问次数V1自签名服务器IP数V3自签名服务器访问次数V3自签名服务器IP数2013年2月2013年6月增长幅度/%此处数据变化大很可能是因为2月份由于假期等原因访问量较少.(2)服务器IP重合度高.重合度采用类似于上述Jaccard系数的定义进行计算,只不过分母不是两个集合的并集中元素个数而是较早时间点的集合中元素的个数.为了观察总体趋势,我们将2月份和6月份的自签名证书服务器IP分别合并去重后计算,其中2月份总IP数为854.15万,6月份总IP数为1033万.结果表明,重合IP数量为349.20万,与2月份和6月份IP重合度分别为40.9%和33.8%.由此可见,相隔4个月仍保持高重合度,绝对重合IP数在百万数量级.(3)证书信息重合度通过对比证书信息,我们发现重合IP证书保持了很强的一致性.而且如果一个服务器不断更换证书,但总是自签名证书,那么持续性仍然成立.而对2月份非重合IP的抽样探测表明,这些服务器443端口关闭(TCP握手失败),要么仍采用自签名证书(只是近期没有访问).总之,自签名证书的部署是普遍的,短期使用现象大量存在,但我们更倾向于认为此现象表明了特定服务行为的随意性和短暂性特征.4.2.4与已有隐私发现研究结果对比比,如表12所示.通过对比可知,已有隐私发现工作一般是细粒度的实验性研究,对用户通过加密、匿名手段访问的特定网站进行识别,数据集很小,普适性较差,目前看实际应用价值有限.我们的工作基于大数据集合,满足实时性要求,更具实际应用价值,但目前是粗粒度,对一些细节还需要进一步研究.我们选取了几个具有代表性的实验结果进行对因此其动态变化肯定存在.自签名证书究竟是长期使用,还是仅仅在加密服务部署的测试阶段临时使用,对于我们的研究结果十分重要.借助于后续测量结果,我们对2013年2月和6月两个月份的自签名证书测量结果进行对比,有如下发现.(1)数量上呈增长趋势.2013年2月和6月两个月份的自签名证书服务器访问次数及IP数量比较结果如表11所示.通过2月份和6月份结果对比可知,采用自签名证书的HTTPS服务数量有明显上升趋势.方法文献[16]各类型加密HTTP,文献[17]HTTPSwebmail文献[19]SSH,Tor,HTTPOS及本文方法HTTPS5结果分析实验结果表明,我们的方法可以相当有效地实现加密SSL服务发现和服务分类,从而表明了采用自签名证书的HTTPS服务存在用户访问应用类别隐私泄露的风险.主要结论如下:(1)由于批量生成证书、批量部署等原因,同一服务的服务器证书往往具有很强的相似性,具体表现为:证书颁发时间相近、序列号长度基本一致,在证书版本、签名算法和密钥长度等方面表现出一致性,证书的通用名模式表现出相似性.(2)属性相似的X.509自签名证书往往对应着相同或相近的服务类别.(3)通过X.509证书可以有效进行服务发现和粗分类,即使无法确认服务的类型也可以进行同类服务的识别.对于采用SSL的新型加密应用的发现Page13具有重要意义.(4)访问采用自签名证书的HTTPS加密服务的用户由于服务器泄露的信息而存在行为泄露隐私风险,即用户访问的应用内容的类型可能被监测者推测出来.6结束语本文从SSL的X.509自签名证书测量入手,首先通过测量结果数据分析对自签名证书类HTTPS服务的隐私安全隐患进行了分析,然后通过进一步聚类挖掘,对SSL服务中部署X.509自签名证书的这一类型应用存在的用户隐私威胁进行了较为深入的研究,主要贡献如下:(1)本研究基于对SSL服务的大范围真实测量结果,不同于一般实验环境进行的模型验证类研究.依据数据对自签名证书服务行为的动机、持续性及隐私泄露隐患进行了较为深入的分析,之前尚未见到此方面的研究.(2)本文的测量工作采用主被动结合的方法,以被动获取的真实连接信息为基础,进行有约束IP地址范围的主动探测,时间短,效率高,成功率高,避免了大面积主动探测耗时太长且容易受到环境等因素影响的缺点.(3)本文从服务器端X.509自签名证书出发提取加密Web服务行为特征,与本领域其他研究利用流量统计属性的研究相比,采用了一个新的角度,且可以忽略由于客户端行为差异带来的影响.(4)对加密Web服务泄漏用户访问的应用类型的研究基于对测量结果中证书属性关联分析和相似度度量,不依赖证书本身的身份标识(比如通用名中的mail、proxy和video等关键字),对加密服务中的典型应用发现十分有效,从而揭示出自签名证书暴露的用户网络行为隐私问题.(5)通过对已有海量数据的学习,本方法可应用在实时环境下,能在加密Web应用网络连接的早期就进行类别预测,与基于流统计属性的方法相比能更早进行结果判断,尽早尽快满足要求.本方法的局限性及应对方法:自签名证书的随意构造性,为恶意应用进行对抗提供了便利.特定恶意软件(如APT)可能采用伪装混淆来躲避安全审查或者误导安全软件.对于此类问题,我们认为需要引入基于历史数据的对抗,从更长的时间段来挖掘出异常行为.本文HTTPS行为测量研究的一个方面,可以扩展深入,我们进一步的研究计划如下:(1)SSL服务类型实时判定.通过已有知识库和在线学习更新,对特定SSL服务实时准确识别.(2)针对SSL服务常用端口(如443、993、995)的非SSL服务的分析,通过简单的熵值及浅度包检测来发现和识别隐蔽信道,比如僵尸网络和木马信道.本文仅侧重于自签名证书的相关研究,下一步可以扩展到全部类型SSL证书的分析.由于采用SSL的服务有多种,而相应服务未必按照标准端口部署,因此更为宽泛端口范围的测量是必要的,也是其它SSL测量工作所没有做的.同时,将SSL证书的属性与其它可观察到的统计属性结合起来从服务器和客户端的网络安全行为来研究加密Web服务隐私问题可能会得到更好结果.
