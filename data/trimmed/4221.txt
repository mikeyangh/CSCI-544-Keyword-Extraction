Page1基于虚拟图像金字塔序列融合的快速图像增强算法戴霞1)李辉2)杨红雨2)张军3)1)(西华大学数学与计算机学院成都610039)2)(四川大学计算机学院图形图像研究所成都610064)3)(上海交通大学航空航天学院上海200240)摘要针对图像增强算法的快速计算问题,文中提出一种“全局尝试、局部精炼”的图像增强策略,利用虚拟图像金字塔序列融合方法构建出一种具有高度可扩展性和线性时间复杂度的图像增强算法框架.在此框架下,输入图像先经过各种全局增强重映射函数的处理而形成备选图像序列,再依据像素级保边缘图像融合规则从该图像序列中精选出有效像素信息,形成最终的图像增强结果.为避免光环效应,所有图像融合计算都在输入图像的拉普拉斯金字塔分解域上进行.通过对局部拉普拉斯滤波算法进行加速的实际应用表明,文中提出算法框架可导出一种快速保边缘图像增强算法,其处理效果与原局部拉普拉斯滤波算法极为相似,但计算速度提高了两个数量级.关键词保边缘图像处理;图像金字塔;序列图像融合;函数逼近1引言图像增强算法是信号和图像处理领域里最重要的研究课题之一,在实际工程中具有广泛的应用.近年来,保边缘图像增强算法更成为了许多计算机视觉、图像理解方法的基石,得到广泛关注.包括图像动态范围压缩[1-4]、图像滤波[5-9]、图像去噪[10-11]、图像风格化[7,12-18]、视频抽象[19]、图像去雾[20-21]、数字抠图[22]、图像复原[15]等诸多热点问题都将受益于一个稳健、高效的保边缘图像增强算法.双向滤波器算法[23](BilateralFilter)使用空间可变的加权函数在高于信号维数的空间对信号进行加权平均处理,其计算过程无需迭代,滤波器参数意义明显,具有显著的保边缘特性,成为了保边缘图像增强算法设计的最重要思想来源之一.然而,在Buades等人[24]指出双向滤波器可能产生伪轮廓的缺点后,各类试图改进双向滤波器边界响应[13,25-26]和计算效率[16,27-28]的保边缘图像滤波器被相继提出.由于人眼视觉系统[29]更偏向于对图像梯度的响应,且具有较强的多尺度效应[30],大量在梯度域设计滤波器[3,13-14]并采用多尺度分解[1-2,12,15,31-35]的算法在近年来大量涌现.另外,局部直方图变换[36]、全局优化[37]等方法也取得良好的保边缘图像增强效果.更加详细的关于保边缘图像增强算法的研究工作回顾可参考文献[13-14,34].图像的拉普拉斯金字塔变换[38]已经为广大工程人员所熟知,其计算过程仅涉及已经存在大量程序库的图像缩放操作,是图像增强算法领域里非常优秀的变换工具之一.Dippel等人[31]认为拉普拉斯金字塔变换比小波变换更加适合大尺度图像结构的增强.而Paris等人[39]的工作也打破了前人对拉普拉斯金字塔图像处理会产生光环现象的一贯认识[2,34],取得了良好的保边缘图像滤波效果.这些因素使本文作者坚信,基于拉普拉斯金字塔变换的图像滤波器设计具有达到Bhat等人[14]对滤波器设计要求的潜力.然而,Paris等人提出的局部拉普拉斯滤波器(LocalLaplacianFilter,LLF)算法的时间复杂度是非线性的O(NlogN),其对高分辨率图像的处理速度远远低于那些具有线性时间复杂度的保边缘图像增强算法[13],无法满足Bhat等人对滤波器设计的计算速度要求.同时,Paris等人提出的LLF算法仅针对单幅图像,其对不同应用问题的适应性只能通目前,已有多种算法潜在的应用了“全局尝试、过调节重映射函数来实现,可扩展性较低.本文提出一种“全局尝试、局部精炼”的图像增强策略,建立完全满足Bhat等人对滤波器设计要求的基于虚拟图像金塔子序列(VirtualImagePyramidSequence,VIPS)融合的图像增强算法框架.在该框架下,本文通过对LLF算法中重映射函数的低维线性化逼近,成功构建出一种LLF算法的快速近似算法.该算法可在线性时间复杂度O(N)内产生与原LLF算法极为接近的结果,大大提高其计算速度的竞争力.1.1相关工作局部精选”的策略.Fattal等人[33]提出基于多幅不同光照条件下成像的图像序列进行图像细节增强的方法.该方法引入固定视角下同一场景在不同方向光源照射下成像的一组图像序列作为输入条件,通过双向滤波器对图像序列进行多尺度分解,并将图像序列里分解后的显著细节特征系数重组成输出图像的多分辨金字塔,最后从该图像金字塔中重建出最终的输出图像.不同光源下成像的图像序列对应于对场景图像进行的一系列全局变换,多尺度分解后的图像细节提取相当于对图像序列的局部自适应精选.由于其算法采用原始双向滤波算法作为图像多尺度分解的工具,其计算时间复杂度为O(N2logN),计算效率不具优势.为提高图像增强算法的计算效率和鲁棒性,Fattal等人[15]提出一种基于数据降维思想的图像低维线性逼近方法.该方法通过双向滤波器和数据聚类运算,在多个尺度空间上建立原始输入图像的近似逼近图像序列.将输入图像向由该基图像序列张成的低维线性子空间投影后,可得到对输入图像的一个具有较高精度的低维逼近.这样,当其它图像增强算法通过作用在这些基图像上而达到间接增强原始输入图像的效果时,可得到更高的计算效率和保边缘特性.然而,该方法对输入图像的低维线性逼近自身涉及求解一个大型稀疏线性方程组,其对图像增强算法的计算效率提升空间有限.Wu[25]提出利用线性规划对图像对比度进行增强的方法,将图像对比度增益和色调保持度作为目标函数,在像素值改变区间限制的约束条件下形成线性规划问题,使用单纯形算法进行求解.线性规划问题的可行域是凸集,单纯形求解策略本质上是穷举该凸集的所有角点来找到最优解.基于此分析,Page3Wu的方法中所涉及线性规划的基础可行解可被视为待选的虚拟对比度增强图像序列,其最终图像增强结果是从该图像序列中精炼出来的.从这个意义上说,Wu的方法是隐式的使用了“全局尝试、局部精选”的策略.Sunkavalli等人[12]针对图像混合问题提出了多尺度图像调和方法,将待混合的两幅输入图像同步的进行多分辨率分解,形成两个待混合候选图像序列.图像混合是通过灰度直方图匹配的形式从候选图像序列中挑选出来的混合图像序列,通过求解一个大型稀疏线性方程组,该混合图像序列可以重建为最终两幅输入图像的混合结果.从实验结果上,该方法在较少人为干预条件下取得了较为优秀的混合视觉效果.Yang等人[28]利用支持向量机原理给出了一个双向滤波器的加速算法.该方法将图像滤波算法表述为向量映射的线性逼近过程,即滤波后的图像向量是由输入图像自身及其幂次向量和经由高斯低通滤波后的输入图像及其幂次所组成的向量组的线性组合.支持向量机的引入是为了从图像训练库中学习出一组合适的线性组合系数,用于拟合双向滤波器的输出效果.该方法本质上是对图像进行了一系列全局映射(自身幂次及自身幂次的低通滤波输出)而形成一个基图像序列,算法输出结果是这个基图像序列的局部融合的结果.由于该方法的局部融合准则是由机器学习过程建立的,其图像增强效果较为依赖训练集的质量.Paris等人[39]提出的LLF算法同样隐式的使用了“全局尝试、局部精选”的策略.在确定每个输出图像拉普拉斯金字塔系数时,该方法都对原输入图像进行一次全局映射.由于这个过程形成了数量可观的备选图像序列,原始LLF算法具有O(N2)时间复杂度.虽然Paris等人通过减小每次全局映射运算时所涉及的图像区域而提高计算效率,其改进后的LLF算法时间复杂度仍为O(NlogN),并不具有计算效率优势.Aubry等人①提出利用亚采样技术加速LLF方法,其计算方式与本文提出的图像算法框架较为接近,且有相同的计算性能.该方法通过对映射函数的亚采样来逼近原始LLF,可视为本文提出的图像增强算法框架下的一个具体实现.本文提出的快速图像增强算法框架显式地使用“全局尝试、局部精选”策略,使在此框架下构造出的图像增强算法具有线性时间复杂度O(N),并且具有简单、易于编程、无人工痕迹的优势.2基于VIPS融合的图像增强算法图像增强算法通过特定方式调整图像中每个像素的像素值,并尽量使调整后的图像具有较少的人工痕迹.本节利用“全局尝试、局部精选”策略在金字塔图像变换的基础上,提出一种具有线性时间复杂度的快速图像增强算法框架.2.1原始局部拉普拉斯滤波算法Paris等人[39]提出的局部拉普拉斯滤波算法根据每个像素位置自身的像素值信息对输入图像的一个局部领域进行变换,并将变换结果以拉普拉斯金字塔系数的形式保存.最终的输出图像增强结果是由这些已经被计算出的多尺度分解系数进行重建.本质上,局部拉普拉斯滤波算法是一个在频率域进行逐点局部变换的图像滤波算法.虽然原始LLF算法流程简单,易于编程实现,但其对输出图像拉普拉斯金字塔中每个系数的计算都需要对原图像进行一次非线性映射和金字塔分解运算,其计算速度并不具有优势,且存在大量冗余计算.在原始LLF算法中,输出图像拉普拉斯金字塔{Ll}nl=0的第l层、(u,v)处的系数值Ll(u,v)是根据输入图像犐的高斯金字塔相应位置系数值对原图像犐进行点变换后,再重新进行拉普拉斯金字塔分解后的新金字塔相应位置的系数值:Ll(u,v)=[Ll(f(犐;Gl(u,v)))](u,v)(1)其中f是Paris设计的根据图像高斯金字塔相应位置系数Gl(u,v)和阈值σf>0对图像边界和细节有不同相应的点变换函数:其中,rd(x)和re(x)分别为细节映射函数和边缘映射函数:rd(x;θ)=θ+sign(x-θ)σf(|x-θ|/σf)α,re(x;θ)=θ+sign(x-θ)[β(|x-θ|-σf)+σf](3)由式(2)、(3)可以看到,点变换函数f本质上是一个带有可调参数θ的非线性函数,其内部固定①AubryM,ParisS,HasinoffSW,etal.FastandRobustPage4参数组(σf,α,β)可以根据不同领域对图像增强效果的差异进行人为制定.Paris将函数的可调参数设置成θ=Gl(u,v),使该方法具有极强的局部特性:每个输出图像拉普拉斯金字塔{Ll}n(u,v)处的系数值都是根据该位置自身高斯金字塔系数值而对图像犐进行全局变换得到的.2.2VIPS融合的理论描述方程(1)的计算复杂度主要来源于非线性局部映射函数f(x;θ)中参数θ的取值与局部图像信息相关,造成每个像素位置的计算都需要重新计算图像金字塔.考虑到数字图像的像素值总是在有限的数集上,可调参数θ值一般分布在一维有限区间(对Lum进行增强)或有限体积(对RGB分量进行增强)上.这使寻找若干全局映射函数的局部线性组合来近似非线性局部映射函数f(x;θ)成为可能.令f(x;θ)≈∑KLl(u,v)=[Ll(f(犐;Gl(u,v)))](u,v)写成:利用金字塔图像变换的线性特性,方程(4)可看成对虚拟序列图像{犐k=fk(犐)}K拉斯金字塔分解的图像融合算法:其中融合系数wk是关于图像高斯金字塔分解的函数,可视为最优融合准则:对于序列图像,可以使用更加一般的最优融合准则,通过综合序列图像的高斯金字塔分解系数计算最优融合准则:2.3基于VIPS融合的图像增强算法方程(5)、(7)共同决定的图像融合算法是一种具有一般性的基于虚拟金字塔序列融合(VIPS)的快速图像增强算法框架,可适应单幅或序列图像增强问题,可嵌入不同的虚拟再映射函数和图像融合准则,且具有线性时间复杂度的高效计算过程,具有更好的可扩展性和更高的计算效率.本文提出的具有O(N)时间复杂度的图像增强框架的详细描述如下.算法1.基于VIPS算法的图像增强框架.输入:图像犐和重映射函数fk(x)(或者图像序列输出:图像增强结果犐步骤:if(单幅图像I)endiffork=0:Kendforforall(k,l)endfor3应用实例本节从原始LLF算法中非线性映射函数的分段线性逼近入手,给出本文提出的基于VIPS的快速图像增强算法框架对原始LLF算法的具体应用,形成一个原始LLF算法的快速近似算法.该算法与Aubry等人利用亚采样技术加速LLF方法本质上是一致的,但具有更加清晰的算法流程和更好的可扩展性(可选择更多种类的数值逼近函数).设输入图像犐的高斯金字塔分解{Gl}n有系数的最大、最小值分别为θmin和θmax,则固定一个离散采样个数K后,对θ是一维变量的情况可形成含有K个非线性全局变换函数的一维序列:条件连续的,即δ>0使得由于f(x;θ)对于可调参数θ是满足李普希兹∫b则函数序列{fk(x)}Kf(x;θ)的,故融合准则为Page5wk=opt(Gl(犐0),Gl(犐1)…Gl(犐K))烄=烅烆且当K→时,∑K对RGB分量进行增强的情况将使θ成为三维变量,即θ=(θR,θG,θB)T.对θ离散化将在3个分量上同时进行,形成含有K3个非线性函数族的三维阵列.对快速LLF计算过程的直观表述见图1,输入图像经过所有可能的全局变换(由离散化采样的参数θ控制)形成一个虚拟图像备选序列,再对该序列的每一帧图像进行拉普拉斯金字塔分解,并根据源图像的高斯金字塔分解系数从序列图像的拉普拉斯金字塔分解系数集合中逐个像素地提取有效信息,从而得到输出图像的拉普拉斯金字塔分解系数.这个过程是显式的采用“全局变换,局部精选”的策略,以牺牲存储空间为代价,换取计算过程的高度并行化和时间复杂度的线性化.4计算结果及讨论本节给出对快速LLF算法性能测试的若干实验来证明在本文VIPS融合算法框架下的快速LLF算法可以产生与原始LLF算法极为贴近的图像增强效果,但其计算效率被显著提高.4.1实验环境所有实验结果都在一个搭载有2.4GHzAMDPhenomCPU的PC平台上得到,实验编程环境为Matlab2011b,前人算法的程序代码皆为相关作者公布的实验测试程序.性能测试时运行时间统计采用tic/toc命令自动计时,其精度为毫秒级.4.2快速LLF算法对原始LLF滤波器逼近度的检验快速LLF算法对原始LLF滤波器线性化逼近,其逼近程度受到采样点个数K和重映射函数复杂程度共同影响.本小节用对图像细节调整的实验测试快速LLF算法对原始LLF算法的逼近程度,并给出逼近度与计算性能之间关系的实验.4.2.1细节调整对两个常见实验输入图像(图2),图3、图4和图5给出了在不同重映射方式和彩色图像处理方式下快速LLF对原始LLF算法的逼近程度,并对采样点个数、重映射函数非线性程度对逼近误差和计算性能的映像做了对比分析.在图3中,Lum标记表示图像增强处理是在亮度单通道下进行的,其快速LLF算法是对一维区间的离散化采样(8),采样点个数为K=64;RGB标记表示图像增强处理是在RGB三通道下进行的,其快速LLF算法是对三维区域的离散化采样,采样点个数为K3=512.α表示式(3)的指数,其值偏离1的程度与重映射函数的非线性度成反比.实验结果图3显示,快速LLF对原始LLF算法的最大平均逼近误差不超过7个灰度级,远低于人眼能感知的程度.而运行效率测试结果表1显示,快速LLF最大可将原始LLF算法的速度提高两个数量级,具有显著的加速特性.图3实验结果还显示出,快速LLF对图像细节降低情况的逼近误差远小于对细节提升情况,这是重映射函数非线性程度差Page6图3快速LLF及原始LLF滤波器对Flower图像的细节调整的计算结果图4采样数K对快速LLF算法逼近程度影响的直观效果异引起的;在单通道上的逼近误差远小于在多通道上的逼近误差,这是采样点个数差异引起的.表1本文快速LLF对原始LLF逼近误差及加速比数据图3最大差异(i)Lum846.9577393.62.4164.0(j)RGB4229.6377553.151.410.8(k)Lum165.5835391.62.1186.5(l)RGB843.3686542.951.310.6图4和图5给出了固定重映射函数非线性特性,不同采样点数对快速LLF算法逼近误差影响的实验结果.图4实验结果显示,采样点不足会引起快速LLF算法计算结果出现视觉上的伪轮廓,并在细节提升情况下更为明显.图5实验结果给出定量化的采样点数与逼近误差间的关系图:随着采样点个数增加,快速LLF的逼近误差快速减小,而计算性能缓慢的呈现线性降低.从实验经验上看,64K128的采样策略是计算性能和逼近误差之间一个较为合适的折衷.图5采样数K对快速LLF逼近误差及计算性能的影响4.3快速LLF算法计算效率对比分析计算效率实验图6的实际测试数据表明,在本文VIPS融合算法框架下的快速LLF算法的计算时间复杂度是输入图像中像素个数的线性函数,在计算性能上具有较为突出的优势.而采样点个数K对本文算法的影响也是可控的,可根据实际计算精Page7度的需要进行调节.5结论本文通过提出“全局尝试、局部精炼”的图像增强策略,成功地提出一种具有高扩展性和计算效率的一般性图像增强算法框架,可适应包括单幅或序列图像增强问题的广泛应用领域.在此算法框架下,本文引入线性函数子空间逼近LLF算法中重映射函数,使原LLF算法中频繁进行的图像局部重映射及金字塔分解过程简化成少量输入图像的全局重映射及拉普拉斯金字塔分解,大大降低了原LLF算法的时间复杂度,达到加速目的.快速LLF算法继承了原LLF算法的所有优势,可以产生高质量的具有保边缘的图像增强效果.与其它保边缘图像增强算法相比,本文算法可在保持较高计算效率的前提下,产生高质量的图像增强效果,并具有更加宽的可扩展性.由于本文算法的核心计算可完全表述为对图像像素值矩阵的简单运算(加法和数乘),可使用现有基本线性代数计算程序库实现CPU指令优化或GPU并行计算功能,具有突出的易编程实现的优势.最后,本文提出的算法框架具有较高扩展性,作者将在后续工作中应用此算法框架到图像去雾、高动态范围图像色调映射等领域,期望能构建出更多优秀图像增强技术的快速逼近算法.
