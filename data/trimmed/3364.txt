Page1无结构覆盖网络中面向搜索范围最小化的副本分布冯国富1)李文中2)张金城1)陆桑璐2)陈道蓄2)1)(南京审计学院信息科学学院南京210029)2)(南京大学软件新技术国家重点实验室南京210093)摘要复制技术常用于无结构覆盖网络,用以提高系统性能.在复制技术中有一个基础性问题经常被论及:给定访问频率和存储空间,系统该为每个数据保留多少副本?平方根分布在过去通常被认为最优,即当每个数据的副本数量正比于数据大小和访问频率的平方根时,系统在搜索过程中转发的消息数量最少.但文中工作表明,该观点并非总是正确的.首先,我们认为,为了达到理论最优,每个数据的副本数量应该反比于数据大小的平方根.其次,在现实环境中,当TTL较小或副本密度较小时,平方根分布并非最优.文中首先对问题进行形式化描述和建模,给出理论答案,然后用模拟实验验证了提出的观点,并分析了文中结论与平方根分布不一致的原因.尽管文中结论是以P2P背景得出的,但它同样适用于那些以应用层无结构覆盖网络管理资源的分布式系统.关键词无结构覆盖网络;副本数量分布;搜索范围;访问频率;数据大小1引言作为一种分布式资源管理方式,无结构覆盖网络广泛应用于今天基于Internet的分布式应用.在全分布无结构覆盖网络中,每个节点连接几个邻居,形成AdHoc网络.每个节点可以通过邻居转发查询消息,实现对目标资源的一步步遍历查找.由于覆盖网络结构与数据内容无关,一个节点并不清楚目标资源在哪个方向,并不清楚哪个邻居更容易命中查询.为此,复制技术被广泛应用于无结构覆盖网络,用以改善盲目搜索系统的性能.关于无结构覆盖网络中的复制技术,一个基础性的问题经常被论及:给定数据大小分布、访问频率分布和节点存储空间,为达到系统性能最优,系统究竟该为每个数据保留多少副本?即基于数据大小和访问频率等异构特性,合理分配有限的存储空间,将可以得到更优的系统性能.在相关工作中,最为知名的是由Cohen和Shenker提出的平方根分布[1].Cohen和Shenker定义搜索范围(searchsize)为成功命中一个查询需要遍历节点的数量,并且认为,当每个数据的副本数量正比于其数据大小、正比于其访问频率的平方根时,平均搜索范围将最小.但本文的工作表明,该工作有两点缺陷:(1)平方根分布其实有一个隐含的假设前提,TTL(TimetoLive)需要无限大以保证每个数据都有足够高的搜索成功率,这在现实中是很难成立的.(2)关于数据大小的影响,可以证明,本文提出的数据副本数量分布要优于Cohen和Shenker给出的结论.本文同样论述在无结构覆盖网络中如何通过合理的数据副本数量分布来达到最小的平均搜索范围(ExpectedSearchSize,ESS).本文第2节介绍相关工作;第3节给出环境模型和问题定义;第4节考虑数据大小的影响并给出最优分布;第5节研究现实环境中的数据副本最优分布;最后第6节是全文总结.2相关工作复制技术常用于无结构覆盖网络用以提高系统性能.首先,将同一数据(或服务)主动部署于较多的分散节点,可以提高系统的可靠性,利于节点之间的负载平衡.其次,对用户来讲,复制可以提高资源的可获取性,加快搜索对用户的响应速度.此外,节点可以从多个备选节点选择最佳服务提高用户体验度.很多数据复制相关研究充分考虑系统在数据大小、访问频率、存储空间等方面的异构性特征,通过优化数据副本数量分布来提高搜索成功率或降低搜索范围[2-4].目前常用的数据副本数量分布有3种:均匀复制(uniformreplication)、正比复制(propor-tionalreplication)和平方根复制(square-rootrepli-cation,本文称之为平方根分布)[5-6].在均匀复制中,所有数据在系统中拥有相同数量的副本,在正比复制中每个数据的副本数量正比于其访问频率.Cohen和Shenker对比研究了均匀复制和正比复制,发现两者在降低搜索范围方面具有相同效果;同时证明,平方根分布中的平均搜索范围最小.此外,Cohen和Shenker在文献[1]中还认为,为了取得最小的搜索范围,每个数据的副本数量应该正比于其大小,尽管文献[1]并没有对该观点展开论证.但我们发现,文献[1]中结论有两个缺陷.首先,我们认为,数据副本数量应该正比于数据大小这一观点的正确性是值得怀疑的.为了有效地利用存储空间,直觉上,一个数据的副本数量应该与其大小有反向关系.因为对用户来讲,数据带来的效果之间是无差别的;对于相同的用户体验效果,大数据却要耗费更多的存储资源.第二点,文献[1]中结论仅仅适用于搜索成功率接近于100%的系统,这在现实中是不成立的.这一前提假设隐含表明,系统实现应该有足够大的TTL或足够高的副本密度来保证足够高的搜索成功率.TTL太大会增加网络负担,加剧响应延迟而不可用.为了合理利用存储资源,总是有访问频率很低、数据密度很小而搜索成功率很低的数据.当TTL在可用范围,存储空间较为有限时,这一理论结果将偏离实际结果,变得不再可用.除了降低搜索范围,还有许多工作着重研究如何通过数据副本分布获取最高的搜索成功率.文献[7]提出了一种对数分布方案,当数据副本数量正比于访问频率对数时可以获得最高的搜索成功率.此外还有许多工作与数据复制相关,它们着重根据不同优化目标阐述全分布系统复制中的时机、位置、数量等基础性问题[8-11].本文的研究内容与之相似:给定存储空间限制、访问频率分布、数据大小分布,求解其最优数据副本分布,以获取最小的平均搜索范围.Page33环境模型与问题定义一个无结构覆盖网络可以用无向图G=(V,E)来表示,其中V代表节点集合,E代表节点之间形成的邻居关系集合,一条边连接的两个节点之间可以直接发送消息通信,而不需要经过其它节点中转.我们假设每个节点愿意共享一定的存储空间,以提高系统的整体性能,并假设每个节点共享相同的空间c.假设一个有N个节点的覆盖网络中共有m个相异数据对象.数据i的大小用vi表示.数据i的访问频率qi是指节点用户对数据i的搜索次数与系统所有搜索次数的比例.对于访问频率向量狇(q1,q2,q3,…,qm)有表达式q1q2…qm和∑qi=1成立.本文用ri代表数据i在系统的所有副本数量(包含源数据对象),它们随机均匀地分布于系统节点.向量狉(r1,r2,…,rm)代表最终的副本分布.无结构覆盖网络的复制优化,其实质就是寻找一个能降低平均搜索范围的从狇到狉的最佳映射.本文采用RandomWalks[5,12]算法路由查询消息.由于该算法具有很好的灵活性和消息规模可控性,在无结构覆盖网络中得到广泛使用.RandomWalks路由算法中一个遍历者walker,除非成功命中或遍历路径长度达到TTL,将一直在系统中转发查找.那么平均搜索范围A定义为其中l是搜索成功查询的平均搜索范围,而s和L分别代表搜索成功率和TTL.4副本数量理论最优分布Cohen和Shenker认为,为了降低平均搜索范围,每个数据的副本数量应该正比于其大小.但下面工作表明该结论是不正确的.本文这里采用与文献[1]相同的问题背景,TTL假设足够大,搜索成功率足够高.4.1数据大小与副本数量最优分布结论1.在面向搜索范围最小化的副本数量分布中,每个数据的副本数量应反比于数据大小的平方根.由于一个数据的副本随机均匀地部署在覆盖网络节点,所以一个针对数据i的查询,在命中之前需要遍历的平均节点数量为那么,我们的数据副本数量分布优化问题可以描述为基于式(3)建立拉格朗日函数:F(r1,r2,…,rm)=∑m其中λ为一常数.令dF/dri=0,可以得到将式(5)代入式(3),得到将式(7)代入式(5),可以得到式(8)即为平均搜索范围最小时的副本数量分布,其中数据的副本数量反比于数据大小的平方根.但文献[1]中却认为ri=Ncviq槡i∑m那么这两个结论究竟哪一个更接近理论最优分布呢?下面给出了模拟实验结果,对两个结论进行了进一步验证.4.2模拟实验环境实验平台用C++编写而成.本文采用Waxman模型[13]生成的随机图作为覆盖网络拓扑.网络由10k个节点组成,平均连接度为8.系统中有240个相异数据对象,在任一节点不存在相同的两个数据副本.数据大小从0.1~1.9随机分布,平均大小为1.0.数据的访问频率来自于PPStream(http://www.ppstream.com)系统快照,取自2008年8月4日综合频道.一个数据的访问频率定义为该数据的在线观众对所有在线观众的比例.每次查询中,随机选择一个节点发起查询.由于在RandomWalks路由算法中每个遍历者(walker)之间是没有交互、相互独立的,所以本文遍历者的数量设定为1.文中实验数据为20k次搜索的平均值.平Page4均搜索范围(ExpectedSearchSize,ESS)为主要的性能度量指标.相关系统参数和缺省值如表1所示.参数缺省值节点数10k遍历数(walker)1连接数40k每节点共享空间5文件数240文件大小0.1~1.94.3模拟实验结果本文下面分别用SRR和SRRR代表平方根分布和本文提出的最优分布.SRR中的数据副本数量正比于数据大小.在本文提出的最优分布SRRR中,如式(8)所示,数据副本数量正比于数据大小的倒数(Square-RootReciprocalReplication,SRRR).图1是在不同TTL下SRR与SRRR平均搜索范围的比较.图2是在不同存储空间情况下SRR与SRRR平均搜索范围的比较.图1和图2均表明,本文提出的副本数量最优分布SRRR要优于平方根分布SRR.在4.1节已经证明,就搜索范围最小化而言,SRRR是理论最优的;而文献[1]并没有提供SRR最优的相应的论证.因此,无论从模拟实验还是分析论证,SRRR最优比SRR最优具有更高的可信度.此外,从直觉上讲,我们并不认为SRR是最优的.搜索范围其实只与数据副本密度有关系,与数据大小并没有直接关系.如果给定有限的存储空间,对于两个访问频率相同的数据,小的数据显然有更高的副本密度因而有更小的搜索范围,从而有更高的系统收益.因此,在数据副本数量最优分布中,数据副本数量应该与数据大小有反方向的增长关系.这一分析性结论与平方根分布SRR观点并不吻合,而与本文提出的最优结论SRRR相一致.5现实环境最优副本分布Cohen和Shenker在文献[1]中证明,平方根分布可以获取最小的平均搜索范围,每个数据的副本数量应该与其访问频率的平方根成正比.本文下面的研究表明,该观点并不总是正确,容易受到现实环境的制约.平方根分布最优这一结论之所以缺乏普适性,就是因为该结论依赖于一个很强的假设,TTL足够大或存储空间足够大,这在现实系统中是很难成立的.为此本文给出了一种具有更加普适性的数据副本数量最优分布.5.1副本数量分布与EES最小化在文献[1]中平均搜索范围定义为查询命中一次查询平均需要遍历的节点数量.对于RandomWalks路由算法,平均搜索范围其实就是平均搜索路径长度与遍历者(walker)数量的乘积.由于RandomWalks中的遍历者之间是独立的,并不会与其他遍历者发生通信,本文只研究只有一个遍历者的情况.5.1.1TTL、副本密度与平均搜索范围我们首先假设系统只有一个数据对象,其副本数量为r(包含源数据对象).当查询消息到达一个节点时,查询消息在该节点命中的概率为r/N,不能被命中的概率为1-r/N.这样,一次搜索在前h-1跳命中失败,但在第h跳命中的概率为如果用α和β分别代表副本密度r/N和1-r/N,那么,系统中该数据的平均搜索路径长度为也就是说,数据i的平均搜索范围hi为通过式(14),将可以得出许多有用的结论.Page5结论2.平方根分布可以获取最小平均搜索范围,当且仅当TTL足够大或副本密度(ri/N)足够高.鉴于此,平方根分布的理论预期结果很难在现实环境中得到应用.平方根分布假设数据i的平均搜索范围为N/ri,它是推导得出平方根分布的基础.将该假设与式(14)对比可以发现,在平方根分布中,表达式(15)隐含表明:(1)L(TTL)足够大;(2)βi足够小,即当TTL固定时副本密度(ri/N)趋近于1.因此,平方根分布存在一定缺陷.首先,在现实环境中TTL的值其实是很小的,因为当TTL很大时,即使搜索命中由于延迟的原因也变得不可用.其次,在现实环境中副本密度ri/N不可能很大,即便存储空间较为空余,系统也将会根据访问频率异构性分配更多空间给热点数据,而有很大一部分数据拥有较小的副本密度.也就是说,由于平方根分布理论结论是建立在很强的假设基础之上的,在现实环境中是很难得到应用的.5.1.2平均搜索范围与最优副本分配量αi的函数,对表达式(14)求导表达式(14)表明,数据i的平均搜索范围是变如果在系统增加数据i的一个新的副本,在降低搜索范围方面的收益将是Δhi=qiL(1-αi)L-1表达式(17)可以用图形更加直观地表达,如图3所示.它表明:(1)对于任一确定数据,增加一个副本在降低搜索范围方面的收益将随着副本密度的增加而降低.(2)对任意两个副本密度相同、访问频率不同的数据,同时增加一个副本,具有高访问频率的数据将获得更高的搜索范围收益.因此,当系统增加一个新的副本时,应该首选那些给系统带来最大搜索范围收益的数据的副本.将所有的存储空间一步步分配完毕,可以证明,此时每个数据所拥有的数据副本数量即为最优分布.下面给出分析性证明.分别用狉=(r1,r2,…,rm)和犚=(R1,R2,…,Rm)代表空间分配完毕时的分布和理论上的最优分布;用rai代表分配给数据i的第a个副本.假设最终分布r不是最优的,那么一定存在ri>Ri和rj<Rj同时成立.它表明,如果将最后分配给数据i的副本rri-Rii给数据j,在降低系统搜索范围方面将可以得到更大的收益.但这一结论是不成立的,因为由前面的存储空间分配过程可知,副本rri-Rii空间之所以分配给数据i而不是数据j,就是数据i可获取更高的搜索范围收益.所以该假设不成立.这一假设对所有副本raRj-rj)同样不成立.所以,空间分布完毕时的副本数量分布在降低搜索范围方面是最优的.5.1.3模拟实验结果这一小节给出了部分模拟实验结果以验证上面给出的结论.采用的模拟环境与4.2节相同.在图4~6模拟实验中,系统只有一个数据对象,在图7和图8中共有240个数据对象.除非特别指明,TTL值默认为400,副本密度默认为0.01.i(a=1,2,…,ri-Ri)和rbPage6图8不同存储空间下两种优化分布的平均搜索范围比较图4是关于搜索范围(搜索路径长度)理论结果与实验结果的比较.在40k次搜索后,分析搜索范围(跳数)分布.理论结果根据表达式(10)计算得到.图4显示,理论结果与实验结果较好吻合.图5和图6是平均搜索范围在模拟实验结果、理论结果和假设性结果(基于文献[1]平方根分布中的假设)之间的比较.理论结果通过表达式(14)计算得到.图5和图6均显示理论结果与实验结果具有一致性.它在一定程度表明本文的推理分析是合理的.但实验结果与假设结果之间的一致性程度随着TTL和副本密度的不同而不同.当TTL较小或副本密度较低时,实验结果的平均搜索范围显著低于假设结果.随着TTL和副本密度不断增长,三者之间搜索范围逐渐趋于一致.图5和图6进一步表明本文5.1节的结论是合理的;而且,平方根分布并不总是正确,其准确程度受到TTL和副本密度的影响.因此,在现实全分布无结构覆盖网络中,TTL较小、副本密度较低,平方根分布在降低搜索范围方面并非最优.在图7、图8和图9中,SRR和Optimal分布代表平方根分布和本文所提出的在现实环境中的最优分布.图7和图8表明,在降低搜索范围方面平方根分布并非最优,尤其是当TTL很小或副本密度较低时.当TTL等于20时,SRR要比Optimal多消耗13.7%的搜索消息.当每个节点仅共享一个数据的存储空间时,SRR每次查询要比Optimal平均多消耗9.7个(13.1%)查询消息.这一结果与本文5.1节分析结论相吻合.图9是SRR与Optimal数据副本数量分布对比.它显示,比之Optimal,SRR分配更多的副本给不太流行的数据.造成这一差别的原因在于SRR假设所有数据对象的平均搜索范围均为N/ri,在数据副本稀疏时每增加一个副本带来的平均搜索范围收益要高于式(17)所示.一个数据副本中,副本密度较低时的非流行数据带来的平均搜索范围收益要远高于较流行数据对象带来的收益,所以在分配空间时优先分配给了部分非流行数据,尽管其访问频率很低.而在Optimal中,副本密度较低时增加一个数据副本带来的平均搜索范围收益没有SRR那么明显,所以非流行数据得到的副本数量就比SRR低.通过图6也可以看出,副本密度由0.005~0.01,基于假设的SRR平均搜索范围降低量比模拟数据更加明显.而副本密度由0.01~0.015再到0.02时,SRR平均搜索范围降低量与模拟实验降低量相比,逐渐变得不再显著.因此,SRR分配更多副本给非流行数据的原因在于SRR关于平均搜索范围的假设在数据副本密度较低时误差太大造成的.6结束语本文是对文献[1]中工作的深化拓展,与之研究了相同的问题,即在全分布无结构覆盖网络中什么Page7样的副本分布可以获得最小的平均搜索范围.本文工作包括两个部分:第一部分将数据大小作为一个重要考量因素研究了数据副本数量在理论假设环境下的最优分布;第二部分分析了理论假设对现实环境分布的影响,研究了在现实环境下的最优分布.本文工作将加深对无结构覆盖网络中复制技术的理解.但关于无结构覆盖网络数据副本数量分布,仍然有很多问题需要解决.首先,低搜索范围并不意味着高的搜索成功率,有些时候搜索成功率要比搜索范围具有更高的重要性.因此,在优化搜索范围时兼顾到成功率也是需要深入考虑的问题.其次,降低搜索范围并不一定是系统的终极目的,我们应该综合分析各种优化的优缺点,为实际应用提供一种实际可行的参考依据.第三,以经济有效的方式达到预期优化目标仍然是一项挑战.我们将在进一步工作中逐步深化这些问题研究.
