Page1面向CC-NUMA体系结构的事务内存冲突规避方法王睿伯卢锡城卢凯王绍刚(国防科技大学计算机学院长沙410073)摘要现有的事务内存研究主要面向多核处理器和SMP机器,缺少对CC-NUMA系统的研究.而CC-NUMA是高端服务器的重要体系结构,随着用户对并行处理能力需求的不断上升,高端服务器将占据越来越重要的地位.文中概要阐述事务内存研究的基本情况,通过详尽的实验数据,深入分析了CC-NUMA结构的本地、远程访存差异特性对事务内存性能的影响,提出了一种面向CC-NUMA体系结构的冲突规避方法PBC.PBC在事务启动之前,对冲突可能性进行预测,并根据预测结果对事务进行调度,以降低事务的失败率.实验表明,文中提出的PBC方法可以显著提高CC-NUMA机器上运行事务内存的整体性能.关键词事务内存;CC-NUMA;冲突规避1引言随着多核技术的普及,处理器提供了充裕的硬件并行能力,而与之形成鲜明对比的是,现在的大多数软件还不是并行的.软件的并行编程技术一直“曲高和寡”,并行编程作为高性能计算领域常用的编程模式,并没有普及到所有的编程人员,并且一直被当做是“专家级”的技术[1-2].目前,并行编程中关键的共享资源同步技术仍然在“锁”机制的基础上实现[3-6],通过对共享数据“加锁”访问来保证并行程序执行的正确性.事实上如何正确地使用锁是一件非Page2常困难的事,非常容易造成死锁[7]等问题.在应用需求的驱动下,学术界已经开始进行了新的同步模型的研究,其中事务内存无疑是最具有吸引力和应用前景的一项新技术,它能够有效地解决并行编程当前所面临的难题,成为近年来的研究热点,也是并行计算机体系结构的前沿研究课题之一[8-11].目前的事务内存主要面向单个多核处理器以及SMP机器,缺少对NUMA结构的关注,特别是CC-NUMA(CacheCoherenceNon-UniformMemoryAccess)结构.而CC-NUMA体系结构是当前高性能服务器的主流体系结构,例如AMD公司Opteron系列处理器的HyperTransport互联技术,还有Intel公司最新的至强和安腾处理器的QuickPath互联技术.NUMA结构的特点,就是每个处理器访问本地和远程内存的延迟不同,访问远程内存的延迟往往是本地的若干倍或者更多,具体差异取决于处理器互联的层次、距离以及互联接口的带宽和延迟.本文通过实验,深入分析了现有的事务内存系统在CC-NUMA结构机器上的运行情况,发现随着远程内存访问延迟的增加,事务之间的冲突开始增多,导致事务的失败率随之增加,极大地影响了系统性能.由此,本文提出了面向CC-NUMA的事务冲突规避方法PBC,该方法在事务开始之前,预测该事务将来发生冲突的可能性,根据预测结果对事务进行调度.实验证明,该方法在CC-NUMA结构机器上可以有效地减少事务冲突,提高事务内存系统的性能.2相关研究2.1事务内存事务的概念源自于数据库管理系统.在数据库管理系统中,事务必须满足ACID性质,即原子性、一致性、隔离性和持久性.用户可以使用事务来包装多个数据库操作,在其他用户看来,事务中的多个数据库操作一次性完成,事务执行过程的中间状态对其他用户不可见[12].将共享数据的访问对应于数据库操作,事务内存系统可以对应于数据库管理系统,用户用事务来包装多个共享数据的访问,由事务内存系统来保证事务特性.在采用事务内存同步方式的程序中,一般使用关键词atomic将指令序列包装成事务,由事务内存
