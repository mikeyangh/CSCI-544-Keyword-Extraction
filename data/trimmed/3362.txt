Page1绿色网络和绿色评价:节能机制、模型和评价林闯田源姚敏(清华大学计算机科学与技术系北京100084)摘要随着网络规模的扩大和网络设备的不断更新,目前的网络对能量的利用日益暴露出能耗高、效率低,浪费多等诸多问题.节省网络能耗、构建绿色网络不仅成为计算机领域一个意义重大、需要迫切解决的课题,也成为影响社会可持续发展和国家发展战略的一个重要因素.目前,大量绿色网络的研究工作致力于减少网络系统的无用能耗,提高能量利用率.文中将能量看成一种系统资源,从资源分配和任务管理角度对绿色网络的机制和策略进行了综述,介绍了模型方法在绿色评价中的应用.基于这些讨论,文中提出了基于随机模型的绿色评价框架,为构建绿色网络和节能机制的评价体系奠定了基础.关键词绿色网络;绿色评价;节能机制;资源管理;随机模型1引言低碳节能已经成为全球最受关注的话题之一,VECC-MEP机构在“到2050年减半世界碳排放”的报告①中指出:2020年温室气体排放量将达到峰值.为此,2009年的哥本哈根气候峰会将减少全球二氧化碳排放量作为首要讨论任务②.中国作为一个发Page2展中大国,预计未来10到20年的碳排放量会远超过美国,我国承诺到2020年实现单位国内生产总值二氧化碳排放比2005年下降40%~45%.据报道①,在即将制定的“十二五”发展规划中,节能将成为重要内容.能耗问题对我国的科学发展和可持续发展具有重大的影响.信息和通信技术行业作为全球增长最快的行业之一,其碳排放也随着行业的增长而不断增长,据统计[1],目前信息和通信技术领域的碳排放占全球的2%,而这一比例到2020年将翻番.2008年服务于互联网的路由器、服务器、交换机、冷却设施、数据中心等各种设备总共消耗8680亿度电,占全球总耗电量的5.3%②.文献[2]中指出,按照目前的增长趋势,到2025年,IT行业平均能耗会达到2006年的5倍,网络领域能耗更会达到13倍.这意味着到2025年网络领域占IT业的总能耗将增长到43%.耗电问题已成为网络和信息系统持续发展的重大障碍.传统的网络系统设计的两个原则有悖于低碳节能的目标:一是超额资源供给,在缺少QoS支持的因特网架构下,超额资源供给能使网络承受突发的峰值负载;另一个是冗余设计,通过冗余链路和设备,提高网络的可靠性,以应对突发的故障失效.这两个原则都没有考虑到能量因素.随着网络规模的扩大和网络设备的不断更新,能量的利用日益暴露出能耗高、效率低,浪费多等诸多问题.互联网骨干网络的忙时最大平均链路利用率不足30%,很多网络的闲时链路利用率只有5%以下[3],而网络设备按照峰值设计消耗能量,绝大部分设备7×24小时全速工作,这为绿色网络的构建提出了挑战也提供了机会.网络中能量浪费和能耗成本的约束,限制着系统性能方面的进一步提高,尤其随着云计算和大规模数据中心这些“能耗大户”的发展,能耗因素往往成为限制其规模和服务能力的瓶颈.构建绿色网络,节省网络能耗成为计算机网络领域一个意义重大、迫切需要解决的研究课题.绿色网络的目的是节省互联网的能耗.目前许多政府机构和产业组织制定标准和法规提倡绿色网络.美国贝尔实验室倡导组建了全球性联盟“绿色沟通”,旨在实现千倍降低能耗的目标.为了控制以太网能耗,电子电气工程师协会正式批准了802.3azEEE标准规范③,其中EEE是EnergyEfficientEthernet的缩写,即高效节能以太网,旨在降低网络设备的能耗,在网络资源利用率较低时,网络设备将自动转为低能耗状态.如果网络设备能耗与负载流量成正比,那么网络系统总能耗将会下降,相同能耗下可部署更多的网络设施,从而提高整个网络系统的可扩展性,所以绿色网络对社会和网络的可持续发展将产生深远的影响.绿色网络是一个系统级的研究课题,涉及网络体系结构、网络协议、网络设备结构创新和算法设计与优化等网络领域的核心科学问题.解决这些问题需要集成化的关键技术支持.如果将能量看成一种系统资源,那么对能耗的管理和控制可以归结为资源配置和管理问题,具体可以分为资源分配、任务调度和架构部署3个方面.资源的分配也是对能量的分配,网络系统可以看成一个生产者-消费者系统,生产者分配资源为消费者提供服务,对服务过程中的能耗进行控制实际是对资源分配过程的控制.任务调度通过制定规则来决定从等待队列中选择哪个任务进行发送,使得所有输入业务能够按照预定的方式得到处理.架构部署是从全局的角度对系统进行体系结构的设计和资源的优化部署.绿色网络的研究需要综合考虑能量和性能因素,而不同的节能模型对于性能的影响不同.随着网络技术应用的不断发展,某些特定领域的业务对网络QoS提出了更高的要求,网络资源的复杂性、异构性等特性和业务需求的多样化导致网络能耗的管理复杂度增加,这就加大了高能效资源配置机制和算法的研究难度.有效的能耗管理要同时满足“绿色”和QoS的双重要求,这就使得绿色网络的实现目标具有双重性,所以绿色网络中的问题往往是在满足一定性能要求和系统有限资源的约束下的最小能耗问题,这涉及到了网络优化问题.优化问题需要对目标函数和约束条件进行形式化描述,我们可以通过评价网络系统中特定属性和能耗的关系,来构造优化的目标函数和约束条件中的变量.目前针对绿色网络的评价存在的问题有:缺乏系统的模型方法和分析;大多数建立在具体的某一项或两项系统属性上,具有一定的局限性;主要针对具体应用背景进行分析,缺乏理论基础,当具体问题变化时,往往需要作大量的修改.因此本文提出了绿色网络的评价体系框架,通过一个循环的过程:模型-评价-优化-实施-评价-再优化,逐步优化网络的服务质量和能效之间的权衡,从而为绿色网络的不断改善提供依据.①②③Page3绿色网络所涉及的领域、网络的能量资源管理结构和网络能耗优化的循环过程如图1所示.本文对绿色网络节能机制和策略、模型及评价方法进行综述,主要分为以下4个部分:第2节分析网络系统能耗,阐明能量与其它系统资源的区别和联系以及不同系统能耗的形式化描述;第3节综述网络节能机制和策略,总结现有网络节能技术,并按照粒度进行分类;第4节介绍模型方法和评价,提出绿色评价的概念以及包含的内容,并且对绿色网络中能耗的优化算法进行归纳和总结;最后对全文进行总结,提出进一步的研究方向.2网络系统能耗分析计算机网络系统是利用通信设备和线路将地理位置不同、功能独立的多个计算机系统互联起来,以功能完善的网络软件实现网络中资源共享和信息传递的系统[4].网络通信设备一般包括网络交换设备、互连设备和传输设备,如网卡、网线、集线器、交换机、路由器等.计算机系统和网络通信设备是网络系统的重要要素,也是能量消耗的主要来源之一.目前网络规模和节点数目急速增长,随之带来的网络能耗问题日趋严重.分析网络系统的能耗模型对研究绿色网络具有重要意义.通过分析能耗与系统参数和负载的关系得出影响能耗的关键因素,有助于以下3方面工作的进行:(1)为绿色网络的设计提供参考,因为影响能耗的因素有很多,不同的因素其影响因子不同,找出影响能耗的瓶颈重点并对其改善对于构建绿色网络具有重要作用.(2)为绿色网络的评价提供方法,评价工作的首要任务是评价能耗,通过网络系统的能耗模型能够得到能耗指标,从而进行合理分析和有效评估.(3)为绿色网络的优化提供依据,网络优化元素包括优化目标、决策变量、约束条件和参数,通过形式化描述,把网络能耗优化转换成一些经典的优化问题,从而设计出能效最优的路由/调度算法.本节首先从网络系统角度阐述了能量资源与其它系统资源的区别与联系,分析了传统的服务器领域的能耗模型,对网络中的能耗模型进行了归纳.2.1系统能量资源分析传统的系统资源一般包括处理器、内存和硬盘等,它们在系统中是真实可见的,系统通过使用资源来提供服务.能量也是一种系统资源,它“无形”地存在于系统中,只要系统处于运行状态,那么就会消耗一定的能量.能量作为一种系统资源,与其它资源有着密切的联系,它是其它资源正常工作的基础.传统的系统资源需要能量提供支撑,如果系统没有了能量,那么再庞大的系统也无法正常工作.区别如下:能量又有别于其它系统资源,它与传统资源的(1)能量是不可再生资源,不可重复使用.与传统的处理器等系统资源相比,能量不可以重复利用,其在被系统消耗之后转换为其它形态,如热能等.(2)利用方式不同会产生不同的效果.集中利用能量比分散利用的有效利用率高.由于静态能耗的存在使得集中利用能量更能节省资源,提高利用率.能量作为一种系统资源,它和传统资源有联系也有区别,因此我们在进行系统能量管理时,不能直接照搬传统资源的管理方法.2.2网络系统能耗模型2.2.1能耗的传统定义能耗和功耗是用来衡量系统消耗能量的两个重要概念,在不同的上下文中,能耗和功耗的定义不同.在计算机系统中,能耗是计算机系统一段时间内总的能量消耗,单位是焦耳(J),其定义如式(1)所示:其中E表示系统的总能量消耗,由时间t和功耗P两方面因素共同决定.功耗是指单位时间内能量的消耗,反映计算机系统消耗能量的速率,单位是瓦特(W).若令ΔE是在Δt时间内所消耗的能量,那么这段时间内的平均功耗Pavg由式(2)给出瞬时功耗是指Δt趋近于0的平均功耗:区分能耗和功耗这两个概念对于节能技术有着Page4重要作用[5],因为减少系统功耗不一定减少系统能耗,例如对于一个计算机系统,我们可以通过降低一半的时钟频率来减少功耗,但是如果这个系统处理事务的时间相应地提高了一倍,那么系统总的能耗可能是相同的.减少能耗和减少功耗是节能研究的两个重要方面,选择其中哪一方面是由具体的上下文决定的,例如在无线移动应用中,减少能耗能够延长电池寿命,所以减少能耗更加重要;对于其它的一些系统,能量供应充足,这时控制系统温度可能是更为重要的问题,我们需要减少系统的最大瞬时功耗即峰值功耗.根据式(2),我们可以使用系统的功耗来计算某段时间内系统的总能耗,因此本文我们主要讨论系统功耗问题.2.2.2服务器能耗模型服务器是网络系统中提供服务的关键设备,在服务器节能领域,已有大量工作进行了深入研究,并取得了一定的研究成果.在服务器系统中,能耗主要来自处理器、内存、磁盘I/O和用于冷却的风扇,其中处理器和内存占有服务器系统中能耗的大部分,也是目前节能研究的关键领域.随着节能技术在处理器产业的应用,例如英特尔公司的Speedstep和AMD公司的PowerNow技术,处理器能够根据负载动态调节性能,从而达到能耗和负载具有较好的比例性.根据谷歌公司2007年统计,其服务器的处理器峰值能耗占总能耗的比例已经低于50%,所以处理器在服务器能耗中已经不再占有支配比例[6].处理器中的数字电路大多采用CMOS集成电路,CMOS集成电路的功耗主要由静态功耗和动态功耗构成:静态功耗是指泄露电流造成的,是电路状态稳定时的功耗,与电路的逻辑状态有关.动态功耗是由电路充放电引起的功耗,与电路的反转频率有关.除此之外,还有一部分由短路瞬间电流产生的短路功耗,一般来说,内部短路功耗不会超过动态充放电功耗的10%,通常忽略不计.动态功耗在CMOS电路功耗中占主要部分,是节能研究的主要对象,其功耗模型为其中a为电路翻转频率,C是负载电容,f为时钟频率.由于电压V与时钟频率f成正比,f又和系统服务速率成正比,那么可以得出动态功耗和服务速率的n次方成正比。虽然不同的设备具体功耗模型不同,但大多数都符合多项式分布,对于一般的处理器系统来说,在服务速率s>0时的瞬时功耗可以简化表示:其中σe为空闲功耗或者静态功耗,μe和α为常数,与具体的设备有关.在实际的测量中,不同的系统表现出不同的功耗特征,文献[7]针对IntelPXA270、PentiumM770和TCP/IPOffloadEngine进行了功耗研究,并提出α=1.11,1.62,1.66.2.2.3网络通信设备能耗模型文献[8]分析了在一个高性能数据中心系统中服务器与网络通信能耗的比例,当系统服务器和网络的利用率在15%的水平而且服务器的能量和负载具有较好的比例性时,网络通信能耗接近总能耗的50%.由此可见节省网络通信能耗对于网络系统来说有着重要的意义.与传统的服务器系统相比,网络通信设备的能耗有着自身的特点,以路由器为例[9]:(1)路由器系统I/O操作占大多数,通常路由器系统都配有各种不同类型的接口线卡,大多数处理工作都在线卡上完成,对主控板的处理能力要求相对较弱.而服务器除了关注系统I/O能力之外,更注重系统的处理器性能,处理器能耗在服务器总能耗中占有一定比例.(2)在进行高性能计算时,服务器通常都配有大容量的内存,内存的能耗在整个系统中占有很高的比例.而对于路由器系统来说,能耗分配相对比较平均.不同网络通信设备的能耗比例不同,文献[10]分析了在互联网中不同设备能耗的占有比例,其中LANswitch和hubs占整个网络设备总能耗的80%左右,其次是路由器和WANswitch.同一设备中不同组件的能耗比例不同,文献[11]分析了路由器的基础能耗情况,通过对目前广泛使用的两种路由器的能耗测量指出,路由器的基本系统(将所有电缆、插槽的线卡都拔掉)的能耗超过总能耗的一半.随着线卡的增加,整体能耗也随之增加,并且与增加的线卡类型有关,所以减少基础能耗对于路由器的节能设计有着重要影响.的影响不同,实验表明:文献[11]中还指出不同的配置与操作对于能耗(1)路由器的整体能耗在有无报文传输时相差(2)相等数据流量下,路由器能耗随报文长度不高.Page5的减少而增加,但幅度较小.(3)线卡配置相对其它配置对能耗影响较大,随着整体配置提高,例如线卡带宽提高时,对于能耗的影响逐渐增加.从式(7)可以看出路由器的功耗PC由它的配置和使用情况决定.向量犡决定了机柜中设备的型号以及设备上的流量负载特征;函数CC(x0)表示机柜在不插任何设备时的功耗;N表示处于工作状态的线卡的数目,而TP(xi0)是一个和路由器利用率有关的系数;LCC(xi1)给出了线卡在标配下的功耗.PC(犡)=CC(x0)+∑N2.2.4路由对能耗的影响从网络全局的角度进行分析能够更好地指导网络节能策略的设计.路由协议是在获得网络拓扑的前提下,根据路由的可达性信息,为分组选择一条优化的传输路径.从这个意义上说,我们根据要求约束传输路径的集合,即限制可选路由的网络拓扑的范围.值得注意的是,所限制的可选路由网络拓扑是实时变化的,我们需要求得一个计算复杂度和节能效率之间的平衡点,使得在取得较高能量利用率的同时,维持网络的服务质量.文献[11]在GSR/OC-48路由器上选取三组随机生成的网络拓扑进行测试,测试对比了最短路径路由和加入能耗因素的路由,数据表明当网络的节点数目保持12个不变而链路数目从24增加到48,最后到134时,加入能耗的路由能够节省的能耗从2%增加到19%,最后到65%.可以看出从影响网络全局的部署、调度和路由的角度研究网络节能策略与算法,能够达到降低网络能耗,提高网络性能的目的.3网络节能机制和策略第2节分析了系统资源与能耗之间的关系,可以看出网络系统的能量消耗与系统资源密切相关,对能耗的管理本质上是对资源的管理.通过资源的合理配置,能使网络系统既满足QoS又满足节能要求,本节综述了网络节能的机制和不同机制下的节能策略.3.1网络节能机制研究能耗管理机制打破了传统资源只有开和关两种状态的束缚,把耗能资源划分成不同状态.不同状态的能耗和服务能力不同,低能耗状态对应的服务能力较弱,高能耗状态对应的服务能力较强.通过低能耗状态实现节能,并通过不同状态之间的相互转移来实现QoS要求.根据不同的应用场景和业务差异,目前主流的能耗管理机制可以分成以下两种:睡眠-唤醒机制和动态速率调节机制.3.1.1睡眠-唤醒机制在网络系统运行中,系统不同层次会有不同时间尺度的空闲时间,利用空闲时间,将部分耗能资源置于睡眠或者关闭状态,能够减少空闲时的能量浪费.由于开-关机制是睡眠-唤醒机制的一个特例,所以分类时将两者合并.睡眠状态又可以划分为不同的子状态,文献[12]将无线传感器节点的能耗部件分成4种不同的睡眠模式.文献[13]将LAN中的交换机端口分成5种不同的状态,如图2所示,其中睡眠状态有3种,即简单睡眠、睡眠和缓冲睡眠,不同睡眠状态的唤醒机制和睡眠深度不同.随着睡眠深度的增加,其能耗相应地减少,唤醒成本(延迟和能量)相应地增加.当睡眠深度由深到浅转移时,系统会花费一定的转移时间δ,系统能量消耗曲线也会出现一个尖峰的波动.睡眠-唤醒机制需要实际硬件的支持,1997年由Intel、Microsoft、Toshiba共同制定了ACPI规范[14],它的主要目标是使整个计算机系统能够动态地管理电源.ACPI定义了计算机系统的全局状态、设备电源状态和处理器电源状态,如图3所示,具体细节可以参考文献[14].计算机系统的全局状态为G0,G1,G2,G3,其中睡眠状态G1又细分为S1到S44种状态.系统从这几种状态被唤醒到G0运行(唤醒等待时间)所需的时间最短的是S1,较短的是S2和S3,居中的是S4.设备状态D0,D1,D2,D3是与设备相关的状态,对用户来说往往是不可见的.其中D0是工作状态,D1,D2是中间状态,D3是关闭状态.Page6处理器电源状态C0到Cn是指在全局状态G0下(只对G0状态有效,在其它状态下不予讨论)处理器的状态,只有C0状态下CPU才会执行指令,C1到Cn状态下CPU都处于各种不同程度的睡眠状态.3.1.2动态速率调节机制根据负载情况动态调节系统处理速率,使得系统能够在低速率下节省能耗.此机制是使系统工作在不同的服务速率和相应的能耗水平上,速率缩放[6,15]和自适应链路速率[16-17]是常用的速率调节机制.以太网的链路有着不同的传输速率,数据表明以太网链路速率从100Mbps增加到1Gbps时,功耗增加了2~4W,而当增加到10Gbps时,功耗增加10~20W[16].而以太网处于空闲和100%链路利用率的情况下功耗几乎是相同的,即以太网功耗与链路利用率无关,通过测量表明,目前以太网的链路利用率主要在1%~5%之间,所以在链路处于低利用率时降低链路速率能够在有限的性能影响下有效地降低能耗.自适应链路速率是由Nordman和Christensen于2005年在IEEE802.3tutorial提出的[17],作为一种能够在全双工传输的以太网中根据链路利用率自动切换链路速率的方法第一次被描述是在文献[16]中.其采用了快速的MAC层信令握手机制RapidPHYSelection,用来发起、协商和同步链路速率的变化.首先链路的一端在决定提高或减少链路速率后发起一个速率变化请求,即ALRREQUESTMAC信令.链路的另一端接收到此信令后告之请求者是否接受速率转换,即回复ALRACK信令接受变化或者ALRNACK信令拒绝转换.一个ALRACK响应能够触发一个链路速率转换和链路再同步.双方握手的总时间加上再同步时间(Tswitch),对于ALR的性能是至关重要的,在1Gbps的以太网中一般低于100μs,用于链路再同步的时间一般是10000个时钟周期.无论是睡眠-唤醒机制还是动态速率调节机制,都是基于系统资源的能耗状态转移,我们定义状态S={S0,S1,S2,…}是系统状态集合,P={P0,P1,P2,…}是相应的能耗状态集合,对于睡眠-唤醒机制,S0~Sn-1表示不同的睡眠状态,在睡眠期间服务速率为0,不能处理任何任务,Sn表示唤醒状态.这种机制的特例即只有两个状态SON和SOFF的开-关机制,对应的OFF状态的能耗POFF=0.对于动态速率调节机制,Si表示不同的工作状态,对应的能耗不为零,而且往往服务速率越大能耗越大.系统在不同状态之间的转换时花费的成本不同,这里的成本主要指转换所花费的时间及其对性能的影响以及所消耗的能量.在睡眠-唤醒机制中,不同的睡眠深度需要的唤醒时间和能耗不同,而在动态速率调节机制中,不同状态之间的转换时间和能耗也不同,过长的转换时间会造成系统性能的损失,如延迟增加、报文丢失等.文献[18]对ALR进行了测量,数据表明实际的转换时间是不可忽略的,而且转换时间不仅和起始终止状态有关,而且是不对称的,例如从1Gbps到10Mbps的转换时间是10Mbps到1Gbps的8.4倍.所以在进行转换成本的计算时要考虑到所有可能的状态转换,而且要考虑转换的方向.目前大多数研究针对单一可调节资源,限于技术原因,目前只有处理器能够有低功耗运行模式,而内存和硬盘的低功耗模式就是完全的休眠.随着技术的发展,越来越多资源能够进行性能的调节,所以会出现多种可调节资源并存在系统中的情况,在进行这种多资源分配中,由于不同可调节资源的耗能范围不同,所以影响系统能耗的瓶颈资源也不同,找出瓶颈资源从而采取相应的节能策略是一种可行思路.对耗能资源的状态管理涉及到了状态转移算法,本文将这些具体的算法归纳为节能策略,下面我们对现有的网络节能策略进行综述和概括.3.2网络节能策略分类节能策略的分类方法有很多,如表1所示[19].Page7分类标准时间尺度在线/离线粒度节点/网络OSI层次链路、网络、传输、应网络结构核心网/边缘网络决定策略实施的位置服务类别GS/CLS/BES不同服务对性能的要求在分类方法上,根据时间尺度可以将策略分为在线策略和离线策略,在线策略是在系统运行中执行的,时间尺度一较小,实时性较强;而离线策略则是在系统运行之前制定的,一般时间尺度较大,而这种策略通常用在系统设计、资源部署中.根据OSI网络层次的划分,可以将策略的实现分成不同层次,例如数据链路层、网络层、传输层和应用层等,有些策略需要跨层执行或者需要多个层次的互相配合.节能策略可以依据应用的网络结构和位置的不同进行划分,例如接入网络和骨干网络,无线网络和有线网络等,不同的网络位置其策略的部署也不尽相同.不同的网络业务有不同的性能和QoS要求,例如实时性较强的业务对于延迟的要求较为严格,而对于一些网络处理设备来说吞吐量是衡量性能的一个重要因素.对业务和服务类型进行分类,有助于研究性能和能耗之间的关系.本文我们将主要从网络粒度的角度对现有策略进行分类,这种分类下的不同策略对于系统资源的抽象程度不同,其决策需要的信息量也不同,不同策略代表了不同的应用层次.对于单个节点,例如设备或者组件,其节能策略是通过单个节点的资源分配使能耗和负载成比例性,大多应用在单独的计算机系统或者设备上.而对于一个分布式的系统或者网络则是从更高的层次,把一个或者多个组件(设备)看成系统资源进行管理和任务调度,从全局的角度实现整个系统网络能耗和负载的比例性,这就涉及到了网络协议和体系架构的设计和改进.文献[20]指出不同粒度策略执行的时间尺度不同:在CPU和指令级别的应用属于纳秒到微秒级;报文间或者流内的应用属于微秒到毫秒级;而流间的应用则属于秒或者小时级.不同的时间尺度决定了策略执行的结构层次,越短的时间尺度对应越低的网络层次,而需要各个部件之间的合作也就越少.3.2.1节点级节能策略节点级策略通过分配单个节点的系统资源,如处理器资源或者带宽资源实现资源的状态管理.在具体系统中,一般通过能耗优化模块具体部署节能策略,如图4所示[21],通过观测子模块实现系统负载等系统信息的观测,观测信息被传递给控制子模块,通过系统部署的节能策略进行系统参数的控制和调节,从而实现系统实时能耗的控制.(1)处理器节能策略处理器的节能策略一般根据负载情况调节CPU的电压和时钟频率,可以分为静态方法和动态方法.静态方法是通过设置阈值来使能耗部件处于睡眠/唤醒或者高速/低速状态,阈值的设置依赖于负载的特性,在负载未知或者经常变化的情况下静态方法不能有效地满足性能的需求.为了解决这一问题,动态功耗管理(DPM)根据负载情况预测调节电压和时钟频率,一些DPM算法能够在硬件层作为电路的一部分设计和实现,但是策略的修改和重新配置成本较高,所以DPM需要软件和硬件的相互配合才能发挥最大效率.而ACPI规范提供给整个计算机系统能够动态地管理电源的接口,使操作系统能够在系统运行期间根据负载情况动态调节运行状态.如何根据负载的特性进行处理器电压和时钟频率的决策和控制,在不降低系统性能的情况下减低能耗成为高性能计算和操作系统领域的热点.Yao等人[22]提出对处理器能耗优化问题的研究产生了重大的影响,他们提出了与速度有关的能量消耗函数,并采用速度缩放策略,把能耗优化问题归结成最优任务调度问题.文献[23]提出采用休眠机制和基于概率的能耗最小算法,并且将速度缩放和休眠机制的策略结合,提出了一个(槡3+22)-competitivePage8的简单算法.在操作系统层次,文献[24]提出了在Linux平台下内核级的实时能耗管理器OndemandGovernor.管理器能够连续地监控CPU利用率,并且决策时钟频率和电压的变化,这是一种动态电压和频率(DVFS)调节策略,状态之间的切换采用现有的技术只需要10ms,所以能使频率降低带来的性能的降幅较小,并且能够应用于多处理器系统.此管理器已被Linux内核版本2.6.10所采用.(2)网络设备节能策略基于CPU的节能技术目前已比较成熟,且各大厂商如Intel、AMD都有各自相应的技术,而在网络设备领域,相关的研究刚刚起步.在应用睡眠-唤醒机制时,面临的主要问题在于进入睡眠和唤醒的条件,“timer-driven”策略是最简单的策略[25],也叫做超时策略,是指当系统处于空闲状态的时间超过某一阈值时,系统进入睡眠或关闭状态,当系统休眠时间到达某一阈值时系统被唤醒.由于计时时间的存在,此策略的节能效果较差,而且在睡眠过程中有数据包到达时,这些包将被丢弃.“wake-on-arrival”(WoA)策略则是使设备的特定接口处于工作状态,当该接口检测到有包到达时唤醒设备,正常工作,但是目前设备并不都支持WoA,所以文献[26]提出利用“哑包”唤醒设备的策略,如果A需要唤醒B,那么A先给B发送一个“哑包”,然后等待δ时间与B进行实际通信,这种策略减少了丢包率,但增加了系统延迟.在3.1节的节能机制中[13]用3种睡眠状态改进了超时策略.在简单睡眠中,交换机端口设置计时器,仅当计时器超时端口被唤醒,在简单睡眠中到达的包被丢弃;当端口处于睡眠状态时,除了满足简单睡眠的唤醒条件之外,当数据包到达时,该端口也被唤醒,丢失该包;缓冲睡眠状态是相对复杂的睡眠状态,当数据包到达时,该报文被缓冲,并唤醒该端口,可以看出缓冲睡眠状态是睡眠状态的扩展,并且需要缓冲区且处于开启状态.基于超时策略还有很多改进,例如可以根据报文到达的特征动态调整超时的阈值或者根据历史情况预测阈值大小等[20].由于现有网络环境的影响,在网络设备进入睡眠状态时一些无用的流量可以直接丢弃,但是如ARP、ICMP或者DHCP等有用流量会影响网络设备的“睡眠质量”,所以提供接口代理[27-28],让代理来执行一些简单的任务,从而保证设备睡眠-唤醒机制的优化执行.自适应链接速率技术基于3.1节中的动态速率调节机制,通过自动调节全双工传输的以太网链路交换速率从而适应不同的链路利用率,使链路交换速率与链路负载成比例,目前对于该技术的研究主要集中在[29]:(1)速率切换,包括切换的条件和时机、最优速率的选择以及如何快速切换.(2)策略对性能的影响.文献[29]提出了单阈值和双阈值的自适应链接速率策略,策略根据输出缓冲的利用率或者队列长度Q进行速率的转移,对应于不同的策略,服务速率u(t)有着相应的变化:在以k为阈值的单阈值策略中,服务速率可表示为式(8):在以k1,k2为阈值(k1<k2)的双阈值策略中,服务速率可表示为式(9):由于双阈值策略的滞后调整会产生抖动问题,为了解决速率抖动,文中提出了两种解决策略,一种是“utilization-threshold”策略,在速率的转换时增加链路利用率参数;另一种是“Time-Out-Threshold”策略,在策略中引入tMinHigh和tMinLow参数分别控制在高速率和低速率的持续时间,参数的计算通过启发式学习.在考虑对性能的影响方面,文献[30]将系统性能参数引入速率变化条件,服务速率u(t)如式(10)所示:其中集合S为服务速率集合,uk为当前速率,h为最短持续时间,δ为速率转移时间,QI为队列长度,这种策略能够保证系统的最大延迟不超过某一阈值.从以上分析可以看出在节点级节能策略中,网络设备的节能策略对于所处网络环境的依赖更大,而且有些策略需要处理器的节能策略作为基础,例如基于现有处理器由软件实现的路由器[31].3.2.2网络级节能策略目前大多数的研究工作只关注于网络节能问题的某一(些)方面,例如针对某一单独计算系统,或者网络系统某一设备(CPU、网络接口、路由器、交换机等)的能耗问题,缺少从网络全局的角度研究网络的节能策略.通过对现有网络协议与路由或者网络Page9架构的改进和设计新的网络架构能够在互联网、数据中心网络和无线网络中实现能耗节省.(1)网络协议与路由调度加入能量因素的网络协议或者路由一般遵循资源整合的原则,即将负载流量聚合到一部分的链路或设备中,使空闲的链路或者设备关闭或休眠从而节省网络能耗,但在进行负载流量聚合时要考虑到网络的可用性和QoS,例如限制链路的最大利用率,不能为了单纯的节约能耗而失去网络系统的功能.文献[32]提出了通过对目前链路状态路由协议的修改,如OSPF协议,来实现网络层的节能算法.算法使路由器能够在低负载的情况下关闭部分链路,算法分成3个阶段,第1阶段路由器被选择作为自身最短路径树(SPTs)的输出者,第2阶段被选择的路由器的邻居执行一个修改的Dijkstra算法来检测链路是否可以被关闭,最后阶段计算修改网络拓扑下的新网络路径.数据表明实际的互联网中,60%以上的链路可以被关闭.(2)网络设计和架构在网络架构设计方面现有的研究可以分成两类,一类提出在现有架构下的改进,而一类提出完全重新设计新的架构.文献[25]提出了对实际网络的改进从而实施睡眠机制,在网络边缘将同一个出口的连续流量通过“buffer&burst”整合成突发流,在网络内部实行简单的“wake-on-arrival”策略,这样网络内部节点就在睡眠和工作两个状态之间进行切换.这种策略减少了状态之间的转移,但是增加了端到端的延迟,制造突发流量的间隔时间B控制着性能和能耗之间的权衡.在此基础上提出了一种简单实用的practB&B策略,实验表明在连续流(CBR)和帕累托分布的流量负载和10%的网络利用率下,设置B=5ms能够使网络60%的时间处于睡眠状态并且延迟在5ms以下.文中并没有提出来策略在什么时候进行切换是最优的和睡眠的最优持续时间,并且流量整形对于抖动的影响也没有考虑.文献[33]提出了光网络,光交换不需要缓冲并且能量利用率高.在光网络中信号以光的形式穿过整个网络,直接在光域内进行信号的传输、再生、交换和选路,中间不经过任何光电转换,以达到全光透明性,实现在任意时间、任意地点、传送任意格式信号的理想目标.但是由于光器件技术的局限性,目前全光网络的覆盖范围还很小.互联网节能与体系结构的改进密切相关.美国斯坦福大学的NickMcKeown等教授的研究组提出了OpenFlow的研究课题[34],OpenFlow交换机将原来完全由交换机/路由器控制的报文转发过程转化为由OpenFlow交换机(OpenFlowSwitch)和控制服务器(Controller)来共同完成,从而实现了数据转发和路由控制的分离,这样既降低了网络设备的成本,又节省了管理代价,同时还能有效地实现网络节能.可以看出互联网的结构改革是达到节能目标的一种有效途径.很多网络级节能策略的研究采用优化理论进行分析,优化方法能够在理论上提供指导,使网络设计和改进有章可循,我们将在4.4节中进行详细介绍,本节就不再赘述.4模型方法与评价目前已经有很多的节能机制和策略致力于提高网络的能量有效利用率,从而控制系统的能耗和碳排放量.不同节能策略的效率如何,一般采用测量方法和模型方法进行分析.测量方法通过一定的测量设备从系统测得各项性能指标或者与之密切相关的量,这是最直接、最基本的方法,其它方法也要依赖于测量的基本量或历史统计数据,缺点在于适用于已经存在并运行的系统,比较费时间.而模型方法是通过数学工具建立适当的模型对系统进行抽象,描述能耗与性能、负载之间的关系.可以对已有系统进行评价,也可以对尚未存在系统(系统设计)的性能进行预测,工作量小,缺点在于模型一般基于简化和假设,刻画系统的详细程度较低,参数的确定依赖于对系统测量结果或对参数的估计,与实际性能指标有差距,性能指标的精确性依赖于模型的精确性.本节归纳了网络节能的评价指标,提出了一种可行的绿色评价理论框架,并且在此框架下总结了节能策略的三种模型方法,最后介绍了优化方法在绿色网络中的应用.4.1网络节能评价指标绿色网络能耗效率的合理评价是绿色网络领域亟待解决的严峻问题.人们已经使用随机模型来评价系统的很多属性,同样希望能够刻画网络系统的能耗属性.本节将建立可量化和可操作的能耗评价指标系统,这是网络系统能耗评价的前提和基础.Page10我们需要指出,由于系统固有的差异性和相关性,使用单个指标不能很好地表示系统的整个状态.然而选择不同的指标对评价结果有很大影响.因此,我们需要在制定评价指标的方向上达成共识,以便于系统能耗的交叉比较.传统的评价系统能效的方法是直接基于系统能耗总量或节约的能量进行分析评价.使用这种方法对系统进行比较时,只进行笼统的总量分析,往往有很大的局限性,如处理器.文献[35]中指出处理器的能耗与时钟频率成正比,降低时钟频率可降低能耗,但性能也下降,因此在比较处理器能量效率时,能耗总量不是一个好的度量指标.除了能耗总量的度量指标之外,针对目前研究中已经存在的多数度量指标,我们根据这些指标适用范围,大致将它们分为3类:(1)基于总能耗与有效能耗关系的评价系统运行时所产生的能耗只有一部分用于系统的功能实现上,剩下的能量消耗在系统运行的支撑环节,如冷却、供电设备等.这类指标通过系统的有效能耗与总能耗的关系来进行评价.这类指标的度量主要有文献[36]中的PUE、DCiE.PUE(PowerUsageEffectiveness),即能量使用效率,它的定义如下:其中,TotalFacilityPower是电表测量得到的能耗,它包括电力输送部分UPS、开关、产生器、PDUs、电池和IT设备之外的配电损失;冷却系统部分如冷水机组、计算机房空调单元、直接膨胀式空气处理单元、泵和冷却塔;计算、网络和存储节点;其它部分如数据中心照明等.ITEquipmentPower是数据中心中用于管理、处理、或者路由数据所用的能耗.它包括与IT设备相关联的负载,如计算、存储和网络设备以及补充设备如KVM交换,监控和用于监测或控制数据中心的工作站和笔记本电脑.如果PUE=3.0,它表明该数据中心的实际能耗需求是IT设备所需能耗的3倍.DCiE(DatacenterInfrastructureEfficiency),即数据中心基础设施效率,它的定义如下:DCiE=1如果DCiE=33%,表明数据中心中IT设备消耗的能耗只占总能耗的33%.(2)基于能耗与性能关系的评价这类指标通常是通过衡量系统在完成一定工作任务的能耗来进行评价的.这里对工作任务的定义不是唯一,而是灵活多变的,如CPU利用率、能力、吞吐量、数据传输率等.这类指标的度量主要有ECR[37-38]、EER[38]、ECRW[37]、ERP[39]、TEER[40]、TEEER[41].ECR(EnergyConsumptionRating),即能量消耗评级,它可以通过式(13)进行计算:其中,Ef是系统满负载时消耗的能量(W),而Tf是系统最大的吞吐量(Gbps).ECR的单位为W/Gbps,其物理意义是每秒传输一千兆串行数据所消耗的能量.EER(EnergyEfficiencyRating),即能量效率ECRW(EnergyConsumptionRatingWeighted),评级,它是ECR的倒数,单位为Gbps/W.即加权能耗评级,它可以通过式(14)进行计算:其中,Ef、Eh和Ei分别表示系统在满负载、50%负载和空负载下消耗的能量(W),α,β,γ反应系统运行时混合模式的加权系数.ECRW考虑了空闲模式,它可以作为ECR的补充指标来估算设备的能耗管理能力.根据Barros[5]的按比例能耗计算的原则,一个理想系统的ECRW评级应等于0.55×ECR,而一个拥有边缘能耗管理能力的系统所实现的ECRW评级,理想上应该接近ECR.ERP(Energy-ResponseTimeProduct),即能量-响应时间积,它可以通过式(15)进行计算:其中,EE[P]和EE[T]分别表示系统的平均能耗和平均响应时间.当系统的性能被定义为平均响应时间的倒数时,ERP指标就和上述EER指标一样了.TEER(TelecommunicationEnergyEfficiencyRatio),即通信能耗效率评级,它可以通过式(16)进行计算:其中,UsefulWork可以根据设备功能的参考标准定义,如数据传输率、吞吐量、每秒处理量等,而Power是设备能耗的测量值.TEEER(TelecommunicationEquipmentEnergyPage11EfficiencyRatio),即通信设备能耗效率评级,根据不同类型的设备选择的计算公式如表2.TransportSwitch/RouterMediaGatewayAccess当然,基于能耗和性能关系的评价除了使用上述度量之外,还可以使用能耗与性能的加权和作为度量,如文献[15]中使用了EE[T]+EE[E]/β,其中T和E分别是一个任务的响应时间和能耗,而β控制着延迟的相对成本.(3)其它评价指标除了上述2种类型的指标外,还有其它一些指标,我们简单介绍EPI[42]、W/ft2[43].例指数.它可以通过式(17)进行计算:EPI(EnergyProportionalityIndex),即能量比其中,M是系统在满负载状态下消耗的能量,I是系统在空闲状态下消耗的能量.EPI的单位是百分率,它刻画了能耗与负载的正比例关系.当EPI为100时,能耗和负载达到最佳正比例关系,而EPI为0时,能耗对负载完全不可知.W/ft2,即能耗密度,它通过系统的总能耗除以系统所占用的空间体积计算所得.上述的3类指标之间以及同一指标中的不同度量并不是相互孤立的,有时我们需要把它们联系起来评价系统的能耗属性.如第2类指标(ECR、EER、TEER和TEEER)都无法刻画系统的能耗和负载之间的按比例程度[6],但第3类指标中的EPI却可以基于空闲状态下的能耗和满负载状态下的能耗来评价该按比例程度.同样,第2类指标中的度量ECRW作为ECR度量的扩展,它在量化系统的能耗效率时考虑了多种负载(零负载、半负载和满负载).上述能耗指标系统不仅有利于绿色网络的研究,而且对工业也有帮助,如它可以指导制造商和服务提供商在基础设施的部署和购买上做出更有效的决定.4.2绿色评价框架模型方法为评价网络节能机制提供了数学工具和理论手段,面对复杂的网络系统和多重性的评价指标来说,仅仅采用单一的模型方法是不够的,我们需要建立系统的绿色评价理论体系,综合使用多种模型方法,使他们能够互相结合和补充.所以绿色网络面临的一个重要挑战是如何建立一个系统的评价体系,提供自上而下的方法分层次分粒度地评价各种节能机制和策略.本节根据前面绿色网络的研究工作,提出了绿色评价的概念,并总结了绿色评价应包含的内容,构建了网络节能机制评价的框架.绿色评价是利用模型方法通过对绿色网络中的节能机制和策略进行建模描述和分析求解的评价体系.具体来说,绿色评价将系统资源的状态作为评价的基础,通过用模型方法描述资源状态及其之间的转移,从而求解出各种评价指标.4.2.1评价基础:系统资源状态对系统资源状态的分析是绿色评价的基础,对状态的研究不仅涉及状态自身,还包括对应的系统参数、能量消耗和系统资源利用率相互关系的研究.绿色网络的各种机制定义了系统的不同状态,状态之间是离散的,不同的状态组成了一个状态集合:S={Si|i=1,2,3,…}.在4.1节中可以看到系统能耗是绿色评价的重要指标,基于在第2节对不同系统的能耗模型的分析和第3节对节能机制和策略的研究,我们得到系统平均功耗的定量计算公式如下:P=∑i∈S对于系统状态集合的每一个元素Si,首先计算该系统状态下的平均功耗Pi和稳态概率Pr(Si),Pi可以通过式(4)或直接测量得到.然后计算以Si为目的的状态转移所产生的转移功耗Pji和转移概率Pr(Sj,Si),其中Di表示以Si为目的的转移的起始状态的集合,如图5所示.图中uji表示从状态Sj到Si的转移速率,那么从状态Sj到Si的转移概率为Page12在计算系统的瞬时功耗时,形式和式(18)是一样的,区别在于Pi为系统在状态Si下的瞬时功耗,Pr(Si)为状态Si的瞬时概率,Pji表示转移功耗,Pr(Sj,Si)表示转移概率.在计算系统一段时间内的能耗时可以利用式(18)和式(1),用系统的功耗对时间进行积分得到.4.2.2评价手段:模型方法利用模型方法能够清楚地分析状态及之间的转移,模型方法主要包括各种随机模型方法,例如排队理论、马尔卡夫过程、随机Petri网、随机进程代数等,这些方法易于对网络系统状态进行有效的描述,精确刻画网络系统的各种随机行为及各个组件之间的关系,便于计算能耗指标.目前来说,大部分模型假设利用指数分布,而对于具有其它分布的随机模型及其求解有着一定的困难.另一方面,基于状态模型的求解通常会导致状态空间爆炸的问题,但目前已经有多种方法来解决这一问题.综上所述,我们总结网络节能机制的评价的基本内容,给出绿色评价的框架模型,如图6所示.4.2.3评价中的几个基本问题首先是评价的多指标问题,在进行绿色评价时,会涉及多指标评价的问题.在不同的节能速率缩放机制的设计中,机制的最优性、公平性和鲁棒性成为评价算法的主要3个指标.这3个指标又是矛盾的统一体,想要同时满足所有指标的要求是非常困难的,例如在最短剩余时间调度算法(SRPT)中,任务的公平性就难以实现.因此,需要在具有矛盾性的指标之间寻求最佳的权衡.性能评价涉及评价的时间尺度,在进行绿色评价中,通常会选取一定的时间间隔作为评价的时间尺度,而t的选择对评价结构会有一定的影响.如果t很小,那么,结果代表了瞬时能耗,即功耗,如果t较大,评价结果代表能耗长期的平均值,能够反映相对稳定的变化规律.而只评价系统的总能耗或者瞬时能耗不能完整地反映系统的特性,尤其是当负载存在突发特性时,系统的瞬时能耗可能偏离于平均能耗而产生抖动,所以在评价时需要同时考虑两个时间尺度.4.2.4评价与优化绿色网络的再造过程是一个循环的过程,通过模型-评价-优化-实施-评价-再优化这个循环逐步改进绿色网络的机制和策略.在这个过程中评价和优化是密不可分的,优化是评价的目的,评价为优化提供基础,在优化模型中一般包含两个主要元素,优化目标和约束条件,而约束条件中的刻画系统的参数往往是不确定的,需要用随机变量表示.通用的优化形式可以表示为其中z(x)为目标函数,x为系统参数的随机变量,fi(x),gi(x),hi(x)为系统的约束条件,如系统吞吐率、延迟、负载均衡等,这些变量可以通过模型分析和求解用一阶矩、二阶矩等形式进行描述.在实际应用中会用到式(20)的对偶形式,它们之间是同构的,可以进行最大和最小目标形式的转换.优化模型中随机变量的存在增加了分析和求解的难度,而模型分析和评价的结果可以刻画随机变量,为优化模型中精确的系统描述提供依据,所以说评价是优化的基础.4.3模型评价方法本节我们将总结多种模型和分析方法,主要包括排队模型、马尔卡夫过程模型以及随机Petri网,这些随机模型为绿色评价提供了有力的手段.4.3.1排队模型排队论又称随机服务系统理论,主要用来研究一个系统对一个群体提供服务时,系统所呈现的各种状态,它是进行计算机系统网络和系统的模型描述、性能分析和评价的重要手段.网络系统可以看成一个顾客-服务员的排队系统,将能量因素加入服务策略中,通过服务策略对顾客进行调度和提供服务.这里的服务员可以是网络系统中提供服务的某个独立功能的节点,如终端、链路或者设备,也可以是某层的网络协议.服务策略的制定影响系统状态的变化,使系统服务时间的分布呈现出一定的规律.采用经典的排队模型进行模型的描述和分析是描述绿色Page13网络机制和策略的重要手段.应用广泛的节能机制要实时做出两个决策:一是通过任务调度策略决定服务规程,二是通过状态控制器决定服务状态,如图7所示.文献[44]用排队模型和动态规划分析了3种速率控制策略:静态速率、门限静态速率和动态最优速率选择算法,评价了不同算法的能耗和对性能影响的上下界.文中将系统看成是一个M/G/1PS的队列,将式(6)的能耗函数简化为P(s)=sα,并假设最优的动态速率是凹函数且当α=2,n2γ时,推导出系统的最优速率sn满足γ+n-2槡γsn其中γ是一个无量纲的参数,表示负载对于系统的影响,n表示系统队列状态,β是性能和能耗的权衡参数.通过式(21)进行最优速率的选取从而制定节能策略.在此节能策略下,将能耗和延迟作为目标函数进行评价,即其中T为单个任务的系统响应时间,E为单个任务的系统能耗,假设任务到达服从泊松分布,λ为任务到达的速率,根据Little公式和式(6)、式(22)可以表示为通过计算可以得到目标函数的上下界为max(γα,γα(α-1)1()α-1)zzgz=其中T为时延,E为能耗,zgz为门限静态策略的成本.文献[4]进一步分析了共享处理器策略(PS)和最短剩余处理时间策略(SRPT)对于速率缩放机制的影响,指出速率控制和任务调度策略是相互独立的,而且在考虑能耗时任务调度比起速率控制来说并不十分重要,例如最坏情况下,PS在以能耗和时延的线性组合目标下是O(1)-competitive,而仅仅考虑时延,不考虑能耗因素下PS是Ω(ν1/3)-competitive,ν表示任务数量.同样的,在随机分析中,SRPT和PT几乎没有差别.无论是M/M/1还是M/G/1,都假设队列无限长,无法计算丢包率,所以要考虑队列长度对性能的影响.在无法确切得知到达分布和服务分布时,通常采用一般的G/G/1/N队列模型,在G/G/1/N模型下,我们可以得到丢包率的上下界,文献[45]分析了在工作频率为fc下的丢包率,其满足pmaxc(fc)pc(fc)pminc(fc)=max0,λc-μc(fc)利用Bernstein不等式计算出上界为其中λc、σc是刻画负载特征的,μc(fc)为工作频率fc下的服务速率.利用式(25)和(26)可以算出在丢包率约束情况下,fc的最佳值.根据负载的情况系统在工作频率fc下系统有两个状态:空闲和活跃,根据式(18),忽略状态转移能耗可以得到fc下的能耗为c(fc)=Pridleidle(fc)+(1-Pridle)active(fc)(27)系统空闲的概率Pridle与系统最大处理能力和负载的比值有关,在G/G/1/N队列中,根据式(27)和(28)得到系统能耗的上界为c(fc)~idle(fc)+λc[1-pminc]虽说排队模型可以刻画系统所处的各种状态,其缺点在于,不能精确地描述状态的转移,由于状态转移带来性能和能耗的损失无法描述.而且目前的分布都是根据假设,例如泊松到达和服务时间的指数分布,与实际的系统有一定的差别.4.3.2马尔卡夫过程模型在基于马尔卡夫过程的随机模型中,可以方便地刻画系统状态的变化规律和评估系统的性能参数和节能指标.马尔卡夫链和马尔卡夫回报模型已经被广泛地应用在节能策略的设计和评价中.Page14文献[46]中将请求到达模拟为随机过程,使用平稳马尔卡夫模型来预测空闲区间,并使用随机优化来决定关闭某个组件的时机.对于非平稳请求,Chung等人在文献[47]中通过预估系统运行时请求的到达率,预算不同请求到达率下的优化方案,当实际到达率发生变化时也能通过在最近的优化方案中进行插值得到.前两种方法都使用了离散马尔卡夫模型,其缺点是只能进行定期的管理决策.为了使组件能在任何时间关闭,Qiu等人在文献[48]中使用了连续时间马尔卡夫模型.在应用服务速率缩放机制的网络系统中,策略的决策参数一般是系统队列的长度,所以用队列长度、服务状态等相关参数的组合作为系统状态的描述.通过一维或者多维的离散状态马尔卡夫链进行状态转移分析,从而得到能耗以及系统吞吐量、丢包率、延迟等值,量化评价节能策略.文献[29,49-50]分析了3.2.1节中单阈值和双阈值的自适应链接速率策略.首先结合M/G/1队列对系统进行描述,假设到达服从泊松分布,到达速率为λ,包大小符合i.i.d指数分布,U={u1,u2,…,un}为服务速率的集合,根据Little公式,对应于一个服务速率u的服务利用率为λ/u,通过以队列长度为状态的一维马尔卡夫模型进行分析,如图8所示,求解得到不同状态下的稳态概率Prn:烄ρ+ρ/ρ1-1ρn-k+2-1-ρPrn=烅烆图9加入转移成本和队列长度的双阈值节能策略然后根据式(18)和式(30)进而可以计算出系统的平均功耗和节省的功耗.以上的模型存在的问题在于:未考虑速率转移时间和代价;假设队列无限大,只考虑延迟未考虑丢包.将转移成本和队列长度加入马尔卡夫模型[51]可以解决以上两个问题,其假设速率转移的时间分布是i.i.d指数分布,定义uHL和uLH分别为从高速率到低速率或者反方向的平均转移速率,其倒数为平均转移时间.定义4种状态:Si=0|i=1,2,3,4,并用二元组(S,R)表示,其中(0,1)系统处于高速率服务状态下,(0,0)系统处于低速率服务状态下,(1,0)系统处于空闲转移状态,且从低速率转移至高速率,(1,1)系统处于空闲转移状态,且从高速率转移至低速率.在二元组中加入队列长度变量N,用(N,S,R)根据式(18)得到系统的功耗为构造马尔卡夫链如图9所示.通过稳态分析得到不同状态的稳态概率Pr,再Page15Pcons=PL∑NPS∑N其中PL,PH,PS分别表示系统处于高速率状态、低速率状态和状态转移时的功耗.然后计算没有采用节能策略时的功耗PH,得到节省的功耗Psave为n=THL+1通过以上的分析可以看出马尔卡夫过程模型是进行节能策略分析的有力模型工具,但存在一些问题,例如在双阈值策略中会产生状态抖动问题,对性能有一定的影响,为了减少状态抖动,文献[29]采取了两种方法,这两种方法都引入了时间参数,但马尔卡夫过程模型不能引入时间参数.而且马尔卡夫过程模型可扩展性差,一旦实际系统资源变化,相应的模型变化就会比较大.所以利用马尔卡夫过程模型进行分析和评价有一定的局限性,需要多种模型相互结合才能真实完整地刻画实际系统.4.3.3随机Petri网模型基于马尔卡夫过程的随机模型只能为一个简单的能量管理系统提供模型分析,不能有效直观地反映系统各个部件之间的相互关系.对于一个复杂的系统来说其本身组件数量多,结构关系复杂,其行为也错综复杂,想要建立马尔卡夫模型是一件较难的事情.而且基于状态的随机模型直接涉及模型状态,很难从实际系统的行为状态中获得.而基于模型的高级随机模型具有较强的描述能力.目前已有多种高级随机模型方法开始应用到网络系统能耗的评价分析中,例如随机Petri网、随机高级Petri网、随机进程代数、随机活动网等.下面我们将以随机Petri网为重点,说明高级随机模型在系统节能机制和能耗评价中的应用.随机Petri网(StochasticPetriNets,SPN)作为网络系统描述和建模的重要数学工具,能够较好地刻画复杂的系统行为,尤其是并发、同步、互斥和冲突行为.虽然随机Petri网具有马尔卡夫性,可以转换为等价的马尔卡夫模型进行分析,但对于一个系统设计者来说,用随机Petri网比直接使用马尔卡夫模型更容易描述系统行为特征.随机Petri网以研究模型系统的组织结构和动态行为为目标,着眼于系统可能发生的各种状态变化以及变化之间的关系.同时Petri网是动态的图形工具,它的结构元素包括位置、变迁和弧.位置用于描述可能的系统局部状态,例如队列、缓冲、资源等.变迁用于描述修改系统状态的事件.弧使用两种方法描述局部状态和事件之间的关系:指出时间能够发生的局部状态;由事件所引发的局部状态的转换.在随机Petri网模型中,标记是包含在位置中的一种标志,随着事件的发生,标记可以在不同的位置中按照弧的方向流动,从而动态描述系统的不同状态.在不断的研究过程中,随机Petri网得到了很大的发展和补充,例如可简化系统状态空间的广义随机Petri网(GSPN);用户报形式表达系统性能测量的随即回报网(SRN)以及将指数分布的变迁实施时间变量引入到高级Petri网中的变迁集中的随机高级Petri网(SHLPN)等.利用随机Petri网的有关理论对绿色网络系统的节能问题进行建模,并通过随机Petri网与马尔卡夫过程同构的特性,可以求解绿色网络模型的节能参数.应用随机Petri网进行绿色评价,可以按照以下步骤进行:1.针对特定绿色网络系统建立描述系统性能的SPN模型;2.建立系统的能耗SPN模型,它描述资源状态的变化过程.将前面性能模型中表示资源的相应位置扩充至不同的能耗状态,并添加相应的变迁和相应的实施规则以及能耗成本.其中能耗状态转移成本与标识的变迁相关联,不同的服务速率能耗成本与不同的标识相关联.3.简化SPN模型结构,求出可达图及相应的马尔卡夫链;标和性能指标.4.计算各状态瞬态和稳态概率,从而求出各种能耗指基于我们之前关于无线传感器网络的睡眠调度机制的研究[12]为例,具体说明随机Petri网在绿色评价中的应用.根据传感器睡眠深度的不同,我们将节点分成4种状态,如表3所示.状态CPU状态传感元件状态接收器状态S1S2S3S4根据表3中的4种状态,可以将无线传感器的睡眠调度策略对应分成4种,即全部活跃调度策略(ACAA)、传感元件和接收器保持活跃调度策略(SRAA)、传感元件保持活跃调度策略(SAA)、无保持活跃调度策略(NCAA),每一种策略的睡眠深度逐渐递增.Page16对于任意一个传感器节点,我们假设节点会遇到两类事件:TE事件(其它节点试图与该节点通信)和HE事件(该节点感知到外部事件)首先我们使用SPN对上述4种睡眠调度策略进行建模,根据所得的模型分析系统的能耗和性能.由于篇幅的限制,我们只给出ACAA策略和NCAA策略的SPN模型.对于ACAA策略,传感器节点的所有部件一直都处于活跃状态,所以节点一直保持在状态S0,该策略下事件几乎没有延迟,但消耗的能量最多.ACAA的SPN模型如图10所示.对于NCAA策略,节点的每个部件并没有一直活跃着,而是大部分时间处于休眠状态.当节点处于休眠时期时,它不会监测任何SE事件或TE事件,直到休眠期结束.该策略下事件延迟最大,但消耗的能量最少.NCAA的SPN模型如图11所示.在上述两个SPN模型中,我们使用位置来表示传感器节点的状态,使用变迁来描述事件的到达或节点的处理措施.模型中的位置、变迁的具体解释如表4所示.位置/变迁S0~S3PoNTE/PoNSETE/SE事件没发生的状态TTE/TSEPoTE/PoSETE/SE事件等待处理的状态THTE/THSETE/SE事件的处理事件服从指数分布Po1T5,T6,T7TSL/TSL2TSW1,TSW2,TSW3Po0T2,T3,T4在图11中的SPN模型中,我们在变迁T3处使用了抑制弧[52].抑制弧虽然不能提高SPN的模型能力,但它可通过减少定义的位置和变迁的个数来简化系统运行的描述.根据SPN模型,我们可以分析得到可达图和等价的连续时间马尔卡夫链,通过求解得到平均功耗.首先计算稳态下不同状态Si的Token期望值:其中Mj(Si)表示在标识Mj下Si状态下的Token数量.在图10中,由于节点一直处于S0位置,所以稳态下TK{S0}=1;在图11中,由于位置Po0和Po1都关联着瞬时变迁,所以TK{S0}+TK{S1}+TK{S2}+TK{S3}=1.因此,稳态下TK{Si}的值恰等于节点处于不同状态Si下的概率.根据2.2节关于系统资源与能耗的关系,得出不同状态Si下的功耗Pi以及状态Si转移到Sj的转移功耗Pij.针对任意一种调度策略,根据式(18)可求解平均功耗为P=∑i∈{sleepschedulingscheme}Pi×TK{Si}+∑j∈Di4.4绿色网络中优化算法设计现有的节能策略的设计往往采用启发式算法,没有严格的理论支持,导致在实施之后进行补丁式的改进.而优化方法[53]为设计绿色网络和节能策略Page17提供了有力的理论支持,以优化理论为出发点对网络系统进行建模分析,可以指导节能策略的设计,使网络尽可能具有性能和能耗的最优权衡.在应用优化理论指导节能策略的设计时,首先在模型方法的基础上深入分析这些系统模型中所有的参数和变量,得到策略设计目标和约束与优化模型的对应关系,而且可以将节能策略中的能耗问题映射到一些经典的数学问题或优化问题,如多物网络流问题、背包问题等.然后对该问题进行形式化的描述并建立详细的数学模型,最后针对模型进行求解,给出评价指标和复杂性分析.在进行形式化描述时,可以按照目标的数量将其分成单目标优化和多目标优化两类,单目标优化是对某一指标而言,将其它的属性作为限制.如果考虑的指标有多个,就需要用多目标优化.单目标优化和多目标优化可以相互转化,多目标通常利用加权归一或添加约束的方法转化为单一目标,而带约束的单目标优化也可利用惩罚函数,转换为多目标的加权形式.在明确知道系统性能和QoS约束的情况下,可以采用单目标优化,将最小能耗作为目标,性能或QoS等条件作为约束条件,从而得到在可容忍的性能损失下的能耗优化问题.文献[7]将速率缩放机制应用到连续流到达网络系统的优化算法表示为整数线性规划问题.定义需求为i(大小为di),其沿单路径由si至ti,能耗函数为f(s),目标为满足需求i时使链路能耗最小,即寻找满足需求i的路径,使∑ei在链路e上的流量,根据式(20)用形式化描述为在不明确系统性能或QoS约束的情况下,可以采用多目标优化,在目标函数中加入加权权衡因子,权衡性能和能耗之间的关系,如文献[44]的目标形式为其中fe(x)为能耗函数,fp(x)为性能函数,β为权衡因子,使该算法具备了调节能耗/性能的能力.节能策略中很多优化问题是NP-难问题,在多项式时间内收敛的优化算法目前不存在,解决此类问题一般可以分为两个步骤:规约和近似.规约是为了证明该问题是NP-难问题,如果能够证明一个NPC问题能够在多项式时间内规约为一个给定问题,则给定问题即为NP-难问题.文献[54]中证明了数据中心网络的最小能耗调度问题是NP-难问题,这类问题是典型的资源受限问题,可以由0-1背包问题规约,且规约过程在多项式时间内完成.要在有限的时间内实施优化算法,通常采用近似算法、贪婪算法、原-对偶方法、随机方法和智能算法等常用的近似算法.文献[7]中的路由最小能耗问题可以转换为一个整数规划的优化问题,并且如果能耗函数f(s)是随着传输速度s次可加的,那么路由最小能耗问题就可以转化为buy-at-bulk网络设计问题.文中给出了可以获得近似度为O(logN)2的复杂度上界为Ω(log1/4N)的随机近似算法.文献[55]将数据中心的调度问题转化为线性规划问题,并用快速多项式时间算法进行求解,得到在有N个请求源和C+1个服务器时,算法的最坏情况的时间复杂度为O(N(C+1)2(logN+(C+1)log(C+1))).智能方法中的启发式算法是近似求解中一种常用的方法.文献[54]中将数据中心网络的调度问题转换为等价的0-1背包问题,在进行近似求解时采用了启发式路由算法,算法的输入为三元组(G0,犜,PR),G0表示数据中心网络的拓扑,犜表示负载的流量矩阵,PR表示性能阈值.算法分为3个部分,路由生成(RG)、吞吐率计算(TC)和节点消除(SE).RG的功能是选择数据流的路由使得整个网络的吞吐量最大.TC用来计算现有网络拓扑下的系统吞吐量,应用Max-MinFairness模型对所有流的吞吐量进行求和.SE选择路由中可以删除的节点.在应用优化算法进行节能策略的设计时应注意一些问题,例如如何准确将具体问题进行建模描述的问题,因为实际的节能策略不能“完美”地映射到数学上的经典问题,往往需要假设,所以在建模过程中需要考虑模型是否能真实地反映实际系统,这样模型分析得到的结果才能有实际的价值.文献[56]通过云计算中的多种资源融合实现资源的最小化分配,其将资源分配问题映射成多维度装箱问题求解,服务器映射成箱子,处理器、硬盘和网络等资源是箱子的各种维度,而各个维度的大小用能耗利用率来表示,每一个给定资源利用率的寄宿程序被看作已知各个维度大小的物体被放入箱子,最小化能耗问题转换为最小化箱子的数量.但是和一般的装箱问题不同,其需要考虑以下两个因素的影响,首先性能没有作为物体的一个维度考虑,当两个物体包装在Page18一起时,它们的性能(如吞吐率)会受到影响,而性能的降低带来无用能耗的增长,所以最小化箱子的数量未必能最小化能耗.其次在一般的装箱问题中,假设最优箱子的数量是n,那么在填满n-1个箱子后,将一个尺寸较小的物体放入第n个箱子是最优算法,但是在实际的问题中,不同的箱子分配方法对能耗的影响不同,所以在应用优化算法时应紧密联系实际,在客观地反映实际问题的同时能够对实际应用起到指导作用,产生真正的价值.5总结本文综述了绿色网络中的节能机制和策略,并将节能问题归结为资源管理问题,从资源分配、任务调度、架构部署3个方面进行阐述.随机模型能够较好地刻画和描述不同的节能机制和策略,是构建和评价绿色网络的重要理论工具.不同的模型评价方法一方面能够准确地表达系统各个参数之间的关系,对节能机制和策略进行定量的分析和数值计算,另一方面能够为系统优化提供依据,使系统从设计到改进都有章可循.基于随机模型,本文提出了绿色评价框架,为构建节能机制和策略的评价体系奠定了基础.在模型分析的基础上,本文结合优化方法对节能机制和策略中的一些问题进行抽象和形式化描述,将其转换为一些基本的优化问题进行求解,力图找到能耗和性能的最优权衡.进一步解决:绿色网络和绿色评价目前还存在很多问题需要(1)节能策略的多目标问题.网络节能技术的研究需要结合具体应用背景和实际需求,通过研究系统可用性、可靠性、可生存性等系统属性与能耗之间的关系,使系统各种目标之间相互融合,统一表达.(2)节能策略的部署问题.策略复杂度高会带来实现成本高、不易部署的问题;而策略简单,成本低,部署容易,但鲁棒性会有所降低,所以在策略设计时应根据上下文分析各个因素,找到最优的权衡.(3)模型描述的精确性.在对策略进行建模时往往忽略某些因素(如状态转移成本),不能精确地反映系统状态.而且不同的模型方法各有利弊,应针对具体问题选择某一种模型方法或者几种模型方法的结合.(4)网络能耗优化问题.目前能耗优化问题的求解上多数采用启发式算法,还存在很大的改进空间,而且网络优化理论本身存在很多难点,例如基于状态的动态规划状态空间的化简等,尚待解决.
