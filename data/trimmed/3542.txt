Page1一种基于主动轮廓模型的心脏核磁共振图像分割方法刘利雄马忠梅赵恒博姚宇华张麒(北京理工大学计算机学院智能信息技术北京市重点实验室北京100081)摘要提出一种基于主动轮廓模型的左室壁内、外膜分割方法.首先构造了主动轮廓模型的广义法向有偏梯度矢量流外力模型GNBGVF,作为对梯度矢量流(GVF)的改进,该外力场同时保持了切线方向和法线方向有偏的扩散,具有捕捉范围大、抗噪能力强,且在弱边界泄漏等问题上性能突出.就左室壁内膜的分割而言,考虑到左室壁的近似为圆形的特点,引入了圆形约束的能量项,有利于克服由于图像灰度不均、乳突肌等而导致的局部极小.对于左室壁外膜的分割,采用内膜的分割结果初始化,即通过重新组合梯度分量来构造外力场.该外力场能够克服原始梯度矢量流的不足,使得左室壁外膜边缘很弱时也能得到保持,可以自动、准确地分割外膜.实验结果表明,该方法能高效准确地分割左室壁内、外膜.关键词心脏核磁共振图像;图像分割;主动轮廓模型;广义法向有偏梯度矢量流;形状约束1引言心脏核磁共振成像MRI(MagneticResonanceImaging)能够提供高分辨率、高品质的图像,对心脏的解剖结构和功能进行准确的描述,是当前医学图像分析领域的研究热点之一,也是心脏疾病诊断的重要辅助手段,对心血管疾病的早期无创诊断和准确预后评估具有重要意义.为了充分利用图像中的解剖信息,为临床诊断提供量化、直观的参考,首先必须分割出左室壁的内、外膜[1-2].然而,由于心脏的运动和血液的高速流动,图像受噪声干扰,使得心脏MR图像的分割仍是一个值得深入研究的问题.近年来,对心脏MR图像的分割国内外都有广泛研究,这些方法大致可以分为基于形态学的方法[3]、基于模糊聚类的方法[4]、基于模板的方法[5]以及基于主动轮廓模型的方法[6-8]等.主动轮廓模型能够将有关目标形状的先验知识和来自图像的知识融入一个统一的过程中,是当前图像分割领域的热点方法,也是心脏MR图像分割中的主流方法,如Sid-diqui等人[9]基于几何主动轮廓模型采用一条初始轮廓线同时分割出了左、右心室的内膜.Hong等人[10]采用基于Lagrange动力学的B样条Snake模型来提取左室壁内膜.Makowski等人[11]采用气球Snake模型来分割左室壁内膜,设计了专门的方法来解决轮廓缠绕问题.Jolly[12]首先采用极大鉴别分析方法来找到左室壁内膜的大致轮廓,并用Snake模型提取左室壁内膜.Nguyen等人[13]对传统Snake、梯度矢量流GVF(GradientVectorFlow)Snake和气球Snake模型分割左室壁内膜的结果作了比较,并与手工勾勒的轮廓进行对比验证,其中,GVFSnake模型性能最好.Nachtomy等人[14]提出了一种基于阈值的方法提取左心室内、外膜,但由于阈值的局限性结果并不令人满意.Pednekar等人[15]针对图像的模糊特点,提出了一种基于模糊分析的左室壁内、外膜分割方法.国内对心脏图像的分割也有相关研究,如周寿军等人[16]用梯度矢量流Snake模型分割左心室时,引入广义模糊集合理论,提出了广义模糊梯度矢量流.秦安等人[17]将广义模糊梯度矢量流与几何主动轮廓相结合来分割左心室内膜,然后采用一种区域灰度均值和距离约束的外力来分割左心室外膜.周则明等人[18]将简化Snake模型用于心脏图像分割,并用贪婪算法求解能量泛函的局部极小点.王元全等人[19]提出了一种基于GVFSnake模型的分割策略,引入了形状约束,提出了一种基于退化最小曲面梯度矢量流(dms-GVF).目前,心脏左心室内、外膜分割存在以下难点:首先,心脏MR图像在成像过程中由于受血液流动的影响,会在血池中产生伪影,使得图像灰度不均;其次,目标边界往往受到乳突肌,肺部呼吸等因素的影响而变得模糊不清甚至边界断裂;另外,由于左心室与右心室及周围其它组织如肝脏等灰度非常接近,形成弱边界,这时基于主动轮廓模型的方法分割左心室外膜时往往发生泄露.针对这些问题,本文提出了一种基于GVF的各向异性扩散和形状约束Snake模型的分割方法.首先构造了广义法向有偏梯度矢量流外力模型GNBGVF(GeneralizedNormallyBiasedGradientVectorFlow),作为对梯度矢量流(GVF)的改进,该外力场捕捉范围大、抗噪能力强、且对弱边界泄漏有更好的鲁棒性.分割左室壁内膜时仍然采用圆形形状约束[19],圆没有方向性,相应的约束可以耦合在主动轮廓的能量泛函中.分割外膜时挖掘了左室壁内、外膜形状上的相似性,构造了一种新的形状能量;根据左室壁内、外膜位置上的相关关系,构造新的边缘图来计算新的外力场,并采用内膜分割结果来初始化,实现外膜的自动分割.采用这一策略可以高效、鲁棒、准确地同时分割左室壁内、外膜.2基于各向异性扩散的Snake模型外力场2.1Snake模型的基本原理Snake模型是一种自顶向下的图像分析方法,具有传统方法无法比拟的优点.Snake模型可以用曲线c(s)=(x(s),y(s))(s∈[0,1])来定义,这是以归一化弧长s作为参数的曲线表达形式.它通过极小化如下的能量泛函来确定目标轮廓:Esnake=∫1其中,α和β为弹性和刚性系数,控制着弹性和刚性能量的大小;一阶导数项cs刻画了曲线的连续性,是曲线的弹性能量;二阶导数项css刻画了曲线的光滑性,是曲线的刚性能量.这两导数项构成Snake模型的内部能量.Eext(c)是Snake模型的外部能量,它吸引Snake轮廓朝目标运动.根据变分法原理,能量泛函式(1)的最小化可以通过求解如下Euler方程Page3得到当式(2)的解收敛时,就得到了待分割目标的轮廓.这时,可以将Snake轮廓的运动过程看成其内、外力的平衡过程其中,Fint=αcss(s)-βcssss(s)称为Snake模型的内力,Fint=-Eext称为其外力.Snake模型已经提出了20年,其理论发展相对成熟,但在特定问题的应用上,其效率和性能并不总是令人满意.2.2广义法向有偏梯度矢量场模型外力在Snake模型的演化中起决定性作用,对外力的研究是Snake模型研究的一个重要方面.由于式(2)定义的Snake模型外力场是基于图像梯度的,因此其捕捉范围小,不能进入深度凹陷区域,初始化敏感.针对这些问题,Xu和Prince提出了用梯度矢量流(GVF)场作为新的外力条件代替式(2)中的Eext来约束动态轮廓线[7],并将其定义为V(x,y)=[u(x,y),v(x,y)],满足下列能量泛函的最小值:ε=∫∫μ|V|2+|f|2|V-f|2dxdy(4)μ为权重系数,f是边缘图,可以由其它边缘检测算子得到或者用图像梯度来近似.使用变分原理,GVF场可以通过解下列欧拉方程获得其中Δ为拉普拉斯算子.作为主动轮廓模型中最成功的外部力场之一,GVF模型扩展了边缘映射的梯度向量,同时通过一个各向同性的扩散过程来抑制噪声.GVF的扩散过程依赖于拉普拉斯算子,对图像f(x,y)而言,其拉普拉斯算子为这是在迪卡尔坐标系下的表达方式,那么在Gauge坐标系下则可写为其中,fTT为沿切线方向的二阶导数,fNN为沿法线方向的二阶导数.尽管GVF已经取得了巨大成功,但仍有改进的余地[20-25].文献[24]提出的NGVF模型是对GVF的一种改进,它从插值的角度出发,把GVF看成一个插值的过程,认为从插值的角度来说[26],fNN是最好的插值算子,Δf其次,fTT是最差的.其模型如下:然而,从GVF的扩散过程来分析,GVF并不是一个插值的过程,而是一个逼近的过程[27].同时扩散分解的理论告诉我们,沿切线方向的扩散有助于去除噪声并保持边缘[28].基于这样的考虑,我们曾提出了法向有偏梯度矢量流(GNBGVF)模型[25],该模型保留了切线方向的扩散,但是对法线方向的扩散进行加权,使得在边缘附近法线方向的扩散减弱,平坦区域的扩散增强,这样有利于保持边缘,去除噪声并扩大捕捉范围.NBGVF通过如下的方程得到ut=μ(uTT+g(|f|)uNN)-(u-fx)|f|2=0烅烄vt=μ(vTT+g(|f|)vNN)-(v-fy)|f|2烆在此基础上,通过对拉普拉斯算子的扩散过程的进一步分析,我们提出了一种新的外力场:广义法向有偏梯度矢量流GNBGVF(GeneralizedNormal-lyBiasedGradientVectorFlow)模型,该模型除了保持NBGVF的优点外,还能根据图像结构信息调整切线和法线方向的扩散过程,具有更大的灵活性.GNBGVF模型如下:ut=μ(h(|f|)uTT+g(|f|)uNN)-烄烅vt=μ(h(|f|)vTT+g(|f|)vNN)-烆其中,g(·)仍为偏差因子,它是关于|f|的单调递减函数,相应地,h(·)是关于|f|的单调递增函数.当|f|很大时,即在边界处,g(·)→0,h(·)→1,则沿法线方向的扩散消失了而沿切线方向的扩散被保持,有助于保持弱边缘,同时消除噪声,GNBGVF就被简化为NBGVF.当|f|=0时,即在平坦区域,g(·)→1,h(·)→0,GNBGVF就被简化为NGVF.此外,当g(·)→1/2,h(·)→1/2时,这时的外力模型就简化为GVF.这里k是一个可为特定应用而调整的常量,它决定着要保持的边缘对比度.当需要保持的边界是弱边缘,这个值很小,反之亦然.3左室壁内、外膜的分割为了克服血液的高速运动冲撞心肌壁造成的伪影(artifact)等引起的图像灰度不均以及乳突肌干Page4扰等对心脏MRI的影响,我们既需要考虑曲线的光滑性,也需要考虑目标的整体形状.整体形状是一种全局性的约束,有利于克服图像中的噪声.但Snake模型内能只能约束曲线的连续性和光滑性等局部性质,且由于缺乏关于目标形状的全局信息而不能有效地刻画目标的形状.考虑到左室壁内、外膜的形状特点,我们引入圆形能量约束项[19],使得Snake轮廓在演化过程中其全局形状得到保持.该能量项如下:Ecircle=λ烅其中,λ为权重因子,Rx(s,x(s))=x(s)-∫1烄Ry(s,y(s))=y(s)-∫1R-(X,Y)=∫1若xc=∫1烆以认为是Snake轮廓线的质心,(xc,yc)和R-是随着Snake曲线演化而动态变化的.Ecircle这一能量就度量了Snake轮廓上的点与圆心为(xc,yc),半径为R-的圆之间的差异.当Snake轮廓不受外力作用时,该能量项将使Snake轮廓保持为圆形.在分割左心室内膜过程中当Snake曲线演化到伪影和乳突肌时,由于受到圆形约束的限制,曲线能绕过伪影和乳突肌向着我们需要的目标特征继续演化.根据变分法原理,式(12)对应的欧拉方程为写成离散形式为烅烄烆烅烄烆i=0其中,R-=1n∑n-1xc=1放在时间演化框架下求解并采用半隐式格式,得到xt+1i-xtiΔt+λxt+1i-λ(xtc+R-tcos(2πi/n))=0烄烅yt+1i-ytiΔt+λyt+1i-λ(ytc+R-tsin(2πi/n))烆图1显示了圆形约束项的作用.在这些结果中,左边图像是没有采用圆形约束的结果,右边图像则是采用圆形约束的结果.图1(a)在分割内膜时,初始轮廓选取位于内膜范围内的圆,可以看到左图由于没有采用圆形约束,Snake轮廓易受到乳突肌和伪影的干扰而陷入局部极小.采用形状约束后Snake轮廓能绕过伪影和乳突肌收敛到我们需要的目标边界,得到较好的分割结果.图1(b)在分割外膜时由于左心室与右心室及周围其它组织如肝脏等灰度非常接近易形成弱边界,并且外力场不够完美,若不采用圆形约束,由于图像的梯度力在低对比度区域和弱边界处太小,出现了变形曲线泄露的现象(左图).在采用全局形状约束后,阻止了Snake轮廓从低对比度区域或弱边界区域泄露(右图).这样,在分割左室壁内膜时,Snake模型的外力由式(10)决定,而内力则由式(2)中的导数项和式(12)共同决定.对于左室壁外膜的分割,考虑到在基于图像梯度的外力场中,左室壁内膜是一个局部极小点,几乎所有基于Snake模型的方法在分割出左室壁内膜后,轮廓都不会再运动,无法继续分割其外膜,为此,必须除去这一局部极小点.事实上,左室壁外膜完全包围了其内膜,在分割出左室壁内膜以后,Snake轮廓也完全刻画了外力的局部极小点.基于上述分析,我们在分割策略中直接将原始边缘图中Snake轮廓所包围区域的边缘强度置为0,这就抹平了左室壁内膜边缘(及部分噪声),再采用这一改动的边缘图来重新计算外力场,从而实现了左室壁外膜的自动分割.Page54实验结果及分析在本节实验中,我们首先对GNBGVFSnake模型进行实验并和NGVF、NBGVFSnake模型进行了比较;然后展示GNBGVFSnake在保持目标弱边界上具有更好地鲁棒性;最后,在一套心脏MR图像上验证上述分割策略,并与手工分割的结果进行定量比较.这里所用的MR图像由SIEMENS1.5T临床系统产生,成像参数如下:原始图像尺寸192×156,切片厚度8mm,重复时间(TR)=29.16,回波时间(TE)=1.08,分辨率1.82×1.82,回转角(flipangle)=50,视野(FOV)=81.25.实验中使用的参数为α=0.1,β=0,λ=0.3,μ=0.15,k=0.1.计算图2NGVF、NBGVF和GNBGVFSnake的性能比较环境为Matlab7.1,CPU3.39GHz,RAM1.0GB,WindowsXPProfessional.图2给出了在合成图像上GNBGVF、NBGVF和NGVF的性能比较.图2(a)和(b)是在长40像素、宽5个像素的深度凹陷区域上的收敛过程.图2(a)是GNBGVF力场迭代200次的结果,显然,GNBGVF模型能够成功地收敛到这个细长的凹陷区域.图2(b)显示NGVF模型在NGVF力场的捕捉范围足够大的时候,即迭代次数大于1000次才能收敛到这个凹陷区域.图2(c)、(d)和(e)给出了在边界缺口处的性能.图2(c)为NGVFSnake的演化过程和它的力场.图2(d)从左到右分别是NGVF和GNBGVF的演化过程,从中可看出部分NGVF模型也能够收敛到右边的凸起,相信也能收敛到左Page6边凸起.这也从另一方向反映了NGVF模型对边界缺口比较敏感.图2(e)从左到右分别是NBGVF和GNBGVF的演化过程,从中可以看出GNBGVF在边界缺口处有更好的性能.图2(f)、(g)和(h)给出了3种外力模型的噪声鲁棒性.由于NGVF舍弃了沿着切线方向的扩散,NBGVF沿切线方向的扩散不随图像信息变化,所以它们与GNBGVF相比对噪声更为敏感.在结果中,从左到右分别是受椒盐噪声、斑马噪声、瑞利噪声和高斯噪声污染的U型图像及其收敛过程,不难看出,GNBGVFSnake具有更好的抗噪性.在第2节中,我们从理论上分析法向有偏梯度矢量流外力模型在保持目标弱边界上具有更好的鲁棒性,这里从实验上说明这一点.如图3所示,图3图3GNBGVFSnake在弱边界方面的性能图4使用本文方法的左室壁分割结果我们对分割结果与手工分割结果进行比较,采用平均绝对距离MAD(MeanAbsoluteDistance)度量二者之间的差异[19],平均绝对距离的方差度量二者之间差异的波动.设Snake轮廓为S,手工分割结果为M,则MAD(S,M)=0.51(a)、(b)、(c)和(d)显示了GVF、NGVF、NBGVF和GNBGVF在一幅合成图像上的表现,该合成图像有一个具有弱边界的矩形,且在矩形附近有一强边界,两者的间距只有3个像素.很明显,GNBGVFSnake在四者中具有最佳的性能.图3(f)、(g)和(h)显示了NGVF、NBGVF和GNBGVF在一幅心脏MR图像上的表现,NGVF在目标的右上角泄漏,而NBGVF和GNBGVF则能很好的封闭,如黑色箭头所指,这就说明了GNBGVF具有较好的保持目标弱边界的性能.采用这里介绍的方法,我们对一套心脏MR图像的一个图层进行分割,在一个心动周期内每个图像层包含21幅图像,图4中给出了21幅图像的分割结果.VAR(MAD)=1其中,S={s1,s2,…,sn},M={m1,m2,…,mk}分别表示Snake轮廓和手工轮廓上的点,d(s,M)=mins-m,MAD(S,M)为MAD的均值.对于整套图像而言,左室壁内膜的平均MAD值为0.67像素,基本上与手工分割结果相同;外膜的平均MADPage7值为1.35像素,与手工分割结果非常接近的.而内膜与外膜的平均绝对距离的方差分别为0.024和0.08,表明实验分割结果与手工分割结果的差异的波动不大.5结论本文提出了一种基于主动轮廓模型的心脏核磁共振图像左室壁内、外膜的分割方法.主动轮廓模型尽管是一种比较成熟的方法,但并不能很好地解决左室壁的分割问题.首先提出了主动轮廓模型的广义法向有偏梯度矢量流外力模型GNBGVF,该外力场除了保持切线方向的扩散外,还保留了法线方向有偏的扩散,具有捕捉范围大、抗噪能力强、且对弱边界泄漏有更好的鲁棒性.在左室壁内膜的分割而言,考虑到左室壁的近似为圆形的特点,采用了圆形约束的能量项,这种形状约束有利于克服由于图像灰度不均、乳突肌等而导致的局部极小.对于左室壁外膜的分割,利用内膜的分割结果初始化,即通过重新组合梯度分量来构造的外力场.这种外力场能有效克服原始梯度矢量流的不足,使得室壁外膜边缘很弱时也能得到保持.实验结果表明,该方法能准确地分割左室壁内、外膜.在接下来的研究中,我们将进一步分析GVF中拉普拉斯算子切线方向和法线方向扩散项的作用,并针对法线方向扩散具有去除噪声和扩散力场的作用拟提出一种基于偏微分方程的图像去噪方法,以期进一步完善本文所提出的分割策略.致谢香港中文大学计算机科学工程系王平安教授为我们提供了多套心脏MR图像,在此我们表示衷心的感谢!
