Page1一种基于情感符号的在线突发事件检测方法张鲁民1)贾焰1)周斌1)赵金辉1)洪锋2)1)(国防科学技术大学计算机学院长沙410073)2)(西安卫星测控中心西安710043)摘要如何快速高效检测出海量数据流中的突发事件是目前的研究热点之一.文中针对微博数据流,提出了一种新颖的基于情感符号的在线突发事件检测算法框架.伴随着事件的发生,文本流中情感符号也存在突发现象.文中通过实时监测情感符号变化态势,及时发现情感符号的突发期,达到挖掘突发事件的目的.首先基于频繁模式挖掘和互信息相结合的算法构建情感符号模型,并通过此模型抽取数据流中的情感符号,采用改进Kleinberg算法检测突发期,通过启发式的近邻传播聚类算法检测突发事件并对事件进行合并.同时,算法设置了离线回收机制,对不含情感符号的博文进行回收利用以保证事件概要抽取的完备性.实验表明,该算法可有效地挖掘出突发事件,无论在速度还是精度上都能保证实时在线处理的要求.关键词情感符号;突发事件;在线检测;微博1引言近年来随着Web2.0技术和应用的蓬勃发展,Page2布超过3.5亿条博文.在国内,截止2012年12月,新浪微博已经拥有超过5亿用户,腾讯微博用户数也已经达到5.4亿①.2012年中国互联网舆情分析报告称,在伦敦奥运会期间新浪微博和腾讯微博共计约7千万条②,成为典型的“微博奥运会”.可以说,微博已经成为新的舆论集散平台.话题发现与追踪,通过对信息流进行新话题的自动识别和已知话题的持续跟踪,帮助人们发现网络中讨论的热点话题,一直是自然语言处理领域的研究热点[1].传统的话题发现与追踪,以新闻流为处理对象,采用基于事件的信息组织方式进行研究,取得了很大成功.然而,与传统长文本相比,以微博为代表的短文本数据量大、产生速度快、数据噪声多,如何从海量数据中迅速检测出热点话题及突发事件是目前面临的主要问题之一[2].基于特征突发进行事件检测是挖掘数据流中突发事件的有效方法之一,其主要思想是首先抽取文档特征词,通过分析特征词随时间变化轨迹检测突发现象,然后将具有相同突发轨迹的特征词进行聚合,形成突发事件[3-5].然而,已有研究成果多是对长文本的研究,应用于微博这类仅有140字的短文本进行在线挖掘有很大不足.首先,微博数据量大,检测突发特征需要花费大量时间,不适合在线处理.其次,微博中用户表达方式的多样化使得信息流中存在大量噪声,突发特征可能由网络新词构成,从而增加了识别突发特征的难度.针对以上不足,我们提出了基于情感符号的事件检测模型.情感符号是微博系统提供给用户用于表达自己心情、态度、情感的图片,典型的新浪情感符号如图1所示.伴随着突发事件的发生,用户采用情感符号表达自己观点的博文比例也会有明显突发,因而可以通过监测微博数据流中情感符号的态势变化达到挖掘突发事件的目的.本文首先利用4000万条新浪微博数据作为语料库,采用基于频繁模式和互信息相结合的算法抽取情感符号库,构建情感符号模型;然后设计了一种高效的基于情感符号挖掘在线突发事件的算法框架,通过改进的Kleinberg算法挖掘情感符号突发期,采用启发式的近邻传播算法对含有情感符号的博文进行事件抽取.同时,采用离线回收机制保证事件概要抽取的完备性.最后,通过392万条有关“伦敦奥运会”的新浪微博实验验证了算法的有效性.本文第2节介绍与数据流事件检测相关技术;第3节介绍本文提出的基于情感符号的在线突发事件检测模型;第4节描述实验过程并对实验结果进行分析;最后对工作进行总结展望.2相关工作数据流上的事件检测一直是学术研究的热点.早在2002年Kleinberg教授提出了经典的突发(burst)挖掘算法,通过二元状态机模型对信息流进行建模,根据文档到达的时间将特征词分为正常和突发两种状态[3].Fung在2005年对其进行了改进,提出了一种无参数的burst挖掘算法,采用超几何分布对文档产生过程进行建模,根据概率判断特征值是否处于突发状态[4].He在2007年基于TFIDF方法与突发特征相结合的特征建模方法,通过增加特征词的突发权重建立新的突发特征模型,取得了良好的效果[5].上述工作都是针对新闻、博客等长文本上进行研究,数据规模较小.而针对微博这类快速到达的大规模数据流,直接采用上述方法将花费大量时间发现突发特征,因而不适合进行在线处理.文献[6]提出了高效的数据流挖掘算法框架,通过单遍扫描就可以计算出聚类中心,而不需要迭代过程,故称Single-Pass算法.此方法效率较高,但其聚类结果受输入顺序影响且精度较低.文献[7]提出采用OnlineLatentDirichletAllocation(LDA)模型对文本流中的话题进行建模,利用演化矩阵记录话题变化情况,取得了良好效果,但LDA模型需要预先指定话题数目和迭代次数.本文在传统突发特征检测的基础上进行了改进,通过监测情感符号的状态变化达到挖掘突发事件的目的.情感符号模型预先采用离线方式训练而成,并且数目较少,从而节省了时间,使得在线处理成为可能.下面对本文的模型进行详细介绍.①②Page33模型及方法3.1形式化定义首先我们进行如下形式化定义.定义1.微博数据流其中,dti={w1,w2,…}表示博文,ti表示博文达到时间,wj表示博文的特征项.对特定时间窗口T,其文档集合可表示为DT={dt:t∈T},集合的大小(即集合包含文档的个数)记为N.定义2.情感符号序列其中,ei表示一类情感符号,包含一种或多种相似的情感符号,n为情感符号种类的个数.定义3.文档情感符号向量d表示d是否包含情感符号ei,即其中δeid=1,如果博文d包含情感符号eiδei定义4.情感符号文档集DTei:时间T内包含情感ei的博文集合,即为定义5.突发状态:对于特征度量函数f及时间窗口T,将T平均分为Q个时刻,称情感ei在t时刻处于突发状态,如果图2基于情感符号的在线突发事件模型框架3.2.1情感符号模型构造为保证在线突发事件挖掘的高效性,情感符号定义6.突发期其中,bkei表示情感ei的第k个突发期.相应的,DTkei称为突发期bkei内的相关文档.定义7.突发事件集:由情感符号ei在时间窗口T内检测到的突发事件集合,为其中,gkei=〈w1ei,w2ei,w3ei,…〉为事件,由一系列特征词wjei进行标识,并按照其权重进行排序;GTE表示时间窗口T内的事件集合.本文的目的在于通过检测情感符号序列E的态势变化达到挖掘突发事件的目的.为此,我们需要着重解决以下几个问题:(1)如何构造情感符号序列E;(2)如何检测突发期BTei及抽取相关文档DTei;(3)如果通过相关文档DTei挖掘突发事件集下面结合本文提出的基于情感符号的在线突发GTei,并构造总的事件集GTE.事件检测模型进行说明.3.2模型框架本文提出的模型框架如图2所示.主要包含情感符号模型构造、突发情感符号检测、基于情感符号的事件抽取和回收机制4个模块.其中模块1采用离线方式构造模型;模块2和模块3通过在线方式完成数据流上的事件挖掘;模块4采用离线方式完成数据回收利用.给定时间窗口T及时间间隔t,算法每隔t时间重新调用模块2和模块3,计算其时间窗口T内的微博达到发现突发事件的目的.模型构造采用离线方式预先进行,并随着语料库的增加进行定期更新.一类情感符号中的元素之间满Page4足以下两个特征:(1)经常一起出现,即到达一定的频繁模式;(2)具有较强的关联性.因而,我们基于大规模微博语料库,采用频繁模式挖掘和互信息相结合的算法构建情感符号模型.FP-growth算法是频繁模式挖掘的高效算法,采用分治策略将提供频繁项集的数据库压缩成一颗频繁模式树(FP-tree),同时保留事务中属性之间的关联信息;然后采用增长频繁集的方法进行数据挖掘,因而不会产生候选项集[8].互信息用于在信息论中衡量两个集合之间相关性,对两个词wi,wj间的互信息(MutualInformation,MI)可以表示为其中,p(wi),p(wj)分别表示wi,wj独立出现的概率;p(wi,wj)表示wi,wj同时出现的概率.设语料库数据规模为R,则其中,C(wi),C(wj)分别表示语料库中分别包含wi,wj的博文数;C(wi,wj)表示同时包含wi,wj的博文数.我们通过API爬取了从2012年7月10日到2012年9月10日的4000万条新浪微博作为初始化语料库,利用API获得的信息中,情感符号会自动转为文本,并通过“[]”进行特殊标识.如会自动转换为“[嘻嘻]”,转换为“[怒]”等,从而可以基于正则表达式进行抽取.整个算法流程如下.算法1.基于FP-growth与MI的情感模型构建.输入:微博语料库D,最小支持度min_sup,MI阈值λ输出:情感符号模型犈1.单边扫描语料库D,对d∈D,采用正则表达式抽取文档d中的情感符号,初始化情感符号向量犈;2.收集情感符号的频繁项集合F和它们的支持度,对F按照支持度降序排序,生成频繁项表L;3.创建FP-Tree根节点,以“null”标记,重新扫描语料库,构建频繁模式树,并挖掘情感符号的频繁2项集P;4.对频繁模式P中的元素p1,p2,根据式(1)计算其互信息,若MI(p1,p2)>λ,则将犈中的两个情感符号进行合并;5.重复步4直到遍历所有频繁2项集;6.将犈中元素按照出现次数进行排序,选取前top-k通过上述算法建立的情感符号模型将用于在线微博数据流的情感符号抽取,并随着数据量的增加进作为最终模型.行定期更新,新的情感模型将重新传递给在线模块.3.2.2突发情感符号检测突发情感符号检测基于已有情感符号模型对新到达的博文进行情感符号抽取,挖掘情感符号的突发期,并将文档按照情感符号进行归类.给定时间窗口T及其文档集合DT,情感抽取根据情感符号向量犈,抽取包含情感元素ei的文档集合构成情感文本DTei.算法如下.算法2.情感符号抽取.输入:文档数据流DT,情感向量犈输出:按照情感符号分类的文本集合DTei1.对d∈DT,构建博文情感博文情感犈d;2.设定标记flag=true,对犈d元素进行逐项研判,3.重复步1,2直到所有文档分类结束.经过上述算法,DT被分为情感符号文本集DTei及非情感文本集合DT!E.在此,我们将所有不含任何情感符号的博文集合加入候选库以备回收构建事件概要,而不是将其丢弃.实际上,DT!E中亦含有可以标识突发事件的信息.虽然模块1构造的情感符号模型包含大量情感符号,但在特定的时间窗口内,公众用来表达其情感意见的主流情感符号只有少数几个.为此,本文采用主成分分析方法,根据情感符号文本集合的数量及文档发表时间,抽取时间窗口内的主流情感以达到降维的目的.对于主流情感符号ei及其相关文档DTei,我们采用改进的Kleinberg突发检测方法进行情感特征检测.实际上,经过情感抽取及分类,相关文档DTei的数据规模已经有明显下降,从而可以很好地采用Kleinberg的算法进行突发检测.Kleinberg采用二元状态模型对信息流进行建模,普通状态为q0,突发状态为q1,采用文档到达的时间间隔衡量状态.当处于普通状态q0时,文档时间间隔长,对应于密度函数f0()x=a0e-a0x;处于突发状态q1时,文档时间间隔短,对应于密度函数f1()x=a1e-a1x,从而a0<a1.在此,我们选取相关文档占总文档的比例作为密度函数,即然后采用Kleinberg方法进行突发特征检测.Page5从而,情感文本集合DTei根据突发期BTei被划分为几个不相交子集.3.2.3基于情感符号的事件抽取基于情感符号的事件抽取通过对情感符号突发期内的文本进行聚类检测突发事件并对事件进行DTkei合并,生成事件列表.对于每个给定情感符号ei及模块1检测出的突发期BTei,在其每个突发期bkei内采用近邻传播聚类方法检测突发事件.近邻传播AP(AffinityPropa-gation)聚类是2007年在Science杂志上提出的一种新的聚类算法[9],其基于N个数据点之间的相似度矩阵犛进行聚类,并以犛矩阵对角线上的值s(i,i)作为衡量点i成为聚类中心的潜在可能性,又称为参考度P(i).P(i)的值越大,点i成为聚类中心的可能性就越大.在AP聚类算法中,相似度一般采用欧氏距离来衡量,参考度一般取犛相似度的中值.我们认为命名实体对突发事件具有更好的表征性,从而提出了基于命名实体识别的启发式AP聚类算法(HAP),提高命名实体在计算相似度及参考度中的权重.在计算相似性之前,首先采用基于层叠隐马尔可夫模型的中文命名实体识别方法进行命名实体识别[10],主要识别文本中具有特定意义的实体,包括时间、人名、地名、专有名词等.从而,文档d的词空间划分为命名实体集合及其他特征项集合,表示如下d={w1对每个特征项,计算其在滑动时间窗口T内的IFIDF值作为评价其重要程度的标志,采用余弦相似度分别计算命名实体空间和其它特征项空间的相似度.文档d1和d2最终相似度公式如下Si,()ji≠j=Simdi,d()j其中β为平滑系数且β>0.5.设S(i≠j)的中值为η,第i个文档d包含的命名实体识别数为μ,文档的平均命名实体识别数为ζ,利用Sigmoid函数设定参考度的值其函数图像如图3所示.从而,文档含有命名实体的数目越多,参考度S(i,i)就越大,成为聚类中心的可能性就越大.AP聚类算法通过不断迭代Responsibility矩阵和Availability矩阵达到检测聚类中心的目的.r(i,k)表示点k是否适合作为点i的聚类中心,a(i,k)表示点i是否选择点k作为其聚类中心.计算公式如下Ri,()k=Si,()k-maxAi,()j+Si,()(j=1,2,…,N,j≠k}),A(i,k)=min{0,R(k,k)+∑j(j=1,2,…,N,j≠i且j≠k),Rk,()k=()Pk-maxAk,()j+Sk,()(j=1,2,…,N,j≠k}).采用HAP聚类算法的步骤如下.算法3.HeuristicAffinityPropagation(HAP).输入:相关文档集合DTkei,最大迭代次数maxits,聚类输出:类簇GTei1.对d∈DTkei,采用命名实体识别检测文档中命名实体;2.利用式(2)计算相似度矩阵犛,利用式(3)计算参考度P;中心连续重复次数达到convits.3.计算犚矩阵和犃矩阵,输出聚类中心集合;4.重复步3直到达到最大迭代次数maxits或者聚类对情感ei的每个突发期bkei内的文档集合DTkei,经过HAP聚类算法,DTkei被分为几个不同的事件类簇GTei.对GTei中的任一事件gTei=〈w1ei,w2ei,w3ei,…〉,其特征项权重采用属于此事件的所有文档的平均权重表示,即wjei=1征项wjei的文档数目.由于针对同一突发事件公众往往具有多元化情感,从而不同事件集合中存在重复事件.本文采用突发期和事件相似性相结合的双限定方式对事件进行合并.对于情感ei,ej及其对应的事件集合GTei和GTej,我们认为两个事件gτ1ei和gτ2ej为同一突发事件,当且仅当Page6其中θ1,θ2为给定阈值.式(4)表示由此事件引发的两种情感的突发期具有一定重合性.式(5)表示事件特征项具有较强的相似度.合并后的事件特征项的权重采用两者平均值表示.3.2.4离线回收机制经过上述过程我们已经达到检测突发事件的目的.为保证抽取事件概要的完备性,本文设计了离线回收机制对未处理的非情感符号文本集合DT!E进行回收.实际上,非情感文本集合DT!E中仍然具有很多事件相关文档,尤其是含有很多对事件进行描述的客观信息.基于已有的事件集合GT,我们选择其对应文档作为训练集,采用改进的KNN算法对其进行分类.对于事件gi=〈w1i,w2i,…〉及其文档集合Di=dj{}i,计算文档dji与事件gi的相似度并按照相似度大小排序,选择top-k文档作为评测标准.对于文档d!E∈DT!E,设其与gi的评价函数为(d!E|gi),则文档d!E属于事件gi当且仅当d!Eg()i=1由于此模块目的是提高事件概要抽取的完备性,采用离线方式即可进行,而不需要实时进行计算,从而提高了系统效率.4实验结果及分析4.1数据集利用上述基于情感分析的在线事件检测模型框架,验证本文算法的有效性.其中离线情符号模型构建的初始化语料库为从2012年7月10日到2012年9月10日的4000万条新浪微博.对算法效果的测试采用从2012年7月25日至8月12日有关伦敦奥运会的3923641条微博数据.所有上述实验数据都直接通过新浪微博API获得,未经任何处理.图4展示了语料库中情感符号的频数分布.可见情感符号分布具有长尾现象,少数情感符号使用次数非常多,而大多数情感符号使用次数较少.设定频繁模式挖掘的最小支持度min_sup为1%,采用基于频繁模式挖掘和MI相结合的情感符号模型构建算法将相似情感符号进行合并,典型的频繁项的MI值如表1所示.符号1符号2MI值符号1符号2MI值左哼哼右哼哼3.84得意地笑噢耶2.65泪流满面崩溃3.78喜得金牌冠军诞生2.08蛋糕礼物3.02猪头吐1.91神马浮云2.86爱心1.48我们选取top200表情符号作为最终的情感符号模型,用于在线微博数据流的突发事件检测.表2和图5是以天为单位的3923641条博文中包含情感符号的博文分布情况.可见平均38%的微博中包含情感符号,这从侧面反映出情感符号作为特征项进行突发事件检测的有效性.日期情感文数总数比例/%日期情感文数总数比例/%7-2592763348627.78-59853519095551.67-26222997016831.88-69473921612143.87-279639019782648.78-714731236743540.17-2821344344415348.18-87745021155436.67-298774319349945.38-94477512173736.87-306818717903138.18-103450710922331.67-319008220218544.68-11255838568129.98-18835622110140.08-126222917224536.18-29719126089837.38-137211419629136.78-37558819290639.28-14183226553828.08-45941015194439.18-15102743966425.94.2实验结果我们设定滑动时间窗口T为1h,最小时间间隔Page7刻度为t为1min,验证算法有效性.设定HAP聚类算法的最大迭代次数maxits=1000,聚类中心连续重复次数convits=20,突发期重合度θ1=0.6,余弦相似度阈值θ2和θ3都为0.8,采用上述情感符号模型及本文算法框架进行突发事件检测,在每个时间窗口中分别选择top5,top10,top20个事件构成最终事件集合,并与文献[3]提出的Kleinberg算法及文献[6]提出的Singlepass算法进行对比.在Sin-glepass和Kleinberg算法中,我们将情感符号从微博中剔除,从而可以认为是基于无表情符号进行的计算.将本文提出的基于情感符号的事件检测算法与无情感符号的Singlepass和Kleinberg算法计算结果进行比较,以此验证本文提出的算法的有效性.由于微博数据量大,人工标注语料库将花费大量的时间,我们采用如下方式对算法进行评价.(1)覆盖率覆盖率为本文检测出的事件占参考事件的比例,反映出算法检测出新事件的能力.首先我们参阅wikipedia①、新浪微博2012伦敦奥运会话题榜②及各门户网站当时的报道,人工抽取奥运会期间的热点话题作为参考标准,共得到包括中国运动员获得奖牌(包括金牌、银牌、铜牌)、刘翔摔倒、陈一冰意外失金等在内的参考事件共计260个,以此为基准判断算法检测新事件的能力.其结果如表3和图6所示.SinglepassKleinberg从中可以看出,本算法可以检测出大部分突发事件,从而应用于实际系统中时对突发事件产生遗漏现象可能性较小.(2)准确率准确率为事件中相关文档数与事件包含文档总数的比例,反映算法抽取出的事件的精准程度.对于事件集合,我们分别随机抽取其中50个事件,人工判断其是否属于此话题.其结果如表4和图7所示.SinglepassKleinberg从中可以看出,本文提出的算法具有较高准确度,平均准确率达到85%左右,与直接采用Klein-berg算法相比,本文提出的准确度提高了56%.(3)检测时间检测时间为算法检测到突发事件的时间与该事件的最早博文之间的时间差,反映算法用于在线检测的效率.检测时间越短,说明算法能越快地检测出事件,效果越好.针对每个集合随机选取的50个事件,采用文献[11]提出的基于时间、内容、链接的方法检测语料库中的事件源头,并与算法首次检测到该事件的时间进行比较.实验在CPU为4核、主频为2.83GHz、内存为8GB的一台服务器上运行,其结果如表5所示.Singlepass302Kleinberg493top5282top10282top20282从表5中可以看出,本文算法平均在9min之内检测出突发事件,其中最快检测时间达到4.7min,并直接进入top5事件之中.分析最慢检测时间的事①②Page8件发现,此类事件开始都并未引起公众关注,经意见领袖转发后才迅速成为公众关注的焦点.4.3算法及结果分析从实验结果中可以看出,本文提出的算法可以快速有效地发现在线微博流中的突发事件.实际上,本算法提出了许多优化方法可以保证实时在线处理海量数据的需求.首先,在模块1突发情感检测的情感抽取中,约60%的文本被划入非情感文本,大大减少了在线模块数据处理的规模.其次,虽然情感模型有200个类别,但通过主成分分析,我们发现处于单独时间窗口中的主流情感平均在6个左右,因而提高了突发检测的效率.命名实体识别虽然增加了算法运行时间,但同时过滤掉了一部分噪声,提高了HAP聚类算法的速度和准确率.另外,通过对不同情感符号的变化态势进行分析,我们发现,情感符号的突发关联实际上可以分为3种:(1)相同极性情感同时突发.情感极性相似表情符号同时急剧上升,伴随着其对立情感迅速下降,如图8(a)所示.这反映出公图8情感符号突发种类5结束语基于微博的情感符号系统,本文提出了一种高效的在线突发事件检测方法.实验证明,本文提出的方法具有较高的处理效率及精度,从而对于海量微博数据流的实时在线处理具有很强实用性.基于本文提出的模型进一步对检测到的突发事件进行关联分析,是我们下一步的研究内容.众对事件的一致态度,从而容易形成联盟,推动事件的进一步发展.图为事件“陈一冰表现完美无缘金牌”时情感符号[怒]、[泪]、[鄙视]的变化状态,可见公众对裁判判罚不公的愤怒态度.(2)对立的情感同时突发.包含两种对立态度的情感符号同时出现突发现象,如图8(b)所示.这反映出公众对于事件的不同态度,从而容易形成对立团体,在微博上形成的争执.图为事件“国羽女双消极比赛”公众情感符号[鼓掌]与[弱]的状态变化,一部分群体认为此为合理利用规则,而另一部分则认为有悖于奥运精神,从态势变化中可以看出,持后一种观点的群众数量较多.(3)情感前后突发.情感呈现明显的前后突发现象,具有一定重合度,如图8(c)所示.这反映出公众态度的转移现象,往往伴随着事件重心的变化.图为“刘翔伤别奥运”事件中情感符号[加油]和[泪]的变化状态,从中可以看出公众情感的演化情况.致谢在此,我们向对本文工作给予支持和建议的同行,尤其是国防科学技术大学计算机学院613教研室的老师和同学表示衷心感谢!
