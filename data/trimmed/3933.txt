Page1基于RPCA的太阳能电池片表面缺陷检测姚明海李洁王宪保(浙江工业大学信息工程学院杭州310023)摘要目前太阳能电池片生产过程中的缺陷检测主要由人工完成,费时费力,容易受主观因素的影响.文中提出了一种基于RPCA(RobustPrincipalComponentAnalysis,RPCA)的太阳能电池片表面缺陷检测方法.该方法对图像矩阵进行变换,使之分解成无缺陷的低秩矩阵图像和有缺陷的稀疏矩阵图像.通过凸优化的方法,分别最小化上述两个矩阵的核范数和1范数,从而使矩阵得以有效快速地分解.同时,文中分别对优化的两种算法:加速逼近梯度(AcceleratedProximalGradient,APG)法和非精确增广拉格朗日乘子(InexactAugmentedLagrangeMultiplier,IALM)法,在太阳能电池片缺陷检测的计算时间和迭代次数方面进行了比较.最后通过大量实验,证明了上述方法在检测太阳能电池片表面缺陷的可行性和有效性.关键词RPCA;缺陷检测;APG法;IALM法1引言近年来,由于日益严重的环境问题和全球石油Page2而受到多数生产厂商的青睐[1].然而太阳能电池片的缺陷将严重降低其转换效率和可用寿命,在制造过程中,这些缺陷的检测就显得尤为重要.太阳能电池片在生产工艺中的缺陷包括裂缝、缺角等,将造成生产量的减少和高昂的回收成本;除此,这些缺陷还会造成太阳能电池片和太阳能模块在后续使用中的电气故障[2].然而,由于太阳能电池片表面有密集的平行栅线分布,而缺陷又具有细微性和隐秘性的特点,这使得自动视觉检测技术较难检测到缺陷的存在.常见的缺陷检测方法包括染色检测、涡流探伤检测、超声波检测、辐射热成像检测、扫描式声波检测、光致发光图像和电致发光图像检测、共振超声振动检测等[3].目前,付庄等人在文献[4]提出一种用机器视觉检测太阳能电池片缺陷的方法,该方法利用裂缝的两个特征:低灰度值和高梯度值来达到检测的目的,但它只适用于缺陷与周围的灰度值有明显差别的时候.蔡笃铭等人在文献[2]中提出了一种各向异性扩散算法来检测在太阳能电池片表面可见的裂缝.这种扩散过程减少了可疑的缺陷区域,保留了晶粒背景,使得裂缝的位置能够通过原始图像与扩散图像相减而检测到.在文献[5]中,蔡笃铭和罗杰宇进一步提出了使用均值漂移算法来检测太阳能硅片的缺陷.原始灰度图像被转换成熵图像,在该图像中一个小邻域窗口中,被定义的每一像素表示熵的梯度方向,然后运用均值漂移过程来去除熵图像中的噪声和晶界,最后在滤波图像中保留下的边缘点就会被识别为有缺陷的图像.邱奕契和刘建宗在文献[3]中使用近红外线成像系统来检测太阳能硅片的微裂缝.所产生的图像中,微裂缝的强度比其周围的晶体边界要暗.然后用局部阈值、区域增长分割法、形态学预处理和区块分析法来检测暗色的微裂缝.该方法的前提是假设感应的微裂缝在红外光下,比晶粒明显的暗,只有这样该方法才能应用于太阳能电池片的缺陷检测.但是,在这种方法下,太阳能电池片中一些暗色的、拉长的晶粒也可能会被错误地识别为缺陷.近年来,电致发光图像已发展成评估太阳能电池片电气特性的一种快速而有效的技术[6].Bastari等人在文献[7]中提出对电致发光图像中暗色缺陷区域进行纹理分析,从而自动分类出有缺陷和无缺陷的电池片.而Fuyuki等人在文献[8]提出了通过诊断太阳能电池片的电致发光图像的温度差来检测缺陷的方法,这主要利用了内在缺陷对温度更敏感的特性.在文献[1]中,蔡笃铭等人提出了基于傅立叶重构技术的一种自我参照法来实现太阳能电池片缺陷的检测.图像重构过程通过设置线型或条状缺陷附近的频率成分为零,然后反变换,把光谱图像转化为空间图像(也就是重构出的图像),来去除可能存在的缺陷.缺陷区域可以很容易地通过评估原始图像和其重构图像的灰度值差异来识别.本文提出了基于RPCA检测太阳能电池片缺陷的技术,它使得待检测的原图像矩阵有效地分解成低秩矩阵图像和稀疏矩阵图像,分别表现为无缺陷的背景图像和缺陷图像.这样,背景图像和缺陷图像就可以很容易地被分离出来,从而仅仅通过检测缺陷图像就可以识别出有无缺陷的存在.本文第1节是对当今太阳能电池片的缺陷的几种技术方法的简介;第2节是对RPCA的原理叙述;第3节是具体介绍APG法和IALM法;第4节利用RPCA对太阳能电池片表面缺陷进行检测,给出了实验结果,并对APG法和IALM法做出了比较,还将其与常用缺陷检测方法进行比较;第5节是总结与展望.2RPCA原理RPCA又称为低秩矩阵恢复或稀疏与低秩矩阵分解[9].RPCA的原理可以从PCA(PrincipalComponentAnalysis,PCA)的角度看,传统的PCA是将高维数据投影到较低维空间的过程,这样既保留了原有各特征的主要信息,又达到了减少特征个数,即降低空间维数的目的.该过程可以写成其中犇的每一列是给定已知的数据,‖·‖F是矩阵的Frobenius范数.通过上述约束优化问题可以找到犇在一个最近的r维线性子空间上的投影.当犈为小噪声,且是独立高斯分布的时候,PCA可以通过一次奇异值分解(SVD)准确地找到最优的犃.但当犃被严重破坏,即犈很大,训练样本集中存在“劣点”样本时,犃的估计往往不准确,并且传统的PCA需要预知子空间维数r.基于上述PCA存在的缺陷,Wright等人提出了RPCA来解决犃中数据被严重破坏的情况.Page3RPCA是指当矩阵的某些元素被严重破坏时,自动识别出被破坏的元素,恢复出原矩阵.前提是假定原矩阵具有良好的结构,即低秩的;并且假定只有很少一部分元素被严重破坏,即犈是稀疏的,但允许大小是任意的[10].于是RPCA可以用如下式子来描述:其目标函数是低秩矩阵犃的秩和稀疏矩阵犈的零范数,λ表示噪声所占的权重.这是一个非确定多项式难题(Non-DetermenisticPolynomial-Hard,NPH),其解的正确性能很容易检查,但在理论和实践中,均只存在指数复杂度(相对于矩阵维数n)的算法,而没有有效的算法[9,11].由于一个矩阵的秩r与它的非零奇异值的个数相等,可以用矩阵的核范数来近似地替代矩阵的秩.同时用矩阵的1范数来近似零范数,这样上述非凸问题就转化为一个凸优化问题,最小化1范数,这种方法称为基跟踪法(BasisPursuit,BP),是较为简单的问题,可以通过线性规划的方法解决[12].Elad和Bruckstein[13]证明了把零范数改为1范数的可行性.于是式(2)可以通过上述松弛,转化为如下问题:其中‖犃‖=∑m个奇异值;‖犈‖1=∑ij的绝对值之和.值得注意的是,权重因子λ的取值在本文设为通用的,即λ=1的最大值.值得说明的是,并不是所有矩阵都可以分解成低秩矩阵犃和稀疏矩阵犈,这里涉及到一个矩阵恢复的可行性.首先,一个杂乱无章的矩阵是不可能重建的,必须要求矩阵结构良好,即低秩,但也并非所有低秩矩阵都可以精确地重建,如果有些矩阵里有过多的0元素,那么这些0元素可能是矩阵犃和犈中的正负值相抵而形成的,那么这样的分解就可能有无数可能性.由文献[14]分析所得,如果一个秩为r的矩阵,奇异值分解而成的k个左奇异向量和k个右奇异向量都是均匀分布在所有由k个正交归一化向量的集合中,那么这样的矩阵就有很大的概率可以分解.其次,并不是在所有的采样方式下得到的矩阵都能够做到矩阵恢复的.假如,当矩阵的某一列完全没有被采样时,任何方法都不能将这一列的元素准确地分解出来.于是,一般都假定矩阵的采样方式是均匀采样的[9].最后假设低秩矩阵犃是n1×n2的,那么必须满足以下条件[15],矩阵才能准确分解.其中n(1)=max(n1,n2),n(2)=min(n1,n2),ρr和ρs是正的常数,而μ是一个很小的非相干参数.上述松弛优化方法的主要思路是将原先非凸的零范数替换为更容易处理的稀疏性度量函数,从而通过转化后的凸优化或非线性规划问题来逼近求解原问题[16].而凸优化问题的求解,由于变量众多,如何有效地求解又是一个值得探索的问题.3APG算法和IALM算法近年来,不断有文献提出具有启发性的解决RPCA的算法,其中具有代表性的有奇异值阈值法(singularvaluethresholding)[17]、交替方向法(alternatingdirectionmethod)[18]、加速逼近梯度法(acceleratedproximalgradient)[19]、增广拉格朗日乘子法(augmentedLagrangemultipliermethod)[20]和贝叶斯鲁棒主成分分析法(Bayesianrobustprincipalcomponentanalysis)[21].但受到问题规模的限制,有些方法并不能快速有效地解决上述稀疏与低秩矩阵分解的问题.例如在图像和视频处理的应用中,通常要求矩阵维数达到m=103~104,这就对算法提出了更高的要求.在这部分,本文将对加速逼近梯度(APG)法和非精确增广拉格朗日乘子(IALM)法作简要介绍.3.1APG算法APG算法对于优化问题的一般形式:其中H表示希尔伯特空间,g(x)是一个连续的凸函数,犃是一个线性映射,b是一个已知的观察量.上式通常通过如下松弛来计算:Page4其中罚函数f(x)=1当μ趋近于0的时候,式(6)的解也就是式(5)的解.在RPCA的问题中,利用上述松弛方法,式(3)可以化为如下形式:minA,EF(X)=μ‖犃‖+μλ‖犈‖1+1其中,X=(犃,犈).F(X):然后用一个可分离的二次函数Q(X,Y)来逼近Q(X,Y)=f(Y)+〈f(Y),X-Y〉+其中f(X)=1λ‖犈‖1,Y为逼近的目标点,〈·〉表示点积,Lf是利普希茨常数,f是f的全导数[19],Q(X,Y)为F(X)的上边界[22].对于第k次迭代,Xk=(Ak,Ek),Yk的值通过Yk=Xk+tk-1-1通过tk+1=1+4t2k槡+1稀疏矩阵犈,Xk分别记为X犃和Y犈k.令G=Y-1于每次迭代,Xk+1=argminQ(X,Yk),即(Ak+1,Ek+1)=argmin犃,犈μ‖犃‖+μλ‖犈‖1+为了对式(9)高效的求解,每次迭代时为其添加一个偏移χε:此时,Xk+1=χμ然后对G犃其中,松弛参数μk+1=max(ημk,ρμ0),η=0.9,ρ10-5,初始值μ0=0.99‖犇‖2(见文献[26-27]),利普希茨常数Lf=2(见文献[20]).具体的算法流程如图1所示.3.2IALM算法相较于APG算法,非精确增广拉格朗日乘子法(IALM)有更高的精确度、更好的收敛率和较少的迭代次数,因而在近年来得到了更广泛的研究.对于一个简单的约束优化问题:则其增广拉格朗日函数为L(X,Y,μ)=f(X)+〈Y,h(X)〉+μ2‖h(X)‖2其中,μ是惩罚参数,是一个正数,f(·)和h(·)是连续可微函数.注意到,增广拉格朗日函数比普通的拉格朗日函数多出了一个关于约束的惩罚项.增广拉格朗日乘子法每次迭代最小化增广拉格朗日函数,得到新的Xk,通过这个Xk和μ来更新乘子Yk,然后Page5继续求解下一个Xk,最后使得Xk收敛到原问题的最优解[9].我们利用增广拉格朗日乘子法来求解RPCA问题,则式(3)的增广拉格朗日函数:L(犃,犈,Y,μ)=‖犃‖+λ‖犈‖1+〈Y,犇-犃-犈〉+可利用交替更新的方式来最小化式(14),即先固定犈和Y求一个使L最小化的犃,然后固定犃和Y求一个使L最小化的犈,如此迭代,就可以得到收敛到这个子问题的最优解.我们称此算法为精确增广拉格朗日乘子法(ExactAugmentedLagrangeMultiplier,EALM).但在实际应用中,考虑到计算时间,可以要求对每一次迭代不必求出子问题的精确解,而只需要更新犃和犈各一次得到子问题的一个近似解,即可使算法最终收敛到原问题的最优解[9].这样我们就得到一个更简单且收敛速度更快的算法,称之为非精确拉格朗日乘子法(IALM),具体的算法流程如图2所示.算法的收敛性证明可参见文献[20].在IALM算法中,需要注意两点计算的细节,即μ值的选择和终止迭代的标准的确定.由文献[20]的经验,选取μ0=n1n2列数.并确定当‖犇-犃-犈‖Fδ‖犇‖F,δ=10-7的时候,迭代终止[15].4太阳能电池片缺陷检测RPCA的原理是将原始图像分解成一个低秩矩阵犃和稀疏矩阵犈之和.将RPCA的原理运用到太阳能电池片表面缺陷的检测中,由于一大批电池片中,除了可能存在的缺陷之外,各个图像都是相似的,在图像矩阵里可理解成各个图像矩阵都是线性相关的,它们表现为低秩,而那些潜在的缺陷可理解为稀疏矩阵里的非零元素.因此,运用RPCA的方法,可以将输入的待检测电池片图像,分解成无缺陷的低秩矩阵图像犃和有缺陷的稀疏矩阵图像犈.对于一批要检测的太阳能电池片,它们可以分别由列向量犐1,犐2,…,犐n来表示,所以RPCA方法中,输入的图像矩阵犇,可以表示为犇=[vec(犐1)|vec(犐2)|…|vec(犐n)]∈Rm×n(15)其中m为每一个图像的像素值,n为图像数,mn.由于这n幅图像是同一场景同一光源下,对同一对象,即同一批太阳能电池片拍摄的,虽然它们存在有无缺陷的不同,但它们基本的背景图像是相似的,在矩阵犇里表现为线性相关.然后对式(15)的输入矩阵犇,采用上文提出的APG法和IALM法,分别求解,将矩阵犇分解成无缺陷的低秩矩阵图像犃和有缺陷的稀疏矩阵图像犈.为了验证上文提出的RPCA原理和算法的正确性,本文选了一批废品率较高的16幅像素为830×586的太阳能电池片图像,其中的缺陷包括有裂缝和缺角,图3就是输入的待检测图像犇,其中只有第Page61行的第1个和第3行的第3、4个图像是无缺陷图像,而第1行的第2、3、4个图像的上端都有裂缝,第3行的第1、2个图像是缺角的缺陷图像,而其他图像有不同程度的缺陷.本文的所有实验都是在IntelCorei5-2450M2.5GHz的CPU环境下,使用工具软件MATLAB完成的.使用APG法的实验结果如图4所示,其中图4(a)和(b)分别是分解出的无缺陷的低秩矩阵图像犃和有缺陷的稀疏矩阵图像犈.随后,我们又使用IALM法对相同的待检测图像犇进行了缺陷检测,实验结果如图5所示,其中图5(a)和(b)分别是分解出的无缺陷的低秩矩阵图像犃和有缺陷的稀疏矩阵图像犈.由实验结果表明,利用APG法和IALM法对相同的16幅待检测图像进行实验,可以成功地检测到电池片表面缺陷.观察图4(b)可以发现,缺陷信息和我们用肉眼检测的结果完全相同,无缺陷的图像表现为一张全黑的图,而缺陷则很清晰地用白色标记出来了.同理,用IALM法也同样可以成功地分解(如图5(a)和(b)所示),得到我们需要的缺陷信息,其准确度也一样很精确.上文提到的APG法和IALM法都能成功地解决RPCA问题,但其在精确度、迭代次数和计算时间上存在些不同,两者的不同点可以总结如下:(1)IALM法精确度更高,尤其是稀疏矩阵犈中非0元素的计算,而APG法可能会漏算其中的非0元素;(2)IALM法计算速度却比APG法快6倍左右;(3)IALM法需要较少的迭代次数;(4)IALM法不需要微调参数,更稳定且对存储容量要求更小.具体比较结果如表1所示.所以在实际生产过程,对实时性和效率要求更高的太阳能电池片表面缺陷检测中,IALM法更适用.APG算法需要25989.95×10-7682.80IALM算法不需要4798.24×10-796.65Page7上文的实验是对批量16个太阳能电池片产品进行缺陷检测,同样,也可以对单个电池片进行检测,但要求有模板进行比较.选取上文实验中的前8个待检测图像,然后加上需要单个检测的新图像,组成如图6的输入图像犇,考虑到实际应用上对效率的要求,使用IALM法对图6进行操作,实验结果如图7(a)和(b)所示.由图6可见,最后一张新加入检测的图像是一个左上角有缺角的太阳能电池片,在应用IALM法对其进行了成功的图像矩阵恢复的,可以明显地看到在图7(b)的稀疏矩阵图像犈的最后一张图片中,缺角的缺陷清晰可见.而且由于图片数量的降低,计算速度得到明显提高,迭代次数降到了251次,计算时间也减少到25.42s.由表1我们可以看出利用IALM法对16幅图的缺陷检测时间需要96.65s,平均每幅图像的检测时间为6s左右,这离实时性的要求还有一些距离.本文又继续对算法进行了优化,不考虑太阳能电池片在固定生产线中的形变和拍摄角度变换的情况.通过此优化,对相同16幅样本使用IALM法进行实验,结果如图8(a)和(b)所示,分别是分解出的无缺陷的低秩矩阵图像犃和有缺陷的稀疏矩阵图像犈.图8(a)的低秩矩阵图像相较于图5(a)有少许模糊,但图8(b)的稀疏矩阵图像依然可以清晰地看出缺陷所在的位置.在不影响缺陷检测结果的情况下,图8对批量图像使用优化的IALM法检测缺陷Page8该优化可以将检测时间降为2.94s,那么平均每幅图像的检测时间为0.21s,迭代次数减为109次,这极大地加快了运算时间,使其应用到实际生产中成为可能.传统的缺陷检测往往是对待测图像进行图像预处理、形态学和中值滤波处理得到缺陷图像,再将缺陷图像分割提取出来,然后选取相应的特征参数如周长、面积、矩形度等作为判别缺陷类型的依据.文献[28]就按上述流程来检测太阳能电池片的表面缺陷,对于同样是在MATLAB平台上,检测156mm×156mm(像素442×442)的图像,本文的方法与文献[28]的常用图像处理方法比较如下:(1)利用文献[28]的方法,每幅图像的检测时间约为1s,而利用本文的方法,每幅图像的运算时间约为0.18s(由于图像像素的减少,相对于上文的0.21s有所减少),计算速度有了大幅度提高;(2)常用图像处理方法如文献[28]的缺陷检测准确度为90%~95%,而本文的方法,准确度可以接近100%;(3)文献[28]的方法需要大量的图像预处理过程,包括去噪、滤波等,流程繁琐复杂,而本文前期的图像处理只需要将图像由RGB形式转为灰度图像,操作简单.5结论与展望RPCA问题就是一个低秩与稀疏矩阵分解的问题,它将一般的图像矩阵恢复成低秩成分和稀疏成分.求解的过程中涉及到了松弛优化的技巧,将原先的非凸问题转变为凸函数,然后通过求低秩矩阵的核范数和稀疏矩阵的1范数来简化,最后可以用APG法和IALM法来计算迭代过程,得到最优解.从上文检测太阳能电池片表面缺陷的实验中,可以看出RPCA可以得到100%正确的实验结果,而且计算速度也较快.但投产到实际应用中,其还存在一些不足需要进一步研究,比如对输入图像数量的要求多于4张(上文实验中选取了16张)或需要4张以上的模版图像,在日后研究中希望通过对单幅图像分割成m×n(m、n为大于1的整数)的子图像来解决.还有图像初始取点来确定检测范围的问题,如果对同一批次大小完全相同的太阳能电池片来说,在光照等其他拍摄条件都一致的情况下,对第一幅图的初始取点可用作这一批次所有待测图像的定位点,而无需每次都重复取点.以上这些存在的不足都是日后深入研究亟需解决的问题,具体的解决方案希望在下一篇论文中进行详细论述.
