Page1一种基于粒子的牛顿流体与粘弹性流体统一模拟方法常元章1)柳有权2)鲍凯3)朱鉴1)吴恩华1),3)1)(澳门大学科技学院电脑与资讯科学系澳门)2)(长安大学信息工程学院西安710064)3)(中国科学院软件研究所计算机科学国家重点实验室北京100190)摘要在越来越受到人们关注的基于物理流体动画领域,目前分别模拟牛顿流体或粘弹性流体的方法很多,但很少有统一模拟两者的方法.文中基于光滑粒子流体动力学方法,通过对传统纳维-斯托克斯方程添加弹性应力项,提出了一种新的统一模拟牛顿流体和粘弹性流体的方法.通过实验说明该方法不仅有效,易于实现,而且具有良好的可控性,仅仅通过调节参数就可以模拟不同粘弹性、不同类型的流体现象.关键词光滑粒子流体动力学;牛顿流体;粘弹性流体;纳维-斯托克斯方程;弹性应力1引言流体现象广泛存在于日常生活、工业生产和计Page2定律,即剪应力与剪切应变率之间满足线性关系,粘性不随速度而变,称为牛顿流体(Newtonianfluid),如水、空气等;而把不满足线性关系的流体称为非牛顿流体(non-Newtonianfluid),如胶状物、牙膏等.粘弹性流体(viscoelasticfluid),属于非牛顿流体,它同时具有固体和流体的特征.该流体受到应力较小时表现出固体的特征,但应力超过阈值而产生较大应变时又体现出流体的特点.很多物质具有这样的特点,如黏液、胶、鸡蛋白、生面团、尚未凝固的混凝土、牙膏、黏土、洗手液、果冻、番茄酱等.在计算机模拟流体现象的方法中,“无网格”的光滑粒子流体动力学(SmoothedParticleHydrody-namics,SPH)是近年来一种比较流行的方法.这种方法不仅容易体现流体的细节,诸如浪花、泡沫和飞溅的效果,而且能很自然地处理有较大拓扑变形的流动,所以得到越来越广泛的应用.目前分别模拟牛顿流体或粘弹性流体的方法很多,但很少有统一模拟两者的方法.本文基于SPH方法,通过对传统Navier-Stokes(NS)方程添加弹性应力项,提出了一种新的统一模拟牛顿流体和粘弹性流体的方法.在实验中,从不同角度对所模拟流体的绘制结果和速度进行了对比、分析,充分说明了本方法的有效性.本文第2节介绍图形学领域中牛顿流体和粘弹性流体的相关工作;第3节提出模拟的统一方法;第4节说明绘制流体场景的方法;第5节对绘制结果从不同角度进行讨论与分析;最后一节总结并提出未来工作.2相关工作在计算机图形学领域,基于物理的流体模拟方法大致可以分为两大类:基于网格的欧拉方法和基于粒子的拉格朗日方法.欧拉方法将流体所占据空间离散成固定的网格,分析网格上每一固定点的流体速度、压强和密度等参数随时间的变化.该方法很容易保持流体不可压却不容易保证质量守恒;拉格朗日法则通过研究流体中每一微团的相应物理参数随时间的运动变化,来描述整个流体的运动.下面将分别对牛顿流体和粘弹性流体的相关工作做介绍.2.1牛顿流体欧拉法.1996年,Foster等人[1]首次在图形学领域通过有限差分的方法,在规则网格上求解三维Navier-Stokes方程.接着,Stam[2]引入了半拉格朗日机制和隐式积分求解的方法,使得计算能够采用较大的时间步长.为了准确捕捉流体表面的细节,Foster等人[3]引入了levelset方法,由于该方法体积损失比较严重,作者在流体内部分布一些无质量的粒子来弥补该缺陷.不久,Enright等人[4]提出了particlelevelset方法,通过在流体外部同样增加粒子来改进levelset方法;且通过将速度外推到空气中来正确处理自由表面处的边界条件,从而获得更加精确的界面和视觉效果.粒子法.SPH是目前最为常用的一种拉格朗日粒子法,该方法利用离散的粒子来表示流体,由于每个粒子包含着各自的质量,且粒子数目在模拟过程中保持不变,使得该方法容易保证流体质量守恒.不过由于通常用理想气体状态方程来求解压强,使得SPH方法存在弱可压的缺点.Desbrun等人[5]首次将该方法引入图形学领域来计算物体较大变形时的受力.接下来,Müller等人[6-7]推广了该方法,实现了交互级的流体模拟.Adams等人[8]通过对SPH粒子定义重要度为依据来使其自动合并和分裂,从而有效地加快了模拟的速度.最近,越来越多的人将目光投注在更加复杂的流体现象上,例如:流体在疏松多孔物质上的流动[9]、流体与颗粒状物质(如沙粒)的交互[10-11]、多相流自然灾害场景的真实模拟[12]等.关于SPH的全面介绍可以查看文献[13].粒子法里,还有一些其他的方法,如Premoe等人[14]引入了MPS(MovingParticleSemi-implicit)方法,通过解全局泊松方程来求解压强,从而使得流体不可压.由于各方法有各自的优势和局限性,目前也出现了一些混合表示的方法,如Losasso等[15]提出了一种双向耦合的模拟框架来同时利用SPH和particlelevelset的优点.2.2粘弹性流体欧拉法.Carlson等人[16]结合Marker-and-Cell(MAC)方法模拟了任意粘性的流体,甚至固体也当作高粘性流体处理,其中粘性随温度、水分含量而变化,从而实现了融化、凝固和流动效果.通过将粒子分割到高分辨率的网格中来精确抽取表面.具体求解中,为了避免高粘性带来的稳定性问题,扩散项采用隐式欧拉代替显式格式,并采用共轭梯度法来迭代计算.Goktekin等[17]通过在NS方程中加入弹性应力项成功地模拟了粘弹性流动现象,并采用vonMises判据来判断是否会发生塑性流动,如果应变偏差的Frobenius范数值大于屈服点,则以正比于超出量的速度塑性流动[18].接着,文献[19]通过考Page3虑旋转张量,对其公式进行了改进,可以真实模拟粘弹性流体的旋转效果.粒子法.Stora等[20]采用SPH方法逼真地模拟了火山熔岩粘性流动的过程.文献[21]基于拉格朗日粒子方法,将流体与物体间的力表示成粘附矩阵的形式,同时将物体表面也作粒子化表示,从而可以很方便地描述粘性流体与物体的相互作用.Mao等[22]为了避免文献[17]模拟粘弹性流体旋转时候存在的问题,在NS方程弹性应力张量项加入旋转张量,并使用SPH对流体进行模拟,但其所能模拟的现象仍然很有限.接着,作者在此基础上真实地模拟了互不溶粘性流体的碰撞及其响应[23].Paiva等[24]继承了文献[16]的想法,使用SPH较为真实地再现了物体的熔化,但其模拟的熔化物体和现象较为单一.与此同时,越来越多的研究者通过对粒子间增加弹簧来达到粘弹性的效果.Nixon等[25]对物体表面采用质点弹簧模型来表示,内部利用NS流体运动方程求解变形,从而可以模拟柔性物体运动变形情况.Clavet[26]通过修改弹簧的静止长度来达到不同的粘弹性、塑性效果.而Tamura[27]则通过随机连接的两种不同的弹簧来模拟粘弹性流体的表面.近年来,越来越多的工作[28-30]集中在通过有限元方法计算应变张量(straintensor)来模拟粘弹性流体.其他方法.Desbrun等[31]使用隐式曲面来模拟柔性物体的融合.Wei等[32]采用三维自动格子机(CellularAutomata)的方法,通过重力和传播两个规则来传递热量和流体,该方法的计算量相对于完全基于物理的方法要小很多.3统一的流体模拟方法本节阐述统一模拟牛顿流体和粘弹性流体的方法.该方法是通过对NS方程添加弹性应力张量项来实现的.本节重点对该项的求解进行剖析,并讨论流体运动时与障碍物的碰撞处理及模拟流程.3.1统一的模拟方法SPH是一种完全无网格的拉格朗日方法,流体运动用跟随流动的粒子运动来描述.流动的粒子储存了自己的质量、速度和位置等物理信息.空间任一位置狉处的属性A可通过周围粒子插值来计算:其中,下标j表示将位置狉周围支持域内的所有粒子求和,W(狉-狉j,h)是半径为h的光滑核函数,狉j,mj和ρj分别为粒子j的位置矢量、质量和密度.属性A的梯度值和拉普拉斯值也可以通过对光滑核函数W(狉-狉j,h)求相应值来得到:与传统的欧拉方法相同,SPH也是通过求解流体力学方程来对流体进行模拟的.对于恒温的不可压流体,描述其运动的主要方程包括质量守恒方程(连续性方程)和动量守恒方程(Navier-Stokes方程):ρD狏Dt=-p+μ2狏+μs·Selastic+ρ犵+犳surface其中狏,p,ρ,犵,μ分别为速度矢量、压强、密度、重力加速度矢量和动力粘度系数.μs·Selastic为本文为了统一模拟牛顿流体和粘弹性流体而对传统NS方程添加的弹性应力项,μs为弹性应力系数,Selastic为弹性应变张量,其求解方法下一小节具体介绍.犳pressure、犳viscosity、犳elastic和犳surface为对应的压强力项、粘滞力项、弹性应力项和表面张力项.由于SPH采用的粒子数目在模拟过程中保持不变,且每个粒子质量不变,因此SPH能够自动保证质量守恒.的方法:犳pressurei=μ∑j犳viscosityi=-σ狀i犳surface压强力、粘滞力和表面张力的计算采用文献[6]其中σ为表面张力系数,δ为预定义的阈值,当超过该阈值时表明粒子位于流体表面.狀i为表面法向,计算为为了求解式(6)和(7),需要首先求得粒子的密度和压强,密度计算如下:接着,粒子的压强可以通过理想气体状态方程得到[5]:Page4公式中k为与流体声速相关的常数,ρ0为预先设定的平衡密度常数.弹性应力项可以通过SPH插值表示为犳elastic3.2弹性应力项的求解本部分推导弹性应变张量Selastic的计算公式.如果能够获得流体的显式变形函数,则该值可以通过变形函数的空间导数求得.然而,由于流体运动变形的复杂性,几乎不可能找到一个有效描述的公式.因此,我们通过将弹性应变张量分解为总应变张量与塑性应变张量的差来间接求解:由于后两项也较难获得,可以转化为求其时间导数的方式:0和Splastic其中Stotal量与塑性应变张量,本文实现过程中将其设定为零矩阵.上述公式后半部分带有积分运算,在数值求解过程中需要将其离散化:公式中Δt为时间步长.下面分别求解dStotaldSplasticdt.前者即为应变率张量,可通过速度的梯度来求得其中狏为雅可比矩阵,在SPH计算中可求解如下塑性应变张量导数的求解需要引入另外一个量,弹性应变偏差S,其数值可通过弹性应变张量Selastic求得公式中Tr(Selastic)为张量方阵的迹,犐为单位矩阵.根据冯·米赛斯屈服准则(vonMises’syieldcriterion),当S的Frobenius范数值低于阈值τ时,没有塑性流动.当超过该值时,流动的速率将会正比于所超出的数值,表达为其中λ为所模拟流体的弹性衰减系数.Sf为张量S的Frobenius范数,定义为张量矩阵内部各元素平方和的平方根:这样,式(16)可以变为dSelasticdt=(狏+(狏)T)/2-λS将式(23)代入式(17)就可以求得每一时间步的弹性应变张量Selastic.3.3障碍物碰撞处理及模拟流程本节讨论流体粒子运动时与边界固体障碍物的碰撞处理,采用的方法与文献[26]类似但略有改动.为了检测粒子与边界固体的碰撞,程序初始化之前需预先对模拟场景进行距离场采样并保存到背景网格中.接着,在模拟过程中,对每个粒子插值计算出符号距离值d,并判断该值与边界固体碰撞阈值T的大小,如果小于该阈值表明发生碰撞.同时,碰撞点表面法向狀o可通过距离场梯度求得.当检测到碰撞且粒子已进入障碍物内部时,则将粒子位置沿着表面法向狀o垂直投影到表面;同时修改其速度如下:假设碰撞粒子相对于障碍物的速度为狏(本文实现设定障碍物固定不动,相对速度等于粒子自身速度),将其沿障碍物界面的法切向分解为碰撞后的法向和切向速度将变为其中,α为法向速度修改系数,实验取值0.05,碰撞后法向速度反向.β为表面摩擦系数,控制障碍物表面的滑移特性,可以获得自由滑移边界条件(β=1)和无滑移边界条件(β=0),本文取值0.9.碰撞后的总速度为切法向两速度之和.以上各节已经讨论了统一模拟牛顿流体和粘弹性流体的SPH方法.实际流程主要分为以下步骤:1.程序初始化.包括参数、几何场景、初始粒子分布等Page5的初始化.2.对每个粒子查找周围粒子并求解光滑核函数W(狉-狉j,h)及对应的梯度和拉普拉斯值.3.对每个粒子计算密度和压强.4.计算压强力、粘滞力、弹性应力和表面张力,并代入式(5)求解粒子的加速度.5.通过数值积分计算粒子的速度和位置,本文采用显式欧拉积分,为保证计算稳定,时间步长应满足CFL条件[33].6.判断粒子是否进入固体障碍物内部,如进入,进行碰撞处理.继续运行,转步2.4场景绘制第3节计算出流体粒子运动的位置、速度等物理信息,接下来需要构建流体表面.我们采用文献[8]的隐式表面定义方法:(狉)=∑j其中dj为粒子j到表面的距离,计算方法、核函数定义均与文献[8]相同.接着,我们采用marchingcubes[34]算法来对定义好的隐式表面进行三角形化,并用渲染引擎POV-Ray①来对提取出的三角形图1立方体流体块降落实验结果(从左到右时刻为0s,0.33s,0.58s,2s)图2穿山甲降落实验结果(从左到右时刻为0s,0.25s,0.57s,2s)网格进行绘制.5绘制结果与讨论为了验证本文方法的有效性和通用性,我们实现了立方体流体块降落、穿山甲降落、兔子斜坡滑落和立方体流体穿越障碍物4个实验的真实感建模与绘制.实验平台为IntelCore2DuoE84003.0GHzCPU,3GB内存和GeForce8800GTGPU的PC机.实验程序采用C++开发.实验中采用的数值计算时间步长为0.001s,每5个时间步输出一帧渲染数据.5.1模拟现象比较本节主要通过4组实验从不同角度对比模拟的牛顿流体(实验中为水)和粘弹性流体的异同.式(5)中参数μ和μs用来控制模拟流体的种类和粘滞度,水的参数μ和μs设定为8×104和0,粘弹性流体相应为8×105和8×106,其它模拟参数都相同.图1对比了立方体流体块从空中降落到地面的过程.可以看到,表面张力使得水块在降落过程中变成球体,但该力对于粘弹性流体的影响较小.落到地面后,前者会形成水花飞溅起来并最终落地归于平静;而后者会先水平撑开接着弹性回拢并最终平衡于棱台状.图2说明了本文提出的方法同样适用于复杂的①POV-Rayurl:http://www.povray.org/Page6几何形体.穿山甲水体会溅起更多的水花,在2s时静止于方行边界内,而粘弹性体则“下蹲”并“趴”在地上.图3与图4用来说明边界障碍物的滑移特性,由于本文设定式(27)的β取值0.9,即边界面近似光滑,本特征可以从图4看到.图5和图6描述了流图3水兔子斜坡滑落实验结果(从左到右时刻为0s,0.25s,0.53s,1.2s,4.09s)图4粘弹性兔子斜坡滑落实验结果(从左到右时刻为0s,0.25s,0.4s,0.55s,1.5s)图5水立方体穿越障碍物实验结果(从左到右依次为俯视图、仰视0s,0.3s,0.5s,3.46s时刻)图6粘弹性立方体穿越障碍物实验结果(从左到右依次为俯视图、仰视0s,0.525s,1.85s,5.4s时刻)5.2实验参数比较实验参数对于本文实验起着至关重要的作用,通过调整参数值能够模拟各种不同特性的流体.其中,式(5)的参数μ、μs和式(23)的τ最为重要.鉴于立方体流体块降落实验具有简单、效果对参数较为敏感的特点,接下来将通过该实验来对这3个参数的作用作对比分析.参数μ越大,流体粘性越大.图7说明当μs,τ一定时,流体粘性随着μ的增大而图7参数作用实验1(参数μs为0,τ为0.005,μ从左到右依次为8×104,2×105和8×105,时刻为0.6s)体如何经过复杂边界,从图中可以看到两种流体均部分穿越井字形障碍,之后水块溅起大量水花,并最终几乎全部落到地上;粘弹性流体块则沿着未被遮挡的空隙一点点断断续续地降落,5.4s时仍有部分滞留于障碍物上.增大,同一时刻溅起的水花越来越少.参数μs越大,流体越具有粘弹性.图8说明了μ,τ值一定时,随着μs的增大,流体粘性和弹性增大,模拟平衡状态时,从左到右棱台的形状越来越高瘦.参数τ对于粘弹性流体较重要,它影响棱台的形状,其值越大,棱台越高瘦,流体弹性越大(图9),其值为0.05时,可以在视频中看到立方体居然反复地弹性“跳动”.Page7图8参数作用实验2(参数μ为8×105,τ为0.005,μs从左到右依次为0,5×106和8×106,时刻为1.5s)图9参数作用实验3(参数μ为8×105,μs为8×106,τ从左到右依次为0,0.005和0.05,时刻为1.5s)5.3运行速度比较表1列出5.1节各实验的粒子数及运行速度,可以看到,粒子数越多,运行越慢.而相同粒子数情况下,粘弹性流体比牛顿流体的计算速度(平均每秒帧数Fps,不包含渲染时间)要慢15%~20%左右.对比实验1与实验4,可以发觉障碍物对于计算速度的影响较小.1立方体块降落水60841.922穿山甲降落3兔子斜坡滑落水23745.034立方体过障碍物水60841.906结论与未来工作本文基于SPH方法,通过对传统Navier-Stokes方程添加弹性应力项,提出了一种统一模拟牛顿流体和粘弹性流体的方法.实验从不同角度对所模拟流体的渲染结果和速度进行了对比、分析,充分说明了本方法的有效性,且通过调整参数可以模拟不同粘弹性、不同类型的流体.本文方法还具有易于实现的特点,可以很方便地添加到其它流体现象模拟中.今后,我们将进一步拓展本方法所能模拟的现象,并考虑采用GPU进行并行加速.
