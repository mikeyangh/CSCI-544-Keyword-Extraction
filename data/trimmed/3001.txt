Page1Petri网的符号ZBDD可达树分析技术李凤英1),2)古天龙2)徐周波1),2)1)(西安电子科技大学电子工程学院西安710071)2)(桂林电子科技大学计算机学院广西桂林541004)摘要Petri网是一种适合于并发系统建模、分析和控制的图形工具.可达树是Petri网分析的典型技术之一,它通过标识向量集合表征系统的状态空间,组合复杂性严重制约了该分析技术可处理系统问题的规模.零压缩决策图(Zero-SuppressedBinaryDecisionDiagrams,ZBDD)是一种新型的数据结构,是表示和处理稀疏向量集合的一种有效技术.文章基于Petri网可达标识向量的稀疏特征,给出了Petri网分析的符号ZBDD技术,该技术通过对标识向量(状态)的布尔向量表示、可达标识向量(状态)的符号ZBDD生成,实现Petri网可达状态空间的高效符号操作和紧凑符号表示.实验表明,基于ZBDD的符号可达性分析算法能够有效处理较大规模Petri网问题.关键词Petri网;零压缩二叉决策图;可达树;状态空间1引言Petri网是一种适于对具有异步、并发特征的离散事件系统进行模拟、分析、设计和控制的图形数学工具,已在制造系统、通信网络、数字电路综合与验证等领域得到了广泛应用[1-3].Petri网分析是其应用中的一个关键环节,现有的Petri网分析方法主要有可达树、状态方程以及结构化简等.可达树方法通过枚举方式穷尽生成Petri网的所有可达标识向Page2量,并以树结构形式表示Petri网的可达状态空间,进而判定相应的活性、安全性、有界性、可达性等性质.对于有界Petri网,可达树方法是一种有效和实用的技术;对于无界Petri网,则需要采用可达树方法的扩展技术———可达图方法.该类方法的局限性在于:状态组合复杂性制约了可处理Petri网模型的规模;状态方程方法通过Petri网的关联矩阵建立标识向量和迁移引发向量之间的矩阵代数方程,基于矩阵代数方程求解Petri网的位置(迁移)不变量,根据不变量的特征来判定Petri网的一些性质.该方法适合于特殊结构Petri网,且随着Petri网模型规模的增大关联矩阵的维数也随之增大,对于大规模Petri网的处理也会带来不便;结构化简方法通过合并特殊的位置、迁移或结构,在保持一定性质不变的前提下来降低Petri网的规模.该方法要求所处理Petri网具有特定的结构,一般作为前两种方法的辅助技术使用.在Petri网模型中,由系统自身的并发特性和状态迁移的语义交织引起的状态组合复杂性,是Petri网分析技术中的一个瓶颈问题,严重制约了Petri网的应用[4].状态组合复杂性一直是计算机科学和应用人员关注的一个重要问题.减缓或者部分程度上避免状态组合复杂性问题的一种可行策略是:状态的符号或者隐式描述.有序二叉决策图(OrderedBinaryDecisionDiagram,OBDD)则是迄今为止最为有效的符号技术之一[5-6].OBDD为布尔函数提供了一种有效和规范的描述方法,同时,布尔函数的所有复杂运算都可以基于OBDD数据结构得到极大地简化实现.尽管,OBDD技术并不能克服所有应用中的状态组合爆炸,但确实解决了许多无法解决的大规模状态应用问题(如,OBDD可处理具有1020状态的应用系统,而显式枚举所能处理的系统状态为103~106).Pastor等建立了基于有序OBDD的Petri网符号分析方法,其实质是用OBDD表示Petri网标识集的特征函数,对Petri网的各种性能进行分析.该方法适用于有界Petri网,为大规模Petri网模型的分析探索了一条新的有效途径[7-8].零压缩二叉决策图(Zero-SuppressedBinaryDecisionDiagrams,ZBDD)是OBDD的一种扩展形式,是描述和操作稀疏二进制向量的高效技术[9-11].在ZBDD技术中,ZBDD的结点数取决于二进制向量集合中1的个数.在Petri网中,位置中的令牌(token)对应于标识向量中非零元素,并且Petri网的标识向量具有稀疏特征.鉴于此,我们建立了基于ZBDD的Petri网T≠);3,…}),即关系弧的权重;无穷大数);符号可达树分析技术,给出了Petri网的符号ZBDD表示、可达标识向量生成算法.算例仿真结果表明了符号ZBDD分析技术的有效性.2预备知识2.1Petri网〈P,T,F,W,K,M0〉,其中,定义1.一个Petri网定义为六元组:PN=P={p1,p2,…,pn}为位置集合;T={t1,t2,…,tm}为迁移集合(P∩T=,P∪F(P×T)∪(T×P)为流关系(关系弧);W:F→Z+为流关系的权函数(Z+={1,2,K:P→Z+∪{ω},是位置上的容量函数(ω为犕0:为初始标识向量.一个标识向量是一个函数M:P→Z+∪{0},表示位置中令牌的分布情况.定义2.对于t∈T,p∈P,令·t={p|(p,t)∈F},t·={p|(t,p)∈F},·p={t|(t,p)∈F},p·={t|(p,t)∈F},则称t·(·p)为迁移t(位置p)的前集或输入集,t·(p·)为迁移t(位置p)的后集或输出集.Petri网中位置是静态的,迁移是动态的.迁移的引发将使位置中令牌的分布发生变化,即产生新的标识.迁移t1,t2,…,tr的依次引发,将使标识依次发生变化M0,M1,…,Mr,相应地产生一引发序列σ=M0t1M1t2…trMr,或简记为σ=t1t2…tr,并称标识Mr是从M0引发σ可达的,记为M0[σ〉Mr或Mr∈[M0〉.定义3.在一个具有初始标识M0的Petri网中,位置p∈P为k-有界的(k∈Z+),当且仅当M∈[M0〉:M(p)k.一个Petri网为k-有界的,当且仅当Petri网中每一位置都是k-有界.Petri网是安全的,当且仅当它是1-有界的.显然,对于安全Petri网,对于M∈[M0〉有:M(p)1,且每条弧上的权重为1,所以安全Petri网可以简写为四元组:PN=〈P,T,F,M0〉.定义4(迁移的使能条件).如果p∈·t有M(p)W(p,t),且p∈t·有M(p)K(p)-W(t,p),则称迁移t是使能的或者具有引发权.定义5(迁移的引发规则).在标识M下,使能迁移t的引发将产生新的标识M,记为M[t〉M:M(p)=M(p)-W(p,t)+W(t,p).Page32.2零压缩二叉决策图对于从{0,1}n到{0,1}的布尔函数f(x1,x2,…,xn),若第i个分量xi取值为0或1,则得到{0,1}n-1到{0,1}的布尔函数f(x1,…,xi-1,1,xi+1,…,xn)或f(x1,…,xi-1,0,xi+1,…,xn),简记为fxi或fxi.布尔函数fxi和fxi分别称为布尔函数f(x1,x2,…,xn)关于变量xi的1-分量(xi分量)和0-分量(xi分量).定义6.对于从{0,1}n到{0,1}的布尔函数f(x1,x2,…,xn)和给定变量序π(即x1,x2,…,xn是有顺序的),有序二叉决策图(OBDD)是一个无环有向图,它满足:①OBDD中结点分为根结点、终结点和内部结点三类;②终结点仅有两个,分别标记为0和1,并表示布尔常量0和1;③根结点和内部结点具有四元组属性(pointer(u),var(u),low(u),high(u)),其中,pointer(u)表示结点u所对应的布尔函数(对于根结点u,pointer(u)=f(x1,x2,…,xn));var(u)表示结点u的标记变元(根结点u的标记变元为变量序π中的第一个变量);low(u)表示结点u的0分枝子结点,对应于该结点布尔函数pointer(u)中变元var(u)取0值后的布尔函数;high(u)表示结点u的1分枝子结点,对应于该结点布尔函数pointer(u)中变元var(u)取1值后的布尔函数;④根结点和内部结点均具有两个输出分枝弧,将它们和各自的两个分枝子结点联系在一起.结点u和low(u)的连接弧称为0-边,结点u和high(u)的连接弧称为1-边,且满足:对于结点u,low(u)≠high(u);对于var(u)=var(v)的不同结点u和v,则low(u)≠low(v)或者high(u)≠high(v);⑤任一有向路径上,布尔函数f(x1,x2,…,xn)中的每个变元均以变量序π所规定的次序依次至多出现一次.在图形表示中,用方框表示终结点,用圆圈表示其它结点,结点之间通过虚线或者实线连接.通常,假设连接弧的方向向下,0-边用虚线表示,1-边用实线表示.零压缩二叉决策图(ZBDD)是一种特殊的OBDD,是日本学者Minato为了克服OBDD表示组合集合(有限集合A的组合集合是该集合的幂集2A的一个子集合)的不足提出的,进一步降低了组合集合表示的空间需求,从而更为有效地处理组合集合相关的问题[9-10].对于具有n个元素的集合A={a1,a2,…,an},从A中不考虑次序地取出任意r个元素,其中0rn,所得到的集合称为集合A中元素的一个组合.若集合A中的每个元素ai均对应一个布尔变量xi,则组合集合中的元素可以用一个n维布尔向量(x1,x2,…,xn)表示,当元素ai不包含在组合中时,对应布尔变量xi=0,否则xi=1.由此可见组合集合可以用一个n元布尔函数f(x1,x2,…,xn)表示.OBDD为布尔函数提供了紧凑规范的表示,在很多情况下OBDD表示可大大降低组合集合表示的空间需求,使表示组合集合所用的结点数远小于集合包含的元素个数,并且使集合上的操作时间与表示集合所用的结点数目成正比.但是,用OBDD表示组合集合仍然存在一些问题,即组合集合的OBDD表示依赖于布尔变量的个数,当布尔变量个数不同时,相同的组合集合会得到全然不同的OBDD.比如对于两个不同的布尔变量域{a,b,c}和{a,b,c,d},要表示相同的组合集合{a,b},就会有两种截然不同的OBDD表示,如图1(a)和(b)所示.这表明OBDD表示与布尔变量域的选取有关.在ZBDD中,通过采用不同的冗余结点删除规则,有效改善了表示组合集合的效率.这也正是ZBDD不同于OBDD之处.在OBDD中,采用的是S-删除规则:删除那些0分枝结点和1分枝结点相同的冗余结点,如图2(a)所示.在ZBDD中,采用的是pD-删除规则:删除1分枝结点为0终结点的结点,如图2(b)所示.使用了新的删除规则的ZBDD中,未出现变量的缺省就表示该变量取值为0.图3给出了不同的布尔变量域{a,b,c}和{a,b,c,d}下组合集合{a,b}的ZBDD表示.对于同一个组Page4合集合,只有一种ZBDD表示,这是因为ZBDD表示与布尔变量域无关.由图3可见,ZBDD表示组合集合比OBDD更为紧凑,这得益于ZBDD所采用的pD-删除规则.从ZBDD的根结点到1-终结点的路径数正好跟组合集合的元素个数相等,每条路径对应一个组合,路径中结点的个数与组合中变量的个数相等.ZBDD的基本操作有9个①,这里主要介绍其中3个,分别由一个基本函数实现,其中P和Q表示以ZBDD表示的集合,v表示输入变量(布尔变量域):合的集合;组合的集合;Subset0(P,v):返回P中不包含元素v的所有Subset1(P,v):返回P中包含元素v的所有组Change(P,v):对P中的每个组合,若包含v,在该组合中删除v;若不包含v,在该组合中增加v.对于变量集合V={v1,v2,…,vn},Subset操作和Change操作可进行如下扩展:v1),…),vn-1),vn)Subset1(P,V)=Subset1(Subset1(…(Subset1(P,v1),…),vn-1),vn)Subset0(P,V)=Subset0(Subset0(…(Subset0(P,Change(P,V)=Change(Change(…(Change(P,v1),…),vn-1),vn)3安全Petri网的符号分析对于安全Petri网PN=(P,T,F,M0),设P={p0,p1,…,pm},任一可达标识的特征函数都可以用位置集合的一个子集来表示,在子集中出现的位置,说明该位置包含了令牌.标识集(标识向量构成的集合)可以用一个关于P的组合集合表示.例如,图4给出了一个包含5个位置P={p0,p1,p2,p3,p4}的安全Petri网,用{p0p2}表示初始标识位置p0和p2含有令牌,位置p1,p3和p4不含有令牌的标识.空标识集用逻辑“0”表示,对应ZBDD的0-终结点,本文也用“logicZero”表示,标识全集(不一定与可达标识集相等)的特征函数用逻辑“1”表示,对应ZBDD的1-终结点,本文也用“logicOne”表示.标识集之间的操作可以通过ZBDD提供的运算来完成.Petri网的结构蕴含着一个局部状态改变集,可称之为迁移函数,迁移函数决定了Petri网的动态特性.对于安全Petri网PN=(P,T,F,M0),若用Et表示迁移t的使能标识集的特征函数,则迁移ti和tj并发的使能标识集为Eti∧tj=∏pi∈·ti在标识M下使能迁移t的迁移函数δt将每个属于Et的标识M变为新的标识M,定义为考虑在一个标识集而不是一个标识的情形下引发迁移t的情况.这种情况下,标识集1由于迁移t引发而变换成标识集2.通常把迁移函数δt导出的这种求一个标识集下由于迁移t引发而得到的可达标识集的运算称作image运算,image运算可表达为2=img(1,t)={M2M1∈1∧Et,δt(M1)=M2},ti和tj并发时,可表达为img(1,ti∧tj)=2={M2M1∈1∧Eti∧tj,更多个迁移并发的情况可进行类似推广计算.达为标识集下一步能到达的标识集的计算可表①AnIntruductiontoZero-SuppressedBinaryDecisionDia-Page5标识集的可达标识集可通过一个运用image运算的符号遍历算法求出.该算法在宽度优先搜索算法的基础上,引用贪婪链技术实现了求可达标识的集合计算,即每次计算都是求一个标识集的可达标识集,而不是只求某个标识的可达标识,因而极大地减少了生成Petri网的所有可达标识集的运算次数.图5给出了Petri网的符号遍历算法.Traverse_Petri-net(PN=(P,T,F,W,M0)){Reached=From={M0};}以图4所示的安全Petri网为例,利用图5所示的Petri网符号遍历算法,用一次外部迭代和三次内部迭代就可得到所有可达标识(如图6(a)所示).图6(b)为可达标识集的ZBDD表示,只用了9个结点.图6(c)为该可达标识集的OBDD表示,需要14个结点.图6安全Petri网的符号ZBDD可达树分析4加权和有界Petri网的符号分析这一节主要将Petri网的符号ZBDD表示和分析技术扩展到加权和有界Petri网.4.1位置编码一个最多包含k个令牌的位置p∈P可以由一个布尔变量集p0,…,pKp来表示,用它来为p中的k个令牌编码.使用二进制编码时,一个k-有界的位置需要log2(k+1)个布尔变量,即Kp=log2(k+1)-1.例如,在3-有界的Petri网中,需要两个布尔变量.对形如N=∑Kp以图7所示Petri网为例,位置p0、p1、p2和p3的界分别为3,2,2和6.因此位置p0、p1和p2需要两个变量编码,分别为p00p10,p01p11和p02p12,p3需要3个变量编码,即p03p13p23.该Petri网的初始标识的布尔特征函数为{p10p02}.4.2迁移引发这里主要讨论加权和有界Petri网的迁移函数和迁移关系的二进制编码问题.迁移t使能的标识集的特征函数(Et)写成如下形式:Et=∏p∈·t在标识M下使能迁移t的迁移函数可写成如下形式:δt(M)=使用二进制编码表示时,用一组布尔变量p0,…,pKp表示位置p中令牌的数量,用同样数量的布尔常量w0,…,wKp表示权重W(p,t),关系M(p)W(p,t)可以用下面的式子来描述:Page6M(p)W(p)=(pKp>wKp)·(pKp-1>pKp-1)·…·(p1+p1)·(p0+p0)+(pKp=wKp)·(pKp-1>wKp-1)·(pKp-2+pKp-2)·…·(p1+p1)·(p0+p0)+(pKp=wKp)·(pKp-1=wKp-1)·(pKp-2>wKp-2)·…·(p1+p1)·(p0+p0)+…+(pKp=wKp)·(pKp-1=wKp-1)·…·(p1=w1)·(p0>w0)+(pKp=wKp)·(pKp-1=wKp-1)·…·(p1=w1)·(p0=w0).其中,·是逻辑与操作;+是逻辑或操作;>是大于操作,a>b即表示ab.由特征函数Et定义的使能迁移t的标识为∏p∈·t∑Kp[[∏i-1h=0在图7所示Petri网中,每个迁移的使能标识集为Et0=[(p10>0)·(p10+p00)·M(p)i=03+(p00=0)·(p10=1)]=p00p10+p10,Et1=[(p11>0)·(p01+p01)·(M(p)k)+(p01=1)·(p11=0)]·[(p03>0)·(p13=1)·(p23=0)·(M(p)k)+(p23>0)·(p03+p03)·(p13+p13)·(M(p)k)+(p03=0)·(p13=1)·(p23=0)]=(p11+p01)·(p13+p23+p03p13+p03p23+p13p23),Et2=[(p12>0)·(p02+p02)·(M(p)k)+(p02=1)·(p12=0)]=p02+p12.对于任何使能迁移t的标识,迁移的引发必须从其输入位置中移走相应的令牌,并在输出位置中增加相应的令牌.位置p中令牌的数量用布尔变量p0,p1,…,pKp的向量来表示,必须要减去的令牌的数量用布尔常量的向量狑0,狑1,…,狑Kp来表示时,迁移函数δt(M)与二进制向量表示的两个自然数的减法是等价的,可以由下面的表示:δt(M)=M(p)-W(p,t)=(p0w0,p1w1B0,…,pKpwKpBKp-1),其中,为异或操作;Bj(j=0,1,…,KP)为借位函数,定义为B0=p0·w0Bj=pj其中,≡表示逻辑相等,a≡b即表示ab+珔a珔b.另一方面,必须添加的令牌的数量可以由另一个布尔常量的向量狑0,狑1,…,狑Kp表示,这时,迁移函数δt(M)与二进制向量表示的两个自然数的加法是等价的,可以由下面的等式表示:δt(M)=M(p)+W(t,p)=(p0w0,p1w1C0,…,pKpwKpCKp-1),其中,Cj为进位函数,定义为C0=p0·w0,Cj=pj以上两种情况都必须选择合适的变量wj,其中wj表示自然数常量W的第j位:烄wj=烅烆综上所述,位置pi的第j个变量的迁移函数δtji(M)=δtj所以,迁移函数的计算式为映像函数img扩展到有界和加权Petri网为img(1,t)=2=在图5的Petri网符号遍历算法基础上,我们采用上式给出的映像函数img,就可以实施加权和有界Petri网的可达状态空间的生成.5实验结果及分析为了检验Petri网符号ZBDD分析算法的性Page7能,选两组例子进行实验.第一组为可以升级的例子,主要检验安全Petri网的符号ZBDD分析算法的性能.一个是典型的哲学家就餐问题,其中n是哲学家的人数,图8(a)给出了一个哲学家就餐问题的图8Petri网模型的例第二组实验选用柔性制造系统(FMS)中作业调度的Petri网模型,主要检验有界和加权Petri网的ZBDD分析算法的性能.假设一个FMS有3台机器,4种作业J1、J2、J3、J4,每个作业有4个过程,它们对机器的需求如表1所示.第1行第J1列的M1/M2表示作业J1的第一个过程可以由M1或M2进行加工.其中Petri网的建模借鉴了文献[13]所介绍的方法.过程1M1/M2M1/M2M1/M2/M3M2/M32M2M3M2/M3M1/M33M1/M3M1/M2M1/M3M2/M34M1/M2M1/M3M1/M2M1/M2/M3利用Colorado大学的CUDD①软件包,用C语言进行编程,在运行平台Windows2000、P41500MHzCPU、128MBRAM上,对上面例子进行了实验,实验结果如表2和表3.表2和表3中位置列表示Petri网模型中位置的个数,迁移列表示迁移的个数,变量是OBDD或ZBDD所用变量的个数,可达标识是可达标识的个数,可达结点是可达标识集的OBDD或ZBDD表示的结点数,最大结点是算法运行中所需OBDD或ZBDD结点数的最大值,迭代次数是遍历算法中需要迭代的次数,时间是算法运行的CPU时间,单位为秒.Petri网表示[8],图中虚线箭头表示可以扩展为n个哲学家就餐问题.另一个是局域网的槽环协议,图8(b)所示的是一个结点的槽环协议的Petri网模型[8],虚线表示可以扩展为n个结点的槽环协议.从表2所示实验结果的可达结点列可以看出,对于同样的可达标识集,ZBDD的大小是OBDD的一半或三分之一.比如phil_15中,1.0×1010个可达标识用OBDD表示需要584个结点,而用ZBDD表示只用312个结点.从时间列可以看出,用ZBDD比用OBDD要快,尤其对于大规模Petri网,效果更加明显.这就说明,基于ZBDD的符号分析算法可用于较大规模Petri网的可达树生成和分析.表3中名称列的Jobi_j_k表示该FMS中有i个作业、j台机器、生产批量为k.从该表的可达结点列可以看出,有界Petri网的标识向量不像安全Pe-tri网那样稀疏,所以可达标识的结点数相差不是很悬殊,但ZBDD的结点数还是要比OBDD的结点数少.从最大结点列可以看出,由于对迁移的使能函数做了改进,ZBDD算法在执行过程中所需的最大结点数大大减少.这样,对于较大规模的有界Petri网,ZBDD算法能在合理时间内求得其相应的可达标识集.6结束语零压缩二叉决策图(ZBDD)能有效地表示组合集合,是求解组合集合相关问题的有效工具.根据①CUDD:CUdecisiondiagrampackagerelease2.3.1.Page8表2安全Petri网的实验结果名称位置迁移可达标识Phil_535252.2×103351571218920.063552559220.03Phil_856402.2×105562228827920.44561705415820.06Phil_1070504.7×106703974840320.89702876020220.13Phil_15105751.0×10101056861358424.611057146531220.28Phil_201401002.2×101314071663744217.0214013337042220.53Slot_550501.7×106509432554081.815012071741180.33Slot_770708.0×1087048423110141013.8870630168791101.48Slot_990903.8×1011902242495163212247.219022071401291125.20表3有界Petri网的实验结果名称位置迁移可达标识Job2_3_1272811279467120.01275961820.02Job2_3_227283.0×103373152746241.11371670020640.05Job2_3_427281.6×1054766546813658.234712001255260.23Job2_3_827281.6×10757932859172710307.75577731291932101.53Job3_3_141461.4×103411840932230.8841871312530.06Job3_3_241461.2×10556183012936440.42567798237540.25Job3_3_441463.5×10771溢出Job3_3_841464.5×101086溢出Job4_3_155641.3×104555961640832.42552732519930.11Job4_3_255643.9×10675溢出Job4_3_455645.6×10995溢出Petri网状态向量稀疏的特点,本文给出了基于ZBDD的Petri网的标识向量表示、使能迁移计算、可达标识向量生成的符号方法,使得Petri网的动态行为的计算能够在基于ZBDD数据结构的紧凑表示和高效操作下得到实施.在Petri网分析的时间和空间效率上,符号ZBDD技术都体现出了较之于符号OBDD技术具有明显的优势.Petri网的可达状态空间是Petri网应用于系统模拟、分析、控制及其调度等的核心和基础.我们可以在生成Petri网可达状态空间的过程中,通过符号ZBDD的操作函数方便地实施Petri网的安全性、活性、有界性、可达性等性质判定.同时,我们也可以基于Petri网可达状态空间的紧凑符号ZBDD描述,开展Petri网模型下系统的控制策略、调度方案等的设计,这是我们正在开展的研究课题.此外,基于ZBDD描述的Petri网性质证明、ZBDD的变量序问题等也将是进一步开展的研究工作.
