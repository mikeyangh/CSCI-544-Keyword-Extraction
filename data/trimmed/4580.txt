Page1基于深度图像利用遮挡信息确定下一最佳观测方位1)(燕山大学信息科学与工程学院河北秦皇岛066004)2)(河北省计算机虚拟技术与系统集成重点实验室河北秦皇岛066004)摘要文中提出一种新颖的利用深度图像中的遮挡信息确定下一最佳观测方位的方法.该方法首先从某一观测方位获取视觉目标的一幅深度图像,然后根据已获得的深度图像中的遮挡信息确定出下一最佳观测方位.主要贡献在于:(1)提出深度图像中最大深度差相邻点的概念,利用其与深度图像中的遮挡边界点可获取遮挡区域外接表面信息;(2)一种基于投影降维思想的遮挡区域外接表面最佳小平面集合的确定方法,用于确定下一最佳观测方位;(3)一种基于最佳小平面集合的下一最佳观测方位确定算法.所提方法无需预先获取视觉目标的先验知识及将摄像机的观测位置限定在固定表面上,适用于具有不同型面的视觉目标.实验结果验证了所提方法的可行性和有效性.关键词深度图像;遮挡信息;下一最佳观测方位;最大深度差相邻点;最佳小平面集合1引言下一最佳观测方位(NextBestView,NBV)的确定一直是三维重建、机器人导航、自动装配、目标识别等领域重要且困难的研究课题之一,它根据当前观测到的信息,确定出摄像机(传感器)的下一观测方向和位置,使得从该方向和位置能够最大量地获取所希望观测到的场景或视觉目标的未知信息.到目前为止,NBV确定算法所基于的图像信息类型主要有两种:图像亮度信息和图像深度信息.基于图像亮度信息的NBV确定算法相对较少,比较有代表性的如:Bottino等人[1]提出一种由轮廓得到形状的重建算法,该方法基于一个最优重建条件来判断是否需要进一步观测,若需要,则根据特定的规则计算出下一最佳观测方位;Trummer等人[2]提出一种综合在线方法用于规划下一最佳观测方位,从而达到优化任意目标三维重建结果精度的目标.Haner和Heyden[3]提出一种利用协方差传播理论确定下一最佳观测方位的方法.同2D的亮度图像相比,2.5D的深度图像更利于获得场景的三维信息,因此,现有的NBV确定算法一般都基于深度图像实现.ConnollyNBV问题进行研究的学者之一,他采用八叉树模型来描述视觉目标,并根据每个节点实际代表的空间是否为空将其进行标记,进而确定出下一最佳观测方位.Maver和Bajcsy域进行多边形建模,提出一种利用遮挡信息确定下一最佳观测方位的方法.Whaite和Ferrie[6]利用深度数据建立物体的参数相似模型,将深度数据与当前模型拟合最差的视角方向作为下一最佳视角方向.Pito[7]通过应用PS(PositionalSpace)算法确定当前观测方位下观测不到的未知区域,进而从大量潜在的观测方位中确定出下一最佳观测方位.Banta等人[8]提出一种组合方法来确定下一最佳观测方位.Chen和Li[9]提出一种基于模型的视点规划方法,该方法对视点设置了一系列约束条件,通过HG(HierarchicalGenetic)算法和Christofides算法来解决视点规划问题.Li和Liu[10]提出一种基于信息熵的视点规划方法,下一最佳观测方位为视觉传感器获得模型最大信息熵的位置.Scott[11]提出一种基于模型的3M(ModifiedMeasurabilityMatrix)算法来解决视点规划问题.然而,上述方法在适用范围、遮挡处理或计算效率等方面存在一些不足.文献[1]所提方法不适合具有复杂表面的视觉目标,因此方法的适用范围有限.文献[2,4,6]所提方法未考虑遮挡因素,因此当视觉目标出现遮挡现象时,这些方法将无法保证所得结果的正确性.文献[5]所提方法针对于特定的设备.文献[7-8,10]所提方法确定出的观测位置被限定在一个固定的表面(如球体表面、圆柱体表面等),因此方法的通用性受到了限制.文献[3,7,9]所提方法计算耗时较大,实时性较低.文献[8-9,11]所提方法需要预先获取场景的先验知识(如场景中视觉目标的尺寸等),因此不适用于未知场景.针对已有NBV方法的不足,本文提出一种基于深度图像利用遮挡信息确定下一最佳观测方位的方法.该方法首先从某一观测方位获取视觉目标的一幅深度图像,然后根据已获得的深度图像中的遮挡信息确定出下一最佳观测方位,从而使摄像机在所求观测方位下能够最大量地观测到当前观测方位下视觉目标上的遮挡区域.在方法的设计过程中,我们主要解决了两个问题:(1)如何建立视觉目标遮挡区域的模型;(2)如何利用获得的遮挡区域信息确定下一最佳观测方位.针对第1个问题,我们提出了最大深度差相邻点的概念,通过利用深度图像中遮挡边界点及其最大深度差相邻点的三维信息实现了对遮挡区域的建模,从而获得了遮挡区域外接表面信息.针对第2个问题,基于已获得的遮挡区域外接表面信息,我们首先提出了一种基于投影降维思想确定遮挡区域外接表面最佳小平面集合的方法,然后提出了一种利用遮挡区域外接表面最佳小平面集合确定下一最佳观测方位的方法.实验结果验证了所提方法的可行性和有效性.本文第2节概述所提方法的基本思想;第3节详细论述如何依据深度图像中的遮挡信息确定出下一最佳观测方位;第4节给出实验结果及分析;第5节总结全文.2方法概述2.1下一最佳观测方位描述观测方位即摄像机(观测者)观测视觉目标时的方向和位置.图1所示为一个理想的视觉目标,由于在当前观测方位下存在遮挡现象,为了获取视觉目标上遮挡区域(如图1中所示的灰色区域)内的未知表面信息,需要调整摄像机对其进行下一步观测.其中,遮挡区域内的未知表面包括两个部分:一是视觉Page3目标的一部分背面;二是视觉目标上的被遮挡表面.在所有可能的下一观测方位中,下一最佳观测方位图1下一最佳观测方位描述为了求解下一最佳观测方位,本文首先提出了最大深度差相邻点的概念,在此基础上,最终给出了基于深度图像利用遮挡信息确定下一最佳观测方位的方法.2.2最大深度差相邻点、遮挡区域外接表面及其小平面对于当前观测方位下存在遮挡现象的视觉目标,由于遮挡区域的信息是未知的,因此需要利用遮挡区域外接表面近似地代表遮挡区域内的未知表面[5].为了结合深度图像中的遮挡信息给出遮挡区域外接表面的定义,本文提出了最大深度差相邻点的概念,其定义为深度图像中任一像素点8个邻域像素点中与其深度差最大的像素点.图2(a)所示为图2视觉目标遮挡区域外接表面及视觉目标深度图像将图2(a)中所示的遮挡区域外接表面单独提取出来并将其划分为若干足够窄的小平面(如图3所示),则每个小平面(图3中各虚线框区域)就可以用一条线段近似地表示,该线段的两个端点分别对应一个遮挡边界点及其最大深度差相邻点,我们称这样的线段为遮挡线段.任取遮挡区域外接表面上的一个小平面Patchi,根据文献[12],Patchi的最佳观测方向应为垂直指向Patchi的方向,最佳观测中心点(摄像机主光轴正对的场景点)应为遮挡线段的中点,即在该观测方位下摄像机能够观测到最大面积的Patchi.即能够使摄像机获取到最大量遮挡区域内未知表面信息的观测方位.一个理想视觉目标,其由△ABC(记为面U)以及矩形BCDE(记为面L)组成.在摄像机当前的观测方位下,面U遮挡了面L,其对应的深度图像如图2(b)所示.在图2(b)中,由遮挡边界点构成的线段称为遮挡边界,其为视觉目标深度图像中发生遮挡现象的多个部分之间的分界线,对应图2(a)中的线段AB和线段AC;与遮挡边界对应的线段为由各遮挡边界点的最大深度差相邻点构成的线段,称为邻接边界,对应图2(a)中的线段FB和线段FC,在图2(a)中,由线段AB、线段AC、线段FB和线段FC所确定的四边形ABFC称为遮挡区域外接表面,其可定义为由深度图像中的遮挡边界和邻接边界对应的视觉目标上的直线段(曲线段)所确定的多边形(曲面).2.3下一最佳观测方位问题分析基于下一最佳观测方位问题及遮挡区域外接表面的描述可知,摄像机对遮挡区域内未知表面的观测可近似等价为其对遮挡区域外接表面的观测,故能够最大量地观测到遮挡区域外接表面信息的观测Page4方位即可视为下一最佳观测方位,其中,信息量的大小通过表面积来衡量.据此可给出下一最佳观测方位问题的描述如下:记任意下一观测方位为狓nv,记摄像机在该观测方位下所能观测到的遮挡区域外接表面的面积Snv=fs(狓nv),遮挡区域外接表面的总面积为St,所有可能的下一观测方位组成的集合为{X}nv,则下一最佳观测方位狓nbv可定义为狓nbv=argmax分析可知,在理想情况下{X}nv可视为无穷集,因而直接求解下一最佳观测方位非常困难.虽然能够通过设定约束条件限制摄像机的观测方位以获取有穷的{X}nv,从而基于搜索的方式从{X}nv中确定下一最佳观测方位,但摄像机的灵活性会受到限制.同时,在{X}nv较大的情况下,搜索过程耗时也较大.针对上述情况,本文提出了下一最佳观测方位问题的对偶问题,具体描述如下:记rt为当前观测方位下整个遮挡区域外接表面,狓v为rt的任一观测方位,摄像机在狓v下所观测到的rt的面积Sv=gs(狓v),则rt的最佳观测方位狓bv应满足狓bv=argmax其中,{X}v为rt所有可能的观测方位组成的集合.由于摄像机在狓nbv及狓bv下均能够观测到最大面积的遮挡区域外接表面并且{X}v{X}nv,因此可将下一最佳观测方位的求解转化为遮挡区域外接表面最佳观测方位的求解,rt的最佳观测方位狓bv即为下一最佳观测方位狓nbv.由于遮挡区域外接表面rt可能比较复杂,直接求其最佳观测方位比较困难.所以,基于分治思想,可利用前述遮挡线段将rt划分为若干足够窄的小平面Patchi并分别计算各小平面的最佳观测方位信息,在此基础上,确定一个最佳小平面集合{P}nbv,图4下一最佳观测方位确定流程由于目前已很容易获得视觉目标的深度图像(如用Kinect),且可以利用已有方法检测到深度图像中的遮挡信息[13-16],故本文不再对深度图像获取及遮挡检测方法进行探讨,而是重点论述如何利用遮挡信息确定下一最佳观测方位.使{P}nbv中的各小平面所组成的表面为摄像机在rt的最佳观测方位下观测到的遮挡区域外接表面,通过对{P}nbv中各小平面的最佳观测方位信息加权求和可求出rt的最佳观测方位,即下一最佳观测方位.记{P}t为划分rt所得全部小平面组成的集合,{Φ}t为{P}t的所有子集组成的集合,rnv为摄像机在下一观测方位狓nv(狓nv∈{X}v)所能观测到的遮挡区域外接表面,对rnv进行划分可得小平面集合{P}nv({P}nv∈{Φ}t),令{P}nv=fseg(狓nv),{P}nv中各小平面的面积之和为fΣ({P}nv),则最佳小平面集合{P}nbv可定义为s.t.0fΣ({P}nv)St,{P}nv=fseg(xnv),由于{P}t是有限集(其中的元素个数与深度图像中遮挡边界点的个数相等),因此{Φ}t也为有限集.又由于最佳小平面集合{P}nbv∈{Φ}t,因此通过设计适当的搜索策略即可从{Φ}t中确定出{P}nbv.在此基础上,分别计算{P}nbv中各小平面的最佳观测方位,通过对其加权求和即可计算出下一最佳观测方位.2.4方法总体思想基于上述分析,本文提出一种基于深度图像利用遮挡信息确定下一最佳观测方位的方法.方法总体思想如下.首先,获取视觉目标的一幅深度图像,同时记录摄像机当前的内外参数.其次,计算深度图像中的遮挡信息并提取最大深度差相邻点.然后,利用上述得到的信息计算遮挡区域外接表面上各小平面的最佳观测方向及观测中心点.最后,计算出最佳小平面集合,基于得到的最佳小平面集合计算出下一最佳观测方位.所提方法流程如图4所示.3利用遮挡信息确定下一最佳观测方位3.1提取最大深度差相邻点获得深度图像及其遮挡信息后,下一步工作是Page5提取最大深度差相邻点.依据前述所提最大深度差相邻点的概念,记深度图像I中任一像素点p(i,j)的深度值为d(i,j),则该像素点的最大深度差值fMDD(i,j)的计算公式为fMDD(i,j)=maxs.t.i-1xi+1,j-1yj+1(4)提取一幅深度图像的最大深度差相邻点的具体方法为:遍历整幅深度图像中的各点,按式(4)计算各点的最大深度差值,记录下各最大深度差值对应的邻域点的像素坐标.遍历完整幅图像后,即可得到每个像素点的最大深度差相邻点的像素坐标.3.2计算小平面的最佳观测方向及观测中心点得到最大深度差相邻点的像素坐标后,还需要获取深度图像中每个像素点的三维坐标.对于已获取的单幅深度图像,可以利用拍摄该幅深度图像时摄像机的内外参数信息,依据投影变换原理,对该幅深度图像进行反投影变换,从而重建出深度图像中每个像素点在世界坐标系中的三维坐标.得到三维坐标信息之后,即可利用深度图像中的遮挡边界点及其对应的最大深度差相邻点的三维坐标以及摄像机的当前观测方位计算遮挡区域外接表面上各小平面对应的最佳观测方向及观测中心点.设摄像机当前的观测方向为犞camera,在当前观测方位下,任取一个遮挡边界点A,坐标为(xA,yA,zA),其对应的最大深度差相邻点F的坐标为(xF,yF,zF),记由点A和点F确定的遮挡线段为lAF,由lAF表示的小平面为PatchAF,根据2.2节的描述,小平面PatchAF的最佳观测方向犞pbv应垂直于lAF且指向其观测中心点P,P应为lAF的中点,具体计算方法如下.(1)计算最佳观测中心点P.设其坐标为(xP,yP,zP),计算公式为(xP,yP,zP)=(2)计算最佳观测方向犞pbv.由于犞pbv垂直于代表PatchAF的遮挡线段lAF,因此可首先求得PatchAF上的两个方向向量,然后通过计算所得向量的叉积得到犞pbv.目前PatchAF上可利用的方向向量仅有犞AF(点A和点F确定的向量),PatchAF上另一个方向向量犞x可通过计算犞camera与犞AF的叉积得到.在此基础上,即可利用犞x与犞AF进一步求得犞pbv.分析发现,摄像机与遮挡区域空间位置关系有两种情形,各情形对应的犞pbv求解方法有所不同.其中,情形1为摄像机主光轴穿过遮挡区域,与遮挡区域相交;情形2为摄像机主光轴未穿过遮挡区域,与遮挡区域不相交.为了区别这两种情形,图5(a)和图5(b)分别给出了PatchAF的最佳观测方向及观测中心点的示意图.图5不同情形下小平面最佳观测方向和观测中心点示意由图5(a)分析可知,当摄像机主光轴与遮挡区域相交时,犞AF和犞x的叉积犞temp垂直于线段lAF且指向遮挡区域,故将其直接作为PatchAF的最佳观测方向犞pbv.而由图5(b)分析可知,当摄像机主光轴与遮挡区域不相交时,由于三角形ABC的遮挡,摄像机在观测方位犞temp下将无法观测到遮挡区域,此时,合理的犞pbv应该为-犞temp.综合考虑上述两种情形,犞pbv的确定方法如下.首先,计算犞x和犞temp,并将犞temp作为临时观测方向.犞x和犞temp的计算公式分别为和其次,将犞temp单位化,得到其对应的单位向量vtemp,将式(5)中计算出的观测中心点P作为vtemp的终点,计算vtemp的起点Q的坐标(xQ,yQ,zQ).此处使用vtemp而不直接使用犞temp来确定Q点的坐标是为了保证后续对Q点进行投影变换时,其所对应的投影点位于深度图像的平面内.再次,利用已得到的摄像机内外参数,对Q点Page6进行投影变换,可以获得Q点在深度图像平面内的投影点Qproject.图6(a)和图6(b)分别给出了图5(a)和图5(b)所示两种情形下Qproject相对于遮挡边界点A及其最大深度差相邻点F的投影点Aproject和Fproject的位置关系.其中,图6(a)所示为摄像机主光轴与遮挡区域相交的情形,而图6(b)所示为摄像机主光轴与遮挡区域不相交的情形.图6不同情形下Q点在深度图像平面的投影点位置示意记Aproject和Qproject所形成的向量与Aproject和Fproject所形成的向量的夹角为θ.由图6(a)分析可知,当摄像机主光轴与遮挡区域相交时,θ角小于90°,而由图6(b)分析可知,当摄像机主光轴与遮挡区域不相交时,θ角大于90°.因此,可以根据θ角的大小来确定犞pbv的方向.记Aproject和Qproject形成的向量为犞A则θ角的计算公式为最后,根据计算出的θ角的值确定出小平面PatchAF的最佳观测方向犞pbv,方法为3.3确定下一最佳观测方位3.3.1遮挡区域外接表面最佳小平面集合的确定计算出遮挡区域外接表面中各小平面的最佳观图7摄像机观测遮挡区域外接表面时的可视空间及小平面最佳观测方向投影示意测方向及观测中心点后,下一步工作是利用这些信息确定出一个最佳小平面集合,该小平面集合所对应的观测方位即为所求的下一最佳观测方位.依据最佳小平面集合的定义(详见2.3节),记rt为当前观测方位下整个遮挡区域外接表面,{P}t为划分rt所得全部小平面组成的集合,{Φ}t为{P}t的所有子集组成的集合,最佳小平面集合为{P}nbv,由于{P}nbv∈{Φ}t且{Φ}t为有限集,因此可通过遍历{Φ}t确定出最佳小平面集合.事实上,我们并不需要对整个{Φ}t进行处理,而只需要关注其中一部分有效的小平面集合,其定义如下:记任意下一观测方位为xnv,摄像机在xnv下所观测到的遮挡区域外接表面为rnv,则划分rnv所得小平面集合称为有效的小平面集合.虽然通过仅遍历全部有效的小平面集合可缩小查找范围,从而减少了一部分计算量,但若是在三维空间中确定最佳小平面集合还需要对大量三维信息进行处理,计算过程仍比较复杂,故在此基础上,本文提出一种基于投影降维思想的搜索策略来确定最佳小平面集合,具体描述如下.首先将{P}t中各小平面的最佳观测方向投影到一个指定坐标系的xoy平面,要求该指定坐标系的z轴正方向与摄像机当前的观测方向相同.这种投影方式具有两个优点:(1)可以使得所有投影向量不重叠,也就是说,每个小平面的最佳观测方向与其在该平面内的投影向量是一一对应的;(2)记{P}valid为任一有效的小平面集合,{P}valid中各小平面最佳观测方向在xoy平面的投影向量组成集合{V}pro,则{V}pro中任意两个投影向量的夹角应小于等于一个固定角度γ,称{V}pro为一个有效的投影向量集合.如图7所示,当摄像机在某个下一观测方位对遮挡区域外接表面进行观测时,可将其可视空间(视野)视为投影平面内的一个梯形区域,若该梯形区域两个腰的夹角为β,则γ应为π-β.一般情况下,β取为摄像机的水平视场角.Page7基于这种投影方式可得全部投影向量的分布情况如图8(a)所示,其中的梯形框区域为摄像机观测遮挡区域外接表面时可视空间对应的投影区域.若将所有投影向量的起点都移动到指定坐标系xoy平面的原点(如图8(b)所示),记各投影向量与x轴正方向的夹角为α,α∈[0°,360°),任取∈[0°,360°),则夹角α的值在[,+γ]范围(如图8(b)所示扇形区域)内的所有投影向量所组成的集合即为一个有效的投影向量集合.因此,每给定一个角度即可计算出一个有效的投影向量集合,通过该集合图8投影向量的分布情况及遍历示意3.3.2确定最佳小平面集合3.3.2.1计算投影向量及其夹角α为了确定最佳小平面集合,基于投影降维思想,首先将计算出的各小平面的最佳观测方向投影到一个指定坐标系的xoy平面(要求该坐标系的z轴正方向为摄像机当前的观测方向),然后,计算所有小平面各自的最佳观测方向在该坐标系xoy平面内的投影与x轴正方向的夹角α,从而得到投影向量的分布情况.任取一个小平面的最佳观测方向犞pbv,其在指定坐标系xoy平面的投影犞project的位置如图9所示,夹角α为x轴正方向沿箭头所示方向与犞project的夹角,其中α∈0°,[夹角α的具体计算方法如下.首先,确定指定坐标系的x轴、y轴和z轴正方向的单位向量.任取一个遮挡边界点A及其最大深度差相邻点F的三维坐标,二者可以确定一个向量犞AF,记摄像机当前观测方向为犞camera,令犞x=犞camera×犞AF,即可确定一个有效的小平面集合.在此基础上,遍历角度的所有可能取值,每获得一个有效的投影向量集合,计算其对应小平面集合中各小平面面积之和,遍历完成后,面积值最大的小平面集合即为最佳小平面集合.此处需要说明的是,由于本文基于积分思想将遮挡区域外接表面划分为若干足够窄小平面,每个小平面均可用其对应的遮挡线段表示.因此,各小平面的面积值即为其对应遮挡线段的长度值.下面给出最佳小平面集合的具体求解过程.将犞x单位化可得到x轴正方向的单位向量犲x,将犞camera单位化可得到z轴正方向的单位向量犲z,最后,y轴正方向单位向量则为犲y=犲z×犲x.然后,计算犞pbv在指定坐标系xoy平面的投影向量.在世界坐标系下,记犲x,犲y和犲z的坐标分别为(xex标为(xc,yc,zc),则犞pbv在指定坐标系的坐标(xc,yc,zc)的计算公式为,yex记犞pbv在指定坐标系xoy平面的投影向量为犞project,坐标为(xproject,yproject),则最后,计算犞project与x轴正方向的夹角α.其计算公式为烄arccosα=烅360°-arccos烆3.3.2.2计算最佳小平面集合得到所有小平面最佳观测方向投影向量的夹角后,即可计算最佳小平面集合.令∈[0°,360°),记i为的任一取值,固定角度γ,夹角α在[i,i+γ]范围内的投影向量组成的集合为{V}pro,{V}pro对应Page8的小平面集合为{P}valid,代表{P}valid中各小平面的遮挡线段组成的集合为{L}i区域外接表面面积Si之和)为其中,area(li)为集合L{}i中第i条遮挡线段li所代表的小平面的面积,其值为li的长度值.在此基础上,记最佳小平面集合{P}nbv对应的遮挡区域外接表面面积为Smax,固定迭代步长为step,其Smax计算公式为Smax=maximize求得Smax后,记录下Smax对应的i值,记为begin,令end=begin+γ,则对应夹角α在[begin,end]范围内的投影向量对应的小平面组成的集合即为最佳小平面集合.3.3.3确定下一最佳观测方位确定出最佳小平面集合后,即可在此基础上进一步计算出下一最佳观测方位.记下一最佳观测方位犞nbv及观测中心点Pview的坐标分别为(xnbv,ynbv,znbv)和(xview,yview,zview),摄像机当前的观测方向犞camera的坐标为(xc,yc,zc),求得的最佳小平面集合为{P}nbv,其对应遮挡区域外表面面积为Smax.为了兼顾遮挡现象不显著或不存在遮挡现象的情况(即Smax比较小的情况),我们设定了一个遮挡区域外接表面面积阈值Sthres(可根据具体应用的实际情况进行调整),根据Smax与Sthres的大小关系,分两种情况进行讨论.(1)当0Smax<Sthres时,即当前观测方位下遮挡现象不显著或不存在遮挡现象时,我们认为在当前观测方位下的场景已经得到了充分的观测,如果将当前观测方位获取到的场景表面视为视觉目标的正面,要想尽可能多地获取场景的未知信息,显然需要从视觉目标的背面进行进一步观测,即将当前观测方向的反方向作为下一最佳观测方向.同时,为了尽可能多地观测到视觉目标的背面,将当前观测方位下视觉目标的中心点作为观测点,从而确定出该情况下的下一最佳观测方位.记摄像机在当前观测方位下获得的视觉目标点总数为Nmodel,观测到的任意视觉目标点Mi的坐标为(xMi的计算公式为Pview的计算公式为(xview,yview,zview)=(2)当SmaxSthres时,即当前观测方位下遮挡现象较显著时,基于求得的最佳小平面集合确定最佳观测方向.记{P}nbv中任意小平面的最佳观测方向犞i和观测中心点Pi的坐标分别为(xi,yi,zi)和(xPi则犞nbv的计算公式为,yPi(xnbv,ynbv,znbv)=∑ωixi,∑ωiyi,∑ωizPview的计算公式为(xview,yview,zview)=∑ωixPi式(17)和(18)中,ωi为犞i、Pi对应的权值,记犞i对应的遮挡线段为li,则ωi的计算公式为最后,根据计算出的下一最佳观测方向和观测中心点计算摄像机的观测位置Pcamera.图10给出了下一最佳观测方向和观测中心点与摄像机观测位置之间的关系.记Pcamera的坐标为(xPcamera机相对于观测中心点的观测距离为dcamera.设由点Pcamera和点Pview确定的向量为犞nbv,坐标为(xview-,yview-yPcameraxPcamera犞nbv=dcamera,犞nbv是犞nbv的平行向量,且方向相同,记犞nbv的坐标为(xnbv,ynbv,znbv),由平行向量的性质可得(xnbv,ynbv,znbv)==则Pcamera的计算公式为(xPcamera(xview,yview,zview)-至此,已确定出下一最佳观测方位狓nbv=(犞nbv,Pcamera).Page93.4下一最佳观测方位确定算法算法1.下一最佳观测方位确定算法.输入:深度图像、遮挡边界和摄像机内外参数输出:下一最佳观测方向和摄像机位置的三维坐标1./提取最大深度差相邻点/For深度图像中每个像素点EndFor2.计算深度图像中每个像素点的三维坐标并记录三3.根据式(5)~(9)计算各小平面的最佳观测方向及4.根据式(10)~(12)计算各小平面最佳观测方向的投5./确定最佳小平面集合/For每个角度值i,0°i<360°,i+1=i+stepEndFor6./确定下一最佳观测方位/IfSmax小于面积阈值SthresElseIfSmax大于或等于面积阈值SthresEndIf依据式(20)、(21)计算摄像机的位置.7.输出计算出的下一最佳观测方向和摄像机位置的4实验及分析4.1实验环境为了验证本文所提方法的效果,分别进行了仿真实验和真实实验,实验硬件环境为CPUPentium(R)Dual-Core2.93GHz、内存2.0GB.确定下一最佳观测方位的程序采用C++编程实现.在仿真实验阶段,我们用http://range.informatik.uni-stuttgart.de/htdocs/html上StuttgartRangeImageDatabase中提供的三维实物模型进行了实验.实验过程中,通过OpenGL模拟摄像机观测三维实物模型并获取其深度图像,设置投影矩阵的参数为(60,1,200,600),视窗大小设定为400×400.在真实实验阶段,我们应用Kinect作为深度图像获取设备,选取了现实生活中若干实物作为视觉目标进行了实验,深度图像的分辨率为640×480.4.2实验结果及分析4.2.1所提方法的实验结果及分析我们应用所提方法对不同的场景进行了实验.仿真实验过程中设定摄像机相对于观测中心点的观测距离为250mm,固定角度γ为120°(摄像机的水平视场角为60°),的遍历步长为1°,面积阈值为10mm2,计算遮挡边界的方法采用文献[16]中所提的遮挡检测方法.真实实验过程中设定摄像机相对于观测中心点的观测距离为1200mm,固定角度γ为123°(Kinect的水平视场角为57°),其余设置与仿真实验一致.图11给出了部分实验结果,从上到下9种不同复杂程度的视觉目标名称分别为Bunny、Duck、Mole、Rocker、Dragon、Banana、Printer、Kettle和Panda.其中,前6个为仿真实验对应的视觉目标,后3个为真实实验对应的视觉目标.图11所示第1列为视觉目标名称,第2列为摄像机在当前观测方位下拍摄到的视觉目标的深度图像,第3列为视觉目标深度图像中的遮挡边界点及其最大深度差相邻点,第4列为计算出的各小平面的最佳观测方向(数量多且长度均等的向量)及最终的下一最佳观测方向(唯一且长度最长的向量),第5列为所求下一最佳观测方位对应的遮挡线段(片状分布的线段)及观测中心点(遮挡线段上成带状分布的点),第6列为摄像机移动到下一最佳观测方位时获取到的深度图像.由图11可以看出,对于当前观测方位下存在遮挡区域且遮挡区域外接表面面积大于给定面积阈值的视觉目标(如Bunny、Duck、Mole、Rocker、Dragon、Printer、Kettle和Panda),所提方法在获得视觉目标深度图像中的遮挡边界点及其最大深度差相邻点的基础上,能够根据上述信息计算出合理的小平面最佳观测方向及观测中心点,并最终确定出下一最佳观测方位,使得在所求观测方位下能够尽可能多地观测到当前观测方位下的遮挡区域.对于当前Page10图11下一最佳观测方位实验结果Page11观测方位下不存在遮挡区域或遮挡区域外接表面面积小于给定面积阈值的视觉目标(如Banana),将当前观测方向的反方向作为下一最佳观测方向,将当前观测方位下视觉目标的中心点作为观测点,从而得到了下一最佳观测方位.分成上述两种情况计算,可以保证观测的充分性,从而为后续的三维重建等领域的实际应用提供高精度的视觉目标点集.同时,由图11还可以看出,无论是仿真实验还是真实实验,所提方法计算出的下一最佳观测方位均与人类的视觉习惯相符,说明了所提方法的可行性和有效性.此外,需指出的是,在图11的真实实验中,由于Kinect获取的深度图像带有噪声,使得视觉目标Printer、Kettle和Panda的深度图像中的部分深度值产生偏差,进而导致深度图像中的各视觉目标检测出的遮挡边界产生偏差,从而在一定程度上会影响到下一最佳观测方位确定的结果.但对本文方法而言,遮挡检测过程为预处理过程,遮挡检测结果只是本文方法的输入数据.所以,只要在图像采集及遮挡检测过程中对噪声加以有效处理,便可进一步改善本文方法在噪声干扰下的效果.考虑到目前不存在NBV方面的标准对照图(GroundTruth),因此很难通过与标准结果比较的方式来评价方法的优劣.但为了进一步评估所提方法的合理性,我们对上述视觉目标对应的实验结果进行了量化分析,分析结果如表1所示.其中,Ncv为当前观测方位下获取到的视觉目标表面点的三维坐标集合Setcv中元素的个数,Nnbv为下一最佳观测方位下获取到的视觉目标表面点的三维坐标集合Setnbv中元素的个数,Noverlap为Setcv∩Setnbv中元素的个数,即为上述两个集合中重合点的个数,Nnew=Nnbv-Noverlap,即所求下一最佳观测方位下新增点的个数,Roverlap为重合率,计算公式为Noverlap/Nnbv,Rnew为新增率,计算公式为(Nnbv-Noverlap)/Nnbv,即1-Roverlap.评估所求下一最佳观测方位效果时,首先关注的是新增点数Nnew,其次才关注新增率Rnew.视觉目标名称NcvNnbvNoverlapNnewRoverlap/%Rnew/%Bunny13813234852229212569.4990.51Duck205941881245931421924.4275.58Mole144321226813961087211.3888.62Rocker37289639360Dragon473711666405112613.4796.53Banana799610733Printer124603413358502828317.1382.87Kettle12014176858154Panda由表1可以看出,在下一最佳观测方位下,获取到的场景点具有较多的新增点数和较高的新增率,说明在所求观测方位下,摄像机的确能够最大量地观测到当前观测方位下观测不到的区域.对于当前观测方位下存在遮挡区域且遮挡区域外接表面面积大于给定面积阈值的视觉目标(如Bunny、Duck、Mole、Rocker、Dragon、Printer、Kettle和Panda),其对应的重合率略高,也就是说,在确定出的下一最佳观测方位下观测这些视觉目标时,获取到的视觉目标点中包含了少部分已经观测过的点.这是由于当前观测方位下的遮挡区域与非遮挡区域相接,因此,在下一最佳观测方位下获取到的视觉目标点集中会包含一部分已经观测过的视觉目标点.同时,由于每个场景在当前观测方位下所对应的遮挡区域的面积和形状存在差异,因此导致每个场景对应的重合率也会有所不同.其中,Kettle的重合率相对较高(即新增率相对较低),其主要是由于Kettle发生遮挡的区域在壶柄部位,遮挡区域较小.同时,Kettle对应的下一最佳观测方位相对于当前的观测方位的变化也较小(与人类观测壶柄处遮挡的行为相符),从而导致摄像机在下一最佳观测方位观测到的新增视觉目标表面点相对较少.对于当前观测方位下不存在遮挡区域或遮挡区域外接表面面积小于给定面积阈值的视觉目标(如Banana),由于直接将当前观测方向的反方向作为下一最佳观测方向,即从视觉目标的背面进行观测,故其对应的新增点数较多,新增率较高,重合率较低.此外,表2中给出了在我们的实验环境下所提方法针对不同视觉目标确定下一最佳观测方位的时间消耗.每个视觉目标对应的时间消耗为10次实验结果的平均值.由表2可以算出,所提方法的平均时间消耗为21.57ms,其中,仿真实验的平均时间消耗为21.31ms,真实实验的平均时间消耗为22.08ms.表2本文方法确定下一最佳观测方位的时间消耗视觉目标名称BunnyRockerDragonBananaPrinterPanda4.2.2与已有方法的实验比较及分析为了更好地评估本文所提方法的效果,我们将Page12其与基于深度图像、对设备无依赖性且考虑了遮挡信息的文献[8,10]中的方法进行了实验比较.其中,各方法在相同的观测方位下计算下一最佳观测方位.图12给出了不同方法在所求下一最佳观测方位下获得的视觉目标深度图像.其中,第1行为当前观测方位下视觉目标的深度图像,第2行为文献[8]方法计算出的下一最佳观测方位下视觉目标的深度图12不同方法在所求下一最佳观测方位下获得的视觉目标深度图像视觉目标名称表3不同方法的下一最佳观测方位实验结果量化评估文献[10]方法NnbvNoverlapNnewRoverlap/%Rnew/%Bunny188391188380.01Duck2158025215550.12Mole176120176120Rocker4523045230Dragon80171280050.15Banana827311081631.33100.0043831157322626.4073.6098.6783686475189377.3822.6210733根据2.1节的描述可知,对于当前观测方位下的视觉目标,其表面可分为两部分:可见表面和未知表面.其中,未知表面又包括背面和被遮挡表面.而视觉目标遮挡区域内的未知表面则包括一部分背面和被遮挡表面.同时,由方法原理可知,文献[8]中方法计算出的下一最佳观测方位主要观测当前观测方位下视觉目标遮挡区域外的背面,文献[10]中方法计算出的下一最佳观测方位主要观测当前观测方位下信息增益较大点的相邻未知表面.而本文方法则按遮挡现象的显著性分为两种情况计算,两种情况下计算出的下一最佳观测方位分别主要观测遮挡区域内的未知表面和视觉目标的背面.在此基础上,结合图12和表3分析可知,与文献[8]方法相比,对于图像,第3行为文献[10]方法计算出的下一最佳观测方位下视觉目标的深度图像,第4行为本文方法计算出的下一最佳观测方位下视觉目标的深度图像.同时,表3给出了不同方法在所求下一最佳观测方位下对应的视觉目标表面点个数Nnbv、重合点个数Noverlap、新增点个数Nnew、重合率Roverlap和新增率Rnew.视觉目标Duck和Mole而言,由于其遮挡区域内的未知表面较小,遮挡区域外的背面较大,故本文方法的新增点数相对较少,新增率相对较低;对于视觉目标Bunny、Rocker和Dragon而言,由于其遮挡区域内的未知表面较大,遮挡区域外的背面较小,故本文方法的新增点数明显较多(尽管新增率略低);对于视觉目标Banana而言,由于其在当前观测方位下不存在遮挡区域,因此本文方法计算出的下一最佳观测方位主要观测视觉目标的背面,故本文方法的新增点数和新增率与文献[8]中方法相当且略好.文献[10]方法通过相关信息增益的计算来综合考虑背面和被遮挡表面,根据已观测点中信息增益较大点及其法向量计算下一最佳观测方位,将计算出的最佳Page13观测这些已观测点中信息增益较大点的观测方位作为下一最佳观测方位.结合图12和表3可以看出,对于视觉目标Duck、Mole、Banana而言,由于其表面平滑或无明显遮挡,致使计算出的下一最佳观测方位与当前观测方位相差相对较小,所以其新增点数相对较少,新增率相对较低;对于视觉目标Bunny、Rocker和Dragon而言,由于其表面复杂或有明显遮挡,致使计算出的下一最佳观测方位与当前观测方位相差相对较大,所以其新增点数相对较多,新增率相表4不同方法确定下一最佳观测方位的时间消耗时间消耗/ms方法名称文献[8]文献[10]本文通过表4给出的不同方法的时间消耗信息可以看出,文献[8,10]和本文方法的平均时间消耗分别为19632.98ms(约19.63s)、13594.42ms(约13.59s)和21.31ms.与文献[8]和文献[10]中所提方法相比,本文所提方法具有较好的实时性.需说明的是,实验中,在利用本文所提方法确定下一最佳观测方位之前,我们使用了文献[16]中所提的方法来计算深度图像中的遮挡边界,实验中该方法计算遮挡边界的平均时间消耗为193.77ms.因此,实验总的平均时间消耗为215.08ms,其中,计算遮挡边界的时间消耗占总时间消耗的90.09%,而确定下一最佳观测方位的时间消耗仅占9.91%.由此可见,即使将计算遮挡边界的时间消耗也加以考虑,利用所提方法确定下一最佳观测方位时的实时性仍然较好.在实际应用中,也可以通过采用其他的遮挡检测方法来进一步减少总的时间消耗,从而进一步提高具体应用的实时性.5结论本文提出一种利用遮挡信息确定下一最佳观测方位的方法.所提方法的贡献主要体现在3个方面:(1)提出深度图像中最大深度差相邻点的概念.应用遮挡边界点及其最大深度差相邻点信息即可对视觉目标遮挡区域的外接表面进行建模并可将遮挡区域的外接表面划分为若干小平面,进而可计算出各小平面的最佳观测方向及观测中心点,为确定最佳小平面集合及下一最佳观测方位奠定了基础;(2)提出一种遮挡区域外接表面最佳小平面集合的对较高.与本文方法相比,由于文献[10]方法注重对视觉目标信息增益较大点的相邻未知表面的观测,而本文方法注重对视觉目标遮挡部分的观测,根据实验结果来看,在新增点以及新增率上,本文方法都比较好.综合来看,本文方法与已有方法侧重不同,对于存在显著遮挡现象的视觉目标,本文方法适用性较好.此外,我们也将本文方法与文献[8,10]中的方法进行了实时性方面的对照比较,各方法确定下一最佳观测方位所需要的时间信息如表4所示.19549.334056.2721.46确定方法.该方法基于各小平面的最佳观测方向,结合积分原理,采用投影降维思想,将三维空间内的问题转化到二维平面内进行求解,计算出最佳小平面集合.该集合中的小平面组合在一起即为摄像机在下一最佳观测方位所能观测到的遮挡区域外接表面;(3)提出一种下一最佳观测方位确定算法.该算法基于计算出的最佳小平面集合,通过综合考虑集合中各小平面的影响,以小平面的面积作为其对最终计算结果影响力的衡量标准,对集合中各小平面的最佳观测方向及观测中心点加权求和求出下一最佳观测方位.与已有方法相比,所提方法的优点是:(1)所需输入数据为深度图像、该图像中的遮挡边界以及获取该幅深度图像时摄像机的内外参数,无需预先获取视觉目标的先验知识;(2)基于分治思想,依据深度图像中的遮挡边界点及其最大深度差相邻点的信息确定下一最佳观测方位,对视觉目标表面形状无依赖关系,适用于具有不同型面的视觉目标;(3)以遮挡区域为研究对象,利用遮挡区域外接表面最佳小平面集合实现了对下一最佳观测方位简便、高效地求解,整个过程未对摄像机位置做特殊限制.最后,需指出的是,所提方法在噪声处理和遮挡区域外接表面面积阈值自适应选取方面存在一定的不足,未来我们将重点针对方法的抗噪性和自适应性展开研究.
