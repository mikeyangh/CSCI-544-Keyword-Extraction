Page1P2P文件共享系统中的一种基于商品市场模型的访问控制机制李勇军1),2)代亚非2)1)(西北工业大学计算机学院西安710072)2)(北京大学计算机科学技术系北京100871)摘要随着P2P文件共享系统日益成为流行的文件交换方式,其安全问题势必引起关注,而访问控制是P2P系统安全的关键技术之一.由于P2P系统具有分散性和动态性,传统的访问控制机制不能够直接应用于P2P文件共享系统中.而现有针对P2P文件共享系统的访问控制机制不能很好地解决大量并发文件下载请求或者爆发式的恶意文件下载对节点带来的侵害.针对上述问题,文中提出一种基于商品市场模型的访问控制机制(ACMCM),利用市场调节机制使得文件下载请求均衡地分布在多个文件提供者之间;下载文件的价格随着重复下载次数的增加而呈指数增长,有效遏制了恶意下载行为;通过在并发下载之间合理地分配下载带宽,使得并发文件下载占用的系统时间尽量缩短.ACMCM保留了P2P系统的分散性和动态性.最后给出了ACMCM的分布式协议的主要过程的流程.关键词P2P系统;访问控制;商品市场模型;分布式协议1引言访问控制技术最初是为了管理大型主机系统上的共享数据的访问请求而产生.但随着计算机应用的普及,这一技术在信息系统的各个领域迅速得到广泛的应用,并成为计算机科学的研究热点之一.访问控制的目的是防止非法用户进入系统以及合法用户对系统资源的非法使用,其研究内容主要包括身份识别和用户(访问)授权.由此可见,访问控制技术是保证系统安全的关键技术之一.随着P2P系统应用在Internet上面的流行,其安全问题势必会引起关注并成为研究的热点,其中认证和访问控制是P2P系统安全的两个主要方面.在传统访问控制技术中,CA(CertificateAuthority)认证是解决认证问题比较流行且有效的方法,而P2P系统的分散性决定了不能把CA认证直接应用于P2P系统[1];访问授权是在用户预先已知的情况下进行的,而P2P系统的动态性显然不满足这一条件.可见,传统的访问控制技术很难直接应用到P2P系统中.文献[1]认为在P2P系统中,访问控制与密钥、数字签名、证书、认证等技术的结合是解决系统安全访问控制的有效途径,P2P系统中的访问控制已经不仅仅是对用户身份的认证和权限的限制,而更多的是如何体现交易的公平性,如何制定信誉机制和惩罚机制以及如何提高用户之间交易的可信性和效率等.目前在P2P文件共享系统中,访问控制机制主要根据节点的信誉值和/或节点对系统贡献大小来确定节点的下载请求是否被接受.这样的访问机制具有一定的激励作用,鼓励节点提供可靠服务和提供更多可供下载的文件.然而这些访问控制机制不能抑制恶意节点的爆发式访问或者正常节点的大量并发式访问对文件提供者(FileProvider,下文简称FP)造成的侵害,可能由于这些突发式的大量访问使得受侵害的节点不能够提供正常的下载服务,甚至使得这些节点退出系统.为解决上述问题,本文提出一种基于商品市场模型的访问控制机制(AccessControlMechanismbasedonCommodityMarket,ACMCM).在P2P文件共享系统中引入虚拟商品市场机制,提供文件下载服务的一方被认为是卖方,而下载文件的一方被认为是买方.当买方从卖方那里下载文件时,需要根据文件的虚拟价格向卖方支付相应数量的虚拟货币,文件的价格随着下载请求的数量而波动.用户手中的虚拟货币量决定了该用户可以下载的文件大小和数量,从而达到控制用户下载文件的目的.ACMCM在保留激励作用的基础上,通过市场的调节作用使得文件下载请求均匀地分散在各个FP之间,使得文件下载的负载达到均衡;调整重复下载文件的价格,使得文件价格随着重复下载次数的增加而呈指数增长,以期对恶意下载行为进行抑制;另外,通过在并发下载之间合理地分配下载带宽,使得下载占用的总系统时间尽量缩短.本文第2节介绍相关工作;第3节详细阐述ACMCM,主要包括信任模型、ACMCM采用的价格策略、带宽分配策略以及ACMCM规则等;在第4节中对ACMCM的性能进行分析和讨论;第5节讲述ACMCM的分布式协议,包括关键数据的放置方式和几个关键协议过程的流程;在第6节对全文进行总结.2相关工作目前在P2P领域的研究大多数还是集中在如何提供服务上,而不是对资源的控制上[1].但随着P2P流量在Internet上所占比重逐渐增多,对P2P系统的访问控制引起一些研究者的关注,尤其是P2P文件共享系统中的访问控制.目前已经提出了一些适用于P2P访问控制模型,如移动P2P协作环境下的访问控制[2]、基于PKI的多层访问控制平台[3]等.对P2P系统访问控制的研究主要包括两个方面:(1)peer的选择问题,即如何有效地选择一个peer进行资源共享.这里涉及到peer的身份认证问题,研究较多的是基于可信和信誉的模型(trustandreputationbasedmodels)[1,4].(2)访问控制策略,即如何保证节点之间安全地共享资源,尽量减少响应恶意节点的请求而消耗自身的服务能力.采取的策略主要包括依据节点对系统贡献大小决定节点的访问权限[5]、动态安全组[6]等.信任和信誉问题已成为P2P研究领域的热点问题之一,但因其不是本文的重点问题.限于篇幅,在此不再赘述,建议有兴趣的读者参见文献[7]了解这方面的最新研究进展.文献[4]提出了一个P2P系统的组信任访问控制模型,并用RBAC实现了P2P系统的安全策略.Page3同组中的节点依据可信度判断组中其它节点的行为,解决了节点的选择问题;用RBAC描述组访问的安全策略,解决了P2P系统中的访问控制策略问题.文献[5]为P2P文件共享系统提出了一个可信访问控制机制,该机制包括认证机制、信任与信誉模型、公平参与机制和访问控制机制等.利用节点GUID(GlobalUniqueIDentifier)和公私钥对解决节点认证(选择)问题,根据节点的信誉值以及节点对系统的贡献大小控制访问权限.该访问控制机制具有激励作用,鼓励节点提供更多和更好的文件供其它节点下载.文献[8]采用了类似的访问控制策略,依据节点信誉值和节点贡献大小决定节点的访问权限.文献[9]提出了一种基于动态信任的访问控制机制,包括信任模型和访问控制策略等.通过比较访问请求的主体和客体的信誉值来控制访问请求,该机制未明显区分节点认证(选择)和访问控制策略.用形式化的方法描述了P2P系统的访问控制机制.文献[10]提出了一种信誉系统的框架,行式化地表述了信誉系统,并把信誉系统应用到访问控制中,其控制策略类似其它基于信誉的访问控制策略.总之,基于信誉和信任的访问控制机制的策略主要是根据节点信誉值或节点贡献的比较结果对访问请求进行限制.另外,为了提高访问控制中的认证强度,有些文献引入了门限密码机制(ThresholdCryptogra-phy).文献[11]主要介绍了门限密码在P2P系统和AdHoc网络中的应用,并给出应用实例,包括ThresholdRSA方案、基于ThresholdDSA的访问控制、基于ThresholdSchnorr的访问控制、基于ThresholdBLS的访问控制等方法.为增强P2P系统访问控制中的认证强度提供了新的解决思路,但在实际P2P系统中是否需要采用如此复杂的密码机制进行节点认证(选择),由系统需要的安全等级确定.3基于商品市场模型的访问控制机制ACMCM包括3个方面的问题:(1)选择(认证)节点.为了保障P2P文件共享系统的安全和良性运行,根据节点的信誉值对下载双方的身份进行相互认证;(2)文件下载的控制策略.根据下载请求的数量动态调整下载文件的价格,使得下载请求均衡地分布在多个FP之间,利用虚拟市场机制控制文件下载行为;(3)带宽分配策略.在并发下载之间合理分配带宽,使得下载占用的系统时间最少.ACMCM机制假设网络中用户节点大部分是理性的,即当用户有多种选择下载源时,选择性价比较好的下载源.3.1信任模型信任机制是P2P研究领域的热点之一.根据节点的历史交易记录确定其可信度,为其它节点选择交易对象提供参考.另外,在实际P2P系统中,根据可信度提供差分服务,依此激励节点提供可靠交易或者服务.本文不专注于信任机制的研究,而是采用文献[11]的EigenTrust信任模型计算节点的全局信任度.在EigenTrust信任模型中,节点的全局信任度(1)直接信任度.如果两个节点,不妨假设为a和b,其中b为FP,a为文件下载者(FileRequestor,下文简称FR).当a从b完成一次下载任务以后,根据文件质量和下载速度等,a对b给出一个评价,满意或者不满意.经过多次下载以后,就可以得到a对b的多次评价结果,满意次数记为m,而不满意的次数记为n.则a对b的直接信任度为计算方式如下:(2)全局信任度.计算全局信任度时,采用其它节点推荐的方式,推荐信任度为节点之间的直接信任度.EigenTrust信任模型认为那些在提供下载文件时具有高可信度的节点,在推荐其它节点的直接信任度时也具有高可信度.为了避免恶意节点推荐的信任度对全局信任度产生较大的影响,首先对直接信任度做归一化处理:节点a对b的全局信任度依据式(3)就可以计算得出.为了简化计算,可以限定迭代次数.详细计算过程可以参见文献[11].节点间的信任度是为文件下载双方在相互选择时提供参考依据.在ACMCM中,信任度的计算并不局限于EigenTrust信任模型,其它任何可以有效地计算节点间信任度的模型都可以应用于ACMCM.3.2价格策略在P2P文件共享系统中,下载一个文件所需支付的虚拟货币与诸多因素有关,很难用一个准确的Page4数学模型进行描述.但是针对不同的应用背景,可以建立一种相对有效的价格模型.基于微观经济学的一般均衡理论,本节提出一种能够反映供需关系的文件下载的价格策略.一般均衡理论从微观经济主体的行为角度出发,考察每一种产品的供需达到均衡状态时所需的条件、相应的均衡价格和均衡数量.FR如果想从FP那里成功地下载一个文件时,需要两个方面的资源:下载的文件以及与FP之间的连接.本文价格策略认为这两类资源都是付费资源,且针对这两类资源分别进行定价.因此FR支付给FP的虚拟货币量是文件价格与连接价格之和.3.2.1文件定价策略在文件共享系统中文件是可复制的,被请求文件的数量不会因为下载次数的增加而出现供不应求,也就是不存在供求平衡问题,因此本价格策略认为文件本身的价格不受下载请求数量的影响,仅与文件大小有关系.假设文件i大小为si,其价格用pf表示,文件的价格定义为文件大小的函数.文件定价是系统统一定价,即同一个文件在系统中的不同节点上的文件价格是一样的.此策略可以防止理性用户(free-rider)私自抬高文件定价,达到不共享资源的目的.3.2.2连接定价策略在P2P文件共享系统中,用户一般都会限制自身的最大连接数.当外部请求过多时,就会出现连接数量供不应求,使得连接成为稀缺资源.这时通过提升连接的价格,可以使得一部分连接请求转向其它节点,从而降低该节点的连接请求数量.反之,当连接数量供大于求时,节点可以通过降低连接的价格吸引较多的连接请求.上述过程经过多次反复,最终可以达到一种均衡状态,使得各个节点上的连接请求数量趋于稳定.为此,可以利用迭代公式pl=pl+δ(D-S)计算连接的均衡价格[12],其中pl是连接的价格,δ是调价速率,D是请求连接的数量,S是节点提供的最大连接数量.当连接的请求数量(D)大于节点最大限制数量(S)时,即D-S>0,此时供不应求时,连接的价格就会上升;反之,当D-S<0,也就是说供大于求,连接的价格就会下降.并且价格升降数量与|D-S|成正比.当提供的连接数量与请求的连接数量相当时,即|D-S|<ε时,价格调整过程终止.上述调价过程在微观经济学中被称为Tatonnement过程,文献[13]证明了Tatonnement过程收敛于均衡价格,并且收敛过程很快.然而正如文献[14]所述,在实际系统中Taton-nement过程的前提条件,|D-S|<ε,不一定总能达到.如在P2P文件共享系统中可能存在下列情况使得Tatonnement过程不能收敛:(1)大规模FR的并发请求,使得FP的连接数量不能满足FR的连接需求,即DS.(2)恶意节点的大量虚假请求,使得DS.(3)某个节点收到的文件下载请求过少,可能是由该节点上的文件不流行或者该节点的信誉过低造成的,使得DS.为了规避上述问题,在调整节点的连接价格时摒弃了Tatonnement过程的收敛条件,取而代之的是(1)相邻两次调价过程产生的供需差异变化小于某个阈值.假设第i次调价过程后供需数量分别为Si和Di,Δdi=|Di-Si|;第(i+1)次调价后的供需数量分别为Si+1和Di+1,Δdi+1=|Di+1-Si+1|.当|Δdi+1-Δdi|<ε满足时,我们认为调价过程达到了平衡状态.或者(2)限制调价过程的迭代次数,也就是说设定一个迭代次数上限,当调价迭代次数超过该阈值时,调价过程无条件结束.此时认为经过多次调价后,节点的供需差异始终不能够收敛.该调价结束条件主要考虑了调价过程的效率问题,调价过程不应影响存取控制的实效性.连接调价过程如算法1所示.算法1.连接的定价算法.Initializinginitialpricepl,adjustmentratioδ,terminalparameterε,iterationthresholdkthreshold,Δd=0,itera-tionroundsk=0;Δd=D-S;while|Δd-Δd|<εandk<kthresholddopl=pl+δ·Δd;endwhileannouncingthepricepl,collectingthefiledownloadrequirementandcomputingD;if|Δd||Δd|thenelseendifendwhilePage5算法1是针对一个时段内下载请求的调价过程,在该时段内FP接收FR的下载请求消息,时段结束后进入上述调价过程,该时段被称为调价周期.为了使得用户的利益最大化,调价周期的大小应该根据Δd的变化进行适当的调整,如果调价周期之间的Δd变化较大,应该缩短调价周期;反之增加调价周期.在调价过程结束以后,如果文件下载请求数量(D)小于或者等于连接数量(S),即DS,接受所有下载请求;而如果D>S,采用Greedy策略接受下载请求.假设D个下载请求为{r1,r2,…,rD},对应的请求文件大小为{s1,s2,…,sD},FR的信誉值分别为{t1,t2,…,tD}.按照式子(5)的数值对D个下载请求按降序方式进行排序,接受前S个下载请求.这样可以使得FP在提供相同文件大小时,获得较大的收益.3.2.3下载定价策略文件的下载基本价格p由两部分组成:连接价格pl和文件价格pf,即p=pf+pl.这样的定价策略在面对正常的文件下载请求时,可以使得下载请求在各个FP之间趋于均衡.然而当某个FP面临多次恶意下载同一个文件的请求时,该价格策略显得有些不足.因为这些下载请求就是发向特定FP的,不会因为连接的调价策略,而转向其它FP.另外多次下载同一个文件也造成系统资源的浪费.为了遏制这种现象的发生,合理有效地利用系统资源,在制定下载定价策略时,不鼓励FR重复从FP那里下载同一个文件.另外,考虑到一个正常的FR在一个时间段内多次下载同一个文件的概率会随着已经重复下载次数的增加而急剧减小,因为每次下载都会付出代价且浪费自身的资源.而如果真正发生了这种多次重复下载的现象,我们认为这是滥用系统资源的行为,需要对此做出惩罚.为此,制定了下面的下载定价策略:一次文件下载的价格由三方面的因素决定,分别是连接价格、文件价格以及从同一个FP那里重复下载同一个文件的次数.其中连接价格与文件价格组成了下载的基本价格,而重复下载次数是对滥用资源行为的惩罚依据.式(6)给出了下载价格与三者之间的关系.其中a是抑制重复下载次数的因子,取值越大抑制效果越明显,即同样虚拟货币量的情况下,a取值越大,FR可重复下载的次数越少.m是下载的次数.从式(6)中不难看出,第一次下载文件(m=1)需要的价格就是下载的基本价格;随着重复下载次数的增加,下载价格呈指数增加.这样的下载策略可以有效地抑制重复下载行为的发生,具体分析见4.1节.在下载过程中,假设FR欲中断本次下载,可FR已经占用了FP的连接,那么FR需要支付给FP相应的连接价格pl;另外FR如果已经从FP下载部分文件内容,FR也需要按照文件定价策略支付给FP相应的虚拟货币.FR可能因为中断下载行为而得到FP的负面评价,进而会影响到FR的信誉.因此FR在下载过程中,如果发现有更低定价的下载资源时,是否中断此次下载而转向其它FP时需要考虑:(1)其它FP那里是否还有剩余连接,否则转移过去可能会得不到连接;(2)本次下载的剩余内容需要支付的费用是否比其它FP公布的下载定价高,如果高才有转移的必要.此策略是权衡FR和FP利益的结果,一方面保证FP因提供资源而得到利益;另一方面也可以防止FR因不适当选择而支付更多的虚拟货币.3.3带宽分配策略本文认为如何从下载等待队列中选择下载请求进入下载过程是P2P文件共享系统需要解决的问题.带宽分配策略的目的不是指导FP如何去选择下载请求,而是在下载确定以后,如何在这些并发的下载之间分配带宽使得这些下载过程所需时间最短.下载时间越短,FP就有更多机会为其它下载服务,从而积聚更多的虚拟货币.从系统调度的角度来看,完成这些并发下载过程所占用的系统时间是完成每个下载过程所占用的系统时间之和.因此带宽分配策略的目标可视为:使得完成每个下载过程所需系统时间之和最短.假设FP的最大连接数为S,可提供的下载带宽为B.在t时刻共有N(NS)个文件请求连接ci(i=1,2,…,N)从FP这里下载文件.其中下载连接ci对应的下载文件大小为si,FR端的最大带宽限制为b0i,FP分配给连接ci的下载带宽为bi.FP需要解决的问题可转化为如下优化问题的求解:Page6很容易证明函数f(bi)=si/bi在bi∈[0,B]满足凹性和单调性,因此式(7)存在均衡解使得分配方案最为合理.参照文献[15]中非线性规划的求解方法,首先假设条件bib0i对N个连接都成立.式(7)对应的非线性规划问题可以转化为如下非线性规划问题:利用拉格朗日方法对式(8)进行求解可以得到根据求解的结果验证假设条件bib0i是否满足,如果满足则式(9)为最优解;否则,假设k条连接的对应条件不满足,即分配带宽大于FR的最大带宽限制,采用启发式方法解决这个问题,为这k条连接分配的带宽为其可接收带宽的最大限制,即b0i,然后对剩余带宽在其余(N-k)条连接之间进行分配.为了表达方便,把这k条连接的对应下标组成的集合记为K,其余连接对应下标组成集合记为L.对剩余带宽分配策略转化为下面的非线性规划的求解:重复上述求解过程直到所有约束条件都满足.为避免频繁触发上述的带宽调整策略,可设置一个定时器,由定时器触发带宽调整策略,定时器时长t可以根据所有被下载文件的总大小和FP的带宽进行估算或由用户设定;另外当连接变化比例超过阈值ε时,也可触发带宽调整策略.t和ε取值越小调整次数越频繁,带宽越能得到合理的利用,FR的用户体验也会频繁变化.3.4访问控制机制P2P文件共享系统中的访问控制机制主要描述节点在满足什么条件的情况下,其文件下载请求会被接受.本小节主要用形式化的方法描述ACMCM利用节点之间的信任度以及3.3节的价格策略控制文件下载的机制.先定义ACMCM中用到的一些概念.定义1.实体(Entity)是指P2P文件共享系统中的节点(peer),包括FP和FR.用E表示实体集合.定义2.对象(Object)特指P2P文件共享系统中的文件.用O表示对象集合.定义3.操作(OPeration)是指实体在P2P文件共享系统中执行的操作,比如文件下载请求等.用OP表示操作集合.定义4.实体信誉值(EntityRepuation)是指按照EigenTrust信任模型计算出的实体的全局可信度.实体a∈E的信誉值记为ta.定义5.实体信任阈值(EntityTrustThresh-old)是指其它实体欲访问本实体上的对象时必须具有的最小信誉值.实体e∈E的信任阈值记为tte.定义6.实体货币量(EntityMoneyQuantity)是指实体所有拥有的虚拟货币总量.实体e的货币量记为qe.定义7.操作价格(OPerationPrice)是指操作被成功执行需要的虚拟货币数量.操作op∈OP的价格记为pop.定义8.操作许可(OPerationPermission)是指操作被接受还是被拒绝.操作op∈OP的许可记为oppop.如果op被接受,则oppop=1;否则oppop=0.操作许可集合用OPP表示,OPP={0,1}.定义9.一次下载请求可以定义为一个四元组(er,op,es,o),其中er∈E是FR,op是下载请求操作,es∈E是FP,o是被请求的文件.定义10.用R表示下载请求集合;ce表示实体e接受下载请求时FR必须满足的最低条件,C是ce的集合.那么P2P文件共享系统中的访问控制可以定义为如下的映射关系:对于文件下载请求(er,op,es,o),F判断实体er是否满足es的条件ces.如果满足,则oppop=1,操作op被接受;否则oppop=0.在ACMCM中,对于任意的文件下载请求(er,op,es,o),条件ces是指实体es信任阈值ttes和操作op的操作价格pop.其中pop是按照3.3节中的价格策略计算出的下载定价.如果实体er的条件满足ces,则op被es接受,否则被拒绝.ACMCM控制规则如下.规则1(ACMCM访问控制规则).er∈E,es∈E,op∈OP,o∈O,ces=(ttes,pop)∈C,Page7其中逻辑操作结果用1和0表示,1表示真(True),0表示假(False).4分析与讨论本节主要针对ACMCM中的价格策略以及带宽分配策略进行分析与讨论,信任机制部分的分析和讨论可以参见文献[11].4.1评估价格策略价格策略的影响体现在两个方面:(1)连接的定价策略会影响文件下载请求在各个FP之间的分布,避免大量下载请求过于集中在某些FP上;(2)下载的定价策略对重复下载文件的次数有抑制作用.下面对这两方面的影响分别进行分析和讨论.4.1.1连接定价策略对请求数量的影响在总需求和总供给基本持平的情况下,Taton-nement过程收敛于供需均衡状态且收敛速度很快.算法1采用Tatonnement过程的调价方法,因此算法会趋于均衡状态.然而由于存在总的下载请求数量大于总的连接数量的可能性,算法可能不能收敛于供需均衡的状态.另外在存在大量并发下载请求或者恶意请求的情况下,一段时间内的下载请求会不断地产生,可能会造成收敛速度较慢.当一个FP收到的下载请求超过自身的最大连接数时,根据算法1连接的价格就会增加.那些感知到涨价的理性FR,在有其它下载源可供选择的情况下,会把自身的下载请求转向一个连接价格相对较低的FP;反之,FP通过降价可以吸引更多的下载请求,增加自身的收益.在不考虑FP信誉值的情况下,最终的均衡状态应该是各个FP所提供的同一个文件的下载基本定价应该很相近,FP可提供的连接数量与收到的下载请求之间的差异收敛到一个稳态.由此可见FP收到的请求数量受自身提供的连接数量限制,提供的连接数量越多则最终收到的下载请求越多.系统对文件定价采用统一的策略,可以避免一些用户对文件定价过高,导致连接数很少.同时也可以防止某些用户为了不向其它用户共享资源,恶意抬高自身保留文件的定价.统一的文件定价策略可能会导致那些带宽较低的FP接到的连接数量降低,因为低带宽意味着较长的传输时间,FR的用户体验会降低.这促使FR提高自身的服务质量以得到更多的连接请求,获得更多的虚拟货币.4.1.2下载定价策略对重复下载次数的影响从同一个FP那里多次下载同一个文件的行为属于恶意行为,无端地浪费系统资源,在P2P文件共享系统中应该尽量遏制这样的恶意行为.首先我们从恶意行为发起者的角度考虑问题,确定最优的恶意下载策略,即特定时间段内,恶意下载在占用相同系统资源的情况下,如何使得付出的代价最少.而从遏制恶意行为的角度讲,这是最坏的情况,其它任何情况下的遏制效果都要好于此.假设某个FP有n个文件可供下载,其文件价格分别为{pi示时刻t的下载请求的连接价格,且随着时间而变化.文件大小分别为{si|i=1,2,…,n}.文件价格为f=bs槡i,这使得每次下载在单位时间内占用相同pi系统资源的情况下,付出的代价相当.只有当系统中恶意请求远大于节点可提供的连接数时,才有可能对节点的下载服务造成影响.按照连接定价策略,此时的连接定价pl(t)近似一个常数,不会随着时间有较大的变化.假设文件i已经被下载次数记为mi,恶意下载行为持续时间为T.从恶意下载请求发起者的角度考虑,最优的请求策略就是下面优化问题的最优解:令式(12)中的a=b=1,显然函数f(mi)=(s槡i+pl)·e(mi-1)在mi∈[0,x]上具有凹性和单调性,因此上述优化问题存在最优解.按照3.3节所述的拉格朗日求解法,可以得出当每个文件被下载次数相等时,下载策略近似最优的.为了计算方便,假设总的恶意下载请求数量为nm次,也就是每个文件被重复下载m次.按照本文下载定价策略,FR需要支付的虚拟货币量为(∑mk=1∑ni=1如果对恶意下载行为未采取惩罚措施,即每次下载的定价为下载基本定价.每个文件被下载m次时,FR需要支付的虚拟货币量为k=1∑n在两种不同定价策略的情况下,下载者需要的Page8代价比为ρ=∑n图1描述了文件重复下载次数m与ρ的关系,即使在最坏的情况下,随着m的增加,ρ的值急剧增长,也就是说本文提出的下载定价策略对恶意下载请求的抑制效果是很明显的.随着m增加,抑制效果越来越显著,而恶意下载请求总次数nm仅随m线形增长.从上面分析容易得知,抑制效果最好的情况就是所有的恶意请求集中在同一个文件上,该文件越小抑制效果越显著.与最坏情况的差别在于,如果m次恶意请求,在最好情况下的抑制效果为ρ0;而在最坏情况下达到抑制效果ρ0需要容忍的恶意请求次数为nm.4.2评估带宽分配策略假设FP能够提供的最大下载带宽为B.在某一时刻FP共提供了N条连接,每条连接对应一个下载请求,该连接对应的下载带宽为bi,下载文件大小为si.先评估在FR的带宽没有最大限制的情况下,本文提出的带宽分配策略与下面两种分配策略之间在所需下载时间上的差异:(1)在各条连接之间平均分配带宽.(2)按照每条连接的请求文件大小的比例分配带宽.为了清晰区分3种不同带宽分配策略所产生的带宽分配方案,依据本文带宽分配策略为连接ci分配的带宽记为b0i,依据策略(1)分配到的带宽记为b1i,依据策略(2)分配到的带宽记为b2i.如果按照策略(1)进行分配带宽,则每条连接分配到的带宽为b1i=B/N,完成所有下载所需要时间之和为如果按照策略(2)进行分配带宽,则每条连接分配到的带宽为所有下载完成所需要时间之和为T=∑N从式(16)和(18)可以看出,按照策略(1)和(2)分配带宽,其效果是一样的.在评估本文的带宽分配策略时,仅依策略(1)为参考.由本文带宽分配策略所产生的带宽分配方案完成下载任务所需要的时间之和记为T0,T0=∑Ni=1i=1=∑N由策略(1)所产生的分配方案完成下载任务所需要的时间之和记为T1.两种不同分配策略之间的效果差异可以用T0和T1的差异ΔT表示.ΔT=T1-T0=N从式(20)可以得出结论:(1)显然ΔT0,也就是说由本文提出的带宽分配策略所产生的带宽分配方案,完成所有下载所需要的时间之和不比利用其它两种策略所产生的带宽分配方案完成所有下载所需时间之和大.(2)当下载文件的大小相等或者相差不大时,3种带宽分配策略的效果相同或者很接近.(3)当下载的文件大小差异较大时,本文带宽分配策略具有明显优势.在FR存在带宽限制的情况下,ΔT的公式较为复杂.为了直观地表示ΔT的大小,选用Maze日志中的用户下载数据作为实例分别计算T0和T1.以2006年11月12日的日志数据为例,该日志数据中Page9共包含163695条下载信息,从其中选取3组数据,每组数据包含10个下载请求.在选取日志数据时,注意到每组数据中下载文件的平均大小,目的是想验证本文带宽分配策略在下载各种大小文件的情况下均具有优势.在Maze文件共享系统中,用户下载带宽默认为512Kb,最大连接数为10,这样每个FR用于下载的带宽最大为5120Kb.在目前的主流配置中,FR是不存在带宽限制的.在计算过程中,假设部分FR存在带宽受限,即FP分配给FR的带宽超出了FR的最大带宽,且带宽超出比例为10%.用k表示存在带宽限制的FR个数,其中k=0可以更直观地表示式(20)的结果.计算结果如表1所示.表1存在带宽限制的情况下犜0和犜1的计算实例数据集序号T1/s128981.0211148.9911208.6811335.7811541.5629576.784989.435009.145043.215107.233270.77194.77195.24195.94196.97从表1中可以得出:(1)在3组数据上的计算结果都表明T0明显比T1小很多,说明本文的带宽分配策略相比于平均分配带宽或者按比例分配带宽策略具有显著的优势.(2)随着k值的增加,T0逐渐变大,但仍然保持着对T1的显著优势.k的增大意味着,由于FR的限制,更多的带宽得不到合理地配置,使得总下载时间增加.5ACMCM分布式协议ACMCM分布式协议主要解决两方面的问题:(1)数据放置问题.与下载有关的一些关键数据(如节点货币总量、节点信誉值等),如何在P2P网络中进行放置,并且使得其它节点取得这些数据时需要的开销是有限的.显然在利益相关的节点上存放这些数据是不合适的,因为这样会导致欺诈行为发生.(2)ACMCM分布式协议本身.节点之间如何协作完成ACMCM,并保证节点之间的交互是安全的,能够有效抑制恶意行为.5.1关键数据的放置ACMCM的实现是建立在结构化的P2P文件共享系统上的,关键数据的放置需借助分布式Hash表(DHT)机制完成的.在具体实现时,本文引入Terrace构件作为P2P文件共享系统的DHT,Terrace是文献[16]构造的一种基于d-tree结构的DHT构件.通过Terrace,文件共享系统中的每个节点都可以映射到一个逻辑d-tree上的d个节点上,并赋予该节点d个全局唯一的逻辑地址.依据任一逻辑地址,其余节点可以访问该节点.Terrace树的根节点表示系统在树中逻辑地址为(0…d-1)的节点;对于其余任意节点,设其逻辑地址为(A0,A1,…,Ad-1),则其第i个(i∈[0,d-1])子节点的逻辑地址分别为(Aid+0,Aid+1,…,A,Aid+d-1).下面以一个实例简要介绍Terrace树,图2是文献[16]列举的一个基于8-tree的逻辑空间.树中每个节点有8个逻辑地址.除根节点最大扇出为7外,其余节点的最大扇出为8.从根节点起,每一个节点的子节点都是该节点逻辑地址在下一个基数位上的枚举,而节点自身包含当前基数位的所有枚举(根节点例外,它没有第0位子树).通过均匀Hash函数,可以将对象映射到相同的逻辑空间中.Terrace的进一步介绍,建议有兴趣读者参考文献[16].选择Terrace构件放置关键数据的原因在于:(1)Terrace的平均查找长度为O(logN),拓扑维护开销为O(d).(2)Terrace的树型结构具有非对称性,这为针对不同(可信度)特征的节点放置提供了基础.(3)Terrace采用单向Hash函数,节点逻辑地址是节点加入拓扑时随机获取的,这就使得无法根据节点的某个特征预先决定节点的逻辑地址,因此增强了关键数据的放置安全性.(4)Terrace具有较强的容错能力.因为每个节点具有d个逻辑地址,可以为逻辑空间中的每个节点分配d个物理节点,这d个物理节点组成一个Cluster,提高了系统的容错能力.定义11.设h为任意均匀的Hash函数,网络中节点i的逻辑地址在Terrace中的投影称为节点i的档案点Di,即Di=h(IDi),IDi是节点i的全局唯一的逻辑地址.在ACMCM中,对文件下载的控制需要下载双Page10方及其相应档案点协作完成.为了防止节点作弊,节点的关键数据存放在其档案点上.在Terrace中,假设节点i的档案点是节点k,节点i共有N下载连接.每个节点都有各自的公钥ki存储三类数据:节点i相关的数据、下载相关的数据以及计算节点信誉值相关的数据.节点i相关的数据结构如图3所示.图3中,IDi是节点i的逻辑地址;ti是节点i的信誉值;ki拟货币总量;b0i是节点i的最大接收带宽,该值是根据每次下载后的测量结果得到的.下载相关的数据结构如图4所示.图4中,IDn1是下载者的逻辑地址;on1是下载的文件标示;pn1on1是本次下载的价格;mn1on1是该节点已经重复下载过文件on1的次数.计算全局信任值相关的数据结构如图5所示.图5中,IDn1是从节点i下载过文件的节点的逻辑地址;Sn1i是逻辑地址为IDn1的节点下载成功的次数;Fn1i是下载失败的次数.每个节点的私钥存储在自身节点上,还有一些非关键数据也存储在节点自身,比如调价之前的所有下载请求、等待下载的请求、未完成的下载等.5.2分布式协议为保障数据传输的安全,节点之间交换数据时,数据发送方利用自己的私钥对传输数据进行加密,接收方收到密文后利用发送者的公钥进行解密.如节点i向节点k传输数据a时,先用kis对a进行加密形成密文(a)ki节点k收到密文后,向节点i的档案点Di索取i的p,然后对收到的(a)ki公钥ki效地防止数据在交换过程被篡改,同时也可以抑制节点利用冒名和诋毁的手段破坏系统的正常运行.限于篇幅,我们这里仅对ACMCM的分布式协议中的几个关键过程进行阐述.图6描述了文件下载请求的过程,下载请求会根据价格的变化而转向性价较好的FP,图6中涉及到的几个原语及其语义如下:SeekFile(o):从P2P文件共享系统中查找可以提供文件o供下载的FP集合,返回值是一个节点集合Eo.SelectNode(Eo):从节点集合Eo选择一个性价比较好的节点,返回值是一个节点.ReqFile(o,e):向节点e发送下载文件o的请求.RecNewPrice(o,e):从节点e接收下载文件oRecFileReq(o):接收下载文件o的请求.Tatonnement():3.2节所述的价格策略.的新定价.图6基于商品市场模型的文件下载请求过程图7描述了文件下载过程的消息交互过程,交互过程中用到的原语及其语义如下(为描述方便我们把节点k从节点i下载文件o的操作记为四元组〈i,download,k,o〉,在不引起歧义的情况下简记为〈i,k,o〉):PutDownloadInfo(i,k,o,p):节点i把节点k下载文件o的信息写入到档案点Di中,下载的基本价格为p.ReqQ(i,k,o,p):Di就下载〈i,k,o〉向Dk请求本次文件下载需要支付的货币量,大小为p.VerifyReqQ(i,k,o,p):Dk向k确认下载〈i,k,o〉及其价格p.如果k认可该下载,返回值为True,否则为False.Page11效.并为下载〈i,k,o〉支付相应的货币.无效.ReqQOK(i,k,o):Dk向Di证实下载〈i,k,o〉有RejctReqQ(i,k,o):Dk向Di证实下载〈i,k,o〉PutDownloadInfo(i,k,o):Di向节点i证实图7文件下载过程图8描述了文件下载过程被中断以后,重新开始下载的消息交互过程,用到的原语及其语义如下,ReqDownloadCont(i,k,o):节点k向节点i请求继续下载操作〈i,k,o〉.GetDownloadInfo(i,k,o):节点i向自己档案点求证下载〈i,k,o〉是否存在.如果存在返回True;否则返回False.AcceptReq(k,m):通知节点k,其发出的请求RejectReq(k,m):通知节点k,其发出的请求消息m被接收.消息m被拒绝.在下载过程中,如果FR终止下载过程,FP就会根据文件定价计算剩余下载所需支付的虚拟货币数量,并通知其档案点退回相应货币到FR的档案点.该过程相对简单,这里不再赘述.下载〈i,k,o〉完成以后,节点i的档案节点Di会接收到节点k根据下载完成情况的对节点i的评价PutDownloadInfo原语操作成功.DelDownloadInfo(i,k,o):Di向节点i证实AcceptDownloadReq(i,k,o):节点i接收节点PutDownloadInfo原语操作未成功.k的下载〈i,k,o〉,并分配连接.消息,Di检查下载〈i,k,o〉是否存在.如果存在接受该消息,否则拒绝接受消息.接受消息后,把下载的价格加到节点i的货币总量中,并把对节点i的评价写入到Ski或者Fki中.如算法2所述,其中参数Ev是节点k对本次下载的评价,取值为Succ或UnSucess,分别对应成功或不成功.算法2.下载〈i,k,o〉完成后Di的处理算法.ProcedureDownloadComplete(i,k,o,Ev)ifGetDownloadInfo(i,k,o)endifend节点Di也会根据节点k下载文件的大小以及下载时长计算节点k的接收带宽,并报告给节点Dk,节点Dk根据报告结果修改节点k的最大下载带宽.这个过程较为简单,在此不给出详细算法.6总结本文提出一种基于商品市场模型的访问控制机制ACMCM,在P2P文件共享系统中引入市场机制,利用虚拟市场调节机制,使得文件下载请求均衡地分布在多个文件提供者之间.为遏制系统中的重复下载行为,下载文件的价格随着同一个请求者重Page12复下载次数的增加而呈指数增长,理论分析证明该定价策略可以有效抑制重复下载行为.通过在并发下载者之间合理分配带宽,有效地减少了下载占用的系统时间.ACMCM分布式协议相对较为简单,因此ACMCM应具有较好的应用前景和较好的工程可行性.致谢感谢审稿人提出的评审意见,这些评审意见对提高论文水平有很大帮助!
