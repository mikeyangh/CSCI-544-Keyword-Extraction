Page1概率积分密码分析李晓千1)吴文玲1)李宝1)于晓丽2)1)(中国科学院信息工程研究所北京100093)2)(中国科学院软件研究所北京100190)摘要在传统的积分密码分析中,积分区分器都是以概率1成立的.虽然Knudsen等学者提到过:“就像差分一样,积分也可以是概率的”,但是,没有文献报道过进一步的研究.文中对此问题进行了探讨,提出了概率积分密码分析方法,并从理论和实验两方面验证了概率积分分析方法的有效性.对于采用S盒设计的分组密码,文中证明了如果S盒的差分均匀性越接近随机概率,则分组密码抵抗概率积分密码分析的能力就越强.同时,文中指出高阶积分分析的某些技巧对于概率积分分析是行不通的,主要原因是随着求和变量个数的增加,积分特征概率趋近于随机概率.最后,文中通过对AES和LBlock这两个算法的概率积分分析实例,说明目前广泛使用的分组密码算法对于概率积分密码分析方法都是免疫的.关键词积分密码分析;差分密码分析;概率积分密码分析;轻量级密码;AES;LBlock1引言在过去的几十年里,对分组密码分析方法的研究有了很大的进展,其中应用最广泛的分析方法有差分密码分析[1]、线性密码分析[2]和积分密码分析[3]等.1990年,Biham等密码学家提出了差分密码分析.差分分析的基本思想是:通过分析两个中间状态的“差”经过几轮密码变换后的变化情况来恢复某些密钥比特.与差分分析类似,积分分析的基本思想是:通过分析多个中间状态的“和”经过几轮密码变换后的变化情况来恢复某些密钥比特.这两种分析方法的不同之处在于,差分分析关注的是两个中间状态的异或值,而积分分析关注的是多个中间状态的异或值以及这些状态之间的关系.差分分析经扩展得到不可能差分分析[4],进一步地,不可能差分分析经扩展得到不太可能差分分析[5].差分分析利用概率高于随机概率的差分特征筛选正确密钥,即p>pr;不可能差分分析利用概率为0的差分特征排除错误密钥,即p=0;而不太可能差分利用概率低于随机概率的差分特征排除错误密钥,即0<p<pr.类似地,在传统的积分分析中,我们利用的积分特征都必须满足概率为1,即p=1.比如对Square[3]、AES[6]、Crypton[7]、Hierocrypt[8]、IDEA[9]、Skipjack[10]、Camellia[11]、MISTY1[6]、FOX[12]、SAFER+[13]、Twofish[14]等算法的积分攻击.那么,能否构造概率不为1的有效概率积分特征,即pr<p<1或0p<pr?在文献[6]中,Knudsen等学者提到过:“就像差分一样,积分也可以是概率的”,这点明了概率积分特征的存在性,但是没有任何文献做进一步的研究.本文对此问题进行了探讨,提出了概率积分密码分析方法,并从理论和实验两方面验证了概率积分分析方法的有效性.本文的主要结论有:对于采用S盒设计的分组密码,如果S盒的差分均匀性越接近随机概率,则分组密码抵抗概率积分密码分析的能力就越强;并且,随着求和变量个数的增加,积分特征概率趋近于随机概率,因此高阶积分分析的某些技巧对于概率积分分析是行不通的.最后,通过对AES和LBlock这两个算法的概率积分分析实例,说明目前广泛使用的分组密码算法对于概率积分密码分析方法是免疫的.本文第2节简要介绍积分密码分析中的符号定义;第3节提出采用S盒的分组密码抵抗概率积分分析的充分条件,并用实验证明,随着求和变量个数的增加,积分特征概率趋近于随机概率pr;第4节通过对AES、LBlock的概率积分密码分析实例,验证第3节的结论,说明目前广泛使用的分组密码算法对于概率积分密码分析方法是免疫的.2基本记号和定义本文沿用文献[6]中的记号.如非特别说明,下文的“集合”均指多重集,即集合中的元素可以重复,例如S={1}与T={1,1}表示两个不同的集合.定义1[10].在积分分析中,定义活跃集A={(a0,a1,…,am-1)∈稳定集C={(a0,a1,…,am-1)∈平衡集B=(a0,a1,…,am-1)∈在本文中,定义Vx=(a0,a1,…,am-1)∈特别的,V0=B.其中m称作求和变量个数.作AC=A;性质1[6].(1)A/C经过一个双射后,仍然是A/C;(2)A的线性组合为B;(3)A与C的对应元素异或求和仍然为A,记(4)VxVy=Vxy.由性质1(1)得,A/C经过S盒仍然是A/C,但是B经过S盒后性质无法确定,如何确定B经过S盒后的性质便成为积分分析的瓶颈,概率积分分析便是针对这一问题引入的.定义2[6].几个集合的直积称作一个结构,例如CCCCABBB=C×C×C×C×A×B×B×B就是一个结构.与差分特征的定义类似,下面给出积分特征的定义.定义3.r-轮积分特征Ω是一个结构序列:α0,α1,…,αr,其中α0是明文满足的结构,αi(1ir)是第i轮输出满足的结构.定义4.r-轮积分特征Ω=α0,α1,…,αr的概率是指,在满足输入积分特征的结构独立、均匀随机选取时,该结构经过i轮加密,满足第i轮(1ir)输出积分特征αi的概率,记作pΩ.Page3定义5[15].对于一个n×n的S盒,令δS=2-nmaxα∈2n\{0}maxβ∈2n#{(a0,a1)∈称δS为S盒的差分均匀性.Probm[α→Sβ]定义6.对于一个n×n的S盒,记{#(a0,a1,…,am-1)∈=i=0=2-n(m-1){#(a0,a1,…,am-1)∈S(ai)=}β∑m-1为S盒的m次积分特征概率,其中α,β∈2n.如果积分特征(α,β)满足(α,β)≠(α,β),|Probm[α→Sβ]-2-n||Probm[α→Sβ]-2-n|,S=Probm[α→Sβ],称δm令δm匀性,即与随机概率差距最大的m次积分特征.定义7.如果一个差分特征概率/积分特征概率为p,并且一个满足该输入差分特征/输入积分特征的明文对/结构,经过一个随机置换后,仍然满足该特征概率p,则称此概率为随机概率,记作pr.3抵抗概率积分密码分析3.1抵抗概率积分密码分析的充分条件这一节我们给出采用S盒的分组密码抵抗概率积分密码分析的充分条件:S盒的差分均匀性越接近随机概率pr,分组密码抵抗概率积分密码分析的能力就越强.定理1.如果一个n×nS盒的任意非零差分特征概率均不大于p,那么任意积分特征概率也不大于p+2-n(1-p).证明.记Probm[α→Sβ]为一个S盒的积分特征(α,β)的概率,其中m是指求和变量个数.由已知得:m=2时,α,β∈2n\{0},Prob2[α→Sβ]p,其中Prob2[α→Sβ]指的是S盒的差分特征概率.下面证明求和变量个数m>2时,α,β∈2n,Probm[α→Sβ]p+2-n(1-p).(1)m=2时,由已知得(2)m=3时,α,β∈2n\{0},α,β≠0[α→Sβ]Prob2=#{(a0,a1)∈=2-n·#{(a0,a1)∈S(a0)S(a1)=β}p.(α,β)∈β≠S(α)[α→Sβ]Prob3=#{(a0,a1,a2)|a0a1a2=α,S(a0)S(a1)S(a2)=β}=2-2n·∑2n-1S(a0)S(a1)=βS(a2)}=2-2n·∑2n-12-2n·2n·2n·p=p<p+2-n(1-p).(α,β)∈{(α,β)∈β=S(α)[α→Sβ]Prob3=2-2n·∑2n-1S(a0)S(a1)=βS(a2)}=2-2n(·∑a2≠αS(a0)S(a1)=βS(a2)}+#{(a0,a1)∈2-2n·((2n-1)·2n·p+2n)=p+2-n(1-p).因此,m=3时,α,β∈2n,Prob3[α→Sβ]p+2-n(1-p)成立.α,β∈2n,Probm-1[α→Sβ]p+2-n(1-p),那么求和变量个数为m时,有α,β∈2n,Probm[α→Sβ]{#(a0,a1,…,am-1)∈=(3)假设m-1时定理成立,即=2-n(m-1)·∑2n-1∑m-1i=0Page4=2-n(m-1)∑2n-1Probm-1[αam-1→SβS(am-1)]2-n(m-1)·2n·2n(m-2)·(p+2-n(1-p))=p+2-n(1-p).综上所述,如果一个n×nS盒的任意非零差分特征概率均不大于p,那么任意积分特征概率也不大于p+2-n(1-p).由定理1我们得到:如果一个S盒的差分均匀性δ与随机概率pr=2-n很接近,那么S盒的任意积分均匀性也与随机概率很接近,该算法抵抗概率积分密码分析的能力也就越强.这个证明也从一个侧面反应了概率积分分析和差分分析的联系.差分分析关注的是两个中间状态的异或值,而概率积分分析关注的是多个中间状态的异或值.因为S盒的m次积分特征概率是多个m-1次积分特征概率的均值,因此当求和变量个数增大时,积分特征概率趋近于随机概率.下面我们用实验验证这一观察.3.2S盒积分特征概率随求和变量个数的变化从3.1节的证明过程我们可以看出:当求和变量个数增大时,积分特征概率趋近于随机概率.这一节分别以AES的8×8S盒、LBlock的4×4S盒为例验证这一观察.图1表示AES中S盒积分均匀性随求和变量个数的变化规律.横坐标表示求和变量个数m,纵坐标表示m次积分均匀性.从图1可以看出:对于AES的S盒,当求和变量个数增大时,积分均匀性趋近于随机概率pr,在这里pr=2-8.实验数据显示,当m11时,m次积分均匀性与2-8的差距小于10-24.图1AES中S盒的积分均匀性随求和变量个数的变化图2表示LBlock中S盒积分均匀性随求和变量个数增长的变化规律.图2只显示了LBlock加密算法中一个S盒S5的积分均匀性随求和变量个数增长的变化情况,其余7个S盒积分均匀性的变化情况类似.从图2可以看出:对于LBlock的S盒S5,当求和变量个数增大时,积分均匀性趋近于随机概率pr,在这里pr=2-4.实验数据显示,当m29时,对于任意加密算法中的S盒Si(0i7),m次积分均匀性与2-4的差距小于10-24.图2LBlock中S盒的积分均匀性随求和变量个数的变化由实验我们可以得到:对于AES和LBlock的S盒,当求和变量个数增大时,积分特征概率趋近于随机概率.实际上,现在绝大多数采用S盒的分组密码算法,抵抗概率积分分析的能力都很强,因为:(1)现代分组密码算法设计时,要求S盒必须具有良好的差分均匀性;(2)S盒的m次积分特征概率是多个m-1次积分特征概率的均值.所以,如果S盒的均匀性越好,求和变量个数m越大,那么S盒的m次积分特征概率就越接近随机概率pr,利用此概率积分特征构造的区分器就越难把密码算法和随机置换区分开.由于同样的原因,高阶积分分析的某些技巧对于概率积分分析是行不通的,这一点将在下一节的实例中详细阐述.4AES、LBlock的概率积分密码分析这一节通过对AES、LBlock进行概率积分密码分析,说明目前广泛使用的分组密码算法对于概率积分密码分析方法是免疫的.4.1计算积分特征概率在差分密码分析中,我们假设每一轮子密钥统计独立且均匀分布;在概率积分密码分析中,对于积Page5分特征Ω=α0,α1,…,αr,我们给出以下假设.假设1.对于任意一个满足输入积分特征α0的结构T0,经过i(i1)轮加密得到第i+1轮的输入结构Ti,我们把这个积分特征中满足αi的Ti组成的空间记作SpaceΩi(αi);另外,把任意满足αi的结构组成的空间记作Space(αi).假设条件概率ProbTi,ki+1ProbTi,ki+1其中ki+1表示第i+1轮的子密钥,Fki+1表示第i+1轮的轮函数.这个假设比子密钥独立均匀的假设强.在对任何一个算法进行概率积分密码分析时,都有必要验证假设1的正确性.在假设1下,计算积分特征概率的问题可以归约到计算S盒的积分特征概率.因为对于任意一个线性变换P:x→P·x,给定输入积分特征α,易得输出积分特征β=P·α以概率1成立.所以计算积分特征概率的问题可以归约到计算S盒的m次积分特征概率Probm[Vx→SVy],x,y∈2n.下面我们用归纳的方法给出一个计算Probm[Vx→SVy]的一般方法:构造表{Tmx,y},0x,y2n-1,其中m指求和的变量个数.(1)令m=2,计算表{T2x,y}(0x,y2n-1):T2x,y=2-n·#{(a0,a1)|a0a1=x,S(a0)(a1)=y,ai∈2n,0i1},实际上这就是S盒的差分分布表.(2)假设已经计算得到求和变量个数为m-1的表{Tm-1x,y}(0x,y2n-1):Tm-1x,y=2-n(m-1)·{#(a0,a1,…,am-2)那么由{Tm-1x,y}可以得到{Tmx,y}:Tmx,y=2-nm·{#(a0,a1,…,am-1)i=0∑m-1=2-nm∑2n-1∑m-2=2-nm·2n(m-1)∑2n-1=2-n∑2n-1i=04.2对AES的概率积分密码分析在这一节里,我们先在假设1的条件下对AES进行概率积分密码分析,然后通过实验验证假设1的正确性.AES是SP结构的分组密码,明文分块为128bit、192bit和256bit.本文只考虑对AES-128的概率积分分析.我们将利用文献[6]中概率为1的积分特征.在这个概率为1的积分特征中,输入积分特征由1个活跃字节A和15个稳定字节C组成;经过第1轮轮函数的作用,变为1列4个活跃字节A和3列12个稳定字节C;经过第2轮轮函数的作用,全部变成16个活跃字节A;经过第3轮轮函数的作用,全部变成16个稳定字节B;经过第4轮子密钥异或,得到16个稳定字节B.接下来我们考虑在概率为1积分特征的基础上,向后加一轮,再利用高阶积分分析的技巧向前加几轮,构成概率p<1的积分特征.先考虑向后加一轮.经过第4轮S盒的变换,设其中一个字节的积分特征为Vx,令px=Prob[B→SVx],易知pΩ=p.在假设1的条件下,由3.1节的实验数据得:当m11时,AES的S盒m次积分均匀性与2-8的差距小于10-24.因为在假设1的条件下,px=Prob[B→SVx]又由积分均匀性的定义得|px-2-8||δ28这里求和变量个数m=28>11,所以我们有|px-2-8||δ28这样的概率积分特征构成的区分器无效.再考虑使用文献[6]中的方法,利用高阶积分分析的技巧向前加轮数———通过增加输入积分特征中活跃字节的个数,增加积分特征的轮数.但是这个方法在概率积分分析中行不通,因为增加输入积分特征中活跃字节的个数k,必然导致求和变量个数m=28·k增加.在假设1的条件下,随着m的增大,积分特征概率p趋近于随机概率pr=2-8.实验数据显示,对AES的S盒,当m11时,m次积分均匀性与2-8的差距小于10-24.当输入积分特征中活跃字节个数k1时,求和变量个数m28,m次积分均匀性几乎与2-4相等,利用这样的概率积分特征构造的区分器无效.Page6我们通过实验验证了假设1在AES中的正确性.随机选取1000个密钥、1000个满足输入积分特征的结构,用AES加密.对于每一个结构,在经过第4轮第一个S盒后,对这个结构中所有中间状态值求和得到x.我们对所有的x做统计,得到的实验结果与我们在假设1的条件下得到的理论结果吻合,证明了假设1对AES算法的正确性.综上所述,AES对概率积分密码分析是免疫的.4.3对LBlock的概率积分密码分析在这一节里,我们对LBlock进行概率积分密码分析,在这之前,我们先验证假设1的正确性.LBlock是Feistel结构的轻量级分组密码,由32轮迭代算法组成,明文分块为64bit,密钥为80bit.本文沿用LBlock设计文档[16]中的记号.4.3.1验证假设1对于任意一个给定的LBlock的积分特征,我们先在假设1的条件下给出相应的概率分布,再在实际情况下给出相应的概率分布,然后用统计方法检验这两个分布的拟合程度.这里只详细阐述对一个积分特征验证假设1的过程,其余积分特征的验证过程类似.在概率为1的9轮积分特征后加1轮,构成一个10轮LBlock概率积分特征.图3(a)与LBlock设计文档中给出的9轮积分特征稍有不同.图3(b)是本文给出的10轮积分特征中的9~10轮,1~8轮与图3(a)的1~8轮积分特征一样.在这个10轮LBlock积分特征中,1~8轮的概率为1.在第9轮中,S5的输入积分特征为B,令S5的输出积分特征为Vx,则第10轮的输出积分特征中有一个半字节为Vx,这就构成了一个10轮概率积分特征.我们记px=Prob[BS→5Vx],易知这个10轮积分特征的概率为px.下面考虑在没有假设的条件下积分特征概率px的分布.第i轮的输出为(Xi+1,Xi),其中Xi=Xi,7‖Xi,6‖…‖Xi,1‖Xi,0.第i轮轮函数F的输出为Ui,Ui=Ui,7‖Ui,6‖…‖Ui,1‖Ui,0.由加密算法得U9,4=S5(X9,5K9,5),X9,5=U8,5X7,3,U8,5=S7(X8,7K8,7)X7,3=S2(S0(S1(X0,5W3)W4)W5)W6,其中,当密钥固定时,Wi(0i6)是明文Xi的函数:=S7(S7(S7(X0,5W0)W1)W2),Page7W0=W0(X1,6),W1=W1(X0,2,X0,3,X1,2,X1,3,X1,5,X1,7),W2=W2(X0,0,X0,1,X0,2,X0,3,X0,4,X0,6,X0,7,X1,0,X1,1,X1,2,X1,3,X1,4,X1,5,X1,6,X1,7),W3=W3(X0,0,X1,0,X1,1,X1,6),W4=W4(X0,2,X1,4,X1,5),W5=W5(X0,1,X0,4,X1,2,X1,4,X1,7),W6=W6(X0,4,X0,6,X0,7,X1,0,X1,1,X1,3,容易证明,当明文独立、均匀随机选取时,对任意固定密钥,Wi(0i6)都是均匀随机独立的变量,因此有X1,4,X1,5).根据积分特征概率的定义,px=Prob[BS→5Vx]把px的分布与px的分布做比较,得到图4.为了检测p和p的拟合程度,我们用拟合优度测试得χ2(p;p)=24∑x∈24从测试结果我们可以看出,在假设1的条件下积分特征概率的分布p和没有任何假设条件下的分布p十分接近.我们对LBlock的其它积分特征也做了检验,结果都验证了假设1的正确性.因此假设1对LBlock算法是合理的.4.3.2对16轮LBlock的概率积分密码分析在这一节里,我们在概率为1的积分特征的基础上,向后加两轮,再利用高阶积分分析的技巧向前加几轮,构成概率p<1的积分特征;然后利用这个积分特征构造区分器,对16轮LBlock做恢复密钥攻击;最后把概率积分密码分析的复杂度与传统积分分析作比较,证明LBlock对概率积分密码分析是免疫的.先向后加两轮,见图5.图5是本文给出的11轮积分特征中的8~11轮,1~7轮与图3(a)的1~7轮积分特征一样.这个积分特征是我们能找到的概率最大的积分特征,其概率pΩ=p3+(1-p3)pr≈2-3.9992×3+2-4,其中p3表示一个满足输入积分特征的结构加密时,满足每一轮输出积分特征的概率;(1-p3)pr表示一个满足输入积分特征的结构加密时,不满足所有中间轮输出积分特征的概率、满足最后一轮输出积分特征的概率.利用图5的11轮积分特征,我们构造11轮概率积分区分器,对16轮LBlock进行恢复密钥攻击.与文献[16]中的方法完全一样,我们猜测12~16轮中的12个半字节密钥,对每一个猜测密钥值建立一个计数器.随机选择24个明文构成一个满足输入积分特征的结构,经过16轮加密,得到相应的24个密文.用每一个猜测密钥值对24个密文进行部分解密,得到第11轮的输出值X11,5,检验24个X11,5的异或之和是否为0,如果为0,则相应密钥的计数器加1.再随机选一个满足输入积分特征的结构,重复以上步骤,直到某个密钥的计数远远大于其余密钥为止,这个密钥就是我们要找的正确密钥.这样就恢复了48bit密钥值,剩下的比特可以通过穷搜的方法得到.对于概率为2-3.9992×3+2-4的积分特征,用文Page8献[17]计算复杂度的方法,攻击成功至少需要226.3个结构,成功概率是0.99.因此对16轮LBlock的概率积分密码分析的时间复杂度是230.3,需要存储248个密钥对应的计数器,其中1个单位时间复杂度是指运行16轮LBlock加密算法一次需要的时间.再考虑利用高阶积分分析的技巧向前加轮数,和在AES中一样,这个方法在概率积分分析中行不通,因为向前加轮数必然会使得输入积分特征中活跃字节的个数k增加,进而导致求和变量个数m=24·k增加.在假设1的条件下,随着m的增大,积分特征概率p趋近于随机概率pr=2-4.实验数据显示,对LBlock的S盒Si(0i7),当m29时,m次积分均匀性与2-4的差距小于10-24.当输入积分特征中活跃字节个数k2时,求和变量个数m28,m次积分均匀性几乎与2-4相等,利用这样的概率积分特征构成的区分器无效.因此概率积分密码分析对LBlock能攻击的最大轮数是16,时间复杂度为230.3;而传统积分密码分析对LBlock能攻击的最大轮数是22.由此看来,概率积分密码分析和传统积分密码分析相比,攻击能力较弱.目前广泛使用的分组密码算法,在设计S盒时,都要求S盒必须具有良好的差分均匀性,并且在算法的安全性评估中,都考虑了算法抵抗传统积分密码分析的强度.因此我们在概率为1积分特征的基础上,构造的积分特征的概率和随机概率很接近.利用这样的概率积分特征构造的区分器,能够攻击的轮数也小于传统积分特征.总的来说,目前广泛使用的分组密码算法对于概率积分密码分析方法是免疫的.5结论本文提出了一种新的分组密码攻击方法———概率积分密码分析.通过理论和实验两方面的研究,验证了概率积分分析方法的有效性.对于采用S盒设计的分组密码,本文的研究从一个侧面反映了概率积分密码分析与差分密码分析的关系:如果S盒的差分均匀性越接近随机概率,则分组密码抵抗概率积分密码分析的能力就越强.并且,本文指出:高阶积分分析的某些技巧对于概率积分分析是行不通的,主要原因是随着求和变量个数的增加,积分特征概率趋近于随机概率.通过对AES、LBlock的概率积分分析,说明目前广泛使用的分组密码算法对于概率积分密码分析方法是免疫的.
