Page1基于体数据空间相似性的传输函数优化设计方法1)(浙江财经大学信息学院杭州310018)2)(浙江大学CAD&CG国家重点实验室杭州310058)摘要传输函数设计是体数据可视化流程的重要环节,高效的传输函数设计方法是提升体数据可视化效率的关键.在传统传输函数设计的基础上,该文以提升体数据特征可视化及分析效率为目标,提出一种基于体数据空间相似性的传输函数优化设计方法.在特征空间分析过程中,结合体数据空间位置信息,定义特征空间相似性度量标准,对一维传输函数特征空间进行自适应划分;在光学参数映射过程中,定义能量方程描述感兴趣特征的可见性分布与目标可见性分布的差异,近似求解能量方程的梯度,加速光学参数向量的迭代优化,以高效地实现光学参数优化设计.相比于传统的传输函数设计方法,该方法有效耦合特征空间分析及光学参数映射过程,可以帮助用户快速地实现体数据中感兴趣特征的分析与可视化.大量的实验结果、效率对比及用户体验反馈信息进一步验证了该文算法的有效性与实用性.关键词体数据;传输函数;特征空间;光学参数;可见性1引言作为科学计算可视化的一个重要分支,体数据可视化是将三维体数据描述为直观的二维图像的过程,其目的是形象地展示体数据中隐含的特征信息,有效地揭示体数据内部特征的结构关系、空间分布等信息,广泛应用于医疗诊断、地质勘探、气象预测、科学验证等与人类生活、社会发展息息相关的重要领域.随着图形处理器(GPU)计算及存储能力的不断加强,图形、图像处理及可视化技术日趋成熟,领域专家对体数据可视化提出了更高的要求,不仅要实现对体数据内部特征结构、空间分布的认知,还要实现体数据中感兴趣特征的实时分析与快速展示,以满足不同领域的应用需求.因此,针对高效体数据可视化方法的研究,已然成为当前体数据可视化领域的研究热点.传输函数设计是实现体数据分类与可视化的重要手段,亦是提升体数据可视化效率的关键,主要可分解为两个步骤,即特征空间分析和光学参数设计.特征空间分析是根据属性信息对体数据进行统计与分析,进而提取体数据中隐含的特征信息;光学参数设计则是基于这些特征信息,建立数据空间中的数据与视觉元素之间的映射关系.例如,经典的一维传输函数用标量值属性对数据进行分析,用户交互设置曲线定义光学参数,进而实现体数据特征的分类与可视化[1].然而,一维传输函数设计是一个复杂且耗时的过程,主要存在以下两点不足:(1)特征空间分析过程不够自动化,即用户难以确定感兴趣特征的标量值属性区间,反复试错的过程制约了体数据可视化效率的提升;(2)参数设计过程不够直观,即传输函数参数设计界面与绘制结果窗口的分离,容易使用户在传输函数设计过程中无法有效确定目标,进而在体数据探索过程中迷失方向.为优化传输函数设计过程,国内外研究学者们提出了大量的特征空间分析及光学参数设计方法.在标量值属性的基础上,多维属性的引入可以从更多角度描述体数据的分布,能够帮助用户有针对性地进行特征空间分析,以提取体数据内部感兴趣特征,如梯度模[2]、曲率[3]、形状[4]、纹理[5]、相对大小[6]等属性.为了进一步优化特征空间的分析过程,亦有大量研究利用参数估计、聚类等方法对多维传输函数特征空间进行自动分析[7-8],或在评价信息的引导下,对传输函数特征空间进行迭代细分,以避免传统反复试错的特征空间分析过程,实现传输函数特征空间自适应划分[9-10].然而,随着传输函数维度的增加,多维信息计算复杂度的升高,多维传输函数特征空间分析过程复杂且难以理解与交互,一定程度上制约了体数据可视化效率的提升.光学参数设计是传输函数定义过程中的重要环节,直接决定了特征在绘制结果图像中的显示.然而,传统的传输函数设计过程中,光学参数设计窗口与绘制结果窗口的分离,使得传输函数设计过程不够直观,缺乏目标感,难以理解与交互.基于图像的传输函数设计方法直接对绘制结果图像进行分析,无需用户交互设置曲线定义光学参数,即可实现传输函数参数优化设计[11-13].亦有研究将可见性引入传输函数设计过程,即在初始传输函数作用下,统计体数据可见性分布,定义能量方程以度量初始传输函数作用下可见性分布与交互定义的目标可见性分布的差异,进而利用最优化方法,迭代获得满意的绘制结果[14-16].虽然上述传输函数设计方法能够直观地定义光学参数,实现感兴趣特征的有效展示,然而,初始传输函数集合的规模及复杂的参数优化过程,增加了传输函数设计的复杂度,降低了体数据可视化的效率,难以满足领域专家的实时应用需求.可以看出,已有的传输函数设计方法在特征空间分析及光学参数设计方面做了深入的研究,却并未实现二者的有效耦合,为用户提供完整的高效传输函数设计方法,提升体数据分析与可视化效率.本文在传统传输函数设计的基础上,提出一种高效的传输函数设计流程.在特征空间分析阶段,结合体数据空间位置信息,定义空间相似性度量标准,对一维传输函数特征空间进行自适应划分;进而,定义能量方程来描述感兴趣特征当前可见性分布与目标可见性分布的差异,近似化简能量方程梯度计算,以快速地实现光学参数迭代优化设计.相比于传统的传输函数设计方法,本文提供的传输函数设计流程主要贡献包括:(1)将空间相似性度量引入一维传输函数特征空间,自适应划分获得的特征集合可以凭借标量值属性清晰地排序,结合领域专家的先验知识可以有效实现体数据分类;(2)以最小化度量特征可见性分布差异的能量函数为目标,利用近似的方法快速地实现光学参数优化设计,提升了传输函数设计的效率;(3)在一维特征空间分析的基础上,按照标量值大小的顺序展示不同特征,由用户交互选择感兴趣特征,在此基础上,可以直接定义不同特征对绘制Page3结果图像的预期贡献值,进而最小化可见性分布差异,自动地实现传输函数参数优化设计.传输函数设计过程中,特征空间分析与光学参数设计紧密结合,耦合度有效提升.因此,利用本文算法可以帮助用户快速地对体数据进行分析与可视化,大量的体数据可视化结果及用户体验反馈信息亦验证了本文算法的有效性与实用性.2相关工作传输函数是体数据可视化过程中的核心环节,亦是实现高效体数据可视化的关键.Guo等人[17]由传输函数设计手段出发,从基于图像的传输函数、以数据为中心的传输函数、传输函数设计界面和交互方式等角度,对传输函数的基础和研究现状进行了综述.本文的目标是研究高效的传输函数设计方法,由传输函数设计过程出发,从特征空间分析及光学参数映射角度对相关工作进行分析与阐述.经典的基于标量值属性的传输函数是以一维数据直方图为特征空间,帮助用户分析与辨识体数据特征.为了增强特征空间对体数据特征的表达,Kniss等人[2]在标量值属性的基础上,引入梯度模属性,构建二维特征空间,能够有效描述体数据特征的边界信息;二维特征空间的坐标轴属性表达不同的含义,二维直方图统计可以从不同角度表达体数据特征,如LH直方图升华了体数据特征边界的表达方式,方便用户快速地发现体数据特征边界信息[18];基于形状属性的统计空间可以有效区分体数据中不同形状的特征,如管状、片状、团状[4];基于纹理统计属性的特征空间,可以帮助用户提取体数据中不同纹理结构特征[5];基于相对大小的特征空间,可以辨识体数据中不同尺度的特征[6].为综合考虑体数据多维属性信息,进一步描述体数据特征,Hadwiger等人[19]定义了标量值、一阶导数、二阶导数的三维特征空间,即在三维统计空间中选取感兴趣特征;Guo等人[20]引入平行坐标技术全面揭示体数据特征的属性信息,进而在基于平行坐标的特征空间中,引入降维技术,快速地识别感兴趣特征,无需复杂的界面切换等步骤,可有效拓展于多变量体数据可视化[21].Zhao等人[22]利用局部线性嵌入法(LLE)对体数据多维属性信息进行降维,并投影至低维空间,方便用户分析与提取感兴趣特征;Moura等人[23]则是利用自组织映射法(SOM)将体数据多维属性信息降维,用户可以在低维空间中交互式地实现感兴趣特征的分析与提取.为简化多维特征空间分析过程,Wang等人[7]在基于标量值与梯度模的二维传输函数特征空间中,利用高斯混合模型(GMM)自动地分析体数据特征信息;Maciejewski等人[8]则进一步引入了核密度估计(KDE),自动地实现感兴趣特征的分析,并拓展至时序数据可视化,能够快速地追踪时序特征的变化;Roettger等人[24]在二维传输函数的基础上,引入体素空间位置信息,对特征空间进行自动划分,由用户交互选取感兴趣信息.亦有大量研究利用评价信息自适应指导特征空间分析过程.Cheuk等人[9]提出一种迭代式传输函数设计策略,利用图割技术对二维传输函数空间进行预划分,进而迭代式地探索体数据,方便用户发现感兴趣特征;Lundstrom等人[10]引入部分范围直方图概念,迭代式分析传输函数空间中的数据分布,进而有效识别体数据细节特征;Zhou等人[25]则提出一种传输函数混合设计方法,在经典的二维特征空间分析基础上,引入附加属性信息对感兴趣特征做二次特征空间分析,以优化感兴趣特征的提取.尽管多维特征空间可以从不同角度描述体数据中特征信息,优化感兴趣特征的提取过程,但是随着传输函数维度的增加,多维信息计算复杂度的升高,多维传输函数特征空间分析过程亦复杂且难以理解与交互,一定程度上制约了体数据可视化效率的提升.为了进一步精确体数据特征的分析与提取,Lathen等人[26]设计空间微调的传输函数,即对空间体素的标量值信息设定动态的微调范围,以优化绘制结果图像中血管的形状描述,有效地弥补了血管造影技术中数据采样的误差,满足了医学领域的特定应用,而对于大部分体数据而言,体素标量值的变化范围及绘制结果图像的优化目标均难以确定,一定程度上限制了空间微调传输函数的应用;Bruckner等人[27-28]则设计了等值面相似图,通过分析体数据中不同等值面之间的距离互信息,进而提供了一种依赖于等值面相似度的体数据分类方法.对于分布规律、结构清晰、易用等值面表达的体数据特征,该方法具有较好的分类效果,而对于那些空间结构繁琐、易受噪声干扰、难以利用等值面精确表达的复杂体数据特征,如MRI医学数据,则呈现出较强的局限性.基于图像的传输函数是直观的光学参数设计方法.DesignGalleries[11]是指在初始参数空间中随机采样生成不同的传输函数及对应的绘制结果图像,利用图像相似性对绘制结果图像集合做降维处理,Page4进而由用户交互选取感兴趣结果图像及其对应的传输函数参数向量,实现光学参数优化设计.Wu等人[12]提出一种基于遗传算法的交互式传输函数设计方法,用户可以在不同的绘制结果图像中定义其感兴趣特征,以感兴趣区域相似程度为衡量标准,对初始的传输函数集利用遗传算法不断进化,进而实现能够满足用户需求的光学参数设计.Guo等人[13]提出所见即所得(WYSIWYG)的体数据可视化系统,利用直观、方便的交互操作实现体数据特征分析与光学参数设计.为了进一步实现体数据中细节特征的分析与可视化,Guo等人[29]对初始体数据进行预分类,进而构建特征之间的拓扑关系,引入树状结构存储,借助于简单而直观的交互方式,实时地实现不同特征的分类与可视化.为了使感兴趣特征在绘制结果图像中的展示定量化,使传输函数的参数设计自动化,Correa等人[14]引入可见性概念度量不同特征在绘制结果图像中的贡献,进而定义能量优化方程实现半自动的传输函数参数设计;Wang等人[15]拓展可见性至特征可见性,在二维传输函数空间中进行特征分类,进而统计不同特征在绘制结果图像中的贡献,以最小化特征可见性差异为目标,自动优化特征的光学属性映射;Ruiz等人[16]则由用户预定义可见性分布,进而引入KL距离度量当前可见性分布与目标可见性分布的差异,自动优化光学参数设计过程,实现感兴趣特征的定量展示.上述传输函数均可以直观地实现光学参数优化设计.然而,初始传输函数集合的规模及复杂的参数优化过程,增加了传输函数设计的复杂度,降低了体数据可视化的效率,难以满足领域专家的实时应用需求.3本文高效传输函数设计方法传输函数设计是体数据可视化的核心环节,相关工作在特征空间分析及光学参数映射过程取得了丰硕的研究成果,却并未实现二者的有效耦合,这些工作以高效传输函数设计为目的,为用户提供方便、快捷的体数据可视化工具.本文以体数据可视化高效传输函数设计方法为目标,引入空间相似性度量,实现特征空间自动分析;定义能量方程描述感兴趣特征可见性分布的差异,利用近似方案简化光学参数优化设计过程.最终,为用户提供快速、有效的传输函数设计方案,以提升体数据特征分析与可视化效率.本节将重点阐述算法的总体流程及具体实现过程.3.1算法流程为了更加清楚地表述本文算法的实现过程,图1出示了算法总体流程图.首先,构建一维传输函数特征空间,统计一维数据直方图,且对初始的数据统计三维空间信息,通过计算相邻标量值特征的空间相似性,对一维特征空间进行自适应划分;分类获得的特征是按照标量值属性排序的,可以按序进行可视化,由用户根据其先验知识交互选择感兴趣特征;进而,计算在当前传输函数作用下感兴趣特征的可见性直方图,由用户根据需求交互指定目标可见性直方图,以最小化可见性分布差异为目标,利用近似方法进行优化求解,实现传输函数光学参数优化设计.图1本文高效传输函数设计方法的总体流程因此,本文提出的高效传输函数设计方法能够有效耦合特征空间分析与光学参数设计,用户在传输函数设计过程中,无需反复试错地定义曲线,简单地设置空间相似性阈值,选择感兴趣特征及定义目标可见性分布,即可实现体数据中感兴趣特征的分析与可视化.整个流程简单易行,为用户提供了便捷的传输函数设计接口,为高效体数据可视化提供了有效支持.3.2特征空间自动分析特征空间分析是传输函数设计的重要步骤.在经典的一维传输函数中,特征空间即标量值属性对应的坐标轴,在直方图统计信息的提示下,用户可以交互设置曲线,以探索体数据中感兴趣特征信息.然而,指导信息不够准确,交互过程相对随机,使得一维传输函数特征空间分析过程存在较强的不确定性,一定程度上限制了体数据可视化效率的提升.尽管多维传输函数设计可以提供更多的属性统计信息,有针对性地表达初始体数据特征,然而的属性计算复杂度较高,多维特征空间难以交互与理解等诸多因素,为不具备丰富图形学、可视化知识的领域专家带来不便,抑制了体数据可视化在专业领域的拓展与应用.三维空间位置是实现体数据特征分类的重要信Page5息.在空间传输函数[23]的启发下,本文统计重心、方差等空间信息,定义空间相似性度量,对经典的一维特征空间进行自适应划分,主要步骤如下:(1)空间信息统计.对于同一标量值特征,所有体素的三维重心能够有效表达特征的空间位置,而三维方差可以描述特征的空间变化程度.因此,可利用空间重心、方差等属性辨识不同特征.在一维直方图的统计过程中,累加同一标量值特征对应体素的三维坐标,进而计算每个标量值特征对应的三维平均坐标即重心,如式(1)所示:其中,k表示标量值为特征i中体素的数目;P(t)表示特征i中第t个采样点的三维坐标;B(i)则表示特征i的重心坐标,能够有效度量特征i空间位置信息.根据式(1)获得的重心坐标,可进一步计算每个标量值特征的方差,如式(2)所示:其中,V(i)表示标量值为i特征的方差,能够有效度量特征i的形状信息.(2)空间相似性度量.重心和方差的统计可以有效表达同一标量值特征的空间位置与空间差异,是判断不同标量值特征是否属于同一特征的有效分析原则.因此,可以结合重心与方差统计信息,定义空间相似性度量标准,如式(3)所示:其中,Bm和Vm分别表示标量值为m的特征重心与方差;Bn和Vn则表示标量值为n特征的重心与方差;α和β分别对应重心与方差的差异参数,由用户交互指定.综合分析不同标量值特征的重心与方差的差异,即可获得空间相似性度量标准Tmn.根据不同标量值特征的空间相似性,可以判断相邻标量值特征是否属于同一类特征,进而实现一维传输函数特征空间自适应划分.(3)特征空间自适应划分.通常情况下,具有相同或相近标量值的体素属于同一特征的概率较大.因此,在初始一维传输函数特征空间中,以初始数据直方图的波峰为起始,结合空间相似性度量标准,迭代地判断当前标量值特征与其相邻标量值特征的相似性.即若相似性度量标准小于一定阈值,则认为是同一特征,可划分为一类,否则停止当前相似性度量计算,迭代地选取下一峰值为起始,继续对一维直方图进行划分,直至直方图中所有标量值特征均划分为其对应的特征.可以看出,上述迭代划分过程避免了反复试错的交互式特征空间分析,用户可以交互式定义相似性阈值,快速、高效地实现一维传输函数特征空间的自适应分析.(4)感兴趣特征提取.空间重心和方差等统计信息可以有效度量相邻标量值特征的相似性,能够自适应地实现一维传输函数特征空间的分析.在此基础上,提供了一种体数据感兴趣特征快速浏览与提取的用户交互界面,即根据标量值的大小,对一维特征空间的划分区段按序绘制,用户可以在特征展示的过程中,交互选择感兴趣特征信息.图2出示了CT采样的VisMale数据利用上述基于空间相似性的特征空间分析方法获得的感兴趣特征信息.在体数据分类过程中,差异参数指定为α=β=0.5,相似性阈值指定为η=0.07.利用上述步骤对一维传输函数特征空间进行自动划分,并由用户交互选取感兴趣特征,如图2(a)展示的皮肤特征[26~51],图2(b)展示的骨骼特征[73~101],其中,区间数值为初始采样值量化至0~255对应的数值(以下同).可以看出,相对于传统的特征空间分析方法,本文算法提供了更加方便的交互方式,帮助用户快速地确定体数据中感兴趣特征的标量值范围,为后续光学参数映射提供了基础.图2基于空间相似性的VisMale数据分类结果3.3光学参数优化设计在特征空间分析基础上,光学参数映射是传输函数设计过程中的又一重要环节,是指建立体数据特征与视觉元素之间的映射联系,进而在绘制结果图像中有效描述感兴趣特征信息.颜色与透明度信息是重要的视觉元素,特征的颜色通常由用户根据先验知识,查找颜色表交互定义完成;透明度决定了特征对绘制结果图像的贡献,在经典的一维传输函数设计过程中,由用户交互设置曲线进行定义,过程不够直观,存在较强的不确定Page6性,制约了体数据可视化效率的提升.在相关工作的基础上,本文定义能量方程描述感兴趣特征可见性分布与目标可见性分布的差异,近似化简能量方程,降低特征可见性计算代价,以快速实现光学参数优化设计,主要步骤如下:(1)特征可见性分布统计.可见性是指体数据特征在绘制结果图像中的贡献,广泛应用于视点选择[30]与示意性可视化[31],如式(4)所示:其中,α(s)表示采样点s的不透明度信息,根据采样点s的属性信息,由传输函数映射而来;α(s)是指在光线投射到达采样点s之前不透明度的累加值;v(s)则表示当前采样点s对绘制结果图像的贡献,即可见性.Correa等人[14]拓展体素可见性至标量值特征可见性,即统计同一标量值所有采样点对绘制结果图像的贡献,进而利用可见性直方图驱动光学参数优化设计.具体的可见性统计,如式(5)所示:VH(i)=α(i)∫s∈Ω其中,VH(i)表示体数据中标量值为i的所有采样点可见性的累加值;δ(s,i)是二值函数,用于判断采样点s是否属于标量值为i的特征,其定义如式(6)所示:其中,f(s)是获取采样点s标量值的函数.可见性直方图可以帮助用户直观地分析不同标量值特征对绘制结果图像的贡献,但是其计算过程占用大量的GPU存储及计算资源,算法复杂度较高.由3.2节论述可知,基于空间相似性的特征空间分析方法可以帮助用户快速获取感兴趣特征的标量值区间,为了进一步简化可见性的计算过程,在文献[15]的启发下,本文进一步拓展标量值特征可见性至感兴趣特征可见性,如式(7)所示:FVH(j)=α(i)∫s∈Ω其中,FVH(j)表示属于第j个特征所有采样点可见性的累加值,能够有效描述特征感兴趣j对绘制结果图像的贡献.而二值函数δ(s,j)能够有效判断采样点s是否属于感兴趣特征j,其定义如式(8)所示:δ(s,j)=其中,tj1和tj2是感兴趣特征j的标量值范围.对式(7)离散化求解,如式(9)所示:FVH[j]=FVH[j]+α(i)(1-α(s)),α(s+Δs)=α(i)(1-α(s))+α(s)因此,在光线投射过程中,沿视线方向动态判断采样点的特征归属,进而计算采样点对绘制结果图像的贡献值,累加至对应特征的可见性,遍历绘制结果图像中的所有像素,统计体数据中感兴趣特征的可见性直方图,进而归一化获得感兴趣特征的相对可见性分布.图3出示了特征可见性直方图统计示意图.(2)目标可见性分布定义.目标可见性分布是指感兴趣特征在绘制结果图像中预期的贡献比例,以做为后续光学参数优化设计的目标,由用户根据需求交互设置完成.为增强光学参数优化设计的有效性,提升体数据可视化效率,本文提供了3种目标可见性分布设计方案,即平均设计方案、自动设计方案和交互设计方案:①平均设计方案目标可见性定义的对象均为用户交互指定的感兴趣特征,初始情况下,假定所有感兴趣特征的重要性相同,即要求每个感兴趣特征对绘制结果图像的贡献均相同,提供一种平均目标可见性分布设计方案,如式(10)所示:其中,n表示特征空间分析过程中,用户交互选取感兴趣特征的数目;FVH[j]则表示感兴趣特征j的目标可见性.平均设计方案作为初始的目标可见性定义方案,可以平衡不同特征对绘制结果图像的贡献,却难以突出展示重要特征,不能满足特定应用需求.②自动设计方案感兴趣特征根据应用需求的不同,亦有重要性之分,为了进一步增强算法的有效性与实用性,提供一种基于特征重要性分析的目标可见性自动设计方案.即认为感兴趣特征的重要性与体素数目及标量值成正比,与特征区间间隔成反比,进而定义特征重要性计算规则,如式(11)所示:Page7其中,numVoxel(j)表示感兴趣特征j体素数目的归一化值;numBin(j)表示感兴趣特征j区间间隔的归一化值;而f(j)表示感兴趣特征j对应直方图波峰标量值的归一化值;而I(j)即为感兴趣特征j的重要性度量.进而,可以按比例确定感兴趣特征对绘制结果图像的贡献,自动地实现目标可见性定义.③交互设计方案自动设计方案一定程度上方便了目标可见性分布的定义,提升了光学参数优化设计的效率.然而,体数据来源的多样性及特征的复杂性使得定义综合图4针对VisMale数据不同目标可见性设计方案对应的体数据可视化结果(3)光学参数迭代优化.目标可见性分布确定了感兴趣特征在绘制结果图像中的贡献比例.初始传输函数作用下的可见性分布通常与目标可见性分布差异较大,为了能够实现光学参数自动设计,定义能量方程度量当前可见性分布与目标可见性分布的差异,如式(12)所示:其中,E(犃)用于度量当前可见性分布与目标可见性分布的差异;n表示用户交互选取感兴趣特征的数量;犃表示不透明度向量{α0,α1,α2,…,α255},满足条件:0αi1.初始情况下,若标量值特征i不属于感兴趣特征,则αi=0;若标量值特征i属于感兴趣特征,αi在其特征范围内部满足高斯函数关系.FVH(j)表示当前不透明度向量对应的感兴趣特征j的可见性.此时,传输函数光学参数设计转化为一个最优化问题,即求解能量方程在不透明度集合上的极小值.通常,可利用经典的最速梯度下降法迭代求解不透明度向量,如式(13)所示:其中,E(犃)是能量方程对于不透明度向量的偏导;s是迭代求解参数,初始值为1;t表示迭代的次数.然而,在利用最速梯度下降法求解不透明度向量过程中,不透明度向量的每次更新,均需统计两次感兴趣特征可见性分布,算法迭代过程的复杂度大而有效的体数据特征重要性度量标准是一项十分困难的工作.领域专家更加相信自己对数据的先验知识及视觉感知,因此,提供了用户交互设置的目标特征可见性设计方案.用户可以交互式确定不同感兴趣特征对绘制结果图像的贡献比例,进而增强重要特征的视觉感知.图4出示了VisMale数据在3种目标可见性分布设计方案的作用下,对应的体数据可视化结果.此外,亦提供了目标可见性定义接口,用户可以根据需求制定目标可见性设计方案,方便、快速地集成于当前传输函数设计流程中,进一步增强了本文算法的实用性和可拓展性.大增加,无法满足领域专家的实时应用需求.为了快速实现光学参数优化设计,提升体数据可视化效率,在文献[16]的启发下,本文引入近似方法快速求解能量方程的梯度E(犃).计算能量方程E(犃)对于不透明度向量的偏导,如式(14)所示:E(犃)αi其中,标量值特征i属于感兴趣特征j.由式(5)可知,VH(i)表示体数据中标量值特征i对绘制结果图像的贡献,对VH(i)进行归一化,如式(15)所示:其中,Ik表示光线投射过程中,到达采样点剩余的光学能量.当不透明度αi的增量为Δα时,即αi=αi+Δα,近似地认为到达采样点剩余的光学能量变化可以忽略,即Ik≈Ik,因此,标量值特征i的可见性VH(i)可以进一步推导,如式(16)所示:VH(i)=Page8在式(16)的基础上,可进一步推导可见性对于不透明度向量的偏导,如式(17)所示:VH(i)将式(17)代入式(14),即可计算获得度量可见性能量差异的方程E(A)相对于不透明度αi的偏导数.可以看出,利用近似方法有效简化了能量方程的梯度求解,相比于原来两次特征可见性分布的统计过程,当前只需要统计一次标量值特征可见性分布,光学参数的迭代优化过程简化,提升了体数据可视化效率.图4出示了3种目标特征可见性分布设计方案及光学参数优化设计对应的体数据可视化结果.其中,图4(a)出示了默认的平均设计方案获得的体绘制结果,皮肤和骨骼特征对结果图像的贡献相同;图4(b)出示了自动设计方案获得的体绘制结果,标量值较大的骨骼特征在结果图像中得以突出展示;图4(c)出示了交互设计方案的绘制结果,根据用户的特定需求,皮肤与骨骼特征对结果图像的贡献更加合理,细节信息展示得更加全面,某种程度上可以满足领域专家的应用需求.4用户交互为了更好地说明基于体数据空间相似性的传输函数优化设计方法,给出了本文算法的用户交互界面,如图5所示.用户交互界面主要由两部分组成,即绘制窗口和操作窗口.其中,绘制窗口的设计风格模仿了当前流行的视频播放器交互操作,特征选择控制窗口中的按钮按照从左到右的次序,分别表示暂停、标量值最小特征、前一特征、开始、后一特征、标量值最大特征.基于空间相似性对体数据进行分类后,利用上述操作按照标量值大小对体数据特征进行按序可视化,当出现用户感兴趣特征时,双击鼠标选择,即列为用户感兴趣特征.操作窗口由3个子窗口组成,特征列表窗口展示基于空间相似性对体数据进行分类获得的所有特征,特征前的标记表明是否属于感兴趣特征;参数设计窗口包含了为用户提供的交互接口,例如空间相似性阈值的定义接口、特征的光学属性显式定义接口及绘制方法选择接口,“Optimize”按钮是本文所提的光学参数优化设计接口;目标可见性设计窗口,初始情况下为用户提供平均设计方案,用户可以交互地拖动柱状图,根据需求定义目标可见性分布,也可以选择“Autovisibility”,利用自动设计方案定义可见性分布.根据目标可见性与当前可见性分布的差异,后台程序可以迭代优化光学参数设计过程,实现高效的传输函数设计.5实验结果为了验证本文提出的传输函数设计方法的高效性和可行性,对不同传感器获得的真实采样数据、模拟数据等采用本文方法进行可视化与分析,且根据用户的反馈信息进一步验证算法的有效性,并对本文算法的不足之处进行了讨论.5.1实验结果图6出示了模拟的Ncat_phantom数据采用本文提供的传输函数设计方案所获得的体数据可视化结果.基于空间相似性对初始体数据做一维特征空间分析,用户在浏览不同分类特征的同时,交互选取感兴趣特征,如图6(a)心脏器官[46~46](注:背景特征亦为利用空间相似性方法分类获得的骨骼边界特征[13~45],以下同),图6(b)是肝脏特征[62~62],图6(c)是肺部器官[93~93],图6(d)是脾脏器官[140~140].用户在选择感兴趣特征之后,利用不同目标可见性分布设计方案(如图6(h)所示)确定不同特征对结果图像的贡献,进而以能量方程度量当前可见性分布与目标可见性分布的差异,迭代优化光学参数设计,获得对应的体数据可视化结果.图6(e)展示了目标可见性平均设计方案对应的可视化结果,感兴趣特征及背景特征对结果图像的贡献相同;图6(f)展示了目标可见性自动设计方案对应的可视化结果,标量值相对较大、单位标量值区间体素数目相对较多的肺部器官和脾脏器官得以突出显示;图6(g)展示了目标可见性交互设计方案对应的可视化结果,用户有意增强了心脏器官对结果图像的贡献比例,因而心脏特征在绘制结果中得以有效展示,且细节特征表现丰富,可以有效满足用户对数据做进一步可视化及分析的需求.Page9图6针对Ncat_phantom数据特征空间分析及不同目标可见性设计方案对应的体数据可视化结果在没有先验知识的情况下,经典的传输函数设计方法难以快速辨识感兴趣特征区间,如图6所示的体内不同器官特征,进而定义满足用户需求的光学参数,反复试错的曲线设置过程制约了体数据可视化效率的提升.而本文算法利用空间相似性自适应地实现特征空间分析,并提供交互展示界面,帮助用户快速确定感兴趣特征;在光学参数设计阶段,提供便捷的目标可见性设计方案,定义能量方程度量可见性分布差异,且近似的梯度计算方法可以加速光学参数迭代优化方程,进一步提升了体数据可视化及分析效率.图7针对Head数据特征空间分析及对应的体数据可视化结果图7出示了针对CT采样Head数据利用本文提供的传输函数设计方案所获得的体数据可视化结果.在相似性度量标准作用下,一维传输函数特征空间自适应划分为若干区间,用户交互选择感兴趣特征,如图7(a)皮肤特征[78~86],图7(b)骨骼边界特征[95~146],图7(c)骨骼特征[167~187].在不同目标可见性分布设计方案的提示下,定义能量方程度量可见性分布差异,采用近似的方法估算能量方程梯度,进而快速实现光学参数迭代优化设计,如图7(d)展示了目标可见性平均设计方案对应的可Page10视化结果,皮肤、骨骼边界及骨骼特征对绘制结果图像贡献相同,部分感兴趣特征被隐藏;图7(e)展示了目标可见性自动设计方案对应可视化结果,标量值相对较大,单位标量值体素数目较多的骨骼特征在绘制结果图像中得以增强展示,而标量值较小的皮肤特征和单位标量值体素数目较少的骨骼边界特征对绘制结果图像的贡献较小;图7(f)展示了目标可见性交互设计方案对应可视化结果,在突出展示骨骼特征的同时,相对增加皮肤及骨骼边界特征对结果图像的贡献,丰富绘制结果图像的信息量,一定程度上满足不同领域的应用需求.图8出示了针对CT采样Tooth数据特征空间分析及不同目标可见性设计方案对应的体数据可视化结果.空间相似性度量可以有效辅助一维传输函数特征空间的自动划分,用户可以从分类特征中选取感兴趣特征,如图8(a)展示了牙髓特征[3~64],图8(b)展示了牙齿根管及边界特征[89~132],图8(c)展示了牙冠特征[175~246].进而,用户根据需求确定目标可见性分布(如图8(d)所示),迭代优化光学参数映射,获得对应的体数据可视化结果,如图8针对Tooth数据特征空间分析及不同目标可见性设计方案对应的体数据可视化结果图8(e)展示了目标可见性分布平均设计方案对应的可视化结果,牙髓、根管、牙冠等特征对结果图像的贡献相同;图8(f)展示了目标可见性分布自动设计方案对应的可视化结果,标量值较小、单位标量值体素数目较少的牙髓特征对结果图像的贡献较小,细节特征缺失;图8(g)和图8(h)分别出示了目标可见性分布交互设计方案对应的不同可视化结果,牙髓特征和牙冠特征不同程度的突出显示,体现了本文算法的灵活性.5.2效率对比实现本文算法的主要计算机配置包括:CPU的型号为Intel(R)Core(TM)2QuadCPUQ9550@2.83GHz;GPU的型号为NVIDIAGeForceGTX470;内存为4GB;编程环境为Windows7操作系统下的VisualStudioC++2008.表1出示了本文算法在上述配置环境下体数据可视化的过程及效率对比.其中,包括利用空间相似性度量标准对体数据进行特征空间分析所消耗的时间、特征空间划分区间数目、用户交互选取感兴趣特征数目、利用传统的最速梯度下降法迭代优化的时Page11间消耗以及近似迭代优化的时间消耗.可以看出,基于空间相似性的特征空间分析过程花费的时间与体数据大小有关,随着体数据规模的变大,特征空间分析的时间复杂度亦随之增加.然而,特征空间分析过程可以在预计算中实现,且分类结果可以保存,对同表1不同体数据利用本文算法进行可视化分析的过程及效率对比体数据VisMaleNcat_phantomHeadToothEngine5.3用户反馈本文提供了一种高效的传输函数设计方法,利用空间相似性度量标准实现一维特征空间自适应划分,进而定义目标可见性分布,以实现光学参数自动优化设计.然而,算法流程仍需用户提供大量的先验知识及交互操作,以获得满足应用需求的体数据可视化结果.为了进一步验证本文算法的高效性与实用性,设计了一个用户反馈实验.其中,用户群体是由17位学生构成,其中计算机专业11位,医学专业6位.实验之前,为用户群体提供专业的体数据可视化传输函数设计指导,详细介绍传统的一维传输函数、二维传输函数以及本文算法的设计原理,并保证用户群体具备传输函数设计的知识和基本实践能力.开始实验,用户群体对相同体数据采用不同传输函数设计方案进行可视化与分析,直至获得满意的可视化结果为止,记录传输函数设计时间.最后,统计针对不同体数据,用户群体利用不同传输函数设计方案完成可视化的平均时间,结果如图9所示.图9传输函数设计方案完成可视化的平均时间统计可以看出,相比传统的交互试错的传输函数设计方案,本文算法可以在用户简单的交互作用下,快速地实现感兴趣特征的可视化,可视化效率明显提升,具有较强的实用性.5.4不足之处相比于传统的传输函数设计方法,本文算法自类数据可以重用,一定程度上节约了计算成本.相比于传统的最速梯度下降法,近似的能量方程梯度计算方法,可以简化特征可见性分布的统计过程,实现高效的光学参数迭代优化,进一步提升了体数据可视化及分析效率,增强本文算法的实用性.特征/个212530237动化特征空间分析过程,自适应实现光学参数优化设计,提升了体数据可视化及分析效率.但是,仍然存在如下3点不足:(1)一维特征空间分析难以辨识具有相同或相近标量值属性的不同特征,对于标量值范围显著不同的皮肤、肌肉、骨骼等特征,分类过程自动效果较好,而在对标量值界限模糊的不同特征进行分类的过程中,则表现出一定的局限性,如图8(a)出示的牙髓和噪音特征等.可以进一步结合体数据空间位置信息,结合区域增长、机器学习等技术,实现感兴趣特征准确分析;(2)相比于经典的最速梯度下降法,本文近似的能量梯度计算方式能够加速光学参数迭代优化,但是光学参数设计过程的时间复杂度仍然与初始体数据大小、感兴趣特征数目等因素密切相关,不能完全达到实时性应用标准.然而,较小的时间消耗即可获得满足用户预期的结果图像,对提升体数据可视化及分析效率具有较大的意义;(3)本文算法以高效传输函数设计为目标,有效地结合了空间相似性的特征空间分析及光学参数优化设计过程,提升了体数据可视化与分析效率,但是传输函数设计过程仍然需要大量的用户交互,一定程度上亦增加了可视化过程的不确定性.可进一步与领域专家密切合作,将先验知识集成于现有的传输函数设计流程中,尽量减少用户的交互操作,以进一步增强本文算法的实用性.6总结与展望本文以高效传输函数设计为研究目标,在传统方法的启发下,将空间相似性引入一维特征空间分析过程,实现体数据特征的自动分类;在光学参数设计过程中,根据用户需求选择目标可见性分布设计方案,定义能量方程度量当前目标可见性分布与目标可见性分布的差异;在迭代求解最小化能量方程Page12的光学参数向量过程中,引入近似的能量梯度计算方式,有效简化了感兴趣特征光学参数的优化设计过程.相比于传统的传输函数设计方法,本文算法有效耦合了特征空间分析及光学参数映射过程,为用户提供了高效的体数据可视化及分析方案,大量的实验结果、效率对比及用户反馈信息亦验证了本文算法的高效性和可行性.未来的工作将重点研究相对准确的特征空间分析方法,在保证特征分析效率的同时,兼顾特征分类精度;将研究更加高效的光学参数优化设计方法,以满足实时应用需求;将与领域专家开展更为有效、深入的合作,将先验知识形式化描述,集成于当前高效传输函数设计流程中,以进一步提升体数据可视化及分析效率.
