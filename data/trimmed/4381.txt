Page1用单幅图像生成书法碑刻及牌匾效果张婷1)章立亮1),2)于金辉1)1)(浙江大学CAD&CG国家重点实验室杭州310027)2)(宁德师范学院计算机与信息工程系福建宁德352100)摘要提出一个高效的从单幅二维书法图像生成三维碑刻或牌匾的算法.首先在输入书法作品图像中检测出书法文字区域,然后在这些区域计算二维欧式距离场.根据事先定义的书法文字雕刻模式(阴刻、阳刻、阴阳刻)调制距离场获得三维文字表面初始估计,对宽大牌匾字还可进一步调整距离场函数进行表面估计.接着采用高斯模糊光滑文字表面,最后叠加上背景区域高度和高频细节信息,生成三维书法碑刻或牌匾的高度图.文中的算法能够快速生成高质量的三维书法碑刻以及牌匾效果,作者用行书、隶书、草书、篆字等书法作品进行实验,效果令人满意.关键词建模;距离场;书法;碑刻;牌匾1引言书法是文字书写的一种法则.它按照文字特点Page2碑刻则是书法与雕刻相结合的产物.它把书法文字雕刻在石头上,从而可以比纸张更加长久地保存书法作品,也可以在露天环境下置放.典型的例子包括房山石经、西安碑林以及众多的碑铭志等.但由于介质和工具的改变,碑刻在力图保持书法文字艺术特征的同时,也糅合了雕刻艺术特征,即把笔画刻成有深度变化的且向内凹的立体线条(称阴刻),从而形成一种新的艺术形式.图1(a)为清代画家郑板桥所书“难得糊涂”的碑刻照片.与碑刻非常类似的牌匾(图1(c)),除了采用碑刻里的阴刻外,还可以采用把文字笔画刻成凸起的阳刻以及文字剖面呈W状的阴阳刻法,从而形成更加复杂的立体文字表面,因而具有极高的审美价值.这种方法广泛地应用于宫殿、牌坊、寺庙、商号、民宅等建筑的显赫位置,用来向人们传达皇权、文化、人物、信仰、商业等信息.从图1的碑刻照片可以看出,尽管清代不算久远,但碑刻受到潮湿、风化、灰尘以及石材本身质地等因素的影响,在碑刻表面造成剥落以及文字模糊.此外,在强外力作用下碑刻还可能发生纹裂以及严重损毁.我国在古代就用宣纸在碑刻上拓印(图1(b)),一方面可以增加保存书法作品的媒介种类,另一方面拓印在古代也起到类似印刷的作用,可对同一件碑刻作品多次拓印得到多份拓片,然后携带到其他地方供更多人欣赏.但拓片只记录了碑刻的书法文字形状,碑刻上文字因雕刻留下的深度信息则丧失掉.如果我们能用拓片图像生成其碑刻效果,不仅可以清晰地再现碑刻上的文字信息,同时又能克服拓片的缺点,表现出碑刻文字的深度变化.生成的虚拟3D碑刻模型可以直接用在数字图书馆、数字博物馆等地,对传统文化保护有重要意义.对于牌匾而言,我们可以将书写在纸张上的文字信息自动生成牌匾文字的深度图,包括阴刻、阳刻以及阴阳刻的多种效果供用户选择,然后用数字雕刻机加工牌匾.这与手工雕刻牌匾相比可大大提高牌匾制作效率,降低制作成本.2相关工作自1986年Strassman等人[1]提出计算机毛笔模型之后,国内外有不少研究人员开展虚拟书法研究并提出很多种计算机书法模型算法,但是这些方法不能用来生成三维书法碑刻及牌匾效果.因为碑刻与牌匾在广义上属于浮雕,受篇幅限制.我们在此不能回顾计算机书法研究工作,而主要回顾计算机生成浮雕的研究工作.用计算机方法生成浮雕的研究最早可追溯到1997年,浮雕的生成方法包括把三维模型转换成浮雕效果以及从单幅图像三维重建两大类.第一类大多采用对三维模型空间压缩来生成浮雕的技术,文献[2]给出了由三维模型自动生成浮雕效果的基本方法,在文献[3-5]中将高动态范围图像压缩算法推广到浮雕生成系统,并且允许对三维物体的细节和非细节部位采取不同的相对压缩率.特征敏感的方法[6]在它们的基础上对梯度域进行操作,加强了细节的表现能力.但是,这些方法不能从单幅书法图像生成对应的三维浮雕效果.第二类技术,即从单幅图像进行三维重建,在本质上是个病态问题,因而需要借助其他知识才有可能实现.如利用纹理重建形状技术[7-10],从单张图像上物体表面的重复纹理单元恢复出物体的深度及法向等信息,创建出三维几何模型.文献[11-13]结合物体的几何约束信息重建三维物体.王松等人[14]提出了用多项式先验高度函数从单幅拓片图像恢复出汉画像浮雕效果.Li等人[15]在王松等人[14]的工作基础上进一步提出了估计汉画像物体内部高度特征的方法,将其与物体轮廓一起作为约束,再进行拉普拉斯网格变形得到汉画像浮雕效果.近几年有少数研究人员开展了计算机生成牌匾Page3的研究.徐玉霞[16]研究了根据用户提交的牌匾内容,从书法家字库选取内容符合且风格一致的书法字,自动生成书法牌匾.鲁伟明等人[17]首先提取书法字特征,并用于表达书法字风格,采用风格一致性模型获得牌匾的候选集,最后用对等反馈传递来调整书法字的风格相似度.上述工作都是在二维空间上进行,并未涉及如何生成牌匾文字的深度.图2书法三维浮雕/牌匾效果生成系统框图3书法文字区域检测书法作品一般是用墨书写在宣纸上,其图像是白纸黑字,而碑刻拓片则是把宣纸铺到碑刻表面,再用墨包拓印.因为碑刻上的书法文字是阴刻,所以拓包只能接触到碑刻表面,结果在拓片上留下黑色背景,白色文字.无论输入图像是白纸黑字的书法作品,还是黑底白字的碑刻拓片,我们都需要检测书法文字的所在区域.用I代表输入书法图像,我们应用Snake算法[18]将I分割成K个不连续区域,此时I可由K-1个笔画区域SRi(这里的笔画区域实际上是由单个孤立笔画或者有交叉的多个笔画组成的连通区域)和背景区域BR表示.笔画区域SRi内的所有点赋值为0,BR内的点赋值为1.SRi的边缘点为SDi(p),这里p表示边缘上的一点.4书法文字表面高度估计获得书法笔画区域SRi后,我们要在SRi区域内估计碑刻和牌匾的笔画深度变化.由于碑刻和牌匾在使用材料上的不同,刻字的模式也不同.碑刻的材料主要是石头,所以只能在石碑表面阴刻,而牌匾材料主要是木头,除了阴刻之外可以采用阳刻以及阴阳刻等多种刻字模式.观察现有的书法碑刻及牌匾作品可以发现,不管用哪种刻字模式,其上面的书法字都是从文字笔画边缘开始向内部伴随深度变化,因此我们采用距离场作为基本函数,对每个笔画区域SRi,计算其内本文提出一个从单幅书法图像生成书法碑刻及书法牌匾的方法,其系统结构如图2所示.首先输入单幅石碑拓片或书法图像,检测出书法字区域,用文字雕刻模式(阴刻、阳刻和阴阳刻)调制距离场函数得到文字高度的初始估计,再用高斯滤波平滑文字表面,最后进行映射纹理得到虚拟3D碑刻或牌匾的输出结果.部每一点P到SDi(p)的最短欧式距离,然后再进一步按照刻字模式调制P点高度.4.1距离变换距离变换的概念由Rosenfeld和Pfaltz[19]于1966年首次提出,随后Danielsson[20]进一步提出了二维欧氏距离映射.设一个M×N的二值图像可以表示成一个二维数组I[M,N]=[ax,y],其中,ax,y=1的像素对应非特征点,ax,y=0的像素对应特征点,令P={(x,y)|ax,y=1}为非特征点集合,P={(x,y)|ax,y=0}为特征点集合,则欧氏距离映射就是对P中所有像素(x,y)求:dx,y=min{D[(x,y),(x,y)],(x,y)∈P,(x,y)∈P}其中,D[(x,y),(x,y)]=(x-x)2+(y-y)目前已有多种距离变换(DTS)算法,根据所用的距离测度主要分为两类:非欧式距离变换和欧式距离变换(EDT).前者包括斜切(Chamfer)、城市街区(City-block)距离等.欧式距离变换精度高,但是其算法复杂度也高,从计算精度和速度两方面考虑,我们采用Borgefors[21]总结的Chamfer算法近似计算dx,y.4.2文字高度模式我们在系统中定义了三种文字雕刻模式:阴刻、阳刻和阴阳刻.这三种模式实际上对应了文字高度的变化方式,我们用HM表示文字高度模式,并把式(2)的距离引进得到其中m代表模式指数,1为阴刻,2为阳刻,3为阴阳刻.u=dx,y/dmax,dmax为dx,y((x,y)∈P)集合中的最大值.hmax为用户定义的文字最大高度,且hmax>0.Page4一般而言,一件牌匾作品上书法字的数量要比一件碑刻作品上的书法字数量少很多,因此牌匾上刻出来的字体笔画宽阔,中间平坦,如图3和图1(c)所示.直接用式(4)中定义的文字高度无法生成牌匾中间平坦的雕刻文字效果,为此我们对式(4)进行修正如下:HM(m=1,u)=-uHM(m=2,u)=HM(m=3,u)=其中u1<1是用户指定的对应笔画高度变化的过渡宽度系数,一般取值范围在0.1左右(即笔画宽度的1/10).图4给出式(5)定义的文字高度模式示意图.为了显示清楚,我们特意将u1对应的过渡段画宽一些.4.3文字表面模糊处理用式(4)或式(5)对SRi内进行距离变换后,我们得到带有文字深度信息的初始估计灰度图GE.图5(a)给出一个书法字“象”的阳刻灰度图.图5(b)给出它对应的表面阴影绘制效果,从中可见文字表面高度从笔画边缘到内部近似线性变化,而碑刻和牌匾中的文字表面近似弧形变化.又因为二维距离变换是以像素为单位进行计算的,从而导致文字表面有锯齿效应.为了解决上述问题,我们对灰度图GE进行高斯模糊,高斯模糊的核取dmax.针对高斯模糊导致的笔画边缘与背景之间的模糊扩散问题,我们用式(1)表示的分割区域图作为二值模板,再和高斯滤波后的图像做乘积运算,得到笔画边缘锐利的刻字效果,如图5(c)所示.5刻字表面高度处理式(4)和式(5)仅定义了文字笔画表面高度,在碑刻和牌匾中除了雕刻的立体笔画外还有一个表平面,我们称为刻字表面L,设其高度为LH.这个L是包含文字区域和背景区域的整个表面.我们还需要确定L在不同雕刻模式下的刻字表面高度LH.在式(1)中去除雕刻笔画区域SRi后就是背景区域BR,令背景平面的绝对高度为BH.假设雕刻前介质表面的初始高度为Hinit,则阳刻模式下,BH的高度要低于Hinit.我们首先确定不同雕刻模式下的BH.BH=从式(4)和式(5)可见HM(m,u)在m=2时取值大于0,m=1或3时取值小于0.又因为阴刻和阴阳刻的文字高度均低于BH,而阳刻的文字高度均高于BH,则有LH=BH+HM(m,u),m=1或3时,BH>hmaxPage5图6为牌匾中三种文字雕刻方式下刻字表面高度示意图.我们将其归一化得到虚拟碑刻或牌匾的低频高度图GL.6最终高度估计在碑刻或者牌匾上除了书法字外有时还有其他细节,比如图1(a)中“难得糊涂”下面的小字以及印章.由于这些小字的雕刻深度浅,我们直接把输入图像的灰度作为这些细节的高度估计GH,然后与上述得到的低频高度图GL叠加,得到最终的碑刻或牌面高度图GF:这里α为混合因子,α取值越大,对应的碑刻或牌匾的细节部分高度也越大,反之则细节部分平滑.图7展示了取不同的α生成的阴刻效果(浮雕在不同光照条件下在视觉上有时会产生二义,即凹陷的可能会感觉突起,或者反之,本图对应的斜视图在图10中给出),通常取α=0.05~0.2可以得到比较满意的结果.本系统允许用户根据自己需要调整书法碑刻或牌匾文字起伏的绝对高度hmax,图8展示了随hmax值递增生成的“象”字阳刻效果.7实验结果与讨论我们的系统用Matlab7.11实现,运行平台为Pentium2.8GHzCPU和4GB内存的PC机.首先我们把本文方法和Li的方法[15]进行比较.图9为Page6式(4)生成的阳刻结果,图10为式(5)生成的阳刻结果.通过观察可以发现,Li的算法所得的阳刻文字表面有很多局部突起(图9(a))和毛刺(图10(a)),而本文方法得到的阳刻文字表面比较平滑.接下来我们用不同字体书法图像作为输入生成图12隶书图13草书碑刻及牌匾效果,包括行书、隶书、草书、篆刻以及牌匾图像.图11展示了对应图7“难得糊涂”碑刻效果的斜视图.为了增强碑刻质感,我们将石头纹理映射到碑刻表面上.图12~图15的输入图像分别为隶书(淡泊明志宁静致远)、草书、篆书以及牌匾(大象无形)生成的碑刻或者牌匾效果.我们用不同的油漆色绘制背景和文字表面.Page7图14篆书图15牌匾表1列出了每幅输入图像的大小、边界点个数、边界检测、低频和高频估计所花费的时间,从表中可以发现处理时间长短与输入图像中书法笔画区域边界点个数有密切关系.在低频估计一项中斜杠符号“/”后面对应的是用Li的方法[15]估计低频所需时间(在Li的方法中其余项所需时间与本方法相同).由于在我们方法中避免了Li方法中的解高阶矩阵求解,所以比Li的方法快40~50倍.图片名称行书754×47859635.10.75/40.50.125隶书460×27628572.50.45/31.40.030草书800×40275284.30.89/47.40.062篆刻800×580116005.21.28/68.30.063牌匾800×5661592910.62.33/99.70.0708结论本文提出一个基于单幅书法拓片或书法图像生成相应三维碑刻或者牌匾效果的方法.它能克服Li方法[15]的书法字表面不光滑以及边缘毛刺等缺点,生成速度也大大加快,对于行书、隶书、草书以及篆刻都能得到满意结果.在广义上从单幅图像恢复物体高度为病态问题,故本文提出的方法目前仅适用书法作品中文字的三维表面生成.在未来的工作中我们打算将其推广到其他种类物体形状的高度重建.
