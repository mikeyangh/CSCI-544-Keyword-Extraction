Page1网格安全互操作及其应用研究邹德清1)邹永强2)羌卫中1)金海1)覃安2)王凯1)1)(华中科技大学计算机科学与技术学院服务计算技术与系统教育部重点实验室暨集群与网格计算湖北省重点实验室武汉430074)2)(中国科学院计算技术研究所北京100190)摘要网格计算为地理分布资源的聚合以及大规模计算问题的解决提供了技术途径,国内外大型网格项目都是基于某种网格平台构建,通过这些平台管理着本领域的资源/服务,为了聚合不同网格平台管理的资源/服务,需要实现异构网格平台的互操作.由于不同网格平台的安全机制不同,安全互操作是网格互操作中需要解决的一个关键问题.通过分析,当前网格平台通常具有网格全局用户身份以及虚拟组织层次结构的公共特征,基于网格平台的主体类型研究网格平台互操作映射策略,并提出一种通用的安全互操作流程.CGSP和GOS是国内两大知名的网格中间件,分别管理了大量的教育和科技资源,以CGSP和GOS的安全互操作为例,阐述了安全互操作策略映射机制及安全互操作流程的具体实现,并分析了网格平台间的授权及其一致性、映射策略的灵活性以及互操作流程的安全性.最后,对CGSP和GOS的安全互操作的性能进行了测试分析.关键词网格;安全互操作;映射策略;网格证书1引言网格计算为地理分布资源的聚合以及大规模计算问题的解决提供了技术途径,当前国际上知名的网格中间件有Globus[1-2]、gLite①、ARC[3]、UNICORE②、GPE③等.虽然开放式网格服务架构OGSA和Web服务资源框架WSRF作为网格标准而提出,但由于OGSA和WSRF本身的不成熟性,众多网格平台并没有严格遵循这两个规范,导致了网格平台之间很难互相访问,而且,网格项目都有一定的应用背景,传统网格平台的技术实现很大程度上都是为了满足某种或某类应用的需求.网格平台之间很难互访的现状是实现更广范围内资源共享需要突破的瓶颈.网格互操作能集成不同异构网格平台下的资源和服务,从而极大扩展了单一网格平台的能力,各种网格中间件通常都包含网格安全、信息服务、资源管理与调度、数据管理等基本模块,网格互操作需要考虑不同平台下同一类型模块的互操作,网格安全互操作是其中一个关键方面,虽然大多数网格系统都采用基于PKI的认证方式,但其认证实现的细节以及授权等安全机制各不相同.安全互操作是网格用户跨异构平台访问资源和服务的基础,并且屏蔽异构平台安全机制的差异.近年来,互操作成为了网格计算领域的研究热点,Web服务相关的协议和规范逐步在网格互操作中发挥了作用,其中安全相关的协议和规范包括以WS-Security为基础的安全协议族、安全性断言标记语言(SAML)、可扩展访问控制标记语言(XACML)等.网格资源互操作项目GRIP,受欧盟资助,用于实现UNICORE和Globus之间的互操作.网格编程环境GPE和OMII-Europe项目是另外两个网格互操作项目,上述项目安全互操作的实现是通过在不同网格平台的CA证书之间建立信任关系,这是一种粗粒度的、基于认证级别的互操作.VOMS(VirtualOrganizationManagemenetService)[4]是一种网格应用领域普遍使用的基于属性证书(AttributeCertificate)的网格授权系统.VOMS项目组依托OMII-Europe进一步实现了基于SAML的属性权威(AttributeAuthority)Web服务,使用SAML断言取代传统的VOMS系统中的属性证书,以达到属性签发的互操作性.ARC网格中间件实现了与两个不同版本VOMS(基于属性证书和基于SAML断言)服务的互操作,并可以通过插件的方式解析和使用VOMS属性;ARC还通过在中间件层次整合SAML2WebSSOProfile,利用ShibbolethIDP(身份标示提供者)等实现多种方式的身份认证,避免了网格身份认证中需要申请X.509证书的局限;另外,ARC还通过对XACML的支持完成安全策略的互操作性.以上实现均基于全局属性管理的前提,不能很好地解决跨域安全策略管理以及安全互操作问题.GPE4CGSP项目旨在实现GPE和CGSP之间的互操作,提出了一系列标准的安全插件接口,如代理插件、令牌插件、证书插件、映射策略插件等,但这些接口的实现需要由网格开发者完成.全球网格论坛GGF于2005年提出了网格互操作计划GIN④,GIN分为不同方向,其中GIN-aup是针对异构网格平台的授权与身份管理的互操作.但GIN-aup目前还仅停留在技术交流层面.虚拟组织是网格的基本表现形式,各种网格平台都是基于虚拟组织来组织资源和提供服务的.例如,中国教育科研网格计划ChinaGrid[5]和中国国家网格CNGrid[6]是国内著名的两大网格项目,CGSP⑤[7]作为ChinaGrid支撑平台,基于域的方式管理资源和服务,遵循OGSA和WSRF规范.CGSP的域可以看作一个相对静态的虚拟组织.GOS[8-9]作为CNGrid的网格中间件,其所有组件形成3个层次:核心层、系统层和应用层.核心层有两个重要概念:社区(agora)和网程(grip).GOS遵循Web服务规范,通过社区组织和管理虚拟化的资源/服务.GOS中的社区是一个相对动态的虚拟组织.虚拟组织中有不同类型的主体,如组、角色和用户,本文通过在不同网格平台的虚拟组织主体之间建立映射关系,能够有效地在认证和授权级别提供灵活的安全互操作映射策略.结合SAML协议,提出一种通用的安全互操作流程.以CGSP和GOS的安全互操作为例,阐述了该映射策略和互操作流程的具体实现,本文第2节介绍网格安全互操作的映射策略和互操作流程;第3节介绍CGSP和GOS之①②③④⑤Page3间的映射策略和安全互操作过程;第4节对安全策略的一致性和灵活性、互操作过程的安全性以及安全互操作的性能进行了分析;第5节对本文进行了总结,并展望了未来工作.2网格安全互操作机制本节将在分析当前网格平台的安全特征基础上,提出一种通用的安全互操作映射策略和安全互操作流程.2.1网格安全互操作映射策略由于公共密钥框架PKI在当前认证领域的权威地位,当前流行的网格平台基本上都采用PKI构建其全局的认证体系,X.509证书通常作为网格用户的全局证书.对于应用于某种应用领域的网格系统而言,由安全中心签署的属性断言也起到了网格用户全局证书的作用,如ShibGrid[10].虚拟组织在不同的网格系统中表现不一样,有的相对静态,具有较明显的地域或组织特性,如CGSP;有的相对动态,如群组或社区,如GOS和CROWN.通常虚拟组织采用一种层次结构进行组织,虚拟组织中包含下级虚拟组织,有的网格平台的虚拟组织只具有单层次结构,有的网格平台的虚拟组织则具有多层次结构,层次的多少甚至是可变的,如VOMS.本文基于网格用户全局身份以及虚拟组织层次结构的网格平台公共特征,基于网格平台的主体类型来研究网格平台互操作映射策略.在描述映射策略之前,先给出如下符号定义:(1)U,U分别表示两个网格系统中具有全局身份的用户集合,其中,U={U1,U2,…,Uk},U={U1,U2,…,Un};(2)VO表示网格系统中的虚拟组织,为了区分两个网格系统的虚拟组织,其中一个表示为VO,另一个表示为VO.一个网格系统中的不同虚拟组织可通过下标进行区分,如VO1表示编号为1的虚拟组织.一个虚拟组织包含一个或多个主体,主体可表示为S,主体可以是角色、用户或组,如VO1.r表示虚拟组织VO1中的角色r,通常主体拥有虚拟组织中部分资源的访问权限.对于层次性的虚拟组织而言,虚拟组织包含下级虚拟组织,如VO1.VOi表示虚拟组织VO1的下级虚拟组织VOi.对于参与互操作的任一网格平台而言,我们给出如下4种类型的映射策略的定义,包括(1)全局身份-全局身份映射,可表示为U-U,即一个网格平台的全局用户身份具有另一个网格平台的全局用户身份在其所在平台上的资源访问权限;(2)全局身份-虚拟组织主体映射,可表示为U-VO.S,即一个网格平台的全局用户身份具有另一个网格平台的某虚拟组织主体在其所在平台上的资源访问权限.另外,在多层次的虚拟组织中,一个网格平台的全局身份可映射到另一个网格平台的某层虚拟组织的一个主体,为方便起见,下面的映射策略中的虚拟组织主体也可以是某层虚拟组织主体,不再赘述;(3)虚拟组织主体-全局身份映射,可表示为VO.S-U,即一个网格平台中获得某虚拟组织主体身份的用户具有另一个网格平台的全局用户身份在其所在平台上的资源访问权限;(4)虚拟组织主体-虚拟组织主体映射,可表示为VO.S-VO.S,即一个网格平台中获得某虚拟组织主体身份的用户具有另一个网格平台的某虚拟组织主体在其所在平台上的资源访问权限.2.2网格安全互操作流程SAML由标准化组织OASIS安全服务技术委员会提出,它是一种基于XML的框架,用于用户身份、权限、属性信息的交互,它包括两个关键组件:标识提供者IDP(IDentityProvider)和服务提供者SP(ServiceProvider).IDP作为认证中心和授权中心,SP用于校验用户的身份和属性.采用SAML实现网格安全互操作具有通用性.为简单起见,假设两个网格平台,Grid1和Grid2,各具有一个IDP的情形,分别表示为IDP1和IDP2.在介绍安全互操作流程之前,给出安全互操作的必要功能要求:(1)一个网格中的IDP为其平台下的全局用户签发属性断言,该属性断言反映了该用户在本平台下对应的虚拟组织主体集合.一个网格中的IDP也签发映射策略的属性断言,反映了另一个网格中的全局用户/虚拟组织主体在本平台中的映射关系;(2)两个平台的认证中心CA1与CA2具有相互信任关系,即一个CA签发的用户证书能被另一个CA所承认.在描述安全互操作流程之前,先给出如下的符号定义:(1)X->Y表示X发送消息给Y;(2)SX(REQ)表示数据REQ由SX签名;(3)CredX->Y表示Y的身份证书由X签署;(4)M1和M2分别表示Grid1和Grid2中的映Page4射策略集合;(5)ATTR(X)表示一个网格平台的全局用户下面对Grid1中的一个全局用户Ui访问Grid2X的属性集.中的资源/服务的安全互操作流程进行介绍.1.Ui->IDP1,REQ(ATTR(Ui)),SUi(REQ(ATTR(Ui))),CredCA1->Ui.用户Ui向本平台的标识提供者IDP1发送获取用户Ui属性的请求REQ(ATTR(Ui))、该请求的签名以及由CA1签发的用户Ui信任状.2.IDP1->Ui,ATTR(Ui),SIDP1(ATTR(Ui)),CredCA1->IDP1.标识提供者IDP1校验用户Ui的身份后,响应该用户的请求,返回用户Ui属性ATTR(Ui).3.Ui->IDP2:REQ-MAPPING-POLICY,SUi(REQ-MAPPING-POLICY),ATTR(Ui),SUi(ATTR(Ui)),CredCA1->Ui.用户Ui向另一个平台的标识提供者IDP2发送策略映射请求REQ-MAPPING-POLICY,该请求由用户Ui签名,同时用户Ui把自己的属性集和属性签名以及由CA1签发的信任状发给标识提供者IDP2.4.IDP2->Ui:M2[Ui],SIDP2(M2[Ui]),CredCA2->IDP2.另一网格平台的标识提供者IDP2验证用户身份后,根据用户Ui的属性集返回给该用户相关的映射策略集M2[Ui]和该映射策略集的签名,同时IDP2也把自身的信任状发给用户Ui,若M2[Ui]为空,表示用户Ui在另一平台中没有映射关系,互操作流程终止.5.Ui->SPm:REQ-S,SUi(REQ-S),M2[Ui],SIDP2(M2[Ui]),CredCA1->Ui.若M2[Ui]不为空,用户Ui向另一网格平台中的服务提供者SPm发送服务请求REQ-S及其签名、IDP2签署的与用户Ui相关的映射策略及其签名以及用户Ui信任状.6.服务提供者SPm校验用户Ui的身份以及映射策略和用户属性的合法性以及完整性之后,确定用户Ui是否具有访问相应服务的权限,若有,请求被允许;否则,请求被拒绝.3CGSP和GOS的安全互操作本节将以CGSP和GOS的互操作为例,阐述网格安全互操作映射策略和互操作流程的具体应用.CGSP的安全技术是基于Globus安全框架GSI[11]开发的,而GOS的安全技术是基于Web服务安全规范以及X.509证书开发.在这一节,将分别介绍CGSP和GOS的安全机制.3.1CGSP和GOS的安全机制(1)CGSP安全机制如图1所示,CGSP安全除了包含GSI提供的安全功能,如GSI的消息和会话机制(GSI-message和GSIconversion)、身份映射(Gridmap)、代理证书(Proxycertificate)及在线代理证书库(MyProxy),另外还提供了如下新的安全功能:①加解密以及文件许可,用于数据和文件加密、SOAP消息加密以及文件的访问控制;②安全令牌中心(SecurityTokenCenter),用于为进入网格系统的用户产生基于SAML格式的令牌;③安全上下文服务,用于解析用户令牌,为部署到ChinaGrid平台上的服务生成安全上下文,网格用户能够使用服务包装工具通过CGSP的门户定制服务的安全上下文;④安全资源属性,是安全上下文服务的扩展,一个CGSP服务能够动态构造它的安全上下文,并通过安全资源属性大纲(Schema)以及它的安全上下文来断言用户令牌;⑤面向域(Domain)的访问控制,用于控制一个域内的资源/服务的访问,网格用户在通过身份认证之后,都映射到域的用户或角色才能使用该域内的服务.(2)GOS安全机制GOS的安全机制是遵循WS-Security标准开发的.GOS著重提供CA中心、认证、授权、访问控制机制,通过消息完整性保护结合传输层安全机制(TLS)保证SOAP消息通信的安全性,提供基于日志的审计功能.它的主要技术特色包括:①安全机制与用户、服务实现隔离.在GOS平台中,安全机制的实现包括从用户登录到服务资源的执行,安全技术细节对用户/开发者是屏蔽的,如图2所示,一个网格用户通过他的终端用户证书(uCert)登录门户,并在GOS的网程容器的控制下访问物理资源.GOS中多种安全机制由Handler链实施,可以在部署时进行灵活的配置,与服务开发过程无关.Page5图2GOS安全架构②基于证书或用户名密码的认证.在GOS系统中,有两种证书,一种是终端用户证书,一种是代理证书(pCert).代理证书是临时的,被创建来代表终端用户证书.当用户通过用户证书登录,登录过程网程容器会请求社区认证用户,认证通过后,网程容器使用其代理证书和其它服务进行双向认证.为了方便用户使用,GOS也支持通过用户名/密码进行登录.③基于社区(Agora)的多粒度授权机制.GOS中社区是作为虚拟组织的一种形式被提出和开发出来.社区是用户和资源的管理中心,也是用户和资源提供者共同信任的授权中介(授权权威,AA),资源端可以自主授权,或者将权限代理给社区.社区中的各实体是动态变化的,可以随时加入,随时退出.社区有精确定义,它包括主体、客体、上下文、策略.策略主要指授权策略.授权信息的主体分为全社区、组、用户3种粒度,授权客体分为服务、服务操作两种粒度.当一个用户想访问资源/服务时,首先由社区签发标准的SAML格式的令牌.最终授权信息在资源端实施.④提供用户可操作的SOAP消息上下文(GOSContext),其中记录社区id,证书(或代理证书)和授权令牌.服务开发人员可以操作此上下文,定制安全机制.3.2CGSP和GOS的安全映射策略CGSP资源/服务以域为单位进行组织,这种组织方式相对静态,但符合现有资源/服务的分布特征.GOS中的资源/服务以社区方式进行组织.当一个CGSP的全局用户请求CGSP平台下的资源/服务时,该用户的证书需要映射到一个域中的局部用户或角色.在一个域中,局部用户还可以分配一个或多个角色,但域中权限的分配是以角色为单位的.在GOS中,每个全局用户可以加入一个或者多个社区,且至少会加入一个社区,社区可以动态创建和删除.社区是分组的,每个全局用户可以属于一个或者多个组,且至少会属于一个组.如2.1节所述,CGSP中的域可看成一个相对静态的虚拟组织,域中的局部用户或角色可看作CGSP虚拟组织主体,GOS中的社区是一个相对动态的虚拟组织,社区组也可看作虚拟组织主体.由于CGSP平台下全局用户和域角色分别提供了跨域和域内资源访问的权限,且域用户也是以角色的身份获得资源/服务的访问权限,故只考虑CGSP中全局用户与域角色和GOS平台中全局用户与社区组的映射策略.映射策略采用“X-Y映射”形式进行描述,其中“X”表示CGSP平台下的授权单位,“Y”表示GOS平台下的授权单位,包括:(1)用户-用户映射;(2)用户-社区组映射;(3)角色-用户映射;(4)角色-社区组映射,本文所指的角色仅指CGSP平台中Page6某域中的角色.在描述映射策略之前,先给出如下符号定义:(1)U,U分别表示由ChinaGridCA签发证书的用户集合,CNGridCA签发证书的用户集合,其中,U={U1,U2,…,Uk},U={U1,U2,…,Un};(2)D,D.R,D.U,D.E分别表示CGSP平台下所有域的集合,所有域的角色集合,所有域的局部用户集合,所有域的局部身份,其中D.E=D.U∪D.R;(3)VO,VO.G分别表示GOS平台下所有社区的集合和所有社区组的集合,其中,VO={Ag1,Ag2,…}.根据上述CGSP平台和GOS平台的安全机制,给出如下定义:(1)CGSP平台内全局用户到局部身份的映射关系可表示为F:U->2D.E,例如,F(U1)={D1.r,D2.u}表示CGSP用户映射到域D1中的角色r和D2中的用户u;F的逆函数F-1:D.E->2U表示由域角色或域用户获得映射到该域角色或域用户的CGSP全局用户集.本文仅考虑域角色到CGSP全局用户的映射,即F-1:D.R->2U;(2)GOS平台内全局用户到社区组集合的映射关系可表示为F:U->2VO.G,例如,F(U1)={Ag1.g1,Ag2.g2}表示GOS用户同时加入了社区Ag1的分组g1和社区Ag2的分组g2;F的逆函数F-1:VO.G->2U表示社区组到GOS全局用户集的映射关系.针对每一种映射策略描述如下:(1)用户-用户映射,用于在CGSP用户和GOS用户之间建立一种直接映射关系,如图3(a)所示.CGSP用户拥有ChinaGridCA签署的终端用户证书,而GOS用户拥有CNGridCA签署的终端用户证书.若CGSP平台采用了用户-用户映射策略,可表示为M1:U->U,例如,GOS用户Uj被映射到CGSP用户Ui,可表示为Uj=M1(Ui).若F(Ui)={D1.ri,D2.uj},则Uj具有CGSP平台下两个局部身份D1.ri和D2.uj访问资源/服务的权限.即一个GOS用户具有其对应的CGSP证书身份访问若干个域的资源/服务的权限.若GOS平台采用了用户-用户映射策略,可表示为M1-1:U->U,例如,CGSP用户Ui被映射到GOS用户Uj,可表示为Ui=M1-1(Uj).若F(Uj)={Agi.gi,Agj.gj},则Ui具有GOS平台下两个社区Agi的分组gi和Agj的分组gj访问资源/服务的权限.即一个CGSP用户能够以对应的GOS用户身份访问若干个社区组的资源/服务.(2)用户-社区组映射,用于建立一个CGSP用户与一个GOS社区组的映射关系,如图3(b)所示.若CGSP平台采用该映射策略,可表示为M2:U->VO.G,例如,GOS中社区组Agi.gi被映射到CGSP用户Ui,可表示为Agi.gi=M2(Ui),若F-1(Agi.gi)={Ui,Uj},F(Ui)={Di.r,Dj.u},则GOS用户Ui和Uj都具有域角色Di.r和域用户Dj.u访问资源/服务的权限.即属于社区的任一GOS用户具有对应CGSP用户访问若干个域的资源/服务的权限.若GOS平台采用该映射策略,可表示为M2-1:VO.G->U,例如,CGSP平台下用户Ui被映射到一个社区组Agi.gi,可表示为Ui=M2-1(Agi.gi),CGSP用户Ui具有社区组Agi.gi访问资源/服务的权限.即一个CGSP用户具有相应社区组访问资源/服务访问的权限.(3)角色-用户映射,用于建立CGSP域中的角色与GOS用户的映射关系,如图4(a)所示.若该映射策略由CGSP平台采用,可表示为M3:D.R->U,例如,GOS用户Uj被映射到CGSP中域Di中的角色ri,可表示为Uj=M3(Di.ri),GOSPage7用户Uj具有域角色Di.ri访问资源/服务的权限.即一个GOS用户具有CGSP某域中对应角色访问资源/服务的权限.若该策略由GOS平台采用,可表示为M3-1:U->D.R.例如,CGSP中域Di中的角色ri被映射到GOS用户Uj,可表示为Di.ri=M3-1(Uj),若F-1(Di.ri)={Ui,Uj},F(U1)={Agi.gi,Agj.gi},则CGSP用户Ui和Uj都具有两个社区分组Agi.gi和Agj.gi访问资源/服务的权利.即被分配域角色的任一CGSP用户具有若干个社区分组访问资源/服务的权限.(4)角色-社区组映射,用于建立CGSP域中的角色与GOS社区组的映射关系,如图4(b)所示.若该映射策略为CGSP平台所采用,可表示为M4:D.R->VO.G,例如,GOS中社区组Agi.gi被映射到CGSP中域Di中的角色ri,可表示为Agi.gi=M3(Di.ri),若F-1(Agi.gi)={Ui,Uj},则GOS用户Ui和Uj都具有域角色Di.ri访问资源/服务的权限.即属于社区的任一GOS用户具有CGSP某域对应角色访问资源/服务的权限.若该映射策略被GOS平台采用,可表示为M4-1:VO.G->D.R,例如CGSP中域Di中的角色ri被映射到一个社区组Agi.gi,可表示为Di.ri=M4-1(Agi.gi),若F-1(Di.ri)={Ui,Uj},则CGSP用户Ui和Uj都具有社区组Agi.gi可访问的资源/服务的权利.即被分配某域的一个角色身份的任一CGSP用户具有相应社区组可访问的资源/服务访问的权利.3.3CGSP和GOS的安全互操作流程目前CGSP与GOS平台安全互操作只考虑CGSP平台与GOS平台各具有一个IDP的情形.在介绍安全互操作流程之前,给出两个平台安全互操作的必要功能要求:(1)CGSP平台中的IDP为CGSP中用户签发属性断言,该属性断言反映了CGSP用户在CGSP平台下的映射关系,如域角色.CGSP平台中的IDP也签发映射策略的属性断言,反映了GOS中的用户/社区组在CGSP中的对应关系.(2)GOS平台中的IDP为GOS中用户签发属性断言,该属性断言反映了GOS中用户加入的社区组.它也签发映射策略的属性断言,反映了CGSP中的用户或域角色在GOS中的对应关系.(3)ChinaGridCA和CNGridCA之间具有相互信任关系,即ChinaGridCA签发的用户证书能被CNGridCA所承认,CNGridCA签发的用户证书也能被ChinaGridCA所承认.除2.2节的定义外,再给出如下的符号定义:(1)M,M[U],M[VO.G],M[Ui],M[VO.G]Ui分别表示在CGSP的IDP中,所有映射策略的集合,属于用户-用户映射和角色-用户映射两种类型的映射策略集合,属于用户-社区组映射和角色-社区组映射两种类型的映射策略集合,与GOS用户Ui相关的映射策略以及M[VO.G]中与用户Ui相关的映射策略;(2)M-1,M-1[U],M-1[D.R],M-1[Ui],M-1[D.R]Ui分别表示在GOS的IDP中,所有映射策略的集合,属于用户-用户映射和用户-社区组映射两种类型的映射策略集合,属于角色-用户映射和角色-社区组映射两种类型的映射策略集合,与CGSP用户Ui相关的映射策略以及M-1[D.R]中与用户Ui相关的映射策略;下面对CPSP用户访问GOS资源/服务以及GOS访问CGSP资源/服务的安全互操作流程分别进行介绍.CGSP用户访问GOS资源/服务流程如下:1.Ui->IDPi,REQ(ATTR(Ui)),SUi(REQ(ATTR(Ui))),CredC_CA->Ui.CGSP用户Ui向CGSP平台的标识提供者IDPi发送获取用户Ui属性的请求REQ(ATTR(Ui))、该请求的签名Page8以及由ChinaGridCA(C_CA)签发的用户Ui信任状.2.IDPi->Ui,ATTR(Ui),SIDPi(ATTR(Ui)),CredC_CA->IDPi.标识提供者IDPi校验用户Ui的身份后,响应该用户的请求,返回用户Ui属性ATTR(Ui).3.Ui->IDPj:REQ-MAPPING-POLICY,SUi(REQ-MAPPING-POLICY),ATTR(Ui),SUi(ATTR(Ui)),CredC_CA->Ui.用户Ui向GOS的标识提供者IDPj发送策略映射请求REQ-MAPPING-POLICY及签名、用户Ui的属性集及签名、用户Ui的信任状.4.IDPj->Ui:M-1[Ui]∪M-1[D.R],SIDPj(M-1[Ui]∪M-1[D.R]),CredV_CA->IDPj.GOS的标识提供者IDPj验证用户身份后,根据用户Ui的属性集返回相关的映射策略集、M-1[Ui]∪M-1[D.R]以及该映射策略集的签名,同时GOS的标识提供者IDPj把由CNGridCA(V_CA)签发的信任状发给用户Ui,其中M-1[Ui]是与用户Ui相关的映射策略集,M-1[D.R]表示的映射策略集与用户Ui的域角色属性相关.5.用户Ui首先验证标识提供者IDPj身份并检查映射策略集的完整性,然后检查映射策略集.若映射策略集为空,则在GOS中没有映射关系,用户终止下一步请求操作.若用户Ui是通过用户-用户映射策略或用户-社区组映射策略和GOS中用户/社区组对应的,则执行Ui->SPm:REQ-S,SUi(REQ-S),M-1[Ui],SIDPi(M-1[Ui]),CredC_CA->Ui.若用户Ui是通过角色-用户映射策略或角色-社区映射策略和GOS中用户/社区组对应的,则执行Ui->SPm:REQ-S,SUi(REQ-S),M-1[D.R]UiSIDPj(M-1[D.R]Ui),ATTR(Ui),SIDPi(ATTR(Ui)),CredC_CA->Ui.用户Ui向GOS中的服务提供者SPm发送对服务请求REQ-S、GOS标识提供者IDPj签署的与用户Ui相关的映射策略、CGSP标识提供者IDPi签署的用户Ui属性ATTR(Ui)(对于第2种情况)以及用户Ui信任状.6.服务提供者SPm校验用户Ui的身份以及映射策略和用户属性的合法性以及完整性之后,确定用户Ui是否具有访问相应服务的权限,若有,请求被允许;否则,请求被拒绝.GOS用户访问CGSP资源/服务GOS用户访问CGSP资源/服务的安全互操作流程和上述流程的步骤近似.下面描述其不同之处:(1)对于第1步和第2步,是由GOS用户向本平台标识提供者发送查询属性的请求,并由标识提供者返回属性集给该GOS用户;(2)对于第3步和第4步,是由GOS用户向CGSP标识提供者发送查询映射策略的请求,并由CGSP标识提供者向该GOS用户返回映射策略;(3)对于第5步,若从CGSP标识提供者返回的映射策略中包含用户-用户映射或角色-用户映射,检查这些映射策略中是否存在该GOS用户对应的CGSP用户或角色,若不存在,根据GOS用户的社区组属性信息检查映射策略中是否包含对应的用户-社区组映射或角色-社区组映射,若也不存在,则用户终止进一步操作.若存在对应映射策略,则向CGSP的某服务提供者发送相应的映射策略和用户的服务请求.(4)对于第6步,CGSP服务提供者根据GOS用户发送的信息,确定该用户是否允许访问服务,并把处理结果返回给该GOS用户.4安全互操作分析在这一节中,以CGSP和GOS平台间的互操作为例分析网格安全互操作的授权及一致性,接着分析映射策略的粒度以及互操作流程的安全性.4.1网格平台间的授权及一致性分析本小节先分别分析CGSP平台对GOS用户的授权和GOS平台对CGSP用户的授权,并对授权中的一致性进行分析.CGSP平台对GOS用户的授权分析对于任一CGSP用户Ui,根据与用户Ui相关的映射策略M-1[Ui]可得到:用户Ui映射到GOS平台的用户(根据用户-用户映射)和社区组(根据用户-社区组映射)的集合.通过结合GOS用户与社区组的映射关系F:U->2VO.G,得到用户Ui映射到GOS平台的社区组集合,设为G.根据CGSP用户和局部身份的映射关系F:U->2D.E,得到用户Ui映射到CGSP平台内的域角色集合,根据与该集合中所有域角色相关的映射策略,得到集合中每个域角色映射到GOS平台的用户(根据角色-用户映射)和社区组(根据角色-社区组映射)的集合,再通过GOS用户与社区组的映射关系F得到域角色与社区组集合的映射,对每个域角色映射到的社区组集合取并集,记为G.则CGSP用户Ui可对应GOS平台中的社区组集合为G∪G,故用户Ui可获得的GOS平台中资源/服务的访问权限为G∪G可访问的权限.为了简化映射的复杂性和维护授权的一致性,针对于同一个CGSP用户,不宜同时采用用户-用户映射以及用户-社区组映射两种策略;针对于同一个CGSP域角色,不宜同时采用角色-用户映射以及角Page9色-社区组映射两种策略.另外,在采用用户-社区组映射以及角色-社区组映射时,不宜采用同一种策略映射到同一个社区的两个不同分组.因为很可能导致同一CGSP用户/域角色同时映射到GOS平台某社区中的不同分组,为了保证授权的一致性,原则上不宜映射到一个社区的多个分组.GOS平台对CGSP用户的授权分析对于任一GOS用户Ui,根据与用户Ui相关的映射策略M[Ui]可得到:用户Ui映射到CGSP平台的用户(根据用户-用户映射)和域角色(根据角色-用户映射)的集合.通过结合CGSP用户与局部身份(域用户和域角色)的映射关系F:U->2D.E,得到用户Ui映射到CGSP平台的局部身份集合,由于域用户也通过映射到域角色获得资源/服务的访问权限,则用户Ui通过映射策略M[Ui]可映射到CGSP平台的域角色集合,设为R.根据GOS用户和社区组的映射关系F:U->2VO.G,得到用户Ui映射到GOS平台内的社区组集合,根据与该集合中所有社区组相关的映射策略,得到每个社区组映射到CGSP平台的用户(根据用户-社区组映射)和角色(根据角色-社区组映射)的集合,再通过CGSP用户与局部身份的映射关系F最终得到社区组与域角色集合的映射,并对每个社区组映射到的域角色集合取并集,记为R,则GOS用户Ui可对应CGSP平台中的域角色集合为R∪R,故用户Ui可获得的CGSP平台中资源/服务的访问权限为R∪R可访问的权限.为了简化映射的复杂性和维护授权的一致性,针对于同一个GOS用户,不宜同时采用用户-用户映射以及角色-用户映射两种策略;针对于同一个GOS社区组,不宜同时采用用户-社区组映射以及角色-社区组映射两种策略.因为很可能导致同一GOS用户/社区组同时映射到CGSP平台某域中的不同角色,为了保证授权的一致性,原则上不宜映射到一个域的多个角色(或局部身份).4.2映射策略的粒度分析理论1.网格安全互操作的映射策略是灵活的、精粒度的.证明.通过CGSP和GOS的安全互操作映射策略进行具体分析:(1)对于CGSP平台而言,(i)如果用户-用户映射策略被采用,一个GOS用户能够访问多个ChinaGrid中域的资源/服务,只要GOS用户对应的CGSP证书身份在多个域建立了映射关系;(ii)如果用户-社区组映射策略被采用,属于某社区组的任一GOS用户能够访问多个China-Grid中域的资源/服务,只要该社区组对应的CGSP证书身份在多个域建立了映射关系;(iii)如果角色-用户映射策略被采用,一个GOS用户拥有对应角色访问某域资源/服务的权限;(iv)如果角色-社区组映射策略被采用,属于某社区组的任一GOS用户拥有对应角色访问某域资源/服务的权限.CGSP通过灵活采用其中一种或几种映射策略,能够使得GOS中的某一用户或某类用户拥有CGSP平台中单域/多域中资源/服务的权限.(2)对于GOS平台而言,(i)如果用户-用户映射策略被采用,一个CGSP的用户能够访问若干个社区组中的资源/服务;(ii)如果用户-社区组映射策略被采用,一个CGSP用户能够访问对应社区组中的资源/服务;(iii)如果角色-用户映射策略被采用,则被分配该角色的任一CG-SP用户能够访问若干个社区组资源/服务的权限;(iv)如果角色-社区组映射策略被采用,则被分配该角色的CGSP用户能够访问对应社区组中的资源/服务.CGSP通过灵活采用上述一种或几种映射策略,使得CGSP平台中一个用户或分配某角色的任一用户能够访问若干个社区组的资源/服务.4.3互操作流程的安全性分析理论2.网格安全互操作流程是可信的.证明.通过CGSP和GOS的安全互操作流程进行具体分析:(1)PKI机制和X.509证书在互操作流程中被采用,CredCA->U,CredCA->SP和CredCA->IDP是ChinaGridCA或GOSCA分别为用户、服务提供者和标识提供者签发的信任状,如步1和步2通过证书在用户和标识提供者之间实现相互认证;(2)信息完整性通过签名的方式获得,如多个步骤中的SU(INFO),SSP(INFO)和SIDP(INFO)分别表示由用户(U)、服务提供者(SP)和标识提供者(IDP)签名的数据,INFO;(3)机密性在本安全互操作流程中是不必要的,因为CGSP平台和GOS平台仅需要验证从属对方平台的用户证书是否合法以及是否具有完整性,而且,信息的加密和解密机密性将对互操作性能的影响也比较大.证毕.5CGSP与GOS安全互操作性能测试本文基于CGSP2.0版和GOS2.1版实现了安全互操作.CGSP和GOS都采用X509格式的证书,CA之间通过交叉认证建立信任关系.第3节已Page10经描述了在CGSP全局用户与域角色和GOS全局用户与社区组之间进行映射的4种方式.为了完成CGSP与GOS的安全互操作流程,本文采用互操作代理的方法.在CGSP和GOS中分别部署一个互操作代理,负责到对方平台的安全互操作,其操作流程详见第3.3节.为了做成通用的代理服务,还需要封装用户参数成统一内部格式,解析服务的WSDL并生成一个通用的Webservices或WSRF的请求客户端,将先前的内部格式的参数转换为该平台规定的特有的格式,提交服务请求.为了测试安全互操作引起的开销,在CGSP和GOS中分别部署一个ping服务.Ping服务直接返回接收到的参数,其逻辑所占的时间可以忽略不计,可以用来测试系统的开销.本文主要测试存在安全互操作和不存在安全互操作的情况下的差值来测试安全互操作的开销,采用1024位的RSA算法来实现认证和签名功能.主要测试4种情况:用GOS的客户端调用GOS中的ping服务,记为GOS-client;用CGSP的客户端调用CGSP中的ping服务,记为CGSP-CLIENT;通过GOS访问CGSP中的服务,记为GOS-CGSP-CLIENT;通过CGSP访问GOS中的服务,记为CGSP-GOS-CLIENT.由于网络速度受多种不定因素的影响,而本测试主要考虑平台带来的安全互操作开销,故本次测试在局域环境下进行.CGSP平台和GOS平台中的标识提供者IDP分别在本平台服务器上安装实现,如CGSP平台的IDP安装在CGSP服务器上.代理服务器上除了具有用于互操作的代理服务外,还作为平台的客户端使用.构建的环境由局域网内4台主机组成:(1)CGSP服务器:PentiumIII1000MHz;512MB;100MbpsFullduplex;(2)GOS服务器:AMDOpteron;1600MHz;2GB;100MbpsFullduplex;(3)CGSP-GOS代理服务器:PentiumIII;1000MHz;256MB;100MbpsFullduplex;(4)GOS-CGSP代理服务器:PentiumIII;1000MHz;512MB;100MbpsFullduplex.另外,局域网机器间传输带宽为100Mbps.通过对ping服务在上述4种调用方式下分别测试了80次之后,获得平均值,如表1所示.表1各种ping服务的开销平均值(单位:ms)GOS-CLIENTCGSP-CLIENTGOS-CGSP-MDCGSP-GOS-MD132.367167.114566.937533.379从表中可以看出,通过CGSP中的代理服务调用GOS中的服务(CGSP-GOS-MD)比直接调用GOS中的服务(GOS-CLIENT)多花533.379-132.367=401.012ms,即可以认为安全互操作引入的开销是401.012ms;通过GOS中的代理服务调用CGSP中的服务比直接调用CGSP中的服务(CGSP-CLI-ENT)会多出566.937-167.114=399.823ms,可以认为是通过GOS中的代理进行安全互操作时引入的开销是399.823.通过CGSP和GOS调用对方的服务时,整个安全互操作流程引入的开销主要来自认证和签名的计算开销,本文在测试时把映射策略放在内存中,若映射策略放在磁盘文件中,则安全互操作还需要加上这部分开销.另外,在映射策略数量为100条时,采用常用的排序算法进行策略匹配的时间几乎可以忽略不计.安全互操作引起的开销相对于服务的业务逻辑往往可以忽略不计.对于批作业计算任务,作业的运行时间通常是小时、天的数量级,互操作引起的开销可以忽略不计.对于计算量比较小的作业,本文以ChinaGrid中常用的医学图像处理为例.给出一个由8个节点机(16个处理器)和1个前端机通过千兆以太网互连而成的测试系统,其中每个节点上配备2块IntelXEON3.2GCPU和4GBRAM.表2滤波变换算法在平台中的开销操作名输入数据和参数并行度时间/μs离散余弦滤波高通滤波baghdad-1024-port.bmp低通滤波baghdad-1024-port.bmp由表2可知,以上3个常用变换操作,对于1024×1024的图片而言,16个CPU处理的时间分别为964、489、491ms,单CPU分别为13962、6663、6784ms,但在实际情况中,较复杂图形图像的处理时间与单图片处理时间相比,存在不止一个数量级的时间差别,远大于互操作引发的开销401.012ms和399.823ms.通过如上的分析可以得出,在针对计算量比较Page11大的科学计算时,安全互操作对性能的影响不大,如果只是单个图片的处理,或处理时间比较短的任务,则安全互操作的开销对性能的影响比较大,对于这种小任务,尽量不要采用安全互操作.6结论和未来工作本文对网格安全互操作及其应用进行了研究.基于当前流行的网格公共特性,如全局用户身份、虚拟组织等,提出了通用的网格安全映射策略.基于SAML规范,研究了网格安全互擦作的流程.以CGSP和GOS的互操作为例,阐述了网格安全映射策略以及网格安全互操作流程的实现过程.然后,从3个方面对安全互操作进行分析:(1)平台间的授权及一致性分析;(2)映射策略的灵活性;(3)互操作流程的安全性.最后对安全互操作的性能进行了分析,分析表明,安全互操作对计算量比较大的科学计算的性能影响小.未来的工作将考虑在更多的平台上实现本文提出的安全互操作机制.
