Page1基于自适应球覆盖的散乱点采样与定向刘圣军韩旭里(中南大学数学科学与计算技术学院长沙410083)摘要对散乱点的正确曲面重构至今依然是一个难题,特别是对于一个带有噪声、孤立点、薄壳结构及分布不均匀数据点集.而正确的法向信息在曲面重构中起着至关重要的作用.在文中,作者提出了一个法向量方向一致化的方法,能处理上述特性的数据,实现对曲面重构的数据进行预处理.首先,使用基于自适应球覆盖技术生成原始数据的一个根据曲面几何特征进行分布的采样点集,以保证在重构曲面上保留重要几何特征.然后,借助于球体的相交关系构造出采样点的邻域,实现在非均匀分布的数据上进行法向量方向传播,获得具有正确法向信息的采样点集.文中例子能充分说明文中方法的稳定性和有效性.关键词法向量定向;自适应球覆盖;一致性;散乱点;曲面重构1引言随着三维扫描仪的普遍使用,曲面重构也成为建模工程中的一个常用的步骤.用来表示被扫描的三维模型曲面的散乱点数据通常带有噪声、孔洞,而且点的分布非常不均匀,这为获得正确的重构曲面增加了难度.在进行曲面重构时,方向一致的法向量非常重要,它们定义了曲面的一阶性质且确定曲面的内/外信息.尽管可以通过光度测量来估计点的法Page2向量[1],然而由于反射高光、材料及阴影等原因造成这种估计不可靠.经典的估计法向量的方法是主元分析法(PrincipalComponentAnalysis,PCA).但是这样计算出来的法向量其方向不一致.使用最广的法向量方向一致化方法是文献[2]中提出的方法,通过最小张成树(MinimalSpanningTree,MST)实现相邻点的法向量方向传播.然而,对于具有噪声、薄壳几何特征以及分布不均匀的点数据,法向量方向传播可能会导致错误的结果.为了解决上述问题,最近一项研究工作[3]首先使用加权的局部最优投影操作[4]在原始点数据上构造一个去除噪声的均匀分布的采样点集,然后通过一个优先级驱动的法向量传播使所有采样点的法向量方向一致.由于采用均匀采样策略,这个方法会破坏原始数据中的一些几何信息,造成重构后的曲面丢失一些重要的细节特征或者会产生一些不希望出现的形状.在另外一项研究工作[5]中,它使用文献[6]中的方法生成一个初始导向网格,搜索距离每个点最近的三角片,并用其法向量修正该点的法向量方向.尽管这个方法能对原始数据的法向量进行方向一致化处理,且不丢失原始数据的任何信息,然而它依赖于初始导向网格的正确构造.为此该方法使用一个基于特征值分析的图1基于自适应球采样的曲面重构2相关工作曲面重构的方法一般可以分成两大类:(1)基于计算几何的方法和(2)基于体的重构技术.基于计算几何的曲面重构方法通常基于给定点云的Voronoi图通过直接连接输入点数据形成一张网格曲面.这类方法不需要法向信息.给定依赖于模型局部特征大小的最小采样密度,Amenta等人[10]提出一个可球分裂步骤保持在稀疏点区域的网格曲面的连接性.尽管使用原始数据重构出的曲面不会丢失模型的几何特征,但是当原始数据量很大时,重构过程将需要很长时间.我们可以考虑在一定的逼近精度内,使用数量较少的点数据来替代原始数据进行曲面重构[8-9],如图1所示.文献[3]中的技术就是基于这种思想来实现曲面重构的.为了解决文献[3]中由于均匀采样导致的几何细节的丢失或形状走样,在这篇文章中,我们提出一个基于自适应球覆盖的技术获取采样点并对其法向量方向进行一致化处理.首先使用改进的自适应球覆盖技术[6]获得原始数据的自适应采样,然后根据球体的相交关系快速获得采样点的邻接关系,最后构造最小张成树对采样点进行法向量方向传播,获得法向量方向一致的采样点集.本文第2节我们介绍曲面重构的相关工作;一种改进的自适应球覆盖技术将在第3节进行介绍,它能更好地保证球体的连接关系;第4节将详细描述法向量定向过程中的源点选择及基于球体相交关系的邻域获取;而实验结果及算法讨论将在第5节进行介绍;第6节对整个方法进行总结并介绍未来工作方向.以保证重构正确模型的方法.然而,该方法不能移除孤立点,导致重构出的曲面质量不够好.文献[11]是类似于文献[10]的方法.当应用这些算法去处理原始数据,有两个困难.一是计算Voronoi图的空间和时间消耗很大;二是这些方法要求给定点数据满足d-覆盖要求,例如,点集S是模型O的采样,在O上任意一点狆可以在S中找到一个点狇使得狇-狆d,这里d为曲面M上的最小特征大小.这在实际应用中是很难满足的,尤其是在点特别稀疏和具有噪Page3声的区域,如图2(b)中所示TightCoCone方法[11]不能正确处理HumanBody数据.在文献[6]中提出了一个方法,该方法能比较好地处理上述问题,而且不需要法向信息.然而,这个算法不能够保证在点很少的区域的曲面的连接性,如图2(c)所示.我们的图2不同方法对HumanBody模型数据进行重构的结果比较基于体的曲面重构技术首先试图建立一个插值或者逼近给定点采样数据的隐式函数[2,7-8,12],然后使用隐式曲面多边形化算法,如MarchingCube算法[13]抽取它的等值面.然而,计算有向隐式函数要求给定的点数据具有正确的法向量信息,这些信息难以由扫描设备直接获得.因此,在曲面重构过程中,方向一致的法向量估计是至关重要的步骤之一[2],特别当点数据中具有噪声、洞、尖锐特征或薄壳结构时.最广泛采用的法向量方向一致化方法是使用最小张成树(MinimalSpanningTree,MST)进行的方向传播算法[2].然而,这个方法难以处理具有上述特点的点数据,如图2(d)所示.最近有研究工算法改进了文献[6]中的自适应球覆盖技术,生成一个球体集和一个自适应采样点集,然后根据球体的相交关系构造出采样点的邻域,并由此构造最小张成树以获取方向一致的法向量.由得到的采样点集使用隐式曲面方法[7]重构出曲面,如图2(g)所示.作[3,5]试图解决相似的问题.尽管这两个方法能正确处理一些数据,但是都有一定的局限性.文献[5]中的方法基于点的法向方向与其所在的曲面朝向应该保持一致的思想.这个方法首先需要生成一个导向曲面,然后给定点数据中的每一个点找到导向曲面中离它最近的面片,根据该面片的朝向修正点的法向方向.由其算法过程知道该算法非常依赖于导向曲面,要获得具有方向一致的点数据,必须保证导向曲面能正确构造出来.为此,在文献[5]中,作者提出一个基于特征值分析的球分裂技术以保证在点数据稀疏区域的导向曲面的连接性及其正确构造.然而,这个方法无法处理由分隔距离较大的两个点集Page4构成的数据(两个点集的覆盖球体集之间没有相交球体).在文献[3]中,由于算法需要均匀的采样点以构造正确邻域,从而正确识别尖锐特征和确定法向量传播的候选路径.当采样点数量较少的时候,点的均匀分布会造成在特征丰富的区域丢失许多重要的几何信息,从而重构出丢失细节特征或者产生局部走样的曲面,如图2(f)所示.在这篇文章中,我们提出的基于自适应采样及球覆盖的法向方向一致化方法将克服这些困难,它能保留重要的原始几何特征,简化给定的点数据,加速后继的曲面重构过程(如径向基函数曲面重构[7]).3改进的自适应球覆盖技术对于没有法向信息的点云数据,为了重构出其图3均匀采样与自适应采样对重构结果的影响(其中(a)~(d)为示意图;(e)~(h)为对Blade模型的采样和重构曲面;表示的曲面,文献[3]使用加权的最优投影算子实现对原始数据的均匀采样,并以这个采样数据替代原始数据进行曲面重构.然而当采样率很大时,会造成对原始数据的形状信息的破坏,如图3(a)所示的尖锐特征处的采样分布.如果使用这种采样数据进行曲面重构,将导致曲面出现图3(b)和(c)所示的结果,其中使用Poisson方法重构[12]会出现图3(b)所示的丢失尖锐特征的结果曲面,而图3(c)所示是使用基于径向基函数的方法[7]进行曲面重构的结果,产生一些不希望出现的变形,如凸包、洞等.图3(e)和(f)给出了对一个实例数据的采样及曲面重构结果.图3(e)所示为Blade模型的均匀采样结果,其中左图是背面剔除模式,右图是正面剔除模式.图3(f)是分别使用Poisson方法[12]和基于径向基函数的方法[7]的重构结果,与图3(b)、(c)分析的示意图Page5相符,其中黑色的点为原始数据点.为了避免出现上述问题,自适应采样是一种较好的选择,它在高曲率区域分布较多的点而分布较少的点在低曲率区域,从而能保证尖锐特征的重构,如图3(d)所示.在本文中,我们使用自适应球覆盖技术来实现对给定点数据的采样.由于每个球体中的辅助点是对球体所覆盖的点的一个最优逼近,这些点形成原始数据的一个非均匀采样,如图3(g)所示.由这个采样数据重构出的曲面显示在图3(h).一般来说,构造非均匀分布点数据的恰当邻域是一个难题,这个问题将在下一节进行讨论.在这一节,我们先简单介绍生成自适应采样的球覆盖技术[6].在计算球覆盖之前,要对数据进行预处理.给定一个包含n个点的数据点集S={狆1,狆2,…,狆n},为了平衡点云数据中点的密度分布,每一个点狆i将赋予一个权值这里{狆j}(j=1,2,…,k)S是点狆i的k个最近点.一般情况下,我们选择k=10,能获得较好的速度和重构质量.这些点的法向量可以对其k个最近点使用标准的主元分析法进行计算[2].尽管这样计算出来的法向量的方向不一致,但是依然可以在后面的二次误差函数计算中使用.在球覆盖算法执行开始,S中所有的点都被标记为uncovered.算法将逐步生成m个球{si},这些球的球心为{犮i},半径为{ri},直至所有点都被球覆盖.自适应球覆盖算法有下面几个步骤:成球体的球心;(1)随机从未覆盖的点中选择一个点作为新生(2)对于每个球体si,如果它的半径ri是已知的,那么我们可以定义一个二次误差函数Qci(ri,狓i)=∑j其中Gσ(ρ)是一个局部支撑的类高斯函数Gσ(ρ)=狆j为满足条件狆j-犮iσ的点,一般选择σ=2ri.点xi可以通过最小化函数Q犮i,狉i(狓i)来确定,狓i=狓min(ri).我们希望能尽可能得到最大的半径ri,其值可以通过求解下面的非线性方程Q犮i,狓i(ri)=(αL)2得到,其中L为点集S的包围盒主对角线长度,α为用户预先设定的误差阈值(我们在实现中一般取α=10-5).我们初始设置狓i=犮i,从区间[αL,10αL]开始搜索一个解区间,然后使用二分法求解非线性方程Q犮i,狓i(ri)=(αL)2以获取一个最大的半径ri.使用半径ri,通过求解一个线性系统最小化Q犮i,狉i(狓i)获得狓i.求解细节详见参考文献[6];(3)获得半径ri之后,我们检测点狓i是否处于球体内部,即判断不等式狓i-犮iri是否成立.如果成立,则狓i将作为球体内部点的辅助点,否则我们将球心直接作为辅助点;(4)将球体内部的点投影到切平面(狓i-犮i)·狀i=0上,并且计算投影点的二维凸包.投影点处于二维凸包内部的点将被标记为covered.当所有的点都标记为covered,则自适应球覆盖过程结束.由于点集中每个点至少被一个球覆盖,对于点数据中的孤立点可以很方便地通过判断其所在的球体与其它球体的相交关系检测出来并予以剔除.在我们的实现中,如果一个球体的相邻球体个数小于3个,我们则认为该球体为孤立球体,其内部所包含的点为孤立点.我们重复执行这个过程,直到球体个数没有变化,则表示孤立点被完全删除.对于一些分布非常不均匀的点数据(图4(d)),有时可能会出现其覆盖球体集完全分离成两个或多个子集的情况(图4(a)),这将导致在第4节讨论的法向量方向传播将会提前终止,从而其它子集的点的法向量无法确定正确的方向,如图4(f)所示.为了阻止法向量方向传播提前终止,最好的办法是在各个独立子集之间能通过球体建立连接关系.加大球体的覆盖半径可以达到这个目的.然而,对所有球体都增大其覆盖半径是没有必要的,而且会增加最小张成树的构造计算量.我们采用自适应的方法选择恰当的球体并增大其覆盖半径以保证整个球体集的连通性,如图4(b)、(c)所示.我们先检测出每个数据点子集的覆盖球体集中的边界球体.对于一个球心处于犮i的球体si,通过球体的相交关系能得到它的一个相邻球体集{sj}.我们根据这些球体的球心{犮j}在犮i切平面上的投影{狇j}形成的角度对它们进行排序,形成一组围绕犮i的三角形{Δ犮i狇j狇j+1}.如果在这些三角形中,至少存在一个三角形,其角∠狇j犮i狇j+1>θ,这个球体则被称为边界球体,如图4(a)所示.在我们的实现中,一般取θ=150°.覆盖球体集形成多个独立的球体子集是由于数据点分布非常不均匀,甚至是由于部分区域的数据Page6图4覆盖球体集的连通性的重建及示例(其中,(a)和(b)是二维示意图)丢失,从而导致球体之间距离较大而造成的.通过增大边界球体的半径,可以恢复球体集的连通性.我们采用的方法是降低球体生成时的逼近精度α,重新计算边界球体,从而增大边界球体的半径,也即增大其邻域搜索半径,建立球体集之间的连接关系.我们不改变初始生成的球体位置,只重新计算边界球体的半径.对于每个边界球体si,我们设置αk+1=1.5αk(k为迭代次数),通过求解非线性方程Q犮i,狓i(rk+1i)=(αk+1L)2,能得到新的半径rk+1i.这个过程是一个迭代计算的过程,当覆盖球体集中没有边界球体或者迭代过程达到预设次数,则计算过程结束.4法向量估计及方向一致化在完成自适应球覆盖操作之后,我们得到对原始数据点的自适应采样点集,记为狓1,狓2,…,狓n.这些采样点狓i的法向量狀i初始估计可以通过使用标准的主元分析技术来计算,其邻域为球心在狓i,半径为2ri的球体内部的采样点.在对采样点进行法向量方向一致化处理之后,更准确的法向量信息可以采用方向相关的主元分析技术[3]重新计算获得.我们的法向量传播过程与文献[3]类似,首先选择一个进行法向量方向传播的源点,然后检测出一些特征点,如尖锐角点、尖锐边点等,接着由源点开始,遍历所有的采样点,并根据采样点之间的距离测量公式计算出的两个采样点之间的值构造一颗最小张成树.遍历最小张成树,则完成法向量方向传播.由于我们得到的采样点集是一个非均匀分布的数据点集,对于这种类型的数据点集,直接使用经典的法向传播算法[2]和点数据均匀采样与定向算法[3]是难以获得正确的方向一致的法向,因为它难以找到正确邻域.因此我们的法向量定向方法在源点选择和邻域确定两个方面与文献[3]不同.4.1源点选择通常会选择一个最外部的点,如具有最大x(或y,z)坐标的点,作为源点[2].然而,这种点可能是模型上一个尖锐特征上的点,这将导致后面的法向传播过程出现错误的结果[3].一个非常合理的选择是将处于平坦区域中的点作为源点.在文献[3]中,通过比较一个点的法向量与其k个最近邻点的法向角度变化,认为角度变化最小的点是处于最平坦的区域.这需要计算每个点的法向与其k个最近邻点的法向的点积,并计算角度变化量.对于我们获得的非均匀分布的采样点集,由于k最近邻点不能表示该点的正确邻域,因此这种方法是不可取的.在我们的算法中,处于平坦区域的点的选择非常简单,只需要检测其所属球体的半径大小,球体半径最大的点则被认为处于最平坦的区域,可以作为法向量方向传播的源点.Page74.2邻域确定在进行法向传播的过程中,获取邻域是一个重要步骤.恰当的邻域能使得法向传播过程快速而准确地获得正确的法向方向.一般对于给定一个点集,确定每个点的邻域有两种方法:r-邻域及k-邻域[14].点狆的r-邻域是指以点狆为球心半径为r的球所包含的点为该点的相邻点.点狆的k-邻域指离点狆距离最近的k个点为该点的相邻点.然而,对于非均匀分布的数据,这两种方式都难以有效找到恰当的相邻点集,如图5(a)和(b)所示.我们可以增大图5非均匀点集中邻域的确定(浅色点为空心点的所求邻域点集)5实验结果与讨论基于自适应采样的法向量方向一致化方法能对原始数据进行简化、去噪,并构造正确的法向量信息,使得在后继的曲面重构中快速、精确地构造出曲面.我们使用VisualC++实现了这个算法.在这一节,将给出在配置为Inter(R)Core(TM)2CPU66002.4GHz+RAM2GB的个人电脑上进行的测试数据.这些数据显示,经过我们的方法处理后的数据能快速重构出高质量的曲面.我们的法向量方向一致化过程包括两个步骤.表1统计数据文献[3]方法的实验结果时间/s-Vase-Lion1733,836HumanBody3170,3465,16215.850.484,98840.3ArmalidoBladeFishDinosaurIndonisiaLadyFiligree--注:P-N表示原始数据点的个数,S-N表示采样点的个数,W-T表示生成均匀采样所需的时间,N-T表示法向量方向传播的时间,C-T表示生成自适应采样的时间.对方法[3]进行测试时,使用的是作者提供的可执行程序,所有例子除了采样粒子数,其它参数都是使用程序默认的值,且只执行一次法向量估计操作.第1个测试例子是图1所示的对具有丰富几何细节的数据的曲面重构.我们对原始数据(图1(a)所示)进行自适应采样并且通过法向传播获得具有正确方向法向的一个采样点集(图1(b)所示),然后使用局r或k,但这样会导致邻点数量太多,在后继的计算过程中增加冗余计算.例如,在进行法向传播时,需要构造出一棵最小张成树,如果一个点的相邻点数量较多,那么最小张成树的构造将消耗较多的计算时间.在我们的算法中,由自适应球覆盖过程生成的采样粒子集为一个非均匀分布的点集,由于我们保留了获得自适应采样粒子过程中的球体集,借助于这些球体之间的相交关系建立对应的采样粒子之间的邻接关系,如图5(c)所示.第1步是对原始数据进行自适应采样.由于在自适应球覆盖过程中使用kd-tree空间结构进行最近邻域点查询,因此其时间复杂度为O(NlogN),其中N为原始点的个数.第2步是进行法向量方向定向.由于要构造最小张成树,这个步骤的时间复杂度为O(Elog(V)),其中E为球体相交关系的数量,V为采样点个数.文中给出的数据的处理时间见表1.在表1中还列出如采样点数、采样所需时间、法向量方向传播的时间的数据.由表1中的数据可以看出,对于文中所给出的例子,最多不超过45s就可以完成法向量方向一致化过程.部支撑的径向基函数[7]对获得的采样点集进行插值重构,并多边形化,得到一张网格曲面(如图1(c)所示).图1(d)是使用通过文献[4]中的方法获得具有正确法向的原始点数据进行重构后的结果曲面.Page8我们使用免费软件PolyMeCo①对这两张重构后的曲面进行比较,曲面之间最大误差为0.0018,平均误差为0.0009,如图1(e)所示.使用自适应采样点进行重构需时7.1s,而直接使用原始数据进行重构则需时335.1s.这表明我们的自适应采样点集在一定精度要求下能替代原始数据实现快速曲面重构.图2已经给出了采用不同重构方法对使用只有前后两个激光扫描仪的设备扫描出的人体数据(如图2(a)所示)重构的结果比较.原始数据包含噪声且不完整,这造成数据分布极度不均匀.使用TightCocone方法[11]和基于自适应球覆盖的曲面网格生成方法[5]在缺少数据的部位不能得到很好的重构曲面.使用经典的最小张成树[2]算法对数据进行法向量方向传播,在人体前后两片数据之间会发生法向图6使用文献[3]中的方法和本文的方法进行曲面重构的结果比较(从第1行到第4行分别是量翻转,从而导致使用基于径向基函数的方法[7]进行曲面重构的结果出现拓扑结构错误.使用均匀采样和定向点集方法[3]得到的采样点最后重构出的结果在原始数据非常稀疏的地方出现严重变形,如人体数据的脚.使用本文的方法和文献[5]的方法能重构出相似的较好的结果,然而使用原始数据进行重构需时116.8s,使用自适应采样点只需1.9s.为了比较方法[3]和我们的方法在采样点个数很少的情况下对曲面几何特征的重构,我们使用数量相似的采样点对给定数据进行采样并构造方向一致的法向.通过比较曲面的重构结果发现,我们的方法能更好地保留原始数据的重要几何特征.如图3、图6和图7所示的对Blade模型的测试结果.图3给出了分别使用基于径向基函数的重构方法[7]和①PolyMeCo,http://www.ieeta.pt/polymecoPage9图7使用均匀采样与自适应采样对尖锐特征的重构结果比较(每组图的左图为Poisson重构方法[12]对由文献[3]中的方法和本文的方法获得的采样点的重构结果.我们在显示重构结果的同时显示出原始数据,以比较重构的准确性.不难发现,对于两种重构方法,使用自适应采样点比均匀采样能获得对原始数据更好的逼近曲面.使用均匀采样会造成特征丢失或者严重走样.这在其它的测试例子中出现过相似的情况,如图6所示.图7图8两个基于自适应采样点和径向基函数进行重构的结果(每组图分别包括原始数据、自适应采样点和重构曲面)尽管我们的方法能较好地保留原始数据的重要几何特征,能处理具有噪声、孔洞和薄壳特征的数据,但是具有一定的局限性.首先,我们现有的实现不能很好地处理具有结构噪声的数据.由于在结构噪声处的自适应球覆盖过程生成非孤立的球体(如相邻球体数量多于3个的球体)无法在算法过程中去除,这将对后面的法向量方向传播过程产生影响.其次,我们的法向量方向传播采用与文献[3]中的方法相类似的过程,为了避免在特征点处出现错误的方向传播,禁止特征点向外进行法向传播.这将导致一些被特征点包围的采样点无法获得正确的法向量方向.6结论在曲面重构过程中,获得方向一致的法向量是非常重要的.对于带有噪声、孔洞和分布不均匀的数据,现有的方法难以稳定而有效地进行处理.在这篇文章中,我们提出一个鲁棒而有效的方法实现散乱所示为在尖锐特征处的重构结果的放大效果.在图8中显示了另外两个经过本文方法处理后的采样数据及其曲面重构结果.这两个例子表明本文的方法对具有非常复杂拓扑结构的数据也能很好地处理.经过处理后的数据通过使用基于径向基函数的方法[7]重构出高质量的曲面.点法向量方向一致化,它重构出的曲面有效地保留了原始数据的重要几何特征.给定一个没有法向信息的原始数据,首先采用改进的自适应球覆盖获得的一个自适应采样,并且保证球体集的连通性,然后对采样点集进行法向传播获得具有方向一致的法向量的数据点集.由获取的有向点集能重构出对原始数据的逼近曲面.由于采样点集是一个非均匀分布的数据点集,为了取得每个采样点正确的邻域,我们根据球体的相交关系建立采样点的邻接关系.如上一节所述,我们的方法还是有一定的缺陷.进一步改进本文的方法是我们未来的工作方向之一.另外,通过自适应球体覆盖过程生成的球体反应了模型数据的几何性质,在比较平坦的区域球体半径大,采样点稀疏,而在曲率较高的区域球体半径小,采样点稠密.我们未来的工作将会考虑如何将球体的这种属性在我们现有的算法实现中充分利用,如在法向量方向传播时借助球体的这种性质确定传播的方向等.Page10
