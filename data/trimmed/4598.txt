Page1BigDataBench:开源的大数据系统评测基准王磊1)1)(中国科学院计算技术研究所北京100190)2)(中国科学院大学北京100190)3)(北京尖峰新锐信息科技研究院北京100081)4)(中国信息通信研究院北京100191)摘要大数据系统的蓬勃发展催生了大数据基准测试的研究,如何公正地评价不同的大数据系统以及怎样根据需求选取合适的系统成为了热点问题.然而,应用领域的广泛性、数据类型的多样性和数据操作的复杂性使得大数据基准测试集的设计面临很大的挑战.现有的相关基准测试工作要么针对某一类特定的应用或软件栈,要么根据流行度主观地选择大数据负载,难以全面覆盖大数据的多样性和复杂性.针对现有工作的不足,文中讨论大数据评测基准需要满足的需求,并研制了一个跨系统、体系结构、数据管理3个领域的大数据基准测试开源程序集———BigDataBench.它覆盖5个典型的应用领域(搜索引擎、电子商务、社交网络、多媒体、生物信息学),包含结构化、半结构化、非结构化的数据类型,涵盖离线分析、交互式分析、在线服务、NoSQL这4种负载类型.目前包含14个真实数据集、3种类型的数据生成工具以及33个负载的不同软件栈实现.BigDataBench已广泛应用到学术界和工业界中,应用案例包括负载分析、体系结构设计、系统优化等.基于BigDataBench,中国信息通信研究院联合中国科学院计算技术研究所、华为等国内外知名公司和科研机构共同制定了国内首个工业标准的大数据平台性能评测标准.关键词大数据;基准测试;工业标准;测试方法;数据生成;应用案例1引言数据的爆炸式增长掀起了大数据的研究热潮,越来越多的应用领域涉及到大数据的处理和存储,其所蕴藏的科学价值和商业价值逐渐体现.为了挖掘大数据中隐藏的知识,各种大数据系统应运而生.目前,一系列关于大数据处理和存储的开源项目被发布,如HadoopMapReduce①、Hive②、ClouderaImpala③、NoSQL数据库④、Spark[1]、GraphLab[2]等.如何客观地评价众多的大数据系统以及从中选择适合自身需求的系统成为学术界和工业界普遍关心的问题,大数据工业界和研究社区迫切需要一套公认的大数据评测基准.LordKelvin⑤阐述了评测对于设计和优化的重要性.在数据库评测基准还未发展成熟的20世纪80年代初期,各大厂商根据自定义的有偏颇的标准对自家的产品进行市场推广,使得数据库领域一度处于争夺利益的混乱时期.可见推出公认的评测基准作为系统设计的依据和产品优劣的评价标准是非常有必要的.大数据的特性[3](海量、多样性、高速性)使得大数据在系统、应用和数据3个层次体现了与传统模式的差别[4],决定了现有的评测基准不能满足需求,也决定了设计大数据领域评测基准的高度挑战性.首先,大数据的海量特性使得评测基准需要能够提供多样化、大规模和真实的数据集,然而大数据中蕴藏的巨大商业价值令其成为重要的私有财产.另外,即使大数据持有者愿意公开其数据,如何传输千万亿字节(Petabyte)甚至更大规模的数据也是一个很大的难题;其次,大数据的多样性表现为应用领域的多样性、数据的多样性、负载的多样性以及软件栈的多样性,这些都直接加剧了构建评测基准的复杂度;最后,大数据系统的快速迭代更新,需要大数据评测基准能够与时俱进,适应大数据系统的快速演变,这同样具有极大的挑战.如表1所示,现有的相关基准不能完整的涵盖大数据的特性.部分评测基准[5-9]针对特定的应用领域或者软件栈,如BigBench[5]的目标评测系统是数据库管理系统(DBMS)和MapReduce系统,另外有些评测基准没有提供可扩展的数据集,如CALDA[7]、YCSB(Yahoo!CloudServingBenchmark)[8]等,或者负载选取缺乏合理的依据,如CloudSuite[10]仅仅根据流行度选取大数据负载,缺乏对大数据多样性和复杂性的全面覆盖.针对现有工作的不足,本文研制了一个跨系统、体系结构、数据管理3个领域的大数据基准测试开源程序集———BigDataBench.为了适应大数据系统快速演变和更新的发展特性,我们采取一种增量式和迭代式的构建方法.首先,我们使用公认的标准[11]选取互联网服务中最重要的大数据应用领域,同时调研新兴的大数据应用领域,并最终确定5个领域:搜索引擎、电子商务、社交网络、多媒体和生物信息学.其次,针对所选择的应用领域,对数据和负载进行多个维度的全面分析,抽象出领域内典型算法中频繁出现的基本操作单元,并基于此构建评测规范.它不仅包含丰富的数据类型(如结构化、半结构化和非结构化数据)和数据语义(如文本、表、图和多媒体),而且涵盖多样的负载类型(如离线分析类负载、在线服务类负载、交互式分析类负载和NoSQL负载).然后,根据不同领域的数据和负载特性,我们定制针对不同领域的基准测试规范,从而指导基准测试的实现.最后,鉴于软件栈对负载①②③④⑤Page3的行为特征有很大的影响[12-13],单一的软件栈不能满足大数据系统横向比较的需求,我们基于多种软件栈实现负载,例如,对于离线分析类负载,我们提供Hadoop、Spark、MPI这3种实现方式.同样地,考虑到真实的大数据集不易获取,我们提供了基于真实的小数据集进行建模并保持真实数据特征的大数据生成工具,包含文本、图和表数据生成工具.另外,为了满足不同的评测需求,我们进一步提供多租户混合负载版本[14]和BigDataBench子集[12].其表1相关评测基准对比基于真实数据的可扩展数据集6(可扩展)评测基准BigDataBenchBigBenchCloudSuiteHiBenchCALDALinkBenchAMPBenchmarks本文第2节阐述大数据评测基准的需求;第3节介绍大数据评测基准相关工作;第4节描述BigDataBench构造方法以及所包含的数据集和负载;第5节论述BigDataBench的使用方法和适用范围;第6节基于3个典型用例描述BigDataBench的应用场景;最后第7节对全文进行总结.2大数据评测基准需求Gray应用,并满足领域内应用的多样性.据此他进一步提出了一套成功的评测基准需要满足的4个条件:系统相关性、可移植性、可扩展性和简单.其中,系统相关性是指能够评测领域相关的系统性能,包括系统的峰值性能,性价比等;可移植性是指评测基准能够移植到不同的平台上,易于在不同的系统和架构上实现;可扩展性是指能够适应不同的系统规模;简单是指评测基准易于理解,评测结果具有可靠性.参考Gray提出的4条标准,并结合大数据海量、高速、多样的特性,我们提出了针对大数据领域的评测基准需要满足的需求.(1)可代表性.大数据领域具有非常广的覆盖范围,信息时代的来临使得越来越多的应用领域涉及到大数据的处理和存储,因此一个完整而全面的评测基准不可能一蹴而就.如何尽可能提高负载覆盖度又不失评测的简易性是很大的挑战,这也就要求评测基准具有领域代表性.我们认为大数据领域中,多租户混合负载版本[14]支持符合真实工作日志动态特征的大数据负载重放,BigDataBench子集[12]是为系统和体系结构研究者提供的典型负载集合,主要目的是为了减少BigDataBench中大量负载给系统和体系结构研究带来的巨大评测开销.BigDataBench经历了4个版本的迭代更新,目前发布的BigDataBench3.1版本是BigDataBench2.0[15]的显著升级版,总共包含14个真实数据集和33个负载的不同软件栈实现.333N/AN/A1N/A的代表性主要体现在3个方面:①代表性负载.众所周知,目前应用领域极其繁多,领域之间有一定的共有特性,但每个领域有其独特性,因此应用领域和负载的代表性在一定程度上也就决定了评测基准的代表性;②代表性数据.大数据领域与传统数据库等领域的一个显著区别即是数据类型多元化,传统的结构化数据不再占据主导地位,半结构化和非结构化数据爆炸性增长,因此评测基准不能忽略复杂而多样的数据类型;③代表性软件栈.数据迅猛增长催生了众多的大数据处理和存储系统,然而不同的软件栈对大数据负载的行为特征具有很大的影响[12-13],因此大数据评测基准需要涵盖代表性软件栈.(2)可移植性.大数据评测基准不仅需要能够纵向地评测大数据系统,而且需要能够对不同的系统进行横向的对比.这就要求相同的负载能够提供不同的实现方式,评测基准能够便利地移植到其他平台.为了使不同的实现方式具有公平的可比性,针对不同平台的实现,需要具有相同的输入和输出,以及相同的算法处理逻辑.如今,一系列针对大数据处理和存储的开源产品被发布,例如MapReduce、Spark等,所以在评测基准的实现过程中需要考虑基于这些不同的软件栈的实现.(3)可扩展性.大数据评测基准需要提供可扩展的数据集和负载.大数据的一个显著特征即是数据量大,单一节点的存储已逐步转变成分布式存储,因此评测基准所提供的数据和负载需要适应不同规Page4模的平台.然而如今大多数的大数据持有者视数据为重要的商业机密,因而能够提供符合真实数据特性的可扩展数据集是大数据评测基准重要而基本的需求.(4)可理解性.评测基准需要具有简易性,易于理解,并易于部署和评测,同时评测结果能够指导系统的评价、改进和优化.然而,大数据系统本身非常复杂.仅仅从简单性的角度来选择典型负载,可能会使基准程序丧失代表性.因此,我们用可理解性来取代原有的简单性需要.可理解性有3点含义:能从基本操作单元和负载模式的角度理解典型负载;评测结果需要简单直观,评测人员能够根据负载的特性分析结果的合理性并判断系统的瓶颈或者优劣;评测结果需要具有稳定性,其结果必须是可靠的并且可重现的.3相关工作随着大数据关注热度的持续升温,大数据评测基准吸引了学术界和工业界的广泛研究,国内外涌现了大量相关研究工作.BigBench[5]是一个针对大数据离线分析的端到端的大数据评测基准,基于TPC-DS构建,并在此模型基础上加入了半结构化和非结构化数据类型.围绕上述3种不同的数据类型,BigBench提供了一系列的查询负载.尽管BigBench包含了丰富的数据类型,但是其目标评测系统是DBMS系统和MapReduce系统,对大数据环境中繁多的软件栈缺少全面的覆盖.CloudSuite[10]是一套评测Scale-out负载的基准,并根据流行度选取了8个负载,包含使用Hadoop框架运行机器学习任务的数据分析负载,数据缓存负载,依赖雅虎云服务标准测试程序的数据服务负载,图分析负载,流媒体负载,资源需求高且耗时的软件测试负载,Web搜索和服务负载.HiBench[6]是Intel提出的一套评测MapReduce应用的评测基准,主要包含微基准测试程序,如计数排序等,机器学习相关负载,如分类聚类等,服务类负载,如索引等,和HDFS基准测试.HiBench-4.0加入了对Spark软件栈的支持.CALDA[7]是评测Hadoop系统和RDBMS系统的测试基准.其所提供的负载是一系列的数据分析任务,主要包含选择操作、查询操作、聚集操作等.其评测指标包含构建索引时间、查询时间、系统加载时间等.YCSB[8]是评测NoSQL系统的测试基准,主要关注云服务系统的性能和可扩展性.其主要针对NoSQL数据库进行压力测试,测试数据库在并发读取、写入、更新等操作时的行为,如吞吐量等.YCSB提供了一组核心的负载,被称为核心包,其中包含5个负载:频繁更新、频繁读取、小范围、只读和读取最新.AMPBenchmarks①是UCBerkeleyAMPLab所提出的一个针对实时分析类应用的大数据评测基准,它主要评测不同规模数据集下一系列关系查询的系统响应时间.其输入数据集包含非结构化的HTML文档和两张SQL表.该团队使用其评测了Redshift、Hive、Shark、Imapla、Stinger/Tez等系统,并报告了实验结果.LinkBench[9]是针对社交图谱数据库的一个可定制和可扩展的评测基准,该基准根据真实的社交网络应用Facebook开发,实时地查询、更新图数据库,评测指标主要包含延迟、吞吐率等.BSMA(BenchmarkforAnalyticalQueriesoverSocialMediaData)[17]是一个针对社交媒体分析应用的测试基准.它提供了一个真实的社交网络数据集和符合一定数据分布规律的数据生成工具.同时,它提供了一系列的查询负载,包括图操作、热点查询、时间线查询等.CloudBM[18]是中国人民大学提出的评测云数据管理系统的测试基准.它以电信业务为应用背景,提供了一组性能评价指标,基于实际应用的数据操作类型和相应的工作流.综上所述,现有的相关测试基准要么针对特定的应用领域或软件栈,要么缺乏负载选取的合理依据,使得所选取的数据集和负载具有一定的局限性.4大数据基准测试方法(Methodology)本节介绍BigDataBench构造方法.我们从构造方法、测试规范、负载和数据集这几个方面进行介绍.构造方法主要介绍如何构造BigDataBench;测试规范介绍BigDataBench的使用场景;负载和数据集具体介绍根据使用场景选取的负载和数据集.4.1构造方法基于大数据评测基准需要满足的需求,我们提出了BigDataBench构造方法.图1宏观地描述了BigDataBench的构造方法.它主要包含5个步骤:①https://amplab.cs.berkeley.edu/benchmark/Page5(1)广泛调研大数据应用领域,并选取典型或者新兴的领域;(2)对选取的应用领域中涉及的数据集和负载进行深入的分析,抽取频繁出现的基本操作单元;(3)针对每一个选取的应用领域提出测图1BigDataBench构造方法Seltzer等人[19]指出为得到真实应用的性能数据必须采用基于应用的评测基准.Chen等人[20]同样提出评测基准应该与真实的应用领域相关联,并且能够反映真实的计算需求.受此启发,BigDataBench构造方法基于具体的应用领域,涵盖领域中真实的数据集和典型的负载.首先,我们调研大数据领域并且根据公认的指标选取典型和重要的领域.互联网服务是大数据中的一个典型类别,我们根据公认的标准(页面访问量和每日访问人数)进行筛选,发现搜索引擎、电子商务和社交网络占据互联网服务中80%的访问量①.毋容置疑,搜索引擎、电子商务和社交网络这3类应用领域是互联网服务中最重要的应用场景.鉴于数据的增长渗透到各行各业,我们同样调研了新兴的大数据应用领域,发现多媒体领域②和生物信息学领域③占据了非常重要的地位.综上所述,我们总共选取了5个大数据应用领域:搜索引擎、电子商务、社交网络、多媒体和生物信息学.针对选取的应用领域,我们深入地分析其中的数据集和负载,主要包含两个方面:(1)数据类型,如结构化、半结构化、非结构化数据和数据语义,如文本、图、表、多媒体数据等;(2)探索领域内常用算法中频繁出现的基本操作单元[21-22].然后,为每一个应用领域提出特定的测试规范,从而指导评测基准的实现.在BigDataBench的具体实现中,我们结合数据的类型选取多样的真实数据集,并在此基础上提取真实数据的特性,构造符合特性的数据生成工具.在负载选择方面,我们全面考虑各种复杂的负载类型,权衡各类型负载所占据的比例,包含离线分析、交互式分析、在线服务和NoSQL这4种类型.不仅试基准规范;(4)提供基于真实数据的数据生成工具和基于多种软件栈实现的负载;(5)根据不同的评测需求提供多租户混合负载版本和BigDataBench子集.如此,为了方便各个大数据系统的对比,我们对于每一个负载提供了多种实现方式.为了满足大数据评测中的特定需求,我们提供了基于BigDataBench的两个不同的版本.一是多租户混合负载版本④:真实的数据中心一般包含多个租户共享基础设施资源,因而提供支持多租户、混合负载场景的评测基准是非常有必要的.多租户混合负载版本提供了符合真实工作日志动态特征的大数据负载重放,主要考虑了两类典型的负载类型,包含长期运行的服务类负载和短期运行的分析类负载.混合负载测试工具主要包含3个模块:用户接口模块、负载运行日志与真实负载匹配模块、多租户负载生成模块.其中,用户接口模块与用户交互,接收具体评测需求,如评测场景中的机器和负载类型等,然后根据评测需求选取相应的负载运行轨迹.负载运行日志与真实负载匹配模块主要是抽取日志中的负载行为特征,进一步采取回归和聚类的方法与真实的负载进行匹配,从而生成负载重放脚本来指导混合负载的生成.服务类负载的生成主要决定于请求发送频率、请求的序列和请求内容3个因素,分析类负载生成主要决定于任务提交时间、负载类型和输入数据3个因素.多租户负载生成模块以负载重放脚本为依据,提取租户信息并构建能够生成服务类和分析类混合负载的多租户框架.目前,我们主要基于搜狗用户查询日志⑤生成服务类负载,以①②③④⑤Page6及基于谷歌集群负载日志①生成分析类负载.二是BigDataBench子集②:大数据负载繁多,且实现方式多样,为系统和体系结构研究带来了巨大的开销,尤其是以模拟器为运行环境的研究,因而从大量的负载中选取特征明显并且差异显著的负载能够缓解评测的压力.BigDataBench子集分析了不同负载及实现,选取了45个系统和体系结构层次的指标,通过主成分分析(PCA[23])和聚类分析(K-Means[24])选出了典型负载的精简集合.4.2测试规范针对所选的5个应用领域,我们制定了不同的测试规范,模拟5个不同的应用场景并选取其中重要而典型的负载,从而指导大数据评测基准的实现.在本节中,我们以搜索引擎为例,阐述模拟的场景以及定义的规范.如图2所示,BigDataBench中的搜索引擎包含两个场景:普通搜索和垂直搜索.普通搜索是对互联网上爬取的所有网页建立索引,而垂直搜索只对和主题相关的页面建立索引,因此能够反馈更符合搜索主题的页面.图3描述了搜索引擎的处理细节.其输入数据主要是网页,在BigDataBench的实现中,网页是由数据生成工具所生成.在网页的处理流程中,搜索引擎首先解析网页的内容并理清网络图的架构.其次,索引器根据解析出的内容建立索引,PageRank程序根据图的链入链出结构计算网页的重要程度.另外,统计程序提取内容的关键词并对网页进行分类.当用户输入一个查询请求,搜索引擎读取索引并根据网页的重要程度将其反馈给用户.整个过程涉及到的关键负载如下:(1)解析.提取网页的内容和外部链接.解析是获取网页页面之后的第一个步骤,通过正则表达式匹配HTML标签得到.(2)统计.计算网页内容中每个词的词频,从而提取描述网页主题的关键词.(3)分类.根据网页关键词进行分类,将网页划分入不同的主题.(4)索引.建立单词到文档号的映射,当搜索到单词时,能够检索到包含单词的文档.(5)PageRank.根据网页的外部链接图迭代计算网页的重要性.(6)搜索请求.在线网络搜索服务器.(7)排序.根据网页的重要性以及与搜索词的相近程度对结果进行排序.(8)推荐.根据搜索的日志文件对搜索关键词进行推荐.(9)过滤.针对垂直搜索引擎的主题,过滤与主题无关的页面,仅保留与主题相关的内容.(10)语义提取.提取网页的语义信息.(11)数据存取.读取、写入或者扫描提取的语义信息.4.3真实数据集和数据生成工具大数据处理中包含丰富的数据类型,据统计,80%的数据增长来自于非结构化数据③,如文档、图片、音视频等.作为大数据系统的评测基准,需要能够覆盖多样的数据类型和数据语义,并满足数据集的可扩展性.本小节介绍我们所选择的真实数据集以及相应的数据生成工具.4.3.1真实数据集通过调研5个选取的应用领域,我们收集了①②③Page714个真实的数据集.其代表性主要体现在:(1)数据来源于可靠而权威的机构或组织,如维基百科、美国国家生物技术信息中心(NCBI)等,和知名的企业,如谷歌、亚马逊等;(2)在各自所属的应用领域内,数据作为常用的数据源已被多次引用并用于评测,如ImageNet是目前图像识别最大的数据库,其相关论文已被引用1600多次;(3)结合大数据领域的数据特性,我们考虑了多样的数据模式,涵盖了结构化、半结构化和非结构化数据类型,包含了文本、图、表、图像和音视频数据语义.表2列举了我们选取的真实数据及相应的数据生成工具,每个数据集的详细介绍如下.标号12亚马逊电影3谷歌Web图456ProfSearch科研人简历7ImageNet89DVD输入流描述数据集1011121314维基百科条目①是非结构化文本数据集,具有4300000篇英文文章,其覆盖的主题包含艺术、地理、历史、数学、自然、科技等.亚马逊电影评论②数据集是半结构化文本数据集,包含1997年8月至2012年10月期间253059个用户对889176部电影的7911684条评论.谷歌Web图③是非结构化图数据集,描述了875713个网页之间5105039个链接的图结构.Facebook社交图谱④是非结构化图数据集,包含4039个节点和88234条边,其中每一个节点表示一个用户,每一条边表示其所连接的两个用户之间的朋友关系.电子商务交易数据是结构化表数据,此数据集来自电子商务网站并且经过了匿名处理.它主要包含订单和订单项目两张表.ProfSearch科研人简历是半结构化表数据.该数据集来自我们自己开发的针对科研人员的垂直搜索引擎,总共包含从大学和研究机构的约20000000个网页中自动提取的278956份简历.ImageNet[25]是非结构化图片数据集,它根据WordNet层次结构进行分类,目前包含其中的21841个同义词集合,每个集合平均超过500张图片,现总共有14197122张图片.英语广播音频⑤是非结构化音频数据集,包含来自美国之音(VOA)、英国广播公司(BBC)、有线电视新闻网(CNN)、国际广播电台(CRI)和美国国家公共电台(NPR)的约8000个音频文件.DVD输入流⑥是非结构化视频数据集,包含110个分辨率为704×480的输入流数据.图像场景描述数据集⑦是非结构化文本数据集,包含39个图像场景描述文件,主要从几何坐标、视角、光线、阴影等多个角度对场景进行描述.基因序列数据⑧是非结构化文本数据集,包含4种不同的基因数据,规模从20MB至7GB,基因片段(Reads)的数量从101617条至31257852条.基因组装数据⑨是非结构化文本数据集,包含4种不同规模的组装数据,从100MB~13GB.SoGou数据集瑏瑠是非结构化文本数据,包含来自SoGou实验室的语料库和查询数据.基于语料库我们得到了4.98GB的索引数据.MNIST瑏瑡是非结构化图片数据集.它是一个手写体数据库,提供了训练集和测试集,其中训练集包含60000个手写体数据,测试集包含10000个手写体数据.4.3.2数据生成工具大数据不仅获取难度大,而且下载开销大,因此我们提供了能够体现大数据真实性、多样性、速率和①②③④⑤⑥⑦⑧⑨瑏瑠瑏瑡Page8规模的大数据生成工具[26-27](BDGS).通过对真实数据的建模分析,BDGS能够快速生成保持真实数据特征的指定规模数据集.目前该工具包含文本、表和图数据生成工具.针对多媒体数据和基因数据的生成工具还待进一步开发.图4描述了BDGS的构造方法.数据生成工具总共包含4个步骤:(1)数据筛选,即选取代表性的真实数据集和相应的建模方法或工具;(2)原始数据处理,即对真实数据采样并建模,提取数据的特图5BDGS架构LDA模型采用词袋的方法,通过将每篇文档转换成一个词频向量进行建模.对于每一篇文档,LDA定义了从主题分布中抽取一个主题,从该主题对应的单词分布中抽取一个单词的过程.LDA模型不仅考虑了词项,而且考虑了隐含的主题,提取了文档的语义特征.因而相对于传统的依据某个概率分布从词典中取词的数据生成方法,LDA模型更多地保留了真实数据特征.图6描述了LDA主题模型.在LDA模型中①,主题狕和单词狑都符合多项式分布,其中主题多项式分布的参数θ符合狄里克雷分布,此狄里克雷分布的参数为α;单词多项式分布的参数为β.LDA建性;(3)数据生成,即通过参数控制数据规模和并行度;(4)格式转化,即根据负载的输入需求转换生成数据的格式.图5是围绕构造方法设计BDGS的总体架构图,它总共包含3个模块:数据处理生成模块、并行控制模块和格式转化模块.数据处理生成模块首先完成构造方法中第2个步骤,即原始数据处理,然后并行控制模块设置规模和并行度,将任务分发,按照参数控制器的输入参数生成指定规模的大数据,最后格式转化模块根据负载的输入需求进行格式转化.在原始数据的建模过程中,文本数据生成工具基于统计学方法,采用隐含狄利克雷分布模型[28](LDA)进行建模;图数据生成工具采用Kronecker[29]模型进行建模;表数据生成工具基于元数据和业务规则进行建模.我们以文本数据生成为例,阐述BDGS如何对真实数据进行建模并生成保持真实数据特性的指定规模文本数据集.模过程主要根据真实语料库训练得出参数α和β,进而确定整个模型,并生成文档.α和β包含的信息为:α是分布P(θ|α)中需要的参数,即狄里克雷分布参数,用以生成文档主题分布θ,β是单词多项式分布P(狑n|狕n,β)中需要的参数,用以生成主题对应的单词.使用训练出的α和β生成文本数据的过程如下:首先,通过参数为α的的狄利克雷分布生成文档主题分布θ,然后,以θ作为参数,通过多项式分布生成N个主题,最后,对每个主题,通过参数β的多项式分布,生成对应的单词.①后文描述中向量用黑体字母表示.Page9图7描述了文本数据处理和生成的整个流程,总共包含5个步骤:(1)针对所选的真实数据集,进行数据预处理,即清洗原始数据,去掉无用的字符;图7文本数据处理生成流程图4.4负载考虑到大数据评测基准的4个基本需求,我们总共选取了33个来自5个应用领域的负载,选取原因及代表性体现主要描述如下:(1)它们是5个典型应用领域中的基本并且重要的负载.如测试规范(2)对预处理之后的数据进行分词处理,统计词项并生成数据词典.词典的生成主要包含是否去掉停用词,如何筛选词项两个方面.对于微基准测试程序,如Sort、Grep等,数据词典的生成方式并不会对它们的运行行为产生较大的影响,然而对于索引构建和文本分类等负载,词典的生成方式会影响负载的运行行为.因此我们在生成数据词典时根据不同负载的特性来决定处理方式,如是否去掉停用词等;(3)根据预处理后的数据和数据词典生成原始数据集的词频矩阵;(4)将上一步得到的词频矩阵作为输入,训练LDA模型,得到α和β参数.我们采用开源的LDA-C①程序对输入数据进行建模;(5)根据模型参数和控制参数(并行度控制、规模控制)生成指定规模的文本大数据.所述,通过模拟5个应用场景,我们挖掘场景中必不可少的负载.例如,对于电子商务而言,应用于商品推荐的协同过滤负载(CollaborativeFiltering)、应用①http://www.cs.princeton.edu/~blei/lda-c/Page10于商品分类的NaveBayes负载和应用于数据库查询的交互式分析类负载是其中关键的负载;(2)它们涵盖了大数据处理中多样的负载类型,如离线分析、在线服务等;(3)它们能够处理不同的数据类型,能够以大数据场景中复杂的数据模式作为输入;(4)它们使用不同的软件栈实现,能够用于评测不同的软件栈.表3从应用领域、负载名称、负载类型、使用数据集、软件栈5个维度描述了BigDataBench包含的负载.对应于上述搜索引擎测试规范的描述,表3负载应用领域搜索引擎社交网络电子商务多媒体生物信息学所有的33个负载均来自于选取的5个应用领域,由于软件栈对负载的行为特征有很大的影响[12-13],所以我们提供负载的多种软件栈实现.例如,对于离线分析类负载,我们提供Hadoop、Spark、MPI这3种实现;对于交互式分析类负载,我们提供Hive、Shark、Impala这3种实现.另外,对于不同的负载,我们优先选取目前主流的及其适合的软件栈进行实现.在未来的工作中,我们会加入更多的实我们同样以搜索引擎为例介绍怎样通过测试规范选取典型的负载.在4.2节搜索引擎测试规范中,我们定义了11个负载,目前我们提供了其中7个负载的实现,包含解析(Grep)、统计(WordCount)、索引(Index)、PageRank、搜索请求(NutchServer)、排序(Sort)、数据存取(Read,Write,Scan).我们的评测基准测试规范总共包含42个负载,目前我们实现了其中的33个,另外的9个负载会在未来工作中实现.ProfSearch科研人简历ProfSearch科研人简历ProfSearch科研人简历Facebook社交图谱Facebook社交图谱Graph500生成工具电子商务交易数据电子商务交易数据电子商务交易数据电子商务交易数据电子商务交易数据电子商务交易数据电子商务交易数据电子商务交易数据电子商务交易数据电子商务交易数据图像场景描述数据集现方式,例如多媒体负载的不同软件栈实现.针对不同的评测目标,用户可自行选择部分或者全部负载进行评测.每个负载的详细介绍描述如下:(1)搜索引擎Grep负载用于获取网页之后的第一步--解析网页,从中提取搜索的字符串.WordCount负载统计词频信息,从而发现网页中的关键字,便于之后的分类处理.Page11Index负载是对网页内容建立索引,通过对内容的分词和停用词去除等处理,对词元进行索引.PageRank负载用于给所有的网页打分,通过网页之间的链接关系迭代计算网页的重要程度.NutchServer负载提供在线搜索的服务,对搜索请求进行查询反馈.Sort负载是对内容进行排序,如对网页的打分数据进行排序从而决定页面的显示顺序.Read、Write、Scan负载表示从数据库中读取、写入或者顺序读取记录.(2)社交网络ConnectedComponent负载提取社交网络图中的连通分支,从而发现不同的社区.K-means负载通过分析节点的相似性(距离)对社交网络图进行聚类分析.BFS负载对图进行广度优先搜索,从某一个节点开始,广度优先遍历整个图.(3)电子商务选择查询负载用于找出一个订单中订购数超过100的物品.聚集查询负载用于计算每个物品的销售总量.连接查询负载用于计算物品在给定时间段内被每个用户所购买的数量.CollaborativeFiltering负载主要用于物品推荐,根据相似性推荐用户可能感兴趣的物品,主要为矩阵计算.NaveBayes负载利用贝叶斯定理预测类别未知的文档最可能属于的类别,主要用于分类.Project、Filter、CrossProduct、OrderBy、Union、Difference、Aggregation是交互式分析中基本的操作.(4)多媒体MPEG负载[30]是按照MPEG-2的标准对视频进行编码解码.SIFT负载[31]用于检测图像中对旋转、光亮、缩放等保持不变的局部性特征.DBN负载[32]是对深度信念网络的实现,用于手写体识别.语音识别负载①通过建立声学模型和语言模型将音频信息翻译成文本信息.光线跟踪负载[33]根据图像场景描述文件的参数,跟踪光线生成3D图像.图像分割负载[34]通过对每个像素加标签将图像分割成多个子区域.人脸检测负载[35]根据脸部特征判断图像中是否有人脸以及检测人脸的位置和尺寸.(5)生物信息学SAND负载[36]实现基因数据的组装,将很多个基因碎片组装成原始的基因序列.BLAST负载[37]实现基因序列的对比,将基因片段与数据库中的数据进行对比以检测相似性.5BigDataBench使用方法和适用范围本节介绍BigDataBench的使用方法,包括使用原则和使用步骤,并讨论BigDataBench的适用范围.5.1使用方法BigDataBench从5个典型的应用场景出发,选取了14个真实数据集和33个负载.针对不同的评测需求,具有不同的评测方法.以下主要分为5个基本的步骤来介绍其使用方法.(1)根据评测需求选取合适的负载和数据集BigDataBench提供了多种类型的数据集和负载,用户可根据其具体的评测需求进行针对性的选择.例如,对于关注评测交互式数据分析系统的用户而言,他们只需要选取交互式分析类负载和电子商务交易数据;而对于进行体系结构研究的用户而言,我们提供了BigDataBench子集用以减少评测开销.(2)部署集群环境并下载安装BigDataBench针对用户选取的系统或者软件栈部署集群环境,下载BigDataBench并进行配置.(3)使用数据生成工具BDGS生成指定规模数据集根据集群的规模和数据集的类型,选取相应的文本、图或者表数据生成工具,并生成指定规模的数据集.(4)运行负载并调优运行第一步选取的大数据负载,并根据实验结果进行调优,如更改配置参数等.(5)采集实验数据并分析得到评测结果根据评测的指标和评测的目的采集实验数据,如负载运行时间、吞吐率、系统层行为特征等.分析和对比实验数据得出评测结果.由于篇幅限制,本文仅介绍使用的一般步骤,具体的数据生成和负载运行等使用方法请参照我们提供的用户手册②.①②Page125.2适用范围BigDataBench是跨系统、体系结构和数据管理3个研究领域的大数据基准测试程序集.适用于大数据系统评测、处理器体系结构设计、负载分析、数据管理系统评测等研究工作.6BigDataBench应用案例如上一节所述,大数据评测基准BigDataBench具有广泛的应用,本节从3个典型案例分别介绍BigDataBench在大数据系统评测(此案例主要评测系统开销)、处理器体系结构设计和负载分析中的应用.针对每一个案例,我们主要从两个方面进行介绍,一是案例本身的工作内容,二是在案例中如何使用BigDataBench以及得出的结论.6.1云数据安全剑桥大学计算机实验室(TheComputerLabo-ratory)设计了一个HadoopMapReduce框架下保护敏感数据的系统———MrLazy4个子系统:来源跟踪、来源重建、字段级跟踪分析和标签生成.来源跟踪主要获取记录(Record)的来源信息,即跟踪输出记录具体是由哪些输入记录处理得到,并保存输入记录和输出记录间的链接关系.MapReduce具有Map和Reduce两个阶段,来源跟踪子系统在Map阶段获取中间记录到输入记录的链接关系,在Reduce阶段获取输出记录到中间记录的链接关系.来源重建将前两部分的链接关系根据中间记录进行连接,得到输入记录和输出记录的直接链接关系.字段级跟踪分析通过分析二进制文件判断执行过程中是否使用敏感字段产生输出.输出记录的标签是以对应输入记录的标签作为函数输入所得到.图8描述了MrLazy的输出标签生成过程.由于BigDataBench提供了代表性的Hadoop负载以及相应的数据生成工具,论文选取BigDataBench作为测试负载,主要选用了交互式分析中的Join负载和电子商务交易数据.他们使用表数据生成工具生成了120GB的数据,并在7个节点组成的集群上运行所选的负载,用以评测MrLazy系统的开销.实验发现从时间开销方面,来源跟踪部分大约增加了19%的运行时间,来源重建部分占任务实际运行时间的18%;从空间开销方面,执行完来源重建之后生成的链接数据文件大小是输出数据的50%,是输入数据的5%.6.2体系结构设计Zou等人[39]介绍了多核领域中3种主流的异构集成技术:单指令集异构多核处理器体系结构设计、CPU和GPU异构计算、异构混合内存架构.其中,单指令集异构多核设计是指所有的核使用同一套指令集但是具有不同的计算资源,如高性能强核和低功耗弱核的组合;CPU和GPU异构计算能够综合CPU低延迟和GPU高吞吐量的优势;异构混合内存架构是指传统的DRAM/SRAM技术和新兴的非易失性内存(NVM)的集成,如相变存储器(PCM)[40].论文选取了BigDataBench中的6个大数据负载(K-means,Aggregation,PageRank,Sort,选择查询,连接查询),然后抽取负载的内存轨迹并使用NVMain[41]重放,从而研究不同内存混合类型下负载的延迟和功耗特征.论文中讨论了4种不同的配置:单纯使用DRAM、单纯使用PCM、DRAM和PCM结合使用、DRAM作为缓存.实现发现从延迟角度,单纯使用PCM延迟最大,而单纯使用DRAM延迟最小;从功耗角度,单纯使用DRAM和使用DRAM作为缓存这两种配置具有更高的功耗,单纯使用PCM的功耗最低.6.3负载分析负载分析主要包含负载的系统层和体系结构层行为,如CPU利用率、访存行为、网络传输、指令特征、流水线行为、TLB(TranslationLookasideBuffer)行为、缓存行为等.这些行为影响着系统和体系结构的设计,深入理解负载的行为特征能够为系统部件设计和硬件配置提供指导,对系统的性能分析和调优同样具有非常重要的作用[42].BigDataBench包含多样的大数据负载.从负载类型的角度包含在线服务类、离线分析类、交互类、NoSQL等;从负载特征的角度包含计算密集型、I/O密集型、混合型.目前已有很多的相关工作使用BigDataBench进行负载分析.Jiang等人[13]探索内存计算框架Spark的负载行为特性,并从系统层面Page13和微体系结构层面发现Spark负载与Hadoop负载和传统的HPC负载均有较大的差异.Pan等人[43]分析数据中心大数据负载的I/O特性,并发现内存的增加能够有效降低I/O请求数,以及HDFS和MapReduce具有不同的I/O行为.Jia等人[44]系统地分析了数据中心分析类负载的微体系结构层的行为特征,并与传统的负载如SPECCPU2006①、HPCC[45]、SPECWEB2005②以及CloudSuite中的Scale-out服务类负载进行对比,并发现数据分析类负载和服务类负载在指令执行和流水线停顿方面都具有较大的差异,其中,流水线停顿是影响流水线效率的一个关键因素,它是指在指令流水线的执行过程中,由于指令之间的相关性等原因,使得流水线被迫停顿一个或者多个时钟周期,以保证程序的正确执行.从指令执行角度,数据分析类负载每时钟周期执行的指令数(IPC)比服务类负载多;从流水线停顿角度,分析类负载和服务类负载均有较大的前端BigDataBench3.1版本较之前的版本是一个显著升级的版本,它加入了新兴的应用领域———多媒图9BigDataBench发展历程停顿,然而分析类负载主要是乱序执行阶段的停顿,服务类负载主要是进入乱序执行之前的停顿.7经验与总结到目前为止,BigDataBench总共经历了4个版本的迭代更新.图9描述了其整个发展历程.2013年,我们发布了第一个版本,主要由3个评测基准组成,包含BigDataBench1.0、DCBench1.0和CloudRank1.0.之后,我们将前3个评测基准进行合并并发布了BigDataBench2.0版本,它来自搜索引擎、社交网络、电子商务等3个应用场景,总共包含6个真实数据集和19个大数据负载,并具有能够保持真实数据特性的大数据生成工具.第3个版本增加了数据集和负载,包含6个真实数据集、2个合成的数据集以及32个负载.其主要的更新在于关注大数据负载中频繁出现的基本操作.①②Page14体和生物信息学.通过调研选取的5个应用领域,分析领域中广泛使用的具有代表性的算法,统计出算法中频繁出现的基本操作,进一步针对各个领域制定测试规范,模拟应用场景,并按照测试规范选取典型的负载,从而指导评测基准实现.BigDataBench3.1包含14个真实的数据集、33个负载实现和采用多样化的实现方式.在此基础上提供两个针对不同应用需求的版本,一是符合数据中心真实工作日志动态特征的多租户混合负载版本,二是降低体系结构研究开销的BigDataBench子集.在之后的工作中,我们会加入更多的典型领域,进一步开发和优化数据生成工具及相应负载实现,同时加入更多新兴的大数据处理和存储系统,如Flink①、Cassandra②、Mongodb③等.BigDataBench设计方法紧密联系工业界,深度调研真实的应用领域和实际的评测需求,目前已广泛应用在学术界和工业界中,并在此基础上完成了国内首个④工业标准的大数据平台性能评测标准⑤.
