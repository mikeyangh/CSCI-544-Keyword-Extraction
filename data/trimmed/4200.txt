Page1洋葱路由追踪技术中时间特征的建模与分析何高峰1)杨明1)罗军舟1)张璐1)马媛媛2)1)(东南大学计算机科学与工程学院南京211189)2)(中国电力科学研究院南京211106)摘要针对洋葱路由匿名通信机制,现有研究工作提出了多种基于时间特征的追踪技术方案,但对如何从理论上解释时间特征可用于追踪的原因,以及如何确定为形成特定时间特征所需调制的报文延时幅度等问题缺乏相应研究.以目前广泛使用的第二代洋葱路由Tor匿名通信系统为研究对象,深入分析其数据包调度策略,建立相应数学模型,并提出数据包输入和输出缓冲区的平均队列长度和网络层报文数量估算方法.在此基础上,结合提出的时间特征差异度度量方法,解释说明能够借助时间特征来进行匿名通信追踪的原因,同时得出影响追踪效果的3个具体因素.进一步,针对ON/OFF流水印模型,推导出在满足一定水印检测率前提下应调制的报文延时幅度.通过Tor实验环境验证了理论分析的正确性.研究成果为后续匿名通信相关研究提供理论和实践指导.关键词洋葱路由;匿名通信追踪;时间特征差异度;ON/OFF流水印模型;报文延时调制1引言随着移动互联网的出现和发展,用户隐私信息的保护逐渐成为关注的焦点.洋葱路由[1]匿名通信机制是确保网络用户隐私信息安全的一种重要手段.第一代洋葱路由匿名通信系统是由美国海军研究室设计并开发,提供实时、双向的匿名通信连接.该系统采用确定路由地址的源路由协议,传输数据前首先建立一条由发送方到接收方的OR(OnionRouter)序列,数据包和地址从后向前逐层采用每个OR节点的RSA公钥进行加密,整个数据包的格式就如同多层的洋葱.收到这个数据包的节点只能解密最外层,根据获得的下一跳地址将加密数据发送出去,每个节点依次操作,直到最后将原始数据发送到接收者;返回数据时则按对应的相反顺序发送.由于采用多跳重路由和层层加密设计,每个OR节点只知道其前一跳和后一跳节点,恶意OR节点和外部观察者难以确定消息发送者、真正接收者以及他们之间的通信关系,从而保护了用户的通信关系隐私和身份信息隐私.Tor[2]作为第二代洋葱路由匿名通信系统,与图1匿名通信追踪示意图在图1中,Alice通过匿名通信系统访问网络资源.在怀疑的通信双方Alice与Server处,追踪者可首先在Server端返回的网络流中提取一定时隙内的报文数量(被动追踪)或者对报文进行延迟处理从而形成一些不含报文的空时隙(主动追踪).然后对Alice处的匿名通信流进行统计处理,提取一定时隙内的报文数量或试图发现嵌入的空时隙,恢复出时间特征.若两处的时间特征相似度超过设定的阀值,则判断出Alice正通过匿名通信系统与Server进行第一代洋葱路由系统相比,增加了安全的秘密转发、拥塞控制、目录服务器、完整性校验以及可变的边缘策略等,提升了系统的安全性和可用性.它采用目录服务器分发OR节点,在用户机器上运行的OP(OnionProxy)程序按一定策略挑选3个OR节点建立匿名路径,路径上的OR节点间采用TLS加密数据,客户端与OR节点间使用DH(Diffie-Hellman)握手协议,协商AES对称会话密钥.一旦匿名连接建立完成,将不再使用公钥算法构建洋葱包,而是采用对称密钥对数据进行层层加密,有效减少了加解密带来的系统开销.目前,Tor客户端可运行于AppleiOS、Android以及NokiaMaemo等智能终端操作平台上,为移动互联网用户提供了便捷、有效的隐私保护.然而,匿名通信系统在保护移动互联网用户隐私信息的同时,也可为不法分子所利用,为其实施网络犯罪增加掩护,阻碍审查机构对其的监控与追踪.因此目前网络安全领域的一个新的研究热点便是匿名通信追踪技术,通过还原匿名用户间的通信关系为匿名网络犯罪的追踪提供相应的技术手段.典型的匿名通信追踪框架[3]可如图1所示.交互,从而完成匿名通信追踪过程.此方法将匿名通信系统作为“黑盒”处理,具有较强适用性.需要注意的是Alice接收到的报文是经过匿名节点多跳转发和多次加密的,因而并不能够直接借助报文头部和内容信息来判断Alice与Server间的通信关系.针对匿名网络犯罪的监控与追踪问题,现有研究工作主要侧重基于时间特征提出不同的追踪技术方案,如被动数包[4-5]和主动流水印[6-7]等,但对其中存在的两个重要问题缺乏相应研究:如何从理论上Page3分析时间特征可用于追踪的原因,以及进一步,如何确定为形成特定时间特征所需调制的报文延迟幅度.解决这些问题具有重要实际意义:一方面可指导设计更加有效的匿名通信追踪技术方案;另一方面可以揭示现有匿名通信协议和匿名通信系统在实现上存在的漏洞,从而能够设计更完善的匿名通信协议以及其系统实现,为用户提供更好的隐私保护.为此,本文以洋葱路由匿名通信系统设计为切入点,根据其对时间特征的改变方式,分析出追踪可行性的理论依据、影响追踪效果的具体因素和为嵌入水印信号所需调制的报文延时幅度等,为后续相关研究提供理论和实践指导.具体的,本文以目前使用最为广泛的Tor匿名通信系统为研究对象,对其运行机制进行深入分析,建立数据包调度算法模型,提出数据包输入和输出队列的平均长度和对应的网络层报文数量估算方法.在此基础上,结合提出的时间特征差异度度量方法,对基于时间特征匿名通信追踪技术的可行性展开理论分析,得出影响追踪效果的3个因素,即报文长度、干扰流和转发节点自身的处理能力等,并给出追踪时的具体实践指导.进一步,为分析在网络流中形成特定时间长度的空隙以嵌入水印信号所需要施加的报文延时范围,本文针对ON/OFF流水印追踪模型[8-9],推导出在满足一定检测率的前提下应调制的报文延时幅度,并给出实际应用时有关参数的获取方法.本文通过Tor实验环境对相关结论进行了验证.本文第2节简要介绍匿名通信及其追踪方面的相关研究工作;第3节对Tor匿名通信系统进行深入分析,建立其数据包调度模型,提出数据包输入和输出缓冲区的平均队列长度和对应的网络层报文数量估算方法,为后续的时间特征度量与分析奠定基础;在第4节中提出时间特征差异度度量方法,结合推导出的网络层报文数量计算公式,对基于时间特征的匿名通信追踪技术展开理论分析,解释说明能够借助时间特征来进行匿名通信追踪的原因和影响追踪效果的具体因素,并在此基础上针对ON/OFF流水印追踪模型,进一步推导出为嵌入水印信号所需调制的报文延时幅度;第5节为实验部分,通过Tor实验环境对相关结论进行验证;最后一节总结全文.2相关工作Chaum[10]于1981年首先提出匿名通信和Mix技术概念,通过一系列Mix节点对数据包进行重路由以掩盖用户的真实IP地址,并以包填充、包延迟和多重加密等混淆手段将通信流中的通信关系加以隐藏.但Mix技术所采取的包延迟等技术给报文传输带来显著延迟,因而其仅适用于对实时性要求较低的网络应用,如电子邮件等.为支持交互式网络应用,研究人员设计并开发了多种低延时匿名通信系统,如Tor[3]、I2P[11]、Anonymizer[12]等.这些系统并未使用包延迟等机制,从而能够支持诸如网页浏览、文件下载、即时通信(如MSN、ICQ)等延时敏感类网络应用,其中Tor系统中约有2600个OR节点①和600000在线用户②,是当前使用最为广泛的匿名通信系统.与Tor相比,I2P采用大蒜路由(GarlicRouting)机制,即会将多个消息组合在一起加以传输,并且I2P在设计上是专门针对隐藏服务,而并非用于一般网络用户的匿名通信.Anonymizer为商用的单跳代理转发系统,与典型的多跳重路由模式差别较大,实现机制也较简单.同时,I2P和Anony-mizer在当前并不能直接用于AppleiOS、Android等智能终端操作平台上,使用范围有限.鉴于上述分析比较,本文首先选择Tor为研究对象,而将I2P、Anonymizer等匿名通信系统留于后续工作中加以分析研究.针对匿名滥用的追踪技术本质上是对匿名通信系统的攻击,其目的是还原出用户之间的通信关系,解除其匿名性.根据对追踪者能力范围限制的不同,匿名通信追踪可分为被动追踪和主动追踪[13].被动追踪是指追踪者仅被动监听怀疑的通信双方处的网络流量,提取特定时隙内报文数量或报文时间间隔等网络流特征以作为追踪依据.而在主动追踪模型中,追踪者不仅可以监听怀疑的通信双方的网络流量,还能够对报文进行延迟、修改、丢弃等处理,以达到准确、高效追踪目的,其中基于时间特征的流水印技术被广泛使用.被动匿名通信追踪的主要研究工作有Zhang等人[8]利用交互式流量的ON/OFF特性计算流之间的相似性;Levine等人[14]首次提出以特定时隙内报文数量为时间特征,对Mix节点的被动流关联技术展开研究;Zhu等人[3]以互信息的方法对进出匿①②Page4名通信系统的流进行关联以确定匿名用户间的通信关系;Fusenig等人[5]提出改进的时隙数包追踪方案;Craven等人[15]针对Tor匿名通信系统,以报文时间间隔为特征,建立其隐马尔科夫模型,从而实施匿名通信追踪.由于被动匿名通信追踪需要对流进行长时间的观察,并记录大量特征数据,总体来说效率不高,因而快速准确的主动匿名通信追踪技术得到了越来越多的关注.主动匿名通信追踪技术在原始网络流中加入特定的标识(水印),如果在匿名通信流中提取出相同的标识,则认为这两条流是相关联的,这方面的典型工作包括:Wang等人[16-17]以报文时间间隔为载体提出了一系列基于流水印的主动流关联技术;Wang等人[18]针对低延时匿名系统在转发数据时无法完全消除流中报文时间特征的缺陷,提出了基于报文抵达时间的主动流关联技术;Yu等人[19]使用直序扩频技术,以流速率为载体,将水印信号扩频后嵌入通信流中,有效地提高了主动流关联技术的检测率和抗干扰能力;Pyun等人[20]以一定时隙内报文个数为载体提出了一种流水印技术以应对传输过程中的包重组问题;Houmansadr等人[21]提出了一种非盲检测流水印,减小了对流的调制幅度,大大提高了主动流关联技术的隐秘性;Huang等人[22]针对文献[19]提出改进的直序扩频水印技术;Zhang等人[6]针对Web浏览、即时消息等交互式应用,在扩频流水印模型的基础上,引入与特定流无关的基于时隙质心的水印载体,提出一种新型流水印技术;Houmansadr等人[7]以报文时隙质心为载体,首次提出流相关的水印追踪技术.在目前匿名通信追踪研究工作中,有许多是围绕时间特征展开的[4-7,13-22].然而现有研究工作所关注的重点是选择不同的时间特征相似度计算方法和设计更为隐蔽、高效的追踪技术,对借助时间特征来进行匿名通信追踪的合理性缺乏理论解释,并对可能造成原始网络流与对应的匿名通信流时间特征产生较大差异的干扰因素和嵌入水印所需调制的时间幅度缺少相应分析.论文着重解决以上问题,为后续匿名通信相关研究工作提供理论和实践指导.3Tor运行机制描述与数据包调度策略建模本节对目前使用最为广泛的第二代洋葱路由Tor匿名通信系统运行机制进行详细描述,并对其数据包调度策略进行建模,提出数据包输入和输出缓冲区的平均队列长度和对应的网络层报文数量估算方法,为第4节中的时间特征分析奠定基础.3.1Tor运行机制描述Tor作为第二代洋葱路由匿名通信系统,是目前最为流行、应用最为广泛的匿名通信系统.当前Tor系统中约有2600个OR节点,估计同时在线用户数为600000.Tor适用于所有基于TCP协议的应用,其整体系统架构如图2所示.当Alice通过Tor访问网络资源,如Web服务器时,首先从目录服务器或Bridge节点处下载所有的OR节点信息,然后根据各节点所公告的带宽、在线时间长短和设定的出口访问策略等因素,使用带宽加权算法选择3个节点分别作为入口节点(EntryNode)、中间节点(MiddleNode)和出口节点(ExitNode).这里的带宽为节点可用的网络带宽,由各节点自行配置并将该参数上传至目录服务器.为防止连接被阻断,Tor提供非公开的Bridge节点以接入网络.若OP配置使用Bridge节点,则转发路径的入口节点即为该Bridge节点,如图2中虚线所示.随后,Alice与Web服务器间通信的所有报文都将通过该3跳路径转发,其中Tor匿名转发链路的建立如图3所示.首先,Alice处的OP程序与入口节点建立TLS连接,然后发送“Create”请求,与入口节点协商会话对称密钥,该对称密钥由DH密钥交换协议生成,并使用RSA加密算法对DH交换参数进行加密处理.协商成功后,OP通过入口节点,继续与中间节点和出口节点间进行类似交互,从而建立3跳的匿名转发链路.当OP传输数据时,数据经入口节点、中间节点和出口节点层层加/解密和转发操作,最终到达目的端.Page5图3Tor匿名转发链路建立流程如上所述,Tor使用带宽加权算法分别从入口节点集合、出口节点集合和中间节点集合中选择3个不同节点构建匿名转发路径.记入口节点的集合为En,出口节点集合为Ex,中间节点集合为Em,而同时属于入口和出口节点的节点集合为En∩x,即En∩x=En∩Ex.令各集合中所有节点的网络带宽之和分别为Bn、Bx、Bm和Bn∩x,所有Tor节点的总带宽为B=Bn+Bx+Bm-Bn∩x.以选择出口节点为例,从出口节点集合中选择第i个节点作为匿名转发链路出口节点的概率为Bx(i)/[Bx+Bn∩xWx],其中Bx(i)为出口节点集合中第i个节点的网络带宽,而Wx为En∩x集合中节点被选为出口节点的权重,计算为Wx=1-B/3Bn.选择其它节点的方法类似,更详尽的分析参见文献[23].转发链路建立成功后OP程序监听本地端口(默认为9050),其它应用程序通过配置Socks代理(127.0.0.1:9050)连接至OP.针对每一Socks连接,OP程序有一个数据包输入缓冲区和对应的输出图4Tor信元结构缓冲区,输出缓冲区与下一跳节点相关,因而可以有多个输入缓冲区对应同一个输出缓冲区.Tor的数据处理和转发功能均由libevent的读事件和写事件控制完成.当读事件被调度时,OP从输入缓冲区中读取数据,一次最多读取498字节,然后利用出口节点、中间节点和入口节点的会话密钥对读取的数据层层加密,再增加信元(Cell)头部字段,并将一个长度为512字节的完整的信元写入信元队列中.若输入缓冲区中还有数据,则继续上述操作,直至读取完所有数据,并注册写事件.当写事件被调度时,首先将输出缓冲区中的数据尽可能多的写入TLS写缓冲区中,然后将信元队列中的信元尽可能多的写入输出缓冲区中.即一个信元发送至网络需要两次写事件,一次写事件将信元写入输出缓冲区中,另一次写事件将信元从输出缓冲区中写入TLS层加密并发送.Tor信元结构如图4所示,图4(a)为Tor命令控制信元结构,图4(b)为数据转发信元结构.OP的报文处理流程如图5所示.Page6转发链路上的OR节点对数据的处理流程与OP略有不同,OR节点从TLS读缓冲区中读取数据至输入缓冲区中,并且每次从输入缓冲区中读取一个信元长度的数据,即每次读取512字节.根据路径方向执行完加密或解密操作后根据信元的Circ_ID字段将该信元放入相应队列中,OR节点有多个信元队列.具体流程如图6所示.需要注意的是出口节点处理目的端(如图2中的Web服务器)返回的数图7TorTLS报文结构为保证传输性能,Tor匿名通信系统采取了多种不同级别的流量控制机制[2],如匿名链路级、通信流级和TCP连接级等.对于匿名链路和通信流级的流量控制,采用窗口机制,每接收到一个信元后窗口数量减1.当接收到一定数量(50或100个)信元后,则向对方发送RELAY_SENDME命令,增加对应窗表1主要符号定义符号ExEn∩xNinTmτ据时其流程与OP相同.输出缓冲区中的信元写入TLS写缓冲区中,加密后经TCP协议传输.Tor借由OpenSSL实现TLS层加密.TLS报文由TLS头部、加密后的数据和消息验证码MAC以及填充字段组成,具体格式如图7(a)所示.但Tor会对每个TLS报文增加一个空的TLS记录,因而最终的TLS报文结构如图7(b)所示.口长度.而对于不同的TCP连接,采用均分总带宽策略,即每一条TCP连接所占用的带宽相同.鉴于篇幅所限,Tor流量控制机制的详细描述参见文献[2].3.2数据包调度策略建模首先对论文中出现的主要符号定义进行说明,如表1所示.Page7C一次调度时间内原始网络流中包含的报文数量Tmin匿名转发路径上节点调度时间的最小值CI(i)一次调度时间内第i个干扰流包含的报文数量Tk匿名转发路径上第k个节点的调度时间Bn,BxBm,Bn∩xtS1,tS2X,…,cTf/T犞X={c1如3.1节中所描述,Tor采用libevent事件机制实现输入缓冲区和输出缓冲区中数据的处理调度,其可表示为隐式的轮询(roundrobin)调度[24],因而Tor节点对数据包的处理流程可抽象为以下算法模型.算法1.TorSchedulingAlgorithm.1.WHILE(TURE)2.FOReachinputbuffer3.IFtheinputbufferisnotempty4.getatmostNpktpacketsandencapsulate5.putthecellsintothecorrespondingoutput6.ENDIF7.ENDFOR8.FOReachoutputbuffer9.IFtheoutputbufferisnotempty10.flushalldata11.ENDIF12.ENDFOR13.ENDWHILE由于Tor本身的流量控制机制[2],算法1中规定从输入缓冲区中一次最多可读取Npkt个数据包.设Tor节点设置的最大流速率为Q,同时有Nout个输出缓冲区,则Npkt≈min(100,Q/(586×Nout)).基于Tor流量控制机制,假定信元队列中的信元可一次性写入输出缓冲区中并发送.算法1的图形解释如图8所示.由算法1可求出数据包输入缓冲区和输出缓冲区的平均队列长度,从而求出对应的网络层报文数量.如图2所示,考察Web服务器返回数据至Alice的情形.设每个OR节点共有Nin个输入缓冲区,tANout个输出缓冲区,NoutNin.每个输出缓冲区有g个输入缓冲区与之对应,1gNin-Nout+1.记OR节点对输入缓冲区和输出缓冲区中数据包的处理速率为μ.对于任一输入缓冲区,依据轮询调度策略,在处理完其它Nin-1个输入缓冲区和Nout个输出缓冲区后才能够再次处理该队列中的数据包.设一次处理的单个输入缓冲区数据包数量等于e的概率为Pre,处理第i个输入缓冲区一次需要时间为则处理Nin个输入缓冲区所需的时间为Tsum(I)≈Nin∑Npkt-1由于输出缓冲区中数据包来源于输入缓冲区中,因而处理Nout个输出缓冲区所需时间可近似相等于处理Nin个输入缓冲区所需时间:则轮询调度一次所需总时间为T=Tsum(Nout)+Tsum(Nin)Page8因而在T时间内,第i个输入缓冲区到达的数据包数量Ψi为由于时隙T值一般较小,因而可认为在T时隙内报文到达速率为定值,记为λi(t).设第i个输入缓冲区的数据包平均长度为pi,则输入缓冲区队列长度(字节数)为对于中间节点和入口节点,pi值等于512,而对于出口节点有pi<M,其中M为网络层最大报文段(MaximumSegmentSize)大小.每个输出缓冲区平均有g-个输入缓冲区与之对应,g-=Nin/Nout.如3.1节中所描述,OP程序在构建匿名转发路径时按在线节点的网络带宽进行加权来选择转发节点.设Tor网络并发用户数为U,用户u构建的匿名转发路径上出口节点的网络带宽为Bx(u),中间节点的网络带宽为Bm(u).根据文献[23],有Nout=U×其中,Wx=1-B/(3Bn),若Bn<B/3,则Wx=0.Wn=1-B/(3Bx),若Bx<B/3,则Wn=0.Wn和Wx分别表示En∩x集合中节点被选择入口和出口节点的权重,Bn、Bx以及B等变量符号含义见表1.结合式(7)和式(8),从而有g-=Bx(u)×(BxWn+BnWx+Bn∩x×Wx×Wn+Bm)对于出口节点,从输入缓冲区连续取出498字节的数据,封装成512字节的信元(图4)后写入输出缓冲区中,因而输出缓冲区队列长度(字节数)L1计算为而对于中间节点和入口节点,从输入缓冲区取出的是512字节的信元,其输出缓冲区队列长度L2计算为信元经TLS层加密封装成长度为586字节的TLS报文(图7),则输出缓冲区对应的网络层报文数量O计算为O=烄烅烆L1512()×586M,forExitNodesL2512()×586M,forEntry由式(12)可求出匿名转发节点在T时间内产生的网络层报文数量.基于此,可以度量相应的时间特征差异度,为后续时间特征的相关分析奠定基础.4时间特征的度量与分析本节首先提出一种时间特征差异度度量方法.然后结合式(12),考虑多转发节点串联情形,对时间特征的差异度进行理论推导,解释说明能够借助其来进行匿名通信追踪的原因和影响追踪效果的具体因素.在此基础上,针对ON/OFF流水印模型,推导出在满足一定水印检测率的前提下应调制的报文延时幅度,为后续匿名通信相关研究提供理论和实践指导.4.1时间特征差异度度量网络流时间特征的表示可有以下两种基本方式[14]:报文时间间隔(Inter-PacketDelay)或特定时隙内报文数量(IntervalPacketCount),现有研究工作均基于这两种表示方式提出不同的时间特征计算方法,如流时隙质心等[16].而文献[14]进一步指出,利用报文时间间隔来表示时间特征易受丢包等网络因素的影响,同时可由特定时隙内报文数量推导出近似的报文时间间隔分布,因而论文采用特定时隙内报文数量作为抽取时间特征的依据.记进入匿名通信系统的原始网络流为X,对应离开的匿名通信流为Y,对流X和Y的统计持续时间长度为Tf.时隙长度为T,则将流X和Y分割成Tf/T个互不重叠的时间段.记时间段i内的报文数量为ci将向量犞X和犞Y之间的距离定义为时间特征差异度.本文采用傅立叶变换和欧式距离来度量时间特征差异度.傅立叶变换将时域向量犞X和犞Y转换为对应的频域分布,而频域分布的高频部分可认为Page9是噪声,因而在计算欧式距离时可先去除噪声部分,减少计算量.对向量犞X和犞Y进行离散傅立叶变换:犉犞X(k)=∑Γ-1犉犞Y(k)=∑Γ-1其中,Γ=Tf/T表示分割的时隙数量.VX(n)和VY(n)分别表示向量犞X和犞Y的第n个元素,0nΓ-1.取向量犉犞X和犉犞Y前H位进行欧式距离计算,则时间特征差异度d计算为式中d值越大,表明向量间距离越远,因而差异度越大.当d=0时,表示时间特征完全匹配.图9考虑干扰流的追踪示意图如图9所示,设匿名转发链路上共有l个转发节点,l1,且将从出口节点到入口节点依次编号为1至l.设在T时间内原始网络流含有C个数据包,报文长度为p,CNpkt(C>Npkt等价于C=Npkt),p<M.其中,Npkt表示节点一次最多可读取的数据包数量,M为网络层最大报文段大小.设有m个其它服务器与出口节点进行交互且对应同一个输出缓冲区,且在T时间内各自包含的数据包为CI(i),报文长度为pI(i),CI(i)Npkt,pI(i)<M,0im,m0,且规定CI(0)=0,pI(0)=0,并称此类数据包为干扰数据包.对于该链路出口节点的输入缓冲区,有Ψ=C+∑m报文数量O1计算为O1=L1512(4.2基于时间特征的追踪可行性与影响因素分析本节考虑匿名通信系统数据包调度策略和多跳转发机制,结合4.1节中时间特征差异度计算式(17),推导出时间特征差异度的具体计算公式,从而说明能够借助时间特征来进行匿名通信追踪的原因和影响追踪效果的具体因素.对图1中的追踪框架进行扩充,考虑干扰流对追踪的影响,其示意图见图9.在进行如Web访问等网络活动时,用户可能同时访问多个Web页面,这些Web页面产生的流量则是通过同一个匿名转发链路到达客户端.追踪者一次只能在一个返回的Web流量中抽取报文数量特征或嵌入水印信息(本文称该流为原始网络流),因此其它的Web流量对追踪者而言,则为干扰流.这些干扰流量可能会消除追踪者所关注的时间特征.为便于分析,首先假设O1Npkt,本节最后讨论O1>Npkt此情形.继续考虑匿名转发路径上其它节点.如图9所示,上一跳节点的输出为下一跳节点的输入,设网络传输链路对时间特征的干扰为δ,即在T时间内有O-δ个数据包发送至下一跳节点.传输链路对时间特征的干扰可分为报文丢弃或重传这两类[25],因而δ的取值为整数.Ri+1为在第i+1个转发节点处,其接收到的报文数量由于出口节点数量远小于中间节点,因而可认为出口节点的负载要大于中间节点,即中间节点执行算法1所需的时间T<T.根据式(11)和(12),中间转发节点对应的发送报文数量为(此时g=1):因而在入口节点处对应T时间内观察到的报文数量OA计算:Page10由式(20)递推得OA=Ol=Ol-1-δl-1=…=O1-∑l-1将式(22)代入式(17)计算时间特征差异度:(FTX(k)-FTY(k))槡d=∑H槡=∑H槡=∑HΓnk槡2=∑H槡=∑H=C-O1+∑l-1其中η在H与Γ(4.1节)确定时为常量,计算为槡k=1∑Γ-1η=∑H因而d值仅与C-O1+∑l-1将式(18)代入式(25)并消除常数,得d∝C-式(26)中δl-i为第(l-i)至(l-i+1)个转发节点间对网络传输链路对时间特征的干扰,具体表现为报文丢失和重传.而报文丢失引发相应的重传,因而可认为在时隙T内丢弃的报文数量|q|和重传的报文数量|r|服从同一概率分布[26],即r=-q,因此E(δ)=E(q+r)=0,从而有据此,将式(26)化简为在解释基于时间特征匿名通信追踪的合理性时,首先假设不存在干扰流,这些干扰可作为影响追踪效果的具体因素进一步加以考虑,进而化简式(29)为由式(29)知,差异度d值仅与流本身的特征相关,如报文数量和报文长度等.论文重点关注时间特征(在分析影响追踪效果的具体因素时再考虑报文长度),合理设定p为定值,因此影响d值的因素仅有特定时隙T内的报文数量C.易知,d值与C成正相关性,即随着C值的增大而增大,C值的减小而减小.因而可推出Tor匿名通信系统对时间特征有着两种不同的改变效果.当原始网络流中T时隙内报文数量越多,经Tor传输后其匿名通信流对应的时隙内报文数量也就改变越大,因此产生“平滑”效果,对此类时间特征的改变程度较大.但当原始网络流中T时隙内报文数量越少,Tor对其改变的程度也就越小,从而又维持了此类时间特征的延续性,这便为基于时间特征的追踪技术提供了可行性基础.通过延迟报文调整单位时间内的报文数量已成为基于时间特征的主动匿名通信追踪常用方法[13,17],而被动匿名通信追踪也借助原始网络流本身的此类特征(如特定时隙内无报文)来增加追踪效果[3,8],现有追踪技术的具体实施也体现了上述理论分析的正确性.下面分析影响追踪效果的具体因素.记表示干扰强度,即表示在封装成Tor信元时缓冲区中干扰数据包对原始网络流中数据包长度的改变程度.为表述简洁,令y=C-即式(28)可表示为由式(30)~(32)可进一步推导出影响匿名通信追踪效果的因素,具体表述为以下3个命题.命题1.在无干扰网络流和原始网络流流速率一定时,时间特征差异度随报文长度增大而递减.证明.无干扰网络流,即m值为0.此时无干扰数据包,由式(30)得z=0,从而化简式(31)为因为原始网络流流速率一定,即C×p为定值,因而当报文长度增大即p值增大时,C值便减小.而M为网络最大报文段大小,取值固定,因此由式(33)得Page11C值减小使得y值减小(C×p/M为定值).由式(32)知,d正比于y,因而y值减小即d值减小,即时间特征差异度随报文长度增大而递减.证毕.命题1的本质仍然是C值减小从而d值减小,但表明除延时报文外,可通过增大报文长度方式来实现减小C值.可将原始网络流中多个数据包合并为一个数据包,增大报文平均长度,从而减少时间特征差异度.命题2.在原始网络流中数据包数量和长度一定时,随着干扰强度z值的增大,时间特征差异度呈现先减小后增加的趋势.证明.原始网络流中数据包数量和长度一定,即C和p值(p<M)一定,由式(30)知影响干扰强度z值的因素有干扰流数量m、干扰数据包数量CI(i)和其长度pI(i).首先分析干扰流中数据包数量和长度一定时,即CI(i)和pI(i)值一定时,由式(30)可得干扰流数量增多,干扰强度增大.即m值增大,z值增大.在式(31)中,若p+zM,即输入缓冲区中报文长度小于网络最大报文段的值,则随着z值的增大,1-(p+z)/M值减小,从而y值减小.由式(32)知,d值减小,即时间特征差异度减小.而当p+z>M时,式(31)中1-(p+z)/M值为负数,随着z值的增大,其绝对值|1-(p+z)/M|增大,从而y值增加.由式(32)知,d值增大,即时间特征差异度增加.同理,当m值一定时,随着CI(i)或pI(i)值增大,d值变化趋势相同.命题2表明在一定范围内(p+zM),干扰数据包有助于减少时间特征差异度.追踪者可以预先对目标网络流的报文长度特征进行判断,若报文长度较小,追踪者可以使用相同Tor链路进行匿名访问,从而增强追踪效果.命题3.Tor转发节点的数据包处理速率越慢,时间特征差异度越大.证明.为分析不同的转发节点处理速率对时间特征差异度的影响,规定网络流的流速率一定,且干扰流的数量和报文长度等参数为定值.转发节点的处理速率变小,即μ值减小,由式(4)知,T值增大,即调度一次所需时间增加.不失一般性,令调度时间增加k倍,从而增大后的调度时间为k×T.由于原始网络流流速率一定,调度时间增大,则由式(5)可得出该时间内到达缓冲区的数据包数量增加,即C和CI(i)值增大,且同增加k倍.报文长度pI(i)、干扰流数量m值一定,而C和CI(i)值同增加k倍,从而式(30)中z值不变.M为网络最大报文段大小,取值固定.考察式(31),p、z和M值一定,C值增大使得y值增大.由式(32)得,d正比于y,从而推出μ值减小使得d值增大,即Tor转发节点的数据包处理速率越慢,时间特征差异度增大.命题3表明若Tor程序构建的匿名转发路径上有负载重、数据包处理速率慢的节点或有较多突发流量产生(突发流量可以增加缓冲区队列数量,从而加重节点负载)则会降低匿名通信追踪效果.因而在执行追踪前可首先观察监控目标处Tor程序构建匿名转发路径时各协商交互(见图3)所需的时间,若其中有时间间隔较大者则认为该路径上存在数据包处理速率较慢节点,然后通过伪造网络连接断开(如发送RST报文)等隐蔽方式使得该路径失效.而监控目标处Tor程序会重新选择其它转发路径继续进行数据传输.追踪者重复进行上述操作直至新的路径适合开展匿名通信追踪,从而提高追踪准确性.以上分析均在O1Npkt该条件下,现考虑O1>当O1>Npkt时,出口节点处的匿名通信流中TNpkt此情形.时间内包含Npkt-∑l-1征差异度计算为槡d=∑H=C-Npkt+∑l-1式中η如式(24)所示.与式(31)类似,令显然,上述命题1和3同样成立.但因Npkt为定值,命题2不再成立.式(35)表明干扰数据包超过一定数量后,对时间特征便无影响.这也解释了文献[3,25]中所观察到的增加干扰流并不能完全消除时间特征的关联性.4.3ON/OFF流水印模型调制时间分析上一节中分析指出,若原始网络流T时隙内(即Tor节点轮询调度一次所需的时间)报文数量越少,则Tor对其改变的程度也就越小.特别的,当T时隙内无任何报文且不存在其它干扰流时,匿名通信流对应时隙内也将无报文出现,这为流水印信号的嵌入提供了有利条件.如追踪者可以对原始网络流进行调制以形成一些无报文出现的空时隙,然Page12后在目的端检测出这些空隙从而完成匿名通信关系的确认.但为在网络流中形成特定时长(不仅仅是T)的空隙,需要对原始网络流报文时间进行调制的具体幅度仍无相关研究.为此,本节在4.2节基础上,假设网络延时抖动服从拉普拉斯分布[27-28],进一步分析对原始网络流中报文时间进行调制的幅度,使得追踪者能够在匿名通信流中形成与调制幅度相同的空隙,从而嵌入一定水印信号并进行匿名通信追踪.论文选择的研究对象为ON/OFF流水印模型.ON/OFF流水印模型[8-9]的基本原理可表述如下:追踪者以时间长度为τ的时隙片段作为水印信号的嵌入对象.为嵌入水印信号‘1’,追踪者在时隙开始处发送一个或多个报文;为嵌入水印信号‘0’,追踪者则在该时隙内不发送任何报文.在恢复水印信号时,将接收到的网络流划分为多个时间长度同样为τ的时隙片段.若当前时隙片段内有报文出现时,便为ON模式,此阶段可编码为信号‘1’.若时隙片段内无报文出现,便进入OFF阶段,编码为信号‘0’.如能全部恢复出嵌入的水印信号,则追踪成功.图形示意见图10.图中τ表示时隙长度,tS报文的发送时刻,tA表示水印检测的起始时间.在基于时间特征的主动流水印追踪技术中,ON/OFF模型是基本的追踪方法,而其它追踪技术可认为是对该模型的改进[18,20-22].如将OFF阶段的条件放宽,当报文数量较少时便可编码为信号‘0’(流速率模型[19,22]),或者以报文集中位于时隙后半段为OFF阶段,并将ON与OFF阶段的报文相对时间差作为水印载体(时隙质心模型[6-7,18,21]),从而提高检测率.因此ON/OFF模型具有代表性,对其展开深入研究具有重要意义.如图10所示,成功嵌入ON/OFF流水印信号的关键步骤是时隙τ的选择.若τ值过小,则时间点2可能会落入其前一个时隙,从而恢复水印失败.若tAτ过大,虽能有效嵌入和提取水印信号,但同时使得水印信号的隐蔽性变差.为此,论文给出在需满足一定水印信号检测率Prτ的前提下所需调制的τ的最小值.为便于分析,本文采用与文献[9]相同的水印嵌入方法,即针对原始网络流,在ON阶段的起始时刻发送一个报文,即在图10中有tS段不发送报文,ON和OFF阶段的持续时间为τ.在相应匿名通信流中,首先确定信号检测的起始时刻ts,然后以τ为时间间隔,将统计时隙内是否有报文出现.若有,则提取信号‘1’,否则,提取信号‘0’,直至恢复出所有水印信号.与4.2节相同,规定匿名转发链路上共有l个转发节点,l1,且将出口节点到入口节点依次编号为1至l.各节点的数据包调度时间为Tk(0kl-1),Tk的估算公式为式(4).服务器与出口节点、转发节点之间的单程传输时延为hk.定义表示匿名转发路径上各节点调度时间的最大与最小值.考虑水印信号‘101’,即两个ON阶段间含有1个OFF阶段.规定水印信号的检测率至少为Prτ(Prτ>0.5,否则没有实际意义).需要注意的是由于τ值与具体水印信号无关,因而针对水印信号‘101’得出的结论同样适用于其它不同的水印信号.具体的,在满足检测率至少为Prτ的前提下,所需调制的τ的最小值如命题4所示.命题4.在满足检测率大于等于Prτ的前提下,所需调制的τ的最小取值为τmin=lβ×2(1-Prτ)(lnA2+1示Tor匿名转发路径长度,A计算为A=expTmax-Tmin+α(抖动分布的位置参数和尺度参数.证明.由3.2节分析易知:否则前后两个报文将在Tor输入队列中重叠,不可能形成OFF阶段,从而嵌入水印信号‘0’失败.如图10所示,为在匿名通信流中成功恢复出水印信号‘101’,需满足以下两个条件:由式(39)、(40)可得Page13即而tS其中,r1和r2分别表示第1个和第2个报文从源端经Tor传输至目的端所需要的时间.由于Tor调度和网络传输抖动的影响,r1和r2的值可能并不相等.由式(43)知,τ值越大,r2-r1的值包括在[-τ,τ]中的可能性就越大,从而成功恢复出水印信号的几率也就越大,符合直观判断.ri(i=1,2)计算为k表示第k个节点处理第i(i=1,2)个报文所其中,εi需的时间,hi至第k+1个节点所需的网络传输时间,从而式(43)计算为令j=h2献[27-28]知,j服从位置参数为α,尺度参数为β的拉普拉斯分布f(x|α,β)=1∑l(ε2k-ε1k=1延时幅度的下限,因而令x=l×(Tmax-Tmin+j)表示最大抖动情形的变量,则x的概率密度函数为f(x)=1若满足水印检测率至少为Prτ,即式(43)成立的概率大于等于Prτ,应有因为Prτ>0.5,从而有τ>l×(Tmax-Tmin+α),进而式(47)计算为∫τ-τf(x)dx=∫l(Tmax-Tmin+α)∫τl(Tmax-Tmin+α)-τ对式(48)进行积分运算得1-1expl(Tmax-Tmin+α)-τ令A=expTmax-Tmin+α(同时,结合式(38)知,在τminTmax/4时,可得出为满足检测率大于等于Prτ所需调制的τ的最小取值为式(51)中Prτ为追踪者所自行设定的参数,l表示Tor匿名转发路径长度,其默认值是3,因而可认为是定值.为得出τmin值,追踪者需要知道Tmax,Tmin,α,β等参数的值.针对Tmax,Tmin值,可利用Tor本身的调度策略来获取.如3.1节中图8所示,针对每一链接,Tor轮询调度完成后才进行该链接的下一次数据包处理.因此可统计与追踪目的端交互的Tor节点的报文调度时间间隔,然后取最大时间间隔为Tmax值,最小时间间隔为Tmin值,从而确定这两个参数的具体数值.针对α,β的取值,追踪者可通过观察追踪目的端与Tor节点的网络连接,统计报文的单程传输时间,计算出延时抖动的值,然后采用最大似然估计法计算出α,β值.具体的,α取为样本中间值,β计算为β=1样本数量.根据文献[28],在大多数网络情形下,网络传输延时抖动分布的α值等于0,可进一步简化计算.5实验实验的网络环境设置如图11所示,在客户端和服务器处分别运行Socket程序.客户端通过Tor匿名通信系统与服务器端相连接,发出下载数据请求和报文时间间隔参数,而服务器端则根据接收到的参数生成具有不同时间特征的返回数据.客户端根据配置参数可运行多个下载数据进程以模拟干扰数据包.同时,在客户端和服务器处运行Tcpdump程序记录网络层报文,统计特定时隙内报文数量,并借助Matlab程序计算快速傅立叶变换和时间特征的差异度.根据文献[29],61%Tor节点调度一次所需时间小于100ms,7.5%的节点所需时间大于Page14450ms;而对于Tor出口节点,40%的节点所需时间大于1000ms.因而在实验中首先通过统计Tor流量的报文调度时间间隔,选择间隔平均值接近0.1s、0.5s和1s的Tor链路进行测试以反映不同的实验环境.在计算式(17)时H取值为8,并且进行傅立叶变换时除去了信号直流分量.实验中Tor匿名转发路径的长度为默认值,即为3.首先对式(29)进行验证.由式(29)知,在无干扰数据包时,可通过调整报文时间间隔来减小C值,降低时间特征的差异度,从而达到匿名通信追踪目的.实验中通过设置不同报文时间间隔来体现特定时隙内报文数量的减少.报文时间间隔设置为10~70ms,报文长度固定为498字节.由式(17)计算时间特征差异度,式中H取值为8,并且计算时除去直流分量.实验结果如图12所示.实验结果表明随着报文时间间隔的增大,时间特征的差异度减小,与4.2节中的理论分析相一致.当报文时间间隔大于60ms时,差异度值约等于6,其物理含义可解释为对于提取的原始网络流时间特征,匿名通信系统有1/3的概率对每一T时隙内增加、减少一个报文或不改变报文数量(此时计算出的差异度值为7),即匿名通信系统维持流原始时间特征基本不变,因而可以借助时间特征来进行匿名通信追踪.此外,从图12也可看出轻负载的Tor链路的时间特征差异度较小,适合用于匿名通信追踪.图12差异度随报文时间间隔的增加而递减命题1表明在网络流速率一定情形下,可通过合并原始网络流中数据包方式来减少时间特征的差异度.实验中流速率固定为100Kbit/s,报文长度设置为100~600字节,实验结果如图13所示.实验结果表明随着报文长度的增加,时间特征的差异度值亦同步递减,与命题1的结论相一致.结合式(35),命题2表明随着干扰数据包的增多,时间特征的差异度呈现先减小后增加,最后趋于平稳状态.实验中通过在客户端发起多个下载数据连接以反映出干扰数据包对差异度的影响.正常数据流的参数设置为报文时间间隔为30ms,报文长度为1~1360字节间的随机分布;干扰数据流的参数设置为报文时间间隔为100ms,报文长度同样为1~1360字节间的随机分布.实验结果如图14所示,横坐标为干扰数据流的数量,纵坐标为对应计算出的差异度.实验结果表明随着干扰数据流数的增加,即干扰数据包的增多,差异度呈现先减小后增加,最后趋于平稳状态,与命题2的结论相一致.在干扰数据流数量固定时,增加干扰数据包的数量或数据包长度与图14有类似结果,由于篇幅限制,省去相应的实验结果图.Page15命题3指出匿名通信链路上若有重负载的转发节点会增加时间特征的差异度.实验在配置的内网Tor环境中完成.固定Tor匿名通信链路的出口节点,借鉴文献[30]中提出的阻塞攻击思路,在出口节点上部署一Socket服务器端程序,该程序接收客户端发送的多组数据,并对接收到的数据执行RSA非对称密钥加密操作,最后将加密后的数据返回至客户端.通过加密和接收/发送报文操作增加转发节点的系统负载,从而降低Tor程序数据包处理速率.返回数据流的参数设置为报文时间间隔为30ms,报文长度为1~1360字节间的随机分布.实验结果如图15所示,横坐标为客户端数量,纵坐标为对应计算出的差异度.实验结果表明随着转发节点系统负载的加重,差异度增加,与命题3相一致.图15差异度随转发节点负载的增加而递增对命题4进行实验验证.通过Tor下载FTP数据,在FTP服务器端对报文的发送进行调制,从而实现ON/OFF水印嵌入.首先按照4.3节中提出的参数估计方法,对Tmax,Tmin等值进行估计,估计结果值为Tmax=115ms,Tmin=96ms.同时,根据文献[28]取α=0,β=4.实验中设定需满足的水印检测率Prτ为0.8.此时,按式(51)计算出的τmin理论值为68ms(图16中星点所示).由式(38)知,τ的最小值为29ms.因此实验中τ值从29ms,每隔10ms递增至99ms.嵌入的水印信号为‘(101)50’,即重复‘101’信号50次.统计成功检测出‘101’信号的次数,并除以50以作为检测率Prd.实验结果如图16所示.实验结果表明当τ值大于等于69ms时,总能满足检测率大于等于0.8,验证了式(51)的正确性.同时,图16也表明了随着τ值的增大,成功恢复水印信号的次数增多,与式(43)的含义相一致.6结束语论文以Tor匿名通信系统为研究对象,对洋葱路由追踪技术中时间特征展开理论分析.深入分析Tor数据包调度策略,建立其算法模型,提出数据包输入和输出缓冲区的平均队列长度和对应的网络层报文数量估算方法.在此基础上,结合提出的时间特征差异度度量方法,得出可借助时间特征来进行洋葱路由追踪的原因、影响追踪效果的具体因素和为嵌入水印信号所需的报文延时调制幅度.主要结论有:(1)时间特征差异度与调度时间T内的报文数量成正相关,因而可推出Tor匿名通信系统对时间特征有着两种不同的改变效果.当原始网络流中T时隙内报文数量越多,经Tor传输后其匿名通信流对应的时隙内报文数量减少越多,对此类时间特征改变程度较大;但当原始网络流中T时隙内报文数量越少,Tor对其改变的程度也就越小,从而又维持了此类时间特征的延续性,为基于时间特征的追踪技术提供了可行性基础.(2)在无干扰网络流和原始网络流流速率一定时,时间特征差异度随报文长度增大而递减.因而可通过合并报文以增大报文长度等方式来增强匿名通信追踪效果.(3)随着干扰强度的增大,时间特征差异度呈现先减小后增加趋势,并最终趋于稳定状态.追踪者可以预先对目标网络流的报文长度特征进行判断,若报文长度较小,追踪者可以使用相同Tor链路进行匿名访问,从而增强追踪效果.(4)在数据包速率和平均长度一定的条件下,转发节点的数据包处理速率越慢,时间特征差异度越大.可首先观察监控目标出匿名转发路径建立时的时间特征来判断该转发路径上是否存在数据包处Page16理速率越慢节点,然后通过使转发路径失效等方式选择新的、适合的路径进行匿名通信追踪,提高追踪准确性.(5)在满足ON/OFF流水印的检测率大于等于Prτ的前提下,报文调制时间τ的最小取值为τmin=lβ×lnA2+1论文通过Tor实验环境验证了上述结论的正确性.下一步研究工作包括:在理论研究成果基础上,进一步设计新的流水印追踪技术,并通过在实际网络中的部署对本文工作进行更全面的验证;研究新的匿名通信数据包调度策略(如在无报文的时隙内增加适量填充报文等),在保证性能的同时,能最大程度改变时间特征,从而更好保护互联网用户的隐私信息.
