Page1对等网络中一种优化的副本分布方法孙新李庆洲赵璞王克祥潘凡(北京理工大学计算机学院北京市海量语言信息处理与云计算应用工程技术研究中心北京100081)摘要数据复制技术是一种提高P2P系统中数据可靠性和可用性的常用策略.现有复制方法大多只考虑副本数量,副本数量越多就越能提高资源访问效率,但采用这样的数据复制方法将会带来高昂的副本一致性维护代价.为平衡副本一致性维护的开销和多副本带来的访问性能提升之间的关系,该文提出了动态副本分布方法.文中首先给出了副本目录的设计和副本信息的获取方法,能够获得某一逻辑资源的所有副本信息.然后,根据逻辑资源的全局副本信息,对访问频率高且平均响应时间长的数据资源进行复制,并给出副本数量的计算方法.最后,根据用户访问特征和节点实时带宽等信息计算放置副本的最佳地点,使副本分布能够适应数据访问请求和网络带宽的动态变化.模拟实验结果显示,该方法能够实现全局优化的副本分布,以少量数据副本提升资源访问的性能.关键词对等网络;数据复制;副本分布;副本放置;副本数量;物联网1引言作为一种分布式体系结构模型,对等计算模式(Peer-to-PeerComputing,P2P)强调资源的全面共享,无须依赖集中式服务器的支持,实际应用非常广泛.在基于对等网络的分布式系统中,数据复制是提高数据可用性和数据访问性能的重要技术.通过为共享资源提供多个数据副本,可以有效减少数据传输时间和带宽消耗,提高数据资源的访问效率和系统容错性.数据复制技术在很多分布式系统中都有广泛应用,如数据网格[1-3]、P2P系统[4]、云存储系统[5-7]等.现有数据复制技术主要包括随机放置副本的策略[8-9]和集中式的数据复制方法[10-12]等.随机方法通常在查询路径的每个节点上创建副本,或者在路径的两端创建副本,为提高数据响应时间,在资源搜索过程中动态、后发性地进行数据复制,通常只考虑副本的数量,而不考虑副本位置的差异.集中式的数据复制方法实现简单,适用于性能高且稳定的分布式系统.另外,有些数据复制方法依据特定评价标准,如副本利用率[13]、副本访问情况[14-15]等进行数据复制,从局部信息出发、在特定评价标准下制定数据复制策略,这类方法扩展性比较差,不能保证副本的全局优化,也无法跟踪副本的利用情况.有些研究者将工作重点放在研究副本数量的问题上[16-17],实质是在给定存储空间限制、访问频率分布和数据大小分布的情况下,求解最优数据副本分布,这类方法更适用于理论研究.此外还有些工作围绕数据复制过程中的副本一致性问题展开研究[18].在实际P2P系统中,由于节点的动态性、异构性以及网络实时带宽的影响,不同数据副本的访问代价差异很大.数据复制技术需要同时考虑副本数量和副本位置这两方面因素来优化数据访问性能:(1)不同的数据资源所需要的副本数量是不同的,副本数量越多就越能提高资源访问效率,这是显而易见的,但采用这样的数据复制方法将会带来高昂的副本一致性维护代价.对热点资源分配多的副本可以更好地改进资源的访问性能,这属于副本分配问题;(2)相同的数据副本放置在不同节点上,其访问性能也有很大不同,这属于副本放置问题.在实际应用中资源的访问请求并不是平均分布的,数据资源的访问往往呈现出很明显的局部性特征.副本分布应该遵循数据访问的局部性特征,从全局角度、根据访问请求的变化和网络的实时通信状况实现动态副本分布.因此,数据复制技术需要解决的是如何确定副本的全局分布和副本数量,最大程度降低逻辑资源的全局平均访问代价.为平衡副本一致性维护的开销和多副本带来的访问性能提升之间的关系,设计全局优化的副本分布方法是本文工作的重点.在已有研究基础上[19],本文进一步给出副本数量和副本位置的计算方法,提出最小访问代价的数据复制策略(MinimumAccessCostbasedReplicationstrategy,MACR).通过计算共享资源的全局访问代价,从系统全局角度以少量数据副本获得平均访问延迟最小目标下的副本优化分布.MACR方法首先给出了副本目录的设计和副本信息的获取方法,能够获得某一逻辑资源的所有副本信息,该方法适用于任何覆盖网络结构的P2P系统;然后,根据数据的全局访问频率和平均响应时间计算副本数量;为获得优化的副本位置,引入复制因子的概念,根据用户访问特征和节点实时带宽等信息计算放置副本的最佳地点.MACR方法能够有针对性地进行主动数据复制,并动态地适应访问请求的变化和网络通信状况.模拟实验结果显示,MACR能够实现副本的优化分布,在提升资源访问性能提升和控制副本数量之间获得良好的平衡.2相关工作数据复制的核心问题在于副本数量和副本位置的确定.现有复制策略大多采用随机放置策略,例如,全分布无结构P2P系统中的复制策略[8]有拥有者备份策略、随机备份策略和按路径备份策略.资源请求比率相关的备份策略[9]根据资源被请求的比率来决定资源备份的数目,包括均衡分配、成比例分配和平方根分配3种方式,但由于每个资源的请求比率难以正确估计,在实现上存在难度.文献[11]给出一种集中式的方法能够减少整个数据文件的访问延迟,并给出分布式缓存方法.文献[3]采用启发式副本放置算法最小化通信代价和访问延迟,但该方法仅孤立考虑每个聚簇(cluster)中副本的数量和位置,没有考虑整个分布式系统内副本分布问题.文献[12]给出了一种在云计算环境下的数据分配模型,考虑了存储代价、计算代价、延迟和带宽4个因素,能够根据用户需求提供带宽或访问延迟代价最小目标下的最优存储设备,该方法主要局限性在于需要依靠云服务提供商提供准确的全局信息.类似的还有针对数据密集型应用的资源Page3放置方法[10]和适用于云存储系统的副本放置模型CDRM[5].这些集中式的方法实现简单,但不适于实际的系统.EAD[13]通过选择合适的查询中转节点增加频繁访问的文件副本的利用率,并动态适应文件的流行程度和节点的兴趣.LALW[14]根据历史访问记录分配不同的权重,最近访问的数据拥有较大的权重,以此为依据对流行的数据文件进行复制.这些方法仅从节点的局部信息出发、在特定评价标准下制定数据复制策略,扩展性比较差,不能保证副本的全局优化.在分布式系统环境下,准确估计数据资源所需的副本数量是非常重要的.一些学者从求解最优副本分布的角度展开研究工作[16-17].文献[16]的研究结果表明,最优搜索性能所对应的副本分布是比例复制;若查询负载最优,对应的副本分布是平方根复制.Cohen和Shenker认为[9],为了降低平均搜索范围,每个数据的副本数量正比于其数据大小,正比于其访问频率的平方根时平均搜索范围将最小.而文献[17]针对文献[9]给出的结论,提出不同观点:在面向搜索范围最小化的副本数量分布中,每个数据的副本数量应反比于数据大小的平方根.这些工作仅讨论副本密度对搜索性能的影响,忽略了副本位置对资源访问性能的影响.基于位置信息与文件流行度的副本管理算法[15]根据文件的访问频率,利用类Zipf分布来估计副本的个数,该方法的局限性是缺乏副本定位机制,只能在假设用户请求是均匀分布的基础上依据节点局部信息计算副本数量,这与实际应用中数据访问的局部性特征并不一致;副本放置采用的原则也仅是将数据放置在距离需要的用户最近的节点上.综上所述,已有的数据复制方法存在以下问题:(1)现有方法通常假定共享的数据资源是静态的和只读的,单纯追求副本数量提高资源访问性能.但对于拥有可更新数据资源的分布式系统来讲,采用这样的数据复制方法将会带来高昂的副本一致性维护代价,而当前研究很少考虑这个问题.(2)由于大规模动态环境下难以拥有全局副本信息,所以目前研究成果多是基于本地信息或局部信息,在特定评价标准下制定数据复制策略,不能保证全局优化,扩展性比较差.(3)现有方法多数只考虑副本数量上的差异,不考虑副本位置的差异.而在实际动态、异构的分布式系统中,访问不同副本所带来的访问代价差异很大,因此,数据复制技术需要同时考虑副本数量和副本位置来优化数据访问性能.本文提出的MACR方法能够从全局角度、根据访问请求的变化和网络实时带宽状况进行动态数据复制,通过数据的访问频率和平均响应时间动态计算副本的数目,优化副本位置,以尽可能少的副本数量降低资源访问时间.3基于双向链表的副本目录理论上,只要能够拥有数据资源在P2P系统内的全部副本信息,就可以制定最优的数据复制策略.问题在于,分布式异构的环境中节点频繁的加入和退出,获得数据资源的所有物理副本信息是非常困难的.为了能够在缺乏全局集中的副本管理器的情况下获得资源的全部副本信息,本文设计一种基于双向链表的副本目录结构,逻辑资源的副本目录与其副本所在物理节点之间形成了一个正向链表,可以获得每个副本的具体访问情况;每个副本与该逻辑资源的副本目录之间的反向链表可以从副本快速链接到逻辑资源的副本目录,获得该逻辑资源的全部副本信息.副本目录记录副本的所有访问信息,如副本所在位置、副本访问频率和副本响应时间等,为优化副本分布策略提供依据.基于双向链表的副本目录结构是定义和建立在覆盖网络结构之上的,不依赖于具体的覆盖网络结构,因此,适用于任何P2P覆盖网络结构.3.1副本目录的结构首先,对副本定位问题给出以下形式化定义.定义1.系统中所有共享的资源,包括文件、数据库、数据表等,都可抽象表示为逻辑资源(LogicalResource),每个逻辑资源具有全局唯一的逻辑资源名(LogicalResourceName,LRN).定义2.每个逻辑资源可以有一个或多个物理副本(PhysicalReplica),简称为副本.每个副本具有全局唯一的物理副本名(PhysicalReplicaName,PRN).系统中首次注册的资源称为该逻辑资源的正本(original).逻辑资源lrName的所有副本的集合记做LR(lrName)={pr1,pr2,…,prn},其中n是逻辑资源lrName的副本数量,n1.同一逻辑资源的各个副本的逻辑资源名相同,但物理副本名PRN不同.网络中的每个节点都维护一个本地副本目录.本地副本目录保存着本地拥有的共享资源的信息,包括数据资源的逻辑资源名LRN、对应的物理副本名Page4PRN、正本或副本标识等信息.这里,正本可以看作是特殊的副本.下面,通过描述副本目录的建立过程给出副本目录的结构设计.(1)当节点注册一个共享资源时,副本管理服务给该数据资源分配一个逻辑资源名LRN,同时分配一个物理副本名PRN,并做“正本”标识;(2)动态创建副本时,副本管理服务给该副本分配一个物理副本名PRN,并将这个PRN与该资源的逻辑资源名LRN建立映射,做“副本”标识,记录该逻辑资源的正本信息.同时,副本管理服务将这条副本信息插入到正本所在的副本目录中.这种副本目录结构称为双向链表的副本目录.因此,在正本所在的副本目录中,即逻辑资源的副本目录,正、副本所在物理节点之间形成了一个正向链表,正向链表结构提供了该逻辑资源在全局范围内的所有副本的视图,在副本选择时可以提供全局意义下的最小代价副本.每个物理副本的副本目录到逻辑资源的副本目录之间的反向链表,可以从某一副本快速链接到逻辑资源的副本目录,便于实现副本创建.逻辑资源的副本目录拥有该逻辑资源的所有物理副本的相关访问信息,它构成了该逻辑资源的完整的副本视图,能够为全局优化的副本分布提供充足的依据.3.2副本目录信息的链式获取方法为了获得逻辑资源在全局范围内的访问信息,需要通过副本服务获得和维护副本目录信息,承担副本创建和管理的工作.下面,在P2P系统的覆盖网络基础上对网络模型做进一步约定,确定节点之间的关系、明确各类节点在副本管理中承担的职责:(1)确定超级节点.超级节点由功能强、带宽高、在线时间长的节点承担,负责数据复制和副本管理等工作.其他节点称为普通节点.(2)每个普通节点可以同时与多个超级节点相连,但只能选择其中1个超级节点作为其父节点.(3)每个超级节点可以同时与多个超级节点相连,但只能选择其中1个或0个超级节点作为其父节点.没有父节点的超级节点称为域超级节点,域超级节点及其所有子节点形成的节点集合称为域.(4)网络中所有超级节点之间的父子关系不能形成回路.这里给出的约束条件并没有改变系统的覆盖网络结构,只是在覆盖网络结构之上定义了节点之间的父子关系,因此适用于任何P2P覆盖网络结构.在广域网范围内确定域超级节点比较费时,并且在缺乏集中管理器的动态分布式环境下,判断超级节点之间的父子关系是否形成回路较复杂,因此,在实际应用中可以采用自荐或预先指派的方式确定超级节点和域超级节点,由域超级节点负责回路的判断,这种方法实现简单且符合实际应用的特点.图1(a)显示了一个任意的P2P覆盖网络模型,依据上述约束条件确定的父子节点关系如图1(b)中箭头所示,域超级节点A和B管理的域如图1(b)中虚线所示.为避免单点失效问题,实际应用中还需要提供域超级节点的冗余备份机制,实现节点的失效恢复.对于超级节点来讲,本地副本目录除了保存本地拥有的共享资源的信息之外,还包括它的子节点的副本目录信息.节点在注册共享资源时,如果这个节点是超级节点,则副本管理服务将这个新的副本数据插入到该节点的本地副本目录中,否则插入该节点的父节点的副本目录中.按照这种副本信息的收集和获取方法,逻辑资源的所有访问情况都会记录到对应的副本目录中,包括哪个节点发起的请求、访问了哪个物理副本、资源实际响应的时间、节点的实时网络带宽以及节点上的等候队列长度等.超级节点负责本地正本资源和子节点中普通节点的正本资源的数据复制,统计资源在全局范围内的访问情况.因为每个普通节点只有一个父节点,所以每个超级节点负责管理的共享资源之间没有交Page5集,不会出现同一逻辑资源的副本由多个超级节点管理的情况.域超级节点负责统计本域内节点对某一逻辑资源的访问频率和访问代价等信息.因为每个超级节点只能有一个父节点或没有父节点,因此,域和域之间的节点没有交集,不会存在某一逻辑资源的访问情况被重复统计的现象.4全局优化的副本分布方法最小访问代价的数据复制方法MACR的主要思想是:首先,根据逻辑资源的全局访问代价确定是否创建副本;然后,对于需要创建副本的逻辑资源,统计不同域内的节点对该资源的访问代价和频率,在平均响应时间大的域内创建副本会最大程度减少逻辑资源的平均响应时间,并给出副本数量和副本位置的计算方法.从系统全局角度利用较少的副本数目降低资源访问时间,实现全局优化的副本分布.4.1副本缺乏资源在广域网环境中分布着数量庞大的数据资源,如果不加限制地对每个资源进行复制会造成存储空间的巨大浪费.MACR方法以降低逻辑资源的全局访问代价为目的,综合考虑数据访问频率、节点负载和实时带宽等因素,对访问频率高且平均响应时间长的数据资源进行复制.引入记号:对于逻辑资源LRj,其物理副本记做PR0,PR1,…,PRn,物理副本所在的节点记做P0,P1,…,Pn,其中n是逻辑资源LRj的副本数量.下面给出相关定义.定义3.在单位时间内,访问逻辑资源LRj副本的次数与副本数量的比,称为逻辑资源LRj的访问频率(AccessFrequency,AF),记作AFj.计算方法如式(1)所示:其中,Timej,i是单位时间内访问逻辑资源LRj的物理副本PRi的次数,n是逻辑资源LRj的副本数量.如果逻辑资源LRj的访问频率AFj大于预先给定的阈值ωAF,称逻辑资源LRj为热点资源.这里,用访问逻辑资源LRj所有副本的总次数与副本数量之比计算逻辑资源的访问频率,强调了副本的平均利用情况.如果某个逻辑资源的访问次数很高,但其副本数量也很多,那么这个资源就不是热点资源.定义4.从资源请求方提出资源访问请求的时刻开始,到资源请求方接收到全部数据为止经过的时间记为资源响应时间(ResponseTime,RT).定义5.单位时间内,访问LRj所有副本的响应时间之和与访问次数之比,称为逻辑资源LRj的平均响应时间(AverageResponseTime,ART),记作ARTj.计算方法如式(2)所示:其中,Timej表示单位时间内资源LRj所有副本被访问的次数.RTk表示单位时间内第k次访问逻辑资源LRj某副本的响应时间.需要创建副本的逻辑资源首先应该满足是热点资源,对热点资源创建副本可以在很大程度上减少数据访问时间、提高系统整体性能.对于每个热点资源,还需要进一步判断资源的平均响应时间,才能确定该资源是否需要创建副本.资源的响应时间取决于很多因素,包括带宽、节点性能等,也包括数据资源的大小.物理尺寸越大的逻辑资源,平均响应时间有可能也大,但这并不说明该资源的副本数量不够,所以,还需要引入单位平均响应时间来判断逻辑资源是否需要创建副本.定义6.对于热点资源LRj,如果则称逻辑资源LRj为副本缺乏资源(ReplicaScarceResource).ωRT是预先给定的阈值,filesizej是逻辑资源LRj物理文件大小.需要为副本缺乏资源LRj创建副本.这里,同时使用两个评判指标即访问频率高和单位平均响应时间长作为是否需要创建副本的判断依据,而不是单一使用某一个评判指标.理由是:访问频率低的数据资源自然不需要创建过多的副本;对于访问频率高的资源,如果其单位平均响应时间比较小,说明在整个系统内访问该资源的代价并不大,也不需要创建新的副本.因此,对访问频率高并且单位平均响应时间长的逻辑资源进行副本创建是合理的.4.2全局副本数量(1)确定缺乏副本的域.基于双向链表的副本目录结构能够保证负责管理某一逻辑资源的超级节点拥有该逻辑资源的所有副本信息,包括何时、从哪个域的哪个节点发出过请求、访问了哪个物理副本以及响应时间等等.Page6对于每个需要创建副本的逻辑资源LRj,超级节点P根据副本目录中记录的副本访问情况,计算全局范围内逻辑资源LRj的平均响应时间ARTj以及每个域(记做Dk)内节点访问逻辑资源LRj的域平均响应时间ARTj,Dk,计算方法如式(4)所示.其中,RTj,i是域Dk内节点Pi访问资源LRj的响应时间,Timej,Dk是单位时间内域Dk内所有节点访问数据资源LRj的次数.如果ARTj,Dk>ARTj,则称域Dk为副本缺乏域.域内节点请求该资源的平均响应时间(即域平均响应时间)能够综合反映该域对资源LRj的缺乏程度和访问热度.如果某个域平均响应时间大于逻辑资源LRj的平均响应时间,说明相对系统内其他区域的节点,域Dk内该资源的副本数量过少,需要在域Dk内增加资源LRj的副本.在平均响应时间大的域内创建副本,会最大程度减少逻辑资源LRj在全局范围内的平均响应时间.(2)在副本缺乏域内确定创建的副本数量.根据域Dk内所有请求资源LRj的实际响应时间和预期响应时间计算所需的副本数量.设资源LRj有count个副本,需要新增的副本数量记为Δcount.考虑到增加副本数量的目的是降低资源的平均访问时间ARTj,使ARTj能够接近给定的期望值ωART.如果期望值ωART与实际ARTj相差比较大,就需要创建更多的副本数量以降低ARTj.因此,新增副本的数量应该满足式(5):由式(5)可以推导出Δcount的计算方法,如式(6)所示:实际应用中ωART的取值可以根据需要设定为最小响应时间的2倍或平均响应时间的1/2倍等.通过域内的访问频率和平均响应时间计算副本的数量,能够使副本分布动态适应数据访问请求的变化和实时网络状况,在提高资源响应时间和减少副本数量之间获得有效平衡.4.3副本放置明确需要在域Dk内创建Δcount个副本后,接下来就需要确定放置副本的位置.下面,给出复制因子的定义,用复制因子衡量节点适合放置副本的程度.定义7.单位时间内,节点响应的请求消息数与所有请求的消息数之比称为节点服务率(ServiceRatio,SR).节点的服务率可以衡量节点的综合服务能力,包括节点的性能、动态性和可靠性.定义8.复制因子(ReplicationFactor,RF)是用来衡量节点适宜放置副本程度的参数.给定节点P,适宜放置资源LRj副本的程度即复制因子的计算方法如式(7)所示.其中,SR是节点P的服务率,Storage是节点P的存储空间,filesizej是资源LRj物理文件的大小,AvgBW是节点P的平均可用带宽.可用带宽可通过节点P的网络带宽与当前节点P上的等候队列长度之比进行计算,等候队列长度越大,则可用带宽越少.在广域网范围内,由于网络带宽限制以及节点的动态性等特点,网络传输延迟成为影响数据访问性能的重要指标,相比之下节点本身的CPU和I/O的处理时间可以忽略不计.因此,复制因子与节点服务率、节点可用存储空间、节点平均可用带宽以及节点Pi上的平均等候队列长度成正比,与副本尺寸成反比.复制因子的大小代表着该节点适宜放置该副本的程度,复制因子的值越大,表明该节点越适合放置这个副本.因为超级节点P并不拥有域Dk内所有节点的相关信息,所以域Dk内副本位置的计算由域超级节点完成.域Dk内没有资源LRj的节点属于副本创建的待选地点,域超级节点计算逻辑资源LRj放置在每个待选节点上的复制因子RFj,选择Δcount个具有最大复制因子的节点作为副本创建地点.4.4MACR算法描述MACR算法主要包括:确定需要创建副本的逻辑数据资源、确定副本缺乏域以及确定副本数量和放置地点.超级节点P管理的所有逻辑资源记做LR0,LR1,…,LRn,这些逻辑资源的所有副本信息保存在节点P的本地副本目录中.超级节点周期性的执行MACR算法,实现该节点负责管理的逻辑资源的动态副本分布.MACR算法步骤如下:1.超级节点P计算逻辑资源LRj(0j<n)的访问频率AFj,如果AFj大于预先给定的阈值ωAF,那么,逻辑资源Page7LRj就是热点资源.热点资源表示该逻辑资源的单位副本在过去的一段时间内被频繁访问,可能需要创建副本.2.对于每个热点资源,计算它们的单位平均响应时间.如果热点资源LRj的单位平均响应时间大于预先给定的阈值ωRT,那么,需要对逻辑资源LRj创建副本.用集合LR表示所有需要创建副本的逻辑资源.3.对于每个需要创建副本的资源LRj∈LR,节点P统计单位时间内对逻辑资源LRj的所有访问请求.如果域Dk内节点访问资源LRj的平均响应时间大于逻辑资源LRj的平均响应时间,则需要在域Dk内创建副本.用集合D表示需要创建LRj副本的所有域.4.对于每一个域Dk∈D,依次确定需要创建的副本数量和所有适合放置副本的节点.4.1.超级节点P根据本地副本目录中记录的数据资源LRj的所有副本的访问情况,统计单位时间内逻辑资源LRj的副本在域Dk内的平均响应时间,依据式(6)计算域Dk内所需副本数量Δcountk;4.2.域Dk的域超级节点在域Dk内确定Δcountk个适合放置副本的节点.域Dk内没有资源LRj的节点属于副本创建的待选地点,域超级节点依据式(7)计算逻辑资源LRj放置在每个待选节点上的复制因子RF,选择Δcountk个具有最小复制因子的节点作为副本创建地点,并将节点地址返回给超级节点P.5.对于每一个域Dk∈D,依次确定需要创建的副本数量和所有适合放置副本的节点.6.在指定节点上创建数据副本.MACR算法的核心思想是通过资源全局范围内的平均响应时间和频率计算副本的数量和位置,在提高资源响应速度和副本开销之间获得有效平衡.MACR算法的合理性分析如下:(1)逻辑资源正本所在的副本目录记录该逻辑资源的所有副本信息,因此能够获得某一逻辑资源在全局范围内的访问情况.逻辑资源的全局副本目录使得在全局范围内制定最优复制策略成为可能,适合任意覆盖网络结构的P2P系统.(2)对访问频率高并且单位平均响应时间长的逻辑资源进行副本创建,能够动态、有针对性地进行数据复制.(3)根据逻辑资源的全局副本目录,计算副本数量和副本创建位置,使副本分布能够适应数据访问请求的变化.类似地,在判断是否需要创建副本的同时,可以监控访问次数过少的副本,如果单位时间内某一逻辑资源的访问次数过少,可以删除该资源的部分副本,减少副本的维护代价.5模拟实验本文在OptorSim上实现了MACR方法,并构造了3组模拟实验验证MACR方法的有效性.第1组实验对比有数据副本和没有数据副本对资源查询性能的影响,第2组实验对比了不同复制方法下资源查询的性能,第3组实验主要从副本数量角度验证MACR方法的效果.5.1实验环境与设置实验采用随机生成P2P网络拓扑结构,网络模型中共有1000个节点,节点之间的网络带宽在100MB~1000MB范围内随机设置.初始文件个数为2000个,每个数据文件的大小为1000MB,采用随机方式平均分布在整个网络中.实验使用平均作业时间和文件平均响应时间作为副本查询性能的评估指标,平均作业时间是系统完成所有作业所占用的节点工作时间之和与作业数目之比;文件平均响应时间是所有作业在执行过程中访问(传输)每个文件的平均时间.MACR方法在估算访问代价时,需要使用节点服务率,但是在模拟程序中很难描述实际运行过程中节点的自主行为,所以针对超级节点具有性能高、在线时间长的特点,根据节点类型的不同,赋予一定范围的随机数值.算法中还使用了两个阈值:一个是判断热点资源时使用的ωAF,这里取ωAF为资源的平均访问频率.另一个是判断副本缺乏资源时使用的ωRT,这里取ωRT为所有资源的平均单位响应时间,即ARTavg/filesizeavg.考虑到数据访问请求是随机产生的,所以,可以近似取ωAF=max(AF)/2,ωRT=max(RT)/2.5.2有无副本的实验对比第1组实验分别获取了MACR方法下有副本(ωRT=max(RT)/2)和没有副本(取ωRT为无穷大)的实验结果,并与SimpleOptimizer方法进行对比.SimpleOptimizer是OptorSim中基本的副本管理策略,不提供副本创建功能,在数据访问过程中通过选择访问代价最小副本达到降低数据响应时间的目的.程序运行过程中产生的作业数量为50~500,数据访问请求随机分布在分布式环境中.采用平均作业时间和文件平均响应时间作为副本访问的性能评估指标,实验结果如图2所示.Page8从图2(a)中可以看出,随着作业量的增加,3种方法的任务平均执行时间都有不同程度的增加,其中,没有副本的MACR和SimpleOptimizer方法的任务平均执行时间增长较快.有副本的MACR方法可以动态根据资源的访问情况动态、有针对性地创建副本来降低资源的访问时间,因此,随着作业量的增加,任务平均执行时间增长较少.在作业数量一定的情况下,有副本的MACR方法比没有副本的MACR方法的任务平均执行时间提高了将近50%,这是因为实验中设定ωAF=max(AF)/2,ωRT=max(RT)/2,有副本的MACR方法通过创建副本使资源的响应时间降低一半,因此实验结果中任务平均执行时间会比没有副本的方法提高50%.实验结果说明MACR方法能够根据数据访问的性能动态创建副本,并且通过参数设定可以调整系统的总体访问性能.在图2(b)中,随着任务数量的增多,Simple-Optimizer和无副本创建的MACR算法的文件平均响应时间不断增加,而有副本创建的MACR算法的文件平均响应时间增长并不明显.这是由于MACR算法根据文件的平均响应时间,即对访问频率高并且单位平均响应时间长的逻辑资源进行副本创建,降低了文件的平均响应时间,表明在大量作业任务下,有副本的MACR方法在访问请求增加的情况下能够基本保证数据访问性能不变,实现副本的优化分布.5.3查询性能第2组实验将MACR与OptorSim中基于缓存的副本创建策略(LeastRecentlyUsed,LRU)和基于经济模型的副本创建策略(ECO)进行了性能比较.LRU方法采用缓存技术,尽可能将访问资源复制到本地,若节点没有足够空间就删除最久没有使用的副本.ECO方法通过经济模型评估创建副本的价值,以此为依据创建副本.程序运行过程中产生的作业数量为500~5000,数据访问请求随机分布在分布式环境中.不同数据复制策略下任务的平均完成时间和文件的平均响应时间如图3所示.ECO方法通过经济模型评估创建副本的价值,任务平均完成时间和文件响应时间最长.LRU方法的任务平均完成时间最短,这是因为LRU方法为避免异地访问,通过在本地创建大量副本、以本地访问为主要手段降低文件响应时间,因此任务平均完成时间和文件响应时间相对较小.MACR方法为减少数据响应时间从全局角度计算副本数量和副本位置,并不是以降低本地资源访问为主要目的,所以MACR方法文件平均响应时间大于LRU方法的文件平均响应时间,但任务平均完成时间和文件响应时间与LRU方法相差不大.5.4副本数量在第2组实验基础上,进一步构建第3组实验,对比MACR、LRU和ECO3种复制方法的副本数量变化.Page9图4显示了随着运行时间的增加,3种数据复制方法产生的副本数量.LRU方法在访问资源的同时将资源复制到本地,随着数据访问请求的增加,本地保存大量资源的副本,副本数目随着作业数量的增加而持续增长.ECO方法通过计算副本的经济价值确定是否进行数据复制,副本数目大约是LRU方法副本数目的2/3,在一定程度上减少了副本数量,但文件响应时间也比LRU方法的时间长.MACR方法对频繁访问的数据进行复制,根据文件的平均响应时间动态计算所需的副本数目,而不是一味通过追求副本数目降低执行时间,所以副本数目不到LRU方法的10%.也就是,MACR方法用不到LRU方法10%的副本数目,就获得了与LRU方法相当的任务平均访问时间,说明MACR方法在性能提升和副本数量之间能够获得良好的平衡.6结论本文提出一种动态的数据复制策略MACR,首先给出了副本目录的设计方法,能够获得逻辑数据资源的所有副本信息.然后,根据逻辑资源的全局访问情况确定缺乏副本的区域,并给出副本数量的计算方法.引入复制因子的概念计算副本位置,使副本分布能够动态地适应访问请求的变化和网络通信状况,进而实现全局优化的数据副本分布.MACR方法具有如下优点:(1)基于双向链表的副本目录方法能够保证副本分布的全局优化双向链表的副本目录结构能够获得逻辑资源的全局副本信息.以此为依据,在给定代价评估标准的情况下,能够在全局范围内获得最优的数据复制策略,还可以动态跟踪副本的利用情况.(2)适用于任何覆盖网络结构在底层P2P系统的覆盖网络基础上对网络模型做进一步约定,给出副本目录信息的获得方法,因此适用于任何P2P覆盖网络结构.通过副本目录记录副本的所有访问信息,为优化的副本分布策略提供依据.变化和网络带宽状况(3)动态进行数据复制,能够适应访问请求的以降低逻辑资源的全局访问代价为目的,综合考虑访问频率、节点负载和实时带宽等因素,对访问频率高且平均响应时间长的数据资源进行复制.明确给出了副本数量和副本位置的计算方法,能够利用较少的副本数目实现全局优化的副本分布.模拟实验从副本响应时间和副本数量两个方面,对比分析了MACR方法与LRU方法、基于经济模型的ECO方法的性能.实验结果表明MACR能够实现副本的合理分布,以少量数据副本提升资源访问的性能.致谢评审专家对本文给出了中肯的评审意见和建议,在此表示感谢!
