Page1利用平面虚拟点光源的素描图像绘制佟强张松海(清华大学计算机科学与技术系北京100084)摘要素描画是一种常见的艺术形式,它通过单色线条来表现直观世界中的事物,而能够体现场景层次的高光和阴影则是表现的重点.艺术家经常会对场景的光影进行艺术化的夸张,这种艺术夸张会更好地表现作品主题.首先提出一种二维图像平面的虚拟点光源位置估计算法,根据输入的真实图像的距离场和亮度场,计算虚拟点光源位置,使其对原图像的亮度梯度影响最小,即最符合原场景中的光照方向.然后提出基于二维虚拟点光源的阴影增强算法,加强了真实图像中的明暗对比,因此能够在最终的素描结果中表现出光影效果.使用该方法生成的素描画,在物体边界处具有更好的明暗对比,从而使得最终绘制图像更具有素描画的光影增强特点.关键词非真实感绘制;素描;虚拟点光源;亮度梯度场;图像处理1引言素描画是一种单纯使用线条描写的绘画形式,以单色线条的明暗深浅来表现事物的本质与神韵.通过对素描画的创作过程进行考察,可以发现,画家在绘制素描画时,不仅是简单地临摹真实场景,更要结合自己的艺术感受,减弱图像中的反光,加强明暗交界线,使明暗对比增强,并加强物体轮廓,以带给画面形体特征.尤其是对于在素描画中占据很大比Page2重的人物素描,画家往往会使用较强的光线变化和较大的明暗反差来处理人物形象,体现人物的精神品质.可以说,对于光影的处理,在素描画绘制中,占据了非常重要的地位.本文改进了已有的素描风格铅笔画自动生成算法,在输入的真实场景的二维图像平面中引入一个虚拟的点光源,该虚拟点光源位于二维平面上,而无需还原出三维场景,其计算量远小于三维重构和光照模型计算.并提出一种二维图像平面上的虚拟点光源位置估计算法,根据输入的真实图像的距离场和亮度场,计算虚拟点光源位置,使其对原图像的亮度梯度影响最小,即最符合原场景中的光照方向.本文还提出了一种阴影增强算法,通过使用二维虚拟点光源照射图像中的各条边缘,在边缘的另一侧产生阴影,从而模拟出素描画中的明暗反差效果,并最终绘制得到具有素描画风格的非真实感图像.该方法加强了真实图像中的明暗对比,因此能够更好地表现出素描画中的光影效果.本文第2节介绍目前针对素描风格图像生成的一些相关工作;第3节介绍利用二维点光源的素描图像绘制的系统框架;第4节讨论计算虚拟点光源的详细步骤以及该点光源对图像亮度梯度场的影响;第5节描述在点光源影响下的带有阴影的图像强度场的生成过程以及随后的绘制步骤;第6节给出本文算法的一些实验结果,与目前已有的素描图像生成算法进行比较,并在第7节进行总结.2相关工作在早期的二维绘制系统PencilSketch[1]中,使用一个基于鼠标的虚拟写字板来进行交互式的素描风格图像绘制.Durand[2]将笔划和高层属性分离开,以用于交互式绘制.在文献[3]中,Mao等提出将线条积分卷积(LineIntegralConvolution,LIC)方法用于铅笔画.在文献[4-5]中,Sousa等通过使用电子扫描显微镜,仔细地研究了真实绘画中的铅笔与画纸的交互情况,从物理的角度构建出铅笔笔划模型.在文献[6-7]中作者讨论了笔墨(pen-and-ink)模型.也有一些研究工作针对输入二维原图像,生成具有素描风格的图像.Shiraishi等[8]使用一种原始图像局部近似的方法来进行绘制,其方法主要分为三个步骤:笔划分布估计、笔划生成、笔划排序与绘制.Hertzmann[9]使用样条曲线样式的画刷笔划,在多个层次上进行绘制,较小的画刷绘制了较上层的图像,而较大的画刷绘制了较下层的图像.文献[10]引入了几何图像矩(geometricimagemoment)的概念来指导计算图像中各个区域的向量,在图像的不同区域上体现出不同的笔划方向,突出了区域之间的边界效果.这些素描风格图像绘制方法均由原图像进行直接处理,如边缘提取、滤波等操作,这种做法忠实于原图像的结构与明暗对比.在对实际素描作品的观察中可以发现,画家为了体现出所绘制场景的层次感,会采用增强明暗对比等方法,在最终绘制结果中加入一些阴影和高光区域.这些区域并非实际场景中真实存在的区域,而是画家为了追求艺术效果,根据其主观感受加入的,而上述的二维图像生成素描风格算法则无法模拟真实素描画中普遍存在的虚拟光影效果.图1真实场景与素描作品的对比(上图为真实的静物场景,下图为画家根据该场景所创造的素描作品.可以发现,在物体边界上,存在着画家根据主观增强的阴影效果)为了实现这种素描风格中的阴影效果,已有研究主要基于三维场景的光照模型来实现.Hertzmann在基于笔划的油画绘制中,引入了笔划高度场并建立了简单的Phong光照模型[11],以实现笔划的立体感.Winkenbach和Salesin[12]按照深度优先顺序进行绘制,并划分图像平面,来计算可见性.他们根据纹理、阴影和方向性,使用Salisbury[13]的阴影线算法来绘制每个可见曲面的阴影线.文献[14]使用光照色调来构造一个非真实感光照模型.文献[15]将场景分为若干层,并根据各层所组合出的颜色温度来决定光照效果.这些方法均基于三维场景,当用户Page3输入仅为单幅二维图像时,要恢复出准确的三维场景需要大量工作.文献[16]在图像上构造阴影密度图来获取图像中存在的阴影,但这种方法只适用于较直的物体.3虚拟点光源下的素描算法框架本文利用一个虚拟二维点光源来指导白噪声图和图像向量场的生成以及阴影的计算,从而为最终素描图像带来增强的光影效果.在该方法中,通过最小化亮度能量来寻找点光源,使用该点光源来调整控制铅笔笔划方向的图像向量场,使得各个笔划方向更趋近于光线方向.同时,根据该点光源在图像强度场中生成阴影区域,以获得用来指导白噪声图的阴影强度场.图2带有虚拟点光源的素描图像绘制算法流程4虚拟点光源位置估计本文算法在绘制过程中引入了一个虚拟的二维点光源,用于实现最终素描风格图像中的光影效果.需要说明的是,该点光源与三维光照模型中使用的点光源有所不同,后者是三维物理世界中真实存在的一个点,且其照明模型符合反射定律、折射定律等与光照有关的物理定律.在本文方法中所引入的点光源O,只是人工定义在二维图像平面中的一个虚拟点,其对像素P的照射方向为二维平面中的OP射线方向.在素描图像中往往存在高光区,这些区域在实际的三维场景中一般受到光线的直接照射,画家根据自己的主观感受而提高了这些区域的亮度.在高光区域内的亮度梯度较平缓,也就是区域内的边缘图2给出了算法的主要流程.该素描图像生成算法主要由两部分组成,首先对虚拟点光源的位置进行估计,再根据该结果来指导带有阴影效果的图像噪声图的生成.在虚拟点光源位置估计过程中,通过构造一个距离场,计算图像中的各个像素到边缘的距离,并在距边缘较远的区域中寻找一个像素位置,当以该位置作为点光源时,能够最好地符合整个真实图像的亮度方向.以该位置作为该图像中的虚拟点光源位置,调整图像向量场的方向,使其在最终绘制时能够体现出光照方向.在阴影噪声图生成过程中,利用图像边缘提取的结果,在各条边缘相对点光源的另一侧生成逐渐衰减的阴影,从而获得带有阴影的原图像强度场,再由该强度场指导生成白噪声图,并利用LIC方法进行绘制.本文将在随后对这两部分内容分别给予详细说明.较少.当图像中存在一个二维点光源时,该光源所在像素也应当位于较明亮的区域内,即与图像中的边缘相距较远.本文首先计算图像中各个像素到最近边缘的距离,再在距离边缘较远的区域中寻找最佳的虚拟点光源的位置.4.1距离场构造本文首先使用文献[17]中的一致线条画绘制算法(CoherenceLineDrawing,CLD)方法生成原图像的线条图L(x)∈{0,255},其中0(black)表示该像素位于线条上.该方法通过基于核的非线性向量平滑方法,计算出一个平滑、保持特征的局部边缘流,称为边缘正切流(EdgeTangentFlow,ETF).然后,使用基于流的各向异性的高斯差分(Difference-of-Gaussians,DoG)方法来直接生成线条效果.图3(b)显示了输入图像相应的线条图.Page4以线条图L(x)中的黑色像素(也就是边缘)作为起始的种子点,利用文献[18]中的JFA(JumpFloodingAlgorithm)方法,可以构造距离场D(x),用以表示图像中各像素到边缘的距离.JFA的算法思想是采用“跳跃”的方式,传播像素的信息.通过迭代地进行步长减半的若干次跳跃计算,当完成了步长为1的跳跃之后,图像中的所有像素都会对应一个距离最近的种子点.对于大小为n×n的图像来说,在logn轮后就可以计算出整个距离场.将该距离场表示为D(x)∈{0,255},其中0(black)表示该像素到最近种子点的距离为最远,255(white)表示该像素与最近种子点重叠(该像素本身就是种子点).图3(c)表示了使用JFA方法所构造出的一个图像距离场.4.2虚拟点光源估计图像强度场是素描风格图像绘制中常用的方法,它表示了图像中各个像素的颜色强度.在Luv颜色空间内构造原图像的强度场I(x),在强度场中的各像素的值I(x,y)表示了像素(x,y)的颜色P(x,y)与指定颜色C的相似性.P(x,y)与C越相似,则I(x,y)越大.本文使用文献[8,10]中的方法将像素强度定义为其中,d(C1,C2)∈R为C1和C2两种颜色在Luv颜色空间中的欧氏距离.使用如下式所示的函数F(d)∈[0,255]将颜色距离d映射到强度的值域F(d)=其中d0是根据实验调节的参数.令图像强度场中的各像素X的强度的梯度幅角为θ(X),该幅角表示了像素在真实三维场景中所受到光照的方向.本文按照如下方式定义像素X在点光源P的照射下所产生的影子像素X.由P出发存在一条经过像素X的射线PX,图像中与该条射线最接近的下一个像素X即为X在P的照射下所产生的影子.射线PX与PX之间的角度即为像素X在P的照射下所产生的阴影向量幅角,记为θP(X).P在图像I中的全部N个像素上具有的平均向量幅角记为θP.将该虚拟点光源表示为O,利用所生成的距离场,在较暗区域(到边缘的距离较远的区域)中,通过下式计算出O,作为素描图像绘制中所使用的虚拟点光源.O=minP∑X∈I其中T表示较暗区域的阈值.4.3向量场提取向量场是素描绘制中非常重要的因素,它确定了笔划的方向,而素描画主要是通过笔划方向来表达物体的轮廓和光影效果.本文首先通过使用两个3×3的模板对图像亮度进行卷积,提取原图像的亮度在水平和竖直两个方向上的梯度场作为原始向量场,这两个卷积模板分别是从而提取出原图像的亮度场在水平方向和竖直方向的梯度h和v.在素描作品中,画家在同个区域内会使用相同的笔划方向来绘制.本文根据像素颜色将原图像分割为若干连通区域.在分割过程中,规定每个区域面积不应小于原图像大小的1%,图3(d)显示了使用MeanShift算法所得到的图像分割结果.在分割出的各个图像区域内,分别计算其内部所有像素的梯度均值,作为该区域的整体梯度.将区域内的所有像素的梯度,均赋为其所在图像区域的梯度.其中R为一个图像区域,X∈R为区域R内的一个像素,N是区域R包含的像素个数.这样,对于任何一个区域来说,其内部的所有像Page5素均具有相同的向量.将像素X的梯度幅值标记为GX,其梯度幅角标记为θX,可以得出G(X)=h2X+v2槡X,θ(X)=考虑到点光源的光照对整幅图像所产生的影响,重新计算点光源到各个像素方向的光照角度δX.更新整幅图像的向量场,各个像素的梯度幅角修改为θX=(θX+δX)/2,其梯度幅值保持不变,则在光照影响下的图像中的像素X的梯度变为hX=GX×cosθX,vX=GX×sinθX.5有阴影的噪声图生成在本文的素描风格图像生成方法中,由原图像所获取的向量场和白噪声图会影响最终素描图像的整体效果,其中向量场决定了各区域的绘制方向,而白噪声图则决定了图像各区域的明暗程度.当计算出虚拟点光源的合适位置时,根据该位置对图像向量场进行了调整,使得绘制结果更能体现出光线照射效果.在本节中,将继续讨论如何生成一个合适的白噪声图,其能够很好地表现出素描图像中的明暗对比效果.首先根据虚拟点光源的位置,生成带有阴影效果的原图像强度场,再由该阴影强度场指导白噪声图的生成,最后使用LIC方法进行绘制,从而获得最终的素描风格图像.5.1阴影强度场生成在真实素描作品创作过程中,画家会根据所绘制对象的亮度来决定其明暗,并在边界处主观地增强这种明暗对比,以体现作品的层次感.一种解决方法是使用前景抠取方法,将前景与背景分离后,再在其边界上产生阴影.但是,许多素描作品中很难区分前景物体和背景,这取决于画家在绘画时对整个绘画场景的理解和主观创作.另外,画家也经常会在前景物体中使用这种明暗对比的手法,以突出某种表现力.利用第4节所引入的虚拟点光源,可以在图像中的边缘处产生阴影,以实现素描作品中的明暗对比效果.首先使用Sobel核提取原图像的边缘图E(x)∈{0,255},其中0(black)表示该像素位于边缘上.当点光源照射到这些边缘时,就会在另一侧产生阴影,从而实现素描画中的明暗效果.本文使用如下方法计算阴影:对于边缘上的一个像素A0初始令i←0,表示当前像素为阴影上的第i个像素,令length←0为阴影长度WHILElength<预设值Ai+1=FindNextShadowPixel(O,Ai);IF(Ai+1位于边缘上)break;ELSEIAi+1=0.5×si+1×IAi+1;IF(IAi+1IAi+1)break;length←length+1,i←i+1;在上述流程中,IX为像素X在强度场中的值,IX为像素X在阴影强度场中的值,s为阴影的衰减速度.当IAiIAi时,阴影已经完全衰减,则无需继续计算A的阴影上的后续像素.FindNextShadowPixel用来寻找当前像素Ai在虚拟点光源O下所产生的阴影像素Ai+1位置.由点光源O出发,经过像素Ai,产生一条OAi射线,该射线所到达的下一个像素Ai+1,即为该像素所产生的阴影像素,因此该阴影像素必然位于当前像素所相对于光源的另一侧.重复使用该方法,直到阴影已经足够衰弱,或是阴影像素也落在图像中的某段边缘上.该方法可以在物体边缘上远离光源的一侧产生逐渐变淡的阴影.对于整个边缘图E(x)上的每个位于边缘的像素执行该过程,则可在强度场I(x)上生成以O为点光源所产生的阴影区域效果,该效果如图4所示.可以看出,该方法在物体边界和内部均会产生适当的阴影,从而在体现了前景与背景之间的明暗对比的同时,也表现出了物体内部的层次感.5.2白噪声图生成白噪声图决定了最终生成的素描图像的灰度色调.通过阴影强度场来指导生成白噪声图,可以很好地匹配最终绘制结果与原图像和阴影区域的色调关系.图像像素在阴影强度场中的取值,表示了该像素产生白噪声的概率,即对于阴影强度场中的每个像素,令其值为I(x),生成一个随机数r∈(0.0,1.0),则噪声图中的对应像素的强度值Inoise为Page6其中,Imax为强度场所可能具有的最大的值,在本文的实现方案中为255.k为一个用来控制白噪声点数量的权值,随着k值的增大,白噪声点的数量也会增加.在本文的实现方案中,k值选择为0.7.图5显示了根据阴影强度场所生成的白噪声图的例子.5.3生成素描结果本文使用LIC方法进行最终绘制操作.该方法沿着给定的向量场对曲线区域的像素进行均值化而图6最终生成的素描图像6实验结果本文使用C++实现了第3节中所描述的算法流程.附图1中展示了该算法所生成的一些例子.可以看出,由于引入了图像中的虚拟点光源,该算法可以很好地模仿出素描画中的阴影和高光效果.7结论与未来工作本文通过在二维图像中引入一个图像平面上的虚拟点光源,改进了现有的素描风格图像生成算法.通过估计原始图像中的光线照射方向,在原图像平面上设置一个虚拟点光源,利用该点光源对真实图像中的各条边缘进行照射生成阴影,模拟出素描图像的阴影区域,从而让绘制结果对于观察者来说更具有素描画的光影增强特点.我们拟将这一工作推广到素描风格化视频的绘制当中,根据视频中的镜实现图像滤波.给定一个二维向量场,和同样大小的白噪声图,该算法沿向量场方向对白噪声进行模糊处理,生成一幅具有铅笔素描效果的图像.在计算结果图像的像素时,首先在向量场内生成一条通过该像素的局部流线,然后在流线上定义一个1D低通滤波核,将白噪声图像中位于该流线上的像素与该低通滤波核进行卷积,得到结果图像的像素值.最后,将利用Sobel核所提取的边缘叠加在结果图像上,获得最终的素描效果.在素描画中,画家会使用物体边缘线条来表现物体的外形与轮廓.在本文的方法中,使用Sobel算子从输入图像中提取边缘线条,并将其加入到结果图像中.对于检测为物体边缘的像素,按照一定比例降低其灰度值,从而体现出边缘的效果.图6显示了未叠加边缘与叠加边缘后的图像的比较.由于之前计算出的图像像素值已经考虑了光照的影响,所以这种添加边缘的方法也可以一定程度上体现出光照的影响.头运动来估计点光源的位置变化与向量场运动,并对各帧图像生成对应的阴影强度图,从而获得具有较好帧间连续性的素描风格化视频效果.致谢本文得到了清华大学计算机科学与技术系可视媒体研究中心的老师与同学们的许多帮助和有益建议,在此表示感谢!
