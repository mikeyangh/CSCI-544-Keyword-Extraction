Page1基于精英池演化算法的数字电路在片演化方法何国良1),2)李元香1),2)史忠植3)1)(武汉大学软件工程国家重点实验室武汉430072)2)(武汉大学计算机学院武汉430072)3)(中国科学院计算技术研究所智能信息处理重点实验室北京100190)摘要20世纪末演化硬件技术的提出为实现硬件系统的自适应与智能化等特征提供了一种可行的新技术,现阶段电路进化是演化硬件研究的热点之一.该文引入人工经验与规则,提出一种扩展矩阵编码法,保护具有较优结构的电路个体不易被淘汰;其次,基于多目标和局部寻优技术,结合子电路杂交与单元重要性的自适应变异策略,提出了一种设计数字电路的精英池演化算法,并在可编程逻辑器件上实现电路的自主动态重构与评价等演化过程.关键词演化硬件;演化算法;电路演化;在片演化1引言演化硬件技术(EvolvableHardware,EHW)自从20世纪90年代初被Gairs等提出以来,引起各国政府部门和学者们的广泛关注与深入研究,极大地促进了该技术的发展和应用.演化硬件的实现过程与演化算法类似,根据个体适应值的评估方式,演化硬件可分为离线演化与在线演化两种设计技术.离线演化一般是通过软件仿真评估每代演化的所有个体,只下载最优个体到可编程器件上验证;而在线演化则将硬件测试嵌入到演化硬件设计过程中,所有个体都下载到硬件设备进行在线实测和评价.作为一个新的研究领域,演化硬件是计算机科学、电子学、生物学的交叉学科,为硬件系统设计的自动化与智能化提供了新的技术手段和设计方法.演化硬件技术在数字电路和模拟电路的设计应用方面有助于实现复杂电路的自动设计与优化、提高设计效率、降低能耗、发现新的规则与知识.人们针对离线演化硬件技术,为提高演化硬件的编码效率,提出了各种电路编码技术,如矩阵编码法[1]、CGP(CartesianGeneticProgramming)[2]编码法等;为了优化硬件并降低演化的时间复杂度,提出了各种有效的智能算法,如并行遗传程序法[3]、多目标自适应遗传算法[4]、单元杂交法[5]、评估技术[6]等.此外,分而治之与生长式方法也是演化复杂演化硬件的有效技术,如基于商农分解定理的自动分解方法GDD(GeneralizedDisjunctionDecomposi-tion)[7]可以提高演化电路的规模,MDCGP(Modu-larDevelopmentalCaresianGeneticProgram-ming)[8]技术可缩短演化时间,提高容错率.与此同时,在线演化硬件和内部演化技术的研究也取得了许多新进展,如直接演化电路的配置串[9]、通过API函数对配置串读写并修改相关基因段[10]、基于可编程逻辑器件(Field-ProgrammableGateArray,FP-GA)的物理结构和待演化系统的特点设计特定的演化结构实现演化电路的动态重构[11]等.本文引入人工设计电路的经验和规则,提出扩展矩阵编码法,设计出一种精英池演化算法(ElitistPoolEvolutionaryAlgorithm,EPEA),结合子电路杂交法与基于单元共享度的自适应变异策略演化数字电路,并采用一种在片演化技术实现电路的演化过程.实验结果表明:该方法在一定程度上可提高演化电路的规模及其设计效率.2演化电路的编码2.1矩阵编码法采用演化硬件技术自动设计数字电路,首先需将电路表示成便于算法设计的一种编码方式,目前一般采用矩阵编码法[1]表示一个组合逻辑电路,如图1所示.其中每个单元表示一个逻辑函数,单元间的互连形成逻辑函数间的关联,构成一个数字电路.为了完全表示一个组合逻辑电路,需定义矩阵中单元的函数类型以及单元间的连接关系.其中,单元的函数类型可以定义为基本的逻辑门类型或自定义的函数类型,表1列举了部分基本逻辑函数类型.其次是单元间互连关系,某些单元的输出信号和电路输入端信号可作为其它单元的输入信号.对于组合逻辑电路的编码,为避免单元间的连接形成回路,先定义单元间连接关系的一个基本概念:单元的连接度.012注:表示此函数类型不执行任何逻辑操作(即直连线),直接将该单元的输入端与输出端相连.定义1.在矩阵编码犎mn(m为矩阵的行数,n为矩阵的列数)中,若某个单元cij(表示此单元的位置在矩阵中的第i行、第j列)的输入端信号可与其前k列单元的输出端信号相连,即在第j-k列至j-1列位置上所有单元的输出端信号都可为此单元的输入端信号,则称此单元cij的连接度D为k.Page3每个单元的编码信息包括此单元的全部输入端信号信息和函数类型,如下所示:输入端信号1输入端信号2…函数类型以单元编码为基础,矩阵中全部单元的编码信息即可表示一个电路的完整结构.该矩阵编码法也可用于对时序逻辑电路编码,此时单元间连接允许形成回路,单元的函数类型包含触发器等.2.2扩展矩阵编码法虽然该矩阵编码法能较好地表示一个数字电路,便于演化算法的自动设计,但容易淘汰一些具有较优结构的电路个体.例如,设计一个三输入二输出的组合逻辑电路,其真值表如表2所示(a,b,c为输入信号,y1,y2为输出信号).图2扩展矩阵编码法为此,本文引入人工设计电路的经验和规则,以矩阵编码法为基础提出一种扩展矩阵编码法,在原矩阵编码法的每个输出端添加一个宏模块,它由一个非门和一个二路选择器组成,如图2所示.当评价演化电路的某个输出端功能与真值表的匹配度低于0.5时,选择器控制端选择信号“1”,表示在此输出信号端添加一个非门;否则,反之.此编码法能保护具有较优结构的电路个体不易被淘汰,同时增强了种群的多样性.此外,本文规定所有单元的连接度为1,即每个单元的输入端信号为电路的原始输入信号或其前一列单元的输出端信号,最后一列单元的输出对应电路的输出端信号.3精英池演化算法为了阐述其演化策略,定义几个基本概念.abc000001000001001000010011000011011101100001000101011000110011101111101101若一个演化电路的功能如表2中的Out1(x1,x2)所示,通过与真值表Out相比较,可知第1个输出端信号的功能匹配度是1/8,第2个输出端信号的匹配度是5/8.若在该演化电路的第1个输出端添加一个非门,则该输出端信号的功能如表2的Out2(z1,z2)所示,匹配度上升为7/8.由此可知,必要时在演化电路的某些输出端添加非门可迅速提高电路性能.定义2.对于一个具有n个输出端信号的组合逻辑电路C,基于输出端信号可将电路C分解为n个单输出子电路,每个子电路分别对应电路C相应输出端信号的功能,本文称按此划分的每个子电路为输出端信号子电路.定义4.在定义3中,若扩展矩阵编码中的某值得注意的是:在定义2中,电路C中的某些逻辑单元可能是多个输出端子电路的逻辑单元,即为多个输出端子电路所共享,我们称其为共享单元,见定义3.定义3.若采用扩展矩阵编码表示定义2中的电路C,电路的每个输出端信号子电路都是由矩阵编码中的某些单元及其连接构成.若矩阵编码中某个单元cij(表示此单元的位置在矩阵中的第i行、第j列)是电路C多个输出端信号子电路的一个逻辑单元,则称此单元cij为共享单元;否则,则称此单元cij为非共享单元.Page4个单元cij是共享单元,且此单元是电路C的m(mn)个输出端信号子电路的共享单元,则此单元cij的共享度为Scij=m/n.3.1子电路杂交法基于多目标技术,若将数字电路的每个输出端信号单独作为一个目标,一个多输出数字电路的设计即为一个带约束的多个目标优化问题.由于一个多输出组合逻辑电路可分解为多个输出端信号子电路,因此,一个多输出组合逻辑电路可由所有单输出端信号子电路构成.本文基于多目标与局部优化技术,提出子电路杂交策略.新个体电路的每个输出端子电路产生规则为:根据两父体电路中同一输出端信号的功能评价值,选取较优的子电路作为新个体电路对应输出端信号子电路,然后将新产生的所有输出端信号子电路组合形成新个体电路.本文在自动设计电路时考虑面积和功耗等因素,需充分利用各子电路间的可共享单元,优化设计电路所需的逻辑门数.因此,在产生新个体电路时,各子电路对应的基因段映射到染色体时可能存在某些基因段的不一致而相互冲突,各子电路融合阶段冲突的处理策略形成多输出电路的共享单元.本文处理冲突的方法是基于电路每个输出信号端的位置,按照某种次序进行替换.首先,将两个父体电路根据输出端信号分解成各个子电路(各子电路间存在共享单元);其次,选择两父体中每组输出端信号具有较高匹配度的子电路作为新个体对应输出端信号子电路;最后,按照输出端信号的位置次序将新个体的第1个输出端信号子电路与第2个输出端信号子电路融合,若融合时某些单元冲突,则用第2个输出端信号子电路的单元覆盖第1个输出端信号子电路的单元,得到的含两个输出端信号子电路与第3个输出端信号子电路融合,依此方式产生包含所有输出端信号的新个体电路.例如,若演化1个四输入三输出的组合逻辑电路,两父体电路中每个输出端信号的适应值分别为14/16,9/16,15/16和9/16,12/16,11/16,如图3(a),(b)所示.其中,矩阵编码中的每个单元分别注明了它属于的特定输出端信号子电路:1、2、3分别表示此单元属于第1个、第2个或第3个输出端信号子电路;-1表示此单元不属于任何输出端信号子电路,是一个冗余单元;若一个单元中注明了多个编号,如1和2,表示此单元是第1个与第2个输出端信号子电路的共享单元.该两父体的子电路杂交过程如下.第1步:分解电路.将每个父体电路分解为输出端信号子电路,如图3(a)、(b)所示.第2步:选择子电路.选取新个体电路的每个输出端信号对应的父体子电路,第1个输出端子电路选取父体I中具有较优匹配度的对应(第1个输出端信号)子电路,如图3(c)所示;同理,新个体的第2个输出端信号子电路选取父体II对应的子电路,如图3(d)所示;同样可得到新个体第3个输出端信号子电路.第3步:融合.将第2步选取的第1个输出端信号子电路与第2个输出端信号子电路融合产生一个包含两个输出端信号的子电路,若融合时第2个输出端信号子电路的某些单元与第1个输出端信号子电路冲突,则将第2个输出端信号子电路的单元覆盖第1个输出端信号子电路的相关单元,如图3(e)所示;将融合的子电路再与第3个输出端信号子电路进一步融合,产生一个包含所有输出端信号的新个体电路,如图3(f)所示.3.2自适应变异策略根据染色体中各个基因的重要性,设计了一种自适应的变异策略,重要位基因以较低的概率变异,非重要位基因以较高的概率变异保持种群的多样性.在扩展矩阵编码法中,矩阵中的每个单元对应染色体一段基因,其变异概率随其单元的重要性和演Page5化电路的性能而动态变化.其中,单元的重要性表现为其共享度,单元的共享度越高,则越重要.根据扩展矩阵编码中每个单元的重要性,自适应变异策略如下:(1)矩阵编码中某个单元是非共享单元:若此单元所在的输出端信号子电路功能不能与真值表完全匹配,则增加此单元的变异概率;否则,降低其变异概率.(2)矩阵编码中某个单元cij是共享单元:若此单元的共享度Scij小于0.5,则增加此单元的变异概率,否则减小其变异概率.3.3精英池演化算法的基本框架基于上述演化策略,设计了一种精英池演化算法(EPEA).其主要思想是在演化过程中每一代的重要性个体变异生成一个精英池,主种群与精英池杂交以提高演化效率.该算法的主要步骤为:1.随机生成一个种群A,规模为N,并评价.2.采用局部搜索策略,将种群A的最优个体通过变异产生M个个体,形成精英池B,其中NM.3.演化操作:从种群A和精英池B中分别随机选取一个个体杂交得到一个新个体,并对新个体运用变异策略,反复此步直到生成规模为N的下一代种群A.4.对新种群A评价,并保留最优个体电路.5.若不满足终止条件,转步2;否则,结束算法.3.4评价函数演化过程中,评价标准能否准确反映电路的优劣程度至关重要,它直接影响到演化操作,并导致能否得到最优解.对于数字电路,通过测试集对其进行功能仿真验证是评价的基础,如组合逻辑电路功能的评价一般是通过测试所有可能的输入组合,通过仿真测试其电路的输出值,并与真值表比较得到演化电路的功能与真值表的匹配度,作为演化电路个体性能的评价值.另外,在设计有效电路的同时要求其结构最优化.本文考虑组成电路的逻辑门数作为电路优化的一个基本特征,即其所需的基本逻辑门数越少,结构越优.采用扩展矩阵编码表示数字电路时,矩阵中的一些单元为电路的冗余单元,它可分为两类:一类是指其函数类型为直连线,即表1中的函数类型0;另一类指该单元不是电路的有效逻辑单元.因此,本文中个体电路x的评价函数定义如下.定义5.电路x的适应值函数F(x)为电路功能评价与电路有效逻辑门数之和,即F(x)=H(x)+wV(x).H(x)为个体电路x全部输出端信号与真值表的匹配程度;V(x)为扩展矩阵编码表示电路个体x的冗余单元数;w是动态权系数,若个体为有效电路(满足真值表中指定的逻辑功能),其值取1;否则,取很小的正数.4在片演化的原理框架基于FPGA的物理结构及在片演化硬件技术的特点,本文采用在片演化硬件设计原理如图4所示,XUP-V2P板具有大容量的静态和动态存储空间,且芯片Virtex-IIPro嵌有IBMPowerPC405处理器,便于在片演化硬件的设计.PC机与FPGA的交互在于系统初始化和演化结果的输出,进化过程中FPGA板自动下载演化电路的染色体、实测验证.在片演化的硬件结构可分为两个模块:第1个是固定模块,它包括PowerPC微处理器、RISC结构、单独的32位指令和数据总线,用于执行算法和FPGA与外部存储器的数据交换.此外,它还包括一些外围接口,如通过GPIO(GeneralPurposeInput/Output)与可重配置模块通讯,或参与内存管理的一些接口等.第2个模块为可重配置模块,它通过总线与GPIO相联系,允许算法控制电路的演化.同时,它包括激励信号产生器对电路功能在片测试和验证.为了便于进行在片演化,本文采用宏结构的虚拟电路表示扩展矩阵编码法中的每个单元,如图5所示.其中,多路选择器1和多路选择器2用于选取两输入逻辑门的两个输入端信号,它们分别通过寄存器1和2控制.多路选择器3用于选取该单元的逻辑函数类型,其控制端通过寄存器3输出.两个输入端信号和一个逻辑函数构成了每个单元的逻辑功能.其中,每个多路选择器的控制端信号都由寄存器实现.因此,只需改变寄存器内容就可实现电路的演化.Page6图5宏结构电路单元5实验与分析为了测试EPEA性能,本文先选取一个单输出和一个多输出的组合逻辑电路,其真值表如表3所示.例1由4个输入(A,B,C,D)和一个输出Y组成.例2由4个输入(A,B,C,D)和2个输出(Z1,Z2)组成.通过与其它智能算法的设计结果比较其最优电路的逻辑门数、设计最优电路的频率、设计有效电路的频率和最优电路所需逻辑门数,验证该算法的效率.为了便于比较与分析,本文采用与文献[12-13]相同的参数:运行算法20次,种群规模为50,可选的基本逻辑门类型如表1所示.输入ABCD0000110100001000011101001000001001010101000011000101100101001101100000010111011010000110100111000101111001111101PSO[12]60.701.006.55DEPSO[13]61.001.006.00EPEA51.001.005.00GA[12]70.250.75—PSO[12]70.400.9510.5DEPSO[13]70.201.008.6EPEA71.001.007.0对于例1的电路,由于它是单输出电路,演化过程中没用到杂交操作,每代仅对极少数个体电路变异及评价.由表4可知,EPEA能以概率1设计含5个基本逻辑门的最优电路(如图6所示),其它算法设计的最优电路都需要6个逻辑门.而对于多输出电路(例2),该算法采用杂交和变异策略,设计性能汇总如表5所示.从该表可知,EPEA以概率1设计出含7个基本逻辑门的最优电路,电路结构如图7所示.其次,为了深入分析扩展矩阵编码和EPEA的有效性,本文选取了二位乘法器、二位比较器和二位加法器,从多角度与相关文献进行了比较与分析,表6汇总了几种算法设计此组实验所需的编码规模及所需的最少逻辑门数.由表6可知,采用扩展矩阵编码法所需的染色体长度较短,且EPEA设计的电路结构较优,能有效地减少对资源的消耗.KM[14]—8—19—12NGA[15]5×596×7125×57MGA[16]5×576×795×57EPEA4×475×594×47此外,由于三位乘法器真值表复杂,难于自动设Page7计其电路,许多学者都用它来验证算法的有效性.本文设计的含27个逻辑门的三位乘法器电路如图8所示.6结论演化硬件作为一个新兴研究领域,在实际生活中有着广泛应用,由此引起许多学者从离线演化和在线演化角度对其进行了深入研究.本文首先引入人工设计电路的经验和规则,提出了一种扩展矩阵编码法,对于匹配度较低的电路结构进行微调,保护具有较优结构的电路个体不易被淘汰.在此基础上,基于多目标和局部寻优技术,提出一种精英池演化算法EPEA———结合子电路杂交法和基于单元重要性的自适应变异策略在片演化数字电路.实验结果表明,EPEA在片演化组合逻辑电路实用有效,且能获得结构较优的电路,这些电路可作为基本模块用于设计更复杂的硬件系统.今后我们拟深入研究部分动态可重构技术及在此基础上基于细胞自动机的自复制和自繁殖原理研究数字硬件系统的自容错、自主进化等技术.
