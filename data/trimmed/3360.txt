Page1基于非下采样Contourlet变换的视网膜分割钟桦焦李成侯鹏(西安电子科技大学智能感知与图像理解教育部重点实验室西安710071)摘要基于非下采样Contourlet变换(NSCT)良好的多尺度、多方向和平移不变性等优点,提出了一种基于NSCT的视网膜图像分割方法.该方法首先通过分析NSCT变换对血管的系数响应,提出基于NSCT的线状特征提取算法.随后对所提取的特征向量利用高斯混合模型(GMM)进行建模,并采用EM算法估计其参数.最后采用贝叶斯规则对血管和非血管像素进行分类,以达到图像分割的目的.在DRIVE和STARE两个数据库上的实验结果表明,基于NSCT的线状特征提取算法能够很好地表征血管目标,在血管的分割正确率和定位精度等指标上表现出良好的性能.关键词视网膜分割;NSCT;线状特征;高斯混合模型;贝叶斯规则1引言在医学领域,视网膜图像越来越广泛的用于病理学诊断.通过对视网膜血管系统的检查可以发现高血压、糖尿病、动脉硬化等疾病.在视网膜图像中,血管占支配地位并且结构稳定.因此,可靠的血管提取是视网膜图像分析和处理的先决条件.目前,国内外的专家们提出了许多视网膜血管增强和分割的方法,包括基于血管跟踪的方法[1-3]、基于匹配滤波的血管增强[4-6]以及基于非线性滤波器[7]和数学形态学滤波的方法[8].Jiang等人[9]提出了一种基于验证的多阈值探查方案以实现自适应局部阈值分割,即先通过假定的阈值进行二值化得到假定的目标,然后通过验证程序决定接受还是放弃该目标.Staal等人[10]利用脊检测的方法提取视网膜血管特征向量.这两种方法均取得了较好的效果.Yao等人[11]则采用向量场散度及改进的定向局部对比度等方法,先获取血管中心线再分割出最终的血管网络.针对光照影响,Du等人[12]在传统Mumford-Shah模型的基础上引入Gabor小波变换取得了较好结果,而Lam等人[13]提出一种多触点模型,很好地克服了光照影响,对正常及病态视网膜均取得了优异的性能.基于监督的血管分割方法在近几年取得了较大进展,其关键问题在于血管特征的提取.Salem等人[14]利用窗口估计提取绿色分量灰度值、局部梯度最大值和局部最大特征值作为特征向量.Soares等人[15]提出利用Gabor小波的多尺度和多方向特性来产生特征向量,取得了较好的结果.但是由于Gabor小波基函数的非正交性、倍频性能不够显著等缺点,对血管奇异性的描述存在本质的不足.Gabor小波的另一个缺点是参数调整比较复杂,限制了其应用.近几年,多尺度几何理论的发展为图像处理提供了新的思路.其中Contourlet以其良好的多尺度、多方向、平移不变等性能,获得了较为广泛的应用[16].在Contourlet的基础上,daCunha等人[17]给出了其平移不变形式,即NSCT(NonsubsampledContourletTransform).在NSCT变换的基础上图像去噪、融合、增强等算法均取得了较好的效果[18-20].本文提出一种基于NSCT的血管特征提取算法并用于视网膜图像分割.该特征的优点是:(1)由于NSCT可以从多方向、多分辨等角度对图像中的轮廓和纹理等方向信息进行稀疏表示,基于NSCT的血管特征对图像中的线状奇异性具有很强的表征能力;(2)NSCT变换是一种固定框架的多尺度多方向的变换,能够有效地避免Soares等人提取Gabor小波特征的多参数设置问题,结果更加稳定.实验结果表明,本文算法在分割正确率和分割精度等指标上表现出良好的性能,同时具有血管虚警率低、血管粘连现象少等优点,有利于视网膜图像的自动分析和诊断.本文第2节首先简要介绍NSCT的基本原理;第3节详细介绍基于NSCT的视网膜血管分割算法;实验结果在第4节中给出;最后在第5节给出小结.2非下采样Contourlet变换(NSCT)小波对具有点状奇异的目标函数是最优的基,在分析这类目标时小波系数是稀疏的,可是小波分析在处理一维信号时表现出的优异特性并不能简单地推广到二维或更高维.小波基函数在描述高维数据时表现出来的非稀疏性以及对多方向信息表示的缺乏,使得多尺度几何分析方法应运而生.Contourlet是Do和Vetterli于2002年提出的一种真正的图像二维表示方法[16],又称为塔形方向滤波器组(PDFB).它不仅继承了小波变换的多分辨率时频分析特性,而且拥有良好的各向异性特征,能用比小波更少的系数来表示光滑的曲线.但是Contourlet在变换过程中,对图像进行下采样操作,使得Contourlet变换不具有平移不变性.非下采样Contourlet变换(NSCT)去掉了Contourlet变换中的下采样操作,因此具有平移不变性,能更准确地捕获图像中的几何结构信息.NSCT由非下采样拉普拉斯塔型分解(NSLP)和非下采样方向滤波器组(NSDFB)组成,如图1所示.图像的NSCT分解分为两部分,首先经过NSLP分解得到不同的频率子带,然后再由NSDFB分解得到不同的方向子带,其2层分解示意图如图1(a)所示;图1(b)是NSCT分解后图像在频率平面的楔形频带划分.Page3图1非下采样Contourlet变换示意图3基于NSCT的视网膜血管分割本节在NSCT的多尺度性、多方向性、平移不变性基础上,通过分析视网膜图像中血管的线状奇异性,提出了基于NSCT的特征提取算法.对所提取的特征向量利用高斯混合模型(GMM)进行建模,其中参数估计采用EM算法.最后采用贝叶斯规则对血管和非血管进行分类,以达到图像分割的目的.3.1图像预处理由于视网膜圆形基底与孔径外区域存在较强的对比度,分类结果在孔径边缘处会产生大量的误判.为消除这一影响,通常对彩色视网膜图像的绿色分量进行预处理.这是因为绿色分量一般具有较好的血管-背景对比度.预处理采用迭代算法来消除视网膜基底和孔径图2视网膜图像预处理3.2特征分析及提取视网膜图像像素可分为血管和非血管(即背景)两类目标.其中血管目标具有明显的线状奇异性,而背景相对比较平滑,因此非常适合用NSCT进行稀疏表示.2.对像素集合A中任一像素,计算其邻域均值以代替该像素值;外区域的强对比度.这种迭代算法从由照相机孔径决定的感兴趣区域ROI(RegionOfInterest)开始,迭代生长该区域.设感兴趣区域模板为mask,算法的步骤如下[15]:1.利用mask找到ROI区域的边界像素集合A.边界定义为位于ROI区域外部,但是与区域内的像素满足4邻域关系的像素集合;3.将集合A中像素加入ROI区域;返回步1.迭代执行一定次数即可减弱视网膜基底和孔径外区域的对比度.本文设定迭代次数为80,邻域大小为5×5时,预处理结果基本令人满意.图2给出了预处理结果的示例,其中图2(a)是原图,图2(b)是其绿色分量,可以看出中间圆形基底区域即孔径的亮度远大于外部区域.图2(c)是对图2(b)进行迭代生长的结果.对视网膜图像的绿色分量进行L层NSCT分解,每一层利用NSDFB进一步分解为Dl个方向子带.设图像像素为x(i,j),空间上相应的NSCT系数为cl,d(i,j),l=1,2,…,L,d=1,2,…,Dl,其中l表示尺度参数,也即变换层数;d表示方向子带的索Page4引.可见分解后系数子带所处的尺度和方向对应于血管的宽度特征和方向信息.小波基函数是用“点”的方式来实现对线状奇异性的描述,而NSCT的基函数为线状,这使得NSCT可以用更少的系数来完成线状奇异性的标准.根据NSCT变换的性质可知,NSCT基函数随尺度l的增大而变宽.考虑给定宽度的血管,在不同尺度NSCT基函数的情况下,血管的响应系数可归类为3种情况:(1)当血管宽度大于基函数宽度时,此时系数在血管两侧边界均会出现局部极值;(2)当血管宽度与基函数宽度相当时,NSCT系数可以看作是匹配响应.此时系数最为稀疏且仅图3血管的NSCT响应示意图对于实际视网膜图像中,如何设计有效的特征提取算法是下一步的目标.图4所示为一幅视网膜图像在不同分解尺度同一方向上的局部系数,其中箭头所指是血管的法向方向.可以看出血管呈黑色线状,对应局部极小值;两侧白色线状为血管与背景图4NSCT变换同一方向不同尺度上的局部系数实际视网膜图像中背景一般为灰色区域,但是由于噪声干扰其系数值在零点附近波动,呈现黑白交替的纹理.这一现象在高频子带,例如l=1即图4(f)中尤其严重.实验表明在最小尺度时很多极细血管的系数响应与背景噪声的分布混叠,极大地影响了较粗血管的分割.综合以上分析,可以从像素精度设计特征提取方法.为避免噪声的影响,这里舍弃l=1时的特征,则对应于像素x(i,j)的系数特征向量可表示为其中vl(i,j)表示像素x(i,j)在第l层的特征图出现一个局部极值;(3)当血管宽度小于基函数宽度时,血管的边缘会沿法向方向拓宽,导致虚警.由于血管亮度较低,对应的系数极值为波谷.图3(a)和(b)分别给出了上述情况(1)和(2)时,沿血管法向方向的理想系数波形,其中过零点为血管.在情况(1)时,随着血管宽度的不断减小,两个过零点会不断靠近,导致由情况(1)转化为情况(2),即由图3(a)演化为图3(b).当血管宽度继续减小时,情况(3)则会出现,但是仍用图3(b)来表示.对于非血管部分,其响应系数在不同尺度NSCT基函数下统计均值为0.由此可以导出血管分割的基本思路.的交界处,表现为极大值.这一点符合上述分析.对各个尺度上的系数进行分析可知,图4(c)表示第4个尺度系数,出现了一定的虚警,对应于情况(3);随着尺度减小,虚警现象减弱,如图4(d)和(e)所示.由于不同方向的血管对应NSCT变换的系数极值会出现在不同方向子带,式(2)可以很好地处理这一问题.而背景处系数的特征值一般较小.大量实验结果表明,取L=4,方向个数Dl=8时可以获得较好的结果.在特征向量中加入绿色分量的空域灰度值x(i,j),最终得到这里省去像素坐标(i,j).对图2(b)所示灰度图进行上述NSCT变换和特征提取,得到的特征图如图5所示.通过图5(a)、(b)和(c)可以看出,不同宽度的血管极值都得到了体现,背景噪声也抑制得较好.Page5图5利用NSCT得到的特征图由于图像的亮度存在差异,需要对每一幅图像的特征向量狏单独进行归一化.特征的归一化如下其中vt表示特征向量狏的第t维特征,μt和σt分别是第t维特征的均值和标准差.最终特征服从均值为0、标准差为1的分别.3.3监督分类视网膜图像中的血管像素记为C1,背景像素记做C2,利用贝叶斯规则可决策如下[15]:x∈C1,若p(狏|C1)P(C1)>p(狏|C2)P(C2)烅烄烆其中p(狏|Ci)表示类条件概率.p(Ci)表示类别Ci的先验概率,可以根据Ci中的样本比率来估计其中Ni表示第i类样本的个数,满足N=N1+N2.类条件概率密度p(狏|Ci)可通过高斯混合模型来表示其中ki表示高斯混合模型p(狏|Ci)中高斯函数的个数.根据式(3),p(狏|j,Ci)表示维数为L的高维高斯函数,其权重为wij.实验中使用若干幅人工标记的视网膜图像建立训练数据集.对第i类Ci,给定ki个高斯分布,通过期望最大化(EM)算法来估计每个高斯分布的参数和权重,从而得到GMM分类器.4实验结果及分析4.1实验数据数据库DRIVE和STARE.实验数据来自国际公用的两个彩色视网膜图像DRIVE数据库由40幅彩色图像及其人工分割结果组成[10].图像大小为768×584,视场(FOV)直径约为540像素.40幅图像被分为训练集和测试集,各包含20幅图像.人工分割结果由经过专业训练的3个人人工分割得到,其中训练集和测试集图像均被前两个观察者人工分割,结果保存在SetA,而测试集还被第3个观察者进行了人工分割,结果保存在SetB中.SetA和SetB得到的分割结果相似.在SetA中12.7%的像素被标记为血管,而在SetB中12.3%的像素被标记为血管.STARE数据库由20幅数字化的幻灯片组成[8].这些幻灯片被数字化为700×605像素的图像,视场约为650×550.人工分割由两个观察者完成,结果分别保存在ahset(SetA)和vkset(SetB)中.SetA中结果相对保守,仅10.4%的像素被标记为血管;而在SetB中14.9%的像素被标记为血管,其中包括更多的极细血管.由于观察者都具有一定的主观性和倾向性,这导致不同观察者的分割结果之间变化较大.因此实验中分别从客观评价指标即分割正确率,以及主观评价即血管定位精度两个方面对本文方法进行评估.分割正确率是指正确分类的像素个数所占比例.血管定位精度定义为血管的检测位置与实际位置的重合程度.4.2分割正确率对于DRIVE数据库,分类器由训练集得到,再对测试集进行分类.对于STAR数据库则采用留一法进行训练和测试.训练用的分割模板均采用SetA,但是在分析测试结果时也用SetB作为参考.由于训练样本规模相当大,实验随机选取训练集合中100万个像素样本来训练分类器.GMM分类器中血管和背景两类的高斯模型个数取为相同的值k=k1=k2.Page6由于观察者都具有一定的主观性和倾向性,这导致不同观察者的分割结果之间变化较大.因此实验中分别采取客观评价指标和主观评价相结合的方法对本文方法进行评估,并与视网膜分割中的一些经典方法进行比较,如表1所示.Soares等人[15]本文方法从表1的结果可以看出,本文方法对DRIVE和STARE两个数据库都得到了很好的效果.对于DRIVE数据库,本文方法和Soares等人均优于Jiang等人和Staal等人的方法.Lam等人的方法属于非监督方法,其多触点模型表现出最优的性能.本文方法属于监督类方法,重点在于验证NSCT变换及线状特征提取算法的有效性.与基于Gabor特征的Soares等人的方法相比,本文方法在k=10时略占优,当k=15和20时,本文方法仅低0.05~0.1个百分点.对于STARE数据库,本文方法和Staal等人的方法表现较好.而当k=20时,本文方法比Staal等人的方法高出0.18个百分点,比图6DRIVE数据库图像分割结果(k=20)图7STARE数据库图像分割结果(k=20)Soares等人的方法高出0.54个百分点.这些结果说明了本文基于NSCT变换的特征提取算法的有效性.表1中还给出了SetB人工分割结果的分割正确率.由数据可以看出,不论是DRIVE数据库还是STARE数据库上,SetB的人工分割均与SetA的人工分割有一定差别.但是总的来说,上述的各种方法与SetB的人工分割在正确率达到了相当的程度.这一方面说明建立可靠的视网膜人工分割图是一个难点,另一方面则说明了现有方法在正确率上的微弱差别实际意义不大,而本文方法在正确率上可以取得与其它方法相当的结果.4.3血管定位精度为方便从主观上加以评估.由于Soares等人的方法所使用的Gabor小波特征与NSCT特征在多分辨和多方向性上具有相似性,通过对比可以说明NSCT变换的优越性.图6和图7分别给出DRIVE数据库和STARE数据库分割结果示例.由于NSCT在多方向、多分辨等角度对图像中的轮廓和纹理等方向信息具有更稀疏的表示,基于NSCT的血管特征对图像中的线状奇异性具有很强的表征能力.在整体效果上两种方法基本相当,但是Soares等人的方法容易出现血管粘连现象,如图6(d)和图7(d)中圆形标记区域所示.而本文方法的血管分割比较清晰,这从一个方面说明本文方法在单个血管的定位上更加精确.对于图8(a)中的圆形标记区域,Soares等人的方法和本文方法的分割结果可以得到相同的结论,分别如图8(b)和(c)所示.Page7图8本文方法与Soares等人的方法结果对比示意图为进一步说明本文方法的优势,图8(d)给出了Soares等人的方法与模板结果的差别图像,其中灰色区域表示Soares等人的方法和模板在分割结果上的相同部分,白色区域表示Soares等人的方法对血管的虚警区域,即模板中为标记出来的区域,黑色区域表示Soares等人的方法的漏检区域.可以看出:(1)灰色区域面积占绝大部分,说明Soares等人的方法有较好的分割正确率;(2)白色区域主要集中在血管的两侧,即分割得到的血管宽度大于实际宽度.这说明虚警较大,也正好给出了其粘连现象产生的原因;(3)黑色区域主要是极细血管处.本文方法与模板结果的差别图像如图8(e)所示.与Soares等人的方法相比,可以看出:(1)本文方法的白色区域较少,说明分割得到的血管宽度小于实际宽度,虚警现象低于Soares等人的方法,因此不容易产生粘连现象;(2)黑色区域较多,一部分集中在极细血管处,另一部分则集中在血管两侧,说明漏警较大.图8(f)给出了Soares等人的方法与本文方法的差值图像,其结果可以进一步证实以上结论.需要说明的是,黑色区域中对极细血管处的漏检普遍存在于目前的方法中,可以作为进一步研究的方向;而本文方法对血管两侧的漏检仅导致血管宽度变小,这一点对血管的细化、矢量化等后续操作是有利的,因此也有利于视网膜图像的自动分析和诊断.血管两侧的虚检则极容易导致误诊为病变区域.综上结果可以说明,本文方法对血管区域的分割较为保守.在此前提下本文方法一方面可以获得与Soares等人的方法相当或更好的分割正确率;另一方面,从视网膜图像的自动分析和诊断的角度来考虑,本文方法的血管定位精度更高,可以有效地避免血管粘连现象.5结束语本文提出基于NSCT变换的血管特征提取方法并用于视网膜图像分割.利用NSCT在多方向、多分辨、稀疏表示等方面的优点,本文详细分析了视网膜图像的NSCT变换响应并给出了对血管的线状特征提取算法.该方法具有参数设置少,虚警率低、粘连现象少等特点.在对血管保守分割的前提下,本文方法在正确分割率和血管定位精度上都具有较好的效果.实验结果证明了其有效性.由于人工分割模板以及视网膜图像的基底噪声和极细血管的Page8影响,视网膜分割方法仍然存在一些尚待解决的问题.视网膜极细血管的检测以及病变检测等可以作为今后的研究方向.
