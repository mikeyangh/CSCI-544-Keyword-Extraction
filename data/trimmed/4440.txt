Page1多宿主连接环境下隧道传输网络的一体化路由模型陈文龙1)肖融2)徐明伟3)徐恪3)1)(首都师范大学信息工程学院北京100048)2)(北京师范大学信息科学与技术学院北京100875)3)(清华大学计算机科学与技术系北京100084)摘要现有隧道传输只考虑异构网络基本连通性,是一种分段独立实施路由选择的路由模型,没能对端到端跨越异构网络的传输路径进行一体化考虑.针对边缘网到支撑网的多宿主连接网络环境,提出了一种跨异构网络的一体化路由模型URM(UnifiedRoutingModel).URM模型采用参考度量实现对异构网络路由优劣的统一描述,利用BGP协议扩展实现参考度量的传递,并设计了参考度量与传统度量的转换方法.URM模型实施时影响范围很小,只需对隧道网关进行简单改造即可完成,最终的一体化路由机制也是透明地利用现有路由机制完成.URM模型会给异构网关和边缘网路由器带来更多的信息存储,但其优势却非常明显,在实现端到端一体化最优路由选择的同时,增加了隧道传输的可用路径并提高了隧道传输可靠性.仿真实验及真实设备组网实验验证了URM模型的一体化路由选择能力及路由收敛能力.关键词隧道;一体化路由;参考度量;映射1引言随着互联网规模、服务和应用的全面发展,大量新型网络模型不断涌现.隧道传输[1-2]因为其诸多优点,已被广泛应用于多种新型网络模型.隧道传输通过数据封装实现一种网络标识数据基于另一种网络的透明传输.例如,IPv4/IPv6过渡方案中的自动隧道机制Softwire[3],实现了不同IPv4边缘网跨越IPv6核心网的通信.同样,为解决互联网快速增长带来的路由可扩展问题,研究者提出的标识空间分离方案[4-5],也是通过隧道来实现.本文定义了隧道传输涉及的两种网络角色:支撑网络SNET(SustainingNetwork),即通过分组封装提供异构网络透传的底层网络;边缘网络ENET(EdgeNetwork),即利用分组封装并基于支撑网络完成跨异构网络的分组传输.现有隧道传输网络通常只提供异构网络的基本连通性,没能对端到端跨越异构网络的传输路径进行一体化考虑,是一种孤立的路由模型IRM(Inde-pendentRoutingModel).边缘网络把支撑网络当作转发路径中的一条链路,支撑网络不关心分组在边缘网络的传输情况.这种简单、独立的转发过程,失去了对网络传输服务的全局把握,无法为用户数据提供高效的一体化路由服务.图1描述了现有隧道传输网络路由机制的不足,包括以下方面:(1)路由度量信息丢失.支撑网络和边缘网络有各自的路由体系和度量参数,标识映射项不存储相应的度量参数.因而,标识映射作为边缘网和支撑网路由体系的纽带,丢失了异构网络路由度量的描述;(2)异构网络状态互不感知.同构网络的网络状态变化(如节点或链路故障),都会通过路由等方式被其他节点所感知.然而,标识映射系统却没有相应机制完成异构网络状态变化的学习;(3)不支持异构网络多宿主连接.现有标识映射系统基本不支持一个边缘网络通过多个异构网关连接到支撑网络,无法为封装分组提供灵活、可靠的网络转发服务.本文面向异构网络多宿主连接环境[6],提出了隧道传输网络的一体化路由模型URM(UnifiedRoutingModelforTunnelingTransmissionNetwork),URM围绕隧道传输网络端到端最优路径选择这个核心问题展开研究.针对不同的路由体系,引入参考度量来统一描述异构网络的路由优劣,并设计了边缘网络传统度量、支撑网传统度量和参考度量间的转换方法.本文还针对目前最为典型的隧道传输网络———面向IPv4/IPv6过渡的4over6网络,给出了支持URM模型的异构网关具体设计,并基于Bit-EngineNetwire4600过渡设备①完成了异构网关原型系统实现.URM模型考虑了对现有路由体系的兼容,所设计的参考度量只是充当传统路由度量在异构网络传递的载体,单个网络中的路由方法仍然按照各自的传统路由机制实施.此外,本文从多个方面分析了URM模型的性能优劣,基于原型系统的真实组网实验则进一步验证了其一体化路由能力.本文第2节介绍隧道传输、多宿主连接及互联网路由的相关研究;第3节分析现有隧道传输过程,以及异构网络多宿主连接环境下隧道传输面临的路由问题,并提出了本文的工作目标;第4节给出基于参考度量转换及传递的隧道传输网络一体化路由模型;第5节对URM模型的路由/映射信息存储、隧道传输路径及传输可靠性等重要网络性能进行分析;第6节介绍面向本文URM模型的异构网关设计;第7节描述仿真实验、真实组网实验及相关性能分析;第8节对全文工作进行总结.2相关研究隧道传输技术被广泛应用于各种新型互联网模型中,如面向下一代IPv6互联网过渡的隧道传输网络模型、面向互联网路由可扩展问题的标识空间分离网络模型、虚拟网络模型等等.文献[3,7]是IETF工作组提出的软线式网状架构:Softwire,它利用地址映射解决IPv4与IPv6之间的过渡问题,IPv4报文封装在IPv6报文里传输.每个IPv4/IPv6网关AFBR(AddressFamilyBorderRouter)存储全网的映射信息,映射信息通过扩展的BGP协议[8]进行通告.源端系统将IPv4报文发送到所属的AFBR进行封装,并经IPv6网络发送到目的端AFBR,由AFBR进行解封装,将载荷(原始的IPv4报文)还原出来,根据其目的IPv4地址继续向目的端转发.Softwire技术实现了①http://www.bit-way.com/Page3面向大规模IPv4/IPv6过渡的无状态自动隧道技术,通过扩展互联网核心协议MP-BGP[8],提供了跨越IPv4/IPv6异构网络的路由寻址方法.文献[9]还基于IPv6隧道实现了现有IPv4NAT终端用户的IPv6地址分配及用户到IPv6网络的访问.隧道传输技术也用于解决互联网可扩展路由问题,主要实施在地址空间分离解决方案中.该方案将用户位置标识和路由标识分离,基于隧道技术完成端到端数据包在核心网的传输.通常,称用户位置标识为“边缘网地址”,用户路由标识为“核心网地址”,代表技术有LISP[4]、APT[5]等.LISP协议将Internet地址分离为终点标识符(EID)和路由定位符(RLOC),通过隧道封装及地址映射的方式将核心网络和边缘网络分离来实现位置分离.为了完成从EID到RLOC的标识映射,LISP利用LISP+ALT通过层叠网来完成映射服务[10].LISP+ALT使用树形结构提供映射服务,叶子节点存储实际的映射信息,通过BGP和GRE隧道建立了一个可完成数据探针包、映射请求包和映射应答包传递的逻辑拓扑.文献[5]提出了一种能真正在互联网部署的地址空间分离模型APT(APracticalTunnelingArchitecture).该技术的信息传递是通过将不可被全局路由的地址封装在可全局路由的地址中,由入口隧道路由器进行封装,出口隧道路由器进行解封装来实现的.APT定义了默认映射器DM来存储全部映射信息,APT模型的映射信息获取是一种PULL/PUSH混合模式,DM之间通过DM-BGP交换映射信息,边缘路由器通过cache存储映射信息.然而,cache的维护非常麻烦,易受攻击,默认映射器DM也需要很高的性能来支持报文快速转发和映射关系的交互及维护工作.隧道技术还广泛应用于各种虚拟网络技术中.文献[11]设计了VegaNet(VirtualGigabitNetwork),它是一种为网络研究提供真实实验环境以及对核心网络进行模拟分析的高性能虚拟网络.VegaNet中各种功能特性的实现基础,就是异构网络间的隧道封装技术.多宿主(Multihoming)技术是当前各机构或终端设备接入互联网的常用方法,文献[12]对现有的多宿主连接方法进行了分类与比较,总结了其在网络可靠性、负载均衡等方面的重要意义,学者还通过数学方法分析出最有效的多径部署方法[13].Shim6工作组提出了基于IPv6的站点Multi-homing的解决方案[14-15].它能够使得Multi-homing主机使用的IP在一个IP地址前缀的集合中切换,而不影响传输层和应用层.Shim6架构不仅支持站点的多宿主连接,还通过身份/位置分离技术解决了互联网路由可扩展问题.多径连接环境下,移动终端所面临的传输问题广为学者关注,文献[16]通过对发送端分组调度来提高多径传输效率,文献[17]希望基于位置ID和节点ID的概念来解决复杂环境下的多径通信问题.RFC6182[18]针对互联网主要的传输层协议TCP,设计多径传输架构来提高用户网络体验.LISA-Recovery[19]针对站点多宿主环境,根据路径状态监测,控制数据在多个传输路径间的选择和切换,提高了网络容错能力.此外,多宿主路由控制技术也在商业设备中应用多年,但是路径切换功能却存在导致路由振荡的可能,Liu等人[20]针对此问题提出了用户最优路由来规避路由振荡并提高路由性能.当前互联网几种典型的路由协议都有各自的路由度量方法.RIP[21]协议是一种经典路由协议,它工作简单,常被应用于小型域内路由体系中.RIP协议以路由跳数为路由度量参数.OSPF[22]是目前应用最广泛的域内路由协议,它根据SPF算法进行路径选择.OSPF协议以链路cost值作为其路由度量参数.然而,链路cost值是一个抽象的度量参数,管理员可根据具体情况确定不同的设定依据,如链路带宽、链路距离、链路可靠性等等.BGP协议[23]是互联网普遍使用的唯一的域间路由协议,它利用多个BGP属性完成路由决策和控制,其中BGP属性包括路由信息来源(Origin)、AS路径(AutonomousSystemPath)、下一跳IP地址(Next-hop)等等.现有路由体系及其路由度量方法,只为单一标识网络服务,并不面向隧道传输这种异构网络提供一体化度量方法及一体化路由机制.上述各种隧道传输网络及路由体系的研究分析,表明当前的隧道传输模型存在着一些共性问题:隧道传输涉及的异构网络度量信息不关联,在状态变化时的互不感知,无法提供端到端传输的快速收敛;大部分模型不支持多宿主异构网络连接,无法提供灵活、可靠的异构网络连接;不支持跨异构网络的一体化路由传输体系,无法实现跨异构网络的最优传输路径决策机制.3隧道传输网络的路由分析首先给出隧道传输网络的主要符号定义.除了前文已定义的支撑网络SNET和边缘网络ENET,定义支撑网节点标识为S_ID,边缘网节点标识为Page4E_ID.另外,定义边缘网和支撑网的路由连接设备为异构网关H_GW(HeterogeneousGateWay).隧道传输的基本过程如图2所示.源端系统发出原始报文,经边缘网到达源端异构网关;源端异构网络根据原始报文的边缘网目的标识查询对应的支撑网标识,并将报文封装发送至目的端异构网关.目的端异构网关解封装得到原始报文,并根据目的端边缘网路由发送到最终的目的端系统.隧道传输总是与标识映射密切关联,传统标识映射关系中,某个边缘网络标识只会被1个支撑网络标识所代表.本文提出的多宿主连接结构,1个边缘网络标识将对应1个或多个支撑网络标识.标识映射关系也可理解为一种代表关系,即1个边缘网络标识被1个或多个支撑网络标识所代表.如图3所示,边缘网通过多个通道接入支撑网络(多宿主连接),这将提高边缘网到支撑网的连通可靠性及连接带宽.此时,跨异构网络的端到端传输路径也变得多样化,图3中主机H1到H2的通信有多种可能的传输路径.由于主机到末端路由器ER(EndRouter)的一跳传输路径是确定的,所以本文只分析路由设备间的传输路径.H1到H2有4条传输路径:{ER1,H_GW1,H_GW3,ER2},{ER1,H_GW1,H_GW4,ER2},{ER1,H_GW2,H_GW3,ER2},{ER1,H_GW2,H_GW4,ER2}.所以,需要为异构网络传输寻找最为合适的传输路径.同时,由于多条传输路径的存在,应该支持网络状态变化时的异构网络传输路径的快速切换.当然,异构网络一体化路由的前提是各个异构网络的路由度量能相互传递并实现一体化评价,即统一异构网络的路由度量.所以,多宿主连接环境下隧道传输网络的一体化路由模型面临3个主要问题:(1)如何统一隧道传输网络中不同路由体系的度量标准,并实现路由度量在异构网络间的传递;(2)基于统一的路由度量,如何实现跨异构网络的端到端一体化最优路径决策;(3)面向一体化路由模型的异构网关设备设计.本文工作正是围绕上述问题展开.4一体化路由模型令图3中末端路由器ER1~2的所辖边缘网标识段为E_ID1~2,H1和H2主机标识分别属于标识段E_ID1和E_ID2,异构网关H_GW1~4的支撑网标识分别为S_ID1~4.隧道传输网络中,异构网络都有各自的路由体系,并根据不同的网络状态设置路由度量.然而,跨异构网络的一体化路由必须将不同的路由度量相互关联,本文通过参考度量实现这一目标.定义1.参考度量.针对异构网络中不同路由体系路由优劣的统一数值化表示,记作RM(Refer-encedMetric).参考度量可以表示跨异构网络路径的优劣.假设异构网络中有两条传输路径PATH1和PATH2,它们对应的参考度量分别为RM1和RM2,若RM1<RM2,则称PATH1优于PATH2.同时,将传统路由度量定义为CM(ConventionalMetric).考虑对现有网络的兼容性,参考度量只是用作传统路由度量在异构网络传递的载体,单个网络中的路由方法仍然按照各自的传统路由度量实施.所以,一体化路由模型需要实现参考度量与传统度量的互转,以及参考度量的传递.定义2.标识映射.定义标识映射为边缘网标识E_ID到支撑网标识S_ID的映射,表示为〈E_ID,S_ID,RM〉.映射项中的参考度量RM是专门为异构网络一体化路由而设计的,现有隧道网络中的映射项并无此参数.由于边缘网以多宿主方式接入支撑网,一个边缘网标识可能对应多个支撑网标识,并有各自的参考度量.标识映射的产生、存储及传播过程都与参考度量密切关联.异构网关生成新的标识映射时,将异构网关到边缘网标识的路由度量转换为参考度量,存储于标识映射中.标识映射携带参考度量在支撑网络中传播,但最终会将参考度量转换成传统度量,为路由决策提供依据.定义3.度量转换.定义度量转换函数为F:Page5CMRM,实现参考度量与传统路由度量的互转.传统度量转换为参考度量,是为了统一描述异构网络传输路径的优劣.而参考度量转换为传统度量,是为了将参考度量对路由寻径的影响,无缝融入到现有路由机制中.URM模型包括3个度量转换函数F1~3.边缘网传统路由度量到参考度量的转换函数F1.F1(CMe,Vcm,{P1,V1,P2,V2,…,Pn,Vn},SMout)=Vcm×CMe+∑n烄烅SMout,烆其中,变量V对应不同参数的权重,有Vcm+∑n该度量转换有3个参考因素:(1)边缘网传统度量CMe,它是F1最主要的转换依据;(2)异构网关到端系统的各种网络状态参数Pi,常见参数包括路由跳数、物理距离、链路带宽、链路稳定性、网络拥塞状况等,Pi可由异构网关实时学习获取,或者由管理员配置;(3)标识映射发布策略SMout,网络运营者可直接对外发布某标识映射的参考度量.发布策略可以对非常规信息进行描述,主要考虑计费、负载均衡、安全等因素,由管理员配置.例如,通过访问控制列表ACL(AccessControlList),指定特定边缘网标识E_ID的参考度量值.F1在异构网关生成标识映射信息时实施.例如,图3中H_GW1生成E_ID1的标识映射项时,将异构网关(H_GW1)到边缘网目的网络(E_ID1)的传统度量转换为“参考度量1”,并存储于异构网关H_GW1中E_ID1的标识映射项里.支撑网传统路由度量到参考度量的转换函数F2.F2(CMs,Vcm,{P1,V1,P2,V2,…,Pn,Vn})=Vcm×CMs+∑n变量V对应不同参数的权重,有Vcm+∑n1.该度量转换有2个参考因素:(1)支撑网传统路由度量CMs,是主要的转换依据;(2)异构网关到端系统的各种网络状态参数Pi,与转换函数F1的描述相同.F2在异构网关学习到标识映射信息时实施.例如,图3中H_GW3学习到E_ID1的标识映射项时,会将H_GW3到H_GW1的传统度量转换为“参考度量2”,该参考度量用于描述两个异构网关(H_GW1和H_GW3)传输路径的优劣,但“参考度量2”不会被直接存储.异构网关H_GW3将“参考度量1”和“参考度量2”相加得到“参考度量3”,并将其存储于E_ID1的标识映射项中.“参考度量3”涵盖了2段异构网络传输路径的优劣.参考度量到边缘网传统度量的转换函数F3.该度量转换有2个参考因素:(1)标识映射对应的参考度量;(2)网络运营者的标识映射引入策略SMin.F3在异构网关将标识映射信息转变为路由项向边缘网络发布时实施.例如,图3中H_GW3到向ENET2发布E_ID1的路由时,会将H_GW3→H_GW1→ER1路径的参考度量转换为ENET2的传统度量,该传统度量将在现有边缘网路由体系中影响数据的路由转发.图4描述了3个转换函数的使用方法以及它们之间的关系.其中,网络状态参数以及标识映射发布/引入策略的配置与一体化路由模型的具体实施密切相关.本文后续描述中,度量转换主要根据传统路由度量完成,以最直接的路由跳数作为传统路由度量的唯一参数,并与参考度量实施等值转换.度量转换、参考度量存储及参考度量传递等事件,都是在隧道传输网络标识映射的生成和传递过程中发生.以图3中ER1所辖标识段E_ID1为例,分析其映射项及路由度量在异构网络中的传播过程.假设双向路由度量等值,即网络中任意一条路径的往、返路由度量总是相等.主要步骤如下.步骤1.各个同构网络完成传统路由学习,各相关路径的路由度量如图5所示.步骤2.H_GW1学习到路由〈E_ID1,CM1〉,生成标识映射项〈E_ID1,S_ID1,RM1〉,其中RM1=F1(CM1),并利用SNET路由协议扩展在SNET各Page6F2(CM5);F2(CM7).F2(CM6);F2(CM8).〈E_ID1,S_ID2,RM4〉,满足RM4=RM2+H_GW4存储的标识映射项为〈E_ID1,S_ID2,RM5〉,满足RM5=RM1+〈E_ID1,S_ID2,RM6〉,满足RM6=RM2+异构网关中传播,即各异构网关都能学习到此标识映射(关于标识映射在支撑网络的传播、学习方法可参见本文前期工作[24]).同理,H_GW2学习到路由〈E_ID1,CM2〉,生成标识映射项〈E_ID1,S_ID2,RM2〉,并传播到各异构网关,其中RM2=F1(CM2).步骤3.H_GW3和H_GW4分别学习到2条针对E_ID1的映射项,并结合支撑网传输路径的路由度量,更新映射项的参考度量.H_GW3存储的标识映射项为〈E_ID1,S_ID1,RM3〉,满足RM3=RM1+步骤4.H_GW3根据映射项生成新的ENET2路由项:〈E_ID1,CM9〉,并向边缘网ENET2发布;其中,CM9=min(F3(RM3),F3(RM4)).同理,H_GW4生成新的ENET路由项:〈E_ID1,CM10〉,并向ENET2发布,其中,CM10=min(F3(RM5),F3(RM6)).步骤5.ER2学习到2条目的标识为E_ID1的路由:〈E_ID1,CM11〉,满足CM11=CM9+CM3;〈E_ID1,CM12〉,满足CM12=CM10+CM4.图5中各路由器针对E_ID1的路由项或标识映射项如表1所示,各表项度量值都能体现路由设备到目的标识的跨异构网络的路径优劣.由于本文主要关注路由或映射项的度量值,所以各表项的其他字段并未描述.例如,ER2的两条路由项具有不同的“下一跳(nexthop)”;而H_GW3的两条映射项蕴涵着不同的封装对端,也对应着不同的封装报文传输的“下一跳”,这些都不做详述.表1路由项/映射项及其度量描述(图5示例)ER1E_ID1直连路由H_GW1〈E_ID1,CM1〉〈E_ID1,S_ID1,RM1〉H_GW2〈E_ID1,CM2〉〈E_ID1,S_ID2,RM2〉H_GW3H_GW4ER2上述控制层处理完成后,各路由设备就可根据自身存储的路由项或标识映射项实现异构网络的报文传输.以图5为例,分析从ER2发送目的标识为E_ID1报文的数据转发过程.(1)路由器ER2收到源端系统发来的报文,根据传统路由选择路径.ER2比较传统度量CM11和CM12,选择度量较小的路由实施转发,该传统度量值是ENET2、SNET、ENET1三段传输路径的路由度量汇总.选择度量值CM11表示通过异构网关H_GW3进行隧道封装发出,CM12则对应异构网关H_GW4.假设CM11小于CM12,则ER2将报文发送到异构网关H_GW3.(2)发送端异构网关H_GW3收到边缘网发来的报文后,查找标识映射表确认其需要封装,并根据映射项的参考度量选择对端异构网关,实施报文封装及发送.即H_GW3比较标识映射项的参考度量RM3和RM4,选择度量较小的标识映射进行封装发送.RM3对应的封装终点为H_GW1,RM4对应的封装终点为H_GW2.假设RM3小于RM4,则隧道传输对端为H_GW1.(3)接收端异构网关H_GW1收到支撑网发来的封装报文后,进行解封装,并根据传统路由转发原始报文.如H_GW1解封装后将报文发送至ER1.(4)接收端路由器ER1收到报文后转发给直连目的端系统.5性能分析便于分析,有表2所示符号定义.符号E边缘网数量Hi/Ha(ENETi/平均每边缘网)异构网关数Ri/Ra(ENETi/平均每边缘网)路由前缀数量Ba平均单个异构网关接入支撑网带宽MCs/MCm(单点连接/多宿主连接)环境下异构网关控制层MDs/MDm(单点连接/多宿主连接)环境下异构网关数据层REs/REm(单点连接/多宿主连接)环境下边缘网路由器路FEs/FEm(单点连接/多宿主连接)环境下边缘网路由器转5.1映射项存储多宿主连接环境中,一个边缘网通过多个异构网关接入支撑网,每个异构网关都会针对所辖边缘Page7网同一地址前缀发布标识映射.对于任一边缘网ENETi,有Hi个异构网关及Ri个边缘网前缀,则该边缘网向外发布(Hi×Ri)个标识映射项.对于边缘网ENETk的异构网关,它将从支撑网学习到远端边缘网的映射信息,数量为∑k-1此外,异构网关自己也会产生Rk个标识映射,所以该异构网关总共存储的映射项数量为∑k-1∑E(Hi×Ri)+Rk.为便于分析,对边缘网的异构i=k+1网关数及边缘网路由前缀数取平均值,则任一异构网关控制层存储的映射项数量MCm满足MCm=∑k-1(Ha×Ra)+∑Ei=1明,同一个边缘网的不同异构网关之间不会建立BGP连接,也不会交互映射信息.互联网路由设备中,路由引擎通过路由协议学习各种路由信息,并针对每个目的前缀选择一条最优路由存储到数据转发层.由于报文高速处理时主要在数据层完成,数据层的表项容量直接影响着转发速度以及昂贵的硬件资源,现有研究主要关注数据转发层的表项存储.面对多宿主连接网络,异构网关可能会学习到针对同一边缘网前缀的多个标识映射项,但只会选择一条参考度量最优的映射项存储于数据转发层.而且,异构网关的数据层无需存储自身产生的映射项.所以,对于边缘网ENETk的异构网关,它的数据转发层存储的映射项数量为∑k-1样,取平均值分析,则异构网关数据层映射项存储数量MDm满足式(2).现有隧道传输网络中边缘网通过单个异构网关连入支撑网,此时Hi为1,边缘网ENETk的异构网关控制层的映射项数量为∑E为∑k-1i=1下异构网关控制层映射项数量MCs及数据层映射项数量分别满足式(3)和式(4).Ri+∑E5.2路由存储支撑网络中的普通路由器(非异构网关),只需实施普通的支撑网路由转发,不关心边缘网的多宿主连接,这些路由器的控制层路由项和数据层转发项也不受影响.单点连接环境中,每个边缘网路由器只需存储所在边缘网的路由,对于目的端在其他边缘网报文,可简单通过默认路由到达异构网关.所以,边缘网ENETk中路由器的路由表容量为(Rk+1),数据层的转发项数量也为(Rk+1).取平均值分析,则边缘网路由器控制层路由表容量REs和数据层转发项数量FEs满足式(5).多宿主连接环境中,边缘网ENETk的多个异构网关会向边缘网路由器发布远端的同一前缀的路由信息,加上ENETk自身的路由信息,ENETk中路由器的路由表容量为∑k-1取平均值分析,边缘网路由器路由项数量REm满足式(6).由于数据层只会选择最优路由存储,所以ENETk中路由器的数据层转发项数量为∑k-1取平均值分析,则多宿主连接环境下边缘网路由器转发项数量FEm满足式(7).5.3隧道连接带宽及可靠性边缘网单点连接环境中,每个边缘网到支撑网的连接带宽为Ba.而且,单点连接还导致隧道传输的可靠性较低,对于任意两个不同边缘网的端系统间的隧道传输路径数量都为1.多宿主连接环境中,第i个边缘网到支撑网的连接带宽为(Hi×Ba),取平均值则为(Ha×Ba).对于任意两个不同边缘网的端系统间的隧道传输,假设源端为ENETi,目的端为ENETj,则共有(Hi×Hj)条可选路径,取平均值则可选路径数为(Ha)2.显然,多宿主连接将导致隧道传输的可靠性显著提高.5.4综合分析两种模型的性能分析比较如表3所述.与现有IRM模型相比,URM模型对支撑网普通路由设备没有任何影响.然而,它会使异构网关存储更多的地址映射信息,以及边缘网路由设备存储更多的路由项/转发项.针对同一目的前缀的多个映射项或路由项的合并存储,可确保两种模型的表项存储链接结Page8构完全一致,这也使得路由系统控制层计算复杂度基本一样.作者的前期工作还针对异构网关映射项存储进行了优化研究[24].当然,URM模型带来的优表3多宿主连接网络与单点连接网络的性能比较映射项数量E×Ra(E-1)×Ha×Ra+RaURM多宿主连接环境使控制层映射项数量随“每边缘网异构网异构网关控制层异构网关数据层映射项数量(E-1)×Ra(E-1)×RaURM模型不会带来数据层存储容量的增加路由项/转发项边缘网路由数量Ra+1(E-1)×Ra×Ha+RaURM模型中,边缘网路由器需存储各边缘网路由信息,并随“单个边缘网异构网关数”倍数增长,但可合并同一前缀的多个路由项URM模型中,边缘网路由器存储的转发项数为各边缘网前缀数边缘网转发项数量Ra+1量之和URM模型使边缘网到支撑网的可用带宽随“每边缘网异构网关边缘网到支撑网数”倍数增长URM模型隧道传输的可靠性大大增加隧道传输路径数量路由选择特点分段选择6异构网关设计4over6过渡技术,是典型的隧道传输网络应用,已在我国CERNET2网络中的百所高校部署.本文以4over6为例,研究多宿主连接隧道网络中异构网关的功能设计,称该设备为“过渡网关”,该设计也可为其他类型的隧道网络提供参考.4over6网络中的映射信息描述为〈PFX4,ADDR6,RM〉,分别对应了IPv4前缀、IPv6地址和参考度量.过渡网关基于IPv4/v6双栈路由器设计,支持多宿主连接环境的一体化路由机制及报文转发.过渡网关主要涉及图6所示的3个功能层次.(1)路由协议及配置层IPv4路由协议功能模块没有任何变化,完成IPv4路由的学习及发布.IPv6路由协议中,根据RFC2858[8]进行BGP协议的扩展,实现“IPv4地址前缀IPv6地址”映射信息的发布及学习.而且,针图6面向4over6隧道的异构网关功能结构势非常明显,在实现端到端一体化最优路由选择的同时,增加了隧道传输可选路径数量,提高了隧道传输的可靠性.关数”倍数增长,但可合并同一前缀的多个映射项两种模型与支撑网的路由/转发存储性能无关联对一体化路由模型,每条映射信息的发布都需配置相应的参考度量值.扩展BGP协议向外发布的地址映射信息,由下层的地址映射管理模块生成.相应的,过渡网关通过BGP协议学习获得的地址映射信息,也通告地址映射管理模块完成后续处理.此外,地址映射配置模块用于实现管理员对地址映射信息的静态配置,如有需要可根据网络运营需要直接配置指定映射信息的参考度量.(2)路由管理及地址映射管理层该层为了实现4over6隧道传输,在现有双栈路由管理基础上引入了地址映射管理模块,包括如下子模块.映射表维护.实现映射信息的增加和删除.一方面,从IPv4路由管理获得本边缘网的IPv4前缀,它们都与过渡网关的IPv6地址对应,产生本地映射信息“IPv4地址前缀IPv6地址”.该映射信息将通过BGP协议向外发布.另一方面,它通过上层BGP协议学习远端地址映射信息.Page9度量转换.根据前文所述的度量转换函数F1~3进行实施.当本地产生映射信息时,将IPv4路由度量转换为参考度量(即F1),该度量随地址映射向外发布.当从上层BGP学得远端地址映射信息〈PFX4,ADDR6,RM〉时,根据ADDR6查询本地IPv6路由表,获得对应的IPv6路由度量,并将该传统度量转换为参考度量RM(即F2).最后,该映射项对应的参考度量为(RM+RM).IPv4路由转换.过渡网关通过BGP协议从远端学得映射信息后,根据映射信息中的IPv4前缀生成IPv4路由通告给IPv4路由管理.需要强调,过渡网关可能学到多条针对同一IPv4前缀的映射项,过渡网关只会生成一条IPv4路由,并选择最优的参考度量转换为IPv4传统度量(即F3),随IPv4路由项向边缘网发布.IPv4/IPv6路由及度量监测.监测IPv4路由表项的增删,并对本地产生的地址映射项实施增删.如果IPv4路由度量发生变化,也需更新地址映射项的参考度量并向外发布.另外,对于学习到的远端映射项,需要监测映射项IPv6地址对应IPv6路由项的路由度量,它们的变化将导致映射项参考度量的重新计算.(3)数据转发层IPv4转发引擎.IPv4/IPv6地址映射信息将与IPv4转发表融合存储,即某个转发项可能用于传统IPv4转发,也可能用于IPv6隧道封装.针对同一IPv4前缀的多条映射项,只会选择参考度量最优的映射项存储,同时存储映射项的IPv6地址用于报文封装.对于接收的IPv4报文,取其目的IP地址进行图8两种路由模型路由选择能力分析IPv4最长前缀匹配.匹配结果可能是普通IPv4转发,也可能是IPv6封装处理.IPv6转发引擎.除了传统的IPv6转发,还需对目的IPv6地址为本机的封装报文提交至“封装/解封装”模块实施解封装处理.封装/解封装处理.对于IPv4转发引擎转交而来的报文,根据匹配结果进行“IPv4inIPv6”封装,并交至IPv6转发引擎实施IPv6转发.对于IPv6转发引擎转交而来的报文,进行解封装并交至IPv4转发引擎实施IPv4转发.7实验分析首先分析URM一体化路由模型的端到端路由选择能力.实验针对的目标网络如图7所示,两个边缘网络ENET1和ENET2分别通过i个异构网关接入支撑网络,令URM及IRM两种路由模型都基于路由跳数最短进行路由选择.实验中,随机生成末端路由器ER1~2到各自边缘网不同异构网关的路由跳数,并随机生成ENET1任一异构网关到ENET2每个异构网关的支撑网路由跳数,假设上述每段路径的路由跳数取值范围为1~10.实验针对单个边缘网异构网关数量i的不同取值进行,实验结果如图8Page10所示.当i=1时,即各边缘网都是单点连接支撑网络,此时URM与IRM的路由选择完全一样,并无优势.但当i=2时,URM模型明显优于IRM模型,多数情况下URM选择的路由跳数会优于IRM模型.当i=3或4时,URM模型的优势更为明显.本文基于Bit-EngineNetwire4600系列过渡设备,按照第6节完成了异构网关的原型系统设计,它可支持IPv4/IPv6异构网络的一体化路由.首先对异构网关的隧道转发性能进行测试.将IXIA测试仪的两个千兆接口分别连接异构网关的两个千兆接口,分别测试普通IPv4报文转发性能及4over6封装转发性能.实验针对不同大小报文进行转发性能测试,最小报文为64字节,最大报文为1478字节(由于4over6封装需增加40字节的IPv6头部),实验结果如图9所示.对于普通IPv4报文转发,64字节报文转发能力将近900Mbps,长度超过200字节的报文都能达到千兆线速转发.对于4over6转发,64字节报文转发性能为520Mbps,随着报文长度增加转发性能提升,长度超过700字节的报文转发性能稳定在900Mbps左右.由于4over6转发过程中,异构网关会增加40字节的IPv6头,而实验中转发性能统计是针对入接口IPv4流量进行,所以可认为4over6转发也基本达到了线速处理.利用IXIA测试仪,实施异构网关的报文转发时延测试,实验结果如图10所示.URM模型中4over6处理的设备转发时延,相对于普通4over6转发模型相差无几.这是因为URM模型在异构网关的数据处理过程,相对于普通4over6转发,没有增加任何额外处理步骤.利用异构网关搭建隧道传输网络,测试URM模型的整体路由收敛能力,网络拓扑如图11所示.其中,R2、R3、R6、R9是根据本文思想设计的异构网关,其他路由器为普通的IPv4路由器或IPv6路由器.为了描述方便,定义图11下部路径(R1-R2-R3-R4-R5)为PATH1,上部路径(R1-R9-R8-R7-R6-R5)为PATH2.两端是IPv4边缘网,分别运行各自的OSPFv2路由协议,各条链路cost值全部设置为1,异构网关将边缘网路径cost值设为参考度量随IPv4-IPv6地址映射信息传递.中间是IPv6支撑网,运行OSPFv3协议,也将链路cost值设置为1.另外,支撑网中R2-R3、R9-R6间建立iBGP连接,运行扩展的iBGP路由协议.上述机制使得整个隧道传输网络将以物理跳数作为基本度量,选择端到端最优转发路径.通过主机H1和H2之间的端到端通信,测试异构网络隧道传输体系的一体化路由机制.为了突出实验效果,实验中在R6-R7-R8-R9路径上注入100Mbps的背景流量.图11隧道传输网络一体化路由实验网络拓扑实验1.利用hrPING(一个高精度的PING工具)测试H1到H2的RTT值,以及网络状态变化对RTT的影响.待各路由协议稳定运行后,开始测试RTT值,第30秒断开链路link1,第60秒link1恢复正常连接.实验结果如图12(a)所示.网络初始稳定时,hrPING显示转发跳数为5跳且RTT为图12(a)第1段连线,此时传输路径为PATH1.当第30秒link1断开后,图12(a)显示发生了明显的丢包,之后其RTT值有了明显的增加且hrPING显示转发跳数为6跳,显然传输路径切换为PATH2.第60秒恢复link1连接后,从图12(a)可以看出传输路径在第170多秒才开始切换回PATH1传输路径,这是因为端到端传输路径经历了两次OSPFv2收敛(中间支撑网的OSPFv3并不受影响)及一次BGP收敛.实验2.利用Iperf工具测试H1到H2的TCP传输带宽.实验过程的网络状态变化和实验1相同,实验结果为图12(b).TCP带宽也在第30秒后出现短暂几秒的0值,之后因为路径切换导致带宽较低Page11并在第170多秒恢复高带宽传输.为了更清楚地分析网络状态变化对单向传输路径的变化影响,继续利用Iperf工具测试H1和H2间的单向UDP传输带宽.实验3.基于链路link1的断连及恢复过程,分析H1→H2的单向传输路径及UDP带宽,实验过程和实验1相同,实验结果为图12(c).可以看出,H1→H2的单向UDP带宽的变化,和实验1、实验2基本类似.然而,接下来的实验4却有与前3次实验不一样的结果.实验4.基于链路link2的断连及恢复,分析图12隧道传输网络一体化路由实验各项性能分析继续分析异构网关及边缘网路由系统的存储代价.在R4中配置不同数量的IPv4静态路由,并重定向至边缘网OSPF协议中,这些路由将转化为映射项或路由项在全网传播.IRM模型实验拓扑如图13所示,两个边缘网分别只配置一个异构网关:R6和R9.URM模型的实验仍在图11拓扑中完成.分析异构网关R9和边缘网R1路由器的控制层存储和数据层硬件转发存储差异,如图14所示.针对同一IPv4前缀,URM模型下的异构网关R9要存储2份去往不同异构网关的的映射信息.但通过同一IPv4前缀映射信息合并存储,URM模型较IRM模型会耗用略多的控制层内存,如图14(a).对于数据层核心转发资源三元内容可寻址存储器TCAM(TernaryContentAddressableMemory),总是以72bits为一个单元分配使用.两种模型下异构网关对TCAM资H2→H1(注意实验4与前3次实验的数据传输方向不同)的单向传输路径及带宽.实验过程和实验1类似,只是将针对链路link1的操作,替换为针对链路link2的操作.实验结果为图12(d),与前3次实验不同的是,link2断连并恢复正常后导致的路径切换发生在第120多秒,而不是前3次实验的第170多秒.分析可以发现,link2的状态变化在H2→H1的单向传输路径中,只会对H2所属的IPv4边缘网选路产生影响.也就是说,link2恢复连接时,只需经过一次OSPFv2收敛即可促成H2→H1的单向传输路径切换.源的耗用没有差异,如图14(b),都只存储最好的一条转发项.此外,边缘网路由器R1在URM模型中要耗用更多的控制层和数据层存储资源,如图14(c)和图14(d).IRM模型因为只有一个异构网关,边缘网可通过一条默认路由/转发项实现到边缘网外部的访问.然而,URM模型要针对每个外部目的前缀明确指定异构网关,这也是多出口网络模型必须面对的存储代价.Page12图14隧道传输存储代价分析综合上述实验及分析,证明本文提出的异构网络一体化路由模型能与现有OSPF、BGP等路由协议友好兼容,并具有良好的异构网络端到端一体化路由收敛能力,完全符合路由协议收敛原理.而且,一体化路由模型在控制层和数据层的计算复杂度都基本没有增加.它的主要代价包括边缘网路由系统控制层/数据层的存储有较明显的增加、异构网关的控制层存储略有增加.8总结现有隧道传输机制只考虑基本的单点可连通性,没能对端到端跨越异构网络的传输路径进行一体化考虑,是一种分段实施路由选择的孤立路由模型.本文针对边缘网到支撑网的多宿主连接环境,提出了一种跨异构网络的一体化路由模型———URM.URM模型通过参考度量对异构网络的路由优劣进行统一描述,并设计了参考度量与传统度量的转换方法,从而实现隧道传输网络的端到端一体化路由选择机制.URM模型实施简单,通过BGP扩展协议实现参考度量的传递,最终的一体化路由机制也是透明地通过现有路由体系完成.URM模型的实施只需对异构网关进行简单改造即可完成,影响范围较小.论文对URM/IRM两种模型的路由性能进行了分析比较.相对现有IRM模型,URM模型会使异构网关存储更多的地址映射项,边缘网路由设备存储更多的路由项/转发项,但对支撑网普通路由设备没有任何影响,作者的相关工作还针对这些问题进行了优化研究[24].然而,URM模型带来的优势却非常明显,在实现端到端一体化最优路由选择的同时,增加了隧道传输路径数量并提高了隧道传输的可靠性.实验验证了在边缘网到支撑网的多宿主连接环境中,URM相对于IRM能选择出更好的跨异构网络端到端传输路径.此外,本文基于Bit-EngineNetwire4600过渡设备设计了异构网关原型系统,并对异构网关进行了隧道传输的性能测试,验证了该设备较高的数据转发带宽.继而,基于异构网关原型系统,完成了真实设备组网实验.实验再次验证了URM模型的一体化路由机制对端到端最优路径的选择能力.并且,还验证了URM模型在网络状态变化情况下的跨异构网络一体化路由收敛能力.本文工作可给未来隧道传输网络的研究及实施提供参考.致谢本论文工作在清华大学完成,感谢清华大学网络所提供的研究支持!Page13
