Page1三维图像多相分割的变分水平集方法潘振宽1)李华1)魏伟波1)郭振波1)张春芬2)1)(青岛大学信息工程学院山东青岛266071)2)(江苏大学计算机科学与通信工程学院江苏镇江212013)摘要变分水平集方法是图像分割等领域出现的新的建模方法,借助多个水平集函数可有效地实现图像多相分割.但在区域/相的通用表达、不同区域内图像模型的表达、通用的能量泛函的设计、高维图像分割中的拓展研究等方面仍是图像处理的变分方法、水平集方法、偏微分方程方法等研究的热点问题.文中以三维图像为研究对象,系统地建立了一种新的三维图像多相分割的变分水平集方法.该方法用n-1个水平集函数划分n个区域,并基于Heaviside函数设计出区域划分的通用的特征函数;其能量泛函包括通用的区域模型、边缘检测模型和水平集函数为符号距离函数的约束项3部分;最后,针对所得到的曲面演化方程,采用半隐式差分格式进行离散,并对多种类型三维图像进行分割验证了所提出模型的通用性和有效性.关键词三维重建;多相图像分割;变分方法;水平集方法;差分方法1引言三维重建是计算机视觉的传统内容之一,也是该领域目前研究的热点问题之一.基于三维图像的三维重建/分割在医学诊断、模式识别等方面具有重要应用[1-3].水平集方法[4]对二维和高维问题具有相同的表达形式,能有效地处理变拓扑结构的情形.变分水平集方法[5]不仅具备上述优点,还能有效地集成多种模型成分,被广泛应用于图像分割、运动跟踪、三维重建等研究[6-7],并在二维图像多相分割研究方面引起了国际图像处理领域学者的关注.在图像分割研究中,Chan和Vese[8]首先以简化的Mumford-Shah模型[9]和水平集方法为基础,建立了分段常值两相图像分割的变分水平集C-V模型;Vese和Chan[10]、Vese[11]用N个水平集函数表达2N个相,将文献[8]提出的模型推广到分段常值和分段光滑的图像多相分割,该模型能自然地避免多个水平集函数的重叠和漏分问题.图像多相分割的变分水平集方法涉及多相区域的划分、图像模型的表达、能量泛函的设计及所得到的演化方程的数值计算等问题.Samson、Blanc-Feraud、Aubert[12]用n个水平集函数区分要分割图像的n个区域,在假定每个区域符合Gauss分布且分布参数已知的情况下,建立了图像多相分类的通用表达式.为了避免水平集函数间的重叠和“真空”现象,该模型中包括了相关约束条件.Lie、Lysaker和Tai[13]用N个取值为1或-1的水平集函数建立了分段常值2N相图像分割的变分水平集模型,该模型亦包含了类似文献[12]提出的约束条件.在文献[14]中,Lie等采用取离散常值的1个水平集函数,通过Lagrange多项式差值建立区分多个不同区域的基函数,建立了分段常值图像分割的变分水平集模型,该模型亦包含避免水平集函数重叠或漏分的约束条件.Chung和Vese[15]用1个连续变化的水平集函数,采用文献[10]的区域竞争策略,建立了变分形式的分层水平集模型,无需增加约束条件.上述研究的局限之一是目前的多相图像分割的变分水平集模型主要针对分段常值图像.实际上,用不同方式获取的图像符合不同的概率分布,诸如MRI图像符合Gauss分布,Ultrasound图像符合Rayleigh分布,PET图像符合Poisson分布,SAR图像符合Gamma分布[16-17].而分段常值图像仅是当标准差为1/槡2的Gauss分布图像.上述研究的局限之二是,模型的本身没有对水平集函数特性的约束,因此,在水平集函数演化过程中,必须不断对水平集函数进行检测,并通过重新初始化使水平集函数符合符号距离函数的属性.局限之三是,区域与水平集函数没有直接的对应关系,不便于对象检测.近年来,国内众多学者对图像分割的水平集方法的研究和应用给予了关注,如朱付平等[20]、陈强等[21]对水平集速度函数的设计、李俊等[22]对该类模型快速算法的设计、肖亮等[23]对分段光滑图像多相分割的研究、周则明等[24]基于三维图像的三维重构的研究等.文献[23]的区域划分使用了文献[10]的方法,文献[24]的研究未考虑多相分割.值得一提的是陈波等[25]对国际近年在几何水平集研究的主要模型和算法给予了较全面的综述,但未涉及近年图像多相分割的成果.本文拟面向三维图像多相分割提出一种新的变分水平集模型.该方法用n-1个水平集函数划分n个区域,并基于Heaviside函数设计出区域划分的通用的特征函数,每个水平集函数对应一个前景区域或对象,第n个区域为背景;所设计的能量泛函包括通用的区域模型、边缘检测模型和水平集函数为符号距离函数的约束项3部分,其中第1部分为包含参数的一般图像区域模型,第2部分为经典的测地轮廓线模型,第3部分为水平集函数为符号距离函数的约束项,以避免水平集函数的重新初始化.最后,针对所得到的曲面演化方程,采用半隐式差分格式进行离散,并对多种类型三维图像进行分割/重建对所提出的模型的通用性和有效性进行验证.本文第2节为基于多水平集函数的区域划分策略与特征函数的确定;第3节为参数化区域模型的通用表达;第4节为多相分割的变分水平集方法;第5节为曲面演化方程的半隐式差分迭代方法;第6节为数值算例;最后为结束语.2多水平集函数的区域划分2.1图像分割的水平集方法基础设u(X):Ω→为一三维数字图像的图像强度,其中,犡=(x,y,z)T,Ω为图像区域,Ω为图像边界.如图1所示,通过一个水平集函数的零水平集Γ(t)曲面将图像划分为互不重叠不同类的两个区域/相R1,R2,Ω=R1∪R2∪Γ(t),R1∩R2=0,Γ(t)=R1.Page3水平集函数定义为[6]烄烅烆通常可将上述函数定义为如下符号距离函数Φ(t,X)=d(Γ(t),X),X在Γ(t)里面烄Φ(t,X)=0,烅Φ(t,X)=-d(Γ(t),X),X在Γ(t)烆其中d(Γ(t),X)为X与Γ(t)间的Euclidean距离.从而Φ(t,X)满足如下Eikonal方程[13]式(3)的唯一粘性解通常为下列初值问题的稳态解[13]界面Γ(t)按照如下非线性PDE运动[13]速度场v依赖于系统的几何位置及物理属性等.相应的标准水平集方程为[13]其中vN为v沿界面的法向分量.2.2区域划分的Heaviside函数与Dirac函数为了实现区域划分的函数表达,在经典的变分水平集方法中,通常引进如下Heaviside函数和Dirac函数[8]为改善数值性态,通常使用如下形式的规整化的Heaviside函数和Dirac函数[8]H1ε(α)=δ1ε(α)=dH1ε(α)其中ε为小正常数.H1ε,H2ε,δ1ε,δ2ε如图2所示.以下使用该类函数,但为书写简洁,仍使用原符号表达.积由下式计算[5]根据H,δ的性质,零水平集的面积及包围的体Area(Φ=0)=∫Ω|Η|dX=∫Ωδ(Φ)|Φ|dX(10)式(10)对应的加权面积2.3多水平集函数的区域划分一个水平集函数可以将区域唯一地划分为两个部分,一部分对应H(Φ)=1,另一部分对应H(Φ)=0.但对于由多个水平集函数划分多个区域的情况则较复杂,当水平集函数冗余时,需要增加必要的约束条件,以避免造成重叠和漏分.对n个区域的划分,如图3所示(以4个区域为例),可定义n-1Page4个水平集函数,每个水平集函数表达一个区域.为避免造成重叠和漏分,对每个区域,定义如下特征函数:R1:χ1=[1-H(Φ0)]H(Φ1),H(Φ0)≡0,R2:χ2=[1-H(Φ0)][1-H(Φ1)]H(Φ2),Ri:χi=∏i-1Rn:χn=∏n-1从而有Φl=∏i-1χi=Ψi,l(Φ)δ(Φl)Ψi,l(Φ)=∏i-1j=0要确保每个像素点仅落在唯一一个区域,上述特征函数必须满足∑n案满足该条件∑ni=1χi=[1-H(Φ0)]H(Φ1)+[1-H(Φ0)][1-H(Φ1)]H(Φ2)+…+∏n-2[1-H(Φj)]H(Φn-1)+∏n-1[1-H(Φj)]H(Φn)j=0=[1-H(Φ0)]H(Φ1)+[1-H(Φ0)][1-H(Φ1)]H(Φ2)+…+∏n-2[1-H(Φj)]H(Φn-1)+∏n-2[1-H(Φj)][1-H(Φn-1)]j=0=[1-H(Φ0)]H(Φ1)+j=0[1-H(Φ0)][1-H(Φ1)]H(Φ2)+…+∏n-2[1-H(Φj)]j=0=…=[1-H(Φ0)]H(Φ1)+[1-H(Φ0)][1-H(Φ1)]=[1-H(Φ0)]=13图像区域模型的参数化通用表达Paragios[19]提出的图像分割的测地主动区域模型(GeodesicActiveRegions)包括经典的测地轮廓线模型(GeodesicActiveContours)和基于概率分布的区域模型两部分,后者基于最大后验概率p(Γ|u)估计图像区域模型参数.基于Bayes公式,该后验概率可表达为最大后验概率估计的含义是计算给定图像的情况下估计其最大分割Γ.对于给定的图像u,p(u)是常值,从而可将对应极值问题转化为并可进一步将其转化为如下极小值问题其右端第1部分表示在给定分割情况下的图像像素点的概率分布,第2项可看作分割线或面的拓扑面积.如p(Γ)=exp(-γArea(Γ))或p(Γ)=exp(-γWArea(Γ)).假设被分割的图像区域不相关,则p(u|Γ)可表达为其中,pi(u|Γi)为Ωi中像素点的概率分布.当假设各个区域中的像素相互独立时,该分布可写为从而式(21)可写为这样,上述最大后验概率估计问题即可转化为如下基于下列泛函的最小参数估计问题珟E(Γ|u)=∑n其中,对于参数化的图像区域模型,Qi=Qi(u,θi),其中,θiPage5为第i个区域模型的参数.4图像多相分割的变分水平集方法4.1曲面演化方程为表达方便,以下将用Φ={Φ1,Φ2,…,Φn-1}表示用于划分n个区域的n-1个水平集函数的集合,χ={χ1,χ2,…,χn}表示n个区域的特征函数的集合,θ={θ1,θ2,…,θn}表示要估计n个区域的参数集合,θi={θi1,θi2,…,θik}表示第i个区域的参数子集,Qi=Qi(u(X),θi)表示第i个区域的图像参数估计模型.图像多相分割变分水平集方法首先要定义用水平集函数表达的能量泛函,然后通过变分方法得到水平集函数的演化方程,当水平集函数停止演化时,其零水平集对应点的集合即为所要求的轮廓线或面.能量泛函的定义是该类方法建模的基础,能量泛函中可包括基于边缘、区域、先验形状、颜色、运动场等方面的相关能量项,故便于建立基于多种信息的集成化模型.本文研究的目标是建立基于边缘和区域信息的三维图像多项分割的变分水平集模型,故定义如下形式的能量泛函E(u,θ,Φ)=ER(u,θ,Φ)+EA(Φ)+EE(u,Φ)+EC(Φ)其中,为基于区域模型能量,Qi的定义见式(25),其中包含分割过程中要估计的各个区域的参数,当图像噪声符合Gauss分布时,相应参数为均值和标准差.为体积最小约束项,该项为水平集函数演化方程提供常值演化速度.为基于边缘的模型,g(u)为通常的边缘检测函数.为水平集函数保持为符号距离函数的约束项.该项源于(3),由于水平集函数作为符号距离函数仅在水平集函数初始化时有定义,而在水平集函数的演化方程中未体现该约束,从而使得用符号距离函数定义的水平集函数的属性(3)不再满足.通常的做法是在水平集函数演化过程中求解(4)以使由通常的变分方法和梯度降方法,可得到能量水平集函数重新满足(3),以确保我们感兴趣的零水平集附近水平集函数的变化不至过于平坦或陡峭,提高界面确定的精度.为避免水平集函数的反复校正,将其符号距离函数的属性(3)设计成能量泛函的一部分(30),以使得能量泛函取得极小值时属性(3)自动满足.泛函(26)取极小值的水平集函数的演化方程t=δ(Φl)∑n-1Φl烄∑nμΔΦl-·Φl烅熿∑n-1γig燀i=1Φl(0,X)=Φl0(X),在Ω烆为简化计算,参照文献[8,10]的分析,本文将体积最小约束及基于边缘的部分简化为EE(u,Φ)=∑n-1得到相应的曲面演化方程为Φlt=δ(Φl)γl·gΦl烄∑n烅在(0,)×Ω内[γlgδ(Φl)|Φl|+μ1-1Φl(0,X)=Φl0(X),在Ω烆i=14.2基于区域模型的参数估计当图像的区域模型为参数模型时,水平集函数的演化和区域模型的参数估计构成一个交替迭代的过程.当图像噪声符合Gauss分布时,Qi=ln2槡π+lnσi+(u-ui)2Page6当图像噪声符合Rayleigh分布时,当图像噪声符合Gamma分布时,5演化方程的半隐式差分迭代格式为简化表达,本部分将式(34)写为如下简洁的表达形式以下参照Chan和Vese[8]构造式(44)的半隐式差分格式.设h为空间步长,Δt为时间步长,则图像空间中(i,j,k)点的离散坐标为(xi,yj,zk)=(ih,jh,kh),0i,j,kM,在迭代过程中,水平集函数在(xi,yj,zk)点第n步的近似值为Φnxi,yj,zk).其中,t=nΔt.初始时,Φ0=Φ0.以下为水平集函数沿不同方向的向后差分、向前差分及中心差分:-Φi,j,k=Φi,j,k-Φi-1,j,kh,ΔxΔx+Φi,j,k=Φi,j+1,k-Φi,j,kh,ΔyΔy-Φi,j,k=Φi,j,k-Φi,j,k-1h,ΔzΔz0Φi,j=Φi+1,j,k-Φi-1,j,k2h,ΔyΔxγΔy-γΔz-γΔx-0Φi,j,k=Φi,j,k+1-Φi,j,k-12hΔz则式(44)可离散为i,j,k-ΦnΦn+1Δt=δ(Φn槡[槡槡i,j,]k+μ[Δx[槡槡(Δy槡(ΔzQnμΔx-Δy-Δz-槡令c1=c2=槡(Δx+Φnc3=槡c4=槡(Δy+Φnc5=槡c6=槡(Δzc=c1+c2+c3+c4+c5+c6,珋c=c1gnc5gn+Φni,j,k+c2gni,j,k+c6gnD=ΔtD1=ΔtD2=ΔtPage7D3=ΔtD4=ΔtD5=ΔtD6=Δt按照与文献[8]类似的方法得到式(44)如下的半隐式迭代格式i,j,k=([ΦnΦn+16数值实验本节对所提出的模型及离散迭代格式进行数值验证.三维图像类型包括人体切片数据、真实三维CT数据和人造三维图像数据,分割区域包括两相、三相、四相情形,图像模型包括分段常值、Gauss分布、Rayleigh分布.在下述计算中,时间步长Δt=0.2,体积约束项系数βl=0,符号距离函数约束项系数μ=0.003,采用式(9a)与式(9b)规整化的H2ε与图5单水平集的三维分割演化与三维模型的重建过程6.2三维图像的三相分割与重建该例为用本文的通用模型实现三维三相分割.δ2ε函数,取小常量ε=1.6.1三维图像两相分割与重建三维图像两相分割的对象取自美国国家图书馆虚拟人体的腿部70幅图像,每幅图像规格为121×141,从而要分割的对象为121×141×70的三维图像.如图4为要分割的图像的第1层、36层和70层图像.由于实验中我们将原彩色图像变为灰度图像,从图像本身特征仅将白色的脂肪、骨骼与黑色的肌肉组织分割开来.该例实验采用Gauss分布的区域参数估计模型(35),仅用一个水平集分割其中的骨骼、脂肪与肌肉组织.水平集函数初始化为Φ(x,y,z)=r-(x-x0)2+(y-y0)2+(z-z0)在计算中,本例取空间步长h=1,相关项系数αi=105,γi=0.01×2552,g=1.如图5所示是其分割与重建的过程.实验数据来源同上例,但仅保留了下颌骨和牙齿部分,图像规格为大小为191×151,共取105层,从而Page8构成191×151×105的三维图像,图6为其中第30、60、86幅图像.用两个水平集函数分割下颌骨和牙齿及周围组织,两个水平集函数的初始化方法同上例,但参数估计采用分段常值区域模型.本例使用空间步长h=1,各项系数分别为αi=10,γi=0.01×2552,而g=1.图7为其三维分割与重建的过程.图7下颌骨与牙齿三维图像三相分割后建立三维面模型通过两个水平集分割后的结果是下颌骨与牙齿的三维立体图.从图7(h)可以看到几颗牙齿有缺损,是因为原始的图像序列中对应的牙齿部位有几帧有缺损,说明该方法建立的三维模型是严格按照二维序列断层图像信息进行三维分割与重建的,真实的反映了所采集的序列断层图像信息.以下对真实的人体下颌三维CT的医学图像分割与重建,图像大小为128×128×99,图8是其中典型的3幅.使用分段常值模型对其进行三维分割与重建,取空间步长h=1,相关项系数αi=10,γi=0.01×2552,而g=1.如图9所示是其三维分割与重建的过程与分割后下颌骨和牙齿等骨质部分与肌肉组织的三维图.Page9图9真实的医学图像序列的三维分割与三维重建的过程7总结与展望6.3三维图像的四相分割与重建本实例分割的对象为90×90×100的4相人造三维图像,主要目的是对Rayleigh模型进行测试.图10是该三维图像中的第1、100、4、96层.使用3个水平集函数如图11(a)~(d).取空间步长h=1,相关系数αi=105,γi=0.01×2552,g=1.图11(e)~(l)所示是其三维分割与重建过程,最终分割出三维图像中用不同颜色表示的3个对象.分割后的结果是根据各个灰度区域部分建立的三维立体图,在原始图像序列中设置了几张断层图片,分割后的结果真实地反映了断层信息.本文面向三维图像多相分割提出了一种新的变分水平集模型,该模型可直接应用于二维图像多相分割.该方法用n-1个水平集函数划分n个区域,并基于Heaviside函数设计出区域划分的通用的特征函数,每个水平集函数对应一个前景区域或对象,第n个区域为背景,本文还简要严格证明了所提出的区域划分能避免重叠和漏分.本文所设计的能量泛函包括通用的区域模型、边缘检测模型、水平集函数为符号距离函数的约束项3部分,其中第1部分为包含参数的一般图像区域模型,第2部分为经典的测地轮廓面模型,第3部分为水平集函数为符号距离函数的约束项,以避免水平集函数的重新初始化.其中的区域模型采用基于参数化概率分布的通用形式,可实例化为不同概率分布的图像.最后,针对所得到的曲面演化方程,采用半隐式差分格式进行离散,并对多种类型三维图像进行分割/重建对所Page10图11四相图像序列的三维分割与三维模型重建过程提出的模型的通用性和有效性进行验证.本文后续工作拟将上述以分段常值假设拓展到分段光滑图像的分割,并发挥变分水平集方法的优势,进一步研究包括纹理信息、先验形状信息、运动信息在多相分割的变分水平集模型.
