Page1互联网自治域商业关系推测算法范琪琳尹浩林闯董加卿宋伟(清华大学计算机科学与技术系北京100084)(清华大学信息科学与技术国家实验室(筹)北京100084)摘要随着互联网进入商业化发展阶段,不同管理机构的自治域通过商业合作关系来共同路由互联网中的流量.从工程上来看,获取全面准确的自治域商业关系可以指导有效的流量工程管理和资源部署从而均衡网络负载,提高服务可靠性,减少网络运营成本;从理论上来看,获取全面准确的自治域关系可以分析互联网的演进模型,指导设计新的路由协议和互联网架构.虽然互联网路由注册中心会记录自治域之间的商业关系,但是由于商业敏感以及注册中心缺乏维护更新,公开的自治域商业关系并不全面准确,因而通过推测算法获得更加全面准确的自治域商业关系成为了学术界与产业界关注的热点.文中系统地综述了现有的互联网自治域商业关系推测算法及其存在的问题,并对该领域有待进一步研究的问题和可能的解决方案给出了一些建议.关键词自治域商业关系;推测算法;有效路径;路由策略;互联网1引言自从20世纪90年代互联网商业化以来,互联网规模飞速发展,进入到了一个新时期.不同管理机构(网络服务提供商、公司、大学、内容提供商等)的自治域系统(AutonomousSystem,AS)通过商业合作关系来共同管理互联网中的流量.边际网关协议(BorderGatewayProtocol,BGP)作为自治域之间的路由协议,允许每个AS独立地配置路由策略来选择路由和宣告路由信息.AS作为互联网的重要组成部分,研究人员认为不论未来网络的体系架构如何变化,受政治经济因素影响形成的AS不会消失[1],因此研究AS之间的商业关系非常必要.早期的Internet拓扑研究都是将Internet抽象为以AS为点,域间连接关系为边的无向图,进而研究网络拓扑特性,包括幂律分布特性[2]、鲁棒且脆弱性[3]、“小世界”特性[4]等.但是AS之间的连接关系并不能表示AS之间的实际路由,比如自治域A拥有两个提供者(Provider)B和C,虽然A和B相互可达,A和C也相互可达,但是A的路由策略却不允许B经由A到达C.自治域商业关系的引入会对互联网的路由策略、服务质量保证(QoS)和流量工程等产生全局的影响,因而近些年,各领域的研究者都开始关注AS之间的商业关系[5-17].从工业界来看,获取全面准确的自治域关系可以指导有效的流量工程管理和资源部署,从而均衡网络负载,提高服务可靠性,减少网络运营成本.比如内容分发网络服务提供商在拥有了自治域关系的全局视图之后可以更好地选择边缘服务器的位置以及流量计费.从学术界来看,获取全面准确的自治域关系可以分析Internet的演进模型[18],指导设计新的路由协议和互联网架构[19].虽然互联网路由注册中心(InternetRoutingRegistry,IRR)是一个全球维护注册自治域关系的机构,但是一方面许多自治域由于商业敏感的因素并不愿意公布其全部的商业关系;另一方面,注册信息缺乏更新和维护.所以,IRR中公共的自治域关系并不全面和准确.由此,自治域关系的推测算法应运而生.目前自治域关系的推测算法已经取得了很多有意义的研究成果,但是目前还缺乏相关文献系统地归纳和总结其发展现状和趋势.本文在现有文献的基础上,从自治域商业关系分类及链路选择入手,归纳了获取源数据集和验证数据集的关键技术,对自治域商业关系推测算法进行了总结和分析,阐述了各种推测算法的性能及有待解决的问题,并指出该领域需要进一步探索的方向及问题.2自治域商业关系和链路选择2.1自治域商业关系分类互联网主要由3类自治域构成:过渡(Transit)自治域、末端(Stub)自治域和多宿主(Multi-homed)自治域.过渡自治域为相邻的域之间提供穿越服务;末端自治域只与一个自治域相连,需要依赖过渡自治域访问其他自治域;多宿主自治域与多个自治域相连,可以实现备份路由.自治域之间的商业关系可以主要划分为3类[5]:P2C(提供者-客户,Provider-to-Customer)、P2P(对等体-对等体,Peering-to-Peering)和S2S(同胞-同胞,Sibling-to-Sibling).(1)P2C关系.提供者(Provider)向客户(Cus-tomer)提供互联网穿越服务,即允许客户通过它到达其他网络并根据流量向Customer收费.(2)P2P关系.两个自治域及其它们的客户之间相互可达,并且Peer连接所产生的流量也由两个AS共同承担[20].(3)S2S关系.两个自治域同属于一个管理机构,这种关系通常产生于兼并与收购.它们及其它们的提供者、客户、对等体之间相互可达并且不计费.图1展示了互联网自治域商业关系的层次结构,末端自治域AS6通过P2C关系连接到穿越自治域AS3来获得穿越服务.自治域AS3和自治域AS4同属于AS1,它们是S2S关系.自治域AS1和自治域AS2之间可以建立对等关系以提供相互穿越服务.AS8是多宿主自治域,有两个提供者AS4和AS5.2.2路由信息选择导出原则不同的自治域商业关系决定了每个自治域路由信息通过BGP会话向其邻居自治域的选择导出原Page3则(SelectiveExportRule)[21](如表1所示).(1)向提供者(或对等体)的导出原则.自治域会将自己及其客户的路由信息导出给提供者(或对等体),但不会将自己从某个提供者或者对等体学习到的路由信息导出给其他提供者(或对等体).自己学习到的所有路由导出给客户(或同胞).(2)向客户(或同胞)的导出原则.自治域会将ProviderPeerSibling√√√Customer√√√向提供者和对等体导出规则是一样的,向客户和同胞导出规则也是一样的,但是提供者与对等体(客户与同胞)的唯一区别在于非对称性.商业利益驱动了自治域之间商业关系的发展.如果一个客户自治域为一个提供者路由数据至另一个提供者,按流量计算它需要支付双倍的费用,因此客户自治域不愿意将自己从某个提供者学习到的路由导出给其他提供者.而提供者自治域为客户路由可以收取穿越服务的费用,因此提供者自治域愿意将自己学习到的所有路由提供给客户.2.3AS路径规则选择导出规则使得路由表中的AS路径存在一定的模式规则,Gao[5]将其归纳为无低谷(Valley-Free)原则:Valley-Free原则.一条AS路径(u1,u2,…,un)是Valley-Free的当且仅当以下两个条件同时满足:(1)如果(ui,ui+1)是P2C关系,那么对于i<j<n,(uj,uj+1)只能是P2C或者S2S关系.(2)如果(ui,ui+1)是P2P关系,那么对于i<j<n,(uj,uj+1)只能是P2C或者S2S关系.符合Valley-Free原则的路径也被称之为有效路径,相反的,不符合Valley-Free原则的路径则被称之为无效路径.有效路径的形式化描述如下:有效路径.令→表示C2P关系,←表示P2C关系,-表示P2P关系,表示S2S关系,则一条AS路径是有效的当且仅当它可以表示为如下正则表达式:{→,}{←,}∪{→,}-{←,}.如图2所示,AS6会将自己的所有路由信息宣告给提供者AS5,同时AS5也为AS4提供穿越服务,所以AS4→AS5→AS6是一条有效路径.AS4不会将从提供者AS5学习到的路由信息宣告给提供者AS3,AS3→AS4→AS5构成了路径上的低谷,所以AS1→AS2→AS3→AS4→AS5→AS6是一条无效路径.3推测算法数据集3.1源数据集自治域关系源数据集是自治域商业关系推测算法的基础,因此数据采集方法是首先需要考虑的问题.根据数据集的来源可以划分为以下3类:BGP路由表和更新、互联网交换点数据库、互联网路由注册中心数据库.(1)BGP路由表和更新.BGP路由表和更新根据获取方法的不同,可以分为以下3类:①路由表快照.获取BGP路由表最直接的方法是登录到自治域的边界路由器上,使用路由器操作系统所提供的show或者dump命令获得BGP路由表快照(snapshot),由于这种方法不仅可以获得该边界路由器的最优路由和次优路由,而且还可以获得各条路由的全部路径属性,因此可以获得最为全面的数据.但由于需要登录到自治域的不同边界路由器上,该方法也是操作最为繁琐和权限要求最高的数据采集方法.②路由器对等监听.这种方法在专门的路由信息采集设备上运行BGP协议,与要监测的自治域边界路由器建立对等关系,被监测路由器会把路由信息采集设备看成它的邻居,发送BGP数据更新报文和BGP路由表信息.由于这种方法较为灵活方便,因此是路由信息采集的主要方法.但由于BGP只会宣告最优路由,与路由表快照方法相比,这种方法只能获得对等边界路由器的最优路由信息.RouteView①和RIPE-RIS②项目都提供了路①②Page4由表快照和路由器对等监听的实时数据查询.③公开列表查询.部分ISP或者网络管理机构提供LookingGlass服务,它允许外部用户通过通用网关界面(CommonGatewayInterface,CGI)的Web形式,查询路由表信息和其它路由设置.路由服务器(RouteServer)通过与连接到互联网交换点(InterneteXchangePoints或者NetworkAccessPoints)上的ISP路由器交换路由信息,保存每个ISP的单独路由策略要求.目前Internet上有一些公开的RouteServer①和LookingGlass②列表.(2)互联网交换点(InterneteXchangePoint,IXP)是一个物理基础架构,它允许不同的互联网服务提供商直接地互联,通过交换来减少对各自上行提供商的依赖,进而减少ISP的运营成本,降低用户的互联网访问费用.互联网交换点为了吸引更多的服务提供商互联互通,会将其基本信息(如位置、费用、互联的自治域列表等)公布.PacketClearingHouse(PCH)③,Peeringdb④和Euro-IX⑤项目收集了各IXP的基本信息并提供公开数据库查询.(3)互联网路由注册中心(InternetRoutingRegistry,IRR)⑥是为了维护互联网路由的稳定性、一致性和安全性而由各网络注册单位自发组织起来的机构.每个网络注册单位(如RIPE、ARIN)都可以发布路由策略和公告.IRR中的路由策略通过路由策略规范语言(RoutingPolicySpecificationLanguage,RPSL)来描述.IRR是获得自治域商业关系最快捷的方式,但是一方面许多自治域不愿意公布其商业关系,IRR数据库信息并不全面;另一方面分布式的IRR数据库由于缺乏更新和维护存在信息冲突以及过时问题.3.2验证数据集关于自治域商业关系推测结果的验证,目前仍没有公开的准确数据可直接用于推测结果验证.在许多相关文献中,研究者都是使用从各种非公开渠道获得的网络服务提供商内部自治域商业关系数据来验证其推测结果.例如文献[5]中使用了AT&T与其邻居AS的商业关系数据来验证其推测结果,该数据是直接从AT&T内部获得的,并不公开;文献[9]中使用的验证数据则是通过调研的形式从各个网络提供商处获得的.Xia等人[14]提出了一种验证AS商业关系推测结果的方法:从IRR数据库中的BGP团体(Community)属性[22]、AS-SET对象以及显式路由策略描述得到部分准确的自治域商业关系.但是因为BGP团体、路由策略描述等并没有标准化的规则限制,所以需要大量的人工甄别、筛选才能获取到部分准确的自治域商业关系数据,缺乏可行性.CAIDA⑦公开了对2012年6月1日自治域之间商业关系的推测结果⑧.CAIDA使用收集到的5815组准确的自治域商业关系数据验证了该推测结果,证明其P2C准确率达到99.1%,P2P准确率也达94.7%.这是目前能够找到的且已公开的自治域商业关系数据中最为准确的,然而由于该结果并非严格准确的,因此只能用于不严格的简单验证.4自治域商业关系推测算法自治域商业关系推测算法的流程如图3所示.推测算法首先确定使用的数据集:BGP路由表和路由更新(如图4所示),互联网路由注册中心数据库(如图5所示),互联网交换点数据库.通过对IXP的反向DNS解析,对BGP路由表和路由更新中AS路径和Community属性的提取以及对IRR中Community属性的释义获得AS连接对以及部分关系,从而构造图G(V,E),其中,V节点表示自治域AS,E表示AS之间存在的关系.最后依据不同的推测策略,为边赋值商业关系.按照推测算法所采用的策略,可以将推测算法分为以下3类:排序法、组合最优法以及局部确定性法.本节将详细讨论这3类推测算法.id=tools:ipv4_route_servers①②③④⑤⑥⑦⑧Page54.1网络特征排序法网络特征排序法的主要思想是提取所有的自治域的网络特征,进行从大到小的排名,排名高的自治域为排名低的自治域提供穿越服务,而排名相当的自治域之间建立对等连接.Gao[5]使用OregonRouteView的BGP路由表和更新数据,第一次提出了自治域商业关系的推测算法.Gao算法基于这样的一个直观现象:一个自治域的重要程度与其在互联网拓扑图中的度数成正比,因而提供者的度数比客户的度数大.Gao算法首先对路由表中每条AS路径进行遍历,统计每个AS的度数.将一条AS路径中度数最大的AS作为提供者,结合Valley-Free策略统计AS对之间的穿越关系,从而为每条AS路径上的每对AS赋值P2C,C2P或S2S关系.但是由于存在少量配置错误的BGP路由器,它们会宣布错误路由信息,Gao算法采用统计学方法设定阈值L过滤少量错误的路由信息.对于P2P关系的确立,Gao算法首先根据P2P关系在AS路径中只出现一次且紧跟P2C或者S2S关系的原则,排除不是P2P关系的AS对.其次,由于AS倾向于选择度数与自己相当的AS建立对等关系,因而在剩余的AS对中,如果两个AS度数之比符合阈值R,则将AS对关系调整为P2P关系.但是Gao算法存在如下缺陷.首先AS度的大小关系不能完全反映AS之间的穿越关系.比如有的AS拥有一些很重要的提供者或者对等体,它的客户必须使用私有AS号或者内部路由协议,就不会出现在BGP路由表中,因此该AS虽然重要,但由于它度数较小,较易引起推测误差.其次,由于P2P关系不能被宣布给邻居的邻居,大多数P2P关系通常只能在采集点被发现,所以对于大多数AS,拥有很多P2P关系的AS和拥有很少P2P关系的AS不能根据度来衡量其重要性.最后,参数的调节也会影响最终的结果,比如阈值R的大小会影响P2P关系的比例.通过对2003年3月至12月RouteView项目中路由表的分析,当R设定为60时,P2P关系的比例为7.2%,而当R设定为无穷大时,P2P关系的比例上升为7.98%.当然随着BGP路由表的增多,参数的影响程度会逐渐变小.Subramanian等人[6]的思想如下.从不同的监测点观察AS的关系会有所不同,因而可以通过收集多个位置的部分拓扑信息来构建Internet的全面拓扑并推测AS之间关系.从一个位置观测到的所有路径可以构成一张有向图.根据Valley-Free原则,有向图的叶子节点很有可能是其父亲节点的Customer,因而依次删去有向图中的叶子节点并赋予rank值,越早删去的叶子节点rank值越低,这一过程称之为逆向剪枝.对每一个位置的有向图进行逆向剪枝后,可以将每一个AS映射到一个N维向量犮(i)=(ri1,…,riN),rij表示从位置j观察到ASi的rank值.为了确定AS之间的关系(比如ASi和ASj),令l(i,j)表示rik>rjk的数量,e(i,j)表示rik=rjk的数量.Subramanian采用如下策略:(1)等价(Equivalence).如果ASi和ASj满足条件e(i,j)>N/2,则认为它们是等价的.如果它们之间有边连接,则i和j是P2P关系;(2)支配(Dominance).如果ASi和ASj满足条件l(i,j)>l(j,i)=0,则认为ASi支配ASj,即i和j是P2C关系.对于不满足等价或者支配策略的边,则使用以下的概率策略:(1)概率等价(ProbabilisticEquivalence).如果ASi和ASj满足条件1/δEl(i,j)/l(j,i)δE,则认为i和j是P2P关系;(2)概率支配(ProbabilisticDominance).如果ASi和ASj满足条件l(i,j)/l(j,i)>δD,则认为i和j是P2C关系.Subramanian算法相比于Gao算法可以发现更多的开放对等策略(OpenPeeringPolicy).开放对等策略允许网络内容服务提供商(InternetContentProvider)等与较大网络运营商建立对等关系从而达到节约穿越成本的双赢局面.由于小型AS更愿意与大型AS建立对等关系,在Gao算法中这样的对等关系往往会被判定为P2C关系.但是Subramanian算法也存在局限性:首先监测点位置的选择影响着AS的rank值从而影响着推测的准确性;其次,有些Page6AS对在任何一个监测点都没有边相连,但是算法却为它们设立了P2C或P2P关系,这样的关系可能在实际中并不存在.最后,参数选择也缺乏理论支撑,过分依赖经验值.网络特征排序法基于互联网本身的特征来推测自治域商业关系,该算法往往实现比较简单,执行的时间复杂度也较低.由于影响自治域商业关系的因素有很多,如何提取合适的网络特征,如何设置经验参数等是该算法所面临的挑战.4.2组合最优法组合最优法的思想是将所有AS关系的赋值转化为数学上的组合最优问题,采用数学上的近似或者随机算法来快速求解.Subramanian等人[6]将AS关系推测抽象为关系类型(TypeofRelation,ToR)组合优化问题.BGP路由表中的路径集合P构成了图G(V,E),图中每条边赋值为P2C或者P2P关系,使得P中的无效路径最小化.Subramanian推断该问题是NP难的,但是没有给出严格证明.Erlebach等人[7]证明了ToR是NP难的,并将ToR问题简化为路径长度k受限(k4)的MAX2SAT问题.Erlebach等人首先对所有路径预处理,迭代式地删除入度和出度为0的边.在有效地缩短了平均路径后,采用2SAT问题的算法检验是否存在使得所有路径都有效的解.如果无解,则采用Lewin等人[24]提出的MAX2SAT近似算法求解ToR问题,在平均路径长度不大于2的情况下,该算法可以在多项式时间内得到近似因子为0.940的近似解.Battista等人[8]也单独证明了ToR问题是NP难的,并且提出在不存在异常AS关系的情况下,ToR问题可以转化为2SAT问题从而在线性时间内可解.构造2SAT图的过程如下:对于每条边(vi,vj)引入布尔变量xi,j,如果边的方向是vi→vj,则xi,j为真,如果边的方向是vj→vi,则xi,j为假.对于一条路径上的连续3个点,可以如表2所示构造子句.○vi→-1○v←i○vi+1xi-1,i∨xi+1,i○vi←-1○v→i○vi+1x-i,i-1∨x-i,i+1○vi→-1○v→i○vi+1xi-1,i∨x-i,i+1○vi←-1○v←i○vi+1x-i,i-1∨xi+1,iBattisa给出了一种推测P2C关系的启发式算法.定义最小覆盖边(covering)是经过无向边(vi,vj)的路径总数.Battisa算法为BGP路由表中的路径集合P构建2SAT图G2SAT,利用强连通分量的方法[25]检验图G(V,E)是否存在解使得所有子句都成立.如果无解,则说明存在异常AS关系,选择最小覆盖边(vi,vj)并删除其包含的所有路径,重复上述操作直至图G(V,E)有解.同时为了最大化有效路径数,Battisa算法逐条检验被删除的路径,在不引入异常AS关系的情况下重新将路径加入集合.同时为了引入P2P关系,Battisa提出可以将寻找k条P2P边转化为寻找k-独立集的问题求解.但是Erlebach等人[7]仅局限于P2C关系,Battista等人[8]的算法也未考虑S2S关系,而忽略P2P关系和S2S关系会降低推测算法的准确性.如图6所示,AS1-AS2-AS4是一条有效路径,实际上AS1和AS2是S2S关系,AS4和AS2是P2C关系,但是如果忽略了S2S关系将AS1和AS2确定为P2C关系,那么AS4和AS2只能是C2P关系.再如图7所示,AS3-AS1-AS2-AS4是一条有效路径,实际上AS1和AS2是P2P关系,但是如果忽略了P2P关系将AS1和AS2确定为P2C关系,AS3和AS1可能会被误推测为P2C关系.其次,最大化有效路径的推测算法由于过分依赖于图特性,会扭曲真实的AS商业关系,虽然大多数AS符合Valley-Free原则,但是也不排除有的AS并没有遵守该原则的情况.同时,针对ToR问题的算法在面对多解时并不能决定最符合实际情况的方案.因此基于以上存在的问题,Dimitropoulos等人[9]提出了一种更符合实际的推测算法.因为S2S关系对P2C和P2P关系的判定有决定性作用,该算Page7法首先使用互联网路由注册中心数据库[23]查询具有S2S关系的AS对.对于P2C关系,该算法引入边的奖励(bonus),用f(d+系边是由度数小的AS指向度数大的AS,则给予奖励(度数相差越大,奖励越大);否则奖励为0.f(d+i,d-f(d+Dimitropoulos算法将ToR问题和奖励机制相结合,通过求解多目标最优化问题来推测更准确的P2C关系.目标O1:最大化有效路径;目标O2:最大化奖励.Dimitropoulos算法使用表2方法为目标O1构造子句,使用表3方法为目标O2构造子句,通过调节子句权值,此最优化问题可以转换为MAX2SAT求解.对于P2P关系,Dimitropoulos算法将路径上最大度数AS的左右邻居都作为备选并计算边的权值g(d+i,d-的表达式如下:其中,c=1/maxi∈Efd+通过给定权值的阈值可以删除不实际的P2P关系,最后通过求解最大权重独立集问题(MaximumWeightIndependenceSet,MWIS)来确定可靠的P2P关系,该NP难的MWIS问题可以在多项式时间复杂度内近似求解①.该算法的缺点是复杂度太高.对比Battisa等人[8]和Erlebach等人[7]的工作,Mao等人[10]提出了基于随机行走的RouteScope算法.RouteScope算法不仅要求观察到的路径尽量是有效的,而且要求没有使用的路径尽量是无效的.该算法形式化自治域关系推测问题,对于边ei=〈x,y〉,引入变量relation(ei),定义如下:relation(ei)=设er是ei的反向边,有效路径上的每条连接和连接对(ei,ej)需要满足以下有效约束:如果有一条比实际路径更短的路径,那么该路径无效,即根据上述最优化目标和约束,RouteScope算法首先初始化每条连接为P2C关系,然后采用Selman提出的随机行走算法[26]进行迭代操作.每次迭代可以随机地选择修改一条不满足有效约束(4)、(5)的连接关系,或者在所有不满足有效约束的连接中,选择修改使得无效约束(6)减少最多的连接关系.同时为了减少推测的规模,RouteScope算法进行了删除叶子节点(出度为0的AS)的预处理操作.但是考虑到路由策略的偏好设置等,路由策略并不一定是按照最短路径选择.而且总有一些路由路径由于监测点的限制无法观察到,但并不表示这些路径无效.因而RouteScope算法存在假设上的缺陷.自治域商业关系除了Valley-Free原则,Kosub等人[11]又引入了无环(Acyclicity)属性.无环属性是指在真实自治域商业关系中,不存在一些不合理的环路情况.比如图8所示,虽然AS1→AS2→AS3→AS4→AS5和AS1→AS2→AS4→AS5是两条有效路径,但是AS2→AS3→AS4却组成了环路,AS3是AS2的提供者,AS4是AS3的提供者,而AS2又是AS4的提供者,这与商业策略不符.将无环属性与ToR问题相结合,Kosub等人提出了无环关系类型(Acyclicall-pathsTypeofRela-tion,AToR)问题:给定无向图G,路径集合P,类型集合K和属于类型集合K的先验关系R,能否使用类型集合U中的关系类型补全图G的关系使之既满足Valley-Free原则又满足无环且K,U{→,-,}.①QUickALmostEXactmaximumweightclique/independentPage8AToR(K,U)问题的时间复杂度如表4所示,其中N表示输入规模,N=V(G)+E(G)+P+R.Kosub等人证明了AToR(,{→})问题在线性时间复杂度内可解并给出了对应算法.该推测算法首先标记每个节点v作为中间节点所经过路径p的总数count(v),循环删除count(v)=0的节点即叶子节点并为与之相邻的节点调整count(v)值,标记C2P关系.如果所有的节点都能够删除则找到了一个可行解.但是Kosub等人也证明了如果加入S2S关系的推测,会使得大多数问题变成NP难的.KO(N)O(N)O(N)O(N)O(N)O(N)O(N)→O(N)O(N)O(N)O(N)NP难O(N)NP难-O(N)O(N)O(N)O(N)NP难NP难NP难O(N)O(N)O(N)O(N)O(N)O(N)O(N)→,-O(N)O(N)O(N)O(N)NP难NP难NP难→,O(N)O(N)O(N)O(N)NP难O(N)NP难-,O(N)O(N)O(N)O(N)NP难NP难NP难→,-,O(N)O(N)O(N)O(N)NP难NP难NP难Hummel等人[12]在AToR问题上进行扩展,提出了更一般化的最大无环关系类型(MaximumAcyclicToR,MAToR)问题:给定无向图G,路径集合P,对图G中的一些边指定方向,使得最大化无环且符合Valley-Free原则的AS路径数.虽然MAToR问题是NP难的,但是在路径长度受限为k的情况下,通过近似因子为2k/(k+1)!的近似算法该问题在多项式时间内可解,随着路径长度的增加,近似因子衰减地很快.Hummel等人在Kosub等人[11]基础上提出了改进算法AHeu,如果不能使得所有路径有效且无环即还有部分节点无法删除,则选择count(v)最小的节点并将与之关联的路径p都删除后继续重复Kosub算法.对于从IRR数据库已知的关系u→v,添加对应的虚拟路径(u,v,⊥),其中⊥是虚拟自治域节点且count(⊥)=.虚拟路径的引入使得算法无需改变即可隐式有效地利用先验信息(Pre-knowledge).同时借鉴Battista的思想,AHeu算法引入了重新添加已删除边的机制来最大化有效无环路径.由于一条无效路径可能包含多个低谷(如图9所示)或者一个低谷可能包含多条无效路径(如图10所示),Cohen等人[13]对MAToR问题稍加变化,将最小化无效路径转换为最小化低谷(valley)数,并且给出了一种近似因子为2/3的近似算法.该算法将每一条路径p分割成路径长度为2的子路径.然后构建如下两个集合:Ev:v作为端节点的子路径集合;Mv:v作为中间节点的子路径的集合.Cohen算法不断地选择|Mv|/|Ev|比值最小的节点,为其标记层次值π(v)并删除包含v的子路径,直至子路径集合为空,越早删除的节点层次值π(v)越低.剩余点的层次值π(v)都赋值为最高.如果π(u)<π(v),则表明u是v的客户,如果π(u)=π(v),表明u和v是P2P关系.当最小比值|Mv|/|Ev|>0即至少有一条子路径经过低谷时,为了最小化低谷数,将经过低谷的边作为备选S2S关系.最后根据拥有S2S关系的两个节点度数较相近这一选择偏好确定S2S关系.图11(a)和(b)都是符合Valley-Free原则的可行方案,但是由于互联网中绝大多数是小型自治域,一般中间节点是顶层的提供者,Cohen算法利用|Mv|/|Ev|值可以推测更为实际的自治域关系(如图11(b)所示).组合最优法算法主要是基于由互联网抽象出来的以自治域为节点、自治域之间的连接为边的无向Page9图.该算法执行时间复杂度一般很高.由于其理论难度,能够推测的关系种类一般也比较单一.如果不借助于网络特征的提取或先验确定性商业关系,推测算法的准确率比较难保证.4.3局部确定法局部确定法的思想是利用公开数据库中存在或者监测器可以监测到的部分确定性关系来推测其余的自治域关系.为了评估文献[5-6]两种AS关系推测算法的准确性,Xia等人[14]提取IRR数据库中的BGP团体(Community)属性[22],AS-SET对象以及显式路由策略描述,得到部分准确的自治域商业关系,对比发现算法[5-6]在P2P关系推测上准确率很低,小型自治域上表现得更明显.GAO进而提出了PTE(PartialnessToEntireness)算法.该算法从已知的AS关系出发,先过滤不符合Valley-Free原则的无效路径,再依据以下规则推测其余的AS关系:推测规则.在一条AS路径上,P2C关系之后是P2C关系;C2P关系之前是C2P关系;P2P关系之前是C2P关系,之后是P2C关系.更新规则.如果(u,v)和(v,u)都被标记为P2C关系,则它们都被更新为S2S关系.最后使用Gao算法[5]推测剩余自治域商业关系.受到Xia等人[14]想法的启发,Shavitt[15]利用额外的数据源进行补充,提出了一种确定性算法来推测更为实际的自治域关系.Shavitt算法首先利用CAIDA为连接赋值S2S关系.Shavitt算法构造一个中心(core),该中心由顶级供应商组成,相互之间用P2P关系连接.中心构造算法有很多种,比如Tau-ro等人[27]提出的贪心最大团(GreedyMaxClique)算法,Carmi等人[28]提出的k-剪枝(k-pruning)算法,CAIDA提供的AS排名,Hasan等人[29]提出的TC(TemporalCone)算法.随后,对于每一条穿越中心的路径,穿越之前的连接全都标记为C2P,穿越之后的连接都标记为P2C;对于没有穿越中心的路径,根据已标记的关系采取投票技术[5]推测其余连接关系.该算法核心在于中心大小的选取,如果太小会遗漏一些顶级运营商,从而导致无效路径的增多.如果太大,一条路径可能会在中心经历多跳.实验表明,中心大小在20左右比较适合.Wikipedia①提供了Tier-1的AS而且为了互联网的可达性,它们之间必须是P2P关系.Oliveira等人[16]基于这一数据源也提出了一种确定性算法.假设Tier-1AS的监视器发现了一条a0-a1-a2-…-an的路径,由于a0是顶级供应商,a0-a1可能是P2P关系也有可能是P2C关系.如果a0-a1是P2P关系,那么其余的Tier-1AS不能够监测到该连接;如果a0-a1是P2C关系,那么其余的Tier-1AS也可以监测到该连接.剩余的连接a1-a2,a2-a3,an-1-an根据Valley-Free原则都标记为P2C关系.但是Tier-1AS监测不到低层次的P2P关系,因而Oliveira从Routeview,RIPE-RIS,PacketClearingHouse,Peeringdb,Euro-IX多处收集数据集.如果某条连接不能被任何高层次的AS所监测到,那么该条连接就是P2P关系.如图12所示,AS2的监测器可以监测到AS2→AS5→AS6→AS8和AS2→AS7→AS9路径,AS4监测器可以监测到AS4→AS2→AS7→AS9,但是AS1,AS3,AS4都不能监测到AS2→AS5→AS6→AS8子路径.因此AS2-AS7是P2C关系,而AS2-AS5是P2P关系.由于P2P关系发现的数量与监测器数量有关,因而当前公开的监视器会丢失90%的P2P连接.互联网路由注册中心由于信息冲突、过时等问题,准确性受到质疑.为此,Battista等人[17]提出了一种更加全面的BGP关系提取的方法.该方法分为4个步骤:首先计算各网络注册单位的基本信息,比如自治域号(AUT-NUMS)数目、自治域集合(AS-SETS)、注册信息随时间的变化情况等;其次依据信息最后改变的时间戳来管理维护各网络注册单位之间信息的一致性;然后分析RPSL语法并且提取备选BGP关系;最后从备选BGP关系中选择合适的关系构造BGP关系图.该方法发现的关系总数远远超过前人发现的关系总数[30-31].但是该方法仅局限在①Tier-1ASes.http://en.wikipedia.org/wiki/Tier_1_carrierPage10无向关系的提取,为了更好地对AS商业关系推测算法进行验证,还应该充分挖掘import和export属性.局部确定法利用部分先验信息,进而推测剩余的商业关系,该算法实现较为简单,执行时间复杂度也较低,而且先验信息可以帮助推测出更加准确实际的商业关系.但是该算法难点在于如何提取准确表5自治域关系推测算法的比较推测算法Subramanian[6]BGP路由表Erlebach[7]BGP路由表Dimitropoulos[9]无异常关系,O(m+n+p)有异常关系,Polynomial和更新P2C,P2PPolynomialLM算法简单,Hummel[12]BGP路由表P2CPolynomialML和更新P2C,P2P,S2SO(p)HM准确率较高,网络特征排名法组合最优法局部确定法注:n是节点数,m是边数,p是所有路径的长度5总结与展望本文在现有文献的基础上,从自治域商业关系分类及链路选择入手,归纳了获取源数据集和验证数据集的关键技术,对自治域商业关系推测算法进行了总结和分析.其中详细介绍了网络特征排序法,组合最优法及局部确定法,阐述了各种推测算法的性能及优缺点.互联网自治域商业关系推测算法还存在很多的可用的先验信息.4.4算法比较表5给出了自治域商业关系推测算法的比较,每个算法都以第一作者命名,用H、L、M分别表示商业关系推测的准确性和无效路径比例的高、中、低,并总结了每种算法的复杂度以及优缺点.LM路径利用率高P2P关系计算效率和准H—准确率较高需要广泛的数据集支撑——能够发现问题需要进一步解决,以下总结了一些自治域商业关系推测算法研究目前所面临的关键性问题及未来可能的发展方向.(1)适合更加多样化的自治域商业关系.传统的自治域商业关系推测算法只基于P2C,P2P,S2S这3种基本关系,但是随着网络环境的日益复杂,自治域商业关系也在向更加多样化的形式发展[32].以下总结了一些新型自治域商业关系.①混合关系.传统的自治域商业关系模型假设自治域之间只存在一种商业关系,但实际上,针对底Page11层不同的物理连接,自治域之间可能存在不同的商业关系.比如,IPv6的路由策略和路径可能与IPv4的完全不同,因此两个自治域如果在IPv4和IPv6平面都存在连接,它们之间可能是混合关系.最近已有研究将IPv6网络的自治域商业关系推测与IPv4网络的加以区分[33].由于IPv6需要快速接入现有网络,经济因素已经不是主要驱动力,Valley-Free原则也就不一定适用于IPv6网络[34];另外入网点(Points-of-Presence,POP)的位置也会影响自治域商业关系,当两个自治域同时与多个网络接入点(NetworkAccessPoints,NAP)或者互联网交换点连接时,它们之间也有可能是混合关系.②部分穿越.部分穿越关系是一般穿越关系的一种特例,提供者只为客户提供限定地理区域的穿越服务.一个多宿主的客户可以通过Communities属性指导国内提供商只提供国内穿越服务,指导国际提供商只提供国际穿越服务,从而节约穿越成本.③间接对等关系.间接对等关系是指两个自治域都与相同的IXP路由服务器建立对等关系但是它们之间却没有实际的物理链接.间接对等关系中的两条P2P连接可以用一条“虚拟”P2P连接代替,从而使得Valley-Free原则仍然有效.新型自治域商业关系的出现对现有推测算法的完备性提出了挑战.针对新型自治域商业关系的推测,今后的研究可以考虑对源数据集进行语义学习和推测(如BGP路由表和更新中的Communities和LocPrf属性).(2)提高源数据集采集的全面性.现有的自治域商业关系推测算法的数据集主要基于公开的IRR数据库、IXP数据库、部署节点的BGP路由表和更新,会丢失许多小型自治域之间的商业关系.BGP路由表和更新通过被动测量监测BGP边界路由器的方式获得.而traceroute工具可以主动地对IP地址列表发送探测包获得路由器级别的路径,通过IP映射转换为AS级别的路径信息.CAIDA(CooperativeAssociationforInternetDataAnalysis)在全球的不同地点放置了很多监测器器,每个监测器上都通过Skitter①软件发送探测报文来收集拓扑信息.在PlanetLab[35]平台上部署的iPlane②也采用了相同的思想.DIMES③是一个分布式的科学研究项目,志愿者下载DIMES软件,并作为代理点将探测结果返回给中心服务器.DIMES目前已经在网络中部署了25393个traceroute探测代理来探测更多的路径,对DIMES的运行结果进行分析,发现了许多小型自治域之间的链路[36].我们分别利用Planet-Labtraceroute和RouteViewBGP路由表数据源测量中国互联网自治域的拓扑结构[37],我们发现trac-eroute(560条)可以发现比BGP路由表(278条)更多的AS连接.但是traceroute的难点在于如何正确地将IP地址映射为所对应的AS[38].因此,如何将traceroute等主动测量的结果转换成可靠的自治域商业关系推测的源数据集是未来研究的一个发展趋势[39].(3)克服现有研究方法的局限性.现有自治域关系推测算法大多基于自治域度数准则,但是这一准则并不能准确判断一个AS的大小[40],最近有研究提出引入混合性的评价准则[41],考虑加入地址空间范围、重要网址数目、用户数量等因素来综合评价一个自治域的大小;另外,数据集路径的准确性和实时性直接影响着自治域关系推测算法的准确性.不正确的路径可能是由配置错误或者过时的自治域合作关系导致的,为了减小已经不存在路径对推测算法正确性的影响,研究可以引入过滤机制来过滤路由表中较少出现的路径[42]或者使用生灭过程的理论模型来计算路径的可信程度[18].(4)借助机器学习的推理技术.将有关联的两个自治域间的关系作为需要推理的值,可以通过机器学习的方法来进行推理.自治域间商业关系需要考虑的因素很多,比如自治域的地理位置、自治域的客户数目、自治域的服务性能等,我们可以利用机器学习的归一化处理作为特征,那么自治域间商业关系可以用一个特征向量表示,作为问题的输入.一方面,我们可以引入机器学习中的贝叶斯、决策树、SVM等分类模型,通过部分已标注的自治域商业关系集作为训练集,对分类模型进行训练,学习特征权重,利用学习到的模型对未知的自治域商业关系进行推理,从而获得全面的自治域间商业关系.另一方面,我们也可以基于自治域拓扑网,将自治域商业关系的特征向量作为可观测数据节点,通过特征向量推测自治域商业关系即隐变量节点,那么该问题转化为在因子图等概率图模型中的学习与推测问题.通过部分已标注的自治域商业关系,基于信息传播,通过监督学习或者半监督学习获得特征权重,然后基于已经学习的因子图模型,根据输入的特征向量,输出自治域商业关系.①②③iPlane.http://iplane.cs.washington.edu/Page12
