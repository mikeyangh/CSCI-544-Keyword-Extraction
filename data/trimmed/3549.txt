Page1基于标识变化的时空推理王生生1)刘大有1)谷方明1)吕倩楠1)温长吉2)1)(吉林大学计算机科学与技术学院符号计算与知识工程教育部重点实验室长春130012)2)(吉林农业大学信息技术学院长春130118)摘要空间变化是空间信息处理中的热点问题,标识变化是空间变化的关键问题之一.但是现有工作侧重表达,知识推理能力较弱.为此,研究了基于标识变化的时空推理问题.给出了基于多段图和集合论的标识变化形式化语义,在此基础上定义了二元关系模型.针对基本关系约束满足问题,提出了构造性求解算法,并证明了代数封闭算法可解;针对全关系约束满足问题,提出了一致场景算法.理论分析和实验应用均表明该方法能有效解决信息不完整、不准确情况下的标识变化表示与推理问题,对此类问题其它同类模型尚不能很好解决.关键词时空推理;标识变化;约束满足问题;代数封闭算法;弱复合1引言空间变化指被观察对象的空间属性随时间发生Page2究,另一类工作是研究从原始数据中抽象出来的定性数据.近年来定性空间变化研究逐渐兴起[1-9],它是指定性空间属性(如拓扑关系)的离散变化.定性空间变化往往是实际应用中用户所更关心的,比直接反馈给用户数值信息更有意义.亦有研究称这种定性变化为事件(event)[4-5,9].标识变化是定性空间变化的主要研究内容.标识(identity)指空间变化中被观察对象的(显式或隐式的)身份识别标志.基本的标识变化包括创建、消失、分裂、融合和无变化.标识变化用一种纯符号系统表达空间变化,非常简洁高效,能反映空间变化的最本质特征,因而成为各类定性空间变化研究的核心内容.现有定性空间变化模型[1-9]能从不同角度描述空间变化过程,但是这些模型都是以表示为主,知识推理能力较弱.定性约束满足方法(QCSP)是时空推理领域中一种很有效的知识推理方法[10].目前针对定性空间变化的QCSP研究还未见报道.为更好地解决空间变化的知识推理问题,本文针对定性空间变化的最核心问题———标识变化,首次开展基于QCSP的时空推理研究.我们对基于标识的时空变化采用两层表达:第1层用多段图表达完整的空间变化过程,每段对应一个时间点的快照;第2层采用二元关系模型描述个别时空对象间的时空关系.由于第2层的关系模型能表达不精确、不完备的时空信息,需要定性推理机制来判断现有信息的一致性和推断未知信息,这是本文的主要目标.最后,通过应用实例,说明了本文工作的应用前景.2相关工作较早的定性空间变化建模工作是针对时空数据模型的研究,参见1999年Abraham和Roddick[1]的综述,快照、时空历史图、面向对象模型等很多时空模型都包括了对定性空间变化的表达.2000年,Renolen[2]将定性空间变化归纳为7种:创建、改变、消失、再生、分裂、合并和重置.同年,Hornsby和Egenhofer研究了标识变化,他们的工作可以描述更复杂的标识历史变化,如忘记和回想[3].同年,Chen等人[4]面向土地划分应用研究了基于事件的时空变化模型,他们提出的模型侧重变化产生的因果关系.2005年,Worboys[5]给出了面向事件的地理现象描述方法.2006年,Egenhofer和Wilmsen[6]研究了定性空间变化和拓扑关系的相互影响,他们只考察了一个具体特例:单个区域和分裂区域之间的各种可能关系.同年,Worboys和Duckham[7]研究了地理传感器网络中的定性空间变化表示.2008年,Klippel等人[8]给出了基于概念邻域图的定性空间变化表示.2009年,Jiang等人[9]基于树变换映射,研究了基于事件的平面区域拓扑变化描述.以上工作,从不同角度刻画了定性空间变化,他们都显式或隐式地包含了基本标识变化.但这些研究是从定性描述角度出发,只提供了对空间变化的定性描述,部分工作提供了面向特定用途的推理策略(如概念邻域图).上述工作的知识推理能力较弱,尚无法实现一致性检查、更新知识和最小表示等知识系统的基本功能.本文工作是在时空推理(spatio-temporalreason-ing)领域开展时空变化表示与推理研究.主要目标是表达时空变换过程,即在文献[1-9]基础上增加知识推理.由于约束方法简洁、高效、实用,本文采用基于约束的时空推理方法,从定性时空变换的最基本问题———标识变化入手,开展时空推理研究.3标识变化模型现有的标识变化模型[1-9]的主要问题是,它们都没有形式化的语义,都是基于自然语言、图形描述或者无形式化语义的代数表示.这导致基于模型的完备可靠推理工作难以开展.我们提出了一种基于多段图的空间变化过程描述,进而赋予其集合语义.定义1(空间变化过程).空间变化过程是一个有向多段图G=(V,E),节点集合V划分为N+1个段,0t(i)N表示节点i的段号;E是有向边集合,每条边只连接相邻段节点.图1是一个空间变化过程的例子.图中每个段代表一个时间快照,节点表示标识.如果(a,b)∈E且(b,a)∈E,则称(a,b)为双向边.参照标识和空间变化过程的物理意义,我们给出空间变化过程的集合语义.图1有向多段图用于表达基于标识的空间变化Page3定义2(空间变化过程的集合语义).G=(V,E)是空间变化过程,对其中的每个节点i赋予集合语义Set(i),若(a,b)∈E则Set(a)Set(b),即a是b的一部分.反之亦然,即若Set(a)Set(b)则(a,b)∈E.根据定义2,图1中的有向边d→b表示d是b的一部分,因而不是d合并到b,而是b分裂出d.集合语义满足如下基本公理.边必须满足如下条件之一:定义3(基本公理).(1)标识独立性公理(2)封闭世界公理任意2个段t1和t2,i1,…,im是t1段节点,j1,…,jn是t2段节点.则Set(i1)∪…∪Set(im)=Set(j1)∪…∪Set(jn).基本公理(1)保证了同一个时间快照内标识是独立的.基本公理(2)可视为物理世界的物质不灭定律.它并不排斥创建和消失.创建、消失可以通过在每段增加一个特殊节点X,创建等于从X节点分裂,消失等于合并到X节点.为了满足集合语义和基本公理下,空间变化过程中的边必须满足如下条件.定义4(边约束).除了第N段节点,任何节点i连接到其右段的(a)i发出1条边,再无其它边.(b)i接收2条或更多边,再无其它边.(c)i连接一条双向边,再无其它边.除了第0段节点,任何节点i连接到其左段的边也必须满足以上条件之一.根据边约束连接节点的边在一个方向(左或右)上只有以上3种构型是允许的.边约束是通过枚举各种可能情况得到的.定理1.一个原子空间变化过程如果满足基本公理(1)并且满足边约束,则它满足基本公理(2).证明.边约束允许的3种情况分别对应3种基本标识变化,以向右为例,依次是合并、分裂和无变化.每种单独的变化都满足基本公理(2).而原子空间变化过程中这些基本标识变化是独立的,所以基本公理(2)在整个变化过程中也成立.证毕.从上述讨论可知,在定义3的前提假设下,定义1的多段图能完备表达标识变化.该方法只对信息完整的空间变化过程有效,下面将给出的二元关系模型BRC,是针对信息不完整的空间变化描述提出的.表1定义了节点a和b间的标识变化的二元关系,这里考虑了两方面因素:一方面是整体-部分关系,通过空间变化过程(定义1的多段图)中是否有从a到b的路径来体现;另一方面是时态关系,通过t(a)和t(b)的大小比较实现,等价于点代数PA[10]的片断.共享标识a→bb→aa→bb≠>aa≠>bb→aa≠>bb≠>a表1中“→”表示“有路径到”,“≠>”表示“没有路径到”.BRC包括了10种基本(或原子)关系{NB,EQ,NA,MG,SP,MGi,SPi,DB,DS,DA}.从定义可知,BRC是JEPD(JointlyExhaustiveandPairwiseDisjoint)关系.BRC全关系由其10种基本关系的幂集构成,共210种关系.如{NB,EQ,NA},{MGi,SPi},都在其中.所有基本关系的并集关系用“”表示,表示完全未知关系.4标识变化约束满足推理4.1约束满足问题约束满足问题(CSP)是时空推理中的典型问题.标识变化的CSP定义如下.定义5(BRC约束满足问题).CSP(R)=(V,Θ)是一个约束满足问题,其中V为变量的有限集合x1,x2,…,xn,Θ为V上的二元约束关系集合,形如x1rx2,r∈R,并且R为BRC的子集.称CSP(R)是一致的(或称可满足,可解,可实现)当且仅当能找到一个空间变化过程G=(V,E)满足VV并且G能满足Θ.亦称G为CSP(R)的一个解(或模型).4.2构造性求解算法对于基本BRC的约束满足问题,我们给出了如下的构造性算法.该算法不仅能判定基本BRC约束是否一致,还能构造出一个满足约束的空间变化过程.算法1.Solving-BC(V,Θ).输入:基本BRC约束满足问题(V,Θ)输出:若Θ一致返回空间变化过程G=(V,E),否则Page41.检查Θ的节点和弧段一致性(约束矩阵的对角线同2.段划分//t(a){<,=,>}t(b)是点代数的片段,可3.检查相邻段4.检查间隔段(关系传递性)forl=2ton-15.补充新节点if(i只从左段收到1条边)then增加一系列新节点if(i只从右段收到1条边)then增加一系列新节点if(i没有边连接左段)then增加一系列新节点修正:k0…kt(i)-1i;if(i没有边连接右段)then增加一系列新节点修正:ikt(i)+1…kN;设n为V中变量数目,算法Solving-BC的时间复杂度是O(n5),因为第3步时间复杂度是O(n5),其它均为O(n2).定理2.基本BRC的约束满足问题(V,Θ)一致当且仅当Solving-BC(V,Θ)有解.证明.“”若Solving-BC(V,Θ)返回G=(V,E),则由算法执行过程,显然G同时满足Θ和边约束.虽然步3中规则比边约束稍弱,但不影响二元关系一致性,如果存在差异可以在步5中修复.所以,G是空间变化过程,G是解,(V,Θ)一致.“”(V,Θ)一致,不妨设存在解G1=(V1,E1),下面我们将检查算法各步,确认不会返回false,并且算法各步生成的G始终满足GG1.(1)Θ全局一致,必然节点、弧段一致,可通过.(2)Θ一致,其上的点代数片段也必一致,故无矛盾.若G1的段号分配和算法得到G不同,可以调整相同,即从0起,紧凑安排,因为前后关系是相对关系,绝对段号只要不违背相对关系可任意分配.故GG1成立.(3)Θ只有基本BRC关系,由定义知Θ可唯一确定V节点相邻段的边,故G1和G内V节点相邻段的边是相同的,GG1成立.G1满足边约束,G也满足,此步的约束比边约束弱,因此无false返回.(4)分情况讨论,[→]在条件(i{MG}j∈Θ)andnot(i→jinG)下,(i{MG}j∈Θ)G1中必有i→kt+1→…→kt+l-1→j.这个链中可能存在部分,但对下面的讨论无影响.kt+1,…,kt+l-1中没有节点会在V中.否则,若kt+v∈V,则有i{MG,NB}kt+v∈Θandkt+v{MG,NB}j∈Θ(1vl-1),因为G1满足Θ.由于这两个约束的段距离都小于l,在前面的l循环中必然会进行处理,也就是G中会有i→kt+vandkt+v→ji→j,与[→]条件前提矛盾.i不能有边到其右段.如果有边,只能是kt+1(发出边至多1条),kt+1不在V中,它是在前面步骤中被创建的.kt+1不可能是端点,创建它的节点只能在右面(左节点刚讨论过),所以kt+1有向右的边.以上讨论可循环进行,直到j.所以G中有i→j,矛盾.由此可知,此处算法不会返回false.若i右侧无边,则算法在G中创建一条新路径,为了保证GG1,我们对G1做局部调整,并且保证G1仍然是解.Page5[←]讨论类似上面.[]在条件(i{NB}j∈Θ)andnot(ijinG)下,(i{NB}j∈Θ)有ikt+1…kt+l-1j在G1中.通过类似前面的讨论,可以得到kt+1,…,kt+l-1均不在V中.G中i不能有边到其右段,j不能有边到其左段.故不会返回false.由于双向链是排他并且唯一的,算法在G中新建的ij双向链,同G1必然是相同的.故此步能保证GG1.[<≠>]若(i{DB}j∈Θ)and(i→jinGori←jinG)成立,G此时和Θ冲突,而GG1成立,推出G1不是解,矛盾.所以对一致的Θ这个条件必然不能成立.(5)因为这步进行的调整对二元关系无影响,表2BRC的弱复合表R(b,c)NBEQNAMGSPMGiSPiDBDSDANBNBNBEQ,NA,NBMGSPMGiSPiDBDBDB,DA,DSEQNBEQNAMGSPMGiSPiDBDSDANAEQ,NA,NBNANAMGSPMGiSPiDB,DA,DSDADAMGMGMGMGMGDBSPSPSPSPDBSPMGiMGiMGiMGiEQ,NA,NB,SPi,SPiSPiSPiSPiDBDBDBDB,DA,DSDBDSDADBDB,DB,DS,DADB,DA,DA,MGi4.4代数封闭算法代数封闭算法通过弱复合运算不断约简所有变量三元组内的关系,最终达到稳定状态,如果没有空约束关系出现就称为代数封闭.致当且仅当Θ代数封闭.定理3.基本BRC的约束满足问题(V,Θ)一证明.“”Θ全局一致必然局部一致,因此代数封闭.“”我们将证明“若Θ代数封闭,则Solving-BC(V,Θ)有解”,依次考察算法各步.所以这里在G中增加的节点和边,或者就在G1中,或者可以对G1做等价调整,使它们一致.最终,能保证GG1并且能满足Θ,则G也是一个解.4.3弱复合表在前面的构造性算法基础上,通过时空推理方法,我们将深入探讨BRC推理问题.弱复合运算是时空推理的最基本操作.弱复合运算:RS={T|a,b,c:R(a,b)∧S(b,c)∧T(a,c)}.BRC的弱复合表可以由Solving-BC算法得到.根据弱复合定义,可以通过穷举所有3变量基本BRC约束网络,得到BRC弱复合表(表2).R(a,c)EQ,MG,MGi,NA,NBDASPiDB,DA,DB,DA,DS,SPDA,MGiDANB,MG,MGiDANA,SPi,DA,(1)Θ代数封闭,则节点和弧段一致,通过.(2)对于点代数片段{<,=,>},代数封闭决定全局一致性.所以Θ上的点代数片段代数封闭,且全局一致.此步能通过.(3)弱复合表中R1R2≠能起到同边约束一样的效果.Θ代数封闭,满足弱复合表,自然能满足此步内的条件,通过.(4)下面说明若Θ代数封闭,各条件下都不会返回false.[→]在(i{MG}j∈Θ)andnot(i→jinG)成Page6立的前提下,如果i在G中有向右侧的边,则沿着→边向右,必然链到v∈V,t(v)<t(j).因为被创建的节点不能做→链端点;→边每节点只能有一条,→链是唯一的,若t(v)t(j),则j必然在链内.G中有i→vi{NB,MG}v∈Θ.通过弱复合推理得到i{NB,MG}v∈Θ,i{NB,MG}j∈Θ,t(v)<t(j)v{NB,MG}j∈Θ.则在前面的l循环里必然对v{NB,MG}j进行过处理,并在G得到v→j.那么G中,i→vandv→ji→j,矛盾.所以i在G中没有向右侧的边,不会返回false.其它(4)中情况讨论类似.所以,弱Θ代数封闭,Solving-BC(V,Θ)不会返回false,Θ全局一致,有解.代数封闭算法的实现和文献[12]中路径一致算法相同(替换复合操作为BRC弱复合),时间复杂度O(n3).但它只能判定是否可满足,不能给出解(空间变化过程G).4.5一致场景算法一致场景是指如果BRC全关系的约束满足问题是一致的,则给出一个约束的子集,该子集只包含基本BRC关系.也就是对于一个不确定的约束知识库给出一个确定的解.定理4.BRC全关系的约束满足问题CSP(BRC)是NP完全问题.证明.CSP(BRC)属于NP难问题,因为它的两个片段,点代数和整体部分关系都是非凸的(参见PA[10]复杂度分析),点代数片段包括{<,>}关系,整体部分关系包括{→,←}关系.CSP(BRC)属于NP,因为它的一个解(基本关系约束网络,即一致场景)可以用algebraic-closure算法(O(n3))检测.故CSP(BRC)是NP完全的.下面给出一个递归回溯算法求解BRC全关系约束满足问题的一致场景.算法2.ConsistentScene(V,Θ).输入:CSP(BRC)=(V,Θ)输出:如果Θ一致,返回true,并且返回的Θ是一致场1.ifnot(algebraic-closure(Θ))thenreturnfalse;2.if存在xiRxj∈ΘandRBCthen3.{for所有S∈RandS∈BC//穷举R内基本关系4.{Θ=Θ;在Θ中将xiRxj替换为xiSxj;5.ifConsistentScene(V,Θ)thenreturntrue;}6.returnfalse;}//失败,回溯7.elsereturntrue;//Θ只有基本关系,且代数封闭,定理5.若BRC全关系的约束满足问题(V,Θ)一致,则算法ConsistentScene(V,Θ)返回一个一致场景,否则返回false.证明.若Θ一致,则algebraic-closure(Θ)返回ture.且Θ存在一个由基本BRC关系构成的约束子集Θ,Θ满足algebraic-closure.不难看出,算法中递归穷举了所有可能一致的基本关系约束子集(只排除了非algebraic-closure的约束网络).所以Θ必然在搜索范围内,算法至少能找到一个一致场景.若Θ不一致,或者Θ不满足algebraic-closure(Θ),或者Θ不存在一致的基本关系约束子集,两者算法均可停机并返回false.设V中有n个变量,考虑逆关系,约束网络Θ有n(n-1)/2组约束,每个可取至多10种基本BRC关系.则最坏情况下,算法ConsistentScene(V,Θ)需搜索10n(n-1)/2个基本BRC关系约束网络,每个判定algebraic-closure(Θ)需O(n3),即时间上界为O(n310n(n-1)/2).下面给出一个推理实例.假定有10个地块,命名为A到J,它们可能存在于不同的历史时期,由于年代久远,只保存了如下不完整的证据:A和B,C和D,E和F,G和H,I和J分别存在于同一时期.A合并到了C,D和F都合并到了H.B合并到了C或者B和C是同一块地的两个名称.E和J是同一块土地在不同时期的两个不同名字.F是C的一部分.E和G是从C中分裂出来的,I是从G中分裂出来的.上述陈述,可以用BRC描述,应用Consis-tentScene算法,检测出上述事实是无矛盾的,并且得到了一致场景描述,进而运行Solving-BC算法,得到了一个图2的具体变化过程描述.若在上述事实中新增加:“G是D的一部分”,则ConsistentScene算法返回假,表示事实之间存在Page7冲突.上述推理过程,现有的方法都不能实现.5实现与应用虽然已经开发出了如SparQ[13]等通用的时空推理工具,代数封闭算法可以直接调用工具,但本文大部分算法需要独立实现.我们基于Windows环境,用VisualC++实现了本文算法,并封装为推理工具ISTR.ISTR在国家863高技术项目“农业知识网格”中进行了测试.从知识网格中可以获取的耕地使用变化的历史信息,由于是多源集成的信息可能存在不一致.ISTR可以从耕地标识变化角度检查数据一致性.实际应用表明,ISTR能够有效发现并更正标识错误.除了数据校验,ISTR还应用于对耕地时空变化的查询优化.复杂的时空查询由多个变量构成,变量之间组成了约束网络.基于ISTR的查询优化体现在两方面:(1)通过基于ConsistentScene算法的查询预处理,事先过滤不一致的查询条件,避免了不必要的时空数据库操作.(2)在约束网络中去掉可由其它约束推导出的约束,得到同原网络等价的最小表示,从而降低查询条件数目,提高查询效率.实际应用表明,上述优化措施显著提高了查询效率,特别在查询变量多、条件复杂的情况下,效果更明显.本文方法还可以用于规划、视频挖掘、视频检索等领域.6结论和展望本文首次提出了针对标识变化的时空推理方法,弥补了定性空间变化推理研究的不足,具有一定理论意义和应用价值.同现有定性空间变化研究[1-9]相比:(1)首次提供了知识推理功能,可以进行一致性检查,发现一致场景.(2)提供了定性空间变化的二元关系表达,直接在关系数据库中存储和管理,便于实现应用;现有方法都是基于图(包括树)的,需要独立开发系统才能实现存储和管理.由于本文工作是首次实现对定性空间变化的QCSP推理,为了保证效率,关系模型相对简单,只表达了最基本的标识关系.所以从语义上较现有模型稍弱,这是为了提高推理效率在表达能力方面的必要牺牲.在后续的研究中,将尝试加入更丰富的语义,并寻找高效的推理算法.
