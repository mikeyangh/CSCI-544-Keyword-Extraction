Page1用户查询意图切分的研究江雪孙乐(中国科学院软件研究所北京100190)摘要用户查询意图是指用户在构建查询时,希望搜索引擎能够返回的信息.如果搜索引擎可以判断用户当前查询与之前输入的查询是否属于同一查询意图,那么可以为用户提供更适当的查询建议、查询扩展或者个性化检索服务等.该文提出了基于点击相似度切分用户查询意图,在决策树模型和CRF模型上都取得了一定的提升.利用用户点击信息可以提高查询意图切分的效果,引入用户点击信息后,基于决策树的方法,F值提高1%,基于CRF模型的F值提高1.4%.关键词信息检索;查询日志;查询意图切分1引言搜索引擎公司将用户在查询过程中的行为,记录在用户查询日志当中.通过分析用户行为,可以为用户提供更好的搜索体验.近年来,用户查询分析、查询理解逐渐成为研究热点.一些研究人员和搜索引擎公司基于查询日志,描述了用户查询的习惯用词、组成结构、搜索热点等[1-3].但是这些研究没有充Page2某一特定的查询意图,AltaVista平均每个session包含2.02个查询[1].如果我们准确判断用户连续输入的查询是否属于同一个查询意图,那么将有利于改善搜索结果,提高用户体验.具体的作用可以概括为以下两点:(1)有利于提高查询建议、查询扩展的效果.针对一个查询意图,用户通常会构建多个查询以获取自己所需的信息.一般而言,搜索引擎根据用户最后输入的查询返回的结果,才能满足该用户的查询意图.基于此,我们可以利用最后输入的查询为用户之前输入的查询提供更合适的查询建议和查询扩展.(2)有利于建立更合理的用户模型.用户模型在个性化检索、计算广告学中都有广泛的应用.个性化检索需要用户的长期模型和短期模型以提供合适的检索结果,而计算广告学则需要判断用户的需求,以提供合适的广告.合理切分用户意图,则能够建立一个噪声较小的用户模型,为提高个性化检索、计算广告学等奠定基础.我们的研究类似于前人所做的Session检测[4-7].目前,Session并没有统一的定义,大致都是指用户为了找到自己所需的信息,与搜索引擎进行的一系列交互行为.本文直接使用用户查询意图的切分来指代Session检测.我们的主要工作就是要检测用户查询意图的边界,即判断两个连续的查询之间是否为两个不同查询意图的边界.在分析前人工作和实际查询日志的过程中,我们发现基于查询相似度的方法存在两个较为严重的问题:(1)词汇不匹配问题,即前后两个查询虽然使用了不同的词汇,但实际上属于同一意图,如“中国首都”和“北京”.(2)前后两个查询虽然使用的词汇非常相近,但是属于两个不同的查询意图,如“汶川地震原因”和“汶川地震校舍倒塌原因”,从字面看两个查询的相似度非常高,但实际上属于两个意图,“汶川地震原因”对应的信息需求是地震的原因,而后者对应的信息需求则是校舍倒塌的原因.要依靠传统的文本相似度来解决上述两个问题,难度非常大.本文借助浏览器记录的查询日志,构建query-url的二部图,基于此计算query之间的点击相似度,作为新的特征加入到决策树、CRF模型中进行验证,通过实验验证了:(1)用户点击信息可以提高查询意图切分的性能;(2)在相同的特征组合下,CRF模型优于决策树模型.2相关工作本节将介绍几种典型的切分用户查询意图的方法.这些方法在切分用户查询意图时,主要使用两类特征:时间间隔、查询重构的模式(pattern).这些方法或单独使用其中一个特征,或将这两类特征联合起来作为切分查询意图的依据[8].2.1基于时间间隔的方法用户趋向于在短时间内向搜索引擎提交多个查询,而在相对长的时间内没有任何动作.因此,为了检测用户查询意图的边界,文献[5,7]采用了时间间隔.他们使用5min作为一个阈值,即如果两个查询的间隔小于5min,那么他们就属于同一查询意图,否则就属于不同的查询意图.这种方法非常简单,应用广泛,并延伸出多种时间间隔的阈值:5min[5],10~15min[7],30min[5,7]等.文献[9]指出对所有用户使用同样的时间间隔阈值是不恰当的,所以他们提出了一种基于Hierar-chicalAgglomerativeClustering的算法,为每个用户估计不同的阈值.2.2基于词汇特征的方法另一些研究人员提出,可以使用查询语句本身的特征来判断两个连续的查询之间是否存在查询意图的转变,即查询意图的边界.文献[6]提出了多种查询模式的分类方法.检测查询意图边界时,以下5种查询模式比较有效:重复(repetition)、细化(specialization)、泛化(generalization)、重构(refor-mulation)、新查询(newquery).“重复”是指前后两个查询完全相同;“细化”是指后一个查询与前一个查询同属一个意图,但是更加细化(如增加几个查询词);“泛化”是指后一个查询与前一个查询同属一个意图,但是更为泛化(如从前一个查询中删除几个查询词);“重构”是指前后两个查询同属一个意图,但是两个查询使用的查询词只有部分相同;“新查询”顾名思义,是指前后两个查询属于不同的查询意图(即查询词完全不同).查询模式是通过比较两个查询的查询词而获得的,这当中存在一个很大的问题,即查询词不匹配.比如前后两个查询分别为“中国首都”和“北京”,根据上述定义,这两个查询分属不同意图,即“新查询”模式.实际上这两个查询指的是同一个概念.Page32.3基于机器学习的方法使用查询模式来检测查询意图边界时,通常有两种方法:一是基于规则的方法,即当出现“新查询”模式时,就认为用户的查询意图发生改变;二是基于机器学习的方法,融合查询模式以及时间间隔信息,估计在这两个特征下,两个查询之间发生意图改变的概率.对于每一对查询,文献[6]先计算二者的时间间隔以及查询模式,对于每一种时间间隔和查询模式的组合,都有一个事先统计好的基于Dempster-Shafer理论的联合概率分布.如果对应的概率超过某一阈值,就认为这两个查询之间发生了查询意图的改变.文献[10-13]同样利用了时间间隔和查询模式,他们分别尝试了人工神经网络、多元线性回归和蒙特卡洛模拟的算法.这几个算法的共同特点是,在识别查询意图的连续性(continuation)时效果较好,而在识别查询意图发生改变(shift)时的效果较差.文献[14]采用了决策树模型的方法,他们的实验结果证明利用多种属性的决策树模型,可以得到比较理想的划分结果,而用户点击的锚文本对于实验结果没有明显改进.2.4其它方法文献[15]使用两个查询的余弦相似度作为判断依据.但是如前所述,因为存在词汇不匹配的问题,所以它们没有利用搜索引擎返回的前50个结果的摘录(snippet),对原查询进行扩展后,然后计算两个查询的余弦相似度.Seco等人①的方法则是一个非常简单的基于启发式的方法.他们认为当一个查询与前一个查询不包含相同查询词,且间隔超过60min时,该查询就属于一个新的查询意图.3我们的方法前人的方法中,主要使用到了时间间隔、查询相似度、查询模式等特征,而文献[14]还融入了用户点击的锚文本相似度,但是实验证明锚文本相似度对于实验结果没有明显提升.正如相关工作中所介绍的,使用这些特征来检测查询意图的边界时,我们遇到的最大难题是词汇的不匹配,即前后两个查询虽然使用了不同的词汇,但实际上属于同一意图,如“中国首都”和“北京”.还有另一类错误往往被以前的研究人员所忽视.即前后两个查询虽然使用的词汇非常相近,但是属于两个不同的查询意图,如“汶川地震原因”和“汶川地震校舍倒塌原因”,从字面看两个查询的相似度非常高,但实际上属于两个意图,“汶川地震原因”对应的信息需求是地震的原因,而后者对应的信息需求则是校舍倒塌的原因.为了解决词汇相似度在检测用户查询意图边界时所遇到的困难,我们希望求助于查询日志中记载的其他信息.首先我们分析用户的查询过程.当用户持有某一特定查询意图时,他首先要向搜索引擎提交查询,然后在返回的结果文档中进行浏览、点击,从而找到自己所需要的信息.在这个过程中,存在三个变量:用户查询意图QI,用户查询q,包含用户所需信息的网页W.根据我们的任务,用户的查询意图QI不变,而包含用户所需信息的网页W也不变,唯一可变的就是用户查询q.用户构建不同的查询q,都是为了反映自己的查询意图QI,让搜索引擎找到所需的网页W,因此,如果两个查询qi和qi+1都点击了同一网页,我们认为查询qi和qi+1是属于同一查询意图的.但是查询日志中存在很多噪音点击,可能会影响这一属性的性能.因此,我们定义qi和qi+1的点击相似性(CL)如下:CLi,i+1=|c(qi,qi+1)|其中,c(qi)指查询日志中,qi点击过的url集合,c(qi,qi+1)指qi和qi+1都点击过的url集合,|c(qi)|指集合c(qi)包含的元素数,|c(qi,qi+1)|也类似.本文选取了两个对比算法,一是基于时间间隔的算法,一是包含时间间隔和查询相似度的决策树模型.我们在决策树模型中融入点击相似度,以验证用户点击信息在检测用户查询意图时的有效性,并在使用同样的特征时,比较了CRF模型和决策树模型,说明CRF模型的性能要强于决策树模型.我们的实验数据采用搜狗公布的查询日志②.因为具体的实验方法依赖于所用到的数据,因此我们先简要介绍实验数据,然后介绍我们的实验方法.3.1实验数据本文的实验数据来源于搜狗公布的用户查询日①②Page4志,该查询日志以天为单位,包含了2008年6月的部分用户的查询历史.表1是该查询日志的一些样例.其中,用户ID是根据用户使用浏览器访问搜索引擎时的Cookie信息自动赋值,即同一次使用浏览器输入的不同查询对应同一个用户ID.用户的每一次点击行为均在查询日志中产生一条记录,用户在结果文档列表上进行一次点击,查询日志就记表1搜狗查询日志的样例访问时间0000001421205460982763[健美]00000000717725924582846[闪字吧]00000001532039495118448[不锈钢]记录行数22003979173153.01表2中记录行数指用户的点击总数,查询数目是指用户提交的查询总数,一个查询可能对应日志中的多行记录.表2中的统计信息也符合我们的观察,即用户通常需要构造多个查询,才能满足其特定的查询需求.3.2查询意图切分的方法用户查询意图切分就是要检测用户查询意图的边界,可以将它看作一个分类问题,即判断两个连续的查询中间,是否为查询意图的边界.因此可以使用决策树模型来进行分类.同时,也可以将它看作一个序列标注的问题,即当前查询是一个新查询意图的开始,还是一个老查询意图的延续,因此可以使用CRF模型来求解.本文首先采用了最常用的时间间隔方法作为对比算法,其次采用文献[14]提出的决策树方法,验证了用户点击信息有利于提高用户查询意图切分的性能,最后基于CRF模型进行实验,在使用相同特征的情况下,证明了CRF模型的性能优于决策树模型.3.2.1使用时间间隔作阈值的方法在前人研究中,使用了多种不同的时间间隔作为检测查询意图边界的阈值.因此本文也分别选取了5min、15min、30min三种阈值进行实验.在本文中,因为查询日志以用户点击为单位进行记录,因此在检测意图边界时,我们需要为一个查询定义两个时间,即查询开始时间FT:用户在某个查询上的首次点击时间;查询结束时间LT:用户在某个查询上的末次点击时间.查询qi和qi+1的时间录对应的访问时间、查询词以及该网页的url等信息.因为本文实验需要训练语料,因此我们从6月1日的查询日志当中,随机抽取3000位用户的查询记录,进行人工标注.为了保证标注的正确性,我们由一位专家对该训练语料进行标注,并由另一位专家进行检查.该训练语料的统计信息如表2所示.811间隔TI定义为当TIi,i+1>δ时,我们认为qi和qi+1属于两个不同的查询意图,其中δ为我们设定的阈值.3.2.2基于决策树的方法文献[14]使用了决策树方法对查询日志中的Session进行划分,并着重考察了时间间隔(TI)、查询相似度(QL)和锚文本相似度(AL)三个属性在Session划分中的作用.他们的实验证明,使用时间间隔和查询相似度两个属性的性能,与使用时间间隔、查询相似度和锚文本相似度三个属性的性能近似.因此本文使用包含TI和QL两个属性的决策树作为对比算法.另外,我们还在决策树模型上融入了点击相似性(CL),并进行比较.决策树的学习过程为,递归地在每一个节点上选择信息增益最大的属性作为该节点的判定依据,直到满足一定条件后停止递归.一个节点的信息量可以根据如下计算:info(x,y)=-x其中x和y分别为该节点所包含的正反例的数量.而该节点的信息增益就是当前节点信息量与其两个子节点的信息量的加权平均之差,权重由两个子节点包含的实例个数的比例决定.本文使用三个属性:时间间隔TI,计算方法如式(2);查询相似度QL,为两个查询的余弦相似度;点击相似度CL,计算方法如式(1).由于我们标注的语料较小,计算CL时容易出现稀疏性问题,因此我们在搜狗提供的整个查询日志上计算CL.3.2.3基于CRF的方法我们把检测用户查询意图的边界,看作序列标Page5注的过程.如果当前查询为某个查询意图的第一个查询时,标记为B,如果当前查询是某个查询的中间查询或末位查询,则标记为I.在估计某个查询序列的标记时,使用如下函数计算标记序列的概率:P(y|x)=1其中,Z(x)为归一化因子,λk为特征函数的权重,fk(yi-1,yi,x,i)为特征函数,即对于整个观察序列x,标记位于i和i-1位置时的特征值.我们就是要寻找一个标记序列y,使得y=argmaxyP(y|x).类似于决策树的方法,我们比较了时间间隔TI、查询相似度QL、点击相似度CL以及它们的各种组合在CRF模型的性能.4实验结果及分析本节将比较上述3种方法的实验结果,并进行错误分析.4.1评价标准以前的多数工作以单个查询为单位,统计每个查询的标注结果正确与否.这显然不适合评价查询意图的切分.因为一个完整的查询意图,需要正确标注出该意图的开始位置和结束位置,而基于单个查询的评价,没有考虑一个查询意图是否完全标注正确.例如一个查询序列X对应的正确标注为BIIBI,而系统给出的答案为BIBBI,根据基于单个查询的评价,该算法的准确率为4/5,而以查询意图为单位,该算法的准确率仅为1/3.本文采用以查询意图为单位的评价体系.评价指标则是常用的准确率(P)、召回率(R)和F值.这3个评价指标的定义如下:表4决策树模型和CRF模型使用不同特征组合时的实验结果决策树CRFP0.42060.83790.66720.76960.67540.84840.8370R0.34780.86340.79200.79660.69930.87230.8610F0.37970.85040.72410.78260.68620.86010.8488P0.36590.85880.67510.84270.66150.87490.8491R0.34570.87140.81180.84620.70640.88320.8585F0.35530.86500.73700.84440.68300.87900.8537注:带“”表示统计显著差异于QL特征,带“”表示统计显著差异于TI_QL_CL特征,p=0.05.其中,Ncorrect指正确切分的意图个数,Nintent是指系统切分的意图总个数,Mintent指正确答案中意图的总个数.4.2结果比较表3是依据时间间隔进行查询意图切分的结果.从表中可以看出,当阈值设为5min时,切分效果最好.但是F值也只有0.5505,难以达到实用效果.时间间隔对于切分查询意图来说,并不是一条合理的依据.因为用户的查询意图与查询的时间间隔没有本质上的依赖关系.用户可能在极短的时间内多次改变自己的查询意图,也有可能长时间停止搜索行为后,再次查找同一信息.要界别用户查询的意图,应当从查询本身的相似度以及用户的点击信息着手.在决策树模型和CRF模型上,通过组合不同的特征,我们得到的实验结果如表4所示.首先观察决策树模型的实验结果,时间间隔TI在切分用户查询意图时的效果最差,且与查询相似度QL、点击相似度CL组合时,实验效果比单独使用QL或CL要差.而同时使用QL和CL两种特征,就可得到实验效果最好的决策树模型.同样,在CRF模型上,我们也可以得出类似的结论.分别在决策树和CRF模型上融入点击相似度CL后,系统的最优F值分别提升了约1%和1.4%,这也验证了我们提出的查询相似度CL可以提升用户查询意图切分的效果.此外,我们还可以对比得知,在使用相同特征时,CRF模型整体上优于决策树模型(使用TI和TI_CL特征除外).在使用QL_CL特征时,CRF模型的F值较决策树模型提高了近1.9%.CRF模型的优势可能来源于它在标注时考虑了前一个查询的标注对后一个查询的影响,而决策树模型仅对当前查询进行分类,不考虑前一个查询所属的类别.表3依据时间间隔进行查询意图切分的结果阈值5min0.61990.49510.550515min0.54950.35580.432030min0.49320.28570.3618Page64.3错误分析为了验证点击相似度是否能解决用户意图切分时的两个问题,我们对实验结果中的错误切分做了进一步的分析.在CRF模型中,性能最优的两种特征组合是QL_CL和QL,为了验证CL的有效性,我们比较了这两种特征组合下各自的错误切分.首先我们找出QL切分错误而QL_CL切分正确的查询意图,这样的查询意图一共有90个.绝大多数都是将本应属于同一查询意图的查询,判断为属于不同的查询意图.主要是由于字符不匹配所造成的错误.这说明点击相似度CL在解决字符不匹配问题上,具有一定的效果.其次,我们分析了QL_CL切分错误而QL切分正确的查询意图.这类查询意图较少,只有17个.这些错误主要由于用户点击的稀疏性造成的.有一些明显属于同一查询意图的查询,但是共同点击过的网页很少.最后,我们分析了分别使用QL_CL和QL时,均切分错误的情况.这类错误非常多,总数在700个左右.这类错误主要由本文提到的第二个问题引起,即查询词相近,但实际上属于不同的查询意图,本文的方法往往将这些查询判定为同一个查询意图.由于各大搜索引擎都采用基于关键词的检索算法,因此即使查询意图不同,但是使用相近的查询词时,返回的结果中依然可能包含相同的网页,并引起了用户的点击.因此用户的点击信息在此处并没有产生预想中的效果.5总结及后续工作甄别用户的查询意图,是提高搜索引擎性能的关键因素.前人多使用时间间隔和查询相似度作为划分的依据,但是面临两大问题:一是词汇不匹配,二是查询相近,但是意图不同.为了解决这两个问题,我们提出了基于用户点击的用户查询意图切分的方法.实验证明,在决策树模型和CRF模型上,加入点击相似度特征都获得了一定的效果提升.但是通过对实验结果的分析,我们发现仍有一些错误是由于词汇不匹配或者查询相近但意图不同两个因素引起的,且第二个问题更为严重.在后续的工作中,我们将引入语义词典和知识库来解决这两个问题,并在此基础上,进行查询建议、查询扩展以及个性化检索的研究.
