Page1基于局部自相似性和奇异值分解的超采样图像细节增强彭红1)1)(武汉大学电子信息学院武汉430072)2)(武汉大学测绘遥感信息工程国家重点实验室武汉430079)摘要基于局部自相似性的图像超分辨率算法中存在面块或线条现象,导致图像纹理不自然,细节信息丢失严重,针对这个问题,文中提出了一种基于局部自相似性和奇异值阈值化的细节增强图像超分辨率算法.在通过轮廓模板插值得到初始超分辨率图像的基础上,利用奇异值分解及阈值化去噪提高局部自相似性提取高频信息的准确性,解决伪高频噪声成分造成的面块或线条痕迹.该细节增强超分辨率算法主要分为4个部分,即初始插值、块匹配搜索、奇异值阈值、细节合成.首先选取Pascal的轮廓模板插值算法得到初始超分辨率图像,该算法在保持插值图像整体轮廓和细节等方面都有着很好的效果优势.块匹配搜索部分,文中算法由初始超分辨率图像和原始低分辨率图像分别提供参考块和学习块,在单一尺度上进行匹配,更多地利用了原始图像的信息,复杂度也更低,即利用原始低分辨率图像的局部自相似性提供先验知识,进行块匹配学习,找到初始超分辨率图像块在原始低分辨率图像块中的最佳匹配块,提取出最佳匹配块的高频信息;然后利用奇异值分解将高频信息矩阵分解到两个正交子空间中,并选取合适的阈值对奇异值矩阵进行软阈值化处理,剔除高频成分中能量较小的伪高频噪声成分,得到更为准确的高频细节信息.最后为得到最终超分辨率图像,有效地实现超分辨率图像的细节增强,利用有效奇异值对应的奇异值矢量重构高频图像块矩阵,并在初始超分辨率图像上进行细节合成.合成过程中,选择中心对称的高斯函数对图像块进行加窗处理,以抑制分块重叠带来的重叠区影响.实验结果数据表明,文中算法不但能明显解决由于伪高频成分导致的面块或线条现象,重建出的图像纹理细节更真实丰富,纹理结构和边缘特征的清晰度和对比度较高,得到的高分辨率图像视觉效果也更好.而且文中算法具有较强的拓展性,可以对多种超采样算法进行细节增强,增强后的图像清晰度和边缘锐度明显得到提高,细节纹理信息更加丰富,客观指标也得到较大幅度的提高.关键词超采样;细节增强;奇异值分解;局部自相似性;块匹配;计算机视觉1引言图像超采样又称为图像超分辨率,是图像处理领域中一个具有相当挑战性的理论分支,主要是估计由原始图像中构建对应的更高分辨率图像所缺失的未知像素点,具有重要的实践和理论意义.图像超采样在视频监控、视频目标跟踪、HDTV、打印机、遥感图像处理、医学图像处理等领域都有非常广泛的应用[1-2].一直以来,通过图像超采样得到高分辨率图像并获取图像的高频细节是视频图像处理领域研究的热门方向.目前主要有三大类图像超分辨率技术:(1)基于插值的方法;(2)基于重建的方法;(3)基于学习的方法[3].在插值算法中,双线性和双三次算法在实践中被广泛使用,但是在边缘及高频区域图像梯度轮廓存在着锯齿、模糊等缺点.为解决上述缺点,Li等人[4]提出NEDI模型,利用低分辨率图像与对应高分辨率图像间协方差矩阵的相似性,沿着边缘进行插值.但是该算法计算复杂度高,不利于实时应用.基于重建的超分辨率技术存在先验知识少的问题,且对于超分辨率大尺度的放大,往往重构的图像高频信息不是很理想[5].基于学习的方法[6-8]近几年得到广泛的研究,通过学习高、低分辨率图像块,建Page3立两者之间相应的关系,并将其作为一种先验知识用于超采样.该方法能够弥补基于重建方法的很多不足,但内存消耗较大.由于需要外部训练库,当图像内容与样本数据库不相匹配时,就会出现明显的人工痕迹.文献[8-13]利用图像的自相似性,将自身图像本身作为数据库,减少内存的消耗,取得了不错的效果.其中文献[10-11]考虑经典的稀疏表示方法,利用自相似性建立的冗余字典进行超分辨率复原,得到了较理想的效果.Freedman等人[9]利用自相似性进行复原,在原始低分辨率图像中通过块匹配搜索找到初始插值图像块的最佳匹配块,提取出重要的高频成分,再叠加到高分辨率图像块中.该算法能取得较好的主观效果,但是该类算法也有明显的缺点,若叠加到高分辨率图像中的高频信息不准确,会导致最终合成的高分辨率图像出现明显的面块(facet)或线条痕迹[14],图像纹理细节信息丢失严重,看上去不自然.为克服上述问题,本文提出一种基于奇异值分解和自相似性的超分辨率细节增强算法.首先由轮廓模板插值获取初始超分辨率图像,并进行分块;其次根据输入的原始低分辨率图像的局部自相似性,在其中寻找初始超分辨率图像块的最佳匹配块,提取出最佳匹配块的高频细节信息;然后利用奇异值图1Koala图放大因子为2时视觉效果对比图图1中Koala皮毛部分出现了明显的线条或面块现象,而经过Bicubic插值算法得到的初始超分辨率图像并没有该现象.利用局部自相似性将高频细节成分叠加到初始超分辨率图像之后,虽然图像清晰度和对比度得到了较大的提高,但同时带来了明显的线条或面块痕迹.以上分析表明该线条或面块痕迹是由于后期叠加的伪高频成分造成的.本文阈值去除高频成分中能量较小的伪高频噪声成分;最后将剔除伪高频噪声成分的高频细节信息,叠加到初始超分辨率图像上,得到最终超分辨率图像,有效地实现了超分辨率图像的细节增强.文章最后将该细节增强应用于其他超分辨率算法,均取得了不同程度的细节增强效果.2相关算法原理2.1局部自相似性局部自相似性(LocalSelf-Similarity,LSS)算法利用图像局部范围内的不同尺度中存在的冗余信息,即大量的图像块具有相似性的结构.研究这种局部自相似性,提取这些相似块中的高频细节成分,进行分析处理和纹理细节合成,估计出高分辨率图像中的高频细节成分,以此实现图像的超采样.在2011年,Freedman等人[9]论证了原始低分辨率图像的局部块与初始超分辨率图像的局部块,在放大因子不大的情况下存在相似性的特点.同时由于摒弃了外部数据库,算法的计算效率很高,有较突出的主观效果.但是该类算法对图像中某些边缘或者细节较丰富的区域,重建出的效果图出现明显的面块或线条现象,如图1所示.考虑将提取的高频成分进行奇异值阈值化处理,剔除其中的伪高频成分,并进行细节合成,得到最终超分辨率图像.2.2奇异值分解图像增强原理奇异值分解属于非线性滤波,是一个有着明显物理意义的方法,它可以将一个包含信息的比较复杂的矩阵用几个更小更简单的子矩阵相乘来表示,Page4这些小矩阵由其奇异值和奇异向量组成,描述了矩阵的重要特性.通常较大的奇异值对应的向量表示图像的有用信号,较小的奇异值对应的向量则表示噪声.通过去除较小奇异值对应的奇异向量,再利用余下有效奇异值进行矩阵重构,即可去除图像噪声.二维图像犃∈犚m×n,其奇异值分解如下:式中,犝和犞分别为m×m,n×n维正交矩阵;Σ为r×r维对角阵,其中r为矩阵犃的秩,Σ的对角元素为矩阵犃的非零奇异值,且从大到小排列.矩阵犃为受噪声污染信号构成的矩阵,可表示为由原始无噪声的信号和噪声信号组成:式中,珡A为原始不含噪信号,N为噪声信息.原始图像的恢复增强就可以转化为图像去噪问题,也就是已知犃,求解珡A的最优逼近问题[15].选取合适的阈值τ对奇异值矩阵进行阈值化处理,即获得图像矩阵犃对应的去噪矩阵的近似奇异值矩阵Στ.则重构的去噪图像为基于局部自相似性的超分辨率算法中,若叠加到高分辨率图像中的高频信息不准确,伪高频成分(噪声成分)会导致重建出的图像出现明显的面块(facet)或线条现象.通过上述奇异值分解图像增强,首先将叠加到高分辨率图像中的高频图像块矩阵分解到一系列奇异值和奇异值矢量对应的信号子空间中;然后去除或降低其中的伪高频成分;最后用有效奇异值对应的高频成分进行重构矩阵,可得到更为准确的高频信息,如图2所示.由图2高频信息对比图可知,LSS算法得到的高频信息不够准确,包含很多非高频细节成分,尤其含有很多白色的块;而经过奇异值分解SVD处理之后,剔除了很多不属于高频的部分,明显减少了白色的块现象,得到的高频信息更加准确.3基于奇异值分解和局部自相似性的细节增强超分辨率算法前面分析表明基于局部自相似性的超分辨率算法中,对图像中边缘或者细节较丰富的区域,重建出现的面块或线条现象是由于叠加的高频成分中含有伪高频成分导致.该伪高频成分可视为噪声,但并非常规的高斯噪声、椒盐噪声等.利用奇异值分解进行去噪,对噪声的类型属性不做任何假设,不需噪声的先验知识,算法复杂度低,简易方便.先利用原始低分辨率图像的局部自相似性提供先验知识,搜索到初始超分辨率图像块的最佳匹配块,提取出高频信息;然后对高频信息矩阵进行奇异值分解,去除伪高频噪声成分对应的较小奇异值;最后利用有效奇异值进行矩阵重构,得到有效的高频细节信息,并进行细节合成,得到最终的超分辨率图像.算法流程图如图3所示.Page5该细节增强超分辨率算法主要分为如下4个部分:初始插值、块匹配搜索、奇异值阈值、细节合成.(1)初始插值.插值算法的选取会对最终超分辨率结果产生一定的影响,较好的插值算法必然会得到较好的最终结果.本文选取Pascal[16]的轮廓模板插值算法得到初始超分辨率图像,该算法在保持插值图像整体轮廓和细节等方面都有着了很好的效果.(2)块匹配搜索.本文采用两个图像块对应点像素值之差的绝对值之和(SumofAbsoluteDifference,SAD)最小为匹配准则.对初始高分辨率图像Y0进行逐点划分块,即对图像中的每个像素点b∈Y0,其坐标为(bx,by),以b为左上角控制顶点,构造一个大小为i×i的超分辨率图像待匹配块(参考块)Bi(bx,by).i为4时,分块示意如图4所示.图4显示了一个块的划分示意图.每个小方格代表一个像素点,其中粗线框代表以黑色小方格为顶点的4×4的块.计算控制点b在原始低分辨率图像X上对应的定位像素点p,其坐标为(px,py),计算公式如下所示:其中scale为图像缩放因子.以p为中心,构造一个5×5的搜索范围窗,在该窗内进行全匹配搜索.计算每个匹配块与参考块之间的SAD,值最小的匹配块为该参考块对应的最佳匹配块R.Freedman算法[9]和Daniel算法[12]在匹配时是将原始输入图像经过下采样,由原始低分辨率图像及其下采样图像共同提供参考块和学习块.本文算法由初始超分辨率图像和原始低分辨率图像分别提供参考块和学习块,在单一尺度上进行匹配,更多的利用了原始图像的信息,计算复杂度更低,更加简洁.(3)奇异值阈值.由以下公式计算最佳匹配块R的高频图像块Rh:其中“”为卷积符号,Gσ(x)=ae数[17].Freedman[9]的算法将简单的灰度信息作为高频特征信息,使得复原效果提升不大[18],这里用高斯卷积求得的高频信息效果更好.对Rh进行如下奇异值阈值处理:①进行奇异值分解Rh=犝Σ犞T,得到其奇异值矩阵如下:Σ=diag(λ1,λ2,…,λr),λ1λ2…λr0(6)②选取合适的阈值τ对奇异值矩阵进行软阈值处理,去除其中的伪高频成分,获得Rh对应的有效奇异值矩阵Στ=diag(λ1,…,λr),其中③重构得到初始超分辨率图像参考块Bi(BiY0)对应的有效高频图像块:(4)细节合成:考虑到分块的重叠性,重构得到-h不能简单的叠加到初始超分辨率图像参考块的RBi中.本文选择中心对称的高斯函数对图像块进行加窗处理,以抑制分块重叠带来的重叠区影响.加窗后得到R其中Gσ(x-xc)=将加窗得到的R纹理特征的超分辨率图像:该基于局部自相似性和奇异值分解的细节增强超分辨率算法如下.算法1.基于局部自相似性和奇异值分解的细节增强超分辨率算法.输入:低分辨率图像X输出:高分辨率图像Y1.输入低分辨率图像X,将其插值放大(采用轮廓模板插值),获得初始超分辨率图像Y0;2.将初始超分辨率图像Y0划分成块B;3.通过高通滤波器将低分辨率图像X分解为高频分量Xh和低频分量Xl;4.取块Bi(BiB),在X中找到与Bi对应的点,在局部进行块匹配搜索,找到与Bi最匹配的块R(R∈X);5.找到与最匹配块R相对应的高频图像块Rh,对高频Page6图像块Rh进行奇异值软阈值处理,去除伪高频成分,得到有效高频图像块R6.利用式(10),将去除伪高频成分的有效高频图像块,对其加窗处理后叠加到初始超分辨率图像块Bi中,从而获得高频图像块Bi7.重复步骤4至步骤6,直至完成所有图像块的操作,得到最终的高分辨率图像Y.4实验结果及分析为验证本文提出的基于奇异值分解和局部自相似性的细节增强超分辨率算法的有效性,首先将本文算法得到的超分辨率图像,与经典的Bicubic插值算法、基于自适应梯度插值的边缘定向超采样方法(Wang)[19],Freedman算法[9]及基于学习的稀疏表示方(Yang)[20]进行对比.然后扩展到其他超分辨率算法,利用其他超分辨率算法图为初始超分辨率图5测试图像图像,并利用本文算法进行后续的细节增强步骤,得到超分辨率图像,并分别与增强前的超分辨率算法效果图进行对比分析.测试环境为:操作系统:WindowsXPSP3;Matlab2012a;计算机配置:InterCorei3-2120(CPU@3.30GHz),4.00GB内存.本文通过主观视觉效果和客观指标对图像质量进行评价.测试图像集源之于加州大学图像分割数据库①.本文进行了大量的测试,并选择标准测试图像Child和Lena,以及纹理丰富的、对算法非常敏感的测试图像flower、koala进行实验对比,测试原图像如图5所示,其分辨率参数如表1.为使算法对比效果更明显,本文算法及对比算法均放大16(4×4)倍.主观对比如图6~图10所示,并对高分辨率图像的局部(图中有色方框标记)放大进行对比.4.1主观效果对比为验证本文算法中高斯滤波器和奇异值阈值选①Berkeleysegmentationdatabase(BSD)[EB/OL].http://Page7图6flower视觉效果对比图7Lena视觉效果对比取的可行性,分别利用均值滤波、中值滤波以及双边滤波器进行提取高频信息,算法其他参数保持一致,并与利用高斯滤波器最终得到的效果图进行对比.图像峰值信噪比(PeakSignaltoNoiseRatio,PSNR)能够衡量两图像像素上的差异,图像的结构相似性(StructuralSIMilarity,SSIM)[21-22]可以比较两图像纹理和结构上的相似情况.计算结果对比如表2所示.Page8客观指标均值滤波中值滤波双边滤波高斯滤波图8koala视觉效果对比表2不同滤波器下客观指标对比PSNR25.31537.14038.95740.442由表2可知,求原始低分辨率图像高频信息时,采用高斯滤波器得到的最终超采样图像客观指标PSNR和SSIM最高.细节信息的不准确会直接影响最终细节合成的超分辨率的结果.现给出奇异值阈值化中不同阈值情况下的超分辨率结果测试数据.依次取0.5到5进行效果测试对比.效果图的客观指标随阈值大小的变化曲线如图11和图12所示.由图11和图12中客观指标与阈值的变化曲线图像ChildSSIM0.98790.99030.99160.9943可知,对大部分测试图像,在一定阈值以内,客观指标随着阈值的变大而变大,在阈值为3.5左右最大,之后随之下降,故将阈值取为3.5.本文算法参数设置中,求原始低分辨率图像的高频信息的高斯函数的高斯半径为3,方差为0.5;块匹配搜索中参考块的大小为4;奇异值阈值化中阈值取值为3.5.本文算法视觉效果图如图6~图9所示.从以上的对比图可看出,双三次插值算法放大Page9图9Child视觉效果对比图10增强前后parrot视觉效果对比的图像比较模糊,对比度较低,存在比较严重的高频细节丢失的现象,例如Child局部对比图中,眼睛睫毛以及眼球细节信息比较模糊;Pascal插值方法[16]较双三次算法图像清晰度有所提高,但是细节信息仍然不够丰富,例如Child的眼睛部分纹理不够清晰;Wang算法[19]也存在清晰度不高的问题,且部分图像出现明显的锯齿现象,表现在koala皮毛部分、Child帽子部分以及Lena局部对比图右下角中帽子边缘的锯齿现象;Yang算法[20]重建的图像纹理细节信息较丰富,但是出现了明显的噪点和阶梯效应,表现在flower叶子花的边缘,Lena帽子边缘部分出现的阶梯效应以及Child眼睛周围出现的阶梯Page10图11PSNR随阈值的变化关系图12SSIM随阈值的变化关系效应;Freedman算法[9]清晰度和边缘锐度很高,但是图像中边缘或者细节较丰富的区域出现了明显的线条或面块痕迹,细节信息丢失严重,表现在Lena头发上、koala皮毛上以及flower花芯处有明显的块现象,Child眼球上也有明显的线条,导致眼球呈现多边形的不自然现象.这些面块或线条现象,使得图像本身丰富的细节纹理丢失严重,看上去不够自然,人工痕迹严重;而本文算法先根据图像的自相似性学习高频信息块,接着利用奇异值分解矩阵恢复客观指标表3客观指标对比PSNRSSIMBicubic26.6320.863228.1440.881637.1290.977236.4380.980138.6590.994326.78240.912926.18390.8400Pascal27.1200.882228.7310.896839.0640.985038.1640.986341.0970.996427.17360.914227.10800.8691Wang26.8660.871028.8380.893238.6050.984138.6220.986739.8160.993727.23870.912127.51420.8683Yang27.7140.902828.9650.901341.6670.992741.0800.993841.9460.994527.24230.912927.39120.8720Freedman23.8760.829025.1920.848626.0220.784125.9090.867334.0810.983924.81530.874223.74160.8396本文算法27.5250.898829.1220.927041.3920.992940.4420.994343.3550.998327.47480.938127.75950.8747由表3的客观指标可知,本文算法的SSIM指标基本上最高,优于其他5种对比算法,除个别图像本文算法的PSNR指标低于Yang于其他对比算法,虽然Yang算法对于个别图像PSNR高于本文算法,但是Yang算法存在明显的理论剔除伪高频成分,故可以明显改善由于高频信息叠加不准确导致的面块或线条现象,且本文算法也没有锯齿等人工痕迹,图像对比度较高,纹理结构和边缘特征相对比较清晰,纹理细节尤为突出.因此从视觉对比效果图可以看出,本文算法的视觉效果整体优于对比算法.4.2客观指标对比本文客观指标采用PSNR和SSIM来衡量,对多组测试源的测试结果如表3所示.图像Child阶梯效应,视觉效果没有本文算法好.综上所述,本文提出的利用奇异值分解图像恢复理论结合局部自相似性进行超分辨率的算法,无论从客观指标上,还是从主观视觉上都优于其他对比算法.Page114.3细节增强效果现将该算法扩展到其他超分辨率算法,利用其他超分辨率算法得到初始超分辨率图像,再进行细图13增强前后child视觉效果对比图10和图13上面一行为经典Bicubic算法、Wang算法[19]和Yang算法[20]得到的超分辨率效果图,下面一行是在上一行超分辨率图像基础上,再结合本文算法进行细节增强,最终得到的超分辨率图像.通过对比图可以明显看出,增强后的超分辨率图像清晰度得到提升,高频细节纹理信息更丰富,图像对比度也得到增强.例如parrot局部放大对比图左下角鹦鹉黑色嘴壳边缘处,增强后的图像锐度明显得到了提高.各算法增强前后客观测试结果如图14和图15所示,分别展示了各测试图像源PSNR和SSIM增强前后的对比变化曲线.由图14、图15可以看出,Bicubic算法和Wang算法[19]以及Yang算法[20]经过本文细节增强算法之后,PSNR和SSIM指标均得到较大提高,部分PSNR提高接近4dB,SSIM增大接近0.05.由以上主观视觉效果和客观指标对比可知,本文细节增强算法用于其他超分辨率算法时,也能取得较好的效果,增强后的图像清晰度和边缘锐度明显得到提高,细节纹理信息更加丰富,客观指标也得到较大幅度的提高.由此证明本文算法具有较强的拓展性,对多种超分辨率算法效果图都有较好的细节增强,得到最终的超分辨率图像.对多组测试源图像进行测试,由于篇幅限制,只列出部分视觉效果对比图,如图10和图13所示.节增强效果.5结论本文提出了一种基于奇异值分解和自相似性的细节增强超分辨率算法.在分析局部自相似性算法的缺点时,认为其线条或面块痕迹是由于后期叠加的伪高频成分造成的,提出利用图像恢复理论中的奇异值分解原理去除高频成分中的伪高频噪声成分.将含有高频信息的图像块矩阵分解为一系列由奇异值和奇异矢量组成的子矩阵,然后进行阈值化处理,剔除其中的伪高频成分,得到更为准确的高频细节信息;为得到最终超分辨率图像,将去噪后的高频细节信息叠加至初始超分辨率图像上.实验数据表明,本文算法可以明显改善基于局部自相似性算法中,由于叠加的高频信息不准确导致的面块或线条现象,较好的恢复出图像的边缘细节信息,并且能够进行细节增强,适用于多种其他超分辨率算法,有较强的拓展性,对多种超分辨率算法效果图都有较好的细节增强效果.Page12图14各算法增强前后PSNR对比图15各算法增强前后SSIM对比Page13
