Page1绿色评价模型的互模拟等价及逻辑保持钮俊1),2),3)曾国荪2),3)王伟2),3)1)(宁波大学信息科学与工程学院浙江宁波315010)2)(同济大学计算机科学及技术系上海201804)3)(同济大学嵌入式系统与服务计算教育部重点实验室上海201804)摘要绿色计算中,复杂系统的绿色评价是一个重要的研究课题,其核心任务是判断运行时时间、空间资源消耗是否满足环境约束或限定.设计时,采用模型检测技术,自动、完备、高效地进行绿色评价,是一种新颖且有效的解决方案,但可能出现的状态爆炸问题将影响评价成败或效率.引入随机决策过程作为绿色评价模型;用时态逻辑刻画包含行为正确性及时间、空间资源约束的绿色评价指标;定义不确定语义理解下评价模型状态的互模拟等价规则,给出互模拟商的构造方法以及商模型调度,并比较等价语义下的行为机理;运用结构化归纳法证明互模拟等价保持评价结论.分析表明,互模拟等价可用作状态约简手段,为基于模型的绿色评价提供理论支撑和技术手段.关键词绿色评价;模型检测;随机过程;评价指标;互模拟;绿色计算1引言全球范围内,已经构建起越来越多的复杂计算系统.这些系统的日常运作耗费大量空间、电力等资源.据统计,Google公司分布于全球的各个大型数据中心所产生的能耗可相当于一个小型城市的总能耗[1].如何保证众多计算系统的“绿色”运行,已经引起人们的高度关注[2].任何计算系统都需消耗资源,产生计算效用.这些资源可分为时间及其它非时间性资源如能耗、存储、信道等.为了方便描述,本文将非时间性资源统称为空间资源.绿色计算中,在确保系统具有预期计算行为的前提下,评价系统是否“绿色”,是基础也是目标.对于非“绿色”系统,才实施绿色计算,绿色计算的目标就是要保证系统“绿色”.近年来,复杂系统的绿色评价已经成为科学界、工程界共同关注的重要课题,如清华大学林闯教授[3]提出一种循环绿色网络评价模式,以评价能力、质量与效能之间的平衡;四川大学郭兵教授认为绿色评价的目的在于评价计算机系统或计算过程的环境友好性和可持续性,判断标准可以是定量、定性或动态的,并分析了绿色计算的定量评价指标,用环境系数描述绿色计算的本质特性[4].绿色评价过程中,很多时候并不需要获得资源耗费的精确值,仅需判断所关注评价指标是否满足约束即可.事实上,由于参数误差或参数获取方法的缺失,某些精确量化值也仅仅是某种程度的近似.因此,从定性、定量分析相结合的角度给出是否绿色的判断,不仅也能满足评价要求,同时还可避免某些精确定量分析所产生的大量计算成本.开放、分布、异构、虚拟的计算环境中,计算系统正变的越来越复杂.因此,从形式验证的角度,判断资源消耗是否满足给定的“绿色”要求,从某种意义上讲,更是一种“绿色”的评价手段.将有助于以自动、完备的方式实施复杂绿色评价,提高效率,同时又不失准确性.近年来,以模型检测[5]为代表的自动、完备的形式验证技术,正被逐步应用到复杂系统绿色评价中[2],如文献[6-7]运用模型检测技术探讨能耗管理系统的能耗优化问题等.评价过程中,需建立系统模型并用时态逻辑刻画表示评价要求的验证性质[5].模型用于描述系统运行时状态变迁过程及时间、空间资源耗费情况.动态、分布、虚拟的互联网环境中,大多数计算系统具有概率、随机和不确定性等特征[5].其中,概率性、不确定性用于描述行为变化趋势,前者满足概率分布,后者刻画不确定选择,随机性表明系统响应时间为随机变量.作为已经被广泛使用的性能分析模型,CTMDP(ContinuousTimeMarkovDecisionProcess)具有概率、随机以及不确定性刻画能力,能刻画大多数的复杂系统[8].同时,CTMDP还被广泛用作许多高层(High-Level)性能模型如随机广义Petri网[9]、随机活动网、随机StateChart图、动态容错树等的语义模型[8].因此,扩展CTMDP并将其作为绿色评价模型,能满足大多数情况的分析需要.常见的刻画验证性质的时态逻辑有计算树逻辑CTL、线性时态逻辑LTL、概率树逻辑PCTL(ProbabilisticCTL)[5]、连续随机逻辑CSL(ContinuousStochasticLogic)[10]、连续随机回报逻辑CSRL(ContinuousStochasticRewardLogic)[11]等.CSRL中的回报约束可用于描述空间资源要求.既然行为正确性是评价的前提和基础,因此绿色评价属性必须包含行为正确性约束.在CTMDP中,功能行为由可观动作及状态序列(路径)体现,最直接的做法就是沿用并扩展基于动作的连续随机逻辑aCSL(action-basedCSL)[12],用于刻画绿色评价指标.但是,由于aCSL在刻画行为时只能限制执行动作集合而无法精确表明执行动作间的复杂时序关系.因此,本文借助动态逻辑(DynamicLogic)[13-14]的思想,将正则式引入路径表达,以表达更加复杂的行为性质,将该逻辑命名为asCSRL(CSRLwithactionsandstatelabels).在运用模型检测技术进行绿色评价过程中,需应对可能出现的状态爆炸问题[15].解决该问题的关键是在保证验证结果一致的前提下,减少需要遍历的状态空间.考虑到大多数计算系统及验证性质的复杂性,单纯行为验证中已经被证明行之有效的约简技术如对称、偏序约简等无法起到好的约简效果[5].因此,本文从理论上探讨了运用互模拟等价技术进行状态约简的可行性.为了能够对能耗等空间资源要求进行刻画,本文为CTMDP添加回报结构(RewardStructure)[5,11],用于刻画状态空间资源要求.本文第2节引入基于CTMDP的绿色评价模型的形式定义;第3节和第4节分别介绍基于动作状态的连续随机回报逻辑asCSRL、互模拟等价规则及行为机理;第5节给出互模拟等价保持asCSRL公式的理论证明并给出基于模型检测的绿色评价方法;最后总结全文.Page32绿色评价模型形式定义及相关概念2.1增强空间资源刻画的绿色评价模型系统运行时时间、空间资源消耗程度是绿色评价的主要内容.绿色计算中,可采用测量的方法或基于模型的方法进行绿色评价[3].但是,前者一般只用于分析已经部署运行的计算系统,同时,也仅能笼统地进行总量分析,无法准确定位系统违反评价指标的瓶颈位置[5].设计时,构建计算系统的动态行为模型,不仅可以加深对需求的理解,还可帮助分析或预测资源耗费情况,并作为改进设计的重要依据.从设计运行的本质上看,概率性、随机性以及不确定性是大量复杂系统的本质特征[6,8].不失一般性,本文采用一种能同时刻画上述特征的绿色评价模型.本文重点关注带有Markov特征系统的评价模型,并沿用、扩展CTMDP,给出模型定义.定义1.增强空间资源刻画的绿色评价模型.定义为七元组M=(S,Act,AP,犚,L,v,ρ),其中,S、Act分别为状态、动作的非空可数有限集;AP为原子命题集合,用以标记系统状态;犚:S×Act×S→0为转移率矩阵;L:S→2AP为状态标记函数;v为初始分布;ρ:S→0为回报结构,描述单位时间内驻留于某状态时的空间资源消耗量,即空间资源要求率[16].设存在a∈Act使得λ=R(s1,a,s2)>0,则状态s1和s2之间存在标记为a的转移s1间t满足参数为λ的指数分布(Markov性).状态s在动作a下的离开率为E(s,a)=∑s∈SE(s)=∑s∈S,a∈Act吸收态[5,16].为了方便描述,记单步状态转移为(a,t,s),表示从某状态出发,选择动作a,在时间t后转移到状态s.直观的,(a,t,s)包含了执行过程中不确定动作a的选取,因此被称为联合转移(combinedtransitions)[17-18].如果E(s,a)>0,则称动作a在状态s是使能的,状态s的使能动作集Act(s)规定其所有可能的不确定选择,每个动作对应一个概率分布.如果状态s满足|Act(s)|>1,则将不确定地选择某个动作a∈Act(s)执行.绿色评价模型M中,行为体现为形如的转移序列所构成的路径.记π(i)为路径π的第i个状态.如果sn为吸收态,则π为有限路径,所包含的转移数|π|称为路径长度,最后一个状态用last(π)表示.无限路径集合记为Pathsω(M)=(S×Act×0)ω,长度为n的所有路径的集合记为有限路径的集合记为则所有路径集合记为Paths(M)=Paths(M)∪Pathsω(M).例1.模型示例.设有两个等价计算组件的计算系统,计算任务被不确定地分配到某个计算组件执行.组件有可能出现故障并能在一定时间内得到修复.计算失败的任务可被调度到另一空闲组件,也可能被终止.对于该系统,可能需关注其能耗情况.设该系统的CTMDP模型如图1所示.状态用椭圆表示,状态中的文字分别表示该状态的编号和能耗要求率(单位:瓦特),s0为初始状态.箭头表示状态转移,附近文字分别表示转移动作及转移率.状态标记分别为L(s0)={sleeping},L(s1)={waiting},L(s2)=L(s3)={running},L(s4)=L(s5)={failed}.由图1可知,Act(s4)=Act(s5)={Retry,Sleep},表明这两个状态存在不确定选择动作,其它状态依此类推.2.2调度由定义1可知,本文采用的绿色评价模型能够刻画不确定性.在运用形式化验证方法进行绿色评价的过程中,首先需要消除状态具有的不确定性,然后才能进行下一步的分析评估,如稳态分析(steady-stateanalysis)、瞬时分析(transientanalysis)等[5].定义2.调度(Policy或Scheduler)[17-18].指绿色评价模型中状态不确定性动作的选择规则.Page4不确定动作的选择一般可能依赖于历史路径或动作选择方式.历史可包括从初始状态出发到当前状态所经历的状态、动作、累积执行时间或空间消耗等.不确定性动作的选择有确定性和随机两种方式,前者明确指定后继执行动作,后者表明动作选取依据某个概率分布.根据对历史信息的依赖程度,调度可分为历史相关和无记忆两种.如果不确定动作的选择依赖于历史信息,则称其是历史相关的,否则称其是无记忆的.文献[17-18]给出了大多数调度类型的定义并比较了相互之间的语义关系.特别地,与时间、历史有关的随机调度THR(TimedHistory-dependentRandomizedscheduler)在对真实时间进行分析方面具有重要现实意义[18],并可用于表示所有其它调度类型,具有一般性.2.3绿色评价模型可测调度所诱导的概率测度在绿色评价模型中,路径代表可能行为,所有路径的集合构成行为的样本空间.定义样本空间中路径集的概率,是对绿色评价模型进行分析或验证的基础[18].时间在绿色评价中扮演重要角色.本文将关注一般意义上的THR类型调度.考虑到分析的有效性[17],本文只关注可测调度.记Distr(S)为集合S上的概率分布集合.定义3.随机可测调度[18].设THR调度为D:Paths×Act→[0,1],Act表示Act上的σ域.如果对任意历史π∈Paths,D(π,·)∈Distr(Act(last(π))),并且对任意动作集A∈Act,函数D(·,A):Paths→[0,1]可测,则称D为可测调度.从路径π最后一个状态last(π)出发联合转移(a,t,s)的发生概率由三方面决定,即状态last(π)选择动作a的概率,该动作在时间t内发生的概率以及转移到状态s的概率.因此,通过上述定义可定义联合转移的测度.定义4.联合转移的测度.设P(s,a,·)为从状态s出发的动作a所对应的概率分布,则联合转移的测度可定义为函数μD(π,·):→[0,1]:μD(π,M)=∫ActD(π,da)∫0E(last(π),a)·e-E(last(π),a)·t(dt)∫SIM(a,t,s)P(last(π),a,ds),其中,M为联合转移集合;为联合转移集合上的σ域;D(π,da)为调度D选择a动作的概率(d为微分记号,下同);E(last(π),a)×e-E(last(π),a)·t表示状态last(π)在时间t内执行a动作的概率密度;∫SIM(a,t,s)P(last(π),a,ds)表示从状态last(π)出发执行a动作进入集合S中状态的概率,IM(a,t,s)为特征函数:如果(a,t,s)∈M,则IM(a,t,s)为1;否则为0.路径为联合转移序列,故可通过联合转移的测度来定义路径的测度.命题1.路径的测度.给定初始分布v,集合Pathsn上的函数Prnv,D定义为Pr0v,D:Paths0→[0,1]:Π∑s∈ΠPrnv,D:Pathsn→[0,1]:Π∫Pathsn-1Prn-1v,D(dπ)∫ΩIΠ(πm)μD(π,dm),则Prnv,D为可测空间(Pathsn,Pathsn)(n∈)的概率测度[18],其中,πm表示从路径π的最后一个状态出发执行转移m而产生的路径,Ω=Act×0×S为所有联合转移的集合.命题1给出了绿色评价模型中有限路径的概率测度定义.根据已有标准方法[17],可将其扩充至无限情形,即获得无限路径集的概率测度Prωs,D.3刻画绿色评价指标的时态逻辑根据前面的相关叙述,绿色评价的目标并不在于仅获得所关注评价指标某个参数的具体值.本文将绿色评价指标统一描述为“在特定的时间、空间资源约束下,正确完成计算任务的可能性大小”.之所以将正确性作为绿色评价的前提,原因在于对不能正确完成计算任务的系统进行绿色评价是毫无意义的.形式上,上述描述也表明特定的行为路径集上,时间、空间资源耗费满足环境约束或主观限定的程度.为了能够对状态空间及行为动作空间统一进行推理,本文采用基于动作、状态的时态逻辑作为绿色评价指标的形式描述语言.显然,在动作及路径刻画方面,时态逻辑aCSL的缺陷是明显的,其路径算子仅仅约束执行的动作集,不能反映动作的执行顺序[12-13].本文采用与命题动态逻辑PDL(PropositionalDynamicLogic)类似的处理思想,用正则式规范动作执行的时序[13-14,16].同时,为了能刻画非时间指标约束,类似于CSL基于回报结构的扩展CSRL,在asCSL的基础上,为状态添加回报结构,并将新产生的逻辑命名为asCS-Page5RL.具体来说,路径由形如sa,→ts的转移所构成,该转移可描述为从满足测试条件Φ=L(s)的状态s出发,经过延迟时间t,执行动作b而转移到状态s.暂时忽略执行时间,转移便可由测试当前状态的状态公式Φ和执行动作b的有序对(Φ,b)表示,简记为Φb.将Φb看作转移“符号”,路径可由所有这些符号构成的符号表Σ=S×Act中的字(word)来表示.定义5.行为一致性约束范式.用正则式规范评价模型中执行路径的状态、动作序列及相互间时序关系,定义为其中,ε为不包含任何转移的空路径,即单个状态;Φb∈Σ;“;”、“∪”、“”分别表示顺序、选择、循环执行关系.行为一致性约束范式α规定了路径应该满足的性质,它用于限定评价模型中所有可能发生路径的集合中满足该性质的某个子集.由正则式与自动机理论可知,α对应某个非确定有限自动机[5].下面给出相关定义.定义6.行为一致性约束范式的等价自动机.路径范式α对应的非确定有限自动机为五元组Aα=(Z,Σ,δ,Z0,F).其中,Z为有限状态集;Σ为符号表;δ:Z×Σ→2Z为转移函数;Z0Z为初始状态集;FZ为接受状态集.假设自动机当前处于状态z,并且评价模型M中路径π=sa,→tπ的初始状态满足sΦ.如果存在从z出发的转移zΦ→bz并且b=a,则自动机将从z出发,不确定地选择满足上述条件的某个转移,并进入到对应的状态z,然后从状态z出发继续路径π的处理,如果b=√(√表示不改变状态的内部动作,也可用于表示路径的终止),则从状态z开始路径π的处理[16-19].如果没有满足上述条件的转移,则自动机将拒绝该路径.如果处理完路径的所有转移序列并进入到自动机的接受状态,则该路径被自动机接受.因此,将该自动机作为路径接受器,从而可获得M中满足α规范的路径集合.定义7.绿色评价指标的语法表示.用于刻画状态应该满足的性质,用Φ表示.定义如下:Φ∷=q|Φ|Φ∧Φ|p(αI)|p(αJ),其中,Φ表示状态公式;q∈AP为原子命题;p∈[0,1]表示概率值;∈{<,,>,}为算术比较算子,I、J为非负实区间;α为行为一致性约束范式,αI、αJ为路径公式.上述定义中的路径公式刻画执行路径应该满足的性质.其中,I0表示时间约束,J0表示空间资源约束.αI表示状态动作序列满足a并且执行时间落在区间I内的路径集合,类似地,αJ表示状态动作序列满足且累积空间消耗落在区间J内的路径集合.模型M中的路径与路径公式之间的满足关系由路径公式的可满足语义规定.记M为当前讨论模型,ζ为M中的无限路径,αI|αJ为路径公式,则路径ζ满足αI|αJ,记为:M,ζpαI或M,ζpαJ,当且仅当存在ζ的有限前缀σ,满足σ∈PathM(α),且σ的执行时间或累积空间资源消耗分别满足时间约束I或空间约束J.其中,集合PathM(α)表示模型M中被α对应的自动机所接受的路径集合,具体形式定义参考文献[19].定义8.绿色评价指标的可满足语义.用于刻画状态和状态公式之间的可满足关系.记M为当前考虑的绿色评价模型,s为M中状态,s满足状态公式Φ,记为M,ssΦ,定义如下:M,ssqiffq∈L(s);M,ssΦiffM,s/sΦ;M,ssΦ1∧Φ2iffM,ssΦ1且M,ssΦ2;M,ssp(αI)iffD∈THR.(Prωs,D{π∈Pathsω|M,πpaI}p);M,ssp(αJ)iffD∈THR.(Prωs,D{π∈Pathsω|M,πpaJ}p).其中Prωs,D表示从s出发无限路径集合在调度D下的概率测度,符号THR表示所有THR类型的调度集合.最后两个规则表明需对所有不同的具体调度进行遍历.在绿色评价过程中,上述可满足语义规则是判断绿色评价指标是否符合要求的重要依据,是运用形式化验证方法进行绿色评价的重要基础.基于本文目标,暂不过多讨论该方法具体过程,相关内容将在后续论文中展示.4绿色评价中的状态爆炸问题及互模拟等价规则在基于模型的分析或验证中,模型状态数可能呈指数增加而产生状态爆炸问题.本文的评价模型将时间空间统一融合,同时,评价指标也囊括行为正确性及时间空间资源约束,这将使得状态约简过程Page6呈现诸多困难,出现新的挑战.基于抽象技术的状态约简是解决状态爆炸问题的重要方法之一.根据状态划分方式,可分为对称、偏序约简(PartialOrderReduction)、互模拟约简等[15,20-21].互模拟等价关系最初用于比较两个系统的行为是否可以互相模拟[5,20].在基于模型的分析中,互模拟也被广泛用作状态约简的有效手段[21].如果具有相同分支结构状态转移系统的行为相似或可逐步(stepwise)相互模拟,则互为互模拟等价.行为相似的概念容易理解,即只需判断执行动作以及动作执行方式是否类同即可.绿色评价以行为正确为前提和基础,更注重行为完成的效果,如时间空间指标的定量分析等.因此,绿色评价中,迫切需要新的状态约简手段.如果互模拟等价规则能够保持原始模型中当前所关注验证性质,则能保证在等价的约简模型中进行分析或验证的正确性.因此,本文重点关注绿色评价模型中互模拟约简规则对asCSRL公式的逻辑保持性.显然,互模拟等价关系定义与模型和验证性质都密切相关.考虑基于动作、状态的asCSRL逻辑,两个状态相互模拟指的是它们不仅具有相同的状态标记,还应具有相同的随机逐步(stepwise)行为.标记传递系统中,状态的行为仅需关注其后继动作序列[5],而在绿色评价模型中,不仅要考虑后继动作,还需关注动作转移发生的转移率以及状态的资源消耗情况.扩展沿用已有相关定义[5,17-18],我们将给出绿色评价模型的互模拟等价关系定义.定义9.绿色评价模型的互模拟等价关系.记绿色评价模型为M=(S,Act,AP,R,L,v,ρ),如果存在等价关系S×S,使得对任意(s,s)∈,L(s)=L(s)并且ρ(s)=ρ(s),同时,对所有a∈Act和C∈S,R(s,a,C)=R(s,a,C)成立,则称为S上的互模拟等价关系.其中,S为由等价关系所划分的等价类的集合,R(s,a,C)=∑s∈C上述定义中首先保证了互模拟状态必须具有相同的命题标记.互模拟等价商S构成商模型的状态空间,该空间中的元素即等价类C∈S可看作商模型中的“聚集”状态,对应于原始模型中彼此互模拟等价的状态集合.记状态s所属的等价类为[s].显然,如果s与s互模拟等价,则它们属于同一个等价类,即[s]=[s].因此,上述定义中的第二个条件保证了商模型中某个“聚集”状态中的任意状态(如s、s等)到其它任何一个“聚集”状态C的转移率相同,定义10.互模拟商.令绿色评价模型为M=这样便可将s作为[s]的代表进行等价分析.需要注意的是,上述定义中要求互模拟等价的状态必须具有相同的空间资源要求率,即ρ(s)=ρ(s),而实际上具体系统的不同状态的空间资源要求率一般是不一样的.为了应对该问题,在建模过程中,可通过某些均匀化手段对状态空间进行划分,从而可保证大量状态的空间资源要求率相同或近似[8].限于篇幅,具体过程不再赘述.(S,Act,AP,R,L,v,ρ),则商模型可表示为其中珟S=S;对任意s∈S、a∈Act以及C∈珟S,珟R([s],a,C)=R(s,a,C);珟L([s])=L(s);珘v([s])=∑s∈[s]v(s);珓ρ([s])=ρ(s).上述定义沿用并扩展文献[17-18]中相关定义.由定义9可知,等价状态具有相同的状态标记.因此,商模型中元素[s]的状态标记对应原始模型中s的状态标记,即珟L([s])=L(s).互模拟等价的目的在于将相互等价的状态集用其中某个状态代表.为了保持刻画的等价性,商模型定义中,等价类的转移率、回报率分别等同于对应单个状态的转移率、回报率.另外,进入等价类的概率为等价类中所有状态在原始模型中的进入概率之和,即珘v([s])=∑s∈[s]v(s).下面讨论原始模型与商模型中路径之间的关系.命题2.互模拟等价路径[17].设有互模拟等价关系及(s1,s2)∈,对每一个从状态s1出发的路径π1=s1,0s1,1s1,2…(s1,0=s1),存在从状态s2出发的同长度的路径π2=s2,0s2,1s2,2…(s2,0=s2),使得二者具有相同第二下标索引的状态互模拟等价,即对于所有的j,(s1,j,s2,j)∈.互模拟等价在原始模型与商模型的路径间建立起等价关系,从而为等价判断提供依据.具体来说,原始模型中彼此互模拟等价的路径集合Π=[s0]×{a0}×{t0}×…×{an-1}×{tn-1}×[sn]被聚集成商模型中的一条路径既然Cartesian积Π的各个元素可测,它所表示的路径集合也可表示成可测矩形[18]Π=S0×A0×T0×…×An-1×Tn-1×Sn,其中,Si∈(珟S∪{})(i=0,1,…,n).因此,对应于商模型中的可测矩形为珟Π={S0}×A0×T0×…×An-1×Tn-1×{Sn}.Page75互模拟等价逻辑保持性证明及绿色评价过程5.1逻辑保持性证明定义互模拟等价关系的目的在于将原始模型中绿色指标的验证转化到与之等价的商模型中进行.原始绿色评价模型与商模型在行为刻画、时间空间资源描述以及分析方法等方面类似,因此同样需要讨论其不确定性调度.下面先给出商模型中调度的定义,然后讨论原始模型与商模型中调度之间的内在联系,从而为评价对象的转移提供理论支撑.在互模拟等价商模型中,路径对应原始模型中彼此互模拟等价的路径集合.因此,商模型中的调度应该与所有这些路径的调度有关.为了方便描述,先给出原始模型的路径在随机可测调度下某个不确定动作被选择的可能性.显然,该可能性与状态、转移以及各个不确定动作选择的概率有关.令M=(S,Act,AP,R,L,v,ρ)为绿色评价模型,v为初始分布,D为THR类型调度,长度为n的有限路径不确定动作被选择的可能性hwn可递归定义为hw0(v,D,s0)=v(s0);hwn+1(v,D,πan,t→nsn+1)=hwn(v,D,π)·D(π,{an})·P(π↓,an,sn+1).上述定义标明不确定动作选择的可能性为路径π的发生概率及在随机可测调度D下不确定动作选择概率的乘积.定义11.商模型调度[17-18].令商模型珮M中路径珘π=[s0]a0,t→0…an-1,tn→-1[sn]对应于原始模型M中的路径集合为Π=[s0]×{a0}×{t0}×…×{an-1}×{tn-1}×[sn],Π被称为简单互模拟封闭区域[17],则珮M的商调度定义为~(珘π,an)=∑π∈ΠDv通俗来说,上述商模型调度的定义表明,商模型中的某条路径从某状态出发,选择某个动作的概率,应该为该路径所对应的原始模型的路径集合中所有选择该动作可能性的期望.命题3.商调度的概率保持性.设D为THR类型调度,则原始模型中互模拟等价路径构成的可测矩形Π的概率等于商模型中在上述商模型调度下对应路径集合的概率,即命题3的详细证明过程参考文献[17].该命题表明,互模拟等价关系将原始模型中的彼此互模拟等价的若干行为(路径)集用商模型中对应“聚合”路径表示.同时,二者发生的概率相同,从而为原始模型与商模型行为刻画的等价性提供依据,进一步为在商模型中进行绿色评价指标验证的合理性提供理论支持.命题4.互模拟等价的逻辑保持性.令M为绿色评价模型,S为其状态集,状态s,s∈S互模拟等价,则s,s满足相同的asCSRL公式,即(1)Φ.(M,ssΦiffM,ssΦ);(2)aI.(D.(D.(Prω(3)aJ.(D.(D.(Prω证明.考虑结论(1)的证明,需对asCSRL状态公式采用结构化归纳法.对于归纳基,如果Φ=q,根据互模拟等价定义,由于L(s)=L(s),结论(1)显然成立.归纳步中,否定算子和合取算子∧显然成立.对于算子p(αI)、p(αJ),由其可满足语义可知,需证明从状态s出发的任何一个策略D,存在从s出发的对应策略D,且两策略保持路径集合的概率,即Prω转化为证明结论(2)、(3).结论(2)、(3)的证明类似,同时也是结论(1)成立的前提,暂考虑(2)的证明.由归纳假设,公式aI中出现的所有状态公式Φ1,Φ2,…,Φn(即符号(Φb)中的测试组件Φ)已经满足结论(1),则对任意互模拟等价状态(s,s),M,ssΦi与M,ssΦi如成立则同时成立(1in),即模型中满足状态公式Φi的所有状态可看作某些相互等价的状态所构成的集合.同时,这些公式的任意逻辑组合也满足该结论.注意,并不是集合Sat(Φ)中所有状态都是互模拟等价的,即它们可能分别来自不同的等价类.原因在于两个方面.首先,从Sat(Φ)的定义Sat(Φ)={s∈S|M,ssΦ}以及定义8中状态公式的可满足语义可以看出,集合Sat(Φ)中所有状态标记中都包含公式Φ,但不能因此说明集合Sat(Φ)中所有状态具有相同状态标记,即L(s)=L(s)可能不成立.其次,尽管L(s)=Page8L(s)可能成立,但是它们可能不满足互模拟等价的另外两个条件.因此,并不能说明二者是互模拟等价的.因此,集合Sat(Φ)可看作某些不相交集合的并,即Sat(Φ)=∪k集合中的所有状态都是互模拟等价的.根据行为一致性约束范式a的可满足语义,满足a的路径之间的对应状态一定属于S的某个等价类.因此,集合Π={π∈Pathsω|M,πpaI}可表示为由某些简单互模拟封闭的可测矩形中的路径中的集合构成的不相交并.即Π=∪简单封闭可测矩形Πi,由命题3可知,商调度保持概率测度,即Prωv,D(Πi)=Prω的可列可加性,可知Prωv,D(Π)=Prω因此,商调度即为存在的调度.结论(3)的证明类似上述过程,需要区别对待的地方在于结论(3)需要处理空间资源约束要求.由于累积空间资源消耗可类比于系统运行过程中时间的推进,借助于空间、时间对偶性质[22],可将其转化为时间资源约束进行处理.5.2基于模型检测的绿色评价方法根据设计时行为互模拟等价分析所产生的商模型以及设计改进依据(反例)的需要,提出基于模型检测技术的绿色评价过程.相比于传统评价方法,它融合了行为正确性判断这一重要前提,并能从定性形式验证的角度给出系统设计是否满足绿色评价指标的判断,过程如图2所示.首先,根据绿色评价目标、要求,明确绿色评价的标准、约束,主要体现为高效、低耗、高可靠性等方面,进而准确定义绿色评价指标.同时,明确对象、粒度,构建所关注系统的绿色评价模型,参数可根据历史或经验数据获得,整合数据可通过相应计算规则得到.其次,将绿色评价指标形式化描述为行为、时间、空间资源消耗的统一约束,建立评价指标的asCSRL时态逻辑公式.同时,根据互模拟约简规则,将原始评价模型转化为对应商模型,作为等价评价对象.第三,借助随机模型检测器PRISM[23]、MRMC(MarkovRewardModelChecker)[20]等的数值计算及验证功能,在商模型中判断评价指标asCSRL公式是否成立,如果不成立,将给出反例.由于本文的绿色评价过程融合了行为正确性判断,因此在验证前,首先还需进行行为正确性判断,具体过程参见文献[16,19].最后,如果不满足绿色评价指标,根据第三步验证结果中的反例,可修改绿色评价模型,再进行上述过程.此时,基于互模拟等价的行为判断结论可作为改进设计的重要依据.由上述过程可以看出,基于形式化验证的评价方法可以自动、完备地进行绿色评价.互模拟等价技术作为状态约简手段,可用于解决可能出现的状态爆炸问题或提高评价效率,同时还可作为行为等价但绿色指标不达标即空间、时间资源消耗不满足时改进设计的重要依据.6结束语绿色计算中,对计算系统进行绿色评价是一项基础性、关键性的工作.绿色评价的目标是判断当前所关注的计算系统在正常运行的过程中所产生的时间、空间资源消耗是否满足某种特定限制.采用能刻画概率、不确定性行为以及时间、空间资源要求的随机决策过程作为设计时分析模型.将包含行为规约以及时间、空间资源约束的统一绿色评价指标用时态逻辑asCSRL刻画.定义能保证行为相互模拟的互模拟等价关系并分析原始模型在互模拟等价语义下的行为机理.最后运用结构化归纳法证明互模拟等价能够保持绿色评价指标的逻辑正确性.结论表明,将互模拟等价关系用作绿色评价模型状态爆炸问题的解决方法是可行的,也可作为提高绿色评价效率的重要手段.Page9与已有工作相比,本文提出将形式化验证技术运用于绿色评价过程中,并从理论上证明了基于互模拟等价的状态空间约简方法的可行性.描述评价指标所采用的时态逻辑asCSRL不仅能够刻画行为以及时间和空间资源约束,同时由于正则路径范式的引入使其具有更加丰富的表达能力.下一步工作将进一步讨论基于本文采用的模型和时态逻辑公式,互模拟商空间的求解方法,为互模拟等价在绿色评价中的实际应用提供技术支撑.
