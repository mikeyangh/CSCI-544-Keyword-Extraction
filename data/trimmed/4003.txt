Page1高效视频编码沈燕飞1),2)李锦涛1)朱珍民1)张勇东1)1)(中国科学院计算技术研究所北京100190)2)(中国科学院大学北京100049)摘要近年来随着视频编码技术的发展以及高清视频需求的快速增长,国际运动图像专家组ISO-IEC/MPEG和国际电信联盟的视频编码专家组ITU-T/VCEG于2010年成立了视频编码联合工作组JCT-VC,开始针对高分辨率视频应用制定新一代视频编码标准,即高效视频编码HEVC(HighEfficiencyVideoCoding),2012年底形成了国际标准草案,并开发了相应的测试模型HM,进行性能评估和算法测试.该文将对标准制定过程中涉及到的关键技术进行详细介绍,主要包括:基于四叉树结构的编码块组织形式、先进的运动矢量预测和合并方法、多方向的帧内预测模式、基于DCT的分像素插值技术和内容自适应的算术编码技术等,最后对相关编码工具的编码效率、计算复杂度进行了分析,并且指出了未来的研究方向.关键词视频编码;高清视频;HEVC;H.264视频编码;视频通信1引言的不断提升,多媒体业务的支持需求日益增长,据调查显示,目前网络视频数据量占据了互联网90%的流量,即使在移动互联网中,视频数据也占了50%随着网络通信技术的不断发展和终端处理性能以上.另外,由于人们对视频质量的需求也在不断提Page2升,包括时间和空间分辨率的不断提升、从二维视频到立体视频的转换等,导致视频数据量的不断增长.因此对视频压缩编码技术的要求也越来越高,视频压缩编码技术也成为目前多媒体技术研究领域中最热门的技术之一.近20年来,国际电联通信标准化组ITU-T、国际标准化组织和国际电子委员会的移动图像专家组ISO/IECMPEG以及中国的音视频编解码工作组AVS都成功制定了一系列视频通信标准,包括H.261、H.263、H.264、MPEG-1、MPEG-2、MPEG-4和AVS等等.其中2003~2009年制定并不断完善的H.264/MPEGAVC视频编码标准,由于高效的压缩效率以及网络适应性等方面的明显优势,逐步成为视频应用领域的主流标准.但随着数字视频应用的快速发展,视频空间分辨率正在从标清(640×480,720×576)向高清(720P、1080P)全面升级,甚至在一些视频应用领域中出现了4K×2K、8K×4K的数字视频格式;视频时间分辨率,即帧率,也在由30帧/s向60帧/s转换;视频编码器芯片化的趋势也日益明显,并行化需求日益加剧;存储空间和网络带宽是视频应用中最为关键的资源等等.面对这些新的应用需求,传统的视频编解码技术出现了以下性能限制:(1)由于空间分辨率的增加,每个大小为16×16宏块所承载的信息量大大减少,而相邻块之间的低频系数相关性却大大增加,因此出现大量的块间冗余;另外,由于分辨率的增加,帧间编码宏块的运动矢量幅值也大大增加,其统计特征不再呈现集中化分布趋势,因此指数哥伦布编码或变长编码模式的编码效率将逐渐下降.(2)随着图像分辨率的增加,宏块个数也出现爆发式的增长,用于表示每个编码宏块的模型参数,包括预测模式、运动矢量、参考帧索引以及量化步长等辅助信息(SideInformation)等所占数据量过多,而用于编码预测残差变换系数的数据明显减少.(3)传统视频编码技术大都采用串行编解码模式,从左至右、从上至下逐个宏块进行处理,特别对于H.264/MPEGAVC中的熵编码技术,即基于上下文的CABAC和CAVLC技术,以及运动矢量预测技术和环路滤波技术,宏块之间数据耦合性大,难以满足并行处理的要求,而对于GPU/DSP/FPGA/ASIC等并行化程度非常高的处理器来说,这种串行化处理模式已经成为制约运算性能提高的瓶颈之一.(4)传统视频编码技术中,帧内/帧间预测块和预测残差变换块的大小相对固定,难以适应高清视频图像纹理特征的多样化分布特点,导致预测性能与预测残差系数编码效率均出现不同程度的下降.(5)由于处理器性能的不断提升和芯片设计规模的不断扩大,传统视频编解码的运算复杂度不再是视频应用的主要瓶颈,可以采用相对复杂的预测模式选择和率失真优化技术来提高压缩编码效率.为了适应以上技术发展趋势及需求变化,国际运动图像专家组ISO-IEC/MPEG和国际电信联盟的视频编码专家组ITU-T/VCEG于2010年成立了视频编码联合工作组JCT-VC[1-2],在全球范围内征集视频编码技术提案[3],在H.264/AVC[4]基础上开始制定新一代高效视频编码标准HEVC[5-6],核心目标是针对高分辨率视频图像,在H.264/AVC高级档次HP(HighProfile)基础上将压缩效率再提高一倍[7-8],即在保证相同重建视频图像质量的前提下,视频编码率减少50%以上.JCT-VC工作组共收到27个技术提案,并随后根据文献[1]中制定的测试方法做了技术评估和测试,遴选出最优的5个技术提案[9-15],然后形成了相应的测试模型TMuC(TestModelunderConsideration)[16],其中涉及到的共性关键技术在文献[10-11]进行了描述.根据测试结果,2010年10月形成了第1个测试模型HM1,随后对其中的关键技术进行反复评估与验证,并于2012年7月发布了公开国际标准草案.2013年1月份发布了最终国际标准草案,在H.264/AVC标准2~4倍的复杂度基础上,将压缩效率提升了1倍以上[17-18].本文首先对HEVC编码框架及其中的关键技术进行介绍,然后详细描述了其中的高级编码工具,最后对编码性能和计算复杂度进行了测试评估并指出了其中的研究热点.2HEVC编码框架HEVC仍然沿用了H.261就开始采用的基于运动补偿的混合编码框架[6],即帧间和帧内预测用于消除时间域和空间域的相关性;对预测残差进行离散余弦变换和量化以消除空间相关性;自适应熵编码消除统计冗余;环路滤波用于消除量化噪声,但HEVC在图像编码单元组织、内容自适应算术编码、多方向帧内预测、先进运动矢量预测和合并、分像素运动估计与补偿、自适应像素补偿和环路滤波等方面都做了很大的改进,HEVC编码框架如图1所示,图中阴影部分为编码和解码共用模块.Page3图1HEVC编码框架[6]HEVC的主要技术特征如下:(1)树形编码块结构在HEVC中,基本编码单元为编码树单元CTU(CodingTreeUnit),大小为16×16、32×32或者64×64,每个编码树单元由亮度编码树块与对应的色度编码树块组成[19-20].每个编码树块可以进一步分成编码块CB(CodingBlock),根据预测与变换的率失真性能,可以对编码块进一步的分成预测块PB(PredictionBlock)和变换块TB(TransformBlock).编码块、预测块和变换块的分离使视频编码更加灵活,各种不同的划分组合更能适应视频图像的纹理特征,有助于编码效率的提高.(2)四叉树残差变换块结构残差四叉树变换(ResidualQuad-treeTransform)属于一种自适应的变换技术,是对H.264/MPEG-AVC中自适应块变换ABT(AdaptiveBlock-sizeTransform)技术的延伸和扩展[21].它允许变换块的大小能够根据预测残差的特征进行自适应的选择,在残差能量集中、图像细节保留以及图像三者之间最优均衡.(3)像素自适应补偿技术像素自适应补偿ASO(AdaptiveSampleOffset)位于编解码环路内,通过对环路滤波后的重建图像进行分类,然后对每一类图像像素选择一种补偿方式,以减少源图像与重构图像之间的失真,补偿方式分为区间补偿和边缘补偿两类[22].(4)并行设计技术为了适应多核处理器的发展趋势,HEVC中引入了片层(Title)、条带(Slice)以及波形并行处理WPP(WavefrontParallelProcessing)的思想[6,18].其中片层方法与条带方法属于粗粒度的并行方法,片层方法将图像划分成非重叠的矩形区域,每个矩形区域独立的编码和解码;条带方法将图像分成多个条带分别编码和解码,每个条带可以进一步切分成可以独立编码和解码的熵条带(EntropySlice),然而条带方法更多地应用于抗误码设计与满足最大传输单元MTU(MaximumTransmissionUnit)的需求.波形并行处理方法属于细粒度的并行方法,类似于流水线设计思想,在完成上一行中第二个编码单元编解码时,即可开始下一行第一个编码单元的编解码处理.(5)自适应熵编码技术在HEVC中对所有的语法元素和预测残差变换系数都采用自适应算法编码技术CABAC进行熵编码.算法原理与H.264/AVC中的CABAC一致,主要由二值化、模型选择和算术编码3个部分组成,但是模型数减少了很多,H.264/AVC中有299个模型,而HEVC中只有154个模型,另外为了提高CABAC的数据吞吐率,模型之间的相关性也进行了大规模简化[23].除此之外,HEVC还针对特定应用和特定编码模式定义了一些编码工具,如应用于屏幕图像编码的无变换(TransformSkip)编码技术、应用于帧内Page4预测残差编码的离散正弦变换DST等等[6].HEVC编码性能的提升是所有编码工具共同作表1HEVC与H.264/AVC关键技术对比表编码单元大小分像素插值滤波器运动矢量预测方法亮度帧内预测色度帧内预测变换环路滤波针对不同的目标应用和码流兼容性测试,HEVC还定义了3个档次(Profile),即Main、Main10和Main静态图像档次,目前所有档次都只支持420格式的视频数据编码,除Main10支持10bit颜色深度的视频数据外,其它两种只支持8bit深度.根据编解码图像的分辨率以及编解码器的实际处理能力,HEVC还定义了13个应用级(Level),支持的图像分辨率从QCIF(176×144)到8K×4K,最大码流达到80Mbps.3HEVC中的高级编码工具3.1灵活的编码单元、预测单元和变换单元在以前的视频标准中[4,24-28],编码单元都是以16×16大小的宏块MB(Macroblock)作为最基本单图2编码单元、预测单元和变换单元用的结果,并非某单项技术所为.HEVC与H.264/AVC中的关键技术对比如表1所示.元,不同的编码标准中对宏块的划分模式略有差别,如MPEG-2中只能采用16×16或者8×8块进行帧间预测编码,而H.264中为了更好地适应不同边缘块形状,可以对宏块进行更加复杂的划分,如16×8,8×16,8×8,8×4,4×8和4×4等.但是由于视频应用的变化,高清视频越来越普及,研究表明使用更大的编码单元能够进一步提高高清视频的编码效率[29-32].因此,在HEVC中采用了更加灵活的编码单元组织形式,编码单元的大小从8×8到64×64,并且采用递归的编码树CTB(CodingTreeBlock)方式进行表示[31].例如,当编码单元大小为64×64和递归深度为4时,编码单元划分形式如图2(a)所示,组织形式如图2(d)所示.如果编码单元的大小为16×16,递归深度为2时,则编码单元的组织形式就与H.264一样.Page5每个编码单元的叶子节点可以划分成一个或多个预测单元,如图2(a)中的叶子节点h可以采用4种不同形状的预测单元进行帧间预测编码,如图2(b)所示,但帧内预测都是基于正方形块进行的.对预测残差的变换同样可以采用不同大小的块形状,划分模式如图2(c)所示.每个变换单元可以包含多个预测单元,但不能超过一个编码单元的大小,变换单元的大小从32×32到4×4,而一个预测单元也可以使用多个变换单元.3.2帧内预测帧内预测算法是充分利用图像的空间相关性,用周围重建像素值对当前编码块进行预测,提高编码效率.3.2.1亮度分量帧内预测在HEVC中共定义了34种帧内预测方向[33-35],预测方向角度由当前预测单元PU的最下面一行或最左边一列像素与上面参考像素行或者左边参考像素列之间的位移确定,如图3所示,预测角度分别为±[0,2,5,9,13,17,21,26,32]/32,这样能够更加精确地预测当前编码块的纹理特性.在使用参考像素对当前预测单元进行预测的过程中,首先需要根据预测方向和当前预测像素的坐标位置计算参考像素的位置,如果参考像素是整像素位置,则直接进行预测,否则要对参考像素进行插值处理,计算出分像素位置处的参考像素值.以8×8预测块和预测角度为“-32”为例,如图4所示.假设当前预测像素的坐标位置为P(x,y),预测角度为PredAng,则参考像素的位置坐标计算如下:Idx=(256×32×(P+1)/PredAng)8Ifact=(256×32×(P+1)/PredAng)%256其中,Idx和Ifact分别为参考像素的整像素和分像素坐标.为了减少除法运算,可以将256×32/PredAng做成表格[4096,1638,910,630,482,390,315,256]进行查表处理.由于不同位置的预测像素需要逐个判断使用水平参考像素还是垂直参考像素,为了减少计算复杂度,可以使用投影的方法,在图4中将垂直参考像素投影成水平方向,如图5所示.另外,对于图像中平滑区域的帧内预测,HEVC中使用平面预测模式(PlanarMode)来替代原先的DC预测模式,在相同客观质量的条件下,非常有助于图像主观质量的提高[36-37],预测过程如图6所示,首先右下角的像素Z由图中重建像素L和T平均得到,然后利用重建像素L和T与Z进行线性插值计算出最下面一行和最右边一列像素值,如图6中像素M和N,然后利用插值得到的像素进行双线性插值计算其它预测像素值,如图6中像素P.Page63.2.2色度分量帧内预测对于色差分量,所有的预测单元PU都可以使用对应亮度预测单元的预测模式,但是预测模式的排序和编码略有差别,除此之外,色差分量还可以用“基于颜色通道相关性”进行色差分量预测[38-40].因为在视频编码中,色差分量和亮度分量可能有相同的纹理信息,因此可以使用通道之间的相关性和线性模型,将对应预测单元的重建亮度分量像素值作为参考对色差分量进行预测,如图7所示.预测方式如式(3)所示:其中,PredC表示色差分量预测值,RecL表示对应块的重建亮度值,在420格式的YUV数据中,由于亮度分量的分辨率是色差分量的4倍,因此在使用这种模式进行色差帧内预测之前,首先对重建亮度块数据分别进行水平方向和垂直方向的下采样处理,如式(4)所示:RecL[x,y]=(RecL[2x,2y]+RecL[2x,2y+1])1参数α和β使用最小线性二乘法计算得到α=I×∑IRecC(i)×RecL(i)-∑II×∑Ii=0i=0这里RecC(i)和RecL(i)分别表示重建的色差分量和下采样的重建亮度分量,如图8中灰色位置处的像素所示.对于N×N的色差块,如果相邻的上边块和左边块都可用,则用于计算的像素总数I为2N,如果只有左边或者上面一个相邻块可用,则用于计算的像素总数I为N.3.3帧间预测在帧间预测方面,和传统的视频编码标准一样,HEVC采用的是基于运动补偿的预测编码技术,消除视频数据时间域冗余,但不同的是采用了基于DCT的分像素插值滤波器[41-42]和先进的运动矢量预测与合并技术[43-45].3.3.1基于DCT的分像素插值滤波器在运动补偿过程中,如果运算矢量指向整像素位置,则根据运动矢量和参考帧索引,直接进行运动补偿操作;如果运动矢量指向分像素位置,则需要进行分像素位置像素值的插值处理.在HEVC标准制定的过程中,提出了许多插值算法,包括自适应插值滤波器、高阶插值滤波器等[46],其中基于DCT的插值滤波器有更好的频率响应,并且响应形成的脉冲平稳,波纹较小,非常适合低通滤波器的图像分像素插值,其设计原理及插值系数的计算过程如下[47]:经典DCT前向变换与后向变换的定义如式(7)X(k)=2槡N∑N-1x(n)=2槡N∑N-1其中ck的定义如式(9)所示.和式(8)所示.将前向变换式(7)代入后向变换式(8)即可得到分像素插值滤波器系数求解的形式化公式(10)[48],α为分像素的坐标位置,N为滤波器的阶数,例如对于半像素位置的8阶滤波器,则α=1/2,N=8.x(i+α)=∑N-1在HEVC中,运动矢量是1/4像素精度,根据计算复杂度与性能的综合评估,半像素亮度分量插Page7值滤波器为8阶,1/4亮度分量插值滤波器为7阶,色差分量插值滤波器为4阶.假设p(a)表示分像素位置处的像素值,已知2M-1个整像素点的值,即i=0,1,…,2M-1,如图9所示,插值公式如式(11)所示.在插值过程中,对使用到的相邻分像素值由最近的已知整像素值替代.x(α)=∑Mm=-M+1cos(2α-1+2M)πk相应的滤波器的系数如式(12)fm(α)=1为了增强滤波器的平滑性能,需要对式(12)中的滤波器系数进行一次平滑操作[49],如式(13)所示.fm(α)=Mcosπm-α14(cos(2α-1+2M)πk根据上面等式,可以计算出任意阶数M和任意分像素位置a的插值滤波器系数fm(a).高效的插值运算都是无乘法运算,可以通过对系数做一些调整和整型化处理,这样插值波过程只需要加法和移位.在HEVC中插值滤波器采用的是非级联形式,即任意分像素位置的像素值可以直接用整像素值运算得到.在如图10所示的像素位置分布图中,A、B、C和D是整像素位置,水平位置分像素a、b和c使用水平方向插值滤波器,垂直位置分像素d、h和l使用垂直方向插值滤波器,对于图中其余位置分像素,先使用垂直方向插值进行块扩充,然后再进行水平方向插值,插值滤波器系数如表2所示,两个1/4像素位置的滤波器系数是反对称关系.表3中也列出了亮度各个分像素位置插值运算所需要的加法、乘法以及需要访问的像素次数,并且与H.264/AVC中的分像素插值运算做了对比.从表3中的数据可以看出,HEVC分像素插值滤波的计算复杂度明显大于H.264/AVC,主要原因是HEVC中插值滤波器的阶数大于H.264/AVC.当然在实际编码器设计的时候,乘法一般都是使用移位来实现的.分像素位置像素位置a776666b887665c776666d776666e495648111211f566355364236g495648111211h887665i566355364236j647263364235k566355364236l776666m495648111211n566355364236o495648111211平均333732161816由于亮度分量采用1/4像素精度的运动矢量,因此对应色差分量的运动矢量精度为1/8像素,同样也是采用基于DCT的插值滤波器,滤波器系数如表4所示.3.3.2先进运动矢量预测和合并技术在传统视频编码技术中,为了提高运动矢量的编码效率,编码端和解码端使用相同的预测模型对当前编码运动矢量进行预测,即使用空域中相邻的Page8左上块、左边块和右上块的运动矢量中值作为预测运动矢量,然后对运动矢量预测误差进行编码.也有一些使用基于竞争的算法在构建的运动矢量集中选择最优的运动矢量作为当前块的预测运动矢量[33],并且将运动矢量索引值发送到解码端,然而对于较大编码块来说,构建的预测运动矢量集较大,选择过于复杂并不利于优化编码.在先进运动矢量预测技术中[50-51],候选运动矢量集由来自左边、上边空域相邻块以及参考帧中对应位置的时域相邻块运动矢量构成,如图11所示,包括当前编码块上面相邻块B0,B1与B2,左边相临块A0与A1以及时域对应位置的相邻块C0与C1.如果时域相邻块C0的运动矢量不可用,则直接使用当前预测块对应位置的中间块C1的运动矢量作为候选运动矢量[45,52].候选运动矢量集中运动矢量个数最多为两个,如果候选运动矢量小于两个,则使用零运动矢量填充.如果有两个运动矢量值相同,则只采用一个作为候选运动矢量,这也称为消除冗余运动矢量技术.图11空域和时域预测运动矢量位置示意图在HEVC中,预测单元可以进行多次循环迭代划分,并以四叉树形式进行表示,有可能导致编码块过于细分,需要编码大量的辅助信息,从而导致编码效率的下降[53-54],因此需要对具有相同运动参数(运动矢量、参考帧索引和预测方向等)的块节点进行合并处理,从而减少运动参数的编码和传输.如图12所示,假设当前编码块为X,与上述先进运动矢量预测技术一样,首先利用空域与时域相邻块构建候选运动矢量列表,然后对具有相同运动参数的相邻块进行合并,共享相同的参考帧索引和运动矢量信息,从而减少传输的数据量,如图12(c)所示,所有M块的运动矢量信息都与S块相同.这种合并模式虽然在概念上与H.264/AVC中的Direct模式和Skip模式相似,但是Direct模式只是从相邻块中计算出当前块的运动矢量,不需要传输任何信息,而合并模式则是创建了一个具有相同运动信息参数区域,对每个编码块需要将选择的候选运动矢量索引及其参考图像列表信息传输给解码端,因此适应性更强,编码效率更高.3.4变换与量化在HEVC中,变换块的大小支持4×4到32×32,DCT变换矩阵近似正交矩阵[21,55],同时具备DCT变换的对称和反对称性质.变换过程中,所有中间值都限制在16位精度范围内,所使用的乘法操作也是16位,而对帧内预测残差,则采用模式自适应的DCT/DST[56-57].3.4.1DCT变换与量化为了有效实现DCT变换,2N点的DCT都会重用N点的DCT过程,也就是说,较小DCT的变换系数都是较大DCT变换系数的子集,如图13中的8×8和4×4DCT系数所示,4×4DCT系数是8×8DCT系数的子集,以此类推,8×8DCT系数是16×16DCT系数的子集,16×16DCT系数是32×32DCT系数的子集,而且在量化和反量化过程中,对于不同的变换基和不同大小的变换都使用统一的量化归一化参数进行量化.在硬件实现和芯片设计中,这些基本运算单元都可以进行有效复用.DCT变换过程由独立的水平变换和垂直变换两部分矩阵乘法组成,为了保证16位精度的实现,水平变换之后,需要对变换系数进行右移位处理,然后再进行垂直变换和量化.在使用矩阵乘法实现N×N点的DCT变换时,需要N3个乘法和N2×(N-1)次加法运算.由于DCT变换的对称性和反对称性,可以用蝶形运算来实现快速DCT变换.3.4.2DST变换与量化对于HEVC中的帧内预测算法,大致可以分为3类:来自单边参考像素的方向性预测、来自双边参Page9考像素的方向性预测和无方向性的DC或者Planar预测模式.在单边预测模式中,距离参考像素越远,预测误差越大,如图14所示,左边像素为参考像素,右边像素为预测像素,那么左边预测像素的预测准确性高于右边预测像素的预测精度,离散正弦变换DST能够很好地适应这种预测误差的统计特性,因此在对残差进行变换编码的过程中,根据使用的预测模式进行自适应的选择DCT/DST能够有效地提高编码效率[58].3.5熵编码在HEVC中,最初有两种熵编码方案,即应用于低复杂度配置方案中的LCEC编码(LowCom-plexityEntropyCoding)和高效配置方案中的内容自适应二进制算术编码CABAC(ContextAdaptiveBinaryArithmeticCoding)[59],后来考虑到编码效率和实现复杂度等原因,在最终的HEVC编码方案中,只保留了CABAC一种编码方案.CABAC算法原理与H.264/AVC中的编码方案类似,首先对需要编码的语法元素和量化系数进行二值化,然后选择合适的上下文模型进行概率估计,最后再进行二进制算术编码[23,60].但是H.264/AVC中CABAC的数据相关性及其处理速度是视频编解码设计中的瓶颈,特别对于解码器.具体表现在以下几个方面:(1)概率模型和算术编码中的范围划分都需要递归运算.(2)上下文概率模型选择与编码语法元素相关性太强,当前解码的语法元素概率模型由前面已解码的语法元素确定,不利于并行编码和解码.(3)对于二值化后的语法元素,上下文概率模型选择还与比特位置有关,不同比特位置二进制数值的概率模型需要切换.因此在HEVC标准制定过程中,保证编码效率不变的前提下仅可能降低数据之间的相关性并增加数据处理速度,包括:减少概率模型的数量,设计分组直接编码模式,降低概率模型的相关性,减少内存需求等等.在对预测残差变换系数编码方面,由于大变换块系数统计特性比较分散,难以使用统一的模型进行概率估计和编码,因此首先对变换系数块划分成子块.如图15所示,将一个8×8变换块分成4个4×4子块,首先对每个子块中数据是否全为零进行标注,如果不全为零,则进行对角、水平或者垂直方向的扫描,将二维数据转换成一维数据进行编码传输.这里需要注意的是,在每个方向扫描中,各行、各列或者各对角线数据都可以独立编码和解码.与传统ZIGZAG扫描方式相比,大大降低了编码系数之间的相关性,有利于进行并行熵编解码,提高数据处理速度.3.6环路滤波与自适应像素补偿在HEVC中,对重建图像进行级联去块斑滤波、像素自适应补偿和自适应环路滤波操作,以提高解码图像的主客观质量[61].其中去块斑滤波用于消除块效应[62],而像素自适应补偿和自适应环路滤波则用于消除量化噪声[63].3.6.1去块斑滤波类似于H.264/AVC中的去块斑滤波,以编码块为单位,对重建图像进行块边缘滤波处理,包括水平滤波和垂直滤波,但不同的是用于滤波的最小块为8×8,而不是H.264/AVC中的4×4块,有效消除了水平滤波和垂直滤波之间的相关性,对于高分辨率视频图像在不影响图像主观质量的前提下降低了计算复杂度.对于滤波权重的计算,如果相邻块有帧内编码块、有非零系数或者相邻块的运动矢量差大于一个整像素,都要进行去块斑滤波,除此之外,还要计算块边缘两侧像素值的差.如图16所示,计算方式如下:di=p2-2p1+p0+q2-2q1+q0(14)这里p0、p1、p2、q0、q1和q2是位于块边缘两边的像素,如图16(a)所示.和H.264/AVC不同的是,不需要每行都计算两侧像素值的差di,例如:对于8×8的块边缘,只要计算图16(b)中两行像素的di值,其余像素行滤波权重的计算都以这两行的di值为参考,这样大大降低了计算滤波权重的复杂度.Page10图16用于去块斑滤波权重计算的像素位置示意图根据计算得到的滤波权重,强滤波过程与H.264/AVC相似,而在弱滤波过程中,首先按照式(15)计算Δ值.Δ=(13×(q0-p0)+4×(q1-p1)-5(q2-p2))/32Δ值的范围截取至(-tc,tc),tc是与量化参数QP成正比的参数,量化参数越大,滤波强度越大.块边缘的滤波如下:3.6.2像素自适应补偿像素自适应补偿技术通过对编码单元CU的重建像素进行分类,并且对每类像素进行自适应的补偿以减少由于变换、量化和预测带来的块效应和振铃效应.HEVC中使用了两种类型的像素自适应补偿技术:边缘补偿和区间补偿.在边缘补偿中,首先对CU中的每个像素进行边缘分类,如图17所示,像素c是当前像素,相邻像素为a和b,像素c的边缘属性根据表5中的条件分为5种类型.在每个编码单元中,编码器选择一种类型的边缘进行自适应补偿并把选择的边缘类型作为辅助信息传给解码端,补偿的边缘类型和具体的补偿值由编码器率失真优化算法确定.这里需要注意的是:在边缘补偿中,HEVC只允许平滑操作,因此补偿值的符号由算法隐式确定;另外,亮度分量和色差分量的像素自适应补偿是互相独立的.在区间补偿中,将每个编码单元中的像素等分成32个区间(即量化步长为8),编码器根据率失真优化算法选择连续5个区间进行自适应补偿操作,补偿区间的起始位置及每个区间的补偿值作为辅助信息传给解码端,通过区间补偿可以有效地消除由于运动估计或量化算法导致的相移问题.每个编码单元只能选择一种边缘补偿或者区间补偿操作,相关辅助信息也可由左边或者上边编码单元预测得到.边缘类型123403.6.3自适应环路滤波自适应环路滤波是利用维纳滤波技术对去块斑滤波后的重建图像进行处理,提高解码图像的主客观质量.对于亮度分量,编码器在Slice层决定是否进行自适应的环路滤波,使用的滤波器为2维钻石滤波器,滤波器的大小分别为5×5,7×7和9×9,如图18所示.滤波像素根据其与周围像素的方差选择合适的滤波器进行滤波处理.对于色差分量,只使用5×5大小的滤波器进行滤波操作,但是滤波系数、滤波性能以及如何进行滤波仍然是编码优化的问题.具体的滤波过程包括计算每个像素与周围像素的方差,然后对像素周围{-3,3}范围内的方差进行统计分析,进行滤波器索引值的计算,根据滤波器索引值,使用相应的滤波器系数和滤波器模板对重建像素进行自适应环路滤波.4HEVC计算复杂度分析虽然HEVC编码技术框架仍然沿用基于空域和时域预测的混合编码框架,但是与传统的视频编码算法相比(例如H.264/AVC),采用了很多新的编码工具来提高编码效率,包括更加灵活的块划分模式、35种帧内预测模式、基于DCT的分像素插值Page11滤波器、先进的运动矢量预测算法与运动合并模式、像素自适应补偿滤波器与环路滤波器等等.这些新的编码工具在提高压缩效率的同时,也增加了编解码器的计算复杂度,尤其对于编码器的设计,在进行率失真优化过程中,有更多的编码选项需要进行组合优化.在保证压缩效率的同时,JCT-VC在制定HEVC标准过程中,也尽可能降低各个编码工具带来的计算复杂度的增加[18].在环路滤波方面,最小滤波块为8×8,不仅大大减少了滤波像素的数量,而且将水平滤波和垂直滤波进行了分离,更加有利于并行化操作;在变换和量化方面,不仅数据位宽限制在16位范围内,而且通过对变换系数的设计,减少了运算复杂度,完成8×8、16×16和32×32块反变换分别需要158、861和4696个指令周期[64];在熵编码方面,仅仅只使用CABAC方法,用于编码语法元素和残差系数的模型也大大减少,H.264/AVC中的模型数为299个,而HEVC仅仅有154个模型.在标准设计方面,为了适应多核CPU技术和多线程编码技术的发展,在高层语法方面,HEVC还提供了并行编解码机制,主要包括条带并行、片层并行和波形并行3种方式,如图19所示.在条带并行方法中,每个条带可以独立编码和解码,条带之间的分割按照顺序扫描方式进行,条带边缘的环路滤波由高层语法控制,这种条带划分方式对误码有较强的鲁棒性;在片层并行方法中,编码图像被分割成大小相同的图像片,每个图像片同样可以进行单独的编码和解码;在波形并行方法中,每个线程负责一行编码单元的编码或者解码,但是下一行编码单元的处理必须延迟前一行两个编码单元,在每行编码单元开始时,必须对CABAC进行重新初始化,其它与正常编码完全一样,这种波形并行方法对压缩效率损失最少.为了进行HEVC的计算复杂度分析,使用文献[65]中的通用测试条件对JCT-VC的HEVC参考实现软件HM6.0进行测试,硬件平台为P9700(双核2.4GHz主频),使用下述3种典型配置对B类和C类(见表6)视频测试序列进行编码,包括帧内编码模式(AI)、随机访问模式(RA)以及低延时模式(LB),量化参数设置为22和37,分别对应于高带宽和低带宽码流.实际编码时间见表7,尽管HM只是用于HEVC的功能验证,不是用于做编码性能测试,但是在一定程度上也反应了其计算复杂度,其中率失真优化、分像素插值、变换与量化占了70%以上的计算复杂度.根据目前的评估,HEVC的编码复杂度至少是H.264/AVC的4~8倍,因此如何在保证压缩效率的前提下降低编码计算复杂度是今后一段时间的研究热点.类别BC序列KimonoParkSceneCactusBasketballDriveBasketballDrillBQMallPartyScene在实际应用中,尤其对于数字电视、流媒体等一些非实时视频应用,更加关注的是视频解码的计算复杂度.目前HM参考软件中解码器的计算复杂度Page12与H.264/AVC的参考软件JM基本相当.在文献[65-66]中,基于ARM平台和X86平台,对优化后的解码器计算复杂度进行了详细分析,在ARM(1GHzCortexA9)平台上,实时解码C类视频码流(2Mbps,30帧/s)的各模块平均计算复杂度如图20.从图20中可以看出,解码器中各模块计算复杂度的分布与H.264/AVC解码器基本相当.5HEVC编码性能分析为了验证HEVC的编码性能,视频编码联合工作组JCT-VC在文献[48]中定义了通用测试条件、测试场景和相应的编码器配置文件信息,率失真性能差的计算采用Bjntegaard测量方法[67],综合峰值信噪比PSNR值由亮度分量与色差分量的PSNR值加权得到,在文献[17]中,对HEVC中各个编码工具对编码性能的提升做了详细的测试和分析.根据测试结果可知,采用大尺寸的编码单元CU以及自适应预测单元PU和变换单元TU对性能的提升最大,特别对于高分辨率视频序列效果最明显,最好情况可以提高压缩效率39.2%.由于H.264/AVC是目前压缩性能最好、应用最广的视频编码标准,因此在与传统视频编码标准做性能对比的过程中,仅使用H.264/AVC高级档次(HighProfile)编码作为比较对象,参考实现软件版本为JM18.30[68],HEVC的测试版本为HM8.0[69],测试序列采用通用测试条件中规定的A类至F类,HEVC编码模式采用全帧内编码模式(AI)、随机访问模式(RA)以及低延时模式(LB)3种,控制图像质量的量化参数分别设置为22,27,32和37,3种模式的测试结果如表8~表10所示.从表中的数据可知,在LB编码模式下,HEVC获得的编码性能提高最大,达到35.1%,另外,对于高分辨率视频序列压缩性能的提升大于低分辨率视频序列,如表中A类与C类性能的提升一般都大于其它类.另外,实验数据还表明在低码率下HEVC性能的提升大于高码率.表8AI编码模式下HEVC与H.264/AVC的编码性能对比测试序列Y/%U/%V/%YUV/%A类-23.7-21.6-20.4-23.4B类-22.8-22.5-22.1-22.8C类-19.9-21.1-21.3-20.3D类-16.7-16.9-17.6-16.9E类-29.1-27.4-27.1-28.8F类-22.8-19.5-20.1-22.7平均值-22.2-21.3-21.2-22.2表9RA编码模式下HEVC与H.264/AVC的编码性能对比测试序列Y/%U/%V/%YUV/%A类-36.7-37.8-39.4-36.9B类-39.7-38.0-37.2-39.5C类-30.0-32.2-32.2-30.4D类-27.2-31.5-33.2-28.2F类-25.6-25.7-27.0-26.0平均值-32.2-33.3-34.0-32.5表10LB编码模式下HEVC与H.264/AVC的编码性能对比测试序列Y/%U/%V/%YUV/%B类-42.1-34.7-35.3-41.1C类-32.3-32.3-32.9-32.5D类-29.1-31.5-33.2-29.7E类-43.7-39.5-38.2-42.9F类-28.8-30.5-33.2-29.9平均值-35.1-33.5-34.4-35.16未来研究方向HEVC是联合视频专家组JCT-VC为解决高清及超高清视频数据的存储、传输而制定的具有更高压缩效率的新一代视频编码标准.尽管仍然基于传统的混合视频编码框架,但对该框架中每个模块都进行了技术创新,包括灵活的块划分模式、基于竞争的运动视频预测、基于DCT的分像素插值滤波器、高效的自适应算术编码以及波形并行处理技术等等.这些新技术使得HEVC编码效率比H.264/AVC提高了一倍.但是这些编码选项的灵活组合使得HEVC的编码复杂度急剧增加,阻碍了HEVC标准的快速推广和应用.因此研究快速、高效的编码率失真优化算法、码率控制算法、主观质量优化算法应该是未来一段时期的研究热点.基于对HEVC参考模型HM[69]的测试分析可知,灵活的块划分模型,包括CU、PU和TU,对视频编码的率失真性能提高最为明显,但其带来的计算复杂度也最大,因此HEVC编码器如何根据相邻块上下文属性以及当前编码块的纹理特征进行快速的CU、PU和TU划分,具有非常重要的研究价值.Shen和Alvarez-Mesa等人在文献[70-71]中提出了Page13基于贝叶斯分类和支持向量基分类的编码单元CU、变换单元TU以及预测单元PU的快速选择算法,在保证率失真性能的前提下大大提高了编码速度.当然还可以通过相邻单元之间的相关性、不同块层次之间的相关性来进一步降低计算复杂度.为了适应多核处理器的发展趋势,HEVC中引入了片层、条带以及波形并行处理WPP的思想,然而目前已有的并行视频编码方法粒度较粗,并行度不高,负载不均衡,无法充分挖掘多核处理器的计算能力,影响编码效率.因此研究适用于多核处理器的高并行度视频编码方法,为视频编码发展提供持续的计算能力保证,具有重要意义[72-74].目前这方面的研究刚刚起步,研究点主要包括并行运动估计算法、并行帧内预测算法和并行熵编码算法等等.在视频编码算法方面,尽管HEVC于2013年1月已经正式发布,但是随着应用需求的不断变化,HEVC还在不断扩展,主要研究包括:(1)三维视频、立体视频和多视角视频的编码技术[75-76],不仅对视频数据进行压缩,还要对深度信息进行编码;(2)分层HEVC编码技术[77-78],用于提高HEVC对网络的自适应能力,目前主要包括空域和质量域可分层视频编码;(3)将人类对视频图像的认知模型融入到视频编码算法中,对视频图像中感兴趣的区域分配较多的码率以提高视频图像的主观质量,具体包括感兴趣区域的检测技术和动态码率分配技术等;(4)优化视频图像的主客观质量评价方法,即视频编码中率失真优化目标,目前主要以峰值信噪比以及结构相似性指标作为评价标准,难以精确模拟人类视觉系统的功能,还有待于进一步提高和改进.7HEVC的应用前景HEVC标准是在H.264标准的基础上发展起来的,结合H.264在视频应用领域的主流地位可以预见HEVC标准在未来广大的发展前景.尽管HEVC的计算复杂度非常高,但是随着多核处理器性能的提高以及芯片处理能力越来越强,算法复杂性对应用的影响越来越小.相反,在实时通信应用以及IPTV应用中,业务的不断扩展和需求的增加使得有限的带宽资源逐渐成为瓶颈,高压缩率的视频编码是解决这一难题的有效技术手段,这也为HEVC在IP流媒体服务领域的应用奠定了坚实的基础.另外,由于视频编码软件开发周期短,平台灵活,因此基于HEVC的网络视频应用不久将大规模出现.8结束语HEVC是由视频编码联合工作组JCT-VC主导制定的新一代视频编码标准,尽管仍然采用的是混合视频编码框架,但是集成了很多先进的视频编码工具,包括35种预测模式的帧内预测、树形块编码组织形式、先进的运动矢量预测和运动合并算法、分像素插值算法以及去块斑滤波、像素自适应补偿、环路滤波等等,大大提高了视频压缩效率,使得HEVC比H.264/AVC标准的压缩性能更加高效.与H.264/AVC相比,在客观性能上,即重建图像的质量在相同的平均PSNR下,HEVC的编码码率可以节省40%;在主观性能上,即重建图像在相同的主观质量下,HEVC的编码码率可以节省50%以上,这都说明了HEVC标准的优越.但需要指出的是,HEVC的高效是以巨大的计算复杂度为代价的.从前面的分析可以看出,HEVC标准中的新技术,给编码器优化留下了更多的编码参数和优化空间.只有合理有效地选择编码参数,才能使HEVC标准发挥其高效的压缩性能.针对HEVC的研究,特别是优化算法的研究,随着标准的形成已经越来越受到学术界和工业界的重视.如何合理有效地发挥HEVC的压缩效率,是HEVC能否在工业界成功应用的至关重要的问题,也是学术界研究的热点问题.HEVC的编码优化算法,主要集中在以下几个方面:HEVC的码率控制算法、HEVC低复杂度编码优化算法、HEVC的主观质量优化算法.致谢在本文撰写和修改过程中,审稿专家和编辑老师提出了许多宝贵意见和建议,在此表示衷心感谢!
