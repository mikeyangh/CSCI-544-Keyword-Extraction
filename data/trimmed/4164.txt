Page1多源混合变形传递研究彭博张辉鑫郝志伟王健马锐伍铁如(吉林大学数学学院长春130012)摘要变形传递是将已有模型上的变形传递到目标模型上,使目标模型能呈现出与源模型相似的变形效果.该文在Sumner等人提出的基于三角网格上的变形传递的基础上,实现了将源网格多种不同的变形传递到同一目标网格上的混合变形传递.在这个过程中提出了两种方法,一是直接将源网格多个部分不同的动作混合传递到目标网格,另一种是先将源网格进行动作融合,再将混合动作传递给目标网格.本文采用在分块时使各部分在边界处具有重叠的三角形和在能量方程中增加边界处的光滑项两种方法,最后得到了光滑的混合变形传递结果.关键词多源;混合变形;动画合成;对应关系1引言三维模型的创建一直是计算机图形学领域研究的热门问题,从现实物体得到三维模型通常需要经过扫描数据、点云配准、曲面重构等一系列数字几何处理的过程.动画变形技术可以将已有的三维模型Page2时间和精力,使得大多数动画制作仅能由经验丰富的人员来完成.变形传递(deformationtransfer)是将已有模型的变形通过优化的方法传递到目标模型上,进而得到新的目标模型,实现对已有变形的重用,是生成新的三维模型的一种重要方法.本文在已有的变形传递的工作基础上提出了两种混合变形传递的方法,实现了将多个源模型不同的变形效果传递到同一个目标模型上,取得了较好的实验效果.本文算法所生成的具有多种混合动作的新模型可以极大地丰富原有三维模型的数据集,可供用户直接使用或进一步激发用户的创作灵感,创作出更多样化的三维模型.2相关工作变形传递是将源模型的变形过程传递到目标模型上,其思想来源于Noh等人在文献[1]中提到的表情克隆,即将一个面部网格上的表情传递到另外一个面部网格上.在这个过程中,每个表情对应着网格上所有顶点的一组偏移量.表情克隆尤其适用于面部表情的传递.Sumner等人在文献[2]中首次提出变形传递的概念,并对三角网格模型实现了变形传递,其方法是后续变形传递工作的基础,现将其简单介绍一下.(1)求解中间网格已知源网格与目标网格,中间网格是指与源网格具有相同拓扑结构且和目标网格具有相似几何外形的网格.用户通过选取标记点作为变形的约束点,并通过构造求解优化问题最终得到中间网格.标记点是分别在源网格和目标网格上选取的一系列点对,每一组点对表示源网格上的点经过变形应该变到的位置.(2)建立对应关系得到与中间网格具有相似几何外形的中间网格之后,通过比较中间网格和目标网格中每个三角形的重心,建立中间网格和目标网格的对应关系,进而可以得到源网格与目标网格之间的对应关系:M={(s1,t1),(s2,t2),…,(s|M|,t|M|)},其中点对(si,ti)表示目标网格的第ti号三角形应该同源网格中第si号三角形一样进行变形。(3)求解变形之后的目标网格在得到源网格与目标网格的对应关系之后,根据作用源网格上的变形梯度构建如下的优化方程求出目标网格的变形梯度,进而得到变形后的目标网格:其中,S和T表示作用在源网格和目标网格上的变形梯度,|M|为集合M的元素个数(即对应关系的数目),矩阵范数‖·‖F是Frobenius范数。不同于文献[2]中基于网格表面的方法,Ben-Chen等人[3]提出了基于空间的变形传递,根据源网格和目标网格相应的Cage生成调和函数的基底,则源网格的变形可以由相应基底的线性组合表示出来,进而将每个变形表示为对应于所有基函数的一组系数,并通过优化的方法求解出目标网格的变形函数,最后得到目标网格的变形结果.该方法能够处理多种形式的源网格和目标网格,如三角网格、多边形等,同时能处理具有多个组成部分的模型,但是其对于人脸等比较扁平的网格效果不佳,这是由于Cage不能很好地描述此类模型.Zhou等人[4]对于具有多个组成部分的目标模型提出了一种简单有效的变形传递方法,克服了文献[3]中Cage的生成比较复杂的问题.该方法通过计算一系列临近点组建立了表示目标网格不同组成部分之间空间关系的图,之后的求解对应关系和变形传递过程均在考虑图的连接关系的条件下进行.此外,他们还在变形传递的能量方程中添加了两个非线性的约束项,用于保持变形传递过程中不同部分之间的空间关系和局部的变形细节.该方法对于具有多个组成部分的目标模型取得了较好的效果,但是所构造的能量方程为非线性方程,需要进行迭代求解,还不能处理源模型中不同部分的相对距离在变形中发生改变的情形.对于源模型为非网格表示的情形,谭光华等人[5]针对点云曲面的特点,定义点云曲面的顶点变形梯度来编码源点云的变形信息,通过全局能量优化产生变形传递的结果.其中点云顶点的变形梯度由其k邻近点决定,此方法不需要源模型具有网格的连接关系,具有一定的通用性.以上的变形传递方法均主要考虑了将源模型的一个变形动作传递到目标模型上,Chen等人[6]将目标网格嵌入到Cage中并用Green坐标插值来表示目标模型,再通过求解能量方程求出Cage的变形梯度,进而得到变形后的目标网格.同时,他们还将不同源模型的变形梯度传递到同一个目标网格的Cage上,进而实现了目标网格的混合变形传递.该方法能够处理源模型和目标模型均为多种表示方式的情形,同时由于Green坐标具有保持几何细节的Page3特性,目标网格的变形结果能够保持原来的细节,但是由于Green坐标的非线性性,此方法同样需要求解非线性优化问题,并且同样不能避免Cage生成较为复杂的问题.Wang等人[7]提出了基于样例的动画合成方法,根据模型中要变形的区域定义了整个模型每个三角面的混合变形权重(deformationblendingweight),然后按这个权重将这部分的变形梯度和单位矩阵进行插值,得到可以变形的该部分而保持其余部分的变形梯度,对于其它希望变形的部分可以采用类似的方法,并将得到的变形梯度相乘,最后实现光滑的动画合成,得到了一个目标模型兼具多个源模型动作的较好结果.同时,文献[7]采取了一种不同于文献[2]中求取中间网格和对应关系的方法,减少了用户在选取标记点时的工作量.以上为基于变形传递的三维模型创建方法.近年来,在基于样例和数据集的三维模型创建领域,根据多个源模型生成具有混合信息的新模型成为了一个热门的研究问题.Funkhouser等人[8]提出了基于样例和数据集的三维建模,新的三维模型由多个源模型的不同部分替换和组合而成.Chaudhuri等人[9]提出了基于概率推理来组合多个模型的不同部分,进而创建新的三维模型的方法.Jain等人[10]将源模型和目标模型分割成了具有层次性的不同部分,新的三维模型通过在每一层次随机选取和替换源模型和目标模型的不同部分而组合生成.Xu等人[11]选取输入数据集中三维模型的不同部分,通过基于控制盒的变形方法,迭代地生成具有多种混合形状的新模型.本文在文献[2]的基础上,提出了一种新的混合变形传递方法,实现了将多个源模型不同部分的变形传递到同一个目标模型上,得到了具有新的混合动作的目标模型.与文献[6]中的将混合变形传递到多源混合变形传递将多个源模型的不同变形传递到同一个目标模型的不同区域上,进而得到具有图1多源混合变形传递示意Cage上,再得到混合变形后的目标网格模型不同,我们直接通过构建优化方程将混合变形传递到目标模型上.与文献[7]中在每一部分的变形传递时,都需要重新计算整个模型的混合变形权重不同,我们对于同一个目标模型,只需计算一次优化方程即可得到整个模型不同部分的变形梯度,实现过程较简单,且在不同部分的边界也取得了较光滑的变形效果.同时,我们还提出了将混合变形传递到源模型本身,得到新的具有混合动作的源模型,进而采用变形传递得到具有混合动作的目标模型的方法.本文旨在生成具有混合动作的新模型,所生成的结果可以扩充三维模型的数据集.3多源混合变形传递变形传递技术比较成功地解决了模型动作整体的重用问题,使得为新模型创建一组已在其它模型上完成了的“旧动作”变得更加快捷,但是创建出有别于已有动作的“全新的”动作依然是费时费力的过程.实际上我们往往需要像复制粘贴文本段落一样以旧模型为素材创建新的模型,例如将一个人偶模型的某个上半身的动作和另一个下半身的动作融合在一起,对已有动作的组合重用是减少人工劳动的另一个重要途径.为此我们提出多源混合形变传递作为解决这一问题的有效方法.多源混合形变传递是在经典的三角网格的变形传递算法上发展出的简单分支,该方法可以将多个源模型的不同变形传递到同一个目标模型的不同区域上,进而得到具有混合动作的目标模型.多源混合形变传递可以将已有的变形效果进行混合,极大地扩展了变形传递的灵活性.如果手头有足够的“素材”,创建新动作甚至可以简单地通过这种类似“复制粘贴”的方式完成.混合动作的目标模型.混合变形传递可以将已有的变形效果进行混合,扩展了变形传递的灵活性.混合Page4变形传递中的主要问题是不同分块边界处的光滑性问题,为此我们采用了在边界处选取部分重叠的三角网格和在变形传递能量方程中添加光滑约束项的方法,使分块边界处在变形传递后不会出现较大扭曲.在此基础上,我们对于三角网格模型提出了两种新的混合变形传递方法.由于在本文的方法中,将多源的变形混合传递到目标模型和将两个源模型的变形混合传递在本质上是一样的,只是选取源模型的个数和变形传递的区域不同,为简单起见,我们在下面主要介绍两个源模型混合变形传递的方法,该方法可以自然地扩展到多源的混合变形传递,在第4小节中我们展示了多源混合变形传递的结果.3.1多源变形直接混合传递3.1.1求解中间网格并建立对应关系由于源网格和目标网格一般具有一定的几何形状差异,不能直接建立对应关系,我们采用文献[2]中提供的方法,把源网格变形成和目标网格具有相似几何外形的中间网格.假设源网格为S,目标网格为T,中间网格为M,构建如下的能量方程:minE(v1,…,vn,c1,…,cn)=wSES+wIEI+wCEC,其中,ES(v1,…,vn)=∑TEC(v1,…,vn,c1,…,cn)=∑nTi为三角形i的变形梯度,adj(i)表示与三角形i相邻的三角形的集合,vi为待求的中间网格的顶点,ci为目标网格上对应vi的有效最近点,{mK}为人工标记点,是源网格和目标网格上一一对应的约束点组.式(2)中,总能量E由3部分组成:ES是光滑能量项,使得在将源网格变成中间网格时,作用在源网格相邻的三角网格上的变形矩阵相似,这样能使得变形光滑.EI是单位能量项,保证在变形过程当中,作用在源网格上的所有变形矩阵应接近单位矩阵,从而避免出现剧烈的变形.EC是有效最近点能量项,表示源模型上的点经过变形后应该接近目标网格上与之相对应的有效最近点,即对第k步迭代后得到的中间网格中的每个点后,寻找目标网格中与其距离最近并保证点法向夹角为锐角的点,并用它来更新ci.wS、wI、wC是人为给定的权重.第1步迭代时令wC为0得到中间网格的草图,在后续迭代的过程中不断增加wC以增加中间网格的细节,在实际计算中会得到比较理想的结果.通过最小化能量来求解中间网格的过程,实际上是将源网格上的标记点变形到目标网格上标记点的位置,其余的顶点按照满足光滑变形的条件进行变形的过程.以此得到的中间网格具有和源网格一致的拓扑关系以及和目标网格相似的几何外形.求解出中间网格M后,可以进一步建立S与T之间的对应关系.为使这个过程更加高效和合理,我们根据模型包围盒的面积以及三角形的个数定义了一个合理的阈值,以T中三角形为迭代器,寻找M中与之重心的距离最小且在阈值范围内的三角形,再对应到S中相应三角形,由此得到T与S的对应关系.3.1.2不同部分的混合变形传递(1)将模型分解并进行混合变形传递由于在3.1.1节中得到的对应关系是由网格S和T本身的几何特性所唯一决定的,在进行混合传递的过程中这种对应关系保持不变.我们将目标网格T划分为两个部分,记为T=(T1,T2),源网格S经过两次不同变形后的网格为1S、2S,源网格S与目标网格两部分T1、T2的对应关系分别记为M1、M2,则这两个子对应关系是包含在S与T的对应关系中的.通过求解下述优化问题可以得到作用在网格T上的每个仿射变换,进而得到T变形之后的网格:min∑M1其中,犛(1)、犛(2)分别表示S经过变形成为1S、2S的变形矩阵,犜(1)、犜(2)分别表示作用在目标网格T1、T2上的变形矩阵,(si,ti)为S和T的对应关系.(2)优化网格分解使混合变形更光滑在实验中可以看出,如果直接将目标网格按照源模型两个部分的变形进行混合传递,分界处的变形结果将不够光滑.混合变形传递中T1、T2的变形具有独立性,二者进行不同的变形后的结果单纯地拼在一起必然会导致边界处的不光滑.我们首先在网格的划分中做一个改进,由用户手动选取珦T1、珦T2,使得珦T1T1,珦T2T2,且珦T1∩珦T2≠,即划分的两部分网格在中间的边界处有一部分重叠的三角形.此时上一步中的优化方程变成如下形式:min∑珮M1其中,珮M1、珮M2分别表示源网格S与珦T1、珦T2中三角形对应关系的索引,珟犜(1)、珟犜(2)分别表示作用在目标网Page5(3)在能量方程中添加光滑项针对(1)中出现的边界处变形差异较大导致结果不光滑的问题,我们在能量方程中添加光滑项,限制在边界周围的点的变形要一定程度地依赖它周围点的变形,即在边界周围的三角形的变形梯度应当尽量接近.设Madj表示目标网格分割处三角形个数.adj(i)表示与三角形i相邻并且位于分割处三角形的索引集合,则定义光滑能量如下:i=1于是我们得到如下优化问题,其中ws表示边界光滑变形的权重:min∑珮M1通过求解上述的能量方程可以得到目标网格的变形梯度,将其作用到目标网格上即可以得到具有混合动作的目标网格.3.2先进行动作融合,再进行变形传递我们还提出了另外一种可以实现目标网格具有混合动作的方法,即先将源网格的动作混合,然后将具有混合动作的源网格直接进行变形传递到目标网格上.注意到在3.1节中,若我们把目标网格替换为源网格,则可以实现源网格的动作混合.类似3.1节,我们将源网格S分成两部分S=(Sa,Sb),Sa与Sb在边界处有重叠的三角形.由于S的所有三角网格与变形后的1S、2S具有一一对应关系,式(6)中的对应关系均可以改为(si,si).记N1、N2分别为Sa、Sb所包含的三角形索引集合,犛(1)、犛(2)分别为从Sa、Sb到1S、2S对应部分的变形矩阵.问题转化为求解下述优化方程:min∑N1其中犜(1)、犜(2)分别为待求的作用在Sa、Sb上的变形矩阵.通过求解优化方程,我们可以得到S在动作融合后的结果S.利用文献[2]中提出的变形传递方法,即可将S到S的变形梯度传递至目标网格上,得到具有混合动作的目标模型.实现过程如图2,图2(a)和图2(b)是猫的两个变形动作,图2(c)是i=1进行动作融合的结果,图2(e)是将融合的动作使用变形传递得到的具有混合动作的豹子模型.图2先进行动作融合再变形传递结果(其中,(a)、(b)为4实验结果与讨论我们在配置为IntelPentiumT23701.73GHz双核处理器,内存2GB的计算机上使用C语言成功地实现了三角网格的多源混合变形传递,所使用的模型都来自文献[12],文中两种方法对应不同模型的运行时间如表1、表2所示.源模型与目标模型的对应关系固定,可以优先计算,重复使用.例子计算对应关系/s混合变形传递/s猫-豹子马-骆驼例子动作融合/s计算对应关系/s变形传递/s猫-豹子0.476马-骆驼0.95810.1893.6264.1变形传递实验结果本文利用Sumner于文献[2]中提出的方法,实现了求解中间网格,并最终得到具有原网格相似形态的变形后的目标网格.图3是以猫为源模型、豹子为目标模型得到的中间网格模型.图4是以猫为源模型,马、豹子分别为目标模型,将源模型上的不同变形形态传递到目标模型上后的变形结果.4.2多源变形直接混合传递的实验结果利用本文给出的第1种方法,实现了将源网格Page6的不同变形传递到目标网格上的不同区域.图5是以马为源模型、骆驼为目标模型,将马的两个不同变形传递到骆驼身体的不同部分的实验结果.图6是以猫为源模型、豹子为目标模型,将猫的3个不同变形传递到豹子上的结果.图5多源混合变形传递结果(其中(a)、(b)为源模图6多源直接变形混合传递结果(其中,(a)为源模型;(b)、(c)、(d)为源模型的3种变形;(e)为多源混合变形的结果)4.3先进行动作融合再变形传递的实验结果采用我们提出的第2种方法,先对不同动作进行融合,再将整体动作传递到目标网格上,并与方法1中的实验效果进行对比,从图2中可以看出,方法2和方法1都能取得较好的混合变形传递效果.4.4添加光滑项后的混合变形传递结果分析为了使得目标网格分割区域的变形更加光滑,本文在混合变形的基础上做出了进一步的改进.首先在分割过程当中,分解的各部分保证有一定数量三角形的重合,这样可以使得分割区域的变形具有较好的一致性.图7给出了重网格选取的示意图.为了从理论上解决分割处在变形过程中出现的不光滑现象,我们还增加了光滑约束项,从而可使得分割区域的变形更加平滑,效果更加真实.图8中的(a)、(b)分别表示未改进与改进后的混合变形的对比图,可以看出在使用了两种方法来保证光滑变形之后,图8(b)中豹子的腹部取得了较光滑的变形效果.为了分别揭示重网格的选取与添加光滑项后的效果,图9中将分割处的效果放大,其中图9(a)表示未改进的混合变形传递实验结果,图9(b)表示在分割区域选取重网格后的实验结果,图9(c)则表示即选取重网格,又添加光滑项后的实验结果.4.5鲁棒性分析本文提出的多源混合变形传递方法具有较好的鲁棒性.当位于分割处的源网格的两种变形动作具有较大的差异时,利用本文提出的算法也能很好地实施混合变形传递.图10给出的图10(a)、图10(b)表示源网格的两种不同变形,图10(c)、图10(d)分别表示混合变形直接传递和先进行动作融合然后进行变形传递的实验结果.虽然图10(a)、图10Page7(b)位于分割处的变形动作具有较大差异,但是实验结果图10(c)、图10(d)均具有较好的变形效果.图10变形差异较大时的混合变形传递结果5结论本文在Sumner于文献[2]中提出的基于三角网格上的变形传递的基础上,提出了两种将多个源网格不同变形传递到目标网格不同区域的混合变形方法.我们通过在分割边界处选取部分重叠的三角形和在能量方程中添加光滑项两种方法,得到了光滑的混合变形传递结果.与文献[3]中的混合变形传递方法相比,本文的方法较为简单且具有一定的鲁棒性.同时本文提出的算法也具有文献[2]中变形传递方法的缺点,源网格和目标网格需要具有相似的动作形态,人为地选取约束点需要花费较多的时间等.致谢本文中的原始数据大部分来自文献[2]和文献[12].在此,作者向他们表示感谢.同时,作者也向对本文的方法研究和写作提出宝贵想法和建议的老师和同学表示感谢!
