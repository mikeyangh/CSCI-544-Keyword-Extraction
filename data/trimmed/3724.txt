Page1代数曲面混合的切分结合S曲面补洞方法方美娥1)汪国昭2)1)(杭州电子科技大学图形图像研究所杭州310018)2)(浙江大学数学系杭州310027)摘要该文首先采用代数曲线样条逼近的方法参数化混合边界,然后用三次样条曲面混合任意两个隐式代数曲面,实现样条曲面和基曲面之间光滑过渡.进一步,文中采用GB样条混合两张代数曲面,当混合边界为Lissajous曲线、二次曲线、三角函数曲线、双曲函数曲线、悬链线或螺旋线等特殊曲线时,可实现混合曲面精确插值边界曲线.而对于多个隐式代数曲面混合,又首次提出了G1连续的切分结合S曲面片补洞的方法,且每张曲面片的形状都可通过形状参数直观地进行调整.关键词隐式代数曲面;2-way混合;GB样条混合;N-way混合;S曲面片1引言曲面混合是CAD/CAM中曲面造型的重要方法,代数曲面也由于它的优美外形和优良性质而成为曲面造型中的经典曲面,因此代数曲面混合是CAD/CAM中的重要研究课题.曲面混合的方法有很多,如Rollingball方法[1-3]、Potential方法[4-5]、圆纹面方法[6-9]、PDE方法[10-13]、细分方法[14-15]、扫掠曲面方法[16]、基于理想的方法[17-19]等.但这些方法Page2都是针对参数曲面或特殊的代数曲面而设计的,用已有的这些方法来混合一般隐式代数曲面时存在诸多局限性.因此真正能很好地用于一般隐式曲面混合的方法仍值得进一步研究.在文献[20]提出的用B样条逼近混合边界曲线的方法的基础上,我们提出一种曲面混合方法:用样条曲面混合任意两个代数曲面,而对N-way混合问题,先将每条混合边界一分为二,每相邻的一对采用2-way问题的方法混合,再用S曲面片补洞.所有混合曲面片均为控制顶点曲面,因此混合过程简化为控制网格的构造过程,另外,每张混合曲面片的形状都可通过修改形状参数直观地调整,混合曲面与基曲面以及混合曲面片之间都实现了光滑过渡.本文第2节介绍混合边界曲线的B样条逼近方法;第3节描述代数曲面的2-way混合问题,给出样条混合曲面控制顶点的构造方法,并给出构造2-way混合曲面及调节形状参数的例子;第4节则描述N-way混合问题及其方法和实例;第5节为全文总结.2混合边界曲线的三次B样条逼近本文讨论的混合问题假定边界曲线为非奇异的平面代数曲线,因此本节实际上是研究非奇异的平面代数曲线的参数逼近方法.整个逼近过程分为3步:采样、采样点排序、三次B样条逼近.我们在文献[20]中已提出了对奇异的平面代数曲线的逼近方法,对于非奇异的曲线方法类似,实际上除排序算法更为简单之外,采样与参数逼近算法基本相同,算法的详细分析参见文献[20].3两个隐式代数曲面的混合合,问题描述如下:两个隐式代数曲面的混合问题简称2-way混假定1,2为任意两个代数曲面,平面Plane1,Plane2分别与1,2交于一条封闭的非奇异平面曲线C1,C2,本文所讨论的2-way混合就是如何构造一张控制顶点曲面,沿C1,C2分别与1,2光滑连接.3.1混合曲面的构造构造一张带形状参数的曲面(u,v)作混合曲面,在跨混合边界的参数u方向上,等参曲线实际上是三次Bézier曲线,而在与边界“平行”的v参数方向上,等参曲线为三次B样条曲线.令V:0=v0=…=v3<v4<…<vm+1=…=这样,问题转化为控制顶点Pi,j(i=0,1,…,m;j=0,1,2,3)的构造,其构造过程包括以下步骤:(1)若平面Planek(k=1,2)与坐标平面平行,则在该平面内运用采样算法(附录1)和排序算法(附录2),对边界曲线Ck(k=1,2)采样,排序.否则,需先通过一个相应的旋转变换r将该平面变换到与新坐标系中的某一坐标平面平行,并对基曲面作同样的变换,再对变换后得到的边界曲线采样,排序,并实施逆变换r-1,得到采样点集的有序点列Psortk(k=1,2).另外,在实施逆变换之前,分别挑选出当前两个有序点列中第2坐标变量值最大(小)的点,记为Ak(Bk)(k=1,2).(2)运用三次样条逼近算法(附录3)对Psortk(k=1,2)作三次B样条逼近曲线,设为bk(k=1,2).为了避免混合曲面扭曲,一般地,我们选择Ak作为bk的首末端点(因为是封闭曲线,末端点与首端点重合),若这样选取不匹配,则用B2代替A2,或者根据具体情况另行确定.又考虑到混合时两边界曲线的控制顶点需一一对应,因此在三次样条逼近算法的第1步应确定一个合适的m0,作为共同的初始插值点数,而在三次样条逼近算法的第5步中应对两条逼近曲线作同样的插值点的增加与删除操作,即只要一条逼近曲线按误差要求需增加一个插值点,则另一条也要增加一个相应的插值点,而删除操作只有当两条逼近曲线都需要时才进行.整个逼近过程中,始终取两边界插值点的累加弦长的平均值为节点向量,并对其规范化处理.(3)确定混合曲面的控制顶点Pi,0,Pi,3(i=0,1,…,m).令b1,b2的控制顶点序列分别为珟Pi,珟Qi(i=0,1,…,m),由此可确定曲面的两列控制顶点,即Pi,0=珟Pi,Pi,3=珟Qi(i=0,1,…,m).这就保证了插值混合边界Ck(k=1,2)的逼近曲线bk(k=1,2).(4)确定曲面的控制顶点Pi,1,Pi,2(i=0,1,…,m).令nk(P)(k=1,2)表示基曲面k在点P处的法矢,Ck(P)表示边界曲线Ck在点P处的切矢,则曲面k在点P处不同于Ck(P)的另一单位切矢为nk(P)×Ck(P)nk(P)×Ck(P);又由(u,v)的曲面方程易知,在边界曲线b1上点P=b1(v)处沿v方向的切矢(u,v)uu=0=3∑mPage3则可保证曲面与1沿边界曲线G1连续,其中λ1为形状参数,d为两点间的距离函数,下一小节中会进一步讨论.为了根据关系式(2)求得控制顶点Pi,1(i=0,1,…,m),我们取参数值u=i到关于Pi,1(i=0,1,…,m)的线性方程组,解方程组便求得曲面的又一列控制顶点Pi,1(i=0,1,…,m);Pi,2(i=0,1,…,m)也同理可求,对应的形状参数为λ2.由于我们采用取值的方式来满足关系式(2)的G1连续条件,这是不充分的.因此混合曲面与基曲面并没有真正实现G1连续,而只是m+1条等参曲线在边界处的切向与基曲面的某一切向重合.但只(b)λ1=0.3,λ2=0.3图1两个squared-off球面的2-way混合3.32-狑犪狔问题的GB样条混合方法如第2节及附录所述,将边界曲线参数化时,采用了三次多项式B样条曲线逼近方法,适合于各种类型边界曲线,是具有一般性的方法,但若代数曲面的边界是二次曲线等特殊曲线时,更希望实现边界精确插值,NURBS曲线可以精确表示二次曲线,但其有理形式给后续的S曲面构造及连续性带来了困难.文献[21]中提出的GB样条曲线既能精确表示如Lissajous曲线、二次曲线、三角函数曲线、双曲g3k(t)=1ωl-(1+2cosωl)(ω(t-(k+1)l))-(1+2cosωl)(w(t-(k+2)l))-2ωlcosωl+其中:k=i,j,l∈(0,π);ω为正实数、零或纯虚数;u,v为参数t区间归一化后的变量,各参数的具体含义详见文献[21].采用双三次GB样条为2-way问题的混合曲面有两点优势:(1)在避免有理形式的前提下精确插值包括Lissajous曲线、二次曲线、螺旋线等在内的边界曲线;(2)频率参数ω为混合要m足够大,从离散的意义上来说是G1连续的,混合曲面与基曲面之间能实现光滑过渡.3.2形状参数调节形状参数λ1取不同的值时,由关系式(2)得到的关于控制顶点的方程组的解Pi,1(i=0,1,…,m)也随之改变,λ1越大,d(Pi,1,Pi,0)也越大,从而混合曲面沿着基曲面1在边界跨界切矢方向顺延得越多;同理λ2也对Pi,2(i=0,1,…,m)产生同样的影响.因此通过调节形状参数λk(k=1,2)的值,可以有预见性地调整混合曲面的形状.关系式(4)右边乘以一个距离函数d(Pi,0,Pi,3),是为了使d(Pi,1,Pi,0)及d(Pi,2,Pi,3)与d(Pi,0,Pi,3)成比例,当两平面交角较大时,避免混合曲面出现“扁平”现象.图1中3幅图是取不同的形状参数,混合相同的两个4次squared-off球面得到的结果,可以看出形状参数的取值对混合曲面形状的影响.函数曲线、悬链线或螺旋线等特殊曲线,又避免了有理形式,因此我们采用双三次GB样条为2-way混合问题的混合曲面.由于GB样条具有多项式B样条的类似性质(详见文献[21]),混合方法及连续性与采用多项式B样条的情况类似,混合算法流程仍按2.1节所述.不同的是,在混合过程中,混合曲面采用双三次GB样条曲面G(u,v)=∑3方程(1)所示的(u,v),这里曲面在v方向提供了形状调整的新参数.如图2所示,图2(a)中两基曲面分别为圆环面和圆柱面,混合边界为圆,取l=π/4,ω=1,按文献[21]中5.1节类似方法可反求三次GB样条精确表示圆时的控制顶点,据此构造出的混合曲面自然插值两混合边界.图2(b)中两基曲面分别为D5曲面:Page4x2y+y4-z2=0及Miter曲面:0.25x2(x2+(y+2.6)2+z2)-(y+2.6)2(1-(y+2.6)2-z2)=0,采用双三次GB样条曲面混合时,混合曲面在v方向的形状可通过参数ω来调整,图2(c)中展图2用GB样条曲面混合4多个隐式代数曲面的混合合,问题描述如下:多个隐式代数曲面的混合问题简称N-way混令i(i=1,2,…,N)为任意N个代数曲面,平面Planei(i=1,…,N)分别与i交于一条封闭的非奇异平面代数曲线Ci(i=1,2,…,N),假定依次连接Ci(i=1,2,…,N)的中心点构成一个空间N边形,本文所讨论的N-way混合就是如何构造一张混合曲面,沿Ci分别与i光滑连接,并且曲面由控制顶点曲面片组成.我们采用切分结合补洞的方法来构造多个隐式代数曲面的混合曲面.首先对所有混合边界Ci采样,将排序后的点列一分为二,分别用两条三次B样条曲线逼近,然后采用2-way混合的方法沿相邻(邻接关系与的中心点对应邻接关系相同)的两条逼近曲线混合其对应的基曲面,这需要N张混合曲面片,且这图33张Q3曲面的切分逼近结果及每两条相邻边界之间的2-way混合结果示了ω由内而外分别取1,0,2πi时得到的混合曲面,显然其膨胀程度与参数的类型及模的大小密切相关,用户可直观地调整混合曲面在v方向的形状.N张曲面片将围成两个N边形的洞.我们采用S曲面片补洞,因此整张混合曲面实际上由N+2张曲面片组成,其构造过程分两大步,即切分混合与补洞.4.1切分混合切分混合的方法运用的是第3节中的2-way混合方法,只是在边界曲线逼近之前要对排序后的采样点列进行切分处理,即选择两个合适的点为点列的断点,将每个有序点列拆成两个点列,断点置为切分后两个点列共同的首末端点,断点一般选用算法3中得到的Ai,Bi(i=1,2,…,N).切分后一个点列中点的顺序与原点列相同,而另外一个点列中点的顺序与原点列相反.切分好以后,分别用一条三次B样条曲线逼近每个点列,得边界曲线Ci(i=1,2,…,N)的逼近曲线bi,1,bi,2(i=1,2,…,N),分别沿bi,2,bi+1,1(i=1,2,…,N)作2-way混合,得N张混合曲面片BPi(i=1,2,…,N).如图3所示,图3(a)为边界曲线切分后逼近的结果,图3(b)为沿相邻边界混合对应的基曲面的结果.Page54.2补洞切分混合得到的混合曲面片BPi(i=1,2,…,N)的边界BPi(ui,0),BPi(ui,1)(i=1,2,…,N)分别围成一个N边形的洞,我们用一张S曲面片补一个N边形的洞,并且S曲面片与BPi之间实现G1连续.由于两个N边形的补洞方法完全相同,我们以BPi(ui,1)(i=1,2,…,N)围成的洞为例,介绍补洞的S曲面片SP的构造方法.S曲面片是Loop和DeRose提出来的,其理论详见文献[22].它将Bézier曲面的定义域推广到任意凸多边形域,而不再局限于三角域和矩形域,同时它还保持了通常Bézier曲面的经典性质,如求值与求导的几何方法,凸包性,边界性质及升阶性质等.补洞是S曲面片一个重要的应用,单张S曲面片即可用于补一个N边形的洞.Loop和DeRose在文献[22]中也给出了用它补洞的方法,它要求洞的周边曲面片必须满足4个相容性条件,而本文的混合问题中,周边曲面片BPi(ui,vi)(i=1,2,…,N)(上式中Fi(ui,vi)表示周边曲面片并不完全满足这些条件,因此不能直接用文献[22]的结果来构造补洞的S曲面片.但文献[23]中的方法给了我们启发,用类似的思路,我们构造出了适合本文混合问题的S曲面片,它不仅能与周边曲面片BPi(i=1,2,…,N)之间G1连续,而且它的形状也有自由参数可供调整.令P是一个正N边形域,p1,p2,…,pN是它的N个顶点,令tE(ti)=(1-ti)pi+tipi+1,ti∈[0,1].用于补洞的曲面片SP以P为定义域.由混合曲面片BPi的构造不难得到以下关系式:(A0)BPi-1(1,1)=BPi(0,1);(A1)BPi-1(A2)BPi-1为了保证曲面片SP与BPi达到G0连续,必须有SP(Ei(ti))=BPi(ti,1),ti∈[0,1],i=1,2,…,N.进一步,若要求SP与BPi实现G1连续,两者必须满足以下充要条件:(B0)DtiSP(Ei(ti))=BPi(B1)μ,ν:[0,1]→R,ν0,s.t.其中,μ,ν是待定的关于ti的函数.类似于文献[23]中的方法,我们推导出以下两个端点条件和一个二次可微条件:(C0)-BPi-1(C1)BPi(C2)-μ(0)·BPi基于关系式(A1)及(A2),取μ(0)=1,μ(1)=-1-2cos2πN,μ(0)=μ(1)及ν(0)=0,ν(1)=0,ν(0)=ν(1),显然,这些条件是关系式(C0)、(C2)成立的充分条件.若进一步取μ(t)为二次多项式函数,则由μ(0)=1,μ(1)=-1-2cos2π一确定μ(t)=(-2-2c)t+1,其中c=cos2πν(t)为二次多项式函数,则由ν(0)=0,ν(1)=0,ν(0)=ν(1)得ν(t)≡0,这与条件(B1)不符,因此ν(t)至少应取3次,此时求得ν(t)=λB(-2t3+3t2-t),其中λB为常数因子,可作为调整曲面SP的形状参数之一.根据周边曲面BPi及函数μ(t),ν(t)的次数,从关系式(B1)中易知,与周边曲面片G1连接的S曲面片SP的次数至少为7次.令曲面片SP表示为SP(p)=∑i其中(l1(p),l2(p),…,lN(p))是点p在域P中的重心坐标,其定义见文献[21].Page6将式(5)、(6)代入(B0)可得烄烅烆)06Γ1-λB6Η15Γ2-2λB15Η0-λB15Η15Γ1+110Γ1+3-2c15Γ1+1-c15Γ1-2c6Γ1-1+3cP1i,2,珟Cei+2ei+1=P1i,3;另外,SP与周边曲面片BPi的混合边界可表示为且BPiuiBPivi(ti,1)=3∑2(ti,1)=3上式中P1i,j+1(j=0,1,2,3)表示BPi(ui,1)的控制顶点,如图4中所示,P2i,j+1(j=0,1,2,3)是BPi控制顶点中与P1i,j直接相邻的4个控制顶点,由于采用三次均匀B样条曲线逼近边界,所以vm+1-vm=1m-3.其中l=3(m-3)Γ2=3P1i,2-P1i,1-3P1i,3+P1i,4,Γ1=-4P1i,2+2P1i,1+2P1i,3,Γ0=P1i,2-P1i,1,Η3=P2i,1-P1i,1+3P1i,2-3P2i,2-3P1i,3+3P2i,3+P1i,4-P2i,4,Η2=3P1i,1-3P2i,1-6P1i,2+6P2i,2+3P1i,3-3P2i,3,Η1=-3P1i,1+3P2i,1+3P1i,2-3P2i,2,Η0=P1i,1-P2i,1.这样,G1连续性条件被转化成了以上关于控制顶点的约束条件.除边界控制顶点及与边界直接相邻的控制顶点按式(7)、(8)确定以外,曲面片SP的其它内部控制顶点可自由确定.为了使曲面SP更具可控性,我们制定了内部控制顶点的确定方法.以下给出整张S曲面片控制网格的构造过程.(1)选取一张3次的S曲面的控制网格珟C作为珟C的边界控制顶点为珟C3ei=P1i,1,珟C2ei+ei+1=初始网格.c7ei=P1i,1烄c6ei+ei+1=4c5ei+2ei+1=1c4ei+3ei+1=1烅c3ei+4ei+1=1c2ei+5ei+1=1cei+6ei+1=4烆进一步,将μ(t)=(-2-2c)ti+1,ν(t)=λB·(-2t3i+3t2i-ti)及式(5)~(7)这3式代入(B1),经过相关的求导计算及一系列幂基与伯恩斯坦基之间的转换运算后,我们得到内部控制顶点由珟Ci=(i1,i2,…,iN)×珘I-1×(珓ν1,珓ν2,…,珓νN)T计算获得,其中珓νi=λI·(3P1i,2-14整曲面SP的形状参数,珘I=(aij)N×N,当且仅当i=1,2,…,N且j=i-1,i+1时aij=1,否则aij=0;(2)将珟C升阶到7次,产生新的控制网格C;(3)按式(7)及(8)重置C中边界控制顶点;(4)按以下方法重置C中如下控制顶点:fori=1:Nforj=0:6υN=cei-1+(7-j-1)ei+jei+1;υ1=c(7-j)ei+jei+1;υ2=c(7-j-1)ei+(j+1)ei+1;forl=2:N-2cei-l+(7-j-1)ei+jei+1=(υ2-υ1,υN-υ1,0)×endforPage74.3形状参数调整及犖-狑犪狔混合实例对每张切分混合的曲面片,都有两个形状参数可供调节,这已经在第3节中讨论过了.因此这里只讨论S曲面片的形状参数λB和λI.λB是S曲面片的边界形状参数,常取λB∈(0,20].调节λB的值,可对S曲面片在边界附近的形状进行微小的调节;λI是S曲面片的内部形状参数,常取λI∈(0,2],改变λI的值可直观地调整S曲面片内部形状.图4是图3中3个Dervish曲面混合后补洞的结果,图4给出了6个隐式代数曲面(3个S26曲面图43张Q3曲面的整体混合结果(a);3张S26曲面及3张BohemianDome曲面间的N-way混合((b)~(d)),分别取(c)λB=1,λI=0.5;(d)λB=1,λI=0.8;(b)λB1=1,λB2=2,λI1=λI2=0.8(仅显示两张S曲面片)5结论本文针对隐式代数曲面混合,尤其是N-way混合问题,提出了切分结合S曲面片补洞方法,将问题分解成切分后的2-way混合与用S曲面片补N边形洞两大部分.整个混合曲面由N+2张曲面片组成,这些曲面片都是控制顶点曲面,且每张曲面片都设有两个形状参数,通过改变它们的值,可以有预见性地调整混合曲面片的形状.进一步我们采用双三次GB样条曲面混合方法,当混合边界为Lissa-jous曲线、二次曲线、三角函数曲线、双曲函数曲线、悬链线或螺旋线等特殊曲线时,可实现边界精和3个BohemianDome曲面)混合的结果,无论是切分混合曲面片与基曲面之间,还是与S曲面片之间都实现了很好的光滑过渡.比较图4(c)和图4(d)可看出λI的取值对补洞的S曲面片形状的影响,图4(c)中λI的值较小,对应的S曲面片中部比较“平坦”,而图4(d)中较突起.图4(b)中是改变λB的取值得到的两张S曲面片,可见其边界附近形状有所不同,但影响不如内部参数明显,由于内部参数相同,所以图4(b)中两张曲面片越到中部越趋向重叠.确插值,并且混合曲面在v方向的形状可通过ω的取值进行直观调整.另外,切分混合曲面片与基曲面以及S曲面片之间都实现了光滑过渡.由于本文提出了边界曲线的一种简单参数逼近方法,使得这种方法真正适合于任意的代数曲面的N-way混合,而不像大多数已有的方法那样,假定边界曲线的参数形式已知.文中混合边界只讨论了平面曲线情形,而实质上,只要将采样算法推广到空间曲线,本文方法也可用于边界曲线为空间曲线的混合问题,另外,对于能用GB样条曲面表示的特殊基曲面的混合问题,若采用GB样条混合方法有望实现C2连续,且基曲面和混合曲面利用文献[21]的细分方法可整体细分生成,相关工作有待进一步研究.Page8
