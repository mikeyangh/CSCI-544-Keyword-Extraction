Page1支持反三角嵌入的松弛度量空间网络坐标算法张春红1)尹航1)程时端2)1)(北京邮电大学信息与通信工程学院北京100876)2)(北京邮电大学网络技术研究院北京100876)摘要网络坐标是根据网络测量时延将节点嵌入虚拟度量空间,根据坐标位置预测节点时延的模型和算法.然而通过网络测量发现互联网中广泛存在非对称和反三角(TriangleInequalityViolation,TIV)时延,度量空间固有的对称性和三角形不等性在本质上无法体现互联网时延的真实特征.特别是对利用反三角属性建立优化中继路由的应用,传统的网络坐标算法无法支持.为此,该文提出一种基于松弛度量空间的网络坐标模型,利用KL散度距离替代欧式距离定义节点时延,并设计了分布式网络坐标算法KL_vivaldi.通过理论分析与仿真表明:算法支持非对称时延和TIV的预测,提高了时延的预测精度,拓展了网络坐标算法的应用领域.关键词网络坐标;反三角;松弛度量空间1引言网络坐标系统NCS(NetworkCoordinationSystem)是一类预测互联网节点时延算法的统称[1].网络坐标算法忽略影响端到端时延的多种工程实际因素,将网络中的通信设备视为分布在某种度量空间中的虚拟节点,基于空间定义的距离度量,根据节点坐标直接计算节点间的预测时延.现有大量网络坐标算法基于局部实测时延,以最小化预测时延和Page2测量时延的误差为优化目标,为节点分配最佳坐标位置.网络坐标的本质是对真实时延空间的拟合与近似.网络测量数据表明,互联网时延广泛具有不对称性和反三角性[2-4].不对称性指一对端点间的双向测量时延不相等,排除测量误差的影响,其可能原因是端点间的双向路径不完全重叠.反三角性指一对端点间的直达路由时延大于通过中继节点构建的两段时延之和,这种现象称为TIV(TriangleInequalityViolation).大量研究工作利用反三角现象,建立以时延为优化目标的业务节点关系、服务器位置或缓存策略位置[5-6].在多媒体通信等应用中,利用TIV构建中继路由,能够降低端到端时延特性,提高业务的服务质量[7].然而,现有网络坐标算法大多以多维空间的欧式距离作为节点时延的度量公式.而对称性和三角形不等性定律是欧式空间的基础属性,这意味着无论如何摆放节点的位置,度量空间中的预测时延都不可能出现TIV现象,也不支持节点时延不对称性,任意节点间的双向时延完全相等.因而度量空间模型无法反映互联网节点时延的真实特征.目前基于欧式距离空间模型设计的网络坐标系统,通常将实际测量时延的TIV视为数据噪声,提出多种算法消除或缓解TIV对预测精度的影响[4,8].这类处理方法虽然能满足粗粒度网络时延预测应用,然而在利用TIV优化业务服务质量的场景中,则难以支持时延预测需求.针对网络坐标算法预测TIV和不对称时延的缺陷,本文提出一种基于松弛度量空间的网络坐标模型,分析了松弛度量空间的描述参数与属性,提出满足不对称性和TIV属性的KL距离定义.通过对经典分布式网络坐标算法vivaldi[8]进行修正,提出支持TIV的网络坐标算法KL_vivaldi.与前人研究工作对TIV的处理思路不同,KL_vivaldi算法认为TIV是网络坐标系统本身应具备的天然属性,而不是将其视为负面影响因素进行消除,或引入度量空间外的其他维度来容纳TIV现象[4].仿真实验表明,算法能够预测一定比例的TIV,具有优于vivaldi算法的预测精度.本文第2节介绍网络坐标研究现状和vivaldi算法;第3节提出构造松弛度量空间的距离函数并详细讨论空间属性;第4节描述KL_vivaldi算法的坐标迭代方法;最后第5节给出仿真实验结果及分析结论.2背景知识2.1反三角TIV随机选择网络中3个节点A,B和C,将源节点A和目的节点C(通称为端节点)以及中继节点B间的时延数值定义为三角形的边长,则3个节点构成了一个虚拟三角形△ABC.若三角形的两边和小于第3边,则称△ABC为TIV三角形.如图1所示,△ABC满足d(A,C)>d(A,B)+d(B,C),经过中继节点B的路径ABC构成了比默认路由AC更快的绕行路由,路径时延减少了120ms.TIV现象存在的本质原因是,网络中路由器执行的路由策略不以节点端到端时延为单一优化目标.终端节点之间的默认IP路径由数据包沿途流经的路由器决定,是域内路由策略和域间路由策略分段联合决策的结果,终端节点无权直接参与路由选择的过程[9].虽然域内路由协议IGP(InteriorGatewayProtocol)通常选择时延较小的链路,但域间路由协议BGP(BorderGatewayProtocol)不仅仅考虑路由自治域AS跳数或延迟等性能指标,还会考虑链路代价、流量负载、网络故障以及定价等综合因素.因此复杂路由策略下的默认IP路由未必是终端节点间的时延最短路由.很多研究工作对TIV属性做了量化研究[4,10],在节点时延数据集合中,TIV三角形数量占总三角形数量的比例通常在10%~30%之间,有些则高达40%以上,表明网络中普遍存在更短单跳绕行路由.大多数中继路由算法通过网络测量技术获取节点时延矩阵以定位TIV.但网络测量技术的复杂性及测量负荷使得通过测量获取全局延时矩阵在工程上是不切实际的方法[11].而利用网络坐标算法有效预测TIV,能够在不增加网络测量开销的前提下搜索中继节点,建立更短捷径优化业务的时延性能.2.2度量空间基于几何空间嵌入的网络坐标系统建立了物理Page3时延与几何拓扑空间的映射关系.网络中P个节点具有P×P维时延矩阵犇,矩阵犇的元素dij表示节点i和节点j的时延测量值.NCS为节点分配最佳坐标X,将节点映射到抽象度量空间M(X,ξ).ξ:X×X→函数,任意两个节点的空间距离为d^ij=ξ(Xi,Xj).欧式距离是典型的距离度量函数ξ:欧式距离满足如下3种性质:非负性ξ(狓,狔)>0狓≠狔、对称性ξ(狓,狔)=ξ(狔,狓)和三角形不等性ξ(狓,狔)<ξ(狓,狕)+ξ(狔,狕),其中对称性和三角形不等性都有悖于互联网时延数据的固有特征.根据文献[12-13]的方法对实际测量时延矩阵犇进行中心化变换得到矩阵犇(设犅=-(1/2)犎犇犎,其中犎=犐-(1/n)犈,犐为单位矩阵,犈为全1矩阵).犅矩阵不是半正定矩阵,其特征值存在负值.而只有当犅为半正定矩阵时,时延矩阵犇才符合欧式空间距离矩阵的特征.由此说明,互联网时延矩阵无法零误差嵌入任何维度的欧式度量空间中.针对这一问题,本文提出能保留互联网时延特征的非度量空间,并设计相应的网络坐标算法.2.3网络坐标算法化问题表述为网络坐标算法为节点分配虚拟坐标,其一般优通过优化策略调整节点坐标X,得到时延误差最小的预测距离矩阵犇^.现有网络坐标算法分为基于度量空间和基于矩阵分解的两类算法.基于度量空间的算法主要包括GNP[14]、PIC[15]和vivaldi[8]等.大部分算法采用欧式距离预测节点间对称的RTT(RoundTripTime).Vivaldi算法是分布式网络坐标算法的代表之一,本文将以vivaldi为基础设计支持TIV的网络坐标算法.Vivaldi假想任意两个节点之间存在一段虚拟弹簧,节点间的距离由弹簧势能决定.当节点距离小于测量时延时,弹簧处于被压缩状态,压缩势能使得两个节点相互远离,在两个节点当前坐标形成的向量方向上,节点选择“更远”的坐标位置进行迭代更新.反之,当节点距离大于测量RTT时,弹簧处于被拉伸状态,拉伸势能在向量方向上拉近节点之间的位置.当节点距离等于测量时延时,两个节点的坐标则无需调整.算法经过若干轮迭代后收敛到稳定状态,系统整体预测误差达到最小.然而,互联网中的TIV现象严重影响了度量空间网络坐标算法的预测准确度[16-17].文献[18]显示,从时延矩阵中删除TIV最严重的前0.5%的节点,全局预测的准确度将提高20%.目前基于度量空间模型设计的网络坐标系统,通常将实际测量时延的TIV视为数据噪声,以牺牲小部分严重TIV为代价换取整体预测精度的提高.Vivaldi认为只要严重TIV存在的比例很低,算法准确度即能限制在可接受的范围内.S-Vivaldi[13]对原始时延数据进行指数变换,降低TIV的严重程度和数量后,再嵌入度量空间.还有文献通过建立层次化空间来分散TIV对嵌入精度的影响[19-20].这些方法试图通过叠加多个度量空间来削弱单一度量空间对TIV的排斥,而非保留嵌入空间的TIV属性.矩阵分解网络坐标算法抛弃了将节点嵌入度量空间的思路,对时延矩阵进行降维分解.IDES[21]算法利用奇异值分解SVD和非负矩阵分解NMF,为每个节点分解出一个入向量和一个出向量,节点入向量与另一节点出向量的内积定义为该节点到他节点的预测时延.矩阵分解算法的预测精确度与度量空间算法基本相同.矩阵分解算法从理论上不受度量空间三角形不等性和非对称性约束,支持TIV的存在.然而IDES采用对称RTT进行计算,并未说明如何处理非对称时延,也未说明算法精度与TIV的关系.3松弛度量空间为了克服度量空间网络坐标算法在TIV预测方面固有的缺陷,本节提出支持非对称时延和TIV的距离函数,构建松弛度量空间实现节点嵌入.为了描述互联网时延特征,首先给出下列定义[22].定义1.γ松弛对称性(γ-RelaxedSymmetry).在集合X上定义距离函数d:X×X→果p,q∈X,γ0,使得|d(p,q)-d(q,p)|γ成立,则称空间(X,d)满足γ松弛对称性.定义2.γ松弛三角形不等性(γ-RelaxedTriangleInequality).在集合X上定义距离函数d:X×X→ζ1,满足d(p,r)+d(r,q)>ζ·d(p,q),则称空间(X,d)满足ζ松弛三角形不等性.互联网时延空间符合γ松弛对称性和ζ松弛三Page4角形不等性,称为松弛度量空间(X,d,γ,ζ).γ与ζ是空间特征描述参数,欧式度量空间是γ=0和ζ=1的特例.距离函数d的选择是构建松弛度量空间的关键,不同的距离函数具有不同的空间特征.互联网距离函数d本质上定义了节点之间的差异度(dissimilarity).大量研究工作提出多种差异度函数,如余弦距离、街区距离、马氏距离、欧式距离[23]等.由于散度(Divergence)差异性具有γ松弛对称性和ζ松弛三角形不等性,因此本文选择散度距离作为互联网时延距离公式,构造松弛度量空间模型.散度常用于衡量概率密度函数之间的差异性[24].设F是定义在L上二次连续可微的严格实值凸函数,p,ρ为两个正值集合,Bregman散度定义为DF:L×L→DF(p‖ρ)=F(p)-F(ρ)-F(ρ)F(ρ)ρ表示对F求导.取F(ρ)=ρln(ρ)-ρ[25]得到广义KL散度(KullBack-Leiblerdivergence):DKL(p‖ρ)=F(p)-F(ρ)-F(ρ)ln(·)表示自然对数.记N维松弛度量空间节点X的坐标为X=(x1,…,xN),节点X到Y的时延距离为dKL(X‖Y)=∑NdKL(X‖Y)也称KL距离.下面证明dKL(X‖Y)满足非负性、不对称性和TIV属性,并讨论空间描述参数的分布特性和极限.证明.dKL(X‖Y)满足非负性.根据式(4),KL距离中每维子项dKL(xi‖yi)等于函数F(xi)与其在yi处一阶泰勒级数展开项间的误差.由于F(xi)为凸函数,因此dKL(xi‖yi)总为非负值[26],其求和结果dKL(X‖Y)满足非负性.当且仅当X=Y时dKL(X‖Y)=0,节点坐标取值均为正实数证明.dKL(X‖Y)满足γ松弛对称性.记K(X,Y)=dKL(X‖Y)-dKL(Y‖X)为节点(X,Y)双向KL距离差,在不引起混淆的情况下,文中(X,Y)既代表节点也表示节点坐标.参数γmax(K(X,Y))反映了双向时延不对称程度,是衡量松弛度量空间的重要参数.记F(X)=∑F(xi)是定义Bregman散度的可分(函数值为各维分量之和)凸函数,F(X)是F(X)在坐标X处的梯度,K(X,Y)可改写为K(X,Y)=F(X)-F(Y)-〈X-Y,F(Y)〉-式中〈·,·〉表示向量内积运算.式(6)利用凸函数性质进行不等式变换,得到K(X,Y)取值下限.同理可得K(X,Y)lnX()Y,X-Y,因此有式(7)表明,节点双向距离差的上限与节点坐标差值和商值相关,当XY时K(X,Y)是坐标X的单调增函数和坐标Y的单调减函数.设节点坐标向量分布在有界空间[A,B]上,任意X满足aixibi.由K(X,Y)单调性可知,空间[A,B]中双向KL距离之差上限为γ=lnB()A,B-A.如图2梯度变化方向所示,K(X,Y)在边界处获得极值.图中箭头表示梯度变化方向,等高线上标识了K(X,Y)的具体数值.除了参数γ,K(X,Y)的概率密度也是反映度量空间不对称性的重要指标.图3显示了有界空间(0,100]中K(X,Y)的概率密度分布.由于K(X,Y)=-K(Y,X),概率密度以0为中心呈现对称分布;同时K(X,Y)集中分布于低值范围,而高值区间密度Page5较低,这与互联网双向时延分布特征相符.当松弛度量空间维度N增大时,K(X,Y)概率密度的集中度随之降低,取值范围也随之增大,因此增加维度N对双向距离不对称性具有弥散作用.调整节点坐标取值空间[A,B]和维度N可得到参数γ各异的松弛度量空间,控制空间的不对称程度,满足双向时延不对称性的嵌入需求.松弛度量空间不但支持不对称时延,也支持对称时延.记K(X,Y)=(k1,…,kN),ki表示第i维坐标贡献的双向距离差.在一维空间中,当且仅当X=Y时K(X,Y)=0成立,表明除节点自身外,到其他节点均为不对称时延.对二维空间中给定的X=(x1,x2),Y=(y1,)(表示y2值未定)有k1=K(x1,y1).对任意给定的x2,不失一般性,由于k2=dKL(x2‖y2)=dKL(y2‖x2)在x2>y2区间上是y2的连续非递增函数,因此在有界区间内至少存在一个y2满足k2=-k1.改变y1可得到新的y2,故k2=-k1的二维解(y1,y2)不唯一.因此存在多个Y=(y1,y2)满足K(X,Y)=0.以此类推,在N维松弛度量空间可由kN=-∑N-1{Y|K(X,Y)=0},使得(X,Y)双向距离相等.因此松弛度量空间中存在多组不重叠的坐标对,可用于摆放双向时延相等的一对节点.由这一特征推论可知,对任意实数|k|<γ,松弛度量空间中总存在节点集合满足Θkx={Y|K(X,Y)=k}.随着维度N的增加,集合Θkx包含的元素总数也随之增加,为节点嵌入度量空间提供了多重坐标位置选择,具有更高的灵活性.证明.dKL(X‖Y)满足ζ松弛三角形不等性.设3个节点XYZ,不失一般性,设Y为中继节点,与其他两个节点构成时延有向三角形.记ψ表示三角形中两个中继链路时延之和与默认链路时延的比值:ψ=dKL(X‖Y)+dKL(Y‖Z)由于dKL(X‖Z)为非负数,故当(X-Y)ln(Y/Z)T>0时ψ1,XYZ构成反三角形TIV.记ζ=min(ψ)为ψ的下限,是反映松弛度量空间属性的重要参数,ζ越小表明空间中能容纳的TIV反三角程度越严重.为了计算ψ的极小值ζ,分别计算式(8)对(X,Y,Z)的偏导数并使其为0,得到驻点{(x0,y0,z0)|x0=y0=z0},对应了ψ最大值,故ψ在有界区间内无全局驻点最小值.为寻找ψ的极小值分析下式:X=-∑dψ中的乘积项h(xi)=yilnxiz()i-xi+zi.在给定(yi,zi)首先讨论一维松弛度量空间的情况.设式(9)分子下对h(xi)求导可知h(xi)在xi=yi时获得全局最大值,并存在x1yix2使得h(x1)=h(x2)=0.当xi∈(xi,x2)且yi>zi时ψdxi<0,表明ψ是xi的单调减函数,ψ在x2处取得最小值.当xi∈(a,x1)∪(x2,b)且yi>zi时ψdxi>0,表明ψ是xi的单调增函数.由于当x1>a时ψ>1,因此ψ仍在x2取得最小值.若x2超出取值区间即x2>b,则ψ的最小值由xi取值右边界b决定;同理当yi<zi时,ψ在x1或左边界a处获得最小值.因此对任意给定(yi,zi)有ζxi=min(ψ(max(a,x1)),ψ(min(x2,b)))(10)相似地由ψdziζzi=min(ψ(max(a,z1)),ψ(min(z2,b)))(11)通过分析ψ对yi的二阶偏导可知对给定的(xi,zi),ψ(yi)为凸函数,故存在全局最小值ζyi=min(ψ(y0)),其中y0=f-1(0),而为ψdyi中的分子项.通过上述分析可见,一维松弛度量空间的参数ζ=min(ψ)与有限闭区域[a,b]的边界值及(xi,yi,zi)间的大小顺序相关.当边界值为(a,b)时,三角形不等性参数ζ1为Page6当松弛度量空间维度增加时,设每维坐标取值边界[a,b]相等,则ψi的最小值ζi均与一维空间的参数ζ1相同,因此N维空间中的参数ψN为故N维松弛三角形不等性参数ζN=min(ψN)的下限为一维松弛度量空间的参数ζ1,且有不等式关系ζNζ1,而ζ1由区域的边界值(a,b)决定.图4显示了[a,b]=[1,10]时ψ1的概率分布,为了重点观察松弛度量空间容纳TIV的能力,图中仅给出了ψ11的概率密度.ψ1在(x,y,z)=(10,4.1,1)处取得最小值ζ1=0.4065;将[a,b]扩展到[1,50],ψ1在(x,y,z)=(50,13.8,1)处取得最小值ψ1=0.3519(图中未显示).这表明ζ1由区间[a,b]边界值决定,当x,z分别在上下边界取值且y位于x,z中特定位置时出现最严重TIV,且ζ1随[a,b]的跨度增大而减小.不失一般性,设x>z,当z-→0或x+→时ζ1能降至足够小,因此可支持互联网时延空间中任意单个TIV的精确嵌入.仿真还发现,一维松弛度量空间中TIV的比例为P(ψ11)≈0.33,且该比例与(a,b)具体取值无关.从表1可见,TIV所占比例P(ψ11)随着维度N增加而降低,同时参数ζN随着维度N增加而上升,表明高维空间中TIV违反三角形不等性的严重程度有所下降.注意,表1中P(ψd1)为松弛度量空间中任意三角形中TIV所占比例,反映了KL距离空间的固有属性.而在互联网时延测量数据集中,TIV比例通常大于表1中高维空间的P(ψN1).由于实测时延集合构成的三角形总数远小于嵌入空间能容纳的所有可能三角形数,因此由算法嵌入空间的三角形呈稀疏性,故P(ψd1)小于实测TIV比例的现象,并不影响节点的实际嵌入精度,预测时延参数ψ的概率密度分布也允许与图4不同.ζN0.40650.43050.50170.6525P(ψN1)0.33000.14620.06300.0142至此,证明了广义KL散度dKL(X‖Y)生成的松弛度量空间(X,d,γ,ζ)满足非负性、松弛对称性和松弛三角不等性,克服了欧式距离度量空间的缺点,充分保留了真实互联网时延特征,从理论上支持TIV的嵌入,是适合互联网时延的空间嵌入模型.4KL_vivaldi算法基于松弛度量空间(X,d,γ,ζ),本文提出网络坐标算法KL_vivaldi.算法以分布式网络坐标算法vivaldi为基础,采用KL距离替代欧式距离定义节点时延.由于更改了距离计算公式,节点间不对称的双向距离无法对应vivaldi算法设定的弹簧势能概念,因此KL_vivaldi重点修改了节点坐标迭代步骤,引入了双向不对称时延对节点坐标的影响.算法的伪代码如算法1所示.算法1.KL_vivaldi算法.输入:测量实验矩阵犇输出:节点坐标矩阵犆和预测时犇^X=rand//随机分配每个节点的初始坐标foreachXiwhile(e>tolerance)foreachXj//计算节点Xi和Xj的不对称KL距离//计算双向预测时延与测量时延的误差//计算引起误差的方向向量//计算迭代参数//修改Xi和Xj的坐标Page7endendendendC←X,犇^=KL(C)KL_vivaldi算法以时延矩阵为输入,以最小化节点KL距离与测量距离的误差为优化目标,通过迭代收敛到节点的最佳坐标C.初始化时算法为节点随机分配大于0的初始坐标值,节点依据到一组邻居节点的测量时延优化自身坐标.对节点Xi,根据当前坐标值计算它到邻居节点Xj的KL距离,得到双向误差e和e^;同时,根据节点Xi和Xj的坐标,计算方向向量犱犻狉,其中狌表示单位向量.节点Xi根据时延误差及犱犻狉方向,对节点Xi和Xj的坐标进行一次微小调整.迭代执行上述过程,直到误差小于设定的门限值,算法结束并输出节点的最优坐标值.KL_vivaldi在关键步骤上对vivaldi算法进行修改.首先采用式(5)的KL距离替代欧式距离计算节点预测时延.其次针对不对称KL距离,引入双向误差e和e^,分别表示从节点Xi到Xj的时延误差以及节点Xj到Xi的反向误差.在vivaldi算法中,由于误差e与时延方向无关,因此一端节点预测误差的降低意味着另一端节点的误差也同步降低.如果沿用vivaldi节点坐标的迭代计算公式,仅利用节点Xi到Xj的单向预测误差e调整节点Xi的坐标,则可能出现与Xj坐标优化需求互斥的反向迭代.也就是说,修改节点Xi的坐标使Xi到Xj的误差e降低时,却增大了节点Xj到Xi的误差,节点坐标难以同向收敛.为此KL_vivaldi算法在调整节点Xi坐标的同时,也调整节点Xj的坐标,使两个节点坐标进行同向优化.当误差e和e^同为正数时,表示两个节点当前的KL距离均大于真实RTT,节点需要相互靠近以拉近距离;当误差e和e^同为负数时,表示两个节点当前KL距离均小于真实RTT,节点应相互远离以增加距离.这两种情况都表明节点当前的相对位置与双向误差大小的相对关系吻合,两个节点应同时延着犱犻狉指示的方法调整坐标.当误差e与e^符号相反时,表示一个节点要求远离,而另一个节点要求靠近.这种情况表示两个节点当前的坐标位置相互矛盾,沿着现有节点方向犱犻狉继续调整无法实现坐标收敛.例如在一维松弛度量空间中,当xi>xj时,d(xi‖xj)>d(xj‖xi)成立.由于节点的初始坐标为随机分配,如果节点间测量时延dij<dji,而两个节点坐标却被分配到xi>xj平面时,将无法满足双向同步优化要求.因此算法根据双向时延的关系,将节点从xi>xj调整到xi<xj平面空间.此时节点将沿着与犱犻狉相反的方向调整节点位置,使节点回归到合理的位置空间,满足双向坐标优化的同向需求.除了利用误差e和e^的符号关系调整节点坐标的相对位置,误差e和e^的数值也用于控制节点坐标的迭代步长及权重.此处借鉴了vivaldi算法的思路,节点坐标迭代步长为误差e与参数δ的乘积,参数δ的选择影响算法的收敛速度,δ为小于1的常数.由于KL距离的不对称性,节点的迭代参数也从不同方向分担对误差的调整:δi表示节点Xi的调整参数,δj为节点Xj的调整参数,le和l珓e分别为双向预测的相对误差(le=e/d).算法1的集中式KL_vivaldi可方便地扩展为分布式算法.当网络规模较小时,由集中式服务器执行KL_vivaldi算法,承担测量节点时延和网络坐标计算的工作.当网络规模扩大时,集中式服务器成为算法性能瓶颈,因此采用分布式策略,由每个节点独立地连续执行KL_vivaldi算法.在系统初始化阶段,每个节点采用随机选择或近邻选择等方法指定一组邻居节点,利用网络测量工具周期性地获取邻居节点的最新双向时延,并读取邻居节点当前坐标值,以此作为KL_vivaldi算法的输入参数进行计算,迭代收敛至稳定的网络坐标值.当新节点加入时,选择一组已具有网络坐标的节点,执行KL_vivaldi算法计算自身坐标;当节点的某邻居节点退出系统或失效时,选择有效节点更换邻居列表,刷新节点坐标值,因此KL_vivaldi算法能够适应网络结构的动态变化.当某节点上的高层应用需要获取网络中任意节点的时延时,无需启动网络测量工具,通过读取对方节点当前网络坐标值,直接计算即可得到预测时延.5算法仿真与验证为了验证松弛度量空间对网络节点嵌入的有效性,本文基于3个网络测量时延矩阵集合Meridian[27]、King①、P2Psim②,采用KL_vivaldi算法预测时延.①②Page8其中King(1740个节点)是非对称时延集合,而Meridian(2500个节点)与P2Psim(1895个节点)是对称时延集合.仿真分析了节点嵌入精确度,讨论了空间嵌入维度对预测误差的影响,重点分析了衡量(X,d,γ,ζ)松弛度量空间三角形不等性参数ζ和不对称性参数γ的属性,说明了算法在非对称性时延和TIV预测方面的有效性,最后分析了参数δ对KL_vivaldi算法收敛速度的作用.仿真结果取100次计算的均值.仿真首先对比了KL_vivaldi算法和vivaldi算法的嵌入精确度.分别采用两种算法将3个时延数据集合嵌入松弛度量空间,计算预测时延与测量时延的相对误差,其累积概率绘制在图5中.图例“KL”表示基于KL距离的KL_vivaldi算法,“EU”表示基于欧式距离的vivaldi算法.图5表明虽然两种算法总体上都能将相对误差小于1的总量控制在90%以上,但KL_vivaldi在获得小误差的性能上优于vivaldi算法,这是源于KL_vivaldi算法能够更多地保持时延空间的真实属性.KL_vivaldi和vivaldi算法的嵌入精确度均与时延数据集合中TIV比例相关.当TIV比例较低时,KL_vivaldi算法对嵌入精确度的提升并不显著.P2Psim数据集合中TIV的比例约为4%,Meridian和King中TIV比例分别为7%和9%,普遍低于互联网中平均TIV的比例.其可能的原因之一是,时延测量者有意剔除了时延集合中部分TIV,以降低可能造成的影响[8].为了验证KL_vivaldi算法在高TIV比例时的性能优势,以Meridian集合为例,通过仿真模拟网络时延动态变化,在测量时延上添加服从均匀随机分布的时延噪声,将时延数据集合中TIV的比例从7%提升至22%,生成新的时延数据集合.另一方面,提高短时延的精度对预测TIV起到重要作用[28].为此,分别根据原始时延和噪声时延采用KL_vivaldi和vivaldi算法将节点嵌入松弛度量空间,比较两种算法在不同TIV比例下对短时延(dij30ms)的预测相对精确度.从图6可见,短时延的预测误差整体高于图5中全集时延的预测误差.因为对短时延而言,即便较小的绝对预测误差也会造成较大的相对预测误差.当TIV比例为7%时,KL_vivaldi算法对短时延的预测虽然优于vivaldi算法,但预测性能改善程度并不显著.当TIV比例升高至22%时,KL_vivaldi算法对短时延的预测精度与TIV为7%时相似,而vivaldi算法的预测精度则出现明显下降.这表明KL_vivaldi算法对高TIV比例具有良好的容纳能力.前文证明了增加空间维度N能够扩展空间不对称性,同时降低TIV违反三角形不等性的严重程度.图7以King时延数据集合为例,显示了相对预测误差与松弛度量空间维度的关系.当采用2维空间时,嵌入相对误差较大;而采用4维、8维和16维空间时,嵌入误差不断降低,但降低幅度的差距越来越小,表明进一步提高嵌入空间维度对误差的改善作用持续降低.除了特别标出维数的图表,本文均采用8维松弛度量空间进行仿真,从而兼顾时延不对称性和反三角性的需求.Page9KL_vivaldi算法的主要贡献是建立了支持TIV反三角的松弛度量空间.根据定义2,对任意TIV存在常数ζ<1使得d(p,r)+d(r,q)>ζ·d(p,q)成立,ζ<1越小表明空间违反三角形不等性的程度越严重,三角形中两条中继路由比直达路由缩减的时延越大,对业务时延的优化效果越显著.式(8)定义了三角形中两跳中继路由时延之和与默认直达路由时延的比值ψ,仿真对比测量时延与预测时延的ψ分布,以此反映KL_vivaldi松弛度量空间支持TIV的有效度.以King数据集合为例,图8显示了测量时延与预测时延参数ψ(ψ1)的概率密度.图8中两种时延参数ψ的概率分布基本相近,表明KL_vivaldi算法较好地保留了测量时延空间图9KL_vivaldi预测误差分布KL_vivaldi算法的预测误差解释了图8中测量时延参数ψ的特征.当TIV程度严重时,即便在松弛度量空间也难以找到高精确的节点嵌入位置,KL散度定义的距离扭曲程度相比于测量时延空间仍有不足.通过仿真发现,KL_vivaldi算法预测的TIV比例大约是真实时延空间的1/3~1/2.对工程实践的反三角属性.分布在(0,0.7]区间上的ψ对应的TIV反三角程度相对严重.在此区间内,预测时延ψ的概率密度低于测量数据;而当ψ>0.7时,预测时延ψ的概率密度大于测量数据.这表明KL_vivaldi算法预测轻度TIV的能力较强,而预测严重TIV的能力相对较弱.基于预测时延ψ可能存在的偏差,节点在搜索中继路由时,可在基于节点坐标计算的参数ψ上,增加相应的修正因子,以提高预测的准确性.参数ψ表现出的分布特性本质上由KL_vivaldi算法的预测误差决定.对测量时延所有数据取整,同一个整数时延值对应多个预测误差,将其均值和方差边界表示为纵向小线段绘制在图9中.图中横坐标表示测量时延的整数取值,例如P2Psim整数时延集合的取值范围为1ms到541ms;纵坐标表示预测误差,单位为ms.图9表明随着测量时延的增大,预测误差的均值也随之上升.当测量时延较小(例如小于50ms)时,预测误差多呈现负值,表示预测时延大于测量时延;而测量时延较大时,预测误差多为正值,表示预测时延小于测量时延;在中段测量时延区间(50ms~250ms),误差则各有正负.这表明KL_vivaldi算法易高估小时延,而低估大时延,导致预测TIV的比例低于真实值,预测TIV的严重程度整体下降.而言,虽然节点难以预测所有中继路由,但仍然能估计一定比例的可用中继路由.前文提到基于矩阵分解的IDES算法也能保持时延的TIV属性.由于IDES只能处理对称时延矩阵,因此以P2Psim集合为例,利用IDES奇异矩阵分解SVD算法预测节点时延(随机选择20个地标Page10节点),图10绘制了参数ψ的概率分布,与图8趋势基本相近.与KL_vivaldi不同的是,IDES算法的参数ψ在小于0.5的区域上,虽然仍低于实际概率密度,但比图8有所增加,说明较多地形成了反三角程度严重的TIV.这是由于IDES在高时延区间的负误差较多,负误差表示预测时延大于测量时延,高估的长边导致TIV严重程度增加.另外IDES对100ms以下小时延的估计误差波动范围偏大,且均值多为负值,说明IDES也同样存在高估小时延的问题.KL_vivaldi算法还支持时延空间的不对称性.基于3个时延数据集合,仿真计算测量时延与预测时延的松弛对称性参数γ(此处γ表示双向时延差的绝对值),将其概率密度绘制在图11中.图中King等3条曲线分别表示3个预测时延集合的参数γ,Kingrtt表示真实测量时延的参数γ,注意由于γ参数概率密度分布范围较大,图11的纵坐标为对数坐标.King测量时延的参数γ分布在[0,174.671ms]区间,γ=0表示两个节点间的双向时延相等,γ>0表示时延不对称,γ越大表示双向时延偏斜越严重.虽然γ的分布范围较大,但超过84%的γ小于15,且随着γ的增大,概率密度不断下降,因此图11只显示了γ在[0,15ms]区间上的分布.通过KL_vivaldi算法预测King时延集合的γ参数分布在[0,36.4ms]的区间内,其分布区间远远小于真实γ,并且有超过92%的γ小于10.这表明对于非对称性较为严重的时延,KL_vivaldi算法会低估其偏斜程度.但由于严重不对称时延在数据集合中所占比例很低,因此算法整体的精确度不会受到明显影响.从图11可见,虽然预测γ的取值区间远远小于真实γ,但在γ集中分布的范围内,预测时延参数γ的概率分布与测量时延基本吻合,γ=0的概率密度大约为16%,表明大多数节点间的预测时延均呈现一定的不对称性.P2Psim和Meridian为对称时延集合,参数γ恒为零,因此未绘制在图11中.在γ>0区间,P2Psim和Meridian预测时延γ参数的概率密度均小于1%,表明绝大部分节点对间的预测时延几乎为双向对称,只有少量的预测时延出现不对称现象.这表明KL_vivaldi算法不但支持非对称时延,在对称时延数据集合上也具有良好的适应性.最后,由于KL_vivaldi算法更改了vivaldi节点坐标更新的迭代方式,因此仿真也分析了迭代参数δ对算法收敛速度的影响.图12以P2Psim时延为例,显示了δ取值对算法收敛性的影响.图中横坐标为迭代次数,纵坐标为当前迭代过程中所有节点的平均绝对误差e(e=E(|rtt-d|).当δ=1时,算法初始收敛较快,但由于迭代步长较大,平均绝对误差e呈现震荡上升趋势,难以收敛到稳定状态.随着δ的减小,算法收敛速度放慢,但算法的震荡范围大幅度下降,保证了算法收敛到相对稳定的范围.这表明参数δ对KL_vivaldi算法收敛速度的影响方式与vivaldi算法基本一致.6小结基于度量空间的网络坐标系统在理论上难以还Page11原网络时延的不对称性和TIV属性,无法直接预测TIV.本文采用KL散度定义节点距离dKL(X‖Y),提出了将互联网节点嵌入松弛度量空间(X,d,γ,ζ)的网络坐标算法KL_vivaldi.仿真表明KL_vivaldi算法平均预测精确度小幅优于vivaldi算法,尤其在高TIV比例下对短时延的预测精度有明显提高.更重要的是,KL_vivaldi算法在理论上支持不对称时延和TIV三角形的嵌入,为节点利用网络坐标算法直接预测更短中继路由提供了可能.事实上,松弛度量空间的定义不受限于具体网络坐标算法,只要考虑针对非对称时延的处理,即可推广到多种网络坐标算法中.然而,KL_vivaldi算法仍然存在改善空间.由网络动态性造成的暂态TIV并不适用于所有时延优化场景,因此KL_vivaldi算法应考虑判别暂态TIV.节点可根据历史测量时延的移动平均值或加权值来更新节点坐标[29],以降低暂态TIV的概率.另一方面,算法预测严重TIV能力仍存在一定限制,导致节点难以选择到最佳中继路由甚至错误中继路由.因此,未来工作将针对暂态TIV判定问题和偏差严重异常节点优化嵌入机制,探索算法的改善思路.
