Page1基于图像匹配-点云融合的建筑物立面三维重建王俊1)朱利2)1)(西安交通大学电子与信息工程学院西安710049)2)(西安交通大学软件学院西安710049)摘要随着计算机技术的快速发展,基于图像的建筑物三维重建逐渐成为计算机图形学和计算机视觉领域的研究热点之一.由于建筑物图像背景复杂、序列长且杂乱无序,现有的三维重建算法存在耗时长、局部几何细节重建效果差的问题.文中针对这些不足提出了一种基于图像匹配实现点云融合的建筑物立面三维重建算法.首先寻找新添加的建筑物局部图像在原始图像集中的匹配图像,组成规模较小的图像集并重建出局部点云模型,然后通过匹配不同点云模型在同一幅图像上的投影点,找到点云模型之间的一致对应点集,接着求解点云集合之间的最佳对齐变换,实现整体和局部点云模型的融合,最终生成建筑物立面完整的三维模型.实验表明,采用文中算法进行三维重建,可以有效地减少重建时间,提高重建精度.关键词SIFT流;图像匹配;点云融合;三维重建1引言随着“数字地球”、“智慧城市”等城市信息化、智能化发展战略的实施,如何高效构建城市三维虚拟环境成为其中的关键技术问题之一,并将有助于实现公共监控、设施管理、数字生活等城市智能环境的建立.建筑物是城市的主要组成部分,各式各样的楼房是居民生活、工作、娱乐的主要场所.因此,城市建筑物的三维重建成为备受关注的重要问题,近几年来在计算机图形学和计算机视觉等领域也逐渐成为研究的热点问题.目前,城市建筑物的三维重建方法主要分为两大类[1]:基于深度检测设备直接获取三维点云数据和基于图像的三维重建.前者通过具有深度测距功能的系统,如激光雷达(LiDAR),可以直接生成目标建筑物表面的点云模型.虽然这种方法重建的三维模型精度较高,但系统设备成本昂贵,而且不适于复杂街道环境的建筑物重建[2].基于图像的三维重建技术则是通过数码摄像机等拍摄的二维图像,恢复出建筑物表面的三维信息.该方法成本低廉,仅需要普通规格的数码相机拍摄建筑物图片,而且自动化程度高,重建的三维模型包含丰富的纹理等信息,因此一直受到学者的广泛重视.本文针对基于图像的建筑物立面三维重建进行研究,提出了一种更高效的通过图像匹配实现点云融合的重建方法.基于图像的三维重建的核心内容是SFM(Structure-From-Motion)技术[3]和MVS(Multi-ViewStereo)[4],即输入一组建筑物二维图像,通过求解对应的摄像机运动参数及几何结构,生成建筑物表面的三维模型.由于维度缺失,从二维图像反求三维运动是一个病态问题,求解困难.通常做法是将摄像机参数估计和三维坐标计算转化为图像平面投影误差极大似然估计,借助非线性最小二乘优化求解[5].虽然这种方法原理比较成熟,但由于建筑物图像背景复杂、图像数目较多,而且需要重建的建筑物外立面结构复杂,现有算法将所有图像作为输入的重建过程耗时长,而且重建出的三维整体模型局部效果差,不利于进一步几何细节增强处理.针对这一问题,本文提出了一种借助局部点云融合的三维重建方法,目的在于保证常规方法[5]重建精度的同时,极大地减少重建时间.该方法首先通过寻找新添加图像在原始图像集中的匹配图像,组成规模较小的局部图像集合并重建出局部点云模型;然后求解整体点云模型和局部点云模型之间的融合变换;最后通过融合两部分点云模型来实现建筑物立面完整的三维重建.本文的主要贡献是提出了一种借助点云融合的三维重建算法,通过整体和局部点云的融合,实现建筑物完整三维模型的快速重建.通过这种图像匹配-点云融合方法重建建筑物立面,可以大大缩短重建时间,同时提高三维模型的重建精度.2相关工作近些年来,学者围绕着建筑物的三维重建开展了大量研究.基于LiDAR数据的方法虽然可以直接获取建筑物表面的三维点云模型,实现建筑物的快速准确重建,但由于受到其硬件设备的制约,不适用于复杂的天气、地理环境以及具有特殊目的的应用,如军事侦察等[2,6].而基于图像的方法由于不受硬件制约,长期以来受到广泛关注,取得了大量研究成果.1996年,Debevec等人[7]最早讨论了基于照片图像的建筑物建模与绘制的方法,引起了人们对城市建筑物这一特殊模型重建技术的兴趣.该方法通过基于模型的立体视觉分析技术根据真实场景与图像的差异进行建模,可以实现对简单建筑物立面的快速重建,但是不能对包含大量重复结构的立面进行准确重建.Muller等人[8]借助建筑物立面图像的规则语义结构分析,半自动地从图像中分析提取规则矩形的门、窗结构,结合过程建模的方式对复杂建筑物进行重建.虽然该方法能够处理比较复杂的建筑物,但自动化程度不高,而且当重复结构不规则时会产生较大的重建误差.2008年,香港科技大学的Xiao等人[9]提出一种半自动的自底而上的规则结构检测方法,通过预定义简单几何体模型实现建筑物表面结构的三维重建.这种方法对于包含复杂重复结构的建筑物立面重建效果不佳.为了解决这个问题,Xiao等人[10]提出一种基于线结构的对称分割方法,可以有效消除结构分析中的语义歧义,能够对大规模街景进行有效的三维重建,但对于非对称的局部几何细节重建效果较差.Micusik和Kosec-ka[11]则将街景图像拼接成全景图,通过全景序列生成建筑物立面模型,虽然减少了图像集合的数据规模,提高了重建效率,但由于拼接过程中的局部扭曲等造成精度下降.针对互联网上越来越多的大规模无秩序的建筑物图像,Agarwal等人[3]提出了一种自适应的分块SFM求解方法,可以从大量的建筑Page3物图像,尤其是互联网图像重建建筑物的三维模型,这也是目前使用最广的摄像机参数估计及三维几何模型求解方法.Musialski等人[12]则采用交互式的方法进行立面建模,通过添加内部结构协调性约束生成更加精细的建筑物三维模型,但是这种方法的运行时间很长,不适合大规模的结构复杂建筑物重建.图1算法流程(1)局部图像集合的构建.通过SIFT流计算图像之间相似性,从整体图像集合中寻找到与新加入的局部图像相匹配的图像,然后选择匹配最佳的若干张图像,与新图像组成局部图像集合(见第4节).(2)整体和局部点云一致对应.对整体图像集合和构建的局部图像集合分别采用常规方法[5]重建点云模型.通过图像匹配寻找整体和局部点云之间的一致对应点集(见第5.1节).(3)点云模型的融合.求解对应点集的变换矩阵,实现整体和局部点云的融合,最终生成完整的建筑物立面的三维点云模型(见第5.2节).4基于SIFT流的图像匹配算法对于整体点云模型中点云稀疏或者缺失的局部区域,我们重新拍摄一些只包含该局部区域的新图像(C2),并在原始图像集中寻找与新拍摄图像匹配的图像,组成规模较小的新图像集,用以重建局部点云模型.新拍摄的图像数目选择应遵循以下原则:第一,确保能够使用一般的传统算法[5]恢复得到建筑物外立面的局部点云模型;第二,在确保第一条的基础上,尽量使用数目较少的图像,以减少重建所花费的时间.实验表明,新拍摄的图像数目为5~10张为宜,通过新的图像实现建筑物立面几何细节的进一步重建.本文采用基于SIFT流[13]的图像匹配算法,对C2中的任意一张图像I,寻找在C1中的最佳匹配图像J,建立局部图像集合.4.1SIFT流计算SIFT流[13]是度量两幅图像之间SIFT特征分3算法简介本文提出的建筑物立面三维重建算法流程如图1所示.输入的建筑物图像包括原始图像集合C1以及新拍摄的图像集合C2.通过以下3个步骤重建建筑物立面完整的三维点云模型.布一致性的表示.由于SIFT特征描述尺度不变和亮度独立的图像结构,匹配SIFT描述子允许在不同场景内容之间建立一致对应.因此,采用SIFT流可以很好地度量两幅图像之间的局部相似性.给定图像I和J,SIFT流对I中的每一个像素(x,y)定义位移向量(V(x),V(y)).图2(c)展示了从图像I到图像J的SIFT流.4.2建筑物局部图像的匹配根据图像之间的SIFT流,得到集合C1中每一幅图像J与图像I对应的投影图像.投影图像的计算公式如下:其中Iij为图像I通过与图像J之间SIFT流变换后的图像(图2(d)).Page4然后,计算图像I和变换图像之间的PSNR(PeakSignaltoNoiseRatio)值,并以此计算结果来表示两幅图像的相近程度.PSNR值越大,说明两幅图像越相近.PSNR值的计算公式如下:其中,n为图像像素数目,MSE为两张图像之间的均方误差.图3(b)展示其中一幅图像的匹配结果.其中,位于左上角图像为新拍摄的图像集C2中一张建筑图3公共图像集与图像匹配结果5点云融合的建筑物立面三维重建获取整体和局部点云模型之后,接下来需要将两部分点云进行融合.融合算法分为两步:第1步是寻找到两部分三维点云模型中一致对应的点集;第2步是计算变换矩阵,实现整体点云和局部点云的融合.5.1局部点云模型的一致对应我们将整体和局部点云模型分别命名为P1和P2.统计公共图像D中每一张图像在P1和P2中对应的点云数目.具体方法为,对D中的每一幅图像K,读取图像K在V1和V2中对应的点云,命名Pk1和Pk2.那么选择包含V1和V2中对应的点云数目都比较多的图像用来引导点云融合,该图像仍记为K.这样选择的目的是为了提高匹配计算的精度和稳定性.然后计算点云P1和P2分别投影在图像K上的像素位置,记录三维点在共同图像平面上投影点位置坐标.计算公式为物的局部图像,右侧图像集合为原始图像集C1,而最佳匹配图像为左下角图像.对C2中的每一幅图像都采用上述方法求得其匹配图像,最后选择匹配最佳的三幅图像,加入到C2中,组成局部图像集C3.接着采用常规方法[5]重建出建筑物外立面的局部点云模型P2=(X1,X2,…,Xn)T,其中Xi=(xi,yi,zi)T是点的三维坐标;而由原始图像集合C1重建的点云记为P1.由于集合C1和C3中都包含这3幅匹配图像,我们称这3幅图像为公共图像集D(图3(a)).其中,Xi是三维点坐标,犘是图像K对应的摄像机矩阵,xi是Xi投影到图像K上的二维点坐标.P1和P2在图像K上的投影结果分别记为K1和K2,如图4所示.由式(3)计算得到的投影像素点坐标并不是整数,首先将所有投影像素点进行坐标取整;然后对比两张图像中投影像素点的坐标位置,记录坐标值重合的像素点,组成点集合A.我们认为这些点是匹配准确的点.图4展示了坐标匹配的结果.其中,图4(a)上的十字点集合对应K1中的投影像素位置,图4(b)上的叉点集合为K2中的投影像素位置,而通过坐标位置匹配,得到点云之间对应的点集(图4(c)圆点所示).为了进一步提高匹配准确度,我们将点集A中的所有点在K1和K2中对应的像素点记为A1和A2.计算A1和A2中每一对匹配点对之间的距离,将所有匹配点对的距离值按照由小到大进行排序,距离值越小,匹配越准确.实验中我们取阈值为0.5,对于距离小于0.5的匹配点对,我们认为是匹配Page5准确的;反之,则认为是匹配不准确的,并予以去除.最后记录A中剩余点对在点云模型P1和P2中图4投影图像5.2点云融合变换在5.1节我们已经找到了三维点云模型P1和P2中的一致点对Pk1和Pk2.接下来需要寻找一个相似变换T,实现Pk1和Pk2中的所有对应点集的坐标对齐.IterativeClosestPoint(ICP)[14]方法是最常用的三维模型匹配算法.该方法通过不断更新最近点的匹配求解变换,是一个非线性迭代过程.而本文中,由于两个点云模型P1和P2的对应点已知,我们接下来采用具有显式解的方法求解T.变换T由3个参数组成:平移向量犔、旋转矩阵犚和缩放因子s.于是求解问题就变成最小化如下目标函数:E(Pk1,Pk2)=Pk1-(s·Pk2·犚+犔)(4)该函数的优化是Procrustes问题[15],我们采用以下步骤逐步求解相应的变换.(1)计算平移量犔首先计算Pk1和Pk2的几何中心,公式如下:其中,O为三维点云模型的几何中心,Xi是三维点云模型中第i个点的坐标,N是三维点云模型的点云数目.其中,O为三维点云模型的几何中心,Xi是三维点云模型中第i个点的坐标,N是三维点云模型的点云数目.得到Pk1和Pk2的几何中心O1和O2后,平移向量犔就可以很简单地计算出来:实际上,为了计算方便,本文采取了坐标归一化的方法,将Pk1和Pk2的几何中心都平移到原点O.则公式转化为如下形式:对应的三维点坐标,我们仍用Pk1和Pk2.这样,我们就得到了整体和局部点云模型之间的一致点对.(2)计算旋转矩阵犚通过将Pk1和Pk2进行坐标归一化,并且先不考虑缩放因子,公式可进一步简化为为了满足点云模型在变换过程中保证结构的不变性,旋转矩阵犚需要满足刚体变换的约束条件,即det(犚)=1.该最小化问题可以采用OPP(OrthogonalProcrustesProblem)算法[14]进行求解,求解出的最优旋转矩阵犚表达式如下:其中,犝和犞是对PTk2·Pk1做SVD分解得到的特征向量矩阵结果.(3)计算缩放因子s缩放因子s可以通过下面的公式直接求得其中tr(·)是矩阵的迹.通过式(7)、(9)、(10)计算得到平移、旋转及缩放变换后,使用如下公式将P2中的点云变换到P1坐标系下:这样,就实现了整体点云和局部点云的融合P1∪珟P2,完成了整个建筑物立面的重建.6实验结果及分析为了验证本文算法的实验效果,我们使用了多组建筑物图像集合进行测试.这些图像都是通过普通数码相机进行拍摄,在不同视角采集建筑物立面图像,然后通过图像匹配实现点云融合,进而恢复所拍建筑物的立面三维模型.图6展示了部分实验结果.实验运行环境为Intel双核处理器2.27GHz,8GB内存,64位操作系统.表1给出了不同实验运行的时间统计.Page6模型科学馆(图5)42校门(图6(a))36化工楼(图6(b))44表1基于图像的建筑物立面三维模型重建时间统计整体点云耗时/min29.06.02.524.07.52.533.56.52.5图5科学馆三维模型重建图6校门及化工楼三维模型重建Page7由图6(a)中的整体点云可以看到,校门右上角的区域点云是缺失的,这可能是由于没有拍摄到该部分的图像,或者图像特征匹配较差造成.对这部分使用本文提出的融合算法进行了修补;经过图像匹配和点云融合后,本文算法对西安交通大学北门右上角区域的点云已经进行了补充,而且局部细节纹理也更加清楚.重建的结果能够体现整个校门的几何模型.而采用一般的重建算法[5],并没有获得更好的重建效果,重建的三维模型局部几何细节较差.分析其原因有两个:第一,由于图像数目的增多,造成了部分干扰物也重建出来,从而带来一些杂点;第二,图像数目的增多,也增加了特征点匹配和摄像机参数估计错误的概率,从而造成重建效果差.图6(b)展示了另一个建筑物侧面的重建效果及对比.从重建时间(表1)来看,在整体点云模型的基础上,当加入新的图像时,采用“匹配+融合”方法进行重建比一般的方法节省50%以上的时间,尤其是当采集图像的数量较大时,优势更加明显.因此本文算法具有较高的运行效率,可以极大地节省建筑物立面三维模型重建时间.7结论本文针对重建出的建筑物外立面点云模型中局部点云缺失或者过于稀疏的问题,提出了一种基于二维-三维图像融合的三维重建算法,对点云模型的局部进行融合修补,得到了结构和细节更加完整丰富的建筑物外立面三维点云模型.与一般方法相比,本文提出的方法可以在保证重建精度的前提下,大大减少重建时间,提高重建效率.当然,本文算法也存在不足,需要进一步改进.第一,本文算法依赖于SIFT流检测图像之间的相似性,对于视角变化剧烈的非平移运动效果较差.这一问题可以通过在拍摄新的局部图像集合时控制平移运动量解决.第二,本文算法只考虑了模型中存在点云缺失或者稀疏的问题,而没有考虑模型中存在噪音的问题.在后续工作中应考虑如何去除多余的噪音,以进一步提高重建点云模型的精度.致谢衷心感谢匿名审稿专家,他们对本文提出了宝贵的修改建议!
