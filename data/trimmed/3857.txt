Page1基于熵和局部邻域信息的高斯约束CV模型卢振泰郑倩冯衍秋刘燕杰冯前进陈武凡(南方医科大学医学图像处理重点实验室广州510515)摘要基于曲线演化的Chan-Vese(CV)模型常常不能准确分割非均匀性且结构复杂的医学图像.针对此缺点,文中提出了一种基于熵和局部邻域信息的高斯约束CV模型,作者利用熵构造内部和外部区域能量的权值系数,加强了对曲线演化的控制;同时将曲线上各点的局部邻域信息引入到曲线演化过程中,提高了分割的准确性,并降低了区域内灰度不均匀等因素对曲线演化的影响;高斯约束保证了曲线演化过程中的稳定性、光滑性,同时不需要曲线周长约束项和重复初始化.利用CircularHough变换对左心室壁内、外膜进行初始定位,避免了人工设置初始轮廓,减少了曲线向目标轮廓演化时间和初始轮廓位置敏感性对分割结果的影响.作者对心脏MR图像的左心室内、外膜进行了分割.结果表明文中方法能够快速准确地分割左心室壁内、外膜,抗干扰能力强,鲁棒性好.关键词Chan-Vese(CV)模型;CircularHough变换;熵;邻域信息;高斯核函数1引言医学图像分割是从医学图像中提取特殊组织信息的一个必不可少的步骤,由于人体解剖的个体差异较大,临床应用对医学图像分割的准确度和算法的执行速度要求较高;医学图像的部分容积效应和有些组织区域的不确定性,决定了医学图像具有不可避免的模糊、边界和区域特征不明显等特点.左心室承担着向全身各处组织供血的功能,因此,左心室壁内膜与外膜的分割一直是内科医生所感兴趣的内容.由于实际的临床磁共振图像存在较严重的不确定噪声、不均匀性以及组织器官解剖结构复杂等原因,使得现有的算法的分割效果不尽人意.活动轮廓模型[1]结合了几何学、物理学和近似理论的知识,综合利用区域和边界的信息,通过使用从图像获得的约束信息对目标进行分割.活动轮廓模型可以较好地克服医学图像中的噪声对图像分割的影响,在运动跟踪和图像分割领域得到了广泛应用[2].活动轮廓模型主要分为两类:参数活动轮廓和几何活动轮廓.参数活动轮廓模型极其复杂,在曲线演化过程中不易处理拓扑结构变化,且对初始轮廓位置比较敏感,而几何活动轮廓由于采用了水平集方法克服了参数活动轮廓的缺点,得到了广泛应用.Mumford-Shah模型[3]和Chan等人[4]提出的简化Mumford-Shah模型的分割模型即Chan-Vese(CV)模型是完全不依赖梯度信息的基于区域信息的几何活动轮廓,克服了基于边缘的几何活动轮廓模型的全局性差、不易分割弱边缘和对噪声敏感的不足.CV模型作为一种有效提高曲线演化时拓扑自适应能力的分割模型,是图像分割领域中一种有效的研究工具,但是CV模型仅将灰度同质作为区域分离的准则,只能用于包含目标和背景两个不同均值区域的高对比度图像分割中.CV模型对非均匀性和结构复杂性广泛存在的医学图像的分割并不太理想,Vese和Chan[5]提出的PS(PiecewiseSmooth)模型和Li等人[6]提出的LBF(LocalBinaryFitting)模型都是改进的CV模型,PS模型引入了两个分段光滑函数代替CV模型中的两个灰度均值常数,因此该模型可以用来分割非均匀图像,但是每次都要利用偏微分方程求解两个分段光滑函数,计算量大,且模型高度复杂;LBF模型分割效果优于PS模型,减小了计算量,利用核函数定义了一个区域二值拟合能量,但该模型对于不同区域的强度不均匀性没有区别考虑,需要反复计算图像数据,计算量仍不小,曲线演化速度慢,限制了其在医学图像分割中的应用.基于熵和局部邻域信息的高斯约束CV模型非常简单,算法执行速度快,该模型首先利用霍夫变换检测到初始轮廓位置,避免了手工确定初始轮廓;其次以熵作为能量函数中内部和外部区域能量的权重系数,自动调节两个区域同质性在能量函数中的权重,以提高对曲线的控制;在曲线上的点的邻域内计算局部区域能量,用这些能量之和作为图像的内部能量,加强对边缘信息的检测,并减小区域内部信息对能量函数的影响,提高了分割的准确性;最后利用高斯约束保证曲线演化过程中的稳定性和光滑性,避免了水平集函数每次更新后的重复初始化,降低了曲线演化的时间.本文第2节介绍本文算法所涉及的基本理论内容;第3节描述本文提出的基于熵和局部邻域信息的高斯约束CV模型和变分形式;第4节验证本文算法的可行性;第5节是结论.2基础理论2.1圆形霍夫变换霍夫变换可以从图像中分离几何形状,鲁棒性强.Duda等人[7]提出的CircularHough(圆形霍夫)变换是一种改进的霍夫变换方法,目的在于从图像中识别圆形物体.CircularHough变换的基本原理是利用点和线的对偶性,将原始图像中的给定曲线变换到参数空间的一个点,这样就把寻找原始空间中一条曲线的问题,转化到寻找参数空间中峰值点的问题.圆心位于(a,b)处的圆定义如下:2.2Chan-Vese(CV)模型CV模型假设图像中只有目标和背景两类分片光滑区域时,定义域为Ω的图像I(z)被任意闭合曲线C划分为目标(内部区域Ωi)和背景(外部区域Ωo)两个同质区域,两区域的灰度均值分别为c1和c2.CV模型的图像能量泛函如下:ε(C,c1,c2)=μL(C)+νS(C)+λa∫inside(C)其中,μ0,ν0,λa>0,λb>0是各项能量的权值系数,L(C)为闭合曲线C的长度,S(C)为曲线C的内部区域面积,前两项是平滑项,取值越小,曲线越光Page3滑.后两项为保真项,当曲线C位于目标边界时,能量ε(C)达到最小值.设闭合曲线C是符号距离函数的零水平集,即C={x|(x)=0},并设为内正外负,即(inside)>0,(outside)<0,以水平集函数表达的能量函数和曲线演化方程为ε()=μ∫Ωδ()||dz+ν∫ΩH()dz+c1=∫ΩI(z)H()dzt=δ([)μdiv(λa|I(z)-c1|2-λb|I(z)-c2|2]烅烄烆其中,δ()和H()分别是Dirac函数和Heaviside函数,div函数的拟合能量项:F()=λa|I(z)-c1|2H()+λb|I(z)-c2|2(1-H())当曲线内外部灰度与其平均灰度接近时,能量达到最小值,即∫Ωi|I(z)-c1|2dz≈0,∫Ωo即当内外部区域同质性在能量函数中保持平衡时,能量最小.CV模型对同质区域划分时仅考虑两个区域的灰度信息,因此容易将内部灰度差较大的一个区域分割开来,灰度差较小的两个区域分割成一个区域.由于在医学图像中,灰度不均匀性与结构复杂性广泛存在,故CV模型在医学图像中的应用还存在许多问题.其次,水平集函数每次更新后,需要重新初始化为符号距离函数,但该过程往往计算量较大.基于此,本文提出了一种基于熵和局部邻域信息的高斯约束CV模型.3ELCV模型与GRELCV模型3.1基于熵和局部邻域信息的CV模型(ELCV)医学图像分割可以引入信息论中的最大香农熵准则、最大交叉熵准则、最小交叉熵准则、Tsallis熵[8]等作为客观判断依据,熵是平均信息量的表征,其定义是其中p(x)是随机变量x的概率密度函数.设pi(x|),po(x|)分别为图像中曲线内部区域和外部区域的概率密度函数,熵描述了该区域的边界点在统计分布上的相似性,熵取值越大说明该区域的分布差异越大.引入水平集函数表示的曲线内部和外部区域的熵如下:对于非均匀目标图像的分割,CV模型中的权值参数不易设置,其分割效率及准确性仍然有待提高.CV模型中参数λa和λb固定,没有考虑曲线演化过程中内部和外部区域的同质性信息,本文用熵代替λa和λb作为曲线内外部能量的权值系数,熵随着曲线的演化而自动变化,自适应的调节内外部区域同质性所占的比重,得到的图像拟合能量为F()=Ei()|I(x)-c1|2H()+当pi(x|)>po(x|)时,说明点x在曲线内部的分布相对于在外部的分布有‘优势’,即Ei()<Eo(),因此,以Eo()作为外部区域局部能量的权值,来增大外部区域同质性的比重.当pi(x|)<po(x|)时,以Ei()作为内部区域局部能量的权值,增大内部区域同质性的比重.当pi(x|)=po(x|)时,曲线内外部的概率密度相等,即点x位于图像目标边界,Eo()=Ei(),能量达到最小值.由于CV模型划分区域时仅考虑区域信息,在对非均匀目标的图像分割中,模型能量容易受到区域内部灰度不均匀和结构复杂的影响.当两个区域内部出现部分灰度较为接近的情况时,模型不仅不能进行准确的分割,而且迭代过程需要对所有图像数据进行反复计算,分割效率差.本文在对非均匀图像进行分析时,考虑曲线上的点的局部邻域信息,用这组点的局部能量之和作为能量函数中的内部能量[9].曲线演化过程中,沿着曲线的点的局部邻域被演化曲线划分为内部和外部两个区域,如图1所示,圆形轮廓为进化曲线,方形框格是曲线上的白色点的邻域轮廓,深色箭头指向邻域的外部区域,浅色箭头指向邻域的内部区域.直到每个局部区域都与模Page4型匹配时,能量达到最优化.曲线的演化与曲线上的点的邻域信息有关,加强了对边缘的检测,同时曲线不再受区域内部灰度不均匀的影响,提高了分割质量.模型不再对整幅图像进行计算,只需要计算曲线上的点的局部邻域能量,加快了曲线收敛速度,提高了分割效率.设图像I(x)上第j点的邻域为Ωj,曲线C将Ωj划分为内部和外部两个局部区域,内部和外部区域的局部灰度均值uj和vj分别表示为Fj()=Ej由于计算内部能量F()时,只考虑曲线上的点的局部能量,忽略各区域内部不均匀的影响,故在式(12)中加入Dirac函数δ(),因此图像内部能量就是沿着零水平集的每个点的邻域的能量之和,ELCV模型的能量函数为ε()=μ∫Ωδ()||dz+ν∫ΩH()dz+根据欧拉-拉格朗日方程,可以得到曲线演化则邻域Ωj的局部区域能量为方程:(z)t=δ((z))μdiv(z)其中,Fj()=δ()(Ej方程中曲线内部面积的权值参数ν不再受取值范围限制.3.2基于熵和局部邻域信息的高斯约束CV模型(GRELCV)传统的水平集方法中,为了防止水平集函数过于陡峭或平滑,保持演化曲线的稳定性及避免错误的分割结果,水平集函数必须初始化为到其表面的符号距离函数(SignalDistanceFunction,SDF)[10-12].在曲线的演化过程中,不断地重复初始化退化的水平集函数,不仅十分耗时,并且导致零水平集远离原始轮廓位置.当水平集函数符合符号距离函数时,即||=1,为了扩大捕获范围,平滑项div(/||)δ()可以写成div(/||),此式是的Lapalacian算子,Shi等人[13]提出当曲线按照其拉普拉斯算子演化可以看成是对其进行高斯滤波,表示如下:其中,Δt是时间步长.在曲线演化过程中,我们对每次迭代更新的水平集函数进行高斯滤波,保证了进化过程中曲线的光滑性和稳定性,且不需要重复初始化退化的水平集函数,提高了分割精度和效率.其次,由于在曲线演化过程中用高斯核函数约束水平集函数,可以省略传统水平集函数中的平滑项div(/||)δ()[14],不需要重复选择光滑项的参数μ,使得算法更为简单.基于熵和局部能量的高斯约束CV模型(GRELCV)以水平集函数表达的能量函数和曲线演化方程为ε()=ν∫ΩH()dz+∫Ω∫Ωδ()Fj()dxdz(17)t=δ((z))-ν-∫ΩFj((x))d(z)4实验结果与分析为了验证本文算法的分割效果,我们对大量医学图像进行了分割实验.实验是在IntelCore3.0Hz,Windows72GB内存的PC机、Matlab7.11平台上实现的.时间步长Δt=0.5.4.1初始化实验相比较利用整幅图像信息的活动轮廓,局部邻域信息的引入给活动轮廓模型带来了对初始轮廓位置敏感的缺点,本文的解决方法是利用CircularPage5Hough变换确定初始轮廓位置.在活动轮廓模型中,初始轮廓位置如果远离目标,不仅增加曲线演化时间,而且容易造成错误的分割结果.考虑到活动轮廓模型对初始轮廓位置的敏感性,左心室壁内、外膜都是类圆形(图2(a)箭头所示),本文使用霍夫变换检测MR图像中的圆形目标,将CircularHough变换检测过程中拟合的圆形曲线作为初始轮廓,如图2.此方法对待分割目标进行初始定位不仅极大缩短曲线向待分割目标演化时间,且无需人工手动选择合适的初始轮廓,提高了分割结果的准确性.图3心脏分割结果对比(有运动伪影)4.2CV、LBF、ELCV和GRELCV模型的对比实验我们对暗血成像技术所得到的矢状位心脏图像进行分割实验.本文提出的方法可以单独分割左心室壁内膜和左心室外膜,也可以对心室壁内外膜同时分割,图3为对心室壁内、外膜同时进行分割结果图(图像大小256×120).图3(a)中左心室内有肉柱和漂浮的乳突肌,心室外的腹腔器官等结构复杂并与心壁的灰度十分接近,心室壁内膜处运动伪影较为严重,这些情况给分割心室壁内、外膜造成了困难,会导致分割的内、外膜边界不够光滑甚至是错误的分割结果.图3(a)中圆形为CircularHough变换结果,作为各个活动模型的初始轮廓;图3(b)是CV模型迭代200次的结果,λa=1,λb=1,μ=0.5×255×255,ν=0.2,曲线演化时达到一个极小值就不向边界处进化;图3(c)是CV模型迭代500次的分割结果,曲线演化到心壁处的一个极小值处不再向心壁内外膜进化,且心室内漂浮的乳突肌发生错误分割,受区域灰度不均匀的影响,心室外部较远的腹腔脏器也被当成待分割目标,该部分误分割的目标区域随着迭代次数增加有继续扩大趋势;图3(d)是Page6LBF模型迭代200次的分割结果,μ=0.03×255×255,ν=0.2,该模型引入了核函数可以处理由于磁共振成像方式引起的灰度非均匀图像,但对于复杂的医学图像其分割结果却不如CV模型;图3(e)是LBF模型迭代500次的分割结果,该模型将心室壁毗邻的很多器官误分割为目标;图3(f)是ELCV模型迭代150次的分割结果,利用局部邻域信息的熵加权后CV模型减小了血液的高速运动冲撞心肌壁造成的伪影等引起的图像灰度不均、乳突肌等对分割结果的影响,加强了对曲线演化的控制,使得曲线只在目标边界处活动,在曲线距离较远处不会出现错误的分割结果,曲线准确地向目标边界逼近,但是ELCV在计算水平集函数时基于点到点,边界不够光滑;图3(g)是GRELCV模型迭代150次的分割结果,ν=-0.2,由于该模型添加了高斯约束项,水平集函数每次更新后不需要重复初始化,保证了曲线演化的稳定性,也不需要设置曲线周长项权值参数μ,该模型快速准确地将左心室壁内外膜分割出来,边界清晰、光滑;图3(h)是专家手动的分割结图4心脏分割结果对比(有运动伪影)果,作为标准图像(ground-truth)验证自动分割算法的可行性,从图中可以看出,GRELCV模型分割的心室壁内、外膜与手动算法较为相似.图4中右心室与左心室粘连且灰度相近,脏器器官与心壁粘连,容易被当成目标处理(箭头所示,图像大小256×120).各个分割模型的参数设置同上个实验.由于利用了CircularHough变换进行待分割目标的初始定位,控制曲线在目标边界附近,降低了图像中心室内部和外部区域灰度不均匀的影响,但是随着迭代次数的增加,CV模型还是将与心壁灰度相近的腹肌误分割成目标区域;LBF模型引入了核函数可以处理磁共振成像方式引起的灰度非均匀图像,但对于复杂的医学图像其分割结果却不如CV模型;ELCV利用熵自适应的控制曲线背景和目标区域的同质性,局部邻域能量代替整幅图像的灰度均值的方法减小了远离曲线区域灰度不均匀的影响,加强了对曲线演化的控制,使得曲线准确地向目标边界逼近,提高了分割质量,但是曲线不够光滑,且每次水平集函数迭代更新后需要重新初始化;Page7GRELCV除了具有ELCV的优点外,又利用了高斯核函数进行约束,不需要重复初始化,加快了分割的速度.图5(a)中左心室与右心室粘连,灰度相近(深灰色箭头所示);左心室内不仅有漂浮的乳突肌,且有乳突肌与左心室壁内膜粘连在一起(白色箭头所示),给分割心室壁内、外膜增加了困难(图像大小256×144).实验参数设置与上述实验一样,图5(a)是CircularHough变换结果,检测的圆作为活动轮廓模型的初始轮廓;图5(b)是CV模型迭代200次的结果,该模型的演化曲线不能准确逼近目标轮廓,同时误将与待分割目标灰度相近的乳突肌分割为目标;图5(c)是CV模型迭代500次的结果,不仅心室内漂浮乳突肌误分割为目标,远离曲线与待分割目标灰度相近的脏器器官也误分割为目标,该部分误分割的目标区域随着迭代次数有继续扩大趋势;图5(d)为LBF模型迭代200次的分割结果,模型图5心脏分割结果对比(有运动伪影)由以上实验可知,设置相同的实验参数,ELCV和GRELCV能获得满意的分割结果.为了客观地比较各种模型的分割结果,本文用重叠率(Dice)、误分割率(ME)[15]和HausdorffDistance[16]作为量化标准,验证本文算法的可行性.引入了核函数可以处理磁共振成像方式引起的灰度非均匀图像,但对于复杂的医学图像其分割结果却不如CV模型;图5(e)为LBF模型迭代500次时ELCV模型迭代150次的结果,因加入了局部邻域信息,减小了区域灰度不均匀对演化曲线的影响,该模型准确地把心室壁内远离内膜的乳突肌分割为背景,同时准确地分割出心室壁内、外膜,但是边界出现毛刺,不够光滑;图5(f)为ELCV模型迭代200次的结果,该模型分割的左心室壁内膜和外膜光滑,边界清晰,但是与心室壁内膜粘连的乳突肌误分为目标;图5(g)为GRELCV模型迭代20次的结果,迭代次数减少,曲线还未演化到与心室壁粘连的乳突肌,演化曲线准确地逼近心室壁内、外膜,该模型准确地分割出心室壁内、外膜,曲线光滑;图5(h)为临床专家手动分割的左心室内、外膜,定性分析各个模型的分割结果.ME=1-|BMaunal∩BAuto|+|FMaunal∩FAuto|HD(FManual,FAuto)=maxh(FManual,FAuto),h(FManual,FAutoPage8其中,h(FManual,FAuto)=maxx∈FManualBMaunal和FMaunal是人工分割的标准图像的背景和前景像素集合,FAuto和BAuto是自动分割算法的前景(目标)和背景像素集合,|·|是集合的基数.从表1可以看出,CV模型受各区域非均匀性影响,随着迭实验方法迭代次数λaλb表1实验方法对比CVLBFELCVGRELCV4.3重复初始化水平集函数和高斯约束水平集函数的时间对比实验传统的水平集方法中,为了保持演化曲线的稳定性以避免错误的分割结果,水平集函数需要重复初始化为符号距离函数,这项工作不仅十分耗时,并且会使零水平集远离原始轮廓位置.为了避免重复初始化迭代更新的水平集函数,在曲线演化过程中图6重复初始化和高斯平滑水平集函数时间对比代次数增加,误分割部分逐渐增大,前景重叠率越来约小;ELCV和GRELCV模型由于用熵作为前景和背景的加权系数,加强了对曲线演化的控制,利用了局部邻域信息,减小了各区域内部不均匀性对曲线演化的影响,曲线收敛得更快,提高了分割质量,同时改进的模型对参数设置较松.νDice-0.100.92290.00292.0000-0.050.92810.00262.0000-0.050.92810.00262.0000-0.150.91390.00332.0000-0.050.92730.00272.0000-0.050.93250.00252.0000-0.200.94720.00191.7321-0.250.94160.00222.0000-0.200.95180.00181.7321-0.250.94080.00222.0000-0.200.95280.00171.73210.250.94410.00212.0000加入高斯约束项,保证了演化曲线的稳定性、光滑性,同时降低了曲线演化时间,如图6所示,实线为GRELCV模型中曲线演化过程中高斯核函数平滑水平集函数所需时间,虚线为CV、文献[11]和ELCV曲线演化过程中重复初始化水平集函数所需时间,高斯核函数平滑水平集函数和重复初始化水平集函数在整个迭代过程中的执行时间均呈线性增长趋势,但前者执行时间远远小于后者的执行时间,随着迭代次数的增多,这种效果更加明显.4.4不同的初始轮廓敏感实验由于改进的CV模型引入了局部邻域信息,ELCV和GRELCV模型均对初始轮廓位置非常敏感,如图7所示,实验参数设置与图3相同,迭代次数均为150次,初始轮廓位置不合适,不能得到满意的分割结果.本文用CircularHough变换确定初始轮廓位置,得到了准确的分割结果,如图3所示,同时减少了曲线向目标演化的时间.Page9图7初始轮廓位置影响实验5结论本文提出了一种基于熵和局部邻域信息的高斯约束CV模型,并将该模型运用到左心室壁内、外膜的分割中.考虑到心室的形状先验信息,我们先用CircularHough变换检测圆的方法对左心室进行初始定位,将检测拟合的圆形作为CV模型中曲线演化的初始轮廓,克服了活动轮廓模型中初始位置敏感的缺点,同时降低了曲线向目标轮廓演化的时间;熵代替权值参数λa和λb,曲线在进化过程中可以自适应地调节目标和背景区域同质性的比重,加强了对曲线演化的控制;同时将曲线上的点的局部邻域信息引入到曲线演化过程中,降低了区域内灰度不均匀等因素对曲线演化的影响,提高了分割的质量;高斯核函数平滑每次迭代更新的水平集函数,保证演化曲线的光滑性、稳定性和高效性,不需要重复初始化水平集函数,降低了算法的执行时间,同时去掉CV模型中的曲线周长项,即不需要设置参数μ.通过对心脏MR图像进行分割,结果表明,本文所提出的方法能够快速准确地分割左室壁内、外膜,抗干扰能力强,鲁棒性好.并且,本文方法不局限于医学图像,可以用于一般的圆形物体检测和分割.致谢匿名审稿老师对本文提出了宝贵的修改意见,在此表示感谢!
