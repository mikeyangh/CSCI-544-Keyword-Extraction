Page1一种有效识别正版视频的TDIA算法周国瑞1)王文江2)孙世新1)1)(电子科技大学计算机科学与工程学院成都610054)2)(龙旗科技(上海)有限公司工程部上海200233)摘要结合视频压缩标准、脆弱数字水印及视频通信技术,文中提出一种有效识别正版视频的TDIA算法.它包括嵌入算法和识别算法两部分.为消除通信干扰对水印的影响,将迭代方法引入识别算法.基于盗版操作与通信干扰的本质不同,研究讨论了迭代方法的性能.最后,基于迭代结果,借助ChernoffBound理论,分析了TDIA算法的识别误差.对于码流BER(BitErrorRate)10-3、视频I帧总数n360的Mpeg2编码视频,该算法识别误差小于10-18.关键词脆弱数字水印;正版视频;盗版视频;录制盗版;Mpeg2编解码器1引言保护正版视频版权关键要做好传输及终端消费两个环节的安全[1].传输安全包括链路安全及接入安全,目前技术较为成熟,主要由网络协议(如SSL、Page2御两种措施.主动禁止是用技术手段主动阻止非法copy,比如,在消费电子装置中配置copy保护,根据CCI(CopyControlInformation)进行copy控制[3-4],主动禁止可以阻止点到点copy[5],但无法阻止用户用录像机等外设对着正在播放的视频屏幕进行视频录制盗版(camcorderpiracy),见图1(a),这种威胁源于analoghole[5].被动防御旨在禁止对非法拷贝的使用和散播,它是在盗版发生之后,对盗版视频版本的禁播、追踪或进一步对肇事者进行的追踪,从而威慑授权用户不要进行散播侵权.被动防御的主流技术有视频指纹(videofingerprinting[6-7]或VideoDNA①)及抗共谋数字指纹技术(anti-collusionfingerprinting)[8-10];两者都要求鲁棒性,即只要视频的视觉内容没有被改变,前者认为其中的VideoDNA没有被改变,后者认为嵌入其内的代表授权用户信息的数字水印(数字指纹)依然存在;因此,利用前者可以进行视频内容检索,利用后者可以进行肇事者追踪.而两者都不区分视频是正版还是盗版,但这种区分是必要的;鉴于此,本文提出了正版视频识别算法,它与这两种技术的有效结合,能推动被动防御的进展.在本文,版权所有者持有的视频版本为正版视频,不妨记为A;由A仅遭受正常通信信道干扰后形成的视频版本也是正版视频.盗版视频指通过基于analoghole[5],用录屏方式获得的视频,但盗版者为规避检测,可能对其进行修改加工.在主动禁止实现后,录屏是唯一的盗版方式,目前,也很流行[11].本文所提TDIA(Disturbance-tolerantIdentifi-cationAlgorithm)算法旨在判定视觉内容一致的视频[12]集中,哪些是正版哪些是盗版.应用模型见图1,图1给出了所提算法与VideoDNA技术结合实现盗版过滤及禁播功能的示意.首先通过VideoDNA技术提取待审核视频的DNA,并到DNAdatabase库中查询,若找到与之相匹配的,则说明待审核视频含受版权保护的内容,因此,需要启动正版视别程序进行正版识别并根据识别结果做出相应处理.图1(a)为视频共享网站(如YouTube[13]、优酷、土豆网等)对Upload视频审查过滤示意图.图1(b)为网络终端对受保护视频的盗版禁播示意图.另外,由于当前在IPTV、3G视频通信中常使用RTP/UDP/IP传输协议[14],而UDP并不保证可靠性和顺序性,所以前端数据并不能保证无误差地传送到终端,终端播放器常利用差错探测、差错控制及差错复原机制来屏蔽所接收视频流中的误码及丢包,尽量给人以流畅的视频感受.在这种环境中,终端播放的视频与前端下发的视频常存在一定的数据差异,并且该差异由通信时信道状况决定.有线信道的通信干扰远小于无线信道,采用足够FEC(For-wardErrorCorrection)[5]及interleaving技术的无线信道通信干扰相当于BER(BitErrorRate)在10-4~10-3范围的BSC(BinarySymmetricChan-nel)信道[15].TDIA算法在设计时考虑了对正常通信信道干扰的容忍.本文第2节介绍录屏盗版的特点、数字水印及盗版视频识别算法现状;第3节给出基于脆弱数字水印技术,能容忍正常通信信道干扰的TDIA算法;第4节对TDIA算法性能进行整体测试;第5节全文小结.2相关技术分析录屏盗版分为外置和内置两种方式.外置指用摄像机、照相机、手机等外设对着正在播放视频的屏幕进行的录制.由于录制时所采用的坐标系[16]、颜色空间、空间和时间采样率都难以保证与播放视频相同,因此同原视频相比,录制的视频存在如下变化:(1)由仿射变化及投影变换[16-17]导致的几何型变,(2)帧率变化,(3)像素值变化.内置指在播放视频的设备上安装录屏软件,使用录屏软件录屏.像CamtasiaRecorder、Screensnap等计算机录屏软件可以实现录制时的坐标系、空间及时间采样率与所播放的视频相同,仅存在由D-A和A-D转换带来的像素值损失.因此,外置比内置录制效果差,但是①VobileannounceslandmarkdeploymentofVideoDNA?con-tentindentificationandmanagementsystem.http://www.Page3目前外置录屏效果已经具备一定的观赏价值[11].当正版视频与这些录制的盗版视频混在一起的情况下,如何识别出正版和盗版视频呢?借助文献[4]的思想,可以用不可见鲁棒水印“illegalcogy”标识盗版.正版视频在嵌入该标记后播放,这样,如果录屏盗版,则该标记一并被录制到盗版视频中.通过识别“illegalcogy”标识,来识别盗版.该思想存在如下不足:(1)播放的视频是叠加了鲁棒水印的视频.同脆弱数字水印相比,鲁棒水印对视频质量影响较大.(2)在camcorderpiracy等录屏盗版下,鲁棒水印的存活和检测是个难题;(3)不同的视频,叠加了相同的鲁棒水印(“ille-TDIA算法,基于脆弱数字水印[18]标识正版,galcopy”),难以抵制移去攻击.弥补了这些不足.3TDIA算法TDIA算法分为水印嵌入及水印提取正版识别两部分.结合视频编码标准、对盗版操作脆弱、视频相依、密钥级安全以及保证一定的水印嵌入量,设计了3.1节嵌入算法.3.2节分析了信道干扰对水印的影响,3.3节给了排除影响的迭代算法,3.4节给出了盲识别算法.3.1嵌入算法在Mpeg2、H.264视频编解码标准中,DCT变换以像素块(Block)[19-20]为单位进行,I帧亮度分量的MB(Maroblock)[19]中每4个这样的Block组成1bit水印承载单位WB(WatermarkBlock).以编码时WB中4个Block的量化后DCT系数[19-20]为基础,嵌入水印,并压缩编码成正版视频.水印嵌入算法基本步骤如下:1.寻找各个WB的水印嵌入点.判定在WB最后编码的Block中,按照zigzag扫描顺序第Tembed(阈值)个扫描系数之后的系数中是否存在非零值AC系数;如果有,则选择该扫描顺序最后的非零值AC系数(Aclast)作为水印嵌入点,转步2;否则在这个WB不进行水印嵌入;2.计算水印.记WB的4个DC系数值分别为Dc0,…,Dc3,令a=(|Dc0|+|Dc1|+|Dc2|+|Dc3|)/4;其中k1∈(0,1)为水印密钥,显然x0∈(0,1).将x0及λ=4作为初值和参数,代入logistic[21]映射迭代式(2);并根据密钥k2,按式(3)计算水印w:其中,floor(·)为向下取整函数.3.嵌入水印.当w=0时,Aclast需为偶数,不为偶数时按下式进行更改:当w=1,Aclast需为奇数,不为奇数时按式(4)进行更改.水印嵌入时机之所以选择量化后DCT系数(亦是解码时反量化前DCT系数),是为了减少量化操作对水印的改变以及避免量化步长的错误对水印检测的影响.考虑到VLC编码规则,式(4)在设计上尽量使|Aclast|变小,以便水印的嵌入不增加视频码长.由λ=4的logistic混沌序列性质[21],式(3)中w等于0或1的概率各为50%,对整个视频来说嵌入0或1的总量基本相等.使用k1、k2两个水印产生密钥,由混沌映射对初值具有敏感性,导致水印难以被统计估计,即使在嵌入算法公开的情况下,安全系数也比较高.3.2信道误码对水印的影响分析传输层二进制视频流的数据结构见图2(a),HD(头信息)及语法参数数据量相对较少,常采用Reed-Solomoncode等容错编码技术进行保护.Videocodeddata占视频比特流的98%左右[22],由于数据量大,难以采用保护措施,因此,是信道误码的多发区域.Videocodeddata是用VLC编码对视频的DC值、AC值、游程长度以及宏块地址增量、宏块类型、块编码模式等进行的二进制编码[19],图2(b)给出了其数据结构,为便于说明信道误码的影响,将VLC编码的DC数据表示为DC,Block的结图2传输二进制流结构及误码引起的块合并示意图Page4束表示为EOB(EndofBlock).图2(c)是图2(b)中的EOB及DC被信道误码干扰成另一个VLC码字后,引起的块合并示意图.Videocodeddata对信道误码非常敏感,当含有信道误码时,视频解码器在解码时就会遇到以下情况:(1)无效VLC码字.通信干扰导致VLC码字无效.(2)越界.通信干扰虽未导致VLC码字无效,但导致VLC码字分解或合并,从而出现:DC、AC、量化因子、运动矢量、宏块地址增量等值越界;块解码的DCT系数总个数超过允许的最大值;Slice[19]解码Block总数不等于应解码总数,特别非EOB被干扰成EOB时,块被分割,EOB被干扰成非EOB,块被合并(图2(c)所示).以上错误统称为语法错误(syntaxerror)[23],这些错误中,只有当DC、AC值越界后,解码器将其修改为默认值,对其它语法错误,标准解码器不对其进行更改,而是直接跳到下一个同步标记处(Slice头)重新开始解码[19].另外,在标准解码器正常解码的slice中,仍可能存在由信道干扰所致的隐藏错误[24],例如:(1)某个块或某些块的AC系数错误;(2)DC系数错误,由于DC系数是预测差分值(DPCM)编码,一个块的DC系数错误,可以导致基于其进行DPCM解码的后继块DC系数错,直到同步标志处为止.因此,信道误码bit位发生位置的不确定性,导致了DC、AC系数错误率的不确定性.故在没有原始videocodeddata的情况下,无法找到信道误码率与水印错误率之间的精确关系.3.3排除信道误码对水印识别的影响由3.2节分析知,应该避免对信道干扰的MB(Macroblock)[19]进行水印提取,但是在没有原始视频的情况下,无误差地找出这些MB几乎是不可能的.目前,可以用标准解码器识别语法错误,而隐藏错误识别是难点.因此,提出了如下计算每个含水印错误I帧最终水印错误率ε1的迭代算法,以消除隐藏错误对水印的影响.迭代算法基本步骤为1.初始化参数TS=TSo,Tac=Taco,T3=T3o,MDb=MDbo;d1=d1o,d2=d2o,d3=d3o,d4=d4o;2.赋值S={MBi|i=1,2,…,N},其中MBi为I帧中被标准解码器正常解码的亮度宏块;N_e[0]=S中错误水印总数;N_c[0]=S中水印总数;berror[0]=N_e[0]/N_c[0];j=0;3.迭代排除While(MDb>0Tac>0)(N_e[j]>0j=j+1;x[j]=0;y[j]=0;If(N_c[j]>0)Tac=Tac-d2;MDb=MDb-d4;If(MDb0‖Tac0)(N_e[j]>0N_c[j]>}4.计算ε1Ifj<5ε1=min(berror[j]);Else判断MB存在AC错误的规则为:MB各Block中若一个Block存在AC系数错误,则该MB存在AC错误.将视频I帧亮度分量VLC解码并反量化到反DCT变换前,对每个Block的AC系数进行错误检测,具体方法[24]:记S=∑64|AC64|}.若S>TS且ACmax/S>Tac,则此Block存在AC错误.Page5判断MB存在DC错误的规则为:将I帧亮度分量解码到像素层,利用空域平滑特性进行DC错误检测[25].如图3所示,currentMB、leftMB和topMB分别表示待判断的MB、与其相邻的左边及上边MB,Pini、Pouti分别为currentMB的第i个及其邻块的第i个边界像素值.当topMB存在时,currentMB与topMB的边界差异Dbt=1当topMB不存在时,Dbt=0;currentMB与leftMB的边界差异Dbl同理计算;令Db=1Dbl),若Dbt与Dbl中之一为零,则K=1;否则,K=2.令TDb=u+MDbρ,其中,u=1N为currentMB所在I帧中已经检测过且不含隐藏错误的MB数目,uj为第j个无错MB的Db值.如果Db>max{TDb,T3},则currentMB中含有DC错误.随着迭代次数的增加,可形成集合{berror[j]},berror[j]为第j步排除完成后S的水印错误率,理论上,当S中不存在错误MB或迭代算法已经没有排除能力后,集合{berror[j]}表现出收敛特性,即对于实际问题,严格相等常表现为迭代差异在小范围内波动.为防止水印过少,而产生迭代结果的剧烈波动,迭代算法要求N_c[j]>10.为降低波动的影响,ε1为最后5次迭代所产生的最小值.对于正版视频,ε1∈[0,δ1],对于盗版视频,ε1∈[λ-δ1,1],其中δ1为视频中没有被排除的错误MB引起的水印错误率,λ为盗版视频水印错误率.迭代算法性能及ε1概率密度函数在第4.4节进行测试.3.4识别算法结合3.1节的嵌入算法和3.3节的迭代算法,提出了如下识别算法,流程图见图4,基本步骤为1.对阈值T、δ进行赋值.2.初始化参数:sum=0,n=0.3.从videocodeddata中对I帧亮度分量进行VLC解码,若检测到语法错误,则跳到下一个同步标记处开始重新解码.4.计算I帧水印错误率berror,n=n+1.根据第3.1节嵌入算法的步1和步2,寻找水印承载单位WB和Aclast上应该携带的水印w.提取Aclast上实际承载的水印w-:当Aclast为偶数时,w-=0,当Aclast为奇数时,w-=1.如果w≠w-,则该WB携带的水印错误;否则正确.根据I帧WB数目及水印错误数量,计算berror,berror=I帧错误水印总数/I帧水印总数.5.若berror=0,则检测结束标志,若视频全部I帧分析完毕,则视为检测到结束标志,转步6;否则转步3,继续解码下一个I帧.若berror>T,则此视频不需进一步判定,识别算法终止,不是正版.若0<berrorT,判断能否迭代,若不能则sum=sum+berror;若能则根据3.3节算法迭代算法计算ε1,sum=sum+ε1.检测结束标志,若检测到结束标志,则转步6;否则转步3.6.当sum在识别算法中,对δ的赋值在4.5节结合识别误差讨论.对T可采用如下3种方式之一赋值:Page6(1)令其中,α为二进制视频码流所面临的比特误码率(biterrorrate),L为视频全部I帧在码流中的比特位总长度,M为视频水印总bit数,m为1个Slice中包含的Block数目.由于1bit错误的最大影响区间为1个Slice[19],因此,T为在信道干扰下I帧最大平均水印错误率.这样赋值有助于提高识别速度.(2)令T为正版视频具备观赏价值下可容忍的最大水印错误率,具体可结合错误恢复算法[24-25]进行统计评估.这样赋值可提高识别速度.(3)令T=1.不出现不需要进一步判断的情形.4TDIA算法性能测试测试环境:(1)IntelPentiumCPU:1600MHz,内存256MB.(2)Mpeg2Codecvision1.2①.4.1嵌入算法性能测试测试内容为:(1)水印嵌入带来的视频质量下降,用相同码率下,水印嵌入后视频各帧PSNR下降的平均值mpsnr来衡量.(2)水印嵌入总量,用wtotal表示.(3)水印嵌入耗时e-time.令嵌入算法参数k1=0.00252、k2=100、Tembed=30.压缩参数为:每个视频时长为1s、帧率30帧/s、GOP=6、I/P帧距为3.在1Mbps、2Mbps、3Mbps、4Mbps码率下,4个视频②container、coastguard、foreman、hall_monitor的测试结果见表1.从表1中数据可以看出:水印对视频PSNR影响微乎其微,水印嵌入量较多,嵌入耗时不大.一定的水印嵌入表1基于Mpeg2Codec,水印嵌入算法性能测试结果表视频码率/Mbpsmpsnrwtotale-time/scontainercoastguarhall_monitorforeman量可以保证识别精度以及防止3.3节迭代结果因为水印量过少而出现抖动.4.2水印对盗版操作的脆弱性测试压缩参数设置方法压缩成盗版:把正版视频解码成帧序列,再把帧序列按如下盗版1.压缩参数设置同正版;盗版2.除码率增大外,其它同正版;盗版3.除码率减小外,其它同正版;盗版4.码率增大、I/P帧距减小,其它同正版.以container正版视频测试这4种盗版方式的水印错误率,测试结果见图5(a)~(d).图5中,perror指盗版视频各I帧水印平均错误率.图5(a)是将码率分别为0.6Mbps~8Mbps的container正版分别按盗版1盗版的测试结果,图5(b)是将0.6Mbps正版按盗版2分别将码率增大到0.7Mbps~8Mbps后的测试结果,图5(c)是将8Mbps正版按盗版3将码率逐步减少到7.9Mbps~0.6Mbps的测试结果.图5(d)是将1Mbps正版I/P帧距减小1,码率增大到1.1Mbps~8Mbps的测试结果.测试中之所以选择0.6Mbps以上视频,是因为当码率小于0.6Mbps时,Mpeg2标准编码器压缩的视频存在明显的马赛克.从图5(a)~(d)对比可知:盗版视频的perror>0.2,盗版1方式是对水印保持最好的方式.由测试结果可以看出水印对盗版操作脆弱.①②tabase_Video.htmlPage74.3通信干扰对水印影响测试在没有通信干扰时,正版视频各I帧水印错误率为零.码率为0.9Mbps的8scontainer正版视频,码流遭受BER=6×10-4干扰后,各I帧水印错误率见图6(a),各I帧平均水印错误率perror=0.1541.利用盗版方式1对该正版视频进行盗版,在同样信道干扰下,各I帧水印错误率见图6(b).对比图6(a)、(b)可以看出,通信干扰使得container正版、盗版perror趋同.图6通信干扰后正版、盗版视频各I帧水印错误率示意图4.4迭代算法效果测试遭受信道干扰后,正版视频某I帧(见图7(a))水印错误率为0.15,盗版视频某I帧(见图7(b))水印错误率也为0.15.用3.3节迭代算法对两幅图进行干扰排除,图7(c)、(d)分别绘出了对图7(a)、(b)进行迭代时,集合S的水印错误率变化曲线,横坐标为迭代次数j,纵坐标为berror[j].在图7(c)中,迭代16次,错误全部被排除,在图7(d)中,迭代86次后berror收敛于0.25.迭代算法所使用的参数值为TSo=100,Taco=0.95,T3o=10,MDbo=5;d1o=10;,d2o=0.05,d3o=1,d4o=0.1.测试第3.3节ε1的概率密度函数,测试样本为遭遇干扰的BER值为[10-4,10-3]的正版、盗版1方式盗版视频,干扰方式为对视频码流随机加扰,迭代测试结果见图8(a)、(b),横坐标为ε1,纵坐标为概率p(ε1).对于正版视频I帧,ε1的数学期望为E(ε1)=0.036;对于盗版视频I帧,E(ε1)=0.352.图8遭遇干扰的正版、盗版视频I帧ε1概率密度函数图进一步测试表明,当BER小于10-4时,正版视频I帧的E(ε1)0.036,盗版方式1盗版视频I帧的E(ε1)仍为0.352.对于其它盗版方式,E(ε1)=0.5.4.5TDIA算法误识别率分析ChernoffBound定理[26-27].如果X1,X2,…,Xn是独立且0Xi1,i=1,2,…,n的随机变量,记Xi/()n,则对任意0<δ<1,有x=E∑n(i)当δ<x时,P∑n(ii)当δ>x时,P∑n其中,D(δ‖x)=δlog2δi=1利用ChernoffBound定理,求识别算法的漏检概率P1,即正版视频满足sum/nδ的概率.由于正版视频每个I帧的水印错误率可以看作一个随机变量,这些随机变量独立且取值在[0,1],满足ChernoffBound定理条件,因此,由式(8),P1=P(sum/nδ)2-nD(δ‖E(ε1)),E(ε1)为正版视频I帧水印错误率的数学期望.当E(ε1)∈(0,0.036]时,D(δ‖E(ε1))为E(ε1)的递减函数,因此,对于E(ε1)∈(0,0.036],都有D(δ‖E(ε1))D(δ‖0.036),P12-nD(δ‖0.036).利用ChernoffBound定理,求识别算法的误检概率P2,即盗版视频满足sum/nδ的概率,由式(7),P2=P(sum/n<δ)2-nD(δ‖E(ε1)),E(ε1)为盗版视频I帧水印错误率的数学期望.当E(ε1)∈[0.352,1)时,D(δ‖E(ε1))为E(ε1)的递增函数,因此,E(ε1)∈[0.352,1],都有D(δ‖E(ε1))D(δ‖0.352),P22-nD(δ‖0.352).既不是正版也不是盗版的视频称为无关视频,Page8这些视频的I帧仍是符合ChernoffBound定理的随机变量,且E(ε1)=0.5,因此用式(7)可计算把无关视频识别为正版的概率P3,P3=P(sum/n<δ)2-nD(δ‖0.5).可根据识别误差,对δ进行赋值.当T=1、δ=(0.352-0.036)/2=0.158时,P12-0.1728n、P22-0.1355n、P32-0.3705n.这表明当信道干扰BER小于等于10-3时,算法漏检率及误检率随着n的增加,指数级下降.当n=360时,P11.88e-19、P27.55e-18、P37.06e-41.通常视频每秒不少于2个I帧,n=360相当于不超过3min的视频时长.5结束语在分析了版权保护技术现状的基础上,本文提出一种有效识别正版视频的算法:TDIA算法.在设计上,它结合了视频编码标准、脆弱数字水印、视频通信技术.TDIA算法包含两部分:嵌入算法及识别算法.在3.1节描述了嵌入算法,在其设计上考虑了安全性、脆弱性、一定的水印嵌入量以及使所嵌入的水印0/1各占50%,对Aclast奇偶性更改概率为50%,以便保证无关视频I帧水印错误率的数学期望为E(ε1)=0.5.基于通信干扰与盗版操作对水印影响的本质不同,在3.3节提出了排除干扰的迭代算法,4.4节测试了其性能.在3.4节提出了识别算法并在4.5节基于E(ε1)、有界随机变量和的ChernoffBound定理,分析了TDIA算法的识别误差.理论和仿真表明,对于BER10-3、视频I帧总数n360的Mpeg2编码视频,TDIA算法能给出识别误差小于10-18的识别结果.并且随着视频的延长,识别结果指数级下降.另外,TDIA算法也可应用于其它编码标准,可用于终端在线检测,也可用于离线检测.它是一种安全性高、识别准确率高、对通信干扰具备一定容忍性的正版视频识别算法.将TDIA算法与VideoDNA技术结合,可实现盗版视频过滤、禁播等.
