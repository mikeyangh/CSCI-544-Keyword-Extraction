Page1三维片上网络体系结构研究综述李晨马胜王璐郭阳(国防科学技术大学计算机学院长沙410073)摘要伴随着三维集成电路的迅速发展,三维片上网络受到国内外研究者的广泛关注.三维片上网络主要用于实现三维堆叠芯片的互连通信,为三维集成电路提供超低的延迟和竖直方向上超高的带宽,从而解决系统集成度增加导致的通信瓶颈问题,有利于克服存储墙问题并提高三维堆叠芯片的性能.文章介绍了三维集成电路研究现状及其结构优势,分析三维片上网络体系结构的特点和存在的问题,包括竖直方向的单跳传播问题、路由器交叉开关的复杂度控制问题以及热效应的控制问题,从系统层、微结构层和电路层对三维片上网络体系结构的研究热点及其实例进行了深入分析,最后对三维片上网络所面临的挑战和设计方法进行了总结和展望.关键词计算机体系结构;三维堆叠;三维集成电路;三维片上网络1引言摩尔定律实际上是半导体集成电路行业的一条Page2的线性缩减有所减缓[1],因此出现了多核、虚拟化等并行策略来维持这一学习曲线.随着技术的继续发展,多核、多线程和虚拟化等策略又会遇到存储墙的问题[2],需要提供更高的存储带宽和更大的存储空间来保证其性能.在这个背景下,急需找到一种新的方式来维持这一学习曲线的速率,因此,三维芯片堆叠的方法应运而生[3].三维集成技术是一种新的集成电路工艺,其将多个硅片垂直堆叠并以三维封装的方式封装成一个芯片[4],是在工艺尺寸缩减受限的情况下提高系统性能的一种新的方式[5],从延伸摩尔定律和超越摩尔定律两方面实现芯片上晶体管密度和芯片性能的大幅度提升[6-8].三维集成电路具有以下4点优势:(1)更短的互连线长.三维集成电路技术最大的吸引力就在于工艺缩减受限的情况下,通过芯片堆叠,降低互连线的平均长度[9],从而缩短延迟并降低功耗;(2)更高的存储带宽.三维集成电路通过对存储部件的堆叠,一方面提高了Cache容量,另一方面减少了平均访存时间,从而提升了吞吐率和能效;(3)支持异质集成的实现.三维集成电路增加的一维空间使得芯片可以在更大的密度下实现更高的性能,也使集成电路的异质集成能力得以更好地体现,即体系结构设计者可以通过灵活的方法实现各种异质结构的堆叠来满足功能的多样性;(4)更小的系统尺寸.三维集成电路技术将二维芯片竖直堆叠,通过纵向垂直互连进行通信.该方式在提升了芯片集成度的同时缩小了芯片面积.三维片上网络通过三维立体的互连通信,为三维集成电路提供超低的延迟和竖直方向上超高的带宽,在现阶段对于提高三维芯片性能并控制热效应问题有着非常重要的意义.三维集成电路必将是未来集成电路的发展方向,三维片上网络作为三维集成电路最重要的互连通信方式,具有非常广阔的发展前景.基于此,本文针对目前三维片上网络的研究热点,从系统层、微结构层和电路层三个层次对三维片上网络体系结构进行热点综述.分析了三维拓扑结构和路由器微结构的发展轨迹;对路由算法、垂直互连的TSV优化设计以及热管理等方面研究进行了分类总结;同时还对非常有前景的2.5维片上互连硅中介技术进行介绍和讨论;此外,对于三维片上网络在设计方法学、缓存分配以及新型堆叠方式等方面的研究也作了分析介绍.通过这些文献综述和讨论,分析现有研究的优势和不足,总结三维片上网络研究所面临的问题和挑战,并针对这些问题和挑战提出下一步的研究前景和发展方向.2三维片上网络体系结构特点与研究层次三维片上网络体系结构的最大特点是三维集成堆叠以及与此相适应的竖直通信链路.目前,三维集成逻辑堆叠的商用芯片产品并未普及,主要是以存储堆叠为主,但按可能批量生产的时间顺序可以分为存储堆叠、硅中介层、存储层堆叠逻辑层和逻辑三维堆叠4种形式[10],这些三维堆叠都是通过纵向的垂直互连进行通信.纵向垂直互连技术包括引线接合法(wirebonding)、微焊点(microbump)、无触点(contactless)以及硅通孔连接(TSV)等几种方式,这几种连接方式在纵向连接密度和实现特点方面各具特色[11].就目前来看,采用TSV的垂直互连技术通过在硅晶圆上穿孔并以钨金属填注进行芯片间互连,相对来说是最有前景的垂直互连技术,最有潜力提供最大的互连密度,虽然其制造成本目前还比较高,但由于其出色的性能,TSV垂直互连技术有望获得最广泛的应用[12].片上网络作为一种在芯片内部通过拓扑结构将各个模块连接,并采用路由和分组交换技术进行数据交换的通信方式,可有效解决复杂SoC通信问题[13-14].三维片上网络是指将资源节点分布在竖直堆叠在一起的不同的物理层上,并采用了三维立体的结构实现节点间的互连通信,实现低延迟、高带宽的片上网络结构[15-16].三维片上网络的体系结构设计对于网络延迟、吞吐率、功耗、应用映射以及芯片的面积、复杂度都有着非常重要的影响[17-18].三维片上网络和二维片上网络最大的区别在于新增加的连接不同层的竖直链路,纵向竖直链路可以实现传统二维片上网络的平面结构所无法实现的性能.因此,如何利用好这些特别的竖直链路成为三维片上网络的研究重点.这就要求设计者选择一个合适的竖直链路体系结构,并设计高性能低开销的路由器来减少竖直方向上的节点跳数.三维片上网络最关键的研究目标就是如何在相对较小的面积和功耗开销下,为三维芯片提供更高的互连性能.相对于二维片上网络,三维片上网络系统结构层的大部分研究集中在解决3个问题:(1)竖直方向的单跳传播问题,即在层间互连中,由于竖直方向距离相对于水平方向可忽略不计,Page3因此要求任意两层之间在竖直方向都采用单跳传播以降低延迟.(2)路由器交叉开关的复杂度控制问题,由于三维结构增加一维需要增加交叉开关的端口数量,进而大幅增大交叉开关的复杂度,使得硬件开销不可接受,因此需要对交叉开关进行简化设计以降低硬件开销.(3)热效应的控制问题,三维堆叠技术使得集成电路晶体管密度增大,单位面积产生的热量也相应增大,同时三维堆叠增大了散热难度,所以热效应成为必须控制的问题.上述问题的研究产生了几大研究热点,这些研究热点分别分布在系统层、微结构层和电路层,概括如图1所示.这种分层的视角可以更好地理解三维片上网络研究层次.在系统层,主要是对片上网络进行全局性研究,如拓扑结构、路由算法、硅中介技术[19]、图2三维拓扑结构发展路线三维对称网络结构[20]是最基本的三维网络结构,它由二维网络结构向竖直方向直接拓展而成.如图3(a)所示,该结构相当于在二维网络结构的路由器上增加两个端口,分别是在竖直方向朝上和朝下设计方法学、新型芯片堆叠方式以及热管理的部分内容;在微结构层研究方面,主要包括路由器缓存分配、路由器微体系结构研究以及热管理部分涉及路由器结构的设计研究;在电路层方面,主要是以垂直TSV互连相关内容的研究为主.下面将针对这些体系结构研究热点进行分析.3三维片上网络体系结构研究进展3.1拓扑结构片上网络主要由链路通道和路由器节点组成,而网络拓扑结构则决定了其物理布局和路由器节点与链路的连接方式.拓扑结构的评价指标有节点的度、平均节点跳数、最大通道负载以及路径多样性等.对于三维片上网络来说,增加的一维纵向竖直连接不同于传统二维片上网络的平面连接方式,为了利用好纵向连接的短距离和高带宽的特性,垂直通信在三维拓扑结构的设计上也需要特别考虑.目前对三维片上网络拓扑结构的研究非常多[26,28-30],其发展路线如图2所示,主要可以分为两类,一类将二维片上网络已有的拓扑结构直接应用于三维片上网络,发挥三维立体结构的空间优势,实现资源利用的最大化;另一类则是根据三维片上网络的特点单独设计,包括利用竖直方向相对于二维平面上可忽略不计的距离、竖直方向上TSV通信的高带宽等.下面将介绍这两类拓扑结构设计思路的研究现状.的两个端口.显然,增加这些端口需要相应地增加缓存、仲裁器以及交叉开关的规模.所谓对称的网络结构是指报文在片间和片内都是每节点一跳地传输,即报文从一个四层芯片的底层某节点传输到顶层某Page4图3三维拓扑结构节点至少需要经过3跳.三维对称网络结构非常简单、易实现,但存在两个主要缺陷:一是片间多跳传输浪费了其相对于片内可忽略不计的距离;另一个是增加额外的端口,需要一个7×7的交叉开关,开销非常大.三维对称网络在竖直方向上按跳传输是极大的资源浪费,因此,文献[21]提出了三维片上网络-总线混合结构以解决该问题.如图3(b)该结构在片内采用包交换网络,片间采用总线结构,通过这种混合机制,很好地解决了片间多跳传输的问题.片内的包交换网络与二维片上网络相似,而在片间采用的总线则是被称为“通信柱”的动态时分多路访问总线(dTDMA).这些通信柱为任意两层芯片的节点提供单跳通信.限制通信柱数量的因素主要包括通孔的密度和路由器复杂度.采用三维片上网络-总线混合结构相对于三维对称片上网络结构解决了片间多跳传输的问题,降低了硬件复杂度,将交叉开关规模从7×7降低为6×6.然而,该结构在竖直方向上不支持并行通信,在高流量下冲突严重,因此对于节点数目和层数的限制非常严格.三维片上网络-总线混合结构在竖直方向存在不支持并行通信的问题,而三维纤毛片上网络结构[22]很好地解决了这个问题.它是一种单Switch连接多IP模块的三维片上网络结构.如图3(c)所示,该3×3×3的三维纤毛结构由9个Switch和27个IP模块组成,其中每个Switch连接3个IP模块.Switch只存在于三维结构的最底层,各层的IP模块都与最底层对应的Switch相连接.在层内互连中,只有接近散热模块的底层具有较好的连通性,其他层的层内通信都需要经过底层Switch来完成.这种结构面积和功耗开销低,在一些特定的流量模型下能发挥较好的性能,但单Switch多IP模块的设计降低了该结构的连通性,因此全局带宽是该结构的瓶颈,影响其整体性能.XNOTS是一种通过交叉开关Switch进行层间互连的片上网络结构[23],各层内可采用任意直接拓扑逻辑结构,而层间则通过交叉开关Switch非直接相连.如图4所示,这种交叉开关Switch被称为路由柱.XNOTS三维片上网络结构的另一特点就是除了底层外,无需保证各层内部任意两节点之间的连通性,这类似于三维纤毛结构,各层之间可根据性能和开销需要独立定制设计.由于散热器离底层Page5较近,易于对底层散热,因此,对于不连通的上层网络节点,均通过底层网络连接.这种设计还采用了热感知路由算法,具有较好的散热性能和较高的吞吐率,但是竖直方向上的交叉开关设计对于面积和功耗的需求相对较高.为了降低三维片上网络的报文传播延迟,Xu等人[24]提出了一种如图5(a)所示的低开销路由器组成的低直径三维片上网络设计.在采用与传统三维Mesh片上网络相同的7阶路由器的基础上,通过在Cache层使用长连线的方式组成网络直径非常低的三维片上网络结构.由于计算核所在层的内图5低阶低直径片上网络结构前面介绍的这几种拓扑逻辑都是在三维对称结构的基础之上针对三维集成电路的特点设计优化的,而下面这3种拓扑逻辑均是由二维片上网络直接引入到三维片上网络中,同时能够非常契合三维结构的特点,具有各自的优势.在二维片上网络中,树形结构是一种常用的拓扑结构,根据应用需求,可分为蝶形胖树、一般胖树和遗传胖树等[36,50-51].Feero等人[22]将树形结构引入到三维片上网络.这种胖树结构通过层次化的连接具有较小的网络直径,并且能达到非常高的性能提升.然而这种设计存在的缺点是后端设计较为复杂且温度控制不够理想.De-Brujin图是一种直径小、路由简单且具有容错等特性的网络拓扑,为了获得简单、可靠、吞吐率高与延时短等优势,该拓扑首先被应用在二维片上网络[52].电子科技大学的Chen等人[25]设计了一种在水平面和垂直平面上均采用De-Brujin图作为拓扑结构的三维片上网络.在大多数情况下,基于De-Brujin图的三维片上网络结构能够同时取得延时和功耗的最佳性能,可以解决由于网络规模增大导致延迟增大的问题,具有良好的可扩展性.该方法的缺点是性能效率不高,传统的一些布局布线算法无法复用,且对节点分布也有要求.二维蜂巢结构[53]相比于传统的矩形Mesh或Torus结构,可降低大约40%的网络开销.芬兰图部Cache一致性通信特别频繁,故保留Mesh结构,而在Cache层则采用长连线的方式.如图5(b)所示,采用传统三维Mesh结构从A节点传送消息到B节点需要7拍,而如图5(c)所示,若采用长连线,则从节点A到节点B再到节点B只需要3跳,而该拓扑结构是由整数线性规划(ILP)根据目标函数和约束函数计算得出.由于该方法只适合36个节点以下的网络,作者还提出了两个扩展规模的方法.这种设计降低了网络直径且具有较高的性能,但是不规则的长连线设计也增加了布局复杂度.尔库大学的Yin等人[26]根据蜂巢片上网络的这一特点,提出了图6的三维蜂巢片上网络结构,同时设计了一种死锁避免路由算法.该设计实际上是从二维片上网络延伸到三维片上网络.增加了维度后,在水平方向上依然保持蜂巢拓扑结构;在垂直方向上,为控制路由节点的阶,作者将节点分为奇数节点和偶数节点两类,一类只有向上的连线,一类只有向下的连线,通过该方法进一步降低硬件开销和功耗.然而这种结构也无法采用传统的布局布线算法,同时平均节点跳数较高,影响性能.上述拓扑结构都各具特点,基于Mesh的三维片上网络形状规则,布局布线相对来说难度不大,非常适合于商业化产品的应用,但是这一类拓扑结构又Page6均存在网络延时大、功耗开销大等问题.其他基于非Mesh结构的三维片上网络,如低直径低阶网络、基于De-Brujin图的网络结构虽然性能高、直径小,但又存在芯片布局布线复杂、实现难度较大等问题.因此,未来三维片上网络拓扑结构设计将面向可扩展性强、布局布线简单、充分利用垂直空间等方向发展.3.2路由算法路由算法定义了一个消息从源节点到目的节点的路径,分为确定性路由、健忘路由和自适应路由3类,根据传输路径的长度也被划分为最短路由或非最短路由.路由算法的性能对于网络吞吐率和延迟有着直接影响,越好的路由算法越能均衡网络负载.表1三维路由算法路由思路Z-XY→X-Z-XY根据网络状态自适应Z-XY-Z/Z-YX-Z分8个象限,功耗自适应AFRA是一种低开销的三维Mesh片上网络容错路由算法[31],主要针对竖直TSV出现的永久性错误而设计.该路由算法在默认情况下采用Z-XY算法,若Z-XY路径的Z方向出现了永久性错误,则采用X-Z-XY路由算法.第1步,消息将先从源节点传递到X方向最短路径上距离源节点最近的逃脱节点上,第2步,从该逃脱节点再经过ZXY路由送到目的节点.若在最短路径上没有合适的逃脱节点,则会选择最小ID号的节点作为逃脱节点.在死锁避免机制上,该文证明了当所有Z方向的链路错误是同向的,则无需虚通道避免死锁.该算法是对Z-XY算法的改进,开销较低且可靠性较高,并具有较好的性能.该算法的局限性在于只能支持竖直方向的容错,且全是同向错误时才无需虚通道.为解决三维片上网络的拥塞问题,缓解热效应,图7层复用网络结构示意图(Rk为第k层路由器对应的IP模块)对于三维片上网络的路由算法,要求其满足简单、高性能和鲁棒性三个关键目标.同时,随着三维片上网络设计规模的不断增大,系统出现错误的概率也相应提高,需要更多的容错设计来解决这些问题以提高可靠性.此外,三维集成电路对于异构体系结构的支持,使得片上网络通信流量形成一定的特征,如何通过路由算法均衡网络负载,提高带宽利用率并降低功耗也成为路由算法研究的一大热点.现有的路由算法研究主要集中在这两方面,根据路由算法的分类分别介绍容错路由、全局流量均衡、层间流量均衡和低功耗路由4个路由算法,其路由思路和功能特点见表1.Chang等人[32]提出了一种流量平衡的路由策略.该路由策略包括一个高级临时转接路由算法,该算法主要采用3个方法:(1)收集网络中的拥塞和节流信息以均衡负载;(2)减少路径复杂度以降低平均延迟;(3)调整路由路径来散热.这种动态的路径选择算法简单高效,不仅具有较低的延迟,同时有利于网络的流量均衡以及热管理.但是在随机流量模型下,部分节点具有非常高的通信频率,性能并不好.当三维片上网络的各层负载不均衡时,效率非常低.因此,Ramanujam等人[33]提出了一种多层复用三维片上网络结构,这种结构其实是一种Z-XY-Z或Z-YX-Z的健忘路由算法,可有效实现各层的负载均衡.该文献用一种输入分层与输出层恢复的结构替代传统的一层一跳结构.如图7所示,报文从节Page7点注入后,首先进入输入分层阶段,该输入分层结构连接对应于该位置的各层的路由器,根据路由器报文计数器状态,将报文随机分配到负载较轻的一层,通过维序路由到达目的节点对应的该层节点,再进入输出层恢复结构,由交叉开关分配到目标节点所在层的路由器.虽然多层复用三维片上网络结构具有负载均衡和路由器结构简单等优点,但该结构仍存在两个缺点,一是在竖直方向上需要两跳通过,二是增加的输入分层和输出层恢复结构是两个4×4的交叉开关,每次报文通信需要多经过两个交叉开关,降低了性能.在控制网络功耗并避免死锁方面,南京大学的虞潇等人[34]提出一种面向功耗免死锁三维全动态路由算法.该算法将二维平面上的奇偶转弯模型扩展到三维结构,将路由空间划分为8个象限,在每个象限选取对应的路由策略,即先走不同的轴,到达对应的象限后采用自适应路由,一方面避免互相之间的打扰;另一方面也避免回路的产生从而避免死锁.该算法还通过比较三维空间中6个方向的功耗指标选择节点功耗较小的路径从而降低功耗,并使报文分布均匀.与传统的Z-XY算法、静态XYZ算法和TTAR[54]算法相比,该设计在功耗方面显著下降,但是在平均延迟和网络吞吐率等性能方面却略有损失.三维片上网络的路由算法已经不仅是为了将消息从源节点传输到目的节点,它还能发挥容错、负载均衡等功能性的作用.三维芯片密度增加,热效应问题严重,对于芯片可靠性的要求更高,同时三维片上网络相对于二维片上网络在路径多样性上有了很大提升,有更多的空间和路径来实现容错、负载均衡的功能.因此,未来三维片上网络路由算法的研究应面向多功能应用算法研究,提高可靠性和降低功耗将与提高性能一样重要.3.3路由器微结构传统的路由器微结构主要包括如下模块:注入缓存、路由计算模块、虚通道分配器、交叉开关分配器、交叉开关以及输出单元等.路由器的功能主要是通过流水线来提高吞吐率.在片上网络中每一个路由器延迟占了总的通信延迟的很大一部分,需要通过减少路由器流水线段来降低延迟并提高吞吐率.由于三维片上网络的规模增大,维数增加,无论是路由器端口数量还是交换开关的复杂度都不可避免地增加,因此,三维片上网络的路由器微结构研究重点是降低交叉开关复杂度等方面.图8显示了以降低开销为目的的三维片上网络路由器微结构设计方向.现有的研究一类通过三维分解降低路由器交叉开关的开销;一类通过减少端口的数量来降低路由器开销;另一类则通过层次化设计实现三维高阶Switch.文献[20]考虑一种纯三维交叉开关的实现,即将交叉开关三维化.如图9所示,采用6个晶体管将交叉开关的连接点向三维扩展,这种连接点称为连接盒.垂直链路嵌入到交叉开关中,不需要额外的物理链路,性能非常好.例如一个报文从底层的东输入端口传播到顶层的南输出端口仅需要一拍.尽管性能非常高,连通性非常好,但这种设计致命的缺点是在交叉开关的连接点增加了大量垂直链路,造成了严重的路径冗余和复杂度开销.对于一个位宽为1的完整三维交叉开关,需要25个连接盒,由于每个连接盒需要6个晶体管,则一个交叉开关需要150个晶体管.控制这些晶体管又需要至少150个控制信号,一个4×4×4的三维片上网络结构,则需要接近10000个晶体管.同时,其路径复杂度又严重过剩,在真实应用程序中,这些连接的利用率非常低.因此,对于延迟和面积约束非常严格的片上网络路由器来说,这种设计是不现实的.DimDe路由器微结构[20]是对纯三维交叉开关的改进.由于纯三维交叉开关开销过大,考虑将其化简成三个模块,即将XYZ三个维度分解成行模块、列模块和纵模块,分别仲裁.如图10所示,该设计将5×5的交叉开关简化为行模块和列模块的两个4×2的交叉开关,尽管增加了交叉开关的数量,但其规模依然小于一个单体的5×5交叉开关.在仲裁设计上,对于一个XYZ维序路由算法,第1步先仲裁单层本地报文,需要传播到其他层的报文胜出,第2步Page8将这些纵向传播的所有报文进行全局仲裁,该仲裁器的设计是为了满足更多的并行通信.DimDe三维片上网络结构相对于总线结构提供了较高的全局带宽,相对于纯三维片上网络结构降低了大量硬件开销.图11LastZ结构的特点在三维高阶路由器的研究方面,密歇根大学的Blaauw领导的研究小组提出了一种支持单周期仲裁的高阶三维集成的Hi-RiseSwitch[44].该高阶Switch基于2DSwizzle-Switch[55]和三维折叠Switch结构[56]设计,一方面将仲裁逻辑集成到交叉开关的交叉点中,使得仲裁器复用数据通路,降低开销;另一方面优化三维折叠Switch结构,如图12所示将其划分为层次化的Switch,本地Switch负责每层的报文分配,层间Switch负责层间的报文分配.在设计上关注两个点,一个是降低垂直通路的数量,控制TSV数量并降低开销;另一个是层次化结构带来的分配不公平问题,设计了一种基于类的最近最少分配仲裁策略(CLRG),为每个输入配置一个三优先级的计数器来实现.该Switch支持64阶4层结构的实现,相对于二维设计和传统三维折叠Switch有更高的性能和更低的开销.Hi-RiseSwitch设计在LastZ路由器微结构[42-43]是对片上网络-总线混合结构的路由器的改进,减少端口数量以达到降低路由器开销的目的,其结构如图11所示.该结构基于LastZ路由规则,即非层内的报文传播,最后一跳必须是竖直方向上的.因此,作者根据这个规则做了两点结构设计:(1)去掉一个输入端口,将6×6的路由器简化为5×6的路由器结构;(2)为每个处理核单元设计一个外包结构,该结构由一个有限状态机和一个两路选择器组成.通过这样的结构设计,使得报文在最后一跳直接从dTDMA总线跳到处理核,而无需经过最后一个路由器.这种设计相对于前面介绍的三维片上网络和总线混合结构,具有较小的面积开销,平均节点跳数降低了一跳,简化的路由器结构使得路由器可以工作在更高的频率.虽然一定程度上缓解了总线拥塞问题,但总线无法并行通信依然是这种结构的瓶颈,导致在一些特定流量模型中效率降低.(N为端口数目,L为层数、C为任意两层间链路数目)Page9Mesh拓扑结构中能实现支持千核的超大规模三维结构.该Switch的不足是垂直链路根据输入或输出分档,每个输入都固定到一条垂直通道,当多个输入竞争该通道时容易拥塞,该策略不够公平,仍有提升空间.现有的三维片上网络路由器微结构研究以降低硬件开销为主要目的,这是由于三维结构相对于二维结构性能已经有了很大提升,而三维结构面临的硬件复杂度、热效应等问题必须以降低开销作为主要解决方式.因此,未来短期内路由器微结构的研究将依然集中于实现低复杂度低功耗的路由器结构.3.42.5维硅中介技术硅中介(Siliconinterposer)技术即2.5维堆叠图132.5维堆叠集成电路如图14(a)所示,在传统的2.5维堆叠设计中,只会利用一小部分硅中介层的连线资源,作为相邻部件间的通信.多伦多大学的Jerger等人[35]开发利用了硅中介层的大量未用资源,达到性能的大幅提升.该文献提出了一种如图14(b)所示的通用方法来利用硅中介层的连线资源,使得片内通信或片间通信均可以利用硅中介层的连线资源.在实现细节上一方面区分访存报文和一致性消息报文,使之分别利用不同层的网络进行通信,另一方面通过负载均衡方法和快速通路合理控制并均衡了网络流量,同时还降低网络直径.该方法在带来非常小的额外资源开销的同时大幅度提高了性能,可以有效缓解网络拥塞,同时大幅提高了等分带宽.作者还提出了图142.5维片上网络硅中介层连线资源的利用技术是在三维堆叠技术尚未成熟前的一种过渡技术,相对来说能较好地支持现有的一些设计工具和设计方法,目前也已成为三维片上网络研究者重点关注的研究方向.如图13所示,2.5维集成电路是将多个同构或异构的部件相邻地堆叠在硅中介层上,相邻部件之间通过硅中介层进行通信.通过2.5维堆叠可以大量增加存储容量,同时避免三维堆叠中的热效应.现在已经出现了许多商用2.5维堆叠产品[57].硅中介技术的研究目前依然是比较新的方向,其主要研究如何利用硅中介层进行通信,硅中介层作为多个异构部件层的下一层,负责这些部件间的通信.一些拓扑逻辑在各层的设计方法以及报文转发策略.该文献第一次开发了硅中介层的设计空间,许多现有的技术都能在此应用,以达到较高的性能,具有非常广阔的前景.2.5维片上网络硅中介层的下一步研究一方面可以从结构和算法设计入手,对硅中介层拥塞控制、容错、路由算法等进行深入研究;另一方面,可以将2.5维片上网络硅中介技术应用到更多的环境,例如CPU、GPU、其他硬件加速器以及DRAM等组合的环境里,更好地实现异构集成,将其潜能更大地挖掘出来.3.5热管理热效应不仅是三维集成电路,同样也是三维片上网络所面临的严峻挑战.在二维集成电路或是二维片上网络中热效应并不明显,但当更多地设备器件层竖直堆叠在一起时,功耗密度和热传导路径的长度均增加.高温所带来的问题是更长的传播延迟和更高的静态功耗.在超出芯片工作范围的温度工作可能会导致错误输出和可靠性降低等问题.此外,热效应使得散热和封装成本均增加.目前对于热效应的研究也非常多,在系统结构层的研究一方面通Page10过结构设计降低功耗和热的产生,另一方面通过路由控制热点区域报文流向消除热点,平衡通信量.“国立”台湾大学的Huang等人[41]提出了一种共享路由器的三维片上网络的热管理结构设计,通过降低路由器数量来降低芯片温度,解决热效应问题.由于远离散热器的m层路由器即使是在空闲状态仍然会产生较大的静态功耗,并导致热效应的问题.作者将远离散热器的m层存储和PE模块的路由器去掉,通过TSV总线将这些部件与其他N-m层的路由器相连,实现路由器共享.该策略与传统三维结构相比,在80的温度约束下可将报文接收率提高两倍,并节省13.4%的功耗开销.在热效应严重的三维芯片中,温度每升高10,连线延迟将增加大约5%,而漏电流将呈指数增长.宾夕法尼亚州立大学的Addo-Quaye[39]提出采用遗传算法来进行热和通信感知的三维片上网络应用任务的映射和布局.相比于随机映射布局方法,该方法热管理效果较好,明显降低了系统通信量.因此,功耗和温度的增加都得到直接缓解,对三维片上网络性能可靠性有着直接影响.高温给系统性能、功耗、可靠性和开销等带来了一些不可避免的问题,针对三维片上网络的热效应这一问题,Chao等人在文献[40]提出了一个三维片上网络流量和热感知的实时热管理策略.该策略包括两个部分:(1)主动向下路由策略;(2)垂直反馈节流策略.主动向下路由策略是一种流量感知策略,将部分流量迁移到底层,靠近散热器的同时,分散拥塞流量.垂直反馈节流策略则是一种热感知策略,将过热的路由器节流以提升网络可靠性,但该策略对三维片上网络的性能有一定的影响.热管理的研究在二维片上网络研究中就被提出,由于堆叠散热困难,在三维片上网络中热管理的重要性凸现出来.对热管理的研究一方面可以缓解热效应的问题;另一方面也能提高系统可靠性.目前对于三维片上网络热管理的研究主要在系统层,通过全局策略进行控制,未来热管理的研究还将更多地面向微结构层和电路层,从底层缓解和消除热效应问题.3.6TSV设计优化三维堆叠垂直互连的几种技术中,TSV最有潜力提供最大的连接密度.TSV连接技术并不限制芯片堆叠的数量,但堆叠后的热效应和产能是制约其发展的关键因素.如图15所示,TSV连接技术可以用在Bulk工艺或SOI工艺下,SOI相对于Bulk工艺具有相对更小的垂直中心距(VerticalPitch).TSV技术的优势非常多,然而也存在一些缺点,包括面积开销大、TSV产能较低、寄生电容问题、路由拥塞问题等.目前在三维片上网络垂直互连研究领域,对于TSV连接技术的研究和发掘最为活跃,主要目的是提高TSV可靠性,减少引脚数量和面积以控制通孔周围的应力问题.对于竖直方向的TSV,竖直连接的引脚面积对于垂直互连的开销影响很大,文献[46]提出了一种竖直TSV连接的串行通信方法以减少TSV数量.该串行通信方法基于移位寄存器,由一个串行发射器和一个串行接收器组成.数据通过一条串行传播通路进行传播.作者测试了不同的串行程度对性能的影响,在41或21的串行程度下较为实际,即采用4条或2条串行传播通路传播数据.在这种串行程度下性能损失和功耗开销都较小,引脚面积可大幅减少.该设计使得竖直方向的热TSV分布更为合理,峰值温度也相应降低,节省的空间方便了芯片核的布局规划.但这种设计的缺点是需要增加逻辑复杂度完成串行通信,且对性能有所影响.文献[47]也通过减少垂直TSV连接的引脚数量,来减少面积和热功耗,该文献作者提出了一种三维片上网络结构BBVC,即一种基于双向双同步垂直通道的三维片上网络.该结构可以动态的自配置竖直链路的方向来传递报文,在竖直方向用一个高频率双向通道替代一对单向通道以达到更高的带宽利用率、更小的引脚面积和更高的可靠性.图16为BBVC结构的示意图,为垂直端口配置控制模块,使之具有双向通信能力.BBVC结构的优点是显著减少了TSV引脚面积,简化了布局,同时异构集成能力强;缺点则是增加了竖直方向上的跳步数,路由器交叉开关开销也较大.Page11文献[48]为了减少TSV高开销这一缺陷,设计了一种性能与开销较合算的三维片上网络结构.该结构的目的就是为了减少TSV的个数.通过对每一层的节点进行分类,将节点归到几个虚拟组,每个虚拟组连接一个TSV通信通道,并设计了一系列算法来管理通信,减少垂直TSV出现空闲的时间,以提高TSV的带宽利用率,继而提高全局性能.该方法可以显著减少TSV面积且性能下降非常小.国内对于TSV设计优化的研究也取得了显著的成果.合肥工业大学的欧阳一鸣等人[49]提出了一种TSV复用容错策略.传统的容错方法是增加一定数目的冗余链路,然而针对TSV故障,由于TSV是数量的限制,该方法难以适用.因此,作者提出通过对故障链路中功能良好的TSV复用,并通过将数据微片多次传输的方式实现对TSV硬故障的容错.此外还通过添加ECC编码解码模块来实现瞬时故障容错功能.该策略一定程度地控制了硬件开销,时延和吞吐率都有提高,但是由于容错策略复用TSV,出现错误时,微片在垂直方向分多次传输,导致零负载延迟增加.上述TSV的设计优化研究均是以降低TSV开销或控制TSV数量提高可靠性为目的,这是由于目前的制造工艺使得TSV的产品良率较低,成本较高.然而在现有技术条件下,垂直方向上采用TSV互连性能较高且最容易商业化应用,所以目前受到广泛关注.未来对于垂直TSV互连的体系结构研究一方面继续对其设计优化降低开销;另一方面还需要挖掘更多更有前景的垂直互连技术,如无触点或交流耦合互连通信等.3.7其他研究除了前面所介绍的6个研究热点外,对于三维片上网络的研究还包括新型芯片堆叠方式、设计方法学研究、任务映射、缓存布局、三维光互连研究[58-59]以及性能评估等许多方面.由于篇幅限制,本文无法全面完整地介绍,只针对具有代表性的新型芯片堆叠方式、设计方法学研究和缓存布局三个方面的研究进行介绍.Puttaswamy和Loh在文献[37]中提出一种三维处理器设计,其每个独立功能模块贯穿多个芯片层,虽然这一结构在当前技术条件下还存在一定困难,但随着多层堆叠处理器技术的成熟,这种结构非常灵活有效.MIRA三维片上网络结构是由美国宾夕法尼亚大学的Park等人[38]基于该技术提出的一种多层路由器结构.在逻辑结构上,其与二维Mesh结构的路由器类似,在竖直方向上,其路由器结构贯穿多层网络,与二维Mesh相比具有较小的节点面积和路由器间较短的距离.此外.路由器无需增加额外的功能结构,只需要将功能模块合理地布局在多层结构中.这种结构具有非常高的性能,但是其针对的是三维设计处理器核,难以重用目前已经高度优化的二维处理器核设计技术,且Switch设计复杂度也很高.在三维片上系统中,如何设计一个能效高的片上网络结构并满足三维堆叠技术的诸多约束是研究者在体系结构设计时最为关心的问题之一.为了解决这个问题,文献[36]提出了一种高能效三维片上网络设计的综合方法.该方法根据核的位置以及三维片上网络的各种约束,决定最合适的拓扑结构和各层路由器的位置.三维片上网络的诸多约束除技术约束外,还包括针对特定应用的网络通信特征.这种定制的三维片上网络拓扑结构针对其通信特征可以大幅度的减少功耗开销并降低传输延迟.在三维多核片上系统中,一般将共享存储部件设置在顶层.当DRAM都在三维片上网络的顶层时,一般都采用WideIO接口进行通信[60],外部存储端口不再是片上系统的性能瓶颈.新的性能瓶颈将是网络热点导致的链路拥塞和饱和.文献[60]针对这一新瓶颈,提出了一个新的性能评估分析方法[61]来分配链路缓存,以这种方式缓解热点区域的拥塞.该方法在网络设计阶段,通过采用UniformRandom和Hotspot混合流量模型寻找网络中可能存在的热点区域,计算并分配各链路所需的合适的缓存数量,以提升网络性能.然而,这种方法不具有实时控制能力,链路缓存分配在设计阶段已确定,因此不能根据网络状态进行调整.本节主要从系统层、微结构层和电路层3个层次出发,介绍了三维片上网络体系结构的最新研究进展.事实上,这些研究热点之间并不是相互独立Page12的,它们的关系错综复杂,每一个研究点都涉及其他多个研究点,而几乎所有的三维片上网络研究最终都回归到拓扑结构、路由算法以及路由器微结构设计等问题.TSV的设计优化、低功耗和热管理、提高可靠性和性能、2.5维硅中介技术、容错以及负载均衡等方面的研究,都是通过针对拓扑结构、路由策略和路由器微结构做具体设计来实现的;同时所有针对拓扑结构、路由策略和路由器微结构的设计,其目的又都是为了提高性能和可靠性、实现容错、降低功耗等.不同于二维片上网络研究,三维片上网络的研究结合其自身结构的特点以及面临的问题,更多地出现在热管理、TSV设计优化、2.5维硅中介层利用以及对层间极短距离的利用上.这些研究的成果能够更好地发挥三维结构的优势特点.表2则将本文介绍的文献以这种方式呈现出来.提高性能降低开销容错和提高可靠性均衡负载热管理和低功耗TSV设计优化硅中介利用缓存分配4研究方法与产品研发4.1模拟环境与性能测试在片上网络体系结构研究中,其巨大的设计空间需要模拟器来有效地评估其性能,并选择合适的参数优化设计.二维片上网络和三维片上网络的主要功能都是连接各节点实现通信,三维片上网络体系结构模拟器目前主要沿用二维结构的模拟器.由于在体系结构研究中,我们更多地关心链路层以上层次的结构,只需要考虑节点连通性、链路延迟、链路带宽以及路由器内部结构等设计,而较少地关心TSV等结构的具体实现.因此,将二维片上网络模拟器升级为三维片上网络模拟器,最主要是在拓扑结构的增维.需要在片上网络垂直方向增加相应的链路,同时在路由器微结构增加相应的端口.垂直方向的链路主要模拟TSV的设计,其延时相应较短,垂直链路的带宽位数代表了TSV的数量,因此还需要注意垂直链路数量、密度和带宽的控制.而路由算法、流控机制、网络流量模型等方面则可根据设计相应实现.现有的片上网络体系结构模拟器按照实现编程语言划分为三类,包括以C++实现的Booksim[62]、Garnet[63]、OPENC-Sim[64];以SystemC实现的Noxim①、Nirgam[65]以及以verilog或VHDL等硬件描述语言实现的模拟器.这些模拟器可以模拟片上网络的拓扑结构、路由算法、路由器微结构、流控机制、网络流量模型等各种机制和特性,通过对代码的修改,可以实现各种设计,并测试其性能和硬件开销.此外,这些片上网络模拟器还可以链接到Gem5等全系统模拟器或Trace模拟器Netrace[66]、SynFull[67]等实现全系统环境下测试片上网络的性能.除了上述性能模拟器之外,还有专门测试片上网络功耗和面积的模拟器,如Orion[68]、DSENT[69]和RTLRouter[70]等.三维片上网络专用模拟器VNOC3②是由CristinelAbabei领导的小组采用C++语言开发的仿真平台.该仿真平台是研究两层或三层的三维片上网络架构的一个框架,建立在一个VNOC仿真平台和一个B树布局之上.该平台是专门针对三维片上网络结构设计的,然而在灵活性和功能全面性方面不及Booksim模拟器.此外,“国立”台湾大学的AccessICLab也开发了一个三维片上网络联合模拟平台AccessNoxim③.其代码结构集成了Noxim和Hotspot两个模拟器,因此该平台集成了网络模型、功耗模型和热模型.该模拟平台采用SystemC语言实现,对于重视热管理的设计实现有很高的应用价值.4.2产品研发由于三维集成电路依然面临着众多挑战,对于三维集成电路的研发还处于先期发展阶段,三维逻辑堆叠芯片的商业化产品并没有问世.目前的三维堆叠产品主要是对于存储部件的堆叠以及采用2.5维硅中介层技术的堆叠.在实验研究型芯片方面,如表3所示,2007年①②③forge.net/projects/noximindex.htmlPage13Intel推出了实验性三维芯片Teraflops处理器;2008年罗切斯特大学的Friedman领导的小组研发了第一款堆叠芯片,主频达到1.4GHz;乔治亚理工学院研制的3D-MAPS三维芯片[71],包含了一层逻辑层和一层DRAM层,采用130nm工艺,主频仅277MHz.其逻辑层64核的核间通信采用的是2DMesh结构,垂直互连方面采用了Tezzaron的1.2μm直径的TSV技术.密歇根大学研制的Centip3De是Teraflops处理器RochesterCube3DSystemPrototype表3研究型堆叠芯片单位Intel罗切斯特大学乔治亚理工学院密歇根大学IBM目前,三维逻辑堆叠的芯片由于技术原因并没有产品化,主要是作为实验性芯片由一些研究机构进行研究开发.由于堆叠层数都非常少,一般都是两层堆叠,故其片上网络结构相对简单,多为在逻辑层的2DMesh或Switch,垂直互连采用总线或Switch为主.商业化产品方面,如表4所示,目前最主要的两种存储堆叠标准分别是由美光公司领导设计的HMC(HybridMemoryCube)①和AMD和Hynix领导设计的HBM(HighBandwidthMemory)②.它们均是采用TSV互连堆叠的高性能RAM接口标准,应用到各种芯片的实现上.HBM与HMC的区别体现在DRAM运行频率、总位宽、发热以及扩展性层面.在应用方面,采用HBM的AMDFijiXT已表4商业堆叠芯片三维数据型闪存3DV-NAND3DNANDFlash商业化产品主要出现在存储堆叠上,由于其结构较为规整,热效应并不严重,因此技术逐渐成熟,并出现了许多商业产品.在其互连结构方面,以HMC标准为例,底层存储控制器通过高阶Switch相连,上层存储部件通过总线,与对应的存储控制器连接,组成三维存储结构.5挑战与展望目前,三维片上网络依然面临着许多问题和挑一款大规模三维CMP处理器[72],采用两层结构,一层为包含64个ARMCortex-M3核心的系统,该64核被组织成16个群,通过crossbar相连接,另一层是Cache.两层通过TSV总线连接.IBM的Wordeman等人[73]研制了一个三维原型系统,由一层存储层和一层逻辑层组成.其中存储结构采用的是eDram,其存储逻辑来自IBMPower7processorL3Cache,其垂直互连采用的是三维Switch结构.经于2015年6月问世.英伟达2016年将推出的下一代GPU架构的Pascal也将采用HBM.HMC则将广泛地应用到Intel第二代至强Phi处理器以及三星存储堆叠芯片等产品中.在国内的产品研发方面,武汉新芯在2015年5月宣布其9层结构的三维存储器芯片通过了基本功能的电学验证,预计2017年将实现量产.在2.5维堆叠集成方面,赛灵思公司则在2011年推出了第一款2.5维堆叠的Virtex-72000TFPGA[57].该FPGA芯片在硅中介层上装配了4块FPGA子芯片,通过硅中介层互连打破了I/O瓶颈,提供了FPGA间10000条数据路径的通信.实现同样的性能,比起二维结构面积只有四分之一,功耗更是只有六分之一.2.5维堆叠战,除了本文第二部分提到的三维片上网络的三大问题之外,其进一步发展还面临一系列的挑战和技术瓶颈[74-75],主要包括:(1)缺乏商业化的EDA工具[76]和设计方法.由二维结构的设计转换到三维结构的设计,片上网络结构从空间上获得了非常多的结构优势和性能优势,同时,在设计上所要考虑的约束条件和设计因素①②Page14也不断增加.然而目前没有成熟和合适的EDA工具和设计方法支持三维片上网络设计,这直接导致三维堆叠的商业化产品无法实现.随着设计空间的增大,设计空间探索难度急剧增加[77],如何发挥三维堆叠优势,设计高性能的三维堆叠产品也困难重重,因此,对于支持三维集成电路的EDA工具和设计方法的研究势在必行.(2)散热问题.芯片堆叠所产生的热效应来源于功耗密度的急剧增加,它带来的散热问题目前是限制三维集成电路及其片上网络发展的最大瓶颈,对于芯片可靠性和稳定性的影响非常大,许多设计都受到散热问题的限制而被迫进行缩减,三维片上网络也因此需要各种结构设计来降低开销.解决该问题需要研究者从电路层到系统层提出思路,对三维堆叠的热效应建立模型,研究可能的解决办法以迁移热效应.(3)通孔周围的应力问题.在三维片上网络的垂直TSV周围会出现应力问题,限制了TSV阵列与器件的间距以及TSV在竖直方向布局密度,从而影响网络带宽和器件布局.这就要求在垂直TSV的设计中考虑全局性因素,需要与电源、时钟网络等因素共同考虑网络资源分配,同时需要在三维片上网络进行体系结构设计与优化.(4)测试问题.目前研究者对于三维堆叠技术的测试问题的研究还非常不足,缺乏针对三维片上网络的测试方法.测试问题最大的局限就是对于堆叠的硅片难以探测访问,难以判断堆叠芯片内部网络的情况,为高可靠性产品的实现带来了隐患.因此,三维堆叠及三维片上网络技术急需研究者提出测试设计的解决办法.上述挑战虽然带来了许多困难,但同时也指引了三维片上网络发展的方向,现在和未来的研究除了提高三维片上网络的性能之外,主要研究目标就是解决这些问题.结合三维片上网络研究热点以及系统结构设计的未来发展,三维片上网络体系结构层设计主要有两个大的发展方向.一方面是将二维片上网络已有的结构或机制引入或移植到三维片上网络中,并根据三维结构特点进行优化设计,包括拓扑结构、路由算法、路由器微结构等方面,这对于三维片上网络研究的快速发展进步是非常有利也非常有必要的;另一方面,在三维片上网络的设计中最重要的一点就是注重混合设计.由于片上网络的三维结构在水平方向上的两维与竖直方向的第三维并不是对称的,因此在设计时可以分别结合片内和片间网络的特点进行不对称设计,发挥不同结构各自的优势特点,这种不对称性既可以适用于拓扑结构、路由器微结构等物理结构上,也适用于路由算法、流控机制等通信流量的管理上,从而更好地发挥出三维片上网络结构的优势.综上所述,三维片上网络由于具备二维片上网络所不具备的空间优势,其发展空间非常广阔,必将伴随三维集成电路的发展成为下一代多核甚至众核系统的主流片上通信架构.
