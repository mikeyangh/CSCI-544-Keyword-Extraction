Page1预测状态表示模型的复位算法刘云龙吉国力(厦门大学自动化系福建厦门361005)摘要预测状态表示(PredictiveStateRepresentations,PSRs)是用于解决局部可观测问题的有效方法.然而,现实环境中,通过样本学习得到的PSR模型不可能完全准确.随着计算步数的增多,利用PSR模型计算得到的预测向量有可能越来越偏离其真实值,进而导致PSR模型的预测精度越来越低.文中提出了一种PSR模型的复位算法.通过使用判别分析方法确定系统所处的PSR状态,文中所提算法可对利用计算获取的预测向量复位,从而提高PSR模型的准确性.实验结果表明,采用复位算法的PSR模型在预测精度上明显优于未采用复位算法的PSR模型,验证了所提算法的有效性.关键词预测状态表示模型;预测精度;复位;判别分析;预测状态表示模型的准确性1引言对动态系统建模,是科学和工程中普遍存在的一个问题,在很多方面,如社会经济系统、环境生态系统、能源系统、生物医学系统、教育训练系统等,都有很广泛的应用[1].通过对系统建模,可以预测和控制该系统.例如,一个投资者可以利用一个公司以往Page2的股价,对该公司的股价建立一个模型,从而预测该公司未来股价的走势,决定未来投资的方向[2].具体到人工智能领域,对于一个随机的、局部可观测的环境,智能体由于受到其感知能力的限制,有可能会感知不到所处环境的某些重要特征,同时,智能体采取的动作也往往得不到预期的效果[3].在这种局部可观测、随机的系统中如何获取智能体的最优策略———即不确定性环境下的规划问题,是人工智能领域研究的一个重要问题[4].解决这种问题的常规途径是首先对系统建模,然后根据得到的系统模型对问题进行求解.局部可观测马尔可夫决策过程(PartiallyOb-servableMarkovDecisionProcesses,POMDPs)为解决这种不确定性的规划问题提供了丰富的数学框架[4].但众所周知,POMDP模型的建立,依赖于局部可观测的名义状态(nominalstate),因此学习系统的POMDP模型往往很困难,并且需要很多先验知识.预测状态表示法(PredictiveStateRepresen-tations,PSRs)是近年来提出的一种对受控动态系统建模的新方法[5].和基于隐状态(hidden-state-based)的POMDP模型不同,PSRs完全根据可观测的量来表现系统的状态.因此,通过观测数据,学习动态系统的PSR模型比学习其POMDP模型应该更容易,并且不容易陷于局部极小点.同时,相比另外一种常用的动态系统模型———基于经历的模型(history-basedmodel),PSR模型有更强的表示能力,有更多的应用领域[1].PSRs用系统中可执行的特定检验(tests)或实验(experiments)所发生的概率,组成向量,称为预测向量,表示系统所处状态.如果存在一个检验,它在两个经历(history)下发生的概率不同,则表示两个经历下系统的PSR状态不同;如果对于所有可能发生的检验,它们在两个经历下发生的概率均相同,则表示两个经历下系统的PSR状态相同.对一个受控系统,一个经历指的是从初始时刻开始的一个动作-观测对序列,表示到目前为止,系统所经历过的动作、观测.同经历一样,一个检验指的也是一个动作-观测对序列,但没有从初始时刻开始的限定,表示从当前时刻起,系统将来可能经历的动作、观测.已经证明,PSR模型的状态表示,不必用到所有检验发生的概率,只用检验核(core-tests)中所有检验发生的概率即可[5].详细介绍见第2节.针对PSRs的主要研究内容是发现和学习系统的PSR模型[6-9],并根据PSR模型选取动作,获取智能体的最优控制策略[10-11].在现实环境中,学习得到的PSR模型不可能完全准确,对同一PSR状态,在不同时刻,通过PSR模型计算得到的用于描述该PSR状态的预测向量也往往不同,仅凭预测向量无法确定系统所处的PSR状态,并且在利用PSR模型计算任意经历的预测向量时,随着计算步数的增多,得到的预测向量有可能越来越偏离其真实值,进而导致PSR模型的预测精度越来越低,而模型很一个作用在于其能够给予我们关于某一事件的预测.本文的工作是首先考虑如何利用判别分析方法,确定每一时刻系统所处的PSR状态;然后,在每一时间步,以系统所处PSR状态的预测向量对当前PSR模型复位;最后,利用3个标准的POMDP测试系统,对所提算法的效果进行验证.仿真结果表明,采用复位算法的PSR模型,在预测精度上明显优于未采用复位算法的PSR模型.本文假定所研究的系统是离散的、观测值有限、可用有限POMDP及有限阶的马尔可夫模型表示.2PSRs简介上面已经提到,PSR模型采用检验核中所有检验发生概率所组成的向量作为其状态表示.假定当前系统的观测值集合为O={o1,o2,…,o|O|},动作集合为A={a1,a2,…,a|A|},则长度为n的经历h={a1o1a2o2…anon}发生的概率是从初始时刻开始,采取动作序列a1a2…an后,观测值序列o1o2…on出现的概率,即p(h)=prob(o1=o1,o2=o2,…,on=on|a1=a1,a2=a2,…,an=an).同样,长度为m的检验t={a1o1a2o2…amom}在经历h={a1o1a2o2…anon}下发生的概率为p(t|h)=p(ht)/p(h)=prob(on+1=o1,on+2=o2,…,on+m=om|h,an+1=a1,an+2=a2,…,an+m=am),其中ai表示在i时刻采取的动作;oi表示在i时刻执行动作ai后在该时刻出现的观测值.给定一系列检验的集合:Q={q1,…,qk},如果由这些检验的预测值所组成的向量狆(Q|h)=(p(q1|h),p(q2|h),…,p(qk|h))T是所有经历的充分统计量,即狆(Q|h)包含了经历h下所有和未来预测相关的信息,也就是存在函数ft,对于所有经历h,使得任意检验t发生的概率为p(t|h)=ft(狆(Q|h)),则认为检验集合Q构成一个PSRs.其中p(qi|h)是在经历h下检验qi发生的概率.Q被称为检验核,狆(Q|h)被称为预测向量,以狆(Q|h)作为PSRs的状态表示.同时,如果ft是线性函数,则称Page3该PSRs是线性PSRs;如果ft是非线性函数,则称该PSRs是非线性PSRs.本文针对的是线性PSRs.在数学上,可用系统动态矩阵犣描述受控和非受控系统,而PSR模型可以直接从系统动态矩阵犣推导出来[1].如图1所示,犣的行对应所有可能的经历(过去),其中第1行对应空经历(nullhistory)即初始经历,列对应所有可能的检验(未来),犣的元素表示在给定经历情况下,检验发生的概率.如果系统的系统动态矩阵的秩为k,则矩阵中存在k个线性无关的检验列,满足检验核的定义,可将其作为系统的检验核Q.同样,将矩阵犣的行向量中任意一个最大线性无关组所对应的经历的集合称为经历核(core-histories).如果已获得检验核,则对每一个检验t,存在长度为k的权向量犿t,使得相应于检验t的矩阵的列p(t|h),可表示为p(t|h)=狆(Q|h)T犿t.该式表明,在得到经历h的预测向量狆(Q|h)后,如采取任意动作a∈A,得到任意观测值o∈O,则其对应的预测向量,即当前时刻的状态表示可通过式(1)进行计算或更新.即对qi∈Q[5]:p(qi|hao)=p(aoqi|h)其中犿aoqi是检验aoqi的权向量,犿ao是检验ao的权向量.所以经历hao的预测向量为[5]其中犕ao是一个k×k矩阵,第i列对应的是犿aoqi.从式(2)可知,在得到PSR模型参数犕ao、犿ao和空经历的预测向量狆(Q|)后,通过计算可得到任意经历的预测向量,即可得知任意经历下系统所处的状态.3PSR模型的复位算法3.1预备知识在详细描述PSR模型的复位算法之前,我们给出与所提算法相关的定理以及状态经历的概念.果犣中的任意两行不相等,则它们线性无关.定理1.给定一个精确的系统动态矩阵犣,如证明.利用反证法证之.假定h1、h2是犣中任意不相等的两行所对应的经历.如果h1对应的行向量和h2对应的行向量线性相关,即存在常数b≠1,对于任意检验t,均有p(t|h1)=b×p(t|h2).然而,根据ka-∈Ak,∑t∈T(a-)p(t|h)=1(注:T(a-)表示所有动作序列为a-的检验集合,Ak表示长度为k的所有动作的集合,h为所有可能发生的经历)[1],可得∑t∈T(a-)p(t|h1)=∑t∈T(a-)b×p(t|h2)由于∑t∈T(a-)p(t|h1)=1,得b=1,与前面b≠1相矛盾.故如果犣中的任意两行不相等,则它们线性无关.定义1.系统动态矩阵犣中所有两两线性无关的行向量,其对应的经历所组成的集合称为犣的状态经历集合,集合中的元素称为状态经历.根据状态经历的定义和定理1可知,状态经历集合对应了系统动态矩阵犣中所有可能发生的不同的行向量,状态经历可以用来描述系统所有实际存在的PSR状态.并且状态经历集合中状态经历和系统实际存在的PSR状态是一一对应的.现实环境下,系统的PSR模型往往是不准确的,导致无法根据预测向量确定某一时间步系统所处的PSR状态.结合状态经历的概念及性质,下面讨论了如何利用判别分析方法[12]确定系统在任意时刻的PSR状态.进而,对通过数据学习得到的PSR模型,讨论如何复位.3.2PSR模型的复位现实环境下,获取系统的PSR模型,首先需要估计系统动态矩阵犣的元素p(t|h).当前大部分发现和学习系统的PSR模型的算法,都利用蒙特卡罗方法估计p(t|h)[6-8].当p(t|h)是通过蒙特卡罗方法估计得到的时,可以认为系统动态矩阵犣中,对应同一个PSR状态的所有行构成了一个正态总体.如果当前系统有k个实际存在PSR状态,则存在k个总体.每个总体,包含了对应同一个PSR状态的所有行向量.如果已知每个总体的均值向量和协方差阵,那么,用判别分析方法,就可判断一个新出现的预测向量,属于哪一个总体,即对应哪一个PSR状态.Page4在每个总体的均值向量狌(i)和协方差阵Σ(i)未知的情况下,要判断一个预测向量对应哪一个PSR状态,则需要通过样本,估计每个总体的均值向量和协方差阵.用于估计每个总体的均值向量和协方差阵的样本,可在获取系统的PSR模型的过程中得到①.判断了一个新的预测向量所对应的PSR状态后,即可对系统的PSR模型复位.下面讨论了算法的具体步骤.PSR模型的复位算法的具体步骤如下:1.在获取系统的PSR模型的过程中,可以得到一组不同经历下的预测向量,这些预测向量都是通过蒙特卡罗方法估计得到的.将这些预测向量按照以下原则划分为多个子矩阵:同一个子矩阵中的预测向量两两线性相关,即该矩阵的秩为1;不同子矩阵的预测向量线性无关(由于通过估计得到的犣的子矩阵的元素存在噪声,本文采用计算元素有噪声的矩阵的秩的方法来计算矩阵的秩[6]).2.如上所述,如果两个向量线性无关,则它们对应不同的PSR状态;如果两个向量线性相关,则它们对应同一个PSR状态.因此,一个子矩阵中所有的预测向量对应同一个PSR状态.可以认为该子矩阵中的所有预测向量是其对应总体的一个样本.如果有N个子矩阵,则得到N个取自不同总体的样本.3.通过样本i估计得到总体i的均值向量狌(i)和协方差阵Σ(i)(i=1,…,N).4.对于每个样本中的所有经历,为了保留初始状态的预测向量.如果存在空经历,则将空经历标记为状态经历;否则,将发生次数最多的经历标记为状态经历.5.如果已知一个经历的预测向量,则其对应的PSR状态可通过判别分析方法获得.采用距离判别法确定系统的PSR状态(当然也可用其它的判别分析方法确定系统的PSR状态,在这里不再详述).假定当前经历为h,在采取动作a,得到观测值o后,则系统所处的PSR状态为其中,i=1,…,N.6.将状态经历的预测向量作为其对应的PSR状态的预测向量.在每一时间步下,确定系统所处的PSR状态后,以当前PSR状态的预测向量,代替通过PSR模型计算得到的预测向量,即对PSR模型复位.现实环境下,通过数据学习得到的PSR模型不可能完全准确.因此,几乎不可能得到某一PSR状态的精确预测向量.但根据状态经历的获取方法,可以认为状态经历的预测向量最接近其对应的PSR状态的预测向量的真实值,同时由于状态经历和PSR状态一一对应,因此可将状态经历的预测向量作为其对应的PSR状态的预测向量.4实验将本文所提算法应用于一些标准的POMDP环境②.针对每个环境,智能体采取随机策略得到一训练数据后,得到一组不同经历下的预测向量、当前系统的PSR模型、状态经历的集合、状态经历对应的预测向量的集合即PSR状态对应的预测向量的集合以及每一个PSR状态对应总体的均值向量和协方差阵.然后采用随机策略产生一测试数据,并采用一种标准化的指标衡量PSR模型的准确性,即在采取某一动作后,首先根据得到的PSR模型计算所有观测值出现的概率,然后根据其准确的POM-DP模型计算实际上所有观测值出现的概率,通过两者之间的平方差判断PSR模型的准确性,具体地说是通过式(4)来判断[13]:L∑L1其中,L表示的是产生的测试数据的长度,在本文中L=10000.p(o|ht,at)是在经历ht下采取动作at产生观测值o的真实概率,p^(o|ht,at)是通过PSR模型计算得到在经历ht下采取动作at产生观测值o的概率,即p^(o|ht,at)=狆(Q|ht)犿ato.其中,针对本文算法,狆(Q|ht)是经过复位后的预测向量,即首先根据学习得到的PSR模型计算ht对应的预测向量,然后判断经历ht对应的PSR状态s,最后以狆(Q|s)作为经历ht的预测向量狆(Q|ht).为了验证本文算法的有效性,将采用复位算法的PSR模型的预测效果和未采用复位算法的PSR模型的预测效果作了比较分析.其中,对于未采用复位算法的PSR模型,每一时间步对应的预测向量直接根据学习得到的PSR模型计算得出.对于两种算法,各做了10次试验.对相同长度的训练数据,以10次实验得到的平均值作为该长度对应的差值.试验结果如图2所示,其中横坐标表示的是用于获得PSR模型的训练数据的长度,纵坐标表示的是采用式(4)计算得到的差值.同时,表1给出了①②Page5在实验过程中所有环境下两种算法得到的最小差值.CheeseMaze0.0352970.003642284×3Maze0.03450Shuttle根据实验结果可知,在大多数情况下,采用复位算法的PSR模型相比未采用复位算法的PSR模型更准确.但从图2可以看出,在4×3Maze和Shuttle环境中,采用复位算法的PSR模型的预测效果并不稳定.分析原因如下:当用判别分析方法在每一时间步跟踪系统的PSR状态时,如果实验过程中不能充分发现系统的状态经历的集合,即充分发现系统的PSR状态,或者不同的PSR状态对应的预测向量差别不是太明显时,在某一时间步下确定的PSR状态有可能是错误的,因此会导致预测效果不稳定的情况发生.虽然如此,从实验结果可以看出,通过采用判别分析方法确定系统在任意时间步的PSR状态,随后对系统的PSR模型复位,用于提高PSR模型的准确性仍然是非常有效的.本文针对的是可用有限阶马尔可夫模型表示的系统,即系统中实际存在的PSR状态数量有限.对于状态空间较大的系统,如果在每一时间步都对系统的PSR模型复位,则所需的计算量较大.对于上述情况,可以仅仅在当前经历是状态经历时,对PSR模型复位,而不是在每一时间步都对PSR模型复位.5结论在对一个离散时间、有限观测值的受控动态系统建模时,相比于其它两种常用的POMDPs和基于经历的方法,PSRs具有很多优点,因此得到了越来越多的重视.在现实环境中,通过学习得到的PSR模型不可能完全准确,因此在用学习得到的PSR模型计算某一时间步对应的预测向量时,随着计算步数的增多,得到的预测向量有可能越来越偏离其真实值.在本文工作中,提出了一种PSR模型的复位算法,通过在每一时间步对PSR模型复位,提高PSR模型的准确性.算法被应用于一些标准的POMDP问题,实验结果验证了本文所提方法是有效的.
