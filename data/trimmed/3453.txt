Page1基于运动受限弹簧质子模型的图像上采样龚永义1),4)罗笑南2),3),4)1)(广东外语外贸大学信息学院广州510006)2)(中山大学信息科学与技术学院广州510006)3)(教育部数字家庭重点实验室(中山大学)广州510006)4)(国家数字家庭工程技术研究中心广州510006)摘要图像上采样是可视媒体技术的重要组成部分.作者提出一种新的方法,将图像上采样问题转换成基于运动受限弹簧质子模型的力学平衡和基于变形网格的上采样问题.首先,根据图像放大的特点,作者调整传统弹簧质子模型中拉伸/排斥力的传统方法定义方式,避免质子对邻域外其它质子的运动产生拉伸干扰;设计向心力,限制质子活动区域;基于源图像梯度场模的梯度场定义模型外力,使所有边缘质子所受外力垂直指向图像边缘方向,非边缘质子所受外力几乎为零;基于Helmholtz-Hodge定理引进光滑正则项,保证变形的光滑性.然后,通过弹簧质子模型确定图元控制区域网格,并基于该网格实现上采样.作者提供了若干实验数据说明方法是有意义的.关键词图像上采样;运动受限弹簧质子模型;图元控制区域1引言图像上采样,又称为图像放大,是一种将低分辨率图像转换成高分辨率图像的图像处理技术,是可视媒体技术的重要组成部分.近10年,随着高清设备、网络电视、3G手机等可视媒体的普及,图像上采样研究再次成为热点,在最近几年的ACMSiggraph、CVPR等学术会议有专题讨论[1-4].图像上采样可以描述为插值问题:如何在新的位置插入合适的图像信息,属于典型的病态问题,需要额外加入适当的限制条件,如放大的图像尽可能保持原有图像的梯度特性,才能解决.图像上采样的研究成果大致可以归为3类[1-27]:(1)基于插值(核函数)的图像上采样算法.特点是:假设图像数据是空间光滑,带宽有限,通过设计有限大小的插值核函数近似sinc函数,进行插值计算,算法实现简单,速度快,当图像光滑时效果很好;缺点是没考虑图像边缘特定局部信息,放大图像尖锐特征模糊化,细节缺失.(2)基于重建的上采样算法.这类算法是目前的热点研究方向,特点是依据先验图像特征知识及原始图像必须与放大图像的下采样相似限制等,重建图像.这类算法放大图像效果相对较好,但算法复杂,速度有待进一步提高.(3)基于学习的上采样算法.这类算法强调高、低分辨率图像之间的关联,通过学习训练,归纳高、低分辨率图像对之间的规律,进行图像上采样.算法的效果与训练集高、低频数据的相似性及数量密切相关,通常算法复杂.Nearest-Neighbor插值、Bilinear插值、Bicubic插值等是经典的基于插值(核函数)图像上采样算法[5].为减少信息丢失,Unser等人[6]提出任意采样步长的最小二乘多项式样条重采样算法,实现任意比率的图像上采样.Marsi和Carrato等人[7]依据图像的局部亮度差调整线性插值的参数,得到更强的图像对比度.Su和Willis[8]根据图像数据,局部调整插值权,减少放大图像的模糊度和其它缺陷.Cha和Kim[9]提出EASE算法,在插值误差(余项)定理的基础上,依据图像的边缘特性,通过弥补误差的方法,改进双线性插值图像上采样算法.研究人员近几年提出的算法,多数可以归属于第(2)、(3)类方法,它们的共同特点是上采样效果较好,但算法复杂.Atkins等人[10]将聚类方法用于图像上采样研究,将图像像素按边、光滑区域等排序,在线性插值的基础上建立决策树,采用基于树的分类方法实现图像上采样.Battiato等人[11]提出的LAZA算法,采用线性插值放大图像,建立简单规则和可调整阈值检测边缘,并更新放大图像;之后Battiato等人[12]提出SIAD算法,引入各项异性扩散函数锐化图像边缘.Hertzmann等人[13]提出广义图像类推框架(imageanalogies),通过范例图像推理出图像详细结构.Freeman等人[14]在此基础上,提出了基于范例(example-based)的图像上采样算法;Tappen等人[15-16]则根据范例集,训练一簇线性插值算子,用于计算高分辨率图像中的可能图像块;然后采用类似belief-propagation策略,为低分辨率中的每个像素,选择合适的高分辨率图像块.基于学习的上采样在图像上采样研究中也很流行.Kopf等人[1]提出解(solution)上采样算法,首先从低分辨率图像计算解,然后采用jointbilateralfiltering进行上采样.Avidan和Shamir[2]提出content-aware图像上采样算法,通过在切割开的裂缝之间插入或删除不太重要的像素,调整图像大小.Li等人[17]提出的NEDI算法基于低分辨率图像的协方差估计高分辨率图像的协方差.Sun等人[4]引入gradientprofile描述图像的边缘几何特性,通过学习得到高、低分辨率之间的gradientprofiles统计分布关系,实现图像上采样.Fattal[3]则分析不同分辨率图像边的依赖统计特性,以此为先验知识,用于重建因图像上采样而丢失的高频信息.也有研究人员建立高低分辨率联系的非参数集,依此向被插值图像添加高频块,但这种方法虽能增强放大图像的锐利度,却引进了不规则信息.为此,Aly和Dubois[18-19]采用全变分方法进行图像上采样,消除不规则信息.总体而言,虽然第(2)、(3)类算法效果较好,但通常算法比较复杂,并不适合在资源受限设备,如手机等移动设备上运行.因此设计符合受限情形的上采样算法是有必要的.本文给出基于运动受限弹簧质子模型的图像上采样算法,算法由基于运动受限弹簧质子模型的网格变形预处理和基于变形网格的上采样二步骤组成.首先我们基于图像生成弹簧质子网格,通过网格变形,令图像边缘附近的网格质子向边缘靠近,非边缘质子尽可能不移动,然后在变形网格的基础上,实现图像上采样.其中网格变形预处理可以预先在高端机器上运行,而基于变形网格的上采样可在受限Page3设备上运行.本文第2节首先说明网格变形用于图像上采样的原理,然后给出基于图像特性的运动受限弹簧质子网格模型;第3节给出基于变形网格的上采样算法;第4节给出适当示例,讨论算法的有效性,分析算法的优缺点;第5节是结论.2基于弹簧质子模型的网格变形评价图像上采样算法优劣的一个常用标准是上采样图像保持源图像图像特性的程度,其中梯度特性是较多采用的图像特性.本文我们给出基于运动受限弹簧质子网格变形的上采样算法,实现保梯度特性的图像上采样.为方便描述,我们称由位于相邻两行两列上的4个图像像素顺时针连接所围的区域为图像的一个图元(cell),上述像素称为图元的端点(如图1(a)).显然,源图像上采样所得新像素必落于源图像图元中,新像素的取值依赖于其所在图元的图像特性.图元与图像区域的关系可归纳为3类情形(如图1(b)):图元处于源图像区域内部并远离区域边缘;图元处于源图像区域内部但位于区域边缘;图元处于区域边缘.对于第1类情形,图元区域内所有像素拥有相似的图像特性,它们之间可以用一种简单的函数关系,如双线性函数近似,将图元区域内的像素取值近似成以图元端点为插值点的函数表示.对于第2类情形,由于图像区域特性的延伸性,在上采样时,我们认为图像的区域特性不会因为图元位于边界而停止,更合理的是它会“漫过”现有边界,涌入与该图元紧邻的图元区域,从而这片被“漫过”的区域应拥有与该图元类似的图像特性,我们可以采用类似第1类情形的方式计算图元区域和漫过区域中新像素的值.对于第3类情形,图元位于边缘,根据第2类情形知道,图元的部分区域已被其它图元“漫过”,只有剩余区域的特性可以由该图元刻画.为方便描述,我们将上述三类情形中,可以依赖图元端点进行像素值计算的区域称为图元的控制区域,用于描述该区域内新像素间函数关系的函数称为图元控制函数.归纳上文分析可以知道,图元控制区域具备如下特点(如图2,图6(b)):第1类情形的图元控制区域就是图元区域本身,第2类情形的图元控制区域是在图元区域基础上向边缘方向的延伸,第3类情形的图元控制区域是图元区域向边缘方向的收缩.从图元控制区域角度分析,经典比例bilinear插值上采样算法假定图元控制函数是双线性插值函数,图元控制区域就是图元区域本身,从而忽略不同区域图元控制区域的差异,从而导致上采样效果不佳.因此,给出合适的图元控制区域,有助于提高上采样效果.本文我们采用基于运动受限弹簧质子模型的网格变形来定位图元控制区域.我们沿用文献[28]中的方法定义弹簧质子模型.假设源图像I0定义在域ΩR2上.源图像中像素对应模型中质子,相邻像素间横纵联系由模型中对应质子间的无质量弹簧模拟.模型变形是关于时间的过程,即变换h(x)是关于时间的函数:h(x,t)=x+u(x,t)表示t时刻质子x的坐标,质子运动轨迹满足:Page4模型的关键是内力Fint、外力Fext的定义.2.1内力定义弹簧质子模型的变形主要体现为三种现象:拉伸、剪切和弯曲.可以通过三类弹性力来模拟:拉伸/排斥力Fstretch、弯曲力Fbending和剪切力Fshear.为防止质子运动过度振荡,引入阻尼力Fdamping.上述四类力组成传统内力[28],我们假设模型中弹簧符合Hooke定律,上述弹对于基于2D图像建立的弹簧质子模型,由于图像不可能向第三维空间发生弯曲变形,因此不考虑弯曲力,为简单起见,不考虑剪切力[28].性力定义如下.2.1.1拉伸/排斥力拉伸/排斥力因弹簧拉伸或压缩变形而产生.网格变形的目的是定位图元控制区域,质子运动模拟对应像素因所在图元区域特性所产生的偏移.根据图像上采样特点,质子间的相互影响与它们之间的距离成反比,因质子偏移而产生的弹簧拉伸不应对其邻域内的其它质子产生过分的拉伸影响,避免其它质子的不恰当偏移,造成相关图元区域特性的虚假延伸,而得到虚假的图元控制区域,因此,我们需要对拉伸/排斥力作适当调整,限制拉伸力,确保它的拉伸影响仅局限于质子的邻域内,而不至于向外传播.本文我们采取的措施是直接取消弹簧的拉力.t时刻质子x所受的拉伸/排斥力定义为Fstretch(x,t)=∑y∈N(x)-k(x,y)·y-xA(x,y)=‖y-x‖-l(x,y),‖y-x‖<l(x,y)其中质子x∈Ω,N(x)是x的邻域质子集,k(x,y)是弹簧xy的弹性系数.l(x,y)表示弹簧质子模型在初始稳定状态时,弹簧xy的自由长度[28].2.1.2阻尼力质子x所受阻尼力定义如下,阻尼力的特点是:速度越大,阻力越大.t时刻其中km(x)是阻尼系数,u(x,t)是质子x的偏移量.2.1.3运动受限图像上采样中一个很大的特点是每个像素的影响范围有限,不应超过它所在的4个图元区域,因此,与之对应的质子的运动偏移也应当在相应的网格区域内.为此,我们特别设计向心力,限制质子的运动.向心力具备如下特点:当质子一旦偏离指定区域时,向心力会变大,否则向心力很小或为零.为简单起见,我们将质子的运动区域限制在以质子x初始位置为中心,以与质子x相连弹簧的最短自由长度l为半径的区域内.t时刻质子x所受向心力定义为Fcent(x,t)=-kcent(x)·u(x,t)-xd(x,t)=‖u(x,t)-x‖-l,‖u(x,t)-x‖-l>0为方便起见,我们将向心力归为内力,从而,t时刻质子x所受的内力为2.2外力定义外力定义是模型的关键.根据图元控制区域的特点,我们要求外力的作用是引导边缘质子向边缘运动,非边缘质子尽可能不运动,由于我们已取消拉伸力,因此,外力应具备如下特点:边缘点所受外力应垂直指向边缘并且较大,非边缘点所受外力尽可能小或为零.Xu等人[29]定义的梯度向量流可以保证边缘像素的梯度向量流垂直指向边缘,但非边缘像素的梯度向量流也指向边缘且较大,因此,若基于梯度向量流定义外力,会导致非边缘质子发生较大的偏移,使得图元控制区域定位错误.分析图像梯度场模的梯度场(图3),图像边缘像素的梯度场模的梯度垂直指向边缘,且它的模比较大,其它区域像素的梯度场模梯度的模相对比较小,几乎为零,基本符合我们对外力的要求.因此我们在图像梯度场模梯度场的基础上定义外力.简单而言,可以直接将t时刻质子x所受外力定义为Fext(x,t)=‖I0‖x.为避免变异的网格变形,如网格相交错位,尖角,极不规则网格等,我们为模型网格变形引入光滑Page5性限制.根据Helmholtz-Hodge定理,光滑变形场可以分解成两部分:散度无关(divergence-free)项和旋度无关(curl-free)项.散度用于度量变形场的流量,旋度与变形场中的旋转有关.尽可能减少变形场的散度和旋度,可以保证变形场的光滑性.为此,我们引入能量函数E(u(x,t))··=2Ωα其中u(x,t)=(f(x,t),g(x,t)),x=(x1,x2),α是权系数.根据散度和旋度定义,能量函数E(u)的最小化,可以使得变形场的散度和旋度为零.在变分法框架下,能量函数最小化的必要条件是其中Δ是Laplace算子.由此,我们将外力修正为对于网格变形中可能出现的拓扑保形问题,我们直接采用文献[28]中提供的策略.3基于变形网格的上采样通过基于运动受限弹簧质子模型的网格变形,我们得到源图像所有图元的控制区域.下面将在图元控制区域网格的基础上实现上采样.首先我们计算每个图元控制区域端点处点的像素值,然后运用双线性插值计算图元控制区域内的上采样像素的值.图4运动受限弹簧质子模型稳定后质子可能的4种情当模型网格变形稳定后,质子的新位置必定是如图4所示的4种情形之一.假设质子x运动到空心点y处,则存在以y为端点且包含质子x的图元控制区域,从图像特性的区域延伸性分析,该控制区域所对应的图元对y影响最大,我们采用基于该图元的双线性外插值计算y处的值,得到控制区域端点y处的像素值V(y).为计算图元控制区域内上采样像素的值,我们用仿射变换近似图元到图元控制区域的变形变换.设图元A的4个端点为(x11,x12),(x21,x22),(x31,x32),(x41,x42),对应控制区域端点为(y11,y12),(y21,y22),(y31,y32),(y41,y42),它们之间的变形变换用仿射变换近似,其中y=(y1,y2)是图元A控制区域内任一点,x=(x1,x2)是在仿射变换假设下点y在图元A中的对应点(图5).在保拓扑的前提下[28],我们将图元控制区域划分成两个三角区域,相应图元区域也划分成两个三角区域,由此将图元控制区域与图元区域之间的仿射变换,用两组三角区域之间的仿射变换近似.图5用仿射变换近似图元A与它的图元控制区域之间以图5图元控制区域中灰色三角区域与图元中对应灰色三角区域之间的仿射变换为例,我们可以确定仿射变换系数如下:从而得到狔=(y1,y2)的对应点狓=(x1,x2),然后我们按下式计算狔=(y1,y2)处像素的值V(狔),V(y1,y2)=(x41-x1)(x42-x2)V(y11,y12)+我们将基于运动受限弹簧质子模型的图像上采样算法归纳如下:(1)基于图像生成弹簧质子模型网格;(2)基于网格,进行基于运动受限弹簧质子模型的网格变形,获取每个图元的控制区域;(3)依据给定的放大倍数,基于变形网格(图元控制区域)进行上采样,得到相应的上采样图像.Page64实验与讨论本节我们给出若干实验数据,说明方法的有效性与不足.我们的实验在配置为IntelCore双核CPUT3002.0G,RAM3GB的IBMR61机上进行.所采用的操作系统是WindowsVista,所有实验用VisualC++6.0编写实现.为简单起见,假设所涉及弹簧质子模型中所有弹簧自由长度为1,弹性系数k=0.1,阻尼系数km=1.0,向心力系数kcent=图6Cameraman局部放大在图7中,我们分别对圆环图像和医学图像放大4×4倍,结果表明我们的算法能较好地保持源图像的边缘锐度并保持适当的边缘光滑性,而不会出现锯齿现象.在图8中,我们分别采用最近邻域法(Nest),Bicubic插值算法[5]、Li等人[17]的Nedi算法、Fattal[3]的基于边缘统计上采样算法和我们的算法对child图像进行4×4倍的图像放大,结果表明我们方法的放大效果清晰度比Bicubic插值算法和Nedi算法好,逊于Fattal的算法.但我们的算法的一个重要特点是可以分成相对的两个过程,其中基于运动受限弹簧质子模型的图元控制区域定位只需运行一次,一旦确定图元控制区域网格,我们可以基于该网格对图像实施任意次任意倍数的快速放大处理,且对环境要求不高,可以在受限设备上运行.在图9中,用我们的方法对flower图像和oldman图像分别进行2×2、4×4倍数的放大,放大结果基本都能保持源图像的锐度.我们也尝试采用RMS[4]比较不同算法的上采样质量.在表1中,我们给出图8中4个上采样算法与我们方法(MCSM)的RMS,表1说明我们方法的RMS值优于Nest、Nedi,与Fattal相近,同时,表1显示Bicubic的RMS最优.但从图8实际图像效果可1.0,光滑系数α=0.2,时间步长Δt=0.4.由于我们在计算外力时,对图像亮度值进行归一化处理,因此时间步长可以比较大.在图6中,我们对所选图像区域放大4×4倍.首先我们运用所提出的算法,确定图像的图元控制区域网格(图6(b));图6(b)表明,位于图像边缘的质子向边缘方向运动,非边缘质子基本不动,图元控制区域网格能较精确地定位图像边缘区域,基于图元控制网格的上采样图像能较好地保留源图像区域的边缘信息(图6(c)).图7采用我们的算法放大4×4倍的图像(第1行左图采用最近邻域插值放大,右图采用我们的算法;第2、3行为医学图像上采样.第2行采用最近邻域插值,第3行采用我们的算法)以看出,Fattal等人的方法应当优于Bicubic算法.因此,RMS只能作为评价上采样算法质量的参考标准.Page7图8采用不同的上采样算法,对128×128的图9采用我们的算法分别放大2×2、4×4倍child45.3732.2647.7533.6933.58尽管如此,我们的方法存在不足.由于我们基于图像梯度场模梯度场定义弹簧质子外力,算法对梯度变化比较平缓的图像边缘区域放大效果有限,不适用于对受噪音干扰图像的放大处理,模型对参数的选取影响放大效果等,这些是我们接下来尽快解决的问题.5结论本文中我们将图像上采样问题转换成基于运动受限弹簧质子模型的力学平衡和基于变形网格的上采样问题.弹簧质子模型主要用于确定图元控制区域网格.根据图像放大的特点,我们调整传统弹簧质子模型中拉伸/排斥力的传统方法定义方式,避免质子对邻域外其它质子的运动产生拉伸干扰;设计向心力,限制质子活动区域;我们基于源图像梯度场模的梯度场定义模型外力,使所有边缘质子所受外力垂直指向图像边缘方向,非边缘质子所受外力几乎为零;基于Helmholtz-Hodge定理引进光滑正则项,保证变形的光滑性.然后,通过弹簧质子模型确定图元控制区域网格,并基于该网格实现上采样.实验表明是有意义的.由于基于梯度场定义弹簧质子模型外力,我们的方法对梯度变化比较平缓的图像边缘区域放大效果有限,不适用于对受噪音干扰图像的放大处理,对模型参数的选取影响放大效果等,这些是我们接下来尽快解决的问题.
