Page1一种基于不变量的工作流协同模型分解方法葛季栋1),2)胡海洋1),4)周宇1),5)胡昊1),3)王栋毅1),2)过晓波1),2)1)(计算机软件新技术国家重点实验室(南京大学)南京210093)2)(南京大学软件学院南京210093)3)(南京大学计算机科学与技术系南京210093)4)(杭州电子科技大学计算机学院杭州310018)5)(南京航空航天大学计算机科学与技术学院南京210016)摘要现代企业计算的业务过程越来越复杂,有很多分散且相对独立的组织机构,为了协同来自不同组织的业务过程,文中提出一种IOPN模型(面向交互的Petri网)用于描述跨组织的工作流协同,该模型包含组织内的过程模型和组织间的交互关系.为了确保IOPN模型能够被正确地执行,文中提出IOPN模型的弱合理性(relaxedsoundness)作为IOPN模型的正确性标准之一.IOPN模型是一种复合模型,其规模一般较大,采用基于状态空间的分析方法,容易产生状态空间爆炸问题,为此文中提出基于不变量的分解方法,能够将一个弱合理的无回路IOPN模型分解为一组顺序图,并提出相关定理:一个无回路IOPN模型是弱合理的当且仅当其可以被分解为一组合法的顺序图.关键词工作流;协同模型;合理性;不变量;分解1引言工作流技术可以用于管理企业的业务过程[1],现代企业计算的业务过程越来越复杂,有很多分散且相对独立的组织机构,因此需要提供一种跨组织过程建模的方法,用于协同来自不同组织的工作流.为了更加有效地管理来自不同组织的业务,每个组织需要分别定义各自的组织内的工作流,并向其它组织的工作流提供接口,以便不同组织之间的工作流能够协同工作.因此,需要一个松耦合的(looselycoupled)建模方法连接来自不同组织的工作流.该模型提供了一种自底向上的建模方法,各组织采用工作流网(WF-net)分别描述组织内的私有过程模型,并向外界提供交互接口,然后在协同模型中定义组织间的交互关系,由此构造完整的全局模型,即IOPN模型(Interaction-OrientedPetriNets(IOPN),面向交互的Petri网).为了确保IOPN模型能够被正确地执行,需要考虑模型的正确性,本文结合工作流网的合理性概念(soundness)以及IOPN模型的特点提出了IOPN模型的弱合理性(relaxedsoundness)作为IOPN模型的正确性标准之一.IOPN模型是一种复合模型,其规模一般较大,采用基于状态空间的分析方法,容易产生状态空间爆炸问题,为此本文提出基于不变量的分解方法,能够将满足弱合理性的无回路IOPN模型分解为一组顺序图,并进一步研究IOPN模型的弱合理性与其模型的可分解性之间的逻辑关系,提出相关定理:一个无回路IOPN模型是弱合理的当且仅当其可以被分解为一组合法的顺序图.该定理可以判定无回路(circuit-free)IOPN模型的弱合理性.本文第2节将介绍相关工作以及工作流过程建模的基本理论;第3节提出IOPN模型用以描述工作流协同;第4节介绍IOPN模型的弱合理性的形式定义,并以此作为IOPN模型的正确性标准之一;第5节介绍本文针对工作流网的特点提出的LMST-不变量;第6节基于LMST-不变量分析,提出将无回路IOPN模型分解为顺序图的方法,并给出无回路IOPN模型的弱合理性与其可分解性之间的逻辑关系;第7节提供一个用IOPN描述的应用实例,并给出其分解为相关顺序图的步骤;最后,第8节总结全文.2相关工作与基本理论将工作流过程建模理论与Petri网相结合,Aalst提出了工作流网模型(Workflownet,WF-net),并在该模型基础上提出了合理性(soundness)的形式定义作为工作流过程模型的正确性评价标准[2].Aalst进一步将WF-net发展为IOWF-net用以支持跨组织工作流过程建模[3-4],并将行为继承理论应用于IOWF-net[5],近年来也有许多工作对工作流协同模型的建模方法和协同模型的检验方法开展了深入的研究[6-7].Petri网是本文的理论基础,本文将简单介绍一些Petri网的基本理论.Petri网是一个三元组PN=(P,T,F).Token在库所集中的分布状况称为Petri网的状态(mark-ing),表示为M:P→{0,1,2,…}的标识函数.设M为PN的一个状态,p为一个库所,那么M(p)表示状态M在库所p中的Token的个数.变迁t在状态M是使能的(enabled),当且仅当p∈·t:M(p)1.状态M所有具备使能条件的变迁集合记为enabled(M).关于Petri网的基本概念,可以参考文献[8-9].工作流网(WF-net)是一种特殊的Petri网[2],一个Petri网PN=(P,T,F)是WF-net,需要同时满足两个条件:(1)PN有两个特殊的库所:i与o.库所i是起始库所:·i=,库所o是结束库所:o·=.[i]与[o]分别表示工作流网的起始状态与结束状态.(2)如果在PN中加入一个变迁t,且满足·t={o}与t·={i},那么扩展后的Petri网PN=(P,T∪{t},F∪{(o,t),(t,i)})是强联通的.图1所示为一个用工作流网建立的过程模型,变迁(transition)表示工作流过程模型的动作Page3(action),Token在库所集中的分布状况表示工作过程模型的执行状态,并依据Petri网的使能(enabled)条件判断在某个状态可以指定的变迁动作.Aalst基于工作流网提出该模型的合理性形式描述[2](见定义1),结合Petri网的活性和有界性提出定理1.足以下条件:图1一个基于WF-net描述的工作流过程模型定义1.工作流网的合理性(soundness)需满(1)对于任何从初始状态[i]可达的状态M,存在一个点火序列使得能够从状态M到达结束状态[o],形式描述为M([i]→M)(M→[o]).(2)当工作流的执行从初始状态[i]达到一个包含库所o的状态时,那么这个状态在除库所o以外的其它库所没有Token,形式描述为M([i]→M∧M[o])(M=[o]).(3)在(PN,[i])系统中,不存在死变迁,形式描定理1.一个工作流网PN如果满足合理性,述为t∈T:M,M,[i]→M→tM.当且仅当(PN,[i])是活的并且有界的[2].3IOPN模型:工作流协同模型3.1IOPN模型Internet是开放而动态的计算环境,需要提供一个松耦合(looselycoupled)的组合方法连接来自不同组织的工作流.本文提出一种称为面向交互的Petri网(Interaction-OrientedPetriNets,IOPN)用以描述来自不同组织之间的协同模型.IOPN模型采用不同工作流的变迁(工作流的活动)之间的交互来表示不同工作流过程之间的协同关系.下面,本文将给出IOPN模型的形式定义(见定义2).定义2.IOPN(Interaction-OrientedPetriNets).IOPN模型可以定义为IPN=(ONS,ρ):(1)ONS={ON1,ON2,…,ONn}是n个Petri网组成的集合,每个ONk描述来自不同组织的子过程.(2)ONk=(Pk,Tk,Fk)表示标号为k的对象网.ONk是一个WF-net.参与交互的ONk之间是对等的.(3)ρ∪n是过程交互(processinteraction)的集合.(a1,b1)∈ρ∧(a1∈Tk)∧(b1∈Tj)是交互集的一个元素.(a1,b1)∈ρ表示从ONk到ONj的一个过程交互消息,a1是该消息的发送动作,b1是其接收动作.这些参与交互的动作为工作流之间的交互提供了一组接口.过程交互可以采用消息传递(messagepassing)的机制实现.(4)本文对过程交互做一些限制,每个发送动作只有唯一的接收者,每个接收动作只有唯一的发送者.若存在(a1,b1)∈ρ,a1是这个交互关系的发送动作,那么b1是这个交互关系的唯一的接收动作,记为b1=ρout(a1);b1是这个交互关系的唯一的发送动作,记为b1=ρin(a1).定义3.过程交互中共享库所.设(a1,b1)∈ρ∧(a1∈Tk)∧(b1∈Tj),对于该过程交互关系,依据Petri网的语法,存在一个附加的共享库所p(a1,b1)(如图2所示),添加两个弧线(a,p(a1,b1))和(p(a1,b1),b),使得库所p(a1,b1)能够连接从a1到b1的两个变迁,IOPN模型中所有共享库所的集合记为Pshared={p(a1,b1)|(a1,b1)∈ρ∧(a1∈Tk)∧(b1∈Tj)∧(k≠j).图2IOPN模型:过程交互之两个变迁之间的共享库所如图3所示,该IOPN模型中包含3个对象网(objectnets),其交互集为ρ={(a1,b1),(b2,c1),(c2,b3),(b4,a2),(a3,b5),(a4,c3),(b6,a5),(c4,a6)}.Page43.2IOPN点火规则定义4.IOPN模型的点火规则与状态表示.设IPN=(ONS,ρ),ONS={ON1,ON2,…,ONn},ONk=(Pk,Tk,Fk),ONk是IPN中的子过程,ONk.M表示ONk的局部状态,那么IPN的全局状态可以表示为IPN.M=ON1.M+…+ONk.M+…+ONn.M+Mρ,Mρ表示过程交互中共享库所Pshared={p(a1,b1)|(a1,b1)∈ρ}的标记(marking).ONk.i与ONk.o分别表示在ONk网中局部的初始状态和结束状态.IPN的初始状态表示为IPN.final=ON1.i+…+ONk.i+…+ONn.i,结束状态表示为IPN.final=ON1.o+…+ONk.o+…+ONn.o.对于变迁a1∈Tk,若a1∈enabled(ONk.M+Mρ),那么a1∈enabled(IOPN.M).当a1发生点火时,存在3种可能情况:(1)如果不存在(a1,b1)∈ρ且(b1,a1)∈ρ,即a1与其它变迁没有交互,那么IPN.Ma→1IPN.M,即ONk.Ma→1ONk.M,IPN.M=ON1.M+…+ONk.M+…+ONn.M+Mρ.(2)如果存在一个交互(a1,b1)∈ρ,那么IPN.Ma→1IPN.M,即ONk.M+Mρp(a1,b1)且IPN.M=ON1.M+…+ONk.M+…+ONn.M+Mρ+p(a1,b1).(3)如果存在一个交互(b1,a1)∈ρ,那么IPN.Ma→1IPN.M,即ONk.M+Mρp(b1,a1),且IPN.M=ON1.M+…+ONk.M+…+ONn.M+Mρ-p(b1,a1).定义5.投影子序列(ProjectionSub-Sequence,PSS).对于IPN=(ONS,ρ),ONS={ON1,ON2,…,ONn},ONk=(Pk,Tk,Fk),假设σ=t1t2…ti…tn是从状态IPN.M1到IPN.M2的一个执行序列,那么IPN.M1→σIPN.M2,IPN.M1=ON1.M1+…+ONk.M1+…+ONn.M1+M1ρ,IPN.M2=ON1.M2+…+ONk.M2+…+ONn.M2+M2ρ.则存在从σ=t1t2…ti…tn派生出来的一个子序列(sub-sequence)α=x1x2…xi…xn,称为基于ONk的投影子序列(projec-tionsub-sequence),其遵循如下投影规则:子序列α被称为σ在ONk上的投影子序列,并记为σ|ONk.很明显,ONk.M1→αONk.M2.例如:如果σ=a1a2b3b4a5b6,(a1,a2,a5∈Tk)∧(b3,b4,b6Tk),那么α=σ|ONk=a1a2a5.4IOPN模型的弱合理性Aalst提出的合理性[2](见定义1)是工作流过程模型的正确性标准之一.IOPN模型能够协同来自不同组织的工作流,然而如果单个工作流过程模型存在错误或者交互集的定义存在错误,都有可能导致复合后的工作流协同模型不能被正确而完整地执行.为了确保工作流能够被正确而完整地执行,需要考虑IOPN模型的合理性和弱合理性(relaxedsoundness).本文将参照工作流网中关于合理性的概念给出IOPN模型弱合理性的形式定义(见定义8),基于该定义,本文将研究相关的检验算法.工作流网的合理性判定是工作流网正确性检验的一个重要方面,一般来讲基于Petri网的可达图的算法,可以生成工作流网的可达图,通过遍历可达图的状态空间可以判定合理性.但是基于可达图的状态空间方法经常会遇到状态空间爆炸(statespaceexplosion)[11]的问题.为此本文结合不变量与工作流网合理性的关系,提出基于不变量的分析方法.根据工作流网的特点以及Petri网的T-不变量的特殊含义,本文总结并提出了LMST-不变量的概念(见定义10),工作流网中的一个LMST-不变量对应着一个从初始状态到结束状态的执行分支,且一个工作流网如果是合理的(sound),那么该工作流网的活动(变迁)集合被LMST-不变量覆盖(见定理3),即该工作流网可以分解为多个T-构件的子网(见定义12).从某种意义上讲,合理性对于跨组织过程模型略显严格,因为不同组织的过程在选择了不匹配的执行分支后容易进入死锁状态,因此严格合理性妨碍了IOPN建模的灵活性.为了提高IOPN模型的灵活性,本文借用WF-net弱合理性[10]的概念(见定义7),在这里需要考虑的问题是如何判定IOPN的弱合理性.弱合理性的含义是“工作流网中的每个变迁都有机会被执行”.定义6.合理的点火序列(SoundFiringSequence)[10].令(PN,[i])是一个WF-net,对于一个点火序列σ且[i]→σM,如果存在另一点火序列σ使得Mσ→[o],那么称σ是合理的点火序列.定义7.弱合理性.令(PN,[i])是一个WF-net,(PN,[i])满足弱合理性,当且仅当任意一个变迁是某个合理的点火序列中的一个元素,形式化表示为t∈T,M,M:[i]→M→tM→[o].Page5从定义7可以看出,弱合理性相对于合理性,条件弱化了.弱合理性的条件,意味着在工作流网中存在足够多的合理的点火序列,且该合理的点火序列中所包含的变迁的集合能够覆盖该工作流网的变迁集,即任意一个变迁都有可能至少出现在某一个合理的点火序列中.严格的合理性不允许有死锁状态(deadstate),对比严格的合理性,弱合理性允许有死锁状态.文献[10]给出了一种鲁棒算法(robust-nessalgorithm),可以移除弱合理的工作流网(relaxedsoundworkflownet)中的死锁状态.如图4所示的工作流网是弱合理的,而非严格合理的.该过程模型包含两个可能的合理的点火序列t1t2t3t4t6t8和t1t2t3t5t7t9,其覆盖了所有变迁.然而它存在两个从初始状态[i]可达的死锁状态[p6+p9]和[p7+p8].图4一个WF-net实例(是弱合理的,但不是合理的)一个WF-net是严格合理的,那么它一定也是弱合理的(relaxedsound),但是反之则不一定成立.因为IOPN结构与WF-net略有不同,因此IOPN的合理性与弱合理性(relaxedsoundness)的形式定义与基本工作流网的定义略有区别.为此,本文基于工作流网的弱合理性概念,给出IOPN模型的弱合理性的形式定义作为协同模型的正确性标准之一.定义8.IOPN模型的弱合理性(RelaxedSoundnessofIOPN).对于IPN=(ONS,ρ),ONS={ON1,ON2,…,ONn},ONk=(Pk,Tk,Fk),IPN是弱合理的(relaxedsound),当且仅当,T=∪n对于任意的t∈T,存在IPN.M,IPN.M使得IPN.init→IPN.M→tIOPN.M→IOPN.final.如图5所示是一个不满足弱合理性的IOPN模图5一个IOPN实例:既不满足合理性也不满足弱合理性型,因为当ON1中a1点火之后,在ON2中b3将没有机会点火;或者当ON1中a2点火之后,在ON2中b2将没有机会点火.关于IOPN模型的弱合理性检验,在一般情况下,基于Petri网的可达图的状态空间分析方法是一种可行的分析方法,但是当IOPN模型的规模变得越来越大时,IOPN所描述的协同交互系统的状态空间会越来越大,以至于爆炸到无法处理的程度.另一方面,基于Petri网的不变量分析的分解方法可以作为一种互补的有效的分析技术,以避免状态空间爆炸问题,这也是不变量分析方法的主要优点.利用Petri网的不变量与活性和有界性之间的联系,可以通过计算Petri网的不变量来得知WF-net的活性和有界性,以至合理性.基于不变量分析,本文提出了一种将无回路(circuit-free)IOPN分解成顺序图的方法,并给出了无回路IOPN的弱合理性与可分解性之间的等价关系.一般来讲,一个IOPN模型满足弱合理性,要求IOPN模型内的各个ONk满足合理性,但是反过来结论不一定成立,即使IOPN模型内的各个ONk满足合理性,但是由于交互集设计不正确,也会造成IOPN模型不满足弱合理性.5Petri网的不变量及LMST-不变量Petri网可以表示成关联矩阵的形式,依据Petri网的执行语义与状态方程,Petri网有两种不变量:P-不变量与T-不变量[9].这两个不变量与Petri网的有界性(boundedness)和活性(liveness)有着密切的关系,而工作流网是一种特殊结构的Petri网,借助工作流网的不变量计算可以分析工作流网的合理性.本文的分解技术主要涉及T-不变量,因此,本文将介绍T-不变量以及工作流网的T-不变量的特殊概念.定义9.关联矩阵,T-不变量.(1)一个Petri网PN=(P,T,F)可以表示为一个关联矩阵犃.(2)T-不变量是方程组犃·犢=0的整数解,解的集合表示为J={J1,J2,…,Jn}.本质上,T-不变量犑k是一个变迁向量(T-vector),映射关系表示为犑k:T→Ζ.一个T-不变量犑k是半正的(semi-positive)当且仅当犑k0∧犑k≠0.一个T-不变量犑k是正的(positive)当且仅当t∈T:犑k(t)>0.‖犑k‖表示在犑k中取值大于0的变迁的集合,即‖犑k‖={t∈T|犑k(t)>0}.一个Petri网被T-不变量覆盖,当且仅当存在一个正T-不变量犑k(t)>0.Page6(3)最小不变量.对于一个半正T-不变量犑k,若不存在其它半正T-不变量犑x包含于犑k(即犑x犑k),则称犑k是最小的.任何半正不变量都是最小不变量的线性组合[9].若一个Petri网存在一个正不变量,则任意不变量都是最小不变量的线性组合.(4)T-不变量的基本性质.令(PN,M0)是一个网系统,犑k是PN的一个T-不变量,σ是与犑k相关的Parikh向量[9],那么M→σM,即在状态M,经过犑k中一组变迁的点火之后可以重新回到状态M.即T-不变量对应着一个循环执行.与一般Petri网相比,工作流网具有一些特殊的结构限制,因此工作流网的不变量具有一些特点和特殊含义.基于工作流网的结构特点,本文提出了LMST-不变量.定义10[12].工作流网的T-不变量.令PN=(P,T,F)是一个工作流网,t是连接库所o与i的附加变迁,PN=(P,T∪{t},F∪{(o,t),(t,i)})是其扩展模型.对于一个T-不变量犑k,如果犑k(t)=1∧犑k0,那么称犑k是合法的最小半正T-不变量(LMST-不变量,LegalMinimalSemi-positiveT-invariant).设犑k是LMST-不变量,那么对应着一个合理的执行序列σ=u1u2…unt∧(ux∈T),其中[i]u→1M1π(σ)是一个记录每个变迁在序列σ出现次数的向量,那么有π(σ)=犑k,π(σ,t)=犑k(t)表示变迁t在序列σ中出现的次数.图1中的LMST-不变量有[1,1,0,1,1,0,1,1,1]与[1,0,1,1,0,1,1,1,1].容易得出,一个从[i]到[o]的合理的点火序列对应着一个LMST-不变量.本文将侧重于基于LMST-不变量的分析.定义11.子网(subnet).设存在两个Petri网,PN=(P,T,F)与PN=(P,T,F),如果满足条件PP,TT,且F=F∩((P×T)∪(T×P)),那么称PN是PN的子网(subnet).定义12.T-构件(T-component).设存在两个Petri网,PN=(P,T,F)与PN=(P,T,F),PN是PN的T-构件(T-component),当且仅当满足条件:(1)PN=(P,T,F)是Petri网PN=(P,T,F)的子网(subnet),且t∈T:·t∪t·P.(2)PN=(P,T,F)是一个标识图(markedgraph).定义13.T-覆盖(T-coverable).一个Petri网PN=(P,T,F)被称为T-覆盖(T-coverable),当且仅当对于任意变迁t∈T,存在一个T-构件PN=(P,T,F)使得t∈T.定理2.一个Petri网系统是活的且有界的,那么该Petri网存在一个正T-不变量[9].定理3.设PN=(P,T,F)是一个工作流网,如果PN满足合理性,那么在其扩展网PN=(P,T∪{t},F∪{(o,t),(t,i)})中存在一个正T-不变量,PN被T-不变量覆盖.证明.根据命题1,如果PN=(P,T,F)满足合理性,那么(PN,[i])是活的(live)且有界的(bounded).所以在PN=(P,T∪{t},F∪{(o,t),(t,i)}),以M0=[i]为初始状态使得(PN,M0)是活的且有界的.那么根据定理2可知,PN中存在一个正T-不变量.根据Petri网及工作流网的T-不变量的基本概念(见定义9)可知,PN被T-不变量覆盖.定义14.基于LMST-不变量的分解[12].设PN=(P,T,F)是一个工作流网,如果PN满足合理性,PN的扩展网为PN=(P,T∪{t},F∪{(o,t),(t,i)}),设犑k是PN的一个LMST-不变量,那么由犑k分解得到的子网记为PN|犑k=(P犑k,T犑k,F犑k),且满足以下条件:(1)T犑k=‖犑k‖\{t}.(2)P犑k={p∈·T犑k|p∈P}∪{p∈T犑k(3)F犑k={(p,t)|p∈P犑k∧t∈T犑k∧(p,t)∈F}∪{(t,p)|p∈P犑k∧t∈T犑k∧(t,p)∈F}.根据上述结论,一个工作流网,如果满足合理性,可以根据PN的LMST-不变量进行分解.图1中的工作流网通过基于LMST-不变量的分解,得到图6中的两个子网(T-构件),从每个LMST-不变量分解出的一个子网对应一个从[i]到[o]的执行分支.图6图1中工作流网的LMST-不变量分解的结果6不变量分析:IOPN分解为顺序图IOPN模型能够协同来自不同组织的工作流,Page7为了确保IOPN模型能够被正确而完整地执行,需要考虑合理性和弱合理性作为协同模型的正确性标准之一.合理性分析可以采用状态空间方法,然而当参与协同的工作流个数增多时,其全局模型的状态空间将呈指数增长,会出现状态空间爆炸问题而使得该方法不能有效应用,为此本文提出一种避免状态空间爆炸问题的方法,即不变量分析方法.基于不变量分析可以将无回路(circuit-free)IOPN模型分解为一组顺序图(见算法1),并且本文还给出了相关定理:一个无回路IOPN模型是弱合理的当且仅当其可以被分解为一组合法的顺序图(见定理5).顺序图通常用于描述多个对象之间的交互协议,本文给出顺序图的形式定义如下.定义15.顺序图(SequenceDiagram).一个顺序图可以表示为一个五元组D=(O,E,Mes,L,W),其中(1)O:一个有限的对象集合.(2)E:一个有限的事件集合.(3)Mes:一个有限的消息集合.对于任意消息g∈Mes,g!和g?分别表示发送和接收消息g,对于任意事件e∈E,与之相关的发送或者接收消息为g,那么表示为φ(e)=g!或者φ(e)=g?.(4)L:EO是一个标签函数,建立任意事件e∈E到对象L(e)∈O的映射.(5)WE×E是事件集合上的一个偏序关系.每个(e,e)∈W均满足e≠e,(e,e)代表了消息序列.6.1算法:将IOPN分解为顺序图对于LMST-不变量犑1,犑1.out表示在不变量犑1中向其它子过程发送消息的变迁集合,犑1.out|ONk表示在不变量犑1中向子过程ONk发送消息的变迁集合.犑1.in表示在不变量犑1中从其它子过程接收消息的变迁集合,犑1.in|ONk表示在不变量犑1中从子过程ONk接收消息的变迁集合.定义16.两个LMST-不变量之间的合法交互(LegalInteractionbetweentwoLMST-invariants).对于两个LMST-不变量犑a和犑b,称它们之间的交互是合法的,当且仅当犑a∈ONk.犑∧犑b∈ONj.犑∧k≠j,ρ(犑a.out|ONj)=犑a.in|ONk≠且ρ(犑a.in|ONj)=犑b.out|ONk≠.如果犑a和犑b是合法交互,则记为(犑a,犑b)=1,否则记为(犑a,犑b)=0.函数ρ(X)定义为ρ(X)={y|x∈X:(x,y)∈ρor(y,x)∈ρ}.例如在图3中,IPN的LMST-不变量为ON1.犑={犑1,犑2},ON2.J={犑3,犑4},ON3.犑={犑5,犑6},犑1=[1,1,0,0,0,0]={a1,a2},犑2=[0,0,1,1,1,1]={a3,a4,a5,a6},犑3=[1,1,1,1,0,0]={b1,b2,b3,b4},犑4=[0,0,0,0,1,1]={b5,b6},犑5=[1,1,0,0]={c1,c2},犑6=[0,0,1,1]={c3,c4}.ρ(犑1.out|ON2)=犑3.in|ON1={b1},ρ(犑1.in|ON2)=犑3.out|ON1={b4},所以(犑1,犑3)=1.通过计算LMST-不变量之间的合法交互,可以得到矩阵(图7表示图3的合法交互矩阵)用以表示LMST-不变量之间的合法交互关系.图7从图3得到的LMST-不变量的合法交互关系矩阵根据LMST-不变量之间的合法交互矩阵,可以设计从IPN到顺序图的分解算法.|ONk.犑|表示ONk中LMST-不变量的个数,犑a|ρ=犑a.in∪犑a.out表示LMST-不变量犑a在交互集ρ投影的变迁集,在每一个顺序图Di=(Oi,Ei,Mesi,Li,Wi)中,Oi和Ei是核心成分,因此算法1主要关注构造每个Di的Oi和Ei.本文给出从无回路IOPN到顺序图的分解算法.通常,在一个顺序图中,参与交互的每个ONk只有一个分支,单独来看,每个构件的一组事件动作构成了其局部的分支行为.而在IOPN中,单独来看,每个ONk有若干个执行分支,而每个执行分支对应于ONk的一个LMST-不变量.因此在构造分解算法时,只要抽取IOPN中各个ONk的LMST-不变量并组合在一起,形成一个闭包(封闭)的交互模型,就可以构造一个顺序图.这样得到的顺序图会有多个,对应着的IOPN中多个可能的执行分支.因此构造分解算法的关键就是将IOPN中各个ONk的LMST-不变量,依据合法交互关系(见定义16)组合在一起.算法1.从IOPN到顺序图的分解算法.设IPN是一个无回路IOPN模型,maxnum=max(k∈{1,…,n}.|ONk.犑|),选择LMST-不变量个数最多的一个构件,即假设|ONp.犑|=maxnum;输入:ONk.犑为ONk中LMST-不变量的集合,ρ为交输出:一组顺序图,DS={D1,…,Di,…,Dmaxnum},1.FORi=1TOmaxnumDO2.犑x··=ONp.犑i;3.Ci··={ONp};Page84.Ei··=犑x|ρ;//Ei的初值设为ONp.犑i|ρ5.TISi··={犑x};6.FORj=1TOnDO//n为IPN中ONS的个数7.IFj≠pTHEN8.FORm=1TO|PNj.犑|DO9.犑b··=ONj.犑m;10.Bool··=TRUE;11.FOR(EACH犑aINTISi)DO12.Bool··=Bool∧(犑a,犑b);13.ENDFOR14.IFBoolTHEN15.Ci··=Ci∪{ONk};16.Ei··=Ei∪犑b|ρ;17.TISi··=TISi∪{犑b};18.BREAK;19.ENDIF20.ENDFOR21.ENDIF22.ENDFOR23.ENDFOR简要说明:算法1第6行中TISi表示LMST-不变量集合,其中任意两个LMST-不变量之间满足合法交互关系.第13行中布尔量Bool表示犑a是否与TISi中的LMST-不变量都有合法交互关系(见定义16).该算法的时间复杂度为O(|ONS|2·Max2(|ONk.犑|)).针对算法1,本文提出了定理5.6.2IOPN模型的可分解性与弱合理性的逻辑关系定理4.设存在一个IOPN模型IPN=(ONS,ρ),ONS={ON1,ON2,…,ONn},k∈{1,…,n}.ONk=(Pk,Tk,Fk)是无回路(circuit-free)Petri网,如果该IPN是弱合理的(relaxedsound),那么其中任意一个ONk在局部也满足弱合理性.证明.对于对象网ONk=(Pk,Tk,Fk),t∈Tk:IPN.M,IPN.M,IPN.initσ→1IPN.M→tIPN.Mσ→2IPN.final,IPN.M=ON1.M+…+ONk.M+…+ONn.M+Mρ,IPN.M=ON1.M+…+ONk.M+…+ONn.M+Mρ且t∈enabled(IPN.M).对应于全局序列σ1,ONk存在一个投影子序列(见定义5)α1=σ1|ONk使得ONk.iα→1ONk.M,且在ONk局部,满足t∈enabled(ONk.M),即ONk.M→tONk.M.对应于全局序列σ2,ONk存在一个投影子序列α2=σ2|ONk使得ONk.Mα→2ONk.o.所以ONk在局部满足弱合理性.定理5.设存在一个IOPN模型,IPN=(ONS,ρ),ONS={ON1,ON2,…,ONn},k∈{1,…,n}.ONk=(Pk,Tk,Fk)是无回路(circuit-free)Petri网.IPN是弱合理的(relaxedsound)IPN能够分解为一组顺序图DS={D1,D2,…,Dn}且每个顺序图满足偏序约束.证明.详见附录.依据定理5可以判定无回路(circuit-free)IOPN模型的弱合理性.图8依据算法1将图3中的IOPN模型分解为两个顺序图图8为依据算法1将图3所示的IOPN模型分解为两个顺序图.然而图5中的IOPN不满足弱合理性,因此不能分级为顺序图.在图5中,可以计算出ON1.犑={犑1,犑2},ON2.犑={犑3},犑1=[1,0,1,0,1,0]={a1,a3,a5},犑2=[0,1,0,1,0,1]={a2,a4,a6},犑3=[1,1,1,1]={b1,b2,b3,b4}.ρ(犑1.out|ON2)={b1},ρ(犑2.out|ON2)={b2},犑3.in|ON2={b1,b2},ρ(犑1.out|ON2)≠犑3.in|ON1,ρ(犑2.out|ON2)≠犑3.in|ON1,所以(犑1,犑3)=0,(犑2,犑3)=0,因此不能分解出合法的顺序图.7实例分析本文将介绍IOPN模型的实际应用,图9和表1使用IOPN模型描述了一个B2B过程模型,该过程模型中包含5个自治的工作流实体,其中EMarket表示交易平台的中介机构,B1表示买方,B2表示卖方,Account表示结算中介,Delivery表示快递中介.B1通过EMarket交易平台发现B2商品并发送订单请求,EMarket将该订单传递信息给B2做确认.在收到B2的确认之后,EMarket通知B1为该订单做支付,B1收到EMarket的支付通知之后,通过Account中介做支付,Account中介在收到B1的支付之后通知EMarket,B1已经对某订单做了支付,在EMarket收到B1已经做了支付的信息之后,EMarket通知B2向B1发送货物,然后B2通过Delivery中介向B1发送货物.当B1收到该订单的货物之后,分为两种情况:(1)B1对收到的货物满意,然后B1将通知EMarket该订单成功,EMarket转告Account中介订单成功,Account中介将货款转给B2,至此订单结束;(2)B1对收到的货物不满Page9意,要求退货,B1通知EMarket订单失败,然后B1通过Delivery中介将货物回寄给B2,当B2收到B1寄回的货物之后,B2通知EMarket已经收到寄回的图9一个用IOPN模型描述的B2B的跨组织业务过程t1_1=OrderingMesg._1!t2_12=Account_3!t1_2=Infor.toAccount?t3_1=OrderingMesg._2?t1_3=Account_1!t1_4=Account_OK?t1_5=Delivering_2?t1_6=BadDeal!t1_7=Back_Delivering_1!t3_6=GoodDeal_2!t1_8=Back_Account_2?t3_7=BackDelivering_2?t1_9=GoodDeal_1!t2_1=OrderingMesg._1?t4_1=Account_1?t2_2=OrderingMesg._2!t4_2=Account_2!t2_3=Ordering_OK?t2_4=Infor.ToAccount!t4_4=Account_4!t2_5=Account_2?t2_6=Account_OK!t2_7=Infor.ToDeliver!t5_1=Delivering_1?t2_8=BadDeal?t2_9=Infor.BackAccount?t5_3=GoodDeal_2?t2_10=BackAccount_1!t5_4=BackDelivering_1?t2_11=GoodDeal_1?假设在该B2B过程中参与者没有恶意交易行为,在该实例中,可以看出IOPN模型能够描述来自不同组织的工作流的协同模型,其交互集为ρ=货物,然后EMarket转告Account中介该订单撤回,Account中介将货款退回给B1,至此订单结束.图9所描述场景的过程交互的消息标签如表1所示.(t1_1,t2_1),(t2_2,t3_1),(t3_2,t2_3),(t2_4,t1_2),(t1_3,t4_1),(t4_2,t2_5),(t2_6,t1_4),(t2_7,t3_3),(t3_4,t5_1),(t5_2,t1_5),(t1_9,t2_11),(t2_12,t4_3),(t4_4,t3_5),(t3_6,t5_3),(t1_6,t2_8),(t1_7,t5_3),(t5_4,t3_7),(t3_8,t2_9),(t2_10,t4_5),(t4_6,t1_8).图9中IOPN模型的各个ONk的LMST-不变量计算为ON1.犑={犑1,犑2},ON2.犑={犑3,犑4},ON3.犑={犑5,犑6},ON4.犑={犑7,犑8},ON5.犑={犑9,犑10}.犑1=[1,1,1,1,1,0,0,0,1]={t1_1,t1_2,t1_3,t1_4,t1_5,t1_9},犑2=[1,1,1,1,1,1,1,1,0]={t1_1,t1_2,t1_3,t1_4,t1_5,t1_6,t1_7,t1_8},犑3=[1,1,1,1,1,1,1,0,0,0,1,1]={t2_1,t2_2,t2_3,t2_4,t2_5,t2_6,t2_7,t2_11,t2_12},犑4=[1,1,1,1,1,1,1,1,1,1,0,0]={t2_1,t2_2,t2_3,t2_4,t2_5,t2_6,t2_7,t2_8,t2_9,t2_10},犑5=[1,1,1,1,1,1,0,0]={t3_1,t3_2,t3_3,t3_4,t3_5,t3_6},犑6=[1,1,1,1,0,0,1,1]Page10={t3_1,t3_2,t3_3,t3_4,t3_7,t3_8},犑7=[1,1,1,1,0,0]={t4_1,t4_2,t4_3,t4_4},犑8=[1,1,0,0,1,1]={t4_1,t4_2,t4_5,t4_6},犑9=[1,1,1,0,0]={t5_1,t5_2,t5_3},犑10=[1,1,0,1,1]={t5_1,t5_2,t5_4,t5_5}.阵为图10所示.根据上述计算,可以得到图9中的合法交互矩犑1犑2犑3犑4犑5犑6犑7犑8犑9犑10犑10010101010犑20001010101犑31000101010犑40100010101犑51010001010犑60101000101犑71010100010犑80101010001犑91010101000犑100101010100图10图9中IOPN模型的LMST-不变量的合法交互矩阵依据图10的合法交互矩阵得到两个顺序图的拓扑结构(如图11所示).加上图9和表1中的消息标签,可以构造出两个顺序图D1(如图12所示)和D2(如图13所示).由此可见图9的IOPN模型能够依据算法1成功分解为两个正确的顺序图,根据定理5可知该IOPN模型满足弱合理性.其构造步骤如下:D1=(O1,犈1,Mes1,L1,W1),O1={ON1,ON2,ON3,ON4,ON5}犈1=犑1∪犑3∪犑5∪犑7∪犑9={B1,EMarket,B2,Account,Delivery},={t1_1,t1_2,t1_3,t1_4,t1_5,t1_9,t2_1,t2_2,t2_3,t2_4,图12从图9分解得到的一个顺序图D1t2_5,t2_6,t2_7,t2_11,t2_12,t3_1,t3_2,t3_3,t3_4,t3_5,t3_6,t4_1,t4_2,t4_3,t4_4,t5_1,t5_2,t5_3},Mes1={OrderingMesg._1,OrderingMesg._2,D2=(O2,犈2,Mes2,L2,W2),O2={ON1,ON2,ON3,ON4,ON5}犈2=犑2∪犑4∪犑6∪犑8∪犑10={B1,EMarket,B2,Account,Delivery},={t1_1,t1_2,t1_3,t1_4,t1_5,t1_6,t1_7,t1_8,t2_1,t2_2,t2_3,t2_4,t2_5,t2_6,t2_7,t2_8,t2_9,t2_10,t3_1,t3_2,t3_3,t3_4,t3_7,t3_8,t4_1,t4_2,t4_5,t4_6,t5_1,t5_2,t5_4,t5_5},Mes2={OrderingMesg._1,OrderingMesg._2,图11依据图10的矩阵得到两个顺序图的拓扑结构Page11图13从图9分解得到的另一个顺序图D28总结为了协同来自不同组织的业务过程,本文提出IOPN模型用于描述跨组织的工作流协同.为了确保IOPN模型能够被正确地执行,本文提出了IOPN模型的弱合理性作为IOPN模型的正确性标准之一.IOPN模型是一种复合模型,包含组织内的过程模型和组织间的交互关系,其规模一般较大,采用基于状态空间的分析方法,容易产生状态空间爆炸问题,为此本文提出基于不变量的分解方法,能够将一个弱合理的无回路IOPN模型分解为一组顺序图,并提出相关定理:一个无回路IOPN模型是弱合理的当且仅当其可以被分解为一组合法的顺序图.该定理可以判定无回路IOPN模型的弱合理性.
