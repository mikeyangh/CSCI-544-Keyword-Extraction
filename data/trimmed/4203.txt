Page1SAMS:一种新型身份/位置分离方案杨芫1),5)徐明伟1),5)杨家海2),5)董庆洲3)陈文龙4)王会2),5)张志超1),5)1)(清华大学计算机科学与技术系北京100084)2)(清华大学网络科学与网络空间研究院北京100084)3)(北京邮电大学网络与交换国家重点实验室北京100876)5)(清华信息科学与技术国家实验室(筹)北京100084)4)(首都师范大学信息工程学院北京100037)摘要当前互联网中的IP地址同时标识主机身份和主机位置,这种语义重载主要导致了两方面的问题.一方面,它使得核心网络路由表项数量急剧增长,引起路由可扩展性问题.另一方面,主机难以在不改变身份标识的情况下实现多宿主和移动中的高速切换.解决这两个问题的根本办法是主机的身份和位置分离,即分别使用相互独立的身份标识和位置标识.目前身份/位置分离方案得到了研究人员的广泛关注,然而现有的方案只是针对某一个问题,不能同时解决这两个问题.此外身份位置分离之后的真实身份问题也很重要.文中提出了一种新型身份/位置分离方案SAMS(ScalableAuthenticMobileidentifier-locatorSeparationscheme),它将用户身份标识、主机身份标识、边缘网络位置标识和核心网络位置标识分离,并设计合理的体系结构将这4种标识结合在一起,对路由可扩展性,主机多宿主和移动能力都有很大的提高,并支持真实身份.文中实现了SAMS的原型系统,并在CERNET2主干网上进行了规模部署和实验,验证了方案的有效性和系统的兼容性.关键词身份/位置分离;路由可扩展;身份认证;主机移动;多宿主1引言在当前的互联网中,IP地址同时起着标识主机身份和标识主机位置的作用[1].这种IP地址语义的重载主要带来了两方面的影响.一方面,它严重影响了互联网路由的可扩展性[2],尤其是当大量用户自治系统(customer’sAS)以多宿主(multi-homing)的方式连接到多个提供者自治系统(provider’sAS)并向外公告前缀时,相同的地址前缀将出现在多条域间路由中,造成核心网络路由表急剧膨胀[3-4].另一方面,它限制了终端主机的移动能力,通常情况下主机位置的改变伴随着IP地址的改变,这必将导致传输连接的中断,虽然提出了移动IP等技术[5-6],但其带来的隧道开销问题和三角路由问题仍未得到很好的解决.解决这两个问题最根本的思路是将IP地址的这两种语义分离[1],即设计和使用相互独立的身份标识和位置标识.这一解决思路受到了广泛关注,已经有很多方案被提出[7-8],不妨将它们统称为身份/位置分离方案.然而已有的方案只能解决一部分问题,例如LISP方案[9]是重点针对路由可扩展性问题设计的,主机移动能力较差;Shim6[10]方案仅仅解决主机多宿主切换的问题;HIP方案[11]能提供对主机多宿主和移动中切换的支持,但难以在短期内提升核心网路由可扩展性.此外还有一些其它方案,但都存在较大的不足.为了更加适应新一代互联网的发展和需求,亟需提出一种更好的方案.本文提出了一种新型身份/位置分离方案SAMS(ScalableAuthenticMobileidentifier-locatorSeparationscheme).SAMS将用户身份标识、主机身份标识、边缘网络位置标识和核心网络位置标识相分离,设计合理的网络体系结构来管理不同标识间的映射并进行正确的路由转发,最终将多种标识有机地结合到一起,提供对多方面的同时支持:提高核心网络路由可扩展能力,多宿主和移动中高速透明切换,真实身份认证和会话保证.该方案还具有很好的兼容性和可逐步部署能力,这也是现有方案难以做到的.本文在真实网络设备上实现了SAMS的原型系统,并在CERNET2[12]主干网上进行了规模部署和实验,结果表明该原型系统在上述几个方面都具有较好的性能.2问题分析互联网采用的TCP/IP体系结构存在跨层操作的现象,这是由互联网最初的设计目标和一定的历史原因造成的.跨层操作虽然在一定程度上简化了协议栈的实现,但随着互联网的发展却带来了一些问题,其中IP地址语义的重载对当今互联网带来了很大的影响.所谓IP地址语义重载[1],指的是IP地址既用来标识主机或网络所处的位置,又用来标识该主机或网络的身份,即IP地址同时拥有位置标识和身份标识的语义.IP地址的语义重载造成的主要问题包括路由可扩展性、多宿主与移动性两方面.路由可扩展性问题指的是由于网络中路由表项数量随着互联网规模的扩大而急剧增长,从而带来巨大的存储开销、路由信息通信开销和路由计算开销,大量的路由信息甚至严重影响了互联网路由的收敛性.造成这一问题的主要原因是用户AS为了提高网络连通度或实现流量工程,向多个提供者AS通告相同的前缀,而其中一些前缀只是某些提供者AS提供的前缀的子前缀,这就导致了位置标识空间的聚合性下降.在这种情况下,远程AS将计算出多条到达该用户AS的路由,这种路由随着网络连通度的提高以乘法的速度增长.为了提高位置标识空间的聚合性,应该设法将边缘网络位置标识与核心网络位置标识空间分离,使边缘网络保持较完整的前缀.这种前缀可以作为该边缘网络的身份标识,再通过设计合理的映射机制将它们与核心网络Page3的位置标识对应起来,将本来较复杂的边缘网络的路由问题转化成相对简单的核心网络的路由问题.多宿主和移动性已成为当今互联网端系统发展的新方向.一台多宿主的主机可以同时接入到不同提供者的网络,作为客户端的多宿主主机可以随时根据应用的需求和网络的具体情况选择能提供较好服务质量的网络,而作为服务器的多宿主主机可以直接为它所接入的网络的用户提供访问服务.而端系统移动性则要求网络能够提供随时随地的接入,在主机移动的过程中,正在进行的通信不会中断,服务质量不会剧烈变化.然而端系统多宿主与移动性的发展受到了IP语义重载的制约,因为IP地址既作为网络层路由寻址的依据,又与端口号组成二元组作为传输层的访问点来标识主机上运行的进程.一方面,如果要保证多宿主主机切换接入网络或移动主机跨域移动时通信不被中断,IP地址就不能改变,但这样就无法通过路由及时找到该主机正确的位置;另一方面,如果要保证路由的正确性,传输层就会由于IP地址的改变而无法将分组提交到正确的进程,最终导致为了继续通信只能重新建立连接.虽然移动IP已经为解决这一问题提供了思路,但最根本的方法还是将IP地址的语义分离,即单独设计身份标识来取代IP地址标识身份的职能.该身份标识被传输层所使用,不包含位置信息,且应该具有全球唯一的特性.互联网的安全在很大程度上需要依赖认证技术,其中主机和用户的身份认证是保证可信通信的重要手段.IP地址同时标识着主机的位置和身份,因此难以作为身份认证的依据,给攻击者利用IP地址的这一弱点进行攻击提供了机会,例如伪造源IP地址进行大规模拒绝服务(DoS)攻击等.虽然可以利用MAC地址等信息来进行主机身份认证,但MAC地址并不包含用户身份的语义,且也有可能被伪造.设计安全性更强的身份标识,并将其与位置标识即IP地址分离有利于提高互联网安全性、可控性和可信性,便于网络安全管理.3相关研究截止到目前,学术界已经提出了很多身份/位置分离方案.其中LISP已经在思科路由器上实现并成为IETF标准,HIP和Shim6也已经成为IETF标准.LISP用于实现边缘网络地址空间与核心网络地址空间的分离,从而解决核心网络路由可扩展问题.具体来说,LISP把IPv4地址空间划分为端节点身份标识(EndpointIdentifier,EID)和路由标识(RoutingLocator,RLOC).主机发送的分组到达边缘网络入口路由器(IngressTunnelRouter,ITR)后,ITR利用一整套映射系统查询得到目的主机所在边缘网络的出口路由器(EgressTunnelRouter,ETR)的RLOC,接着ITR用含有该RLOC的头部封装原来的分组,并使用隧道机制将其发往ETR,ETR对分组解封装后发往边缘网络中的目的主机.LISP利用映射系统来保存EID与RLOC之间的映射,路由器只需要保存RLOC的路由,从而减少了路由表项数量.LISP不对终端主机作任何修改,尽管它显示地提供了对多宿主和流量工程的支持,然而它本身对终端主机提供的安全性以及移动能力的支持较为有限.此外,从本质上说,LISP是把原有路由表相关的存储和通信开销转移到映射系统中,因此其映射系统的存储和通信开销仍然是一个问题,尤其是由ITR发起查询这一点[13]会带来一些问题,对于触发查询的分组,如果ITR对其进行缓存,会给高速存储资源有限的路由器带来较大的负担且不可扩展,而如果ITR丢弃该分组,则会导致终端计时器超时重传,对发起通信时的时延增加较大.HIP用于支持主机身份标识与位置标识的分离.HIP采用全球唯一的IPv6地址作为主机的身份标识,并在分组的网络层头部与传输层头部之间加入一个新的头部存放身份标识.为了处理身份标识,HIP在传统互联网体系结构的传输层和网络层之间加入了主机标识层(HostIdentifyLayer,HIL),HIL以上使用主机标识(HostIdentifier,HI)作为访问点,HIL以下则采用传统的IP地址进行位置寻址.身份标识和位置标识的映射由专门的设备管理,HIL的功能是查询并缓存这一映射以便正确处理分组头部并完成路由或递交.HIP支持主机移动和多宿主[14-15],但它的不足之处在于:不能解决由用户AS多宿主导致的路由可扩展性问题;IPv6形式的身份标识不具有用户身份语义且不便于记忆,能提供的安全保障比较有限[16].此外,HIP协议栈下能运行的应用程序需要重新开发,它们必须使用一类新的套接字(socket)接口,这使得HIP不具有兼容性,很难在现实中部署.Shim6协议用于支持主机使用多个位置标识访问互联网,即主机的多宿主.与HIP类似,它也将身份标识(Shim6中称为UpperLayerIdentify,ULID)Page4设计成IPv6地址的形式,并且也增加了新的分组头部和相应的新协议栈层次Shim层.不同之处在于,Shim层并非独立的一层,而是嵌入到IPv6模块中.此外,Shim6也没有专门的设备来保存ULID与位置标识(Shim6中称为定位符)的映射,而是双方Shim层进行通信协商来获取映射信息.最重要的协商消息包括初始时的四次握手和定位符变换时的通知消息.与HIP一样,Shim6也能支持主机移动与多宿主[17-18],但它同样也没有解决路由可扩展性问题,此外Shim6也采用了不具有用户身份语义的IPv6地址,且映射关系仅由通信双方自行维护,其安全性不如HIP.在身份/位置分离方案的其它研究成果中,一部分研究以现有的标准或方案为基础,因此基本继承了这些方案的优缺点,例如文献[19]和文献[20]使用分布式散列表(DHT)来构建LISP的映射系统.还有的方案设计了新的体系结构,例如文献[21]提出的MILSA方案设计了一种类URI的层次化主机身份标识,能提供多种场景下的移动能力和安全信任机制,但是没有从根本上解决路由可扩展性问题.表1对现有身份/位置分离方案提供的功能和存在的问题进行了概括总结.总的来说,目前已经提出的方案都不能同时满足路由的可扩展性、安全性以及多宿主和移动性的需求.本文提出一种新型身份/位置分离方案SAMS,并分析它在解决这3个问题方面的特性.方案路由可扩LISPHIP短期效果不明显,Shim6短期效果不明显,MILSA中等4SAMS体系结构4.1设计思想为了同时支持路由可扩展以及主机移动与多宿主,不能简单地照搬现有的标识设计与分离方法.首先,路由可扩展性的好坏依赖于路由标识能否很好的聚合,尤其是在核心网络中应当尽可能减少路由数量,这可以通过将边缘网络的地址空间与核心网络的地址空间分离来实现,也就是让边缘网络中的前缀在核心网络中仅仅作为该边缘网络的身份标识而存在.其次,主机移动与多宿主需要传输层能适应网络层位置标识的改变,因此可以在网络层以上传输层以下添加一个新的层次即“身份标识层”,并改变传统传输层以〈IP地址,端口号〉作为访问点的方式,用〈主机身份标识,端口号〉取而代之,而网络层仍然使用传统的IP地址.这样IP地址仅作为主机的位置标识,不起标识主机身份的作用,可以在移动和多宿主情况下进行改变.此外,为了实现真实身份并适应现实中用户与主机多对多的关系,可以在主机身份标识之外再设计用户身份标识,用户身份标识可以采取便于记忆的形式以便于查询,并应当与用户真实身份绑定从而为身份认证提供基础.总的来说,SAMS的核心思想是将用户身份标识、主机身份标识、主机位置标识(边缘网络位置标识)和核心网络位置标识相互分离.下面将对SAMS的体系结构进行详细说明.4.2体系结构用户身份标识(UserID)用于唯一标识一个用户(个人或组织),由用户向权威机构申请获得,并与用户的真实身份信息绑定;主机身份标识(HostID)用于唯一标识一台主机,它与端口号一起组成主机的传输层的访问点;边缘网络位置标识(EdgeLocator,ELOC)指出了主机在本地网络中的位置,是边缘网络路由器决定分组向何处转发的依据;核心网络位置标识(RoutingLocator,RLOC)指出了一个边缘网络在核心网络中的位置,是核心网络路由器决定分组向何处转发的依据.这4种标识在协议栈中所处的位置如图1所示.与传统的互联网协议栈相比,SAMS的协议栈在网络层之上、传输层之下增加了一个新的层次“身份标识层”用于处理身份标识.UserID可以采用类Email地址的格式,由一个标识用户名的字符串、字符“@”和标识管理本区域服务器的主机名(例如tsinghua.edu.cn)组成.这样的设计既方便记忆,也有利于借助现有DNS系统实现聚合.HostID需要携带于分组中进行传输,因此可以通过对UserID进行编码得到定长的HostID,例如使用32比特来标识域(例如可以将一个AS作为一个域),24比特作为用户编号,8比特作为主机编号.用户在申请获得UserID的同时还将获得一组属于该用户的公私钥对,以便通过数字签名和加密机制来提供对安全性的支持.ELOC和RLOC可以使用现有地址簇,Page5如IPv4或IPv6.新型身份/位置分离方案采用如图2所示的体系结构来将这4种标识统一起来.图14种标识在协议栈中的位置该体系结构包括的主要成员和要素有边缘网络映射服务器EMS(EdgeMappingServer),扩展的DNS系统,核心网络边缘路由器PE(ProviderEdge)以及核心网络映射服务器RMS(RoutingMappingServer).EMS保存了用户真实身份信息和UserID,它的作用主要有三方面.首先,EMS接受主机的注册,认证用户的身份并为其分配HostID.其次,EMS为已经注册的主机保存UserID、HostID和ELOC的实时映射关系,并通过定期与主机交换消息来随时更新ELOC.第三,EMS接受其它主机的查询请求,并用当时的映射关系予以应答.不同的EMS负责不同管理范围内的用户,例如可以在每个AS内部部署一台EMS.扩展的DNS系统保存了3类新的记录,第1类是域名与UserID之间的映射关系,第2类是域名或UserID与负责该域的EMS的ELOC之间的映射关系,第3类是域名或UserID与HostID之间的映射关系.其中第三类记录主要是针对一些长期在固定位置提供服务,并且HostID很少变化的服务器.PE是连接核心网络与边缘网络的路由器,对边缘网络分组进行封装或解封装,并在核心网络中转发.PE只保存少量常用ELOC前缀(popularprefix)到RLOC的映射关系,对于其它分组则封装发送到RMS.PE还负责通过扩展的BGP协议将它所连接的边缘网络的前缀通告给RMS.(4)HostA使用(3)中得到的HostID和ELOC组装分组,分组被发往该边缘网络的边界路由器(CustomerEdge,CE),并被转发到PEA;(5)PEA用RMS的RLOC对分组进行封装,封装后的分组在核心网络中被发送到RMS;RMS是核心网络中部署的功能较强的路由器,不仅能从相同AS内的PE那里学到ELOC前缀与RLOC之间的映射关系,而且能通过与相邻AS建立BGP会话学习到全局映射信息.因此,RMS拥有全局路由表,能将接收到的封装分组解封装后再次封装,并发送到正确的出口PE.RMS还负责将常用ELOC前缀通告给相同AS内的PE.4.3工作流程说明SAMS的基本工作流程.A)发起注册,经过身份认证后获得HostID;以图2中HostA发起与HostB的通信为例,(1)HostA向其所在管理域的EMS(即EMS(2)HostA向扩展的DNS系统发起查询,查询关键字为HostB的域名,DNS应答返回HostB的UserID和EMSB的ELOC;(3)HostA用HostB的UserID作为关键字向EMSB发起查询,EMSB应答返回HostB的HostID和ELOC,(2)和(3)两步中查询的结果可以暂时保存在HostA的缓存(Cache)中,在缓存超时之前如果又有查询需求则可以直接从缓存中获取;Page6(6)RMS将分组解封装之后,在映射表中查找目的ELOC对应的出口PE的RLOC,用此RLOC将分组再次封装,封装后的分组在核心网络中被发送到PEB;(7)PEB将分组解封装,转发到HostB所在的边缘网络,分组在该边缘网络中被发送到HostB;(8)最终,HostB检查出分组的目的HostID与自己的HostID一致,于是接收该分组.5SAMS特性分析在上一节提出的SAMS方案中,路由可扩展性、移动与多宿主以及真实身份认证都能得到很好的支持,本节将分别对这些特性进行分析.5.1路由可扩展性SAMS的第一个重要特性是能提高核心网络路由的可扩展性.路由可扩展性问题主要是由用户AS向多个提供者AS通告前缀造成的.然而在SAMS中,虽然PE会通告它所连接的边缘网络中包含的前缀,但PE本身和核心网络中的普通路由器都不会保存这些前缀.换句话说,只有在拥有全局路由表的RMS上会产生一些开销,这些开销主要有两部分.第一是存储路由表和计算路由的开销,这部分开销与现有的核心网络路由器的开销相同.但是,由于一个AS内部只有少量RMS(部署多台RMS而不是一台可以预防单点失效问题,并提供可扩展性),因此可以部署高性能的路由器作为RMS来存储和计算路由,也就是以较低的成本来解决问题.第二是路由信息更新的开销,这部分开销与现有的情况相比得到了有所减小.在传统的BGP协议中,位于同一个AS内部的BGP路由器之间以全连通(full-mesh)的形式建立IBGP会话,所有的路由更新消息在每一对BGP路由器之间传送,造成极大的带宽消耗,虽然目前很多AS采用了路由反射器(reflector)技术[22]来取代全连通结构以求减小开销,但PE与reflector之间的路由更新消息的数据量仍然不可忽视.在SAMS中,AS内部的路由更新消息仅仅涉及与该AS所连接的边缘网络的前缀,这只占据了全部路由更新消息的很小一部分;而且两个相邻AS之间仅在RMS之间建立EBGP会话,域间路由更新消息的数量也得到了有效控制.5.2移动与多宿主SAMS的第二个重要特性是支持大量主机跨AS移动或多宿主.在当前的互联网中,IP地址在标识用户位置的同时还作为传输层的访问点的一部分起着标识主机身份的作用.当主机跨越AS移动的时候IP地址发生变化,会导致两方面的问题,一是远程用户不能及时得到移动主机最新的位置信息,难以与其建立连接,二是已经建立的传输层连接会被中断,需要重新建立连接才能继续传输,这对于一些实时性要求较高的应用如实时视频会造成较大的影响.将UserID、HostID与ELOC分离可以使边缘网络IP地址较好地聚合起来作为位置标识使用,而当主机发生移动/多宿主时也能通过UserID和HostID标识出主机的身份.一方面,当主机ELOC发生变化时,该主机会立即通知管理它的EMS和在之前一段时间内通信过的主机,因此在ELOC变化之后其它主机也能通过本地缓存或EMS查询到该主机当前的ELOC,从而发起通信.这种方式能适应终端主机游牧方式的移动,即主机从一个地方移动到另一个地方后停留一段时间,通常移动速度较慢,且移动之后需要重新建立新的连接.另一方面,当主机ELOC变化时,该主机会立即通知正与它进行通信的主机,收到通知的对端主机只需要改变目的ELOC,而不用改变目的HostID,所以传输连接不会中断,仅仅会产生一定的带宽和延迟变化.这种方式能适应终端主机漫游方式的移动,即主机可以任意移动且在移动过程中已建立的传输连接不会被中断.主机多宿主的情况与跨域移动的情况十分类似,不同之处在于多宿主主机可以同时使用多个网络接口卡接入到网络.这样,多宿主主机在从一个ELOC切换到另一个ELOC之前可以先由两个接口分别同时接入到提供这两个ELOC的网络,切换时分别通知EMS和对端主机同时更改本地路由.在这个过程中,通信双方的分组仍然能够进行正确收发,所以数据传输受到的影响很小,尤其是当切换前后带宽和端到端延迟比较接近的时候.借鉴多宿主切换的这一优点,可以在主机移动时也使用两个接口,这样一来,即使在获取新的ELOC和检测ELOC变化的时候也能进行正常通信.SAMS不仅支持单个主机的快速移动和多宿主,也支持包含多个主机的网络(例如一辆行使中的列车上的网络)的快速移动和多宿主.这种网络中需要使用特殊的网关,称为移动网络边缘路由器(MobileCustomEdge,MCE).MCE一方面充当Page7NAT网关,将分组中ELOC映射为网关的外部地址和传输层端口号组成的二元组,由于新型身份/位置分离方案中的分组在网络层头部与传输层头部之间增加了一类新的头部,因此MCE需要在传统NAT网关的基础上进行扩展以便能识别此分组结构;另一方面,MCE还要负责实现网络整体移动时的相关功能.MCE可以使用两个外部接口来帮助切换,这与主机多宿主的情况类似.如图3所示,当边缘网络需要整体移动时,MCE的一个接口负责在原来的路径上继续收发分组,另一个接口则执行建立新的链接的过程.当新的链接建立完成后,由MCE而不是主机负责发送通知给当前有通信的所有对端主机,由于MCE作为NAT网关保存了动态端口映射表,将其做一定扩展就能实现发送消息给通信对端的功能.当对端主机收到消息时将发送分组到新的目的地址,此时MCE将更新端口映射表,这样就将传输流量转移到了新的路径上.5.3真实身份认证在现实中,用户与主机之间存在多对多的映射关系.一方面,同一用户可以使用不同的主机连接到互联网,另一方面,有些主机也会被多个用户交替使用甚至同时使用.现有的身份/位置分离方案仅定义了一种身份标识即主机身份标识,难以提供对用户身份真实性认证的支持.SAMS将用户身份标识与主机身份标识相分离的思想能够提供更好的身份认证和安全机制,这与已有的研究有本质上的不同,为验证互联网用户身份的真实性与合法性提供了保障,也为网络攻击源追踪和定位提供了基础.用户在向权威机构申请用户身份标识的时候,提供给用户的包括一个类Email地址格式的UserID和一个用于身份验证的Key文件,其中包含用户的公私钥对以及管理该用户的EMS的公钥.在SAMS中身份认证与标识映射机制是集成在同一设备即EMS上来实现的,这就大大减小了系统实现和部署的复杂程度.SAMS提供两方面的身份认证机制.一方面是EMS对请求注册的用户的认证.用户在注册的时候需要使用Key文件中包含的用户私钥对注册消息签名,以证明注册用户身份的真实性,同时还可以使用EMS的公钥加密以防止消息被篡改.已注册的用户需要定时向EMS发送保活消息并在ELOC发生变化时立即通知EMS,这些消息中包含EMS与用户主机协商好的序列号,每交换一次消息序列号增大1,如果消息丢失则重新协商序列号.在此过程中EMS可以随时要求用户主机进行基于签名的身份验证.另一方面是通信一端的主机对另一端主机身份的验证,其基本方法仍然是基于数字签名机制.主机可以在任何它认为需要的时候向对端索取签名,例如对方主机的ELOC发生变化之后.6讨论其它一些相关问题进行讨论.这一节将对SAMS在性能上的一些折衷以及(1)端到端时延SAMS方案可能增大端到端时延的因素包括封装、解封装的时间开销,路径拉伸,以及发起通信前的映射查询时延.首先,现有核心路由器的封装和解封装技术已极为成熟,能做到线速转发,因此带来的额外时延时间开销很小.其次,路径拉伸仅发生在目的地址为少数非常用前缀的情形中,且可以通过RMS的合理部署来减小.本文7.1节中通过实验评价了不同RMS部署对路径拉伸的影响.最后,通过与LISP和Shim6的比较来讨论SAMS的映射查询时延.在LISP方案中,主机先查询DNS从名字解析对端的EID,然后发起通信.当第一个分组到达ITR后可能会出现CacheMiss,此时需要借助于映射系统解析对端EID到RLOC的映射,会引入额外的一个RTT的时延,当ITR已经缓存了映射时就不会有额外时延.然而当CacheMiss时,ITR对于触发查询的分组有两种可能的处理方式,一是丢弃该分组,二是缓存该分组直到查询到相应的映射信息或计时器超时.在前者的情况下,发起通信的终端需要等待计时器超时并重传(例如TCP协议),造成的时延将远不止一个RTT,而后者的情况会占用大量的Page8路由器资源,不具有可扩展性.在Shim6方案中,通信双方在发起通信前需要执行四次握手协议,额外时延为2个RTT.而SAMS在最坏的情况下,需要对DNS和EMS各查询一次,引入的额外时延与Shim6相同,为2个RTT.然而此额外时延产生于发起通信前的查询请求,可以类比为现有网络中多次查询DNS的情况,而实际的通信过程中不会有额外的时延.因此与LISP相比,SAMS将处理查询的开销从网络转移到终端,将时延的代价从通信中转移到通信前,获得了一定的改进效果.(2)映射系统可扩展性一方面讨论EMS的可扩展性.EMS只需要维护它所管辖区域内的用户,即只保存局部的有限的信息,与拥有全局信息的DNS相比数据量要少得多.跨越EMS管辖区域的映射查询是通过扩展的DNS系统来实现的,而DNS系统具有较好的可扩展性.对于用户数量较多的AS,可以根据系统的处理能力增设多台EMS分别管理不同的用户(例如按地址段划分)和处理查询请求.而对于少量访问较为频繁的地址(如知名站点),可以通过扩展的DNS系统来保存这些少量的映射信息.此外,终端会对映射信息做缓存,因此同一台主机不会在短时间内频繁地向同一台EMS查询相同的映射信息.(4)RMS会话可扩展性与安全性另一方面讨论扩展的DNS系统的可扩展性.扩展的DNS系统主要保存两类映射.第一类是域名到EMS的ELOC的映射,由于并不是每个用户的UserID都需要有一个域名与之对应(一般用户仅拥有UserID,其映射记录保存在EMS中),因此这类映射的管理与现有DNS系统享有相同的可扩展能力.第二类是个别用户(如知名站点)的域名与其UserID及ELOC的映射,这类映射主要是为了加快查询速度,以及减小EMS处理查询的负担,由于这类映射记录的数量最多与现有DNS记录相同,因此不会对DNS系统带来可扩展性问题.(3)核心网流量策略SAMS方案中,部分流量会经过RMS来转发,而不是通常的PE到PE的路由方式,这会使得原本的网络流量发生一定变化.然而PE也缓存了一部分映射,虽然这部分映射数量很少,但是它们对应的是网络中的常用前缀,即大部分流量还是由PE来路由,只有少部分流量需要经过RMS.此外,运营商还可以部署多个RMS,并通过控制路由的发布和学习来实现自己的流量策略.RMS建立BGP会话的主要作用是学习和发布全局映射信息,可以分为域间会话和域内会话两种情况来讨论其可扩展性.在域间会话方面,RMS与现有BGP边界路由器之间建立会话的方式一致,部署多少台RMS以及每台RMS与哪些邻居AS的RMS建立会话都是通过管理员配置决定的,因此在会话方面的可扩展性与安全性与现有的BGP协议一致.而在域内会话方面,因为RMS只负责维护全局映射信息,会话建立的方式不影响域内路由,所以不需要在每一对RMS之间都建立会话,只需要使用较少量的会话以保证全局映射信息在域内的传播即可,这样一来就不会引入iBGP协议的域内会话数量平方增长的问题(参见路由反射器[22]).(5)封装/解封装开销与LISP相比,SAMS中可能会多引入一次封装/解封装的开销,这次封装/解封装发生在流量经过RMS的情况下.然而这种情况仅出现在少数非常用前缀的流量中,而大多数流量因为PE对常用前缀的映射做了缓存,所以不需要经过RMS,因而与LISP一样,只需要一次封装/解封装.此外正如前面所说,现有路由系统的封装/解封装技术已极为成熟,在我们实现的原型系统中已经能够达到线速处理.因此,封装的开销主要在于带宽的额外消耗,这部分开销与LISP引入的一样,属于能够承受的范围内.(6)链路失效处理SAMS方案并不改变和影响现有网络的故障恢复能力,很多已有方案都可以与SAMS共存.即使当PE和CE之间的链路发生故障时,也有一些解决方法,例如可以采用AS级别的多宿主连接,当链路出现故障时通过现有的路由系统达到收敛,或者通过构建冗余备份链路来达到处理故障的目的.7性能分析与评价为了更好地评价SAMS方案,我们实现了SAMS原型系统.开发的设备包括扩展协议栈的主机、扩展的DNS系统和EMS,以及支持新型身份/位置分离方案的PE路由器和RMS.原型系统以高性能虚拟网络VegaNet[23]为平台,在CERNET2主干网的10个路由器节点上进行了部署,部署的节点和拓扑结构如图4所示.实验网络由3个核心AS和4个边缘网络组成.HostA与HostB分别属于不同的边缘网络,且HostB能通过不同的接入方式Page9分别接入3个边缘网络,包括无线局域网(WiFi)接入和3G(TD-SCDMA)接入,其中3G接入将HostB连接到互联网,通过建立一条VPN隧道将流量引回到一个边缘网络.HostB采用多种接入方式接入到多个边缘网络的目的是实验验证当主机移动或多宿主时的通信情况.下面将分别对SAMS的多个方面的性能进行分析与评价.7.1路由可扩展能力图5给出了采用SAMS前后CERNET2核心网络路由表项数量的情况.总体上,采用SAMS之后25个核心路由器节点中的平均路由表数量得到了大幅减少.具体来说,IGP路由基本保持不变,从用户AS学到的路由减少,这两部分在原来总的路由表中占的比例很小;从PeerAS学到的路由大幅减少,从占原来路由表的绝大多数减少到与IGP路由大致相当,具有很好的可扩展性.此外,采用一个RMS或采用多个RMS对路由表大小的影响不大.然而,采用多个RMS一方面可以预防单点失效问题,另一方面还可以减小因为部署SAMS而产生的分组转发路径拉伸,从而减小SAMS对端到端延迟的影响.图6对端到端路径拉伸的情况进行了比较,被比较的方案包括仅部署一台RMS以及同时部署三台RMS.从图中可以看出,选择拓扑结构中更合适的节点作为RMS可以减少路径拉伸,例如将北京节点作为RMS时有70%的端到端路径长度不变,而如果将上海节点作为RMS则只有30%.同时使用三台RMS可以获得最小的路径拉伸,88%的路径长度不变,只有不到5%的路径拉伸超过2,而这部分路径拉伸可以通过在PE路由器上配置常用前缀来消除.7.2标识快速切换为了评价SAMS的标识快速切换能力,我们测量了HostB在两个接入网络之间每次切换所需的时间,图7和图8给出了实验结果,其中图7按照测试的时间顺序给出了每一次移动切换的时间,而图8给出了切换时间的累积分布.可以看到切换的时间大体较为稳定,有大约50%的切换的切换时间在1.5s~2s之间,平均切换时间为2.28s.由于一般的Page10流媒体应用都会有2s~3s的缓存,因此这一切换时间能为这类应用提供移动中的平滑播放.这一实验结果说明SAMS能提供很好的多宿主和移动主机跨域高速切换的性能.为了分析影响标识切换时间的因素,为进一步优化奠定基础,我们建立了如图9所示的理论模型,它使用广义随机Petri网[24](GeneralizedStochatiscPetriNet,GSPN)描述了移动主机在ELOC变化时通信双方的状态.表2给出了模型中各位置和变迁的含义.符号p1主机A发生移动前的瞬间t1主机A发生移动p2对端主机B尝试发送分组t2p4p5p3主机A获取ELOC,检测ELOC变化,通知端主机ELOC变化对端主机B等待重传计时器超时对端主机B收到了ELOC变化的消息,映射缓存更新完成对端主机B完成发送分组到新的ELOCt6其中t2、t3、t4、t6是时间变迁,速率分别是λ2、λ3、λ4、λ6.通过求解此模型可以得到一个标记从离开位置p1到再次返回p1的平均时间,即主机进行ELOC切换时不能接收到对端发来的分组的平均时间间隔:p6这一时间间隔由三部分组成,一是获取新ELOC的时间加上检测本机ELOC变化的时间再加上发送消息通知对端的时间,二是重传计时器超时时间的2倍,三是对端到本主机新路径的传输延迟.针对这一结论,可以从两方面入手对主机移动时产生的延迟变化进行优化:(1)改进传输协议在ELOC切换时的重传时间间隔;(2)缩短检测本机ELOC变化的时间,可以依靠在内核设计特殊的机制来实现当网卡一旦变成可用状态时就立即发送消息.此外,采用双网卡进行位置标识切换也有利于减小切换时间.7.3身份认证开销从功能看,SAMS将身份标识与位置标识进行区分,并通过签名机制提供对用户身份真实性的认证,从而保证会话的可信与可靠.这种身份认证机制的安全性能是由签名算法来保证的,在本文中不做进一步的讨论,这里主要对身份认证的开销进行实验评价,以说明SAMS提供的真实身份认证特性不会对基本的转发功能造成影响.图10给出了在开启签名和不开启签名这两种情况下,用户主机与EMS之间的保活消息的往返时间实验结果,这段时间既包括了用户主机和EMS构造消息、计算和验证签名的时间,也包括了消息在网络中传输的时间.从图中可以看出开启签名与不开启签名相比额外开销很Page11少,两种情况下的平均处理延迟分别为69.28ms与64.44ms.这就说明了SAMS可以在不影响正常通信的情况下的提供安全性保证.7.4可部署性SAMS既需要改动网络,也需要改动主机的协议栈,但它仍然提供了较好的对可部署性的支持.总的来说,SAMS既能提高核心网的路由可扩展性,也能为终端用户提供很多好处.对于网络运营商来说,部署SAMS可以帮助他们有效地解决核心网路由可扩展性问题,且不影响流量工程、故障恢复等其它功能.对于用户来说,SAMS提供了对移动性和site级别的多宿主的支持,并且由于SAMS支持真实身份认证,当发生攻击时,部署了SAMS的非攻击者用户能够最早被排除嫌疑,这种先部署先获益的特性可以促进SAMS的部署.此外,SAMS对主机协议栈的修改很轻量,且与现有协议栈兼容,这使得在终端部署SAMS可以通过操作系统升级或打补丁的方式实现,无须用户自己动手.SAMS原型系统进行了长期实验,在峰值流量达到600Mbps的情况下,主干网设备仍然能很好地完成ELOC到RLOC之间的映射和分组转发功能.此外,SAMS原型系统在主机协议栈和应用程序的各种组合情况下都能很好地工作,这些都说明SAMS具有很好的可部署性.下面给出SAMS端到端通信的几种典型的场景.当通信双方的协议栈均为新协议栈且已分别向各自的EMS注册的时候,可以使用新开发的应用程序(用UserID或HostID进行通信),也可以使用传统的应用程序(用IP进行通信).当使用传统应用程序通信时,需要事先在本地缓存中保存对端主机的HostID和ELOC的映射信息,这可以通过先运行其它新开发的应用程序来实现,例如以对端的UserID为对象运行扩展的ping程序.无论使用哪种应用程序,双方都是通过发送和接收包含ID头部的分组相互通信的.当通信双方中只有一端的协议栈为新协议栈,而另一端为传统协议栈时,因为传统协议栈无法对含有ID头部的分组进行处理,所以只能依靠发送传统的IP分组进行通信.此时,使用新协议栈的主机查询不到对端主机的HostID,映射缓存中也不会保存此信息,所以协议栈虽然包含身份标识层,但不会对分组添加ID头部,分组的发送和接收按照传统的流程进行.总的来说,新协议栈的主机能够一边发送包含ID头部的分组与另一新协议栈主机通信,同时一边访问互联网上的传统站点,充分体现了SAMS的逐步部署能力.8总结互联网路由可扩展性问题亟待解决,与此同时,安全性与多宿主以及移动性在未来互联网中的重要程度也越来越高.学术界普遍认为将IP地址的身份标识语义和位置标识语义分离开来是解决这些问题的根本方法,但现有的身份/位置分离方案不能同时很好地解决这些问题.本文提出了一种新型身份/位置分离方案SAMS.SAMS将用户身份标识,主机身份标识,边缘网络位置标识和核心网络位置标识分离,构成方案体系结构的要素包括边缘网络映射服务器EMS,扩展的DNS系统,核心网络边缘路由器PE以及核心网络映射服务器RMS,很好地分离了IP地址的语义.SAMS大幅提高了核心网路由可扩展性,为用户真实身份认证提出了一种较好的解决方案,并能很好地支持多宿主和大规模移动.我们实现了SAMS的原型系统,在CERNET2主干网节点上部署了大规模的实验网络并进行了长时间的实验,实验结果表明原型系统具有预期的功能和良好的性能,并具备很强的兼容性和可逐步部署能力.
