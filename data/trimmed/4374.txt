Page1基于多HA部署的MIPv6网络服务可用性提升方法张瀚文1)张玉军1)许智君1),2)马超1),2)李忠诚1)周继华3)1)(中国科学院计算技术研究所北京100190)2)(中国科学院大学北京100049)3)(重庆金美通信有限责任公司重庆400030)摘要移动IPv6是实现下一代互联网移动特性的核心技术,依赖于部署在家乡链路的家乡代理(HA)实现节点移动过程中的可寻址性.家乡链路的单一HA部署,将成为系统的单点故障隐患及性能瓶颈,难以保证系统服务可用性.为提升移动IPv6网络的系统服务可用性和系统性能,需要在家乡链路部署多HA,解决其单点故障问题,并有效均衡多家乡代理间的负载.文中研究移动IPv6网络多家乡代理部署方法,引入检测备份环对多HA间进行有效组织,基于此实现HA容错和负载均衡.多家乡代理采用单一HA映像以实现容错及负载均衡处理对移动节点的透明性,减小处理延迟和开销.关键词移动IPv6;家乡代理;容错;负载均衡;服务可用性1引言移动IPv6(MobileIPv6,MIPv6)[1]是IP网络中支持移动的核心技术,定义了节点移动过程中保持可寻址性的机制.MIPv6依赖于家乡代理(HomeAgent,HA)实现移动节点(MobileNode,MN)移动过程中的可寻址性.HA作为实现MIPv6系统服务的关键节点,仅在家乡链路部署单一HA,将会成为系统单点故障隐患及服务能力的瓶颈,应考虑在同一链路部署多HA,解决HA容错和负载均衡问题,提升MIPv6网络服务的可用性.本文研究MIPv6家乡链路多HA部署方法.引入检测备份环对多HA进行合理组织,通过HA间主动的失效检测和服务迁移实现HA容错,各HA同时作为服务节点和备份节点,避免设备冗余,充分利用系统资源,提升系统总体服务可用性和服务效率;通过单一HA映像实现多HA部署及容错和负载均衡处理对MN的透明性,提高效率的同时降低处理开销.本文第2节对多HA部署下的两个关键问题的研究现状进行介绍和分析,即HA容错和负载均衡;第3节提出基于多HA部署的MIPv6服务可用性方案(MultipleHADeploymentScheme,MHADS);第4节和第5节通过数值分析和系统仿真,对本文所提方法进行性能评价,并与现有方法进行比较分析;最后总结全文.2相关工作从MIPv6协议标准设计之初就有研究关注多HA部署下的容错和负载均衡问题.在负载均衡方面,早期的静态方案通过预配置将MN分配给某HA[2],这种静态方案可以将所有MN均匀地分配给各HA,但各MN的通信量强度及业务类型各不相同,难以有效实现负载均衡.更多的研究采取动态方案.有基于动态HA发现(DHAAD)的负载均衡方案[3-4],试图利用任播(anycast)技术动态发现最优HA.这些方案都是由MN发起,无法对MN透明,且会增加处理延迟和开销.文献[5-6]也是通过动态的移动锚点选择实现负载均衡.文献[7]引入浮动令牌和负载阈值实现动态负载均衡,基于负载阈值实现负载迁移和浮动令牌的移交,所有的注册请求都由唯一的、持有浮动令牌的HA处理.在文献[8]中,当某一HA的数据包到达率大于确定阈值时进行负载迁移.文献[9]提出一种双阈值转移策略.现有负载均衡方案仅仅基于被动的过载迁移,没有实现主动的过载预防,且负载均衡过程对MN不透明.在HA容错方面,现有的方案主要分为两类:基于集中管理系统的方案和基于信息备份的方案.文献[10]基于资源共享的思想,把失效家乡代理的负载重定向到有效的代理上,需要部署强大的网络管理系统承担移动代理的失效监测、备份代理的选择、负载信息的重新采集、负载重定向等功能.文献[9,11]提出了注册信息全备份的容错方法,所有HA维护完全相同的注册信息,当一个HA失效后,其他HA可以继续为MN服务,但这种方案难以实现注册信息在所有HA之间的同步,而且浪费存储空间.文献[12]提出在家乡链路上采用非易失存储器备份注册信息的容错方法,当一个HA失效后,有效的HA需要花费较多时间从非易失存储器中获取注册信息;当存储器发生故障时,这种方法不再有效.现有的容错方案均对MN不透明,普遍存在信息冗余大、迁移效率低、失效恢复延时长等问题,影响上层应用特别是实时应用的服务质量.3MHADS方案本文提出一种基于多HA部署的MIPv6服务能力提升方案(MHADS).多HA间的组织结构,是实现HA容错和负载均衡的基础,MHADS引入一种全新的多HA组织方式,在此基础上,通过HA间主动的失效检测和服务迁移实现HA容错,基于主动过载预防的思想实现全局任务在多HA间的负载均衡.MHADS的基本思想是:将家乡链路的多HA组织成环状的相互检测和信息备份关系,通过检测/备份环(Detection&BackupRing,DBR)中下游节点对上游节点主动的有效性检测和移动管理信息备份,实现快速的HA失效检测和失效实体的服务接管;通过移动管理信息在下游节点的唯一备份,降低信息冗余度,并省略服务接管目标的选择,实现快速的失效恢复.为实现检测/备份环的构造与维护,同时实现多HA间的负载均衡,引入超节点(SupervisorHA,SHA).SHA也作为家乡链路多个HA面向MN的统一服务接口,实现多HA对MN的单一映像,从而实现HA容错和负载均衡对MN的透明性.MHSDS系统结构如图1所示.Page3图1MHADS中多HA组织结构检测/备份环(DBR)生成方法如下:在家乡链路存在n个有效HA的情况下,采用一种明确的、结果唯一的排序方法形对n个HA进行排序,排序结果为首尾连结形成一个相互检测和备份的环状链HA1,HA2,…,HAn,HA1.本文给出一种基于HA优先级和地址的DBR构造实例:首先按照HA的优先级由高到低进行排序;对于优先级相同的HA,则按照地址组成的字符串由小到大进行排序.超节点作为检测/备份环的管理者和多HA面向MN的统一服务接口.在任意时刻,有且仅有一个HA拥有管理令牌(SupervisorToken,ST),作为SHA,配置多HA所共享的唯一HA地址,广播代理宣告.SHA作为检测/备份环的管理者,负责环的构造和维护:SHA动态维护环中各节点状态信息(包括各HA在DBR中的序号、地址、状态、负载、所服务MN的信息、优先级);当有节点加入或退出时,根据排序规则重构检测/备份环,并向环重构所涉及图2MHADS方案关键过程3.1MN移动注册SHA配置链路唯一的HA地址(SHA_Addr),作为面向MN的统一服务接口.所有MN不再需要通过DHAAD过程发现选择服务HA,而是直接将SHA_Addr配置为HA地址.移动到外地网络的MN发往家乡链路的移动的相关节点通告其新的上下游节点信息.SHA同时也作为家乡链路所部署的多HA面向MN的统一服务接口.家乡链路所有HA共享一个全局地址,整个HA集群体现为一个单一HA,通过统一服务接口SHA,被用户访问,具体的服务节点对MN而言透明.SHA配置多HA所共享的唯一HA地址,并在链路广播代理宣告.单一HA映像,使得多HA部署以及HA容错、负载均衡等处理对MN完全透明,所有操作仅在家乡链路内部的多HA间完成,同时省略MN注册时的动态HA发现(DHAAD)过程,减小MN注册、HA容错及负载均衡的处理延时和开销.SHA作为统一服务接口接收所有MN的服务请求,可根据全局HA状态及负载为每个到达家乡链路的移动注册请求动态选择最优服务实体,更利于实现全局任务在多HA间的实时均衡.以DBR为基础,MHADS实现多HA间的负载均衡及容错,几个关键过程如图2所示,以下分别进行介绍.注册请求将首先到达统一服务接口SHA.SHA根据全局负载状态为每个移动注册请求动态选择当前最优的服务节点,将请求重定向至选中的目标HA,由该HA完成此次移动注册请求的处理,并负责承担请求发送MN后续的移动代理服务.图3描述了HA为MN隧道转发数据的具体实现过程.Page4图3数据转发任务具体实现SHA作为统一服务接口为MN的移动注册请求进行最优服务实体动态选择.为在选择时作出最佳决策,SHA需要准确并及时地获取各HA的负载信息,为此设计了动态加权负载评估算法和基于切片的负载报告算法,具体算法参见文献[13].3.2HA失效检测在MHADS中,由于仅有SHA在家乡链路广播代理宣告消息,无法基于代理宣告实现HA间的失效检测,因此引入心跳机制实现HA的有效性检测:(1)DBR中的任意HAi以间隔时间HEART-BEAT_INTERVAL周期性地向其下游节点HAi+1发送心跳应答消息.(2)HAi+1每次接收到HAi的心跳应答后,将为其维护的Missing_Heatbeat计数器置0,并重置心跳计时器(值为HEARTBEAT_INTERVAL).(3)心跳计时器到期,HAi+1将为HAi维护的Missing_Heatbeat值增1后,重置心跳计时器.(4)当Missing_Heatbeat值达到预设的上限值Missing_Heatbeat_Allowed时,HAi+1向HAi发送心跳请求消息,请求对端应答.(5)若HAi+1接收到HAi回复的心跳消息,则执行步(2).(6)若HAi+1等待对方应答超时(超时时间HEARTBEAT_REQ_TIMER),则判断HAi失效.3.3失效HA服务迁移若失效节点HAi为普通节点,它的下游节点HAi+1在检测到其失效后,向SHA通告HAi的失效.SHA从DBR中删除HAi,根据排序规则重构DBR;SHA向环重构所涉及的相关节点通告其新的上下游节点信息.失效节点的下游节点HAi+1根据所备份的移动管理信息直接接管其服务,在家乡链路为接管的MN广播代理邻居宣告,将这些MN的HoA地址绑定到自己的物理地址,此后为这些MN隧道转发数据包;同时向下游节点HAi+2同步备份新接管MN的移动管理信息.若失效节点HAi为SHA,它的下游节点HAi+1在检测到其失效后,获得管理令牌,配置SHA_Addr,成为新的SHA,接管失效SHA作为HA所服务的MN,同时接管SHA服务,包括通过广播代理宣告通告向其他HA自己的SHA身份;从DBR中删除已失效的SHA,根据排序规则重构DBR;向环重构所涉及的相关节点通告其新的上下游节点信息.4MHADS方案性能分析本节和下节通过理论分析和系统仿真,对IETF的RHASM方案[9]和本文所提的MHADS方案进行比较.为实现IPsec支持,RHASM需采用硬切换和虚拟切换两种模式,在硬切换模式下,失效HA的服务迁移需要MN参与,向接管实体进行重注册.图4为HA容错方案性能分析的网络模型.其中:tmr表示MN与基站或无线接入点(BS/AP)间的无线链路传输延时;tra表示BS/AP与本地网络接入路由器AR间的单向传输延时;tah表示MN当前所在网络的AR与MN家乡网络间的单向传输延时;thh表示家乡链路内部各HA间的单向传输延时;tca、tch分别为MN的通信节点CN与MN当前所在网络的AR间、CN与MN的HA间的单向传输延迟.各参数经验值如表1所示[14-15].Page5tmrtratahthhtcatch10(WLAN)50(3G网络)150(卫星网络)HA容错时间Tft包括HA失效检测时间Tfd和失效HA服务迁移时间Tss.RHASM和MHADS的HA失效检测时间分析如图5所示.RHASM方案如图5(a)所示,HAi在失效前以间隔时间HELLO_INTERVAL(Ihl)在家乡链路周期性广播Hello消息,ti时刻为HAi在失效前发送的最后一个Hello消息,ti+1时刻该消息的生命期(LThl)到期,HAi的检测节点HAj将主动向HAi发送Hello请求,ti+2时刻HAj等待HAi的Hello应答超时(令超时时间为TOhlr),判断其失效.令σ表示HAi失效发生到ti+1时刻的时间间隔,那么,σ服图5HA失效检测时间分析RHASM方案的硬切换模式,活跃HA失效后的服务迁移需经过MN与新活跃HAj的多轮交互:HAj向各MN通告重配置HA;MN与HAj通过IKE过程协商IPSecSA(该过程至少需要MN-HA间两轮往返交互);MN向HAj进行家乡注册.忽略消息在各节点的处理时间,该模式下的服务迁移时间为TRHASM-Hss=7×tmh=7×(tmr+tra+tah).RHASM方案的虚拟切换模式,活跃HA失效后的服务迁移过程需从备用HA中选举产生一新的活跃HA,接管失效HA的服务,服务迁移时间主要为接管实体的选举时间TRHASM-V从[0,LThl]上的均匀分布.RHASM的HA失效检测时间为TRHASMMHADS方案如图5(b)所示,HAi以间隔时间HEARTBEAT_INTERVAL(Ihb)周期性地向下游节点HAi+1发送心跳消息.HAi失效发生在第i和i+1次心跳消息的间隔周期内.从ti+1开始,HAi+1每隔Ihb时间都会将HAi维护的MISSING_HEARTBEAT值增1,直到ti+Nmhb时刻MISSING_HEARTBEAT值达到Nmhb(令Nmhb为MISSING_HEARTBEATS_ALLOWED),HAi+1将主动向HAi发送心跳请求消息,到tj时刻HAi+1等待HAi的心跳应答超时(令超时时间为TOhbr),判断其失效.令θ表示HAi失效发生到下一次心跳间隔到期的时间,则θ服从[0,Ihb]上的均匀分布.MHADS的HA失效检测时间为TMHADSIhb+TOhbr.MHADS方案中,某节点HAi失效后,将由它唯一的备份节点HAi+1基于同步备份的信息直接接管其服务,若忽略节点处理时间,其服务迁移时间可忽略不记,该方案的容错时间主要由失效检测时间决定.RHASM硬切换模式、虚拟切换模式及MHADS的容错时间均值分别为ft]=LThl/2+TOhlr+7×(tmr+tra+tah),E[TRHASM-Hft]=LThl/2+TOhlr+tvote,E[TRHASM-VE[TDBRMft]=(Nmhb-1/2)×Ifdm+TOhbr(1)图6给出了RHASM硬切换、虚拟切换和Page6MHADS方案的容错时间均值,其中,LThl=3Ifdm,Nmhb=2,TOhlr=TOhbr=6thh,tvote=20ms.图6(a)为容错时间均值随失效检测消息间隔周期Ifdm的变化情况.三者都随着Ifdm线性增长,E[TMHADS终最小,E[TRHASM-V需要经过接管实体选举过程.而E[TRHASM-H远高于前两者,主要因为RHASM硬切换的服务迁移过程需要MN参与,并需要MN-HA间的多轮交互.现有HA容错方案中Ifdm典型取值为50ms.从图中可以看到,当Ifdm<150ms时,E[TMHADSft]都小于250ms(上层音频业务容忍的最E[TRHASM-V大传输延时),Ifdm的建议取值范围为10ms~150ms.而E[TRHASM-Hft]的最小值也远大于250ms,RHASM硬切换无法避免HA失效对MN上层应用尤其是音频业务造成影响.图6(b)为容错时间均值随MN-HA间传输延时的变化情况,RHASM硬切换的容错过程需要MN参与,使得其容错时间随MN-HA间传输延时的增大而显著增大.而RHASM虚拟切换和MHADS由于对MN透明,容错处理在家乡链路内实现,使得其容错时间与MN-HA间传输延时无关.5MHADS方案系统仿真本文在NS-2中,通过扩展MIPv6协议模块MobiWan,仿真实现了MHADS和RHASM方案.仿真场景设置:家乡链路设置为10GB以太网,一个边界路由器ER,6个HA.MHADS中6个HA组成检测/备份环;RHASM中6个HA分别属于两个冗余备份集,各冗余备份集包括一个活跃HA和两个备用HA.100个MN移动在5条外地链路.各MN的移动注册请求服从发送率为λmn-reg的泊松分布.每个MN的数据包到达率设置为λmn-data的泊松分布.仿真参数设置如表2所示.表2MHADS和RHASM方案仿真参数设置MN-AP间无线链路CN、AP、ER与Router间链路带宽100MB,单向传输延时10ms失效检测消息间隔周期Ifdm10ms~100ms各MN移动注册请求率λmn-reg0.125个/s(1个/8s)各MN数据到达率λmn-data5~90个/sMHADS方案负载评估及报告算法系统参数值仿真时间5.1容错时间图7为RHASM硬切换、虚拟切换和MHADS方案容错时间随失效检测消息间隔周期Ifdm的变化情况.与理论分析结果一致,三者都随Ifdm线性增长.在10ms~100ms范围内,TMHADS终小于250ms.RHASM虚拟切换模式的服务迁移由于需要经过接管实体选举过程,TRHASM-V大于TMHADS5.2移动注册请求失败率本节和下节分别比较MHADS和RHASM方案在各种系统负载状况下的系统总体服务可用率Page7(移动注册请求失败率)和系统服务性能(移动注册平均延时).家乡链路总的利用率ρhl反映系统负载.λmn-reg=0.125(1个/8s),λmn-data从5~90变化,则ρhl从0.1~1.5变化.图8给出MHADS和RHASM方案在不同系统负载状况(家乡链路利用率)下的移动注册请求失败率.当系统负载较轻,即ρhl0.3时,两种方案的移动注册失败率都为0.当ρhl>0.3时,随系统负载的增大,RHASM方案下的移动注册请求失败率rf大幅增大,当ρhl=1时,PRHASMPRHASM而MHADS方案的移动注册请求失败率始终为0,直到ρhl增大到1.1,PMHADS部署MIPv6系统时,会考虑到系统总服务能力,将系统所支持的最大MN数设置在其能力范围内.即通过设置系统所服务MN个数的上限值,使得预期的家乡链路总利用率ρhl1.也就是说在系统实际部署中,MHADS方案的移动注册请求失败率几乎为0.5.3移动注册平均延时图9给出两种方案在不同系统负载状况(家乡链路利用率)下的移动注册平均延时.当系统负载较轻,即ρhl0.3时,两种方案下的移动注册平均延时都在100ms左右.当ρhl>0.3时,随着系统负载的增大,RHASM方案下的移动注册平均延时reg大幅增长,当ρhl增大到0.5时,TRHASMTRHASM达750ms左右,当ρhl=1时,TRHASM右,如此高的注册延时将严重影响MN上层应用;而MHADS方案的移动注册平均延时TMHADSρhl1时始终在100ms左右.5.4容错信令开销图10为MHADS和RHASM方案所引入的单位时间信令开销CMHADS测消息间隔时间Ifdm的反比例函数,Ifdm越小,即失效检测消息发送越频繁,HA容错时间将越小.系统设置时,需在权衡容错时间和引入开销的基础上配置恰当的Ifdm值.MHADS方案基于检测/备份环减小了移动管理信息备份开销,使得CMHADSft.除了容错信令开销,RHASM引入了大量的CRHASM设备冗余开销和信息存储开销.备份HA仅用于信息备份,造成系统资源浪费;移动管理信息在多个实体同时备份,信息冗余大,造成大量存储开销.而MHADS引入检测/备份环实现多HA间的合理组织,所有节点同时作为服务节点和备份节点,避免设备冗余,同时实现了多HA间的负载均衡,充分利用系统资源,提升系统总体服务能力.6结语本文提出一种基于多HA部署的MIPv6服务能力提升方案(MHADS),该方案将家乡链路的多HA组织成环状的相互检测和信息备份关系,通过检测/备份环中下游节点对上游节点主动的有效性检测和移动管理信息备份,实现失效实体的快速失效检测和服务接管.引入逻辑功能实体SHA作为检测/备份环的管理者和家乡链路整个HA集群面向MN的统一服务接口,通过多HA对MN的单一映像,实现多HA部署及容错过程对MN的透明性,减小容错时间,同时通过统一服务接口为每个Page8MN进行最优服务实体选择,实现全局任务在各HA间的动态均衡,提升系统总体服务能力.
