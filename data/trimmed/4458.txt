Page1基于重采样的差分频域分析方法王?刘戬王飞宇刘剑峰(北京中电华大电子设计有限责任公司北京100102)摘要差分频域分析方法是常用的攻击方法之一,当设计中使用随机延时运行等其他防护措施时,现有的差分功耗分析方法已经不能开展攻击,而差分频域分析方法可以对这类防护措施实施攻击.但该攻击方法会带入更多噪声,降低攻击效率.针对以上问题,文中提出了一种基于重采样的差分频域分析方法,该方法可有效地提升攻击效率.文中首先介绍了基于重采样的差分频域分析方法的基本原理,然后搭建实验,在SASEBOGII仿真板上实现一个防护措施为随机延时运行和功耗隐藏的DES算法实施攻击.实验结果表明,针对DES随机延时运行和功耗隐藏防护措施,文中提出的重采样频域攻击方法较之DPA方法可攻击成功,是多种防护措施攻击成功的实例.同时,采用重采样处理的差分频域分析方法可以有效提高信号的信噪比,将攻击效率提升一倍.关键词差分频域分析;重采样;DES;防护措施;密码学1引言在信息安全领域,针对密码芯片的安全攻击研究是现今的热点之一.自Kocher等人[1]在1996年首次提出利用芯片的侧信道信息破解芯片密码后,Kocher等人又提出了差分功耗分析(DifferentialPowerAnalysis,DPA).之后,国内外侧信道研究工Page2作不断深入[2-4],不同类型的侧信道攻击(SideChannelAttacks,SCA)方法相继出现,如相关功耗分析(CorrelationPowerAnalysis,CPA)[5]、模板攻击[6]等.差分功耗分析是侧信道攻击技术中应用范围最广的一种.DPA攻击相对于传统的穷举攻击,省时省力.一般来说,DPA处理的信息是时域上的信号,因此要求算法的关键运算步骤的时域信号必须精确对齐,才能开展攻击[1].针对DPA的特点,学者们针对防护DPA需要时间上精确对齐,设计出相应的防护措施,如随机抖动[7].Messerges[8]将RSA模幂算法的操作随机化,提出了一种伪随机扫描模幂算法,可以抵御DPA的攻击.使得防护DPA攻击的防护措施的研究更进一步.若所攻击的算法中加入了随机运行算法的操作,会使得各条功耗曲线相同操作时间点不能精确对齐,那么使用再多的差分曲线条数都不能将正确密钥找出来.因此,针对如此防护措施的算法运算,直接应用DPA无法攻击成功[9-10].与此同时,针对防护DPA攻击的防护措施的攻击研究也有了进展.2000年Aigner等人在文献[11]中就曾经指出:在密码旁路分析中的时域信号差异在频域中同样会体现出来.在2005年的CHES会议上,Gebotys等人[12]针对电磁信号的频域分析,在PAD上运行Rijndael和ECC算法,成功获取了算法密钥,验证了频域值同样携带了时域信息.邓高明等人针对带防护DPA的算法的频域分析,使用模板攻击方法成功获取算法密钥[13].由于算法运行中,信息时域信号存在的差异在频域中同样会体现出来[14-15],将频域信号的特点引入到DPA中,得到一种针对频域信号的DPA分析方法,即差分频域分析(DifferentialFrequencyAnalysis,DFqA).DFqA是差分时域分析DPA攻击的一种改进方法.根据频域信号的这一特性,本文针对一种防护DPA的DES算法,使用DFqA方法,实验验证了DFqA方法较之DPA方法的独特之处.由于DFqA方法需要将全部运行算法部分的信号进行分析,会引入更多的噪声,在实际攻击中,较之DPA方法,需要更多曲线条数才能攻击成功.信噪比降低,随之而来的是攻击效率较低.对于DFqA方法的信噪比提升的研究文献较少.2011年,Hodgers等人[16]针对随机抖动防护措施的AES使用了滑动窗的信号处理方法,该方法与差分频域分析方法结合,可成功获取AES密钥.此外,国内外文献研究中,并没有针对实际的功耗干扰的防护措施进行攻击分析.而本文,考虑到实际应用,在防护措施中加入功耗干扰措施,并展开攻击分析.本文设计了一种防护常规DPA的DES算法,使用DPA攻击不能获取密钥,而使用DFqA方法,可以获得DES密钥.针对DFqA攻击中的信噪比问题,提出一种采用重采样DFqA攻击方法,该方法可以将攻击成功所需的曲线条数减少至未使用重采样DFqA攻击方法的47%.缩短攻击时间,将攻击效率提高一倍.本文第2节为差分频域分析方法的背景介绍;第3节为基于重采样的差分频域攻击方法描述;第4节为设计实验实例、实验结果分析;第5节为相关工作介绍;第6节为本文总结和工作展望.2背景介绍2.1DES算法DES算法是美国IBM公司于1977年提出的一种分组对称数据加密算法.DES的整个体制是公开的,系统的安全性全靠密钥的保密.DES将64位明文依次进行初始置换、16轮迭代变换和逆变换后,生成64位密文.DES采用Feistel结构,共有16个迭代周期,DES算法的框架如图1所示.本文的贡献在于:(1)提出一种基于重采样的差分频域分析方法.该方法对差分频域分析的信号处理技术提供应用指导.(2)通过实验验证了基于重采样的信号处理方法,可提高信噪比,提高差分频域分析方法的攻击效率.将攻击时间缩短了一倍.(3)通过实验验证传统抵御DPA的防护措施,可以被差分频域分析方法攻击成功,已经不再有效.也即考虑安全措施时,仅考虑抵御DPA防护,已不再安全.(4)本文的防护措施中包含了功耗干扰,较之以前的仅从算法上实现防护措施来研究和分析安全攻击方法,此方法更贴近实际应用场景,为实际应用提供了参考.Page3本文的算法防护措施实现以及实际攻击算法对象,使用DES算法.2.2差分功耗分析侧信道攻击方法中DPA方法的目标是记录密码设备对大量不同数据分组进行加密或解密操作时的能量曲线,并基于能量曲线恢复出密码设备中的密钥.DPA攻击方法的基本攻击策略步骤如下[17].步骤1.选择所执行算法的某个中间值.这个中间值必须为一个函数f(d,k),其中d是已知的数据,如明文或者密文,k为密钥的一小部分;步骤2.测量能量消耗.即测量攻击对象在加密或者解密不同数据时的能量消耗,共D条曲线,能量曲线可记为矩阵犜;步骤3.计算假设中间值.计算不同数据的中间值,将假设值记为犽=(k1,…,kk),其中K为犽的所有可能值,得到矩阵犞{vi,j=f(di,kj)|i=1,…,D,j=1,…,K};步骤4.将中间值映射为能量消耗值.将假设中间值矩阵犞映射为假设能量消耗值矩阵犎;步骤5.比较假设能量消耗值和能量曲线.将每一个密钥假设对应的假设能量消耗值矩阵犎与在每一个位置所记录的能量曲线矩阵犜比较,得到矩阵犚,犚中值大的即为匹配度高的,即认定为密钥假设正确.本文的DFqA攻击方法是基于DPA攻击方法的一种改进的攻击方法.3基于重采样的差分频域攻击方法3.1功率谱Aigner等人在文献[11]中指出在密码旁路分析中的时域信号差异,在频域中同样会体现出来.基于此项研究,侧信道攻击方法面对的对象可以是时域信号,同时也可以是频域信号.若算法防护中加入了随机延时运行等防护措施,采集的时域信号中相同操作时间点不固定,会导致关键运算在时域上不能对齐,此时DPA失效.将采集到的时域信号去除时间特性的方法之一是进行傅立叶变换,将时域信号变换到频域上来,消除了时间参数.由快速傅里叶变换(FastFourierTransform,FFT)将采集到的时域信号变换到频域上,公式如式(1)所示:将有限的时间信号通过傅立叶变换,转换到频域上,这个过程是符合能量守恒的.同时,时域信号进行傅立叶变换后的数据相关性仍然保存.由于时域信号中所关心的操作,在时间上是不固定的.由离散傅里叶变换的时移特性,当信号在时域上有时移时,体现在频点上为相位差异,如式(2)所示:上式中,当在时域上延时间轴时移-m,进行傅立叶变换之后等效于其乘以相移因子犠mk,也即信号在时域上移动,其幅度谱不变,而相位谱产生了变换.对于我们所关心的算法关键步骤的随机延时运行的信息时域信息,经傅立叶变换后,去除了时域信号的时间不对齐,同时引入了关心频域点的相位差异.我们进行攻击的过程并不关心相位信息,可以利用功率谱密度,将傅立叶变换后的序列去除相位信息,得到对应频率的能量.功率谱密度公式,如式(3)所示:P(ω)为功率谱密度,表示单位频带内信号功率随频率的变换情况,反映了信号在频域上的能量分布.这样,既去除了时域信号中DES关键操作的时间随机,又去除了傅立叶变换后频域上的相位差异.获取功率谱分布,需要将算法运行全过程的功耗信号进行FFT和功率谱密度函数计算,因此算法运行频率点的能量值会带入整段曲线此频率点的运行噪声.3.2重采样处理采集的时域信号中会带入噪声信号,由于对于侧信道攻击的对象,提高其信噪比,会减少攻击所需的曲线条数[17].同时,由于功率谱中每个频点所对应的幅值要包含整个算法运行功耗的频点信息.因Page4此,其引入的噪声要远多于时域信号,更需要降低噪声,提高信噪比.对于采集的信号一般由以下部分组成:式(4)中,犛noise为噪声,犛el.signal为芯片运行功耗中与算法关键信号无关的部分,犛exp.signal为芯片运行功耗中的算法关键信号.对于安全攻击而言,信噪比公式如式(5)所示:为了提高攻击信号的信噪比,需要降低犛noise和犛el.signal信号.犛el.signal信号是运算中不可去除的,而犛noise信号为芯片运算时的噪声.芯片在运行过程中,噪声部分主要来源如下:(1)芯片物理特性的固有噪声,如热噪声、散粒噪声、闪烁噪声、猝发噪声等[18];(2)采集信号,从模拟到数字过程的量化误差引起的噪声[19];(3)测量中引入的外部环境噪声.以上噪声信号的频率不是在芯片的工作频率上产生.同时,芯片工作时,当芯片内部时钟的时钟沿到来时,电路翻转[17].因此,其主要的翻转功耗集中在时钟沿到来时刻.基于信号与噪声的频率不一致的情况,考虑使用基于芯片工作频率来压缩和提取信号.将时钟沿处的信号提取出来,同时减小犛noise信号,将会大大改善信号的信噪比.基于以上分析,基于算法运行的工作频率作为重采样频率,可实现这一设想.重采样处理的算法流程图,如图2所示.噪声水平,提高信噪比.3.3重采样差分频域分析方法策略步骤如下:的工作频率进行重采样;由以上分析,给出DFqA攻击方法的基本攻击步骤1.将算法运行消耗的时域信号,使用芯片步骤2.将重采样后的时域信号,进行FFT变步骤3.将功率谱值作为攻击对象,使用DPA给出基于重采样的差分频域分析方法的流程使用芯片的工作频率进行重采样,可有效降低换,并得到功率谱值;方法实施攻击.图,如图3所示.时域信号,使用芯片的工作频率进行重采样,去除了部分噪声信号,提高信噪比.得到重采样后的时域信号后,再进行FFT以及功率谱密度计算.选择工作频率对应的能量值,分别与猜测的0~255的轮密钥所对应的中间值进行差分分析,选取其中峰值最高的猜测轮密钥.使用一组明文和密文,通过遍历256次,验证该轮密钥的猜测是否正确.若不正确,再选择功率谱密度的下一个频率点对应的能量值进行计算,直到计算完所有频率点;若正确,则输出正确密钥.下面,我们将设计一种可以抵御DPA攻击的Page5并在硬件上实现该安全算法.DES防护设计,分别使用DPA方法和DFqA方法进行攻击.对DFqA方法的信号预处理,使用重采样与未使用重采样,来对比两种信号处理方式影响攻击效率的情况.4攻击实验4.1问题为了实验验证针对DPA方法的防护措施,对防DPA有效,而差分频域分析方法可以将该防护措施攻击成功.同时,在同样本下,本文提出的基于重采样的差分频域分析方法与未采用重采样的差分频域分析方法的攻击结果对比.因此,本文需要完成以下几个工作:(1)设计防DPA攻击的带防护DES安全算法,(2)整个功耗信号采集系统的搭建工作.(3)功耗曲线采集过程中,为了提高功耗信号的质量,需要加入硬件低通滤波器.(4)重采样算法的合理实现,也会对最终的信号处理产生较大的影响.以上几个工作中,防护措施的实现以及采集系统的搭建为本次实验的难点,重采样算法的合理实现为本实验的难点和关键.4.2实验设置4.2.1DES安全算法实现由文献[5-6]的防DPA方法,本实验选择了相似的一种防护DPA攻击的防护措施.为了避免DES算法运行时,在时间上可以精确对齐,我们采用随机数来控制DES算法运算的随机启动.这种防护措施可以使得DES算法的关键运算在时间上不固定,不能在时域上进行对齐,从而达到不能直接攻击的目的.同时,为了掩盖DES真实运算功耗特征与随机延时的功耗特征差异,避免可以通过对DES信号特征进行对齐,从而通过对齐曲线还可以使用DPA方法进行攻击成功.本文的防护措施中的一项为功耗隐藏,即在整个运行过程中加入CPU操作功耗,对DES运算功耗进行掩盖.固定DES整个运行时间为128周期,前后两段随机延时的周期固定为112周期.随机运行DES操作的防护措施示意图,如图4所示.带防护措施的DES设计代码,如图5所示.t=GerRrnd();t=t%112;InitDes();mencpy(DestAddr,SrcAddr,t);//开启功耗扰动StartDes();mencpy(DestAddr,SrcAddr,128-t);//开启功耗扰动getDesRes();使用SASEBO-GII算法设计仿真板,其为算法FPGA(CryptographicFPGA).在FPGA上实现上述带安全的DES算法设计.该防护措施主要为两项:一为随机运行DES算法,二为在整个运行过程中加入随机CPU噪声.SASEBO仿真板自带晶振是24MHz,工程中CPU和DES运行频率均为12MHz.SASEBO仿真板的实物图,如图6所示.4.2.2实验平台集部分、信号处理部分、安全攻击部分.整个实验平台分为三个大部分,分别为功耗采安全攻击部分主要为PC机安全攻击软件.将功耗采集部分,由SASEBO仿真板、示波器、读卡器、PC机、稳压电源等组成.将加入防护DPA攻击的DES安全算法下载至SASEBO仿真板上.运行DES安全算法,在FPGA内核电压上串接了1欧姆电阻,通过测量电阻上的电压变化,可获得功耗信号.DES的运行具体位置,由SASEBO板来引出内部运算指示信号,定位功耗曲线上包含防护措施的整个DES运算位置.信号处理部分由硬件滤波和PC机软件处理软件组成.测量得到DES功耗信息后,保存在PC机上,由软件实现重采样信号处理和FFT变换后的频谱能量值.Page6信号处理之后的能量信息,用于安全攻击,得到最终攻击结果.整个实验平台连接示意图,如图7所示,电脑通过USB接口控制Gemalto的PCSC读卡器,PCSC读卡器通过7816转接口与SASEBO仿真板通信.SASEBO仿真板上消耗的电流信号通过示波器采集后通过UTP网络连接传送至电脑.SASEBO仿真板使用直流电流源供电.4.2.3DES的DFqA方法实现在对DES算法的DPA分析中,需要确定和计算出一个和密钥相关的中间数据,用以与频谱幅值进行相关性计算.图8给出了DES的运算图和可以利用的数据点.图8中,(L0,R0)组成了DES算法64bit明文输入,按照DES算法流程分别进行E扩张、与轮密钥K进行异或操作、S-box操作、P置换、与L0进行异或操作,之后输出第1轮的轮输出(L1,R1),以上完成了DES第1轮运算.图8中,标示出了两个输入数据点(I1,I2),两个输出数据点(O1,O2).实际攻击中,常用的6个攻击位置点分别如表1所示.序号12S盒输出与轮输入的异或O1I13S盒输出与S盒输入的异或O1I2456轮输出与S盒输入的异或O2I2根据文献[17]描述,使用汉明重的功耗模型对寄存器翻转的效果明显.因此,本次实验选择轮输出数据O2和轮输入数据I1的异或作为攻击中间值,功耗模型选择汉明重模型.部分攻击程序如图9所示.IndexOfTrace=0Input(CountOfTrace)Do{Input(Plain,Crypto,P)byIndexOfTraceIP_OUT=PermuteIP(Plain)R=LOW32Bit(IP_OUT)//低32bit数据L=HIGH32Bit(IP_OUT)//高32bit数据E_OUT=PermuteE(R)//初始置换FORi=0TO64STEP1{SBOXIN=GessKey(i)E_OUTSBOXOUT=DesSBox(SBOXIN)SBOXOUT=SBOXOUTInversePermuteP(L)hammingWeights[i]=CalculateHammingWeight(SBOXOUT)//计算猜测密钥的中间值汉明重}Keys=CalculateCorrlation(hammingWeights,P)//猜测中间值与频域值计算相关性FindKey=VerifyKeys(Plain,Crypto,Keys)//使用明密文数据验证猜测密钥是否正确IFFindKeyTHENDoOutput(Keys)IndexOfTrace=IndexOfTrace+1}Util(IndexOfTrace>=CountOfTraceORFindKey)4.3攻击实验4.3.1功耗数据采集使用搭建的实验平台,运行DES算法,采集整个DES算法的功耗.DES算法包含两个防护措施,采集大量曲线条数.给出其中一条整体的DES功耗曲线,如图10所示.图10中,黑框部分为带安全防护的整个DES运行过程的功耗特征,其由随机等待和DES运行两部分组成,整个DES运行过程中均有功耗干扰操作.从上图中,不能确定DES算法运行特征,并在时Page7图10原始采集信号间上不对齐,因此不能使用特征对齐的方式来进行信号预处理再进行DPA攻击.因而,该DES防护措施,在时域上不能进行攻击的情况下,该防护措施可使用差分频域攻击方法来开展攻击.4.3.2曲线预处理(1)重采样处理采集的时域信号噪声较多,使用DES的工作频图11重采样后信号图12重采样后功率谱图图13原始信号的功率谱图率12MHz作为重采样频率,应用重采样处理,得到重采样后的信号,如图11所示.重采样后的信号,噪声减少.对重采样后的时域信号,使用FFT变换,得到功率谱分布,如图12所示.(2)未进行重采样处理对采集的原始信号,不经过重采样处理,直接FFT变换后得到功率谱密度,如图13所示.Page8使用重采样后的功率谱和未进行重采样的功率谱分别进行攻击实例.4.4实验结果与分析4.4.1DPA和DFqA攻击结果使用DPA和DFqA两种方法,对DES随机延时运行和功耗干扰的防护措施进行攻击.对原始信号进行DPA攻击,再对原始信号的频率能量信号进行DFqA攻击,攻击结果如表2所示.序号攻击方法12DFqA353万条曲线攻击出密钥由表2,使用488万条曲线,DPA攻击未能获取DES密钥,而DFqA攻击在353万条曲线时,就成功获取了DES密钥.将功耗曲线与第1轮可能的64个子密钥进行相关性计算,得到攻击的功耗曲线与子密钥的相关性图,如图14所示.如图14,(a)图中使用DPA方法攻击488万条曲线,第1轮所有子密钥无任何明显高相关性曲线出现;(b)图中使用DFqA方法攻击353万条曲线后,第1轮正确密钥呈现出高相关性.DPA方法未能获取正确密钥,DFqA方法可获取正确密钥.4.4.2不同信号处理的DFqA攻击结果为了对比重采样处理的效果,我们分别使用重采样处理以及原始信号的功率谱进行攻击验证.应用差分频率分析算法流程进行攻击分析.使用DFqA攻击分别对两种功率谱密度曲线进行安全攻击,攻击结果如表3所示.序号处理过程获得密码所需曲线条数(万条)1重采样,FFT,功率谱密度166万条攻击出密钥2FFT,功率谱密度353万条攻击出密钥由表3,对原始信号以及重采样处理后的信号进行FFT变换后得到的两个功率谱分布信号,使用DFqA方法,均可以攻击出正确密钥.使用重采样处理,攻击所需曲线减少到未使用重采样处理的曲线条数的一半.从图14中的计算相关性曲线可看出,在166万条曲线后,正确的第1轮子密钥的相关性要高于其他子密钥,重采样的DFqA攻击方法使用166万条曲线即可攻击出密钥.其中,图(c)给出了重采样的DFqA攻击的相关性曲线.Hodgers等人[16]针对随机抖动防护措施的AES使用了滑动窗的信号处理方法来提高信噪比,其仅对比了未对齐情况下普通DPA不能攻击成功,而滑动窗处理后的DFqA可以攻击成功,却没有进行滑动窗处理前后DFqA攻击情况的分析.本文将两种情况均作了对比试验,试验结果表明DES算法在带有随机延时和功耗干扰的防护措施下,普通DPA不能攻击成功,而DFqA使用353万条曲线,可以攻击出DES密钥.进一步采用基于重采样的DFqA使用166万条曲线就能攻击出DES密钥.从攻击所需曲线条数和相关性系数比较,可确定Page9重采样处理大大提高了信噪比,降低了攻击所需的曲线条数,在实际攻击中,将攻击效率提高了一倍.5相关工作随着金融智能卡、社保卡等高安全芯片的应用,对智能卡的信息安全要求越来越高.各种智能卡芯片要求达到相应的安全级别,安全攻击则是检验安全性的重要手段.相应的侧信道的安全攻击方法研究和应用越来越多.侧信道的安全攻击方法种类繁多.从1996年Kocher等人[1]首次提出简单功耗分析方法之后,又提出了差分功耗分析方法.2002年的CHES会议上,Chari等人[6,17]提出了模板攻击方法,该方法是最强大侧信道攻击方法.在2005年的CHES会议上,Gebotys等人[12]针对电磁信号验证了频域分析方法,之后DFqA方法研究越来越多[13-16].除了针对功耗信号之外,还有对电磁信号、射频信号的分析.目前,这些流行的攻击方法也是安全性检测机构常用的检测攻击方法.在实际安全攻击中,对攻击的信号对象进行预处理的过程,用以提高信号的信噪比,也逐渐被大家关注.随之而来,一些学者开始研究侧信道安全攻击中的信号处理技术.VanWoudenberg等人[20]研究了动态时间弯曲算法,将其应用在了信号对齐上,以提高信号的精确对齐从而提高DPA攻击效率.Le等人[21]将四阶累计的统计方法应用到了信号处理中,提高了信号信噪比.Archambeau等人[22]研究了独立成分分析的统计方法,并将其应用到了模板攻击中,在不降低信息量的情况下,降低攻击样本.这些信号处理方法,可以提高攻击信号的信噪比,提高攻击效率,甚至是攻击成功率.因此,在安全攻击中,攻击对象的信号预处理显得格外重要.DFqA方法较之DPA攻击方法,要带入更多的噪声.在DFqA方法的使用中,对信号的处理也就非常重要.然而,对于DFqA方法的信号信噪比提升的研究文献较少.2011年,Hodgers等人[16]针对随机抖动防护措施的AES使用了滑动窗的信号处理方法,该方法与差分频域分析方法结合,可成功获取AES密钥.但是该方法实现的AES算法,仍可以通过对齐功耗特征,使用DPA方法获取正确密钥.在现有文献中,并没有对DES随机延时运行和功耗干扰两项防护措施的攻击研究,而本文就此进行了攻击研究和攻击实施.6结论本文在现有差分频域分析方法上,提出了一种基于重采样的差分频域分析方法.此方法的主要特点是采用重采样的信号预处理技术提高信噪比,解决差分频域分析方法引起的噪声问题,将攻击效率提高一倍.在FPGA上实现了防御DPA攻击的随机延时运行以及功耗干扰的DES算法.在时域上不能确定DES关键运算运行位置,而且其运行时刻是不断改变的,在DPA不能实施攻击的情况下,使用差分频域分析攻击方法,可以成功获取DES密钥.同时,实验证明,对采集的时域信号进行重采样处理,可以非常有效地提高信号的信噪比,降低攻击所需的曲线数量,将整个安全攻击的效率提高一倍.针对DES随机延时运行防护措施,本文提出的重采样频域攻击方法攻击效率更高.本文的攻击研究,在设计安全防护措施时,不仅要考虑在时域上防护DPA,同时还要考虑在频域上防护DFqA.频域上防护DFqA,可以增加更多噪声或者随机芯片工作频率等措施.致谢审稿专家和编辑为本文提出了宝贵的意见和建议,作者在此表示衷心感谢!
