Page1网络流量异常检测中分类器的提取与训练方法研究郑黎明1)邹鹏1),2)贾焰1)韩伟红1)1)(国防科学技术大学计算机学院长沙410073)2)(装备指挥技术学院北京100029)摘要随着网络安全领域研究的不断深入,研究者提出了各种类型的流量异常检测方法,基于分类的方法是其中很重要的一类.但是因为网络环境的多样性和动态变化性,在训练数据集上具有很高精度的检测系统实际部署时可能出现大量的误报.文中针对训练模型难于获取以及部署环境的动态变化性问题,对分类器的选择、使用和训练方法进行了研究.首先把网络流量数据投影到不同维度的Hash直方图上构建检测向量,在检测向量的基础上对比了各类分类器,选用能够处理高维数据、泛化能力强的SVDD进行异常检测;采用增减式在线训练算法对分类器进行不断训练,提高异常检测系统的精度并减少训练成本;最后采用多步关联检测算法优化检测精度,并在新增样本中剔除明显的异常样本,减少训练成本提高分类精度.通过大量的真实网络流量数据验证了上述方法具有较高的检准率和较低的误报率,并能够有效减少训练成本.关键词流量异常检测;直方图;支持向量数据描述;在线学习;关联1引言随着网络规模的不断扩大以及各类网络应用的持续深化,互联网已经成为人类生产生活不可或缺的基础设施.但与此同时,各类网络攻击日益猖獗,严重威胁着互联网的安全,如计算机病毒、蠕虫、分布式拒绝服务等.异常检测作为一种行之有效的网络防护手段且能够检测未知攻击,日益被广大学者和业界人士所重视.国内外研究者通过不断探索提出了多种类型的异常检测方法[1],如基于统计理论的方法、基于数据挖掘的方法、基于机器学习的方法以及各类混合方法.随着各种机器学习理论被广泛应用于异常检测,异常检测系统已经能够检测更加隐蔽的攻击,而分类方法是其中很重要的一类.但是(1)为了让异常检测系统达到较好的检测精度,通常需要大量的训练样本,但采集和标识训练数据工作量很大;(2)在流量异常检测应用中,对于如何构建检测向量(分类向量),如何选择分类器对检测效果有很大的影响,但往往被研究者忽视;(3)网络环境是动态变化的,随着时间的推进,训练好的分类器分类效果可能逐渐变差[2],通常可以采用重新训练的方式解决,但重新训练分类器的成本是昂贵的.现有的异常检测系统通常基于机器学习的方法构建,首先在网络中采集并标识异常样本,然后用这些异常样本对异常检测系统进行训练,最后使用训练过的系统进行异常检测[1].但是,网络是一个实时动态环境,异常流量和正常流量同时存在,即使标识为异常的样本也是正常流量和异常流量混合导致的结果,很难精确给出判断[3].随着网络技术的不断发展,网络中的流量数据成指数增长,新的异常情况不断涌现,我们无法标识所有的异常情况.另外对异常的标识也可能出现错误,而标识的异常样本对异常检测系统的精度具有决定性的影响.同时机器学习本身存在“欠学习”和“过学习”等问题,都可能导致对未知异常检测能力差,误报率高.综上,在分类器的选择过程中必须选用非监督式的分类器,从海量的未标识数据中学习正常模式,用于异常检测.分类的方法被广泛应用于异常检测领域,但是网络流量异常检测有其自身的特点.流量数据具有多个不同的维度,异常流量对各个维度造成的影响不尽相同,在各个维度上聚集的层次不同这种影响也不尽相同[4].总的来说基于分类的检测方法主要有4步,检测向量的构建、选择合适的变换把检测向量映射到度量空间、训练分类器和最后采用分类器进行异常检测.在检测向量的构建上通常可以采用MIB流量统计信息、各维度上的熵值[4-5]、概要数据结构[6]等方法.但是MIB流量统计信息只刻画了流量大小,无法对更加隐蔽的攻击进行检测;各维度上的熵值也只刻画了网络整体流量的分布情况,文献[7]更是提出基于熵的异常检测方法存在诸多弊端;概要数据是在内存中维护一个远小于原始数据规模的数据结构,以较高的抽象程度反映原始数据的高层特性,在任何时刻都可以通过概要数据结构得到满足一定精度要求的查询结果.直方图、抽样、小波、Hash函数等都是构造概要数据结构的常用方法,但是抽样会影响检测精度,小波变换计算量偏大,直方图可能面临攻击时相异数据项急剧增大,导致系统溢出的问题.本文采用Hash函数构建直方图,每个直方图对应一个检测向量,能够有效提高检测精度并规避其它方法存在的缺陷.虽然大量的研究者对网络流量异常检测进行了广泛的研究,提出了各种类型的异常检测系统,但对异常检测系统训练过程的研究相对较少.通常都是一次训练后就开始部署,以后都采用该训练器进行检测.但是在动态复杂的网络环境下,这样可能导致异常检测系统的精度越来越差.首先,网络流量随着时间不断变化,异常检测系统本身的分类器也应该随着输入(环境)实时动态调整[8];然后,异常对网络产生的影响是多方面的,依赖于网络本身的状态,异常对网络造成的影响也随着环境不同而不同[9].已有基于机器学习的异常检测系统通常是通过分析已有的训练样本获取流量模型,当网络流量偏离模型较远时则认为出现了异常,通过上述分析可知正常Page3的网络模型随着部署的地点和时间不断“飘移”[10],所以需要研究在线学习异常检测方法,按照环境的变化不断对分类器进行在线训练,提高检测精度.本文首先把网络流量数据投影到不同维度的Hash直方图上,在网络流量Hash直方图上采用非监督式的SVDD(支持向量数据描述)进行异常检测;针对正常的网络模型随着部署地点和时间不断变化的特征,采用增减式在线学习的方法对该系统中分类模型进行不断训练,提高异常检测系统的精度,减少训练成本;最后针对异常检测量存在的时间相关性和异常样本严重影响检测精度的问题,提出了检测精度优化和样本选择算法.本文的主要创新点与贡献有:(1)针对基于分类的流量异常检测方法中,训练数据难于获取、在分类器的选用方面研究不足,通过对比研究,提出了在Hash直方图上选用SVDD对流量异常进行检测的方法,能够有效提高检测精度并避免了已有方法的缺陷.(2)针对异常检测系统分类器随着部署地点和时间不断变化的特征,且已有在线训练方法时间和空间复杂度高,提出基于增减式在线SVDD训练方法.(3)针对检测统计量时间相关性、异常样本对精度影响的分析基础上,提出了检测精度优化和新增训练样本选择算法.2相关研究为了提高异常检测系统的检测精度,特别是提高对隐蔽攻击的检测能力,研究者提出了大量的异常检测方法,如基于熵的方法[11]、基于PCA的方法[12]和基于概要数据结构的方法[13]等,但是文献[7]指出基于熵的方法存在严重的不足,文献[14]指出基于PCA的方法容易被攻击者攻陷,概要数据结构能够在保证数据特征的基础上有效降低计算和空间复杂度,可以在概要数据结构上构建更加精细的异常检测算法[15],但也存在训练数据难获取,且容易出现训练不足或过拟合等问题.同时大量研究者提出采用一类分类方法或离群点检测技术进行异常检测,但是只有很少的分类方法能够处理高维数据或大数据集,一类支持向量机因具有很好的泛化能力且能够处理高维数据而得到了广泛的应用[3].网络是一个动态复杂的环境,其正常流量随着部署的环境和时间动态变化,异常情况更是层出不穷.由大数定量可知,仅当存在完备的训练数据集时,经验风险才会逐渐收敛于期望风险,但现实的网络环境下,几乎不可能定义完备的训练数据集.为了解决上述问题,在线增减式学习思想被引入到异常检测领域,使得异常检测系统能够在应用过程中随着样本集的积累,不断提高分类器的精度.文献[2]提出了一种高效的增量式SVM训练算法,设计了高效的数据结构和逆矩阵计算方法.Bordes等人[16]提出了快速主动式在线训练方法,它对不同的点采用不同的处理方法,来有效降低训练的复杂度.Galmeanu等人[17]分析了增减式SVM训练方法实现中存在的问题.Karasuyama等人[18]提出了增减多个样本的增减式在线训练方法;Nguyen等人[19]提出了一种综合集成方法有选择的增加样本,从而减少训练的时间和空间复杂度.上述研究的基本思想都是随着新样本点的加入,根据KKT条件动态调整各个支持向量的系数,采用迭代算法求解新的支持向量,但大部分都是针对标准的二类分类问题.在实验过程中发现,网络流量异常检测问题有其自身特点,并不是每个样本点都需要考虑是否加入到新的训练集合中.本文在以上观察的基础上,把标准的SVM增量训练方法扩展到SVDD,并提出了基于TRW(ThresholdRandomWalk)的多窗口关联检测与样本优化选择算法.3分类器的选择与使用3.1检测向量的构建流量数据直方图是流量数据在某个维度上分布情况的近似,其中流量数据可能是流的数目、IP包数目或者是总的比特数,维度可以是源/目IP、源/目端口、TCP标识位、协议号、IP包的长度或流持续时间等.本文在实验过程中只记录IP包数目,维度采用了源/目IP、源/目端口4个维度.在直方图上采用分类的方法原则上还是通过度量分布特征的差异来检测异常,只是比熵提高了更加细粒度的信息.为了克服文献[7]中所述的缺点,本文提出在Hash函数的基础上构建Hash直方图,在Hash直方图的基础上进行异常检测.Hash直方图的数据结构如图1所示,在每个维度对应一个Hash函数和一个数组,通过Hash函数把流量数据投影到数组中,数组中每位对应一个计数器(Hash桶),记录投影到该位置的流量数据.为了保证维度上所有可能取值均匀分布在Hash直方图的映射空间,采用通用Hash函数[20]构建Hash直方图.Page4初始状态时,直方图中每个Hash桶初始值为0,在每个时间周期内,用每个新到达的数据项更新直方图数据结构,具体过程如下:1.当一个数据项(〈SIPi,DIPi,Sporti,Dporti〉,ui)到达时,首先投影到各个不同维度,在各个维度上计算Hash函数值,得到对应的Hash桶位置,hashk(featurei,k)∈{1,…,Mk},k∈{1,…,hd}.2.对每个hashk(featurei,k)标识的计数器统计值进行更新,即T[k][hashk(featurei,k)]+=ui,其中k∈{1,…,hd}.3.当每个时间窗口结束时,把每个维度的Hash直方图中的值构成一个检测向量犮=[c1,c2,…,ck],转检测流程.3.2分类器的选择在机器学习领域,研究者提出了大量一类分类方法,如k-Means、KNN(k-NearestNeighbor)、GMM(GaussianMixtureModels)和SVDD[21].其中k-Means是一种基于样本相识性度量的间接分类方法,通常采用“距离”来度量点与点之间的相识性,但某一种距离通常只能区别某些类型的异常,而对其它类异常无能为力,可能导致在训练数据集上效果很好的分类器实际分类效果并不理想,即分类器的泛化能力较差.KNN方法存在两方面不足:一是当样本不平衡时,如异常检测中正常样本占绝大多数,异常样本很少,当输入一个新样本时,该样本的k个邻居中大容量的样本可能占多数,导致判断错误;另一方面是对每个待分类的样本都要计算它到全体已知样本的距离,计算量过大.GMM假设数据服从高斯分布,在高维情况下训练的时间和空间复杂度很高,需要大量的训练数据才能获得较好的分类器,如实验过程中对IP维度进行分类检测时,投影到1024维的Hash直方图中,需要十万个训练样本才能获得较理想的分类效果.非监督SVM又叫SVDD,它建立在统计学习理论基础之上,在有限训练样本下能够获得较好的分类器,既有严格的理论基础又能较好地解决小样本、非线性、高维数和局部极小点等实际问题.它通过计算最优分类超平面,要求分类超平面不但能将两类无错误地分开,还能使两类间隔最大,从而保证经验风险最小化的同时使得分类器的泛化能力达到最优.它在特征空间中建立一个体积尽量小且包含尽量多训练样本点的超球面[21].给定训练数据集,其中包含l个独立同分布的样本点,数据集中不含任何分类信息,xi∈Rn,i={1,2,…,l},i是训练数据集中的数据点标号,Rn是输入空间,n是输入空间的维度.映射函数(·):Rn→H将输入空间映射到高维特征空间,在特征空间H内,建立一个体积尽可能小且包含尽可能多训练样本点的超球面,在超球面外的样本被识别为异常点.设α和R分别为超球面的球心和半径,则该问题可描述为求解以下二次规划问题:其中‖(xi)-α‖2R2+ξi,ξi0,i=1,2,…,l.式中ξi是松弛变量,主要是为了处理训练数据集中可能出现的异常样本点.加入松弛变量后,所有的训练样本距离中心点不需要严格限制在R之内,但这样的情况要受到相应的惩罚.C是惩罚因子,取值需要在经验误差和泛化能力之间折中,它是训练误差和分类器复杂度的控制参数.对上面的二次规划问题,可以采用Lagrange乘子法进行求解,引入Lagrange乘子把问题转化为它的对偶问题,同时可以将高维空间优化中的内积运算采用满足mercer条件的核函数代替,再利用极值条件可以求得L=∑li=1其中∑l系列αi值,且a=∑l是核函数,研究者已经提出了多种核函数,如线性核、多项式核、RBF(径向基)核、Sigmoid核,本文实验过程中选用使用最广泛的RBF核函数,它的适用范围广,有较宽的收敛域,是较为理想的分类依据函数.其中σ为核函数的参数,它主要影响样本数据在高维特征空间H中分布的复杂程度.如果xi满足‖(xi)-α‖2<R2+ξi约束条件,对应的Lagrange乘子αi=0;如果xi满足‖(xi)-α‖2=R2+ξi约束条件,对应的LagrangePage5乘子0<αi<C;如果xi不满足约束式,αi=C.一般情况下,大多数系数αi等于零,对分类器并不产生影响,而对分类起作用的仅仅是那些取非零值的αi所对应的xi,这些xi就是SV(SupportVector,支持向量).SV集合充分描述了整个训练数据集的数据特征,对SV集合的划分等价于对训练数据集的划分,在大多数情况下,SV只是训练数据集中很少的一部分.4增减式在线训练算法已有的SVM在线训练算法通常是在每个时间间隔后加入当前间隔的检测向量,同时删除最早的检测向量,对分类器进行重新训练.但是网络流量通常是平稳的,对应的分类模型也是平稳的,在绝大部分情况下不需要重新训练分类器.本文首先采用自适应的在线训练方法,过程如图2所示,具体的算法如算法1所示.在每个时间间隔内,构建检测向量V,当检测到异常时(其中黑色点表示异常点),则需要对分类器进行重新训练.在训练的过程中加入新增加的n个样本点,同时删除最早的n个样本点,然后重新训练.图2自适应在线训练算法(黑色点代表异常点)算法1.AdaptiveAnomalyDetection.WhenVtarrivesComputed(V);if(d(V)>Threshold)Vt是异常点;elseVt是正常点;endifif(Vt是异常点)UpdatingTraining(Vt-m+1,…,Vt);sett←t+n;endifendwhenUpdatingTraining(Vt-m+1,…,Vt)更新训练数据集,把最早的n个点从训练数据集中Retraining(Vt-m+1,…,Vt);return;SVM算法虽然能够把原问题转化为二次规划问题进行求解,但是其训练算法的复杂度太大,假设训练样本数为l,则SVM算法的训练时间复杂度为O(l3),空间复杂度为O(l2).现在通常采用的是优化的SMO算法,它把大规模的二次规划问题转化为小规模的二次规划问题,在对精度影响不大的前提下提高训练速度,但是在高维情况下还是无法达到在线训练的性能要求.流量异常检测中需要快速在线SVM训练算法,但它亦有自身的特点:(1)对每个新增样本并不需要同等对待,大部分样本不可能成为支撑向量;(2)结合后续多窗口关联检测算法,每次无法直接区分正常或异常的样本,即位于超平面边缘的点,极有可能成为支撑向量,需要加入到训练集中重新训练分类器;(3)结合多窗口关联检测算法,每次重新训练时需要加入多个样本,需要支持多样本点加入和删除的增减式训练算法.基于上述分析,本文采用文献[18]所述方法,把SVM训练问题转化为多参数规划问题,从而能够一次增加和删除多个样本点,有效减少训练时间.5检测精度优化与样本选择算法上述增减式在线学习算法在每次循环时,如果出现了异常,则需要将样本点加入到训练集中进行重新训练.已有研究发现,如果能够去除训练数据中的异常样本将有效提高分类器的精度[22],可采用投票的方式来剔除异常样本.此外,异常检测统计量本身存在时间和空间相关性[23],本文提出利用检测统计量的时间相关性可以有效提高异常检测的精度.基于上述分析,提出基于TRW的多步关联检测和样本选择算法,累计多个时间窗口内的检测结果提高异常检测系统的精度,并改进自适应在线学习算法中对新增样本点的筛选处理过程.TRW(ThresholdRandomWalk)又叫作连续假设检验,目的是通过观测获得的多个连续事件来计算异常出现的概率[24-25].假设有一组观测值Y1,Y2,…,Yt,则可以采用多步关联检测算法综合多个时间窗口的值进行异常判断,定义似然比Λt为Λt=lnf(Yi,…,Yt|H1)用检准率PD和误报率PF度量检测精度,定义它们的上界α和下界β,即PFα,PDβ,那么按照TRW算法,随着时间窗口的不断推进,如果Λn不断增加并达到阈值B=ln((1-β)/α),那么认为出现Page6了异常,相反,如果Λt不断减少,达到阈值A=ln(β/(1-α)),那么认为是正常情况,如果没有达到任何一个阈值则等待下一时间窗口继续判断.本文为了便于考察多个维度上的结果,定义:在异常检测过程中,当出现的观察值Yt>-1且Yt<0时,很难准确判断是否发生了异常,需要根据多个时间窗口的观测值来增加判断的可信度,并通过计算似然比进行度量.随着时间的推进,如果在观察时间步数内出现了ΛtB,则有很大的概率出现了异常,如果在观察时间步数内达到ΛtA,则认为没有出现异常.详细的算法过程如算法2所示,其中每个观察值Yi取SVDD的判别式,Yi=Computed(V)=(w·(Vi)+b)-ρ;当Yt-1,直接判断出现了异常;当出现的观察值Yt0时,直接判断为正常.按照检测结果,当直接判断为异常样本或直接判断为正常样本时,都不需要进行增减式在线训练,如果是正常样本则已经被已有的最小闭包包含,如果是异常样本则为了提高在线学习的精度需要将其剔除.如果在当前窗口内无法判断,则开始计算似然比并记录计算的时间窗口步数,启动多窗口关联检测流程.在下一时间窗口,如果满足Λt+1B则认为检测到异常,把检测流程中所有窗口内的检测向量加入到训练数据集中,同时删除最早的相同数据样本点,重新训练分类器;如果满足Λt+1A则认为正常,但这些样本点也极有可能再成为支撑向量,所以同样需要加入到训练数据集重新训练;如果在设定的时间窗口步数内,没有达到任何阈值,也认为正常,所有窗口内的检测向量加入到训练数据集中重新训练.算法2.CorrelationAnomalyDetection.WhenVtarrivesComputed(V);if(d(V)<ThresholdA!isUncertainty)elseif(d(V)>ThresholdB!isUncertainty)elseendifendwhenUpdatingTraining(Vt-m+1,…,Vt)更新训练数据集,把最早的n个点从训练数据集中return;6实验与结果分析为了验证本文所提方法的有效性,从两个方面进行实验,一方面是对SVDD+Correlation的检测方法进行精度对比实验,验证它的检测精度优于已有的异常检测方法;一方面是验证通过增减式在线学习方法训练的SVDD分类器具有足够的精度,能够随着流量数据的持续到达不断更新分类器,使分类器能够有效地在“飘移”的流量数据中检测异常,而且相对经典的训练方法在训练时间和训练所需空间上有一定改善.6.1实验数据实验过程中主要采用了两类数据,一类是人工合成数据,一类是真实的骨干网流量数据.人工合成数据是将各类恶意网络流量数据按照一定规则注入到背景流量中,其中背景流量采用WIDE项目组在穿越太平洋的骨干链路上采集到的流量trace数据①,实验中使用的是2009.03.3002~04h的流量(该时间段内流量相对比较平稳),恶意流量数据采用CAIDA组织②发布的Witty蠕虫数据、DDOS2007数据以及Conficker蠕虫数据.Witty蠕虫数据是Witty爆发时通过Telescope采集的蠕虫扫描数据,提取了Witty开始爆发时的16min数据;DDOS2007数据是CAIDA组织采集到的一次大规模ICMP类型DDOS攻击,时间为2007.05.01,实验使用了该攻击爆发时针对目标主机的攻击流量,提取了攻击开始时的10min数据;Conficker蠕虫为典型的隐蔽型蠕虫,它采用休眠等方式有效降低扫①②Page7描速率,试图达到躲避现有检测系统的检测,该数据集也是CAIDA组织通过Telescope采集的扫描流量,提取了2008.11.02日中19时开始的21min数据.各数据集的特征如表1所示.把Witty数据20%注入背景流量、DDOS2007数据2%注入到背景流量、Conficker蠕虫数据30%注入到背景流量作为合成实验数据集,具体的流量曲线如图3所示,分别绘制了正常流量、合成流量以及各恶意流量的曲线图,其中横坐标是时间,按1min的时间窗口进表1数据集统计信息表背景流量MAWIWittyWormCAIDADDOS2007CAIDAConfickerCAIDA6.2实验设计为了验证所提方法具有足够的检测精度,选取了几类典型的异常检测方法:基于EWMA预测模行统计,纵坐标是每分钟IP包的数目.第2部分实验数据采用WIDE项目组分别在2008.03.19、2009.03.30和2010.04.15采集的骨干网流量数据,这3天数据都是在CAIDA组织发起的“ADayinTheLifeofTheInternet”项目指导下采集的流量数据,具有典型的代表性.首先对该数据集中的流量异常进行定位,其流量如图4所示,图中用虚线标示了流量异常段,其中2008.03.19有4个异常段,2009.03.30有3个异常段,2010.04.15无明显异常.型的检测方法、基于熵的检测方法[11]、基于GMM(GaussianMixtureModels)的聚类方法.前两种方法已经广泛应用于实际的异常检测工具中,而GMM是经典的分类方法,且可用于解决一类分类问题.其中EWMA方法α取0.5;GMM方法中异常的比例取数据中被标识异常所在总数据的比例,GMM聚类方法也是在Hash直方图上构建检测向量,再在检测向量的基础上采用GMM聚类方法进行检测;基于熵值的异常检测方法不同维度上的熵值具有不同的检测能力,实验中在源/目IP,源/目端口上分别进行检测,选择具有最佳检测效果的维度作为检测维度.为了突出多窗口关联检测算法的效果,同时直接采用SVDD以及在SVDD结果上加多窗口关联检测算法构成两个方法(SVDD+Correlation).实验首先把上述5个方法分别在上述2个数据集上进行实验,检测时间窗口设置为1min.为了便于对比,基于熵的方法、基于GMM的方法和本文所提方法在Witty数据集上都在源端口维度检测;在DDOS2007数据集上都在目的IP维度上检测;在Conficker数据集上在目的端口维度上检测;在骨干网数据集上在目的端口维度上检测.为了验证本文所提增量式在线学习方法能够在“飘移”的流量数据中有效检测异常,本文在2008.03.19、2009.03.30和2010.4.15日3天采集的骨干网流量数据集上进行对比实验,主要和经典的LibSVM中实现的SMO训练算法[26]进行对比.实验的精度对比部分首先把LibSVM在2008.03.19和2009.03.30数据上进行训练,分别用2009.03.30和2010.4.15数据作为测试集进行实验(RawLibSVM);Page8然后把LibSVM在2008.03.19和2009.03.30数据上进行训练,但在测试时每加入一个点需要在所有已有数据集上重新训练SVDD(IncrementalLibSVM);最后是把2008.03.19和2009.03.30数据作为初始训练数据,采用所提方法进行训练,分别用2009.03.30和2010.4.15数据作为测试集进行实验.实验效率对比部分主要对比IncrementalLibSVM和所提增量学习算法,分别从训练时间、支持向量集大小方面进行比较.结果见图5~图6及本期封三彩图1.6.3检测精度对比实验按照上述设计的实验,检测精度对比实验把上述5个方法分别在2个数据集上进行实验,实验结果如图5和图6所示.图5是5个方法在合成数据集上的检测结果,图6为5个方法在骨干网流量数据集中2008.03.19和2009.03.30上的检测结果.从图5和图6中可看出,本文所提方法在大部分情况下都是所述方法中最优的,基于EWMA预测模型的方法的检测精度最差,基于GMM聚类方法和SVDD聚类方法各有优劣,基于熵的方法在大部分情况下优于GMM和SVDD方法,不过ROC曲线也有交叉,说明它也并不是在所有情况下都优于两类聚类方法.图5(a)是Witty蠕虫数据集上的ROC曲线图,所述方法对攻击开始几分钟检测效果欠佳,但还是优于其它方法;图5(b)是在DDOS2007数据集上的ROC曲线图,图中基于SVDD和GMM方法检测效果较差,通过仔细分析发现是因为在攻击爆发的前2min,DDOS攻击数据包并不多,分布差异没有明显变化,导致基于聚类的GMM和SVDD效果较差,而EWMA效果较好;图5(c)是Conficker蠕虫数据集上的ROC曲线图,由于恶意Page9流量很少,淹没在正常流量中,EWMA方法检测能力很差,但是由于所提方法采用一类聚类方法对流量数据进行描述,能够发现该细小的变化,且采用了多窗口关联综合检测方法,提高了检测精度,达到了较好的检测效果;图6(b)是在2009.03.30数据集上的ROC曲线,由于异常较明显,大部分方法都达到了较好的检测效果.所提方法检测效果较好主要是采用了SVDD以及多窗口关联检测方法.SVDD寻求的是结构分析最小化,具有很好的泛化能力.多窗口关联检测能够累计多个窗口的结果,充分利用了恶意流量在时间上的相关性,有效提高了检测精度.基于熵的方法虽然也具有较高的检测精度,但它的计算和空间复杂度较高,在特殊的维度上可能出现相异数据项剧烈增加.如对Witty蠕虫的检测需要在源IP维度上计算熵值,随着源IP的增加熵值计算时间呈指数增长,无法做到在线实时异常检测.在对GMM和SVDD聚类模型进行训练时发现,在高维情况下GMM要求较多的训练数据和训练时间,如果训练数据较少则严重影响检测精度,但SVDD方法在训练数据较少且高维情况下依然能够获得较好的分类效果.6.4在线训练算法验证实验增减式在线训练算法精度验证实验的精度对比如封三彩图1所示,彩图1(a)是2008.03.19作为训练数据,2009.03.30作为测试数据实验效果图;彩图1(b)是2009.03.30作为训练数据,2010.04.15作为测试数据效果图.图中红色线是RawLibSVM方法在测试数据集上的结果,黑色线是所提方法在测试数据集上的结果,蓝色线是IncrementalLibSVM在测试数据集上的结果.对非监督分类器结果的评价主要考虑两方面,一个是采用尽可能小的球覆盖尽可能多的正常数据点(覆盖数据密度),一个是对异常点的区分能力.从彩图1可以看出,从覆盖数据密度上看,所提方法最优,RawLibSVM方法最差,IncrementalLibSVM方法介于两者之间;从对异常点的区分能力上看,所提方法能够很好地平滑非异常点,有效减少误报,虽然异常点数值不是最小,但整体区分能力较强,RawLibSVM方法在对正常点的处理误差上和IncrementalLibSVM方法相当,区分能力却比IncrementalLibSVM方法差.其原因大致分析如下:(1)所提方法采用增量式在线学习算法,能够随着数据输入不断对分类器进行训练,使分类器能够适应环境的不断变化;(2)所提方法在训练过程中采用了多窗口关联检测和样本选择算法去除了一些明显的异常点,提高了分类器的精度.增减式在线训练算法的训练效率对比如表2所示,同样是把2008.03.19的数据作为初始训练数据集,2009.03.30和2010.04.15对应的训练时间是对所有新增训练数据点的训练时间均值,SV集合大小也是所有时间点SV集合大小的均值.算法全部采用C++语言实现,实验平台配置如下:IntelDualCore2.66GHz/2GB,WindowsXP.从表2中可以看出所提方法在训练时间和SV集合大小上都明显优于IncrementalLibSVM方法.但是本文没有和其它在线学习方法进行对比,这将是在下步工作的重点.时间2008.03.19IncrementalLibSVM36727222009.03.30IncrementalLibSVM44209972010.04.15IncrementalLibSVM1132914397结论与下一步工作本文针对异常检测领域内获取精确分类器很困难、异常检测系统精度随着网络环境和时间不断变化的问题,在Hash直方图上采用SVDD进行异常检测,为了提高检测精度并让分类器随着时间不断进行调整,采用了增减式在线学习的方式对分类器进行不断训练,同时在SVDD的基础上采用多窗口关联检测算法累计多时间窗口的检测结果,充分利用异常在时间上的相关性提高检测精度,优化增减式在线学习算法中新增样本点的选择过程.采用SVDD对网络流量进行异常检测,其中参数惩罚因子和核函数的选取对检测系统的精度有很大的影响,还有检测时时间窗口的长度、训练数据的多少都对最后的检测精度也有较大影响,本文没有对参数的选择进行详细的讨论,这将是下一步工作的重点.
