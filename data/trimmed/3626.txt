Page1一种基于边缘与区域信息的先验水平集图像分割方法王斌李洁高新波(西安电子科技大学电子工程学院西安710071)摘要传统的水平集图像分割方法仅考虑了图像的数据信息,因此对被遮盖的目标以及与背景灰度相近的目标无法达到理想的分割效果.针对这个问题,提出了一种基于边缘和区域信息的先验水平集图像分割方法.该方法首先将图像的区域信息融入基于边缘的水平集方法,然后将其与形状先验结合.对比实验表明该文方法由于综合考虑了多种信息,能够更好地完成被遮盖目标的分割,对于与背景灰度相近的目标也能达到更好的效果.关键词形状先验;水平集;主动轮廓模型;曲线演化;图像分割1引言图像分割作为图像工程、模式识别以及计算机视觉的一个基础研究课题一直受到科研工作者的关注[1].近年来主动轮廓模型(ActiveContourModel,ACM)在图像分割领域中取得了长足的发展,而其中几何主动轮廓模型(GeometricActiveContour,Page2Osher和Sethian[2]最早提出了水平集隐式表示,Malladi等人[7]和Caselles等人[8]分别将其应用在图像分割中,提出了基于图像边缘的水平集图像分割方法;Chopp[9]从文献[8]出发,设计能量函数方便地将约束加入水平集演化中;Li等人[10]在Ca-selles等人[8]的工作基础上,加入了惩罚项使水平集函数在演化过程中保持为符号距离函数[11],但该方法只能使曲线以预设的形态演化,即扩张或收缩.这几种方法都基于图像边缘信息来设计速度函数,这种方式导致分割方法对噪声不够鲁棒,同时在弱边缘处易发生边缘泄漏.为了改进对弱边缘目标的分割效果,Chan和Vese[12]通过简化Mumford-Shah[13-14]模型设计了一个分段常函数,并用它来逼近待分割图像,通过最小化逼近误差实现图像分割.该方法基于图像的区域信息设计能量泛函,对噪声鲁棒,同时对弱边缘目标也有更好的分割效果.基于该方法,Vese等人[15]提出了基于区域信息的多水平集图像分割方法;同时该方法也被推广到多通道图像[16]和张量图像[17]的分割上;另外Chen等人[18]还用贝叶斯最大后验(Maximuma-Posterior,MAP)对文献[12]的方法进行了泛化.无论基于边缘[2,7-10]还是基于区域的水平集图像分割方法[12,16,18]其外部能量的设计仅考虑图像中的数据信息,对被遮盖的目标以及一些与背景灰度相似的目标分割效果并不理想,将已知的形状信息作为约束加入能量泛函是一种有效的解决途径.基于Chen等人[19]的工作,Chan和Zhu[20]使用水平集函数表示形状先验,通过定义当前水平集函数与经过仿射变换后的形状先验之间的距离设计了形状先验驱动的能量;Cremers等人[21]亦通过加入动态标签函数限制了形状先验在图像中的作用区域.这些方法仅适用于单先验的情况,而对于多先验的情况,Tsai等人[22]使用主成分分析法(PrincipleCompo-nentAnalysis,PCA)来获取一系列特征形状,再利用特征形状的线性组合来逼近当前形状.该方法通过最小化逼近误差实现在形状先验约束下的曲线演化,但未提供形状先验的对齐方法;Rousson和Paragios[23]沿用文献[22]的思路,不同的是其使用了基于Shape-to-Area的形状对齐方法,但这种方法通过迭代的方式实现,计算复杂;Hossam等人[24]使用了更多的参数来模拟形状先验的变化,增加了参数数量和计算量.这些方法可被归为参数化的形状先验模型,其主要缺点是曲线演化过程中需要迭代更新参数,算法复杂度较高,同时在使用梯度下降法求解能量泛函时较难选择参数步长[25].Leventon等人[26]使用PCA提取形状先验的局部变化规律,再基于MAP设计形状先验能量项,最后结合图像边缘信息设计了分割方法.该方法假设先验符合高斯分布,而实际中该假设往往不成立;Cremers等人[25]使用核密度估计(KernelDensityEstimation,KDE)建立统计模型,结合形状先验和图像区域信息设计分割方法,该方法和文献[26]方法相比不再需要高斯分布假设,更加符合实际情况.这两种方法使用概率模型替代了运动参数(如仿射变换系数和执行PCA后形状先验在子空间的投影)的迭代计算,简化了算法.为提高对被遮盖目标的分割效果,本文将图像的边缘信息、区域信息结合形状先验信息提出了一种基于边缘和区域的先验水平集图像分割方法.本方法首先使用图像的区域信息设计了概率加权停止函数和自适应方向选择函数,增强了现有的基于边缘的水平集图像分割方法;其次通过核密度估计的方法引入形状先验信息,使其干预曲线的演化,从而实现对被遮盖目标的分割.由于本文方法综合考虑了多种信息,与外部能量仅为数据驱动的水平集方法相比能够正确分割被遮盖的目标,同时对与背景灰度相似的目标也能取得更好的分割效果.2基于边缘和区域信息的先验水平集方法新的能量泛函定义为式中α和β为权重系数,满足α∈[0,1],β∈[0,1]且α+β=1;Edata为数据驱动能量项,Eshape为形状先验驱动能量项,两者结合构成了一种新的带有形状先验的能量泛函.Edata反映了图像的边缘信息和区域信息,定义如下:Edata()=μ∫Ω式中g(x,y)是概率加权的停止函数,定义为g(x,y)=d(x,y)是自适应方向选择函数,它自动决定曲线演Page3化方向和幅度,定义为d(x,y)=κ式中I为待分割图像,Gσ是高斯核函数,Th为常数阈值,取值一般为0.5.P(Ωobj/bkg|I)为像素属于目标或背景的后验概率,可通过下式计算P(Ωobj/bkg|I)=P(I|Ωobj/bkg)P(Ωobj/bkg)式中先验概率P(Ωobj/bkg)未知时可设为0.5,假设条件概率服从高斯分布,即P(I|Ωobj/bkg)∝1因为P(Ωobj|I)+P(Ωbkg|I)=1,故当P(Ωobj|I)=P(Ωbkg|I)时P(Ωobj|I)P(Ωbkg|I)取值最大,而式(3)取值最小.P(Ωobj|I)=P(Ωbkg|I)表示该像素既是目标也是背景,也就是图像边缘,这时式(3)取值最小使得曲线停留在图像边缘处.式(4)为自适应方向指示函数,当P(Ωobj|I)接近Th时表示该像素处于边缘处,这时演化的速度应该减小,以防止在弱边缘处发生边缘泄漏;当P(Ωobj|I)大于Th时表示该像素属于目标,故d符号为正且速度较大,这样曲线快速扩张从而将目标包在曲线内部;当P(Ωobj|I)小于Th时表示该像素属于背景,故d符号为负且速度较大,这样曲线快速收缩从而将背景排除在曲线以外.式(3)使得曲线停留在真实的图像边缘(即目标附近的灰度变化)附近;式(4)使得曲线能够自动选择演化的方向,且在匀质区域(即目标或背景区域)以较快的速度演化,而在有灰度变化的区域(即边缘区域)以较慢的速度演化,从而避免弱边缘的泄漏.通过式(3)和(4)我们将区域信息融入基于边缘的水平集方法中,得到了一种新的基于边缘和区域信息的数据驱动的外部能量.为实现对被遮盖目标的分割,基于文献[25]的工作,设计了形状先验驱动的能量项Eshape,分单先验和多先验两种情况,单先验定义如下:式中为当前水平集函数,φ~是将形状先验φ根据的矩[27]经过仿射变换后的先验;H(·)是Heaviside函数.对于多先验情况,我们用KDE进行概率密度估计,再计算其负对数,从而构成形状先验驱动的能量项,定义为shape()=-ln1EM式中φ~i是将第i个先验φi根据当前的水平集函数经过仿射变换后得到的先验,d(·)是两个水平集函数的欧氏距离.和文献[25]方法相比,φ~i经过了旋转变换,可以更好地处理先验与目标存在角度差异的情况.可以看出,当最小化式(7)或(8)时,当前的水平集函数将会向形状先验靠近,这样在演化的过程中受形状先验的约束而变得与先验形状相似.实际运行时即便待分割目标被部分遮盖,演化曲线也可根据先验的形状信息将其正确分割出来.σ是KDE中核函数的宽度,可通过下式[25]计算:推导式(1)的欧拉-拉格朗日方程,可得演化方程如下:t={αμΔ-div[δ()g(x,y)d(x,y})-(1-α)Eshape式中δ(·)为Dirac函数,Eshape验情况分别为ESt=-ESEM式中3数值实现方法由于能量泛函中引入了扩散项,不再需要使用逆风算法来求解PDE[10].我们直接采用中心差分方法求解演化方程,其数值求解方法如下:x,y,t+1=x,y,t+Δtαμx+1,y,t-2x,y,t+x-1,y,tPage4x,y+1,t-2x,y,t+x,y-1,tΔtαλδε()gx,y+1-gx,y-12Δ(x+1,y,t-x-1,y,t2Δ(槡Δtαdgδε()-Δt(1-α)δε()ΔΕshape式中K可通过下式计算K=div熿·槡燀对于单先验和多先验两种情况,ΔΕshape分别为ΔEM式中φ~x,y,i是将第i个先验φ~i根据当前的水平集函数经过仿射变换得到的先验;Hε(·)和δε(·)分别为经过平滑的Heaviside函数和Dirac函数,定义如下:4实验结果本文方法在人造图像、自然图像和医学图像上进行了多组实验以验证其分割效果.本节给出的4组实验均与文献[10]和文献[12]两个方法进行对比,以说明本文方法的有效性和实用性.为便于描述,分别用M1、M2和M3来表示文献[12]、文献[10]和本文方法.实验1中,待分割图像是手写英文字母p的人造图像,字母部分被遮挡且图像受高斯噪声干扰.图1中从上至下3行分别表示M1[12]、M2[10]和M3方法的水平集演化过程及分割结果.该实验采用单形状先验.基于区域信息的M1方法由于仅考虑图像的像素信息,无法将目标检测为字母p;基于边缘信息的M2方法对噪声敏感,无法检测到有意义的边缘;M3方法结合了形状先验信息,使得曲线在向目标边缘运动的同时保持形状先验相似,故M3方法可将被遮盖的目标正确分割为字母p.实验1表明:由于结合了形状先验信息,本文方法可以有效分割被遮盖的目标,且对噪声鲁棒.图1实验1(带有噪声的人造缺损图像的分割结果)实验2中,待分割图像为海边人的侧影,人为地将侧影的腿用与背景相近的灰度条遮挡.图2中从上至下3行分别表示M1[12]、M2[10]和M3方法的水平集演化过程.该实验采用单形状先验.受背景中部分深色像素的影响,M1方法无法检测到有意义的边缘;由于目标被遮挡,M2方法仅考虑图像的数据信息,故无法正确分割出完整的侧影;M3方法集成了形状先验驱动的外部能量,该能量使得曲线的当前形状与先验尽量地靠近.故M3方法可以将被灰度条遮盖的部分当作人的一部分正确分割出来.实验2表明:本文方法能够正确分割自然图像中被遮挡的目标.实验3中,待分割图像为停在树枝上的鸟,是自然图像.图3中第1至3行分别表示M1[12]、M2[10]和M3方法的水平集演化过程与分割结果,第4行为形状先验.该实验采用多形状先验,图像的特点是作为待分割目标的鸟与背景中树枝的灰度相似且有部分遮挡发生.基于区域信息的M1方法受到树枝的干扰,无法区别鸟和树枝;基于边缘信息的M2方法也将树枝的边缘当作目标的边缘错误地分割;M3Page5方法使用概率加权停止函数抑制了远离目标的边缘,同时通过形状先验驱动的外部能量使曲线轮廓与先验形状相近,故正确地分割出目标.实验3表明:本文方法能够有效地分割自然图像中被遮挡的目标,不受背景中与目标灰度值相似的像素的影响.实验4中,待分割图像为人类左心室的核磁共振图像,是医学图像.该实验中采用多形状先验.图4中第1至3行分别表示M1[12]、M2[10]和M3方法的水平集演化过程与分割结果,第4行表示左心室的形状先验.该实验采用多形状先验,待分割图像的特点是目标和周围组织灰度非常相似.基于区域信息的M1方法受到了周围组织的影响,不能正确分割出左心室;基于边缘信息的M2方法受到左心室中深色区域的影响,使得演化曲线停留在错误的地方;M3方法由于使用概率加权的停止函数与自适应方向选择函数,使得曲线在正确的方向上演化,并保持与形状先验相似,故正确分割出左心室.实验4表明:本文方法可以正确检测出医学图像中和周围组织灰度相似的目标.5结束语本文提出了一种新的基于图像边缘和区域信息的先验水平集图像分割方法.该方法具有以下优点:(1)利用图像的区域信息自动决定了曲线的演化方向,即膨胀或收缩;(2)使用概率加权的停止函数可检测到目标附近的真实边缘,抑制伪边缘;(3)自适应的速度函数使得曲线在图像边缘处演化速度较慢,而在匀质区域速度较快,从而防止边缘泄漏的发生;(4)引入形状先验指导曲线的演化,实现被遮盖目标的分割.总而言之,由于本文方法综合考虑图像的边缘信息、区域信息和形状先验信息,实现了图像中目标的有效分割.实验表明与其他外力仅为数据驱动的水平集图像分割方法相比,本文方法可正确分割人造图像、自然图像和医学图像中被遮盖的目标,对与背景灰度相似的目标也取得了更好的效果.致谢感谢评阅专家给予的建议!
