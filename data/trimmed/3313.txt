Page1雪花结构:一种新型数据中心网络结构刘晓茜1)杨寿保1)郭良敏1),2)王淑玲1)宋浒1)1)(中国科学技术大学计算机科学与技术学院合肥230026)2)(安徽师范大学计算机科学与技术系安徽芜湖241003)摘要该文分析了传统数据中心的不足以及新型数据中心具备的新特点,借鉴已有数据中心结构,依据著名的科赫曲线(Kochcurve),提出了新型数据中心网络结构———雪花结构.该结构充分考虑了数据中心的可扩展性,在保证交换机与服务器较低数量比例(0.125~0.333)的前提下,可以在较短的平均路径内实现节点间路由机制,具有较小的网络开销.关键词数据中心;网络结构;协议;路由1引言过去两年里随着碳排放和电费的不断激增,使得高能效数据中心的研究已经发展成为热点.数据中心是提高能源效率最困难的商业建筑,因为安装在数据中心的计算机需要大量的电力并且排放出大量的热量,而数据中心消耗的一半电力都用于支持IT设备的电力和制冷空调等冷却基础设施.美国联邦环境保护署(EnvironmentalProtectionPage238%和9%,照明系统仅占1%.因此从服务器的角度出发,在保证数据中心海量服务器的前提下尽可能降低交换机个数,提升服务器与交换机的数量比例,不仅可以有效降低能耗达到减排目的,同时还可以降低交换机的成本开销.本文借鉴已有的数据中心网络结构,依据著名科赫曲线[1],提出新型数据中心结构———雪花结构(Snowflake,Snow).该结构充分考虑了数据中心的可扩展性,在保证交换机与服务器较低数量比例的前提下,可以在较短时间内实现节点间路由机制,具有较小的网络开销.本文第2节介绍相关工作;第3节是全文主体,详细介绍基于雪花结构的数据中心网络构建方法及其属性内容;第4节阐述该结构中节点间的路由协议和算法;第5节补充说明其它方面的内容,例如雪花结构不完全时的情况等;第6节是实验模拟,将雪花结构与DCell结构作比较;最后,总结全文.2相关工作“数据中心”是上世纪IT界的一大发明,标志着IT应用的规范化和组织化.传统数据中心结构[2]如图1所示.Internet中的请求经过第3层的边界路由器(BorderRouter,BR)和接入路由器(AccessRouter,AR)被转发到基于虚拟IP地址(VirtualIP,VIP)的第2层.处于第2层顶端的交换机连接了两个负载均衡器,若其中一个均衡器失效,另一个仍然可以维持工作.VIP就配置在这两个负载均衡器中.此外,每个负载均衡器配置了一组目的IP(DestinationIP,DIP),因此一组DIP与一个VIP相对应.DIP是机架上物理服务器的私有内部地址.这组VIP就定义了服务器资源池,用以解决发送给VIP的请求,而负载均衡器则负责在资源池中的DIP间传播请求.然而随着科技的不断进步,传统数据中心的局限性也逐步显现出来,它存在以下不足之处[3]:(1)可扩展性差.服务器数量限制在4000台左右,若建立百万规模的数据中心则会导致高额的成本和低效的网络性能.(2)静态的网络分配[2].为支持数据中心的内部流量,独立的应用通常被映射到特定的物理设备.这种方式基于VLAN及其生成算法来满足服务器与特定应用映射.虽然直接映射服务与相关物理设备可以提供一定的安全性和独立性,但是在执行管理和安全性维护时容易造成VLAN策略超载.另外VLAN生成算法和大服务器池会将流量限制在树的顶端,易造成链路流量超载.(3)资源分片[2].主流的负载均衡技术通常要求同一个VIP资源池中的所有DIP在相同的两层中,因此应用需要更多服务器时,不能利用其它两层中的服务器,导致资源分片和低利用率.虽然全NAT负载均衡允许利用其它两层中的服务器,但基于IP的应用通常要求服务器知道客户端的IP,而全NAT无法支持.(4)人力成本高.当服务需要在服务器间重分配时,传统数据中心网络的地址空间分片会导致巨大的人工配置成本,且人工操作出错的概率很高.(5)硬件成本高.传统数据中心网络使用专用的交换机,位于上层的交换机成本较高.此外,负载均衡器扩容时需要成对更新,成本较高.因此,针对不断出现的新变化和新需求,新型数据中心必须满足以下特点[3-4]:(1)模块化的标准基础设施.在新一代数据中心中,为使IT基础设施简化和具有适应性与可扩展性,需要对服务器、存储设备、网络等基本组成按标准进行模块化配置设计,以使这种配置更易于针对数据中心的服务需求量身打造.基于标准的模块化系统能够简化数据中心的环境,加强对成本的控制,进而实现使用一套可扩展、灵活的IT系统和服务来构建更具适应性的基础设施环境,从而提高数据中心工作效率,降低复杂性和风险.(2)虚拟化的资源和环境.在新一代数据中心中,广泛采用虚拟化技术将物理资源集中在一起形成一个共享虚拟资源池,从而更加灵活和低成本地使用资源.通过服务器虚拟化、存储虚拟化、数据中Page3心虚拟化等解决方案,不仅可以降低服务器数量,还可以优化资源利用率.虚拟化是新一代数据中心中使用最为广泛的技术,也是与传统数据中心的最大差异.(3)良好的扩展性.数据中心的可扩展性包括3个方面:①物理结构必须是可扩展的.理想的结构必须支持十万甚至百万台服务器的低成本扩展,每个节点的链路数不宜过多或者不依赖于高端交换机;②物理结构必须支持增量扩展.当增加新的服务器时,不会影响已有服务器的运行;③通信协议设计必须是可扩展的,例如路由协议.(4)良好的容错性.在当前的数据中心中,故障是非常普遍的.硬件、软件和能源等因素可能引起各种各样的服务器、链路、交换机和机架故障.当网络规模足够大时,单独的服务器和链路的故障甚至比异常发生的频率更高,因此新型数据中心必须具备足够的物理冗余和良好的容错性.(5)良好的服务器间通信性能.部署在数据中心的许多应用在服务器间的流量远大于与外部客户交互的流量,如网页检索、分布式文件系统、科学计算等.因此良好的服务器间通信性能是保障服务QoS的基础.(6)位置无关的地址结构.服务需要采用与物理位置无关的地址结构来解决数据中心对服务器地址的限制问题.这样数据中心的任意服务器都可以成为任意资源池的一部分,既保证了服务的可扩展性又可以提高资源利用率,简化管理配置.(7)节省能源和空间.传统数据中心设计追求的是性能,而新一代数据中心在当今能源紧缺与能源成本迅猛增涨的情况下必然需要综合考虑能源效率问题,提高数据中心空间利用率,解决传统数据中心的过量制冷和空间不足的问题.目前有代表性的数据中心网络结构有Fat-Tree[5]、DCell[6]、BCube[7]和VL2[8]等.我们将详细介绍这几种结构并分析其各自的特点[3].Fat-Tree结构将服务器分为k个子群,每个子群包含两层端口数为k的k/2个交换机,下层每个交换机的k/2个端口连接到k/2台主机,其余k/2个端口分别与每个聚和层交换机连接;核心层需要(k/2)2个端口数为k的核心交换机,最多能支持k3/4台主机.Fat-Tree抛弃了传统数据中心采用专用交换机的模式,转而采用商业以太网交换机,较大提高了性价比.它能为包含上万台服务器的数据中心提供高聚合带宽,不需要对主机网络接口、操作系统进行修改便可构建,且与以太网、TCP/IP等通信协议兼容良好.Fat-Tree各层的链路数相等,使得所有服务器产生的最大流量和核心层的最大吞吐量相等,不存在网络瓶颈.而且它采用两张路由表进行两级路由,并采用一定的链路错误检测机制来实现容错路由.Fat-Tree结构解除了树形结构上层链路对吞吐量的限制,并能为内部节点间通信提供多条并行链路.但是Fat-Tree的扩展性受限于核心交换机端口数量,目前比较常用的是48端口10GB核心交换机,在三层树结构中能够支持27648台主机.长远来讲,规模在十万以内的数据中心是无法满足应用需求的,因此Fat-Tree存在扩展性不足的缺点.Fat-Tree的另一个缺点是容错性差,具体表现为处理交换机故障能力不足及路由协议容错性不强.MSRA研究表明[9]:Fat-Tree对低层交换机故障非常敏感,严重影响系统性能.因为Fat-Tree仍然是树结构,本质上具有树结构的缺陷.DCell是一种递归定义的网络结构,使用位于第i-1层的DCell构建第i层的DCell.当节点度增加时DCell的规模接近以2的指数次方扩展.通常DCell0内包含常数服务器,一般为3~8台,并通过微型交换机互连.DCell容错性较好,没有单点故障并且能够在严重的链路和节点故障的情况下利用其分布式协议实现接近最短路径的路由.DCell还能为各种各样的服务提供比传统树结构更高的网络容量.另外DCell可以增量扩展并且在不完全结构的情况下表现出上述性能.虽然DCell0很小,但DCell能支持的服务器数量是惊人的,例如当DCell0包含6台主机时,DCell3可以支持326万台服务器.由于DCell连接方式接近完全图,并且DCell路由协议(DCellFault-tolerantRouting,DFR)利用链路状态和贪心算法来实现容错路由,所以DCell可以在服务器、链路或交换机严重故障的情况下,实现性能较好的路由.然而,DCell也有不足之处.首先,其完全图的连接方式可能带来巨大花费,而且实际链路规模庞大,连接和维护困难.其次,DCell中流量在不同层次分布不均匀,level0承担了过多流量,严重影响吞吐量.最后,由于DCell使用服务器执行路由,增大了网络延迟,而且其路由协议也不适于在链路故障时发现最短路径,网络延迟较大.BCube是DCell的模块化版本[10-12],它的连接方式是在BCube0以外的层次中采用微型交换机实现连接.它在每层单元的数量上与DCell不同,如果Page4DCell在第k层有n个DCellk-1,那么第k+1层则有n+1个DCellk;而BCube在任一级都具有相同的单元数n,易得出BCubek拥有nk+1台服务器(n为BCube0中的服务器数).交换机作为连接媒介使BCube具有很多冗余路径,这可以保证容错路由并方便模块化连接而且路由速度比DCell快.另外BCube应用BSR(BCubeSourceRouting)选取路径,采用路径自适应协议,能够很好地开拓网络中的最短并行路径,并实现可靠数据传输.BCube能够高效无带宽限制地执行OnetoOne、OnetoAll、OnetoSeveral、AlltoAll类型的通信,很好地支持GFS,MapReduce类应用.BCube的连接方式和递归结构使得数据中心可以模块化建设,实现性好.BCube在结构不完整的情况下表现出比DCell具有更好的性能.实验表明[9]给定2048台服务器,在Fat-Tree、DCell和BCube结构都不完整的情况下,BCube的网络吞吐量和容错性能是最好的,这是因为BCube对不完整结构采用完整结构的交换机连接策略.BCube的不足体现在可扩展性上,BCube在k=3、n=8时(k为BCube层次,n为BCube0中服务器数),仅支持4096台服务器,与DCell差距较大.VL2是一种可扩展的灵活的数据中心网络结构,它能够支持超大规模的数据中心,为服务器间提供均衡的高带宽通信性能,服务间的性能隔离及以太网第2层语义.第2层语义是指将第2层所有的域虚拟化为统一的域,在这个层面上所有主机都位于同一个域中.VL2在结构上改变的是第3层交换机的连接方式,采用特殊协议实现虚拟第2层;而其它结构在物理连接方面的改变是整体.另外,地址表示和路由协议在VL2中更为重要,直接关系到虚拟第2层的实现.VL2中采用VLB(ValiantLoadBalancing)进行路由,为均衡各路径流量,VL2将各中间交换机设为相同IP,采用随机的方式选择一个中间交换机实现路由.3新型数据中心网络结构———雪花结构这一部分详细介绍雪花结构的构建方法及其特有的一些属性.之所以称为雪花结构,是因为这种结构依据科赫曲线,形似科赫雪花.3.1雪花结构及其构建方法雪花结构包含两个组成部分:服务器和微型交换机.前面已经介绍了DCell和BCube结构,二者均采用了递归的方法来定义各自结构.在雪花结构中,我们同样采用递归定义的方法,在(n-1)级雪花结构的基础上添加若干个0级雪花结构,构成n级雪花结构.这里的“若干个”我们在后面会详细介绍.这样定义的好处是,首先,我们用添加某种固定结构的方式尽可能地将结构模块化处理,有利于结构的模块化连接;其次,当n级结构没有扩展完全时,继续扩展(n+1)级结构也较容易.此时,若发现n级结构没有扩展完全,可以在不改变已有(n+1)级结构的情况下,继续补充不完全的n级结构,有利于结构的扩展.下面我们来详细介绍雪花结构的构建方法.0级雪花结构(Snow0)由一个微型交换机和若干个服务器组成.借鉴已有数据中心结构,设置服务器的个数最少为3个,不超过8个[6-7].如图2(a)所示,我们以3个服务器为例(k=3),将3个服务器连接到一个n端口的微型交换机上.如图2(b)所示,我们调整3个服务器的理论位置,为3个服务器的两两直接互联添加了3条虚线.这3条虚线并非实际的服务器互联,而是为了方便说明构造下一级雪花结构,我们称之为虚连接,即不存在的网络连接,只是为了方便说明结构的构建.在Snow0基础上,我们断开3条虚连接(如图2(b)),每断开一条虚连接,即要添加一个0级雪花结构,将该新添0级结构中的微型交换机分别与虚连接的两端节点相连.相对于虚连接,这样的连接称为实连接,即断开虚连接重新构建的连接.这里的实连接是实际存在的连接,是新添加结构中的交换机与原有结构中服务器的连接.这样得到一个1级(Snow1)雪花结构,如图3所示.由于是在断开的虚连接处添加0级雪花,此时虚连接的状态已经变为实连接(1条虚连接转化为2条实连接),链接状态从无到有,因此在此处不再添加虚连接.需要特别说明的是,实连接不只是实际存在的连接,更体现了由虚连接到实连接,这种连接从无到有的变化状态,因此在Snow0中服务器与交换机相连的3处不看作是实连接,它虽然是实际存在的连接,但是并没有状态变化的体现.仔细观察可以Page5发现,断开虚连接添加的0级结构与Snow0是有区别的,它缺少了一条虚连接,并不是真正意义上的Snow0结构.为了区分二者,不至于混淆读者,这种后来断开虚连接不断添加的缺少一条虚连接的0级结构,我们称其为Cell,以区分Snow0.Snow1包含6条实连接和6条虚连接.在之后的每一级雪花结构中,总是断开上一级中包含的所有实连接和虚连接,添加Cell,构成新的高级结构.图4显示了k为3时的2级(Snow2)雪花结构.构建雪花结构的伪代码如算法1所示.算法1.构建雪花结构.1.ConstructSnow(k,n)2.If(n==0)//构建的是Snow03.For(inti=0;i<k;i++)4.Connectithservertoswitch;5.标记两两相邻的服务器;//虚连接标记6.将标记的服务器成对放入队列;7.记录队列长度queue_len;8.Return;9.Elsewhile(n!=0)10.{while(queue_len!=0)11.{从队列中取出节点对,添加Cell,Cell中的交12.将添加Cell产生的2条新的虚连接和2条新13.记录新的队列长queue_new_len;14.queue_len--;//添加一次Cell队列长减一15.}16.n--;//当队列长为0时,表明新的一级雪花17.queue_len=queue_new_len;18.}在这一节,我们介绍并证明雪花结构的特有3.2雪花结构的属性属性.定理1.假设第0级雪花结构中包含k个服务器(Cell也包含k个服务器),则第n级雪花结构包含SVn个服务器,SWn个微型交换机.其中k∈{3,4,5,6,7,8},n0.SVn和SWn分别满足下列条件:证明.Snow0包含k个服务器,因此Snow0中,SVnSWn=k1.Cell包含k个服务器,因此Cell中,SVnSWn=k1.每一级雪花结构都是在前一级的基础上不断添加Cell,服务器与交换机的比例没有改变,因此SVnSWn=k1是显而易见的.变换形式即得到式(1)结论.下面,我们用数学归纳法来证明式(2).当n=0时,SV0=k,k×(k+1)n=k,此时,SVn=k×(k+1)n.当n=1时,SV1=k+k×k=k(k+1),k×(k+1)n=k(k+1),SVn=k×(k+1)n.假设,当n=m时,等式成立,即SVm=k×(k+1)m.则当n=m+1时,SVm+1=SVm+k×(断开Snowm中虚连接和实连接添加的Cell个数).这里,断开Snowm中虚连接和实连接添加的Page6Snowm中虚连接和实连接个数=(k+1)×Cell个数=Snowm中虚连接和实连接个数;[SVm-SVm-1]/k=k×(k+1)m;因此SVm+1=k×(k+1)m+1.所以,SVn=k×(k+1)n,等式(2)成立.证毕.从式(1)和(2)可以得到,当k=3、n=10时,雪花结构可以达到314万个服务器.该结构在最初阶段扩展较慢,但是一旦形成即迅速增长.当k=6、n=4时,雪花结构可以达到14406个服务器、2401个交换机,交换机与服务器的比例为0.167.在BCube中,当k=6、n=4时,只能达到7776个服务器,却同时包含交换机2850个.不仅服务器数量减半,扩展性较弱,而且交换机与服务器的比例达到了0.367,是雪花结构的2倍多.当k=4、n=4时,BCube的交换机与服务器比例甚至达到2.328,交换机的数量是服务器的2倍多.考虑到数据中心这种大规模结构的制冷开销以及交换机成本,这种交换机个数的较高比例甚至超过服务器同比例增长,显然是不利的.此外,雪花结构在保证交换机的低数量方面也是很有优势的,当k=6时,始终保持交换机与服务器的比例为0.167,最坏情况k=3时,也可以达到0.333的低比例.3.3雪花结构的性能分析延时3个方面来分析雪花结构的性能.3.3.1网络交换容量我们假设交换机与交换机之间的带宽为AMbps,交换机与服务器之间的带宽为BMbps,一般情况下A大于等于B.当任意2个服务器之间需要发送数据时,这2个服务器之间的带宽受限于二者之间路径上的最低带宽值.雪花结构的一大特点就是用较少的交换机连接较多的服务器,网络扩展性好.同时,节点之间的带宽也较大.综合以上的特点,该结构适合于节点之间有频繁通信,且需要较大节点规模的应用.例如在该结构上运行大规模数据挖掘等.3.3.2瓶颈链路在这一节,我们从网络交换容量、瓶颈链路以及我们将瓶颈分为2种:节点瓶颈与路径瓶颈.节点瓶颈是指,某个节点(服务器或者交换机)由于数据流量过大成为瓶颈.越是层级低的节点越容易成为瓶颈节点.因此我们在第5节补充问题研究里面将低层级中的一些服务器改进为交换机,其中的交换机也可以换成高吞吐量如万兆交换机,以减轻数据传输的压力.路径瓶颈是指,2个子网之间有且只有一条路径,当该路径断开时,这2个子网即失去连接,这样的路径我们称为瓶颈路径.在定理5中我们已经证明,Snow_n中任意2个服务器包含并行路径,至少2条不超过22n条.因此理论上雪花结构中不存在路径瓶颈的问题.3.3.3延时RTT(Round-TripTime)表示从发送端发送数据开始,到发送端收到来自接收端的确认(接收端收到数据后便立即发送确认),总共经历的时延.当2点之间的RTT值较大时说明这2点之间的延时较大;反之,则说明2点之间延时较小.从RTT的定义可以看出,RTT与2点之间的最短路径成正比.当2点之间距离较长时,RTT较大;反之,则RTT较小.我们在定理4及推论4中已经得出最长最短路径为(2n+1)跳.因此,延时为O(n).4雪花结构中协议和路由策略在这一小节,首先分析雪花结构中的无失效路前面已经说到,当k=3,n=10时,雪花结构可以达到314万个服务器,由于该结构中的服务器个数随着n值的增加呈指数次方不断增长,它的目标是扩展连接十万百万量级的服务器,因此基于雪花结构的数据中心不适合使用全局的链路路由机制,易造成带宽瓶颈和单点失效的OSPF[13]协议自然不适合这种结构.在这一节,我们首先介绍无失效情况下节点路由情况;接着提出基于雪花结构的路由协议;最后,详细阐述了依据路由协议的节点路由情况.4.1无失效路由由情况.假设源节点为src,目的节点为des.定理2.Snow0中任意2个服务器之间仅1跳.如图2(a)和(b)所示,Snow0中任意两个服务器间通过交换机即可达,1跳显然.定理3.k=3时,Snow1中任意2个服务器之间不超过2跳.当k∈{4,5,6,7,8}时,任意2个服务器之间不超过3跳.k=3时,如图3所示,Snow1中节点路由可以分为以下5种情况:Snow1中服务器→Snow0中服务器:1跳;Snow0中服务器→Snow1中服务器:1跳;Page7服务器:2跳;服务器:2跳;服务器:2跳.Snow1中服务器→Snow0中服务器→Snow1中Snow1中服务器→Snow0中服务器→Snow0中Snow0中服务器→Snow0中服务器→Snow1中不超过2跳的结论是很容易得到的.当k∈{4,5,6,7,8}时,同理可得到3跳结论.定理4.Snown中任意2个服务器之间最长最短路径为(2n+1)跳.其中最短路径是指2个服务器之间路由经过的最少服务器个数.假设源节点src位于Snowj中,目的节点des位于Snowk中.j和k都小于等于n.此时,考虑最长最短路径情况.源节点src从Snowj逐级向下经由Snowj-1,Snowj-2…路由到Snow0中的服务器,最多需要j跳.Snow0中的服务器经由Snow1,Snow2…路由到Snowk中的服务器最多需要k跳.而Snow0中的服务器彼此之间最多1跳.因此Snowj中的源节点src路由到Snowk中的目的节点des最长最短路径为j+k+1跳.当j和k都取最大值n时,src与des的最长最短路径达到最大值2n+1跳.由上述分析我们还可以得到,当j和k不同时取到n或者j和k不相等时,src与des的最长最短路径必然小于等于2n+1跳.因此,我们得到推论4.推论4.Snowj与Snowk(j不等于k,且j与k均小于等于n)中任意2个服务器之间最长最短路径上限为2n+1跳.定理5.Snown中,任意2个服务器包含并行路径,至少2条,不超过22n条.并行路径是指,2个服务器之间同时存在的路径,这些路径彼此之间独立无依赖关系.我们通过在前一级雪花结构的基础上断开所有的实连接和虚连接,添加Cell来构建下一级雪花结构,每一个添加的Cell都是通过交换机的左右两条连接才加入新结构中,因此,任意2个服务器之间至少包含2条并行路径.当Snowj中源节点src路由到Snowk中的目的节点des时,src从Snowj开始经由Snowj-1Snowj-2…路由到Snow0,每一次从Snowp到Snowq总是有2条并行路径,因此至多包含2j条并行路径.同理,Snow0到Snowk也至多包含2k条路径.因此,从Snowj的源节点src路由到Snowk的目的节点des至多有2j+k条并行路径.当src与des都处于Snown时,两节点至多包含22n条并行路径.4.2协议4.2.1节点唯一标识方法我们对每一个服务器和交换机进行标记,标记结构为〈级别,度数〉.级别表明该服务器处于雪花结构的这个级别中,是在该级别被添加进雪花结构的.然而由于在每个级别中并非只添加了一个节点,仅仅级别这一度量还不足以唯一标识雪花结构中的节点位置,因此,我们引入度数这个度量,结合级别唯一标识雪花结构中的每一个服务器和交换机.下面详细解释节点标识的方法.如图5所示,标记Snow0中的3个服务器分别为A〈0,0/360〉,B〈0,120〉,C〈0,240〉.其中第1位表示级别,即这3个服务器均处于Snow0中.第2位表示度数,这里的度数表明的是相对位置,均是以Snow0中的交换机为基础参照物得到的相对位置.因此Snow0中的交换机被标记为〈0,0〉,服务器A在交换机的正上方,相对度数为0°,依照顺时针方向,服务器B为120°,服务器C为240°.这样Snow0中的3个服务器即被唯一标识.为了区分服务器与交换机,对交换机添加w标记,即Snow0中的交换机标记为S〈0,0,w〉.需要说明的是,对于特殊位置的服务器A,同时标记其度数为360°,方便构造高级雪花结构的标识.我们在3.1节已经阐述了如何构建Snow1.这里,同样利用产生Snow1的3个Snow0服务器来产生Snow1的标识.如图6所示,Snow1中的交换机D所处Cell添加在服务器A、B之间并与其直接相连,利用A、B来产生D的标识,记D的标识为〈1,60,w〉,即Snow0构建产生Snow1,级别为1,度数为A、B和的一半.用这一位置同时标记交换机D的正上方(相对于D的位置)服务器E为〈1,60〉.前面说到服务器A的度数同时标记为360°,当A、C用以标识交换机M时,采用A的360°构造M为〈1,300,w〉.即A与180°内的节点构造新标识时采用0°,与180°~360°内的节点构造新标识时采用360°.Page8这样做的好处是可以形成一个规范化的节点唯一标识方法.4.2.2请求数据包的结构定义定义源节点src发送的请求数据包中,包含src的标识信息,数据包ID以及目的节点des的标识信息.这样一个请求数据包可以通过其自身ID与src的标识来唯一标记.当转发数据包的路由节点发现已经转发过某一数据包时,即放弃该数据包不再转发以降低网络流量.当目标节点des收到请求数据包后,也可以根据包中携带的src的标识信息获得请求节点的相关信息.具体的路由机制在4.3节详细阐述.4.3路由策略我们定义源节点src〈j,a〉和目的节点des〈k,b〉.当src发送请求数据包时,包内携带的信息包含(ID,〈j,a〉,〈k,b〉).如图7所示,在该雪花结构中,虚线表示中间省略的若干级别.左节点标记为src〈j,a〉,右节点标记为des〈k,b〉.当src要发送数据包给des时,首先查看des的度数b的所属范围.由于b属于0~120°范围则通过服务器A或者C路由到B,再经由中间若干交换器不断地接近des,最后从服务器G到达des.根据度数b可以确定路由的方向,根据级别k可以确定路由的大概路径长度.以图8为例,src需要发送请求包给des时,首先查看des的度数b,这里为45°.src第1步经由交换机M〈1,300,w〉可以路由到N或者C,由于N更接近服务器A〈0,0/360〉,A同时为0°较C更靠近des,因此src选择M—N—A的路径.A可达H〈2,30,w〉,虽然与des同层级,但是度数较低,继续路由达交换机D〈1,60,w〉.D可达K〈2,90,w〉,虽然K与des同级但是度数较大,进一步发现D连接的两个服务器E〈1,60〉和G〈1,30〉均属于Snow1,E和G可构建Snow2级,且45°属于30°~60°之间,因此,D经由E或者G到交换机F〈2,45,w〉,最后达des.5补充问题研究当雪花级别不断扩大,结构中的服务器数目不断增多,达到百万级别时,路由的消息数量剧增,此时Snow1中的12个服务器显然会负载较重的信息转发任务,因此我们对上述提出的雪花结构略微改进,将Snow1中的12台服务器替换为交换机,如图9所示,以缓解低级雪花结构的负载强度,提高消息转发速度.我们在Snown-1的基础上添加若干个Cell形成Snown.此时,若新添加的Cell中的交换机发生故障时,会导致该交换机连接的3台服务器完全脱离雪花结构.当这种情况出现较为严重时,Snown即退化为Snown-1级结构,可用服务器数量显著受到影响.而这种影响源于交换机并非服务器本身造成.为了避Page9免这种情况的出现,我们补充规定,在新添加的Cell中,3台服务器轮流每20s发送一个查询交换机是否存活的消息,这样每个服务器平均1min发送一次消息.当3台服务器不能连通时表明交换机出现故障,服务器已经脱离雪花结构,这时需要检查该交换机,确保其稳定工作.6实验模拟在这一节,我们采用模拟的方法来评估雪花结构的性能.模拟程序采用Java编写,开发工具为Eclipse3.5.0,在一台联想X200笔记本上运行.场景1.无节点失效时,不同层级节点总数及平均最短路径长度.首先来看无节点失效情况.表1显示了当k=3时,Snow0中的服务器到其余节点的平均最短路径情况.由于未考虑节点失效情况,因此不可达节点数均为0.由平均最短路径长度可以发现,在Snow4的范围内,平均路径可以保持在3跳内,与4.1节中的定理4相符,但是实验结果优于定理4的理论推导结果.表1无节点失效情况下,各个节点到Snow0中雪花级别Snow24816470801.702Snow31926419104162.178Snow4768256767020482.670场景2.有节点失效时,平均最短路径长度与路径失效率.这里的节点失效是指服务器故障.当k=3时,我们详细设置了节点失效比例,测试了Snow4中,随着节点失效比例的增加,平均最短路径长度变化情况.从图10可以看出,当节点失效保持在0.05~0.30时,平均路径长度波动不大,基本处于2.6~2.7之间.当k=3时,我们测试在了Snow4中随着节点失效率的增加,路径失效率的情况,并与DCell[6]中的实验结果做了对比.图11所示为Snow4与DCell4的路径失效对比图.从图中可以看出,Snow的路径失效率围绕DCell上下波动,差别不大.场景3.有链路失效时,平均最短路径长度与路径失效率.这里的链路失效是指交换机与服务器之间的链接断开,或者交换机故障,并非服务器本身故障.从图12可以看出,随着链路失效率的增加,平均最短路径长度变化幅度不大.链路失效率在0.2以内时,平均最短路径长度始终在2.6~2.9之间.Page10当k=3时,我们测试在了Snow4中随着链路失效率的增加,路径失效率的变化情况,同样与DCell[6]中的实验结果做了对比.图13所示为Snow4与DCell4的路径失效对比图.从图中可以看出,Snow的路径失效率比较稳定,始终保持0.001~0.004之间.最后,我们综合比较了DCell、BCube以及Snow,如表2所示.网络结构DCellBCubeSnow交换机与服务器的比例径失效的关系较好较好与DCell效果节点失效与路链路失效与路径失效的关系较好较好较DCell失效率网络吞吐量7结束语本文分析了传统数据中心的不足以及新型数据中心具备的新特点,借鉴已有数据中心结构,依据著名科赫曲线,提出了新型数据中心网络结构———雪花结构.该结构充分考虑了数据中心的可扩展性,在保证交换机与服务器较低数量比例的前提下,可以在较短的平均路径内实现节点路由机制,具有较小的网络开销.
