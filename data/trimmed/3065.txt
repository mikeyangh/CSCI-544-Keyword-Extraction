Page1基于效用的EPONVoDQoS组播实现机制研究张晋豫1)刘犁2)杨维1),3)1)(北京交通大学计算机学院北京100044)2)(新泽西理工学院计算机科学系内瓦克新泽西07102美国)3)(东南大学移动通信国家重点实验室南京210096)摘要服务质量无法保证和低效益是IP网络上开展VoD业务面临的主要问题.基于组播业务的网络优先级、用户群的SLA优先级和经济优先级,提出了一个基于效用的EPONVoD组播QoS优先级(效用优先级)算法.在网络拥塞的时候,基于该效用优先级来动态调整组播组的资源分配,不但节省了带宽需求和降低包丢失率,而且可通过将网络资源汇聚到高价值的业务上,提高带宽的效益.通过对变长和无序EPONEthernet下行帧进行基于效用的定长和有序的改进,可减少VoD业务流的包时延抖动.仿真实验结果很好地验证了该机制的优点.关键词以太无源光网络;视频点播;服务质量;组播1引言网络带宽且具有严格的QoS(QualityofService)要求,具有个性和群体性双重属性,适合使用组播传输.EPON[1-2](EthernetPassiveOpticalNetwork)VoD(VideoonDemand)业务需要占用大量的能够提供1Gbps(未来可以达到2.5Gbps和10Gbps)Page2的上下行带宽,其P2MP(Point-to-MultiplePoint)的无源树形拓扑非常适合于广播和组播业务的开展;采用与IP(InternetProtocol)兼容的以太帧结构,可以和广域网无缝连接;采用集中的下行以太广播和上行TDMA(TimeDivisionMultipleAddress)MAC(MediaAccessControl)协议,中间不需要路由,可保证较小的包传输时延[3].EPON的这些优点为VoD业务的开展提供了便利,但也显示存在一些缺点[4-5]:(1)由于所有的ONU(OpticalNetworkUnit)共享物理媒质,当分路比较高时,带宽提供能力有限;(2)当网络接入率和多媒体成份增加时,网络拥塞和包丢失率显著增加;(3)由于采用变长的下行以太帧(64~1518Byte)和无序的帧结构,在突发的业务量环境,具有较大的时延抖动;(4)支持的优先级机制,如DiffServ(DifferentiatedService)和802.1Q等,容易产生所谓的“低效益”问题,即大量低价值的业务流占据大量的带宽[6-9].VoD是增值业务,除了要强调业务的网络优先级保证外,还要兼顾用户的SLA(ServiceLevelAgreement)和业务的经济优先级保证.文献[10-11]提出了基于拍卖的网络资源调度机制,文献[12-13]提出基于网络、政策和市场属性的网络业务定价机制,文献[14-15]提出了基于用户的SLA的EPON的QoS实现机制,但目前还没有发现关于组播组群体SLA优先级定义以及基于它的QoS实现机制的研究成果.基于组播用户的SLA优先级、组播业务的网络优先级和经济优先级,借鉴经济理论,本文提出了一个基于效用的VoD组播业务QoS优先级(效用优先级)算法,在拥塞时,源调度模块基于效用优先级动态调整编码压缩率和进行基于效用的资源调度,不但节省了网络带宽需求,减少了网络拥塞和丢包率,提高了VoD组播业务的QoS保证能力,而且通过将带宽汇聚到高价值的组播业务上,提高了网络资源的运营效益,解决了“低效益”问题.对EPON变长和无序的下行以太帧进行了有序和定长的改进:(1)采用定长以太下行帧;(2)在一个下行帧中,从前到后按照组播业务的效用优先级降序排列组播业务包,Internet排在组播业务的后面,仍然采用无序和变长的结构;(3)不同帧中,同组播业务的数据包的大小保持相同.通过这些改进,在突发Ethernet业务流环境下降低了包的时延抖动,解决了EPONMAC机制固有的时延抖动过大问题.本文第2节论述基于效用的EPONVoD组播QoS实现机制;第3节介绍仿真实验和讨论;最后给出我们的结论.2基于效用的EPONVoDQoS组播实现机制本文提出了一个基于效用的EPONVoDQoS组播实现机制,如图1所示.图1基于效用的EPONVoDQoS组播实现构架本机制分为4个模块:(1)动态组播业务应用定义;(2)基于效用的业务类定义;(3)低丢包率动态资源调度;(4)低时延抖动执行结构.2.1动态组播业务应用定义EPON中的数据设备属于第2层,数据传输不通过路由器.二层组播协议有GMRP(GroupMulticastRegistrationProtocol)和IGMP(InternetGroupManagementProtocol)Snooping.GMPR是一个纯粹二层协议,其工作范围涉及到二层交换机与主机,当一台主机申请加入和离开一个组播组,它向交换机发送一个以MAC地址“01-80-C2-00-00-20”为目的地址的GMRP包,交换机据此在自己内部建立和维护一个基于MAC和转发端口的二层组播转发.IGMPSnooping的工作范围涉及到路由器、交换机与主机.交换机中的IGMPSnooping功能是通过窥探路由器发出的询问与主机发出的应答包,从而在交换机内建立基于端口的二层组播转发表来实现的.当主机申请加入或离开一个组播,它向路由器发送一个IGMP包,该包经交换机到达路由器,路由器据此决定是否转发该组的数据帧.可以看出,这两个协议在二层上实现组播的功能几乎相同,由于IGMPSnooping涉及到三层相关的内容,反应速度没有GMRP快,但目前GMPR没有IGMPSnoo-ping兼容性好,所以本系统采用IGMPSnooping.在网络中有路由器时,路由器管理着组播组的建立Page3和删除、组成员的加入和离开.本系统用复用器或ONU模拟路由器的这些功能.组播组的建立过程如下:系统上电工作后,ONU发送目的地址为224.0.0.1询问报文,各个视频源收到后,发送目的地址为224.0.0.2的加入报文,ONU收到后建立各个视频组播组,并在以后的主机询问时,向主机依次报告,确保各个视频组播组始终存在.具体的实现过程如下:在上行方向,IPSTB(Set-TopBox)接收到红外遥控器的频道切换命令后,通过视频解码器的串口送给网络处理器.网络处理器首先将节目频道号转换为MAC组播地址,然后将该MAC组播地址封装到IGMP的请求加入包中,发送到Ether-net多路统计复用器,申请频道切换,即将IPSTP加入到相应的组播组中.由于EPON的下行数据是广播的,当前播放的所有视频组播流都会到达PON内的每一个ONU上,这样组播组的加入在ONU就可完成.只有在PON内没有视频组播流时,ONU才将IGMP加入包转发到Ethernet多路统计复用器,后者将组播地址加入到它的下联端口的组播转发表里,将该路视频流广播到PON内的每一个ONU.频道切换涉及到离开与加入组播组两个过程,为了切换,组成员必须先离开原来的组播组后再加入到新的组播组中.当一个VoD节目首次被申请时,EPON为它建立一个组播组.OLT(OpticalLineTermination)首先为该组播组实例化一个组播MAC,并绑定一个LLID(LogicalLinkIdentifier),然后启动一个发现过程,将组播LLID和组播MAC发送给ONU,完成ONU的组播注册,自此,ONU(OpticalNetworkUnit)可以接收此组播组数据流了.在组播组组建期,当其它用户申请加入此组播组时,OLT启动一个相同的发现和注册过程.当组播组组建期结束后,业务类定义模块根据所有组播用户的SLA、组播业务的网络属性和经济属性,使用EPONQoS定义算法,动态为该组播定义一个业务类,资源调度模块按照该业务类来分配网络资源,并交付执行机构来实施.2.2业务类定义EPON的业务类定义算法的输入参数包括:(1)宿主的级别(SLA);(2)宿主的数量;(3)业务的网络属性;(4)业务的市场属性.由于VoD是增值业务,VoD业务的自身价格和组播组的用户数决定了它的市场价值,而市场价值是影响它的优先级的最重要的因素,因此可以用它表示组播组的经济优先级.组播组的经济优先级可表示为其中,Cx、Mx和Nx分别表示组播组x的业务总价值和价格(不包括传输费用)以及总用户数,满足Nx=∑Jj是最大的用户级SLA级别数.SLA是用户和运营商签署的法律文件,用EPON的网络技术语言SLS(ServiceLevelSpecifi-cation)来描述,SLS包含业务QoS水平定义,由QoS参数子集表示,并进一步被映射为EPONQoS机制的转发业务类[14-15].EPON支持DiffServQoS机制[11-13],定义了EF(ExpeditedForward)、AF(AssuredForward)和BE(BestEffort)转发业务类,EPON在OLT和ONU为每一个转发业务类创建一定长度的优先级队列,支持不同的优先级别,如CBR(ConstantBitRate),适应语音业务的QoS特征,VBR(VariantBitRate),适应视频业务QoS特征,以及BE(BestEffect)优先级,适应非实时数据业务的传输特征.优先级调度机制负责将到达的数据包按照优先级放入相应的转发队列并按照调度策略进行发送控制.IEEE802.1D支持严格的优先级调度机制[6,9],即为不同的业务类创建等长的队列,优先转发高优先队列中的数据包,只有当高优先级别队列为空时,才可能转发低优先级队列中的数据包.当高优先级别的队列满时,后到达的高优先级别的包可以替换低优先级队列中的低优先级数据包.因为低优先级队列中的数据包要等到高优先级队列为空才能发送,而VoD业务是持续的业务流,因此,即使在网络总的业务量降低的情况下,低优先级别业务类的数据包的传输时延和丢包率也可能增加,产生所谓的“轻负载惩罚”问题[6,8].为了避免这种现象发生,通用的方法为每一个业务类定义一个最大带宽门限[7,9].在该限制下,对相等的带宽,高优先级的业务类通过接纳较少的用户业务应用来提高QoS水平.按照经济学理论,对ISP(InternetServiceProvider)来说,相等的资源需要产生相等的效益,这势必造成高优先级别的业务类单位带宽具有较高的价格[10-11].因此,用户的SLA优先级可用该级别用户拥有的最大平均带宽的价格来表示,优先级别越高,相同带宽支持的用户数越少,用户拥有的平均带宽较多,数据包遭遇拥塞的概率较低,业务应用的QoS水平越高.一个用户SLA级别可Page4表示为其中,pj表示SLA级别为j的用户的平均优先级,R表示EPON单位下行带宽的价格(对各个级别是一样的),Wjmax为用户SLA级别j具有的VoD最大带宽,满足∑J最大的用户数,Wvod为组播可以使用的带宽.对一个VoD组播组,它的价值包括传输费用(网络使用费)和VoD视频业务的销售额.价值越大,为运营商带来的利润就越多.由于VoD业务是增值业务,就应该给它提供好的QoS水平.因此,可以用VoD组播组的总价值来表示它的QoS水平优先级,即效用优先级,表示为lx=kp∑J其中,lx为组播组x的QoS优先级,Tx为播放时长,kp和kc为加权系数.其中,第1项中∑J示VoD组播业务总的传输费用,即占用带宽资源的总费用,第2项Cx表示VoD业务批发销售给组播用户的总价值.2.3EPON动态低丢包率资源调度机制EPON的数据链路层扩展了IEEE802.3定义的Ethernet网络的数据链路层,以实现点到多点的访问控制.在OLT侧,多MAC实体共享同一个多点MAC控制.多点MAC控制是包含控制解析器/复用器功能的唯一实体,根据多点发送控制中的一个外部控制信号来进行发送模块的使能,避免了发送冲突,丢包不会发生在OLT和ONU之间的ODN(OpticalDistributionNetwork)上,因此EPON不需要CSMA/CD(CarrierSenseMultipleAccess/CollisionDetection)协议.由于Ethernet业务流具有突发性,OLT和ONU的优先级队列有可能发生溢出而产生丢包现象.VoD业务属于流媒体业务,或者IPTV(IPTele-vision)业务,基于拥塞机制的TCP(TransportCon-trolProtocol)/IP不能为流式传输提供所需要的QoS保证[16-17].为了解决在IP网络上传输流媒体所固有的QoS缺陷,除了改进协议外,如使用RTP(Real-timeTransportProtocol)和RTCP(RTPControlProtocol)、RTSP(Real-TimeStreamingProtocol)、MMS(MicrosoftMediaServerProtocol)等,压缩编码是一种很重要的方法.压缩编码可以减少业务的带宽需求,降低网络负载,从而减少拥塞发生的概率.当前普遍使用的流媒体压缩协议MPEG(MovingPictureExpertsGroup)2、MPEG4和H.264等,都可以根据实时流媒体协议反馈的网络的拥塞状态,自动或手动调节压缩编码参数来修改压缩率[16].由于VoD是增值业务,所以在网络拥塞时,应该按照组播组的价值来分配带宽:价值高的压缩少一点,价值低的压缩多一点.由于在式(3)定义的组播组效用优先级等于组播组的价值,因此,在网络拥塞时分配给一个组播组的带宽或压缩率,应和它的效用优先级成正比.在网络拥塞时,一个组播组的压缩率可表示为其中,rx为多播组x的压缩率,等于需求带宽wxn和实际分配带宽wxa的比wxawxn当一个VoD组播组建立时,它的加入会提高网络的负载(其不压缩时的发送带宽需求在VoD的Profile中描述):网络有可能会发生拥塞和不拥塞两种情况,为了保证整个网络的QoS,同时最大限度提高带宽资源的使用价值,每一个在线的VoD应通过调节压缩率来调整它们的发送带宽,调节算法如图2所示.当新的组播组x加入没有引发网络拥塞时,按照组播组x的带宽需求wxn来支配带宽,业务流不压缩,提供原始的视频质量(最好).其它在线的VoD组播组业务流的发送带宽不作调整,它们也提供不压缩的最好的视频质量.当要引发拥塞时,为了避免Page5拥塞发生,要对组播组x的业务流进行压缩,其它在线的VoD组播组业务流都要通过压缩来调整发送速率.压缩率按照式(4)计算,对组播组x,其指配的业务流发送带宽为wxa=rx×wxn,对其它在线的组播组,其业务流的发送带宽调整为i∈Nvod:wia=ri×w.对组播组x,资源的分配算法可以用下面的伪代码表示:wxa=wxn+∑Nvod对MPEG2/4以及H.264压缩编码算法,压缩分为无损压缩和有损压缩两种,其中无损压缩是通过数学变换算法来实现的,如矩阵的对角变换等,有损压缩是通过帧内、帧间预测算法以及帧速率和帧体积调整等机制来实现[16-17],压缩率越低,其对视频质量的影响越小.式(4)参考所有在线组播组的价值来定义压缩率算法,不但可通过调节供求关系避免拥塞,而且可以保证价值大的组播组拥有最小的压缩率,提供最好的视频质量.因此,机制实现了网络资源基于效用的优化.图3低时延抖动下行帧结构(1)变变长帧为定长帧.Ethernet下行帧长度可在64~1518Bytes之间选择,是产生时延抖动主要原因,采用定长帧,可以将相邻下行帧中的数据包的时延抖动限制在一个范围内.(2)变变数据包长为定数据包长.在不同的帧中,变变体积的同组播组数据包为等体积数据包,不同组播组的数据包的大小和QoS优先级相关,级别越高,数据包越大.一个组播组业务流的数据包的大小可表示为其中,Six表示在一个帧中效用优先级为i的组播组x的包的大小,L为总帧长度.(3)变无序为有序.在一个下行帧中,从头开始,按照效用优先级的大小,降序排列不同VoD组EPON的下行是基于LLID来过滤的,一个LLID可以是一个组播组、单拷贝广播SCB(SingleCopyBroadcast)或一个用户单播.下行帧中可以任意组装所有LLID的可变长数据包(64~1518Byte).因此,一个VoD组播组业务流的下行带宽是一个统计复用带宽,可以用发送的总时长表示:其中,tx和Tvod流x和所有已在线VoD组播组业务流的发送时间.2.4低时延抖动执行结构在OLT侧,通过实例化多个多点MAC控制实体来实现上层的多个MAC控制客户端同下层的多个MAC之间的接口.在ONU侧,仅使用一个MAC实体同OLT的一个MAC实体进行通信.MAC控制客户端同MAC实体的通信要经过OAM(Operation,Administration&Management)管理.为了减少时延抖动,针对抖动产生的原因[3-4],对变长无序的下行以太帧进行如图3所示的改进.播组数据包.Interent数据包放在VoD的后面,可以是变长的.高优先级别的数据包大,传输带宽高,在业务体积相同的情况下,最早传输完毕.采用倒序,可以保证帧结构稳定性.VoD一般是持续业务流,以上改进,可保证VoD数据包具有比较小的时延抖动.当下行带宽求大于供时,各个组播组业务流的压缩编码率增加,数据包减少,从而时延抖动增加.新的组播组的产生和组播用户数的动态变化会改变QoS优先级,帧中数据包顺序随之改变,从而引发时延抖动增加.增加的时延抖动可表示为其中,(jx)n2n1表示在两个连续帧中,组播组x的QoS优先级从第n1级变成n2级别时的时延抖动,等于在Page6一个帧中,发送优先级低于n2的所有数据包和优先级低于n1的所有数据包的时间差.VoD是具有timestamp的流式媒体,时延抖动对视频质量的影响较大,所以对于价值越高的VoD组播组,其时延抖动应尽量地小.在定帧长和定数据包大小的Ethernet帧中,优先级比较高的VoD组播组的业务流具有比较大的数据包,因此受其它VoD数据包的影响比较小,其时延抖动的变化较小.所有在线的VoD业务数据包采用倒序排列,整个VoD业务的时延具有较大的统计稳定性.因此,机制实现了VoD组播组业务流数据包的时延抖动基于效用的优化.3仿真和讨论为了检验本文提出机制的性能,实现了仿真系统,如图4.仿真网络:具有16个ONU,用户到ONU的接入链路速率是100Mbps,OLT到ONU的距离是10km.上行最大的周期是TMAX=2ms.分离两个连续的发送窗口的保证时间是5μs,下行帧的大小为L=1518Bytes.OLT中定义了3个优先级队列P0、P1和P2,缓存大小都是8Mbytes,3个优先级保证的最大带宽分别为100Mbps、600Mbps、300Mbps.EPON使用P1优先级,即Wvod=600Mbps.单位带宽的价格R=0.06yuan/Mbps.VoD的组播组的组建周期Tcmgs=120s.单位时间(1s)分配给VoD的发送时间Tvod用户级别:定义了3个用户级别,即J=3,金牌用户100个,银牌用户300个,铜牌用户为600个,分别共享相同的200MbpsVoD最大带宽.W1max=W2max=W3max=200Mbps.VoD业务:定义了300个VoD业务(组播),播放时长都为1小时.格式为(1)高清HD(HighDefinition):8Mbps,30F/s,1920×1080,宽高比169,价格为5元/次,总数50个.(2)标清SD(StandardDefinition):2Mbps,30F/s,640×480格式,宽高比43,价格为3元/次,总数50个.(3)普通清晰度LD(LowerDefinition):包括6种格式:①32kbps、10F/s和QCIF(QuarterCom-monIntermediateFormat)(176×144),0.5元/次,总数50个;②64kbps、15F/s和QCIF,0.6元/次,总数50个;③128kbps、15F/s和CIF(CommonInter-mediateFormat)(352×288),0.7元/次,总数50个;④256kbps、15F/s和QCIF,0.8元/次,总数50个;⑤512kbps、30F/s和CIF,0.9元/次,总数50个;⑥1024kbps、30F/s和CIF,1元/次,总数50个.实验结果及讨论:产生一个0~999的随机数,对应一个用户,该随机数模3的余数表示用户的级别,0表示金牌,1表示银牌,2表示铜牌.产生一个0~300之间的随机数,表示用户选择的组播组,该随机数模50的商表示组播组的VoD格式.带宽的效益:不同接入率下本机制和未改进的机制的VoD带宽的总价值比较,如表1所示.接入率/%10.710.7150882.61869.35561.3961.3955984.08968.7510143.76143.76601059.971044.4515249.56249.56651148.301132.0920326.83326.83701235.111218.1025425.22425.22751312.791295.1030523.01523.01801403.491385.1035620.29620.29851472.451453.8536.3645.33633.95901537.901518.7040709.39697.85951617.491598.1045809.30796.451001690.931670.80网络带宽的总价值的计算公式为其中,V表示所有VoD带宽的总价值,X表示总的组播数(300).未改进机制采用传统的编码压缩率公式:Page7即所有的组播组使用统一的压缩率,压缩率带宽的调度机制仍采用式(5).在接入率为36%时,带宽被用完,此前,两种机制的带宽总价值一样,因为两个都按照需求来提供带宽.之后,本机制的VoD总带宽价值始终要大于未改进机制,而且随着接入率增加快速增加.随着压缩率的增加,视频质量会降低,视频质量和压缩率之间的关系可以用图5所示.在[c0,1]为无损压缩,c0表示无损点.[c1,c0]为预测压缩,c1为预测点,对应的视频质量q0为临界清晰度,也就是用户可以接受的最差的画面质量.在[c2,c1]为帧速率压缩,c2点为裁员点,对应的视频质量q1为临界动画质量,也就是用户可以接收的最差的帧速率,在[0,c2]为帧体积压缩.本文提出的机制使价值最大的组播组业务流具有比较大的压缩率(压缩最少),因此,视频的质量比较好.视频质量直接影响到收视率,这样网络资源的价值就加速增加.在另外的关于收视率实验中,在1个小时内(VoD业务的平均时长为1个小时),本文的机制比没有改进的机制的价值平均要高大约15~20倍.率对比,如图6所示.丢包率比较:本机制和未压缩情况下的包丢失在接入率为0.42时,VoD带宽被用尽,未压缩的情况下包丢失率开始急剧增加,但使用本机制,丢包率一直维持很小.抖动情况,如图7所示.时延抖动:在不同接入率下第一个组播组时延当接入率为0.42时带宽被用完,此时发生大的实验结果显示:本机制可以提高带宽的效益,能时延抖动,但很快抖动就趋于平稳.够维持小的丢包率和小的时延抖动.4结论随着宽带接入技术的发展和普及,VoD业务得到了迅猛的发展,多播是最适合VoD特点的传输技术.EPON作为公认的新一代接入网络技术正得到广泛的应用,但在EPON中开展多播还存在时延抖动过大,带宽提供能力、包丢失率过高、“轻负载惩罚”、“低资源效益”等问题.本文提出了一个基于效用的EPONVoDQoS组播实现机制.在业务应用定义模块,通过为组播组实例化一个组播MAC和LLID,并启动发现过程对申请用户进行组播注册,从而充分利用EPON的数据链路层提供的便利机制容易地实现了组播.在业务类定义模块,在综合了业务的市场特性、网络特性和用户群特性的基础上,提出了一个基于效用的组播组QoS优先级(效用优先级)算法,通过资源调度模块在拥塞发生时基于效用优先级对编码压缩率和资源分配计划进行调度,不但节省了带宽需求,减少了包丢失率,而且通过将资源汇聚到高价值VoD业务和高级别的组播群用户上,提高了带宽的使用价值,较好地解决了“资源低效益”问题.在执行机构模块,通过对EPON无序、变长的下行以太广播帧进行了有序、定帧长和定组播包包长的改进,有效减少了VoD业务流数据包的时延抖动.仿真实验结果显示,在网络拥塞的时候,本机制可以提高带宽的效益,保持低的丢包率和低的时延抖动.
