Page1软体多局部破碎特效研究曾亮吴亚刚(国防科学技术大学计算机学院软件所长沙410073)摘要基于物理的软体仿真与动画是计算机图形学的研究热点之一,但大多数方法计算复杂度较高,难以获得实时性交互.文中在虚节点算法基础上,提出了一种软体多局部破碎特效行为描述算法,该算法通过判别组成软体物理模型的质点受力、弹簧结构损伤情况,对模型进行局部几何拓扑重构,较好地描述了软体局部破碎行为.此外,在闭合压力模型理论基础上,结合质点弹簧系统,实现了一个实时交互的软体仿真平台.实验证明,整个软体仿真及多局部破碎特效过程可以获得稳定、实时交互、具有物理真实感的效果.关键词软体仿真;虚节点;局部破碎;质点弹簧系统;拓扑重构1引言近年来,真实感实体形变的物理仿真与动画越来越引起图形学界研究者的兴趣.软体(SoftBody)仿真,在医疗外科手术模拟中扮演了重要角色[1].随着可编程图形硬件的大众化投入使用,游戏、娱乐、影视动画等领域也越来越需要复杂、真实感的软体、粘性体形变及其破碎的相关特效;如果把刚性物体(rigidbody)看成是软体的特例[2],那么刚性物体在外力作用下的形变和破碎研究,也将从软体仿真的相关研究中获得启发.在软体模拟方面,目前主要有两种方法:质点弹簧系统(MassSpringSystem,MSS)[1,3-6]方法和有限元方法(FiniteElementMethod,FEM)[7-8].质点弹簧系统由于易理解、易实现,已被研究者广泛应用在诸多软体类仿真中,包括图形硬件加速的外科手术模拟[1]、布料建模仿真[3]、三维火焰仿真[4]、闭合压力模型软体仿真[5]以及实时毛发模拟[9]等,均可采用质点弹簧系统进行模拟.文献[7-8]使用有限元Page2法进行软体仿真,有限元法在算法设计上具有非常高的复杂性[2],它能获得逼真的效果但一般难以达到实时性要求,因此一般出现在工程应用领域.此外,研究者们一直在致力于软体仿真领域其它问题的研究:文献[6]在文献[5]的理论基础上描述了软体仿真中的一种漏气现象;文献[10]使用Navier-Stokes方法,描述了压缩流在封闭网格中的流动属性,较好地体现了软体的行为,但最大的缺陷就是无法达到实时模拟[2];文献[11]解决了布料仿真中三角形对之间的快速碰撞检测问题.在一些物理引擎诸如ODE、Physx、Havok、Bullet中,也都较成功地展示了软体仿真效果.目前软体仿真中依然存在许多具有挑战性的问题,高效实时的碰撞检测(含自身碰撞检测)、逼真的破碎行为、不同材质特征体现等都有待解决.尤其是针对软体的破碎行为,目前的研究文献中往往很少提及.本文在文献[5-6]的闭合压力理论基础上,融合虚节点算法[12]思想,提出并验证了软体多局部破碎特效模拟的描述算法.该方法以引发破碎行为的弹簧、质点为出发点,将虚节点分散在邻接三角面片中进行局部拓扑重构.虚节点的增加离散了物理模型局部区域弹簧的紧耦合性,随着仿真过程的推移,逐渐形成了局部裂缝、局部破碎块,较好地展现了软体仿真中的破碎现象.2软体仿真建模本文软体仿真过程吸取了当前该领域成熟方法的优点,软体建模采用质点弹簧模型1,将软体表面网格模型的边作为弹簧,把离散的顶点看作弹簧系统中的质点,由弹簧进行连接.质点的运动遵循物理规律,同时软体内部看作由一定数量的某种理想气体填充,且该气体的运动遵循热力学方程.2.1质点弹簧模型质点弹簧模型将软体表面网格看成一系列质点以及连接相邻质点的弹簧所组成[4].对于一个三维表面(实体)模型,我们可以假想该对象的质量离散分布在模型的顶点上,顶点通过边连接,而边则是我们所关注的质点弹簧系统中的弹簧,这种映射关系实现了从几何模型到物理模型的转化工作.质点弹簧系统是一个动态平衡系统,质点在外力(含自身重力)作用下发生位移,相邻质点的位移差导致连接该质点的弹簧发生形变,形变弹簧产生弹力反过来作用在两端的质点上.弹簧形变过程遵守胡克定律,如方程(1)所示;同时为抑制两相邻质点由相对位移所造成的粘滞性拖曳[5],在弹簧形变过程中引入振荡平衡力,有效避免了弹簧的无限振荡,其表达式如方程(2):方程(1)中,Fs是弹簧形变所产生的弹力,Ks为弹性系数,xj和xi则是弹簧所连接两质点的位移,lij0为两质点的初始位移差,也即弹簧的原始长度;方程(2)中Kd为弹簧振荡系数,vi和vj为质点的速度.Fs、Fd的度量遵从牛顿定律,弹簧两端的质点受弹性作用力大小相同,方向相反.弹性系数Fs、Ks的参数值设置则依据软体所要表征实体的物理属性而定.弹簧的原始长度则与其所映射的实体几何模型边的长度成比例.2.2运动学模型由于质点具有质量属性,当有外力(重力、弹力)的作用时,由牛顿第二定律我们可以获得该质点的加速度,如方程(3)所示;在此基础上,使用直观的显式欧拉积分方法[3,7],可获得质点的速度、位移属性,它们记录了质点的运动状态,如方程(4)、(5)所示:质点的上述运动学属性值是文中软体仿真平台进行渲染的基本对象,随着仿真过程按时间步长推进,质点的位移不断发生变化,质点位移差引起的弹力作用在质点上又推动了质点的运动,整个运动过程形成了软体形变运动学模型.2.3闭合压力模型文献[5]中提出闭合压力模型,在封闭表面模型中充入一定数量的理想气体,该气体会与模型表面产生微观相互作用,这种作用最终以气体压强的形式体现出来.依据克劳修斯———克拉佩(Clausius-Clapeyron)状态方程,可以获得软体内部压强、体积、温度等的数学关系,其表述如下:方程(6)中P代表压强值,V是形变软体的体积,n为理想气体的摩尔数,R则是气态常量,T为温度值.在仿真过程中,我们设定方程(6)中右边表达式的值保持不变,以常量Kp表述,因此当求解了形变软体的体积后,可以依据公式(7)求解压强值:依据方程(7)所获得的压强,对于仿真过程中由三角面片组成的几何模型,通过数值积分方法可求得几何面片面积S,则作用在面片上的力为Page3在方程(8)基础上数乘该面片的法向量,即可获得作用在该面片上具有物理意义的力,作用力的计算如方程(9)所示:通过加权平均的形式将作用在面片上的力分散作用在组成面片的3个质点上,最后对每个质点的所受的弹力、气体压力等进行矢量累加,将结果与运动学模型中的方程(3)相结合,软体仿真的3个重要环节耦合在一起了.3虚节点算法、局部破碎行为3.1虚节点算法虚节点算法(virtualnodealgorithm)是斯坦福大学FedkiwRon教授在文献[12]中提出,用于仿真过程中改变模型的拓扑结构,它解决了仿真过程中材质断裂和分离的问题.算法中,当把一个节点从图1虚节点算法3.2局部破碎行为研究破碎行为,必须解决破碎的发生时机以及如何对破碎行为进行描述这两个关键问题.破碎的触发,在质点弹簧系统中被定义为由于某弹簧受力作用超过其最大限度而引发;当某弹簧处引发破碎行为时,我们以该弹簧两个端点为母本生成虚节点,虚节点分散在与该弹簧相邻接的三角面片中进行几何拓扑重构,虚节点离散了质点弹簧模型局部区域图2局部破碎行为上面阐述的是局部破碎描述算法中以弹簧为参考对象的情况,它是在虚节点算法思想启发下提出的最为直观的局部破碎描述算法的一个部分.如果我们从虚节点算法的本质思想出发,也即从材质核心点出发,也可提炼出一种破碎行为表达方式.在图1中我们可以看出,如果以材质核心点为中心,通它所属环中切割出去时,将以该环的中心点为基准,生成一系列虚节点.新生成的虚节点将获得中心点物理属性的一个拷贝,然后这些虚节点参与到周围的网格面片中进行拓扑重组,构成新的三角面片.重组过程决定了网格破碎的自由度,虚节点算法的核心是虚节点拓扑重组.虚节点算法首先计算环中心点的位置,依据所属环中共享该中心点的三角面片数,生成相应数目的虚节点,生成的虚节点将分别代替三角面片原来所共享的环中心点进行拓扑重组,重组过程保持了原网格模型的闭合性,其示意图如图1所示.图1中,用箭头指明、圆圈标注的环中心点即将被分割出去,该点是文献[12]中提到的材质核心点.原网格拓扑结构中周边共有6个面片共享了该材质核心点,因此当它被分离出去时,将以它为母本拷贝物理属性形成6个虚节点,新生成的节点分散到共享核心节点的面片中,形成新的拓扑结构.弹簧的紧耦合性.在引发破碎弹簧的两个端点之间,线性插值形成两个虚节点,虚节点具有与端点成线性比例的位置、速度、质量.同时,共享该弹簧所代表的边的三角面片将重新实例化,不再参与仿真过程,相应由加入了虚节点的新面片替代.随着虚节点的继续运动,将会在新生成的三角面片之间形成一定的缝隙区域,我们把它定义为裂缝.裂缝形成过程描述图如图2所示.过与虚节点的组合构成材质核心块,形成的核心块恰好是即将破碎分离出去的碎片,这样一种破碎方式较之于裂缝的形成更具有直观性.核心块的形成示意图如图3所示.图3中,核心点受到外界作用即将引发局部核心块的分离.同样是以核心点为母本拷贝形成虚节Page4点,原来共享核心点的面片上的两个虚节点两两相连形成新的弹簧,新生成的弹簧首尾相连形成了核心材质块.新生成的虚节点还必须再次生成自身的拷贝以进行所在面片剩余部分拓扑重组,该项重组过程保证了原模型的闭合性.核心材质块将在虚节点的运动下逐渐分离出去,形成了软体局部的块状破碎效果.步骤如下:综合上述步骤,提炼的局部破碎行为描述算法模型;向量;1.质点弹簧系统参数初始化;2.载入软体几何模型;3.几何模型映射为对应于质点弹簧系统结构的物理4.对动力学运动方程进行欧拉积分:4.1.遍历各质点,更新外力作用;4.2.计算弹性形变产生的拉力,对质点累积弹性作用;4.3.计算软体体积,更新几何模型三角面片面积、法4.4.更新气体压强,对质点积累理想气体压力作用;4.5.求解质点加速度,更新速度、位移等物理属性;5.破碎检测:5.1.遍历弹簧,判定弹簧形变程度是否超出最大限度;5.2.超过:搜索包含此弹簧端点的面片,生成虚节点,图3核心材质块形成添加新弹簧,重组局部拓扑关系;5.3.检测是否有核心点受力超出最大限度;5.4.有,生成虚节点重构形成核心块,同时保留原始模5.5.是否结束仿真过程,否则转步4继续.型的闭合性;4系统验证为了验证软体仿真模型和局部破碎行为描述算法,本文对布料形变、软体碰撞以及软体多局部破碎三种情况进行了测试.仿真平台以质点弹簧系统为基础,结合欧拉积分方法,采用OpenGL进行绘制,在WindowsXP系统上获得了具有物理真实感、实时交互的效果.4.1布料形变基于质点弹簧系统的布料仿真是软体仿真的基础,环境空间设置为一个连续变化的风场,该风场将作用在质点弹簧系统的每一个质点上.结构组织良好的质点会在弹簧的弹性作用下进行有规律的物理运动,从而达到布料实时形变的效果.本文软体仿真平台中二维布料仿真效果图如图4所示.图4中,左图为布料弹簧系统组织结构图,线框显示为弹簧和质点;右图为布料在持续风场作用下的形变,双面光照渲染.4.2软体碰撞软体由封闭几何模型的边和顶点通过质点弹簧系统构造而成,内部填充一定数量的理想气体.仿真过程中,软体在外力(重力、外界交互力)作用下下落,当与地面发生碰撞后,软体内部气压发生变化,由气压引起的内壁压力又作用在每个质点上,引起质点新的运动.整个运动过程包含简易碰撞检测,且遵循动力学规律,获得了逼真的物理效果,软体实时仿真效果图如图5所示.图5中左图显示为形变过程中的软体拓扑结构,线框模型渲染的球面为软体相应质点弹簧模型的弹簧和质点;右图为软体与地面发生碰撞后的挤压效果.图中四周为木板材质墙壁,深色球体代表软体下落过程中的障碍物,浅色球体为软体仿真对象:球面模型的软体.4.3多局部破碎行为当某弹簧处引发破碎行为,以该弹簧某一端点为中心生成虚节点,虚节点分散在与原始中心相邻接的三角面片中进行几何拓扑重构,新增的虚节点离散了质点弹簧模型局部区域弹簧的紧耦合性,形Page5成了局部破碎.随着虚节点的继续运动,将会在新生成的三角面片之间形成裂缝.同时,核心块的分离也形成了较大程度上的破碎效果.仿真平台中的多局部破碎效果图如图6所示.图6多局部破碎特效(左图:椭圆标示处发生了局部破碎行为;右图:局部破碎引发的软体收缩(由内部气压变化引起).整个仿真平台采引入光照、双面渲染)5总结本文提出了一种软体多局部破碎特效行为描述算法,该算法以引发破碎行为的弹簧、质点为出发点,将虚节点分散在邻接三角面片中进行局部拓扑重构.虚节点的增加离散了物理模型局部区域弹簧的紧耦合性,随着仿真过程的推移,逐渐形成了局部裂缝、局部破碎块,较好地模拟了软体仿真中的破碎现象.同时,本文基于质点弹簧系统的软体及其破碎仿真平台,在虚拟现实、影视动画制作、虚拟手术等方面有较强应用价值.
