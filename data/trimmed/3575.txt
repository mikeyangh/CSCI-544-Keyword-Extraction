Page1一种无线传感器网络MAC协议优化算法刘云璐1)蒲菊华1)方维维2)熊璋1)1)(北京航空航天大学计算机科学与工程学院北京100191)2)(北京交通大学计算机与信息技术学院北京100044)摘要在无线传感器网络中,各节点采集的信息以多跳的方式传送到汇聚点.从各节点到汇聚点形成一棵以汇聚点为根的传输树.文中在对无线传感器网络传输特点分析的基础上,剖析了基于CSMA/CA(载波多路监听/冲突避免)的MAC协议在树状结构无线传感器网络中的弊端,提出了一种基于CSMA/CA的MAC协议优化算法.算法基于节点在传输树中的位置信息调整其MAC信道接入分配,将CSMA/CA采用的各节点均等竞争信道的方法优化为各节点依据在传输树中的位置情况竞争信道的方式,这一优化提高了节点公平性,使MAC信道接入分配与树状结构的无线传感器网络传输特点相契合,解决了基于CSMA/CA的MAC协议与树状结构无线传感器网络不匹配的问题,从而减少了信道资源浪费,提高了网络传输效率,降低了能耗.实验结果表明该算法在网络丢包率、吞吐量和能耗方面的性能均有较大改进.关键词物联网;无线传感器网络;传输树;MAC协议1引言无线传感器网络是物联网的支撑技术之一,具有广阔的应用前景和许多不同于传统无线网络的特点[1].典型的无线传感器网络采用汇聚点(Sink)收集网络中的数据,各节点采集的数据通过其它节点转发以多跳的方式最终传输到汇聚点,整个网络的信息向汇聚点传输的过程形成一棵以汇聚点为根的传输树,这种网络模式是传感器网络最主要的信息传输模式之一[2].在传输树中,上层节点承载的传送任务不仅包括节点本身的数据采集,还包括下层节点的数据转发.因此,网络负载会在上层节点处累积.一般地基于CSMA/CA的无线MAC协议为网络中每个节点提供同等的信道访问机会,这种策略比较适用于传统的Ad_hoc网络.在传统的Ad_hoc网络中,每个节点都可以是信息传输的目标节点,网络负载的分布没有一定的规律,平等的信道访问机会对各节点是公平适用的.但是在树状传感器网络中信息传输有固定的目标汇聚点,上层节点负载较重,同等的信道访问机会平均到每条信息,则每条信息在上层节点处的发送概率将明显低于其在下层节点处的发送概率.并且当网络在一段时间内持续繁忙时,上层节点处的信息由于发送概率低而累积,下层节点的信息持续传送到上层节点处并逐渐在上层节点处形成拥塞,甚至被丢弃.显然,用于发送这些最终被丢弃信息的资源(包括信道、能量等)被浪费了.这一问题是由基于CSMA/CA的无线MAC协议和树状传输结构的传感器网络的传输特点不相符造成的.本文针对上述问题,基于树状传输结构的无线传感器网络应用,提出一种基于CSMA/CA的无线MAC协议的优化算法和信道抢占解决方案.本文第2节给出相关领域的研究现状,介绍本文工作的特点和贡献;第3节描述本文工作采用的网络模型和相关定义;第4节讨论树状传感器网络的传输特点,并给出算法的数学推导和证明;第5节阐述本文算法的流程;第6节给出算法在丢包率、吞吐量和能耗方面的性能实验验证与分析;最后是本文的结论.2相关工作近年来,各国学者针对传感器网络的高效传输问题,做了很多研究,包括从MAC层、路由层到传输层的优化改进,有效地降低了网络丢包率和能耗,增强了网络的可靠性.本文着重分析MAC层的解决方案.传感器网络MAC协议根据信道分配方式可以分为三类:基于CSMA/CA的协议、调度协议和混合MAC协议.基于CSMA/CA的协议不存在网络同步问题,扩展性好.调度协议能有效利用资源,但一般需要中央节点调度,在复杂网络情况下部署有效的调度协议被证明是NP-hard问题[3],并且以TDMA协议族为代表的调度协议通常有时钟同步要求,时钟同步需要节点频繁交换控制信息,这将大大增加网络能耗.因此,由于传感器节点及网络布设的局限性,以TDMA协议族为代表的调度协议较少在传感器网络中直接采用[4].混合协议结合了上述两种协议的优点,但通常比较复杂,难以配置[5].基于CSMA/CA的协议是传感器网络中比较常用的一种方式,研究也最为活跃,下面我们对该领域的代表性成果加以分析.一般基于CSMA/CA的传感器网络MAC协议是在采用DCF(分布协调功能)的IEEE802.11[6]的基础上进行的优化和改进,其信道竞争的核心思想是:当节点发送数据时,先监听信道是否繁忙.如果繁忙,节点等待一定时间后再尝试发送;如果再次发生冲突,节点按一定的策略重发信息,直到信息发送成功或放弃.SMAC(Sensor-MAC)[7]是第一个完全针对传感器网络设计的基于IEEE802.11的MAC协议,它的重要贡献是引入了节点休眠机制,即节点定期休眠,相邻节点休眠调度周期同步.TMAC[8]是在SMAC基础上的改进,对节点休眠的策略进行了适度的调整,例如根据网络状况动态调整节点休眠时间以提高协议效率.B-MAC[9]、WiseMAC[10]、X-MAC[11]和Z-MAC[4]协议在SMAC协议的基础上,采用前导序列技术提高了休眠唤醒决策的精度,无需节点同步.P-MAC[12]协议根据网络流量自适应地调整休眠调度.Sift协议[13]针对事件驱动的传感器网络应用,当多个节点同时检测到同一个事件,只保证其中的部分节点发送检测信息,一定程度上降低了网络冲突的概率,但协议基于严格的时钟同步.DMAC[14]协议提出根据网络传输的树状结构,调整休眠调度策略,使得下层节点的发送时间与上层节点的接收时间相对应.所述的传感器网络MAC协议的信道接入机制均沿用IEEE802.11协议的DCF机制,本文称它们属于IEEE802.11协议族.它们主要从休眠调度策略方面对MAC协议进行优化改进,没有针对本文所述的树状传输结构网络所存在的信道分配问题提出解Page3决方案.调度协议以TDMA协议族为代表,下面介绍调度协议相关研究成果.TRAMA协议[15]提供了根据流量预先分配时间槽的无冲突通信,它属于TDMA协议族,时间同步及时间槽分配调度的资源耗费是这类算法应用的瓶颈,且这类算法复杂、实现难度大.本文算法属于基于CSMA/CA的协议,但根据网络结构调整了信道接入概率参数,与TDMA协议族相比,本文算法由于没有涉及到时间槽调度算法,总体上规避了TDMA协议族的局限(如时钟同步).混合协议是基于CSMA/CA的协议与调度协议的结合,与本文算法解决的问题不同.本文算法的目标是解决传感器网络树状传输结构引入的问题,即在传输树中,由于信息在上层节点处的发送概率低于在下层节点处的发送概率而造成的传输效率低下及信道和能量资源浪费等问题.以Z-MAC为代表的混合协议解决的是MAC层单跳信息发送冲突的问题[4],并没有考虑传感器网络结构引入的传输问题.Funneling-MAC[16]在全网采用CSMA协议,在汇聚点周围的漏斗区域按需采用TDMA协议,虽然将TDMA协议仅限制在汇聚点附近,并由汇聚点实施时间槽调度,避免了TDMA协议时间槽调度算法在传感节点难以部署的问题,但随网络规模的增大,漏斗区范围扩大,时间槽调度的复杂度和向各节点周期性部署的耗费都随之大大增加,TDMA协议的时钟同步问题也并未避免.时钟同步信息的交互耗费对能耗要求极高的传感器网络是不容小视的负担,也是本文算法不考虑TDMA类协议的重要原因之一.在一些涉及MAC层优化的算法中,采用了优先级设置方案[17],根据设计目标,在MAC层为信息设置不同的优先级[18-20].文献[18]通过调整MAC层延迟等待窗口,给予拥塞节点更多的信道占有机会,以帮助缓解拥塞.文献[19]针对无固定汇聚点的无线网络应用,给予数据流不同的MAC层优先级.文献[20]在网格结构的网络中,给予等候信道时间较长的节点更多的信道抢占几率.这些算法分别是根据不同的网络传输结构需要提出的MAC层优化算法,但极少涉及本文所述的问题.本文针对树状结构的传感器网络应用,优化基于CSMA/CA的无线MAC协议.与以上所述方法不同,本文算法采用设置MAC层最小竞争窗口的方法来实现信道的非均等分配,并非设置信息或节点的优先级,即不干预网络运行的动态参数,节点或信息没有优先等级.算法优化了在信息碰撞情况下的信道分配方式,因此具有较高的自适应性:在网络轻载情况下,由于不存在信息拥塞和不公平问题,算法运行与IEEE802.11协议相近;在网络重载情况下,算法通过调整MAC层最小竞争窗口给予节点不同的信道接入概率,以解决前面所述的IEEE802.11协议族与树状传感器网络应用不匹配的问题.3网络模型本文描述的网络模型针对上行传输的树状传感器网络应用,如图1所示.我们对网络模型给出以下假设:(1)网络中节点静止,在初始网络部署后,传感(2)在节点传输半径范围内的点,是可连通点,整个网络为连通网络,即从汇聚点可以通过多跳的方式与任一节点通信;器节点和汇聚点静止;(3)节点能量主要消耗在通信中,根据文献[21]中的测量,设定发送信息消耗的能量为接收信息消耗的能量的两倍.在检测区域中,给定N个传感器节点和汇聚点s构成连通网络,用无向图G=(V,E)表示,V表示传感器节点的集合,E是节点间双向链路集合.以汇聚点为根节点在G中可以生成一棵M层的传输树T.如图1所示,为一棵以汇聚点为根的上行传输树.在以上所述的网络模型中,传输树T中的任一非叶节点既要发送自己检测的信息,又承担了子节点数据的转发工作.在传输树T中,距汇聚点越近且子节点越多的节点,承载的发送任务就相应越重.我们称这种情况为无线传感器网络的非均衡传输特Page4点,描述如下:在上行传输的树状无线传感器网络中,非叶节点n的负载量不少于它的所有子节点的负载量的总和.对于任一节点n:(1)若在T中距汇聚点的跳数为i,则在T中的层次为li或l(n);所有层次为li或l(n)的节点集合为Li或L(n);(2)子节点集合为Dn;层li或l(n)的子节点集合(层中所有节点的子节点组成的集合)为Dli或Dl(n),;层li或l(n)的平均子节点数(层中所有节点子节点数的平均值)为珡Dli或珡Dl(n);网络总平均子节点数为珡D=∑M-1(3)子节点系数为αn=|Dn|/(珡Dl(n)),珡Dl(n)≠0即子节点数与层平均子节点数的比值,当n为叶子节点时,珡Dl(n)=0,系数为0.图2IEEE802.11DCF信道分配机制[22]在无线Ad_hoc网络中,由于目标节点分散,网络负载是无规律分布的,因此这种公平的信道竞争机制能够得到比较好的效果.本文所述的无线传感器网络模型,在传输树T中父节点和子节点的关系固定,并存在上节所述的非均衡传输特点,即父节点的负载量不少于它所有子节点负载量的总和,当信道持续繁忙一段时间,由于父节点只能和子节点以相同的概率抢占信道,导致信息在父节点处累积,以至于信息极易由于缓存溢出而被丢弃.子节点成功抢占信道发送到父节点处的信息会进一步加重父节点负担和丢包率,同时,子节点的这种无效发送,还浪费了带宽和能量资源.因此,均等信道抢占机制并不完全适用于本文所述的网络模型,应给予父节点相对于子节点更多的信道抢占机会.最小竞争窗口的大小是决定信道抢占概率的一个重要参数,本文着重探讨怎样针对所述网络模型为T中节点设置最小竞争窗口值,以合理分配信道使其符合树状网络模型的传输特点.如第2节所述,基于CSMA/CA的传感器网络MAC协议众多,但信道接入方法主要是基于4问题描述及理论分析4.1信道分配基于CSMA/CA的无线网络MAC协议(以IEEE802.11DCF为例,如图2所示),其信道分配的基本原理是:节点在发送信息前监听信道,如果信道繁忙,则随机等待一个时间段,等待的时间段大小是从0到竞争窗口大小之间的随机数.每当网络空闲时间达到DIFS(DistributedInter-FrameSpace)时间段长度时,延迟计数器减1,直到延迟计数器为0,节点开始发送数据,当发送冲突时,竞争窗口按一定的规律增加,信息重新等待发送,直到竞争窗口大小达到最大竞争窗口值.网络中节点的竞争窗口初始值取统一设置的最小竞争窗口值,保证了节点拥有均等的信道抢占机会[6],这是一种公平的信道竞争机制.IEEE802.11协议的DCF算法,因此本文算法基于IEEE802.11协议的DCF.4.2最小竞争窗口计算方法由前面的分析可知,对在树状结构的无线传感器网络进行MAC层传输控制的核心是分配给父节点相对于子节点更多的信道抢占机会.而从整个传输树T来看,越上层的节点负载越重,相对信道占有率应该越高.在源负载均匀分布的情况下,节点的总负载量取决于它转发的信息量,节点的转发信息量与节点在T中的层次和子节点的数量密切相关.设每个节点源信息量为1单位,如图3所示的传输树结构负载分布显示:越靠近汇聚点且子节点数量越多,其负载量就越大.在源负载不均衡的情况下,仅考虑根据负载量来调整信道分配难以满足节点公平性的要求:按负载量调整信道分配使得源信息数小的节点发送成功的信息量会小于源信息数大的节点,源信息数小的节点的信息甚至会被源信息数大的节点的信息淹没,使得源信息数小的节点无法传达信息.这是不可取的,因为很多传感器应用的基本Page5要求是要能从各个节点平等的接收信息.因此,在信道分配中,应以节点数为分配依据.为此,本文首先依据传输树的层次为每层计算其层最小竞争窗口图3负载分布图4.2.1层最小竞争窗口计算信道分配与节点在传输树中的层次直接相关,层次最小竞争窗口从总体上为传输树中各层设置了最小竞争窗口的基准值.层次最小竞争窗口值根据上层节点的最小竞争窗口值和上层平均子节点数计算给出,保证了每层的最小竞争窗口值不小于其上层值.层最小竞争窗口计算公式如下:CWli+1min=其中,CW0CWlimin表示li层的最小竞争窗口值,A是根据网络规模预先给定的常数(A>CW0口的一个上限(参见定理1),A的设定可以避免由于最小竞争窗口值过大而导致节点长期无法抢占信道.公式中每层的最小竞争窗口值都是由上层的最小竞争窗口值和平均节点数以及预先设定的网络参数决定的.相邻两层的最小竞争窗口值差异是由上层的平均子节点数直接决定的,χ为调整系数,由网络的总平均子节点数和预先设定的根节点最小竞争窗口值及常数A决定,每层最小竞争窗口的计算采用相同的χ值,对于给定的网络和预置参数,χ固定.定理1.A为层最小竞争窗口值的一个上限.证明.iM,我们有CWlMmin=CWlM-1min×(1+珡DlM-1)χ根据算术几何平均不等式,我们得到[(1+珡Dl0)×(1+珡Dl1)×…×(1+珡Dlm-1)]值,并根据各节点的子节点数量和所在层最小竞争窗口值,给出每个节点的最小竞争窗口值.((1+珡Dl0+1+珡Dl1+…+1+珡Dlm-1)/M)M=(1+珡D)M.因此,min,4.2.2节点最小竞争窗口计算如图3所示,在T中同层的节点由于子节点的数量可能不同,其数据负载量也会存在差异,因此,对于同层节点以所在层最小竞争窗口值为基准,并根据子节点的数量计算各节点的最小竞争窗口值.节点n的最小竞争窗口的计算公式为:CWnmin=((1-Bl(n))e1-αn+Bl(n))×CWl(n)烅烄CWl(n)烆其中,αn为子节点系数,它是节点子节点数与层平均子节点数的比值,Bl(n)为层调整系数,保证节点的最小竞争窗口取值在上层最小竞争窗口值和本层最小竞争窗口值之间.它的父节点m的最小竞争窗口值.式(2),我们有(1+珡D)M>1,A/CW0χ>0.定理2.任一节点n的最小竞争窗口值大于证明.由珡D>0,M>0,0<CW0iM,(1+珡Dli)χ>1,由式(1),我们得到CWli+1min>CWlimin.如果αn>1,因为0<1/1+珡Dl(n)-11及χ>0,由式(4),我们得到0<Bl(n)1.由0<e1-αn<1,我们得到0<(1-Bl(n))e1-αn<1-Bl(n),Bl(n)<(1-Bl(n))e1-αn+Bl(n)<1.由式(1)~(4),我们有Bl(n)×CWl(n)及((1-Bl(n))e1-αn+Bl(n))×CWl(n)Page6CWnCWl(m)由式(3),我们有CWl(n)-1如果αm>1,我们有CWmmin,则CWn如果αm1,我们有CWmmin>CWl(m)如果αn1,我们有CWn如果αm>1,我们有CWmmin>CWl(m)如果αm1,我们有CWmmin>CWl(m)因此,CWn定理2保证了父节点比其任一子节点拥有更多的信道抢占机会.符合传输树结构的非均衡传输特点,证明了算法的合理性.5设置算法CWl(n)CWl(n)最小竞争窗口的设置算法流程如图4所示,初始时汇聚点在全网广播一条查询信息,该信息携带跳数值h,初始为1,当任一节点n收到查询信息时,检查它的层数设置l(n)(初始设置为无穷大),如果层数设置大于信息跳数值,将层数设置为信息跳数值,并将信息上一跳节点设置为父节点;如果层数值图4算法流程图小于信息跳数值,设置其非叶节点标志位参数为1(初始为0);如果相等,丢弃信息.经过一轮查询信息设置,所有非叶节点标志位参数为0的节点向其父节点发送聚敛信息,该聚敛信息中加入自己的节点号和层数,所有收到聚敛信息的节点将加入自己的节点号和层数,并将该信息该转发给父节点.最终汇聚点收到聚敛信息,根据式(1)计算层最小竞争窗口的参数值,并根据式(1)和式(4)计算得到每层最小竞争窗口值和节点最小竞争窗口计算参数Bli.汇聚点将计算所得的各层最小竞争窗口值和参数Bli向网络中广播.各节点根据式(3)计算最小竞争窗口值并进行设置.6实验与评估我们采用NS2仿真器分别在20节点、50节点及100节点的网络中验证了本文提出的MAC优化方法在丢包率、吞吐量和能量消耗方面的效率.如在第2节中所述,调度协议及混合协议与本文算法由时钟同步及目标不同引入的低可比性,使得本文算法难以与此类算法进行性能比较;而基于CSMA/CA的传感器网络MAC协议,虽然在休眠等其它方面各有长处,但信道接入方法基本上沿用了IEEE802.11协议的DCF方式,即采用了相似的信Page7道接入方法.因此,优化算法与IEEE802.11协议的比较具有代表性.本文仅将MAC优化算法与基础的IEEE802.11协议的DCF进行比较.本文是对IEEE802.11协议族信道接入方法的优化,可以容易地植入IEEE802.11协议族中,与其它优化结合以提高总体效率.实验节点均匀部署在200m×200m的矩形区域内,节点通信半径为40m.实验采用2Mbps信道,数据包长度为512字节,便于算法在以后的工作中嵌入IEEE802.11协议进行扩展[23-24].依据文献[21]中的测量结果,每发送一个数据包的能耗设置为2单位,每接收一个数据包的能耗设置为1单位.6.1网络丢包率图5所示为IEEE802.11协议及本文算法在不同发送速率下的数据丢包率情况.如图5(a)所示,在20节点的网络中,本文算法相对于IEEE802.11图5丢包率6.2吞吐量图6所示为IEEE802.11及本文算法在20、50和100节点的网络中,在不同的发送速率下,网络吞吐量的情况.在如图6(a)所示的20节点网络实验协议丢包率减低超过20%.并且,随发送速率的增加本文算法的丢包率相对稳定.在图5(b)所示的50节点的网络实验中,我们测试了不同的A参数值,A值取32时,在速率较低的情况下丢包率有明显改善,但当速率达到500p/s时本文算法的丢包率与IEEE802.11协议接近;而当A值取256时,丢包率降低幅度较大,并且比较稳定,在高速率情况下,丢包率相对IEEE802.11协议依然降低了40%.在如图5(c)所示的100节点网络实验中,当A值取40时,本文算法相对于IEEE802.11协议并无明显改善,甚至在低发送速率时丢包率略有超出,这是由于在规模较大的网络中传输树的层数相应较多,采用较小的最小竞争窗口上限使接近汇聚点的节点最终设置的最小竞争窗口值过小,过小的竞争窗口值增加了冲突的几率并导致了丢包的增多.因此,需要根据网络规模相应调整A值.中,本文算法较IEEE802.11协议的吞吐量情况有较大改善,并随发送速率的增加优势更加明显.在如图6(b)所示的50节点网络实验中,A值取32时本文算法优势并不明显,A值取256时本文算法较Page8IEEE802.11协议有平稳改善且吞吐量提高50%左右.在如图6(c)所示的100节点网络实验中,A值取40时算法性能劣于IEEE802.11协议.吞吐量由信息发送量和丢包率决定,图5(c)中显示本文算法在A值取40时的丢包率与IEEE802.11协议持平,仅在低速率时稍有超出,则本文算法在A值取40时吞吐量较低的原因是较小的信息发送量.较小的图6吞吐量6.3能量消耗能量消耗是传感器网络算法性能的重要监测标准[25].如图7所示,我们测试了汇聚点每成功接收一个数据包网络的平均能量消耗.在图7(a)所示的20节点网络中,本文算法较IEEE802.11协议的能量消耗情况有较大改善,没有随发送速率的增加而快速增加.在速率达到250p/s以后,随着发送速率的增加,本文算法每成功接收一条数据的能耗有所降低.而与能耗相对,图5(a)中本文算法的丢包率在速率达到250p/s后保持稳定.这说明这段能耗降低的主要原因不是由于丢包率的下降.其原因是:采用本文算法后,随着发送速率的提高,越来越多的信息在更早的阶段被丢弃,减少了后续无效信息发送量产生的原因是由于过小的竞争窗口上限值,增加了发送冲突的几率,从而增加了信息重传率,降低了信息发送频率,从而减低了信息发送量.从图6(c)中可以看出,本文算法在A值取64时的吞吐量与IEEE802.11协议持平并在低速率时略好.A值取128和256时,本文算法较IEEE802.11协议已经有较大改善.传输步骤的能量消耗.在图7(c)所示的100节点网络实验中,与在图5(c)中观察的情况类似,当发送速率低于5p/s时,A值取40的算法的能耗稍差于IEEE802.11协议.原因与丢包率分析相同,较小的最小竞争窗口值上限使得在规模较大的网络中靠近汇聚点的最小竞争窗口值过小,导致冲突、丢包率和能源浪费的增加.7结束语本文针对基于CSMA/CA的IEEE802.11协议族与树状结构的无线传感器网络不匹配的问题,根据树状结构的无线传感器网络的非均衡传输特Page9图7能量耗费点,提出了一种基于CSMA/CA的MAC协议优化算法.算法根据节点在传输树中的层次和子节点的数量调整节点信道接入概率,给出了层次最小竞争窗口和节点最小竞争窗口的计算模型,理论上证明了模型符合树状网络传输特点,并给出了最小竞争窗口的上限.最后采用实验方法,证明了算法在丢包率,吞吐量和能耗方面均有较大幅度改善.致谢感谢美国卡内基梅隆大学计算机学院的Satyanarayanan教授及PeterSteenkiste教授对本文工作的支持和建议,同时感谢本文审稿专家和编辑,他们给出了宝贵的意见和建议!
