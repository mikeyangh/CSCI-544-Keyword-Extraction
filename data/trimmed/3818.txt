Page1基于查询意图的长尾查询推荐白露郭嘉丰曹雷程学旗(中国科学院计算技术研究所网络数据科学与工程研究中心北京100190)摘要查询推荐是一种提升用户搜索效率的重要工具.传统的查询推荐方法关注频度较高的查询,但对于那些频度较低的长尾查询,由于其信息的稀疏性而难以产生好的推荐效果.另外,传统的方法由于没有考虑查询意图对推荐结果的影响,故对长尾查询的推荐会受到查询中噪声单词的影响.该文提出了一种新的关于词项查询图(term-querygraph)概率混合模型,该模型能够准确地发掘出用户的查询意图.另外,文中还提出了一种融合查询意图的查询推荐方法,该方法可以将新查询中单词的推荐结果按查询意图自然地融合起来,从而避免了噪声单词对推荐结果的影响.实验结果表明,通过考虑查询意图,可以显著提高长尾查询推荐的相关性.关键词查询推荐;长尾查询;概率混合模型;查询意图;词项查询图1引言随着互联网的蓬勃发展,搜索引擎成为用户访问网络资源必不可少的工具.用户通过向搜索引擎提交查询来表达自己的信息需求.但是构造好的查询并非易事,为了帮助用户构造合适的查询,现代搜索引擎通过分析查询日志来提供查询推荐.现阶段Page2的查询推荐研究工作,大部分是关注于那些频度较高的用户查询.然而,已有研究工作表明[1],用户查询的频度分布服从长尾现象(“LongTail”)规律,即很大比例的用户查询的频度都很低,并且大多数用户都会向搜索引擎提交这种长尾查询;但是由于其信息的稀疏性,对于这类查询进行相关查询推荐的结果往往不能令人满意.因而,为长尾查询进行有效的相关查询推荐,将会极大地提高Web搜索效率,进而提升用户查询体验.针对长尾查询的查询推荐的研究工作开展较晚,一些方法通过单词信息扩充查询间的关系,来进行推荐.然而这类方法没有考虑到单词在查询中的不同作用,特别是忽略了查询意图对查询推荐的影响,从而导致较差的推荐结果.另外查询中有很多词是噪声词,过分考虑这类词会造成推荐结果偏离用户的查询意图.实际上一个单词ti对于查询q是否是噪声单词,是由查询q的查询意图决定的.比如有这样的两个查询“wwwconferencedeadline”和“wwwwikicomnet”,尽管这两个查询均包含“www”这个单词,但是所起作用明显不同,前者“www”表示该查询是关于国际互联网大会,而在“wwwwikicomnet”查询中,“www”却是无关紧要的噪声词.基于以上考虑,本文提出了一种关于词项查询图的概率混合模型.具体地讲,该模型用概率的方法建模查询意图,并解释了词项查询图中每个查询、每个单词以及每条边的产生过程.通过该模型,我们可以清晰地表示出蕴藏于词项查询图中的不同查询意图.另外,我们还提出一种新的长尾查询的推荐方法.该方法通过查询意图来衡量单词在查询中所起的作用,将不同单词的推荐结果按查询意图整合起来.实验数据表明我们的方法能够推荐出更加相关的查询.2相关工作概率混合模型是近年来出现的一种比较流行的数据分析方法.借助其清晰的定义和解释,概率混合模型被用到多个研究领域,如文本分析[2]、协同过滤[3]、社会网络分析[4]等等.其中比较有代表性的工作是Hofmann[5]提出的PLSA模型和Blei等人[6]提出的LDA模型.最近人们开始尝试用混合模型去解决社区发现的问题,并取得了一定的效果.其中Newman等人[7]提出的社区发现算法,能够发现可部分重叠的网络社区.Ramasco等人[8]基于Newman的方法提出了一种可以即建模单向和双向边的社区发现算法.Ren等人[9]从PLSA的角度出发,给出了一种概率化的社区发现算法,该算法假设有边相连的两个结点来自于同一个社区.受以上工作影响,我们构建了一种关于词项查询图的概率混合模型,该模型不仅能够建模查询和查询之间,以及查询和单词之间的关系,而且能够发掘出用户的查询意图.查询推荐一直是检索领域中一个重要问题.面对不同的推荐需求,人们提出了各种各样的模型和算法.比如Mei等人[10]使用hittingtime在click-though图上推荐语义相关查询.Zhu等人[11]通过利用带停止点的流行排序来推荐多样性查询.Guo等人[12]提出了一种结构化的推荐方法,该方法将推荐进行聚类来帮助用户更好地理解推荐.最近由Boldi等人[13]提出的查询流图(query-flowgraph)也被用于查询推荐,他们用在查询流图上进行个性化随机游走的方法进行查询推荐.在Boldino等人[14]的工作中,他们将查询流图映射到低维的欧式空间中进行查询推荐.长尾查询的推荐是近年来人们比较关注的问题.尽管这类查询中单个查询发生的频率较低,但其整体却占所有查询中不小的一部分.Song等人[15]利用伪反馈的方法扩展长尾查询的信息,通过url信息将clickgraph和skipgraph的推荐结果融合在一起.Pandey等人[16]对长尾查询中的广告效用进行了分析.Szpektor等人[17]利用模板和额外的本体信息对长尾查询进行推荐.在Bonchi等人[18]的工作中,长尾查询被分解到单词,然后通过随机游走推荐查询.受该项工作的启发,我们也使用了查询中的单词信息,但我们的方法建模了查询意图,因而能产生更加相关的推荐结果.3基于查询意图的长尾查询推荐方法在这一部分,我们首先介绍词项查询图的定义,然后我们将介绍一种基于词项查询图的概率混合模型,通过该模型可以得到用户的查询意图.最后,我们基于查询意图,用词项查询图上的个性化随机游走进行长尾查询推荐.3.1词项查询图由于词项查询图是查询流图的一种扩展,因此我们先介绍一下查询流图.查询流图是由Boldi等人[13]提出的一种新的用于挖掘查询日志信息的工Page3具.查询流图利用查询日志中的会话信息,将不同的查询连接起来构成一同质有向图.具体的说,如果我们在查询日志中有一查询会话集合S,我们用G=(V,E,W)表示与其对应一个查询流图,其中结点集合V=Q∪{s,t},Q是集合S中的所有查询,s,t分别表达两个特殊的虚拟结点:开始结点和终止结点.图1查询流图的构建在查询流图中,查询结点之间的关系只能通过查询会话中连续共现信息来建立.实际上在查询流图中有大量的查询虽然没有边相连,但是却因为包含同样的单词而具有相似或相关的语义.于是,Bonchi等人[18]提出一种被称为词项查询图的包含单词信息的扩展查询流图.如果还用G=(V,E,W)表示某一查询流图,而用G={V,E,W}表示其对应的一个词项查询图(如图2所示),那么V=V∪T,T={w1,w2,…}表示所有查询中的单词集合.E=E∪ETQ,ETQ表示词到查询的边集合,这样的边可定义为,如果某一查询q包含某个词wi,那么就有一条边wi→q.W=W∪WTQ,WTQ表示从单词到查询的转移频率集合.图2给出了图1对应的词项查询图.简洁起见,在词项查询图中,我们没有将起始节点s和终止节点t绘出.3.2基于词项查询图的概率混合模型这一节将具体介绍我们提出的一种新型的关于E是查询流图中边的集合,如果两个查询qa,qb是同一个查询会话中的连续的两个查询,那么在查询流图中就有一条从qa指向qb的有向边.W是边的权重集合.不同的应用场景权重的定义不同,这里我们仅用查询会话集合中的查询间转移频率来表示边的权重.图1展示了从一组查询会话中构建查询流图的过程.词项查询图的概率混合模型.实际上,我们的模型基于如下几点假设:(1)每一查询都是产生于某种查询意图.(2)在某一查询会话中,相邻的两个查询来自于同样的查询意图.(3)组成某个查询的所有单词都来自同样的查询意图.这几条假设比较简单直观,符合人们对查询及查询间关系的理解.具体的说,每一查询都是产生于某种查询意图,查询中单词蕴含了该种查询意图,用户在查询提交给搜索引擎之后,如果对搜索结果不满意,将会提交不同的查询来重新表述其查询意图.因而,查询会话中连续的查询是用户对其某一查询意图的多种表述.基于这样的认识,我们可以分析词项查询图中查询与查询、查询和单词间的关系来挖掘出查询意图和单词的相互关系.同传统的话题模型一样,这里我们也采用单词的分布来表达用户的查询意图.但是,相对于传统的话题模型(LDA[6],PLSA[5]),我们所学得的单词分布不仅能反映出单词的共现语义性质,而且能通过建模词项查询图中查询和查询之间的相互关系来影响查询中单词的产生方式,从而达到建模查询意图的目的.图3展示了产生词项查询图的概率图模型.具体的说,如果我们有一词项查询图G,其中查询节点的个数是N,查询和查询之间的边的数目是M,单词集合是T.我们假设这样的G是由K个查询意图产生的,βr是关于查询意图r的|T|维多项分布,|T|表示单词集合的大小.我们用eab来表示G中连接查询a,b的边.gab是一指示器变量,用来说明边eab来自于哪个查询意图.π是整个G中关于查询意图的K维多项分布.w表示在查询中出现的单词,|a|和|b|分别表示查询a和b中单词的个数.方便Page4起见,我们用Qd,i来表示在查询d中单词wi出现的次数,用Gab来表示连接节点a和b边的权重,使用如上的符号的定义,我们给出一条连接查询a和b的边eab的产生过程:过程1.产生边eab的过程.1.对于边eab,我们首先按照K维多项分布π2.对于查询a,我们按照|T|维多项分布βr选取3.对于查询b,我们按照|T|维多项分布βr选取根据上述过程,我们可以写出产生边eab且选取某个意图r.|a|个单词组成查询a.|b|个单词组成查询b.gab=r的概率如下:Pr(eab,gab=r)=Pr(gab=r)·将变量gab积掉,我们可以得到关于边eab的概率:通过建模每一条边的产生概率,我们可以得到关于整个G似然函数如下定义:Pr(Gπ,β)=∏eab∈E∑K从上式可以看出,π和β是控制似然函数Pr(G|π,β)参数.一般来说,通过最大化似然函数可以将模型参数求出,但是由于上式中连乘的每一项都是由累加计算而来,这使得直接最大化似然函数比较复杂.基于这种考虑,这里我们采用EM算法来迭代的最大化似然函数,同时求出各个参数的值.在模型中,我们用隐变量gab指示边属于哪个查询意图.令ηab,r=Pr(gab=r|eab),那么关于ηab,r就可以写成:ηab,r=Pr(gab=reab)=Pr(gab=r,eab)=从该式可以看出ηab,r反映了第r个查询意图对产生边eab的贡献程度.有了以上的关于隐变量gab的后验估计,我们就可以写出如下关于G的对数似然函数:lnPr(Gπ,β)=∑eab∈E我们在上式中加入π和β的概率归一性约束,就得到如下目标函数:LL=∑eab∈E∑Kα∑K其中α,μ是拉格朗日因子.我们将上式分别对π和β求导数,并令各自结果为0.化简后可得到如下的公式:πr=∑eab∈E∑Kr=1∑eab∈Eβr,i=∑eab∈E∑Ti=1∑eab∈E上式中,()·是指示函数,定义如下:在实际计算中,我们首先随机初始化π和β的值,然后按照式(4)、(7)、(8)迭代计算,就可以得到关于模型参数π和β的估计值.EM算法保证了迭代的收敛性,并且每次迭代都会使对数似然函数增加.因此我们可以通过设定某一阈值作为终止迭代的条件,当对数似然函数的增幅小于这一阈值之后便认为收敛.EM算法是确定性算法,其迭代终止时得到的结果是由参数初始化值而定的.因此我们可以进行多轮迭代,将其中拥有最大似然函数值的那轮迭代的参数作为最后结果.3.3结合查询意图的长尾查询推荐在文献[18]中作者提出了一种利用词项查询图对长尾查询进行推荐的方法.该方法首先从查询会Page5话中构建出词项查询图,然后对于某个长尾查询q={t1,t2,…,tm},利用如下概率转移矩阵犃i计算每个单词ti在词项查询图上通过个性化随机游走而得到的PageRank向量狕(i):其中,犠是由犌={V,E,W}的邻接矩阵按照行进权重归一化得到的矩阵,λ∈[0,1]是个性化随机游走中远距传输概率(teleportationprobability).犲i是一个|V|维的行向量,该向量除了第i个元素是1,其余全是0.1是各元素全是1的|V|维行向量.传统的方法将q中每个ti计算出来的z(i)按照Hadamard积相乘:其中,zq即是G中每个结点关于查询q的推荐得分.然后将得分较高的结点所对应的查询取出作为查询q的推荐.从式(11)可以看出,传统方法使用Hadamard积时,将每个单词ti等同看待,且不考虑q的查询意图和每个单词ti的相互关系,这样就会造成一些噪音单词z(i)一定程度上影响了q的最后推荐结果.基于这样的考虑,我们提出利用查询意图来衡量每个单词ti对查询q的重要程度,从而达到消除或减缓噪音单词对查询推荐的影响.在上一节中,我们可以计算出查询意图的分布π和查询意图关于单词的分布β.对于一个新来的查询qc,利用贝叶斯公式可得到该查询关于查询意图的分布:Pr(rqc)=Pr(r)Pr(qcr)因此对于每一种查询意图r,qc中的每个单词ti关于该意图的重要性可以用Pr(ti|r)=βr,i来表示.利用qc中每个ti的PageRank值z(i),我们可以计算在该种意图r下qc的推荐得分:将不同的zr得到最后我们关于q的推荐得分:zqc=∑K从式(14)中我们可以看到,不同单词的z(i)会由于当前查询qc属于不同的查询意图r而表现出不同的重要性.那些关于意图r比较重要的单词ti,由于其βr,i比较大,故zβr,i(i)中各个结点得分的差异也比r=1较大,因而能够对zr我们用Pr(r|qc)来权衡不同意图的重要程度,故对于qc蕴含的那些不明显的意图(即Pr(r|qc)比较小),其对zqc的最后得分影响也较小.4实验4.1数据集我们实验数据来源于某商业搜索引擎3个月的搜索日志.我们从中剔除了非英语的查询,并将所有的查询中的单词转化为对应的小写单词.我们按照30min的时间间隔将查询切分成查询回话,构建查询流图.为了减小噪音所带来的影响,我们去除了所有发生频率小于3次的边,并使用nltk工具包中的lancaster算法对所有单词提取词干.我们选取了其中最大的一个连通子图来构造词项查询图,该子图包含16980个不同的查询、51214条边以及8713个不同的单词.实验中我们经验选取意图的个数为60,80,100,120,并均取得相似的实验效果,这里我们仅报告话题个数K=100的结果.4.2评价查询意图在表1中,我们展示了3个随机选取的查询意图,并将每个词按照Pr(wi|r)的大小进行排序,这里我们仅展示了每种查询意图中排序最高的10个单词.为了方便辨认,我们将词干还原成对应的单词.我们可以看出这些词清晰地反映了各个查询意图,其中第一列是关于移动通信的,第二列是关于汽车的,第三列是关于航空旅行的.移动通信verizoncingularwirelesssprintmobilenexteltmobilephoneverizonwirelesslexus4.3评价长尾查询的推荐这一节我们将评价对长尾查询的查询推荐质量.我们将文献[18]中提到的方法作为基准方法.基准方法和我们的方法均使用相同的λ=0.7来计算长尾查询q={t1,…,tm}中每词ti对应的PageRank向量狕(i).表2中列出了两个随机选出的长尾查询:“yahoomailinbox”,“zipcodeforWashingtondc”为例子,来比较我们的方法和基准方法产生的推荐有效性.从这两个例子中我们可以看出,我们方法产Page6生的推荐查询同原查询更相关.而基准方法给出的查询由于等同看待查询中的每个单词,因而推荐出的查询是那些与每个单词都尽量相关的查询.从而导致了在整个词项查询图中比较流行的查询(如mapquest,bankofamerica)被推荐出来.我们的方法通过查询意图来衡量单词关于查询的重要性,因而对于那些比较重要的单词w(如“zipcodeforWashingtondc”中的“zip”和“code”)赋予更多的权表2两个长尾查询推荐的对比z0.1rw=另外,我们请了3位评价者来人工地标记推荐查询的相关性.这里我们采用3级标注法,其中0分表示根本不相关,0.5分表示部分相关,1分表示完全相关.我们从已有的查询日志中随机地产生100个在词项查询图中没有出现过的查询,同时要求组成这些查询的单词包含在词项查询图内.我们按照式(15)计算关于查询q的相关性得分(RS).其中q表示当前查询,k表示关于q的推荐查询个数,L={l1,l2,…,lk}表示各个推荐所得分数.其中q表示当前查询,k表示关于q的推荐查询个数,L={l1,l2,…,lk}表示各个推荐所得分数.我们按照推荐分数进行排序,并选取前k=1,3,5,7,10个查询让用户标注同源查询的相关性.图5展示了我们的方法和基准方法随机选取100个查询的平均相关性得分的对比.可以看出随着推荐查询个数的增多,越来愈多的不相关的查询被推荐出来,所以基准方法和我们的方法的相关性得分都在变差.但显而易见,由于我们的方法考虑了查询意图的影响,推荐查询的相关性明显好于基准方法的推荐查询.重(Pr(w|r)=βr,w较大),使得计算出来这些节点的PageRank值在该权重的作用下具有较强的区分能力,对最后的排序结果的影响也较大,从而推荐效果也就更好.如图4的例子所示,我们有一PageRank向量狕(i)[权重βr,w=0.1,βr,w=0.9得到的两个排序值对每个节点有明显不同的区分性,那些Pr(w|r)=βr,w较大的zβr,w(m)区分力较大.bankofamericaamericanidolyellowpagerealtorcomhomedepot5总结本文提出了一种新的基于查询意图的长尾查询推荐方法.不同于以往关于长尾查询的推荐方法,本文提出了一种概率混合模型来挖掘词项查询图中的查询意图,在该模型中我们将查询意图定义为单词的分布,因而可以从单词的角度去预测长尾查询的查询意图.此外我们还提出了一种根据查询意图来集成单词的个性化随机游走的方法,该方法通过衡量单词在查询中的重要程度,对长尾查询进行推荐.实验验证了我们推荐方法的有效性.在以后的工作中,我们将会考虑url等信息,进一步提高推荐效果.
