Page1基于补库所的死锁预防策略吴文慧王寿光(浙江工商大学信息与电子工程学院杭州310018)摘要文中基于补库所理论提出了活性控制器设计方法.首先,利用容量函数K将原Petri网N转变为有限容量网珦N,再通过逐一增加K值得到具有最大可达集的容量函数Kmax,然后根据Kmax添加一组补库所,最终得到活性受控网N.文中首先以S3PR网模型为例,与几种经典的死锁预防控制策略进行比较.实例数据表明,基于补库所理论设计的控制器不仅结构简单,避免了信标计算,还具有较好的行为许可性.最后,以S3PGR2网模型为例,说明基于补库所的死锁预防策略同样可以应用于一般Petri网.关键词Petri网;死锁;补库所控制器1引言柔性制造系统是一个典型的离散事件系统.该系统中资源高度共享,如果缺乏有效的调度和控制,则可能发生死锁现象[1],从而造成整个或部分系统的停顿,带来严重的经济损失甚至灾难性后果.因Page2锁的分析和控制方面取得了丰富的研究成果.其中不乏一些非常经典,且影响广泛的死锁控制方法.如Ezpeleta等人[4]提出的基于控制库所的活性Petri网控制器的设计方法.该方法成功地分离了系统模型和控制器,成为死锁预防法中的经典之作,但却在计算复杂性、结构复杂性和行为许可性三个方面存在不足.Huang等人[6]提出了迭代死锁控制策略,这提高了死锁控制的计算效率且具有更多的许可行为,但在活性Petri网控制器结构复杂性方面没有明确改善.Uzam[8]提出了求解最优活性Petri网控制器的区域理论,但没有解决计算复杂性和结构复杂性问题.Li和Zhou[9-11]提出了基于基本信标理论的死锁控制策略,这大大简化了控制器结构,但不足之处在于计算复杂性和行为许可性,且存在一个Petri网的基本信标的集合不是唯一的问题.可以看出,上述的这些死锁预防控制策略在不同理论方法的基础上有着各自明显的优势,亦存在各种明显的不足[12],主要体现在行为许可性、计算复杂性、结构复杂性和策略适用范围等方面.因此很多学者针对其中的某个或某些问题展开进一步的研究[13-22],其中Wang等人[22]提出了一种针对S3PR网的基于补库所理论和信标理论的死锁预防控制策略,通过给Petri网严格极小信标中的部分操作库所添加补库所,从而形成结构极为简单的补库所活性控制器.本文基于补库所控制理论,提出了不同于Wang等人[22]的补库所控制器设计算法,来处理Petri网系统的死锁问题.该方法最大的特点在于无需通过信标计算便可得到一个控制器结构简单且具有更好的许可行为性的活性受控网.此外,该死锁预防策略适用范围较广,可适用于权值大于等于1的一般Petri网.但该方法亦有不足之处,其计算复杂性为指数级.2基本概念一个Petri网结构是一个4元组,记作N=(P,T,F,W),其中P是库所集,T是变迁集合,它们是有限、非空且不相交集合;F(P×T)∪(T×P)被称为有向弧集合;W:F→函数.令x∈P∪T是Petri网N的节点,x的前置集·x定义为·x={y∈P∪T|(y,x)∈F},x的后置集x·定义为x·={y∈P∪T|(x,y)∈F}.Petri网N的标识是一个映射M:P→,其中={0,1,2,…},(N,M)被称为一个被标记的网.M(p)表示在标识M下库所p中托肯的个数,其中p∈P.M0记作系统的初始标识.对于变迁t∈T,称其在标识M下是使能的当且仅当p∈·t,M(p)W(p,t),记作M[t〉.在标识M下,使能的变迁t发射后,网系统跃迁到另外一个状态,产生一个新的标识M,使得p∈P,M=M(p)-W(p,t)+W(t,p),记作M[t〉M.从M0可达的所有标识的集合称为(N,M0)的可达集,记作R(N,M0).对于P的子集SP,如果S中有一个库所被标记,则S被标记,S中所有库所里的托肯数总和记为M(S).|S|表示库所集S中所拥有的库所个数.如果其库所集合S满足·SS·,则S被称为一个信标.一个简单顺序过程资源系统(ASystemofSimpleSequentialProcesswithResources,S3PR)网N=Οq(PiA∪{Pi网,该子网通过一些公共库所连接并满足:(1)Pi(2)PRi和Pi(3)p∈Pi称为操作库所和资源库所;PRi=;PR=t·∩PR={rp};(4)r∈PRi,··r∩Pi(5)··(pi(6)当所有的资源库所和相应的弧从子网Ni中移除后,得到的网Ni是一个强连通状态机且Ni的每条回路中都含有过程闲置库所Pi库所必须是资源库所,称Ni和Nj是可组合的.r∈PRi的持有者集合,珚S=[∪r∈SR的补集.3补库所控制理论(7)如果子网Ni和Nj拥有共享资源,则共享的在S3PR网中,H(r)=··r∩PA为资源库所定义1.一个Petri网(N,M0),称变迁t∈T在M0下是活的,当且仅当M∈R(N,M0),M∈R(N,M):M[t〉.称(N,M0)网是活的,当且仅当t∈T,t在M0下是活的.定义2[21].若Petri网(N,M0)中每个库所能容纳无限个托肯,则该网被称为无限容量网.如果Page3p∈·t,M(p)W(p,t),则称变迁t在M下使能,记作M[t〉.这样的变迁触发条件称为弱变迁规则.定义3[21].若Petri网(N,M0)中,对于p∈P和M∈R(N,M0),K(p)∈K(p),则N被称为有限容量网,K:P→N的容量函数.如果:(1)p∈·t,M(p)W(p,t),(2)p∈t·,在变迁t触发后M∈R(N,M),使得M(p)K(p),则称变迁t在M下使能,记作M[t〉.该变迁触发条件称为强变迁规则.定义4[21].给定一个容量有限的Petri网(N,M0),它可以通过补库所转化法转化成无限容量网(N,M0).具体步骤如下:步骤1.为每个库所p添加补库所p,p的初始标识为M0(p)=K(p)-M0(p).步骤2.添加由库所p的输出变迁指向补库所p的有向弧(p·,p),以及由补库所p指向库所p输入变迁的有向弧(p,·p),对于t∈T,使得变迁t触发前后,库所p和它的补库所p的总托肯数始终等于K(p).引理1[21].令(N,M0)是采用强变迁规则的有限容量网,(N,M0)是(N,M0)通过补库所转化法得到的采用弱变迁规则的无限容量网.则这两个网有着相同的所有可能的变迁序列集.本文中我们主要讨论S3PR网.设一个有限容量的S3PR网记为(N,M0),N=(PA∪P0∪PR,T,F,K),其中K为容量函数.由于p∈P0∪PR,K(p)=M0(p),因此对于容量函数K的讨论通常只针对p∈PA.设PA={px,…,py},K=[K(px),…,K(py)]T,K:PA→引理2.令t∈T是有限容量S3PR网(N,M0)的一个变迁,若(1)r∈PR,M0(r)|H(r)|,(2)p∈PA,K(p)=1,则该变迁t在M0下是活的.证明.根据S3PR网的定义,网系统N有q个子网,第i个子网中有m个变迁Ti={ti其中i∈{1,2,…,q}.设pi0∈·tipi及pi·,…,pitim-2始标识M0下是活的.1;同时pim-1∈·ti根据定义1,假设变迁ti活的,则M∈R(N,M0),\M∈R(N,M):M[ti根据条件p∈PA,K(p)=1,所以M(piM(pim-1)=1或者M(pi(1)M(piM):M[tiM(pim-1)=0.这就与M(pi(2)M(piM∈R(N,M),M(pi下不是活的.同样地,根据定义2,我们有M∈R(N,M),M(pi到M∈R(N,M),M(piM(pi1)=M(pi所以,假设不成立,ti同理可证,ti理2得证.定理1.给定一个有限容量S3PR网(N,M0),若其满足(1)r∈PR,M0(r)|H(r)|,(2)p∈PA,K(p)=1,则(N,M0)是活的.证明.由定义1和引理2可知,该定理成立.定理2.给定一个有限容量S3PR网(N,M0),其通过补库所转化法得到的无限容量网为(N,M0).其中N=(P∪PA,T,F),PA为给操作库所p∈PA添加的补库所p集合.如果(1)r∈PR,M0(r)|H(r)|,(2)p∈PA,M0(p)=1,则无限容量网(N,M0)是活的.证明.一个有限容量S3PR网(N,M0),根据S3PR网的性质,有p∈P0∪PR,K(p)=M0(p).如果其具有条件p∈PA,K(p)=1,那么根据定义4,可以通过补库所转化法得到无限容量网(N,M0).由于闲置库所和资源库所并不需要进行约束,因此对于p∈P0∪PR,不需添加补库所,而对于p∈PA,则M0(p)=1.因此由定义4和引理1可知,满足条件(1)r∈PR,M0(r)|H(r)|,(2)p∈PA,K(p)=1的有限容量S3PR网(N,M0)与满足条件(1)r∈PR,M0(r)|H(r)|,(2)p∈PA,M0(p)=1的无限容量S3PR网(N,M0)等价.又根据定理1可知,该定理成立.4基于补库所理论的死锁预防控制策略在这个部分里,基于补库所理论,我们提出了一种死锁预防策略,采用补库所控制器得到无死锁的受控网.假设(N,M0)网是一个无限容量的Petri网模Page4型,其中N=(PA∪P0∪PR,T,F),M0是初始标识,且对于所有的资源库所r∈PR有M0(r)H(r).我们采用如下设计思路.首先,为原Petri网(N,M0)添加一个初始值为[1,1,…,1]T的容量函数K,则原Petri网转变为有限容量网(珦N,M0);然后逐一增加K值,直到在某个K值下不再存在活的网系统,则选取(K-1)值;接下来,比较在(K-1)值下得到的多个活性有限容量网(珦N,M0)的可达集大小,选取可达集最大的网系统(珦Nmax,M0);最后,将(珦Nmax,M0)通过补库所形变转化为最终的活性受控网(N,M0).需要注意的是,对S3PR网而言,p∈P0∪PR,K(p)=M0(p),且M(p)∈R(N,M0),M(p)M0(p),因此对于闲置库所和资源库所来说,添加的初始标识M0(p)=0的补库所完全可以省略.因此在下面的“基于补库所的控制器设计算法”中,只需针对操作库所p∈PA来讨论容量函数K(p),及添加补库所控制器.以下为基于补库所的控制器设计算法.算法1.基于补库所控制理论的死锁预防策略算法.输入:Petri网(N,M0),其中N=(PA∪P0∪PR,T,输出:活的受控系统(N,M0)1.用混合整数规划法(MIP)判断Petri网(N,M0)中2.IF(不存在可被清空的信标)THEN3.(N,M0)是活的,退出算法1;4.ELSE5.对于p∈PA,令PA={px,…,py},6.K··=[1,1,…,1]T;7.令珦N=(PA∪P0∪PR,T,F,K);8.IF((珦N,M0)是活的)THEN9.跳至算法2;10.珦N=(PA∪P0∪PR,T,F,Kmax);11.ELSE12.不存在补库所控制器,退出算法1;13.ENDIF14.FORp∈PADO15.IF(Kmax(p)<B(p))THEN16.为该库所p添加一个补库所p,令17.添加由库所p的输出变迁指向补库所p的18.ENDIF19.ENDFOR20.转化后的Petri网记为(N,M0),其中21.ENDIF22.输出:(N,M0)23.END算法2.修正容量函数K算法.输入:Petri网(珦N,M0),其中珦N=(PA∪P0∪PR,T,F,K)输出:一个新的容量函数Kmax/Kmax是具有最大许可1.λ··=1;2.p∈Pi3.令x1+x2+…+xn=λ,其中n=|PA|;4.设Γ={K|K=[K(px),…,K(py)]T+5.WHILE(K∈Γ,珦N=(PA∪P0∪PR,T,F,K)是6.λ··=λ+1;7.x1+x2+…+xn=λ;8.Γ={K|K=[K(px),…,K(py)]T+9.ENDWHILE10.x1+x2+…+xn=λ-1;11.Γ={K|K=[K(px),…,K(py)]T+[x1,…,xn]T,12.FORK∈ΓDO13.令珦N=(PA∪P0∪PR,T,F,K);14.IF((珦N,M0)不是活的)THEN15.Γ··=Γ\K;16.ENDIF17.ENDFOR18.令珦Nmax=(PA∪P0∪PR,T,F,Kmax),其中Kmax∈19.输出Kmax;20.ENDPage55例子如图1所示的Petri网模型(N,M0)是一个S3PR网,在初始标识M0下的可达标识有37073个.其中不安全标识的数目有246个,因此这个系统所能得到的最大许可标识有36827个.根据算法2,逐渐增加容量函数K值,当∑K(pi)增加到最大值36时,能得到活的网系统珦N的组合有3种,如表1所示.其中,以K1=[7,5,2,5,4,1,5,7]T为容量函数的网系统珦N1的可达状态数目为31626;以K2=[7,4,1,5,5,2,5,7]T为容量函数的网系统珦N2的可达状态数目为31626;以K3=[7,4,2,5,4,2,5,7]T为容量函数的网系统珦N3的可达状态数目为35770.因此,珦Nmax=珦N3=(PA∪P0∪PR,T,F,K3).根据补库所控制理论,将该活的有限容量网(珦N,M0)通过算法1添加补库所控制器p3和p6,其中M0(p3)=K(p3)-M0(p3)=4-0=4,M0(p6)=K(p6)-M0(p6)=4-0=4,最后得到活的受控网(N,M0)如图2所示.ΨK(p2)K(p3)K(p4)K(p5)K(p6)K(p7)K(p8)K(p9)6与其它几种典型控制策略的比较本节将针对图1所示的S3PR网模型,通过5个典型的死锁预防策略的应用,进而与本文的死锁控制策略进行比较,分析其优劣.将Ezpeleta等人[4]提出的死锁预防策略,简称为E-策略,应用于图1所示的S3PR网模型.计算得到3个严格极小信标分别是S1={p4,p8,p11,p12}、S2={p5,p7,p12,p13}、S3={p5,p8,p11,p12,p13},因此添加3个控制库所pc1、pc2和pc3,如图3所示.所得到的活性受控网可达状态数目为24401,相对于最大许可状态数目36827,仅实现了66%的许可行为.Li等人[9]提出了基于基本信标理论的死锁预防策略,简称为L1-策略.针对图1所示的Petri网模型,其基本信标分别为S1={p4,p8,p11,p12}和S2={p5,p7,p12,p13},因此添加两个控制库所pc1和pc2,如图4所示.所得到的活性受控网可达标识数目与E-策略的结果相同,但在控制器结构方面有所简化.Li等人[10]在L1-策略的基础上,通过改进控制库所后置集而得到具有更多许可行为的活性受控系Page6统的一种死锁预防策略,简称为L2-策略.将其应用于图1模型,我们在图4的基础上,移动控制库所的输出弧,使之在不产生死锁的前提下,尽可能远离源变迁,所得结果如图5所示.得到的活性受控网可达标识数目为34413,实现了93%的许可行为.Uzam[8]基于区域理论提出来的设计最优活性Petri网控制器的方法,简称为U-策略.该方法需要先计算网系统的可达图,然后通过求解线性规划问题来得到控制器.图6是图1所示网系统应用U-策略得到的结果,其可达标识数目为36827.Wang等人[22]基于信标和补库所理论提出的死锁预防策略,简称为W-策略.针对图1所示的S3PR网,计算得到3个严格极小信标分别是S1={p4,p8,p11,p12}、S2={p5,p7,p12,p13}、S3={p5,p8,p11,p12,p13},其具有最大可达集的容量函数Kmax=[7,3,2,5,4,2,5,7]T(或Kmax=[7,4,2,5,3,2,5,7]T),最后为p3和p6添加控制补库所如图7所示,有33733个可达标识.将上述5种死锁预防策略应用于图1所示的网系统,所得的结果如表2所示.由表2可知,U-策略得到的活性Petri网控制器是最优的,具有最大许可行为.但该策略需对每一个状态变迁分离事例求解一个不等式组,而理论上,状态变迁分离事例的数目与Petri网系统的规模成指数关系,因此其计算复杂性亦随网规模成指数增长.E-策略和L1-策略得到的受控网的可达标识数目相等,且仅占了所有许可标识的66%,因此这两种策略的缺点在于许可行为受到较大的限制.其中E-策略所添加的控制库所数目与严格极小信标的数目相等,而严格极小信标的数目在理论上和网规模成指数关系,因此E-策略得到的控制器结构比较复杂.而在E-策略基础上提出的L1-策略应用了基本信标理论,改善了控制器的结构复杂性问题,但在行为许可性方面却没有改进.因此,Li等人[10]又对L1-策略进行了改进,提Page7出了L2-策略,在保证系统活性的前提下,将控制库所指向源变迁的弧向远离源变迁方向移动,从而增加受控网的可达标识数目.另外,Wang等人[22]基于补库所和信标理论提出的W-策略,其行为许可性与L2-策略接近,但其控制器结构比L2-策略简单.不过其算法中的信标枚举和可达集计算都是指数级计算复杂度的.死锁预防策略EL12L22UW本文2由表2可知,本文提出的基于补库所理论的死锁预防控制策略有3大特点.首先,最终得到的控制器结构简单,这点与W-策略一样,我们仅需对Petri网中的某些操作库所添加补库所形成补库所控制器,其控制库所数目不超过网的操作库所数目,因此我们的控制器复杂性是多项式的.与E-策略、L1-策略、L2-策略及W-策略不同的.最后,其行为许可性较优,虽没有达到最优,但已优于E-策略、L1-策略、L2-策略及W-策略.和行为许可性最优的U-策略相比,本文的方法的控制器结构要简单的多.为了进一步讨论,我们针对图1示例,在不同初始标识下应用补库所策略,得到最终受控网的行为许可百分比,见表3.由表3可知,随着初始标识的增大,受控网的许可行为百分比越接近百分百,即补库所策略在初始标识较大的情况下可以得到接近最大许可行为的控制器.其次,在控制器计算过程中不需计算信标,这是[5,0,0,0,0,0,0,0,0,5,3,2,3]T5239/5762=90.9[6,0,0,0,0,0,0,0,0,6,4,2,4]T15006/15777=95.1[7,0,0,0,0,0,0,0,0,7,5,2,5]T35770/36827=97.1[8,0,0,0,0,0,0,0,0,8,6,2,6]T75407/76788=98.2[9,0,0,0,0,0,0,0,0,9,7,2,7]T145353/147096=98.8[10,0,0,0,0,0,0,0,0,10,8,2,8]T261536/263679=99.2[11,0,0,0,0,0,0,0,0,11,9,2,9]T445416/447997=99.4另外,实际上本文中的死锁预防策略并不局限于某一普通Petri网子类,它还可以适用于一般Petri网.接下来,我们就通过一个一般Petri网的例子来进一步说明.示例2的网系统如图8所示,是一个S3PGR2(SystemofsimplesequentialProcesseswithGeneralResourceRequirements)网[23],该模型有363个可达状态,其中好的可达状态数为323个.在文献[23]中我们可以看到,添加如表4所示的3个控制库所,16条有向弧,得到的活性受控网含有85个可达状态;而在文献[24]中,添加如表5所示的3个控制库所、14条有向弧,则得到含有246个可达状态的活性受控网.表4针对图8示例文献[23]计算得到的活性控制器pciM0(pci)pc143t3,t5,4t6,t124t1,t10pc24t7,3t10,2t11,t13t1,3t8pc32表5针对图8示例文献[24]计算得到的活性控制器pciM0(pci)pc192t3,2t5,4t6,3t10,2t11,t134t1,3t8pc23pc33如果通过本文所述的基于补库所理论的算法1和算法2,进行死锁预防处理,则需要添加3个控制库所、6条有向弧,得到如图9的受控活性Petri网,含有291个可达状态.由此我们可以看到,文中基于补库所的死锁预防策略不仅适用于普通Petri网,亦适用于一般Petri网,且得到的补库所控制器同样具有结构简单、行为许可性较优的特性.但是,本文的补库所控制策略亦存在一些缺点.首先,它的计算复杂性是指数级的.算法2显示计算的复杂性在于容量函数K的计算,容量函数K每增加数值1均需通过MIP方法进行活性检测,理论上来说检测次数与容量函数K的排列组合数目有关,因此是随网规模成指数型增长的.另外,计算复Page8图9图8示例通过算法1得到的活性受控网杂性还在于可达集的计算,其计算亦随网规模成指数级增长.其次,本文所述算法的应用条件为资源库所的初始标识M0必须满足M0(r)H(r),因此该算法对初始标识的限制要求较大.7结论本文主要以柔性制造系统的Petri网模型为研究对象,通过对某些操作库所添加补库所的办法设计补库所控制器,从而得到活性受控网.文中通过一个S3PR网和一个S3PGR2网的实例说明本文所设计的补库所控制器具有非常简单的结构且不需要计算信标;用该方法得到的活性受控网的许可行为随着初始标识的增大而逐渐增大至接近最大许可行为;并且该死锁预防策略适用范围较广,也可适用于一般Petri网.另一方面,该方法的不足之处在于其计算复杂性为指数级;且对网系统的初始标识有较大的限制,只适用于初始标识满足M0(r)|H(r)|的Petri网.因此,今后的研究工作是在本文的基础上进一步降低计算复杂性.
