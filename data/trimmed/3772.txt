Page1一种基于依存文法的需求文本策略依赖关系抽取方法李天颍刘瞞赵德旺曹原(清华大学软件学院北京100084)摘要从基于自然语言的需求文本中抽取概念模型已有很多相关研究,然而,抽取模型中的关系信息因其复杂性而较少被研究者系统地分析和处理.文中提出了一个通用的关系信息抽取方法,给出抽取规则,从需求文本中确定和抽取关系信息.基于该方法设计并实现了一个系统CREAT3,从中文需求文本自动生成i框架中的SD(StrategyDependency,策略依赖)模型,侧重抽取策略依赖关系信息.将得到的模型和专家抽取结果进行对比,结果显示该系统可以获得相当高的准确率,同时也保证了很高的召回率,证明了方法的可用性.并且较相关工作具有更好的可扩展性.关键词自然语言需求文本;依存文法;关系抽取;策略依赖模型1引言在软件生命周期的概念建模阶段,需求的常用Page2化,所以需求分析建模过程总离不开人的参与.但这并不意味自动建模工具的辅助没有存在的必要.当遇到一个复杂的系统时,需求文本的处理工作量是相当大的,我们希望能够尽可能缩短处理的时间,减轻需求分析师的工作负担,因而一些自动建模工具应运而生.已有相关工作集中在UML模型的自动生成上,例如用例图、类图和活动图等等.处理过程可以总结为:首先从文本中获得特定的信息,然后定义一系列的转换规则,最后,通过这些规则将需求文本映射到对应的图形化模型上.由于只使用简单的分词和词性标注技术,大量的语义信息在文本分析中丢失.另外,因仅用直观经验定义的规则往往不能有效地覆盖丰富的需求文本句式,这些自动建模工具的召回率和准确率只能通过限定输入文本的句式来得到保证.通过总结大量的需求文本分析建模经验,我们注意到:一方面人类专家可以不必费太多力气就能阅读一段很长的文字,他们可以很有效地扫描文本,基于一些预期的语法与语义模式,获得所需信息;另一方面对于图形模型来说,最有价值的信息往往存在于图中元素和元素的链接上.例如类图中的整体-部分关联关系,活动图中的时序关系等等.文本中的关系信息恰好对应于图中的链接,可以很大程度上帮助我们从需求文本中抽取模型结构.例如,整体-部分关联在类图里可以表示为聚合关系.本文提出一个系统化的关系信息抽取方法,通过定义一套抽取规则,从大量的需求文本中确定和抽取关系.基于该方法,我们开发了一个自动从中文需求文本生成i框架中的策略依赖(StrategyDependency,SD)模型的系统CREAT3.我们将得到的模型和专家的抽取结果进行对比,证明了方法的可用性.本文的第2节简要介绍相关工作研究;第3节阐述关系信息抽取方法的具体步骤;第4节对CREAT3自动建模工具的实现进行简要介绍,并用实验加以验证与分析;最后给出总结.2相关研究目前针对英文已经存在若干需求文本分析和自动建模的方法和工具.Mich等人[1]1996年在NL-OOPS系统中首次从语义网(SemNet)中抽取出了对象和对象之间的关联.Overmyer等人[2]在2001年开发了能自动生成对象图和类图的LIDA系统,该系统提供了一系列模型转换器,能和多个CASE工具兼容.同时,还有一些工具提供了多种模型的自动生成功能.UCDA系统[3]首先从自然语言中获取用例模型,然后以此为中介抽取协作图和类图.UMGAR系统[4-5]优化了这个过程,并且提供了一个自动化验证的工具.Yue等人[6]则给出一系列转换规则,并提供了抽取活动图的方法.在中文的需求自动建模工具开发方面,纪磊等人[7]和利锦标等人[8]分别于2008和2010年研发出了知文系统的两个版本(CREAT和CREAT2)需求半自动建模系统.他们利用分词和词性标注的结果,用自定义句式框架匹配的方法识别类图中的元素,并将识别结果通过问卷的方式和用户进行交互确认.由于自然语言分析得到的信息量少,匹配句式简单,其准确率并不非常理想.在信息抽取领域,国内外已经存在许多较成熟抽取关系的研究成果,只是他们对于关系的定义各有不同.例如Lin等人[9]从文本中抽取个人、组织或者位置之间的关联关系,有人专门抽取特定的关系,例如因果关系的抽取[10],还有的研究者例如Embarek等人[11-12]则将关系的抽取应用到问答系统和生物制药领域.就我们所知,目前尚没有一个系统的方法从自然语言文本中抽取关系信息并应用于需求自动建模系统.3关系抽取方法定义1.关系R在自然语言文本中被定义为一个有序的三元组(X,Y,G),其中X和Y是R的两个实体,分别作为关系的起点和终点,G是关系类型.X和Y至少有一个是名词短语.我们按照图1所示的一个基于依存文法的3层语义映射框架,其中文法分析层获得的是文法分析后句子成分以及成分之间的依存关系.通过文法分析层的文本做两次抽象映射即可从中获取初步的概念模型.第1次映射到实体识别层:基于语义映射的规则抽取建模元素及元素之间的关系;第2次映射到语义模型表示层:基于需求模型的特征建立文法Page3分析自动机.最后通过图形可视化获得目标模型图.下面本文将以i框架中的SD模型[13]为例,针对各个步骤依次介绍.3.1文本分析与领域词汇处理利用已有的自然语言分析技术,依次进行分词、词性标注及语法分析.语法分析后生成的语法树可以有两种表达形式:短语结构树和关系依赖树,分别如图2(a)、(b)所示.两种语法分析树都以句子为单位进行划分.短语结构树的分析,首先会有一个主-谓语的初始划分,而关系依赖树的分析则每次选取句子的中心动词为树的父结点.由于关系依赖树本身结点与结点间就有依赖类型的标注,更加适合关系的抽取并且树的结点数更少,遍历更快,因此我们选取关系依赖树作为文法分析结果的表示.本文中选取的文本分析工具为哈尔滨工业大学的LTP[14]自然语言分析工具,作为文本分析部分的模块.这是一个集成的中文自然语言分析平台,并且通过使用其提供的网络服务API,提升文本分析部分性能.结合需求具有特定领域背景这一属性,我们在文本分析中增加了领域词典模块.需求文本中存在大量的领域词汇,一些词汇在分词或词性标注的过程中可能会发生错误,会直接影响到关系抽取的准确性.例如学生课程管理系统需求文本中的“助教”一词在LTP系统中会被标注为动词,因而含有“助教”的句子的关系抽取,会由于实体无法正确识别而失败.为了解决该问题,我们建立了领域词典,通过遍历领域词典,修改被错误标注的词性和分词结果,从而大幅提高了关系抽取的准确率.目前该词典的初始化由输入的该领域需求文本中名词词组出现的频率进行确定,当频率超过预设阈值,就自动将其加入领域词典.3.2实体识别提出识别实体的8条通用规则,如表1.另外结合目标SD模型的特点给出两条特殊规则.遵循由繁到简,从通用到特殊的优先级顺序应用规则可以识别模型中的实体在文本中对应的短语.我们发现,关系实体总可以用以下5种类型的短语进行表示:名词短语(NounPhrase,NP)、动词短语(VerbPhrase,VP)、介词短语(PrepositionPhrase,PP)、副词短语(AdverbPhrase,AP)和从句(ClausePhrase,CP).序号规则1.名词与名词交替出现,并且它们之间的关系为修饰关系规则2.每个单独出现的名词也作为一个名词短语.规则3.动词与动词交替出现,并且它们之间的关系为修饰关系规则4.每个单独出现的动词,并且不是描述性动词(例如:是)也规则5.情态动词以及单独出现的副词都作为副词短语.规则6.介词与其紧跟的名词短语和副词短语形成一个介词短语.规则7.介词与其后紧跟的动词短语和副词短语形成一个介词短语.规则8.i框架中的SD模型是面向主体的,描述了多个有意愿的主体之间的策略依赖关系,依赖类型可以是资源、任务、目标和软目标.SD模型中的一条策略依赖关系可以表达为两个关系三元组.例如:“学生希望老师给出高分.”表达为关系三元组是(学生,高分,资源依赖),(高分,老师,资源依赖).直观上看,主体和资源往往是NP,目标和任务应该多为VP,而软目标则常出现在AP中.识别出一般短语类型后,对于一个特定目标模型中的实体(元素),有时需要根据图形元素本身的定义推导出在文本中相应的语义角色,从而对短语类型进一步细分.例如SD模型中的主体:具有主观能动性的行为体;资源:不具有主观能动性,被某个主体拥有.具有能动性的Page4行为体必然是动作/意愿的发出者,因而推出作为一个句子的具有动作/意愿动词的主语可被认为是主体,而其余名词则应作为资源的候选词.增加的两条特殊规则为规则9:需求文本中作为动作/意愿动词的主语出现过的NP和“系统”被标注为主体(Actor),其余NP被标注为资源(Resource).规则10:如果一个完整的句子中只有一个VP,并且前3个完整的句子中都没有VP被标注为目标,那么将该VP标注为目标(Goal),其余VP被标注为任务(Task).例如一句文本经过通用规则识别后结果为“[在任何情况下]PP,[项目经理]NP[要求]VP[团队成员]NP[必须]AP[完成项目]VP[认真并及时]AP.”经过特殊规则识别后则是“[在任何情况下]PP,[项目经理]Actor[要求]VP〈Task〉[团队成员]Resource[必须]AP[完成项目]VP〈Task〉[认真并及时]AP.”如果整个需求文本中还有团队成员作为表2SD图的语义模型的正则表示(PPP为被动介词短语)语义模型正则表达式(RE)对应的依赖关系R(X,Y,G)RE1:OtherActor1OtherVP〈Task〉1VPRE2:RE1Actor2Other(VP〈Task〉1,Actor1,任务依赖)、(Actor2,RE3:OtherActor1OtherVP〈Goal〉1OtherRE4:RE2VP〈Goal〉1OtherRE5:RE2VP〈Task〉2OtherRE2Resource(Actor1,Resource,资源依赖)、(Resource,RE2APOther(VP〈Task〉1+AP,Actor1,软目标依赖)、RE3Resource(Actor1,Resource,资源依赖)(Actor2,VP〈Task〉1+AP,软目标依赖)用户希望系统响应速度迅速.RE3APOther(Actor1,VP〈Goal〉1+AP,软目标依赖)学生希望得到的分数高.RE4APOther(Actor1,VP〈Task〉1+VP〈Goal〉1+AP,RE5APOther(Actor1,VP〈Task〉1+VP〈Task〉2+AP,OtherActor1OtherPPPActor2VPOtherActor1OtherPPPVPRE1PPPActor2VP主语的句子,例如“团队成员可以查看各团队的进展状况.”则[团队成员]被标记为主体.3.3语义模型表示关系依赖树上的每个结点都是分词后得到的一个词语,而完成实体识别后,相邻的一些结点会合并形成短语,短语之间仍然通过关系依赖树上的边进行连接.在一个特定的需求模型中,所需抽取的关系也被限制在一定的范围内,因而保证了规则数量的有限性.例如SD模型只关注策略依赖关系,并不关心时间的先后,所以一些含有关于时间先后的介词短语的句子如“在此之后”这类结构可以不必考虑.本文针对SD模型的建模目标和中文语言自然表述的特点,总结了17种常用句式,我们认为涵盖了需求文本中各种可能出现的句式,换句话说,这是SD模型分析的最小等价类,如表2所示.在系统演化过程中,这个集合是可扩展的.句式举例(课程管理系统)对应的SD模型图用户可以修改登录密码.管理员负责在系统中分配学生.项目成员希望按时完成课程项目.助教可以在系统中协助学生完成项目.助教可以在系统中帮助学生解答疑问.学生需要助教在系统中给出的分数.学生需要得到好分数.助教可以在系统中协助学生尽快完成.老师要求学生要完成功课认真并及时.每个完成了课程注册的学生都会由助教批改作业.学生被批改作业.学生写作业被助教在系统中进行批改.Page5语义模型正则表达式(RE)对应的依赖关系R(X,Y,G)RE1PPPVP(VP〈Task〉1+PPP+VP,Actor1,任务RE2PPPActor3VPRE2PPPVP将表2中的规则采用确定性有限自动机(DFA)来表示,可以得到抽取出的SD语义模型为图3所示.一个语义自动机包含了若干的结点和边,每读入一个短语,状态进行一次转移.句子终止前,循环进行短语读入,转移状态,并记录路径.句子终止,获得最后一个终止态之前的一段路径对应的模式,根据路径对应的模式得到关系类型,以及两个实体从而获得依赖关系.句子终止时,记录的路径中如果没有终止态,则无法提取依赖关系,将句子保存在未识别句式库中,线下人工识别.匹配过程的算法如算法1所示.例如:“[在任何情况下]PP,[项目经理]Actor[要求]VP〈Task〉[团队成员]Actor[必须]AP[完成项目]VP〈Task〉[认真并及时]AP.”对应的正则表达式是“RE2APOther”,在表2中对应着软目标依赖,项目经理依赖团队成员达到软目标:完成项目认真并及时.需要注意的是:在SD模型中,一条完整的依赖关系中必然有两个主体,如果提取的关系中只能找到一个主体,则另一个主体有两种可能:(1)“系统”,例如:“用户可以修改用户密码”的依赖关系可以最终表示为:系统依赖用户修改用户密码.(2)需要结合领域信息和一定的推理过程进行判断,例如:“学生需要得到好分数”中,另一主体应为“老师”.本文将这类句子中另一主体默认设置为“系统”,并自动生成用户问卷,由用户最终调图3用于SD模型分析的文法自动机句式举例(课程管理系统)对应的SD模型图学生完成课程作业将在系统中直接被批改.小组成员交换小组首先需要由管理员在系统中修改小组信息.管理员需要重新设置项目成员并被告知是否修改成功.整确认.算法1.语义自动机匹配算法伪代码.输入:实体识别后的结构化文本:text,语义自动机:输出:relationVectorSet{〈actor1,dependency,dep-1.WHILEtexthasnextsentence2.DOhasRelation←FALSE3.FOREACHphrasepiinstructuredsentence4.DOtransitionPhrase←pi5.getnextStatesjfromtransitionVectorSet6.putnowStateintopathStack7.nowState←sj8.ENDFOR9.FOREACHstateinpathStack10.DOIFstatekinendStateSet,THEN11.retrieverelationVectorinpatternSet12.addrelationVectortorelationVectorSet13.hasRelation←TRUE14.ENDIF15.ENDFOR16.IFhasRelation=FALSE17.THENstorethesentenceinunrecognizedlibrary18.ENDIF19.ENDWHILEPage6整个抽取过程仅需遍历文本常数次,所以时间复杂度为O(n),即和文本字数成线性正相关.4系统实现和实验验证4.1线下指代消解模块原始需求文本中存在的大量指代现象使得需求建模变得困难.例如“导师可以接受研究生的请求加入其创建的项目,并可以查看他的项目的进度.”中的“其”和“他”分别指代的是“导师”还是“研究生”呢?正确地找出指示代词在需求文本中所指代的名词实体对需求分析和建模有着重要意义.我们提出了用于中文指代消解的算法,同时实现了一个指代消解模块,可以在线下对需求文本进行预处理.指代消解算法流程如图4:(1)信息提取.利用文法分析工具做命名实体识别,从段落中提取指代词和候选先行词列表.(2)名词实体识别.对每个代词和它的候选先行词进行一致性匹配.包括人/物的一致性和单复数一致性.不匹配的候选先行词将在下一步的筛选器中被剔除.(3)一致性判断.对第三人称代词和反身代词进行区分,分别通过不同的筛选器进行筛选.筛选器由7条语法规则组成.(4)规则筛选.为每个指代词的候选先行词进行突显因子赋值.突显因子是候选先行词的多项特征值加权和.候选先行词的8个特征值包括独立名词、存在性修饰、主语强调、宾语强调、并列结构、非介词结构、句内指代、重复出现.(5)突显因子赋值.通过比较突显因子给出得分最高的候选先行词作为消解结果.从北京大学词义标注语料库2007版中选取小规模数据集(140个段落、180个指代词)设计完成一系列实验,调整特征值权重,使模块基于该数据集的图5CREAT3系统流程图准确率达到71.11%,对应的各个特征的权重赋值向量为(80,100,120,80,120,100,100,0),作为本文系统做线下指代消解的权重设置.4.2系统实现本文使用AdobeFlex+J2EE(Java2Platform,EnterpriseEdition)技术设计并实现了一个针对中文自然语言需求文本的抽取系统CREAT3(http://sourceforge.net/projects/lerisk),对建模方法中的各个步骤进行了支持.该系统由文本预处理、文本分析、用户反馈和可视化显示4个模块组成.系统的工作流程和界面演示分别如图5、图6所示,系统可以根据用户提供的需求文本自动生成SD模型,并进行自动布局.无法找到关系的实体将排列在图的正上方以供和用户交互确认.Page7图6CREAT3系统界面截图4.3实验验证4.3.1准确率和召回率为了测试本文提出的关系抽取方法应用在需求文本自动建模的可行性,本文对3段中文需求文本分别实验,这3段文本分别来自于3个不同领域系统的早期需求文本收集:课程管理系统、儿童体验主题场馆运营系统和商业游戏说明,特征如表3所示.需求文本需求文本字数句子个数句子平均长度文本一文本二1081文本三1516SD模型中包含的图形元素有主体、资源依赖、目标依赖、软目标依赖、任务依赖.为了检验生成结果的准确性以及方法的可靠性,我们将工具抽取的模型和两名需求分析专家的抽取结果进行对比,分别统计实体和关系识别结果,如表4所示(P/%和R/%分别代表准确率和召回率,F1/%表示F1度量值,其中F1=2×P×R需求文本一87.5087.5087.5073.6887.5080.00二100.0066.6780.0064.2981.8172.00三85.71100.0092.3164.7091.6775.86平均值91.0784.7286.6067.5686.9975.95如表4所示,实体识别的准确率和召回率可以达到91.07%和84.72%,说明实体识别的规则能够准确定位到关系的两个端点.依赖关系的准确率并不很高:平均为67.56%.这表明当前语义模型的设计还不够准确,通过分析数据集,发现主要原因在于缺少领域知识的推理和一些特殊句式的处理,例如祈使句.但是关系识别的召回率是比较令人满意的:86.99%,这说明当前语义模型能够覆盖需求文本中的绝大部分句式结构,通过用户对模糊需求的判定,可以得到较完整的目标模型.4.3.2数据集规模分析从3组实验可以看出,实验结果的准确率和召回率并没有随着需求文本的字数增长而发生变化,而是随着句子平均长度的增长有所降低.例如文本三的字数最多,但是由于平均句子长度较小,其F1度量值仍比文本二高(75.86>72).而随着需求文本规模的扩大,复杂句式出现的频率也逐渐增加,当前语义模型的匹配失败率会随之提高,所以语义规则还需要进一步完善.但由于较高的召回率,所以F1度量值即系统整体性能仍然保持较高的水平.4.3.3相关工作对比CREAT3是“知文”系统的第3个版本.前两个系统CREAT和CREAT2的目标模型都是面向对象的类图,而CREAT3选取面向主体的SD图作为抽取对象.如表5所示,CREAT3结合使用语法树的信息,而不仅仅使用分词/词性标注结果,可以获得更全面的语义信息.添加了线下共指消解的模块,Page8对文本进行预处理,并且用户界面更加友好灵活,通过将识别出的关系有效地展现给用户,同时对模糊需求生成用户问卷,获得用户的反馈,从而获得更优的结果模型,可以很好地辅助需求概念建模过程.将前两版本系统基于同一数据集抽取的类和属性作为实体,类之间关联作为关系,与CREAT3的结果进行对比,如图7所示.可以看到CREAT3无论实体还是关系的识别准确率和召回率都比相关工作高,验证了方法的可靠性.表5“知文”系统各版本实现对比系统版本文本预处理无语义模型识别和表示语义模型:5种基本句式表示语义模型:4种普通模型(复杂模型包模型可视化与用户反馈文本用户编辑括子模型)和2个特殊模型图7各系统版本实体和关系抽取结果对比5结论目前还没有一个通用的方法,从自然语言中抽取建模元素及元素之间的关系信息.本文结合依存文法提供的丰富语义信息,提出了一种关系信息抽取方法,并将该方法应用到一个基于中文自动建模系统中,抽取策略依赖关系,构建i框架中的SD模型.实验表明,该系统能够自动生成一个较完整的SD模型,模型的抽取能够保证较好的准确率.通过用户的反馈和简单编辑获得最终的SD模型图,用以辅助需求分析.该方法具有很好的可扩展性.未来,我们的研究包括:(1)增加计算样本量,并行化分析过程.(2)添加领域知识推理,提高关系抽取的准确率.(3)将该方法应用于例如活动图等其它目标模型.由于本文系统基于中文需求,和国外相关工作无法用同一个数据集进行实验,不具有可比性,但仅从国外相关论文中所述的实验结果[12,15]来看,我们的准确率和召回率也是具有较强竞争力的.在抽取方法上,抽取关系的方法可以很容易扩展到例如活动图等模型的抽取上,可以应用的目标模型更为广泛.对语法成分的依存关系做两次有序的抽象映射,保证了规则集合的精炼,给基于规则的关系抽取提供了一个新的思路.CREAT2
