Page1基于行为的可信动态度量的状态空间约简研究庄?沈昌祥蔡勉(北京工业大学计算机学院北京100124)(可信计算北京市重点实验室北京100124)摘要针对复杂并发计算机系统行为可信的动态度量研究中,细粒度动态度量所引发的状态空间爆炸问题一直是研究的难点.文中基于并发理论研究复杂并发计算机系统行为可信问题,在保障度量可靠性的前提下对系统状态空间进行约简,即通过标记变迁系统模型描述行为系统,通过事件结构模型研究行为关系,依据行为关系对变迁系统中各条路径进行重构,合并重构路径中相同的路径,实现变迁关系集约简,缩小状态空间.通过上述方法缓解了状态空间爆炸,并且,根据约简后的状态空间得到面向行为的可信动态度量的行为预期,增加细粒度动态度量方法在复杂系统中应用的可行性.关键词可信动态度量;细粒度度量;状态空间约简;行为关系;行为预期获取;网络安全;信息安全1引言可信计算机系统通过可信度量将信任从可信根扩展到整个系统,从而构建系统的信任链,以保证系统可信.因此,可信度量是可信计算机系统构建的关键技术.可信度量分为静态度量和动态度量.系统启动时信任链构建过程中的可信度量是对系统硬件、软件及固件的数据完整性度量,称为静态度量;系统运行过程中的可信度量称为动态度量.为了保障计算机系统可信运行,必须从静态与动态两方面对系统进行度量[1].根据可信计算组织TCG(TrustedComputingGroup)提出的“给定目标下的行为可预期”①的可信定义,从考量实体行为可信的角度研究系统的可信动态度量,更加符合可信计算的本质要求.基于行为的动态度量研究涉及行为描述及行为度量方面的相关研究,相对于基于数据完整性度量更为复杂,是可信动态度量的一种方式,以保证系统运行可信.目前,可信计算研究领域存在理论滞后于技术开发问题,尚未有完善的可信动态度量理论模型[2].在面向行为的可信动态度量研究中,度量模型的状态空间会因系统行为的复杂化和度量粒度的细化而变得异常庞大,引发状态空间爆炸.因此需要研究细粒度可信动态度量引发的状态空间爆炸问题,该问题如能有效解决,细粒度可信动态度量预期行为获取问题便会迎刃而解.近年来有关可信动态度量的研究取得了一些成果,2004至2006年间,Sailer等人[3]、Jaeger等人[4]、Shi等人[5]的研究分别采用对运行时实体、信息流、实体功能片段的完整性度量方法,度量系统运行时的可信,这些研究集中在工程模型构建及实现上.2007年以后的研究开始关注软件行为,文献[6]的研究指出系统的动态可信性只需关注与可信相关的行为,但没有明确给出如何判断与可信相关的行为,如何度量行为可信.Alam等人[7]的研究基于使用控制(UCON)模型,将信任与特定任务的预期行为相关联,并依据执行行为和预期行为的比较来判断行为是否可信,但UCON模型是一种面向安全的模型,在该模型下的可信度量势必受到局限.文献[8-9]介绍了一种基于软件行为的动态完整性度量模型,通过分析可执行文件或源代码的API调用关系获取预期行为,将软件行为与预期行为进行比较,判定行为是否可信,其度量粒度可以细化到最底层的调用关系.作者先前的工作[10]基于软件行为学理论提出了动态度量方法,从理论上给出了度量粒度细化到一个软件行为时的可信判定方法,但文献[8-10]的细粒度的度量会产生状态空间爆炸.目前,可信动态度量的研究大多停留在技术层面上,另外存在着细粒度的动态度量引发的状态空间爆炸问题.可信动态度量通常包括3个步骤:(1)构建行为预期;(2)获取度量平台的运行时证据;(3)行为可信性验证.对于复杂的应用系统,系统运行的状态空间庞大,可信动态度量的关键是如何获取预期,使可信动态度量既能够准确地度量系统行为可信,及时发现非预期行为,又能够保证系统运行正常,使可信动态度量具有可靠性和可用性.随着可信度量的研究从静态转向动态,从粗粒度到粒度逐步细化,如何在度量空间随软件复杂度急剧增加的情况下保证度量方法可行性的相关探讨并不多见.本文运用并发理论研究基于行为的细粒度动态度量问题,通过标记变迁系统模型描述行为系统,通过事件结构模型研究行为间关系,依据行为间的原因关系对变迁系统进行重构,即将路径中不具有原因关系的行为进行分离,通过合并重构后的相同路径实现状态空间的约简,减小变迁系统模型中的变迁关系集,缓解细粒度动态度量可能引发的状态空间爆炸.状态空间约简的方法也是获取可信动态度量行为预期的方法.最后分析约简效率.2行为系统及状态空间爆炸问题2.1行为系统及其描述Keller[11]于1976年提出了广为接受的基于抽象状态机的状态变迁模型,用于对并发系统的行为刻画.模型将一个变迁系统描述为状态和变迁关系的二元组.此后,Plotkin[12]增加了标记(动作)元组,即标记变迁系统LTS[13].下面给出LTS定义.定义1.一个标记变迁系统是一个四元组〈S,S0,A,δ〉,其中:(1)S是一个有限的状态集合;(2)S0是初始状态的集合,并且S0S;(3)A是动作的集合;(4)δ是变迁关系,δS×A×S.模型从状态、动作和变迁关系对行为系统进行了抽象和刻画,即行为系统从初始状态S0,按照变①https://www.trustedcomputinggroup.org/groups/TCG_1_Page3迁关系,完成相应的动作,实现向新的状态的转换.动作是行为在标记变迁系统中的模型化描述.一个动作可通过软件行为学[14]描述如下.定义2.一个动作定义为主体使用函数(过程)对客体进行操作:A={action=(s)APPLIES(f)TO(obj)|s∈Subjects,f∈Functions,obj∈Objects},其中APPLIESTO为施用,Subjects为主体集,Functions为函数集(过程、服务),Objects为客体集.变迁系统模型以中间状态作为纽带,通过连续的变迁构成路径,路径也描述了可能的行为时序.下面给出路径定义.定义3.在标记变迁系统〈S,S0,A,δ〉中若存在s0,s1,…,sn∈S(n>0),a1,a2,…,an∈A,使(s0,a1,s1),(s1,a2,s2),…,(sn-1,an,sn)∈δ,则称L={(si,ai+1,si+1)|(si,ai+1,si+1)∈δ,i=0,1,…,n-1}为路径,在不引起混淆的情况下可简记为L=a1a2…an.系统运行从初始状态S0,按照不同的变迁关系,在标记变迁系统模型中形成不同的路径.如图1所示为一个LTS,圆圈表示系统的状态,带箭头的连线表示变迁关系,箭尾相连的状态为变迁前的状态,箭头相连的状态为变迁后的状态,连线上的标注表示动作标记.LTS可形象地描述系统的动态运行过程.将标记变迁系统中所有状态构成的集合称作行为状态空间,简称状态空间.2.2状态空间爆炸随着计算机系统结构日益复杂,功能不断增加,系统运行状态空间迅速膨胀,使复杂并发系统的细粒度可信动态度量的可行性受到了严峻的挑战,即细粒度的可信动态度量引发系统状态空间爆炸.复杂并发计算机系统的行为除包括最基本的计算行为、输入输出行为、存储行为和网络传输行为外,还涉及系统与外界环境复杂的信息交换行为以及大量的进程并行工作导致进程间的相互作用行为等.因此,复杂的计算机系统运行所引发的系统状态变迁,形成了庞大的状态空间.假设一个标记变迁系统〈S,S0,A,δ〉,对s∈S,都有m个不同的动作a(a∈A),可使其发生状态变迁,即s∈S,(s,a,s)∈δ,这样,对一个路径长度为n的系统(不考虑回路),将产生一个规模为Σ=(mn+1-1)/(m-1)的状态空间,即n层m叉树所对应的状态空间,状态空间随n指数增长,当n大到一定程度,即产生所谓状态空间“爆炸”.系统细粒度的行为可信动态度量要考察系统每一个状态是否可信,状态空间越大,可信动态度量的复杂度越大,在状态空间爆炸下实施细粒度可信动态度量是不可行的.因此,要依据一定规则对状态空间进行约简,使细粒度的可信动态度量得以实施,并能保证可信动态度量结果的正确.3状态空间约简标记变迁系统在理论上描述合法行为序列具有完备性,即考虑了任一状态下所有可触发动作引发的状态变迁,这种完备性在对平台证据进行可信性验证时彰显了优势,因为可对所有证据可靠地给出可信性断言.然而,对于复杂的软件系统,这将产生庞大的状态空间.另一方面,可信关注的是“特定目标下的行为预期性”,而描述这些在特定目标下的预期行为是相对简洁和紧凑的,在达成特定目标的前提下,预期行为序列中的行为都是必需的,对目标没有影响的行为不在行为序列中.标记变迁系统描述了一个较大的状态空间,因为在任一状态下都考虑了所有可行动作所引发的变迁,所以能对所有平台证据可靠给出可信性断言;特定目标下的行为预期描述了一个相对小的状态空间,但是在对平台证据进行可信性验证时受到了限制,因为对于并发系统,即使是符合预期的平台行为,也很难严格按照预期所描述的步骤依次发生,很多不同目标下的行为可能交织发生,相互之间可能没有影响,也可能相互影响,并产生非预期,这更符合现实中的系统,但这种现实给可信性度量增加了难度,即理想的预期描述在现实中不适用.本文通过如下对标记变迁系统的处理在确保度量可靠性的同时,约简状态空间:(1)重构变迁系统路径;(2)合并重构后的相同路径.下面分别对2步处理的具体方法及合理性进行论述:对于(1),对变迁系统中同一条行为路径中的行Page4为依据、行为目标进行分离.本文通过行为关系研究行为与其目标的关联,在同一行为目标下的行为间具有特定的行为关系(即原因关系),不具有原因行为关系的行为对彼此的预期不会产生影响(对一个行为序列产生非预期影响的行为一定对该行为序列的至少一个行为构成原因),应置于不同的路径分开度量,所以这种路径重构不会影响度量的可靠性,反而缩短了路径长度,降低了复杂性.事实上,将变迁系统中的状态变迁的关注点由“合法性”转变为“因果性”(后者是前者的子集,即能够触发的行为不一定彼此具有特定的行为关系),因为“因果性”是导致非预期的根本,即使病毒发作,也未对当前行为目标构成原因,即不会产生非预期,故不在当前行为路径中度量其可信性.在可信性验证时,对平台证据依据行为关系进行同样的处理,确保平台证据在约简的变迁系统下可验证,因此,可信性验证所检出的非预期分为如下两种情况:①与某目标下的行为序列中的行为具有原因关系且应该发生的行为没有发生(这种关系是预期的,如登录网上银行时,安全程序未启动);②与某目标下的行为序列中的行为具有原因关系且不应该发生的行为发生(这种关系是非预期的,如病毒程序启动,且对当前操作序列构成影响).这里需要指出,步骤(1)并未减少变迁系统中变迁关系的数量.对于(2),合并重构后的相同路径,该步骤削减了变迁关系的数量,减小了状态空间,但减小的变迁系统能表示路径合并前的变迁系统中的所有路径.对此,已用相关定理进行了论证.所以,状态空间的约简并未降低度量的可靠性.3.1行为关系并发理论中的事件结构模型[15]对行为间的关系进行了描述,将行为间关系划分为原因关系、矛盾关系和独立关系.当系统运行时,实现特定目标的一系列行为中,行为间的原因关系起到了至关重要的作用,推动了行为目标的达成.另外,在复杂并发系统中,实现某一目标的行为已不再像在单任务环境下以连续性方式发生,而是与其他目标或子目标下的行为交织,这种交织增加了度量的复杂性.因此,通过行为的原因关系分析出对特定目标构成影响的行为,将无关行为分离,以简化度量.本节基于事件结构模型对变迁系统路径中的行为关系进行分析,将不具有原因关系的行为从路径中分离,使得变迁系统中的每条路径的行为具有原因关系.3.1.1行为关系描述并发性、分布性已经成为现代复杂计算机系统的基本特征,把由相互作用的子系统构成的、并呈现出并发性、分布性特点的系统称为并发系统.事件结构模型是描述并发模型的主要模型之一,形式化地描述了系统事件间关系,定义了事件间的原因、矛盾和独立关系.事件结构模型包括被标记的事件和事件间关系两个要素.事件是指发生的动作的模型化,对于一个动作的发生,它所发生的时间、原因及环境都各不相同,事件就是指具体的发生了的动作.事件是构成事件结构的基本单元.下面给出事件结构模型[15]定义.定义4.一个定义在集合A上的基本事件结构(以下简称事件结构)ξ是一个四元组〈E,<,#,l〉,其中:满足“矛盾继承规则”:系),并满足“有限原因规则”:(1)E是事件集合;(2)<E×E是非自反的偏序关系(即原因关e∈E:{d∈E|d<e}是有限的,〈的逆用〉表示;(3)#E×E是非自反的有限的矛盾关系,并d,e,f∈E:d<e∧d#fe#f;(4)l:E→A是动作标记函数,一个被a(a∈A)标记的事件表示动作a的一次特定出现.该模型在事件集合上定义了事件间关系,l将事件标记为动作.通过图示表示一个事件结构.如图2所示为一个包含3个事件ea,eb,ec的事件结构ξ,其中→表示原因关系,#表示矛盾关系.由原因关系和矛盾关系可以得到独立关系~,即d~e(d=e∨d<e∨d>e∨d#e),即~=defE×E\(〈∪〉∪#∪{(e,e)|e∈E}),显然,=、<、>、#和~是E×E的一个划分.下面通过行为关系图描述行为间原因关系.定义5.一个基于行为时序的序列a-=a1a2…an的行为关系图G=〈V,E〉,其中顶点集V={ei|l(ei)=ai},边集E={(ei,ej)|ei<ej且对ek∈V\{ei,ej},有(ei<ek<ej)}.行为关系图将事件作为图的顶点,原因关系作为图的边,反应了事件间的原因关系.显见,G是一个偏序关系的哈斯图,G可能是一个连通图,也可能由多个不相互连通的子图构成.行为关系图通过原Page5因关系反应行为的预期性,图3所示为一个行为关系图,在这些具有原因关系的行为作用下,达到预期的行为目标.定义4(2)所定义的原因关系是一种直接原因关系,具有直接原因关系行为是可信动态度量所要关注的.然而在独立关系中,还有一种特殊的行为关系,即两个事件虽不具有直接的原因关系,但这两个事件均对第三个事件构成了原因,由于具有这种关系的行为由原因关系间接地关联到一起,并同时作用于行为目标,所以应置于一条路径中度量可信性,这种关系称为间接原因关系,间接原因关系是一种对称关系,下面给出定义.定义6.设事件结构ξ=〈E,<,#,l〉,若e1,e2∈E,且e3∈E,满足e1<e3,e2<e3,则称e1,e2具有间接原因关系,记为e1⊙e2.具有直接原因关系和间接原因关系的行为最终达成一个行为目标,具有直接原因关系和间接原因关系的行为是可信度量在一个行为目标下所关注的.例如,如果将使用网上银行进行转帐作为一个行为目标,显然,登录及认证(a1)、输入转帐金额(a2)、输入收款人帐户信息(a3)和转帐(a4)行为是所关注的行为,若有ξ=〈{e1,e2,e3,e4},<,#,l〉,使对i,l(ei)=ai,显然有e1<e2,e1<e3,而e2、e3通过e4关联(即e2<e4,e3<e4),形成间接原因关系e2⊙e3,则转帐行为目标通过原因关系(直接、间接原因关系)构成了度量行为集{a1,a2,a3,a4}.3.1.2系统行为关系分析本节在行为关系描述的基础上,依据系统行为对系统视图(由系统属性确定的状态)的影响,分析和判定行为间关系.路径用序列a-=a1a2…an表示,行为构成的集合记为|a-|.显然,一个路径中不存在具有矛盾关系的行为,即事件结构ξ=〈E,<,#,l〉,ei∈E,l(ei)=ai,则对ei,ej∈E,1i,jn,有(ei#ej).下面对路径中行为间原因关系<和独立关系~进行分析判定.根据事件结构定义,区别原因关系和独立关系的依据是是否存在偏序关系,偏序关系的反对称性体现在从系统视图的角度上,行为在时序上的不可互换性,即若两个时序相关的行为互换,则对这两个行为以后的系统视图产生可见的影响,下面给出判定行为间原因关系的定理.定理1.定义在|a-|(a-=a1a2…an)上的事件结构ξ=〈E,<,#,l〉,即对ei∈E,l(ei)=ai,对ei,ej∈E,1i<jn,若珔b=b1b2…bp,c-=c1c2…cq,有|珔b|∩|c-|=,|珔b|∪|c-|={ai,ai+1,…,aj},ai∈|珔b|,aj∈|c-|,且珔b、c-满足对bu1,bv1∈|珔b|,cu2,cv2∈|c-|,若bu1=ar,bv1=as,cu2=at,cv2=aw(r,s,t,w∈{i,i+1,…,j}),则(u1-v1)(r-s)0,(u2-v2)(t-w)0,如果满足succ(…(succ(succ(s,ai),ai+1)),…,aj)=succ(succ(s,c-),珔b),则ei~ej,否则ei<ej.证明.设R是一种非自反的偏序关系,则R是非对称的,即若(ek1,el1)∈R,k1≠l1且k1,l1∈{1,2,…,n},则不存在|珚d|(珚d=d1d2…dn,且|珚d|=|a-|)使得ak1=dk2,al1=dl2(k2,l2∈{1,2,…,n}),但(k1-l1)·(k2-l2)<0,succ(…(succ(succ(s0,a1),a2)),…,amax(k1,l1))=succ(…(succ(succ(s0,d1),d2)),…,dmax(k2,l2)).则对于ei,ej∈E,1i<jn,若珔b=b1b2…bp,c-=c1c2…cq(|珔b|∩|c-|=,|珔b|∪|c-|={ai,ai+1,…,aj}),使得succ(…(succ(succ(s,ai),ai+1)),…,aj)=succ(succ(s,c-),珔b)时,(ei,ej)R,因为违背非对称性,故(ei<ej),又i<j,故(ei>ej),由于ei≠ej,(ei#ej),则ei~ej.而当(ei~ej)时,只有ei<ej.判定.例如,对于使用网上银行的某用户,若某时刻其帐户余额为b元(对应状态s1),若此后相继发生如下动作:向该帐户存入m元(a1),从该帐户对外转帐n元(a2),满足b+m>n,并有ξ=〈{e1,e2},<,#,l〉,使对i,l(ei)=ai,若b>n,则succ(succ(s1,a1),a2)=succ(succ(s1,a2),a1),即e1~e2,若b<n,则succ(succ(s1,a1),a2)≠succ(succ(s1,a2),a1)(由于帐户余额不相等),即e1<e2,这种行为间的原因关系限制了银行卡的透支行为.3.2基于行为关系的状态空间约简3.2.1变迁系统的划分基于行为关系的状态空间约简,通过分析路径的行为关系实现约简.路径过长,会使可信动态度量的度量粒度过大.因此,将系统的变迁系统划分为多个子变迁系统,划分后每个子变迁系统的路径能够表达完整的行为语义,度量粒度为一个子变迁系统.间接原因关系可依据定义和上述定理进行Page6图4为一个系统的变迁系统模型,当系统从s0变迁至s7后,状态s0,s1,s2,…,s7之间的变迁形成了一个完整行为语义,如一个线程,则这些状态和状态之间的变迁构成子变迁系统LTS1,同样道理构成LTS2、LTS3、LTS4.从初始状态s0出发,可沿3个选择分支,历经子变迁系统LTS1、LTS2、LTS3,子变迁系统LTS4的初始状态为LTS2的终结状态s9.3.2.2子变迁系统的重构对子变迁系统中各条路径进行行为关系分析,依据原因关系重构路径.路径重构后会出现相同路径,合并相同路径,实现子变迁系统重构.重构后的子变迁系统由从同一个状态出发的多个路径构成,每个路径是一次度量的预期.由于路径合并减小了子变迁系统的变迁关系集,使状态空间得到约简.3.2.2.1路径重构路径重构通过对路径行为关系分析,将一条路径中的行为划分为一个或多个行为集,每个行为集中的行为满足原因关系,基于行为集和行为发生顺序,构建新的路径.原路径中的行为可能被分至多条路径中,不同路径中的行为不具有原因关系.由于系统的目标由具有原因关系的行为变迁达成,因此可信性度量仅关注具有原因关系的行为.原因关系包括直接原因关系和间接原因关系,将具有原因关系的行为集合记作NA,每个行为是集合NA中的一个元素,下面给出集合NA的定义.定义7.集合NA={a|a∈A,ξ=〈E,<,#,l〉,满足l(E)=A,当a=l(e)且若a∈NA,a=l(e)≠a,则e<e∨e>e∨e⊙e}.集合NA中若包含两个或两个以上元素,则任两个元素代表的行为具有关系<、>或⊙.如果重构前路径的行为集为A_Set,由路径原因关系分析可知,若A_Set中包含m个集合NA,每一个集合NA记作Ai,1im,有A_Set=A1∪A2∪…∪Am,特殊情况下,m=1,另一方面,Ai中可能仅有一个元素.每个Ai中的行为构成一条新的路径.路径重构的原则:(1)一个行为及与其构成后继原因的行为均在同一重构路径中;(2)重构路径中的行为构成的集合是一个NA.由于NA仅体现两个行为间的原因关系,而路径由多个具有先后顺序的行为构成,这里,引入并发理论中描述事件结构行为的“格局”概念,描述具有原因关系的路径.格局是以行为集、行为和行为关系刻画的变迁系统中的某一状态.根据行为关系能够展现格局间的行为变迁.格局[16]定义如下:定义8.设集合X是事件结构ξ的事件集E的一个子集:(1)X是左封闭的,当且仅当d,e∈E:e∈X∧d<ed∈X;(2)X是无矛盾的,当且仅当ξ|X是无矛盾的,ξ|X=〈X,<∩(X×X),#∩(X×X),l|X〉;(3)X是一个格局当且仅当它既是左封闭的,又是无矛盾的.左封闭表明格局中与一个事件构成前继原因关系<的所有事件都必然在该格局中,无矛盾表明格局中不存在相互矛盾的事件.例如,在图2所示的ξ中,ea是eb的原因,并与ec矛盾,根据矛盾继承规则,eb也与ec矛盾,所以系统可能存在的格局有,{ea},{ea,eb}和{ec}.重构后的路径由具有原因关系的行为变迁到达某一目标所形成的,也就是路径经多个状态变迁达到最终状态.而格局仅描述了变迁系统中的某一状态.另外,格局定义了X是无矛盾的,说明X中的事件间具有原因或独立关系.因此,定义8不能准确地描述路径重构.根据路径重构原则,分别定义如下2个特殊格局和度量格局,来描述重构路径.定义9.设X是事件结构ξ=〈E,<,#,l〉的一个格局,X是一个最终格局,当且仅当e∈X,对e∈E,有(e<e).定义10.设X={e1,e2,…,en}是一个格局,并设若ei<ej(1i,jn),则i<j.X是一个最简格局,当且仅当对k∈{1,2,…,n-1},el∈X,使得ek<el.Page7最终格局表示不存在与格局中事件集合中的事件具有后继原因关系的事件,是无矛盾事件的最终状态;最简格局表明格局的事件集合中仅包含达到某一目标的那些具有原因关系的事件,换言之,最简格局中的所有事件在该格局行为达成的目标下都是不可缺少的.根据定义9和定义10,下面给出度量格局的定义.定义11.格局X是一个度量格局,当且仅当X是一个最终格局,且X是一个最简格局.例如,当关注网上银行的存款和转帐功能时,有如图5所示的行为关系图和事件结构模型,对于转帐行为,X1={e1},X2={e1,e3},X3={e1,e3,e4},X4={e1,e3,e4,e5}均为最简格局,但只有X4为最终格局,由于对e∈{e1,e2,e3,e4,e5},有(e5<e),实际情况中虽存在格局X5={e1,e2,e3,e4,e5},但X5并非最简格局,由于对于e∈X5,(e2<e),即存款非转帐必须发生的行为,则对于转帐功能,X4为度量格局.则l(X)是一个NA.论显然成立.下面给出度量格局的相关定理.定理2.X={e1,e2,…,en}是一个度量格局,证明.任取ei,ej∈X,若ei<ej或ei>ej,则结否则若(ei⊙ej),则ep,eq∈X,ep=ei或ep>ei,eq=ej或eq>ej,且对e∈X,(ep<e),e∈X,(eq<e),并且ep≠eq.由于X为度量格局,则X为最简格局,则ep,eq中至少有一个事件,不妨设ep,e∈X,使得ep<e,与对e∈X,(ep<e)矛盾.则有ei⊙ej,所以l(X)是一个NA.证毕.另外,可以通过行为关系图(定义5)描述度量格局,下面给出相应定理.定理3.给定行为关系图G=〈E,<〉,E为事件集,<为事件间的原因关系.ε是E的一个极大元,则X={e|e<ε}∪ε为一个度量格局.证明.由于ε是E的一个极大元,故对e∈E,有(ε<e),又由于ε∈X,所以X是一个最终格局.由于对e∈X\ε,至少有e<ε,故X是一个最简格局.由定义11可得,X是一个度量格局.证毕.上述定理表明,一个行为关系图G中的极大元ε关联一个度量格局X,记为X(ε).则图G描述的路径的所有度量格局为{X(ε)|ε是E的极大元}.事实上,一个度量格局只关联唯一的ε,所以ε与度量格局形成一一对应关系,这样可以通过ε唯一确定一个度量格局,下面给出定理.定理4.一个度量格局X={e1,e2,…,en}存在最大元.证明.通过反证法.若不存在最大元,则至少存在两个X上的极大元ei,ej,不妨设1in-1,由于X是一个度量格局,所以X是一个最简格局,由定义10:el∈X,使得ei<el,这与ei是极大元矛盾,故X中只存在一个极大元,所以度量格局X={e1,e2,…,en}存在最大元.下面举例说明通过行为关系图确定度量格局.行为序列a-=a1a2…a9的行为关系图G=〈E,<〉如图6所示,e9和e6是在原因关系<下的两个极大元,则e9和e6确定2个度量格局X(e9)={e1,e3,e4,e7,e8,e9},X(e6)={e2,e5,e6},同时e9和e6也是这2个度量格局中的最大元.由于系统的行为可以由格局间的动作变迁描述,所以连续的格局间的动作变迁可生成路径,从初始格局X0=开始,通过不断添加原路径中的单个行为生成新的格局X1,X2,…,Xi,…,Xn,对i∈{1,2,…,n},Xi=Xi-1∪{ei},ai=l(ei)∈A,格局生成过程中,当出现度量格局时(Xn是度量格局),格局中事件所对应的行为构成了一条重构后的路径,即L=a1a2…an.下面给出重构后路径的定义.定义12.设原路径L重构后生成路径L1,L2,…,Li,…,Lm,L和各Li对应的动作集分别为A_Set和Ai,则A_Set=A1∪A2∪…∪Ai∪…∪Am.且对i∈{1,2,…,m},Li由一个格局序列Xi0,Xi1,…,Xin生成,对j∈{1,2,…,n},Xij=Xi(j-1)∪{eij},aij=l(eij)∈A,n为Li的路径长度,Xin是度量格局.例如,设一个子变迁系统对应的事件结构ξ=〈E,<,#,l〉,其中E={e1,e2,e3,e4},e1<e2,e3<e4,对i∈{1,2,3,4},l(ei)=ai,一个基于l(E)的变迁Page8系统模型如图7(a)所示,对于路径L=a1a3a4a2,首先设X10=,当发生a1时,X11={e1},当发生a3时,若加入到当前格局,则a1与a3及其各自的后继原因事件将不构成最简格局,故不向X11中添加e3生成新格局,同样地,不向X11中添加e4,当发生a2时,由于e1<e2,向X11添加e2生成X12={e1,e2},状态s4提升至s1,即删除s1和s4之间的所有状态及变迁,同时合并s1和s4,由于X12已为度量格局,故生成一条重构后路径L1=a1a2.同样地,设X20=,当发生a3时,X21={e3},当发生a4时,向X21添加e4生成X22={e3,e4},X22为度量格局,故可得到另一条重构后路径L3=a3a4,对L路径重构后的子变迁系统如图7(b)所示,则子变迁系统中存在4条从s0出发的路径L1={(s0,a1,s1),(s1,a2,s5)},L2={(s0,a1,s1),(s1,a2,s5)},L3={(s0,a3,s6),(s6,a4,s5)},L4={(s0,a3,s3),(s3,a4,s5)}.3.2.2.2路径合并上一节给出了基于格局路径重构的方法,子变迁系统的路径重构后,一条路径可能生成一条或多条新的路径.子变迁系统中的各条路径重构后,可能出现相同的路径,合并这些相同的路径,使子变迁系统的变迁关系集δ减小,从而约简状态空间.下面给出路径相同定义.定义13.设L1={(si,ai+1,si+1)|(si,ai+1,si+1)∈δ,i=0,1,…,m},L2={(tj,bj+1,tj+1)|(tj,bj+1,tj+1)∈δ,j=0,1,…,n}为路径,若m=n,s0=t0,sm=tn,且对i∈{1,2,…,m},ai=bi,则称L1与L2路径相同,记作L1=·由于重构后的子变迁系统中的一条路径即一次度量的预期,子变迁系统中的那些相同路径作为可信度量的预期,可以将其看作一条路径.故当出现相同路径时,合并这些路径,实现状态空间约简.若h为一个LTS,记GL(h)为h中的路径集合,下面给出路径合并的定义.定义14.h=〈S,S0,A,δ〉为一个LTS,若L1,L2,…,Ln∈GL(h),L1=·Li={(sij,ai(j+1),si(j+1))|(sij,ai(j+1),si(j+1))∈δ,j=0,1,…,m},i∈{0,1,…,n},则对k∈{1,2,…,m-1},合并状态s1k,s2k,…,snk为sk,并令s0=s10=…=sn0,sm=s1m=…=snm,且对p∈{1,2,…,m},令sp=succ(sp-1,ap),ap=a1p=…=anp,则将L1,L2,…,Ln合并为L,L={(sj,aj+1,sj+1)|(sj,aj+1,sj+1)∈δ,j=0,1,…,m}.经路径合并的约简的变迁系统可以表示合并前变迁系统中的所有路径,即约简的变迁系统没有削减对预期行为的描述能力.下面给出定理.定理5.h=〈S,S0,A,δ〉为一个LTS,若L1,L2,…,Ln∈GL(h),L1=·L1,L2,…,Ln后形成变迁系统h=〈S,S0,A,δ〉,有GL(h)=GL(h).证明.由于h是h经路径合并所得,故若M∈GL(h),则M∈GL(h);对于M∈GL(h):若M{L1,L2,…,Ln},则M∈GL(h);否则,若M∈{L1,L2,…,Ln},则M=·{(sj,aj+1,sj+1)|(sj,aj+1,sj+1)∈δ,j=0,1,…,m},由于M∈GL(h),所以M∈GL(h).综上,由于对M∈GL(h),有M∈GL(h),对M∈GL(h),有M∈GL(h),所以GL(h)=GL(h).在图7所示例的路径重构后的子变迁系统(图8(a))中,由于存在2个{(s1,a2,s5)},同时{(s0,a3,s6),(s6,a4,s5)}与{(s0,a3,s3),(s3,a4,s5)}路径相同,合并这两组相同的路径得到如图8(b)所示的约简的子变迁系统.可见,状态空间变小.Page9可以根据重构前路径的行为特征判定子变迁系统经路径重构后是否存在相同路径,下面给出相应定理.定理6.设L1={(si,ai+1,si+1)|(si,ai+1,si+1)∈δ,i=0,1,…,p},L2={(tj,bj+1,tj+1)|(tj,bj+1,tj+1)∈δ,j=0,1,…,q}为路径,并设na是一个NA,若s0=t0,sp=tq,且1u1<u2<…<ump,1v1<v2<…<vmq,对i∈{1,2,…,m},aui∈na,aui=bvi,同时对j∈{1,2,…,p}\{u1,u2,…,um},ajna,k∈{1,2,…,q}\{v1,v2,…,vm},bkna,则路径重构后,L1,L2,使得L1=·证明.通过构造法证明.由于对i∈{1,2,…,m},aui∈na,对j∈{1,2,…,p}\{u1,u2,…,um},ajna,故基于na对L1进行路径重构,即对所有j∈{1,2,…,p}\{u1,u2,…,um},将aj从L1分离后形成L1={(si,ai+1,si+1)|(si,ai+1,si+1)∈δ,i=0,1,…,m},s0=s0,sm=sp,且对i∈{1,…,m},ai=aui;同样,基于na对L2进行路径重构后形成L2={(tj,bj+1,tj+1)|(tj,bj+1,tj+1)∈δ,j=0,1,…,m},t0=t0,tm=tq,且对j∈{1,…,m},bj=bvj.因为对i∈{1,2,…,m},aui=bvi,所以对i∈{1,2,…,m},ai=bi,又因为s0=t0,sp=tq,所以s0=t0,sm=tm,由定义13可得L1=·当子变迁系统中存在定理6所述性质的路径时,经路径重构后即出现相同的路径.在实际系统中,大量存在这种由非原因关系行为交织而造成的空间冗余.4约简效率分析本文提出的可信动态度量状态空间约简,通过减小变迁模型中的变迁关系集δ实现.下面分析约简效率:基于行为关系的约简通过约简变迁模型中的变迁关系集δ实现.对于图4所示系统对应的变迁模型,设该模型可划分为m个子变迁系统,对于第i(1im)个子变迁系统,基于行为关系约简前、后的变迁关系集大小分别为ui,vi,则原变迁模型中的变迁关系集大小为Δ=∑m迁关系集大小为Δ=∑m效率为ηR=1-Δ/Δ=1-∑m变迁系统的约简效率越高,整个系统状态空间的约简效果越明显.而对于各子变迁系统,ui-vi=∑nlj,lj为因路径合并所减小的长度,n为被合并的j=1路径数目,所以,对于各子变迁系统,路径重构后出现的相同路径越多(n越大),相应路径越长(lj越大),变迁关系集的约简效率越高.5应用实例本节通过网上银行系统说明状态空间的约简方法.当用户登录网上银行时,会有很多可供选择的行为支,如账户信息、转账汇款、缴费以及投资理财等.图9(a)是转账行为支的标记变迁系统模型,进入转账功能(atrs_in)后,系统在转帐行为前后提供用户账户信息查询功能(aqry),转账功能由用户转账信息(收款人帐号、转账金额)输入(ain)和转帐操作(atrs)两个动作组成,最后退出转帐功能(atrs_out),相应的事件结构为ξ=〈E,<,#,l〉,其中,E={etrs_in,eqry,ein,etrs,etrs_out},l(etrs_in)=atrs_in,l(eqry)=aqry,l(ein)=ain,l(etrs)=atrs,l(etrs_out)=atrs_out,由定理1可得,etrs_in<ein<etrs<etrs_out,对于路径L=atrs_inaqryainatrsaqryatrs_out,由度量格局生成过程可得度量格局X14={etrs_in,ein,etrs,etrs_out},X23={etrs_in,eqry,etrs_out}和X33={etrs_in,eqry,etrs_out},对L重构后得到如图9(b)所示系统,以同样方法对其他路径重构后进行路径合并,得到最终的系统如图9(c),可见,状态空间有了减小.行为间的原因关系分析将不可能产生非预期影响的行为进行了分离,从而简化了度量空间.这里需要说明,正常的账户查询不会对转帐产生非预期影响.若查询功能被越权使用,并对转帐产生非预期影响,则所采集的平台证据中,根据原因关系分析,查询行为不会从转账行为路径中分离,而在相同的路径中作为转账行为的原因.可信性验证时,行为预期未对这样的原因关系进行描述,检出非预期影响.对各路径重构后,会出现4条L1=atrs_inainatrsatrs_out和3条L2=atrs_inaqryatrs_out,则有5条路径需要合并,∑5lj=7,需要指出,两条相同路径间可能存在公共j=1子路径,所以因合并而减小的路径长度不包括这段共有的子路径长度.由于Δ=u1=12,所以ηR=7/12=58.3%,即通过行为关系的约简对原变迁系统的状态空间缩减了58.3%,事实上,这种基于行为关系Page10的冗余对于越复杂的软件系统,存在的几率会越大,所以在目前软件发展趋势下,这种约简对于可信动态度量具有明显的现实意义.图9网上银行系统的基于行为关系的约简6结论在可信度量进入到对动态度量的研究,同时度量粒度逐步细化以后,度量空间的急剧膨胀是度量方法可行性亟待解决的难题.本文运用并发理论研究行为状态空间的约简,对解决状态空间爆炸作出探索性的尝试.约简通过分析路径中具有原因关系的行为,并用格局的概念描述子变迁系统中具有原因关系的行为序列,进行路径重构,重构后,路径长度变短,路径数量增加,合并重构后的相同路径,使变迁系统中的变迁关系集δ减小.由于路径重构依据行为关系将不会影响预期的行为从路径中分离,简化了度量的复杂性,同时路径合并保持了原有预期行为路径的表达能力,所以本文在约简状态空间的同时,确保了度量的可靠性.本文给出了约简方法的应用实例.从约简后的状态空间可以很容易地得到面向行为的可信动态度量的行为预期.最后分析了状态空间的约简效率,结果表明,路径重构后子变迁系统中相同路径越多,约简效率越高,缓解状态空间爆炸的效果越明显,这种约简对于复杂的软件系统具有重要的现实意义.
