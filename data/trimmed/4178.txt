Page1基于概率攻击图的内部攻击意图推断算法研究陈小军1),2),3)方滨兴1),2)谭庆丰2),3)张浩亮2)1)(中国科学院计算技术研究所北京100190)2)(中国科学院信息工程研究所信息内容安全技术国家工程实验室北京100093)3)(中国科学院大学信息科学与工程学院北京100049)摘要内部攻击行为具有明显的多步骤性和伪装性.这些特性增加内部攻击检测的难度,影响检测结果的准确性.攻击图模型能够描述攻击行为的多个攻击步骤之间的因果关系,但由于单步攻击检测结果存在的不确定性,使得攻击图模型无法准确地推断攻击者的意图.该文在攻击图模型中引入转移概率表,刻画单步攻击检测结果的不确定性,即从观测事件推导出某步攻击发生的概率,提出了一个面向内部攻击意图推断的概率攻击图模型.基于该模型,提出了一种推断内部攻击意图的算法以及针对攻击目标的最大概率攻击路径的计算方法.实验结果表明该文的工作能够有效地推断攻击意图和计算攻击路径,减少不可信报警数量,为网络安全管理员提供良好的可配置性.关键词内部攻击;概率攻击图;行为分析;意图推断;网络行为1引言随着计算机网络的发展,网络攻击技术也在快速发展,各种安全攻击事件层出不穷,而其中来自内部恶意人员的攻击事件所占比例越来越重.内部恶意人员是指具有以下行为的恶意的前或者现职员、承包商和商业伙伴:(1)被授权访问组织的网络、系统或数据;(2)故意超越或滥用其访问权限;(3)行为损害该组织的信息或者信息系统的机密性、完整性和可用性[1].典型的内部攻击包括知识产权窃取、欺诈和IT破坏等行为.内部攻击能给企业甚至国家带来巨大的危害,最为著名的例子是2010年,美国士兵曼宁非法下载大量机密文档和视频,刻录在CD上并带出军事基地,随后,逾9万份阿富汗战争文件被维基解密组织暴露[2].该事件在全球政界和安全界引发了强烈“地震”,内部攻击威胁也受到各界关注,防护内部攻击迫在眉睫.如何尽早地发现内部攻击并推断其攻击意图是内部攻击检测研究面临的一个难题.该问题主要面临着两个挑战:(1)内部攻击行为具有较强的伪装性,这导致检测结果具有一定的不确定性;(2)内部恶意人员可以有充裕的时间安排攻击行动,其攻击行为具有多步骤性.内部攻击的伪装性体现在两个方面.恶意内部人员可以滥用自己的合法权利,在正常行为遮掩下从事非法活动,称为行为伪装;也可以通过职便或者社会工程学的手段获取他人的身份认证信息,冒充合法用户进入他人电脑或数据中心窃取机密数据,称为身份伪装.在具有行为伪装和身份伪装的内部攻击者面前,传统的防火墙和访问控制等手段基本会失效.因此内部攻击行为检测方法更多地采用异常检测的算法来发现用户偏离正常行为模式的行为,从而确定攻击的存在,比如Schonlau等人[3]通过检测用户的命令执行序列来发现异常行为,Salem等人[4]对用户的文件搜索访问行为建立一类支持向量机模型来检测身份冒用者(Masquerader),Zheng等人[5]通过鼠标移动等的生物行为特征来确定当前用户是否为合法用户.这些方法能检测一些异常行为,但也存在较高的假阳性FalsePositive(FP)和假阴性FalseNegative(FN),如Schonlau等人[3]用贝叶斯一步马尔科夫模型检测执行命令序列,其FP为6.7%,FN为21.3%.较高的假阳性会浪费网络安全管理员大量的人力分析成本,而错误的指控内部人员会带来破坏性的影响.内部攻击的多步骤性体现在内部攻击者有足够的时间观察、计划和实施攻击方案,逐步攻击系统的弱点,达到攻击目标.这种多步骤性加重了内部攻击检测方法的复杂度.攻击树/攻击图模型可以模拟不同节点之间的因果依赖关系,常被人用来研究复杂的多步攻击行为.攻击图通过对攻击行为和目标网络进行建模,刻画了攻击者有步骤地实施攻击,一步步提升权限,获取更多的资源,并达到攻击目标的过程.但现有的攻击图大多通过分析漏洞之间的关系构建,攻击事件一旦被观测到,则对应的攻击被认为已经发生,在单步攻击检测过程中可能引入的不确定性被忽略.图1中展示了两种内部攻击过程的实例.攻击场景A描述了内部漏洞利用攻击的过程图,恶意用户MaliciousUser(M)利用Web服务器上的漏洞CVE-2002-0640(URL缓冲区溢出)获取Web服务器的管理员权限,进而通过网络文件系统接口在文件服务器上写入木马程序,最后该木马被管理员Admin(A)不小心执行从而让恶意用户M可以窃取到管理员A计算机内的机密数据.该场景中的大Page3部分动作都可以被安全监控系统检测到,M的攻击行为明显具备多步攻击的特性,他通过5个攻击步骤完成对机密信息的窃取企图,每一步攻击都具有明确目的,前后两次攻击动作是一种依赖关系.图1的攻击场景B描述了一个恶意的内部人员M利用职便,通过“猜密码”的方式进入了管理员A的个人电脑,并安装了一种具备KeyLogger功能的恶意软件.A负责管理企业中的文件服务器(FileServer)和其它资源.由此,M获得了A在文件服务器上的用户权限,M通过A的权限登入了文件服务器,并下载机密文档.该场景下,除了恶意软件KeyLogger行为可能会被杀毒软件检测到外,大部分的攻击行为都是在合法权限下进行的常规操作,难以被普通安全防护系统检测到.M也可能通过其它手段替代KeyLogger获取文件服务器的密码,比如拷贝走A的密码维护文件.攻击场景B中,M的每一步攻击行为都具有伪装性,只能利用异常检测算法检测每一个步骤的行为异常.不少异常检测算法可以为每一个检测结果给出分值,指示算法对结果的置信程度,我们称为检测结果(观测事件)的置信度.置信度反应从一个观测事件推导出某步攻击真实发生的概率.传统的攻击图模型将检测结果作为确定性事件处理,无法在检测结果存在不确定性的情况下有效地推断攻击者的真实意图.针对该问题,本文提出了一种面向内部攻击意图推断的概率攻击图模型,该模型利用概率转移表刻画了单步攻击检测结果的不确定性.在此基础上,提出了一种能根据安全监控系统的报警日志序列和相关的置信度,推断当前网络中内部攻击潜在意图的方法,并给出针对攻击目标计算最大概率攻击路径的方法.本文的主要贡献有;(1)提出面向实时内部攻击意图推断的概率攻击图模型,并在攻击图中刻画了单步攻击检测结果的不确定性,给出其概率推导方法;(2)在已知概率攻击图和观察事件序列的前提下,给出推断当前攻击潜在意图的算法以及针对攻击目标的最大概率攻击路径.(3)在实际的攻击场景下对本文的概率攻击图模型和攻击意图推断方法进行了验证,实验结果表明本文的工作能够有效地推断攻击意图和计算攻击路径,减少不可信报警数量,为网络安全管理员提供良好的可配置性.本文第2节介绍相关研究工作;第3节给出概率攻击图模型的定义并依次介绍概率攻击图的构建方法、攻击意图推断和最大概率攻击路径计算算法;第4节通过实验展示概率攻击图模型的计算过程,证明其在减少不可信报警数量和可配置性方面的优势;最后总结本文的工作并对未来的研究进行展望.2相关工作在内部攻击行为检测方面,Brackney等人[6]首先比较全面地描述了内部攻击在IntelligenceCom-munity(IC)系统里的危害和实施过程,并由此提出了一个全面的检测框架.该框架包含了对个人角色、用户动作、系统事件、监视器、融合分析和安全策略等6个方面的检测与分析.在Brackney框架的基础上,Zheng等人[5]构建了基于用户的鼠标移动等生物特性身份冒用者检测框架,取得了不错的效果.Maloof等人[7]根据用户的文件访问行为设计了一个系统Elicit,来检测那些违背“需要知悉”(need-to-know)原则的用户行为.以上工作致力于检测内部人员单一的异常行为,这些异常检测能揭示某些简单的内部攻击意图,但对精明熟练的内部攻击者,其行为具有明显的多步性和计划性,这类方法就具有一定的局限性.但上述工作都可以作为本文的基础,提供对具体某一步攻击行为的观测事件和相关的不确定性估计,比如Zheng等人的工作可以用来检测身份冒用攻击,Maloof等人的工作可以检测异常下载攻击.攻击图已被人们广泛应用在网络安全状态和风险评估[8]、分析系统安全的最优弥补集[9]等方面.在概率攻击图研究成果中与本文相关的主要有两方面的研究.首先,在概率攻击图结构与不确定性的研究方面,Wang等人[10]根据漏洞攻击的难度和配置网络的代价,建立了攻击图的概率属性,首次正式地提出了评估网络风险的一种概率安全属性,并在此基础上提出了用累积概率的方法计算整个网络的安全属性.该方法讨论概率属性的几种计算方法,但并未引入观测事件的置信度进行概率计算.Xie等人[11]第一次深入地探讨了在攻击图中3种不确性的来源,分别为攻击图结构的不确定性、攻击动作发生的不确定性以及触发报警的不确定性.其触发报警的不确定性与本文所提单步攻击检测结果的不确定性有一定类似,但他们的模型中仅对一些重要攻击节点引入前提条件,即攻击动作节点AttackActionPage4Node(AAN),计算中只有当攻击动作节点为真时才对攻击节点进行概率推导,因此他们也未完全将单步攻击检测结果的不确定性纳入到概率推导计算过程中来.其次,在概率攻击图的推导计算方面,张少俊等人[12]提出了一个在满足观测事件偏序条件的情况下,利用贝叶斯推理计算攻击图节点的置信度方法.他们的模型中攻击节点与观测事件的条件关系与本文所提的正好相反,该模型根据当前攻击节点的概率,使用似然抽样算法推导观测事件的置信度,而我们的工作则利用安全监控系统给出的观测事件的置信度来计算攻击意图的概率.在Wang等人[10]工作的基础上,叶云等人[13]提出了一种攻击图简化算法来解决存在环时攻击图推导存在的性能瓶颈问题,基于简化的攻击图,给出计算最大可达概率的方法.最大可达概率的概念与本文的累积概率类似,本文扩展其用法,不仅仅计算目标攻击节点的最大可达概率,而且计算其最大概率的攻击路径.另外与Wang等人的工作一样,该工作也未引入观测事件的置信度进行概率计算.综上所述,针对内部攻击的研究能检测内部攻击人员某一方面的行为异常,但该类方法一方面其结果具有较大的不确定性,另一方面无法应对有计划分步骤的复杂内部攻击.攻击图的研究工作较好地刻画了多步攻击,但大都关注在预先固定的网络配置环境下的安全风险评估计算,没有利用当前攻击动作检测结果的不确定性进行概率计算,在进行内部攻击意图的推断计算方面有一定的限制.3概率攻击图及攻击意图推断3.1概率攻击图的定义内部攻击是一种很复杂的多步骤行为,包含着一些完成最终攻击意图所必须达到的子攻击目标和一组紧密关联的基本攻击动作.基本攻击动作的实施帮助攻击者达到子攻击意图,攻击者相应地获得更多的资源和权限,以实施下一次攻击.攻击图可以静态地评估一个网络系统的安全状况,但是很难动态地攻击意图推断,即根据当前安全系统的运行状态,评估可能存在的攻击.实时的攻击意图推断主要面临着几个不确定性的因素:(1)某个状态下是否一定会发生某种攻击;(2)攻击是否一定会成功;(3)安全监控系统的异常告警多大程度上预示着攻击正在发生.为了建立适用于充满不确定性的内部攻击意图推断的模型,本文在Ou等人[14]的攻击图模式上进行修改,加入了3类条件概率转移表,以此来表示上述讨论的3类不确定性.概率攻击图的形式化定义如下.定义1.概率攻击图定义为一个有向无环图PAG=(N,E,Δ),其中:(1)N代表节点集合,N=S∪A∪O.S是状态节点集合,每一个状态节点代表攻击者每步攻击后所处的状态,包括取得的攻击资源或权限能力.s0是初始状态节点,表示攻击者最初所处的攻击状态.G表示攻击目标节点集合,满足约束:GS.A是攻击动作节点集合,ai表示某个具体的攻击动作发生.而O为观察事件节点集合,假定每次攻击ai发生,安全监控系统能以一定的概率监控到某些事件oi.所有节点的取值为(0,100],分别表示“攻击状态达到(S)”,“攻击意图成功(G)”,“攻击动作发生(A)”以及“攻击被检测系统观察到(O)”的置信度.(2)E是表示各类节点之间因果关系的有向边集合.细分E可表示为E=Es∪Ea∪Eo.其中EsS×A,表示攻击者拥有某些资源后才能实施某些攻击动作.EaA×S,表示一次攻击成功后能够获取更多的资源,进入新的攻击状态.EoO×A,表示根据安全监控系统观测到的事件可以确定或者推断某个攻击已经发生.(3)Δ为条件概率表CPT(ConditionalProba-bilityTable),依附于每一条有向边上.根据有向边的分类,Δ=(Δs,Δa,Δo),Δs是依附于有向边集Es上的条件概率表,Δsij表示在攻击状态si下可能发生后续攻击aj的概率.Δa是依附于有向边集Ea的条件概率表,Δaij表示攻击动作ai成功并进入下一状态sj的概率.Δo是依附于有向边集Eo的条件概率表,Δoi表示观测事件的置信概率,即察到oi事件时能证明攻击ai发生的概率,即P(ai|oi).根据以上定义,图2展示了攻击图的几种可能的情况.其中攻击状态节点用不带线条的圆圈表示,攻击动作节点用带空心的黑色圆圈表示,观察事件节点用黑色实心节点表示.每一条便都依附着一个概率属性,用Δ表示.定义2.指向同一节点的边之间存在“与”和“或”的关系,具体定义如下:(1)依附于状态节点的边都是“或”关系.(2)依附于攻击动作节点的边有两种情况,如果ei,ej∈Es,即从攻击状态节点到攻击动作节点,Page5则ei,ej之间是“与”关系,表示要发动某次攻击必须同时满足所有前提状态.如果某条边ei∈Eo,则该有向边与其它依附于该攻击节点的所有其它边是“或”的关系.如图3中的状态节点s2,表示该攻击状态能通过攻击a2达到,也能通过实施攻击a3达到.依附于a4的边有3条,从s2和s3到a4的两条边是“与”的关系,而从o4到a4的边与其它两条边是“或”的关系.本模型把观察事件节点到攻击节点之间的边认为是和其余所有依附于该攻击节点的边用“或”连接起来,这在现实中具有合理的解释:当人们观察到事件发生时,可以不用考虑其前提条件是否满足即可推断该攻击行为可能确实发生了;而如果没有观察到事件(比如IDS被攻击者成功欺骗),则可以通过其已经满足的前提条件来推断该攻击发生的可能性.3.2概率攻击图的构建过程概率攻击图的构造分为两部分:攻击图基本结构的确定和条件概率表CPT的生成.攻击图结构的生成目前大部分都依赖于专家知识库来生成,比如Ou等人[14]采用Horn逻辑描述攻击模板,可以利用漏洞和攻击之间的逻辑关系半自动辅助安全专家来生成大规模的攻击图结构.攻击图结构的生成是一个复杂的问题,本文的攻击图结构假定利用专家知识库来生成,而主要关注如何确定攻击图中的条件概率表CPT.在3.1节介绍的概率攻击图中,条件概率表CPT是其中最重要的部分.张少俊等人[12]在其模型上也引入攻击行为发生的概率、攻击行为成功的概率以及攻击证据被观察到的概率P(oi|ai),与本文介绍的概率攻击图最为相似.但是他们在计算过程中,假设攻击行为发生概率和成功的概率为0.5,P(oi|ai)为1.0.他们没有给出这3种概率在实际系统中的含义,且将P(oi|ai)定义为1.0,本质上与没有引入观测事件节点其结果是相同的.本文根据已有的静态漏洞分析知识库和安全监控系统动态生成的事件置信度作为确定条件概率表的依据,很好的与实际情况结合,使得后续的攻击意图推断算法更具有说服力.Δs表示攻击发生的概率.Δsij为在状态si下,攻击aj发生的概率P(aj|si).如果攻击方法是利用某个软件固有的漏洞,那么攻击发生的概率与该漏洞被利用的难易程度非常相关.一般来说,攻击方法越简单,其发生概率越大.NationalVulnerabilityDatabase(NVD)发布了大量软件漏洞,通用安全脆弱点评估系统CommonVulnerabilityScoringSystem(CVSS)是一个能量化各个软件漏洞属性的工具.其中存取复杂度Ac-cessComplexity(AC)描述了发动漏洞攻击的难度,可以取值高、中、低.因此CVSS系统对漏洞的评估可以被作为确定Δsij的来源.在内部攻击中,也存在大量攻击方法不是利用软件漏洞来发动,比如猜口令攻击、KeyLogger攻击等.这种攻击手段发生的概率可以通过安全专家指定,比如猜口令攻击很容易实现,但不易成功.本文通过给每类攻击指定一个类似于CVSS系统的AC属性一样的参数,来给出相应的概率取值.另外,也可以通过网络安全系统给出的攻击日志数量来确定.表1给出了本文所使用的标准,如果一个漏洞在CVSS系统中的AC属性为“High”,或者某类攻击被安全专家标记为“High”,则说明该攻击实施的难度很大,满足预设条件时,其可能发生的概率被设置为0.2.如果某类攻击在一周内安全监控系统报警次数小于5次,则说明该类攻击手段很少被使用,其可能发生的概率被设置为0.1.Δa表示攻击成功的概率.Δaij为攻击ai成功后达Page6到状态sj的概率P(sj|ai).实际上攻击发生概率和攻击成功的概率是相关的,比如攻击者选择一个软件漏洞进行攻击与其是否成功都是跟利用该软件漏洞的难易程度相关.但是它们又不完全一样,比如猜口令攻击,一个网络中很容易发生这种攻击,但是成功的可能性却比较低.因此,这里将软件漏洞攻击的成功概率置为1.0,攻击发生概率中已经考虑了其难度,而对其它异常攻击,则根据专家知识库来设置.Δo表示观察到的事件确定攻击正在发生的概率,即观测事件的置信度.Δoi表示攻击观察事件oi能证明ai正在发生的概率.现代的信息安全监控系统能根据特定的规则检测某些具体攻击,也能根据用户的日常行为模式检测异常.前者通常预示着某些确定性的攻击正在发生,而后者给出的危险报警常常具有比较高的FP和FN,信息安全监控系统也常常能给出该类事件的置信度p.对于确定性的攻击oi,Δoi可以取值为1;对有不确定性的异常事件oj,Δoj可以取值为其相对应的置信度p(oj).Δo在概率攻击图中是一个延迟变量,其值在安全监测系统观测到具体事件时才能被决定.3.3攻击意图推导算法定义了概率攻击图后,需要解决如下问题:对给定的当观测到一些攻击行为告警时,如何推断当前网络中潜在的攻击意图和可能的攻击路径?该问题可形式化表述如下.问题1.给定概率攻击图PAG=(S,E,Δ)和一个观察事件序列O={o1,o2,…,on}及其对应的置信概率PO={p1,p2,…,pn},求:(1)P(G|O,PO);(2)从S0到G的一条路径(S0,…,Si,…,G),使得攻击概率最大.为了解决该问题,下面首先定义累积概率,然后给出攻击意图的推断算法,最后给出最大概率攻击路径选择算法.3.3.1累积概率累积概率本来定义一个随机变量取值某个范围的概率.在此处,状态节点和攻击节点的累积概率定义为在给定攻击图和当前观测到事件的情况下,达到当前攻击状态或者发生当前攻击行为的整个可能性.累积概率的具体定义如下.定义3.给定概率攻击图PAG=(N,E,Δ),状态节点集合S和攻击节点集合A中节点的累积概率CP(CumulativeProbability)被定义为:(1)CP(oi)=1,即如果从安全监控系统观察到事件oi,则该事件就是确定性发生了;(2)CP(s0)=1;否则,CP(si)=(Pre(si));(3)CP(ai)=U(Pre(ai)),如果oi没有看到;否(4)(s,s1,s2)表示指向s的节点确定的所有则,CP(ai)=(U(Pre(ai)),oi).边执行概率“或”操作,计算如下:边执行概率“与”操作,计算如下:(5)U(s,s1,s2)表示指向s的节点确定的所有U(s,s1,s2)=CP(s1)Δ1×CP(s2)Δ2.(6)Δ1,Δ2分别是依附在从s1到s和s2到s的边上的条件概率.3.3.2攻击意图推断算法在上述对节点累积概率的定义下,CP(G)即在观测事件序列下可能发生攻击意图的总体概率估计.因此,只需要计算每个攻击目标节点的累积概率,然后对其进行排序即可知道当前网络最可能发生的攻击意图.积概率.算法1采用广度优先算法对各个节点计算其累算法1.攻击意图推断算法.输入:概率攻击图PAG=(N,E,Δ);观察事件序列O={o1,o2,…,on}及其对应的置信概率PO={p1,p2,…,pn}.输出:攻击图中各个节点的累积概率.FUNCTIONIntentInferring(PAG,O,PO)1.Queue_Init(Q);2.Queue_Push(Q,s0);//将初始节点压入队列中3.WHILE(Queue_Empty(Q))DO//判断4.n=Queue_Pop(Q);5.FOREACHciischildofnDO6.Queue_Push(Q,ci);7.IFn∈状态节点集STHEN8.ncp=P_OR(n,Pre(n));Page79.IFn∈攻击节点集ATHEN10.(o,p)=从输入(O,PO)中找到与节点n相关11.n.cp=∏Ri∈Pre(n)Ri.cp;//计算节点n的12.IF(o,p)不为空THEN13.ncp=ncp+1p-ncp1p14.ENDWHILE15.RETURN所有节点的累积概率;其中,概率“或”函数P_OR(s,Pre(s))的定义如下:FUNCTIONP_OR(s,Pre(s))1.Not_N=12.FOREACHciinPre(s)DO3.Not_N=Not_N(1-ci.cpΔ);4RETURN1-Not_N复杂度分析:本算法与图上的广度搜索算法复杂度相同,为O(N_num+E_num),即节点数和有向边数规模的和.3.3.3最大概率攻击路径选择算法定义4.最大概率攻击路径指这样一条攻击路径Path=(s0,…,si,…,G),在所有的路径中CP(Path|(GAE,O))最大.经典的Viterbi算法常用于在隐马尔可夫模型中,寻找最优可能产生观测事件序列的隐含状态序列.最大概率攻击路径本质上同Viterbi算法的目的类似,只是最大概率攻击图状态节点取值空间与隐马尔科夫模型中的状态空间不一样,而且观测序列允许事件缺失.因此,我们在Viterbi算法的基础上进行修改来寻找最大概率攻击路径.在算法1得到的所有节点累积概率基础上,算法2利用贪心算法反向查找.如果当前节点为状态节点,则寻找概率最大的攻击节点;如果当前节点为攻击节点,则包含所有前提状态节点到路径中.算法2.最大概率攻击路径选择算法.输入:攻击图PAG=(N,E,Δ);以及各个节点的累积概率CP={nicp|ni∈N}.输出:最大概率攻击路径Path=(S0,…,Si,…,G).FUNCTIONMaxProbabilityPath(PAG,CP)1.Path={};2.Queue_Init(Q);3.g=argmaxg∈G(gcp);//从目标节点集中取出最4.AddgtoPath;//节点放入路径中5.Queue_Push(Q,g);6.WHILE(Queue_Empty(Q))DO7.n=Queue_Pop(Q);8.IFn∈ATHEN9.Queue_Push(Pre(n));//将n的所有前提10.AddPre(n)toPath;11.IFn∈STHEN12.c=argmaxc∈pre(n)(ccpΔc);13.Queue_Push(c);//节点出队列14.AddcintoPath;//将节点加入路径中15.ENDWHILE16.RETURNPath;复杂度分析:该算法与算法1相似,复杂度也是O(N_num+E_num),即节点数和有向边数规模的和.4实验验证本节首先以图1所代表的网络拓扑为例,介绍在实验环境中真实搭建的网络环境以及在此网络环境中的安全漏洞和内部攻击手段.然后利用第3节介绍的概率攻击图定义,给出了此场景下的概率攻击图结构和对应的CPT表.最后通过捕获了一些模拟攻击数据,给出概率攻击图的计算过程以及和其它方法检测结果的比较和分析,其结果证明了我们算法的可行性,以及在缩小攻击报警范围方面的有效性和灵活性.4.1实验网络环境在图1所示的网络拓扑中,网络被分为3部分:外网区域、内部办公区和内部服务器区.外网与内网通过防火墙系统逻辑隔离开来;内部服务器区部署一台网站服务器(apache2.2)、文件服务器(Linux2.4)和其它服务器;内部办公区部署一些终端和个人PC,包括一台模拟的恶意内部用户终端和管理员终端.内部服务器区上存在的漏洞包括网站服务器上apache的CVE-2006-3747(Apachemod_rewrite模块单字节缓冲区溢出漏洞)和文件服务器上存在CVE-2003-0252(Linuxnfs-utilsxlog()远程缓冲区单字节溢出漏洞),两种漏洞的攻击复杂度分别为High和Low.实验环境中部署了一些安全监控软件,包括Snort用来捕获各种漏洞利用攻击行为和网络行为异常事件,Tripwire部署在文件服务器上,用来监控文件系统的完整性,各个终端和个人计算机上部署OSSEC,用来监控PC端的木马活动和异常行为.Page84.2概率攻击图的结构和CPT表图3表示了图1两种攻击过程的完整攻击图.为了避免繁琐,图3中省去了条件概率表,除观测事件到攻击节点的条件概率在实际计算过程外,其它条件概率取值根据3.2节中定义的方式在表4中给出.4.3实验及结果分析4.3.1计算过程与分析根据图3和表4确定了本文所定义的概率攻击图,通过实验环境部署的Snort、Tripwire和OSSEC等安全监控软件可以观测到观测事件以及其对应的转移概率,以此为输入,即可通过3.3节定义算法1和算法2计算当前的潜在攻击意图及其最大概率攻击路径.实验结果如表5所示.边概率取值边(s0,a1)0.9(s0,a6)(s0,a10)0.8(a1,s1)(a6,s6)1.0(a10,s7)(s1,a2)0.4(s1,a3)(s6,a7)0.8(a2,s2)(a3,s2)1.0(a7,s7)(s2,a4)0.6(s3,a4)(s7,a8)0.8(a8,s8)(a4,s4)1.0(s8,a9)(a9,s4)1.0(s4,a5)(a5,s5)1.0编号观测事件序列O1O2{o6:1,o7:0.85,o9:0.9}{s0,a6,s6,a7,s7,a8,s8,a9,s4,a5,s5}O3{o2:1,o4:0.9,o8:0.5}{s0,a1,s1,a2,s2,a4,s4,a5,s5}状态节点O1O2O3攻击节点O1O2O3s0100100100a1909090s1999a23.63.6100s210.510.5100a37.27.27.2s3100100100a45.055.0594.8s436.694.396.9a532.984.987.2s62010020a62010020s783.299.483.2a7169716s866.579.566.5a866.579.583.2狊532.984.987.2a933.29441.6在表5中,我们针对3种情况对攻击意图进行推断和攻击路径计算.为了不失一般性,假定第1个实验中没有观测到任何事件,这相当于传统的网络安全风险评估方法,根据已有的漏洞知识和专家知识库可以发现系统中最脆弱的攻击路径.图4(a)直观地体现了攻击者最可能的攻击路径以及置信度评估.在没有看到任何报警事件的情况下,可能存在攻击成功的概率是32.9%,最可能采取的攻击路径是{s0,a10,s7,a8,s8,a9,s4,a5,s5}.第2个实验假设系统观测到了o6,o7和o9事件,其对应的置信度分别为1.0,0.85和0.9.在此情况下,推测攻击成功的概率为84.9%,最可能的攻击路径为{s0,a6,s6,a7,s7,a8,s8.a9,s4,a5,s5},如图4(b)所示.第3个实验假设系统观测到事件o2,o4,o8,对应置信度分别为1.0,0.9.0.5.在此情况下,推测攻击成功的概率为87.2%,最可能的攻击路径为{s0,a1,s1,a2,s2,a4,s4,a5,s5},如图4(c)所示.需要说明的一点是,在第3个实验中s1的累积概率非常小,只有9%,但该路径上的其它累积概率都非常大,这可解释为安全监测系统极有可能没有捕获到“猜密码成功”事件,也说明本文所提方法能够处理在某些观测事件缺失的情况下推断攻击意图和攻击路径.4.3.2检测结果的比较与分析贝叶斯网络算法被广泛应用在攻击图中检测攻击.叶云等人[13]的工作在攻击图上计算累积概率,但他们的模型中没有考虑观察事件推导到攻击发生的不确定性,观测事件与攻击发生是一一对应的,对应到我们的模型中即Δoi取值全为1.Xie等人[11]的工作中观测节点被有选择地引入,某些重要的攻击节点引入一个特殊的前提节点AAN.攻击节点的概率计算方式与本文所述方法不同,只有当AAN节点为真(被观测到)才用其前提节点进行与或计算得到攻击节点的概率.否则,其攻击节点的概率被置为0.Page9图4在观测序列O1,O2和O3上的推断过程示意图从实验环境中安全监控软件的日志数据中,我们提取了100个观测序列及其相关的转移概率,加上4.3.1节的两次攻击序列O2和O3,共有102个观测序列.本文实现了叶云等人的算法(Inferring_Ye)和Xie等人的算法(Inferring_Xie),其中Xie的算法分别选择a7(1_AAN),a7和a9(2_AAN)作为具有AAN节点的攻击节点.将这102个观测序列作为输入,在为目标节点选择不同的置信度阈值情况下,3个算法的检测结果情况如表6所示.置信阈值Inferring_OurInferring_YeInferring_Xie0.5380.6260.7220.8170.9从结果对比表6中,首先观察到的是我们的算法(Inferring_Our)的报警数量明显要比其它两种算法少.通过分析那些在其它算法中报警但我们的算法中没有被检测出来的案例,发现很多在叶云等人的算法中被检测命中观测序列,其观测事件的置信概率都很低,如第10、30和31个观测序列(O10={o2:0.1},O30={o4:0.1},O31={o4:0.2}),在In-ferring_Ye和Inferring_Xie1AAN都检测命中,而在Inferring_Our中检测结果的置信度分别为35.5%、38.7%和44.4%.这种差别的原因在于其它两种算法只考虑观测事件是否发生,而没有考虑观测事件的置信度,这也正是内部攻击行为检测会造成大量报警日志的原因.通过利用安全监控软件中异常检测算法提供的观测事件的置信概率,我们的算法能更有效地检测攻击威胁.另一方面,如果网络安全管理员也可以通过调节攻击目标节点的置信阈值实现捕获更多攻击.上一小节的实验已经表明在没有任何输入事件(O1={null})的情况下,概率攻击图的目标节点受到攻击的概率是32.9%.只要选择的置信阈值等于或低于32.9%,所有的攻击行为都会被检测到.其次,我们的算法对阈值变化的敏感性要优于其它的算法.当调节阈值从0.5~0.9时,我们的算法给出的检测结果数量从38降到2,且每一次阈值调节带来的变化都很明显.而算法Inferring_Ye和Inferring_Xie则表现得不敏感.这也是因为这两种算法仅考虑了攻击图结构的不确定性,这些不确定性都是在攻击图构造过程中就已经固定下来了,因此,以上两种算法的计算过程对输入观测序列的敏感性不高.而我们的算法更重要的是将运行期监控到的观测事件及其置信概率作为输入,可以实时计算攻击意图和攻击路径.算法对阈值选择的敏感性可以帮助网络安全管理员更快地找到嫌疑最大的攻击行为,提供了良好的可配置性.5结束语内部攻击行为的检测面临着复杂性和不确定性Page10的挑战.本文描述了如何在目标网络中根据安全专家知识库和各种安全监控软件的实时检测结果建立概率攻击图,推断攻击意图并计算可能的最大概率攻击路径.本文提出的模型和算法考虑了监测事件的不确定性,可以利用现有的安全监测系统的异常检测功能,应对内部攻击行为的伪装性和多步骤性带来的挑战.实验结果表明本文的工作能够有效推断攻击意图和计算攻击路径,减少不可信报警数量,为网络安全管理员提供良好的可配置性.本文的概率攻击图模型完全依靠专家知识库来构建,这对在大规模网络中推广使用该模型有一定的限制,未来我们开展对自动构建大规模的内部攻击概率攻击图以试图解决该问题.本文的另一个限制是由于缺乏大规模的内部攻击公开数据集,算法没有在公开数据集得到验证.由于安全和隐私等问题,安全行为分析方面的公开数据集一直很少,据我们所知,仅有KDD’99的入侵检测数据集得到大家的广泛认可.而这个数据集因不太适用于本文所提的内部攻击意图推断,寻找或者构建适合内部攻击意图推断的数据集,并建立可量化的评价指标也是我们下一步的工作方向.
