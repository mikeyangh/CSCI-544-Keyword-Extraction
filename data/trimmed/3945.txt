Page1一种基于Gestalt原理的多连通分量形状外包络提取方法吕肖庆1)符松平1)宋建国1)高良才1)汤帜1),2)1)(北京大学计算机科学技术研究所北京100080)2)(数字出版技术国家重点实验室(北大方正集团有限公司)北京100871)摘要图形识别领域的学者们正在将研究重点从简单图形转向复杂图形,其中,由多个独立图元(该文中称为连通分量)组合成的外轮廓对于复杂图形的整体分析起着至关重要的作用.该文提出了一种针对多连通分量形状提取整体外轮廓(即外包络)的方法.该方法基于德劳内三角剖分(DelaunayTriangulation),根据Gestalt原理,通过对轮廓片段的凹度和连通分量之间松散度的分析,构造了紧致的外包络,特别是针对断口情况,即由于明显内凹或间隙过大造成的视觉缺失,提出了一种基于平滑曲线对接的恢复方法,最终得到了更符合人类视觉感知的外轮廓.实验对象选自MPEG-7图形库,实验结果表明了该文方法在提取复杂图形外轮廓方面的有效性.关键词外包络提取;多图元形状;平滑对接;Gestalt原理;图形检索1引言随着网络与多媒体技术的迅速普及,产生了越来越多的图像,基于内容的图像检索技术成为了近年国内外研究的热点.其中,形状和颜色、纹理等特征一样,都是一个物体最基本的特征,而且会给人留下更强的视觉感知,因此人们一直希望能直接用形状信息进行图像检索.基于形状的检索依赖于对象的检测,特别是准确的轮廓提取,对于多对象的复杂图形而言,如何提取符合人类视觉感知的外轮廓一直是个挑战.这一挑战不仅来自计算机视觉和模式识别领域,而且还来自心理学和认知神经科学等领域,各领域的最新进展都有助于我们认识人类视觉感知中高层形状信息是如何形成的,据此提出的识别方法可用于图像检索系统中,取得更好的检索结果.本文正是在这一背景下,提出了一种符合人类视觉感知的多对象复杂图形外轮廓的提取算法,以获取更为准确的视觉形状特征.2相关工作形状外包络(Envelope)的概念最早是由Eakins等人[1]于1996年在他们的商标检索系统ARTISAN中提出.他们根据Gestalt理论的近似性规则将对象进行聚类,对每类对象再构建其外包络,由外包络构造的形状特征作为整个商标的重要特征.文献[2]提出了一种自适应的选择方法,利用Zernike矩和几何基元的特征来描述商标,对商标图像而言,其几何特征也是基于Gestalt理论的4个原则———连续性、接近性、平行性和闭合性,根据该理论,整体轮廓不等于各部分之和,需按照上述4个原则进行分析.文献[3-4]在多对象形状分析中提出了一种外包络的提取算法,该算法首先对多对象进行聚类,再利用形态学方法和平滑技术获得外包络,将其应用于手绘商标检索中取得了不错的实验结果,但该算法仅仅依靠形态学的处理,有些边缘的细节不够精确.在文献[5]中,Hung等人把质心点到周边各方向上最远的点的集合作为外包络,对于不存在点的方向,利用三次插值拟合进行弥补,该算法对于质心位于整体图形内部且不同连通分量空间位置比较紧密的情况比较有效,但当连通分量分布比较松散时,会形成多个方向或者较大夹角区域中没有最远点,即使采用了拟合技术也很难取得理想效果.文献[6]针对闭合轮廓,从视觉感知的角度,提出将某些形状分解成为基本结构和细长条结构,并认为前者比较稳定,后者一般是形状突变,对于一些有凹形长条的图形,其外轮廓就可视为在基本结构上去除这些长条的影响后的结果.文献[7]认为轮廓中大部分内凹在视觉上可以被忽略,描述形状时予以删除可增强形状主体特征.文献[8]采用数学形态学的策略模拟人对形状的视觉感知,获得忽略细节后的整体形状特征,提高了形状检索的准确率,但对于不同类型的形状,多大尺度下可以作为外包络尚难确定.此外,在地学领域中,Xu等人[9]针对平面点集,提出了一种基于Graham扫描法的ω-hull凹包算法计算外包络,但对于散点的不同空间分布,很难自动确定角度ω获得合理的外包络.针对同样的问题,文献[10]基于三角剖分检测平面点集的空间特征,通过去除大于指定距离阈值的边,来获取点集的外包络.本文重点关注的是断口对外轮廓的影响,即一些实体边界局部上存在明显的内凹,或在多个对象的边界之间存在局部间隙,但在视觉上并不影响人眼感知完整的轮廓,在这方面也有不少前人的探索可以参考.Schuster等人[11]采用二次或三次多项式来拟合数据点;Tsiligianni等人[12]采用B样条恢复原来的形状;Soares等人[13]利用多项式拟合数据点,并用Bezier曲线实现对接;Ben-Yosef和Ben-Shahar[14]依据人类视觉对线条的感知是在初级视皮层形成的这一事实,用单元切向集束(unittangentbundle)模拟初级视皮层,并对缺失曲线段问题进行了形式化的描述,在此基础上通过计算两个断点之间最短可接受曲线段,取得了很好的缺失曲线恢复效果.综上所述,现有方法虽然做了有益的探索,但对于多对象图形还存在以下问题:(1)对参数的依赖程度过高,不同参数下有些样本的实验效果好,有些不好,常常顾此失彼,较难达到较高的一致性;(2)对于相当一部分实验对象的外轮廓提取,效果并不完美,即不符合人类的视觉感知.本文则根据对多连通分量形状轮廓片段的内凹程度和连通分量之间的松散程度的分析,利用Bezier曲线对外轮廓的断口做了平滑处理,提出了一种全新的外包络提取算法,所得结果更符合人对形状整体的视觉感知.3算法设计本方法的设计基于Gestalt原理(又称作格式Page3塔原理或完形心理学),该原理主张:整体轮廓不等于各部分之和,强调人的视觉具有一定的“构造”能力,而不是机械地记录.例如,接近性原理指出我们更倾向于把彼此靠近的元素组合到一起;连续性原理指出我们更容易把轮廓平滑连续的图形组合看成一个整体,而不是那些方向发生突变的图形;闭合性原理告诉我们那些看上去闭合或接近闭合的图形更容易被看成一个整体[15-17].这些结论对于我们提取符合人类视觉感知的外轮廓无疑具有重要的指导意义,在具体的算法设计中,我们分为5个主要步骤加以实现:(1)对图像进行二值化,提取图像中各连通分量自身的轮廓,并用顺时针顺序的x-y坐标序列表示;(2)为体现整体性,我们对所有轮廓点的集合进行Delaunay三角剖分,将它们关联到一起;(3)提取点集的凸包作为初始的外包络;(4)根据本文提出的约束条件,不断地向内迭代收缩,将相关的视觉原则转化为可计算的凹度和松散度等计算方法,算法要对所有外包络上的边进行深度遍历,对每一条边进行收缩判断,如果需要收缩就用Delaunay的关联边替换;(5)对外轮廓断口根据视觉的连续性和闭合性要求设计曲线对接方法,以期恢复平滑的连接效果,并获得最终的外包络.算法的整体流程如图1所示.为便于理解算法的关键步骤,对本文所用的符号说明如下.如图2所示,做三角剖分后得到三角形中的当前边用E=(Ps,Pe)表示,Ps为起点,Pe为终点,位于边E的右侧的对应的Delaunay三角形顶点用PNN表示,它与边E的两个端点Ps、Pe构成Delaunay三角形,E对应的原始图像的轮廓段为CS.图2(a)中粗虚线就对应着由原始所有外轮廓点的凸包构成的初始外包络,在该例中,这条粗虚线边显然是不符合视觉效果,不能准确地反映出整体形状,按照人的视觉感受外包络在虚线框处应该要缩进.图2(b)和(c)是图2(a)的局部放大图,图2(b)是图2(a)中的当前需要处理的轮廓段E,从图2(b)Page4到图2(c)粗虚线的变化则对应着一次收缩操作,采用的方法是将Delaunay三角形中的一条边替换为Delaunay三角形中另外两条邻边.3.1收缩规则如何制定边的收缩规则在整个外包络计算过程中起着至关重要的作用,会直接影响最终的外包络的提取效果.首先,我们将边分为两种类型,类型I和类型II.如果一条边的两个端点属于同一连通分量,称该边为类型I.如果一条边的两个端点分别属于两个不同的连通分量,称该边为类型II.3.1.1针对类型I边的收缩模型对于类型I边的收缩判断是利用局部封闭区的面积AreaLER与边长LE的平方的比值来衡量局部曲线的内凹程度,计算公式如下:用所得凹度与单联通凹度阈值做比较,若小于凹度阈值且不为零时收缩,否则不收缩.3.1.2针对类型II边的收缩模型对于多连通分量,当轮廓边的两个端点不在一个连通分量时,如图3所示,需要构造一个动态局部封闭区(DLER),在得到DLER之后可以参照类型I的判断方法计算跨连通分量的轮廓边是否需要收缩.为克服不同图形间的差异,避免人工调节凹度阈值,DLER的检测需要依赖图形松散度的计算,在本方法中我们将松散度转化为形状中的各个连通分量之间平均缝隙大小.具体计算是通过不同半径大小的圆形结构元素对目标形状进行闭操作,找到使所有连通分量连接为一个整体的最小尺度的圆形结构元素.最后,将能够把连通分量连接在一起形成一个整体的最小尺度圆形结构元素的直径作为松散度的取值.对于多连通图形,根据Gestalt原理的整体性,我们尽量把多连通分量当做一个整体来看待.但是对于两个连通分量之间的边,如果跨度很大,也是不应该收缩的,因此相关阈值的计算与单联通对象的计算有所不同.简言之,图形松散度相对大的,相应的轮廓边收缩的长度阈值也会相对较大.为构造DLER,当前边长度与动态阈值做比较,大于阈值的边就往里面预收缩,不断重复此操作直到不能收缩为止,这时的所有轮廓点就形成了DLER.之后可以利用式(1)计算出凹度,进而执行收缩判断与操作.这里需要指出的是:虽然收缩判断依赖阈值,但在本方法中阈值是根据每个图形自身的松散度自动调整的,因此本算法对各个图形具有很好的一致性.有关收缩规则的前期研究内容可参见文献[18].3.2断口处平滑对接之所以要提出“断口处平滑对接”是因为由实体边界线本身构成的外包络,或即使跨越断口用直线连接而成的外包络,会因为断口的影响产生类似噪音的局部凹陷,这种包络线并不符合人类视觉感知,而且也会给后续应用外轮廓进行图形相似性比较带来干扰.人类视觉对复杂图形外轮廓的感知往往会忽略细小断口的影响,尤其是对一些设计类图形更倾向于感知到一个平滑、完整的外轮廓,这种要求在实际判断图形相似性的过程中起到了非常重要的作用,为此我们需将其作为潜在的外轮廓形状约束假设.保持断口对接后的平滑性就是指力求获得消除了断口影响的、更加平滑、整体感更强的外轮廓,在后续的具体计算中我们将“平滑性”转化为曲线在衔接处保持导数一致作为优化目标.如图4所示,人类对于图4(a)的轮廓感受是:不仅会忽略掉右下角缺口的影响,而且还会偏向于一个完整圆形的轮廓,而不是像图4(b)中由直线连接形成的机械轮廓.很多断口是在计算初始轮廓时就存在的,在收缩过程中也会形成一些新的断口,如果用直线直接连接,显然得不到平滑的整体轮廓,因此,需要采用平滑的曲线来补全这个断口,这样更符合人类的视觉感知.补全断口的曲线在视觉上必须与断口的两个端点相切,而且还要顺应两端基线的趋势.在参考了现有技术[11-14]的基础上,本文设计了基于Bezier曲线的平滑对接技术,具体算法主要分为以下4个步骤:Page5进行建模,拟合出两条基线;(1)评估并选择对断口有贡献的两个端点的点(2)用Bezier曲线分别对断口两端的贡献点集(3)计算断口中间符合视觉感知的新生长点;(4)基于新的生长点计算连接曲线,并以此恢复断口形状.经过以上步骤,我们可以计算出一条对接曲线,它不仅能继承断口两端曲线的趋势,并可与两端的基线实现平滑连接,算法涉及的关键技术说明如下.3.2.1断口点集选取与基线建模为计算断口连接线的形状,首先要分析出哪些点对断口有贡献,换言之,哪些点蕴含了断口连线的趋势.显然距离断口越近的点贡献越大,反之,越远的点其影响则逐渐减弱.但如何量化地选择贡献点集是一个关键问题,经过观察和分析,我们认为断口本身的距离,即断口的跨度是一个很重要的参考依据,根据它的长度估计贡献点集数量在视觉上符合人的感知,这样我们可以得到点集大小的初始值,假设其取整后为n,则可从断口两端分别开始找到n个原始数据点O={p1,p2,…,pn}.如图5(a)为需要处理的断口,图5(b)为断口两端数据点集的选取.贡献点集确定后,就可以采用Bezier曲线来进行基线建模.n阶Bezier曲线一般采用下式表示:q()t=∑n集,作为拟合基线的基础;式(2)中,Pi为n阶Bezier曲线的控制点,Bi,n()t是基函数.为保证平滑程度,我们采用三阶Bezier曲线为基线建模,其表示如下:式(3)中,P0,P1,P2,P3为3次Bezier曲线的4个控制点,t为参数.其中,第1个控制点P0,最后1个控制点P3分别要与第1个数据点和最后1个数据点重合,所以只需要确定中间两个控制点P1,P2,我们采用最小二乘法拟合的方法求中间两个控制点,假设有n个数据点,pi,q(ti)分别是对应的原始和拟合数据,定义最小二乘方程如下:式(4)可以进一步写为S=∑n通过解下式可求解P1、P2:求得中间两个控制点以后,进而可求得拟合数据为Q={q1,q2,…,qn},即初始基线.但初始基线有可能并不能很好地反映贡献点集的分布情况,为此,我们要在确保拟合效果的前提下,通过消减贡献点集的方式逐步迭代计算新基线,直至其达到合理的拟合效果.具体计算方法如下:首先,为判断拟合效果,求出所有原始点O={p1,p2,…,pn}与对应拟合数据点之间的距离;之后,将其与经验阈值相比较,如果有大于阈值的点,则从远离断口的一端减少一个数据点;第三,对剩下的数据点重新拟合,得到新基线;重复上述步骤,直到拟合基线与入选的贡献点集之间的距离低于阈值,最终得到的Bezier曲线被用来拟合断口的贡献点集.对于图5(a)的断口,最终拟合基线如图5(c)所示,从断口两个端点开始拟合的两段基线为Cl、Cr,图5(c)粗线所示.Cl是由控制点(Pl是由控制点(Pr0,Pr1,Pr2,Pr3)组成的Bezier曲线.3.2.2新生长点的选择与连接曲线的构造有了两端的基线,我们就可以根据其走势计算新的生长点,进而构造出连接曲线.新生长点的计算根据的是可保证平滑度的对称性估算方法.具体方法如图6所示,图6(a)为新的控制点的求取区域,Page6其中,求出Pn-1出Pr1关于Pr0的对称点为新控制点Pr接曲线的生成过程,利用Pn可以根据式(3)求出补全原断口的Bezier曲线,生成的对接曲线如图中粗虚线所示.补全断口的对接曲线与断口两端的曲线Cl、Cr连接的平滑性可以证明如下.由式(2)可以求得任意一条n阶的Bezier曲线在端点的一阶导数如下:其中:n为Bezier曲线的阶数,q·(0)为起点处的一阶导数,P0、P1为离起点最近的两个控制点,q·(1)为终点处的一阶导数,Pn-1、Pn为离终点最近的两个控制点.因此任意一条n阶的Bezier曲线在端点处的切线方向只与端点最近的两个控制点有关,端点处切线方向与最近的两个控制点的连接方向相同.由于新的控制点是按照对称性原则生成的,所以断口处基线与生成的对接曲线在端点处有相同的一阶导数,即在图6(b)中,Pn-1l的连线方向相同,P0r与P1r的连线方向和P0r与PsPs连接方向相同,两曲线连接的平滑性得以保证.4实验结果与分析我们的实验主要分两个部分:(1)在外包络的提取效果上与文献[5-6]其它方法进行比较,从MPEG-7形状库中选择部分复杂形状进行测试;(2)检验外包络作为形状的整体特征在形状检索中的提升作用.本文采用相同一组凹度阈值,实现了对不同类型的多连通分量和单连通分量形状的外包络提取.单连通分量凹度阈值设定为2.5,多连通分量设定为0.75.为了评估本文算法的有效性和通用性,首先与其它算法比较了外包络的提取效果.表1(a)与(b)分别是与文献[5]和文献[6]算法的对比结果,从表1的对比结果看,本文提出的算法改善了其它算法在提取外包络过程中存在的局部形状信息缺失或扭曲等问题.(a)(b)从MPEG-7形状库中选择部分复杂形状进行测试,结果如图7所示.从测试结果可见,不管是单连通还是多连通的图形,本文方法都能够得到平滑、准确的外包络.图7MPEG7CE-2中部分复杂形状的外包络Page7为了验证外包络作为形状的整体特征在多连通分量形状检索中的作用,我们在MPEG-7CE-2商标库的子集SETB上进行了测试,该集合一共包含2811个形状,其中682个形状已经由人工分成10类.实验中,将这10类中的每个形状作为查询形状在SetB中进行检索,并且利用BEP(Bull’sEyePerformance)来进行评估,BEP可衡量检索方法的查全性能,值越大越好,通过计算前2×N个检索结果对查询形状的查全率来度量,这里的N为查询形状所属类中形状的个数.本文选择了角度径向变换[5](AngularRadialTransform,ART)、Zernike矩[19](ZernikeMomentDescriptor,ZMD)和通用傅立叶[20](GenericFou-rierDescriptor,GFD)3种基于区域的形状描述子以及内距形状上下文描述子[21](Inner-DistanceShapeContext,IDSC),对比它们结合外包络前后的检索效果,具体方法是:计算原始形状S1和S2的相似性距离为D1,S1的外包络S1env和S2的外包络S2env的距离为D2,那么结合外包络后的距离D=α×D1+β×D2,α、β为权值,实验中都取0.5.外包络对平均检索率的提升作用如表2所示.ZMDARTGFDIDSC表2的实验结果表明,结合外包络的形状特征后,有效地增强了ZMD、ART、GFD对形状的描述能力,明显地改善了它们在形状检索中的效果.事实上,外包络不仅可以与这3种方法结合,而且可以与任何一种描述多连通分量形状的方法相结合,更为重要的是,像IDSC这类不适合描述多连通分量形状的方法,也可以通过描述外包络形状来描述其整体形状特征.5结论本文基于德劳内三角剖分和Gestalt理论,把多连通分量形状在视觉上看作一个整体,通过对形状轮廓段的内凹程度分析,利用轮廓段的相对深度描述凹度,对整个形状采用数学形态学的策略,进行多尺度的分析,定义了连通分量之间的松散度,衡量形状中连通分量之间的缝隙大小,并采用基于松散度的限制构造出缝隙间的轮廓,从而,利用边的对应轮廓的凹度衡量其对形成外包络的贡献.为了保持原始外轮廓断口两边曲线的趋势,对断口处做平滑对接,最终得到了平滑的外包络,为分析复杂的多连通分量形状提供了整体形状信息.实验结果表明,形状分析中引入外包络的形状信息,可以有助于提高检索的准确率.但是算法中关于边的收缩条件仍有进一步的改进空间,目前,算法中仅仅是根据局部的区域信息去考虑收缩条件,因此,我们下一步将对收缩条件方面做进一步的探索,增强算法的自适应性.
