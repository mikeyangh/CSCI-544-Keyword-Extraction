Page1Petri网极小虹吸的计算方法与性能分析张金泉1),2)倪丽娜1),2)蒋昌俊2)张军旗2)1)(山东科技大学信息科学与工程学院山东青岛266510)2)(同济大学嵌入式系统与服务计算教育部重点实验室上海201804)摘要虹吸是Petri网的一种重要结构,可以用来分析所模拟系统的许多重要特性,如可达性、可逆性和活性等.文中首先提出了虹吸子网的概念,并给出了将Petri网划分成虹吸子网的多项式算法,进而给出其性能分析.通过求解虹吸子网的极小虹吸得到原Petri网的所有极小虹吸.而对于每个虹吸子网,首先求解它的一个极小虹吸,并根据此极小虹吸对子网进行分解,将分解得到的子网做类似原网的处理过程,直到每个子网的位置集就是一个极小虹吸或不包含任何极小虹吸为止.性能分析及实验表明,所构造的求解Petri网所有极小虹吸的算法是一个有效的算法.关键词Petri网;虹吸子网;极小虹吸;活性1引言Petri网是一种描述系统并发、并行、异步等特Page2如活性反映了被描述系统的整体或局部无死锁性.而虹吸(陷阱)作为Petri网中的重要结构[1-2],特别适合于分析Petri网的活性[3-4]及控制所模拟系统的死锁预防[5]和避免.Park[6]等结合标识和虹吸构造了死标识虹吸,并用它分析具有资源需求的简单顺序流程系统的活性,从而给出了顺序资源分配系统的死锁避免策略;Li等[7]将极小虹吸分为严格极小虹吸和非严格极小虹吸,又进一步将严格极小虹吸分为基本虹吸和松弛虹吸,通过控制基本虹吸得到对所模拟的柔性制造系统的死锁控制.虹吸(陷阱)的定义是非常简洁的,但是,计算Petri网的虹吸(陷阱)至今没有找到一个多项式算法.许多学者在这方面做了大量的研究工作,提出了基于不等式[1]、逻辑等式[8-9]、线性代数方法[10]、带松弛变量的线性方程[11]、线性规划[12]、结构性质[13-15]以及通过构造对偶网的可重复向量[16]等算法.特别是Cordone等[15]基于极小虹吸的性质给出了一个将Petri网分解成子网、通过求子网的极小虹吸得到原网极小虹吸的算法.但是,该方法在分解原网时子网之间的重叠部分较大,因此分解的速度较慢.本文通过研究极小虹吸和网结构的特点,提出了虹吸子网的结构,并证明了极小虹吸包含在一个虹吸子网中,不属于任何虹吸子网的位置也不属于任何极小虹吸,而任何两个虹吸子网都是不相交的,这样我们就可以实现一个网的快速分解,并且只需求解每一个虹吸子网的极小虹吸就可以得到原网的所有极小虹吸.本文第2节给出Petri网虹吸和极小虹吸的概念以及与本文相关的工作;刻画虹吸和极小虹吸的主要结论在第3节给出;第4节给出求解极小虹吸的算法过程;演示算法的例子、算法性能的模拟结果在第5节给出;结论及近一步的工作在第6节给出.2Petri网的基本定义及相关工作本节给出与本文工作相关的基本概念,详细内容请参见文献[1].Petri网是一个三元组N=(P,T;F),其中P和T是有限非空集合且它们不相交.P是位置集合,T是变迁集合,F(P×T)∪(T×P)称为流关系.值得指出的是,本文针对位置的容量无限、流的权为1的Petri网展开研究工作.结点x∈P∪T的前集定义为·x={y∈(P∪T)|(y,x)∈F},x的后集定义为x·={y∈(P∪T)|(x,y)∈F}.子集S(P∪T)的前集定义为它的每个结点前集的并,即·S=∪x∈SS·=∪x∈Sx·.NR=(P,T;FR)称为N的逆网,其中(x,y)∈F→(y,x)∈FR且(x,y)∈FR→(y,x)∈F.一个非空集合PP导出的子网N=(P,T;F)(记为red(N,P))定义为T={t∈T|(·t∪t·)∩P≠}且F=F∩((P×T)∪(T×P)).显然,x,y∈(P∪T),(x,y)∈(F)+→(x,y)∈F+.在不引起混淆的情况下,对于子网N中(x,y)∈(F)+直接写成(x,y)∈F+.一个非空集合SP是虹吸当且仅当·SS·.一个虹吸是极小的当且仅当它的任何一个非空真子集都不是虹吸.一个非空集合SP是陷阱当且仅当S··S.显然,网N的虹吸(陷阱)是其逆网的陷阱(虹吸).因此,求解虹吸(陷阱)的算法同样适合于求解陷阱(虹吸).下面引入本文相关的几个结论[15].设N=(P,T;F)是一个Petri网,s∈P,如果·s=,则{s}是N的一个虹吸,且是极小虹吸.我们把这样的虹吸称为N的平凡虹吸.求解这样的极小虹吸是比较容易的.t∈T,如果·t=,则s∈t·,N的任何一个虹吸中均不含有s.设SP是N的一个虹吸.如果s1∈S满足t∈s·S)=,则S-{s1}也是N的一个虹吸;S是N的一个极小虹吸当且仅当s∈S,red(N,S-{s})不含有虹吸;S={s1,…,sk}P是N的一个极小虹吸,则N的所有极小虹吸的集合等于{S}∪Σ1∪…∪Σk,其中Σi是red(N,P-{si})的极小虹吸的集合.3虹吸子网和极小虹吸本节首先给出虹吸子网的定义,然后分析Petri网中虹吸子网的特点,最后给出虹吸子网与极小虹吸的关系.定义1.设N=(P,T;F)是一个Petri网,PP且P≠,N=(P,T;F)是P导出的一个子网,如果(1)x,y∈(P∪T),x≠y满足(x,y)∈(F)+∧(y,x)∈(F)+;(2)x∈(P∪T),y∈(P∪T),(x,y)∈F+∧(y,x)∈F+→x∈(P∪T);则称N是N的虹吸子网,N的所有虹吸子网的集合记为sc(N).Page3定理1.设N=(P,T;F)是一个Petri网,sc(N)是虹吸子网集,N1=(P1,T1;F1),N2=(P2,T2;F2)∈sc(N),N1和N2满足(P1∪T1)∩(P2∪T2)=.证明.假设(P1∪T1)∩(P2∪T2)≠,亦即x∈(P1∪T1)∩(P2∪T2).那么y∈(P1∪T1),z∈(P2∪T2),满足(x,y)∈F+且(z,x)∈F+,有(z,y)∈F+,同理可证(y,z)∈F+.这与N2是虹吸子网矛盾.定理1表明,N的任意两个虹吸子网都不相交,因此sc(N)是一个有限集.定义2.设N=(P,T;F)是一个Petri网,sc(N)是虹吸子网集,N1=(P1,T1;F1),N2=(P2,T2;F2)∈sc(N),x∈(P1∪T1),y∈(P2∪T2),满足(1)(x,y)∈F+;(2)z∈(P∪T)-((P1∪T1)∪(P2∪T2)),N3=(P3,T3;F3)∈sc(N)-{N1,N2},满足(x,z)∈F+∧(z,y)∈F+,有称N1是N2的前驱虹吸子网,记为pre(N1,N2),N2是N1的后继虹吸子网,记为suc(N2,N1).定理2.设N=(P,T;F)是一个Petri网,sc(N)是虹吸子网集,N1=(P1,T1;F1),N2=(P2,T2;F2)∈sc(N),x∈(P1∪T1),y∈(P2∪T2),满足(x,y)∈F+,则(y,x)F+.证明.假设结论不成立,即有(y,x)∈F+.z∈(P1∪T1)都有(z,x)∈F+,故(z,y)∈F+,同理(y,z)∈F+.这与N2∈sc(N)矛盾.证毕.定理3.设N=(P,T;F)是一个Petri网,sc(N)是虹吸子网集,N∈sc(N),N不存在前驱虹吸子网.证明.假设结论不成立.即N∈sc(N),N存在前驱虹吸子网,则在sc(N)存在一个序列Ni=(Pi,Ti;Fi)∈sc(N)(i=1,2,…,k)满足Ni是Ni1的前驱虹吸子网,其中i=k时,i1=1,i<k时,i1=i+1.即xi∈(Pi∪Ti)(i=1,2,…,k),满足(xi1,xi)∈F+,那么(xi,xj)∈F+(i≠j),这与Ni∈sc(N)(i=1,2,…,k)矛盾.同理,可证sc(N)中存在虹吸子网,它不存在后继虹吸子网.定理2和定理3表明N的任意两个虹吸子网N1和N2,如果N1是N2的前驱虹吸子网,则它就不是N2的后继虹吸子网;如果是N2的后继虹吸子网,(1)N1的位置到N2的变迁存在有向弧;(2)N1的变迁到N2的位置存在有向弧;(3)N1的位置到N2的位置通过一个变迁构成N1到N2的一条有向路.引理1.设N=(P,T;F)是一个Petri网,N=(P,T;F)是N的一个虹吸子网,S1P且S1≠,s∈P-P.如果S1∪{s}是虹吸,则S1是虹吸或者{s}是虹吸.证明.如果·s=,则显然{s}是虹吸,因此,不s∈S1,有且仅有下列3种情形之一:(1)(s,s)∈F∧(s,s)F;(2)(s,s)∈F∧(s,s)F;(3)(s,s)F∧(s,s)F.对于(1)因S1∪{s}是一个虹吸,亦即·(S1∪{s})(S1∪{s})·.又·(S1∪{s})=·S1∪·s,(S1∪{s})·=S1F∧(s,s)F,故·S1∩s·=,则·S1S1个虹吸.妨假设·s≠.就不是N2的前驱虹吸子网.因此,任意两个虹吸子网之间的关系为下列情形之一:它们之间不存在前驱和后继关系,或者一个是另一个的后继(前驱).并且后继(前驱)为以下3种情形之一:对于(2)的证明与(1)类似,即可得{s}是虹吸.同样,对于(3)的证明与(1)类似,可得S1和{s}均是虹吸.定理4.设N=(P,T;F)是一个Petri网,sc(N)是N的极小虹吸集合,SP是N的一个极小虹吸.N=(P,T;F)∈sc(N),如果S∩P≠,则SP.证明.假设结论不成立,即S∩P≠且S-P≠.不妨设s∈S-P,即有S=(S-{s})∪{s}.由引理1知S-{s}或{s}是虹吸.不论是哪种情形,都与S是极小虹吸矛盾.定理4表明每一个极小虹吸都包含且仅包含在某个虹吸子网中.这样,我们就可以通过构造网N的虹吸子网,求虹吸子网的极小虹吸,而得到原网的所有极小虹吸.由定理4得到下列推论.推论1.设N是一个Petri网,sc(N)是虹吸子网集.N的所有极小虹吸的集合等于sc(N)中每个网的所有极小虹吸集的并.定义3.设N=(P,T;F)是一个Petri网,N=(P,T;F)是N的一个虹吸子网,如果t∈T-T满足p∈P,(t,p)∈F,称t是N的输入变迁.Page4定理5.设N=(P,T;F)是一个Petri网,N=(P,T;F)是N的一个虹吸子网.如果N不存在输入变迁,则P是N的一个虹吸.证明.结论是显然的.定理6.设N=(P,T;F)是一个Petri网,N=(P,T;F)是N的一个虹吸子网.如果t∈T-T是N的输入变迁,则N的任意一个极小虹吸S,有t·∩S=.证明.因p∈t·,有(p,t)F+,故s∈S,有(s,t)F+,则·S∩{t}=.故t·∩S=.定理6表明输入变迁的输出位置不包含在任何极小虹吸中,因此只有一个位置的虹吸子网如果存在输入变迁则它不可能是极小虹吸.对于一个存在输入变迁的虹吸子网,将输入变迁的输出位置删除后,可能不再是虹吸子网,则我们可以求删除这些位置后得到的子网的虹吸子网,每个虹吸子网的极小虹吸就是N的极小虹吸,而且不会遗漏极小虹吸子网.4算法描述及性能分析4.1算法描述根据前一节得到的结论以及文献[15]的结论,得到求Petri网所有极小虹吸的一个递归算法.该算法基于Petri网的虹吸子网,通过对原Petri网的分解迅速缩小网的规模.算法的总体思想描述如下:1.求所有的虹吸子网;2.对每个虹吸子网如果有输入变迁,则删除输入变迁的输出位置,然后该虹吸子网的虹吸子网,重复步2直到每个虹吸子网不存在输入变迁;3.求每个虹吸子网的一个极小虹吸;4.分解虹吸子网;5.重复步1~步4.本文提出的算法由4个子算法构成:求网的所有虹吸子网(算法1)、将一个虹吸子网分解成不含输入变迁的虹吸子网(算法2)和基于极小虹吸分解虹吸子网(算法3).最后由算法4给出所有的极小虹吸.算法1.Petri网N的虹吸子网(FindAllSi-phonSubnet(N))1.sc(N)=;2.不区分位置和变迁,将网N看成一个普通的图,求其所有极大强连通分支;3.对每一个极大强连通分支N=(P,T;F),如果P≠,则sc(N)=sc(N)∪{N};4.return(sc(N)).如果sc(N)是一个空集,则原网中不含有任何虹吸,当然也就不存在极小虹吸.由定理5知,如果一个虹吸子网存在输入变迁,则输入变迁的位置不属于任何极小虹吸,算法2的功能是处理含有输入变迁的虹吸子网,将它分解成不含有输入变迁的更小的虹吸子网,并且这个过程一直下去直到得到的虹吸子网不含有输入变迁为止.(UpdateSiphonSubnet(N,N))算法2.处理含有输入变迁的虹吸子网1.nit=;2.temp={N};3.Whiletemp≠do3.1.N=(P,T;F)∈temp,temp=temp-{N};3.2.若p∈P,·pT,则nit=nit∪{N},转步3;3.3.对每一个p∈P,·pT,则对所有t∈·p,P=3.4.SN=FindAllSiphonSubnet(red(N,P));3.5.temp=temp∪SN,转步3;4.return(nit).在算法2中,如果一个虹吸子网含有输入变迁,则将它分解成几个不含输入变迁的虹吸子网.对sc(N)中每个虹吸子网处理后,sc(N)中每个虹吸子网就是一个虹吸.本文采用文献[15]提出的方法求虹吸子网的一个极小虹吸,基于此极小虹吸,将虹吸子网进行分解.SiphonSubnet(N=(P,T;F),S))算法3.基于极小虹吸的网分解(Decompose-1.paranit=;2.temp=S;3.Whiletemp≠do3.1.c=;3.2.p∈temp,temp=temp-{p},3.3.c=FindAllSiphonSubnet(N);3.4.c=c∪c,转步3;4.Whilec≠do4.1.N∈c,c=c-{N},4.2.paranit=paranit∪nit,转步4;5.return(paranit).基于以上的几个算法,下面给出求Petri网中所有的极小虹吸的算法.如果没有极小虹吸,则返回一个空集;否则输出极小虹吸子集.算法4.Petri网的所有极小虹吸.1.Σ=;2.temp=FindAllSiphonSubnet(N);Page53.c=;4.Whiletemp≠do4.1.N∈temp,temp=temp-{N};4.2.nit=UpdateSiphonSubnet(N,N);4.3.c=c∪nit,转步4;5.Whilec≠do5.1.N=(P,T;F)∈c,c=c-{N};5.2.S=FindMinSiphon(N,P);5.3.Σ=Σ∪{S};5.4.paranit=DecomposeSiphonSubnet(N,S);5.5.c=c∪paranit,转步5.其中,步5.2调用的函数来自文献[15],经过我们的一系列处理后P就是一个虹吸,而该函数就是求一个虹吸包含的一个极小虹吸.集合Σ中的每一个集合就是N的一个极小虹吸,并且N的所有极小虹吸都在Σ中.4.2算法性能分析用m表示网中位置数,n表示变迁数,α(α(n+m)(n+m-1)/2)表示弧的条数.在算法1中,通过求网的极大强连通分支得到所有虹吸子网,因此时间为O(α).在算法2中,设一个子网(P1,T1,F1),其位置数为m1,变迁数为n1,则检测是否有输入变迁的时间为O(m1n21),假设有输入变迁,删除输入变迁的位置后,调用算法1分解成虹吸子网.对有输入变迁的虹吸子网继续分解,但是最多分解m1次,因此该算法的最坏情况下时间为O(m1(m1+n1)2).在算法3中,设一个极小虹吸含有k个位置,那么对一个虹吸子网至多进行k次分解,对于每一次分解得到的子网调用算法2处理后可能得到几个虹吸子网.由于两个虹吸子网分解成虹吸子网集中可能有相同的虹吸子网,因此算法的最坏时间为O(km1(m1+n1)2).因此,以上算法的时间复杂度均在O(nα)内.在算法4中,步2~4,得到原网的所有不含输入变迁的虹吸子网,步5是一个迭代过程,由于在网中最多有2n个虹吸,因此最坏的时间复杂性为O(nα2n).但是,在实际情况下,平均时间复杂性要低得多,因为算法1将网分解成多个虹吸子网,使得网中节点规模迅速减少.即使原网是一个强连通图,但经过一个极小虹吸的分解后,将将得到多个虹吸子网.因此,本文提出的算法是一个有效的算法.5实验下面,我们通过一个例子演示算法的执行过程(图1),在例子中的Petri网含有4个极小虹吸,即{p2,p3}、{p8,p11}、{p12,p13}和{p10,p11,p12,p14}.图2给出了算法1执行生成的5个虹吸子网,其中图2(a)和(c)没有输入变迁,(b)、(d)和(e)有输入变迁,执行算法2,从(b)中删除位置p9后,变迁t4成为位置p6和p7的输入变迁,继续删除位置p6和p7,然后变迁t2成为位置p4的输入变迁,继续删除位置p4后,不再含有位置,即(b)中不包含极小虹吸.而(d)和(e)都只含有一个位置而有输入变迁,则它们都不是极小虹吸.因此,原网的极小虹吸包含在虹吸子网(a)和(c)中.{p2,p3}是一个极小虹吸,即(a)中仅包含一个极小虹吸.而{p8,p11}是(c)的一个极小虹吸,执行算法3后得到的虹吸子网如图3Page6所示.算法4执行后得到的极小虹吸为{p2,p3}、{p8,p11}、{p12,p13}和{p10,p11,p12,p14}.为了验证算法的执行效率,随机产生了200个Petri网,这些Petri网由不同位置和变迁数以及不同的拓扑结构构成.为了简单起见,本文仅给出了4种规模的Petri网,即n=m=5,10,15,20.其中n是变迁的个数,m是位置的个数.本文给出的算法由C程序实现,在奔腾4处理器上的执行时间结果如表1所示.Petri网的规模平均极小虹吸个数计算时间/s101520从表1可以看出,我们给出算法执行时间均较短.因此,我们的算法是一个有效的算法.6结论本文给出了计算Petri网所有极小虹吸的方法.首先,给出了几个结论证明了每个极小虹吸包含在一个虹吸子网中,然后给出了计算极小虹吸的算法.该算法将原网分解成多个不相交的虹吸子网,通过计算每个虹吸子网的极小虹吸得到原网的极小虹吸.这样,将一个大的Petri网迅速分解成几个小的Petri网,从而提高了计算极小虹吸的效率.进一步的工作是研究每个虹吸子网的结构,提出分解虹吸子网更高效率的算法.另一个工作是将本算法改为并行算法,以适合计算大规模Petri网的极小虹吸.
