Page17轮AES-128的非对称不可能飞来器攻击董晓丽1)胡予濮1)陈杰1),3)韦永壮1),2)1)(西安电子科技大学计算机网络与信息安全教育部重点实验室西安710071)2)(桂林电子科技大学信息与通信学院广西桂林541004)3)(中国科学院软件研究所信息安全国家重点实验室北京100049)摘要分组密码是信息安全中实现数据加密、认证和密钥管理的核心密码算法,其安全性分析是密码学的重要课题之一.基于差分分析原理,文中提出了分组密码新的分析方法:非对称不可能飞来器攻击.该方法是通过构造非对称不可能飞来器区分器,排除满足这种关系的密钥,并最终恢复出秘密密钥的一种攻击方法.利用密钥编排方案,基于差分表查询技术和数据多次利用技术,把新方法应用于AES-128.研究结果表明:攻击7轮AES-128所需的数据复杂度为2105.18个选择明文,时间复杂度为2115.2次加密,存储复杂度为2106.78个AES分组.就攻击轮数、数据复杂度和时间复杂度而言,新分析优于已有针对AES-128的攻击.关键词密码分析;分组密码;AES;飞来器;时间复杂度1引言现代密码学是解决信息安全问题的有效手段.分组密码是现代密码学的一个重要研究方向,属于对称密码体制.它可以直接用来加密消息,对消息提供保密性;可以用来构造消息认证码(MAC)和Hash函数来保障数据的真实性和完整性.分组密码还具有简洁、快速、易于标准化等特点,因此在信息安全领域有着最广泛的应用.自2000年,NIST宣布Rijndael[1]是高级加密标准(AES)征集比赛中的获胜者,它已经成为全球最受关注和广泛使用的分组密码算法之一.同时,涌现出了一些新的针对AES的攻击,包括平方攻击[2-3]、碰撞攻击[4]、不可能差分攻击[5-9]、飞来器攻击[10]、中间相遇攻击[11]、相关密钥攻击[12-13]等.单密钥模型下,AES-128的攻击结果如下:1997年,AES的设计者Daemen等人[2]首次提出了6轮AES-128的平方攻击,需要232个选择明文和272次加密.2000年,Ferguson等人[3]把攻击6轮AES-128的时间复杂度降为244.同时,7轮AES-128的平方攻击需要2127.977个选择明文和2120次加密.同年,Gilbert等人[4]提出7轮AES-128的碰撞攻击,需要232个选择明文和2128次加密.2000年,Biham等人[5]首次将不可能差分攻击应用于AES,攻击5轮AES-128需要229.5个选择明文和231次加密.2002年,Cheon等人[6]提出6轮AES-128的不可能差分攻击,需要291.5个选择明文和2122次加密.2004年,Biryukov等人[10]提出5轮AES-128和6轮AES-128的飞来器攻击.5轮AES-128攻击中需要239个选择明文和239次加密,6轮AES-128攻击中需要271个选择明文和271次加密.2007年,Zhang等人[7]和Lu[8]分别提出改进的7轮AES-128的不可能差分攻击,其中文献[8]中复杂度较低,需要2112.2个选择明文和2115.6次加密.文献[9]中,Lu同时提出6轮AES-128的不可能飞来器攻击,需要2112.2个选择明文和2112.3次加密.2008年,Lu等人[9]提出7轮AES-128的不可能差分攻击,需要2112.2个选择明文和2117.2次存储访问.2010年,Dunkel-man等人[11]提出7轮AES-128的中间相遇攻击,依据时空折中需要约2116个选择明文和约2116次加密.本文的主要贡献:基于差分分析原理,提出了分组密码新的分析方法———非对称不可能飞来器攻击.首先描述了非对称不可能飞来器攻击,并给出了详细的理论支持.该攻击是通过构造非对称不可能飞来器区分器,排除满足这种关系的密钥,并最终恢复出秘密密钥的一种攻击方法.然后,构造了4轮AES非对称不可能飞来器区分器,利用密钥编排方案,差分表查询技术和数据多次利用技术,针对7轮AES-128进行新分析.所需的数据复杂度为2105.18个选择明文,时间复杂度为2115.2次加密,存储复杂度为2106.78个AES分组.就攻击轮数、数据复杂度和时间复杂度而言,新分析优于已有针对AES-128的攻击.本文第2节为基础知识,介绍AES算法和不可能飞来器区分器;第3节详细描述新的密码分析方法:非对称不可能飞来器攻击;第4节把非对称不可能飞来器攻击应用于7轮AES-128;第5节给出本文的分析结果及与已有结果的比较,并提出下一步工作的方向.2基础知识2.1AES介绍AES[1]分组长度是128bit,密钥长度有128bit、192bit和256bit3种,分别用AES-128、AES-192和AES-256表示,且分别迭代10轮、12轮和14轮.AES-128分组表示为字节Ai为元素的4×4矩阵((A0,A1,A2,A3)T,(A4,A5,A6,A7)T,(A8,A9,A10,A11)T,(A12,A13,A14,A15)T).AES的每一轮由以下4种变换组成:字节代替(SB):每个字节进行S盒变换;行移位(SR):每行循环左移位(第i行循环左移i个字节,i=0,1,2,3);列混淆(MC):在GF(28)上每列左乘矩阵;密钥加(ARK):中间状态异或128bit子密钥.AES第0轮之前有密钥加法运算(这个密钥又称为白化密钥);最后一轮没有列混淆变换.AES密钥编排算法把秘密密钥扩充成128(R+1)bit子密钥,其中R表示轮数.AES-128密钥方案由128bit密钥K=(W0,W1,W2,W3)生成W4,W5,…,W43,其中Wi为32bit字.密钥生成如下:1.用户密钥K=(W0,W1,W2,W3).2.Fori=4toi=433.K-1=(W0,W1,W2,W3),Kr=(W4(r+1),W4(r+1)+1,W4(r+1)+2,W4(r+1)+3),0r9.其中Kr表示r轮子密钥,K-1表示白化密钥.Page3RotByte(·)表示一字节的循环;Rcon(·)表示轮常量.本文使用的记号:P表示明文,C表示密文.XIr表示第r轮的输入,XSBr、XSRr、XMCr、XOr分别表示第r轮SB、SR、MC、ARK的中间值,显然XOr-1=XIr.同一轮MC和ARK交换,子密钥要用等价子密钥珦Ki,且满足珦Ki=MC-1(Ki).Xr,i表示Xr的第i字节(i=0,1,2,…,15).Xr,Col(l)(l=0,1,2,3)表示Xr的第l列.Xr,SR(Col(l))(l=0,1,2,3)表示Xr中相应于第l列SR变换后位置的4个字节;同理Xr,SR-1(Col(l))(l=0,1,2,3)表示Xr中相应于第l列SR-1变换后位置的4个字节.Pr(·)表示相应事件的概率.Y~Poi(λ)表示随机变量Y服从参数为λ的泊松分布.2.2不可能飞来器区分器分组密码E:{0,1}k×{0,1}n→{0,1}n表示为两个算法级联的形式E1E0,即算法E在密钥K下加密明文P也可以表示为EK(P)=E1KE0K(P).选择N元组(X0,X1,…,XN-1),其中X2i+1=X2iαi(0iN/2-1),E(X(2j+2)modN)=E(X2j+1)γj(0jN/2-1).不可能飞来器区分器包括:(1)算法E0中Pr(αi→βi)=1(0iN/2-1);(2)算法(E1)-1中Pr(δj→γj)=1(0jN/2-1);(3)(N/2-1(0iN/2-1,0jN/2-1)是n-bit块.由于不可能飞来器区分器的结构对称,且N为偶数(N2).因此本文称之为对称不可能飞来器区分器,相应的攻击为对称不可能飞来器攻击.N=4情况如图1所示.3非对称不可能飞来器攻击基于差分分析技术和不可能飞来器攻击,本节提出新的密码分析方法———非对称不可能飞来器攻击.3.1非对称不可能飞来器区分器定义1(非对称不可能飞来器区分器).分组密码算法E=E1E0,非对称不可能飞来器区分器包括:(1)算法E0中,Pr(αi→βi)=1(0iN-2);(2)算法(E1)-1中,Pr(δ→γ)=1;(3)β0β1…βN-2γ≠0,其中α0,β0,α1,β1,…,αN-2,βN-2,δ,γ是n-bit块.可以看出,非对称不可能飞来器区分器结构非对称,且满足N2.N=4情况如图2所示.下面的定理对非对称不可能飞来器区分器提供了理论基础.定理1.分组密码算法E=E1E0,密钥为K,Xi(0iN-2)是n-bit块,XiXi+1=αi(0iN-2),E0K(X0)E0K(XN-1)=γ.假定算法E0满足P(αi→βi)=1(0iN-2),算法(E1)-1满足Pr(δ→γ)=1,且β0β1…βN-2γ≠0.下列等式不能成立:证明.假定X1,Xn,K使等式(1)成立.算法E0满足Pr(αi→βi)=1(0iN-2),其中XiXi+1=αi,E0K(Xi)E0K(Xi+1)=βi(0iN-2),下列等式成立的概率为1:E0K(X0)E0K(XN-1)=(E0K(X0)E0K(X1))…(E0K(Xi)E0K(Xi+1))…(E0K(XN-2)E0K(XN-1))=((E1K)-1(EK(X0))(E1K)-1(EK(X1)))…((E1K)-1(EK(Xi))(E1K)-1(EK(Xi+1)))…((E1K)-1(EK(XN-2))(E1K)-1(EK(XN-1)))=β0β1…βi…βN-2.由于算法(E1K)-1满足Pr(δ→γ)=1,即当Page4EK(X0)EK(XN-1)=δ,下列等式成立的概率为1:E0K(X0)E0K(XN-1)=(E1K)-1(EK(X0))(E1K)-1(EK(XN-1))=γ.因此,与条件β0β1…βN-2γ≠0相矛盾,定理成立.3.2密钥恢复分组密码算法E表示为4个算法级联形式E=EaftE1E0Ebef,其中E1E0表示非对称不可能飞来器区分器β0β1…βN-2γ≠0,Ebef表示E0之前加密轮,Eaft表示E1之后加密轮.假定Kbef、Kaft分别是算法Ebef、Eaft的子密钥猜测,则攻击者检验N元明/密文组((P0,C0),(P1,C1),…,(PN-1,CN-1))是否满足非对称不可能飞来器区分器的N个条件:Ebefαi,(EaftKbef(Pi)EbefRound0:→ARK4.24轮AES非对称不可能飞来器区分器来器区分器.图3形象描述了此区分器的差分.烌bi0000000→MC0000烎0000Round1:→SBai,bi,ci,di,ei,fi(0iN-2)表示任意非0字节.(a)算法E0中αi→βi(0iN-2)烌烄MC←-1烆烎???0???烌烄←ARK烆烎??(b)算法E1中δ→γ图34轮非对称不可能飞来器区分器的差分定理2.4轮AES非对称不可能飞来器区分器E1E0如下:((a0,0,0,0),(0,0,0,0),(0,0,0,0),(0,0,0,0);…(ai,0,0,0),(0,0,0,0),(0,0,0,0),(0,0,0,0);……;(aN-2,0,0,0),(0,0,0,0),(0,0,0,0),(0,0,0,0))→|(XO3,SR(Col(l)))0(XO3,SR(Col(l)))N-2=0,l∈{0,1,2,3},其中ai(0iN-2)表示任意非0字节,?表示任意值.证明.E0中αi→βi(0iN-2)为((ai,0,0,0),(0,0,0,0),(0,0,0,0),(0,0,0,0))→((02·ci,01·ci,01·ci,03·ci)T,(01·fi,01·fi,03·fi,02·fi)T,(01·ei,03·ei,02·ei,02·ei)T,(03·di,假如存在N元明/密文组满足上面的等式,则子密钥猜测(Kbef,Kaft)是不正确的.因此有足够多的明/密文组,通过丢弃所有错误的子密钥猜测,攻击者能够寻找到算法Ebef,Eaft中正确的子密钥.47轮AES-128的非对称不可能飞来器攻击4.1AES-128部分密钥编排结果下面定理构造了4轮AES的非对称不可能飞02·bi000烄01·bi00001·bi000烆03·bi02·di,01·di,01·di)T),如图3(a)所示.则N-2N-2i=0(βi)为((N-2i=1ai,0,0,0),(0,0,0,0),(0,0,0,0),(0,0,0,0))→((02·N-2(01·N-2(01·N-2(03·N-2可以看出,N-2i=1fi,01·N-2i=1ei,03·N-2i=1di,02·N-2Page5均不为0.所以n-1不为0;(2)其中1列为0,其余字节全不为0;(3)其中2列为0,其余字节不为0;(4)其中3列为0,其余字节不为0;(5)16个字节都为0.E1中δ→γ为((XO3)0(XO3)N-2)→((XSB2)0(XSB2)N-2),满足((XO3,SR(Col(l)))0(XO3,SR(Col(l)))N-2=0)→((XSB2,SR-1(Col(l)))0(XSB2,SR-1(Col(l)))N-2=0),l∈4.37轮AES-128的非对称不可能飞来器攻击对称不可能飞来器攻击.烄qi000ui000vi000烆烎000wi(a)算法Ebef→SRRound4:烌z000000z←ARK0000烎0000烌z00z00zz←ARK0zz0烎00(b)算法Eaft图47轮AES-128的非对称不可能飞来器攻击4.3.1攻击过程交换.由于攻击需要,第4轮和第5轮的MC和ARK预计算阶段.1.XMC0,Col(0)的差分为下列4种情形之一:(a,0,0,0),(0,a,0,0),(0,0,a,0)或(0,0,0,a),其中a表示任意非0字节(下同).共有232×4×(28-1)≈242数据对.对每一个数据对计算XI0,SR-1(Col(0)),将这些4字节的数据对以它们在这4个字节的差分为索引,存储于一张Hash表Hash-1,一个索引值平均对应210数据对.2.XO5,Col(0)的差分如为(a,0,0,0),有232×(28-1)≈240数据对.对每一个数据对计算XSR6,SR(Col(0)),将这些4字节的数据对以它们在这4个字节差分为索引,存储于一张Hash表Hash0,一个索引值平均对应28数据对.下面计算存储按照同样的方法.XO5,Col(0)的差分如为(0,a,0,0),有约240数据对,计算XSR6,SR(Col(0)).Hash表Hash1存储数据对.XO5,Col(0)的差分如为(0,0,a,0),有约240数据对,计算XSR6,SR(Col(0)).Hash表Hash2存储数据对.XO5,Col(0)的差分如为(0,0,0,a),有约240数据对,计算XSR3.XO5,Col(3)的差分如为(a,0,0,0),有约240数据对,计算XSR6,SR(Col(3)).Hash表Hash12存储数据对.XO5,Col(3)的差分如为{0,1,2,3},如图3(b)所示.γ中每一列至少有一个字节为0.又因为选择明文攻击中选择的N元组中不会有相同的明文,所以γ≠0.因此N-2取N=3,图4形象给出了7轮AES-128的非烄烆烄烆烄烆(0,a,0,0),有约240数据对,计算XSRHash13存储数据对.XO5,Col(3)的差分如为(0,0,a,0),有约240数据对,计算XSRXO5,Col(3)的差分如为(0,0,0,a),有约240数据对,计算XSR6,SR(Col(3)).Hash表Hash15存储数据对.在线阶段.1.定义一种结构Struci.232个明文Pi,j在字节SR-1(Col(0))取所有可能的值,其余字节固定.Struci产生C2232≈263个明文对(Pi,j0,Pi,j2),每个明文对(Pi,j0,Pi,j2)形成P1232-2≈232个三元组(Pi,j0,Pi,j1,Pi,j2),满足任意两两三元组的无序差分组(Pi,j0Pi,j1,Pi,j1Pi,j2)均不重复.选择273.18个结构Struci(i=0,1,…,273.18-1),生成273.18×263×232=2168.18个三元组(Pi,j0,Pi,j1,Pi,j2).在选择明文攻击中,对于273.18×232=2105.18个明文,获得相应密文Ci,j.选择三元组(Pi,j0,Pi,j1,Pi,j2)满足(XO6,SR(Col(1,2)))i,j0(XO6,SR(Col(1,2)))i,j2=0,其中0j0≠j2232-1.剩余2168.18×2-64=2104.18个三元组.2.初始化232个空列表,每个对应K-1,SR-1(Col(0))的猜测值.考虑剩余明文三元组(Pi,j0,Pi,j1,Pi,j2),计算Pi,j0Pi,j1和Pi,j1Pi,j2在字节SR-1(Col(0))值,用ΔP0、ΔP1表示.分别访问Hash-1中分别以ΔP0、ΔP1索引的库.对于Page6ΔP0索引库中的每一个数据对(x0,y0),ΔP1索引库中的每一个数据对(x1,y1),如果存在Pi,j0x0=Pi,j1x1,则把明文三元组(Pi,j0,Pi,j1,Pi,j2)添加到相应密钥列表Pi,j0x0值中.Pr(Pi,j0x0=Pi,j1x1)=210×2-32=2-22,因此2104.18×210×2-22=292.18值分布在232个密钥上,即每个子密钥K-1,SR-1(Col(0))剩余260.18个三元组.3.对每个猜测值K-1,SR-1(Col(0)),剩余的260.18个三元组中选取257.18个三元组(Pi,j0,Pi,j1,Pi,j2),满足(Pi,j0,Pi,j2)不重复.由于对于每个K-1,SR-1(Col(0)),步2中任意一个对(Pi,j0,Pi,j2)相应的232个三元组(Pi,j0,Pi,j1,Pi,j2)中,剩余概率为232×(210×2-32)2=2-12.由泊松分布Y~Poi(λ=2-12),Pr(Y9)≈2-126.5,剩余9个三元组(Pi,j0,Pi,j1,Pi,j2)对应相同(Pi,j0,Pi,j2)的概率为2-126.5.因为共有2105个三元组(Pi,j0,Pi,j1,Pi,j2),所以剩余三元组中存在一个对(Pi,j0,Pi,j2)对应9个三元组(Pi,j0,Pi,j1,Pi,j2)的概率非常低.因此假定剩余三元组中每个对(Pi,j0,Pi,j2)对应8个三元组(Pi,j0,Pi,j1,Pi,j2),则剩余260.18个三元组中至少有260.18×2-3=257.18个三元组(Pi,j0,Pi,j1,Pi,j2)满足(Pi,j0,Pi,j2)不重复.步4~6为m=0,1,2,3的循环执行.4.初始化232空列表,每一个相应于K6,SR(Col(0)的猜测值.考虑剩余三元组(Ci,j0,Ci,j1,Ci,j2),且计算(Ci,j0Ci,j2)在字节SR(Col(0))值,用ΔP2表示.访问Hashm中ΔP2为索引的库,对于该库中的每一个数据对(x2,y2),计算Ci,j0x2,则把三元组(Ci,j0,Ci,j1,Ci,j2)添加到相应密钥列表Ci,j0x值中.257.18×28值分布在232个密钥上,因此每个K-1,SR-1(Col(0))子密钥,剩余257.18×28×2-32=233.18个三元组.5.初始化232空列表,每一个相应于K6,SR(Col(3))的猜测值.考虑剩余明文三元组(Ci,j0,Ci,j1,Ci,j2),且计算(Ci,j0Ci,j2)在字节SR(Col(3))值,用ΔP3表示.访问Hash12+(m+1)mod4中ΔP3为索引的库,对于该库中的每一个数据对(x3,y3),计算Ci,j0x3,则把三元组(Ci,j0,Ci,j1,Ci,j2)添加到相应密钥列表Ci,j0x3值中.233.18×28值分布在232个密钥上,因此每个K6,SR(Col(3))子密钥,剩余233.18×28×2-32=29.18个三元组.6.猜2个字节的子密钥(珦K5,m,珦K5,12+(m+1)mod4).部分解密剩余三元组(Ci,j0,Ci,j1,Ci,j2)中的(Ci,j0,Ci,j2),检验是否(XO4,Col(m))i,j0(XO4,Col(m))i,j2只有1个字节为0.假如存在三元组满足这个条件,则丢弃密钥值(K6,SR(Col(0)),K6,SR(Col(3)),珦K5,m,珦K5,12+(m+1)mod4,K-1,SR-1(Col(0))).7.对每个可能的子密钥值(K6,SR(Col(0)),K6,SR(Col(3)),珦K5,Col(0),珦K5,Col(3),K-1,SR-1(Col(0))),结合AES-128密钥方案,穷举确定剩余24bit密钥.4.3.2复杂度分析预计算阶段.时间复杂度为3×2×242×1/7×1/4≈239.2次7轮AES-128加密,存储复杂度为3×2×242×1/4≈242.6个AES在线阶段.需要2105.18个选择明文.1.存储复杂度为3×2×2104.18=2106.78个AES分组.2.时间复杂度为2×2104.18×210=2115.18次存储访问,约相当于[12]2108.18次7轮AES-128加密.3.存储复杂度为3×2×260.18×232=294.78个AES分组.分组.4.时间复杂度为4×232×257.18×28=299.18次存储访问.存储复杂度为3×2×257.18×28=267.78个AES分组.5.时间复杂度为4×264×233.18×28=2107.18次存储访问.存储复杂度为3×2×233.18×28=243.78个AES分组.6.时间复杂度为4×{2×2112×[1+(1-2-6)+…+(1-2-6)29.18]×2/16×1/7}≈2115.2次7轮AES-128加密.对于每个m,满足条件的三元组概率为4×2-8=2-6.对于每个猜测的96bit密钥值(K6,SR(Col(0)),K6,SR(Col(3)),K-1,SR-1(Col(0))),预计剩余约216×(1-2-6)29.18≈22.82个子密钥(珦K5,m、珦K5,12+(m+1)mod4).考虑4个迭代m=0,1,2,3,对于每个猜测的(K6,SR(Col(0)),K6、SR(Col(3))、K-1,SR-1(Col(0))),剩余约22.82×4=211.28个子密钥(珦K5,Col(0)、珦K5,Col(3)).由AES-128密钥方案,得到296×211.28×2-24=283.28个可能的子密钥.7.时间复杂度为283.28×224=2107.28次7轮AES-128因此,攻击所需要的数据复杂度为2105.18个选择明文,时间复杂度为2115.2次7轮AES-128加密,由步6决定;存储复杂度为2106.78个AES分组,由步1决定.5结论加密.分组密码是信息安全的核心密码算法.基于差分分析原理,本文提出了非对称不可能飞来器攻击这一新的分组密码分析方法.该方法是通过构造非对称不可能飞来器区分器,排除满足这种关系的密钥,并最终恢复出秘密密钥的一种攻击方法.然后,构造了4轮AES非对称不可能飞来器区分器,利用密钥编排方案、差分表查询技术和数据多次利用技术,针对AES-128进行了新分析.攻击7轮AES-128所需的数据复杂度为2105.18个选择明文,时间复杂度为2115.2次加密,存储复杂度为2106.78个AES分组.与已有的结果比较见表1,可以看出:新分析的攻击轮数达到7轮.在7轮攻击中,时间复杂度低于已有攻击;数据复杂度也低于除文献[4]以外的攻击,而文献[4]为巨型攻击,因为它需要的时间复杂度为2128次加密,等于密钥穷举搜索.因此针对AES-128的攻击,本文提出的密码分析方法更为新型有效.Page7攻击类型轮数数据平方攻击平方攻击平方攻击碰撞攻击不可能差分攻击6291.52122—[6]不可能差分攻击72115.521192105[7]不可能差分攻击72112.22115.62105[8]不可能差分攻击72112.22117.2MA289.2[9]中间相遇攻击7211621162116[11]飞来器攻击6271271233[10]不可能飞来器攻击62112.22112.3249[8]非对称不可能飞来器攻击注:CP为选择明文;MA为存储访问.时间复杂度单位:加密次数;存储复杂度单位:AES分组.本文提出的非对称不可能飞来器攻击可以应用于其它分组密码算法分析中,研究中可以进一步关注.
