Page1基于切向约束构造复合二次B样条插值曲线于谦1)李缨1)张彩明2)1)(山东女子学院信息技术学院济南255000)2)(山东大学计算机科学与技术学院济南250100)摘要该文提出一种构造二次B样条插值曲线的新方法,包括新的参数化方法和新的插值方法.新参数化方法中,相邻曲线段的连接处与插值点相一致,以插值点的切向作为约束,利用二次B样条曲线本身的几何性质进行参数化,使曲线在每个插值点上都满足指定的切向,可以直观地控制插值曲线的形状以达到预期效果,参数化方法稳定,不必解方程组.在新参数化方法的基础上进一步提出了分段构造的思想,将形状不好的段分成多段构造,除插值点的切向外还留有其他的自由度进一步直观调控曲线的形状,使得二次B样条插值曲线的形状更自然.新方法对于数据点的改变具有良好的局部性.实例表明该方法是有效的.关键词插值;参数化;B样条曲线;插值点;曲线1引言B样条是计算机辅助几何设计中曲线插值的常Page2造过程.其中,参数化的目的是为每一个插值点指定一个具体的参数值,不同的参数化方法得到的参数值不同.当节点向量的选取与参数化相一致时,构成整条插值曲线的各曲线段在整节点处连接,插值点正位于连接处.若两者不一致,即各曲线段的连接处未取在整节点上,则插值点各自位于一段曲线内,不会正好处在两相邻段之间.节点向量的选取与参数化相一致在构造奇次B样条插值曲线时有非常好的效果,但并不适用于偶次[1-2].因此大量关于偶次B样条插值曲线的研究集中在不一致的情况[3-8],分别采用均匀、向心、二次精度[9]、Foley等参数化方法将相邻曲线段的连接处取在非整节点上,获得了较好的曲线形状.这些方法都是从整体上一次性确定所有的节点值,插值完成后曲线形状不可调,变动局部插值点时曲线整体形状变化较大,在工程应用中受到了限制.针对这些不足,潘日晶[10]在允许节点向量的选取与参数化不一致的情况下,在二次B样条插值过程中递推确定节点值,并充分利用节点向量的自由度调整曲线的形状,同时使曲线的局部性较好.但该方法对切矢方向限制过于严格,而且节点向量作为自由度没有固定的通用取值,在一定程度上给用户带来了操作上的不便.上述方法都是在节点向量与参数化不一致的情况下构造偶次B样条插值曲线,但这并不代表相一致时就不能有好的结果,只要节点选取恰当、选用合适的插值方法偶次B样条一样能具有数据点所建议的形状.Piegl等人[11]就做到了这一点,在参数化的过程中利用二次B样条曲线的几何性质引入了切向约束,给出了节点向量的确定取值,在需要拐点时就将含有拐点的曲线段分成两部分构造,得到的曲线在数据点较均匀弯度较小时形状自然.不足之处是所得到的节点值易重复,会造成曲线的断开,调整形状的自由度与拐点同时存在,而改变自由度的同时拐点也会发生不可预期的变化,形状不易掌控.潘日晶[12]也在节点向量与参数化相一致的情况下通过指定曲线段相对于所在弦的高度来确定节点值,能获得令人满意的结果,但相对高度的获取在工程上并不容易,因此限定了该方法的应用范围.针对上述问题,本文在节点向量的取值与参数化相一致的情况下提出构造二次B样条插值曲线的新方法.鉴于节点向量与曲线的几何形状之间的密切联系,本文将曲线自身的几何性质考虑到参数化中,利用切矢作为约束递推出节点向量,所产生的节点值不会有重复,节点间的间隔不会很大,而且节点间隔的大小与插值点间的弯度变化相一致,若用粒子的运动模拟参数化,则当路线弯度越小时粒子经过的时间就越短.当满足切矢约束所得到的曲线段相对高度过高或切矢建议需要拐点时就将曲线段分成多段插值,称为复合二次B样条曲线,所得的曲线既满足于切矢约束又不受切矢方向限制,在构造过程中留有用来调整形状的自由度,拐点位置不随自由度变化,调整后的曲线形状可预期,而且给定自由度的通用取值,便于工程上使用.实验结果表明了新的参数化方法和插值方法的有效性.2问题描述利用二次B样条插值曲线对插值点序列P1,P2,…,Pn进行插值.本文考虑的是插值点位于各相邻曲线段连接处的情况,n个插值点共有n-1段曲线,令犜=t0,t1,…,tn{D0,D1,…,Dn,插值曲线表示为并有C(ti+1)=Pi,i=1,…,n(2)成立.其中Bi,3(t)是规范二次B样条基函数,t0t1…tn+3.基于二次B样条曲线与控制多边形相切故将曲线在Pi处的单位切矢犞i考虑在内,以便利用犞i调整曲线形状,因此令C(ti+1)/|C(ti+1)|=犞i,i=1,…,n(3)若工程上不能直接获取犞i,则由Akima[13]方法进行估计.本文的目标是在满足式(2)和式(3)的前提下求出犜和控制点序列.为讨论方便,令所求曲线为端点插值,即D0=P1,Dn=Pn,t0=t1=t2,tn+1=tn+2=tn+3.3基于切向约束构造复合二次B样条插值曲线3.1二次B样条曲线相关概念与公式对应节点段[ti,ti+1],i=2,…,n.令S(Pi-1Pi)表示弦Pi-1Pi所对应的曲线段,定义1.肩点.若S(Pi-1Pi)不是线段,则称其上离弦Pi-1Pi最远的点为肩点.根据二次B样条曲线段与控制多边形相切的性质可知S(Pi-1Pi)与Pi-1Pi形成位于△Pi-1Di-1Pi内的三角凸包(图1),由Li等人[14]的研究知Page3S(Pi-1Pi)上的肩点唯一且其切线平行于Pi-1Pi,设肩点对应的参数值为t-,可知以下引理.引理1.设P是[ti,ti+1]段肩点,则C(t-)=Cti+ti+1()2.证明.C(t)表示导数曲线,×表示叉乘,由潘日晶[12]的研究知Pi-1=C(ti)=ti+1-titi+1-ti-1Di-2+ti-ti-1ti+1-ti-1Di-1C(t)=2由肩点性质可得即c(t-)×[c(ti+1)-c(ti)]=0,式(4)~(6)共推出(2t--ti-ti+1)(Di-Di-1)×(Di-1-Di-2)=0,由S(Pi-1Pi)与Pi-1Pi形成三角凸包知Di-2Di-1Di不共线,所以t-=(ti+ti+1)/2.引理2.若Q是弦Pi-1Pi的中点,则肩点P是线段Di-1Q的中点(图1).证明.由式(1)和B样条曲线及基函数的性质可得C(t)=Di-2Ni-2,2(t)+Di-1Ni-1,2(t)+DiNi,2(t)其中t∈[ti,ti+1].由引理1及式(4)、(7)可得P=C(t-)=0.5[(Pi-1+Pi)/2+Di-1](8)故命题成立.引理3.若Di-2、Pi-1、Di-1、Pi四点共线,则[ti,ti+1]段曲线必为线段.证明.由B样条曲线的凸包性可知[ti,ti+1]上的曲线段必位于△Pi-1Di-1Pi内,而Di-2、Pi-1、Di-1、Pi共线,所以该段曲线必为线段.证毕.ti+1=ti+(Di-1Pi-→1+Di-1P→i)×Pi-1P→i证明.由式(7)和引理2可得0.25(Pi-1+Pi)+0.5Di-1=由基函数的性质上式可表示为Di-2Ni-2,2(t-)+Di-1Ni-1,2(t-)+DiNi,2(t-).引理4.当[ti,ti+1]段曲线不是线段时,Di-2-Di-1ti+1-ti-1+Di-Di-1ti+2-ti=Pi-1-Di-1+Pi-Di-1ti+1-ti.两边同时叉乘(Pi-Pi-1):(Di-2-Di-1)×(Pi-Pi-1)(Di-Di-1)×(Pi-Pi-1)(Pi-1-Di-1+Pi-Di-1)×(Pi-Pi-1)又由式(7)和式(4)得由式(9)和式(10)可推出由引理3知若该段曲线不是线段,则Di-2、Pi-1、Di-1、Pi四点必不共线,故式(11)整理为ti+1=ti+(Di-1Pi-→1+Di-1P→i)×Pi-1P→i3.2基于切向约束的参数化方法本小节中先对插值点的单位切矢做出约束以便选取控制点,然后在3.3节中去掉这些约束.约束的内容及控制点的选法与潘日晶[12]的方法相同.如图2,令α表示犞i-1与Pi-1P→i的夹角,θ表示犞i与Pi-1P→i的夹角,0α,θ<π(本文中所有角度均属于[0,π)).规定:α=0θ=0,or烅烄(犞i-1×Pi-1P→i)(犞i×Pi-1P→i)<0andθ<π-烆式(12)表明如果犞i-1平行于Pi-1P→i,则犞i也必与之平行,否则两切矢分别指向Pi-1P→i的两侧且相交于犞i-1所指向的一侧.基于式(12)将控制点D0,D1,…,Page4Dn取为烅烄Di=烆直线li以犞i为方向过Pi点.此处控制点满足式(3)条件,保证了Pi位于Di-1Di上,而且只要Di-2Pi-1Pi共线必有Pi-1Di-1Pi共线,即Di-2Pi-1Di-1Pi共线(图3).图3箭头是各点单位切矢,圆点是控制点,十字是插值点确定控制点后定义节点向量犜:t0=t1=t2=0,t3=P1P→2,烄ti+1=ti+ki(ti-ti-1),(a)烅ti+1=ti+λi1-λi烆tn+1=tn+2=tn+3当Di-2Pi-1Di-1Pi不共线时ti+1按式(14(a))取值,ki=(Di-1Pi→-1+Di-1P→i)×Pi-1P→i(Pi-1Di→-2+PiDi→-2)×Pi-1P→i(14(a))满足式(4)即条件式(2)的约束;当此四点共线时按式(14(b))取值,λi=0.5|Pi-1P→i|/|Di-2Di→-1|,下面证明式(14(b))也满足式(2)约束.证明.由引理3及式(12)、(13)知此时S(Pi-1Pi)为线段(图3),犞i-1和犞i与弦平行且Di-1=(Pi-1+Pi)/2,因此式(14(b))变为其中,ai=|Pi-1Di→-1|/|Di-2Di→-1|.而由式(4)可得ti+1-titi+1-ti-1Pi-1-Di-1,由Di-2、Pi-1、Di-1、Pi共线,等式两边同时点乘(Di-2-Di-1)可得ti+1-titi+1-ti-1|Di-2-Di-1|=|Pi-1-Di-1|,整理可得式(15),所以式(14(b))满足式(2)约束.将犜归到[0,1]后取值为{0,0,0,t3tn+1下面是该节点向量所具有的性质和相关概念.性质1.无重节点且相邻节点值相差不会非常大.定义2.弯度犞i-1和犞i分别是Pi-1和Pi的切矢,称两切矢间的夹角α为Pi-1和Pi间的弯度.性质2.α是犞i-1和犞i间夹角,当Di-2、Pi-1、Di-1、Pi不共线时α越小ki越小,即弯度越小时间越短.由式(12)和式(13)可知控制点与插值点间的位置关系如图3,当犞i-1与Pi-1Pi不平行时必有△Pi-1Di-1Pi而且Di-2、Pi-1、Di-1共线,Di-1、Pi、Di共线,这是证明上述两性质的基础.性质1证明.当Di-2、Pi-1、Di-1、Pi不共线,ti+1取式(14)中的式(a).观察图4(a),令犜1=Di-1Pi→-1+Di-1P→i,犜2=Pi-1Di→-2+PiDi→-2,犜1和犜2指向Pi-1P→i同侧,故ki>0,节点值递增.继续证明ki取值不会非常大.θ1是犜1与Pi-1P→i夹角,π-θ2是犜2与Pi-1P→i夹角,则ki=|犜1|sinθ1Pi-1Pi分别在△Pi-1Di-1Pi和△Di-2Pi-1Pi上的高.保持犞i-2和犞i不变,需将犞i-1逆时针旋转才能令h2变小,其极限位置是直线L1处(与犞i平行),否则便违背约束,设L2是过Pi-2与犞i-2同向的直线,令d表示L1L2交点到Pi-1Pi的距离,则h2>d>0,如果d非常小,则h1也不会很大,故ki的分子与分母之差不会过大;观察图4(b),将犞i-1顺时针旋转会使h2变小,|Di-1P→i|随之变小,故h1也会相应变小,所以ki的取值仍然不会非常大,性质成立.四点共线的情况证明略.Page5性质2证明.观察图4(b),在曲线S(Pi-1Pi)段上,插值点保持不变,通过调整犞i来改变弯度.若逆时针旋转犞i则α会减小,∠Pi-1Di-1Pi增大,即Pi-1和Pi之间的弯度减小,同时|Di-1Pi→-1|也随之减小,而∠Di-1Pi-1Pi不变,故h1变小,即ki变小,表明粒子在弯度越小的两点之间经过时速度越快.3.3构造复合二次B样条曲线3.2节参数化时对切矢的方向做了约束,而现实中得到的切矢不可能都符合这种约束,若想该参数化方法得到广泛应用则必须在曲线插值时摆脱角度束缚,使得对任意角度的切矢都能使用新方法构造插值曲线,此处我们采用动态插入新插值点、分多段构造的方式解决这个问题,把不符合约束的段分成2~4段构造,以及使切矢符合约束但曲线形状不好的段得到优化,做到在不增加拐点的前提下,使得到的曲线段数尽可能少、相对高度尽可能小.令α表示犞i-1和Pi-1P→i间夹角,θ表示犞i和图5Method0~Method4构造方法Method1.当π/3α∩θ<π-α时,切矢符合约束但形状不好,如图5(b),与DQ相交的曲线段相对高度过高,通过插入一个新插值点利用2-分段构造来降低其高度.取△Pi-1DPi的中线DP上的点Q,令|QP|=γi-1|Pi-1P→i|,γi-1是一种自由度,用来调整新曲线相对于弦Pi-1Pi的高度,γi-1越小所得曲线段越偏平,我们将之称为形状因子,根据实验γi-1=0.25是其通用值.令犞Q//Pi-1P→i,直接构造Pi-1Q和QPi段.图5(c)与图5(b)情况相同,其角是新插值点的单位切矢,分成以下4种情况6种方法(Method0~Method5)构造多段曲线:第1种情况.相邻切矢符合约束条件.Method0.如图5(a),当相邻切矢符合约束条件而且曲线段不需要优化时,该段称为理想段.曲线段是否理想由α和θ决定,Yong等人[15]曾证明当cosα>1/3且cosθ>1/3时对{Pi-1,Pi,犞i-1,犞i}插值的三次Hermite曲线几何最优,考虑到切矢跟二次B样条插值曲线之间的关系,此处我们参考这一结论,结合实践规定α<π/3∩θ<π/3,符合这两个角度值的曲线段就为理想段,直接用式(12)求控制点,用式(13)求节点,无需优化.实验表明π/3可满足一般工程上的应用,我们将其定为α和θ的通用取值,称之为理想角度.理想角度值是一种自由度,在实际应用中可以改变,进而从整体上调整曲线的形状,其值越小所构造的曲线整体上越扁平.度在απ/3∩π/3<θ<π-α范围内.第2种情况.犞i-1和犞i指向Pi-1Pi两侧,但θπ-α,不符合约束.Method2.θ=π-α,如图5(d)和(e),犞i-1和犞i平行反向,仍用2-分段构造.P是Pi-1Pi中点,取新插值点Q1令PQ→1与犞i-1同向,且|PQ→1|=γi-1|Pi-1P→i|,犞Q1与Pi-1P→i同向.再根据犞Q1与犞i-1和犞i的方向按照Method0和Method1调整Pi-1Q1和Q1Pi段的形状,图5(d)中Q2是进一步调整的结果.Page6Method3.如图5(f)和(g),θ>π-α.Pi-1Q1平分α,若απ/3平分一次(图5(f)),否则平分两次(图5(g)),故ωπ/4,令|Pi-1Q→1|=γi-1|Pi-1P→i|,犞Q1与Pi-1P→i同向,再用Method0和Method1构造Q1两边的段,整个S(Pi-1Pi)由2-分段或3-分段组成.第3种情况.犞i-1或犞i平行于Pi-1Pi.Method4.如图5(h)和(i),Q是新插值点,D1和D2是控制点,令D1=Pi-1+犞i-1/8,D2=Pi-犞i/8有Q=(D1+D2)/2,犞QD1D→2,再用Method0和Method1构造2-分段.第4种情况.犞i-1和犞i指向Pi-1Pi同侧,要有拐点产生,用3-分段或4-分段构造.Method5.如图6,用Method3的方法取Q1和犞Q1,Pi-1Q1段曲线用Method0和Method1构造.Q2是Pi-1Pi的中点,q取自Q1Q2延长线,由|Pi-1Q→2|=2|Pi-1Q→1|知∠PiQ2q=∠Q1Q2Pi-1<π/6,作Q2q→令∠PiQ2q=∠qQ2q,令犞Q2平分∠qQ2q以便使曲线形状更自然.用Method0直接构造S(Q1Q2),而S(Q2Pi)则由犞i和犞Q2的位置关系决定,从Method0~Method4中根据实际情况选择,整个S(Q1Pi)段在Q2处产生拐点.图6Q1Q2是新插入的点,黑色箭头是其单位切矢图7为Method5的实例.图7(a)和(b)是犞i-1犞i的情况;图7(c)和(d)中,犞i-1和犞i指向Pi-1Pi的同侧相交于另一侧;图7(e)和(f)中,两切矢相交的一图7Method5犞i-1和犞i指向弦同侧,Q1Q2Q3为新插入的点侧与其指向的一侧相同.从图7可知,该方法中拐点位置固定,用自由度调整曲线时曲线的变化是可预知的,完全弥补了Piegl方法的不足.上述6种方法包含了切矢的所有角度,每确定一个新插值点和单位切矢,相应的控制点也被求出,当检测完所有的原始插值点后,控制点序列和节点向量也得以确定,算法1描述整个过程.算法1.ComplexBspline(n,P,V).输入:原插值点P1,P2,…,Pn,单位切矢犞1,犞2,…,犞n输出:二次B样条插值曲线{D0=P1;FORi=1TOn{α是犞i与PiPi→+1夹角,θ是犞i+1与PiPi→+1夹角;}//然后确定节点向量t0=t1=t2=0;t3=|P1P→2|;FORi=3TOn{IF(Pi-1Di→-2+PiDi→-2)×Pi-1P→i≠0tn+3=tn+2=tn+1;}//算法结束4实验下面分各种情况给出新方法的实例.工程上若已知插值点的顺序则按既定顺序插值,否则按照插值点的坐标从左到右插值,对于横坐标相同的点,如图8所示,B与C的插值顺序取决于A,距A近的点先插值.图8B和C纵坐标相同,插值的顺序取决于ABrodlie[16]、Akima[13]和Fritsch[17]数据是插值Page7曲线研究领域内的经典实验数据,文献[18]中的B样条(我们称为传统方法)和Marsden[4]的二次样条是构造二次插值曲线的常用方法,因此,我们基于经典数据在例1中把新方法和常用方法的结果进行比较,同时将Piegl方法也应用在经典数据上与新方法进行对比.弯度、局部可调性、自由度等是有效展现曲线性能的几个方面,我们分别在例2~例5将本文方法和潘日晶[10]的方法以及Piegl方法就这几个方面进行对比.所有实例中的切矢皆由Bessel或Akima方法估计,新方法的自由度除例5外都取前文所定的通用值,例2~例5的数据及潘日晶的方法的图皆取自文献[10].例1.经典数据.Brodlie数据.观察表1,P1和犜1分别是新方法的插值点序列和节点向量,P2和犜2是Piegl方法的表1插值点序列及对应的节点向量插值点与节点向量P1犜1P2犜20,0,0,0.01778,0.035493,0.053206,0.053206,0.053206,0.337109,0.635236,0.75245,0.868810,0.8929530,图9Brodlie数据,虚线是控制多边形图10Akima数据插值点和节点向量,曲线见图9(a)和(b).表中加粗表示的是原始插值点,共11个.新方法所产生的新插值点较Piegl方法要多,但节点值均匀递增,而犜2中有重节点,导致曲线断开,同时弯度较大时Piegl曲线出现交叉现象.在P2和控制点序列确定以后,将Piegl方法倒序插值,得到图(c),可以看出不同于图(b),而将新方法在P1上倒序插值得到的结果与(a)完全相同,在本文所有实例中,新方法的倒序插值均与其正序结果一致,有力地说明了新方法的稳定性.Akima数据.图10,n=11;Fritsch数据.图11,n=9.图10(c)、(d)和图11(c)、(d)中的节点向量由积累弦长参数化求得.可以看出,除了前两种方法性能明显优越以外,新方法在有拐点的段中更具有数据点建议的形状.值Page8例2.图12,n=23,在小弯度情况下各方法的对比,前两种表现良好而潘日晶的方法则不够光顺.图11Fritsch数据例3.图13,n=9,在大弯度情况下各方法的对比,插值点分布较均匀,本文和潘日晶方法的曲线形状较好,而Piegl方法的曲线相对高度过高.例4.图14,n=12.图中的实线是直接对原始点插值,点线改了P4的位置,点划线改变了P8的位置,3种方法都具有良好的局部可调性.例5.图15,n=19.点划线是使用自由度的通用值插值而得,本例通过改变切矢、理想角度和形状因子调整曲线的形状.改变犞3,犞5~犞8和犞11的值后曲线形状如图15(a)中实线所示,改变后的犞5和犞6平行于弦P5P6,因此S(P5P6)表现为线段.将理想角度值由π/3改为π/5,曲线变化如图15(b)中的深色实线所示,在此基础上再将γ3~γ6,γ10~γ13改小,效果如图15(b)中的浅色实线所示.可见切矢和形状因子可直观局部地改变曲线形状,理想角度则可达到从整体上调整曲线形状的目的.Page9图15利用自由度调整曲线形状5结论本文在参数化与节点向量的取值相一致的前提下,将切矢作为约束条件引入到控制点序列的选取中,更充分利用了二次B样条曲线本身的几何性质进行参数化,并通过严格的数学证明表明了所得到的节点值无重复、无大间隔递增、弯度变化越小节点值递增幅度越小;在插值过程中,利用分段思想以达到既利用切矢又不受其限制的目的,使每段曲线都具有预期的形状,并留有切矢、形状因子和理想角度3种自由度,既可以从局部角度直观调整,又可以从整体上优化,从而使曲线更具有插值点所建议的形状.使用本文方法所得到的顺序插值和逆序插值曲线形状相同,这是现有的二次B样条插值曲线方法所不具备的,这说明新方法具有更好的稳定性,再结合实例中所表现出来的良好的局部性,充分证明了新方法的实用价值.由于本文方法需要动态插入新的插值点,在数据点所建议的形状拐点较多、弯度较大时会增加运行的时间和存储空间.另外,从数学上证明顺序插值和逆序插值所得到的曲线是同一条也是将来的工作之一.
