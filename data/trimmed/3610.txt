Page1ODBF:基于操作型衰落BloomFilter的P2P网络弱状态路由算法朱桂明1),2)郭得科3)金士尧2)1)(江南计算技术研究所江苏无锡214083)2)(国防科学技术大学计算机学院并行与分布处理国家重点实验室长沙410073)3)(国防科学技术大学信息系统与管理学院信息系统工程国家重点实验室长沙410073)摘要在P2P网络中,基于衰落BloomFilter的弱状态路由算法试图将每条查询消息沿着成员资格信息量最强的方向传递,并最终以较低的传输代价和传输时延确保较高的查准率.研究发现衰落BloomFilter在传递过程中存在严重的多径叠加和噪音问题,这直接导致查询消息以很高的概率沿着错误的方向传播,甚至会退化为泛洪路由算法.为解决这一挑战性难题,文中提出了基于操作型衰落BloomFilter的弱状态路由算法ODBF(OperativeDeca-yingBloomFilter).ODBF通过分别保存对象的衰落BloomFilter及源节点等信息,使得ODBF能够有效解决基于衰落BloomFilter的路由信息在P2P网络中的多径叠加和信息回流问题,有效抑制噪音的影响,进而使得基于弱状态的路由能够以很高的概率沿着正确方向进行.关键词对等计算;弱状态路由;衰落BloomFilter;噪音1引言BloomFilter是一种结构简单而空间复杂度很小的随机数据结构[1].其主要用一个长度为m的位向量犞对大小为n的集合X进行精确压缩表示,并代替被表示的集合回答类似“元素x是否在集合A中”的判定.BloomFilter使用k个相互独立且随机分布的Hash函数h1,h2,…,hk将每个元素散列到一个长度为m的数组中.图1给出了将元素x,y添加到BloomFilter中的结果示例.对于被BloomFilter表示的集合X中元素e,数组中位置为h1(e),h2(e),…,hk(e)的比特位均被设置为1.对于给定的元素x,若位置为h1(x),h2(x),…,hk(x)的比特位均为1,则认为元素x∈X,否则xX.BloomFilter对该问题的回答不存在假阴性错误(falsenegative),但是存在着假阳性错误(falsepositive).即BloomFilter技术不可能把属于集合X的元素误判为不属于X,但可能把不属于集合X的元素误判为X的元素.发生假阳性错误的概率随着集合中元素的增加而增大.此外,BloomFilter不支持元素的删除操作.出现假阳性错误的概率为[2]Perr=(1-(1-1/m)kn)k≈(1-e-kn/m)k.图1将元素x,y添加到BloomFilter中的结果示例Kumar等人[3]首次设计了一种依指数衰减的BloomFilter,并在此基础上提出了非结构化对等网络中的弱状态路由机制.每个节点产生的本地BloomFilter,以距离为衰减指数,向周围节点传递;节点把从相同邻居链路传递进来的BloomFilter进行并运算,并将产生的联合BloomFilter作为该邻居链路的路由条目.弱状态路由机制,要求在查询路由过程中,查询消息沿着成员资格信息量增强的方向进行.文献[2]指出,由于噪音的原因,且噪音很可能接近甚至比正确路由条目中的成员资格信息还要强,导致大部分查询会沿背离目的节点的方向传递,使得弱状态路由机制十分低效.图2给出了弱状态路由示例.在查询进入目标节点A的衰减范围之前,即路径K→H→G→E,采取随机路由;之后,根据有效信息与噪音强度的对比关系,或沿着错误方向进行(如图2(a)所示),或沿着正确方向进行(如图2(b)所示).针对基于衰落BloomFilter的弱状态路由机制存在的问题,本文提出了基于操作型衰落BloomFilter的弱状态路由算法ODBF(OperativeDeca-yingBloomFilter).ODBF通过分别保存对象的衰落BloomFilter、及源节点等信息,使得ODBF能够有效解决基于衰落BloomFilter的路由信息在P2P网络中的多径叠加和信息回流问题,有效抑制噪音的影响,进而使得基于弱状态的路由能够以很高的概率沿着正确方向进行.2相关工作非结构化P2P网络由于其资源定位方法的简单性和易用性,在Internet上得到了大量应用.然而,由于拓扑结构的不确定性、资源对象放置的随意性等特点,在没有辅助机制的条件下,非结构化P2P资源定位方法很难同时获得较低的查询延迟、少量的定位成本和较高的查询命中率[2].近年来,出现了大量关于非结构化P2P网络的提示性资源定位技术的研究,其主要思想是,由各资源共享节点发布共享信息,并在网络中传播和维护这些共享信息,用于指导资源定位消息的转发[3-4].对于不采用压缩方法的提示性路由方法,维护和更新共享资源对象元信息需要消耗大量的存储空间和网络带宽,资源对象元信息的传播和维护通常只能在一个相对较小的范围内进行,因而对路由指导作用十分有限.针对该问题,提示性路由的研究重点是基于BloomFilter技Page3术对资源对象元信息进行压缩存储和传播,并基于BloomFilter进行查询路由[2-4].BloomFilter被广泛用于非结构化对等网络[5-8]、无线传感器网络[9]、adhoc网络[10-13]以及mesh网络[14]中,实现概率路由.其共同的思想[2]是,每个节点将其所共享的全部资源对象用一个BloomFilter表示,并将其传播到给定逻辑跳步(例如h跳)内的节点;节点把从相同邻居链路传递进来的BloomFilter集合作为该邻居链路的路由条目.如果一个节点需要将查询消息路由到距离其h跳步内的潜在目的节点,则通过检查每个邻居链路的路由条目就能挑选出正确的路由方向,并转发给相应的邻居节点.这些方法的缺点是,虽然单个BloomFilter的存储开销不大,但由于每个节点需要存储从每个链路传递进来的所有BloomFilter,且同一节点的BloomFilter往往通过不同链路多次到达同一节点,从而对存储资源提出了极高的要求.Kumar等人首次设计了一种依指数衰减的BloomFilter,并在此基础上提出了非结构化对等网络中的弱状态路由机制SQR[3].SQR中,每个节点产生本地BloomFilter,以距离为衰减指数向周围节点传递;节点把从相同邻居链路传递进来的BloomFilter进行并运算,并将产生的联合BloomFilter作为该邻居链路的路由条目.该弱状态路由机制要求在查询路由过程中,查询消息沿着成员资格信息量①最强的方向进行.基于BloomFilter的弱状态路由机制的核心思想是:每个节点为其所属对象构造从自身向周边邻居依规则衰减的信息梯度;如果节点转发以其他节点上对象为目标的查询消息,并且处于该消息的潜在目标节点为查询对象构造的信息梯度范围内,则要求该节点能够为该查询消息选择正确的方向进行转发.文献[2]指出,SQR将从相同链路传递进来的BloomFilter的联合作为该链路的路由条目,虽然大大缩小了对存储资源的要求,但是由于噪音的问题,且噪音很可能接近甚至比正确路由条目中的成员资格信息还要强,导致大部分查询沿着背离目的节点的方向传递,使得弱状态路由机制十分低效.文献[2]深入分析了基于BloomFilter的弱状态路由机制SQR存在的问题,并给出了该机制正常运行所需满足的约束条件.然而,该模型建立在局部网络拓扑度数为常数的树型结构基础上,每个节点共享相同个数的资源,约束条件太苛刻;且相关参数的设置和获取也并非易事.本文提出的ODBF能够解决基于衰落BloomFilter的路由信息多径叠加和信息回流问题,极大抑制了噪音的影响,使得基于衰落BloomFilter的弱状态路由算法ODBF能够以很高的概率沿着正确方向进行.3ODBFODBF的基本思想是,分别保存各次资源发布的衰落BloomFilter及源节点和发布序号等信息;进行查询路由时,将查询语义的BloomFilter与各个路由条目中各次资源发布的衰落BloomFilter进行匹配.通过这种方法,ODBF能够仅保存从最短路径传递进来、含有资源对象成员资格信息的衰落BloomFilter,能够消除不同节点和相同节点但非同一次发布资源对象BloomFilter中成员资格信息之间的相互干扰,从而OBF能够进行有效的弱状态路由.3.1ODBF数据结构ODBF的抽象结构为ODBF={Update1,Update2,…,Updatei=(Setsi,Propertiesi),Setsi={…,set(j),set(k),set(l),…},Propertiesi={src_id,res_id}.ODBF结构是由所有资源发布操作结构组成的集合,每个资源发布操作结构Updatei由操作集Setsi和属性集Propertiesi组成.操作集Setsi对应本次资源对象发布的衰落BloomFilter,set(j)表示将第j位设置为1.属性集Propertiesi由资源发布节点的标识src_id和本次资源发布的标识res_id组成.操作集Setsi既可以索引对被设置比特位逐个表示,也可采用BloomFilter数据结构直接表示,具体方法选择存储空间开销较小者.3.2基于ODBF的路由条目设计节点为每个邻居节点关联一个ODBF作为该邻居链路的路由条目.节点接收到从邻居节点传递进来的资源发布对象的衰落BloomFilter时,首先判断该衰落BloomFilter是否从最短路径传递进来,若从最短路径传递进来,则将本次资源发布对象的衰落BloomFilter加入到该邻居节点的ODBF路由条目中,并删除其它邻居链路ODBF路由条目中①给定BloomFilterbf,元素x的成员信息量定义为bf中位Page4从非最短路径接收到的本次资源发布对象的衰落BloomFilter;否则,丢弃该更新操作.判断本次资源发布对象的衰落BloomFilter是否从最短路径传递进来的方法是,扫描所有邻居链路的路由条目的ODBF,通过每次操作的属性src_id和res_id,找出本节点从不同路径接收到的与本次资源发布对应的所有衰落BloomFilter,比较所有衰落BloomFilter的资源成员资格信息量,将资源成员资格信息量最大的BloomFilter作为当前从最短路径传递进来的衰落BloomFilter.节点接收衰落BloomFilter的操作如算法1所示.算法1.节点接收.voidrcv_update(Nodenode,Updateupdate)1.foreachneighbor’sroutingitem(ODBF)odbf2.ifodbfhasupdate3.oldUpdate=getUpdate(odbf,update);4.ifmembership(oldUpdate)<membership(update)5.deleteoldUpdatefromcurrentneighbor’s6.else7.return;8.insertupdateintonode’sroutingitem;3.3路由算法进行查询路由时,将查询语义BloomFilter与邻居节点路由条目中的每个衰落BloomFilter进行匹配,即路由条目的每个衰落BloomFilter与查询的BloomFilter进行“与”运算后计算值为1的比特位个数,并用最大比特位个数作为该邻居节点与查询语义的相关性大小,选择相关性最大(即成员资格信息最强)的邻居节点进行路由转发.查询路由算法ODBF如算法2所示.算法2中,若当前节点具有满足查询query的资源,则直接向查询请求节点返回相应的资源;否则,若尚未达到查询消息传递的最大距离,则继续遍历所有邻居节点.找出与查询BloomFil-ter相关性最大的邻居节点,并进行查询路由转发.算法2.查询路由算法.ODBF(NodecurNode,NodesrcNode,BloomFilterque-1.ifcontain_resource(query)2.sendresourcetosrcNode;3.return;4.ifdistancehreturn;//h为最大传播距离5.max_rel=0;6.forneighborfromNeighbors7.odbf=getODBF(neighbor);8.ifθ(query∧odbf.update)max_rel9.max_rel=θ(query∧odbf.update);ry,intdistance)10.forneighborfromNeighbors11.odbf=getODBF(neighbor);12.ifθ(query∧odbf.update)==max_rel13.ForwardNodes.add(neighbor);14.fornodefromForwardNodes15.ODBF(node,srcNode,query,distance+1);4理论分析ODBF通过分别保存各次资源发布的衰落BloomFilter及源节点和发布序号等信息,能够消除不同节点和相同节点但非同一次发布资源对象BloomFilter中成员资格信息之间的相互干扰,能够仅保存从最短路径传递进来的资源对象的衰落BloomFilter.相对于以单个BloomFilter作为邻居节点的路由条目而言,ODBF大大提高了弱状态路由的成功概率;与此同时,大多数情况下ODBF的空间开销也稍大.定义1.给定集合X和其BloomFilterbf,令θ(x,bf)表示在对应bf中任意元素x∈X的成员资格信息量,即Bfaddress(x)中设置为1的比特位的数目,(Bfaddress(x)由hi(x)构成,其中1ik);令θ(X,bf)表示集合X在对应bf中的信息量,即bf中被设置为1的比特位的数目.定义2.令bfi表示一个bf在第i轮衰减后的结果,其中i1.在bfi中保留有θ(bfi)个为1的比特位.对bf依指数衰减,则有令c为节点的度数,每个bf传递的最大距离为h,则节点通过一条邻居链路linkj最多从网络中能收到linkj=∑hlinkj个BloomFilter的并运算产生一个BloomFilter为bf(linkj),则bf(linkj)=∪hβ(linkj)表示通过链路linkj接收到所有bf的成员资格信息量的总和,则有β(linkj)=∑h且θ(bf(linkj))=m(1-(1-1/m)β(linkj)),其中m为bf的长度.定理1[2].如果x被bf表示,当i=1时,θ(x,bfi)等于k.否则,θ(x,bfi)是一个离散随机变量,记为Ui,其概率分布函数为P(Ui=a)=Page5定理2[2].如果x被bf表示,指标θ(x,bfi(linkj))是个离散随机变量,记为Vi,其概率分布函数为P(Vi=v)=∑v其中,P(Wi=b|Ui=a)=k-a()bP(Eα(linkj)=0)k-a-b,α(linkj)=β(linkj)-θ(bfi),P(Eα(linkj)P(Ez=0)=(1-1/m)z,P(Ez=1)=1-P(Ez=0).令θ(x,bf(linkj))表示节点A从任意其它链路linkj上关于对象x的成员资格信息量.如果节点A的h跳内节点上没有对象x的副本,则θ(x,bf(linkj))定义为对象x在链路linkj上的噪音强度指标.θ(x,bf(linkj))是一个离散随机变量,记为Y,其可能的值为0~k的整数.其概率分布函数为[2]P(Y=u)=()kp0和p1分别表示bf(linkj)中取值为0和1的比特位的比例,并用作bf(linkj)任意一个比特位为0和1的概率.定理3[2].如果节点A已经从查询消息的潜在目的节点接收到一个bfi,则使用单播或多播转发关于对象x的消息的概率为fvalid(Vi)=∑k定理4.如果节点A已经从查询消息的潜在目的节点接收到一个bfh,则使用单播或多播转发关于对象x的消息,能够成功到达目的节点的概率为证明.由于节点A已经从查询消息的潜在目的节点接收到一个bfh,则中间各节点使用单播或多播转发关于对象x的消息的概率为fvalid(Vi),1ih.因此,使用单播或多播转发关于对象x的消息,能够成功到达目的节点的概率为PBF=∏h令obfi(linkj)表示节点A使用OBF结构存储从链路linkj上接收到的bfi,θ(x,obfi(linkj))表示对象x在obfi(linkj)中的成员资格信息量的最大值.令θ(x,obf(linkj))表示节点A从任意其它链路linkj上关于对象x的成员资格信息量的最大值.如果节点A的h跳内节点上没有对象x的副本,则θ(x,obf(linkj))定义为对象x在链路linkj上的噪音强度指标.θ(x,obfi(linkj))是一个离散随机变量,记为Qi,其可能的值为0~k的整数.θ(x,obf(linkj))是一个离散随机变量,记为Z,其可能的值为0~k的整数.令θ(x,bfl在任意链路linkf上关于对象x在bfl信息量,其中1ih,1l(c-1)i-1.令x不被i表示,θ(x,bflbfli,其可能的值为0~k的整数.Z的分布函数为为ZlP(Z=v)=P(Zv)-P(Zv+1),其中,P(Zv)=1-∏hP(ZlQi的分布函数为P(Qi=a)=P(Qia)-P(Qia+1),P(Qia)=1-∏h定理5.如果节点A已经从查询消息的潜在目的节点接收到一个bfi,并使用OBF存储接收到的bfi,则使用单播或多播转发关于对象x的消息的概率为fvalid(Qi)=∑k证明.对于Qi的任意可能取值v,其中0vk,考虑对象x除接收到bfi的邻居链路linkj之外的其它一条邻居链路上的噪音强度小于v的事件,其发生的概率由∑v象x在除linkj和节点A接收到当前查询消息的邻居链路之外的其余邻居链路上的噪音强度同时小于v的事件,该事件发生的概率为∑vc-2为存在噪音的平均邻居链路个数.结合事件Qi的概率分布可知,节点A最终使用单播或多播转发关于对象x的消息的概率为fvalid(Qi)=∑k定理6.如果节点A已经从查询消息的潜在目的节点接收到一个bfh,各节点使用OBF存储接收到的bfi(1ih),则使用单播或多播转发关于对象x的消息,能够成功到达目的节点的概率为Page6证明.定理6的证明与定理4类似,不再赘述.假设每个节点共享n个资源对象,以依指数衰减的BloomFilter一次性发布其共享资源对象,并以ODBF存储其接收到的各个bfi.令BloomFilter的长度为m,Hash函数的个数为k,衰减指数为d,传递的最大距离为h,各节点的度数为c,则每个ODBF的信息量为∑h需log2m个比特位,则所需空间为∑hlog2m个比特位.SQR算法中各节点以单个BloomFilter存储通过一条邻居链路linkj接收到的h范围内节点发布资源的bfi(1ih),其信息量为θ(bf(linkj))=m(1-(1-1/m)β(linkj)),所需空间大小为m个比特位.传统方法中,各节点将通过邻居链路linkj接收其h范围内节点发布资源的BloomFilter完整保存下来,所需存储的信息量为i=1∑(c-1)i-1∑h5模拟实验l=1我们在Peersim①上实现了ODBF,并将其与SQR、传统方法(节点通过邻居链路接收给定逻辑跳步h内所有节点共享资源的BloomFilter,并将这些BloomFilter的并集作为该邻居链路的路由条目)进行了比较.给定参数BloomFilter的比特位个数m、Hash函数的个数k、衰减指数d、最大传输距离h、网络规模N、节点度数c、各节点一次性发布共享资源对象的个数n,考查从接收目标对象的第h次衰落BloomFilter的节点发起的查询的命中率、查询代价(即查询消息访问节点的个数)及各个路由条目的信息量、(或)空间大小.由于各算法的查询延迟均为h,本实验不作考虑.实验参数如表1所示.节点个数N节点度数c拓扑结构BloomFilter的比特位个数mHash函数的个数k衰减指数d最大传输距离h实验过程:各节点发布相同个数资源对象的BloomFilter;任选50个节点作为查询的目标节点,对于任意目标节点,从距离该目标节点距离为h的所有节点发起针对目标节点任意共享资源的查询,并统计查询命中率的均值、查询代价的均值以及各节点路由条目中BloomFilter的信息量、(或)空间大小均值.图3、图4和图5给出了各节点发布1~30资源对象时,各种方法对应的查询命中率、查询代价和各路由条目中的信息量、空间开销.SQR采用多播策略(即路由过程中,将查询消息转发给所有成员资格信息量最大的路由条目对应的邻居节点),查询命①JelasityM,MontresorA,JesiGP.Thepeersimsimula-tor.2009.http://peersim.sf.netPage7中率随着各节点共享资源个数的增加先降低后增加,且最低达到了0.4左右;而查询代价随着资源个数的增加先缓慢增加,而后急剧上升,最大值接近150.结合图3和图4,不难发现,查询命中率降低的过程中查询代价缓慢增加,即对应着其它链路路由条目的噪声强度以一定的概率大于正确路由条目中的信息强度;而查询命中率增加的过程中查询代价急剧上升,即查询命中率的上升是由于各节点共享资源个数达到一定数量后,其它链路上路由条目的噪声强度以较大的概率与正确路由条目的强度等同,产生了大量的近似于“泛洪”形式的消息转发.传统方法(Tradition)的查询命中率为1,且查询代价较低,然后其路由条目中的信息量和空间开销比较大.相对于传统方法,ODBF的查询命中率与其十分接近,查询代价略低,而各路由条目中的信息量和空间开销则大大低于传统方法;与SQR相比,ODBF以相对较大的各路由条目中的信息量和空间开销,获得了远小于SQR的查询代价和较高的查询命中率.图3中ODBF的有效路由命中率的理论值与实验值基本吻合,理论值与实验值相互佐证,表明ODBF的有效性和正确性.相对于以单个BloomFilter作为路由条目,ODBF以稍大的空间开销获得了很高的路由成功率;相对于传统方法的BloomFilter,ODBF的空间开销小得多,而查询成功率与之非常接近.6结论本文提出了基于操作型衰落BloomFilter的弱状态路由算法ODBF(OperativeDecayingBloomFilter).ODBF通过分别保存对象的衰落BloomFilter及源节点等信息,使得ODBF能够有效解决基于衰落BloomFilter的路由信息在P2P网络中的多径叠加和信息回流问题,有效抑制噪声的影响,进而使得基于弱状态的路由能够以很高的概率沿着正确方向进行.
