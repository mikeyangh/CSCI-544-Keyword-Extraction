Page1基于网结构分解的Petri网分散监控器设计罗继亮1)王飞1)方慧娟1)缑锦2)1)(华侨大学信息科学与工程学院福建厦门361021)2)(华侨大学计算机科学与技术学院福建厦门361021)摘要不可控子网的复杂结构是目前Petri网监控难题的根源,该文提出了控制规范等价的网结构分解方法,将对象网分解为多个结构简单的新网,并且将控制规范等价转换到各新网上,从而将复杂的全局控制问题分解简化为多个简单的局部控制问题,进而采用库所不变量方法设计各局部最优Petri网监控器,实现复杂问题分散控制,有效地降低了Petri网控制问题的计算复杂性.最后以一个柔性制造系统为例验证和说明了上述方法.关键词Petri网;离散事件系统;监控;禁止状态1引言大部分实际系统的上层(逻辑层面)均可抽象为离散事件系统,其状态空间随着子单元数指数级增长,即“状态空间爆炸”.而实际的离散事件系统往往规模庞大,比如地铁、核电和柔性制造系统等等,因此确保其满足顺序、联锁和安全等控制规范的监控器设计非常复杂.以可编程逻辑控制器(PLC)为例,其程序的设计和调试工作量巨大,难于获得最优的监控器,且容易出现程序的逻辑错误,而任何程序错误在核电和地铁等安全关键系统中均可造成严重事故.Iordache和Antsaklis[1]基于网结构变换将广义线性约束等价转换为一般线性约束,而广义线性约束能够描述任意语言规范,包括顺序、联锁、负荷平衡和复杂工艺等等.针对线性约束问题,计算机和控制学界基于Petri网开展了监控理论的研究,以Page2期获得逻辑监控器设计的形式化方法,从理论上保证监控器的正确性和最优性,已经取得了一系列重要研究成果[2-3].文献[4]研究了制造系统的Petri网监控器的自动重构方法.Chen[5]给出了基于库所递减量的监控方法.Moody和Antsaklis[6]给出了基于线性代数的库所不变量设计方法.Basile等人[7]在库所不变量方法的基础上引入了次优监控器的设计方法.文献[8]基于局部关联矩阵提高了库所不变量方法中约束的计算效率.为了得到最优监控器设计方法,研究者们将问题限定在一些重要的Petri网子类上,进而借助路径代数发展监控理论,包括状态机[9]、事件图[10]、后向无冲突自由选择网[11]和前向无同步网[12](关于Petri网子类的定义,请参考文献[12]).针对有界网,文献[13]给出了基于可达图和域理论的监控方法,但需求解线性整数规划,而且监控网规模呈指数级增长.文献[14]利用可达图给出了一种最优监控理论,但应用范围限制为安全网和特殊控制规范.文献[15]针对性地提出了基于网结构分解的监控方法,提出依据在于:网结构分解已经成功应用于Petri网行为分析[16],与其类似的网结构压缩(观测器)技术有效地减小了对象网的规模[17-18].但是,文献[15]仅研究了后向无冲突前向无同步网和条件约束(权值为0或1的特殊线性约束).综上所述,Petri网监控问题面临计算复杂性难题,其计算复杂性随网规模指数级增长,因此现有方法均无法兼顾效率和最优.为了降低监控器设计的计算复杂性,本文给出了Petri网分散监控器设计方法,将复杂网分解为多个简单网,从而将全局控制问题分解为各简单网上的局部控制问题,从而将复杂的全局控制问题简化为多个简单的局部控制问题,有效地降低了Petri网监控问题的计算复杂性.现有的最优监控方法[9-12]仅适用于一些Petri网子类,而本文的分散监控方法能够简化对象网,从而能够使得一类尚未求解的监控问题的最优监控器设计成为可能.本文分散监控方法会将原始控制规范分解为一组“或”逻辑的局部控制问题,它通常对应的允许状态空间非凸,超出了文献[11-12]中最优监控器设计的适用范围,对最优监控器的存在性研究具有指导意义.2基本概念2.1Petri网Petri网是一个三元组,记为N=(P,T,F),P是库所集;T是变迁集;F(P×T)∪(T×P)是一个变迁和库所或库所和变迁组成的二元组的集合.一个结点x的输入集和输出集分别表示为·x和x·.标识是托肯在库所中的一个分布,表示为一个函数(列向量)m:P→Z,其中第i维分量表示库所pi含有的托肯数,1iP.设珚P是库所集P的一个子集,那么标识m在珚P的限制是一个函数μ:珚P→Ζ,p∈珚P,μ(p)=m(p);记作μ=m珚P.Petri网系统记作(N,m0),其中m0为初始标识.如果p∈·t,m(p)>0,那么t在标识m下是使能的,记作m[t>.只有使能的变迁可以发生,当一个变迁发生时,它的每个输入库所减少一个托肯,每个输出库所中增加一个托肯.R(N,m)指网N从m经过任意个变迁发生到达的(可达的)全部标识的集合,Ru(N,m)指网N从m经过任意不可控变迁的到达(不可控可达的)标识的集合,如果Petri网在上下文中是确定的,R(N,m)和Ru(N,m)通常简写为R(m)和Ru(m).库所和变迁交替出现并且每个结点是其相邻上游结点的输出的序列称为路径;末结点是首结点的输入的路径称为回路.由库所和不可控变迁组成的路径称为不可控路径.路径π的末尾结点表示为π.在标识m下路径π内托肯数表示为m(π).2.2允许的线性约束线性约束(广义互斥约束)是一个二元组(w,k),其中w:P→0,1,2{},…是库所的权值函数(向量),k∈Z是标识加权和的上界,权值非零的库所为禁止库所.一个Petri网控制问题通常是如何施加控制动作使得系统(N,m0)行为(标识)满足线性约束(w,k),记作[(N,m0),(w,k)].禁止标识集记作Mw,k··={m∈R(m0)|w·m>k},合法标识集为Lw,k··={m∈R(m0)|w·mk},允许标识集为Aw,k··={m∈R(m0)|Ru(m)∩Mw,k=}.定义1[8].给定一个Petri网和线性约束,变迁的权值函数为:T→Z,其中t∈T,(t)=∑p∈t·w(p)-∑p∈·tw(p).定义2[5].对于一个线性约束,如果每个变迁的权值非正,那么该约束称为允许的线性约束,简称允许约束.不可控子网是删除原网内的全部可控变迁后得到的子网.前向无同步网是每个变迁最多有一个输入的普通Petri网.如果:(1)π1=ππa,π2=ππb;(2)πa和πb的首结点是不同的变迁,那么π1和π2冲突[8].在前向无同步网内(为了简便,设网内不含不Page3可控回路),库所p的关键路径集Πc(p)是由始自p的互不冲突的路径组成的集合,且满足其中Ξp是一个路径集的集合,其每个元素是由始自p的互不冲突的路径组成的集合[8].如果在网系统(N,m0)上施加一个允许约束(w,k),采用库所不变量法设计的Petri网监控器是最优的,其设计步骤如下:(1)在对象网内添加一个监控库所c,其初始标识为m0(c)=k-w·m0;(2)对于任意变迁t,如果(t)>0,则增加从c到t的有向弧,且其权值为(t);如果(t)<0,则增加从t到c的有向弧,且其权值为(t)[5].3网结构分解方法本节将介绍前向同步结构分解算法,旨在将复杂Petri网控制问题等价简化或者分解成多个简单的局部控制问题.定义3.如果变迁t有多个输入库所,那么它与其输入库所组成了一个前向同步结构.引理1.给定一个Petri网系统(N,m0),其中p1、p2和t组成了一个前向同步结构,删除N内的从p2到t的有向弧得到新网珡N,珡Nt是删除珡N内所有没有路径与t相连的结点的新网,设珡Nt的库所集为珚Pt,它的初始标识为μ0=m0珚Pt.如果网系统(珡Nt,μ0)是活的,设删除N内从p1到t的有向弧得到新网珦N,珦N的库所集为珟P,那么删除p1对应的状态维数后(N,m0)与(珦N,m0珟P)的状态空间相同.证明.在系统(N,m0)中,可能会限制t激发的是珡Nt和p2及与之通过路径相连的结点,如果(珡Nt,μ0)是活的,那么p1总能被标识,因此p1不会限制t发生,而t是p1的唯一输出,因此割断从p1到t的有向弧不会影响任何变迁的发生,唯一的影响是p1标识没有随t的发生而减少,因此去除p1对应的状态维数后(N,m0)与(珦N,m0珟P)的状态空间相同.由引理1可知,同步结构分解在一定程度上维持了系统行为的不变性,而该不变性正是分解网结构以简化控制问题的根据.下面由引理1给出控制问题的等价简化定理.定义4.如果p是t的输入库所,并且它和t的其他输入库所构成的前向同步结构满足下列条件,则称其为I型同步结构:(1)t是不可控变迁,w(p)=0;(2)在原网N内删除p之外的t的其他输入库所,得到新网珡N,删除珡N内全部没有路径与t相连的结点后的新网珡Nt,设珡Nt的库所集为珚Pt,它的初始标识为μ0=m0珚Pt.没有可控变迁是珡Nt内任何库所的输出,且网系统(珡Nt,μ0)是活的.定理1.给定一个离散事件系统,其Petri网模型为(N,m0),要施加的线性约束是(w,k),如果p和t的其他输入库所组成了I型同步结构,珡N是割断N内从p到t的有向弧后得到的新网,那么[(N,m0),(w,k)]等价于[(珡N,m0),(w,k)].证明.由定义4可知,珡Nt内的任何库所的输出都不是可控变迁,因此可控变迁的激发不会减少珡Nt内的托肯,而(珡Nt,μ0)是活的,那么无论(N,m0)到达哪个状态,珡Nt在该状态下都是活的.因此根据引理1,对于任何可达状态m,删除p对应的状态维后(N,m)和(珡N,m)的不可控可达的状态空间是相同的,而p的权值为0,因此删除p对应的状态维后(N,m0)和(w,k)对应的允许状态空间与(珡N,m0)和(w,k)相同,因此两个控制问题等价.证毕.算法2.II型同步结构分解.输入:[(N,m0),(w,k)]输出:[(珡N,m0),(w,k)]1.珡N←N,P←P;算法1.I型同步结构分解.输入:[(N,m0),(w,k)]输出:[(珡N,m0),(w,k)]1.珡N←N,P←P;2.从P中任意选择一个库所p;3.对于系统(N,m0)和(w,k),判断p是否和一个变迁t的其他输入库所组成I型同步结构,如果是,执行下一步;如果否,P←P-{p},执行步2;4.删除珡N内从p指向t的有向弧,得到新网N;5.珡N←N,P←P-{p};6.如果P≠,执行步2.算法1是基于网结构分解的控制问题等价简化算法,任务是分解网内全部的I型同步结构,降低监控器设计的计算复杂性.因为它是根据定理1直接设计的,其等价性的证明不再赘述.定义5.p和t的其他输入库所组成了一个前向同步结构,如果满足下列条件,那么它称为II型同步结构:(1)t是不可控变迁,w(p)=0;(2)存在一个包含p和t的不可控环c,该环内每个库所只有一个输出变迁,除t外的变迁均只有一个输入库所,并且m0(c)>0.Page42.从P中任意选择一个库所p;3.对于(N,m0)和(w,k),判断p是否存在于包含不可控变迁t的II型同步结构,如果是,执行下一步;否则,珡N←N,算法结束;4.在N内割断从p指向t的有向弧,从而得到新网珡N;5.N←珡N,返回并执行步3;6.如果P≠,执行步2.定理2.如果将(N,m0)和(w,k)输入算法2得到的输出是新网珡N,那么对于离散事件系统,控制问题(N,m0)和(w,k)等价于(珡N,m0)和(w,k).证明.因为p和t的其他输入库所组成了II型同步结构,根据定义5,p和t存在于不可环c内.因为环内的每个库所只有输入变迁,因此环内每个库所的输出变迁也是环内某库所的输入变迁,因此环内的托肯数不会减少,又因为初始标识下环是被标识的,所以该环始终是被标识的.而在该环内只有变迁t处于一个同步结构,因此p总能不可控地获得c内的托肯,也就是说,在系统由不可控变迁驱动的系统行为中,t的发生不受p的控制,因此删除p对应的状态维后,新系统(珡N,m0)与原系统(N,m0)的状态空间相同,并且由于w(p)=0,在这两个系统上施加线性约束(w,k)得到的受控系统的状态空间也相同,所以算法2的输入和输出对应的两个控制问题等价.构,下面考虑无环的前向同步结构的分解方法.件,则称其为III型同步结构:算法1和算法2是分解涉及不可控环的同步结定义6.如果变迁t和其输入库所满足下列条(1)t的输入库所的权值均为0;(2)t的任意输入库所最多只有一个输出变迁,(3)t的输入库所不存在于任何不可控环内.算法3.III型同步结构分解.输入:[(珡N,m0),(w,k)]输出:局部控制问题Ω··={[(珡N1,μ01),(珡w1,k)],…,1.Ω←,T←T;2.[(珡N1,μ01),(珡w1,k)]←[(N,m0),(w,k)],Ω←3.从T中任意选择一个变迁t;4.Ω←,H←1,h←1;5.对于[(珡Nh,μ0h),(珡wh,k)]∈Ω,如果t与其输入库所组成III型同步结构,P←·t,执行下一步;否则,Ω←Ω∪{[(珡NH,μ0H),(珡wH,k)]},h←h+1,H←H+1,执行步5;6.从P中选择一个库所p,H←H+1;7.在珡Nh内,割断除p之外其他库所指向t的有向弧,且该变迁不可控;[(珡N1,μ01),(珡w1,k{从而得到新网珡NH,设其库所集为珚PH,μ0H←m0珚PH,珡wH←w珚PH;8.Ω←Ω∪{[(珡NH,μ0H),(珡wH,k)]},P←P-{p};9.如果P≠,则执行步6;10.如果hH-1,h←h+1,并且执行步5;11.T←T-{t},Ω←Ω;12.如果T≠,H←H,并且执行步3.算法3是对网系统内的全部III型同步结构的逐个分解,具体分解规则见步7,得到的新控制问题的数量与III型同步结构数成正比.为了证明原控制问题与得到一组新控制问题的逻辑“或”等价,我们首先给出引理2.引理2.给定一个Petri网系统(N,m0)和其约束(w,k),其中t与其仅有的两个输入库所p1和p2成III型同步结构,从N内删除p1得到新网珡N1,从N内删除p2得到新网珡N2,p-网的库所集,μ01=m0珚P1,μ02=m0珚P2,珡w1=w珚P1,珡w2=w珚P2,那么原控制问题等价[(珡N1,μ01),(珡w1,k)]和[(珡N2,μ02),(珡w2,k)]的“或”逻辑.证明.根据定义6,t是p1和p2的唯一输出变迁,并且t不可控.p1和p2内的托肯只能通过t不可控地进入网内下游的禁止库所,而且从任何标识开始,t的最大不可控激发数等于两个库所能够不可控地获得的托肯数的较小者,因此m,maxm∈Ru(N,m)w·m=minmax由此可知m,其中μ1=m珚P1,μ2=m珚P2.maxm∈Ru(N,m)w·mkμ1∈Ru(珡N1,μ1)珡w1·μ1k∨maxmax因为珡N1和珡N2中变迁t只有一个输入库所,限制它发生的输入库所比原网减少了,因此m,其中P=P-p1,p{}2.实际系统的状态空间是确定的,根据式(2)和式(3)可知,原控制问题的允许状态空间与两个新问题的允许状态空间的和相等,因此原控制问题等价与两个新控制问题的“或”逻辑.定理3.将(N,m0)和(w,k)输入算法3,得到Ω··={[(珡N1,μ01),(珡w1,k)],…,[(珡NH,μ0H),(珡wH,k)]},H∈Z+,那么原控制问题等价于Ω内各新控制问题的“或”逻辑.Page5证明.在算法3中,网结构的分解操作在步7执行,割断某个III型同步结构内库所p之外的其他库所指向变迁的有向弧,因此如果一个同步结构含有x个库所,那么就会分解出x个新网,即x个新控制问题,根据引理2,这x个新问题的“或”逻辑等价于原问题,因此原控制问题等价于Ω内各新控制问题的“或”逻辑.4Petri网分散监控器设计实际上对象网内很多结点对于监控器设计来说是冗余的,特别是在引入网结构分解算法以后,很多结点与禁止库所之间的路径被割断,从而成为冗余结点,因此删除这些冗余结点,将全局控制问题局部化,从而降低控制问题的计算复杂性.算法4.网结构删减算法.输入:[(N,m0),(w,k)]输出:[(珦N,珦m0),(珦w,k)]1.珦N←N,珟T←T,P←P;2.从珟T中任意选择一个变迁t;3.在珦N中,如果存在从t的任意输出库所或输入库所到任意禁止库所的不可控路径,则执行下一步;否则,删去变迁t,得到的新网为N,珦N←N;4.珟T←珟T-{t};5.如果珟T≠,执行步2;6.从P中任意选择一个库所p;7.如果在珦N中p·=,并且w(p)=0,则删除库所p,8.P←P-{p};9.如果珟P≠,执行步6;10.珦m0=m0珟P,珦w=w珟P.算法4删除的结点均没有不可控路径连向权值得到新网N,珦N←N,珟P←珟P-{p};图1柔性制造系统单元的Petri网模型非零的库所,即对于控制问题来说,删除的结点都是冗余结点,因此输入和输出等价,其证明不再赘述.针对控制问题[(N,m0),(w,k)],Petri网分散监控器设计步骤:[(珡N,m0),(w,k)];[(珡N,m0),(w,k)];[(珡N1,μ01),(珡w1,k)],…,[(珡NH,μ0H),(珡wH,k{[(珦N1,珘μ01),(珦w1,k)],…,[(珦NH,珘μ0H),(珦wH,k{下列操作:1.利用算法1,将[(N,m0),(w,k)]等价转换为2.利用算法2,将[(珡N,m0),(w,k)]等价转换为3.利用算法3,将[(珡N,m0),(w,k)]等价分解为Ω··=4.利用算法4,逐一等价转换Ω内的元素,得到珟Ω··=5.对珟Ω内的每个控制问题[(珦Nh,珘μ0h),(珦wh,k)],按照5.1如果不可控子网为前向无同步网,那么其中Πc(p)是库所p的关键路径集,于是得到与珦wh等价的允许约束w^h束w^h;5.2针对[(珦Nh,珘μ0h),(w^h,k)],根据库所不变量法设计监控器库所ch,从而得到局部监控器Petri网(Nc6.最后得到H个Petri网监控器,即(Nc(NcH,m⌒0H),它们按照“或”逻辑协调控制离散事件系统:当且仅当一个事件的发生将导致全部监控器库所的标识为负时,才需禁止该事件;否则,允许该事件发生.5柔性制造单元图1是一个柔性制造车间的Petri网模型,文献[19]讨论了该系统中自动导航小车的调度监控问题,本文将考虑避免工件碰撞的生产负荷调度问题.Page6如图1所示,该柔性制造系统由3个柔性加工单元和5辆自动导航小车组成,两种工件分别由两辆自动导航小车(AGV1,AGV2)送入两个加工单元(Workstation1,Workstation2),完成各自工序(t2,t5),然后分别由两辆自动导航小车(AGV3,AGV4)送入第3个加工单元(Workstation3),完成组装工序t11,产品放入缓存p17,然后由自动导航小车AGV5载出制造系统.其中缓存p17的容量是3,超过容量将导致产品碰撞,形成废品.考虑传感器和执行机构的成本,仅希望通过控制AGV1和AGV2避免工件产品碰撞,因此在该系统中只有变迁t1和t4可控,其余变迁都不可控.显然,该监控问题是要在系统行为上施加线性约束m(p17)3.根据文献[10]的路径代数法可以给出最优监控器:p17具有两条影响路径:π1=(t1,p2,t2,p3,t3,p9,t7,p13,t9,p15,t11,p17)和π2=(t4,p6,t5,p7,t6,p12,t8,p14,t10,p16,t11,p17)那么控制策略P为m,t∈Tc,m[t>m,u=P(m),u(t)=1其中控制策略P为任意一个标识m给出控制动作u,u(t)=1表示允许变迁t发生,u(t)=0表示禁止变迁t发生,m(π1)=m(p2)+m(p3)+m(p9)+m(p13)+m(p15)+m(p17),m(π2)=m(p6)+m(p7)+m(p12)+m(p14)+m(p16)+m(p17).而根据本文的分散监控器设计步骤可以得到其最优监控器,如图2所示,对涉及算法1、2和3的计算过程介绍如下.图2柔性制造系统的分布式Petri网监控器比较该分散监控器和最优控制策略(5)可知,两者对制造系统的动态行为作出了相同的限制,即两(1)p2、p4和t2既是I型同步结构,也是II型同步结构,因此根据算法1或2,删除从p4到t2的有向弧;类似地,分别删除p10到t3、p8到t5、p11到t6和p18到t12的有向弧,从而得到珡N;(2)在珡N内p15、p16和t11组成了III型同步结构,因此根据算法3,删除p15到t11的有向弧得到珡N1,删除p16到t11的有向弧得到珡N2.(3)根据算法4,删除珡N1内的结点p15,t9,p13,t7,p10,p9,t3,p3,t2,p2,p4,t1,p1,p18得到新网珦N1,如图2实线部分所示;删除珦N2内的结点p16,t10,p14,t8,p12,p11,t6,p7,t5,p6,p8,t4,p5,p18得到新网珦N2,如图2中实线部分所示.(4)于是,原控制问题等价转换为在珡N1上施加约束m(p17)3或在珦N2上施加约束m(p17)3.(5)珦N1和珦N1的不可控子网都属于前向无同步网,于是计算每个库所的关键路径集,显然每个库所的关键路径集都只有一条路径,即是从该库所到p17的路径,根据珦N1上的m(p17)3转换为允许约束m(p6)+m(p7)+m(p12)+m(p14)+m(p16)+m(p17)3而珦N2上的m(p17)3转换为允许约束m(p2)+m(p3)+m(p9)+m(p13)+m(p15)+m(p17)3.(6)根据库所不变量法,分别为两个允许约束设计监控器库所c1和c2,其闭环系统如图2所示,c1监控t4,c2监控t1,在任意状态下,只要t1或t4不导致c1和c2的标识同时为负,那么监控器允许该变迁(事件)发生.种方法得到的监控器等价,也表明原始控制问题与本文分解所得两个简单问题等价.而原始约束转换Page7到了两个经过分解的简单子网上,即全局控制问题分解为两个局部问题,有效地降低了监控器设计的计算复杂性,所得Petri网分散监控器的在线计算量仅与有限的监控器库所数相关,可以满足在线要求.而且制造系统的控制规范等价于“或”逻辑的两个线性约束,即允许状态空间是非凸的,因此最优监控器无法由文献[5,7]的方法得到;文献[14]的方法同样无法给出最优监控器,因为对象网是无界的,并且不可控子网是非安全的.此例只是规模较小、结构较简单的制造系统单元,如果涉及多生产车间或企业级大规模复杂(Petri网)系统,网结构分解方法在降低计算复杂性上的优势将表现地更加明显.6结论针对Petri网监控问题的复杂网结构难题,本文给出了基于网结构分解的监控方法,定义了3类具有代表性的同步结构,根据它们设计了3个网结构分解算法,结合随后设计的网结构删减算法,它们可以将原始复杂全局控制问题等价分解为多个简单子网上的局部控制问题,并进而给出了最优的分布式Petri网监控器设计方法.结果显示,该方法有效地降低了Petri网控制问题的计算复杂性,并得到了一类尚未解决的控制问题的最优解,各局部监控器形式上采取了Petri网形式,便于采用Petri网分析工具分析闭环系统性能,并且监控器满足在线计算要求.
