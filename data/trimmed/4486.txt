Page1改进的自适应冲击滤波图像超分辨率插值算法贾茜1)1)(武汉大学电子信息学院武汉430072)2)(武汉大学测绘遥感信息工程国家重点实验室武汉430079)摘要针对基于插值的图像超分辨算法造成图像边缘扩散和引入噪声的缺点,该文提出一种改进的自适应冲击滤波模型的图像超分辨率插值方法.根据插值后的初始高分辨率图像梯度自适应调整冲击滤波的权重,针对不同的图像边缘相应地减少图像的边缘扩散,同时利用前向扩散消除噪声.相对传统冲击滤波方法,避免了锯齿、块效应等人工痕迹,有效的保留了细节纹理特征.理论分析和实验结果表明,文中方法获得更好的超分辨率结果,主观效果得到明显改善,客观指标得到一定提高.关键词图像超分辨率;图像插值;偏微分方程;冲击滤波1引言图像超分辨率是采用信号处理技术从单帧或多帧低分辨率图像重建出高分辨率图像的技术.图像超分辨率技术在遥感、军事、医学成像、公共安全等Page2于重建的方法,此类方法是利用多帧图像超分辨率重建的思想,忽略运动估计和配准环节,利用基于极小化的原则进行图像重建[4];第4类方法则是基于增强的方法,预先使用图像插值方法处理后,通过图像增强的方式来改善图像放大的效果[5].本文研究基于增强的单帧图像超分辨率插值方法.现有的插值算法可以分为线性方法和非线性方法[1].线性方法常见的有最近邻插值、双线性插值、双三次插值等方法.这些方法插值效率高,但是都会出现锯齿效应、纹理细节等边缘特征丢失的缺点,导致图像变模糊;非线性插值在某种程度上克服了上述缺点,其中以Li和Orchard[6]的边缘指向插值,Fattal[7]的边缘统计插值,Pascal[8]的轮廓模板插值为代表.但是由于基于插值的方法以低分辨率图像的局部信息为基础,仍然会造成图像边缘不同程度的扩散,导致图像变模糊,同时引入内插噪声.近几年来,基于偏微分方程(PartialDifferentialEquation,PDE)的图像处理算法被广泛应用于图像去噪、图像修复、图像超分辨等领域[9-11].基于PDE的图像超分辨方法首先通过对低分辨率图像进行插值得到初始高分辨率图像,然后通过求解PDE去噪增强得到最终的高分辨图像.Osher等人[12]提出一种冲击滤波模型对图像进行锐化增强,在无噪声情况下,获得了良好的增强效果,但该模型对噪声敏感,图像增强的同时噪声也被放大,严重影响增强的效果;Alvarez和Mazorra[13]通过引入高斯核函数,并与前向扩散过程相结合,削弱了噪声的影响,图像增强得到良好的改善,但是其缺点是会产生块效应、锯齿、伪边界等人工痕迹;Kornprobst和Deriche[14]通过阈值调整冲击滤波和前向扩散的权值,由于权重的不连续,不仅会产生锯齿等人工痕迹而且会导致图像变模糊;Gilboa等人[15]提出一种复数域冲击滤波和扩散过程相结合的图像增强和去噪方法,利用图像在复数域的虚部近似作为梯度二阶方向导数,同时采用弱的符号函数,该方法能避免人工痕迹,其缺点是大量的细节特征丢失,图像的纹理部分整体变模糊;Fu等人[16-17]提出基于区域的冲击滤波的自适应图像增强方法,对于不用图像区域采用不同的权重系数处理,该方法取得了很好的效果,但是其不足之处是对于部分图像边缘会产生锯齿现象.本文提出一种改进的自适应冲击滤波的超分辨率方法,通过改进冲击滤波模型,使冲击滤波权重根据图像梯度自适应变化,消除引入的噪声,有效地减少了图像的边缘扩散,提高了图像的清晰度,图形的主观效果得到改善,客观指标得到一定提高.2基于冲击滤波的图像超分辨率插值基于插值的图像超分辨率方法由于其固有的缺陷会导致图像边缘扩散、图像变模糊、清晰度降低,同时引入噪声.如果利用适当的方法对图像进行增强和去噪,就可以得到较为理想的高分辨图像.如图1为基于冲击滤波的图像超分辨率重建框图.低分辨率图像通过插值得到初始高分辨率图像,然后采用冲击滤波进行去噪和增强,得到最终的高分辨率图像.本文侧重点在于冲击滤波的增强方面.2.1冲击滤波模型的提出及分析1990年,针对噪声造成的图像模糊,Osher等人[9]提出如下的冲击滤波模型来锐化增强图像,其优点在于明显减少了图像的边缘扩散,提高了图像的清晰度.其中:uηη表示图像梯度方向η的二阶方向导数,作用为对图像进行边缘检测;u为图像梯度.冲击滤波发生在信号的零交叉点处,根据边缘检测项uηη的符号确定冲击流的方向,利用图像的梯度值确定冲击流的强度.当sign(uηη)>0时,信号被减弱;当sign(uηη)<0时,信号被增强,这个过程相当于去卷积、去模糊或者边缘增强.信号增强后得到的是一个在原有拐点处形成剧烈跳跃的信号,从而达到图像的锐化效果.图2为冲击滤波的去模糊特征图.冲击滤波可以减少图像放大过程中的边缘扩散,但是该冲击滤波模型对噪声敏感,图像增强的同时,噪声也会被放大;其次针对不同的图像内容,对于不同的边缘扩散,即不同的图像梯度,冲击滤波后,边缘扩散得到相同程度的减少,显然会造成明显的块效应、伪边界、锯齿等人工痕迹[12].Page32.2自适应冲击滤波相关模型及分析对于冲击滤波存在的缺点,随后相关的研究引入了前向扩散过程,同时对冲击滤波进行了相应的改进.Alvarez等人[13]为了克服冲击滤波对噪声的敏感,提出了将冲击滤波和前向扩散过程相结合的模型,Alvarez模型如下:其中:η,ξ分别表示平行于和垂直于图像梯度方向;Gσ为高斯函数;cξ为一个正常数;uξξ表示前向扩散过程.该模型通过高斯函数Gσ减少了噪声的影响;增加前向扩散过程去除插值引入的噪声.但是该模型的块效应、锯齿等人工痕迹依然存在.对于Alvarez模型存在的缺点,Gilboa等人[15]利用复数域冲击滤波和扩散过程相结合的方法,有效地改善了人工痕迹,Gilboa模型如下:ut=cηuηη+cξuξξ-其中:cη=|cη|exp(iθ)为一个复数系数,i为虚数单位;cξ是一个实数系数;参数a为控制函数靠近零点处的尖锐度.该模型利用Im阶导数以及利用反正切函数取代符号函数,这样可以有效避免块效应等人工痕迹.但是对于纹理细节丰富的图像,Im纹理细节边缘,导致图像整体变模糊,同时该模型需要设置参数a来控制图像的尖锐度,以适应不同的边缘特征.为了进一步改善人工痕迹等现象,Kornprobst等人[14]以及Fu等人[16]通过对图像进行划分区域,并对扩散项和冲击滤波项加以不同的权重,提出了改进的结合模型,Kornprobst模型和Fu模型的分别为式(4)和式(5):=ατ(uξξ+hτ(|(Gσu)|)uηη)-utαe(1-hτ(|(Gσu)|))sign(Gσuηη)|u|(4)式中:hτ()z=和αe分别为扩散过程和冲击滤波的权重.ut=cηuηη+cξuξξ-w(uη)sign(Gσuηη)u其中,cη,cξ和wu()η分别为扩散过程、细节保留项和冲击滤波的权重.根据不同阈值进行区域划分,采用不同权重进行处理,具体计算见文献[16].以上两个模型通过相关阈值将图像分成不同的区域.在Kornprobst模型中,通过阈值τ将图像分成同质区域和异质区域.当|Gσ(在同质区域,式(4)变为式(6)主要为前向扩散过程,去除图像插值过程中引入的噪声,但是仍然会造成图像纹理细节变模糊.当|Gσ(出现Alvarez模型的缺点.在Fu模型中,该模型根据阈值T1和T2将图像划分成3种不同类型的区域:较大梯度区域;中等梯度区域;较小梯度区域.与Kornprobst模型相比,图像区域划分更加合理,同时采用了连续的权重(Kornprobst模型hτ(z)函数不连续),人工痕迹得到较好的解决,整体上获得了比较好的增强效果.其不足之处是冲击滤波权重系数取决于图像二阶方向导数,在梯度变化较快的纹理细节区域,图像边缘的拐点附近会出现一些锯齿现象.上述两个模型通过不同的阈值将图像分成不同的区域进行处理,虽然在一定程度上减少了块效应等人工痕迹,但是对于不同的图像,阈值的选取不一样,难以有效的确定阈值.3自适应冲击滤波模型的改进及实现针对以上模型存在的问题,在以上分析的基础上,本文提出一种改进的自适应冲击滤波方法.针对不同的图像内容,根据图像梯度自适应控制冲击滤波的权重,对不同的梯度进行合理的处理,避免对所有图像边缘进行相同的处理或者冲击滤波权重的不连续性,有效的改善了人工痕迹,图像效果更加符合人眼视觉感知特性效果.3.1模型的改进本文提出的改进模型如下:ut=cξuξξ-(1-g(u))tanh(Gσuηη)u其中:g(x)=exp-正常数,分别控制冲击滤波和前向扩散过程的权重.与2.2节分析的模型相比,本文模型将带有边缘停止函数的冲击滤波和前向扩散过程相结合.本文模型的冲击滤波项改用双曲正切函数(tanh).一般模型采用符号函数(sign),其取值为-1,0,1,在图像拐点附近的权重一样,导致图像边缘出现锯齿Page4现象.本文改用双曲正切函数,这样使图像拐点附近的权重取值连续,削弱了锯齿现象.而反正切函数(arctan)曲线变化比双曲正切函数平缓,图像权重取值偏小,会导致图像的增强不够,因此采用双曲正切函数保证合适的增强.3种函数的曲线对比如图3所示.本文模型冲击滤波项的权重包含边缘停止函数g(|u|),能根据图像的梯度自适应调整边缘扩散减少的程度.在图像梯度较小部分,该权重较大,冲击滤波项较大,前向扩散的作用相对较小,从而使边缘扩散减少的程度相对较大;相反在图像梯度较大部分,该权重较小,前向扩散的作用相对较大,从而使边缘扩散减少的程度相对较小.这样,针对不同的图像内容,使冲击滤波的权重根据图像梯度连续变化,这样使图像的边缘扩散得到不同程度的减少,在图像增强的同时进一步减少图像边缘的人工痕迹,图像增强的效果更加客观合理.在Gilboa模型中,需要设置参数a来控制图像的尖锐度,以适应图像不同的边缘特征;同样在Kornprobst模型和Fu模型中,冲击滤波的权重由阈值划分确定,因此阈值的选取尤为关键.在Kornprobst模型中,通过阈值将图像划分为同质区域和异质区域;在Fu模型中,通过阈值将图像分为较大梯度区域、中等梯度区域和较小梯度区域,不同区域的权重系数的选择不一样,因此对于不同的图像内容,阈值难以确定,同时权重系数不仅取决于图像二阶方向导数,而且与参数l1和l2有关[16],同样增加了选择的难度.而本文方法的权重系数由图像自身的梯度决定,对于纹理特征丰富的图像以及不同的图像具有一定的普适性.3.2模型的数值实现对于式(7)的偏微分方程,本文采用有限差分法求解,其迭代形式为un+1=un+Δt{cξunΔt为时间离散步长,迭代的初始条件为插值后得到的高分辨率图像u0.其中二阶方向导数的离散如下:烄uηη=烅uξξ=烆其中:ux,uy分别表示在x,y方向上的一阶差分;uxx,uyy,uxy分别表示在x,y方向上的二阶差分和混合差分.对于梯度u的数值离散化,本文利用minmod函数[18]m(a,b)来近似计算图像梯度.烄u=烅m(a,b)=烆其中:u+的前向差分和后向差分;h为空间离散步长.本文利用Matlab编程实现以上各项的离散化,本文算法的具体实现过程如算法1.算法1.改进的自适应冲击滤波图像超分辨插值算法.输入:低分辨率图像LR输出:高分辨率图像uN1.令n=0,对输入低分辨图像LR插值得到初始高分辨率图像u0;2.计算高分辨率图像在x,y方向上的前向差分和后向差分:u+x,u-3.利用minmod函数,由式(10)近似计算高分辨率图像的梯度|u|;4.计算高分辨率图像的边缘停止函数g(|u|);5.由式(9)分别计算高分辨率图像沿梯度方向的二阶方向导数uηη以及沿垂直于梯度方向的二阶方向导数uξξ;6.利用高斯函数Gσ对沿梯度方向的二阶方向导数uηη进行高斯卷积得到Gσuηη;7.计算高分辨率图像的冲击滤波-tanh(Gσuηη);8.计算式(8),迭代得到重建的高分辨率图像un+1;9.令n=n+1,如果nN(N为最大迭代次数),转至步2;否则,转至步10;10.输出最终高分辨率图像uN.以上算法主要步骤的计算细节如下.步骤1.计算高分辨率图像在x,y方向上的前向差分和后向差分:u+为图像的x,y坐标,u(i,j)表示图像的像素值,则图像在x,y方向的前向差分和后向差分可以参考文献[18]定义.步骤2.计算高分辨率图像的梯度|u|,边缘停止函数g|u(uξξ.根据步骤1中计算的图像在x,y方向上的前向差Page5分和后向差分代入式(10),得到图像梯度|u(i,j)|以及边缘停止函数g|u(i,j)gu(i,j)图像在x,y方向上的一阶差分ux(i,j),uy(i,j)的计算如下:{ux(i,j)=[u(i+1,j)-u(i-1,j)]/2uy(i,j)=[u(i,j+1)-u(i,j-1)]/图像在x,y方向二阶差分uxx(i,j),uyy(i,j),uxy(i,j)分别如下:{uxx(i,j)=u(i+1,j)+u(i-1,j)-2u(i,j)uyy(i,j)=u(i,j+1)+u(i,j-1)-2u(i,juxy(i,j)=[u(i+1,j+1)-u(i-1,j+1)-u(i+1,j-1)+u(i-1,j-1)]/4(14)因此,将上述一阶差分和二阶差分代入式(9)可得,图像的二阶方向导数uηη(i,j)和uξξ(i,j)的计算式.步骤3.计算梯度方向二阶导数uηη和高斯函数Gσ的卷积uσ=Gσuηη以及冲击滤波Fshock=tanh(Gσuηη).定义高斯函数Gσ的半径为M.那么uσ(i,j),Fshock(i,j)的计算如下:综上所述,重建的高分辨率图像un+1(i,j)的计算为式(16).un+1(i,j)=un(i,j)+Δt{cξun[1-g(u(i,j))]Fshock(i,j)un(i,j)}3.3模型的复杂度分析本文在相同的参数条件下,对上述冲击滤波模型进行了复杂度分析.在实际计算中乘除法的运算时间远大于加减法,因此本文忽略加减法的运算时间,设高分辨率图像的长和宽分别为H和W,高斯函数的半径为M(M3).图像每个点的梯度计算为2次乘法,因此图像梯度计算量为2HW;边缘停止函数每个点的计算为2次乘法和1次除法,因此边缘停止函数计算量为3HW;图像每个点的一阶差分ux和uy计算为1次除法,因此一阶差分的计算量为2HW;图像每个点在x,y方向上的二阶差分uxx和uyy的计算为1次乘法,二阶差分uxy的计算为1次除法,因此图像二阶差分的计算量为5HW;图像每个点的二阶方向导数uηη和uξξ的计算为13次乘法,因此图像二阶方向导数uηη和uξξ的计算量为13HW;图像每个点的方向二阶导数uηη与高斯函数Gσ的卷积计算为(2M+1)2次乘法,因此图像高斯卷积的计算量为(2M+1)2HW.以上分析了上述模型一般的计算量,具体的数学函数的计算因每个模型的差异而不同,本文在后面实验结果中给出了每个模型具体的计算时间,对各个模型的效率进行对比.由以上分析得出,Alvarez模型的计算量大约为[39+(2M+1)2]HW;Gilboa模型计算量大约为42HW;Kornprobst模型计算量约为4+(2M+1)模型的计算量大约为45+2(2M+1)型计算量大约为44+2(2M+1)型各项权重系数具体的计算量根据不同图像有所不同,本文在后面的实验结果中给出了对于不同图像[各个模型的具体计算时间;而本文模型的计算量大约为43+(2M+1)知Gilboa模型计算量最小,Kornprobst模型和Fu模型的计算量其次,而本文模型的计算量适中.4实验结果及分析为了验证本文提出的改进的自适应冲击滤波图像超分辨插值算法的有效性,本文选择Pascal插值方法[8]对低分辨率图像进行插值得到初始高分辨率图像,然后利用Alvarez模型[13]、Gilboa模型[15]、Kornprobst模型[14]、Fu模型[16]和本文方法进行处理,最后将处理后的图像进行对比;同时与其他具有代表性的超分辨率方法进行了对比,这些方法包括基于重建的迭代反投影方法(ISP)[4]、基于增强的梯度轮廓先验方法(GPP)[5]和基于学习的稀疏表示方法(ScSR)[3].测试的仿真软件为Matlab2012;操作系统为WindowsXP;计算机配置为CPU双核,主频3.3GHz,内存4GB.图像效果采用主观效果和客观效果进行评价.本文对大量图像进行了测试,测试图像来源于加州大学伯克利分校图像分割数据库,图像主客观效果选择标准测试图像Lena以及在校园内实际拍摄的图像Leaf.测试方法为:首先将原始高分辨率图像下采样为原始图像的1/16大小,然后采用插值方法将其放大为与原始图像大小一样的初始高分辨率图像,最后利用上述冲击滤波模型对其进行处理.主观效果如图4所示,输入图像表示低分辨率图像,原始图像表示原始高分辨率图像,选择输入图像方框标记的部分进行整体效果对比,选择高分辨率图像方框标记的部分进行局部细节对比.Page6(a)Lena结果对比(Alvarez模型:cξ=2,N=14;Kornprobst模型:τ=6,ατ=1,αe=1,N=13;Gilboa模型:a=0.5,θ=π/1000,cη=1,cξ=1,N=27;Fu模型:T1=9,T2=3,l1=0.05,l2=50,N=12;本文模型:cη=10,cξ=1,N=19)(b)Leaf结果对比(Alvarez模型:cξ=3,N=11;Kornprobst模型:τ=8,ατ=1.2,αe=1,N=10;Gilboa模型:a=2,θ=π/1000,cη=0.1,cξ=1,N=29;Fu模型:T1=10,T2=4,l1=0.01,l2=100,N=20;本文模型:cη=10,cξ=1,N=18)图4主观效果对比Page74.1主观效果参数设置:实验过程中通用参数一般设置相同,以保证实验结果的合理性,高斯半径M=7,方差σ=5,时间步长Δt=0.03.冲击滤波的权重系数根据不同方法选取不一样,实验过程中,针对不同的图像,通常选取最合适的参数以达到最好的效果.本文冲击滤波的权重系数主要根据图像梯度变化,参数cη影响不大,通常取值为10.从图4的主观效果可以看出双三次插值方法的细节丢失严重,图像变模糊,甚至出现严重的锯齿效应;Pascal插值方法与双三次方法相比图像清晰度有所提高,但是图像边缘扩散较大,图像整体还是比较模糊;Alvarez模型虽然边缘扩散较小,但是图像出现了严重的块效应、锯齿等人工痕迹,具体表现在Lena图像的头发部分出现锯齿以及脸部存在块效应,Leaf图像的叶子部分边缘存在明显的块效应和锯齿;Kornprobst模型虽然对于梯度变化较小部分的人工痕迹有所改善,但是以图像模糊为代价,同时图像梯度变化较大,部分仍然存在块效应和锯齿,具体体现在Lena图像的头发变模糊以及帽子边缘出现锯齿和伪边界,Leaf图像的部分树叶边缘出现模糊、块效应以及锯齿;Gilboa模型的图像边缘扩散减少的程度较小,图像无明显的人工痕迹,但是图像相对比较模糊;Fu模型对于图像块效应改善比较明显,但是图像边缘梯度渐变较大部分仍然会出现锯齿效应,锯齿的位置出现在Lena图像的帽子边缘、表2客观指标对比图像ChildLenaFlowerAirplanePeppersBarbaraLeaf由表2的客观指标可知,本文的PSNR最高,与原始图像的误差最小;在SSIM方面,Alvarez模型冲击滤波的权重系数为一个常数,对于不同的纹理结构,增强的程度相同,导致在图像的边缘出现大量的块效应和伪边界,这些“虚假”的图像结构可能Leaf图像的树叶边缘.而本文的方法无明显的块效应等人工痕迹,同时边缘扩散较小.而利用其他超分辨率方法虽然没有出现块效应、锯齿等人工痕迹,但是图像边缘都出现了不同程度的模糊,图像整体变模糊.因此,本文方法的图像纹理结构和边缘特征相对比较清晰,整体视觉效果最好.4.2客观效果图像处理的客观指标很多,本文使用峰值信噪比(PeakSignaltoNoiseRatio,PSNR)和图像的结构相似性(StructuralSIMilarity,SSIM)[19-20]来衡量图像的客观效果.峰值信噪比(PSNR)是对重建图像与原始图像的误差进行定量计算.计算如下:EPSNR=-10log10∑X和Y表示大小相同的两个图像.图像的结构相似性(SSIM)用来衡量两幅图像的相似度,计算如下:ESSIM=其中:μX,μY分别是两幅图像的均值;σX,σY分别是两幅图像的标准差;σXY是两幅图像的协方差;C1,C2是常量.本文用以上两个指标对图像进行客观评价,对多组测试源进行测试.图5和图6分别为PSNR与迭代次数的关系,测试结果以及其对应SSIM如表2所示.Gilboa模型0.91190.91920.91740.91690.91670.91240.92200.92440.92440.91390.92360.91970.89360.88870.89680.88480.88910.89790.91230.91470.91470.91760.91640.91950.94450.82670.8270.97650.97840.97950.97070.97910.9770更接近原始图像,从而使SSIM错误的偏高.而在Fu模型中,权重系数由梯度方向二阶导数决定,由于在图像纹理细节区域图像梯度变化较快,从而导致权重系数偏高,也会出现一些伪边界和锯齿,同样使SSIM错误的偏高.而本文SSIM相对其他方法Page8较高.因此客观结果表明,本文方法能取得更好的效果.4.3效率对比本文对3.3节模型的复杂度分析给出具体的时间效率对比,测试结果如表3所示,从表3可以看出本文提出的模型效率适中.图像Child512×5122.063Lena512×5122.719Flower768×5122.609Airplane512×5121.734Peppers512×5122.547Barbara788×5762.922Leaf512×5121.9845结论本文提出一种改进的自适应冲击滤波模型的图像超分辨率插值方法.首先利用插值算法得到初始高分辨率图像;其次利用图像梯度自适应调整冲击滤波的权重,减少图像的边缘扩散,通过前向扩散过程消除噪声;最后将冲击滤波和前向扩散有效结合最终得到高分辨率图像.实验结果表明,相比基于插值的图像超分辨率方法、传统冲击滤波模型以及其他几种具有代表性的其他超分辨率方法,本文方法提高了图像的清晰度,主观效果得到明显改善,客观效果整体得到一定提高.本文算法的不足之处在于迭代次数直接影响图像增强的效果,后期的研究工作可以考虑迭代次数根据图像增强的效果自适应停止;另外本文图像效果与真实图像还有一定的差距,将来的工作可以考虑利用基于学习的方法补充一些高频信息.
