Page1一种基于随机Petri网的Web服务组合性能瓶颈定位策略何炎祥1),2)沈华1),3)1)(武汉大学计算机学院武汉430079)2)(武汉大学软件工程国家重点实验室武汉430072)3)(湖北工业大学计算机学院武汉430068)摘要Web服务组合的性能对推动以服务为核心的价值链的良性融合起着重要作用.针对如何有效发现Web服务组合中性能瓶颈的问题,提出一种基于随机Petri网的Web服务组合性能分析模型,根据库所和变迁之间的直接关系总结出模型的4种基本结构,通过结构转换得到性能瓶颈定位分析结构集{顺序结构,分支结构,汇聚结构},在此基础上提出一种Web服务组合性能瓶颈定位策略.该策略首先根据库所中token消耗的速度将库所分成主动受阻库所、被动受阻库所和流通库所3类,然后分别基于3类库所在3种分析结构中的不同分布情况,通过顺向结构分析和逆向结构分析相结合的方法,讨论瓶颈可能存在的位置,并给出如何确定3种分析结构的结构发现定理.实验证明策略的预测结果是有效的.关键词随机Petri网;Web服务;Web服务组合;性能瓶颈;瓶颈定位1引言通过协调组织多个Web服务之间的交互,服务组合提供了更为强大的服务功能,并且有效加快系统开发的速度,快速满足用户需求[1].Web服务组合的本质是通过若干Web服务间的相互通信和协作灵活实现上层业务需求,并能够屏蔽底层实现技术的变迁对上层产生的影响.Web服务组合是面向服务架构(Service-OrientedArchitecture,SOA)中构建新服务和满足业务需求的主要手段,在业务流程的构造和重组中处于核心地位,因此Web服务组合的性能及其评价方法对SOA的发展至关重要.目前一些关于Web服务组合性能评价的研究采用的是基于模型的方法,首先为Web服务组合系统建立一个合适的模型,然后求出模型的各项性能指标,最后根据得到的性能指标对模型进行性能评估.目前广泛采用的建模工具有进程代数[2-7]、Pi演算[8-9]、自动机理论[10-11]、排队论[12-13]、Petri网[14-18]等.文献[19]提出一种代价概率进程代数PPPA并用于Web服务组合建模,以支持Web服务组合的功能、可靠性、性能和代价的建模和分析.文献[20]针对工作流网提出了一种性能建模和分析的方法.该文献提出了包含时间、结构和资源等多维度信息的工作流网络概念,将无环自由选择工作流网络分解为一组变迁组件集的算法进行扩展,使得该算法能够处理包含循环结构的时间工作流网.利用连续时间马尔可夫链对资源的可用性进行分析,并且通过服务到达的平均速率和服务速率分析出工作流中可能存在的瓶颈.文献[21]提出了一个e-business系统的通用队列模型,该模型可以捕捉到大多数e-business系统的行为特征.文献在该模型的基础上提出了一种近似分析算法,该算法的近似解可以用来在给定或假设的负载条件下预测系统的性能,同时能够为特定性能指标选择最优的控制参数配置.文献[22]利用网络演算的概念提出了一种形式化最坏情况下的演算模型.网络演算是为了研究确定性排队系统所提出的一种系统理论,文献[22]利用该理论来描述在最坏情况下工作流的行为特征,根据对行为特征的分析来预先规划工作流的控制流.文献[23]利用高级面向对象Petri网(AdvancedObject-OrientedPetriNet,AOOPN)对Web服务组合进行建模,并对其进行安全性、活性、可达性、有界性等方面的评估.文献[24]为了分析多层次互联网应用的行为特征,提出了一种基于闭合队列网络的分析模型,模型中的每个队列分别对应于应用的不同层次,根据模型捕捉到的各层次的行为特征,可以对该互联网应用进行性能预测、应用程序配置以及瓶颈定位.文献[25]利用统计技术和Petri网为服务组合的可信性提出了一种评估方法.每个Web服务的可信性可以通过分析它们以往的执行情况进行评估,组合服务的可信性评估则通过分析每个Web服务的评价结果和组合服务的组合拓扑来得到.文献[26]在排队Petri网的系统模型框架上采用图形化的方式完成服务系统的性能建模和分析.文献[27]首先用随机Petri网(StochasticPetriNet,SPN)对Web服务流进行建模,然后对Web服务流的5种基本结构(顺序sequential、并行parallel、条件conditional、循环loop和互斥mutex)提出了一组化简规则,并在5种结构简化的过程中讨论了它们的性能分析.文献[28]为基于SPN的工作流系统的顺序、并行、选择和循环4种基本结构提出了一组性能等价公式,通过这些等价公式可以对复杂工作流系统进行性能的定量分析.本文首先提出一种基于SPN的Web服务组合Page3性能分析模型WSCPAM(WebServicesCompositionPerformanceAnalysisModel).WSCPAM实质上是满足某些约束条件的SPN,这些约束条件来自于Web服务与服务请求之间固有的特征.从图论的角度重新认识WSCPAM,会发现模型中两类顶点(库所和变迁)之间存在4种直接关系,4种直接关系之间的不同复合可以表示出Web服务的各种组合方式.结构即关系,将两类顶点间的4种直接关系称为WSCPAM的4种基本结构.对4种基本结构进行结构转换生成瓶颈定位分析结构集{顺序结构,分支结构,汇聚结构}.在分析结构集的基础上提出一种Web服务组合性能瓶颈定位策略BNL-WSCPAM(BottleNeckLocationinWSCPAM).BNL-WSCPAM的主要思想是,根据库所中token消耗的速度将库所分成主动受阻库所、被动受阻库所和流通库所3类,然后分别对分析结构集中的结构进行性能瓶颈预测分析,并针对3类库所在结构中的所有可能分布,通过顺向结构分析和逆向结构分析相结合的方法对结构中所有可能存在的性能瓶颈进行讨论.最后根据讨论得到的抽象算法生成实现算法,开发相应的软件工具,并给出测试用例说明BNL-WSC-PAM预测结果的有效性.本文第2节给出基于SPN的性能分析模型WSCPAM的定义以及对WSCPAM的结构分析,得到用于瓶颈定位的结构分析集;第3节是对BNL-WSCPAM策略的详细描述,给出性能瓶颈定位预测的抽象算法;第4节讨论抽象算法中用到的顺向结构分析和逆向结构分析方法,并给出结构发现定理.结构发现定理解决了如何确定输入算法的结构是结构分析集中的哪种结构的问题;第5节给出一个实例说明BNL-WSCPAM策略预测结果的有效性;第6节总结本文的工作.2WSCPAM模型及结构分析2.1WSCPAM模型2.1.1建模工具SPN有两种形式[28]:Molloy形式和Florin-Natkin形式,本文采用的是Molloy连续时间SPN.其定义如下.定义1.连续时间SPN[28].一个四元组N=(S,T;F;M0),其中S为库所集,T为变迁集,N是一个连续时间SPN当且仅当满足:(1)S∪T≠;(2)S∩T=;(3)F(S×T)∪(T×S);(4)M0为初始标识;(5)dom(F)∪cod(F)=S∪T;(6)t∈T的可实施时刻到实施时刻之间的时间间隔被看成是一个连续随机变量xt(取正实数值),且服从分布函数Ft(x)=P(xtx)=1-e-λtx,其中实参数λt>0是变迁t的平均实施速率,变量x0.定义2.变迁的前置集和后置集[28].对于t∈T,t的前置集记为·t,其定义为·t={s|(s,t)∈F};t的后置集记为t·,其定义为t·={s|(t,s)∈F}.定义3.库所的前置集和后置集[28].对于s∈S,s的前置集记为·s,其定义为·s={t|(t,s)∈F};s的后置集记为s·,其定义为s·={t|(s,t)∈F}.定义4.起始库所和终止库所.如果s∈S(|·s|=0),则库所s是一个起始库所;如果s∈S(|s·|=0),则库所s是一个终止库所.2.1.2模型描述在本文提出的Web服务组合性能分析模型WSCPAM(WebServicesCompositionPerformanceAnalysisModel)中,Web服务或子Web服务组合用变迁表示,变迁的前置库所(也称为输入库所)存放对该变迁的请求队列,变迁的后置库所(也称为输出库所)存放的是该变迁对某个后置变迁的服务请求,且请求队列的长度不限.换句话说,两个变迁之间的库所相当于一个生产者一个消费者问题中容量不限的缓冲池,两个变迁则分别作为生产者和消费者,如图1所示.从图1可以看出,变迁ti执行完成后将对tj的服务请求发送到库所sij的过程相当于生产者将产品放入缓冲池;如果sij有token,则变迁tj可以开始执行并消耗sij中的一个token,这相当于消费者从非空缓冲池中取出一个产品进行消费.显然一个缓冲池对应一对生产者-消费者,因此一个库所对应一个变迁序偶对;又由于起始库所和终止库所的存在,故对每个库所而言,它需要满足如下约束条件:此外,在Web服务组合逻辑中不存在服务的自Page4我请求,即在WSCPAM中不存在图2所示的循环结构.如果存在图2所示循环结构,则意味着一个服务的开始执行依赖于它自身的执行结束,这有悖于常理,因此在WSCPAM中不可能存在“one变迁one库所循环结构”.换句话说,在WSCPAM中任一库所和任一变迁之间最多只存在一条弧.图2所示的循环结构可以形式化描述为s∈S,t∈T((s,t)∈F∧(t,s)∈F),因此要使得模型中不存在上述循环结构,WSCPAM必须满足下述条件:s∈S,t∈T(((s,t)∈F∧(t,s)F)∨((s,t)F∧(t,s)∈F))因为且由式(1)可知:假设|t·|∩|·t|≠,则有s∈S(s∈|·t|∩|t·|)(s,t)∈F∧(t,s)∈F,与式(2)矛盾,所以假设不成立,即故式(2)与下述条件等价:综上所述,WSCPAM就是满足约束条件式(1)和式(3)的SPN.定义5.WSCPAM模型.WSCPAM是一个同时满足以下两个约束条件的SPN.约束条件1.约束条件2.(s∈S(·s∩s·=))∧(t∈T(·t∩t·=)).2.24种基本结构根据2.1节中的定义1和定义5可知:在WSCPAM中存在两类顶点(库所,变迁)、两类弧(库所→变迁,变迁→库所).定义6.基本结构.基本结构是指库所与变迁之间的直接关系,即库所与变迁之间的一步关系.换句话说,基本结构描述了库所和变迁之间的一种原子关系.WSCPAM中有如图3所示的4种基本结构.4种基本结构是模型中粒度最小的结构,模型中的任何一个结构均可由这4种基本结构构造得到.因此可以从有限基本结构开始对模型的结构进行归纳分析,预测出瓶颈可能存在的位置.2.3结构分析集由4种基本结构经过两两复合,可以得到如图4所示的复合结构.对图4所示的8种简单复合结构做如图5所示的5种结构转换.通过观察图5所示的转换结果,可以发现,WSCPAM的复合结构一定包含图4(a)和图4(b)所示的顺序结构(SequenceStructure),图4(c)所示的分支结构(SplitStructure)和图4(e)所示的汇聚结构(JoinStructure).因此,{顺序结构,分支结构,汇聚结构}构成了WSCPAM的结构分析集.本文对WSCPAM基于结构的瓶颈定位分析策略BNL-WSCPAM就是建立在此结构分析集之上的.Page5图5WSCPAM的简单复合结构的结构转换3BNL-WSCPAM策略描述3.1相关概念定义7.token概率密度函数[28].在稳定状态下,每个库所中所包含的token数量的概率.对s∈S,i∈N,令P[M(s)=i]表示位置s中包含i个token的概率,则可从标识的稳定概率求得库所s的token概率函数为其中Mj∈[M0〉,且Mj(s)=i.定义8.库所中的平均token数[28].对于si∈i表示在稳定状态下库所si在任一可达标识中平S,u-均所含token数,则有u-定义9.平均消耗时延.对应每个库所设置一个参数τi,称为“平均消耗时延”,其定义如下:i是库所si所含的平均token数,λi是库所si后其中u-继变迁ti的平均实施速率,Δ是影响因子.显然,在变迁始终处于可实施的假设条件下,τii与λi的比值;但在实际情况中变迁ti并不总等于u-是处于可实施状态,因此τi还受到变迁可实施度的影响,我们把可实施度对τi的影响用“影响因子”来表示.定义10.变迁的可实施度.变迁ti可实施度fi的定义如下:容易发现,可实施度为0对τi的影响最大,可能导致τi趋于无穷大;可实施度不为0,其值越大意味着待变迁ti消耗的token越多,则对τi的影响也越大.定义11.影响因子.基于上述特点,影响因子Δ定义如下:其中ω表示一个足够大的数,显然有limn→又有n2n=0,limn→易知,故将式(7)代入式(8):Page6定义12.非终止库所集和终止库所集.根据库所的后置变迁集是否为空,将库所集S分为两类:非终止库所集S·和终止库所集S=.其定义为定义13.主动受阻库所集,被动受阻集和流通库所集.为了便于分析,根据τi的值将非终止库所集S·分为3个互补相交的子集:主动受阻库所集S^、被动受阻集S⌒和流通库所集S··.其定义如下:S^=si|si∈S·&&τi→ω&&u-S⌒=si|si∈S·&&τi→ω&&u-S··=si|si∈S·&&(τi→ω显然有定义14.库所流集和变迁流集.用符号ES表示库所流集,用符号ET表示变迁流集,它们的定义分别为定义15.库所的直接后继/前驱库所.库所si的直接后继库所si定义为库所si的直接前驱库所si定义为定义16.顺向结构分析,逆向结构分析.顺向结构分析(DownArcAnalysis),也称为前向结构分析,是指沿着弧(或流)的方向进行分析;逆向结构分析(ReverseArcAnalysis)是指逆着弧(或流)的方向进行分析.3.2主要算法描述算法1.瓶颈定位策略BNL-WSCPAM.输入:WSCPAM输出:瓶颈预测结果1.求非终止库所集S·和终止库所集S=;2.求出非终止库所集S·中所有库所的平均消耗时延τi;3.根据τi的大小和定义13将非终止库所集S·分成3个不相交集S^、S4.如果S⌒非空,则执行步5;否则执行步6;5.依次以S⌒的库所作为始点进行结构分析,得出预估瓶颈的位置;6.如果S··非空,则按照τi的大小对S··中的库所进行降序排序,以S··的库所为始点进行结构分析,得出预估瓶颈的位置.4性能瓶颈定位的结构分析根据定义13可知,非终止库所共有3种状态:主动受阻状态、被动受阻状态和流通状态.定义了如图6所示的图形符号来表示库所的3种不同状态和变迁成为瓶颈的可能性大小.4.1顺向结构分析4.1.1顺序结构分析图7是顺序结构示意图.因为在顺序结构不存在被动受阻库所,所以另外两种库所可能的几种分布如图8所示.首先对图8(a)进行分析,根据前面的算法1,我们知道此时只有库所s0可以作为当前库所进行瓶颈Page7定位分析.因为当前库所s0为流通库所,因此变迁t0是可实施的,存在从s0途经变迁t0流向s1的token流,如果:(1)λ0>λ1,则说明正常情况下对s1而言token流入速度大于流出速度,从而s1应该成为流通库所,但s1却为主动受阻库所,从而说明变迁t0发生了阻塞,它成为瓶颈的可能性高,即如图9所示.(2)λ0λ1,λ1>λ2,说明正常情况下,s2应该成为流通库所,但在图8(a)中s2并不是流通库所,从而说明t1发生了阻塞,t1成为瓶颈的可能性高,即如图10所示.继续分析如下:r-1),则说明tj-1成为瓶颈的可能性高;构中不存在成为瓶颈可能性高的变迁.依次类推,假设tr为顺序结构的最后一个变迁,(3)λ0λ1,λ1λ2,…,λj-2λj-1,λj-1>λj(j(4)λ0λ1,λ1λ2,…,λr-2λr-1,则说明该结下面对图8(b)进行分析,在图8(b)中库所s0和s1均可作为当前库所.当s0作为当前库所进行分析时,(1)λ0>λ1,根据图8(a)的分析可知在这种情况下t1成为瓶颈的可能性小;(2)λ0λ1,说明正常情况下s1的队列长度应小于等于s0的队列长度,如果这个条件不满足,则说明t0成为瓶颈的可能性高,即如图11所示.无论是哪种情况,都将当前库所修改为s1,然后继续进行分析.当s1作为当前库所进行分析时,情况同图8(a)的分析.下面考虑一般的情况,假设sf是顺序结构的首库所,sr是顺序结构的尾库所(r>f),sf到si连续i-f+1个库所均为流通库所(fir),si+1到sr均为主动受阻库所.根据前面的算法1可知sf到si之间的任何一个库所都有可能被选为当前库所,不失一般性,可以假设首先选择sj(fji)为当前库所,为了能够嵌套调用前面的分析方法,做如下处理.算法2.顺序结构的瓶颈预测算法.输入:WSCPAM输出:瓶颈预测结果1.从sj开始逆向搜索找到sf;2.如果sf状态为“尚未分析”,则将sf作为当前库所进行分析,其分析过程即为图8(b)的分析过程,并将sf的状态修改为“已分析过”;否则继续判断sf直接后继库所是否是“尚未分析”库所,如果是,则令它为当前库所,执行图8(b)的分析过程,将该库所的状态修改为“已分析过”;3.重复上述过程,直到当前库所为si,如果si的状态为“尚未分析”,则执行图8(a)的分析过程,并将si的状态修改为“已分析过”;否则算法结束.4.1.2分支结构分析图12是分支结构示意图.主动受阻库所或流通库所.显然,可以得到以下几点认识:(1)根据被动受阻库所的定义易知,si只可能是(2)由于我们进行的是前向结构分析,故在此结构中只有si可能被选为当前库所.(3)根据前面的算法1可知当前库所只能是被动受阻库所或流通库所.基于以上3点我们可以得出结论:在分析分支结构时,只有当si为流通库所时才有意义.因此在结构分析有意义的情况下,3种库所在分支结构的分布有如图13所示的几种:根据3种类型库所的定义进行简单分析可知:如果ti的后置库所是流通库所,那么该库所所属的后继结构可能是顺序结构或分支结构;如果ti的后置库所是被动受阻库所,那么该库所所属的后继结构为汇聚结构(如图14所示).也就是说,图13(b)中的sj所属的后继结构可能是顺序结构或分支结构;图13(c)中的sj,sk所属的后继结构可能分别是顺序结构或分支结构;图13(d)中的sj所属的后继结构是汇聚结构;在图13(e)中sj,sk均是汇聚结构,Page8需要注意的是si和sj不可能同时属于同一个汇聚结构,否则它们可以合并成一个库所;图13(f)中sj的后继结构为顺序结构或分支结构,sk的后继结构为汇聚结构.算法3.分支结构瓶颈预测算法.输入:WSCPAM输出:瓶颈预测结果1.如果sj,sk同为主动受阻库所,则说明变迁ti成为瓶颈的可能性高;否则执行步2;2.如果sj为被动受阻库所,则执行步5;3.如果sj为流通库,则执行步4;否则执行步5;4.如果sj的后继结构为顺序结构,则对sj执行图8(b)的分析过程;如果为分支结构,则对sj调用算法3,然后执行步6;5.对sj调用算法6;6.对sk重复步2~5.下面考虑更一般的情况,如图15所示的分支结构:假设用St0表示t0的后置集,S^t0表示t0后置主动受阻库所集,S⌒表示t0后置流通库所集,S=集,显然有St0=S^t0∪S⌒可知,此时s0是流通库所,是当前库所.算法.算法4.更一般情况下的分支结构瓶颈预测输入:WSCPAM输出:瓶颈预测结果1.如果S⌒法6,并把si标记为已访问过;执行步2;2.如果S⌒3.选择S⌒4.如果S⌒则执行步5;5.如果S··6.选择S··继结构为顺序结构,则对sj执行图8(b)的分析过程;如果为分支结构,则对sj调用算法3;并把sj标记为已访问过;7.如果S··否则执行步8;8.整个算法结束.4.1.3汇聚结构分析图16是汇聚结构示意图.在计算库所si和sj的平均消耗时延时,因为它们的fk相同,由式(9)可知,它们的平均消耗时延要么同为大数,要么同为小数.也就是说,变迁tk的前置集要么是(主动或被动)受阻库所集,要么是流通库所集.根据被动受阻库所的定义可知,tk的前置集不可能只包含被动受阻库所(被动受阻库所的存在依赖于主动受阻库所的存在),所以对于前置集大小为2的变迁tk而言,各种库所在其前置集中分布共有(1+(2-1))+1=3种,如图17所示.Page9对于一般情况,即tk的前置集大小为n的情况,根据上面的分析,可知共有(1+(n-1))+1=n+1种库所的分布.根据定义,当前库所只能是被动受阻库所或流通库所,所以不对图17(a)所示情况进行结构分析.算法5.汇聚结构瓶颈预测算法.输入:WSCPAM输出:瓶颈预测结果1.如果tk前置集均为流通库所(图17(b)所示),则说明tk成为瓶颈的可能性大;否则执行步2(图17(c)所示情况);2.此时说明瓶颈可能发生在si的前置区域,对si进行下面考虑更一般的情况,如图18所示.逆向结构分析,即调用算法7.用Sk表示tk的前置集,S^k表示Sk中主动受阻库k表示Sk中流通库所构成的集合,显然有Sk=k∪S··所构成的集合,S⌒合,S··S^k∪S⌒&&S··改为算法6.算法.算法6.更一般情况下的汇聚结构瓶颈预测输入:WSCPAM输出:瓶颈预测结果1.如果S··2.如果S^k≠&&S⌒执行步2;的库所si的前置区域进行结构分析,即调用算法7对si进行逆向结构分析,并将si打上已访问过的标志;3.重复步2直到S^k中再也找不到尚未被访问过的库所为止.说明:(1)“如果S··可能性大”,这是因为如果tk的前置集中存在流通库所,那么就不可能存在主动受阻库所和被动受阻库所.如果存在被动受阻库所,则一定存在主动受阻库所,这时流通库所也只能变换成被动受阻库所.所以说S··k≠就意味着变迁tk的前置集所包含的库所都是流通库所.(2)在具体实现时,做了简化处理.对于算法6中的循环〈步2,步3〉,只对集合S^k中的一个库所通过逆向结构分析定位出了一个可能的瓶颈,那么循环就结束.4.2逆向结构分析通过前面的分析可知,只有在对汇聚结构进行顺向结构分析时才需要对某个主动受阻库所进行逆向结构分析,如图17(c)所示.逆向结构分析共有图19所示的几种情况.假设逆向分析的起始库所为si,现分析如下:(1)显然图19(a)和图19(b)是逆向结构分析的递归Page10结束条件;(2)在图19(d)中si的前置结构是分支结构,si的前置变迁tk的其它分支不对si分支的性能构成影响,因此图19(d)与图19(c)等价;(3)图19(c)、图19(e)和图19(f)的处理类似,无论si的前置结构块是什么结构(顺序结构或者分支结构或者汇聚结构),匀是对si前置结构中的主动受阻库所进行递归逆向结构分析(如图19(c)的sk、图19(e)中的si、图19(f)中的si、sj).算法7.逆向结构分析算法.输入:WSCPAM输出:分析结果1.假设si的前置变迁为ti,如果|·ti|=1,则执行步2;否则(即|·ti|>1)执行步3;2.假设si∈·ti,如果si为流通库所,则变迁ti成为瓶颈的可能性大,执行步6;否则(即si为主动受阻库所)执行步5;3.如果s∈·ti,s均为流通库所,则变迁ti成为瓶颈的可能性大,执行步6;否则执行步4;4.如果s∈·ti且s为尚未被访问过的主动受阻库所(因为·ti可能包括多个主动受阻库所,需要对它们依次进行逆向结构分析),则执行步5;否则执行步6;5.用si替换si执行步1,即递归调用算法7;6.算法结束.说明:假设si的前置变迁为ti,如果|·ti|=1,则说明si的前置结构为顺序;如果|·ti|>1,则说明si的前置结构为汇聚,这个判断结果可以通过“结构发现”得到.4.3结构发现定理1.结构发现定理.假设库所si的后置变迁(或前置变迁)为ti,则有(1)如果|·ti|=1&&|ti顺序结构;(2)如果|·ti|=1&&|ti(3)如果|·ti|>1&&|ti证明.(1)由|·ti|=1&&|ti汇聚结构.一个前置库所和一个后置库所,且si∈|·ti|或者si∈·|,因此si所属的结构是顺序结构;(2)|·ti|=|ti1&&|ti显然是一个分支结构,且si∈|·ti|或者si∈|tisi所属的结构是分支结构;(3)|·ti|>1&&|ti1ti具有多个前置库所和一个后置库所,显然是一个汇聚结构,且si∈|·ti|或者si∈|ti结构是汇聚结构.分支结构;5实验分析为了测试策略BNL-WSCPAM的有效性,开发了一个界面友好的跨平台软件集成平台.该平台包括基于本体的Web服务组合需求获取子系统、按照需求规划组合服务子系统、消息服务器及Web服务组合流程控制子系统、Web服务组合性能分析仿真子系统和Web服务组合性能分析数学分析子系统.本文的工作属于平台Web服务组合性能分析数学分析子系统,该子系统以BPEL文件和WSDL文件作为输入,通过对二者的解析生成对应的基于SPN的Web服务组合性能分析模型WSCPAM,并在得到的WSCPAM上实现策略BNL-WSCPAM对Web服务组合进行性能评价和性能瓶颈预测.该子系统采用图形化的展示方式,图形化显示WSC-PAM模型以及性能瓶颈的预测结果,以便用户进行查看和分析.本系统采用的开发平台为eclipse,主要使用的开发语言为Java和SQL,开发过程中使用了Javaswing和多线程技术,采用的操作系统为Windows2003.Web服务组合中各子服务的服务速度一般呈现两种情况:服务速度差异不大,服务速度差异较大.第1种情况又有两种具体表现:大部分的子服务都是以较低的速度提供服务;或者都以较高的速度为用户提供服务.为了验证BNL-WSCPAM策略在上述情况下对Web服务组合瓶颈定位的有效性,设计了如表1所示的3种实验参数配置方案.表1中前两行所示的实验配置参数表示WSCPAM模型中各变迁的实施速率差异不大的情况,其中第1行表示变迁实施速率均处于较低水平;第2行表示变迁实施速率均处于较高水平;最后1行所示的实验配置参数表示实施速率差异较大的情况.在每种方案的速率范围内给每个变迁随机分配实施速率,在每种配置方案下运行BNL-WSCPAM策略100次.对得到的实验数据进行分析,考察BNL-WSCPAM策略在变迁实施速率普通较低或普遍较高或实施速率差异大时对性能模型WSCPAM的瓶颈预测情况,以此衡量预测结果的有效性.(1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)100(1,10)(1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)100(90,100)(1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)100(1,100)Page11某计算机公司计算机销售过程的工作流如图20所示[28].用户通过Internet或其它方式向公司发出订单,给出所需要的计算机基本配置和数量.公司接收用户订单,对订单进行检查,计算价格,检查零部件的库存情况,进行配置检查,确认用户的订单技术上是否可行.根据检查结果做出决策,如果检查通过,则通知用户付款和发出生产通知,在用户付款成功和装配完成后进行发货;如果检查不通过,则提出订单修改意见,并向用户反馈意见.图21测试用的WSCPAM模型表2~表4分别是在表1所示的3种实验参数配置方案下得到的瓶颈预测结果.从表2可以看出在变迁实施速率普遍较低时,预测的瓶颈主要集中在变迁6、变迁11和变迁14,其中变迁6在100次运行中均被定位为潜在的瓶颈,变迁11的预测命中率也高达98%,变迁14的预测命中率为90%.观察图21可以发现,这3个变迁均为汇聚变迁.由于变迁的实施速率差异性不大,故各库所中的token队列长度相差不大,又由于变迁的实施速率普遍较低,故各库所中的token队列长度变化比较平缓.在此情况下,受约束条件越多的变迁成为瓶颈的可能性越大.汇聚变迁所受约束条件比非汇聚变迁要多,图21中汇聚变迁6的汇聚率要高于同为汇聚变迁的变迁11和变迁14,同时变迁11是变迁14的直接前驱变迁,它们具有相同的前驱变迁7,且变迁7到达变迁14的路径长度要小于到变迁11的路径长度,这说明变迁11的处理压力要大于变迁14,因此算法给出预测结果是有效的.初始标识变迁实施(1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)(1,10)从表3可以看出在变迁实施速率普遍较高时,上述工作流对应的WSCPAM模型作为测试模型,如图21所示.图21中库所结点和变迁结点中的数字是它们的编号.预测的瓶颈主要集中在变迁2、变迁7和变迁8,其中变迁2和变迁8在100次运行中均被定位为潜在的瓶颈,变迁7的预测命中率也高达99%.观察图21可以发现,这3个变迁均为分支变迁.由于各变迁的实施速率相差不大且实施速率普遍较高,故各库所中的token队列长度变化幅度不大但频率较高.在此情况下,库所中的token队列长度为0的次数增多,从而分支变迁和顺序变迁相对于汇聚变迁而言成为瓶颈的可能性大.又由于顺序变迁的后置库所数少于分支变迁的后置库所数,故顺序变迁受后置库所中token队列长度变为0的影响要小于分支变迁,因此分支变迁成为潜在瓶颈的可能性最大,因此算法给出预测结果是有效的.初始标识变迁实施(1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)(90,100)28121从表4可以看出在变迁实施速率差异大时,预测结果与变迁实施速率普遍较高时的预测结果相同,主要集中在变迁2、变迁7和变迁8.在第3种实验参数配置环境下变迁2的预测命中率为100%,变迁7的预测命中率为82%,变迁8的预测命中率为77%,变迁7和变迁8的预测命中率较变迁实施速率普遍较高时要低一些.由于变迁的实施速率相Page12差较大即变迁实施速率不匹配的情况比较突出,从而使得各库所中的token队列长度相差较大,且有些库所中的token队列长度变化平缓而另一些库所中的token队列长度变化比较频繁,因此图13(c)所示分布和图17(b)所示分布的出现概率减少,而图13所示的其它分布和图17(c)所示分布的出现概率增大.故在此情况下,分支变迁成为瓶颈的可能性要高于汇聚变迁.因为顺序变迁的后置库所数少于分支变迁的后置库所数,故顺序变迁受后置库所中token队列长度变化的影响要小于分支变迁,分支变迁成为瓶颈的可能性要高于顺序变迁.综上所述,预测结果为变迁2、变迁7和变迁8是有效的.变迁7和变迁8的命中率比上一组实验要略低,主要是因为在本组实验中库所token队列的长度相差较大,有些token队列的长度可能达到一个比较大的值,从而使得分支变迁所有后置库所中的token队列长度均为0的可能性减少.初始标识变迁实施(1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)(1,100)6结论本文首先给出了一种基于SPN的Web服务组合性能分析模型WSCPAM,然后通过对WSCPAM的4种基本结构进行结构转换得到性能瓶颈定位分析结构集,在此基础上提出了一种Web服务组合性能瓶颈定位策略BNL-WSCPAM.该策略根据库所中token消耗的速度将库所分成主动受阻库所、被动受阻库所和流通库所3类,并通过对分析结构集中的结构进行顺向结构分析和逆向结构分析得到在3类库所所有可能分布下的性能瓶颈位置的预测结果,最后用测试用例说明了BNL-WSCPAM预测结果的有效性.通过WSCPAM的定义可知,WSC-PAM实质上是结构部分受限的SPN,因此如何将BNL-WSCPAM策略扩展到一般的Petri网将是我们今后的努力方向.
