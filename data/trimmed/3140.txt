Page1面向不确定图的概率可达查询袁野1),2)王国仁1),2)1)(医学影像计算教育部重点实验室(东北大学)沈阳110004)2)(东北大学信息科学与工程学院沈阳110004)摘要图的可达性查询被广泛应用于生物网络、社会网络、本体网络、RDF数据库和XML数据库等.由于对数据操作时引入的噪声和错误使这些图数据具有不确定性,已经有大量的针对不确定RDF和XML数据库的研究.文中使用可能世界语义模型构建不确定图,基于该模型,研究了概率可达查询(PR).处理PR查询是#P完全问题,对此文中首先给出一个基本随机算法,可快速地估算出可达概率,并且该值有很高的精确度.进一步,文中为随机算法引入条件分布(称为“条件随机算法”),采用图的不相交路径集和割集作为条件概率分布,因此改进的随机算法可准确地并且是在多项式时间内处理查询.最后基于真实不确定图数据的大量实验结果验证了文中的设计.关键词不确定图;可能世界;条件随机算法;路径集;割集1引言本文研究一个不确定图上任意两点的可达性问题.具体地,给出一不确定图和其任意两点s和d,欲返回s和d的连通概率.由于不确定图存在于许多应用中[1-5],研究不确定图中的可达查询十分必要,下面给出两个具体应用的实例.应用实例1.文献[3]给出了一个音乐推荐社会网络.该网络的每个节点代表一个音乐用户,赋予每条边一概率来表示一个用户的音乐建议将被另一个用户采纳的可能性.图1给出该网络的一部分,在图中,边e3上的概率表示用户B的建议影响用户A的概率是0.75.对图1,会提出查询“用户s的建议影响用户d的概率是多少?”.应用实例2.在生物信息学中,常用蛋白质作用(PPI)网络分析蛋白质之间的关系.在PPI网络中,节点表示蛋白质,边表示两种蛋白质之间的相互作用,其中可达查询是一种基本分析方法.例如,会提出“是否一种基因会间接地受另一种基因控制?或两种蛋白质之间是否存在生物路径?”等问题.由表1图1中s和d可达的可能世界e1e2e3e4e5(Pr=0.3672),e1e2e3e4e5(Pr=0.0918),e1e2e3e4e5(Pr=0.1224),e1e2e3e4e5(Pr=0.0408)e1e2e3e4e5(Pr=0.0306),e1e2e3e4e5(Pr=0.0136),e1e2e3e4e5(Pr=0.0102),e1e2e3e4e5(Pr=0.0034)e1e2e3e4e5(Pr=0.0648),e1e2e3e4e5(Pr=0.0072),e1e2e3e4e5(Pr=0.0918),e1e2e3e4e5(Pr=0.0162)e1e2e3e4e5(Pr=0.0306),e1e2e3e4e5(Pr=0.0054),e1e2e3e4e5(Pr=0.0216)一种直接求解PR查询的方法是枚举不确定图所有的可能图,并且对每个可能图做传统的可达查询处理.找出所有给定两点连通的可能图,对其概率求和,所得结果即是可达概率.该方法被称为Naive算法.但是,此方法的效率非常低,因为需枚举指数级的可能图.因此,欲快速求解查询,本文首先给出于不准确的PPI检测方法,使用不确定图表示PPI网络是合适的,其中不确定边的权值表示蛋白质之间存在相互作用的可能性[4,6].文献[7]给出一个真实PPI网络,其中每条边被赋予一个概率.此概率被定义为两种蛋白质之间的可靠性,该值越大,两种蛋白质之间越可靠.对于该网络,可以用可达查询计算一种蛋白质到另一种蛋白质的可靠性.从以上应用实例可看出,基于不确定有向图的可达性查询比在传统确定有向图的可达查询能表达出更丰富的语义.例如图1所示的音乐建议网络,边的方向表示建议的方向.传统的s和d之间的可达性查询仅返回s的建议可以影响d.但是,例1中提出查询不仅返回“可以影响”,而且还返回影响的程度.为解决不确定有向图的概率可达查询问题,本文采用可能世界模型[8-9](一种被用来描述概率数据库的模型)表达不确定图.具体地,给出一个不确定有向图,赋予每边一个存在概率,根据文献[1-4,7]应用的规定,本文假设不同边的分布是独立的.一个不确定图的可能世界是一个确定图,称为可能世界图(简称可能图),它是不确定图中所有边(取决于它们的存在性)组合的一个实例.一个可能图的概率是其所有存在边概率和其不存在边的不存在概率的乘积.给定不确定图两顶点s和d,从s到达d的可达概率是部分可能图概率的和,在这些可能图中,s和d必须是连通的.图1给出一不确定图,计算从s到d的可达概率.很明显该不确定图可派生出25=32个可能图.表1列出了所有s到d连通的可能图和相应的概率.那么s到d的可达概率即是这些可能图概率的和,其值是0.9176.一基本随机算法,该算法用于模拟产生可能图的过程,从而可以快速在此过程中求解查询,并用相关理论保证结果的准确性.此算法的缺点是对较小的可达概率收敛速度慢,而小可达概率是图数据库应用的主要特点,比如PPI网络中,蛋白质相互作用及其微弱.为弥补基本随机算法的不足,本文设计了Page3“条件随机算法”.改进后的随机算法能在多项式时间内高精度地求解小概率可达查询.2问题定义定义1.一个不确定图是集合G=((V,E),Pr)),其中(V,E)是有向无环图,Pr:E→(0,1]是定义边集中每条边存在的概率函数.从定义1易知确定图是一个特殊的边概率为1的不确定图.正如第1节提到的,本文使用可能世界模型来定义不确定图.在可能世界模型下,一不确定图可派生出一组确定图G=(V,E),此确定图称为可能世界图,简称可能图,它满足V=V,EE.根据文献[1-4,7]中的规定,本文假设不确定图不同边的概率分布是相互独立的,因此可能图的概率为Pr(G)=∏e∈E设Imp(G)为不确定图G的所有可能图的集合.显然Imp(G)的大小是2|E|,并且对任何可能图G有Pr(G)>0,∑Pr(G)=1.d,概率可达查询返回s到d的可达概率:定义2.给一不确定图G和其两个顶点s和其中RA(G,s,d)是s可达d的可能图的集合.注意到s和d在G中可能不连通,本文采用“Path-TreeCover”[10]方法首先测试s是否可到达d.如果它们连通,则计算可达性概率qpr.否则,直接返回不可达信息.接下来,本文都假设在G中s和d是连通的.在给出具体PR查询复杂度前,先给出如下概念.定义3.给定一个不确定图G和其两个顶点s和d,一个s-d割是一组边的集合,删除该边集,s和d不再连通.如图1所示,{e1,e2}是一个s-d割.定理1.计算不确定图中的可达概率是一个证明.假设G的m条边中,每条边的不存在#P完全问题.概率是1-p那么qpr=1-∑mλi是一个s-d割的大小.变换上式得下面用反证法证明定理,假设可在多项式时间内计算qpr.将m+1个不同p值代入方程(3),得m+1个线性方程,其中有m+1个未知数λi和m+1个已知数p和qpr.该线性方程组的系数矩阵是非奇异的,因此可用高斯消元迭代算法在多项式时间内求解方程组,从而可以在解集中快速找到最小s-d割的基数.因此,如果可以多项式时间计算qpr,那么可多项式时间得到图G最小s-d割的基数.但是计算一图s-d最小割的基数是一个#P完成问题[12],从而推出矛盾.3基本随机算法从定理1知,处理PR查询是#P完全问题,这也意味着不存在快速算法计算精确的qpr.因此,本节给出一简单而有效的抽样方法近似计算qpr.设Xe是一随机变量,以表示e存在于不确定图G派生出的可能图G的事件,如果e∈G,Xe=1,否则,Xe=0.令m=|E|,则随机向量犡=(X1,…,Xm)可表示G派生出G这一事件,易得出X的状态个数为2m.定义(犡)为根据式(2),可得qpr的值是E((犡)),算法1给出近似求解E((犡))的步骤.算法1.ApproxCompute().1.V=0;2.Repeat;3.对每边e∈E,以概率Pr(e)选取“1”作为Xe的值,或以概率1-Pr(e)选取“0”作为Xe的值,这样便可构成向量犡=(X1,…,Xm);4.if((犡)==1)5.V=V+1;6.UntilNtimes;7.ReturnV/N.当N的值足够大,Chernoff-Hoeffding界给出引理1.对任意的δ(0<δ<1)和τ(τ>0),如果N3ln2()δτ2,则Pr|V/N-E((X))>近似解的精确保证[11].τE((X))|δ.确度.定理2保证随机算法1的近似解有很高的精Page44改进的随机算法本节为随机算法引入条件分布(称为“条件随机算法”(CRA))来改进基本算法.改进的随机算法能在m(m=|E|)多项式时间内完成查询,同时得出高精度的结果.本质上说,算法1生成犡1,…,犡N与犡同分布的N个独立随机向量,得到的近似值q^BC可表示为这一近似结果的质量由100(1-α)%置信区间所给出①:其中σ^N是基于犡1,…,犡N对Var((犡))的估计.通常用置信区间的半宽度(HW)来衡量近似结果的质量.对于固定的α,有HW=z1-α/2Var((犡))如果HW很小,则说明估计的质量很高.此外,对较小的qpr,采用公式(4)估计出的q^BC方差会很高,有必要增加N来改善估计,会导致N的值非常大.相反如果控制N较小,估计的q^BC误差就很大.对于不确定图,小的qpr值可能出现在图中两个顶点距离非常大,或者每条边的概率值非常小的情况下.因此,需要降低Var(q^BC)以改善算法1,以保证对较大和较小的qpr都能快速收敛.一个有效降低Var(q^BC)的方法是引入条件分布[13].4.1条件随机算法首先介绍CRA的基本方法[13].设C=C(犡)是一离散随机函数,取值{c1,…,ck}.又引入因此得这里把集合C划分成k组,每组对应一个θi,其中第i组的大小为Ni(i=1,2,…,k),并且N1+…+Nk=N.第i组中的取值是根据犡的C=ci的条件分布生成的,用来估计条件期望θi(i=1,2,…,k).设{犡r,i:r=1,2,…,Ni}表示第i组的取值,则θi被估计为整合此k个估计,可得qpr的CRA估计:其中,Var(q^CRA)=∑k从式(10)可看出,条件估计的方差依赖于Ni.理想情况下,如果条件方差较大,则希望Ni也较大,反之亦然.因此最佳的分组能保证最小的总方差.然而,实际中这是很困难的,因为条件方差是未知的.为和Var(q^BC)进行比较,这里取Ni≈N·Pr(C=ci),i=1,2,…,k,那么,Var(q^CRA)≈∑k从式(11)可看出,CRA估计比算法1所得估计有更小的方差.这个数量可以解释为:C包含多少与相关的信息.因此欲选择较好的C,应该选取含有尽可能多关于信息的离散变量.但是,在应用CRA时还有其它一些重要的方面需要考虑[13].首先,C必须能在多项式时间内计算出其分布.其次,C可能取值个数(这里指k)不能超过m的多项式.最后,需可以对X关于C的条件分布进行快速抽样.在下一小节中,将给出满足上述条件的C.4.2条件分布的上界和下界基本框架如下:本节给出具体应用CRA估算qpr的算法,它的首先选取式(7)中,C(犡)··=L(犡)(犡)U(犡)作为CRA中的条件.使用这些界限,可得由式(12)给出的qpr的估计值,但这里需要产生独立同分布于Pr((犡)|C(犡))的N个样本.因此,最重要的一步是如何计算条件分布Pr((犡)|C(犡)),设S表示该条件分布,式(14)给出S的计算公式.本节把S的计算转换为计算基于每边随机变量Xi,1i|E|的条件分布,其结果由式(15)给出.选择不确定图G的不相交的路径集和割集向量作为(犡)的上下界.结合这些界的性质,给出基于迭代计算的①MartinHaugh.http://www.columbia.edu/mh2078/Page5策略求解Xi的条件分布,式(32)给出此结果.利用这些结果,便可计算条件分布S.最后,我们可以使用式(12)来估计qpr.要应用CRA,本文定义C(犡)··=L(犡)(犡)U(犡),其中L和U是不确定图对向量犡的结构函数.如果这两个函数非常逼近于(犡),便可估算一个准确的qpr.根据C的定义,C的可能取值是{(L,U)}={(0,0),(0,1),(1,1)},又有E[|L=U=0]=0和E[|L=U=1]=1.因此只需估计E[|L=0,U=1].观察到,Pr(C=(0,1))=Pr(L=0∩U=1)其中qU和qL分别是qpr=E[]的上界和下界.类似地可得Pr(C=(1,1))=Pr(L=1∩U=1)将这些结果代入式(9),得qpr的CRA估计:其中犡1,…,犡N是犡对(L=0,U=1)的条件分布的样本.设S表示此条件分布,得估计的方差:VarS(q^CRA)=1其中ES和VarS是S分布的期望和方差.从上式可看出,当qpr=(qU+qL)/2时,VarS(q^CRA)取最大值:从式(13)易知,当qU和qL尽可能接近时,可得很小的方差,这也意味着估计的收敛速度更快.现在我们对条件分布进行采样.首先引进了边状态概率Pi=Pr(Xi=1),i=1,2,…,m.此时条件分布S记为Pr(X1=x1,…,Xm=xm|U(犡)-L(犡)=1)=∏mi=1这样把对S的采样问题转化为对边随机变量Xi的条件分布的采样.由于边的概率相互独立,式(14)可写成PrXi=xi|U(犡)-L(犡)=1,∩i-1(PrU(犡)-L(犡)=1|∩i(=PrU(犡)-L(犡)=1|∩i-1(PrXi=xi|∩i-1(EU|∩ik=1Xk=x(=EU|∩i-1k=1Xk=x(=qU(犡i,犘)-qL(犡i,犘)qU(犡i-1,犘)-qL(犡i-1,犘)pxii(1-pi)1-xi(15)其中qU(犡i,犘)=EU|∩iEL|∩ik=1Xk=x(从式(15)可见,如果L和U可在多项式时间内完成计算,那么可在多项式时间内完成对条件分布S的采样.下面提出一种获得此上界和下界函数的方法.本文使用不确定图G中不相交路径集和割集作为(犡)的界限.定义4.给定一个不确定图G和其两顶点s和d,一条s-d路径是连通s和d的边集,一个s-d割是一边集,删除这一边集,s和d不再连通.如图1所示,{e1,e4}和{e2,e5}是两条路径,{e1,e2}和{e4,e5}是两个割.定义PS和CS分别为G的所有s-d路径和割的集合.这两个集合可唯一地确定G,因此可用来计算qpr.从概率理论,易得为简化表述,上述公式改写为qpr=E∏Path∈PS∏i∈Path其中∏i但计算式(16)是困难的,因为路径集或割集里的元素通常不会两两不相交,并且PS和CS的大小在最坏的情况下会以m的指数级增长.设PS和CS分别是PS和CS的子集,只由不相交的路径和割组成.已有具体算法可以直接产生它们,而不需要产生集合PS和CS.此外,PS和CS的大小总是小于m.Page6定义L(犡)和U(犡)如下,L(犡)=∏Path∈PS∏i∈Path由于PS和ES中的元素不相交,因此元素对应的事件是独立的,为此有E[L(犡)]qpr=E[(犡)]E[U(犡)].由于PS和CS分别是PS和CS的子集,由式(16)和(17)可得从上式可见,如果PS和CS的基数尽可能大,就会得到更紧的界.为此本文应用网络流理论中的两个定理[14].引理2.最大不相交s-d路径数等于最小s-d割的基数.引理3.最大不相交s-d割数等于最短s-d路径的长度.这里,我们使用文献[14]中的算法求解PS和CS基数的最大值,该算法可在多项式时间内完成.在图1中,PS和CS的最大集合分别为{{e1,e4},{e2,e5}}和{{e1,e2},{e4,e5}}.因此E[L]=1-(1-P1P4)(1-P2P5)=1-(1-0.85×0.8)(1-0.8×0.9)=0.9104,E[U]=1-(1-P1P4)(1-P2P5)=0.9506.由于PS∈PS,CS∈CS,因此有LU.例如,在图1中,(L=0.9104)(=0.9176)(U=0.9506).因此,式(15)中计算分布S所需的条件期望可计算如下:E(L|∩r=∏Path∈PS∏k∈Path\ErE(U|∩r=∏Cut∈[CS∏k∈Cut\Er其中Er={1,2,…,r},r=1,2,…,m.对式(15)所需剩余的计算项,我们构造递推式来计算.为此引入如下符号,aPath(Xr,P)=∏k∈Path\Er烄烅bCut(Xr,P)=∏k∈Cut\Er烆使用上述符号,可重写qL(犡r,犘)和qU(犡r,犘)为之后,假设qL(犡i-1,犘)和qU(犡i-1,犘)已算好,并且要计算qL(犡i,犘)和qU(犡i,犘).由于PS中的元素不相交,最多存在一个路径path∈PS,使得i∈path.同样最多存在一个割cut∈CS,使得i∈cut.此时由式(14)可得aPath(犡i,犘)=xi烄烅bCut(犡i,犘)=1-1-xi1-pi1-bCut(犡i-1,犘烆对从i-1到i没起作用的路径和割有将式(20)和(21)代入式(19),得最终结果:qL(犡i,犘)=1-1-aPath×(犡i,犘)qU(犡i,犘)=bCut×(犡i,犘)当qU(犡i-1,犘)和qL(犡i-1,犘)已知时,用式(22)可以在常数时间内计算qU(犡i,犘)和qL(犡i,犘).然后将qU(犡i,犘)和qL(犡i,犘)的结果代入式(15),其结果再输入式(14),最后可用式(14)求解条件分布S.这个过程可在O(m)时间完成计算.因此,一个采样过程(用式(12)产生的一个犡i)可在O(m)时间内完成.有了这些结果,便可由式(12)来估计qpr.采样的次数N仍采用定理2给出的值以保证结果的准确性.5性能分析本节用真实和合成的不确定图数据验证本文的算法,算法代码用VisualC++6.0编写,运行环境是奔腾43.0GHzCPU,2G内存和160G硬盘.对本文给出的算法,R-BC表示基本随机算法,R-CRA表示“条件随机算法”.真实不确定数据采用Entrezgene6091-OMIM127700数据库①.它是描述人类基因网络的数据库,其中网络节点代表“显性基因”,边被赋予小数权值以表示基因相互作用的大小.使用该数据库的5个基因网络作为不确定图数据,表2给出它们的参数.①http://www.ncbi.nlm.nih.gov/omimPage7图数据编号节点数量边集大小边的平均概率Dys145211130.423Dys2177541630.396Dys3325987900.212Dys46786140560.237Dys511368327540.311同时从Citeseer①中抽取图数据(|V|=12140,|E|=36874),并按正态分布N(0.7,0.2)为每边产生概率.每次实验时,随机地产生100个查询,记录下查询的平均代价.作为比较,本文也实现了第1节给出的Naive算法,因为目前还没有对此查询的工作.正如前文所述,R-BC和R-CRA的模拟次数都采用引理1给出的理论值,该理论值是由τ和δ来控制的.这两个参数是需要输入的,为取得对实际图2取不同δ时,采样算法的查询质量其次用真实数据测试算法的运行效率和可扩展性.图3给出测试结果,其中横坐标是Dys1~Dys5,纵坐标是运行时间.如图所示,所有曲线都随图规模的增加而增长.其中Nave增长的最快,到Dys2时就已经超过100s,Nave要枚举所有可能图,从而导致其时间的指数级增长.而R-CRA和R-BC都具有较好的可扩展性,即使对边数量超过3万的图Dys5求解NP难查询,它们的运行效率也是高效的,可在1min内完成.从结果中也可发现,尽管采用相同的模拟次数,R-CRA比R-BC花费略多的时间,因为R-CRA还需要计算图的路径集和割集.应用的最佳参数值,首先通过实验确定它们的取值.固定τ=0.1,改变δ的取值,用模拟值和真实值qpr的比来衡量不同δ取值下的查询质量.因为R-CRA有更好的查询质量,这里用R-CRA来测试.这里通过测试真实数据和合成数据给出结果.Dys2是小规模真实数据,Citeseer是大规模的合成数据,故选取它们更符合实际的应用.图2给出对数据Dys2和Citeseer的测试结果.从结果看出,查询质量随着δ的减小而增加.当δ减少到0.3以后,曲线的增长变得非常平缓,其中两组数据的查询质量都超过95%.当δ=0.3时,由定理2得N=570,这是一个合理的模拟次数.而对更小的δ,例如δ=0.05时,N=1107,这需要相当长的时间,而查询质量只比δ=0.3时略高些.因此这里取(τ,δ)=(0.1,0.3).最后测试R-BC和R-CRA的查询质量.正如第4节所述,在运行效率相同时,R-CRA有更高的查询质量,尤其对较小的qpr.因为真实数据的各参数已固定,这里用合成数据来检验,查询质量仍被定义为模拟值与真实值之比.为模拟小qpr,改变正态分布的μ从0.8~0.05,例如当μ取0.05时,qpr的数量级是10-6.图4给出测试结果,结果表明即使qpr小至10-6时,R-CRA的查询质量也高于90%.而在μ取0.4和0.8时,质量都在98%以上,而此种情况更符合真实的应用[3-5].相反随着μ的减少,R-BC的①http://citeseer.ist.psu.edu/oai.htmlPage8质量急速下滑,最小时已跌至50%.但在μ大于0.4时,R-BC的查询质量也高于90%,这说明在实际应用中,R-BC也有较可观的准确率.图5给出在不同方差σ下查询的质量.从图中可见,R-CRA的曲线比R-BC稳定得多,这说明R-CRA能较好地适应数据噪声动态变化的环境.6相关工作已有很多面向确定图的可达查询工作.文献[15]用图的传递闭包来压缩原始图,并在求解过程中把问题转化为网络流问题.文献[16]把图分成若干有向链,并每个顶点都记录了与其相邻的链,从而可常数时间求解查询.文献[17]首先提出树覆盖的方法,并以树为单元对图进行压缩,并证明此种压缩是保证可以求解查询的最优压缩.文献[18]和文献[19]都是在索引构建时间上改进了树覆盖方法.文献[10]拓展了有向链的方法,把问题转换成平面图的问题,并只需2跳即可完成查询.面向概率数据库的研究是现在的热点.早期工作的重点是在概率关系数据库上如文献[8-9,20],即处理概率SQL查询.之后研究者提出了一些查询类型及其处理方法,主要包括Top-k查询[21]和Skyline查询等[22].近年来开始关注结构化数据如概率XML数据[1,2].就图数据库而言,邹兆年等人[23]研究了不确定图的频繁子图挖掘,而张硕等人[24]研究了带索引的不确定图Top-k查询.7结束语本文所述是第一个面向不确定图研究可达查询的工作.采用细粒度的可能世界模型定义不确定图,从而使可达查询具有丰富的概率语义.在给出问题是#P难后,本文首先设计了一个基本随机算法求解查询.在理论分析了它的不足后,采用“条件随机算法”改进基本算法.其中选择不确定图的不相交路径集和割集作为可达概率的下界和上界去逼近真实概率,计算基于该界的条件分布可在多项式时间内完成,因此可多项式时间计算真实概率.此外基本和改进的随机算法都保证了高质量的估计结果.实验结果验证了本文的设计.今后将研究基于不确定图的多种查询.
