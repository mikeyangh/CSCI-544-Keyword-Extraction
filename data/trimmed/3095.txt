Page1基于一致分布的时间Petri网模型潘理1),2)丁志军2)陈刚2)1)(湖南理工学院信息与通信工程学院湖南岳阳414006)2)(同济大学计算机科学与技术系上海200092)摘要时间Petri网的现有分析理论主要关注基于区间端点的计算和推理,缺乏对实施区间内不确定性的定量描述,不利于时间Petri网进行系统性能评价和动态模拟实现.为了解决这一问题,提出基于一致分布的时间Petri网模型.首先给出变迁实施概率和变迁序列实施概率的计算方法;然后引入概率条件到状态类,用于构造时间Petri网的概率可达类树;最后给出动态模拟实验,检验理论方法的正确性.关键词时间Petri网;一致分布;实施概率;状态类方法;模拟1引言将时间约束引入Petri网是应用驱动的结果.当我们处理以系统性能或可靠性为设计目标的实时应用时,时间将显得尤为重要[1].时间约束可以引入到库所、变迁、弧和令牌[2-5],其中引入到变迁是一种常见的时间扩展方式.联系到变迁上的时间也有多种形式,其中时延Petri网(timedPetrinets)赋给每个变迁一个固定的延时[6];时间Petri网(timePetrinets)为每个变迁联系一个时间间隔[2];而随机Petri网(stochasticPetrinets)则使用服从某种概率模型的随机变量来描述实施时间[3,7].已经证明,时间间隔比固定延时具有更强的表达能力[8],因为间隔既Page2能反映事件发生的不确定性,又能刻画事件发生的时限性.时间Petri网已成为描述和验证实时系统最常用的形式模型之一.时间间隔虽然增加了时间Petri网的描述能力,但同时也增大了模型分析的困难程度.由于每个变迁的实施间隔包含着无穷多个可能的实施时间点,因此时间Petri网的状态空间通常是无限的.这就需要一种有限的结构来描述这种无限的状态空间.状态类方法应运而生,并已成为分析和验证模型时间性质的基本方法[8-10].特别值得一提的是,清华大学林闯教授提出一种不确定时段的扩展时段时序逻辑(EITL),给出了一套基于时间Petri网模型的推理机制,能在线性时间复杂度内定量计算各变迁之间的时序逻辑关系,是一种简洁、直观、高效的时段推理方法[11-12].在大多数实际情况下,由于实时系统的离散特性和外界许多不确定因素的影响,一个事件持续的时间并不能预先确定下来,但是事件结束的时间范围多数可以预测[11].这时候,使用时间Petri网来建模和分析这些系统将是一个合适的选择.然而,当我们进一步需要预测事件发生的概率时,或者需要模拟事件的动态行为时,仅仅使用区间端点来处理问题显然是不够的.这将迫使我们考虑如何在实施区间内假定一种合理的概率分布来分析这些问题.例如,某学生通常采用两种方式上学:(1)直接步行,需用时30~40min;(2)搭乘公交,需步行到公交车站、乘坐公交车、下车步行到学校,分别用时4~6min、22~30min、4~5min.如果我们想知道哪种方式更有可能更快地到达学校,那么就要认真考虑在时间区段内选取合适的概率分布来计算了.目前,时间Petri网的现有理论成果主要集中于基于区间端点的分析和推理,对时间区段内不确定性的刻画并没有展开实质性研究.例如,实施区间是否遵循一定的概率分布?如何模拟事件在区间内的动态行为?这些问题将关系到所建模型是否符合实际系统的需要,关系到模型性能指标的计算以及模型动态模拟的实现等等.本文的研究正是致力于这些问题的解决.文章初步选取一个基于区间的常用概率模型(一致分布模型)作为研究对象,假设时间Petri网的变迁实施时间在其实施区间上遵循一致分布.在此基础之上,围绕变迁实施概率计算、状态类方法以及动态模拟等一系列问题展开深入的研究,总结出一套切实可行的理论计算方法,并利用仿真实验验证理论方法的正确性.本文第2节给出一致分布和时间Petri网的基本定义;第3节提出基于一致分布的时间Petri网模型,给出变迁实施概率、变迁序列实施概率和概率可达类树计算方法;第4节设计基于一致分布的实验方案,对时间Petri网进行动态模拟仿真;最后一节总结本文.2基本定义2.1一致分布假设N是自然数集(包括0),R是实数集,R+是非负实数集.定义实数闭区间I={x∈R|axb},记为I=[a,b],这里a,b∈R且ab.在概率论中,连续一致分布是一类常见的概率分布.设随机变量X的概率密度函数为则称X服从参数为a,b的一致分布,记作X~U(a,b).其相应的累计分布函数为FX(x)=∫x若X~U(a,b),Y~U(c,d),且X,Y相互独立,则(X,Y)的联合分布函数F(x,y)为其中,f(x,y)=fX(x)·fY(y)是(X,Y)的联合密度函数.2.2时间Petri网用IR(IR+)表示所有(非负)实数闭区间的集合.设I,I1,I2∈IR,且I=[a,b],定义闭区间的一元和二元运算如下:(1)↓I=a,↑I=b;(2)|I|=↑I-↓I;(3)I1+I2=[↓I1+↓I2,↑I1+↑I2];(4)I1-I2=[↓I1-↑I2,↑I1-↓I2];(5)若I1∩I2≠,则I1∩I2=[max{↓I1,↓I2},min{↑I1,↑I2}].定义1[8].一个时间Petri网是一个六元组TPN=(P,T,Pre,Post,M0;SI),其中:(1)P={p1,p2,…,pm}是有穷、非空的位置集;(2)T={t1,t2,…,tn}是有穷、非空的变迁集;(3)Pre:P×T→N是向前关联矩阵;(4)Post:P×T→N是向后关联矩阵;(5)M0:P→N是初始标识;Page3(6)SI:T→IR+是变迁的静态实施间隔映射函数.对t∈T,SI(t)表示变迁t的静态实施间隔.Pre(p,t)=i(i>0)当且仅当存在一条从库所p到变迁t的权值为i的弧;Pre(p,t)=0当且仅当不存在从库所p到变迁t的弧.用Pre(t)∈NP表示t的输入库所多重集,即对应向前关联函数Pre中t列所对应的向量.用·t={p|Pre(p,t)>0}表示变迁t的输入库所集合,p·={t|Pre(p,t)>0}表示库所p的输出变迁集合.类似地,可以定义Post(p,t),Post(t),t·和·p.Petri网的标识M可表示为一个|P|维向量,其中第i个元素M(pi)表示库所pi中的令牌数.因此标识反映资源在库所集中的分布情况.定义2[13].如果Pre(t)M,则称变迁t∈T在标识M是使能的(enabled).如果变迁t在标识M是使能的,那么t可以实施(fire)并产生一个新的后继标识M,且M=M-Pre(t)+Post(t).用En(M)表示标识M的所有使能变迁的集合.用Newly(M,tf)表示在标识M实施tf后新使能的所有变迁的集合,即Newly(M,tf)={t∈T|(t∈En(M))∧((tEn(M-Pre(tf)))∨(t=tf))},这里M=M-Pre(tf)+Post(tf).注意Newly(M,tf)的定义采用了中间语义[14],即在新标识M使能且在中间标识(M-Pre(tf))不使能的变迁属于新使能变迁;或者变迁tf在它自己实施后仍然使能,亦看作新使能变迁.用dM(t)=min{M(p)/Pre(p,t)|p∈·t}表示变迁t的使能度.若dM(t)2,则称变迁t在标识M是多重使能的[15].为了简化问题的处理,本文不考虑变迁的多重使能.时间Petri网的状态通常采用两种表示方法:时钟方法[5,16]和间隔方法[8-9].时钟方法给每个使能变迁联系一个时钟,用来记录该变迁最近一次的持续使能的时间.间隔方法给每个使能变迁联系一个动态实施间隔,用来表示该变迁相对于当前状态的所有可能的实施时间.本文使用间隔方法.元组s=(M,f),其中定义3[8].一个时间Petri网的状态是一个二(1)M∈NP是标识;(2)f:T→IR是一个动态实施间隔函数.t∈T,f(t)表示t相对于当前状态的实施时间间隔.时间Petri网的初始状态s0=(M0,f0)定义如下:(1)M0是初始标识;(2)t∈En(M0),f0(t)=SI(t).统(TimedTransitionSystem)来刻画.TTS=(S,S0,Σ,→),其中时间Petri网的形式语义可以使用时间变迁系定义4[5].一个时间变迁系统是一个四元组(1)S是状态集;(2)S0S是初始状态集;(3)Σ是描述时间事件的标号集;(4)→S×Σ×S表示状态转移关系.在时间Petri网中,当一个变迁开始使能,该变迁就被赋予一个动态实施间隔,其初值为它的静态实施间隔.动态实施间隔随着时间的流逝同步减小.当动态实施间隔的下界到达0时,变迁可以实施.一旦动态实施间隔的上界减小到0,该变迁必须实施(即强语义).变迁实施不计时间.定义5.一个时间Petri网TPN=(P,T,Pre,Post,M0;SI)的形式语义定义为一个时间变迁系统TTS=(S,S0,Σ,→),且使得(1)SNP×(IR+)T是TPN的状态集;(2)S0={s0}是TPN的初始状态集;(3)Σ=T×R+是时间变迁标号集;(4)→S×Σ×S是状态转移关系,且使得d∈R+,tf∈T,(M,f)(tf,d→)(M,f)ifftf∈En(M),烄↓f(tf)d↑f(tf),t∈En(M),d↑f(t)M=M-Pre(tf)+Post(tf)烅t∈En(M),f(t)=SI(t),t∈Newly(M,tf)烆状态转移是指从状态s流逝一段时间d,然后实施变迁tf到达另一个状态s.状态转移关系(a)表明tf在M使能;(b)保证流逝时间d位于tf的动态实施间隔内;(c)确保d不超过所有使能变迁的实施时间上界;(d)计算新状态的标识;(e)计算新状态下使能变迁的动态实施间隔.3基于一致分布的时间Petri网模型3.1变迁实施概率假设时间Petri网中每个变迁的实施时间遵循一致分布.用X1,X2,…,Xn分别表示变迁t1,t2,…,tn的实施时间随机变量.如果使能变迁ti在时刻τ开Page4始使能,那么它的实施时间一定落在τ+SI(ti)区间内.因此,变迁ti的概率密度函数为fXi(xi)=假设ti和tj是两个使能变迁,它们的实施时间间隔分别为[ai,bi]和[aj,bj],则优先实施ti的概率为Pr(XiXj)=∫bj如图1所示,对于上述二重积分,可以分区段讨论如下:(1)若biaj,则Pr(XiXj)=∫bi(2)若bjai,则Pr(XiXj)=∫bi(3)若aiajbibj,则Pr(XiXj)=∫aj|SI(ti)|dxi+∫biai(4)若ajaibjbi,则Pr(XiXj)=∫bj(5)若aiajbjbi,则Pr(XiXj)=∫aj|SI(ti)|dxi+∫bjai(6)若ajaibibj,则Pr(XiXj)=∫bi用Pr0(ti)表示在状态s0实施变迁t的概率.我们推广到n个使能变迁的情况.假设t1,…,tn是状态s0的n个使能变迁,则在状态s0实施ti的概率为Pr0(ti)=Pr(XiX1,…,XiXn)=∫bi∫bi-1∫bn在积分计算的时候,要注意考虑积分区间分段的情况.以图2所示时间Petri网为例,在初始状态s0有3个使能变迁t1,t2和t3,它们在s0的实施概率Pr0(t1),Pr0(t2),Pr0(t3)分别计算如下:Pr0(t1)=0,Pr0(t2)=∫2Pr0(t3)=∫4值得一提的是,在传统时间Petri网中,t1和t3可以在时刻4同时发生.但是,在一致分布的时间Petri网中,t1和t3在两个端点处取值的概率为0.所以t3总是在t1之前实施.3.2变迁序列实施概率定义6[13].一个变迁序列σ是变迁集T上一个有限(或无限)的字符串.包含0个字符的序列称为空序列.一个序列w称为σ的前缀,当且仅当存在一个序列v使得σ=wv.用Pr(σ)表示变迁序列σ的实施概率.不妨设序列σ的最后一个变迁为tr.从初始状态开始实施序列σ之后所有使能变迁的集合用Enabled(σ)表示.假设ti∈Enabled(σ),则Pr(σti)的积分公式可以通过修改Pr(σ)积分公式获得.具体计算方法如下:(a)对于ti,若ti是新使能变迁,则在Pr(σ)的积分公式中增加一重积分:(b)对于tj≠ti,若tj∈Enabled(σ)是新使能变迁,则在Pr(σ)的积分公式中增加一重积分:Page5(c)对于tj≠ti,若tj∈Enabled(σ)是继续使能变迁,则修改Pr(σ)中关于tj的积分项下限为xi.(d)除上述3种情况之外,不修改Pr(σ)中的积分项.计算多重积分同样需要注意区间分段问题.我们仍以图2中时间Petri网为例,计算Pr(t3t1t5)的实施概率.首先计算Pr(t3).对于第一个实施变迁,采用3.1节介绍的方法计算.Pr(t3)=Pr0(t3)=∫4接下来计算Pr(t3t1).根据上述方法,通过修改Pr(t3)的积分公式,得到Pr(t3t1)积分公式如下:Pr(t3t1)=∫4其中t5为新使能变迁,t1为继续使能变迁.这里需要对Pr(t3t1)进行分段计算:(a)当x3∈[2,3],则∫32dx3∫712(b)当x3∈[3,4],则2dx3∫7∫312∫32dx3∫712故Pr(t3t1)=41最后计算Pr(t3t1t5).通过修改Pr(t3t1)积分公式,得到Pr(t3t1t5)的积分公式Pr(t3t1t5)=∫4其中t4是新使能变迁,t5是继续使能变迁.再对Pr(t3t1t5)分区段进行计算:(a)当x3∈[2,3]且x1∈[4,x3+2],则∫32dx3∫7122dx5∫x1+2∫x3+31(b)当x3∈[2,3]且x1∈[x3+2,x3+3],则∫32dx3∫7(c)当x3∈[3,4]且x1∈[4,x3+1],则∫42dx3∫713122x1x1+113x1+11(d)当x3∈[3,4]且x1∈[x3+1,x3+2],则∫42dx3∫713∫x3+32dx5∫x1+21(e)当x3∈[3,4]且x1∈[x3+2,6],则∫42dx3∫7对(a)~(e)项求和,我们得到Pr(t3t1t5)=93.3概率可达类树这一节我们讨论概率可达类树的生成方法.由于时间域的密度性,时间Petri网的可达性分析通常采用状态类方法.一个状态类是一个聚合的伪状态,它代表从初始状态出发实施相同变迁序列所能到达的全部状态[8].本文借鉴文献[8-9]中提出的状态类方法,将概率条件引入状态类,形成基于一致分布的时间Petri网状态类方法.元组C=(M,D,K),其中定义7.一个时间Petri网的状态类是一个三(1)M:P→N是标识;(2)D:T×T→IR是实施域.ti,tj∈En(M),D(ti,tj)代表变迁tj相对于变迁ti的实施时间间隔.特别地,令D(ti,ti)=0.(3)K:T→[0,1]是概率域.ti∈En(M),K(ti)表示变迁ti在状态类C的实施概率.定义8.初始状态类C0=(M0,D0,K0)定义如下:(1)M0是初始标识;(2)ti,tj∈En(M0),D0(ti,tj)=SI(tj)-SI(ti)且D0(ti,ti)=0.(3)ti∈En(M0),K0(ti)=Pr0(ti).接下来定义状态类的演化条件和规则.定义9(可实施条件).一个变迁tf∈En(Mk)在状态类Ck=(Mk,Dk,Kk)是可实施的(firable)当且仅当ti∈En(Mk),↓Dk(ti,tf)0且Kk(tf)>0.用Fr(C)表示状态类C的所有可实施变迁的集合.定义10(实施规则).假设从初始状态类C0=(M0,D0,K0)通过实施变迁序列σ=tr1tr2…trn到达状态类Ck=(Mk,Dk,Kk).如果变迁tf∈Fr(Ck),则实施tf到达状态类Ck+1=(Mk+1,Dk+1,Kk+1)由下列实施规则确定:Page6(1)标识Mk+1:Mk+1=Mk-Pre(tf)+Post(tf).(2)实施域Dk+1:ti,tj∈En(Mk+1),(i)Dk(ti,tf)={(ii)Dk+1(ti,tj)=-SI(ti),ti∈Newly(Mk,tf)[↓Dk(ti,tf),min{↑Dk(ti,t)|t∈En(Mk)}],o.w0,烄Dk(ti,tf)-Dk(tj,tf),ti,tj∈Newly(Mk,tf).烅Dk(ti,tj)∩(Dk(ti,tf)-Dk(tj,tf)),o.w烆(3)概率域Kk+1:ti∈En(Mk+1),使用状态类方法计算图2所示的例子,得到如图3所示的概率可达类树.值得注意的是,图3中虚线部分的结点是传统时间Petri网生成的状态类.在一致分布实施策略下,这些结点并不存在,因为从C0到C1的转移概率为0(即Pr0(t1)=0).因此,实线部分的结点才是基于一致分布的时间Petri网所产生的状态类.每个实线结点都附有一个时间间隔,这个时间间隔表示该状态类的到达间隔,或者说是沿初始(根)结点到达该结点所经过的变迁序列的实施间隔.从一个状态类转移到另一个状态类用一条有向边指示,有向边上标注着引发转移的事件(变表1图2时间Petri网基于一致分布的实施模拟结果状态类转移C0→C10.35205.600.32881.360.33260.220.33340.021/3≈0.3333C0→C20.64802.800.67120.680.66740.110.66660.012/3≈0.6667C2→C40.48303.620.47772.480.46510.220.46520.20179/384≈0.4661C2→C50.51703.160.52232.160.53490.200.53480.18205/384≈0.5339C4→C70.13426.160.14410.760.14491.320.14270.22128/895≈0.1430C4→C80.86581.030.85590.130.85510.220.85730.03767/895≈0.8570其它10迁)以及该事件的实施概率.从图中不难发现,分支处各条边的概率之和刚好等于1,每条路径的实施概率等于路径上各条边的概率之积.例如:在C2分支下,变迁t1的概率和变迁t2的概率之和为(179/384)+(205/384)=1;路径t3t1t4t5的实施概率为(2/3)×(179/384)×(128/895)×1=2/45.通过概率计算可以获得一些有价值的系统信息.假设图2中时间Petri网描述了两个任务的执行流程.任务1由t1和t4相继完成;任务2由t2完成、或者由t3和t5完成.如果系统要求任务1尽可能地先于任务2完成,根据前面概率分析,这种概率只有2/45.为了提高任务1优先完成的概率,可以适当提前t1和t4的实施时间.再如,我们计算出任务2交给t2执行或者交给t3和t5执行的概率分别是1/3和2/3,这又可以帮助我们进一步分析路径t2和路径t3t5上的工作负载情况.因此,通过一致分布模型获得的量化数据将有助于更好地评估系统性能和验证系统设计.4实验仿真本节设计和实现基于一致分布时间Petri网的仿真实验.实验方案设计如下:(1)一旦变迁ti开始使能,就根据一致分布在区间SI(ti)中生成一个随机数ui,表示该变迁(相对于使能时刻)的实施时间.(2)实施时间ui随着时钟的流逝同步减小.一旦ui到达0,就立刻实施变迁ti.因此,具有最小实施时间的变迁总是优先实施(时间竞争策略).(3)如果变迁ti丧失使能,该变迁则失去实施权(可设置ui=).根据设计方案,我们在Matlab2007平台上开发了一个基于一致分布的时间Petri网仿真工具箱.使用该工具箱对图2中时间Petri网的例子分别进行103次、104次、105次和106次运行模拟,得到如表1所示的统计数据.模拟概率10Page7对比表中数据不难发现,103次模拟产生的结果偏差较大,它与理论值的相对误差最高达到6个百分点,模拟统计值只能精确到十分位.当模拟次数达到104时,相对误差平均下降了2个百分点.当模拟数量级为105,相对误差基本在1%以下,统计值可精确到百分位.一旦模拟次数提升到106次,统计值与理论值的相对误差均控制在0.3%以下,其绝对误差值也限制在千分位上.所以,随着模拟次数的增加,模拟统计值与理论值的差距就越小.表中最后一行说明,在没有分支出现情况下(即只有一个子结点),状态类转移概率总是1,实验结果和理论结果保持一致.通过实验数据得出的结论进一步验证了理论计算方法是正确的.5结论时间Petri网关于时间性质的分析理论主要集中于区间端点的计算和推理方面,涌现了不少具有代表性的理论成果,比如状态类方法和扩展时段时序逻辑.但是,对于实施区间内不确定性的定量描述与分析一直未曾探讨.文章首次在时间Petri网中引入一致分布概率模型,并提出在一致分布下变迁实施概率、变迁序列实施概率、概率可达类树一系列问题的理论计算方法,为时间Petri网模型的性能评价和动态模拟研究提供了一条新的探索途径.经典时间Petri网侧重于变迁实施间隔的计算.在此基础之上,本文提出的模型还能计算变迁的实施概率,这对于既要考虑任务执行时间、又要考虑任务执行概率的实时系统来说是非常有益的.例如,我们可以分析任务的操作频率、不同路径的工作负载、到达某一状态的概率等,这些量化信息可以帮助我们评价系统的性能、分析系统的可靠性、调整系统的设计等等.未来工作将进一步探讨基于其他概率分布的时间Petri网模型(比如正态分布、三角形分布等)以及模型在一些典型实时系统中的应用,比如嵌入式实时系统、柔性制造系统等.
