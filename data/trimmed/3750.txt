Page1一种基于P2P流量规划的网络资源可重构分配方法马东超1)王晓亮2)杨参2)马礼1)1)(北方工业大学信息工程学院北京100041)2)(北京大学软件与微电子学院北京100871)摘要现有IP网络的无连接性和网络资源的松散管理结构使得网络流量存在全局范围内的分布不均情况,造成网络资源利用率低并且对运营商的一些突发的QoS需求很难做到快速响应.具备网络资源集中式管理特征的可重构网络虽然弥补了这一不足,但对特定业务的流量优化能力以及按需合理重构网络资源的能力不足,使得可重构网络资源分配及QoS保障技术仍有待进一步提高,尤其是占据网络流量主体的P2P业务流量和突发性高优先级QoS保障.当前的P2P优化以及流量工程技术不但自身存在不完善,并且也不能高效地直接适用于可重构网络环境中.因此,文中站在网络资源全局统筹的角度,提出了一种应用于可重构网络环境中的、基于P2P流量规划的网络资源动态可重构技术,使得可重构网络的资源管理机制有能力对全网P2P流量进行优化调度,尤其是能够在网络资源不足的情况下,通过调整P2P流量,释放指定网络资源以响应突发高优先级需求.通过仿真验证可见,以P2P流量规划的手段对全网资源进行全局规划、动态重构,形成弹性的可重构网络环境中,网络流量负担、P2P节点出、入度等多方面均有较大幅度提升,从而赋予了运营商一种对各种优先级业务的规划手段.关键词流量规划;网络资源可重构;P2P;突发流量需求1引言当前,运营商对网络设备铺设和升级的速度,已渐渐满足不了网络带宽需求的增长[1].同时,传统IP网络无连接的特性导致网络流量分布不均,网络资源难以得到高效利用,由此带来的对ISP网络规划能力的制约,导致保障业务QoS需求时成本很高.因此,在现有网络资源紧张的前提下,如何有效地规划网络业务量,从而使得网络的带宽资源得以合理的应用以及业务QoS得到保证,已经成为当前网络研究的热点问题之一.对于上述问题,当前的流量工程技术虽有一定成效[2],但受制于现行网络松散的资源管理结构.具有网络资源集中式管理特征的可重构网络及相关技术的出现,很好弥补了流量规划的不足.但其在特定业务的管理优化和网络资源动态调整方面仍存在不足,特别是对占据当前流量主体的P2P业务.然而,现有的P2P优化技术和流量工程自身尚不完善,不能直接适用于可重构网络的新型体系结构[2-3].可重构网络的新型体系结构的特点是主要网络能够智能地针对新业务的需求,在加载对应协议构件的前提下,面向新业务链接的颗粒度能够动态分配带宽资源满足业务需求[4-7].于是,本文从运营商统筹规划网络资源的层面,以可重构网络体系结构为基础,从优化P2P流量方面另辟蹊径,提出一种基于P2P流量规划的网络资源可重构分配方法,旨在完善可重构网络资源管理与QoS保障策略,使可重构网络能够对全局P2P流量进行动态优化.尤其是能够在突发高优先级业务需求的时刻不影响P2P使用者的网络感受的前提下有目标地释放指定链路上P2P所占的相当部分网络资源,来保证其它高优先级的QoS需求,形成按需分配的弹性网络环境,为运营商一定程度上降低网络带宽不足的问题,同时保证高优先级业务的带宽使用,在总体上赋予了运营商对网络资源按需重构的规划能力.2研究现状网络中流量分布不均的问题早已广泛受到学术界和业界的关注[2],并就此问题提出了多种流量规划技术加以解决[2-3,8],这些技术各有特点,并在均衡网络流量、缓解P2P应用引发的网络资源消耗等问题上,起到了一定的积极作用[3,8],但是也存在着一定局限性,特别是缺乏对全网集中全局管理的能力.近年可重构网络的提出,弥补了这方面不足,但是其在特定业务的管理优化和网络资源动态调整方面方面仍有待改善,其中首要考虑的就是P2P业务优化.在这方面,当前措施主要包括:P2P限制、P2P缓存和P2P本地化以及流量工程技术,由于网络基础结构的巨大差异,这些优化技术并不能直接高效适于可重构网络环境中.以下将分别介绍这些相关研究,在第3节中具体阐述其局限性.2.1传统流量规划技术现状在传统流量规划中,网络为每条链路设置权重,通过寻找最短路的方式来确定路由的路径.通过信息洪泛的方式,各节点都能够得到域内的拓扑信息并据此判断最短路径.例如早期出现的手工配置链路cost值、Cisco公司推出的增强网关内部路由线路协议(EnhancedInteriorGatewayRoutingProtocol,EIGRP)以及策略路由等手段[3].自从MPLS协议出现后,其在流量规划领域的应用就一直受到各方重视.MPLS是IETF提出的结合二层交换和三层路由的面向连接的数据传输技术[8].MPLS协议下的流量规划是为业务流选择路径的处理过程,以在网络中不同的链路、路由器和交换机之间均衡业务流.MPLS由于自身路由与转发分离的特点,适合与TE(TrafficEngneering)的结合,形成MPLS-TE技术[3,8-9].MPLS-TE通过感知网络带宽的使用情况,采Page3用带有约束条件的最短路径优先算法(ConstraintsShortestPathFirst,CSPF)计算满足带宽要求的路径,并通过资源预留协议(ResourceReserveProtocol,RSVP)建立带宽预留的TE隧道(Tunnel)[8-9],可以很好地解决基于内部网关协议的流量工程所不能解决的问题,尽可能提高网络资源的利用率[9].2.2当前流行的P2P优化研究现状P2P自其诞生起就在网络资源分配中,占据了很大部分.当前,P2P流量优化技术在缓解运营商面对的满足网络带宽需求以及整体网络资源的规划能表1研究现状限制P2P应用流量分析,按一定策略控制P2P应用部署P2P缓存缓存P2P流,减小带宽消耗流量本地化P2P流量本地消化,减少骨干网和跨域流量P4P技术2.3基于可重构网络的QoS研究随着信息产业的高速发展,当前面向业务支撑的传统网络,为承载特定业务和融合新兴业务不断构建和改造网络,依靠提升网络设备性能,增加复杂控制算法和协议等技术,不仅难以满足特性差异日益扩大的用户业务承载需求,而且付出了网络复杂度相对较高且传送效率相对低下的代价[4].为了摆脱传统网络技术体系束缚,提出了面向服务提供的新型网络技术体系———可重构网络[4,7,15].体系结构采用如图1所示的分布式管理模式.在该体系结构中,多个路由节点(RouterNode,RN)组成一个域(Domain),多个域组成一个区(Region),全网由多个区组成[5].其中,域内控制层部署柔性网力两个问题中,都扮演着非常重要的角色[10-12].网络运营商和学术界一直没有停止过研究和实施各种流量控制技术,主要分为以下3类[10-14]:进行限制.(1)限制P2P,部署流量监控设备对P2P应用(2)P2P缓存[11],通过架设P2P缓存设备来降(3)流量本地化[12-14],简单重定向到本地来限如表1所示.低带宽消耗.制网间流量.络配置代理(FlexibleNetworkConfigureBroker,FNCB),负责对域内路由节点资源信息和拓扑信息进行管理,FNCB的基本目标是避免拥塞问题以及由此引起的QoS服务等级下降问题[4-5].从网络流量的观点来看是对网络中各种业务流量分布的优化,从而提高网络传输效率.域间控制层部署根节点服务器(RootServer),负责协调管理域间资源信息和拓扑信息[5-6].在可重构网络中,用户业务和网络服务关系是松耦合.在资源管理层面引入QoS业务管理平台,并在接入设备处部署网络接入控制进行业务申请的集中管理[4-5].而全网的拓扑结构及网络资源等信息则由各FNCB及RS管理,并通过它们对网络资源和结构进行重构,通过集中式的网络资源申请及分配管理,保证当前QoS策略的实现[4,6].3问题分析网络拥塞在某种程度上是因为网络资源不足和流量分布不均匀造成的.前者唯一的解决办法是升级基础设施,提供更多的网络资源.后者则可以依靠资源调整来优化.当前的网络流量工程技术就是出于资源调整这一目的并取得了一定的成绩[2-3,8].但是,由于当前IP网络的无连接性以及现行网络松散的资源组织结构,缺乏资源和信息的集中管理使得当前流量工程的实际效果并不理想[8].例如动态路由协议RIP、OSPF和IS-IS,由于它们总是选择其Page4独自判断的最短路径转发IP包,都可能会导致不均匀的流量分布.结果在两个结点之间沿着最短路径上的路由器和链路可能发生了拥塞,而沿较长路径的路由器和链路却相对负载较轻,如图2所示.MPLS协议在理想情况下可以使到同一出口的不同路径上公平地装载流量,但由于其路径选择基于对网络状况的感知,而非实际的集中管理,故也会出现网络感知失真、流量失衡的情况[3,8-9].可重构网络及其相关技术的出现,很好地弥补了现有网络及流量工程的这一不足.由于其打破了当前网络的传统结构,采用FNCB、RS服务器管理全网资源,引入QoS管理平台和网络接入的申请机制,在网络结构的层面上对QoS的实现和保障明显优于传统网络结构[4].然而,可重构网络的资源管理机制在以下两方面仍有待提高:(1)需要根据业务特点进行流量优化,其中P2P业务所占比例很大,应重点考虑.可重构网络的QoS保障中使用的严格优先级划分、域间加权轮询等控制策略,将流量通过业务类别划分到各个传输队列轮询等待[4-6],这一方式中如果对P2P优先级设置较高,则影响其它业务;如果对P2P优先级设计很低,则影响P2P用户体验.而现有P2P优化技术在解决这一问题上,由于网络体系结构的差异,很难高效适用于可重构网络环境,更重要的是,现有P2P优化技术也都存在其自身的不足:①限制P2P应用一方面面临P2P应用提供商技术上的反击,造成P2P应用与ISP的更激烈的对立;另一方面,这也损害了ISP用户的合法权益.②P2P缓存由于P2P应用的开放性,ISP很可能因为缓存非法内容而遭遇法律问题.同时缓存设备和策略的高成本也限制了这一技术.③流量本地化简单的重定向机制会面临连接数限制、影响少数用户网络体验以及少数骨干链路负载失衡等问题.而以P2P提供商与ISP合作模式为基础的P4P及类似技术,由于缺乏动力和版权问题等,P2P提供商的合作积极性势必将受到影响.(2)当面对突发的高优先级QoS需求,尤其是网络资源不足的情况下,可重构网络管理机制缺乏有效的规划手段来充分利用全网资源.网络灵活调整自身流量的能力不足,很难做到既满足突发资源需求,又能合理调整当前流量,不明显影响现有连接的服务质量,达到全网资源和连接优化配置的目的.计算机网络的流量和服务等优化问题是近年来的研究热点,已有一些宏观的指导性文献[16-17],但针对本文的具体问题,需要有一个具体优化实例.于是,本文基于完善可重构网络流量管理及QoS保障技术的目的,从占据当前大部分网络资源的P2P流量进行优化的方面另辟蹊径(典型低优先级业务),提出一种基于P2P流量规划的网络资源可重构分配技术P2P-NRRA(P2P-flow-planningbasedNet-workResourcesRestructurableAllocation).旨在依托可重构网络体系结构的基础上,针对P2P流量和突发高优先级业务QoS需求,提出网络整体的资源管理技术,实现对全网P2P流量的优化,并可按需对指定链路的网络资源进行合理的动态重构,调整P2P流量以满足突发的网络资源需求,赋予ISP能够对网络资源按需进行灵活的总体规划的能力,最终在提高网络对高优先级业务的容纳能力的同时保障了P2P用户体验.4P2P-NRRA方案如上文所述,本方案将从重构、优化P2P流量入手,在可重构网络体系结构基础上,通过网内各FNCB和RS设备,获取全局流量信息,汇总计算当前全网状态的优化流量分布方案,来对网络资源进行重构,避免流量的不均匀分布,实现资源的优化利用.从理论上讲,传统的流量工程问题包含解决优化和满足约束两方面问题,通常其形式定义如下:令操作符T代表流量工程的处理,对于一个给定的网络G(V,E),D=∏i∈I的网络流量D;输出:怎样最优化在网络上传输流量D.算法的目标是决定一个优化的映射X,这个映射优于其它映射x∈X,这需要一个目标函数来辨别优劣:Page5其中的目标函数即是优化问题的核心,其模型建立和设定部分将在4.1节的问题建模部分详细讨论.为了部署和实现本技术,本文对可重构网络的图3可重构网络中的P2P-NRRA部署示意图在可重构网络体系结构中,对网络拓扑和资源管理的FNCB以及RS设备中部署本文提出的P2P-NRRA技术,将其模块动态加载于上述设备,无需对网络的体系结构、设备等进行任何的调整修改.流程方面,在可重构系统获取用户地理位置信息和网络相关信息时[4-7],进行业务类型判断,对于P2P业务及突发高优先级QoS需求,转入P2P-NRRA模块处理,并按照本模块输出的网络资源优化重构方案,调整和分配相应网络资源.下面将详细介绍P2P-NRRA的算法设计.4.1问题建模网络通信由其内部链路和网间链路组成一个全连接拓扑环境,在这里使用图G=(V,E)描述网络拓扑环境.对问题建模,其中V是表示网络环境中自治域的节点集合,E是边集合,每条边表示相连的自治域间的一个数据连接.对于任意一条边e(u,v)∈E都有一个连接开销,表示选择在自治域u和v之间建立连接的相应成本.在此网络环境下,为了描述问题的清晰,进行如下定义.定义1.定义集合P,对于P∈E,有e(u,v)∈P,表示在u,v间的链路存在P2P流量.定义2.定义集合H,对于H∈E,有e(u,v)∈H,表示在u,v间的链路存在高优先级流量需求.定义3.定义集合I,对于i∈I,表示一个端到端P2P流量的完整路径.于是,假设t1时刻,网络环境图G中的连接状态为S,其中节点u和v之间存在数据连接e∈P.下一时刻t2,网络环境图G中的连接状态发生变QoS保障机制进行改进,将充分利用可重构网络优异的可扩展性,通过管理平台将本技术构件化并直接动态部署于可重构网络的各层FNCB及RS设备中,如图3所示.化,记为S,其中节点u和v之间出现高优先级业务,释放此段链路上P2P占用的网络资源,即e∈H.此时,需要对G=(V,E)网络中的P2P流量需要进行重构,使得全网环境下的优化目标达到最优.整体的优化为了达到两个目标,其一是使得全网的网络开销尽可能的小;另一个是使得全网的链接变动尽可能的小.根据这两个优化目标,设函数F为全局优化目标函数,即全局优化目为找到一个全网连接状态S,使得式(1)取得最小值:F(S)=∑i∈I其中,α和β为Cost和Tran的计算权重;Cost为链路的连接开销;Tran为链路的变动开销.Cost的具体定义如下:对于任意i∈I,该链路的连接开销记为Cost(i).对于全局连接状态S,记某一连接i∈I的流量为H(i),连接成本为V(i),建立连接和维护开销为J(i),则全网连接开销Cost(S)定义如下:Cost(S)=∑i∈I其中,连接成本V(i)旨在量化某一P2P连接所占用的网络资源,并以此做为一个重要的参数来指导进行网络资源重构的方案设计.对于任意连接i上的任意一段物理链路e,其V(e)正比与物理链路的长度Le,该链路上的当前流量Flownow(e)以及使用该条物理链路的费用Exp(e),反比于该条链路的带宽B(e),即由此可得,全局优化目标函数F中的Cost(S)Page6的表达式如下:Cost(S)={∑i∈IH(i)·∑e∈i全局优化目标中的另一个重要优化项是全网的连接状态变动幅度,记为Tran(S).连接状态变动幅度由两个参数来加以描述,分别是变动次数Tc(S)以及链路的变动距离ΔD.即由于其中变动次数Tc(s)可以使用全网范围内每一条端到端P2P流量的路径是否调整来标示,全Le·Flownow(e)·Exp(e)4.2问题的复杂度情况及其证明本文上述P2P-NRRA问题可抽象为求解一个给定无向连通图中,在给每条边赋以权值的情况下,一个指定节点集合L∈V的最小生成树.下面证明该问题是NP难的.这里将利用基础的NP难———三精确覆盖(X3C)问题来辅助证明P2P-NRRA的NP难属性.首先,这里给出X3C问题的形式化定义如下:对于有限集X,有|X|=3q,设集合R为X中元素的三元组集合,即R={R1,…,Rn},RiX,Ri=3,1in.在此条件下,存在RR,对xX,均有xrnR,且|R|=q.下文的证明过程中将利用到一个文献中的辅助结构①,考虑到有助于理解下文的证明部分,这里同样给出这一结构的构造过程.定义节点集为V(G)={v}∪{r1,…,rn}∪{x1,…,x3q}.这里加入的节点v是为了将以下两个层次的节点联通成一个完整的树结构.定义边集为E(G)={vr1,…,vrn}∪∪xj∈Ri定义生成树节点集L为设NRRA所需要求解的最优解为K为4q.为了便于理解,可将上述设定表述如图4所示.于是,对于如上所述构造的辅助结构,将证明NRRA与X3C问题等价.(1)由X3C多项式规约NRRA.网范围内,Tran(S)可以由对所有i∈I的Tran(i)求和得到,其中变动距离D由经过的子网数来度量.于是,可以联立得出Tran(s)=∑i∈I烄烅i∈I,Tran(i)=1,链路i发生变动烆至此,本文给出了问题的形式化描述,并得出了完整的全网优化目标函数,联立式(1)~(3)可得函数F的表达式如下:没有变动设当前存在一个X3C问题的实例解R,为不是一般性,假设R={R1,R2,…,Rq},故,一定存在以下边vR1,…,vRq和Rixj,其中xj∈Ri,1iq,所以存在边数为q+3q=4q=K的生成树.设NRRA问题中e∈E,其权值为F(e).定义边长为1的无权值边为“标准边”eθ,其集合为E.设从NRRA边集E到E的映射为f,定义如下:e∈E,其两个顶点vi、vj由若干eθ连接,并满足∑eθ=F(e).于是,通过映射f将NRRA问题转换为求解无向连通图G(V,E)中,是否存在一个正整数K,使得不多于K条边即可连接L个顶点,形成一个图G的生成树,其中L∈V.由上文可知,存在此生成树.即该解符合NRRA所求.(2)由NRRA多项式规约X3C.设当前存在一个NRRA问题的实例解,同上①AlessandroSantuari.SteinerTreeNP-completenessProofPage7理,对NRRA问题中的边集做f映射,问题得以转换,即存在一颗生成树T拥有最多4q条边,由于T为树,故T最多拥有4q+1个节点.由于T必须包含的节点集为L=v,x1,…,x3{点.故R类节点最多有q个(图4第2层节点).若R类节点少于q个,考虑到R类节点向下的度为3,则不可能连接所有的3q个X类节点(图4第3层节点),故R类节点刚好有q个,为不失一般性,将其假设为R1,R2,…,Rq,则X3C问题的解即为至此,证明了NRRA与X3C问题间可以多项式规约,即NRRA问题为NP难,难以在多项式时间内找到最优解,后文应用一种性能尽量优化的启发式算法来求最优解.4.3算法描述按照上一节中对问题的数学描述,以及给出的全局优化目标函数,本文设计使用启发式算法对该优化问题进行求解.对于两个优化目标:一个是使得全网的网络开销尽可能的小;另一个是使得全网的链接变动尽可能的小,这都要求在系统算法和体系结构上有相应设计,以获取当前的全局信息.体系结构上的相关安排已于第4.1节做了详细介绍,主要通过在自治域的接入路由器上部署相应的下载信息统计和路径记录模块来获取相应信息,由此,系统的中心处理集群———云端处理平台上将获得当前全局P2P下载过程中的热点文件列表,记为List,云平台同时掌握List中包含的所有文件在全网中的布局情况,即对于f∈List,云平台均掌握一个集合V,对于v∈V,v上均有文件f的资源,将此映射记为RList→V.将得到如下的映射集合,记为P,即P=此外,借助自治域边界的接入路由器上的TraceRoute路径记录功能,则可获得P2P流量的拓扑映射关系,该映射关系记为Ri→e,i∈I,e∈E.于是,沿用4.1节对问题的相关定义和描述,当全网在状态S下时,由子网V1到V2链路记为链路i,其上出现了高优先级业务需求,需要释放该路径上可压缩的P2P流量,以此来满足高优先级业务的网络资源需求.此时,优化算法的目标为寻求一个即时条件下的全网连接状态S,使得优化目标函数取得最小值minF(S),以此获得当前状态下的最优解.首先,需要将链路i上的P2P流量进行分析汇总,得到该链路上P2P流量的所有发起节点,以及各个节点所要求的资源文件.即,得到该链路上P2P流量发起节点集合Vs与热点文件列表List之间的映射关系RVc→List,由此可得到形同集合P的需求集合P.之后,按照List列表中资源文件的热度高低降序排序,记热度最高的资源文件为f1,优先对其进行处理.为了方便叙述,这里设即在链路i上,有V1,V2,…,Vk节点发起的获取资源文件f1的P2P流量.之后,获取文件f1的布局映射RList→V(f1)以及P2P流量的拓扑映射关系Ri→e,i∈I,e∈E.此时,在选择新的peer节点时面对的困难是,P2P连接数是受到来自协议或来自P2P应用或用户体验的不同限制的,反应到本文建模的拓扑图G上,即对拥有资源文件的节点,其有出入度的限制,于是,对于同一个热点资源的需求队列中,任何一个节点先选定其更新的目标peer后,都有可能对其它尚未选定更新peer的节点,产生影响.如图5所示,节点1和2需要寻找新的peer,而节点3、4、5则都是拥有1、2所需的资源文件的节点,从图5上标示的优化目标函数F的取值可以看出,对于节点1和2自身来说,节点3是其局部最优解.但是此时节点3只剩1个可用连接数,若保证F最小值的2→3连接建立,则节点1需要与节点4建连,此时F(1,4)+F(2,3)=110,远远高于1、3建连,2、5建连时的F(1,3)+F(2,5)=45.由此可见,为了避免陷入局部最优,而导致算法的全局失效,需要在算法设计上做相应处理.从以上分析得到启发,本算法在此安排选取目标peer的优先级时,不是直接安装各个节点所能得到的最优解的优化程度(即目标函数F的值)排序,而是应该根据各个节点所能得到的最优解与次优解之间的差值大小排序.据此,分别计算V1,V2,…,Vk中各个节点在更换目标peer节点后,全网范围内,Page8能使得目标优化函数F值最优(即最小)的新peer节点A,以及使得F次优的peer节点B,分别记录这两个节点,并计算Vn选择这两个不同目标peer时,目标函数F的差值,记为Δτ(Vn).计算完成后,将Δτ(V1),Δτ(V2),…,Δτ(Vk)按照降序排列,优先让Δτ(Vn)值最大的节点Vn选取最优目标peer.若在Vn连接后,Vn的目标节点达到入度上限,则此时对V1,V2,…,Vk队列中,将最优解或次优解目标与Vn的目标节点相同的节点,更新其最优或次优解,并更新差值Δτ.依此循环进行,直到V1,V2,…,Vk均选定新的目标peer,此时,修正全网拓扑,并更新相应个边的连接开销.之后代入热点文件f2,循环进行,直到将该链路上的所有可释放的P2P流量全部重新规划至其它链路上.至此,完成了对网络资源进行全局优化的重构,在保证指定链路高优先级业务需求的前提下,整合全网资源,提升网络运营商的整体资源规划能力和服务质量.经过以上分析,将算法描述如下:1.检查指定链路i上的P2P流量.2.获得需求集合P,即指定链路i上P2P流量的各个发起节点的资源文件请求情况,并按资源文件热度排序.3.若此时集合P不空,则选择当前集合P中,热度最高的文件所映射的各个发起节点.否则,算法停止.4.根据映射关系RList→V和Ri→e,i∈I,e∈E,即文件在全网中的布局情况和P2P流量的拓扑映射关系,计算步3中选出的各个节点当前的最优解和次优解,计算Δτ,按照Δτ降序排列,并记此队列为L.5.若此时L不为空,则选择L中排序第一的节点,优先选择最优解目标peer,并将此节点从L中删除.若L为空,则跳转步7.6.若在步5选择后,该目标peer达到入度上限,则更新其它所有以此目标peer为最优解或次优解的节点,并更新Δτ,再次对L降序排序,跳转步5.否则,直接跳转步5.步3.7.从集合P中删除此文件与其起始节点的映射,跳转算法伪码描述0.NetResRecon(QueueP,RList→V,Ri→e,Req){1.ftop←FILM;Notetop,Notetop←NOTE;Lf,Lf←QUEUE;2.对P按照热点率降序排序;3.While(P≠temp<Req){4.ftop=Move(P);5.获取ftop所对应的节点列表Lf;6.While(Lf≠){7.Notetop=Move(Lf);8.根据RList→V和Ri→e计算Notetop的最优解、次9.}10.对Lf按节点Δτ降序排列,得Lf;11.While(Lf≠temp<Req){12.Notetop=Move(Lf);13.Notetop取最优解,更新Lf;14.temp+=Cost(Notetop);15.}16.}17.}由算法的伪码描述可以看出,算法框架上成两次循环的嵌套形式.设集合P中连接总数为N,则由于高优先级业务的带宽需求Req给定,实际运算中需要处理的连接数n∈N.算法中涉及排序的部分假设实现上采用快速排序,其时间复杂度为O(nlogn).设依据算法分析,所需重构的节点数为m,则伪码中6~9行时间复杂度为m的常数项,而11~14行的循环,由于其要根据当前节点Notetop的最优解更新Lf,重置其中最优解或次优解与当前节点冲突的节点备选对象,其中涉及对冲突节点的查找和当前节点的剔除,其时间复杂度应为m!.于是,本算法时间复杂度的估计为O(nm!).由于上述算法为近似的启发式算法,并不能完全保证在所有情况中均能取得理论最优解,对算法求得的优化解与理论最优解之间的差距会因具体网络环境不同而存在差异,现简要举例.如图6(a)所示,释放网络资源的目标链路为1-2-3,其所需资源在节点4、5、6、7处均有提供且这Page94个节点均只剩余1个可用连接数,连接成本如图6(a)所示.在此的网络环境中,理论最优解应该为1-4、2-5、3-6,连接成本总计为20+15+20=55.而使用P2P-NRRA技术,得到优化解的过程为:首先1选择最优解,不存在冲突,与4建连;2选择最优解6,与节点3的最优解冲突,计算两个节点最优解和次优解的差值分别为5、30,故节点3优先,与6建连,节点2与次优解5建连.故在此网络环境中,P2P-NRRA技术可以取得理论最优解.而如图6(b)所示的网络环境中,本算法最优解选择步骤为:节点1选择最优解,由于与2最优解和次优解的差值相等(20-15=25-20),故不产生冲突,节点1选择最优解5;节点2则选择次优解6,此时发现节点3无可用备选节点,产生节点饥饿.而理论上的最优解应为1-4、2-5、3-6所有节点均得到服务.可见P2P-NRRA算法在节点竞争并产生饥饿的环境中并未获得良好最优化性能,有进一步完善优化空间,后续研究中会详细演算近似比并完善本算法.图7仿真网络拓扑仿真结果如图8~图12所示,分别从上述方面反映了本文所提出的网络资源可重构分配策略的相关特性.下面本文针对这4个方面,对仿真结果分别进行详细说明.4.4算法仿真本文采用如图7所示的网络拓扑结构,对基于P2P流量规划的网络资源可重构分配策略进行NS2仿真.子网中包含若干网络终端设备,全网的终端设备总数浮动设置,进行总体规模上限为3000的多阶段仿真.各节点间的连线表示仿真拓扑中各子网的物理链路,其中各段链路的主要参数在仿真开始前进行统一设定,在结果统计时根据仿真数据和之前确定的全网相关参数(如链路长度、结算费用、带宽等),代入4.1节中的全网开销表达式中进行计算,获得相应开销值,并以此和仿真获得的相关数据,对2个方面的主要变化趋势和性能影响等进行分析验证.这2个方面分别为(1)考察网络高优先级业务突然出现时,本算法在网络重构的收敛速率、对全网性能以及被重构节点性能等方面的影响.效果、对网络节点性能等方面的影响.(2)考察本文提出的算法在不同网络规模下的考察网络高优先级业务突然出现时,本算法在网络重构的收敛速率、对全网性能以及被重构节点性能等方面的影响.图8为全网环境下,出现高优先级业务时,在使用本文策略进行全网优化的情况下,Page10全网的连接开销和平均吞吐率随着时间的变化情况,图9为在同图8情况下,被重构节点的流量随时间的变化情况.在图8和图9中,横轴为时间,跨度为0至400s.图8纵轴为比率,为了将全网开销和平均吞吐率曲线调整到一个合适的坐标空间,此处将开销值取1/1000,吞吐率取1/20.两条曲线分别为全网平均吞吐率随时间的变化情况和全网开销随时间的变化情况,此时的网络规模为3000个节点,在时间t=150s时,全网范围出现20%的高优先级业务量.由图8可以看出,当全局范围内出现高优先级业务时(即t=150s时刻),全网的实时吞吐率会在当时受到较大影响,并在25s内达到负影响的极大值,至此,网络重构开始收敛,由于重构算法分层迭代的设计,全网吞吐率开始呈现阶梯状回升,并在175s后,回复到重构前的速率水平,而曲线代表的全网开销,则呈现出在第150s的时刻高优先级业务出现,并引发网络重构后,逐渐降低,并在网络吞吐率稳定前基本达到新的稳定水平,减少了13%的全网连接开销.而图9中,可以看出被重构节点在第150s的时刻,流量发生锐减,并在之后70s内保持相对平缓的降低并达到极小值,这是因为重构算法在根据重构流量中的文件热点度进行迭代重构.此后,流量开始呈现阶段性的回升,达到重构前的流量水平.而全网节点流量总体变化较为平缓,当相应节点发生流量重构时,全网节点平均流量出现平缓上升,随着相应节点流量重构结束,全网平均流量平缓回落至初始水平.通过图8和图9,可以发现,本文提出的策略是能够在可接受的时间范围内快速收敛的,在保证了高优先业务需求的前提下,降低了全网的连接开销,使得整体结构更加合理,同时有效减少了对P2P用户的使用影响.Page11为讨论本文提出的算法在不同网络规模下的效果、对网络节点性能等方面的影响,给出下面实验结果.其中,文件热点率保持为2%,图10为全网开销随网络规模的变化曲线图,两曲线表示使用和未使用本文重构策略的网络开销变化趋势.图11为全网节点的平均跳数随网络规模的变化图,3根方柱分别是无策略、简单重定向策略和本文策略的情况.图12为节点平均入度随网络规模的变化,同图11.由图10可看出,全网的开销随网络规模的增大呈现加速增长的趋势,不同的是,未按本文策略进行优化的情况下,网络开销的增长速度则要大于进行全网优化的情况,尤其是随着网络规模的增长,这种差别呈现出逐渐增大的趋势.表明本文策略有效控制了随网络规模增大而加速激增的全网连接开销.而图11中,文件热点率保持在2%不变的情况下,可以看出在1000、1750和2500这3种网络规模上,经过本文策略优化的网络结构下,平均跳数均小于未经优化的网络,而简单重定向机制则介于两者之间.从图12中可以看出,按照本文的优化策略,全网范围内,节点入度达到3及以上的节点数要高于未经优化和按照简单重定向机制进行优化后的网络,这给高入度节点带来了一定压力.5有关部署方面的局限性关于本文方案在部署中的问题以及与P4P的关系,在此做阐述.首先,可重构网络体系结构及相关技术的部署实现,需要对当前网络做出重大调整,配备或升级大量的相应网络承载设备加以支持,这一网络升级过程具有一定的困难和阻力.但即便如此,可重构网络具备资源配置方面的重大优势,使近年来呼声逐渐提高,在未来确有可能会逐步替代现有网络架构.在这种局面下,本文方案可依照第4节中所述方案部署实施.同时,考虑到可重构网络全面替代现有网络还需时日,笔者也对本文方案在现实网络环境下的部署实施进行了相应的分析设计,在此做一讨论,其结构如图13所示.本文方案在现实网络环境中的部署实施,仅需要网络的边缘汇聚路由器提供相应支持;同时,需要一组中央服务器,在其上部署本技术的规划算法,当网络规模很大时则可以搭建云处理平台,如图13所示.受当前网络运营的商业模式所限,云平台无法在不同运营商之间共享,因此针对现实网络的部署实际情况需要各运营商针对自治域或自治域联盟部署自己的云平台管理自治域中各网域之间的流量分配.上述部署方法在现网中可行性较强,如下文所述:汇聚路由器需要向云平台提供其网内的网络信息.当前多数厂商的主流路由器都已具备了DPI功能,且运营商也已部署各层别的DPI设备,这一信息在当前环境下是可以提供的.另一方面,汇聚路由器需要接受云平台返回的优化方案,调整相应流量.此时,需要边缘路由器获取peerlist信息.这种协议干预方面的实验,作者在格林威尔的EPON接入的OLT设备EP6100及比威12008系列路由器上均做过实验,验证了方案的可行性.云平台上部署P2P-NRRA规划算法,获取由各域中的汇聚路由器上报的网络信息,优化调配全网资源.当网域内某链路出现高优先级业务时,依据当前网络状态,调用P2P-NRRA算法,生成相应规划方案下发,保证高优先级业务的网络资源需求,同时最大限度的降低对P2P应用业务的影响.另外,本文的方案与P4P的主导思想并不矛盾,而是调整和细化.一方面针对P4P的信息共享提出了基于DPI的调整建议,另一方面细化了当网络高优先级业务来临的情况下的一种以调整P2P流量来满足高优先级业务的最优化算法.6结束语本文针对网络资源分配不均的实际问题,尤其网络面对高优先级业务时的容纳能力有限和P2P业务汹涌的现实情况,在可重构网络架构逐渐明朗化的今天,独辟蹊径地提出了一种以调整P2P业务为主要手段的网络资源分配方案.在保障P2P用户感受的前提下,有目标的释放突发需求的指定链路上P2P所占的大部分网络资源,来保证其它高优先级的业务应用,形成可由运营商全局统筹的、按需分配的可重构柔性网络环境,为运营商极大减轻了网络带宽的负担.Page12本文详细仿真验证了方案的可行性和效果.通过仿真结果看出本技术可有效优化全网P2P流量,并在突发高优先级业务时,以P2P应用小幅波动为代价,有效的按需重构指定链路的P2P流量,达到全网资源合理分配,形成弹性的网络环境.此外,后续针对可重构网络短期内无法迅速铺开的现状,对现有网络架构做出了一种部署方式的讨论,详细说明了现网部署对网络改造的程度不大,论述了其可行性.本文的后续研究中,将重点针对当前网络运营商业模式下,运营商各自为政无法有统一云平台管理的部署问题进行深入探讨和思考,拟建立博弈模型对此问题进行分析并考虑统一云平台的可行性方案.致谢在此,由衷感谢林闯老师对本文工作提出的宝贵意见和建议!
